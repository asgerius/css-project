[{"tags": ["c++", "inheritance"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user3849502"}, "edited": false, "score": 1, "creation_date": 1547680602, "post_id": 54226630, "comment_id": 95279692, "body": "I am not sure why I got -1, at least the person who did that should mention the reason if there is something unclear"}, {"owner": {"reputation": 25894, "user_id": 4304, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5MIg7.jpg?s=128&g=1", "display_name": "zdan", "link": "https://stackoverflow.com/users/4304/zdan"}, "edited": false, "score": 2, "creation_date": 1547680735, "post_id": 54226630, "comment_id": 95279733, "body": "I can&#39;t reproduce your issue. What compiler/compiler options are you using?"}], "answers": [{"comments": [{"owner": {"reputation": 124806, "user_id": 121747, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/9fcebb68b105446c0d9eebbce1146044?s=128&d=identicon&r=PG&f=1", "display_name": "Jack", "link": "https://stackoverflow.com/users/121747/jack"}, "edited": false, "score": 1, "creation_date": 1547687665, "post_id": 54227648, "comment_id": 95281191, "body": "A <code>virtual</code> destructor is basically required as soon as you introduce a <code>virtual</code> method or the compiler might not know how to delete your derived objects."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user3849502"}, "is_accepted": false, "score": 0, "last_activity_date": 1547687395, "creation_date": 1547687395, "answer_id": 54227648, "question_id": 54226630, "link": "https://stackoverflow.com/questions/54226630/how-to-solve-a-mesh-inheritance-problem-in-c/54227648#54227648", "title": "How to solve a mesh inheritance problem in C++", "body": "<p>The problem turned out to be related to other virtual functions inside the original classes that I had in my code. The code above works without any problem. During the development, I had encountered other problems so I post her a new code that solves all these problems with comments mentioned next to them:</p>\n\n<pre><code>// Top Level (Level 1)\n\nclass Abstract_Class_A\n{\n     ~Abstract_Class_A (); // To solve source type is not polymorphic\u201d when trying to use dynamic_cast\n};\n\nclass Abstract_Class_B: virtual public Abstract_Class_A\n{\n  public:\n  uint8_t type;\n};\n\nclass Abstract_Class_C: virtual public Abstract_Class_A\n{\n};\n\n// Second Level (Level 2)\nclass Impl_Class_A : virtual public Abstract_Class_A\n{\n  public:\n  double angle;\n};\n\nclass Impl_Class_B: virtual public Abstract_Class_B, virtual public Impl_Class_A // Missing second virtual\n{\n};\n\nclass Impl_Class_C: virtual public Abstract_Class_C, virtual public Impl_Class_A // Missing second virtual\n{\n};\n\nvoid test()\n{\n  Impl_Class_B* test = new Impl_Class_B ();\n}\n</code></pre>\n\n<p><strong>Notes:</strong> </p>\n\n<ol>\n<li>With this type of inheritance paradigm, you cannot use <code>static_cast</code> but rather <code>dynamic_cast</code> should be used. Check the following <a href=\"https://stackoverflow.com/questions/3747066/c-cannot-convert-from-base-a-to-derived-type-b-via-virtual-base-a\">discussion</a>.</li>\n<li>When using <code>dynamic_cast</code> you should add a virtual destructor to the top class. Check the following <a href=\"https://stackoverflow.com/questions/15114093/getting-source-type-is-not-polymorphic-when-trying-to-use-dynamic-cast\">discussion</a> about it.</li>\n</ol>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user3849502"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1547687395, "creation_date": 1547679366, "question_id": 54226630, "link": "https://stackoverflow.com/questions/54226630/how-to-solve-a-mesh-inheritance-problem-in-c", "title": "How to solve a mesh inheritance problem in C++", "body": "<p>I have the following set of classes that inherit from each other in a mesh way. In the top level, I have abstract classes. Both <code>Abstract_Class_B</code> and <code>Abstract_Class_C</code> inherit from <code>Abstract_Class_A</code>.</p>\n\n<p>In the second level of inheritance, I have the exact implementations of those classes. </p>\n\n<ol>\n<li><code>Impl_Class_A</code> inherits from <code>Abstract_Class_A</code>.</li>\n<li><code>Impl_Class_B</code> inherits from both <code>Abstract_Class_B</code> and <code>Impl_Class_A</code>.</li>\n<li><code>Impl_Class_C</code> inherits from both <code>Abstract_Class_C</code> and <code>Impl_Class_A</code>.</li>\n</ol>\n\n<p>When I compile the below code, the compiler compiles perfectly if I do not declare any class in the code. But when I start declaring pointer to the classes in the second level, the compiler gives the following error:</p>\n\n<pre><code>undefined reference to `VTT for ns3::Impl_Class_B'\nundefined reference to `vtable for ns3::Impl_Class_B'\n</code></pre>\n\n<p>I used <code>virtual</code> to tackle the typical diamond problem in inheritance, but I am still not able to compile. It makes sense that the compiler gets confused because of this way of inheritance. But my system requires such a design for those classes. Any solution to fix this problem?</p>\n\n<p>The code:</p>\n\n<pre><code>// Top Level (Level 1)\n\nclass Abstract_Class_A\n{\n};\n\nclass Abstract_Class_B: virtual public Abstract_Class_A\n{\n  public:\n  uint8_t type;\n};\n\nclass Abstract_Class_C: virtual public Abstract_Class_A\n{\n};\n\n// Second Level (Level 2)\nclass Impl_Class_A : virtual public Abstract_Class_A\n{\n  public:\n  double angle;\n};\n\nclass Impl_Class_B: virtual public Abstract_Class_B, Impl_Class_A\n{\n};\n\nclass Impl_Class_C: virtual public Abstract_Class_C, Impl_Class_A\n{\n};\n\nvoid test()\n{\n  Impl_Class_B* test = new Impl_Class_B ();\n}\n</code></pre>\n"}, {"tags": ["c++", "c++17", "boost-hana"], "comments": [{"owner": {"reputation": 10248, "user_id": 268396, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4220afde4dd928ef33648797c7415ada?s=128&d=identicon&r=PG", "display_name": "user268396", "link": "https://stackoverflow.com/users/268396/user268396"}, "edited": false, "score": 0, "creation_date": 1547679027, "post_id": 54226407, "comment_id": 95279156, "body": "That is what <code>Algorithms in Hana always return a new container holding the result.</code> would suggest... You are encouraged to use pure functions and create new objects over performing destructive updates on old ones."}, {"owner": {"reputation": 69264, "user_id": 256138, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ed9e8c0ff767e38f8fade11f5af00a45?s=128&d=identicon&r=PG", "display_name": "rubenvb", "link": "https://stackoverflow.com/users/256138/rubenvb"}, "reply_to_user": {"reputation": 10248, "user_id": 268396, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4220afde4dd928ef33648797c7415ada?s=128&d=identicon&r=PG", "display_name": "user268396", "link": "https://stackoverflow.com/users/268396/user268396"}, "edited": false, "score": 0, "creation_date": 1547679440, "post_id": 54226407, "comment_id": 95279278, "body": "@user268396 what if I have a huge struct all filled in with complicated things, but I want to set a single member? Is that really impossible? In the mean time I discovered <code>hana::members(a) = input;</code> also &quot;works&quot; in the sense that it compiles, but again, the lhs is a copy of the members so <code>a</code> is never modified."}], "answers": [{"comments": [{"owner": {"reputation": 69264, "user_id": 256138, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ed9e8c0ff767e38f8fade11f5af00a45?s=128&d=identicon&r=PG", "display_name": "rubenvb", "link": "https://stackoverflow.com/users/256138/rubenvb"}, "edited": false, "score": 1, "creation_date": 1547729335, "post_id": 54227626, "comment_id": 95297153, "body": "This does not give me write access to <code>a</code> though, because of the by value semantics. I need accessors like@Jason suggested."}], "tags": [], "owner": {"reputation": 7407, "user_id": 1757805, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/AMueI.jpg?s=128&g=1", "display_name": "Francis Cugler", "link": "https://stackoverflow.com/users/1757805/francis-cugler"}, "is_accepted": false, "score": 0, "last_activity_date": 1547687173, "creation_date": 1547687173, "answer_id": 54227626, "question_id": 54226407, "link": "https://stackoverflow.com/questions/54226407/how-to-assign-to-members-of-a-struct-object/54227626#54227626", "title": "How to assign to members of a struct object?", "body": "<p>I'm not real familiar with Boost nor Hana; but I went to their website and read a little bit of their documentation on some of their objects, functions etc. I do not know if this will help you but I was able to modify your code slightly and I got this to compile:</p>\n\n<pre><code>int main() {\n    A a;\n    auto tuple = hana::make_basic_tuple( 42, \"42\" );\n\n    hana::for_each( hana::zip( hana::members(a), tuple), \n                               [&amp;](auto&amp;&amp; element) {\n                                   hana::at( tuple, hana::size_c&lt;0&gt; );\n                                   hana::at( tuple, hana::size_c&lt;1&gt; );\n                               }\n                  );\n\n}\n</code></pre>\n\n<p>I changed your lambda to have <code>[&amp;]</code> and changed the parameter to be an <code>auto&amp;&amp;</code> and I used <code>hana::at()</code>. AFAIK I do not think this is assigning anything at the moment but you might be able to use this and go from here, but the positive part is that on the same website your provided with your demo code and with the same compiler settings, this did compile without error. <a href=\"http://coliru.stacked-crooked.com/a/37f89d31dfc72dba\" rel=\"nofollow noreferrer\">Live Demo</a></p>\n"}, {"comments": [{"owner": {"reputation": 69264, "user_id": 256138, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ed9e8c0ff767e38f8fade11f5af00a45?s=128&d=identicon&r=PG", "display_name": "rubenvb", "link": "https://stackoverflow.com/users/256138/rubenvb"}, "edited": false, "score": 0, "creation_date": 1547729283, "post_id": 54229590, "comment_id": 95297126, "body": "This seems to be it. I was trying to tie an accessors instance to <code>a</code>, but that&#39;s not how it works, the binding is done at the call site of the contained &quot;getters&quot;. Thanks!"}], "tags": [], "owner": {"reputation": 1567, "user_id": 800347, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7Buq1.jpg?s=128&g=1", "display_name": "Jason Rice", "link": "https://stackoverflow.com/users/800347/jason-rice"}, "is_accepted": true, "score": 4, "last_activity_date": 1547703631, "last_edit_date": 1547703631, "creation_date": 1547703193, "answer_id": 54229590, "question_id": 54226407, "link": "https://stackoverflow.com/questions/54226407/how-to-assign-to-members-of-a-struct-object/54229590#54229590", "title": "How to assign to members of a struct object?", "body": "<p>To modify a <code>Struct</code> in place, use <a href=\"https://www.boost.org/doc/libs/1_69_0/libs/hana/doc/html/group__group-Struct.html#ga983a55dbd93d766fd37689ea32e4ddfb\" rel=\"nofollow noreferrer\"><code>hana::accessors</code></a> which provides a tuple of <code>hana::pair</code>s each with a key and an accessor function. Also since we don't have reflection yet you need to use one of the macros like <a href=\"https://www.boost.org/doc/libs/1_69_0/libs/hana/doc/html/group__group-Struct.html#gaba3b4d2cf342bfca773e90fc20bfae91\" rel=\"nofollow noreferrer\"><code>BOOST_HANA_ADAPT_STRUCT</code></a> to implement <code>A</code> as a <code>hana::Struct</code> .</p>\n\n<p>The other answer addresses the lambda taking an rvalue  because the zipped tuple is a temporary object.</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>#include &lt;cassert&gt;\n#include &lt;boost/hana.hpp&gt;\nnamespace hana = boost::hana;\nusing namespace hana::literals;\n\n#include &lt;string&gt;\n\nstruct A\n{\n  int integer;\n  std::string string;\n};\nBOOST_HANA_ADAPT_STRUCT(A, integer, string);\n\nint main()\n{\n  auto tuple = hana::make_tuple(42, \"42\");\n  A a;\n  hana::for_each(\n    hana::zip(hana::accessors&lt;A&gt;(), tuple),\n    [&amp;a](auto&amp;&amp; element) {\n      auto accessor_pair = hana::at_c&lt;0&gt;(element);\n      auto get_member = hana::second(accessor_pair);\n      get_member(a) = hana::at_c&lt;1&gt;(element);\n    });\n\n  assert(a.integer == 42 &amp;&amp; a.string == \"42\");\n}\n</code></pre>\n"}], "owner": {"reputation": 69264, "user_id": 256138, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ed9e8c0ff767e38f8fade11f5af00a45?s=128&d=identicon&r=PG", "display_name": "rubenvb", "link": "https://stackoverflow.com/users/256138/rubenvb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 226, "favorite_count": 1, "accepted_answer_id": 54229590, "answer_count": 2, "score": 4, "last_activity_date": 1547703631, "creation_date": 1547678026, "last_edit_date": 1547678416, "question_id": 54226407, "link": "https://stackoverflow.com/questions/54226407/how-to-assign-to-members-of-a-struct-object", "title": "How to assign to members of a struct object?", "body": "<p>I'm taking my first steps with Boost.Hana, so please bear with me. I have</p>\n\n<pre><code>#include &lt;boost/hana.hpp&gt;\nnamespace hana = boost::hana;\nusing namespace hana::literals;\n\n#include &lt;string&gt;\n\nstruct A\n{\n  int integer;\n  std::string string;\n};\n\nint main()\n{\n  auto tuple = hana::make_tuple(42, \"42\");\n  A a;\n  hana::for_each(hana::zip(hana::members(a), tuple), [](auto&amp; element) { element[0_c] = element[1_c]; });\n}\n</code></pre>\n\n<p>This is my attempt at assigning each tuple element to its respective (sequential) member of A. This does not work (see <a href=\"http://coliru.stacked-crooked.com/a/b550120b90b858d0\" rel=\"nofollow noreferrer\">live example</a> for complete error). It boils down to</p>\n\n<pre><code>main.cpp:19:54: note: candidate function [with $0 = boost::hana::tuple&lt;int, int&gt;] not viable: expects an l-value for 1st argument\n\n hana::for_each(hana::zip(hana::members(a), input), [](auto&amp; element) { element[0_c] = element[1_c]; });\n                                                    ^\n</code></pre>\n\n<p>I read in the documentation that Hana algorithms have <a href=\"https://www.boost.org/doc/libs/1_69_0/libs/hana/doc/html/index.html#tutorial-algorithms-value\" rel=\"nofollow noreferrer\">by-value semantics</a>, but then how would one go about doing this kind of thing? Is constructing an <code>A</code> from the <code>hana::tuple</code> the only thing possible?</p>\n"}, {"tags": ["c++", "smart-pointers"], "comments": [{"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1547677734, "post_id": 54226343, "comment_id": 95278732, "body": "Not the problem but the first code block should be <code>Thing(int data, Thing*&amp; thing_ptr) {     data_ = data;     thing_ptr = this;   }</code> otherwise you have undefined behavior."}, {"owner": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 1, "creation_date": 1547677747, "post_id": 54226343, "comment_id": 95278733, "body": "<code>Thing th(6, thing_ptr);</code> what happens if <code>th</code> goes out of scope. Also what happens if the smart pointer tries to delete the object on the stack."}, {"owner": {"reputation": 1961, "user_id": 7022459, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/646lY.png?s=128&g=1", "display_name": "Apollys supports Monica", "link": "https://stackoverflow.com/users/7022459/apollys-supports-monica"}, "edited": false, "score": 0, "creation_date": 1547678365, "post_id": 54226343, "comment_id": 95278952, "body": "Well, I think that&#39;s why I put the <code>thing_ptr</code> in the same scope as <code>th</code>.  But it does seem that this approach might be opening the door for a lot of problems.  Maybe the right way is just to assign the pointer after construction?"}, {"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 1, "creation_date": 1547678794, "post_id": 54226343, "comment_id": 95279076, "body": "<i><code>this</code> is not really a pointer to <code>Thing</code>, but rather a pointer to an uninitialized block of memory with the right size to hold a <code>Thing*</code></i> It&#39;s an initialized block of memory. C++ requires all objects to be initialized before entering the body of a constructor."}, {"owner": {"reputation": 1961, "user_id": 7022459, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/646lY.png?s=128&g=1", "display_name": "Apollys supports Monica", "link": "https://stackoverflow.com/users/7022459/apollys-supports-monica"}, "reply_to_user": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1547678808, "post_id": 54226343, "comment_id": 95279080, "body": "@NathanOliver Can you quickly explain why?  I thought I can do something like <code>void foo(int* p) { *p = 5 }</code> and then later <code>int x = 7; foo(&amp;x)</code> yielding the value 5 to be assigned to x.  Is this different?"}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 3, "creation_date": 1547678925, "post_id": 54226343, "comment_id": 95279118, "body": "When you do <code>Thing* thing_ptr;   Thing t(6, thing_ptr);</code> <code>thing_ptr</code> doesn&#39;t actually point to anything.  doing <code>*thing_ptr = *this;</code> then dereferences a pointer to &quot;nothing&quot; and assigns an object to it but you are not allowed to do that.  There is no object at where the pointer points."}, {"owner": {"reputation": 9427, "user_id": 7703024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94e363e0e11695395e04f814233b6274?s=128&d=identicon&r=PG", "display_name": "super", "link": "https://stackoverflow.com/users/7703024/super"}, "edited": false, "score": 0, "creation_date": 1547679328, "post_id": 54226343, "comment_id": 95279245, "body": "Smart pointers own the objects they refer to. Trying to make a smart pointer refer to an object that already exists defeats the whole purpose of the <b>smart</b> part of the pointer. This is what raw pointers are for. (possibly weak pointer, bu then the original object need to already be a <code>std::shared_ptr</code>)."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1547682426, "post_id": 54226343, "comment_id": 95280174, "body": "The second example attempts to hand over ownership of <code>*this</code> to <code>thing_ptr</code>, but you&#39;re not allowed to do that. (The object will be destroyed twice, which has undefined behaviour.) Transfer of ownership is not something an object itself can decide, only its rightful owner can."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1547682603, "post_id": 54226343, "comment_id": 95280209, "body": "Since your &quot;non-smart&quot; version assumes that it&#39;s given a valid pointer (it has undefined behaviour otherwise, such as in your example use), why wouldn&#39;t the &quot;smart&quot; version assume the same?"}], "answers": [{"comments": [{"owner": {"reputation": 1961, "user_id": 7022459, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/646lY.png?s=128&g=1", "display_name": "Apollys supports Monica", "link": "https://stackoverflow.com/users/7022459/apollys-supports-monica"}, "edited": false, "score": 0, "creation_date": 1547679799, "post_id": 54226627, "comment_id": 95279401, "body": "This is cool, I didn&#39;t know it is allowed to make constructors private."}], "tags": [], "owner": {"reputation": 65594, "user_id": 459640, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/bc790307b3c4cdbd25f582d9067651f1?s=128&d=identicon&r=PG", "display_name": "aschepler", "link": "https://stackoverflow.com/users/459640/aschepler"}, "is_accepted": false, "score": 3, "last_activity_date": 1547680652, "last_edit_date": 1547680652, "creation_date": 1547679355, "answer_id": 54226627, "question_id": 54226343, "link": "https://stackoverflow.com/questions/54226343/smart-pointers-this-and-constructors/54226627#54226627", "title": "Smart Pointers, this, and Constructors", "body": "<p>The most common use of smart pointers is to manage the lifetime of an object.  But note that when you declare a variable with class type, as in</p>\n\n<pre><code>Thing th(6, thing_ptr);\n</code></pre>\n\n<p>you have no choice about the lifetime of that object: it will end at the next enclosing <code>}</code> if declared in a function block, or with the end of the lifetime of the containing object if declared as a class member, or at the end of the program if declared as a namespace member.  <code>std::unique_ptr&lt;T&gt;</code> using the default deleter can only contain a pointer to an object that was created using <code>new</code>, since the default deleter attempts to use <code>delete</code>.</p>\n\n<p>If your pointers will always be to objects with ordinary declarations like this, and not created with using <code>new</code>, then you're stuck making sure on your own that the pointers are only used during the lifetime of the objects they pointed at.  And in that case, there's not much advantage to be gained from using <code>std::unique_ptr</code>; you can go ahead and use a raw pointer, which is still the ordinary way to represent a pointer when something else (here the C++ language itself) is responsible for lifetime issues.</p>\n\n<p>If you want the possibility of pointers that outlive the function block where the object is created, you can't use the ordinary object declaration syntax.  One possible alternative would be to require all object creation to use a <code>create</code> function rather than directly declaring an object:</p>\n\n<pre><code>class Thing {\npublic:\n    static std::unique_ptr&lt;Thing&gt; create(const Thing&amp; src)\n    { return { new Thing(src) }; }\n    static std::unique_ptr&lt;Thing&gt; create(int data)\n    { return { new Thing(data) }; }\n\n    void PrintData() const;\n\nprivate:\n    // All constructors private, to make sure a Thing can ONLY be\n    // created by a create() function - including the copy constructor.\n    Thing(const Thing&amp;) = default;\n    explicit Thing(int data) : data_(data) {}\n\n    int data_;\n};\n\nint main() {\n    auto thing_ptr = Thing::create(6);\n    thing_ptr-&gt;PrintData();\n}\n</code></pre>\n"}], "owner": {"reputation": 1961, "user_id": 7022459, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/646lY.png?s=128&g=1", "display_name": "Apollys supports Monica", "link": "https://stackoverflow.com/users/7022459/apollys-supports-monica"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 236, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547680652, "creation_date": 1547677581, "question_id": 54226343, "link": "https://stackoverflow.com/questions/54226343/smart-pointers-this-and-constructors", "title": "Smart Pointers, this, and Constructors", "body": "<blockquote>\n  <p><strong>Synoposis:</strong> convert the raw pointers in the first block of code below to smart pointers while leaving the rest of the functionality as\n  unchanged as possible.</p>\n</blockquote>\n\n<hr>\n\n<p>I was writing some code in which I'm trying to pass a pointer into an object's constructor, with the goal of making this pointer point to the constructed object by the time the constructor returns.</p>\n\n<p>(Note: this originated in a much more complicated situation, but I've simplified it to the essence of the problem.  Thus, if you try to ask <em>why</em> I'm doing this, you won't necessarily find a sensible answer in this context - but that's not the point of the question.)</p>\n\n<p>After struggling with the smart-pointer implementation, I reverted to raw pointers to ensure I wasn't missing a fundamental problem:</p>\n\n<pre><code>#include &lt;iostream&gt;\n\nclass Thing {\n public: \n  Thing(int data, Thing* thing_ptr) {\n    data_ = data;\n    *thing_ptr = *this;\n  }\n\n  void PrintData() {\n    std::cout &lt;&lt; data_ &lt;&lt; std::endl;\n  }\n\n private:\n  int data_;\n};\n\nint main() {\n  Thing* thing_ptr;\n  Thing t(6, thing_ptr);\n  thing_ptr-&gt;PrintData();\n\n  return 0;\n}\n</code></pre>\n\n<p>That went without a hitch, but when I returned to smart pointers, I couldn't seem to reproduce this functionality.  The basic problem is that I don't know how to initialize the smart pointer without either doing unnecessary extra work or not behaving correctly.</p>\n\n<p>The first thing I tried was:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;memory&gt;\n\nclass Thing {\n public: \n  Thing(int data, std::unique_ptr&lt;Thing&gt;&amp; thing_ptr) {\n    data_ = data;\n    thing_ptr = std::unique_ptr&lt;Thing&gt;(this);\n  }\n\n  void PrintData() {\n    std::cout &lt;&lt; data_ &lt;&lt; std::endl;\n  }\n\n private:\n  int data_;\n};\n\nint main() {\n  std::unique_ptr&lt;Thing&gt; thing_ptr;\n  Thing th(6, thing_ptr);\n  thing_ptr-&gt;PrintData();\n\n  return 0;\n}\n</code></pre>\n\n<p>which I suppose fails (core dump at runtime) because <strong><code>this</code></strong> is not really a pointer to <code>Thing</code>, but rather a pointer to an uninitialized block of memory with the right size to hold a <code>Thing</code>.  Actually I'm not 100% sure what's happening here, but since this failed with both <code>unique_ptr</code> and <code>shared_ptr</code>, I decided I should first initialize the smart pointer, and then assign <strong><code>this</code></strong> to its contents.</p>\n\n<p>The problem is that I can't get around creating an extra object with this method (which in turns requires even adding an additional constructor).</p>\n\n<pre><code>  Thing() : data_(0) {}\n\n  Thing(int data, std::unique_ptr&lt;Thing&gt;&amp; thing_ptr) {\n    data_ = data;\n    if (!thing_ptr) {\n      thing_ptr = std::make_unique&lt;Thing&gt;();\n    }\n    *thing_ptr = *this;\n  }\n</code></pre>\n\n<p>Here I make a <code>Thing::Thing()</code> only to assign it away the very next line, which is certainly not the correct approach.</p>\n\n<p>Could someone <s>smart</s> point me in the right direction?</p>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 2, "creation_date": 1547677513, "post_id": 54226289, "comment_id": 95278628, "body": "Stop using <code>using namespace std;</code>, prefix <code>std::</code> for whatever you use from the standard library instead."}, {"owner": {"reputation": 3125, "user_id": 2878796, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8bxWv.png?s=128&g=1", "display_name": "UnholySheep", "link": "https://stackoverflow.com/users/2878796/unholysheep"}, "edited": false, "score": 5, "creation_date": 1547677523, "post_id": 54226289, "comment_id": 95278636, "body": "You didn&#39;t <code>#include &lt;vector&gt;</code> in your header. Also you should write <code>std::vector</code>"}, {"owner": {"reputation": 1727, "user_id": 3166476, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/tU6SH.jpg?s=128&g=1", "display_name": "lakeweb", "link": "https://stackoverflow.com/users/3166476/lakeweb"}, "edited": false, "score": 0, "creation_date": 1547677547, "post_id": 54226289, "comment_id": 95278648, "body": "<code>using namespace std;</code> is what is getting you into trouble, Don&#39;t do it. use the qualified name like <code>std::vector</code>,, especially in headers."}, {"owner": {"reputation": 68702, "user_id": 1593860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1361e47a8bf06d20ffda9a686ceb7e68?s=128&d=identicon&r=PG", "display_name": "Pete Becker", "link": "https://stackoverflow.com/users/1593860/pete-becker"}, "reply_to_user": {"reputation": 1727, "user_id": 3166476, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/tU6SH.jpg?s=128&g=1", "display_name": "lakeweb", "link": "https://stackoverflow.com/users/3166476/lakeweb"}, "edited": false, "score": 4, "creation_date": 1547677867, "post_id": 54226289, "comment_id": 95278776, "body": "@lakeweb \u2014 you\u2019re right that <code>using namespace std;</code> is a bad idea, but it\u2019s not the problem here."}, {"owner": {"reputation": 1727, "user_id": 3166476, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/tU6SH.jpg?s=128&g=1", "display_name": "lakeweb", "link": "https://stackoverflow.com/users/3166476/lakeweb"}, "edited": false, "score": 0, "creation_date": 1547678138, "post_id": 54226289, "comment_id": 95278879, "body": "Yes it is. You are &#39; using namespace std;` after you include Print.h. Hence, the error."}, {"owner": {"reputation": 249, "user_id": 4592520, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c362fd37c32b17ea32a4bd4989f0bac6?s=128&d=identicon&r=PG&f=1", "display_name": "cmehmen", "link": "https://stackoverflow.com/users/4592520/cmehmen"}, "reply_to_user": {"reputation": 1727, "user_id": 3166476, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/tU6SH.jpg?s=128&g=1", "display_name": "lakeweb", "link": "https://stackoverflow.com/users/3166476/lakeweb"}, "edited": false, "score": 0, "creation_date": 1547678287, "post_id": 54226289, "comment_id": 95278926, "body": "@lakeweb it&#39;s not the comlete problem, after updating my code - removing namespace and using std:: in the correct spots I get the following --  error: variable or field \u2018print_stuff\u2019 declared void (and) error: \u2018vector\u2019 is not a member of \u2018std\u2019"}, {"owner": {"reputation": 1727, "user_id": 3166476, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/tU6SH.jpg?s=128&g=1", "display_name": "lakeweb", "link": "https://stackoverflow.com/users/3166476/lakeweb"}, "edited": false, "score": 1, "creation_date": 1547678549, "post_id": 54226289, "comment_id": 95279002, "body": "Did you <code>std::vector</code> throughout your header? I can&#39;t see your updated code."}, {"owner": {"reputation": 249, "user_id": 4592520, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c362fd37c32b17ea32a4bd4989f0bac6?s=128&d=identicon&r=PG&f=1", "display_name": "cmehmen", "link": "https://stackoverflow.com/users/4592520/cmehmen"}, "reply_to_user": {"reputation": 1727, "user_id": 3166476, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/tU6SH.jpg?s=128&g=1", "display_name": "lakeweb", "link": "https://stackoverflow.com/users/3166476/lakeweb"}, "edited": false, "score": 0, "creation_date": 1547678871, "post_id": 54226289, "comment_id": 95279100, "body": "@lakeweb just added updated code"}, {"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 1, "creation_date": 1547678957, "post_id": 54226289, "comment_id": 95279128, "body": "print.cpp could use a <code>#include &lt;iostream&gt; </code>"}, {"owner": {"reputation": 249, "user_id": 4592520, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c362fd37c32b17ea32a4bd4989f0bac6?s=128&d=identicon&r=PG&f=1", "display_name": "cmehmen", "link": "https://stackoverflow.com/users/4592520/cmehmen"}, "reply_to_user": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 0, "creation_date": 1547679452, "post_id": 54226289, "comment_id": 95279285, "body": "@user4581301 That fixed the problem. From my understanding of how things were compiled i wasn&#39;t aware that I had to #include &lt;vector&gt;, &lt;iostream&gt;, etc for each individual file. Now it does make more sense though. Thank you!"}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 0, "creation_date": 1547680498, "post_id": 54226289, "comment_id": 95279666, "body": "@cmehmen &quot;<i>error: \u2018vector\u2019 is not a member of \u2018std\u2019</i>&quot; - that happens when you are missing <code>#include &lt;vector&gt;</code>. You can&#39;t use something that is not declared."}], "answers": [{"comments": [{"owner": {"reputation": 249, "user_id": 4592520, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c362fd37c32b17ea32a4bd4989f0bac6?s=128&d=identicon&r=PG&f=1", "display_name": "cmehmen", "link": "https://stackoverflow.com/users/4592520/cmehmen"}, "edited": false, "score": 0, "creation_date": 1547679906, "post_id": 54226631, "comment_id": 95279457, "body": "So you are telling me to add &#39;&amp;; before the variable name that I pass to function, which I already did. And then post code that is absent of what you said, and never even calls the function?"}, {"owner": {"reputation": 21, "user_id": 10924975, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--WAyvC_A2zc/AAAAAAAAAAI/AAAAAAAAADM/ybqCNAAh0NU/photo.jpg?sz=128", "display_name": "Prekzursil", "link": "https://stackoverflow.com/users/10924975/prekzursil"}, "reply_to_user": {"reputation": 249, "user_id": 4592520, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c362fd37c32b17ea32a4bd4989f0bac6?s=128&d=identicon&r=PG&f=1", "display_name": "cmehmen", "link": "https://stackoverflow.com/users/4592520/cmehmen"}, "edited": false, "score": 0, "creation_date": 1547680091, "post_id": 54226631, "comment_id": 95279522, "body": "Yes I forgot to call it, but yes basically &amp;v means that after running the function the vector will be affected but if not it will make a copy of it and therefore it will not be affected after the end of the function."}, {"owner": {"reputation": 21, "user_id": 10924975, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--WAyvC_A2zc/AAAAAAAAAAI/AAAAAAAAADM/ybqCNAAh0NU/photo.jpg?sz=128", "display_name": "Prekzursil", "link": "https://stackoverflow.com/users/10924975/prekzursil"}, "reply_to_user": {"reputation": 249, "user_id": 4592520, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c362fd37c32b17ea32a4bd4989f0bac6?s=128&d=identicon&r=PG&f=1", "display_name": "cmehmen", "link": "https://stackoverflow.com/users/4592520/cmehmen"}, "edited": false, "score": 0, "creation_date": 1547680184, "post_id": 54226631, "comment_id": 95279555, "body": "Mind you, if you use anything else then gcc like visual studio, it will not accept the custom made bits library, so you will have to add all libraries you use or make a custom one yourself."}, {"owner": {"reputation": 65594, "user_id": 459640, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/bc790307b3c4cdbd25f582d9067651f1?s=128&d=identicon&r=PG", "display_name": "aschepler", "link": "https://stackoverflow.com/users/459640/aschepler"}, "edited": false, "score": 3, "creation_date": 1547680342, "post_id": 54226631, "comment_id": 95279615, "body": "It&#39;s right in the original code: <code>void print_stuff(vector&lt;int&gt; &amp;month_mileage);</code>. Suggesting adding a <code>&amp;</code> to the function parameter is not useful when it&#39;s already there.  Also, <code>#include &lt;bits&#47;stdc++.h&gt;</code> is an even worse idea than <code>using namespace std;</code>."}, {"owner": {"reputation": 249, "user_id": 4592520, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c362fd37c32b17ea32a4bd4989f0bac6?s=128&d=identicon&r=PG&f=1", "display_name": "cmehmen", "link": "https://stackoverflow.com/users/4592520/cmehmen"}, "edited": false, "score": 0, "creation_date": 1547680361, "post_id": 54226631, "comment_id": 95279620, "body": "Next time actually look at the code that is posted, and then read the question. what you are telling me to do was already implemented in my original code."}, {"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 2, "creation_date": 1547680476, "post_id": 54226631, "comment_id": 95279657, "body": "Unrelated: By themselves <a href=\"https://stackoverflow.com/questions/31816095/why-should-i-not-include-bits-stdc-h\"><code>#include&lt;bits&#47;stdc++.h&gt;</code></a> and <a href=\"https://stackoverflow.com/questions/1452721/why-is-using-namespace-std-considered-bad-practice\"><code>using namespace std;</code></a> can lead you into a lot of trouble. Together they can combine into a terrifying, program-destroying monster. Exercise caution when using them in your code and avoid using either of them in an answer."}], "tags": [], "owner": {"reputation": 21, "user_id": 10924975, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--WAyvC_A2zc/AAAAAAAAAAI/AAAAAAAAADM/ybqCNAAh0NU/photo.jpg?sz=128", "display_name": "Prekzursil", "link": "https://stackoverflow.com/users/10924975/prekzursil"}, "is_accepted": false, "score": -3, "last_activity_date": 1547680032, "last_edit_date": 1547680032, "creation_date": 1547679372, "answer_id": 54226631, "question_id": 54226289, "link": "https://stackoverflow.com/questions/54226289/what-is-the-correct-way-to-pass-vectors-as-a-reference/54226631#54226631", "title": "What is the correct way to pass vectors as a reference?", "body": "<p>Note that unlike C arrays, c++ classes have to have &amp; before them just like regular parameters you pass by, otherwise it will create a copy on the stack in the function it was passed to.</p>\n\n<pre><code>#include&lt;bits/stdc++.h&gt;\nusing namespace std;\n\nint fun(vector&lt;int&gt; v)\n{\n    //your code here\n}\n\nint main()\n{\n    vector&lt;int&gt; v;\n    int n,x;\n    cin&gt;&gt;n;enter code here\n    for(int i=1;i&lt;=n;i++)\n        v.push_back(x);\n    cout&lt;&lt;fun(v); // make it void if you need it void.\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 65594, "user_id": 459640, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/bc790307b3c4cdbd25f582d9067651f1?s=128&d=identicon&r=PG", "display_name": "aschepler", "link": "https://stackoverflow.com/users/459640/aschepler"}, "edited": false, "score": 2, "creation_date": 1547680447, "post_id": 54226770, "comment_id": 95279647, "body": "It would be more typical, and essentially required once you start getting into class definitions, to <code>#include &quot;Print.h&quot;</code> in Print.cpp. (Then it doesn&#39;t need <code>&lt;vector&gt;</code> since it got that via Print.h, but it still needs <code>&lt;iostream&gt;</code>.)"}, {"owner": {"reputation": 249, "user_id": 4592520, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c362fd37c32b17ea32a4bd4989f0bac6?s=128&d=identicon&r=PG&f=1", "display_name": "cmehmen", "link": "https://stackoverflow.com/users/4592520/cmehmen"}, "reply_to_user": {"reputation": 65594, "user_id": 459640, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/bc790307b3c4cdbd25f582d9067651f1?s=128&d=identicon&r=PG", "display_name": "aschepler", "link": "https://stackoverflow.com/users/459640/aschepler"}, "edited": false, "score": 0, "creation_date": 1547681535, "post_id": 54226770, "comment_id": 95279945, "body": "@aschelper This helped me a lot. So would it be bad practice to simplify everything and just have <code>#include &lt;vector&gt;</code> and <code>#include &lt;iostream&gt;</code> in <code>&quot;Print.h&quot;</code> and then just have #include <code>&quot;Print.h&quot;</code> in both <code>&quot;Print.cpp&quot;</code> and <code>&quot;main.cpp&quot;</code> ?"}, {"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 0, "creation_date": 1547682801, "post_id": 54226770, "comment_id": 95280253, "body": "@cmehmen typically no. A header should <code>#include</code> what it needs, no more and definitely no less. Everything you include has cost, be it loading unnecessary files (that some other file needed) at compile time or debugging and refactoring because the brain now has to consider extra avenues suggested by unnecessary header includes."}, {"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 0, "creation_date": 1547683069, "post_id": 54226770, "comment_id": 95280318, "body": "Sometimes you will find going even lighter can help. Say you have a reference to <code>MassiveClass</code> in a header. Including all of MassiveHeader.h to get <code>MassiveClass</code> can be avoided by forward declaring <code>MassiveClass</code> in the header to satisfy the reference. You&#39;ll see this in the standard library sometimes. In GCC you can get weird <i><code>stringstream</code> not fully defined</i> messages because iostream forward declares <code>stringstream</code> rather than pull in a header that relatively few users of iostream need. The same sometimes happens with <code>string</code>."}], "tags": [], "owner": {"reputation": 249, "user_id": 4592520, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c362fd37c32b17ea32a4bd4989f0bac6?s=128&d=identicon&r=PG&f=1", "display_name": "cmehmen", "link": "https://stackoverflow.com/users/4592520/cmehmen"}, "is_accepted": false, "score": 1, "last_activity_date": 1547680577, "last_edit_date": 1547680577, "creation_date": 1547680274, "answer_id": 54226770, "question_id": 54226289, "link": "https://stackoverflow.com/questions/54226289/what-is-the-correct-way-to-pass-vectors-as-a-reference/54226770#54226770", "title": "What is the correct way to pass vectors as a reference?", "body": "<p>To solve the problem I had to</p>\n\n<p>List item</p>\n\n<ol>\n<li>add <code>#include &lt;vector&gt;</code> to the <code>Print.h</code> file</li>\n<li>add <code>#include &lt;vector&gt;</code> and <code>#include &lt;iostream&gt;</code> to <code>Print.cpp</code></li>\n<li>pass reference as <code>void print_stuff(std::vector&lt;int&gt; &amp;month_mileage);</code></li>\n</ol>\n"}], "owner": {"reputation": 249, "user_id": 4592520, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c362fd37c32b17ea32a4bd4989f0bac6?s=128&d=identicon&r=PG&f=1", "display_name": "cmehmen", "link": "https://stackoverflow.com/users/4592520/cmehmen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1547680577, "creation_date": 1547677299, "last_edit_date": 1547678847, "question_id": 54226289, "link": "https://stackoverflow.com/questions/54226289/what-is-the-correct-way-to-pass-vectors-as-a-reference", "title": "What is the correct way to pass vectors as a reference?", "body": "<p>I'm trying to pass a vector to to a function as a reference so that I can print the contents. The problem is the following compiling errors.</p>\n\n<pre><code>Print.h:7:19: error: variable or field \u2018print_stuff\u2019 declared void\n  void print_stuff(vector&lt;int&gt; &amp;month_mileage);\n                   ^~~~~~\nPrint.h:7:19: error: \u2018vector\u2019 was not declared in this scope\nPrint.h:7:26: error: expected primary-expression before \u2018int\u2019\n  void print_stuff(vector&lt;int&gt; &amp;month_mileage);\nmain.cpp: In function \u2018int main()\u2019:\nmain.cpp:20:12: error: \u2018print_stuff\u2019 is not a member of \u2018Print\u2019\n     Print::print_stuff(&amp;month_mileage);\n            ^~~~~~~~~~~\nPrint.cpp:4:19: error: variable or field \u2018print_stuff\u2019 declared void\n  void print_stuff(vector&lt;int&gt; &amp;month_mileage) {\n                   ^~~~~~\nPrint.cpp:4:19: error: \u2018vector\u2019 was not declared in this scope\nPrint.cpp:4:26: error: expected primary-expression before \u2018int\u2019\n   void print_stuff(vector&lt;int&gt; &amp;month_mileage) {\n                          ^~~\n</code></pre>\n\n<p>I believe the problem could possibly be related to the way I have my files set up. From all the research I have done I can't find anything that has helped me other than to #include in the header file. Which I thought was bad practice, but I understand I could be wrong. </p>\n\n<pre><code>[main.cpp] \n #include \"Print.h\"\n #include &lt;vector&gt;\n #include &lt;iostream&gt;\n\n using namespace std;\n using namespace Print;\n\n int main() {\n\n    int num;\n    vector&lt;int&gt; month_mileage(0,12);\n\n     cout &lt;&lt; \" Please enter your mileage for the past 12 months\\n\";\n\n     for( int i = 0; i &lt; 12; i++) {\n         cin &gt;&gt; num;\n         month_mileage[i] = num;\n     }\n\n     Print::print_stuff(month_mileage);\n\n\n return 0;\n }\n[Print.h]---------------------------------------------------\n  0 #ifndef PRINT_H\n #define PRINT_H\n\n\n namespace Print {\n\n         void print_stuff(vector&lt;int&gt; &amp;month_mileage);\n\n };\n #endif\n[Print.cpp]---------------------------------------------------\n namespace Print{\n\n\n         void print_stuff(vector&lt;int&gt; &amp;month_mileage) {\n\n             for(int i = 0; i &lt; 12; i++) {\n                     for(int a = 0; a &lt; &amp;month_mileage[i]; a++) {\n                             std::cout &lt;&lt;\"|\";\n                     }//END FOR     \n                 std::cout &lt;&lt;'\\n';\n             }//END OUTER FOR\n         }//END PRINT_STUFF\n\n }\n\n\nUPDATED CODE is as follows\n\n[Print.h]--------------------------------------------------- \n#ifndef PRINT_H\n#define PRINT_H\n#include &lt;vector&gt;\n\nnamespace Print {\n\n    void print_stuff(std::vector&lt;int&gt; &amp;month_mileage);\n\n};\n#endif\n\n[Print.cpp]---------------------------------------------------\n\nnamespace Print{\n\n\n    void print_stuff(std::vector&lt;int&gt; &amp;month_mileage) {\n\n        for(int i = 0; i &lt; 12; i++) {\n            for(int a = 0; a &lt; month_mileage[i]; a++) {\n                std::cout &lt;&lt;\"|\";\n            }   \n            std::cout &lt;&lt;'\\n';\n        }\n    }\n\n}\n[main.cpp]---------------------------------------------------\n#include \"Print.h\"\n#include &lt;vector&gt;\n#include &lt;iostream&gt;\n\nusing namespace Print;\n\nint main() {\n\n   int num;\n   std::vector&lt;int&gt; month_mileage(0,12);\n\n   std::cout &lt;&lt; \" Please enter your mileage for the past 12 months\\n\";\n\n    for( int i = 0; i &lt; 12; i++) {\n        std::cin &gt;&gt; num;\n        month_mileage[i] = num;\n    }\n\n    Print::print_stuff(month_mileage);\n\n\nreturn 0;\n}\n</code></pre>\n\n<p>So my question is am I passing the reference incorrectly? or have I set up the Header file incorrectly?</p>\n\n<p>Thanks </p>\n"}, {"tags": ["c++", "c", "visual-studio-2015", "clr"], "comments": [{"owner": {"reputation": 870071, "user_id": 17034, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cii6b.png?s=128&g=1", "display_name": "Hans Passant", "link": "https://stackoverflow.com/users/17034/hans-passant"}, "edited": false, "score": 0, "creation_date": 1547679331, "post_id": 54226278, "comment_id": 95279246, "body": "That is the correct way to do it.  Standard reason to still get the error is forgetting to make this setting change for all configurations and all platforms.  The two combo-boxes at the top of the dialog."}], "answers": [{"tags": [], "owner": {"reputation": 1637, "user_id": 131166, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b139a6d5ea2ed82bcba6d23ea9e4e27c?s=128&d=identicon&r=PG", "display_name": "Sam Skuce", "link": "https://stackoverflow.com/users/131166/sam-skuce"}, "is_accepted": true, "score": -1, "last_activity_date": 1547840227, "creation_date": 1547840227, "answer_id": 54260404, "question_id": 54226278, "link": "https://stackoverflow.com/questions/54226278/getting-error-d8045-cannot-compile-c-file-file-with-clr-option-even-after-t/54260404#54260404", "title": "Getting error D8045 &quot;cannot compile C file &lt;file&gt; with /clr option&quot; even after turning off CLR option", "body": "<p>It cleared up on its own eventually.  I had restarted Visual Studio a few times and it kept happening, which is why I asked this question.  I guess some cache somewhere wasn't being updated or got corrupt or something.</p>\n"}], "owner": {"reputation": 1637, "user_id": 131166, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b139a6d5ea2ed82bcba6d23ea9e4e27c?s=128&d=identicon&r=PG", "display_name": "Sam Skuce", "link": "https://stackoverflow.com/users/131166/sam-skuce"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 0, "accepted_answer_id": 54260404, "answer_count": 1, "score": -1, "last_activity_date": 1547840227, "creation_date": 1547677268, "question_id": 54226278, "link": "https://stackoverflow.com/questions/54226278/getting-error-d8045-cannot-compile-c-file-file-with-clr-option-even-after-t", "title": "Getting error D8045 &quot;cannot compile C file &lt;file&gt; with /clr option&quot; even after turning off CLR option", "body": "<p>This is in Visual Studio 2015.  </p>\n\n<p>I have a native C library that I'm using from my .NET Visual C++ code.  I'm aware that I have to change the \"Common Language Runtime Support\" option to \"No Common Language Runtime Support\" on the property page for each .c file, per <a href=\"https://stackoverflow.com/questions/880413/d8045-cannot-compile-c-file-serialcommands-c-with-the-clr-option\">this question</a>.  However, even after I have turned that option off, I am still receiving error D8045 when I attempt to compile those files.  </p>\n\n<p>Is this a known issue in VS2015, or am I missing something?</p>\n"}, {"tags": ["c++", "vector", "floating-point"], "comments": [{"owner": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 0, "creation_date": 1547677172, "post_id": 54226228, "comment_id": 95278460, "body": "<b><i>it but it states that there needs to be a class structure to the left</i></b> Please always post the exact text of the error message. If this is Visual Studio copy that from the Output Tab ( Alt+2 )"}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 2, "creation_date": 1547677264, "post_id": 54226228, "comment_id": 95278512, "body": "Why are you using floating point types?  Prime numbers are only integers and you can solve if a integer is prime or not by using <code>%</code> to check the remainder.  You should really switch your data types."}, {"owner": {"reputation": 17, "user_id": 10909085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1195ce091e64321e0876428be41638e7?s=128&d=identicon&r=PG&f=1", "display_name": "FuzMunkey", "link": "https://stackoverflow.com/users/10909085/fuzmunkey"}, "reply_to_user": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1547680777, "post_id": 54226228, "comment_id": 95279747, "body": "@NathanOliver I used floats due to the way I check if its not a prime number. If I used ints the rounding would cause all numbers between 1-100 to be defined as not prime numbers. The purpose is more so comparing vector elements than the prime number aspect."}, {"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 0, "creation_date": 1547683429, "post_id": 54226228, "comment_id": 95280399, "body": "Sidenote: Comparisons of <code>float</code>s can get messy because <code>float</code>s can&#39;t contain exact representations of many numbers and even when it can, sometimes the result of an arithmetic operation slightly &quot;breaks&quot; the number. In other words, you think you&#39;re looking at 25, but what the <code>float</code> is actually holding is <code>24.999999999999997</code> and isn&#39;t exactly equal to 25. More on this topic: <a href=\"https://stackoverflow.com/questions/588004/is-floating-point-math-broken\">Is floating point math broken?</a>"}, {"owner": {"reputation": 17, "user_id": 10909085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1195ce091e64321e0876428be41638e7?s=128&d=identicon&r=PG&f=1", "display_name": "FuzMunkey", "link": "https://stackoverflow.com/users/10909085/fuzmunkey"}, "edited": false, "score": 0, "creation_date": 1547684846, "post_id": 54226228, "comment_id": 95280677, "body": "@user4561301 hmmm, what would then be the proper syntax of comparing  two float values? One vector a number bank and the second vector a series of calculated values ?"}], "answers": [{"comments": [{"owner": {"reputation": 17, "user_id": 10909085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1195ce091e64321e0876428be41638e7?s=128&d=identicon&r=PG&f=1", "display_name": "FuzMunkey", "link": "https://stackoverflow.com/users/10909085/fuzmunkey"}, "edited": false, "score": 0, "creation_date": 1547684933, "post_id": 54226681, "comment_id": 95280692, "body": "switching to a for loop worked thanks! For arguments sake lets say the issue was you think you&#39;re looking at 25, but what the float is actually holding is 24.999999999999997 and isn&#39;t exactly equal to 25.what would then be the proper syntax of comparing two float values? One vector a number bank and the second vector a series of calculated values ?"}, {"owner": {"reputation": 30170, "user_id": 5231607, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QzGsq.jpg?s=128&g=1", "display_name": "1201ProgramAlarm", "link": "https://stackoverflow.com/users/5231607/1201programalarm"}, "reply_to_user": {"reputation": 17, "user_id": 10909085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1195ce091e64321e0876428be41638e7?s=128&d=identicon&r=PG&f=1", "display_name": "FuzMunkey", "link": "https://stackoverflow.com/users/10909085/fuzmunkey"}, "edited": false, "score": 0, "creation_date": 1547686109, "post_id": 54226681, "comment_id": 95280922, "body": "@FuzMunkey See <a href=\"https://stackoverflow.com/questions/17333/what-is-the-most-effective-way-for-float-and-double-comparison\">What is the most effective way for float and double comparison?</a>"}], "tags": [], "owner": {"reputation": 30170, "user_id": 5231607, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QzGsq.jpg?s=128&g=1", "display_name": "1201ProgramAlarm", "link": "https://stackoverflow.com/users/5231607/1201programalarm"}, "is_accepted": true, "score": 0, "last_activity_date": 1547679686, "creation_date": 1547679686, "answer_id": 54226681, "question_id": 54226228, "link": "https://stackoverflow.com/questions/54226228/comparing-floats-in-a-vector/54226681#54226681", "title": "Comparing Floats in a vector", "body": "<p>You never reset <code>n</code>, so once you get a prime number (when <code>n == (not_prime_numbers.size()-1)</code>) the rest of the numbers will also be added to the prime list.</p>\n\n<p>Why are you checking that condition within the loop?  You should set a flag variable if you find the number is not prime, then check that after your loop to possibly add it to your prime list.</p>\n"}], "owner": {"reputation": 17, "user_id": 10909085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1195ce091e64321e0876428be41638e7?s=128&d=identicon&r=PG&f=1", "display_name": "FuzMunkey", "link": "https://stackoverflow.com/users/10909085/fuzmunkey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 656, "favorite_count": 0, "accepted_answer_id": 54226681, "answer_count": 1, "score": 0, "last_activity_date": 1547679748, "creation_date": 1547676991, "last_edit_date": 1547679748, "question_id": 54226228, "link": "https://stackoverflow.com/questions/54226228/comparing-floats-in-a-vector", "title": "Comparing Floats in a vector", "body": "<p>I am writing a program that creates two vectors to practice comparing elements in a vector. The first vector is a list of all numbers that are not prime numbers between 1-100 (not prime numbers), the second vector is a list of all numbers between 1-100 (vector number_bank). I am using loops to compare each element in the vectors. Lets say the number 5 comes up from the number_bank (which is a prime number), if this number does not match any number in the not_prime_numbers vector then it is pushed back into a third vector called prime numbers. If a number like 4 were to be compared to the elements of the not_prime_number list it is supposed to match with the number 4 in this list and break the loop without pushing back the number into the prime_numbers vector. What is happening is all numbers  between 1-100 are being pushed back. 4 in the number_bank vector is never equal to the 4 in the not_prime_numbers vector so the cycle continues pushing back 4 into the prime numbers vector. </p>\n\n<p>There is no math involved changing the elements in these vectors so there shouldn't be an incremental margin of error (epsilon) usually associated with comparing floats. Is there a better way to compare the elements in these vectors?</p>\n\n<pre><code>int main()\n{\n    float i = 1.0;\n    unsigned int n = 0;\n    std::vector&lt;float&gt;not_prime_numbers;\n    std::vector&lt;float&gt;number_bank;\n    std::vector&lt;float&gt;prime_numbers;\n    while (i &lt; 101.0)\n    {\n        for (float j = 1.0;j&lt;(i);++j)\n        {\n            float p = i / j;\n            if (abs(floor(p)) == p&amp;&amp;j!=1.0)\n            {\n                not_prime_numbers.push_back(i);\n                break;\n            }\n        }\n        ++i;\n    }\n\n    for (float k = 1.0; k &lt; 101.0; ++k)\n    {\n        number_bank.push_back(k);\n    }\n\n    for (unsigned int m = 0; m &lt; number_bank.size(); ++m)\n    {\n        while (n &lt; not_prime_numbers.size())\n        {\n            if (not_prime_numbers[n] == number_bank[m])  // here is where i try to break the loop\n            {                                            \n            break;                                   \n            }\n            if (n == (not_prime_numbers.size()-1))\n            {                   // here is where element is pushed back when compared to all loop elements\n                prime_numbers.push_back(number_bank[m]);\n                break;\n            }\n            if (not_prime_numbers[n] != number_bank[m])\n            {\n                ++n;\n            }\n\n        }\n    }\n\n\n    std::cout &lt;&lt; \"All prime numbers between 0 and 100 are as follows:\\n\";\n    for (unsigned int j = 0; j &lt; prime_numbers.size(); ++j)\n    {\n        std::cout &lt;&lt; prime_numbers[j] &lt;&lt; \"\\n\";\n    }\n    return 0;\n}\n</code></pre>\n\n<p>I read about .compare and tried it but it states that there needs to be a class structure to the left (perhaps a vector has no class structure?). I'm new to C++ and would greatly appreciate the help.</p>\n"}, {"tags": ["c++", "inheritance", "mixins", "prototypal-inheritance"], "comments": [{"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 0, "creation_date": 1547676753, "post_id": 54226119, "comment_id": 95278302, "body": "Of course that&#39;s possible. Just look at what the <code>operator&lt;&lt;()</code> for <code>std::ostream</code> does. It&#39;s used ubiquitously."}, {"owner": {"reputation": 1727, "user_id": 3166476, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/tU6SH.jpg?s=128&g=1", "display_name": "lakeweb", "link": "https://stackoverflow.com/users/3166476/lakeweb"}, "edited": false, "score": 0, "creation_date": 1547677373, "post_id": 54226119, "comment_id": 95278565, "body": "c++ is rich with <a href=\"https://en.cppreference.com/w/cpp/language/operators\" rel=\"nofollow noreferrer\">operator overloading</a>.   I take it that is what you are looking for."}], "answers": [{"tags": [], "owner": {"reputation": 54044, "user_id": 3723423, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a2c916310a1261b53773de75fc83e5ad?s=128&d=identicon&r=PG&f=1", "display_name": "Christophe", "link": "https://stackoverflow.com/users/3723423/christophe"}, "is_accepted": true, "score": 1, "last_activity_date": 1547681109, "last_edit_date": 1547681109, "creation_date": 1547677918, "answer_id": 54226392, "question_id": 54226119, "link": "https://stackoverflow.com/questions/54226119/implement-concatenative-inheritance-in-c/54226392#54226392", "title": "Implement concatenative inheritance in C++", "body": "<p>According to <a href=\"https://medium.com/javascript-scene/the-heart-soul-of-prototypal-oo-concatenative-inheritance-a3b64cb27819\" rel=\"nofollow noreferrer\">this article</a>: </p>\n\n<blockquote>\n  <p>Concatenative inheritance is the process of combining the properties\n  of one or more source objects into a new destination object.</p>\n</blockquote>\n\n<h3>Are we speaking of class inheritance ?</h3>\n\n<p>This is the basic way public inheritance works in C++.  Thanks to multiple inheritance, you can even combine several base classes. </p>\n\n<p>There might be some constraints however (e.g. name conflicts between different sources have to be addressed, depending on use case you might need virtual functions, and there might be the need to create explicitly a combined constructors).   </p>\n\n<h3>Or is inheritance from instantiated objects meant ?</h3>\n\n<p>If it's really about objects and not classes, the story is different. You cannot clone and combine object of random type with each other, since C++ is a strongly typed language. </p>\n\n<p>But first, let's correct the misleading wording.  It's not really about concatenative inheritance, since inheritance is for classes.  It's rather \"concatenative prototyping\", since you create new objects by taking over values and behaviors of existing objects.  </p>\n\n<p>To realize some kind of \"concatenative prototyping\" in C++, you therefore need to design it, based on the principle of composition, using a set of well defined \"concatenable\" (i.e. composable) base classes. This can be achieved, using the <a href=\"https://www.oodesign.com/prototype-pattern.html\" rel=\"nofollow noreferrer\">prototype design pattern</a> together with the <a href=\"https://en.wikipedia.org/wiki/Entity%E2%80%93component%E2%80%93system\" rel=\"nofollow noreferrer\">entity-component-system</a> architecture.  </p>\n\n<h3>What's the purpose</h3>\n\n<p>You are currently looking for this kind of construct, probably because you used it heavily in a dynamically typed language. </p>\n\n<p>So keep in mind the <a href=\"https://en.wikipedia.org/wiki/Law_of_the_instrument\" rel=\"nofollow noreferrer\">popular quote</a> (Mark Twain ? Maslow ? ):  </p>\n\n<blockquote>\n  <p>If you have a hammer in your hand, every problem looks like nails</p>\n</blockquote>\n\n<p>So the question is what you are really looking for and what problem you intend to solve. IMHO, it cannot be excluded that other idioms could be more suitable in the C++ world to achieve the same objective.     </p>\n"}], "owner": {"reputation": 13, "user_id": 9902184, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ab79001dc498a8eb51be2591685344c?s=128&d=identicon&r=PG&f=1", "display_name": "pasteMyCode", "link": "https://stackoverflow.com/users/9902184/pastemycode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 1, "accepted_answer_id": 54226392, "answer_count": 1, "score": 0, "last_activity_date": 1547681109, "creation_date": 1547676436, "question_id": 54226119, "link": "https://stackoverflow.com/questions/54226119/implement-concatenative-inheritance-in-c", "title": "Implement concatenative inheritance in C++", "body": "<p>Is it ppssible to implement a concatenative inheritance or at least mixins in C++?</p>\n\n<p>It feels like it is impossible to do in C++, but I cannot prove it.</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["c++", "time", "std"], "comments": [{"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 1, "creation_date": 1547676391, "post_id": 54226099, "comment_id": 95278155, "body": "Did you have a look at <code>std::chrono</code> already?"}, {"owner": {"reputation": 160, "user_id": 791744, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0a44aec05cc6c41470a406d5889d6128?s=128&d=identicon&r=PG", "display_name": "samwise", "link": "https://stackoverflow.com/users/791744/samwise"}, "reply_to_user": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 0, "creation_date": 1547678579, "post_id": 54226099, "comment_id": 95279007, "body": "Yes, the reason I am posting is because I could not find a way to do this by reading the std::chrono documents."}], "answers": [{"comments": [{"owner": {"reputation": 160, "user_id": 791744, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0a44aec05cc6c41470a406d5889d6128?s=128&d=identicon&r=PG", "display_name": "samwise", "link": "https://stackoverflow.com/users/791744/samwise"}, "edited": false, "score": 0, "creation_date": 1547739564, "post_id": 54238498, "comment_id": 95303363, "body": "Thanks a bunch! You are a hero for fixing this. How on earth chrono made it through the committee in its present state is beyond me."}, {"owner": {"reputation": 177852, "user_id": 576911, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2a2941970f141aad669d13375dc57c4f?s=128&d=identicon&r=PG", "display_name": "Howard Hinnant", "link": "https://stackoverflow.com/users/576911/howard-hinnant"}, "reply_to_user": {"reputation": 160, "user_id": 791744, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0a44aec05cc6c41470a406d5889d6128?s=128&d=identicon&r=PG", "display_name": "samwise", "link": "https://stackoverflow.com/users/791744/samwise"}, "edited": false, "score": 0, "creation_date": 1547739642, "post_id": 54238498, "comment_id": 95303402, "body": "You&#39;re welcome!  Yeah, those guys were real bozos: <a href=\"http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2008/n2661.htm\" rel=\"nofollow noreferrer\">open-std.org/jtc1/sc22/wg21/docs/papers/2008/n2661.htm</a> ;-)"}, {"owner": {"reputation": 160, "user_id": 791744, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0a44aec05cc6c41470a406d5889d6128?s=128&d=identicon&r=PG", "display_name": "samwise", "link": "https://stackoverflow.com/users/791744/samwise"}, "edited": false, "score": 1, "creation_date": 1547740399, "post_id": 54238498, "comment_id": 95303879, "body": "Ah, touche. Well, thanks for taking another stab at it."}], "tags": [], "owner": {"reputation": 177852, "user_id": 576911, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2a2941970f141aad669d13375dc57c4f?s=128&d=identicon&r=PG", "display_name": "Howard Hinnant", "link": "https://stackoverflow.com/users/576911/howard-hinnant"}, "is_accepted": true, "score": 1, "last_activity_date": 1583802167, "last_edit_date": 1583802167, "creation_date": 1547736808, "answer_id": 54238498, "question_id": 54226099, "link": "https://stackoverflow.com/questions/54226099/how-do-i-create-a-system-clocktime-point-from-a-utc-timestamps-components-y/54238498#54238498", "title": "How do I create a system_clock::time_point from a UTC timestamp&#39;s components (Y,M,D, h,m,s,ms)", "body": "<p>The easiest and most efficient way is to use <a href=\"https://github.com/HowardHinnant/date/blob/master/include/date/date.h\" rel=\"nofollow noreferrer\">Howard Hinnant's free, open-source, header-only, single-header, date/time library</a>:</p>\n\n<pre><code>#include \"date/date.h\"\n...\nusing namespace date;\nusing namespace std::chrono;\nint Y, M, D, h, m, s, ms;\n...\nsystem_clock::time_point tp = sys_days{year{Y}/M/D} + \n                              hours{h} + minutes{m} + seconds{s} + milliseconds{ms};\n</code></pre>\n\n<p>All the date/time library does for you is convert the Y/M/D triple into a <code>chrono::time_point&lt;system_clock, days&gt;</code>.  Then the rest of the expression is all C++11 <code>&lt;chrono&gt;</code>.</p>\n\n<p>The <a href=\"https://github.com/HowardHinnant/date/blob/master/include/date/date.h\" rel=\"nofollow noreferrer\">date/time library</a> is now in the C++20 spec, so you can upgrade your code to C++20 by simply removing <code>#include \"date/date.h\"</code> and <code>using namespace date;</code>.</p>\n\n<p>If for whatever reasons you can't use the <a href=\"https://github.com/HowardHinnant/date/blob/master/include/date/date.h\" rel=\"nofollow noreferrer\">date/time library</a>, nor upgrade to C++20, then you can code up <a href=\"http://howardhinnant.github.io/date_algorithms.html#days_from_civil\" rel=\"nofollow noreferrer\"><code>days_from_civil</code></a> yourself with this public domain formula.</p>\n"}], "owner": {"reputation": 160, "user_id": 791744, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0a44aec05cc6c41470a406d5889d6128?s=128&d=identicon&r=PG", "display_name": "samwise", "link": "https://stackoverflow.com/users/791744/samwise"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 209, "favorite_count": 0, "accepted_answer_id": 54238498, "answer_count": 1, "score": 1, "last_activity_date": 1583802167, "creation_date": 1547676312, "question_id": 54226099, "link": "https://stackoverflow.com/questions/54226099/how-do-i-create-a-system-clocktime-point-from-a-utc-timestamps-components-y", "title": "How do I create a system_clock::time_point from a UTC timestamp&#39;s components (Y,M,D, h,m,s,ms)", "body": "<p>I am reading some data from an external source that is providing me with a UTC time stamp broken down into its constituents to millisecond precision, i.e. I get year, month,day, hour, minute, second and millisecond as integers. How do I (efficiently) create a system_clock::time_point that represents this time?</p>\n"}, {"tags": ["c++", "c++-winrt"], "comments": [{"owner": {"reputation": 3058, "user_id": 635160, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/R8jPW.jpg?s=128&g=1", "display_name": "Gabriel Fair", "link": "https://stackoverflow.com/users/635160/gabriel-fair"}, "edited": false, "score": 1, "creation_date": 1548270284, "post_id": 54226053, "comment_id": 95485628, "body": "This question was linked to in a Microsoft thread here: <a href=\"https://github.com/MicrosoftDocs/windows-uwp/issues/1398\" rel=\"nofollow noreferrer\">github.com/MicrosoftDocs/windows-uwp/issues/1398</a>"}], "answers": [{"comments": [{"owner": {"reputation": 325, "user_id": 6220486, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/16b0fd0714b6147991aece5929542eb3?s=128&d=identicon&r=PG&f=1", "display_name": "user34299", "link": "https://stackoverflow.com/users/6220486/user34299"}, "edited": false, "score": 0, "creation_date": 1547726559, "post_id": 54229618, "comment_id": 95295577, "body": "miradham, I added the registration for a second button to the constructor for MainPage, based on the reference you cited.  What I do not understand is that no such registration is in that constructor for the first button, the button which is part of the Blank App.  Three questions: 1. Why is the registration event for the first button not present in the Microsoft generated code?  2. Can the 2nd button&#39;s registration be removed after one compilation? 3. Why is the events section of the Properties tab for XAML controls blank?  Thanks for your time."}, {"owner": {"reputation": 1936, "user_id": 4265714, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh3.googleusercontent.com/-GWz2zlyQ_u0/AAAAAAAAAAI/AAAAAAAADH4/GRNAzkeBFx8/photo.jpg?sz=128", "display_name": "miradham", "link": "https://stackoverflow.com/users/4265714/miradham"}, "reply_to_user": {"reputation": 325, "user_id": 6220486, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/16b0fd0714b6147991aece5929542eb3?s=128&d=identicon&r=PG&f=1", "display_name": "user34299", "link": "https://stackoverflow.com/users/6220486/user34299"}, "edited": false, "score": 0, "creation_date": 1547773790, "post_id": 54229618, "comment_id": 95317416, "body": "@user34299 regarding #1 You already have <code>Click=&quot;ClickHandler&quot;</code> in xaml code. That&#39;s also one way to add event handler. #2 No it can&#39;t. Why would you do so? #3 Not sure regarding this yet, let me update my VS and check it."}, {"owner": {"reputation": 1936, "user_id": 4265714, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh3.googleusercontent.com/-GWz2zlyQ_u0/AAAAAAAAAAI/AAAAAAAADH4/GRNAzkeBFx8/photo.jpg?sz=128", "display_name": "miradham", "link": "https://stackoverflow.com/users/4265714/miradham"}, "reply_to_user": {"reputation": 325, "user_id": 6220486, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/16b0fd0714b6147991aece5929542eb3?s=128&d=identicon&r=PG&f=1", "display_name": "user34299", "link": "https://stackoverflow.com/users/6220486/user34299"}, "edited": false, "score": 0, "creation_date": 1547775192, "post_id": 54229618, "comment_id": 95317695, "body": "@user34299 I created sample C++ Blank App(Universal Windows) and added a button. Click event in Properties page of the Button is empty. When double click on that, <code>Button_Click</code> event handler auto generated. As per your description it seems <code>.cpp</code> and <code>.h</code> files are not generated or deleted by accident in your case."}, {"owner": {"reputation": 325, "user_id": 6220486, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/16b0fd0714b6147991aece5929542eb3?s=128&d=identicon&r=PG&f=1", "display_name": "user34299", "link": "https://stackoverflow.com/users/6220486/user34299"}, "edited": false, "score": 0, "creation_date": 1547829543, "post_id": 54229618, "comment_id": 95340279, "body": "When I add a button, the way you describe, the events section of the Properties tab shows no events to double-click on.  Clicking on the lighting bold of the Properties tab shows the newly added button as a Button with its name, but no events, only the text where event listings should be, &quot;The document item has no code-behind file. Add a code-behind file and a class definition before adding event handlers.&quot;"}, {"owner": {"reputation": 325, "user_id": 6220486, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/16b0fd0714b6147991aece5929542eb3?s=128&d=identicon&r=PG&f=1", "display_name": "user34299", "link": "https://stackoverflow.com/users/6220486/user34299"}, "edited": false, "score": 0, "creation_date": 1547830575, "post_id": 54229618, "comment_id": 95340781, "body": "You were not using the same VS menu app as am I.  You are using C++ Blank App (<b>Universal Windows</b>), as you said.  I am using C++ Blank App (<b>C++/WinRT</b>), which is marked as &quot;experimental&quot; in the top-right description.  The app I am using is further down the menu from the one you are choosing after the C++/WinRT extension has been added to Visual Studio."}, {"owner": {"reputation": 1936, "user_id": 4265714, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh3.googleusercontent.com/-GWz2zlyQ_u0/AAAAAAAAAAI/AAAAAAAADH4/GRNAzkeBFx8/photo.jpg?sz=128", "display_name": "miradham", "link": "https://stackoverflow.com/users/4265714/miradham"}, "reply_to_user": {"reputation": 325, "user_id": 6220486, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/16b0fd0714b6147991aece5929542eb3?s=128&d=identicon&r=PG&f=1", "display_name": "user34299", "link": "https://stackoverflow.com/users/6220486/user34299"}, "edited": false, "score": 0, "creation_date": 1548052079, "post_id": 54229618, "comment_id": 95390233, "body": "@user34299 please check my updated answer. It seems xaml design view is not yet supported for C++/WinRT."}, {"owner": {"reputation": 325, "user_id": 6220486, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/16b0fd0714b6147991aece5929542eb3?s=128&d=identicon&r=PG&f=1", "display_name": "user34299", "link": "https://stackoverflow.com/users/6220486/user34299"}, "edited": false, "score": 0, "creation_date": 1548159794, "post_id": 54229618, "comment_id": 95435990, "body": "Thank you for the complete reply.  In the past I had used MFC and C#/WPF for Windows applications.  In December, when I learned of the fully C++ 17 compliant SDK for Windows apps, I started looking into it.  That there was no XAML event support made me think I was doing something wrong.  Microsoft\u2019s big C++/WinRT rollout was in May, 2018 and this problem was not mentioned, even though it was longstanding by then."}, {"owner": {"reputation": 1936, "user_id": 4265714, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh3.googleusercontent.com/-GWz2zlyQ_u0/AAAAAAAAAAI/AAAAAAAADH4/GRNAzkeBFx8/photo.jpg?sz=128", "display_name": "miradham", "link": "https://stackoverflow.com/users/4265714/miradham"}, "reply_to_user": {"reputation": 325, "user_id": 6220486, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/16b0fd0714b6147991aece5929542eb3?s=128&d=identicon&r=PG&f=1", "display_name": "user34299", "link": "https://stackoverflow.com/users/6220486/user34299"}, "edited": false, "score": 0, "creation_date": 1548199357, "post_id": 54229618, "comment_id": 95455574, "body": "@user34299  I have reported this missing point in MS docs as github issue and got response from MS. Please see updated answer. Please feel free to comment further in the github issue if you think they need to add something more to the docs. If you think my answer  is useful, please don&#39;t forget to accept it (:"}, {"owner": {"reputation": 325, "user_id": 6220486, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/16b0fd0714b6147991aece5929542eb3?s=128&d=identicon&r=PG&f=1", "display_name": "user34299", "link": "https://stackoverflow.com/users/6220486/user34299"}, "edited": false, "score": 0, "creation_date": 1548322740, "post_id": 54229618, "comment_id": 95502643, "body": "Where has stevewhims posted this topic which he says is live now?"}, {"owner": {"reputation": 1936, "user_id": 4265714, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh3.googleusercontent.com/-GWz2zlyQ_u0/AAAAAAAAAAI/AAAAAAAADH4/GRNAzkeBFx8/photo.jpg?sz=128", "display_name": "miradham", "link": "https://stackoverflow.com/users/4265714/miradham"}, "reply_to_user": {"reputation": 325, "user_id": 6220486, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/16b0fd0714b6147991aece5929542eb3?s=128&d=identicon&r=PG&f=1", "display_name": "user34299", "link": "https://stackoverflow.com/users/6220486/user34299"}, "edited": false, "score": 0, "creation_date": 1548377637, "post_id": 54229618, "comment_id": 95529904, "body": "@user34299 It is <a href=\"https://docs.microsoft.com/en-us/windows/uwp/cpp-and-winrt-apis/intro-to-using-cpp-with-winrt#blank-app-cwinrt\" rel=\"nofollow noreferrer\">here</a>"}], "tags": [], "owner": {"reputation": 1936, "user_id": 4265714, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh3.googleusercontent.com/-GWz2zlyQ_u0/AAAAAAAAAAI/AAAAAAAADH4/GRNAzkeBFx8/photo.jpg?sz=128", "display_name": "miradham", "link": "https://stackoverflow.com/users/4265714/miradham"}, "is_accepted": true, "score": 0, "last_activity_date": 1548377576, "last_edit_date": 1592644375, "creation_date": 1547703350, "answer_id": 54229618, "question_id": 54226053, "link": "https://stackoverflow.com/questions/54226053/how-do-you-add-a-c-winrt-button-click-handler/54229618#54229618", "title": "How do you add a C++/WinRT Button Click handler?", "body": "<blockquote>\n<p>How does one translate the Microsoft ButtonBase.Click Event information for C++/WinRT into a prototype declaration and definition?</p>\n</blockquote>\n<p>Not sure what do you mean by <code>prototype declaration and definition</code> since given information itself is prototype.</p>\n<p>In <a href=\"https://docs.microsoft.com/en-us/windows/uwp/cpp-and-winrt-apis/handle-events\" rel=\"nofollow noreferrer\">this</a> page you can find more information about event handling in C++/Winrt. Link explains about handling and revoking events with delegates and gives example of Button click event handling for <code>C++/WinRT</code>. In short you need to have handler and register it through delegate.</p>\n<pre><code>// function that handles event\nvoid MainPage::ClickHandler(IInspectable const&amp; /* sender */, RoutedEventArgs const&amp; /* args */)\n{\n    Button().Content(box_value(L&quot;Clicked&quot;));\n}\n...\n// register above function for event handler\nButton().Click({ this, &amp;MainPage::ClickHandler });\n</code></pre>\n<p><strong>UPD:</strong> I tried to check regarding error <code>The document item has no code-behind file. Add a code-behind file and a class definition before adding event handlers</code> when user tries to access Properties and Event Handlers. I could easily reproduce this issue by creating Blank App (C++/Winrt) after installing <a href=\"https://marketplace.visualstudio.com/items?itemName=CppWinRTTeam.cppwinrt101804264\" rel=\"nofollow noreferrer\">cppwinrt</a> extension.</p>\n<p>I checked <a href=\"https://github.com/Microsoft/Windows-appsample-photo-editor\" rel=\"nofollow noreferrer\">photo editor sample app</a> from ms github to further down debug this problem. In this sample app I failed to load XAML design mode. First it requested me to update my Windows version to 1809, but I failed to update. So I decided to rollback to <a href=\"https://github.com/Microsoft/Windows-appsample-photo-editor/commit/3fd2defc5cdb46a740db4aad99b1b7f7c19be623\" rel=\"nofollow noreferrer\">this</a> commit id which does not require Windows 1809 update.</p>\n<p>After this XAML design failed with <code>Some assembly references are missing. Building to restore the NuGet cache might resolve this issue.</code> error. Research lead me to this <a href=\"https://github.com/Microsoft/cppwinrt/issues/279\" rel=\"nofollow noreferrer\">issue</a> which is closed with following comment</p>\n<blockquote>\n<p>This is currently unsupported. The XAML team is currently working on designer support, so you should see this light up in a future update to the Windows SDK.</p>\n</blockquote>\n<p>After opening <a href=\"https://github.com/MicrosoftDocs/windows-uwp/issues/1398\" rel=\"nofollow noreferrer\">issue</a> in MS docs github, I got following response from them and according <a href=\"https://docs.microsoft.com/en-us/windows/uwp/cpp-and-winrt-apis/intro-to-using-cpp-with-winrt#blank-app-cwinrt\" rel=\"nofollow noreferrer\">page</a> of MS docs was updated.</p>\n<blockquote>\n<p>I've added the following info to the &quot;Blank App (C++/WinRT)&quot; subsection of this topic, since that's the project template that uses XAML as its UI.</p>\n<p>&quot;Visual Studio's XAML design surface support for C++/WinRT is close to parity with C#. One exception is the Events tab of the Properties window. With a C# project, you can use that tab to add event handlers; with a C++/WinRT project, that facility is not present. But see Handle events by using delegates in C++/WinRT for info on how to add event handlers to your code.&quot;</p>\n<p>This change should be live soon. Please let me know if there's anything further I can add.</p>\n</blockquote>\n"}], "owner": {"reputation": 325, "user_id": 6220486, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/16b0fd0714b6147991aece5929542eb3?s=128&d=identicon&r=PG&f=1", "display_name": "user34299", "link": "https://stackoverflow.com/users/6220486/user34299"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1018, "favorite_count": 0, "accepted_answer_id": 54229618, "answer_count": 1, "score": 2, "last_activity_date": 1548377576, "creation_date": 1547676029, "question_id": 54226053, "link": "https://stackoverflow.com/questions/54226053/how-do-you-add-a-c-winrt-button-click-handler", "title": "How do you add a C++/WinRT Button Click handler?", "body": "<p>How does one translate the Microsoft <a href=\"https://docs.microsoft.com/en-us/uwp/api/windows.ui.xaml.controls.primitives.buttonbase.click\" rel=\"nofollow noreferrer\">ButtonBase.Click Event</a> information for C++/WinRT into a prototype declaration and definition?</p>\n\n<p>In Visual Studio Community 2017, version 15.9.5, I created a standard project, viz., Blank App (C++/WinRT), which has a button (myButton) as part of it.  I want to learn how to add a second button.  I have added the XAML code for a second button (myButton2), but thereafter I am stuck.</p>\n\n<pre><code>&lt;Page\n    x:Class=\"X003.MainPage\"\n    xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\n    xmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\"\n    xmlns:local=\"using:X003\"\n    xmlns:d=\"http://schemas.microsoft.com/expression/blend/2008\"\n    xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\"\n    mc:Ignorable=\"d\"&gt;\n\n    &lt;StackPanel x:Name=\"stackPan\" Orientation=\"Horizontal\" HorizontalAlignment=\"Center\" VerticalAlignment=\"Center\"  Background=\"LightBlue\"&gt;\n        &lt;Button x:Name=\"myButton\" Click=\"ClickHandler\"&gt;Click Me&lt;/Button&gt;\n        &lt;Button x:Name=\"myButton2\" Click=\"ClickHandler2\"&gt;Click Me2&lt;/Button&gt;\n    &lt;/StackPanel&gt;\n&lt;/Page&gt;\n</code></pre>\n\n<p>I could just copy the code from the first button that the Blank App (C++/WinRT) provided.  But, if I did not have the first button as an example, I would not know how I would translate the Microsoft documentation, viz.,</p>\n\n<pre><code>// Register\nevent_token Click(RoutedEventHandler const&amp; handler) const;\n\n// Revoke with event_token\nvoid Click(event_token const&amp; cookie) const;\n\n// Revoke with event_revoker\nClick_revoker Click(auto_revoke_t, RoutedEventHandler const&amp; handler) const;\n</code></pre>\n\n<p>into a Click handler.  The first line of the Microsoft documentation, viz.,</p>\n\n<pre><code>event_token Click(RoutedEventHandler const&amp; handler) const;\n</code></pre>\n\n<p>is, I take it, the format to be used in creating the handler.  It does not look like the handler already in the project, viz.,</p>\n\n<pre><code>void ClickHandler(Windows::Foundation::IInspectable const&amp; sender, Windows::UI::Xaml::RoutedEventArgs const&amp; args);\n</code></pre>\n\n<p>I thought that it could be added to the .idl file.  But, the .idl file does not have the first button in it.</p>\n\n<p>The example code with Microsoft provides is for C#, even when \"C++/WinRT\" is selected at the top-right of the page.</p>\n\n<p>The new version of C++/WinRT has a lot of documentation, almost too much.  Coming from having used C#/WPF/XAML, I cannot see my way clearly to doing similar work with C++/WinRT.</p>\n\n<p>Finally, the project Properties tab is of no help.  In C# the events were listed and choosing one would result in a declaration and basic definition being created in the code.  For C++/WinRT, when the cursor is on the control in the XAML page, the events section of the Properties page shows the name of the control, myButton or myButton2, and indicates \"The document item has no code-behind file.  Add a code-behind file and a class definition before adding event handlers.\"  But, there is no code-behind file for the existing button, myButton.</p>\n"}, {"tags": ["c++", "visual-studio", "file-io"], "comments": [{"owner": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 2, "creation_date": 1547675582, "post_id": 54225938, "comment_id": 95277812, "body": "My advice is to use your debugger to see why. Put a breakpoint in your code where it opens your file and see  what happens when you step through the code that opens the file. Also your code should have some form of error handling."}, {"owner": {"reputation": 6675, "user_id": 854742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3dc3befe29d589c7c34fd1600affc041?s=128&d=identicon&r=PG", "display_name": "Carey Gregory", "link": "https://stackoverflow.com/users/854742/carey-gregory"}, "edited": false, "score": 1, "creation_date": 1547675616, "post_id": 54225938, "comment_id": 95277825, "body": "What&#39;s the error? When you know what error is being returned you&#39;ll know what the problem is."}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 1, "creation_date": 1547675907, "post_id": 54225938, "comment_id": 95277933, "body": "Are you loading the file using a <b>relative</b> or <b>absolute</b> file path? If relative, it could certainly fail, since the starting working directory of the process is likely not what you are expecting when run within the IDE. ALWAYS use absolute paths at runtime, if you are not already doing so."}, {"owner": {"reputation": 1, "user_id": 10904957, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a3a6ebc35d9a770411104a4579f0d1b?s=128&d=identicon&r=PG&f=1", "display_name": "pc-crash", "link": "https://stackoverflow.com/users/10904957/pc-crash"}, "edited": false, "score": 0, "creation_date": 1547676626, "post_id": 54225938, "comment_id": 95278253, "body": "So stb_image use fopen_s as function for loading the file. It is returning a ernno_t with the value 2. This means no such File or Directory. But the file is present, and it can be opend  if i run the compiled exe outside of VS. The Problem only occures when i am trying to run the programm inside of Visual Studio."}, {"owner": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 0, "creation_date": 1547676874, "post_id": 54225938, "comment_id": 95278345, "body": "<b><i>This means no such File or Directory. But the file is present,</i></b> Look at the path to the image file in your debugger when you debug. Perhaps the path was corrupted for some reason."}, {"owner": {"reputation": 1, "user_id": 10904957, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a3a6ebc35d9a770411104a4579f0d1b?s=128&d=identicon&r=PG&f=1", "display_name": "pc-crash", "link": "https://stackoverflow.com/users/10904957/pc-crash"}, "edited": false, "score": 0, "creation_date": 1547677039, "post_id": 54225938, "comment_id": 95278404, "body": "Using absolute paths with double backslashes fixed it. I feel like a moron now. How can i set a comment as an answer?"}, {"owner": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 0, "creation_date": 1547677493, "post_id": 54225938, "comment_id": 95278623, "body": "You can answer your own question if you want."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 10904957, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a3a6ebc35d9a770411104a4579f0d1b?s=128&d=identicon&r=PG&f=1", "display_name": "pc-crash", "link": "https://stackoverflow.com/users/10904957/pc-crash"}, "is_accepted": false, "score": 0, "last_activity_date": 1547678247, "creation_date": 1547678247, "answer_id": 54226452, "question_id": 54225938, "link": "https://stackoverflow.com/questions/54225938/loading-file-works-in-compiled-exe-but-not-when-run-inside-visual-studio/54226452#54226452", "title": "Loading File works in compiled exe but not when run inside visual studio", "body": "<p>Using absolute paths in the loading function fixed the problem.</p>\n"}], "owner": {"reputation": 1, "user_id": 10904957, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a3a6ebc35d9a770411104a4579f0d1b?s=128&d=identicon&r=PG&f=1", "display_name": "pc-crash", "link": "https://stackoverflow.com/users/10904957/pc-crash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 25, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547678247, "creation_date": 1547675444, "question_id": 54225938, "link": "https://stackoverflow.com/questions/54225938/loading-file-works-in-compiled-exe-but-not-when-run-inside-visual-studio", "title": "Loading File works in compiled exe but not when run inside visual studio", "body": "<p>I am trying to load an image into my program using stb_image. Every time i run the program directly inside of visual studio (pressing f5, happens in debug and release) the opening of the File fails. If i run the compiled exe in windows explorer the loading works just fine. The same problem occured when using fstream to load a textfile into a string. </p>\n\n<p>I tried placing the files in the directory of my code and into the final build folder but with no different outcome. Running Visual Studio with different Rights and different build settings. </p>\n"}, {"tags": ["c++", "unique-ptr", "overhead"], "comments": [{"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 0, "creation_date": 1547675506, "post_id": 54225864, "comment_id": 95277774, "body": "This is not specific to <code>unique_ptr</code>, but likely applies to passing any non-trivially-constructible class type <b>by value</b>, as the example is doing. Plus, it is not really a fair comparison, because <code>foo()</code> has to destroy the <code>u</code> object upon exit, where <code>boo()</code> does not destroy its <code>i</code> parameter, so there is more code generated to handle that."}, {"owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 0, "creation_date": 1547675636, "post_id": 54225864, "comment_id": 95277833, "body": "Oh, sorry. Right idea, wrong on the details. The <code>foo</code> function could destroy an object. The <code>bar</code> function could not. So they&#39;re really not comparable."}, {"owner": {"reputation": 8075, "user_id": 2169853, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/68b89009f4066d3e1adbe72d4329c8d3?s=128&d=identicon&r=PG", "display_name": "Jens", "link": "https://stackoverflow.com/users/2169853/jens"}, "reply_to_user": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 0, "creation_date": 1547675696, "post_id": 54225864, "comment_id": 95277854, "body": "@RemyLebeau If this is a common behavior I am sure it was considered when <code>unique_ptr</code> was introduced, so it was a deliberate decision to introduce an abstraction with mandatory overhead. Didn&#39;t that spawn a lot of discussion in the standard committee?"}, {"owner": {"reputation": 8075, "user_id": 2169853, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/68b89009f4066d3e1adbe72d4329c8d3?s=128&d=identicon&r=PG", "display_name": "Jens", "link": "https://stackoverflow.com/users/2169853/jens"}, "reply_to_user": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547676013, "post_id": 54225864, "comment_id": 95277992, "body": "@Fran&#231;oisAndrieux To my surprise, foo does not call the deleter of the <code>unique_ptr</code> parameter. As you can see in the example, the deleter gets called in the calling function <code>g</code> instead."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547676247, "post_id": 54225864, "comment_id": 95278076, "body": "@Jens Yes, the call site is taking care of it. This is not my field of expertise but this sounds like a calling convention thing."}, {"owner": {"reputation": 8075, "user_id": 2169853, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/68b89009f4066d3e1adbe72d4329c8d3?s=128&d=identicon&r=PG", "display_name": "Jens", "link": "https://stackoverflow.com/users/2169853/jens"}, "reply_to_user": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 0, "creation_date": 1547676281, "post_id": 54225864, "comment_id": 95278093, "body": "@RemyLebeau The generated code for <code>foo</code> does not call the deleter which I find very strange; But still, even if it would and if I modified <code>boo</code> to also delete the passed object it would still be an overhead. A very small negligible one, but the additional instruction is still generated. I don&#39;t consider this a performance issue, but find it strange."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 2, "creation_date": 1547676465, "post_id": 54225864, "comment_id": 95278184, "body": "@Jens As far as I know, <code>std::unique_ptr</code> isn&#39;t guaranteed to be without performance overhead. I believe this &quot;common wisdom&quot; comes from how only simple optimizations are required to eliminate the overhead it introduces. If a particular implementation can&#39;t achieve it, it sounds like it might be a problem with the implementation. It&#39;s the same with <code>std::array</code> (<a href=\"https://stackoverflow.com/questions/30263303/stdarray-vs-array-performance\">link</a>) it&#39;s usually considered zero overhead but that depends on inlining <code>operator[]</code> and other member function calls."}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1547681699, "post_id": 54225864, "comment_id": 95279994, "body": "These examples aren&#39;t analogous -- the first function also frees the pointer on exit.  If the function is not intended to free the pointer it should be <code>int foo(std::unique_ptr&lt;int&gt; const&amp; u)</code>"}, {"owner": {"reputation": 8075, "user_id": 2169853, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/68b89009f4066d3e1adbe72d4329c8d3?s=128&d=identicon&r=PG", "display_name": "Jens", "link": "https://stackoverflow.com/users/2169853/jens"}, "reply_to_user": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1547715258, "post_id": 54225864, "comment_id": 95289107, "body": "@M.M I&#39;ve added a second example which also deletes the pointer for <code>boo</code> to be more equivalent. However, this does not change the indirection when passing a <code>unique_ptr</code> by value compared to a plain pointer, so the parameter access of <code>unique_ptr</code> always requires an additional instruction (once per parameter only)."}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "reply_to_user": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1547734806, "post_id": 54225864, "comment_id": 95300324, "body": "@M.M semantically yes, but in practice no - the codegen <b>does not</b> free the pointer upon the exit."}, {"owner": {"reputation": 8075, "user_id": 2169853, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/68b89009f4066d3e1adbe72d4329c8d3?s=128&d=identicon&r=PG", "display_name": "Jens", "link": "https://stackoverflow.com/users/2169853/jens"}, "reply_to_user": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547823067, "post_id": 54225864, "comment_id": 95336600, "body": "@Fran&#231;oisAndrieux The behavior is consistent across plattforms and compilers available on godbolt which were able to compile the example. This includes POWER, ARM, X86 and ARM64 with different ABIs. Since the &quot;overhead&quot; is a result of parameter passing, inlining will eliminate (or let the compiler eliminate) it because there is no parameter passing anymore. However, this depends on the user code and not on the ability to inline library functions such as <code>std::array::operator[]</code>."}], "answers": [{"comments": [{"owner": {"reputation": 8075, "user_id": 2169853, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/68b89009f4066d3e1adbe72d4329c8d3?s=128&d=identicon&r=PG", "display_name": "Jens", "link": "https://stackoverflow.com/users/2169853/jens"}, "edited": false, "score": 1, "creation_date": 1547677297, "post_id": 54226226, "comment_id": 95278528, "body": "Thanks for the reference and the further explanation which also explains why the deleter is called in the caller. I always which that authors of standards would add rationals or publish an extra doc with their rationals for later use. I also tested other platforms that are available on Godbolt and it seems to be consistent on ARM, ARM64 and POWER."}, {"owner": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "edited": false, "score": 1, "creation_date": 1547710457, "post_id": 54226226, "comment_id": 95286850, "body": "Also, if the destructor is not trivial, the object must be in memory in order to be destructed during stack unwinding."}, {"owner": {"reputation": 8075, "user_id": 2169853, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/68b89009f4066d3e1adbe72d4329c8d3?s=128&d=identicon&r=PG", "display_name": "Jens", "link": "https://stackoverflow.com/users/2169853/jens"}, "reply_to_user": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "edited": false, "score": 0, "creation_date": 1547716141, "post_id": 54226226, "comment_id": 95289616, "body": "@Oliv I am not sure this is a reason for deleting it in the caller&#39;s context. The object is a parameter of the called function and the lifetime is coupled to this function; stack unwinding as a result of an exception can only happen in that function and there, the object can be deleted instead of the caller&#39;s context."}, {"owner": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "reply_to_user": {"reputation": 8075, "user_id": 2169853, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/68b89009f4066d3e1adbe72d4329c8d3?s=128&d=identicon&r=PG", "display_name": "Jens", "link": "https://stackoverflow.com/users/2169853/jens"}, "edited": false, "score": 1, "creation_date": 1547728585, "post_id": 54226226, "comment_id": 95296732, "body": "@Jens Or the exception could be raised in a callee of the callee in which case the object should again be in memory. The reason object are constructed in caller context is that only the caller know how to build the arguments and in which order they are built."}], "tags": [], "owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "is_accepted": true, "score": 6, "last_activity_date": 1547677324, "last_edit_date": 1592644375, "creation_date": 1547676982, "answer_id": 54226226, "question_id": 54225864, "link": "https://stackoverflow.com/questions/54225864/does-passing-a-unique-ptr-by-value-have-a-performance-penalty-compared-to-a-pl/54226226#54226226", "title": "Does passing a `unique_ptr` by value have a performance penalty compared to a plain pointer?", "body": "<p>System V ABI uses Itanium C++ ABI and refers to it. In particular, <a href=\"https://itanium-cxx-abi.github.io/cxx-abi/abi.html#non-trivial\" rel=\"noreferrer\">C++ Itanium ABI</a> specifies that</p>\n<blockquote>\n<p>If the parameter type is non-trivial for the purposes of calls, the\ncaller must allocate space for a temporary and pass that temporary by\nreference.</p>\n<p>Specifically:</p>\n<p>...</p>\n<p>If the type has a non-trivial destructor, the caller calls that destructor after control returns to it (including when the caller throws an exception), at the end of enclosing full-expression.</p>\n</blockquote>\n<p>So a simple answer to question &quot;<em>why it is not passed into register</em>&quot; is &quot;<em>because it can't</em>&quot;.</p>\n<p>Now, an interesting question might be '<em>why did C++ Itanium ABI decided to go with that</em>'.</p>\n<p>While I wouldn't claim that I have intimate knowledge with rationale, two things come to mind:</p>\n<ul>\n<li>This allows for copy elision if the argument to the function is a temporary</li>\n<li>This makes tail-call optimizations more powerful. If callee would need to call destructors of it's arguments, TCO wouldn't be possible for any function which accepts non-trivial arguments.</li>\n</ul>\n"}], "owner": {"reputation": 8075, "user_id": 2169853, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/68b89009f4066d3e1adbe72d4329c8d3?s=128&d=identicon&r=PG", "display_name": "Jens", "link": "https://stackoverflow.com/users/2169853/jens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1016, "favorite_count": 1, "accepted_answer_id": 54226226, "answer_count": 1, "score": 11, "last_activity_date": 1547716711, "creation_date": 1547675073, "last_edit_date": 1547716711, "question_id": 54225864, "link": "https://stackoverflow.com/questions/54225864/does-passing-a-unique-ptr-by-value-have-a-performance-penalty-compared-to-a-pl", "title": "Does passing a `unique_ptr` by value have a performance penalty compared to a plain pointer?", "body": "<p><a href=\"http://www.modernescpp.com/index.php/memory-and-performance-overhead-of-smart-pointer\" rel=\"nofollow noreferrer\">Common wisdom is that <code>std::unique_ptr</code> does not introduce a performance penalty</a> (<a href=\"https://stackoverflow.com/questions/50001598/how-can-unique-ptr-have-no-overhead-if-it-needs-to-store-the-deleter\">and not a memory penalty when not using a deleter parameter</a>), but I recently stumbled over a discussion showing that it actually introduces an additional indirection because the <code>unique_ptr</code> cannot be passed in a register on platforms with Itanium ABI. The example posted was similar to</p>\n\n<pre><code>#include &lt;memory&gt;\n\nint foo(std::unique_ptr&lt;int&gt; u) {\n    return *u;\n}\n\nint boo(int* i) {\n    return *i;\n}\n</code></pre>\n\n<p><a href=\"https://godbolt.org/z/yLGjp0\" rel=\"nofollow noreferrer\">Which generates an additional assembler instruction in foo compared to boo.</a></p>\n\n<pre><code>foo(std::unique_ptr&lt;int, std::default_delete&lt;int&gt; &gt;):\n        mov     rax, QWORD PTR [rdi]\n        mov     eax, DWORD PTR [rax]\n        ret\nboo(int*):\n        mov     eax, DWORD PTR [rdi]\n        ret\n</code></pre>\n\n<p>The explanation was that the Itanium ABI demands that the <code>unique_ptr</code> shall not be passed in a register because of the non-trivial constructor, so it created on the stack and then the address of this object is passed in a register.</p>\n\n<p>I know that this does not really impact performance on a modern PC platform, but I am wondering if somebody could provide more details on the reasons why it shall not be copied to a register. Since zero-cost abstractions are one of the major goals of C++, I am wondering if this has been discussed in the standardization process as an accepted deviation or if it is a quality of implementation issue. The performance penalty is certainly small enough when considering the benefits, especially on modern PC platforms. </p>\n\n<p>Commenters have pointed out that the two functions are not fully equivalent and thus the comparison is flawed since <code>foo</code> will also call the deleter on the <code>unique_ptr</code> parameter but <code>boo</code> does not release the memory. However, I was only interested in the difference resulting from passing a <code>unique_ptr</code> by-value compared to passing a plain pointer. <a href=\"https://godbolt.org/z/mcxW_3\" rel=\"nofollow noreferrer\">I've modified the example code and included a call to <code>delete</code> to free the plain pointer</a>; the call is in the caller because the <code>unique_ptr</code>'s deleter also gets called in the caller's context to make the generated code more identical. In addition, the manual <code>delete</code> also checks <code>ptr != nullptr</code> because the destructor also does this. Still, <code>foo</code> does not pass the parameter in a register and has to \ndo an indirect access.</p>\n\n<p>I also wonder why the compiler does not elide the check for <code>nullptr</code> before calling <code>operator delete</code> since this is defined to be a noop anyway. I guess that <code>unique_ptr</code> could be specialized for the default deleter to not perform the check in the destructor, but that would be a very small micro-optimization.</p>\n"}, {"tags": ["c++", "winapi", "shellexecute"], "comments": [{"owner": {"reputation": 14021, "user_id": 7571258, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/fBP6e.png?s=128&g=1", "display_name": "zett42", "link": "https://stackoverflow.com/users/7571258/zett42"}, "edited": false, "score": 1, "creation_date": 1547677896, "post_id": 54225771, "comment_id": 95278789, "body": "Please clarify in the <i>question</i>: Is your program compiled for 32-bit or 64-bit? Is the target of the link <code>C:\\\\Program Files\\\\Blender Foundation\\\\Blender\\\\blender.exe</code>? There are a few unused variables in the code sample, which should be removed (they are just confusing)."}, {"owner": {"reputation": 82917, "user_id": 3501, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/1fd5f5cc203c393634379a3b3b7e7a87?s=128&d=identicon&r=PG", "display_name": "Anders", "link": "https://stackoverflow.com/users/3501/anders"}, "edited": false, "score": 0, "creation_date": 1547691451, "post_id": 54225771, "comment_id": 95281865, "body": "What happens if you put a <code>Sleep(6666);</code> after ShellExecute?"}, {"owner": {"reputation": 13, "user_id": 10924628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2e2e7b625923acacae59e5e2b6d2123?s=128&d=identicon&r=PG&f=1", "display_name": "Jeremiah T", "link": "https://stackoverflow.com/users/10924628/jeremiah-t"}, "edited": false, "score": 0, "creation_date": 1547705298, "post_id": 54225771, "comment_id": 95284888, "body": "Updated OP. The blender shortcut was indeed created from the executable path BUT as I said before I have not been able to get ANY .lnk files to launch with ShellExecute. So far, all .exe and other extensions have worked. I&#39;m not sure why I was requested to use Sleep() but I tried with the suggested time and it slept and returned 3 like before."}, {"owner": {"reputation": 14021, "user_id": 7571258, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/fBP6e.png?s=128&g=1", "display_name": "zett42", "link": "https://stackoverflow.com/users/7571258/zett42"}, "edited": false, "score": 0, "creation_date": 1547714318, "post_id": 54225771, "comment_id": 95288639, "body": "Are you sure it fails for any LNK file? I can repro only for LNK files that point to a path under <code>C:\\Program Files</code>, but LNK files pointing to <code>C:\\Program Files (x86)</code> do work, which clearly indicates a 32/64-bit issue."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 10924628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2e2e7b625923acacae59e5e2b6d2123?s=128&d=identicon&r=PG&f=1", "display_name": "Jeremiah T", "link": "https://stackoverflow.com/users/10924628/jeremiah-t"}, "edited": false, "score": 0, "creation_date": 1547703891, "post_id": 54228410, "comment_id": 95284473, "body": "I&#39;m certain the path is correct. I just copy/pasted the path from Visual Studio to the Command Prompt (removed ONLY the escape slashes) and it launched the file as expected. I previously read the path with a function and it was also shown as expected."}, {"owner": {"reputation": 6168, "user_id": 10611792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r727s.jpg?s=128&g=1", "display_name": "Drake Wu", "link": "https://stackoverflow.com/users/10611792/drake-wu"}, "reply_to_user": {"reputation": 13, "user_id": 10924628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2e2e7b625923acacae59e5e2b6d2123?s=128&d=identicon&r=PG&f=1", "display_name": "Jeremiah T", "link": "https://stackoverflow.com/users/10924628/jeremiah-t"}, "edited": false, "score": 0, "creation_date": 1547706818, "post_id": 54228410, "comment_id": 95285391, "body": "@Jeremiah T And, what about the filename, use cmd go into the path of .lnk file, then dir to check the filename if it is &quot;blender.lnk.lnk&quot;. And what&#39;s the return value <code>hRes</code> of <code>ppf-&gt;Load(pszString, TRUE);</code>"}, {"owner": {"reputation": 6168, "user_id": 10611792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r727s.jpg?s=128&g=1", "display_name": "Drake Wu", "link": "https://stackoverflow.com/users/10611792/drake-wu"}, "reply_to_user": {"reputation": 13, "user_id": 10924628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2e2e7b625923acacae59e5e2b6d2123?s=128&d=identicon&r=PG&f=1", "display_name": "Jeremiah T", "link": "https://stackoverflow.com/users/10924628/jeremiah-t"}, "edited": false, "score": 0, "creation_date": 1547718653, "post_id": 54228410, "comment_id": 95291065, "body": "hi,@Jeremiah T  <code>IShellLink.GetPath</code> can parse the full path of the file, and the result depends on the platform you compile. So that&#39;s the reason you have the wrong path, program has gone to the wrong folder. And I have updated it."}, {"owner": {"reputation": 13, "user_id": 10924628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2e2e7b625923acacae59e5e2b6d2123?s=128&d=identicon&r=PG&f=1", "display_name": "Jeremiah T", "link": "https://stackoverflow.com/users/10924628/jeremiah-t"}, "edited": false, "score": 0, "creation_date": 1547840204, "post_id": 54228410, "comment_id": 95344886, "body": "Sorry, I didn&#39;t see what your function was getting at before. You and zett42 have shown me the problem. It was just a coincidence that ALL the shortcuts I tested were pointing at x64 executables. I even stated in the OP that it might have to do with 32/64-bit discrepancy but abandoned that suspicion too soon I suppose. However, I still need a solution. What&#39;s the best way to resolve a shortcut&#39;s target path at run-time regardless of 32/64 build?"}, {"owner": {"reputation": 6168, "user_id": 10611792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r727s.jpg?s=128&g=1", "display_name": "Drake Wu", "link": "https://stackoverflow.com/users/10611792/drake-wu"}, "reply_to_user": {"reputation": 13, "user_id": 10924628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2e2e7b625923acacae59e5e2b6d2123?s=128&d=identicon&r=PG&f=1", "display_name": "Jeremiah T", "link": "https://stackoverflow.com/users/10924628/jeremiah-t"}, "edited": false, "score": 0, "creation_date": 1551941939, "post_id": 54228410, "comment_id": 96826906, "body": "Finally, I find the root cause and a workaround, see my edit in answer."}], "tags": [], "owner": {"reputation": 6168, "user_id": 10611792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r727s.jpg?s=128&g=1", "display_name": "Drake Wu", "link": "https://stackoverflow.com/users/10611792/drake-wu"}, "is_accepted": true, "score": 1, "last_activity_date": 1551926753, "last_edit_date": 1592644375, "creation_date": 1547694358, "answer_id": 54228410, "question_id": 54225771, "link": "https://stackoverflow.com/questions/54225771/c-shellexecute-specifically-not-opening-lnk-files/54228410#54228410", "title": "C++ ShellExecute specifically not opening LNK files", "body": "<p>First, check that your .lnk file is in the path.</p>\n<p>Then (and the most probable cause of your problem) check that your .lnk filename is created correctly. To make sure it is not like &quot;blender.lnk.lnk&quot;(I can reproduce your issue if I have set as this).</p>\n<p>You can also try to parse the path of the link file manually by yourself.\nHere is the sample:</p>\n<pre><code>void ShortcutToRealpath(LPWSTR pszString, LPSTR pdzString)\n{\n    IShellLink   *pShellLink;\n    HRESULT hRes;\n\n    ::CoInitialize(NULL);\n    hRes = CoCreateInstance(CLSID_ShellLink, NULL, CLSCTX_INPROC_SERVER, IID_IShellLink, (void **)&amp;pShellLink);\n    if (SUCCEEDED(hRes))\n    {\n        IPersistFile   *ppf;\n        hRes = pShellLink-&gt;QueryInterface(IID_IPersistFile, (void **)&amp;ppf);\n        if (SUCCEEDED(hRes))\n        {\n            hRes = ppf-&gt;Load(pszString, TRUE);\n            if (SUCCEEDED(hRes))\n            {\n                pShellLink-&gt;GetPath(pdzString, MAX_PATH, NULL, 0);\n            }\n            ppf-&gt;Release();\n        }\n        pShellLink-&gt;Release();\n    }\n    ::CoUninitialize();\n}\n</code></pre>\n<p>When I build as x86 Platform, the path will be parsed like:\n<a href=\"https://i.stack.imgur.com/qQrxm.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/qQrxm.png\" alt=\"enter image description here\" /></a>\nThat's the reason your program can't find the path.</p>\n<p>And if I select x64:\n<a href=\"https://i.stack.imgur.com/t21TW.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/t21TW.png\" alt=\"enter image description here\" /></a></p>\n<p>Put your target file to the corresponding file.</p>\n<p>EDIT:</p>\n<p>After I test it with the MS tool <a href=\"https://docs.microsoft.com/en-us/sysinternals/downloads/procmon\" rel=\"nofollow noreferrer\">Procmom.exe</a>, I have found something others, if run as 32-bit, it will show :\n<a href=\"https://i.stack.imgur.com/8BMzb.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/8BMzb.png\" alt=\"enter image description here\" /></a></p>\n<p>The key\u00a0value is <code>C:\\Program Files (x86)</code> and if we run it as 64-bit, the key is reference to &quot;HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\ProgramFilesDir&quot; the key value is <code>C:\\Program Files</code>. After I check the registry:\n<a href=\"https://i.stack.imgur.com/KdoFO.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/KdoFO.png\" alt=\"enter image description here\" /></a>\n<a href=\"https://i.stack.imgur.com/Z8AI6.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Z8AI6.png\" alt=\"enter image description here\" /></a>\nIt seems that <code>C:\\Program Files</code> is not visible by default to the 32-bit registry(I am not sure about the specific reason).\nIf you change the key <code>ProgramFilesDir</code> to <code>C:\\Program Files</code> in 32-bit registry, the issue will be fixed.</p>\n"}], "owner": {"reputation": 13, "user_id": 10924628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2e2e7b625923acacae59e5e2b6d2123?s=128&d=identicon&r=PG&f=1", "display_name": "Jeremiah T", "link": "https://stackoverflow.com/users/10924628/jeremiah-t"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 848, "favorite_count": 0, "accepted_answer_id": 54228410, "answer_count": 1, "score": -1, "last_activity_date": 1551926753, "creation_date": 1547674618, "last_edit_date": 1547704664, "question_id": 54225771, "link": "https://stackoverflow.com/questions/54225771/c-shellexecute-specifically-not-opening-lnk-files", "title": "C++ ShellExecute specifically not opening LNK files", "body": "<p>-Windows 7 64-bit<br>\n-Visual Studio 2013 (v120)<br>\n-Unicode Enabled<br>\n-Target Build- Debug 32-bit</p>\n\n<p>I would like to build a launcher (for personal use) however I can't get ShellExecute to work with all file types or paths, specifically shortcuts (LNK). I've researched and tried the following in many combinations...<br>\n-I'm using escape sequences<br>\n-I'm adding the file extension (and tried without)<br>\n-I've included Windows.h<br>\n-Printed directory FindFirstFile / FindNextFile to explicitly ensure the path has no typos<br>\n-Tried using both a literal and variable as file path argument<br>\n-Tried running VS with admin privileges<br>\n-Tried ShellExecute, ShellExecuteA, ShellExecuteEx, and System (with appropriate character sets)<br>\n-Tried NULL, \"runas\" and, \"open\" for the verb<br>\n-Launches fine from Command Line or explorer using same path<br>\n-Tried using %USERPROFILE% macro instead of user name (returns 2)<br>\n-Seems to work with EXE and URLs<br>\n-Does not seem to work with any LNK across any path including C:\\ directly  </p>\n\n<p>Suspected issue<br>\n-32bit/64bit discrepancy<br>\n-UAC / Privelages<br>\n-Character set<br>\n-File extension<br>\n-Anti virus interference (though AV isn't alerting me of any issues) and I've tested while silencing my AV  </p>\n\n<p>Here is one of the simplest programs I've tried...</p>\n\n<pre><code>#include \"stdafx.h\"\n#include &lt;iostream&gt;\n#include &lt;Windows.h&gt;\n#include &lt;atlstr.h&gt;\n\nint _tmain(int argc, _TCHAR* argv[])\n{\n    CoInitializeEx(NULL, COINIT_APARTMENTTHREADED | COINIT_DISABLE_OLE1DDE);\n\n    // Variables below for testing as path argument\n    // Paths that end with LNK are the only ones that I can't get to launch\n    CStringW link(\"C:\\\\Users\\\\Home\\\\Documents\\\\Art\\\\blender.lnk\"); // Doesn't work\n    CStringW target(\"C:\\\\Program Files\\\\Blender Foundation\\\\Blender\\\\blender.exe\"); // Launches software as expected\n    CStringW url(\"https://stackoverflow.com\"); // Launches browser with URL as expected\n\n    int error = reinterpret_cast&lt;int&gt;(ShellExecute(\n        NULL, \n        NULL, \n        L\"C:\\\\Users\\\\Home\\\\Documents\\\\Art\\\\blender.lnk\", // Using literal with LNK extension also does not work\n        NULL, \n        NULL, \n        SW_SHOWDEFAULT\n        ));\n\n\n    // EVEN SYSTEM CAN NOT FIND THE PATH!!!\n    // system(\"C:\\\\Users\\\\Home\\\\Documents\\\\Art\\\\blender.lnk\");\n\n    std::cout &lt;&lt; error &lt;&lt; std::endl; // Returns 3 \"The specified path was not found.\".\n\n    // Free COM\n    CoUninitialize();\n\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c++", "visual-studio", "linker-errors", "mathgl"], "comments": [{"owner": {"reputation": 7006, "user_id": 540815, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/zEGbl.png?s=128&g=1", "display_name": "ThomasMcLeod", "link": "https://stackoverflow.com/users/540815/thomasmcleod"}, "edited": false, "score": 1, "creation_date": 1547675266, "post_id": 54225759, "comment_id": 95277681, "body": "Welcome to Stackoverflow. What are you considering to be an &quot;attached library&quot; verses &quot;locally present&quot;?"}, {"owner": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 0, "creation_date": 1547676258, "post_id": 54225759, "comment_id": 95278080, "body": "<code>__declspec(dllimport)</code> means the implementations are in a dll and you will be linking against an import library."}, {"owner": {"reputation": 21, "user_id": 8801029, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QGxCOABSV1I/AAAAAAAAAAI/AAAAAAAAACc/Pool3-oQMRs/photo.jpg?sz=128", "display_name": "Sreevatsank Kadaveru", "link": "https://stackoverflow.com/users/8801029/sreevatsank-kadaveru"}, "reply_to_user": {"reputation": 7006, "user_id": 540815, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/zEGbl.png?s=128&g=1", "display_name": "ThomasMcLeod", "link": "https://stackoverflow.com/users/540815/thomasmcleod"}, "edited": false, "score": 0, "creation_date": 1547717367, "post_id": 54225759, "comment_id": 95290347, "body": "@ThomasMcLeod &quot;attached Libraries&quot; are the precompiled &#39;.lib&#39; files which I have manually attached as Additional Dependencies, &quot;locally present definitions&quot; are the function definitions that are present in the source file(i.e. in the .cpp/.h file) that I am compiling. For Example:"}, {"owner": {"reputation": 21, "user_id": 8801029, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QGxCOABSV1I/AAAAAAAAAAI/AAAAAAAAACc/Pool3-oQMRs/photo.jpg?sz=128", "display_name": "Sreevatsank Kadaveru", "link": "https://stackoverflow.com/users/8801029/sreevatsank-kadaveru"}, "edited": false, "score": 0, "creation_date": 1547717890, "post_id": 54225759, "comment_id": 95290632, "body": "For Example:      class FullyDefined_Class{    // is a fully defined Class, all functions have      well defined definitions. ( present locally)            int a, b, c;        //  some variables            int Fully_Defined_Function(){        //  Full function definitions             printf(&quot;Example of a fully defined function\\n&quot;);     return 0;            }      };      class __declspec(dllimport) ExternallyDefined_Class {  // this is a externally defined class, one of its function definitions are not present here       int a, b, c;      int exteranlly_Defined Function();     };"}, {"owner": {"reputation": 7006, "user_id": 540815, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/zEGbl.png?s=128&g=1", "display_name": "ThomasMcLeod", "link": "https://stackoverflow.com/users/540815/thomasmcleod"}, "edited": false, "score": 0, "creation_date": 1547756495, "post_id": 54225759, "comment_id": 95311850, "body": "sounds like you don&#39;t have the linker configured to search for the .lib files. Are they located outside of your project tree?"}, {"owner": {"reputation": 21, "user_id": 8801029, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QGxCOABSV1I/AAAAAAAAAAI/AAAAAAAAACc/Pool3-oQMRs/photo.jpg?sz=128", "display_name": "Sreevatsank Kadaveru", "link": "https://stackoverflow.com/users/8801029/sreevatsank-kadaveru"}, "reply_to_user": {"reputation": 7006, "user_id": 540815, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/zEGbl.png?s=128&g=1", "display_name": "ThomasMcLeod", "link": "https://stackoverflow.com/users/540815/thomasmcleod"}, "edited": false, "score": 0, "creation_date": 1547996689, "post_id": 54225759, "comment_id": 95377347, "body": "@ThomasMcLeod the linker is configured, it links well with other functions"}, {"owner": {"reputation": 7006, "user_id": 540815, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/zEGbl.png?s=128&g=1", "display_name": "ThomasMcLeod", "link": "https://stackoverflow.com/users/540815/thomasmcleod"}, "edited": false, "score": 0, "creation_date": 1548015689, "post_id": 54225759, "comment_id": 95382966, "body": "Other functions might be in other directories. If you&#39;re .lib is not in one of several directories that the Linker searches, then you must tell the linker where to look with a directory search argument. Usually, this is <code>-L</code> followed by a path."}], "owner": {"reputation": 21, "user_id": 8801029, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QGxCOABSV1I/AAAAAAAAAAI/AAAAAAAAACc/Pool3-oQMRs/photo.jpg?sz=128", "display_name": "Sreevatsank Kadaveru", "link": "https://stackoverflow.com/users/8801029/sreevatsank-kadaveru"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 83, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1547674556, "creation_date": 1547674556, "question_id": 54225759, "link": "https://stackoverflow.com/questions/54225759/how-to-look-up-for-function-class-definitions-locally-before-looking-up-the-att", "title": "How to look-up for function/class definitions locally, before looking up the attached libraries? (Linker C++)", "body": "<p>My observation: C++ Linker(Visual Studio specifically) takes __declspec(dllimport) too seriously, the linker looks up for definitions \n of any class/function declared with this directive, in the attached libraries ONLY. (Ignoring the definitions present locally).\nI want to give __declspec(dllimport) directive lesser priority so that the linker first considers the locally present definitions before looking elsewhere. is it possible to do so? \nAlso is it a Windows Specific/ Visual Studio Specific Issue? if so is there a workaround?</p>\n\n<p>I encountered this issue while trying to use the precompiled MathGL-v2.4.2 binaries on Visual Studio 2015, Windows.</p>\n\n<p>Initial Builds gave many Linker Error 2019: unresolved external symbol  __declspec(dllimport) _cdel mglGraph::mglGraph(void).... blah blah.</p>\n\n<p>Further, I went through the Library code to find that Every Class and Struct definitions are of the form:</p>\n\n<pre><code>class MGL_EXPORT mglGraph { \n      //  some variables and \n      //  Full function definitions \n      //  (also contains some inline functions)\n}; \n</code></pre>\n\n<p>Where MGL_EXPORT is defined as,</p>\n\n<pre><code>/* in dllexport.h  the following is declared */\n\n#    ifdef mgl_EXPORTS\n    /* We are building this library */\n#      define MGL_EXPORT __declspec(dllexport)\n#    else\n    /* We are using this library */\n#      define MGL_EXPORT __declspec(dllimport)\n#    endif\n</code></pre>\n\n<p>also, I looked up the libmgl.dll Exported Symbols, those symbols that the linker is looking for don't exist(hence naturally Linker gives unresolved Symbol Error).</p>\n\n<p>From all the Above, Conclusion: Linker Ignores any local Definition of class/function and Only Looks-up the Attached Libraries for Function Definitions, of the class/function declared with __declspec(dllimport) directive.</p>\n\n<p>More proof: By removing the MGL_EXPORT from the definition of completely defined functions/classes the code compiles</p>\n\n<p>Now the Question is: is this a platform specific problem? if yes is there a workaround? (as it is very cumbersome to carefully go through every class in the library to make sure that all the functions are completely defined before removing MGL_EXPORT directive).</p>\n\n<p>\"I want to give __declspec(dllimport) directive lesser priority so that the linker first considers the locally present definitions before looking elsewhere\" This very elegantly solves the problem.</p>\n"}, {"tags": ["c++", "multithreading"], "comments": [{"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547674606, "post_id": 54225720, "comment_id": 95277389, "body": "You have to lock even if the condition is atomic."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547674655, "post_id": 54225720, "comment_id": 95277412, "body": "Your condition variable doesn&#39;t actually have a condition to wait on. It&#39;s just waiting for an event. Due to spurious waking it may not behave as you intend."}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1547674779, "post_id": 54225720, "comment_id": 95277466, "body": "Do not use condition variables as a general signalling mechanism - they are not designed for this. If you find it unfair, find small consolation in the fact that you are not alone here."}, {"owner": {"reputation": 19267, "user_id": 801894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=128&d=identicon&r=PG", "display_name": "Solomon Slow", "link": "https://stackoverflow.com/users/801894/solomon-slow"}, "edited": false, "score": 0, "creation_date": 1547675272, "post_id": 54225720, "comment_id": 95277683, "body": "Re, &quot;what if I do not need to transfer data, but only need to wake up the waiting thread?&quot; That doesn&#39;t make any sense. If nothing has changed in memory, then there can be no reason to wake the waiting thread. If something <i>has</i> changed, then your program must use some form of <i>synchronization</i> (e.g., by proper use of a <code>std::mutex</code>) to ensure that the change will be visible to the other thread when it wakes up."}, {"owner": {"reputation": 231, "user_id": 4264977, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lNiXr.jpg?s=128&g=1", "display_name": "o2gy", "link": "https://stackoverflow.com/users/4264977/o2gy"}, "reply_to_user": {"reputation": 19267, "user_id": 801894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=128&d=identicon&r=PG", "display_name": "Solomon Slow", "link": "https://stackoverflow.com/users/801894/solomon-slow"}, "edited": false, "score": 0, "creation_date": 1547675774, "post_id": 54225720, "comment_id": 95277888, "body": "@SolomonSlow, well, that is right. But lets imagine I have queue which I can&#39;t modify, but I can to know if there is new element in that queue, so I just try to workaround this with minimal cost."}, {"owner": {"reputation": 231, "user_id": 4264977, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lNiXr.jpg?s=128&g=1", "display_name": "o2gy", "link": "https://stackoverflow.com/users/4264977/o2gy"}, "reply_to_user": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1547675862, "post_id": 54225720, "comment_id": 95277916, "body": "@SergeyA, What would you advise to use instead?"}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 1, "creation_date": 1547676794, "post_id": 54225720, "comment_id": 95278318, "body": "@o2gy nothing in posix has a signal semantic. In Linux there is linux-specific event_fd."}, {"owner": {"reputation": 231, "user_id": 4264977, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lNiXr.jpg?s=128&g=1", "display_name": "o2gy", "link": "https://stackoverflow.com/users/4264977/o2gy"}, "reply_to_user": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547720059, "post_id": 54225720, "comment_id": 95291951, "body": "@Fran&#231;oisAndrieux it seems to me like my question is not duplicate. My accent on that - I do not need to transfer data. And actually my question - is three different questions."}, {"owner": {"reputation": 19267, "user_id": 801894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=128&d=identicon&r=PG", "display_name": "Solomon Slow", "link": "https://stackoverflow.com/users/801894/solomon-slow"}, "edited": false, "score": 0, "creation_date": 1547735727, "post_id": 54225720, "comment_id": 95300877, "body": "@o2gy If there is a new element in the queue, then something has changed in memory. If something has changed in memory, then the threads need to use some form of synchronization (e.g., a mutex) to ensure that the change will be visible to those threads that need to see it."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 2, "creation_date": 1547737189, "post_id": 54225720, "comment_id": 95301764, "body": "@o2gy This is why asking multiple questions in a single question <a href=\"https://meta.stackoverflow.com/questions/371614/why-isnt-it-good-to-ask-multiple-questions-and-answers-in-one-question\">is not allowed</a>. Assuming the title of your question is what you actually want to know, this question can be closed as a duplicate. At least it something comes of it. If the question can&#39;t be boiled down to a single query then <a href=\"https://meta.stackoverflow.com/questions/267058/how-to-handle-a-question-that-asks-many-things\">it should be closed</a> for being too broad."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547737310, "post_id": 54225720, "comment_id": 95301844, "body": "@o2gy If the duplicate does not answer your question, you may have a more fundamental misunderstanding of what <code>std::condition_variable</code> actually does. It allows you to wait for a condition but it is not itself a condition. It requires a separate condition (a state to occur) and requires that condition to be synchronized by a mutex even if it would otherwise be atomic. In the example you gave about queues, the condition would be that the queue is not empty and a mutex would be required when modifying that condition."}, {"owner": {"reputation": 19267, "user_id": 801894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=128&d=identicon&r=PG", "display_name": "Solomon Slow", "link": "https://stackoverflow.com/users/801894/solomon-slow"}, "edited": false, "score": 0, "creation_date": 1547739526, "post_id": 54225720, "comment_id": 95303339, "body": "This tutorial (<a href=\"https://docs.oracle.com/javase/tutorial/essential/concurrency/guardmeth.html\" rel=\"nofollow noreferrer\">docs.oracle.com/javase/tutorial/essential/concurrency/&hellip;</a>) explains how to use the condition variables provided by the Java standard library. It&#39;s a different library, and it&#39;s written in a different language, but the ideas are nearly identical."}], "owner": {"reputation": 231, "user_id": 4264977, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lNiXr.jpg?s=128&g=1", "display_name": "o2gy", "link": "https://stackoverflow.com/users/4264977/o2gy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 89, "favorite_count": 0, "closed_date": 1547674611, "answer_count": 0, "score": 0, "last_activity_date": 1547720690, "creation_date": 1547674327, "last_edit_date": 1547720690, "question_id": 54225720, "link": "https://stackoverflow.com/questions/54225720/is-it-necessary-to-use-a-mutex-before-cond-var-notify", "closed_reason": "Duplicate", "title": "Is it necessary to use a mutex before cond_var.notify ()?", "body": "<p>UPDATE:<br>\nIt seems to me like my question is not duplicate. My accent on that nuance - we do not need to transfer data. And actually my question - is three different questions.</p>\n\n<p>I have a few questions.<br>\n1) <code>std::condition_variable</code> is everywhere considered as a means of synchronizing access to data. Thus, examples of usage usually look like this:</p>\n\n<pre><code>void put (const T &amp;val) {\n\u00a0\u00a0std::unique_lock&lt;std::mutex&gt; lock(m_Mtx);\n\u00a0\u00a0m_Value = val;\n\u00a0\u00a0m_CondVar.notify_one();\n}\nT get () {\n\u00a0\u00a0std::unique_lock&lt;std::mutex&gt; lock(m_Mtx);\n\u00a0\u00a0m_CondVar.wait(lock);\n\u00a0\u00a0return m_Value;\n}\n</code></pre>\n\n<p>It's clear. But what if I do not need to transfer data, but only need to wake up the waiting thread (if there is one) - can I, in this case, NOT use the mutex and use code like this?</p>\n\n<pre><code>void put_nolock () {\n\u00a0\u00a0m_CondVar.notify_one();\n}\n</code></pre>\n\n<p>It is quite not clear from documentation.In the documentation for <code>pthread_cond_signal</code> can see:</p>\n\n<blockquote>\n  <p>The pthread_cond_broadcast() or pthread_cond_signal() functions may be\n  called by a thread whether or not it currently owns the mutex that\n  threads calling pthread_cond_wait() or pthread_cond_timedwait() have\n  associated with the condition variable during their waits; however, if\n  predictable scheduling behavior is required, then that mutex shall be\n  locked by the thread calling pthread_cond_broadcast() or\n  pthread_cond_signal().</p>\n</blockquote>\n\n<p>I can not realize - what exactly does this mean (\"however, if\npredictable scheduling behavior is required...\")?\nMy goal is micro-optimization, less mutexes, less potential context switching. So maybe it does not make sense at all and the cost of using mutex + cond_var is equal the cost of using just cond_var?</p>\n\n<p>2) what is the cost of <code>m_CondVar.notify_one()</code>? Will it be a regular syscall? Does it depends on whether there are waiting threads or that cond_var or not?</p>\n\n<p>3) maybe you know more lightweight way to notify (without or with sending a message, it does not matter) one thread from another?</p>\n"}, {"tags": ["c++", "lambda", "scoping"], "answers": [{"tags": [], "owner": {"reputation": 35327, "user_id": 27678, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/7496124d499d578df1e3a6ff85e7ae03?s=128&d=identicon&r=PG", "display_name": "AndyG", "link": "https://stackoverflow.com/users/27678/andyg"}, "is_accepted": true, "score": 4, "last_activity_date": 1547676560, "last_edit_date": 1547676560, "creation_date": 1547674485, "answer_id": 54225749, "question_id": 54225609, "link": "https://stackoverflow.com/questions/54225609/will-lambda-run-out-of-scope-if-returned/54225749#54225749", "title": "Will lambda run out of scope if returned", "body": "<blockquote>\n  <p>Will I run into scoping issue?</p>\n</blockquote>\n\n<p>Yes.</p>\n\n<p>Your lambda captures <code>color</code> by reference, and after <code>getHouse</code> returns, the stack unwinds, and further accesses to <code>color</code> are undefined behavior.</p>\n\n<p>You should capture <code>color</code> by value to avoid such an issue.</p>\n\n<pre><code>h.colorSelector = [color]() {\n  return color;\n}\n</code></pre>\n\n<p>If you need to refer to the same <code>color</code>, perhaps you want to allocate a <code>std::shared_ptr&lt;color&gt;</code> somewhere, and capture a copy of that instead.</p>\n"}], "owner": {"reputation": 2820, "user_id": 1804543, "user_type": "registered", "accept_rate": 49, "profile_image": "https://i.stack.imgur.com/u2EW6.jpg?s=128&g=1", "display_name": "WhatABeautifulWorld", "link": "https://stackoverflow.com/users/1804543/whatabeautifulworld"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 54225749, "answer_count": 1, "score": 1, "last_activity_date": 1547676560, "creation_date": 1547673847, "question_id": 54225609, "link": "https://stackoverflow.com/questions/54225609/will-lambda-run-out-of-scope-if-returned", "title": "Will lambda run out of scope if returned", "body": "<p>I have a struct which takes a function or callable object as input:</p>\n\n<pre><code>struct House {\n  std::function&lt;int()&gt; colorSelector;\n}\n</code></pre>\n\n<p>Now I assign in this way:</p>\n\n<pre><code>House getHouse() {\n  House h;\n  int color = 10;\n  h.colorSelector = [&amp;]() {\n    return color;\n  }\n  return h;\n}\n</code></pre>\n\n<p>Will I run into scoping issue? As after getHouse returns, color (local variable) will be destroyed?</p>\n"}, {"tags": ["c++", "winapi", "visual-c++"], "comments": [{"owner": {"reputation": 14021, "user_id": 7571258, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/fBP6e.png?s=128&g=1", "display_name": "zett42", "link": "https://stackoverflow.com/users/7571258/zett42"}, "edited": false, "score": 2, "creation_date": 1547674829, "post_id": 54225538, "comment_id": 95277490, "body": "Also it is recommended to handle <code>WM_CONTEXTMENU</code> instead of mouse click. After all, the context menu could be opened by other means than a mouse click, e. g. via keyboard shortcut. See remarks section of <a href=\"https://docs.microsoft.com/en-us/windows/desktop/api/shellapi/nf-shellapi-shell_notifyiconw\" rel=\"nofollow noreferrer\">docs.microsoft.com/en-us/windows/desktop/api/shellapi/&hellip;</a>"}, {"owner": {"reputation": 531, "user_id": 7068954, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TkLYk.gif?s=128&g=1", "display_name": "NoSkill", "link": "https://stackoverflow.com/users/7068954/noskill"}, "reply_to_user": {"reputation": 14021, "user_id": 7571258, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/fBP6e.png?s=128&g=1", "display_name": "zett42", "link": "https://stackoverflow.com/users/7571258/zett42"}, "edited": false, "score": 0, "creation_date": 1547675304, "post_id": 54225538, "comment_id": 95277695, "body": "Thanks for answers I&#39;ll try to follow your recommendations ;)"}], "owner": {"reputation": 531, "user_id": 7068954, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TkLYk.gif?s=128&g=1", "display_name": "NoSkill", "link": "https://stackoverflow.com/users/7068954/noskill"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 191, "favorite_count": 0, "closed_date": 1547730593, "answer_count": 0, "score": 0, "last_activity_date": 1547673537, "creation_date": 1547673537, "question_id": 54225538, "link": "https://stackoverflow.com/questions/54225538/shell-notifyicon-tray-icon-show-both-popup-menu-and-taskbar-menu", "closed_reason": "Duplicate", "title": "Shell_NotifyIcon: Tray icon show both - popup menu and taskbar menu", "body": "<p>I have created tray icon that displays pop-menu on mouse right click:</p>\n\n<pre><code>NOTIFYICONDATA nid;\nnid.cbSize = sizeof(NOTIFYICONDATA); \nnid.hWnd = (HWND) hWnd;   \nnid.uID = 12345;\nnid.uFlags = NIF_ICON | NIF_MESSAGE;\nnid.hIcon = LoadIcon(hInstance, (LPCTSTR)IDI_TRAY_ICON);\nnid.uCallbackMessage = WM_USER_SHELLICON; \nShell_NotifyIcon(NIM_ADD, &amp;nid);\n</code></pre>\n\n<p>hWnd - is main window and it is hidden. There WndProc is look like:</p>\n\n<pre><code>LRESULT CALLBACK WndProc(HWND hWnd, UINT Message, WPARAM wParam, LPARAM lParam)\n{\n  switch (Message) \n  {\n    case WM_USER_SHELLICON: \n    {\n      switch(LOWORD(lParam)) \n      {   \n        case WM_RBUTTONDOWN: \n        {\n          HMENU hPopupsMenu = LoadMenu(hInstance, MAKEINTRESOURCE(IDC_POPUPS));\n          if (hPopupsMenu)\n          {\n            HMENU hTrayPopupMenu = GetSubMenu(hPopupsMenu, 0);\n            if (hTrayPopupMenu) \n            {\n              POINT lpClickPoint; \n              GetCursorPos(&amp;lpClickPoint);         \n              SetForegroundWindow(hWnd);\n              TrackPopupMenu(hTrayPopupMenu, TPM_LEFTALIGN | TPM_LEFTBUTTON | TPM_BOTTOMALIGN, lpClickPoint.x, lpClickPoint.y, 0, hWnd, NULL);\n            }\n            DestroyMenu(hPopupsMenu);\n          }\n        } \n        break;\n      }\n      break;\n    }\n...\n</code></pre>\n\n<p>When I right click to tray icon it shows my popup-menu. The problem is that default TaskBar context-menu is shown too. How to fix it?</p>\n"}, {"tags": ["c++", "c++11", "dictionary", "vector"], "comments": [{"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 1, "creation_date": 1547673574, "post_id": 54225520, "comment_id": 95276923, "body": "Your <code>empty_</code> is an elegant way of doing this. Could make it static for good measure."}, {"owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "edited": false, "score": 0, "creation_date": 1547673609, "post_id": 54225520, "comment_id": 95276940, "body": "Return a pointer, which could be <code>nullptr</code>."}, {"owner": {"reputation": 768, "user_id": 496553, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/ugRds.jpg?s=128&g=1", "display_name": "RedFox", "link": "https://stackoverflow.com/users/496553/redfox"}, "reply_to_user": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "edited": false, "score": 0, "creation_date": 1547674873, "post_id": 54225520, "comment_id": 95277511, "body": "@john nullptr doesn&#39;t work. fails to compile."}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "edited": false, "score": 1, "creation_date": 1547675207, "post_id": 54225520, "comment_id": 95277651, "body": "@RedFox pay attention to the first sentence."}, {"owner": {"reputation": 3504, "user_id": 224982, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e7b4b96492f8648f4e9372a9f3db752f?s=128&d=identicon&r=PG", "display_name": "ilya1725", "link": "https://stackoverflow.com/users/224982/ilya1725"}, "edited": false, "score": 0, "creation_date": 1547678565, "post_id": 54225520, "comment_id": 95279003, "body": "The warning is correct - you return a reference to local variable tat will cease to exist after the function call. Your local <code>empty_</code> is a decent solution. The function can also throw an exception or return a pointer instead of a reference (failure to compile is not a blocker)"}], "answers": [{"comments": [{"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1547673776, "post_id": 54225561, "comment_id": 95277028, "body": "static function-scope variables bear (a minuscule) performance hit. Class level static doesn&#39;t have this drawback."}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "reply_to_user": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1547673817, "post_id": 54225561, "comment_id": 95277049, "body": "@SergeyA but class level static suffers from static initialisation order fiasco."}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1547673847, "post_id": 54225561, "comment_id": 95277065, "body": "Not in this case."}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "reply_to_user": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1547673927, "post_id": 54225561, "comment_id": 95277099, "body": "@SergeyA why not?"}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1547674012, "post_id": 54225561, "comment_id": 95277138, "body": "Ok, I should rephrase it - not with the code provided."}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "reply_to_user": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1547674173, "post_id": 54225561, "comment_id": 95277223, "body": "@SergeyA well, the code provided does nothing since <code>GeVector</code> is never called. But it is just an example. If <code>GeVector</code> is called from initialisation of a static object defined in another TU than where the suggested static member is defined, the order of initialisation will be unspecified. Not a problem with a local static."}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1547674359, "post_id": 54225561, "comment_id": 95277282, "body": "Like I said - than you have performance hit. Best solution is to actually use initialization guard, like <code>std::cout</code> uses. That would be supposedly overkill here."}], "tags": [], "owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "is_accepted": false, "score": 6, "last_activity_date": 1547673748, "last_edit_date": 1547673748, "creation_date": 1547673640, "answer_id": 54225561, "question_id": 54225520, "link": "https://stackoverflow.com/questions/54225520/return-empty-vector-by-reference/54225561#54225561", "title": "return empty vector by reference", "body": "<p>You could use a static variable:</p>\n\n<pre><code>static const std::vector&lt;ClassA&gt; empty;\nreturn empty;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 689, "user_id": 9185797, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HJqOX.jpg?s=128&g=1", "display_name": "Phins", "link": "https://stackoverflow.com/users/9185797/phins"}, "is_accepted": false, "score": 3, "last_activity_date": 1547674179, "last_edit_date": 1547674179, "creation_date": 1547673939, "answer_id": 54225619, "question_id": 54225520, "link": "https://stackoverflow.com/questions/54225520/return-empty-vector-by-reference/54225619#54225619", "title": "return empty vector by reference", "body": "<p>If your method support the option of failure you could throw a exception instead of returning an empty vector.</p>\n\n<pre><code>const std::vector&lt;ClassA&gt;&amp; GeVector(const std::string&amp; class_id) {\n    auto iter = class_map_.find(class_id);\n    if (iter != class_map_.end())\n       return iter-&gt;second;\n\n    throw std::exception(\"Element not found\"); // or similar\n}\n</code></pre>\n"}], "owner": {"reputation": 768, "user_id": 496553, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/ugRds.jpg?s=128&g=1", "display_name": "RedFox", "link": "https://stackoverflow.com/users/496553/redfox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1405, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1547674179, "creation_date": 1547673488, "question_id": 54225520, "link": "https://stackoverflow.com/questions/54225520/return-empty-vector-by-reference", "title": "return empty vector by reference", "body": "<p>I'm returning a vector by reference as shown below and it is getting bit ugly when I want to return an empty vector when there is no item in the map. The following gives warning (<code>returning address of local variable</code>) and to fix it, I have another private member variable <code>vector&lt;ClassA&gt; empty_</code> and I could return it to avoid this.</p>\n\n<p>I am wondering if there is elegant way to implement this. </p>\n\n<pre><code>const std::vector&lt;ClassA&gt;&amp; GeVector(const std::string&amp; class_id) {\nauto iter = class_map_.find(class_id);\nif (iter != class_map_.end())\n    return iter-&gt;second;\nreturn {}; // return empty_;\n}\n\nprivate:\nstd::unordered_map&lt;std::string, std::vector&lt;ClassA&gt;&gt; class_map_;\nvector&lt;ClassA&gt; empty_;\n</code></pre>\n"}, {"tags": ["c++", "eigen", "xilinx", "eigen3"], "comments": [{"owner": {"reputation": 866, "user_id": 7607594, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-OyzH_J0Nigs/AAAAAAAAAAI/AAAAAAAAAFg/tWm2BVaSBwY/photo.jpg?sz=128", "display_name": "Jorge Omar Medra", "link": "https://stackoverflow.com/users/7607594/jorge-omar-medra"}, "edited": false, "score": 0, "creation_date": 1547673668, "post_id": 54225455, "comment_id": 95276974, "body": "Have you added the directory, which has the <code>split_test_helper.h</code>, file as a compiler&#39;s directive (-I[include dir])? Check this answer: <a href=\"https://stackoverflow.com/questions/15478005/how-to-tell-g-compiler-where-to-search-for-include-files\" title=\"how to tell g compiler where to search for include files\">stackoverflow.com/questions/15478005/&hellip;</a>"}, {"owner": {"reputation": 25324, "user_id": 1641621, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/h50hY.png?s=128&g=1", "display_name": "ggael", "link": "https://stackoverflow.com/users/1641621/ggael"}, "edited": false, "score": 1, "creation_date": 1547674588, "post_id": 54225455, "comment_id": 95277381, "body": "Eigen is header only, and does not require any configuration step, so all you have to do is tell where to find Eigen&#39;s header. The file <code>split_test_helper.h</code> is only referenced by the unit tests. Those are completely unrelated to your project. Here I see it tries to compile the BVH unit test... this does not make any sense. Please review your project setup."}, {"owner": {"reputation": 999, "user_id": 4051748, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3d012d2cf5c02a4b9de7ef6c5fb6f3d8?s=128&d=identicon&r=PG", "display_name": "Mochan", "link": "https://stackoverflow.com/users/4051748/mochan"}, "edited": false, "score": 0, "creation_date": 1547687010, "post_id": 54225455, "comment_id": 95281074, "body": "Can you check the versions of cmake that you are using in Linux vs Xilinx? The script that generates the split_test_helper.h is at <a href=\"https://bitbucket.org/eigen/eigen/src/f33ba4f6c409690b96cfe06fed367dc5292e9eb1/scripts/eigen_gen_split_test_help.cmake\" rel=\"nofollow noreferrer\">bitbucket.org/eigen/eigen/src/&hellip;</a>. It seems to be just writing some basic stuff not related to the underlying OS and you can probably get away with copying the file from the other system."}], "owner": {"reputation": 1, "user_id": 10924658, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-2FJG1A5__9A/AAAAAAAAAAI/AAAAAAAAAF0/HeUVA5Ykt3c/photo.jpg?sz=128", "display_name": "ksever", "link": "https://stackoverflow.com/users/10924658/ksever"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 171, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1547673250, "creation_date": 1547673250, "question_id": 54225455, "link": "https://stackoverflow.com/questions/54225455/eigen-library-problem-split-test-helper-h-not-found", "title": "Eigen library problem: split_test_helper.h not found", "body": "<p>I am trying to compile my code that uses the Eigen library but I am having some difficulties. I have compiled and run my program in Visual Studio 2017 with no problems, but since I have to implement this code on some piece of hardware (namely Xilinx ZedBoard that runs Linux OS) I am trying to compile the same code in Xilinx SDK.</p>\n\n<p>When trying to do that I get this error: fatal error: \n    split_test_helper.h: No such file or directory\nI also get this error when building the project with Xilinx SDK -\n    make: ***[eigen-eigen-323c052e1731/unsupported/test/subdir.mk:275:eigen- \n    eigen-323c052e1731/unsupported/test/BVH.o] Error 1</p>\n\n<p>I am aware that split_test_helper.h file should be generated as it says in CMakeLists.txt but I guess it does not in the case of Xilinx SDK, but does in the case of compiling with Visual Studio.</p>\n\n<p>Any help is appreciated, thank you.</p>\n\n<p>Also I should maybe mention that I managed to compile and run the code from Linux terminal on a virtual box Linux OS from my computer using g++.</p>\n"}, {"tags": ["c++", "templates"], "comments": [{"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "edited": false, "score": 0, "creation_date": 1547672425, "post_id": 54225226, "comment_id": 95276402, "body": "Note that <code>_Up</code>, <code>_Ep</code> and <code>_Ptr</code> are reserved identifiers, so unless you came across that in an implementation of the standard library, the usage of the identifiers would have undefined behaviour."}, {"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 0, "creation_date": 1547672574, "post_id": 54225226, "comment_id": 95276461, "body": "Looks like you are diving into the Standard Library implementation. Before you use this code as a Shining Example to be imitated, note that only the Standard Library implementation <a href=\"https://stackoverflow.com/questions/228783/what-are-the-rules-about-using-an-underscore-in-a-c-identifier\">is allowed to use underscores  in particular ways</a>."}, {"owner": {"reputation": 2934, "user_id": 367316, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f09837eb8a4cfaac44c1e08b43f72091?s=128&d=identicon&r=PG", "display_name": "Konrad Eisele", "link": "https://stackoverflow.com/users/367316/konrad-eisele"}, "reply_to_user": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "edited": false, "score": 0, "creation_date": 1547672711, "post_id": 54225226, "comment_id": 95276514, "body": "@eerorika: Didnt know that. I&#39;m just browsing the unique_pointer code in /usr/include/c++/*."}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "edited": false, "score": 0, "creation_date": 1547672788, "post_id": 54225226, "comment_id": 95276554, "body": "@KonradEisele well, that would explain why they use identifiers that are reserved for that very purpose. Just remember not to imitate their usage of underscores."}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 1, "creation_date": 1547672857, "post_id": 54225226, "comment_id": 95276594, "body": "@KonradEisele I would sincerely discourage you from learning C++ by looking at STL implementation."}, {"owner": {"reputation": 2934, "user_id": 367316, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f09837eb8a4cfaac44c1e08b43f72091?s=128&d=identicon&r=PG", "display_name": "Konrad Eisele", "link": "https://stackoverflow.com/users/367316/konrad-eisele"}, "reply_to_user": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1547673925, "post_id": 54225226, "comment_id": 95277097, "body": "@SergeyA : There is a  reason though: I got irritated of the noise that is generated when using a std::unique_ptr with a std::map, which I asked here <a href=\"https://stackoverflow.com/questions/54223750/is-there-a-transparent-way-of-using-unique-ptr-in-std-containers\" title=\"is there a transparent way of using unique ptr in std containers\">stackoverflow.com/questions/54223750/&hellip;</a> . So I tried to figure out  weather I can derive from  std::unique_ptr that would allow me to skip the wrap/unwrap."}], "answers": [{"comments": [{"owner": {"reputation": 35327, "user_id": 27678, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/7496124d499d578df1e3a6ff85e7ae03?s=128&d=identicon&r=PG", "display_name": "AndyG", "link": "https://stackoverflow.com/users/27678/andyg"}, "edited": false, "score": 1, "creation_date": 1547672298, "post_id": 54225246, "comment_id": 95276338, "body": "Also, as an aside, the standard is currently undecided on whether that is well-formed, because <code>void*</code> is not a pointer to class type."}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "reply_to_user": {"reputation": 35327, "user_id": 27678, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/7496124d499d578df1e3a6ff85e7ae03?s=128&d=identicon&r=PG", "display_name": "AndyG", "link": "https://stackoverflow.com/users/27678/andyg"}, "edited": false, "score": 0, "creation_date": 1547672361, "post_id": 54225246, "comment_id": 95276371, "body": "@AndyG that is something I am not familiar with! Do you have some further reading advice?"}, {"owner": {"reputation": 2934, "user_id": 367316, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f09837eb8a4cfaac44c1e08b43f72091?s=128&d=identicon&r=PG", "display_name": "Konrad Eisele", "link": "https://stackoverflow.com/users/367316/konrad-eisele"}, "edited": false, "score": 0, "creation_date": 1547672469, "post_id": 54225246, "comment_id": 95276414, "body": "Thanks for the list to the list of books. Yes, I&#39; still learning... &quot;Effective Modern C++&quot;  I have actually."}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "reply_to_user": {"reputation": 35327, "user_id": 27678, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/7496124d499d578df1e3a6ff85e7ae03?s=128&d=identicon&r=PG", "display_name": "AndyG", "link": "https://stackoverflow.com/users/27678/andyg"}, "edited": false, "score": 0, "creation_date": 1547672797, "post_id": 54225246, "comment_id": 95276560, "body": "@AndyG, thanks for the link. Wasn&#39;t aware of this. But looks like this is how it is done anywhere despite this fact :D"}, {"owner": {"reputation": 35327, "user_id": 27678, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/7496124d499d578df1e3a6ff85e7ae03?s=128&d=identicon&r=PG", "display_name": "AndyG", "link": "https://stackoverflow.com/users/27678/andyg"}, "edited": false, "score": 1, "creation_date": 1547672892, "post_id": 54225246, "comment_id": 95276613, "body": "@SergeyA: Indeed it does. I used this pattern for a long time before discovering this fact. It&#39;s safe to use <code>typename std::enable_if&lt;condition, int&gt;::type = 0</code>"}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "reply_to_user": {"reputation": 35327, "user_id": 27678, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/7496124d499d578df1e3a6ff85e7ae03?s=128&d=identicon&r=PG", "display_name": "AndyG", "link": "https://stackoverflow.com/users/27678/andyg"}, "edited": false, "score": 1, "creation_date": 1547673527, "post_id": 54225246, "comment_id": 95276903, "body": "@AndyG I&#39;ve also switched and use <code>typename std::enable_if&lt;condition, bool&gt;::type = true</code>/<code>std::enable_if_t&lt;condition, bool&gt; = true</code>"}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "reply_to_user": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1547673660, "post_id": 54225246, "comment_id": 95276969, "body": "@NathanOliver We spoke about it a couple of days back, and I immediately remembered this conversation. However, you didn&#39;t tell me why, just said it feels more descriptive to you :)"}], "tags": [], "owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "is_accepted": true, "score": 6, "last_activity_date": 1547672384, "last_edit_date": 1547672384, "creation_date": 1547672166, "answer_id": 54225246, "question_id": 54225226, "link": "https://stackoverflow.com/questions/54225226/what-does-the-asterix-after-a-template-type-mean/54225246#54225246", "title": "What does the asterix &#39;*&#39; after a template type mean?", "body": "<p>Means the same thing that it would mean for any type - it is a pointer to a <code>type</code> defined inside <code>std::enable_if</code> specialized for true condition, which is by default <code>void</code> - yielding all familiar <code>void*</code>.</p>\n\n<p>On a completely different (and possibly ill-advised) note this is not the first time I see a question from you which touches on rather complicated topic (SFINAE is one), which demonstrates that some basic fundamentals are not there yet. I sincerely recommend reading a good C++ book - you can find curated list here: <a href=\"https://stackoverflow.com/questions/388242/the-definitive-c-book-guide-and-list\">The Definitive C++ Book Guide and List</a></p>\n"}], "owner": {"reputation": 2934, "user_id": 367316, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f09837eb8a4cfaac44c1e08b43f72091?s=128&d=identicon&r=PG", "display_name": "Konrad Eisele", "link": "https://stackoverflow.com/users/367316/konrad-eisele"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 1, "accepted_answer_id": 54225246, "answer_count": 1, "score": 0, "last_activity_date": 1547672384, "creation_date": 1547672079, "question_id": 54225226, "link": "https://stackoverflow.com/questions/54225226/what-does-the-asterix-after-a-template-type-mean", "title": "What does the asterix &#39;*&#39; after a template type mean?", "body": "<p>I came template code that uses <code>*</code> after a template type: </p>\n\n<pre><code>  ...\n  template &lt;typename _Up, typename _Ep, typename = void&gt;\n  struct _Ptr\n  {\n      using type = _Up*; \n  };\n  ...\n</code></pre>\n\n<p>another usage I saw</p>\n\n<pre><code>   ...\n   template &lt;typename T, typename \\\n   std::enable_if&lt;std::is_integral&lt;T&gt;::value,T&gt;::type* = nullptr&gt;\n   ...\n</code></pre>\n\n<p>Where is this construct described?</p>\n"}, {"tags": ["c++", "arrays", "turbo-c++"], "comments": [{"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 0, "creation_date": 1547671926, "post_id": 54225112, "comment_id": 95276196, "body": "Unrelated: Before you get too much further, giv <a href=\"https://stackoverflow.com/questions/44863062/why-doesnt-a-simple-hello-world-style-program-compile-with-turbo-c\">Why doesn&#39;t a simple \u201cHello World\u201d-style program compile with Turbo C++?</a> a read so that you have some awareness of the sorts of problems you will likely run into using Turbo C++."}, {"owner": {"reputation": 44802, "user_id": 2752075, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5oQlf.png?s=128&g=1", "display_name": "HolyBlackCat", "link": "https://stackoverflow.com/users/2752075/holyblackcat"}, "edited": false, "score": 4, "creation_date": 1547672005, "post_id": 54225112, "comment_id": 95276229, "body": "Obligatory reminder: Turbo C++ is horribly outdated, you should switch to a modern compiler..."}, {"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 1, "creation_date": 1547672045, "post_id": 54225112, "comment_id": 95276240, "body": "On the upside TurboC++ comes with the fantastic Turbo Debugger, a tool that will allow you to control the execution of your program and investigate its variables. This makes it much easier to see what the program is really doing (as opposed to what you want it to do). Note that the vast majority of modern toolchains also come with a debugger."}, {"owner": {"reputation": 2954, "user_id": 5508296, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/l6uTa.jpg?s=128&g=1", "display_name": "sjrowlinson", "link": "https://stackoverflow.com/users/5508296/sjrowlinson"}, "edited": false, "score": 0, "creation_date": 1547672093, "post_id": 54225112, "comment_id": 95276260, "body": "I won&#39;t give the full answer but you can achieve this with a single while (or do-while) loop where you accumulate a sum from both the beginning and end of your array - i.e. you don&#39;t need any <code>for</code> loops here, just think about what condition you need for your <code>while</code> loop."}, {"owner": {"reputation": 35327, "user_id": 27678, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/7496124d499d578df1e3a6ff85e7ae03?s=128&d=identicon&r=PG", "display_name": "AndyG", "link": "https://stackoverflow.com/users/27678/andyg"}, "edited": false, "score": 1, "creation_date": 1547672143, "post_id": 54225112, "comment_id": 95276278, "body": "This looks a little funky: <code>for(i=n;i&lt;5;n++)       j+=arr[i];</code>"}, {"owner": {"reputation": 17343, "user_id": 445976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c82b2b9bdcf1baaf4677238d59cf745f?s=128&d=identicon&r=PG", "display_name": "Blastfurnace", "link": "https://stackoverflow.com/users/445976/blastfurnace"}, "edited": false, "score": 0, "creation_date": 1547672260, "post_id": 54225112, "comment_id": 95276320, "body": "This is called an Equilibrium Index and there are lots of <a href=\"https://stackoverflow.com/questions/33375769/a-zero-indexed-array-given-an-equilibrium-index-of-this-array\">examples here on Stack Overflow</a> and at <a href=\"https://rosettacode.org/wiki/Equilibrium_index\" rel=\"nofollow noreferrer\">Rosetta Code</a>."}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1547673382, "post_id": 54225112, "comment_id": 95276838, "body": "FWIW, A modern approach would look like: <a href=\"http://coliru.stacked-crooked.com/a/542244cf4ecf27f7\" rel=\"nofollow noreferrer\">coliru.stacked-crooked.com/a/542244cf4ecf27f7</a>"}], "answers": [{"tags": [], "owner": {"reputation": 8852, "user_id": 1383240, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/41093f55db0d5feaa0012ed6b5c3ca5c?s=128&d=identicon&r=PG&f=1", "display_name": "NiVeR", "link": "https://stackoverflow.com/users/1383240/niver"}, "is_accepted": false, "score": 0, "last_activity_date": 1547672077, "creation_date": 1547672077, "answer_id": 54225224, "question_id": 54225112, "link": "https://stackoverflow.com/questions/54225112/how-to-find-an-element-in-array-such-that-sum-of-left-array-is-equal-to-sum-of-r/54225224#54225224", "title": "How to find an element in array such that sum of left array is equal to sum of right array", "body": "<p>I will give you some hints that should guide you to the solution:</p>\n\n<ol>\n<li>Calculate total sum in the array in one pass. Let's call it <em>totalSum</em>.</li>\n<li>Do a second pass and calculate the <em>partialSum</em>, until the position that you have processed (<strong>but not included</strong>). Say that this is <em>i</em>, with value <em>a[i]</em>. If <code>totalSum - partialSum - a[i] = partialSum</code>, then the position <em>i</em> is your answer, and <em>a[i]</em> is its value.</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 864, "user_id": 10913596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1cf12cce6499d0cf89a03500f0808ab?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/10913596/daniel"}, "is_accepted": true, "score": 0, "last_activity_date": 1547672861, "last_edit_date": 1547672861, "creation_date": 1547672246, "answer_id": 54225259, "question_id": 54225112, "link": "https://stackoverflow.com/questions/54225112/how-to-find-an-element-in-array-such-that-sum-of-left-array-is-equal-to-sum-of-r/54225259#54225259", "title": "How to find an element in array such that sum of left array is equal to sum of right array", "body": "<p>First off, you want to reset j, k every iteration with this method, if I understand correctly. </p>\n\n<p>Second, the second for loop increments n instead of i, for some reason.</p>\n\n<p>Third, you're also declaring arr2, not initializing it, and adding values in arr2 to k for some reason.</p>\n\n<p>You're including the median as well. Try n = 2. </p>\n\n<p>j = arr[2] + arr[3]+arr[4] = 2 + 5 + 0 = 7<br>\nk = arr[0] + arr[1] = 1 +  4 = 0 </p>\n\n<p>proposed changes to while loop (to maintain the same method): </p>\n\n<pre><code>while (n &lt;= 5) {\n    j = 0; k = 0;\n    for (i = n+1; i &lt; 5; i++) {\n        j+= arr[i];\n    }\n    for (i = 0; i &lt; n; i++) {\n        k+= arr[i]\n    }\n    if (k == j) {\n        cout &lt;&lt; \"\\n\" &lt;&lt; arr[n];\n        break; //you should end the for loop here\n    }\n    n++;\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1317, "user_id": 1258421, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/1Fyvd.jpg?s=128&g=1", "display_name": "jshah", "link": "https://stackoverflow.com/users/1258421/jshah"}, "is_accepted": false, "score": 0, "last_activity_date": 1547672308, "creation_date": 1547672308, "answer_id": 54225275, "question_id": 54225112, "link": "https://stackoverflow.com/questions/54225112/how-to-find-an-element-in-array-such-that-sum-of-left-array-is-equal-to-sum-of-r/54225275#54225275", "title": "How to find an element in array such that sum of left array is equal to sum of right array", "body": "<p>When you're summing the right side of the array, you're starting at the equilibrium element:</p>\n\n<p>let's assume <code>n = 2</code> and your input is <code>[1, 4, 2, 5, 0]</code></p>\n\n<pre><code>while(n&lt;=5) {\n  for(i=n;i&lt;5;n++)\n      j+=arr[i];   //sum of right side arr from n-th   element\n}\n</code></pre>\n\n<p>the summation of the right side of the array will start at <code>i = 2</code>, thus it will be <code>2 + 5 + 0</code> not <code>5 + 0</code>.</p>\n\n<p>A quick and easy way to debug problems like this is to print what each step is doing (in your case, what index it's picking to sum) so you can quickly diagnose if you're doing something you're not supposed to.</p>\n\n<p>Also, your current method isn't the most optimal approach but it's a good place to begin. I urge you to try a different approach after you get this solution to work.</p>\n"}], "owner": {"reputation": 3, "user_id": 10924334, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39d8fb632cd3c70f6f5195b2b7d5950d?s=128&d=identicon&r=PG&f=1", "display_name": "nkb", "link": "https://stackoverflow.com/users/10924334/nkb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 761, "favorite_count": 0, "accepted_answer_id": 54225259, "answer_count": 3, "score": -1, "last_activity_date": 1547673124, "creation_date": 1547671613, "last_edit_date": 1547673124, "question_id": 54225112, "link": "https://stackoverflow.com/questions/54225112/how-to-find-an-element-in-array-such-that-sum-of-left-array-is-equal-to-sum-of-r", "title": "How to find an element in array such that sum of left array is equal to sum of right array", "body": "<p>here is the input and output the code should generate:</p>\n\n<ul>\n<li>Input : <code>1 4 2 5 0</code></li>\n<li>Output : <code>2</code></li>\n</ul>\n\n<p>Explanation : If 2 is the partition, then: <code>1+ 4=5(LHS)</code> and <code>5+0=5(RHS)</code> should print <code>2</code>, but in my case I'm not getting the output.</p>\n\n<p>I tried my code with the logic that.. the n-th element would be present somewhere in between the array. So considering the sum of element of arr till n-th element will be LHS and from n-th element it would be till the end of the arr which is RHS. Also i added a while loop which increments the pointing element n. </p>\n\n<pre><code>#include &lt;iostream.h&gt;\n#include &lt;conio.h&gt;\nvoid main(){\n   int arr[5],arr2[5],i,j=0,k=0,n=1;\n   cout&lt;&lt;\"input_arr\\n\";\n   for(i=0;i&lt;5;i++)\n    cin&gt;&gt;arr[i];\n\n   while(n&lt;=5)\n{\n   for(i=n;i&lt;5;n++)\n      j+=arr[i];   //sum of right side arr from n-th   element\n   for(i=0;i&lt;n;i++)\n    k+=arr2[i];  //sum of left side arr till n-th element\n   if(k==j)\n    cout&lt;&lt;\"\\n\"&lt;&lt;arr[n];  // prints the equilbrium element\n   else\n         n++;\n}\n    getch();\n}\n</code></pre>\n"}, {"tags": ["c++", "vector", "time-complexity"], "comments": [{"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 4, "creation_date": 1547671196, "post_id": 54224982, "comment_id": 95275864, "body": "Sidenote: C++ doesn&#39;t allow defining a function inside another function."}, {"owner": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 2, "creation_date": 1547671279, "post_id": 54224982, "comment_id": 95275897, "body": "Have you tested/benchmearked both options? My guess would be that an optimizing compiler would generate the same code for both."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547671308, "post_id": 54224982, "comment_id": 95275909, "body": "Note in c++ the compiler can assume that any loop with no side effects will eventually terminate. Infinite loops can be optimized in surprising ways as they have undefined behavior. See <a href=\"https://stackoverflow.com/questions/3592557/optimizing-away-a-while1-in-c0x\">this question</a>."}, {"owner": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "reply_to_user": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 0, "creation_date": 1547671317, "post_id": 54224982, "comment_id": 95275915, "body": "@user4581301 but gcc does, as an extension (at least for C)."}, {"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 4, "creation_date": 1547671430, "post_id": 54224982, "comment_id": 95275954, "body": "The fools. They&#39;ll probably allow Variable Length Arrays next."}, {"owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "edited": false, "score": 0, "creation_date": 1547671594, "post_id": 54224982, "comment_id": 95276036, "body": "There&#39;s no answer to this question as there are too many variables. The answer with one compiler might not be the same as the answer with another compiler. The only thing you can do is try both methods and time it."}, {"owner": {"reputation": 35327, "user_id": 27678, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/7496124d499d578df1e3a6ff85e7ae03?s=128&d=identicon&r=PG", "display_name": "AndyG", "link": "https://stackoverflow.com/users/27678/andyg"}, "edited": false, "score": 3, "creation_date": 1547671781, "post_id": 54224982, "comment_id": 95276119, "body": "These two examples actually do different things."}, {"owner": {"reputation": 4732, "user_id": 8477999, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f8172e1919af53269de92316dcf03a03?s=128&d=identicon&r=PG&f=1", "display_name": "Gem Taylor", "link": "https://stackoverflow.com/users/8477999/gem-taylor"}, "edited": false, "score": 1, "creation_date": 1547671818, "post_id": 54224982, "comment_id": 95276142, "body": "It is not clear what you are actually doing, but in a perfect world, redeclaring and sizing the vector should have some extra overhead, On the other hand, resizing it to zero and using push_back would not."}, {"owner": {"reputation": 9311, "user_id": 4944425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05592a58619d128e2eee1c3c17801e76?s=128&d=identicon&r=PG&f=1", "display_name": "Bob__", "link": "https://stackoverflow.com/users/4944425/bob"}, "edited": false, "score": 4, "creation_date": 1547674571, "post_id": 54224982, "comment_id": 95277371, "body": "<code>for ( int i = 0; i &lt; my_vec.size(); i++) { my_vec.push_back(i); }</code> Is unlikely what you want to do."}, {"owner": {"reputation": 247, "user_id": 4796617, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZHDn1.jpg?s=128&g=1", "display_name": "Akshay Kumar", "link": "https://stackoverflow.com/users/4796617/akshay-kumar"}, "reply_to_user": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 0, "creation_date": 1547675957, "post_id": 54224982, "comment_id": 95277955, "body": "@user4581301 - yes, the snippet didn&#39;t convey the problem correctly. Made appropriate changes."}, {"owner": {"reputation": 9551, "user_id": 9837301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9414V.png?s=128&g=1", "display_name": "JaMiT", "link": "https://stackoverflow.com/users/9837301/jamit"}, "edited": false, "score": 0, "creation_date": 1547717691, "post_id": 54224982, "comment_id": 95290524, "body": "Example A still contains an infinite loop (see Bob__&#39;s comment). Since Example B eventually terminates, it easily comes in as less computationally expensive. But you probably meant to ask a different question."}, {"owner": {"reputation": 247, "user_id": 4796617, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZHDn1.jpg?s=128&g=1", "display_name": "Akshay Kumar", "link": "https://stackoverflow.com/users/4796617/akshay-kumar"}, "reply_to_user": {"reputation": 9551, "user_id": 9837301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9414V.png?s=128&g=1", "display_name": "JaMiT", "link": "https://stackoverflow.com/users/9837301/jamit"}, "edited": false, "score": 0, "creation_date": 1547836679, "post_id": 54224982, "comment_id": 95343473, "body": "@JaMiT - Both loops run on conditions, may or may not be infinite."}, {"owner": {"reputation": 9551, "user_id": 9837301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9414V.png?s=128&g=1", "display_name": "JaMiT", "link": "https://stackoverflow.com/users/9837301/jamit"}, "edited": false, "score": 0, "creation_date": 1547849452, "post_id": 54224982, "comment_id": 95348251, "body": "@AkshayKumar Saying &quot;both&quot; implies only two loops, but there are <i>four</i> loops in your examples. Two of these (the <code>while</code> loops) have an abstract &quot;condition&quot;. A third loop (Example B&#39;s <code>for</code>) will iterate 5 times. The fourth loop (Example A&#39;s <code>for</code> -- the one Bob__ commented on) is infinite. If you don&#39;t believe us, try running your code yourself."}, {"owner": {"reputation": 9551, "user_id": 9837301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9414V.png?s=128&g=1", "display_name": "JaMiT", "link": "https://stackoverflow.com/users/9837301/jamit"}, "edited": false, "score": 0, "creation_date": 1548623586, "post_id": 54224982, "comment_id": 95597560, "body": "I also meant to mention that Example B does not match the claim &quot;overwrite old values in each iteration&quot;. It does overwrite values, but only the initial value (0.0); the assigned values are destroyed at the end of each iteration of the <code>while</code> loop. Are you sure the question you wrote is the question you meant to ask?"}], "answers": [{"tags": [], "owner": {"reputation": 9551, "user_id": 9837301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9414V.png?s=128&g=1", "display_name": "JaMiT", "link": "https://stackoverflow.com/users/9837301/jamit"}, "is_accepted": false, "score": 1, "last_activity_date": 1548939792, "creation_date": 1548939792, "answer_id": 54461269, "question_id": 54224982, "link": "https://stackoverflow.com/questions/54224982/vector-re-declaration-versus-insertions-in-looping-operations-c/54461269#54461269", "title": "Vector re-declaration versus insertions in looping operations - C++", "body": "<p>I still suspect that the question that was asked is not the question that was intended, but it occurred to me that the main point of my answer would likely not change. If the question gets updated, I can always edit this answer to match (or delete it, if it turns out to be inapplicable).</p>\n\n<h1>De-prioritize optimizations</h1>\n\n<p>There are various factors that should affect how you write your code. Among the desirable goals are space optimization, time optimization, data encapsulation, logic encapsulation, readability, robustness, and correct functionality. Ideally, all of these goals would be achievable in every piece of code, but that is not particularly realistic. Much more likely is a situation where one or more of these goals must be sacrificed in favor of the others. <strong>When that happens, optimizations should typically yield to everything else.</strong></p>\n\n<p>That is not to say that optimizations should be ignored. There are plenty of optimizations that rarely obstruct the higher-priority goals. These range from the small, such as passing by const reference instead of by value, to the large, such as choosing the logarithmic algorithm instead of the exponential one. However, the optimizations that do interfere with the other goals should be postponed until after your code is reasonably complete and functioning correctly. At that point, a profiler should be used to determine where the bottlenecks actually are. Those bottlenecks are the only places where other goals should yield to optimizations, and only if the profiler confirms that the optimizations achieved their goals.</p>\n\n<p><strong>For the question being asked,</strong> this means that the main concern should not be computational expense, but encapsulation. Why should the caller of <code>func()</code> need to allocate space for <code>func()</code> to work with? It should not, unless a profiler identified this as a performance bottleneck. And if a profiler did that, it would be much easier (and more reliable!) to ask the profiler if the change helps than to ask Stack Overflow.</p>\n\n<h2>Why?</h2>\n\n<p>I can think of two major reasons to de-prioritize optimizations. First, the \"sniff test\" is unreliable. While there might be a few people who can identify bottlenecks by looking at code, there are many, many more who merely think they can. Second, that's why we have optimizing compilers. It is not unheard of for someone to come up with this super-clever optimization trick only to discover that the compiler was already doing it. Keep your code clean and let the compiler handle the routine optimizations. Only step in when the task demonstrably exceeds the compiler's capabilities.</p>\n\n<p><em>See also: <a href=\"/questions/tagged/premature-optimization\" class=\"post-tag\" title=\"show questions tagged &#39;premature-optimization&#39;\" rel=\"tag\">premature-optimization</a></em></p>\n\n<h1>Choosing an optimization</h1>\n\n<p>OK, suppose the profiler did identify construction of this small, 10-element array as a bottleneck. The next step is to test an alternative, right? Almost. First you need an alternative, and I would consider a review of the theoretical benefits of various alternatives to be useful. Just keep in mind that this is theoretical and that the profiler gets the final say. So I'll go into the pros and cons of the alternatives from the question, as well as some other alternatives that might bear consideration. Let's start from the worst options, working our way to the better ones.</p>\n\n<h3>Example A</h3>\n\n<p>In Example A, a vector is created with 5 elements, then elements are pushed onto the vector until <code>i</code> meets or exceeds the vector's size. Seeing how <code>i</code> and the vector's size are both increased by one each iteration (and <code>i</code> starts smaller than the size), this loop will run until the vector grows large enough to crash the program. That means probably billions of iterations (despite the question's claim that the size will not exceed 10).</p>\n\n<p>Easily the most computationally expensive option. Don't do this.</p>\n\n<h3>Example B</h3>\n\n<p>In example B, a vector is created for each iteration of the outer <code>while</code> loop, which is then accessed by reference from within <code>func()</code>. The performance cons here include passing a parameter to <code>func()</code> and having <code>func()</code> access the vector indirectly through a reference. There are no performance pros as this does everything the baseline <em>(see below)</em> would do, plus some extra steps.</p>\n\n<p>Even though a compiler might be able to compensate for the cons, I see no reason to try this approach.</p>\n\n<h3>Baseline</h3>\n\n<p>The baseline I'm using is a fix to Example A's infinite loop. Specifically, replace \"<code>my_vec.push_back(i);</code>\" with Example B's \"<code>my_vec[i] = i;</code>\". This simple approach is along the lines of what I would expect for the initial assessment by the profiler. If you cannot beat simple, stick with it.</p>\n\n<h3>Example B*</h3>\n\n<p>The text of the question presents an inaccurate assessment of Example B. Interestingly, the assessment describes an approach that has the potential to improve on the baseline. To get code that matches the textual description, move Example B's \"<code>std::vector&lt;double&gt; my_vec(5, 0.0);</code>\" to the line immediately before the <code>while</code> statement. This has the effect of constructing the vector only once, rather than constructing it with each iteration.</p>\n\n<p>The cons of this approach are the same as those of Example B as originally coded. However, we now pick up a gain in that the vector's constructor is called only once. If construction is more expensive than the indirection costs, the result should be a net improvement once the <code>while</code> loop iterates often enough. (Beware these conditions: that's a significant \"if\" and there is no a priori guess as to how many iterations is \"enough\".) It would be reasonable to try this and see what the profiler says.</p>\n\n<h3>Get some static</h3>\n\n<p>A variant on Example B* that helps preserve encapsulation is to use the baseline (the fixed Example A), but precede the declaration of the vector with the keyword <code>static</code>. This brings in the benefit of constructing the vector only once, but without the overhead associated with making the vector a parameter. In fact, the benefit could be greater than in Example B* since construction happens only once per program execution, rather than each time the <code>while</code> loop is started. The more times the <code>while</code> loop is started, the greater this benefit.</p>\n\n<p>The main con here is that the vector will occupy memory throughout the program's execution. Unlike Example B*, it will not release its memory when the block containing the <code>while</code> loop ends. Using this approach in too many places would lead to memory bloat. So while it is reasonable to profile this approach, you might want to consider other options. (Of course if the profiler calls this out as <em>the</em> bottleneck, dwarfing all others, the cost is small enough to pay.)</p>\n\n<h3>Fix the size</h3>\n\n<p>My personal choice for what optimization to try here would be to start from the baseline and switch the vector to <code>std::array&lt;10,double&gt;</code>. My main motivation is that the needed size won't be more than 10. Also relevant is that the construction of a <code>double</code> is trivial. Construction of the array should be on par with declaring 10 variables of type <code>double</code>, which I would expect to be negligible. So no need for fancy optimization tricks. Just let the compiler do its thing.</p>\n\n<p>The expected possible benefit of this approach is that a <code>vector</code> allocates space on the heap for its storage, which has an overhead cost. The local <code>array</code> would not have this cost. However, this is only a possible benefit. A vector implementation might already take advantage of this performance consideration for small vectors. (Maybe it does not use the heap until the capacity needs to exceed some magic number, perhaps more than 10.) I would refer you back to earlier when I mentioned \"super-clever\" and \"compiler was already doing it\".</p>\n\n<p>I'd run this through the profiler. If there's no benefit, there is likely no benefit from the other approaches. Give them a try, sure, since they're easy enough, but it would probably be a better use of your time to look at other aspects to optimize.</p>\n"}], "owner": {"reputation": 247, "user_id": 4796617, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZHDn1.jpg?s=128&g=1", "display_name": "Akshay Kumar", "link": "https://stackoverflow.com/users/4796617/akshay-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1548939792, "creation_date": 1547671025, "last_edit_date": 1547675648, "question_id": 54224982, "link": "https://stackoverflow.com/questions/54224982/vector-re-declaration-versus-insertions-in-looping-operations-c", "title": "Vector re-declaration versus insertions in looping operations - C++", "body": "<p>I have an option to either create and destroy a vector on every call to <code>func()</code> and push elements in each iteration, as shown in Example A OR fixed the initialization and only overwrite old values in each iteration, as shown in Example B.</p>\n\n<p>Example A:</p>\n\n<pre><code>void func () \n{\n    std::vector&lt;double&gt; my_vec(5, 0.0);\n    for ( int i = 0; i &lt; my_vec.size(); i++) {\n        my_vec.push_back(i);\n        // do something\n    }\n}\n\nwhile (condition) {\n    func();\n}\n</code></pre>\n\n<p>Example B:</p>\n\n<pre><code>void func (std::vector&lt;double&gt;&amp; my_vec) \n{\n    for ( int i = 0; i &lt; my_vec.size(); i++) {\n        my_vec[i] = i;\n        // do something\n    }\n}\n\nwhile (condition) {\n    std::vector&lt;double&gt; my_vec(5, 0.0);\n    func(myVec);\n}\n</code></pre>\n\n<p>Which of the two would be computationally inexpensive. The size of the array won't be more than 10.</p>\n"}, {"tags": ["python", "c++", "boost"], "comments": [{"owner": {"reputation": 155, "user_id": 2417774, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3e28fcff33afd3cfb2242c4ae49b72c?s=128&d=identicon&r=PG", "display_name": "llonesmiz", "link": "https://stackoverflow.com/users/2417774/llonesmiz"}, "edited": false, "score": 0, "creation_date": 1547713503, "post_id": 54224743, "comment_id": 95288233, "body": "<a href=\"https://wiki.python.org/moin/boost.python/Inheritance#Reflecting_C.2B-.2B-_Inheritance_Relationships\" rel=\"nofollow noreferrer\">wiki.python.org/moin/boost.python/&hellip;</a> seems relevant."}], "answers": [{"tags": [], "owner": {"reputation": 107, "user_id": 5281266, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe89ac43fa335a2b0ff5ba76f2925d64?s=128&d=identicon&r=PG&f=1", "display_name": "Keith Sloan", "link": "https://stackoverflow.com/users/5281266/keith-sloan"}, "is_accepted": false, "score": 1, "last_activity_date": 1547719410, "creation_date": 1547719410, "answer_id": 54233385, "question_id": 54224743, "link": "https://stackoverflow.com/questions/54224743/accessing-from-python-a-c-function-that-takes-a-pointer/54233385#54233385", "title": "Accessing from python a C++ function that takes a pointer", "body": "<p>Thanks for reference was able to resolve by adding bases to definition</p>\n\n<pre><code> class_&lt;G4VFacet, G4VFacet*, boost::noncopyable&gt;\n    (\"G4VFacet\", \"solid class\", no_init)\n    // ---\n    .def(\"SetVertex\",      &amp;G4TriangularFacet::SetVertex)\n\n    // operators\n    .def(self == self)\n    ;\n\n class_&lt;G4TriangularFacet, bases&lt;G4VFacet&gt; , boost::noncopyable&gt;\n   (\"G4TriangularFacet\", \"solid class\")\n   // ---\n   .def(\"SetVertex\",      &amp;G4TriangularFacet::SetVertex)\n\n   // operators\n   .def(self == self)\n   ;\n</code></pre>\n"}], "owner": {"reputation": 107, "user_id": 5281266, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe89ac43fa335a2b0ff5ba76f2925d64?s=128&d=identicon&r=PG&f=1", "display_name": "Keith Sloan", "link": "https://stackoverflow.com/users/5281266/keith-sloan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1547719410, "creation_date": 1547669978, "question_id": 54224743, "link": "https://stackoverflow.com/questions/54224743/accessing-from-python-a-c-function-that-takes-a-pointer", "title": "Accessing from python a C++ function that takes a pointer", "body": "<p>I am trying to use a function that requires a pointer to a class.</p>\n\n<p>I get the following error</p>\n\n<pre><code>&lt;class 'Boost.Python.ArgumentError'&gt;: Python argument types in\n    G4TessellatedSolid.AddFacet(G4TessellatedSolid, G4TriangularFacet)\ndid not match C++ signature:\n    AddFacet(G4TessellatedSolid {lvalue}, G4VFacet*)\n</code></pre>\n\n<p>G4TesselledSolid has a function\n     G4bool     AddFacet (G4VFacet *aFacet)</p>\n\n<p>G4TriansularFacet class definition has\n     class G4TriangularFacet : public G4VFacet</p>\n\n<p>My Boost class definition looks like</p>\n\n<pre><code>class_&lt;G4TessellatedSolid, G4TessellatedSolid*, boost::noncopyable&gt;\n         (\"G4TessellatedSolid\", \"solid class\")\n // ---\n       .def(\"AddFacet\",       &amp;G4TessellatedSolid::AddFacet)\n // operators\n       .def(self == self)\n       ;\n</code></pre>\n\n<p>My Pythons looks like \n    tessellate = G4TessellatedSolid()\n    tessellate.AddFacet(face)</p>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 1, "creation_date": 1547670070, "post_id": 54224716, "comment_id": 95275358, "body": "That&#39;s because the size of a static array needs to be a known compile time constant. But your implementation seems to assume <code>len</code> is always 2 anyway, since you assign to <code>ests[0]</code> and <code>ests[1]</code> so I have a hard time understanding what you actually want to do."}, {"owner": {"reputation": 30076, "user_id": 1828637, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/46b5428a878306d5af0a87fc7b2db499?s=128&d=identicon&r=PG", "display_name": "Noitidart", "link": "https://stackoverflow.com/users/1828637/noitidart"}, "reply_to_user": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547670144, "post_id": 54224716, "comment_id": 95275384, "body": "@Fran&#231;oisAndrieux its a very simplified case. My case is bigger. Is it possible to create static array without compile time constant? Or is it possible to return array another way from that fucntion?"}, {"owner": {"reputation": 2238, "user_id": 3810510, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/65Qrj.jpg?s=128&g=1", "display_name": "Denis Sablukov", "link": "https://stackoverflow.com/users/3810510/denis-sablukov"}, "edited": false, "score": 0, "creation_date": 1547670259, "post_id": 54224716, "comment_id": 95275441, "body": "Consider using <code>std::vector</code>"}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547670267, "post_id": 54224716, "comment_id": 95275449, "body": "You will necessarily need to know at compile time the size of the array, or at least deduce it at compile time. It cannot depend on user input. <code>constexpr</code> and templates will let you do sophisticated calculations are compile time. But if you need it to depend on user input you will need to use another approach, maybe just returning an <code>std::vector&lt;double&gt;</code>."}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 0, "creation_date": 1547671875, "post_id": 54224716, "comment_id": 95276168, "body": "&quot;<i>Is it possible to create static array without compile time constant?</i>&quot; - NO. In order to create a fixed-length array, the compiler needs to know the exact array size to use. Hence a compile-time constant is required. Otherwise, you have to allocate the array dynamically at runtime, using <code>new[]</code> or <code>std::vector</code>"}], "answers": [{"comments": [{"owner": {"reputation": 30076, "user_id": 1828637, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/46b5428a878306d5af0a87fc7b2db499?s=128&d=identicon&r=PG", "display_name": "Noitidart", "link": "https://stackoverflow.com/users/1828637/noitidart"}, "edited": false, "score": 0, "creation_date": 1547670465, "post_id": 54224849, "comment_id": 95275535, "body": "May you please show how to use that in a function like above."}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "reply_to_user": {"reputation": 30076, "user_id": 1828637, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/46b5428a878306d5af0a87fc7b2db499?s=128&d=identicon&r=PG", "display_name": "Noitidart", "link": "https://stackoverflow.com/users/1828637/noitidart"}, "edited": false, "score": 1, "creation_date": 1547670546, "post_id": 54224849, "comment_id": 95275578, "body": "@Noitidart just replace the contents of your function with what I show. You can replace the <code>&#47;&#47; ...</code> with whatever you have between declaration of <code>ests</code> and <code>return</code>."}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "reply_to_user": {"reputation": 30076, "user_id": 1828637, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/46b5428a878306d5af0a87fc7b2db499?s=128&d=identicon&r=PG", "display_name": "Noitidart", "link": "https://stackoverflow.com/users/1828637/noitidart"}, "edited": false, "score": 1, "creation_date": 1547670966, "post_id": 54224849, "comment_id": 95275767, "body": "@Noitidart given the implementation that I show, it should be <code>double*</code>."}], "tags": [], "owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "is_accepted": true, "score": 2, "last_activity_date": 1547670486, "last_edit_date": 1547670486, "creation_date": 1547670361, "answer_id": 54224849, "question_id": 54224716, "link": "https://stackoverflow.com/questions/54224716/use-const-int-by-reference-to-create-static-array/54224849#54224849", "title": "Use const int by reference to create static array", "body": "<blockquote>\n  <p>Use const int by reference to create static array</p>\n</blockquote>\n\n<p>Is not possible. The length of all arrays which have non-dynamic storage must be a compile time constant.</p>\n\n<p>You can have a static vector:</p>\n\n<pre><code>assert(len &gt;= 2);\nstatic std::vector&lt;double&gt; ests(len);\n// ...\nreturn ests.data(); \n</code></pre>\n"}], "owner": {"reputation": 30076, "user_id": 1828637, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/46b5428a878306d5af0a87fc7b2db499?s=128&d=identicon&r=PG", "display_name": "Noitidart", "link": "https://stackoverflow.com/users/1828637/noitidart"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 54224849, "answer_count": 1, "score": 0, "last_activity_date": 1547670486, "creation_date": 1547669858, "question_id": 54224716, "link": "https://stackoverflow.com/questions/54224716/use-const-int-by-reference-to-create-static-array", "title": "Use const int by reference to create static array", "body": "<p>I am trying to cretate an array of doubles in <code>pi_sequence</code> and then return a pointer to it. Then I want to print out its values. I tried this but I get the error <code>storage size of ests is not constant</code>:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;stdlib.h&gt;\n\n\ndouble* pi_sequence(const int&amp; len)\n{\n  static double ests[len];\n  ests[0] = 1.11;\n  ests[1] = 2.22;\n  return ests; // address of?\n}\n\nint main() {\n\n  double* ests = pi_sequence();\n  std::cout &lt;&lt; \"will write to file: \" &lt;&lt; ests[0]  &lt;&lt; std::endl;\n\n}\n</code></pre>\n"}, {"tags": ["c++", "c++98"], "comments": [{"owner": {"reputation": 727, "user_id": 4866865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7789b80c26c3bc3f9d69580734c220b?s=128&d=identicon&r=PG&f=1", "display_name": "Gamification", "link": "https://stackoverflow.com/users/4866865/gamification"}, "edited": false, "score": 1, "creation_date": 1547670200, "post_id": 54224671, "comment_id": 95275412, "body": "std::shared_ptr or another smart pointer, depending on the situation. However, you tagged c++98 so I assume you&#39;re not using modern c++? Generally passing a pointer and deleting in the callee would be considered bad practice. One would rather expect obj to be deallocated in main, where it has been allocated. But actually, raw allocation should be avoided and only if it&#39;s absolutely neccessary be used encapsulated into classes; E.g. do (de-) allocations within Test and make sure everything is deallocated in the destructor or sooner."}, {"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 1, "creation_date": 1547670772, "post_id": 54224671, "comment_id": 95275689, "body": "You can&#39;t. You need to establish <a href=\"https://stackoverflow.com/questions/49024982/what-is-ownership-of-resources-or-pointers\">ownership</a> via rules and enforce those rules as best as you can."}, {"owner": {"reputation": 45, "user_id": 10530794, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-puQtA1JQ7jU/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbD4417Kindb5gjX1NTdBtnLZFqCtw/mo/photo.jpg?sz=128", "display_name": "Alex Gh", "link": "https://stackoverflow.com/users/10530794/alex-gh"}, "edited": false, "score": 0, "creation_date": 1547671010, "post_id": 54224671, "comment_id": 95275790, "body": "Thank you for clarifying the use of raw pointers. Indeed this is c++98 (so no smart pointers)."}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 0, "creation_date": 1547672004, "post_id": 54224671, "comment_id": 95276228, "body": "@Alex &quot;<i>this is c++98 (so no smart pointers)</i>&quot; - C++98 has the <code>std::auto_ptr</code> smart pointer. Or you can use smart pointers from the <a href=\"https://www.boost.org/\" rel=\"nofollow noreferrer\">Boost</a> library."}], "answers": [{"tags": [], "owner": {"reputation": 12749, "user_id": 7976805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92a559df8b4b287aad23724b4c66d67c?s=128&d=identicon&r=PG&f=1", "display_name": "Yksisarvinen", "link": "https://stackoverflow.com/users/7976805/yksisarvinen"}, "is_accepted": false, "score": 1, "last_activity_date": 1547670881, "last_edit_date": 1547670881, "creation_date": 1547670576, "answer_id": 54224888, "question_id": 54224671, "link": "https://stackoverflow.com/questions/54224671/how-to-tell-if-a-function-parameter-can-be-safely-deleted/54224888#54224888", "title": "How to tell if a function parameter can be safely deleted", "body": "<p>If you can move to C++11, you should use <a href=\"https://en.cppreference.com/w/cpp/memory/shared_ptr\" rel=\"nofollow noreferrer\"><code>std::shared_ptr</code></a> and your problem is solved. <code>shared_ptr</code> will take care about number of users of the pointer and will automatically clean it up when last user disposes it. And I strongly recommend transferring to modern C++, it solves great amount of problems.</p>\n\n<p>You can also take a look at <a href=\"https://www.boost.org/doc/libs/1_68_0/libs/smart_ptr/doc/html/smart_ptr.html\" rel=\"nofollow noreferrer\">Boost SmartPtr</a> - it does essentailly the same and can be used before C++11.</p>\n\n<p>You could also try to implement such utility on your own, but you have to make sure to implement it properly - with reference counter incrementing and decrementing correctly in the spirit of <a href=\"https://stackoverflow.com/questions/4172722/what-is-the-rule-of-three\">Rule of Three</a></p>\n\n<hr>\n\n<p>If you have to use raw pointers, then there's no way in standard C++ to guarantee that a pointer will (or will not) be deallocated by a function.<br>\nThe only way to inform other programmers that your function wants to take ownership of the pointer (and will delete it) is via <em>documentation</em>, either in-code (with comments), or with a separate document (if you create an API for example). </p>\n\n<p>However, you should strongly consider whether the function <strong>should</strong> take ownership of the pointer. Is it reasonable for function to own it? If not, just leave it and let allocating function take care of deallocation.</p>\n"}, {"comments": [{"owner": {"reputation": 45, "user_id": 10530794, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-puQtA1JQ7jU/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbD4417Kindb5gjX1NTdBtnLZFqCtw/mo/photo.jpg?sz=128", "display_name": "Alex Gh", "link": "https://stackoverflow.com/users/10530794/alex-gh"}, "edited": false, "score": 0, "creation_date": 1547718079, "post_id": 54225576, "comment_id": 95290742, "body": "Thank you, I was not aware how auto_ptr works in c++98. Is it used for something else in modern c++, or is it just deprecated and not to be used?"}, {"owner": {"reputation": 12749, "user_id": 7976805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92a559df8b4b287aad23724b4c66d67c?s=128&d=identicon&r=PG&f=1", "display_name": "Yksisarvinen", "link": "https://stackoverflow.com/users/7976805/yksisarvinen"}, "reply_to_user": {"reputation": 45, "user_id": 10530794, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-puQtA1JQ7jU/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbD4417Kindb5gjX1NTdBtnLZFqCtw/mo/photo.jpg?sz=128", "display_name": "Alex Gh", "link": "https://stackoverflow.com/users/10530794/alex-gh"}, "edited": false, "score": 0, "creation_date": 1547723420, "post_id": 54225576, "comment_id": 95293959, "body": "@AlexGh It&#39;s deprecated starting from C++11 and removed completely in C++17. <code>std::auto_ptr</code> is a little strange to use, and it cannot be used in standard containers for example. You can&#39;t store arrays with it either."}], "tags": [], "owner": {"reputation": 2179, "user_id": 5528355, "user_type": "registered", "profile_image": "https://graph.facebook.com/1252788474746853/picture?type=large", "display_name": "Yuri Nudelman", "link": "https://stackoverflow.com/users/5528355/yuri-nudelman"}, "is_accepted": true, "score": 0, "last_activity_date": 1547673718, "creation_date": 1547673718, "answer_id": 54225576, "question_id": 54224671, "link": "https://stackoverflow.com/questions/54224671/how-to-tell-if-a-function-parameter-can-be-safely-deleted/54225576#54225576", "title": "How to tell if a function parameter can be safely deleted", "body": "<p>Actually you can do this in C++ 98. No need for the new standard.\nYou do not place delete inside f. Instead just create the object you pass to f with auto_ptr guard:</p>\n\n<pre><code>Test *obj = new Test();\n\nf(auto_ptr&lt;Test&gt;(new Test()).get());\nf(obj);\n</code></pre>\n\n<p>Auto pointer will make sure the object is released after the function execution is over.</p>\n\n<p>Well, to be honest it is *almost the same. If you explicitly need to delete the pointer inside f and not just to guard it to make sure it is released then you really need smart pointer and not just auto_ptr, for this you have to either use boost or c++11 or just write it yourself, it is really not complicated to implement.</p>\n\n<p>Also pay attention that auto_ptr is deprecated in the new standard so this code is not forward compatible.</p>\n"}], "owner": {"reputation": 45, "user_id": 10530794, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-puQtA1JQ7jU/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbD4417Kindb5gjX1NTdBtnLZFqCtw/mo/photo.jpg?sz=128", "display_name": "Alex Gh", "link": "https://stackoverflow.com/users/10530794/alex-gh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 54225576, "answer_count": 2, "score": 0, "last_activity_date": 1547673718, "creation_date": 1547669677, "question_id": 54224671, "link": "https://stackoverflow.com/questions/54224671/how-to-tell-if-a-function-parameter-can-be-safely-deleted", "title": "How to tell if a function parameter can be safely deleted", "body": "<p>I want to know if there is any way to tell if a function can safely <strong>delete</strong> an object passed as a parameter.</p>\n\n<p>Code:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>struct Test {\n\n};\n\nvoid f(Test *ptr) {\n    delete ptr;   //if i delete the pointer here,\n                  //i cannot use obj in main\n}\n\nint main() {\n    Test *obj = new Test;\n\n    f(new Test);\n    f(obj);\n\n    //delete obj;   //obj has already been deleted in f()\n}\n\n</code></pre>\n\n<p>Is there any way to free the memory allocated by f(new Test), but keep the obj and still use it in main()?</p>\n"}, {"tags": ["c++", "raii"], "comments": [{"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 1, "creation_date": 1547669711, "post_id": 54224656, "comment_id": 95275163, "body": "<code>res(res)</code> will try to copy your non-copyable type. Try <code>res(std::move(res))</code>."}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 0, "creation_date": 1547672296, "post_id": 54224656, "comment_id": 95276337, "body": "<code>B(A res, Stuff stuff) : res(std::move(res)), stuff(stuff) {}</code>"}], "owner": {"reputation": 1955, "user_id": 1264768, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/94mm8.png?s=128&g=1", "display_name": "salbeira", "link": "https://stackoverflow.com/users/1264768/salbeira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 38, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1547669628, "creation_date": 1547669628, "question_id": 54224656, "link": "https://stackoverflow.com/questions/54224656/passing-around-resource-wrapper-objects", "title": "Passing around resource wrapper objects", "body": "<p>Consider I have a class wrapping a resource:</p>\n\n<pre><code>class A {\npublic:\n     A(Data data) : handle(aquire_resource(data)) {}\n     A(A &amp;&amp;temp) : handle(temp.handle) { temp.handle = 0; }\n    ~A() { lib_destroy(handle); }\n\n    A &amp;operator=(A &amp;&amp;temp);\nprivate:\n    int handle;\n};\n</code></pre>\n\n<p>This class has no copy constructor or copy assignment as the resource handle needs to be unique across all instances of the class A - we do not want the resource to be freed while some other wrapper object still knows of the handle.</p>\n\n<p>Now I want to have other classes a way to take control of the resource by having member variables of the wrapper class:</p>\n\n<pre><code>class B {\npublic:\n    B(A res, Stuff stuff) : res(res), stuff(stuff) {}\nprivate:\n    A res;\n    Stuff stuff;\n};\n</code></pre>\n\n<p>Consider now that I need to do some preparation of that resource before acquiring it. I need a loader function to take care of some stuff and then return the resource, because the data required for the resource can come from computation or from a file for example. Thus creating a constructor for the Wrapper that takes the file would bind the implementation of the wrapper to the way the Data it needs gets parsed and prepared. I do not consider this wise. Thus the preparation of the Data happens elsewhere, for example:</p>\n\n<pre><code>A loader(std::string filename) {\n    //open file\n    Data data;\n    //read data from file\n    return A(data);\n}\n</code></pre>\n\n<p>The problem is with the way A is structured, I can not create objects of B in the way of:</p>\n\n<pre><code>B b(loader(\"foo\"), stuff);\n</code></pre>\n\n<p>because within the constructor of B, the instance of A gains an address, thus it can no longer be bound to the &amp;&amp;a of its move constructor or move assignment operator.</p>\n\n<p>How can I still pass the resource handle around across multiple layers of function calls and constructors without implementing a copy semantic?</p>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 13849, "user_id": 2602718, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CQ4Gj.jpg?s=128&g=1", "display_name": "scohe001", "link": "https://stackoverflow.com/users/2602718/scohe001"}, "edited": false, "score": 0, "creation_date": 1547669686, "post_id": 54224608, "comment_id": 95275143, "body": "If you have to downcast, there&#39;s a large possibility there&#39;s a better &quot;more OOP&quot; way of doing things. At the very least, you&#39;re breaking <a href=\"https://en.wikipedia.org/wiki/Liskov_substitution_principle\" rel=\"nofollow noreferrer\">the Liskov Substitution Principle</a>."}, {"owner": {"reputation": 7277, "user_id": 6205379, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/dPsLh.png?s=128&g=1", "display_name": "Timo", "link": "https://stackoverflow.com/users/6205379/timo"}, "edited": false, "score": 1, "creation_date": 1547669789, "post_id": 54224608, "comment_id": 95275198, "body": "If you, for some reason, cannot create a common interface type, there is always the possibility of using type erasure."}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 0, "creation_date": 1547672718, "post_id": 54224608, "comment_id": 95276518, "body": "Note that <code>item = static_cast&lt;B*&gt;(item)</code> doesn&#39;t work like you think. Since <code>item</code> is statically typed as an <code>A*</code>, assigning the casted pointer back to <code>item</code> just ends up giving you the same pointer that you started with. You need something more like this instead: <code>if(type == NUMBER) { B *b = static_cast&lt;B*&gt;(item); b-&gt;get(); } else if(type == STRING) { C *c = static_cast&lt;C*&gt;(item); c-&gt;get(); }</code> and so on."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1547674586, "post_id": 54224608, "comment_id": 95277380, "body": "So <code>B::get()</code> is meant to return <code>void</code>?"}, {"owner": {"reputation": 75, "user_id": 1057010, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/d64331affdd527c1e46a290db359c7c7?s=128&d=identicon&r=PG", "display_name": "Jie Liu", "link": "https://stackoverflow.com/users/1057010/jie-liu"}, "reply_to_user": {"reputation": 7277, "user_id": 6205379, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/dPsLh.png?s=128&g=1", "display_name": "Timo", "link": "https://stackoverflow.com/users/6205379/timo"}, "edited": false, "score": 0, "creation_date": 1547677852, "post_id": 54224608, "comment_id": 95278773, "body": "@Timo. Thanks for mentioning that. I did some reseach and learned a lot although it may not work for my case."}, {"owner": {"reputation": 75, "user_id": 1057010, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/d64331affdd527c1e46a290db359c7c7?s=128&d=identicon&r=PG", "display_name": "Jie Liu", "link": "https://stackoverflow.com/users/1057010/jie-liu"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 1, "creation_date": 1547677985, "post_id": 54224608, "comment_id": 95278819, "body": "@curiousguy. hmmm..... Good question. I think my original post was wrong. It is supposed to return int for B::get() and string for C::get(), which means the item-&gt;get() could return different type."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1547678278, "post_id": 54224608, "comment_id": 95278922, "body": "@JieLiu &quot;<i>supposed to return int for (...)</i>&quot; That changes a lot of things. It isn&#39;t possible to declare one pure virtual function with overriders in <code>B</code> and <code>C</code> then. We still don&#39;t know enough about the real problem being solved."}, {"owner": {"reputation": 7277, "user_id": 6205379, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/dPsLh.png?s=128&g=1", "display_name": "Timo", "link": "https://stackoverflow.com/users/6205379/timo"}, "edited": false, "score": 0, "creation_date": 1547678572, "post_id": 54224608, "comment_id": 95279004, "body": "@JieLiu Are those types somewhat restricted, what do they have in common? Also which c++ version do you use? If the variation is too big, Remy Lebeau&#39;s answer might be the more simple and straight forward solution. Using some macros and a static registry probably reduces future overhead even more."}, {"owner": {"reputation": 75, "user_id": 1057010, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/d64331affdd527c1e46a290db359c7c7?s=128&d=identicon&r=PG", "display_name": "Jie Liu", "link": "https://stackoverflow.com/users/1057010/jie-liu"}, "reply_to_user": {"reputation": 7277, "user_id": 6205379, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/dPsLh.png?s=128&g=1", "display_name": "Timo", "link": "https://stackoverflow.com/users/6205379/timo"}, "edited": false, "score": 0, "creation_date": 1547740369, "post_id": 54224608, "comment_id": 95303859, "body": "@Timo and curiousguy, Thanks for your comments. I admit that my original post was bad. I stuck yesterday. I have edited my question and hopefully it&#39;s more clear this time."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "reply_to_user": {"reputation": 7277, "user_id": 6205379, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/dPsLh.png?s=128&g=1", "display_name": "Timo", "link": "https://stackoverflow.com/users/6205379/timo"}, "edited": false, "score": 0, "creation_date": 1547743735, "post_id": 54224608, "comment_id": 95305724, "body": "@Timo &quot;<i>there is always the possibility of using type erasure</i>&quot; how that different from &quot;create a common interface type&quot;?"}, {"owner": {"reputation": 7277, "user_id": 6205379, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/dPsLh.png?s=128&g=1", "display_name": "Timo", "link": "https://stackoverflow.com/users/6205379/timo"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 2, "creation_date": 1547744337, "post_id": 54224608, "comment_id": 95306036, "body": "@curiousguy In terms of logic, there isn&#39;t. However, if he is not able to create a base type (i.e. the source code of a type is not accessible, like in 3rd party code), type erasure is a good alternative as it doesn&#39;t rely on a common type hierarchy. If however, those types have nothing in common (i.e. identical function signatures) type erasure won&#39;t be that helpful aswell."}, {"owner": {"reputation": 75, "user_id": 1057010, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/d64331affdd527c1e46a290db359c7c7?s=128&d=identicon&r=PG", "display_name": "Jie Liu", "link": "https://stackoverflow.com/users/1057010/jie-liu"}, "reply_to_user": {"reputation": 7277, "user_id": 6205379, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/dPsLh.png?s=128&g=1", "display_name": "Timo", "link": "https://stackoverflow.com/users/6205379/timo"}, "edited": false, "score": 0, "creation_date": 1547822457, "post_id": 54224608, "comment_id": 95336219, "body": "@Timo, yes, in my case. SeriesData, AT, IT and ST are in 3rd party code. However the return type will be different for some of the functions due to the different type of template argument. Does that mean it is not possible to just use the pointer of A to call functions."}, {"owner": {"reputation": 7277, "user_id": 6205379, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/dPsLh.png?s=128&g=1", "display_name": "Timo", "link": "https://stackoverflow.com/users/6205379/timo"}, "edited": false, "score": 0, "creation_date": 1547826802, "post_id": 54224608, "comment_id": 95338838, "body": "@JieLiu In theory you could also make an additional erased type that accepts all possible return types. But this would only move your boilerplate code to another place instead of eliminating it. I cannot come up with a better solution than Remy Lebeau."}], "answers": [{"tags": [], "owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "is_accepted": false, "score": 1, "last_activity_date": 1547673811, "last_edit_date": 1547673811, "creation_date": 1547673487, "answer_id": 54225519, "question_id": 54224608, "link": "https://stackoverflow.com/questions/54224608/cast-the-type-dynamically-in-multiple-inheritance-scenario/54225519#54225519", "title": "Cast the type dynamically in multiple inheritance scenario", "body": "<p>You can wrap the <code>type</code>-dependent operations in helper functions that are stored in lookup tables keyed by <code>type</code>, for example:</p>\n\n<pre><code>std::map&lt;int, A*(*)()&gt; makeAMap;\nmakeAMap[NUMBER] = []() -&gt; A* { return new B; };\nmakeAMap[STRING] = []() -&gt; A* { return new C; };\n...\n\nstd::map&lt;int, void(*)(A*)&gt; getFuncMap;\ngetFuncMap[NUMBER] = [](A *item){ static_cast&lt;B*&gt;(item)-&gt;get(); };\ngetFuncMap[STRING] = [](A *item){ static_cast&lt;C*&gt;(item)-&gt;get(); };\n...\n\nA* item = makeAMap[type]();\n...\nitem-&gt;common();    \ngetFuncMap[type](item);\n</code></pre>\n\n<p><a href=\"https://ideone.com/EHsfQV\" rel=\"nofollow noreferrer\">Live Demo</a></p>\n"}], "owner": {"reputation": 75, "user_id": 1057010, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/d64331affdd527c1e46a290db359c7c7?s=128&d=identicon&r=PG", "display_name": "Jie Liu", "link": "https://stackoverflow.com/users/1057010/jie-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1547740228, "creation_date": 1547669454, "last_edit_date": 1547740228, "question_id": 54224608, "link": "https://stackoverflow.com/questions/54224608/cast-the-type-dynamically-in-multiple-inheritance-scenario", "title": "Cast the type dynamically in multiple inheritance scenario", "body": "<p>Assume there is a template class that is an abstract interface to keep track a series of data.</p>\n\n<pre><code>template&lt;typename T&gt;\nclass SeriesData\n{\n    virtual T valueAt(int i) const = 0;\n};\n</code></pre>\n\n<p>I decide to use vector to store the data so I inherits from it, I also add a function to add value to series.</p>\n\n<pre><code>template&lt;typename T&gt; class MySeriesData : public SeriesData&lt;T&gt;\n{\n    T valueAt(int i) const {return values_[i];}\n    void add(const T&amp; value) {values_.push_back(value);}\nprivate:\n    std::vector&lt;T&gt; values_;\n};  \n</code></pre>\n\n<p>The class that is going to use the series of data. </p>\n\n<pre><code>template&lt;typename T&gt;\nclass AT\n{\npublic:\n    T data() const {return data_;}\n    void setData(SeriesData&lt;T&gt;* data) {delete data_; data_ = data;}\n\nprivate:\n    SeriesData&lt;T&gt; *data_;\n};\n\nclass IT : public AT&lt;int&gt;\n{\n};\n\nclass ST : public AT&lt;string&gt;\n{\n};\n</code></pre>\n\n<p>There is also a class that implements some common logic:</p>\n\n<pre><code>class A\n{\npublic:\n    A(){}\n    virtual ~A() {}\nprotected:\n    void common() {cout &lt;&lt; \"A common\" &lt;&lt; endl;}\n};\n</code></pre>\n\n<p>And there are two classes, each of which inherits from <code>IT</code> and <code>ST</code>, and both of which need to inherit from <code>A</code>. I want to have them inherit from A because there are so much common logic.</p>\n\n<pre><code>class Numbers : public A , public IT\n{\n};\n\nclass Strings : public A , public ST\n{\n};\n</code></pre>\n\n<p>In the main logic, I will use a pointer in type of A to dynamically create the instance of either Numbers or Strings based on the type client wants.</p>\n\n<pre><code>A* item;\nif(type == NUMBER)\n    item = new Numbers();\nelse if(type == STRING)\n    item = new Strings();\n</code></pre>\n\n<p>I can just use item to do those common things, which is good.</p>\n\n<pre><code>item-&gt;common();\n</code></pre>\n\n<p>However, for those logic that are related to AT. I would need to check the real type and then do cast.</p>\n\n<pre><code>item-&gt;common();    \nif(type == NUMBER)\n{\n    IT* itemNumber = static_cast&lt;Numbers*&gt;(item);\n    itemNumber-&gt;setData(new MySeries&lt;int&gt;());  \n}\nelse if(type == STRING)\n{\n    ST* itemString = static_cast&lt;Strings*&gt;(item);\n    itemString-&gt;setData(new MySeries&lt;string&gt;());  \n}\n\n.....\nif(type == NUMBER)\n{\n    //Have to cast from A to the a type of AT first\n    Numbers* itemNumber = static_cast&lt;Numbers*&gt;(item);\n    //Another conversion\n    MySeries&lt;int&gt;* numberValues = (MySeries&lt;int&gt;*)itemNumber-&gt;data();\n    numberValues-&gt;add(1); \n}\nelse if(type == STRING)\n{\n    Strings* itemString = static_cast&lt;Strings*&gt;(item);\n    MySeries&lt;string&gt;* stringValues = (MySeries&lt;string&gt;*)itemString-&gt;data();\n    stringValues-&gt;add(\"1\");   \n}\n</code></pre>\n\n<p>This is annoying when the code is full of these <code>if...else</code> or <code>switch...case</code>, especially when there are more and more types.</p>\n\n<p>Is it possible to cast the type more smartly? It will be nice if I can always (or in most of cases) use pointer of A to do all the stuffs.</p>\n"}, {"tags": ["c++", "g++"], "comments": [{"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 0, "creation_date": 1547669731, "post_id": 54224554, "comment_id": 95275177, "body": "<a href=\"http://coliru.stacked-crooked.com/a/28566b952cbe9417\" rel=\"nofollow noreferrer\">No repro</a>. Provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> as required please."}, {"owner": {"reputation": 9606, "user_id": 3677097, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b8c49e598194e53b9aba3a195da387a5?s=128&d=identicon&r=PG&f=1", "display_name": "Andreas DM", "link": "https://stackoverflow.com/users/3677097/andreas-dm"}, "reply_to_user": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 0, "creation_date": 1547669915, "post_id": 54224554, "comment_id": 95275270, "body": "@\u03c0\u03ac\u03bd\u03c4\u03b1\u1fe5\u03b5\u1fd6 strange, I do manage to reproduce it"}, {"owner": {"reputation": 7540, "user_id": 4474230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/713c7ce18010e541853962264a719d83?s=128&d=identicon&r=PG&f=1", "display_name": "Jeffrey", "link": "https://stackoverflow.com/users/4474230/jeffrey"}, "edited": false, "score": 1, "creation_date": 1547669950, "post_id": 54224554, "comment_id": 95275290, "body": "You simply need to provide an implementation, somewhere for data(). &#39;removing virtual in DataOp&#39; simply hides the problem. As soon as you put a call to .data() and .value() in main() you get the error back. Just implement the .data() function."}, {"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "reply_to_user": {"reputation": 9606, "user_id": 3677097, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b8c49e598194e53b9aba3a195da387a5?s=128&d=identicon&r=PG&f=1", "display_name": "Andreas DM", "link": "https://stackoverflow.com/users/3677097/andreas-dm"}, "edited": false, "score": 0, "creation_date": 1547669962, "post_id": 54224554, "comment_id": 95275298, "body": "@AndreasDM Show us a link at godbolt or coliru."}, {"owner": {"reputation": 9606, "user_id": 3677097, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b8c49e598194e53b9aba3a195da387a5?s=128&d=identicon&r=PG&f=1", "display_name": "Andreas DM", "link": "https://stackoverflow.com/users/3677097/andreas-dm"}, "reply_to_user": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 0, "creation_date": 1547670101, "post_id": 54224554, "comment_id": 95275370, "body": "@\u03c0\u03ac\u03bd\u03c4\u03b1\u1fe5\u03b5\u1fd6 run your example again without optimization -O0"}, {"owner": {"reputation": 23, "user_id": 9849427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae903f6458f224428d2aed530594208c?s=128&d=identicon&r=PG&f=1", "display_name": "Andre", "link": "https://stackoverflow.com/users/9849427/andre"}, "edited": false, "score": 0, "creation_date": 1547670130, "post_id": 54224554, "comment_id": 95275379, "body": "here is the link: <a href=\"http://coliru.stacked-crooked.com/a/1e92710344444ae6\" rel=\"nofollow noreferrer\">coliru.stacked-crooked.com/a/1e92710344444ae6</a> to reproduce."}, {"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "reply_to_user": {"reputation": 9606, "user_id": 3677097, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b8c49e598194e53b9aba3a195da387a5?s=128&d=identicon&r=PG&f=1", "display_name": "Andreas DM", "link": "https://stackoverflow.com/users/3677097/andreas-dm"}, "edited": false, "score": 0, "creation_date": 1547670230, "post_id": 54224554, "comment_id": 95275424, "body": "@AndreasDM Ah, yes. That reproduces the problem. Not mentioned in the question yet though."}, {"owner": {"reputation": 23, "user_id": 9849427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae903f6458f224428d2aed530594208c?s=128&d=identicon&r=PG&f=1", "display_name": "Andre", "link": "https://stackoverflow.com/users/9849427/andre"}, "reply_to_user": {"reputation": 7540, "user_id": 4474230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/713c7ce18010e541853962264a719d83?s=128&d=identicon&r=PG&f=1", "display_name": "Jeffrey", "link": "https://stackoverflow.com/users/4474230/jeffrey"}, "edited": false, "score": 0, "creation_date": 1547670302, "post_id": 54224554, "comment_id": 95275465, "body": "@Jeffrey <code>data()</code> function is implemented in <code>DataImpl</code>. Also, removing templates solves the problem with expected result (prints whatever <code>data()</code> returns in <code>DataImpl</code>)"}, {"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "reply_to_user": {"reputation": 9606, "user_id": 3677097, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b8c49e598194e53b9aba3a195da387a5?s=128&d=identicon&r=PG&f=1", "display_name": "Andreas DM", "link": "https://stackoverflow.com/users/3677097/andreas-dm"}, "edited": false, "score": 0, "creation_date": 1547670338, "post_id": 54224554, "comment_id": 95275484, "body": "@Andre Please put any relevant information into your original question. Just <a href=\"https://stackoverflow.com/posts/54224554/edit\">edit</a> it."}], "answers": [{"tags": [], "owner": {"reputation": 23, "user_id": 9849427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae903f6458f224428d2aed530594208c?s=128&d=identicon&r=PG&f=1", "display_name": "Andre", "link": "https://stackoverflow.com/users/9849427/andre"}, "is_accepted": true, "score": 0, "last_activity_date": 1547672418, "last_edit_date": 1547672418, "creation_date": 1547671879, "answer_id": 54225181, "question_id": 54224554, "link": "https://stackoverflow.com/questions/54224554/undefined-reference-to-function-in-c-g-with-diamond-inheritance/54225181#54225181", "title": "Undefined reference to function in c++ (g++) with diamond inheritance", "body": "<p>Found a solution and posting it here for future references. Adding <code>this</code> in <code>DataOp</code> solves the problem:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>template&lt;typename T&gt; struct DataOp: virtual Data&lt;T&gt; {\n    virtual T value() { return this-&gt;data(); }\n};\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 9849427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae903f6458f224428d2aed530594208c?s=128&d=identicon&r=PG&f=1", "display_name": "Andre", "link": "https://stackoverflow.com/users/9849427/andre"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 54225181, "answer_count": 1, "score": -1, "last_activity_date": 1547672418, "creation_date": 1547669171, "last_edit_date": 1547671470, "question_id": 54224554, "link": "https://stackoverflow.com/questions/54224554/undefined-reference-to-function-in-c-g-with-diamond-inheritance", "title": "Undefined reference to function in c++ (g++) with diamond inheritance", "body": "<p>I have simplify my original problem to highlight the issue, so some fixtures may look redundant but they are useful for the rest of my project.</p>\n\n<p>The code of this sample is in a single file <code>t.cc</code> and is compiled with <code>g++ t.cc</code> with the error:</p>\n\n<pre><code>In function `DataOp&lt;int&gt;::value()':\nt.cc:(.text._ZN6DataOpIiE5valueEv[_ZN6DataOpIiE5valueEv]+0x28): undefined reference to `Data&lt;int&gt;::data() const'\ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>The code is this:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>template&lt;typename T&gt; struct Data {\n    virtual int data() const = 0;\n};\n\ntemplate&lt;typename T&gt; struct DataImpl: virtual Data&lt;T&gt; {\n    virtual int data() const override { return 0; }\n};\n\ntemplate&lt;typename T&gt; struct DataOp: virtual Data&lt;T&gt; {\n    virtual T value() { return Data&lt;T&gt;::data(); }\n};\n\nstruct OpImpl\n    : DataOp&lt;int&gt;\n    , DataImpl&lt;int&gt;\n{};\n\n\nint main() {\n    OpImpl c;\n    return 0;\n}\n</code></pre>\n\n<p>Interestingly enough, removing <code>virtual</code> in <code>DataOp</code> implementation removes the linker problem (but I cannot do it easily in the project).</p>\n\n<p><strong>Updates</strong></p>\n\n<ul>\n<li><a href=\"http://coliru.stacked-crooked.com/a/30036e3e26f6eb7a\" rel=\"nofollow noreferrer\">Link</a> to reproduce the results.</li>\n<li>The problem occurs when optimization is disabled, e.g. when -O0 (or no optimization flag) provided to g++.</li>\n<li>Seems to be reproducable on clang++ as well</li>\n<li>Removing templates as <a href=\"http://coliru.stacked-crooked.com/a/85f14969511f8f34\" rel=\"nofollow noreferrer\">here</a> removes the error.</li>\n</ul>\n"}, {"tags": ["c++", "visual-studio-2017", "expression", "formula"], "comments": [{"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 3, "creation_date": 1547668988, "post_id": 54224508, "comment_id": 95274846, "body": "It sounds like you may need to learn how to use a debugger to step through your code. With a good debugger, you can execute your program line by line and see where it is deviating from what you expect. This is an essential tool if you are going to do any programming. Further reading: <a href=\"http://ericlippert.com/2014/03/05/how-to-debug-small-programs/\" rel=\"nofollow noreferrer\">How to debug small programs</a> and <a href=\"http://idownvotedbecau.se/nodebugging/\" rel=\"nofollow noreferrer\">Debugging Guide</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 9727662, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Kyle Williams", "link": "https://stackoverflow.com/users/9727662/kyle-williams"}, "edited": false, "score": 0, "creation_date": 1547671468, "post_id": 54224790, "comment_id": 95275974, "body": "thank you for your assistance with the if statements, I did not want to use the extra semi colons, however the program would not even run unless I put that there the formula I&#39;d like for it to be is principal * rate / (1 \u2013 (rate + 1)-sqrt(term)), it is giving me an error code stating that a &quot;;&quot; is required so I did what the compiler asked, and it worked, but it is still giving me incorrect answers"}, {"owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "reply_to_user": {"reputation": 1, "user_id": 9727662, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Kyle Williams", "link": "https://stackoverflow.com/users/9727662/kyle-williams"}, "edited": false, "score": 0, "creation_date": 1547671785, "post_id": 54224790, "comment_id": 95276123, "body": "<code>principal * rate &#47; (1 \u2013 (rate + 1)-sqrt(term))</code> is not correct because you haven&#39;t declared a variable called <code>term</code>. Neither do you have a variable called <code>principal</code>. I know these may be typos but I can only go on what you type.  Also don&#39;t take compiler error messages too literally."}, {"owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "reply_to_user": {"reputation": 1, "user_id": 9727662, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Kyle Williams", "link": "https://stackoverflow.com/users/9727662/kyle-williams"}, "edited": false, "score": 0, "creation_date": 1547672063, "post_id": 54224790, "comment_id": 95276253, "body": "Based on what you&#39;ve said this looks to me to be the correct formula <code>monthlypayment = (prinicple * rate) &#47; (1 - (rate + 1) - sqrt (mterm));</code> But even that looks mathematically wrong, because the ones cancel out, +1 and -1."}, {"owner": {"reputation": 1, "user_id": 9727662, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Kyle Williams", "link": "https://stackoverflow.com/users/9727662/kyle-williams"}, "edited": false, "score": 0, "creation_date": 1547672172, "post_id": 54224790, "comment_id": 95276293, "body": "excuse me John, I am a beginner. but I did make a mistake naming principle &quot;priniciple&quot;, and term is sqrdMonth or sqrdYear relative if the user enters &quot;m&quot; or &quot;y&quot; I thought that"}, {"owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "reply_to_user": {"reputation": 1, "user_id": 9727662, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Kyle Williams", "link": "https://stackoverflow.com/users/9727662/kyle-williams"}, "edited": false, "score": 0, "creation_date": 1547672310, "post_id": 54224790, "comment_id": 95276341, "body": "If you can&#39;t get it to work then post exactly what you have for the formula, cut and paste from your program, and the exact error message, again cut and paste from your program."}, {"owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "reply_to_user": {"reputation": 1, "user_id": 9727662, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Kyle Williams", "link": "https://stackoverflow.com/users/9727662/kyle-williams"}, "edited": false, "score": 0, "creation_date": 1547672513, "post_id": 54224790, "comment_id": 95276438, "body": "BTW I think you have the formula wrong. I just looked up the compound interest formula and its <code>prinicple * pow(1 + rate, term)</code>. Where <code>pow</code> means the first number raised to the power of the second number."}], "tags": [], "owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "is_accepted": false, "score": 2, "last_activity_date": 1547670470, "last_edit_date": 1547670470, "creation_date": 1547670149, "answer_id": 54224790, "question_id": 54224508, "link": "https://stackoverflow.com/questions/54224508/how-could-i-properly-set-up-this-loan-equation-based-on-my-code/54224790#54224790", "title": "How could I properly set up this loan equation based on my code?", "body": "<p>Several mistakes</p>\n\n<pre><code>if (choice = 'M') // if its monthly \n    mterm = 12; // there are 12 months within a year\n</code></pre>\n\n<p>First point is that should say </p>\n\n<pre><code>if (choice == 'M') // if its monthly \n    mterm = 12; // there are 12 months within a year\n</code></pre>\n\n<p>In C++ we use <code>==</code> to test for equality and <code>=</code> to assign to a variable.</p>\n\n<p>Even more seriously think about this</p>\n\n<pre><code>if (choice == 'M') // if its monthly \n    mterm = 12; // there are 12 months within a year\ncout &lt;&lt; \"How many years will this loan be for?\" &lt;&lt; endl;\ncin &gt;&gt; years; // I need this information for getting the exact\nmonth = mterm * years;\n</code></pre>\n\n<p>Now suppose <code>choice</code> is not <code>'M'</code> what do you think the value of <code>mterm</code> will be?</p>\n\n<p>The answer is that it is undefined. Yet you are using the variable in the formula two lines down. It's bad to use variables with undefined values. </p>\n\n<p>It looks to me that you need to restructure your code to include more statements inside of the if statement</p>\n\n<pre><code>if (choice == 'M')\n{\n    mterm = 12; // there are 12 months within a year\n    cout &lt;&lt; \"How many years will this loan be for?\" &lt;&lt; endl;\n    cin &gt;&gt; years; // I need this information for getting the exact\n    month = mterm * years;\n    sqrdMonth = sqrt(month); // I need to square root the months for the periodic payment formula\n    monthlypayment = (prinicple * rate) / (rate); sqrdMonth; // this is where my problem is \n                                            //  ^^^^ why is it asking me to close my equation with a ';'\n    cout &lt;&lt; \"Your monthly loan payment is: \";\n    cout &lt;&lt; monthlypayment;\n}\n</code></pre>\n\n<p>Finally this</p>\n\n<pre><code>monthlypayment = (prinicple * rate) / (rate); sqrdMonth;\n</code></pre>\n\n<p>I've no idea why you've got two semi-colons. Makes no sense to me, but I not sure what the formula should be. There's no mention of square roots in the formula in your question, so I'm not sure why you included one here.</p>\n"}], "owner": {"reputation": 1, "user_id": 9727662, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Kyle Williams", "link": "https://stackoverflow.com/users/9727662/kyle-williams"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1547670470, "creation_date": 1547668958, "last_edit_date": 1547669006, "question_id": 54224508, "link": "https://stackoverflow.com/questions/54224508/how-could-i-properly-set-up-this-loan-equation-based-on-my-code", "title": "How could I properly set up this loan equation based on my code?", "body": "<p>The question wants me to create 2 scenarios </p>\n\n<ol>\n<li>The user accepts the dealer\u2019s rebate offer and finances the car through his or her local credit union.</li>\n</ol>\n\n<p>and</p>\n\n<ol start=\"2\">\n<li>The user declines the dealer\u2019s rebate offer but accepts the dealer\u2019s lower financing rate.</li>\n</ol>\n\n<p>It expects for me to use the periodic payment formula, which is: principal * rate / (1 \u2013 (rate + 1)-term) and use it to get either a monthly or annual payment.</p>\n\n<p>The problem that I am having with my code I believe has something to do with my equations I am using to get annual or monthly loan payments, it for sure is not giving me the correct answer to my inputs and I do not know why. </p>\n\n<p>I have tried changing the equations around several times and still no avail.</p>\n\n<pre><code>int main()\n\n\n// these are the variables I will be using in maths for this project\ndouble annualpayment; // what will be displayed once all is calculated annually \ndouble monthlypayment; // what will be displayed once all is calculated monthly\ndouble prinicple; // amount borrowed\ndouble rate; // interest rate\ndouble mterm; // what the user will enter for monthly term \ndouble yterm; // what user will enter for yearly term\ndouble years; // term of loan (yearly)\ndouble month; // term of loan (monthly)\ndouble sqrdMonth; // sqrt of term of loan (monthly)\ndouble sqrdYear; // sqrt of term of loan (yearly)\nchar choice;\n}\n{\n    cout &lt;&lt; \"Enter your principle: \" &lt;&lt; endl; // total amount borrowing\n    cin &gt;&gt; prinicple;\n\n    cout &lt;&lt; \"Enter your your interest rate: \" &lt;&lt; endl; // interest rate on loan\n    cin &gt;&gt; rate;\n\n    cout &lt;&lt; \"Will this be (M)onthly or (Y)early payment? (enter y or m)\"; // declaring if it will be a monthly or yearly payment\n    cin &gt;&gt; choice;\n\n    if (choice = 'M') // if its monthly \n        mterm = 12; // there are 12 months within a year\n    cout &lt;&lt; \"How many years will this loan be for?\" &lt;&lt; endl;\n    cin &gt;&gt; years; // I need this information for getting the exact\n    month = mterm * years;\n    sqrdMonth = sqrt(month); // I need to square root the months for the periodic payment formula\n    monthlypayment = (prinicple * rate) / (rate); sqrdMonth; // this is where my problem is \n                                                //  ^^^^ why is it asking me to close my equation with a ';'\n    cout &lt;&lt; \"Your monthly loan payment is: \";\n    cout &lt;&lt; monthlypayment;\n\n    if (choice = 'Y')\n        yterm = 1;\n    cout &lt;&lt; \"How many years will this loan be for?\" &lt;&lt; endl;\n    cin &gt;&gt; years;\n    years = yterm * years;\n    sqrdYear = sqrt(years); // I need to square root the years for the periodic payment formula\n    annualpayment = (prinicple * rate) / (rate); sqrdYear; // this is where my problem is \n                                        // ^^^^ why is it asking me to close my equation with a ';'\n    cout &lt;&lt; \"Your annual loan payment is: \";\n    cout &lt;&lt; annualpayment;\n\n\n}\n</code></pre>\n\n<p>}</p>\n\n<p>I expect for the user to input the principle, rate, and length of loan then the compiler to do the math and then output the correct numbers. My actual results are negative numbers or irrational numbers. </p>\n"}, {"tags": ["c++", "c++14"], "comments": [{"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1547668888, "post_id": 54224461, "comment_id": 95274800, "body": "You don&#39;t use <code>struct</code> in <code>stat getStat();</code> but you use it in <code>struct stat Person::getStat() {  }</code>.  Why?"}, {"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 0, "creation_date": 1547668909, "post_id": 54224461, "comment_id": 95274809, "body": "Use <code>struct Person::stat Person::getStat() {</code> for the definition. `"}, {"owner": {"reputation": 79, "user_id": 10924382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c66d0bbec1a4a2263112e0ad9e77316?s=128&d=identicon&r=PG&f=1", "display_name": "Kupperu", "link": "https://stackoverflow.com/users/10924382/kupperu"}, "edited": false, "score": 0, "creation_date": 1547669001, "post_id": 54224461, "comment_id": 95274851, "body": "Because I was getting an error in the cpp file and putting struct solved it. However it didn&#39;t do anything for the header file so I figured I didn&#39;t have to."}, {"owner": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 0, "creation_date": 1547669016, "post_id": 54224461, "comment_id": 95274857, "body": "<code>Person::~Person() { }</code> -&gt;&gt; <code>Person::~Person() = default;</code> you don&#39;t want a user defined function when you can get a trivial one."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547669143, "post_id": 54224461, "comment_id": 95274914, "body": "In c++ you don&#39;t need to use <code>struct</code> to indicates that an identifier names a <code>struct</code> that&#39;s been previously declared. You have (had?) to in c but it&#39;s not a requirement in c++. It&#39;s necessary when you declare and define the <code>struct</code> but not when you use it."}], "answers": [{"comments": [{"owner": {"reputation": 79, "user_id": 10924382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c66d0bbec1a4a2263112e0ad9e77316?s=128&d=identicon&r=PG&f=1", "display_name": "Kupperu", "link": "https://stackoverflow.com/users/10924382/kupperu"}, "edited": false, "score": 0, "creation_date": 1547669032, "post_id": 54224497, "comment_id": 95274863, "body": "May I ask why it&#39;s Person::stat ? Is it because stat is a struct I defined in the header file?"}, {"owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "reply_to_user": {"reputation": 79, "user_id": 10924382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c66d0bbec1a4a2263112e0ad9e77316?s=128&d=identicon&r=PG&f=1", "display_name": "Kupperu", "link": "https://stackoverflow.com/users/10924382/kupperu"}, "edited": false, "score": 1, "creation_date": 1547669086, "post_id": 54224497, "comment_id": 95274892, "body": "@Kupperu It&#39;s because you defined <code>stat</code> <i>inside</i> <code>class Person</code>. If you had defined it outside you wouldn&#39;t need to say <code>Person::stat</code>. It has nothing to do with header files. C++ code is the same whether it&#39;s in a header file or anywhere else."}], "tags": [], "owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "is_accepted": true, "score": 2, "last_activity_date": 1547668911, "creation_date": 1547668911, "answer_id": 54224497, "question_id": 54224461, "link": "https://stackoverflow.com/questions/54224461/why-am-i-getting-a-declaration-is-incompatible-with-x/54224497#54224497", "title": "Why am I getting a &quot;declaration is incompatible with (x)&quot;?", "body": "<p>Should be</p>\n\n<pre><code>Person::stat Person::getStat() {\n\n}\n</code></pre>\n\n<p>Your version declares a new <code>struct stat</code> which isn't the same as <code>Person::stat</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 79, "user_id": 10924382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c66d0bbec1a4a2263112e0ad9e77316?s=128&d=identicon&r=PG&f=1", "display_name": "Kupperu", "link": "https://stackoverflow.com/users/10924382/kupperu"}, "edited": false, "score": 0, "creation_date": 1547669365, "post_id": 54224501, "comment_id": 95275008, "body": "Yeah I read about that in one of the posts on stackoverflow which was why I was confused as to why that seem to have temporarily solved a previous problem where I was getting an error for writing on the word stat. Since it seems to have fixed that error I kept it in."}], "tags": [], "owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "is_accepted": false, "score": 1, "last_activity_date": 1547668924, "creation_date": 1547668924, "answer_id": 54224501, "question_id": 54224461, "link": "https://stackoverflow.com/questions/54224461/why-am-i-getting-a-declaration-is-incompatible-with-x/54224501#54224501", "title": "Why am I getting a &quot;declaration is incompatible with (x)&quot;?", "body": "<p><code>struct stat Person::getStat()</code> is a method that returns a <code>stat</code> that belongs to the global namespace, not to <code>Person</code>:</p>\n\n<pre><code>Person::stat Person::getStat()\n</code></pre>\n\n<p>Note that there is no <code>struct</code> here (to avoid declaring one). In C++, we don't use <code>struct</code> after the type has been declared.</p>\n"}], "owner": {"reputation": 79, "user_id": 10924382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c66d0bbec1a4a2263112e0ad9e77316?s=128&d=identicon&r=PG&f=1", "display_name": "Kupperu", "link": "https://stackoverflow.com/users/10924382/kupperu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1300, "favorite_count": 0, "accepted_answer_id": 54224497, "answer_count": 2, "score": 1, "last_activity_date": 1547668924, "creation_date": 1547668792, "question_id": 54224461, "link": "https://stackoverflow.com/questions/54224461/why-am-i-getting-a-declaration-is-incompatible-with-x", "title": "Why am I getting a &quot;declaration is incompatible with (x)&quot;?", "body": "<p>I'm creating a class called person right now in separate header and cpp files.\nAnd for one of the functions I'm getting this error:</p>\n\n<blockquote>\n  <p>declaration is incompatible with \"Person::stat Person::getStat()\" (declared at line 26 of \"C:...\")</p>\n</blockquote>\n\n<p>(Not the exact directory but you get the idea)</p>\n\n<p>Here is the code in the header file:</p>\n\n<pre><code>#pragma once\n#include &lt;string&gt;\n#include &lt;iostream&gt;\nclass Person\n{\npublic:\n    struct stat {\n        int str;\n        int end;\n        int dex;\n        int intel;      \n    };\n    Person();\n    ~Person();\n    //properties\n    stat getStat();\n};\n</code></pre>\n\n<p>Here is the code in the cpp file:</p>\n\n<pre><code>#include \"pch.h\"\n#include \"Person.h\"\n\n#include &lt;string&gt;\n#include &lt;iostream&gt;\n\nPerson::Person()\n    :age(12), height(0)\n{\n}\n\n\nPerson::~Person()\n{\n}\n\nstruct stat Person::getStat() {\n\n}\n</code></pre>\n\n<p>I'm getting the error with the getStat() function. I've tried including the string and iostream headers in both file and also only in the header file since a similar post suggested it. Both didn't solve my problem however.</p>\n"}, {"tags": ["c++", "windows", "winapi", "cmd", "g++"], "answers": [{"tags": [], "owner": {"reputation": 11238, "user_id": 7594711, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7872c871b0431b72df6350dd0394bea?s=128&d=identicon&r=PG&f=1", "display_name": "SoronelHaetir", "link": "https://stackoverflow.com/users/7594711/soronelhaetir"}, "is_accepted": false, "score": 1, "last_activity_date": 1547669848, "creation_date": 1547669848, "answer_id": 54224712, "question_id": 54224417, "link": "https://stackoverflow.com/questions/54224417/g-include-rc-files-from-cmd/54224712#54224712", "title": "G++ include .rc files from cmd", "body": "<p>.rc files aren't fed to gcc, they have to be processed by windres (the gcc equivalent of MS' rc.exe), you use windres to create a .o file from the .rc and then feed that .o to gcc (or ld) as part of your final link stage.</p>\n\n<pre><code>windres my_file.rc my_file.o\ngcc -o my_final &lt;other parameters&gt; my_file.o\n</code></pre>\n\n<p>There are other potential arguments to windres, look at the man page for details.</p>\n"}, {"comments": [{"owner": {"reputation": 89, "user_id": 10792316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc9a9e156283d243d6072c2a44adba06?s=128&d=identicon&r=PG&f=1", "display_name": "snzm", "link": "https://stackoverflow.com/users/10792316/snzm"}, "edited": false, "score": 0, "creation_date": 1547881446, "post_id": 54231530, "comment_id": 95353460, "body": "Removing the header file as an argment to g++ did the trick. Thank you."}], "tags": [], "owner": {"reputation": 6168, "user_id": 10611792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r727s.jpg?s=128&g=1", "display_name": "Drake Wu", "link": "https://stackoverflow.com/users/10611792/drake-wu"}, "is_accepted": true, "score": 0, "last_activity_date": 1547712656, "creation_date": 1547712656, "answer_id": 54231530, "question_id": 54224417, "link": "https://stackoverflow.com/questions/54224417/g-include-rc-files-from-cmd/54231530#54231530", "title": "G++ include .rc files from cmd", "body": "<p>The main difference between MS resource tools and GNU tools is that MS RC generates'.res' files in a special binary resource format, which can be passed directly to MS links, while GNU linker LD only supports '.o' (the same as'.obj') format. So As the answer of @SoronelHaetir, you need to use the windres:\n<code>windres main.rc -o res.o</code></p>\n\n<p>What else I want to point out is You shouldn't \"compile\" .h files. Doing so will create precompiled header files, which are not used to create an executable, then cause the <code>xxx.o: file not recognized: File format not recognized</code>. Builder is able to find these header files by itself due to #include directives. See the similar issue <a href=\"https://stackoverflow.com/questions/17126384/g-output-file-not-recognized-file-format-not-recognized\">here</a>.</p>\n"}], "owner": {"reputation": 89, "user_id": 10792316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc9a9e156283d243d6072c2a44adba06?s=128&d=identicon&r=PG&f=1", "display_name": "snzm", "link": "https://stackoverflow.com/users/10792316/snzm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 533, "favorite_count": 1, "accepted_answer_id": 54231530, "answer_count": 2, "score": 0, "last_activity_date": 1547712656, "creation_date": 1547668579, "last_edit_date": 1547669668, "question_id": 54224417, "link": "https://stackoverflow.com/questions/54224417/g-include-rc-files-from-cmd", "title": "G++ include .rc files from cmd", "body": "<p>I've made a simple WIN32 project using resources (.rc files).</p>\n\n<p>When I compile with code::blocks the dialog box displays,\nbut when compiling with g++ from cmd it doesn't.</p>\n\n<p>Trying to include the .rc as an argument to g++ results in this:<br>\n<code>main.rc: file not recognized: File format not recognized\ncollect2.exe: error: ld returned 1 exit status</code></p>\n\n<p>How do I include the .rc file to g++ in cmd?</p>\n\n<p>Edit:\nI tried with windres doing:<br>\n<code>windres main.rc -o res.o</code><br>\n<code>g++ -c win_main.cpp resource.h -o source.o</code><br>\n<code>g++ -o Executable res.o source.o</code><br></p>\n\n<p>I get the same error but with <code>main.o</code> instead of <code>main.rc</code> not recognized.</p>\n"}, {"tags": ["c++", "cl.exe"], "comments": [{"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 0, "creation_date": 1547668399, "post_id": 54224350, "comment_id": 95274576, "body": "Pointer arithmetic takes type size into account. Also alignment will take place."}, {"owner": {"reputation": 12073, "user_id": 527574, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e5b251b4ac8f0cb7942587ee8077cddb?s=128&d=identicon&r=PG", "display_name": "Michael Dorgan", "link": "https://stackoverflow.com/users/527574/michael-dorgan"}, "edited": false, "score": 0, "creation_date": 1547668545, "post_id": 54224350, "comment_id": 95274657, "body": "OMG that is a lot of memory you are allocating."}, {"owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 4, "creation_date": 1547668661, "post_id": 54224350, "comment_id": 95274702, "body": "You probably need <code>0x400000B0 * 4L</code> or the multiplication can overflow."}, {"owner": {"reputation": 12073, "user_id": 527574, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e5b251b4ac8f0cb7942587ee8077cddb?s=128&d=identicon&r=PG", "display_name": "Michael Dorgan", "link": "https://stackoverflow.com/users/527574/michael-dorgan"}, "edited": false, "score": 0, "creation_date": 1547668707, "post_id": 54224350, "comment_id": 95274719, "body": "Guess that literal multiplies would warn on that, but you never know..."}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "reply_to_user": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 1, "creation_date": 1547668789, "post_id": 54224350, "comment_id": 95274750, "body": "@DavidSchwartz that&#39;s the answer."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547669436, "post_id": 54224350, "comment_id": 95275035, "body": "<code>new float[0x50000000]</code> is over a billion <code>float</code>. If <code>sizeof(float) == 4</code> you are asking for a contiguous block of addresses 5GB long."}, {"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 0, "creation_date": 1547670465, "post_id": 54224350, "comment_id": 95275534, "body": "&quot;I got me a hundred gigabytes of RAM. I never feed trolls and I don&#39;t read spam&quot;-- Al Yankovic, 1999."}, {"owner": {"reputation": 1702, "user_id": 1408005, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6f155380babfb7dd23b13b5fb9c6abc2?s=128&d=identicon&r=PG", "display_name": "Elliot", "link": "https://stackoverflow.com/users/1408005/elliot"}, "reply_to_user": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 0, "creation_date": 1547671080, "post_id": 54224350, "comment_id": 95275820, "body": "@David-Schwartz thanks, I had no idea it would do that. If you put that for an answer then I&#39;ll select it soon."}, {"owner": {"reputation": 1702, "user_id": 1408005, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6f155380babfb7dd23b13b5fb9c6abc2?s=128&d=identicon&r=PG", "display_name": "Elliot", "link": "https://stackoverflow.com/users/1408005/elliot"}, "reply_to_user": {"reputation": 12073, "user_id": 527574, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e5b251b4ac8f0cb7942587ee8077cddb?s=128&d=identicon&r=PG", "display_name": "Michael Dorgan", "link": "https://stackoverflow.com/users/527574/michael-dorgan"}, "edited": false, "score": 1, "creation_date": 1547671090, "post_id": 54224350, "comment_id": 95275823, "body": "@Michael yep, I see now that there was a warning. Lesson learned."}], "answers": [{"tags": [], "owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "is_accepted": false, "score": 2, "last_activity_date": 1547671371, "creation_date": 1547671371, "answer_id": 54225060, "question_id": 54224350, "link": "https://stackoverflow.com/questions/54224350/pointer-arithmetic-confusion-or-weird-behavior/54225060#54225060", "title": "Pointer arithmetic confusion or weird behavior", "body": "<p>You need <code>0x400000B0 * 4L</code> or the multiplication will overflow.</p>\n"}, {"tags": [], "owner": {"reputation": 1702, "user_id": 1408005, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6f155380babfb7dd23b13b5fb9c6abc2?s=128&d=identicon&r=PG", "display_name": "Elliot", "link": "https://stackoverflow.com/users/1408005/elliot"}, "is_accepted": false, "score": 1, "last_activity_date": 1547762479, "creation_date": 1547762479, "answer_id": 54244915, "question_id": 54224350, "link": "https://stackoverflow.com/questions/54224350/pointer-arithmetic-confusion-or-weird-behavior/54244915#54244915", "title": "Pointer arithmetic confusion or weird behavior", "body": "<p>I am guessing that David's answer works for some compilers, but in the Microsoft compiler I still got warnings and the same result. I noticed in some C++ documentation that \"long\" only provides \"at least a width of 32bits\". Therefore I changed the variable type and the expression type to long long;</p>\n\n<pre><code>long long _varLLxxLL = 0x400000B0 * 4LL;\nstd::cout &lt;&lt; \"_varLLxxLL has value \" &lt;&lt; _varLLxxLL \n          &lt;&lt; \", the expression had type \" &lt;&lt; typeid(0x400000B0 * 4LL).name() &lt;&lt; \"\\n\";\n</code></pre>\n\n<p>Output: </p>\n\n<blockquote>\n  <p>_varLLxxLL has value 4294968000, the expression had type __int64</p>\n</blockquote>\n\n<p>Compare to:</p>\n\n<pre><code>long _varLxxxLx = 0x400000B0 * 4L;\nstd::cout &lt;&lt; \"_varLxxxLx has value \" &lt;&lt; _varLxxxLx \n          &lt;&lt; \", the expression had type \" &lt;&lt; typeid(0x400000B0 * 4L).name() &lt;&lt; \"\\n\";\n</code></pre>\n\n<p>Output: </p>\n\n<blockquote>\n  <p>_varLxxxLx has value 704, the expression had type long</p>\n</blockquote>\n\n<p>I'll leave the question open for now. </p>\n"}], "owner": {"reputation": 1702, "user_id": 1408005, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6f155380babfb7dd23b13b5fb9c6abc2?s=128&d=identicon&r=PG", "display_name": "Elliot", "link": "https://stackoverflow.com/users/1408005/elliot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1547762479, "creation_date": 1547668291, "question_id": 54224350, "link": "https://stackoverflow.com/questions/54224350/pointer-arithmetic-confusion-or-weird-behavior", "title": "Pointer arithmetic confusion or weird behavior", "body": "<p>When the following has run, I get _pfloatPos and _charPos being different:</p>\n\n<pre><code>    float* const _pData = new float[0x50000000];\n\n    float*  const _floatPos = _pData + 0x400000B0;\n    char*   const _charPos = ((char*)_pData) + 0x400000B0 * 4;\n\n    if ((char*)_floatPos !=  _charPos)\n    {\n        throw \"Derp.\";\n    }\n</code></pre>\n\n<p>Maybe I've got brain fog and missed something basic. The two addresses should be the same, right? </p>\n\n<p>I looked at the disassembly. 1000002C0h is 4 * 0x400000B0 . For the second one it seems to have been truncated at some point.</p>\n\n<pre><code>        float*  const _floatPos = _pData + 0x400000B0;\n00007FF7CE48F6E2  mov         rax,1000002C0h  \n00007FF7CE48F6EC  mov         rcx,qword ptr [_pData]  \n00007FF7CE48F6F0  add         rcx,rax  \n00007FF7CE48F6F3  mov         rax,rcx  \n00007FF7CE48F6F6  mov         qword ptr [_floatPos],rax  \n        char*   const _charPos = ((char*)_pData) + 0x400000B0 * 4;\n00007FF7CE48F6FA  mov         rax,qword ptr [_pData]  \n00007FF7CE48F6FE  add         rax,2C0h  \n00007FF7CE48F704  mov         qword ptr [_charPos],rax  \n</code></pre>\n\n<p>I am using visual Studio 2017 Version 15.9.2, but I'm not sure about the version of the compiler. </p>\n"}, {"tags": ["c++", "octave"], "answers": [{"comments": [{"owner": {"reputation": 7449, "user_id": 3811887, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/88dcea89bc4be8736da3b890f368a788?s=128&d=identicon&r=PG&f=1", "display_name": "Andy", "link": "https://stackoverflow.com/users/3811887/andy"}, "edited": false, "score": 1, "creation_date": 1547811434, "post_id": 54227229, "comment_id": 95330317, "body": "Please note  that symbolic links are to be avoided in Octave packages, as symbolic links do not exist on some file systems and thus the autoload mechanism described by carandraug should be prefered"}], "tags": [], "owner": {"reputation": 200780, "user_id": 116908, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/54d38793d7a407446999b33b81d607fd?s=128&d=identicon&r=PG", "display_name": "Carl Norum", "link": "https://stackoverflow.com/users/116908/carl-norum"}, "is_accepted": true, "score": 4, "last_activity_date": 1547683582, "creation_date": 1547683582, "answer_id": 54227229, "question_id": 54224260, "link": "https://stackoverflow.com/questions/54224260/generating-multiple-oct-files-from-a-single-cc-source-file-to-interface-a/54227229#54227229", "title": "Generating multiple *.oct* files from a single *.cc* source file to interface a C library to Octave", "body": "<p>The point of the second link is that you <em>don't</em> load a <em>.oct</em> file with multiple functions in it - at least not from octave's perspective. That's what the symlinks are for - you have symbols <code>A</code>, <code>B</code>, and <code>C</code> in there? Make <code>A.oct</code>, <code>B.oct</code>, and <code>C.oct</code> symbolic links that point at that file and you can use them as if each contained only the symbol you care about.</p>\n"}, {"comments": [{"owner": {"reputation": 42647, "user_id": 7328782, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/treJu.png?s=128&g=1", "display_name": "Cris Luengo", "link": "https://stackoverflow.com/users/7328782/cris-luengo"}, "edited": false, "score": 1, "creation_date": 1547734315, "post_id": 54228915, "comment_id": 95300031, "body": "This quote from the documentation clarified this answer for me: \u201cNormally, calls to autoload appear in PKG_ADD script files that are evaluated when a directory is added to Octave\u2019s load path.\u201c"}, {"owner": {"reputation": 7449, "user_id": 3811887, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/88dcea89bc4be8736da3b890f368a788?s=128&d=identicon&r=PG&f=1", "display_name": "Andy", "link": "https://stackoverflow.com/users/3811887/andy"}, "reply_to_user": {"reputation": 42647, "user_id": 7328782, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/treJu.png?s=128&g=1", "display_name": "Cris Luengo", "link": "https://stackoverflow.com/users/7328782/cris-luengo"}, "edited": false, "score": 0, "creation_date": 1547808231, "post_id": 54228915, "comment_id": 95328669, "body": "@CrisLuengo: also see <a href=\"https://octave.org/doc/interpreter/PKG_005fADD-and-PKG_005fDEL-Directives.html#PKG_005fADD-and-PKG_005fDEL-Directives\" rel=\"nofollow noreferrer\">octave.org/doc/interpreter/&hellip;</a> . Nowadays almost all octave forge packages have the PKG_ADD directive in the source files and <code>pkg</code> creates the PKG_ADD on installation"}], "tags": [], "owner": {"reputation": 12237, "user_id": 1609556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6fa53133932b5d2a4536232c9429d39?s=128&d=identicon&r=PG", "display_name": "carandraug", "link": "https://stackoverflow.com/users/1609556/carandraug"}, "is_accepted": false, "score": 3, "last_activity_date": 1547698384, "creation_date": 1547698384, "answer_id": 54228915, "question_id": 54224260, "link": "https://stackoverflow.com/questions/54224260/generating-multiple-oct-files-from-a-single-cc-source-file-to-interface-a/54228915#54228915", "title": "Generating multiple *.oct* files from a single *.cc* source file to interface a C library to Octave", "body": "<p>If you have multiple function definitions in a single oct file, you use <code>autoload()</code>.  So if you have <code>foo.oct</code> which has functions <code>foo</code> and <code>bar</code>, then you do:</p>\n\n<pre><code>autoload (\"bar\", \"path-to-foo.oct\");\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 18197, "user_id": 4183191, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ce0d78cc78f51ee79cec5088effe3ed?s=128&d=identicon&r=PG", "display_name": "Tasos Papastylianou", "link": "https://stackoverflow.com/users/4183191/tasos-papastylianou"}, "is_accepted": false, "score": 2, "last_activity_date": 1547738996, "last_edit_date": 1547738996, "creation_date": 1547730445, "answer_id": 54236654, "question_id": 54224260, "link": "https://stackoverflow.com/questions/54224260/generating-multiple-oct-files-from-a-single-cc-source-file-to-interface-a/54236654#54236654", "title": "Generating multiple *.oct* files from a single *.cc* source file to interface a C library to Octave", "body": "<p>I'll start by clarifying the second quote-window in your question. This is not referring specifically to .oct defined functions. What this is implying is the difference between a canonical m-file defined function, and 'on-the-spot' functions defined directly in the console or as part of a script. </p>\n\n<p>As for the first quote-window, when it comes to functions that are defined in .oct files, the situation is different. What it's saying is that you can create an .oct file that defines many functions, but in order to <em>call</em> these functions, there needs to be a <em>file</em> by the same name in your path. So if an .oct file defines functions \"foo\" and \"bar\", you need to have one copy of the .oct file called \"foo.oct\", and another (or, more realistically, as symbolic link to the original) renamed as \"bar.oct\". </p>\n\n<p>Similarly, you can also define a \"foo.m\" and \"bar.m\" file in your workspace, which only contains the documentation for those functions, such that if you then do \"help foo\" or \"help bar\" you get the intended documentation out.</p>\n\n<p>Alternatively, you can use <a href=\"https://octave.org/doc/interpreter/Overloading-and-Autoloading.html\" rel=\"nofollow noreferrer\">autoload</a>, as carandraug suggested.</p>\n"}, {"tags": [], "owner": {"reputation": 596, "user_id": 6152534, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/925595697531599/picture?type=large", "display_name": "Pedro H. N. Vieira", "link": "https://stackoverflow.com/users/6152534/pedro-h-n-vieira"}, "is_accepted": false, "score": 2, "last_activity_date": 1547816925, "creation_date": 1547816925, "answer_id": 54254674, "question_id": 54224260, "link": "https://stackoverflow.com/questions/54224260/generating-multiple-oct-files-from-a-single-cc-source-file-to-interface-a/54254674#54254674", "title": "Generating multiple *.oct* files from a single *.cc* source file to interface a C library to Octave", "body": "<p>Another possibility to generate a C to Octave interface is using <a href=\"http://www.swig.org/Doc3.0/Octave.html\" rel=\"nofollow noreferrer\">SWIG</a> which can generate a single <em>.oct</em> file with all your functions. Refer to <a href=\"http://www.swig.org/Doc3.0/SWIGDocumentation.html#Library_nn3\" rel=\"nofollow noreferrer\">here</a> when using pointers and arrays.</p>\n\n<p>Here is an example:</p>\n\n<p>header</p>\n\n<pre><code>/* File: example.h */\n\nint fact(int n);\n\nint fact2(int n1, int n2);\n\nvoid add(int *x, int *y, int *r);\n</code></pre>\n\n<p>source</p>\n\n<pre><code>/* File: example.c */\n\n#include \"example.h\"\n\nint fact(int n) {\n    if (n &lt; 0){ /* This should probably return an error, but this is simpler */\n        return 0;\n    }\n    if (n == 0) {\n        return 1;\n    }\n    else {\n        /* testing for overflow would be a good idea here */\n        return n * fact(n-1);\n    }\n}\n\nint fact2(int n1, int n2) {\n    return fact(n1)*fact(n2);\n}\n\nvoid add(int *x, int *y, int *r) {\n    *r = *x + *y;\n}\n</code></pre>\n\n<p>interface</p>\n\n<pre><code>/* File example.i */\n%module swigexample\n%include \"cpointer.i\"\n\n%{\n#include \"example.h\"\n%}\n\n%pointer_functions(int, intp)\n\n%include \"example.h\"\n</code></pre>\n\n<p>compile</p>\n\n<pre><code>swig -octave -o swigexample.cpp example.i\nmkoctfile -I. -I/usr/include/octave-4.2.2/ -Iswiglib swigexample.cpp example.c\n</code></pre>\n\n<p>test</p>\n\n<pre><code>% File test.m\nswigexample;\nfact(5)\nfact2(4,4)\n% ==============\na = new_intp();\nintp_assign(a, 37);\nb = new_intp();\nintp_assign(b, 22);\nc = new_intp();\nadd(a,b,c);\nr = intp_value(c);\ndelete_intp(a);\ndelete_intp(b);\ndelete_intp(c);\nr\n</code></pre>\n"}], "owner": {"reputation": 596, "user_id": 6152534, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/925595697531599/picture?type=large", "display_name": "Pedro H. N. Vieira", "link": "https://stackoverflow.com/users/6152534/pedro-h-n-vieira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 1, "accepted_answer_id": 54227229, "answer_count": 4, "score": 3, "last_activity_date": 1547816925, "creation_date": 1547667969, "question_id": 54224260, "link": "https://stackoverflow.com/questions/54224260/generating-multiple-oct-files-from-a-single-cc-source-file-to-interface-a", "title": "Generating multiple *.oct* files from a single *.cc* source file to interface a C library to Octave", "body": "<p>I have a C library that I want to use from within <a href=\"https://www.gnu.org/software/octave/\" rel=\"nofollow noreferrer\">Octave</a>. Following the <a href=\"https://octave.org/doc/v4.2.2/Getting-Started-with-Oct_002dFiles.html#Getting-Started-with-Oct_002dFiles\" rel=\"nofollow noreferrer\">tutorial</a>, it seems straight forward: wrap the functions in C++ then <em>mkoctfile</em> them. The problem is: what if I want to have multiple functions definitions (wrappers) in a single source file?</p>\n\n<p>In the mentioned tutorial it is stated</p>\n\n<blockquote>\n  <p>It should be noted that it is perfectly acceptable to have more than one DEFUN_DLD function in a source file. However, there must either be a symbolic link to the oct-file for each of the functions defined in the source code with the DEFUN_DLD macro or the autoload (<a href=\"https://octave.org/doc/v4.2.2/Function-Files.html#Function-Files\" rel=\"nofollow noreferrer\">Function Files</a>) function should be used.</p>\n</blockquote>\n\n<p>Then in the provided link:</p>\n\n<blockquote>\n  <p>Once Octave finds a file with a name that matches (the called function), the contents of the file are read. If it defines a single function, it is compiled and executed. See <a href=\"https://octave.org/doc/v4.2.2/Script-Files.html#Script-Files\" rel=\"nofollow noreferrer\">Script Files</a>, for more information about how you can define more than one function in a single file.</p>\n</blockquote>\n\n<p>In this second link, there is no info as to how to load a <em>.oct</em> file with multiple functions in it or how to generate multiple <em>.oct</em> files from a single source file. From what I've understood, the later is the correct approach. How can I do that?</p>\n"}, {"tags": ["c++", "xaml", "uwp"], "answers": [{"tags": [], "owner": {"reputation": 7891, "user_id": 6782612, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KuUfK.jpg?s=128&g=1", "display_name": "Xie Steven", "link": "https://stackoverflow.com/users/6782612/xie-steven"}, "is_accepted": false, "score": 0, "last_activity_date": 1547705570, "creation_date": 1547705570, "answer_id": 54229987, "question_id": 54223961, "link": "https://stackoverflow.com/questions/54223961/how-can-i-set-me-uwp-page-to-have-a-constant-width-and-height-at-startup/54229987#54229987", "title": "How can I set me UWP page to have a constant width and height at startup?", "body": "<p>UWP apps do not only run on desktop, it also run on tablet, phone etc. So, what you want to set a fixed size page was not realistic. But you could call the <a href=\"https://docs.microsoft.com/en-us/uwp/api/windows.ui.viewmanagement.applicationview.tryresizeview\" rel=\"nofollow noreferrer\">ApplicationView.TryResizeView(Size) Method</a> to change the size of the view.</p>\n\n<p>If you still want a fixed size of the page during runtime, you could handle the page's <code>SizeChanged</code> event, in its event handler, you could call <code>ApplicationView.TryResizeView</code> method to resize it to the original size.</p>\n"}], "owner": {"reputation": 172, "user_id": 9616687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cd372729d752196e0634e2be4711063?s=128&d=identicon&r=PG&f=1", "display_name": "Jacce", "link": "https://stackoverflow.com/users/9616687/jacce"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 398, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547705570, "creation_date": 1547666659, "question_id": 54223961, "link": "https://stackoverflow.com/questions/54223961/how-can-i-set-me-uwp-page-to-have-a-constant-width-and-height-at-startup", "title": "How can I set me UWP page to have a constant width and height at startup?", "body": "<p>I am creating a UWP app using C++ and XAML. How can I set the app's width and height to be constant?</p>\n\n<p>I am completely new to XAML and I want to create a UWP app using C++/WinRT. I have set the page's width to 500 and the height to 200 but if I resize the page during runtime, and then I restart the app, the size of the page will still be the resized size. For example if I resize the page's width and height too 1000 during runtime (using my cursor to drag the page), when I then restart the app, the page's width and height will still be 1000.</p>\n\n<p>Here is my main.cpp:</p>\n\n<pre><code>#include \"pch.h\"\n\nusing namespace winrt;\n\nusing namespace Windows::ApplicationModel;\nusing namespace Windows::ApplicationModel::Activation;\nusing namespace Windows::Foundation;\nusing namespace Windows::Storage;\nusing namespace Windows::UI::Xaml;\nusing namespace Windows::UI::Xaml::Controls;\nusing namespace Windows::UI::Xaml::Markup;\n\nstruct App : ApplicationT&lt;App&gt; {\n    fire_and_forget OnLaunched(const LaunchActivatedEventArgs&amp;) {\n        const auto packageFolder = Package::Current().InstalledLocation();\n        const auto file = co_await packageFolder.GetFileAsync(L\"MainPage.xaml\");\n        const auto xaml = co_await FileIO::ReadTextAsync(file);\n\n        const auto body = XamlReader::Load(xaml).as&lt;Page&gt;();\n\n        auto window = Window::Current();\n        window.Content(body);\n        window.Activate();\n    }\n};\n\nint __stdcall wWinMain(HINSTANCE, HINSTANCE, PWSTR, int) {\n    Application::Start([](auto&amp;&amp;) {make&lt;App&gt;(); });\n}\n</code></pre>\n\n<p>And here is my MainPage.xaml:</p>\n\n<pre><code>&lt;Page\n xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\n xmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\"\n xmlns:d=\"http://schemas.microsoft.com/expression/blend/2008\"\n xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\"\n mc:Ignorable=\"d\"\n Background=\"{ThemeResource ApplicationPageBackgroundThemeBrush}\" \n Width=\"500\" Height=\"200\"&gt;\n\n&lt;Grid HorizontalAlignment=\"Stretch\" Margin=\"0,0,408,0\" \nVerticalAlignment=\"Stretch\"/&gt;\n&lt;/Page&gt;\n</code></pre>\n\n<p>I would want the app to restore its size each time a start the app. So the width should always be 500 and the height should always be 200 on startup. I have no idea why this happens since I am completely new to this so any help would be appreciated.</p>\n\n<p>Thanks.</p>\n\n<p>Additionally I would want a fixed size of the page during runtime, meaning that the page will not be able to resize during runtime.</p>\n"}, {"tags": ["c++", "c++17", "unique-ptr", "stdmap"], "comments": [{"owner": {"reputation": 10055, "user_id": 2466431, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/gSQh3.png?s=128&g=1", "display_name": "JVApen", "link": "https://stackoverflow.com/users/2466431/jvapen"}, "edited": false, "score": 0, "creation_date": 1547668090, "post_id": 54223750, "comment_id": 95274431, "body": "I don&#39;t understand your question: what are you trying to do with the map and the wrapping?"}, {"owner": {"reputation": 2934, "user_id": 367316, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f09837eb8a4cfaac44c1e08b43f72091?s=128&d=identicon&r=PG", "display_name": "Konrad Eisele", "link": "https://stackoverflow.com/users/367316/konrad-eisele"}, "reply_to_user": {"reputation": 10055, "user_id": 2466431, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/gSQh3.png?s=128&g=1", "display_name": "JVApen", "link": "https://stackoverflow.com/users/2466431/jvapen"}, "edited": false, "score": 0, "creation_date": 1547669044, "post_id": 54223750, "comment_id": 95274868, "body": "@JVApen : I want a map that destroys its items at the end/when overwriting. I\u2019m using the raw pointer outside of the code. I want to get rid of the noise generated by having to wrap/unwrap when saving and also accessing."}, {"owner": {"reputation": 10055, "user_id": 2466431, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/gSQh3.png?s=128&g=1", "display_name": "JVApen", "link": "https://stackoverflow.com/users/2466431/jvapen"}, "edited": false, "score": 1, "creation_date": 1547669149, "post_id": 54223750, "comment_id": 95274918, "body": "Why would you want to prefer raw pointers over the unique one?"}, {"owner": {"reputation": 2934, "user_id": 367316, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f09837eb8a4cfaac44c1e08b43f72091?s=128&d=identicon&r=PG", "display_name": "Konrad Eisele", "link": "https://stackoverflow.com/users/367316/konrad-eisele"}, "reply_to_user": {"reputation": 10055, "user_id": 2466431, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/gSQh3.png?s=128&g=1", "display_name": "JVApen", "link": "https://stackoverflow.com/users/2466431/jvapen"}, "edited": false, "score": 0, "creation_date": 1547669600, "post_id": 54223750, "comment_id": 95275106, "body": "@JVApen: dont need unique pointers ouside of the map code. Lifecycle is managed  in the map only. It would be ideal if c++ standard had a quailifier called &#39;unique&#39; for pointers and C++ could do it transparently.."}], "answers": [{"comments": [{"owner": {"reputation": 2934, "user_id": 367316, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f09837eb8a4cfaac44c1e08b43f72091?s=128&d=identicon&r=PG", "display_name": "Konrad Eisele", "link": "https://stackoverflow.com/users/367316/konrad-eisele"}, "edited": false, "score": 0, "creation_date": 1547669955, "post_id": 54223914, "comment_id": 95275295, "body": "It seems that I need to write a derivate of <code>std::map</code> myself then."}], "tags": [], "owner": {"reputation": 82712, "user_id": 598696, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/k1Yif.png?s=128&g=1", "display_name": "Vittorio Romeo", "link": "https://stackoverflow.com/users/598696/vittorio-romeo"}, "is_accepted": false, "score": 1, "last_activity_date": 1547666502, "creation_date": 1547666502, "answer_id": 54223914, "question_id": 54223750, "link": "https://stackoverflow.com/questions/54223750/is-there-a-transparent-way-of-using-unique-ptr-in-std-containers/54223914#54223914", "title": "Is there a transparent way of using unique_ptr in std containers?", "body": "<blockquote>\n  <p>I'd like to use <code>tbl.insert({id,m});</code> and <code>tbl[id] = m;</code> instead of having to wrap/unwrap for each access.</p>\n</blockquote>\n\n<p>Why? This hides information from the reader. It is important to know whether something is dynamically allocated or not.</p>\n\n<hr>\n\n<blockquote>\n  <p>Are there implementations of std containers for unique_ptr? In particular <code>std::map</code>.</p>\n</blockquote>\n\n<p>Not in the Standard Library.</p>\n\n<hr>\n\n<blockquote>\n  <p>How would a transparent interface be implemented?</p>\n</blockquote>\n\n<p>Store a normal container inside your wrapper, provide forwarding functions that create <code>unique_ptr</code> where required. Iterators could unwrap automatically. E.g.</p>\n\n<pre><code>template &lt;typename T&gt;\nclass unique_ptr_vector\n{\n    std::vector&lt;std::unique_ptr&lt;T&gt;&gt; _data;\n\npublic:\n    template &lt;typename... Ts&gt;\n    void emplace_back(Ts&amp;&amp;... xs)\n    {\n        _data.emplace_back(std::make_unique&lt;T&gt;(std::forward&lt;Ts&gt;(xs)...));\n    }\n};\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4113, "user_id": 97235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e69fb9d384d7714d070d3320d932520?s=128&d=identicon&r=PG", "display_name": "Drew Hoskins", "link": "https://stackoverflow.com/users/97235/drew-hoskins"}, "is_accepted": false, "score": 10, "last_activity_date": 1548197738, "last_edit_date": 1548197738, "creation_date": 1547666819, "answer_id": 54223996, "question_id": 54223750, "link": "https://stackoverflow.com/questions/54223750/is-there-a-transparent-way-of-using-unique-ptr-in-std-containers/54223996#54223996", "title": "Is there a transparent way of using unique_ptr in std containers?", "body": "<p>Generally, we don't want to implicitly create <code>std::unique_ptr</code> because <a href=\"https://stackoverflow.com/questions/34882140/why-cant-a-pointer-be-automatically-converted-into-a-unique-ptr-when-returning/34886264\">that can be dangerous</a>.</p>\n\n<p>In this sample, I'd recommend starting out with a <code>unique_ptr</code> rather than a bare <code>new</code>.  This <a href=\"https://stackoverflow.com/questions/37514509/advantages-of-using-stdmake-unique-over-new-operator\">makes sure the entire lifetime is tracked</a>.</p>\n\n<pre><code>#include &lt;memory&gt;\nint main(int argc, char **argv) {\n    auto m = std::make_unique&lt;method&gt;();\n    insert(1, std::move(m));\n}\n</code></pre>\n\n<p>within <code>insert</code> you can also use <code>std::move</code> to transfer ownership to the collection.</p>\n"}, {"tags": [], "owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "is_accepted": true, "score": 3, "last_activity_date": 1547739768, "last_edit_date": 1547739768, "creation_date": 1547674992, "answer_id": 54225846, "question_id": 54223750, "link": "https://stackoverflow.com/questions/54223750/is-there-a-transparent-way-of-using-unique-ptr-in-std-containers/54225846#54225846", "title": "Is there a transparent way of using unique_ptr in std containers?", "body": "<p>When you pass a raw pointer into a function, it is generally unknown who is expected to keep ownership of the pointed-to object when the function exits - the caller or the callee.  There is nothing in the language to specify or enforce that.</p>\n\n<p>So, it is generally good practice to pass in a raw pointer only when the callee reads or modifies the object but the caller is expected to maintain ownership.</p>\n\n<p>In your example, that is not the case.  You want your functions to take ownership of the allocated <code>method</code> objects.  So, you should change your functions to pass in <code>std::unique_ptr&lt;method&gt;</code> objects by value, instead of passing raw <code>method*</code> pointers.  That makes it very explicit that ownership is expected to pass from the caller to the callee, eg:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;memory&gt;\n#include &lt;map&gt;\n\nstruct method {\n    virtual ~method() { std::cout &lt;&lt; \"f\\n\"; };\n};\ntypedef std::unique_ptr&lt;method&gt; MPTR;\n\nstd::map&lt;int, MPTR&gt; tbl;\n\nvoid insert(int id, MPTR m) {\n    tbl.insert(std::make_pair(id, std::move(m)));\n};\n\nvoid set(int id, MPTR m) {\n    tbl[id] = std::move(m);\n};\n\nint main()\n{\n    insert(1, MPTR(new method)); // or insert(1, std:::make_unique&lt;method&gt;()) in C++14 and later\n    set(1, MPTR(new method)); // or set(1, std:::make_unique&lt;method&gt;()) in C++14 and later\n    return 0;                                                                                                                               \n}\n</code></pre>\n\n<p><a href=\"https://ideone.com/ZaF7K4\" rel=\"nofollow noreferrer\">Live demo</a></p>\n"}], "owner": {"reputation": 2934, "user_id": 367316, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f09837eb8a4cfaac44c1e08b43f72091?s=128&d=identicon&r=PG", "display_name": "Konrad Eisele", "link": "https://stackoverflow.com/users/367316/konrad-eisele"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 551, "favorite_count": 0, "accepted_answer_id": 54225846, "answer_count": 3, "score": 2, "last_activity_date": 1548197738, "creation_date": 1547665745, "last_edit_date": 1547667296, "question_id": 54223750, "link": "https://stackoverflow.com/questions/54223750/is-there-a-transparent-way-of-using-unique-ptr-in-std-containers", "title": "Is there a transparent way of using unique_ptr in std containers?", "body": "<p>Is there a transparent way of using <code>std::unique_ptr</code> in  containers? </p>\n\n<pre><code>#include &lt;iostream&gt;                                                                                                                         \n#include &lt;memory&gt;                                                                                                                           \n#include &lt;map&gt;                                                                                                                              \n\nstruct method {                                                                                                                             \n    virtual ~method() { std::cout &lt;&lt; \"f\\n\"; };                                                                                              \n};                                                                                                                                          \ntypedef std::unique_ptr&lt;method&gt; MPTR;                                                                                                       \n\nstd::map&lt;int, MPTR&gt; tbl;                                                                                                                    \n\nvoid insert(int id, method *m) {                                                                                                            \n    tbl.insert({id,std::unique_ptr&lt;method&gt;(m)});                                                                                            \n};                                                                                                                                          \n\nvoid set(int id, method *m) {                                                                                                               \n    tbl[id] = std::unique_ptr&lt;method&gt;(m);                                                                                                   \n};                                                                                                                                          \n\nint main(int argc, char **argv) {                                                                                                           \n\n    insert(1,new method());                                                                                                                 \n    set(1,new method());                                                                                                                    \n    return 0;                                                                                                                               \n}   \n</code></pre>\n\n<p>I'd like to use <code>tbl.insert({id,m});</code> and <code>tbl[id] = m;</code> etc. instead of having to wrap/unwrap for each access.</p>\n\n<ul>\n<li>Are there implementations of std containers for unique_ptr? In particular <code>std::map</code>.</li>\n<li>How would a transparent interface be implemented?</li>\n</ul>\n"}, {"tags": ["c++", "qt", "cmake", "quazip"], "comments": [{"owner": {"reputation": 2122, "user_id": 1182648, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1631e4de89a74e792dd29621ee9ea954?s=128&d=identicon&r=PG", "display_name": "lapkritinis", "link": "https://stackoverflow.com/users/1182648/lapkritinis"}, "edited": false, "score": 0, "creation_date": 1547665609, "post_id": 54223593, "comment_id": 95273309, "body": "Post some code what have you tried"}, {"owner": {"reputation": 3, "user_id": 10924163, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DzrxPGjaID8/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcaIHNTI4SHegk3ey3e1GAhMnm9i3g/mo/photo.jpg?sz=128", "display_name": "dipatov", "link": "https://stackoverflow.com/users/10924163/dipatov"}, "reply_to_user": {"reputation": 2122, "user_id": 1182648, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1631e4de89a74e792dd29621ee9ea954?s=128&d=identicon&r=PG", "display_name": "lapkritinis", "link": "https://stackoverflow.com/users/1182648/lapkritinis"}, "edited": false, "score": 0, "creation_date": 1547665845, "post_id": 54223593, "comment_id": 95273419, "body": "Ok, I laid out all my CMakeLists"}, {"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1547669516, "post_id": 54223593, "comment_id": 95275070, "body": "You show the code which uses <code>quazip</code>, what is a <b>problem</b> with it? If it produces an error, then add this error into the question post."}, {"owner": {"reputation": 3, "user_id": 10924163, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DzrxPGjaID8/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcaIHNTI4SHegk3ey3e1GAhMnm9i3g/mo/photo.jpg?sz=128", "display_name": "dipatov", "link": "https://stackoverflow.com/users/10924163/dipatov"}, "edited": false, "score": 0, "creation_date": 1547670056, "post_id": 54223593, "comment_id": 95275349, "body": "Ok. I added it)"}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 10924163, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DzrxPGjaID8/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcaIHNTI4SHegk3ey3e1GAhMnm9i3g/mo/photo.jpg?sz=128", "display_name": "dipatov", "link": "https://stackoverflow.com/users/10924163/dipatov"}, "edited": false, "score": 0, "creation_date": 1547673897, "post_id": 54225310, "comment_id": 95277089, "body": "Thanks. Can you help me, please, how to include JlCompress in my project?"}, {"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "reply_to_user": {"reputation": 3, "user_id": 10924163, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DzrxPGjaID8/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcaIHNTI4SHegk3ey3e1GAhMnm9i3g/mo/photo.jpg?sz=128", "display_name": "dipatov", "link": "https://stackoverflow.com/users/10924163/dipatov"}, "edited": false, "score": 0, "creation_date": 1547674683, "post_id": 54225310, "comment_id": 95277431, "body": "What is wrong with <code>#include &lt;JlCompress.h&gt;</code>, as shown <a href=\"http://quazip.sourceforge.net/classJlCompress.html\" rel=\"nofollow noreferrer\">there</a>?"}, {"owner": {"reputation": 3, "user_id": 10924163, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DzrxPGjaID8/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcaIHNTI4SHegk3ey3e1GAhMnm9i3g/mo/photo.jpg?sz=128", "display_name": "dipatov", "link": "https://stackoverflow.com/users/10924163/dipatov"}, "edited": false, "score": 0, "creation_date": 1547675230, "post_id": 54225310, "comment_id": 95277666, "body": "Exception, that &quot;No such file or directory&quot;"}, {"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "reply_to_user": {"reputation": 3, "user_id": 10924163, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DzrxPGjaID8/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcaIHNTI4SHegk3ey3e1GAhMnm9i3g/mo/photo.jpg?sz=128", "display_name": "dipatov", "link": "https://stackoverflow.com/users/10924163/dipatov"}, "edited": false, "score": 0, "creation_date": 1547675969, "post_id": 54225310, "comment_id": 95277966, "body": "Strange. What content of <code>QUAZIP_INCLUDE_DIRS</code> is? (You may print the variable&#39;s value with <code>message(&quot;${QUAZIP_INCLUDE_DIRS}&quot;)</code>. Check that one of the directories, listed in that variable, contains <code>JlCompress.h</code> file."}, {"owner": {"reputation": 3, "user_id": 10924163, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DzrxPGjaID8/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcaIHNTI4SHegk3ey3e1GAhMnm9i3g/mo/photo.jpg?sz=128", "display_name": "dipatov", "link": "https://stackoverflow.com/users/10924163/dipatov"}, "edited": false, "score": 0, "creation_date": 1547676427, "post_id": 54225310, "comment_id": 95278171, "body": "I wrote D:\\quazip-0.7.3\\quazip"}, {"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "reply_to_user": {"reputation": 3, "user_id": 10924163, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DzrxPGjaID8/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcaIHNTI4SHegk3ey3e1GAhMnm9i3g/mo/photo.jpg?sz=128", "display_name": "dipatov", "link": "https://stackoverflow.com/users/10924163/dipatov"}, "edited": false, "score": 0, "creation_date": 1547712717, "post_id": 54225310, "comment_id": 95287889, "body": "&quot;I wrote D:\\quazip-0.7.3\\quazip&quot; - What does it mean in the context of my previous comment?"}, {"owner": {"reputation": 3, "user_id": 10924163, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DzrxPGjaID8/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcaIHNTI4SHegk3ey3e1GAhMnm9i3g/mo/photo.jpg?sz=128", "display_name": "dipatov", "link": "https://stackoverflow.com/users/10924163/dipatov"}, "edited": false, "score": 0, "creation_date": 1547716927, "post_id": 54225310, "comment_id": 95290082, "body": "I have corrected to <code>${QUAZIP_LIBRARIES}</code>, but now my project found `&lt;JlCompress.h&gt; , but when I was building, my project had a lot of exceptions, but when I was building with qMake, I didn&#39;t have exceptions"}], "tags": [], "owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "is_accepted": true, "score": 0, "last_activity_date": 1547672452, "creation_date": 1547672452, "answer_id": 54225310, "question_id": 54223593, "link": "https://stackoverflow.com/questions/54223593/how-to-connect-the-quazip-library-in-cmake/54225310#54225310", "title": "How to connect the QuaZip library in CMake", "body": "<p>The find script for quazip is named <a href=\"https://github.com/stachenov/quazip/blob/master/FindQuaZip.cmake\" rel=\"nofollow noreferrer\">FindQuaZip5.cmake</a> (it is renamed during installation). So for find <code>quazip</code> you need to use</p>\n\n<pre><code>find_package(QuaZip5)\n</code></pre>\n\n<p>Meaning of the find script is described in its head:</p>\n\n<pre><code># QUAZIP_FOUND               - QuaZip library was found\n# QUAZIP_INCLUDE_DIR         - Path to QuaZip include dir\n# QUAZIP_INCLUDE_DIRS        - Path to QuaZip and zlib include dir (combined from QUAZIP_INCLUDE_DIR + ZLIB_INCLUDE_DIR)\n# QUAZIP_LIBRARIES           - List of QuaZip libraries\n# QUAZIP_ZLIB_INCLUDE_DIR    - The include dir of zlib headers\n</code></pre>\n\n<p>That is, for use <code>quazip</code> with <code>zlib</code> in your code, add these lines:</p>\n\n<pre><code>include_directories(${QUAZIP_INCLUDE_DIRS})\ntarget_link_libraries(${PROJECT_NAME} ${QUAZIP_LIBRARIES})\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 10924163, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DzrxPGjaID8/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcaIHNTI4SHegk3ey3e1GAhMnm9i3g/mo/photo.jpg?sz=128", "display_name": "dipatov", "link": "https://stackoverflow.com/users/10924163/dipatov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1183, "favorite_count": 0, "accepted_answer_id": 54225310, "answer_count": 1, "score": 0, "last_activity_date": 1547716377, "creation_date": 1547665106, "last_edit_date": 1547716377, "question_id": 54223593, "link": "https://stackoverflow.com/questions/54223593/how-to-connect-the-quazip-library-in-cmake", "title": "How to connect the QuaZip library in CMake", "body": "<p>My project uses the QuaZip library, and I need to build the project through CMake. How to add this library to CMakeLists? \nFrom the library I need JlCompress</p>\n\n<p>My CMakeLists:</p>\n\n<pre><code>cmake_minimum_required(VERSION 3.6)\n#set_property(GLOBAL PROPERTY USE_FOLDERS ON)\n#set_property(GLOBAL PROPERTY PREDEFINED_TARGETS_FOLDER \"cmake\")\n\nset(Boost_USE_STATIC_LIBS OFF)\nset(Boost_USE_MULTITHREADED ON)\n\nproject(Archiver LANGUAGES CXX)\n\nset(CMAKE_INCLUDE_CURRENT_DIR ON)\n\nfind_package(Qt5 REQUIRED COMPONENTS Core Widgets Gui)\nfind_package(zlib)\nfind_package(QuaZip5)\ninclude_directories(${QUAZIP_INCLUDE_DIRS})\n\nset(project_ui\n    mainwindow.ui)\nset(project_headers\n    archive.h\n    mainwindow.h)\nset(project_sources\n    main.cpp\n    archive.cpp\n    mainwindow.cpp)\n\nqt5_wrap_ui(project_headers_wrapped ${project_ui})\nqt5_wrap_cpp(project_sources_moc ${project_headers})\n\nadd_executable(${PROJECT_NAME} ${project_headers} ${project_sources} \n    ${project_sources_moc} ${project_headers_wrapped})\n\ntarget_link_libraries(${PROJECT_NAME} \n    PUBLIC \n    Qt5::Core\n    Qt5::Gui\n    Qt5::Widgets\n    ${QUAZIP_LIBRARIES}\n)\n</code></pre>\n\n<p>Build error:</p>\n\n<blockquote>\n  <p>CMake Warning at CMakeLists.txt:13 (find_package):   By not providing\n  \"Findquazip.cmake\" in CMAKE_MODULE_PATH this project has   asked CMake\n  to find a package configuration file provided by \"quazip\", but   CMake\n  did not find one.</p>\n  \n  <p>Could not find a package configuration file provided by \"quazip\"\n  with any   of the following names:</p>\n\n<pre><code>quazipConfig.cmake\nquazip-config.cmake\n</code></pre>\n  \n  <p>Add the installation prefix of \"quazip\" to CMAKE_PREFIX_PATH or set \n  \"quazip_DIR\" to a directory containing one of the above files.  If\n  \"quazip\"   provides a separate development package or SDK, be sure it\n  has been   installed.</p>\n  \n  <p>CMake Error at CMakeLists.txt:37 (target_link_libraries):   The\n  keyword signature for target_link_libraries has already been used with\n  the target \"Archiver\".  All uses of target_link_libraries with a\n  target   must be either all-keyword or all-plain.</p>\n  \n  <p>The uses of the keyword signature are here:</p>\n  \n  <ul>\n  <li>CMakeLists.txt:31 (target_link_libraries)</li>\n  </ul>\n</blockquote>\n"}, {"tags": ["c++", "destructor"], "comments": [{"owner": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 2, "creation_date": 1547664512, "post_id": 54223415, "comment_id": 95272783, "body": "A better reference site: <a href=\"https://cppreference.com/\" rel=\"nofollow noreferrer\">cppreference.com</a>"}, {"owner": {"reputation": 119, "user_id": 4749176, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-LRG7VDHPVdI/AAAAAAAAAAI/AAAAAAAABGI/fEcKsVWz1EE/photo.jpg?sz=128", "display_name": "Samueljh1", "link": "https://stackoverflow.com/users/4749176/samueljh1"}, "reply_to_user": {"reputation": 17343, "user_id": 445976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c82b2b9bdcf1baaf4677238d59cf745f?s=128&d=identicon&r=PG", "display_name": "Blastfurnace", "link": "https://stackoverflow.com/users/445976/blastfurnace"}, "edited": false, "score": 0, "creation_date": 1547665039, "post_id": 54223415, "comment_id": 95273039, "body": "@Blastfurnace yes, sorry that was what I had meant. Sorry for the confusion."}, {"owner": {"reputation": 2647, "user_id": 9829403, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-RvgmsYSS48c/AAAAAAAAAAI/AAAAAAAAAAw/pUPnPAhmDec/photo.jpg?sz=128", "display_name": "Tim Randall", "link": "https://stackoverflow.com/users/9829403/tim-randall"}, "edited": false, "score": 1, "creation_date": 1547667892, "post_id": 54223415, "comment_id": 95274346, "body": "You&#39;d learn more if you printed the value of <code>this</code> as well as <code>id</code>"}, {"owner": {"reputation": 119, "user_id": 4749176, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-LRG7VDHPVdI/AAAAAAAAAAI/AAAAAAAABGI/fEcKsVWz1EE/photo.jpg?sz=128", "display_name": "Samueljh1", "link": "https://stackoverflow.com/users/4749176/samueljh1"}, "edited": false, "score": 0, "creation_date": 1547668216, "post_id": 54223415, "comment_id": 95274485, "body": "@TimRandallYeah, good point. Just did that now which helped me understand more about those temporary instances."}], "answers": [{"comments": [{"owner": {"reputation": 119, "user_id": 4749176, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-LRG7VDHPVdI/AAAAAAAAAAI/AAAAAAAABGI/fEcKsVWz1EE/photo.jpg?sz=128", "display_name": "Samueljh1", "link": "https://stackoverflow.com/users/4749176/samueljh1"}, "edited": false, "score": 0, "creation_date": 1547664991, "post_id": 54223496, "comment_id": 95273022, "body": "Ok that part about the temporary values makes sense. The only thing that doesn&#39;t add up is if this was always the case, how come we don&#39;t get the destructor call for Object 1 when <code>Test x = Test(1);</code> is executed? Is this because it is an initialization rather than a reassignment?"}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "reply_to_user": {"reputation": 119, "user_id": 4749176, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-LRG7VDHPVdI/AAAAAAAAAAI/AAAAAAAABGI/fEcKsVWz1EE/photo.jpg?sz=128", "display_name": "Samueljh1", "link": "https://stackoverflow.com/users/4749176/samueljh1"}, "edited": false, "score": 0, "creation_date": 1547665405, "post_id": 54223496, "comment_id": 95273215, "body": "In modern c++ that line is equivalent to <code>Text x(1);</code>. It <i>looks</i> like it&#39;s creating a temporary and then initializing <code>x</code> with it, but the standard requires that this &quot;temporary&quot; (<a href=\"https://en.cppreference.com/w/cpp/language/value_category#prvalue\" rel=\"nofollow noreferrer\">prvalue</a>) never exist in the first place. This occurs when you try to copy initialize an object from a temporary object of the same type. It instead initializes the object directly with the same arguments as you would have used for the temporary."}, {"owner": {"reputation": 2647, "user_id": 9829403, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-RvgmsYSS48c/AAAAAAAAAAI/AAAAAAAAAAw/pUPnPAhmDec/photo.jpg?sz=128", "display_name": "Tim Randall", "link": "https://stackoverflow.com/users/9829403/tim-randall"}, "edited": false, "score": 0, "creation_date": 1547668001, "post_id": 54223496, "comment_id": 95274389, "body": "Maybe emphasize that whereas OP talks about &quot; the destructor for Object 2 &quot; it&#39;s important to realize that <i>there is no Object 2</i>. An object&#39;s current value is not its identity"}, {"owner": {"reputation": 119, "user_id": 4749176, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-LRG7VDHPVdI/AAAAAAAAAAI/AAAAAAAABGI/fEcKsVWz1EE/photo.jpg?sz=128", "display_name": "Samueljh1", "link": "https://stackoverflow.com/users/4749176/samueljh1"}, "edited": false, "score": 0, "creation_date": 1547668938, "post_id": 54223496, "comment_id": 95274826, "body": "Ok thanks for clearing that up. I understand what is going on now and the importance of cleaning up resources even in assignment operator overloads, thanks!"}], "tags": [], "owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "is_accepted": true, "score": 4, "last_activity_date": 1547664688, "creation_date": 1547664688, "answer_id": 54223496, "question_id": 54223415, "link": "https://stackoverflow.com/questions/54223415/c-destructor-called-for-the-wrong-object/54223496#54223496", "title": "C++ Destructor called for the wrong object?", "body": "<blockquote>\n  <p>Using the debugger, Created 2 and Destroyed 2 both display when the line x = Test(2); is called. If we just assigned x to Object 2, why is its destructor being called immediately? This follows on to the next part.</p>\n</blockquote>\n\n<p>The line <code>x = Test(2);</code> first create a <code>Test</code> with the constructor argument <code>2</code>. This is what produces <code>Created 2</code>. This nameless <code>Test</code> is then assigned to <code>x</code> which gives <code>x.id</code> the value 2. That nameless <code>Test</code> is then destroyed at the end of the expression, producing \"Destroyed 2\".</p>\n\n<blockquote>\n  <p>Secondly, since the destructor for Object 2 has been called, we can assume it has been destroyed. The next output of 2 seems to contradict this, as it suggests that x is still holding Object 2 (expected, but contradicted by the call of its destructor).</p>\n</blockquote>\n\n<p>As expressed in the first part of this answer, it's not <code>x</code> that is destroyed but the temporary <code>Temp</code>. <code>x.id</code> is still valid and will yield it's new value, 2.</p>\n\n<blockquote>\n  <p>Finally, Destroyed 2 is outputted. This would make sense if we didn't see this earlier. Object 2 is stored in x, so when it goes out of scope the destructor is called.</p>\n</blockquote>\n\n<p>This happens when <code>x</code> is destroyed at the end of the function. It's <code>id</code> value was changed to 2 by the previous assignment, so it produces \"Destroyed 2\".</p>\n\n<blockquote>\n  <p>1: Why is this weird behaviour occurring, and is there any logical reason to why it is? </p>\n</blockquote>\n\n<p>It may not be the behavior you expected, but it's not weird. I hope this answer will help you understand why it's occurring.</p>\n\n<blockquote>\n  <p>2: Does 'overriding' an object (e.g. Object 1) with another object (Object 2) by assignment lead to its destructor (in this case the destructor of Object 1) to be called or not?</p>\n</blockquote>\n\n<p>Assigning to an object does not destroy it. It replaces it's value with a new one and in that sense \"destroys\" the <em>value</em> it previously help but the actual object instance is not destroyed and the destructor is not involved.</p>\n\n<p>Edit : It seems you may be concerned with resource leaks. Since no resources are being managed by <code>Test</code> there will be no leaks and the compiler generated members will behave fine. If your class <em>does</em> manage resources (usually in the form of dynamically allocated memory) then you will need to apply the <a href=\"https://en.cppreference.com/w/cpp/language/rule_of_three\" rel=\"nofollow noreferrer\">rule of 3/5/0</a>. Notably you will need to implement the assignment operator yourself such that it cleans up any previously held resources. It's not enough to implement just the destructor as it's not involved in assignment.</p>\n"}, {"comments": [{"owner": {"reputation": 119, "user_id": 4749176, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-LRG7VDHPVdI/AAAAAAAAAAI/AAAAAAAABGI/fEcKsVWz1EE/photo.jpg?sz=128", "display_name": "Samueljh1", "link": "https://stackoverflow.com/users/4749176/samueljh1"}, "edited": false, "score": 0, "creation_date": 1547668847, "post_id": 54223606, "comment_id": 95274779, "body": "Thank you for the explanation. That instance counter really helped, so now I understand why you need to handle deletes from within the assignment operator. Thanks :)"}], "tags": [], "owner": {"reputation": 19779, "user_id": 878532, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/5fbebb625a289267abd098c0e676c760?s=128&d=identicon&r=PG", "display_name": "Klaus", "link": "https://stackoverflow.com/users/878532/klaus"}, "is_accepted": false, "score": 2, "last_activity_date": 1547666024, "last_edit_date": 1547666024, "creation_date": 1547665176, "answer_id": 54223606, "question_id": 54223415, "link": "https://stackoverflow.com/questions/54223415/c-destructor-called-for-the-wrong-object/54223606#54223606", "title": "C++ Destructor called for the wrong object?", "body": "<pre><code>Test x = Test(1);\n</code></pre>\n\n<p>This creates a new object with the value of \"1\".</p>\n\n<pre><code>x = Test(2);\n</code></pre>\n\n<p>This first creates a new object with value of \"2\" and after that it will be assigned\nto the first object with assignment operator which is implicitly created for your class! In this moment, you have two objects, both having the value of 2!</p>\n\n<p>To get a better idea you can do this:</p>\n\n<pre><code>class Test{\n    public:\n        static int instanceCount;\n        int id;\n        int count;\n\n        explicit Test(int id) : id{id}, count{instanceCount++} {\n            std::cout &lt;&lt; \"Created \" &lt;&lt; id &lt;&lt; \" \" &lt;&lt; count &lt;&lt; std::endl;\n        }\n\n        ~Test() {\n            std::cout &lt;&lt; \"Destroyed \" &lt;&lt; id &lt;&lt; \" \" &lt;&lt; count &lt;&lt; std::endl;\n        }\n\n        //Test&amp; operator=(const Test&amp;) = delete;\n        Test&amp; operator=(const Test&amp; ex) \n        {\n            id=ex.id;\n            return *this;\n        }\n};  \n\n\nint Test::instanceCount = 0;\n\nint main() {\n    Test x = Test{1};\n    x = Test{2};\n\n    std::cout &lt;&lt; x.id &lt;&lt; std::endl; \n    return 0;\n}  \n</code></pre>\n\n<p>Now you can see when a new instance is created. If you delete the assignment operator for your class, you will see that the first instruction you wrote \"Test x = Test{1};\" is NOT an assignment but construction. The second one \"x = Test{2};\" will fail, as you have deleted the operator now.</p>\n\n<p>The output is as follows:</p>\n\n<pre><code>Created 1 0\nCreated 2 1\nDestroyed 2 1\n2\nDestroyed 2 0\n</code></pre>\n\n<p>As you see, you get first a instance with count 0 and your value 1. The second temporary instance is then created as count 1 with your value of 2.\nThen this one will be assigned to the first one and the temporary instance will be deleted before your std::cout will happen! In the moment you left the main function scope, the first instance will be deleted!</p>\n\n<p>What you can learn:</p>\n\n<ul>\n<li>creation of an object with <code>X x=X(3);</code> is the same as writing <code>X x(3);</code></li>\n<li>if you have not written manually a assignment operator, you will may get a default one, depending on some more rules ( to broad here ).</li>\n<li>you should see that you create temporary objects here which will\nbe created and deleted \"on the fly\" but having a cost at all which can be avoided in most cases!</li>\n<li>you should <em>not</em> use <code>using namespace std</code> !</li>\n<li>you should write <code>X x{3} instead of</code>X x(3)`</li>\n<li>writing <code>X x=X(3);</code> is totally confusing, as it looks like you construct a temporary and than assign it to a default constructed one. But this will not happen and so you should write your code simpler instead!</li>\n</ul>\n"}], "owner": {"reputation": 119, "user_id": 4749176, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-LRG7VDHPVdI/AAAAAAAAAAI/AAAAAAAABGI/fEcKsVWz1EE/photo.jpg?sz=128", "display_name": "Samueljh1", "link": "https://stackoverflow.com/users/4749176/samueljh1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 191, "favorite_count": 0, "accepted_answer_id": 54223496, "answer_count": 2, "score": 0, "last_activity_date": 1547666024, "creation_date": 1547664260, "last_edit_date": 1547665077, "question_id": 54223415, "link": "https://stackoverflow.com/questions/54223415/c-destructor-called-for-the-wrong-object", "title": "C++ Destructor called for the wrong object?", "body": "<p>I am new to C++ and I wrote a small program to learn about how assignment works with objects. I was prompted to do this from the cpp docs at this page (<a href=\"http://www.cplusplus.com/doc/tutorial/classes2/\" rel=\"nofollow noreferrer\">http://www.cplusplus.com/doc/tutorial/classes2/</a>). On this page it states:</p>\n\n<blockquote>\n  <p>The implicit version <em>[of the copy assignment operator]</em> performs a shallow copy which is suitable for many classes, but not for classes with pointers to objects they handle its storage. In this case, not only the class incurs the risk of deleting the pointed object twice, but <strong>the assignment creates memory leaks by not deleting the object pointed by the object before the assignment</strong>.</p>\n</blockquote>\n\n<p>The final part which I have formatted in bold is why I had decided to test things out. I thought that this problem could be solved by handling the deletion of pointed objects in the destructor (which is standard?), rather than having to overload the copy assignment operator. If the destructor is not being called, then isn't that really inconvenient? Say I had multiple referenced objects, I would have to put all the deletes in both the destructor (for most cases of reallocation) and also in the assignment overload. </p>\n\n<p>During this test, I encountered an entirely different problem. My initial idea was to create a simple class which stores an int (as an identifier for testing purposes) and overload the constructors and destructors to see when and if the destructor was being called.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>class Test{\npublic:\n    int id;\n    explicit Test(int id) : id(id) {\n        cout &lt;&lt; \"Created \" &lt;&lt; id &lt;&lt; endl;\n    }\n    ~Test() {\n        cout &lt;&lt; \"Destroyed \" &lt;&lt; id &lt;&lt; endl;\n    }\n};\n\nint main() {\n    Test x = Test(1);\n    x = Test(2);\n\n    cout &lt;&lt; x.id &lt;&lt; endl;\n    return 0;\n}\n</code></pre>\n\n<p>The output I would have expected was to be:</p>\n\n<p>1: <code>Created 1</code><br/>\n2: <code>Destroyed 1</code> ? (this was the one I was unsure of as the website hinted this destructor would not be called if the object was 'replaced' with another rather than going out of scope)<br/>\n3: <code>Created 2</code> Object 2 'replaces' object 1 as it is assigned to x<br/>\n4: <code>2</code> the value of Object 2's id printed out<br/>\n5: <code>Destroyed 2</code> Object 2 destroyed as it goes out of scope</p>\n\n<p>Instead, i got the following output:</p>\n\n<pre><code>Created 1\nCreated 2\nDestroyed 2\n2\nDestroyed 2\n</code></pre>\n\n<p>This really does not make sense to me.</p>\n\n<p>Using the debugger, <code>Created 2</code> and <code>Destroyed 2</code> both display when the line <code>x = Test(2);</code> is called. If we just assigned <code>x</code> to Object 2, why is its destructor being called immediately? This follows on to the next part.</p>\n\n<p>Secondly, since the destructor for Object 2 has been called, we can assume it has been destroyed. The next output of <code>2</code> seems to contradict this, as it suggests that <code>x</code> is still holding Object 2 (expected, but contradicted by the call of its destructor).</p>\n\n<p>I'm not too sure why this is happening.</p>\n\n<p>Finally, <code>Destroyed 2</code> is outputted. This would make sense if we didn't see this earlier. Object 2 is stored in <code>x</code>, so when it goes out of scope the destructor is called.</p>\n\n<p>For some reason we get the destructor called twice, and Object 1, which is 'overridden' by the assignment of Object 2 to <code>x</code> never has its destructor called, but instead the destructor of the object we just created has its destructor called.</p>\n\n<p>So... this sums up to a two-part question:</p>\n\n<p>1: Why is this weird behaviour occurring, and is there any logical reason to why it is? <br/>\n2: Does 'overwriting' an object (e.g. Object 1) with another object (Object 2) by assignment lead to its destructor (in this case the destructor of Object 1) to be called or not?</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["c++", "stl", "c++17"], "comments": [{"owner": {"reputation": 83151, "user_id": 3943312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc00b38b94ca7b6f820622b0a8af8ded?s=128&d=identicon&r=PG", "display_name": "Sam Varshavchik", "link": "https://stackoverflow.com/users/3943312/sam-varshavchik"}, "edited": false, "score": 1, "creation_date": 1547662567, "post_id": 54222962, "comment_id": 95271886, "body": "Pretty sure that variant&#39;s comparison overload compares <b><i>which</i></b> alternatives are in both variants, and then compares them directly only if both variants have the same underlying type. I.e. it compares <code>index</code>() first."}, {"owner": {"reputation": 21009, "user_id": 1896169, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/jap8U.png?s=128&g=1", "display_name": "Justin", "link": "https://stackoverflow.com/users/1896169/justin"}, "edited": false, "score": 1, "creation_date": 1547662585, "post_id": 54222962, "comment_id": 95271898, "body": "FWIW, <a href=\"https://en.cppreference.com/w/cpp/utility/variant/visit\" rel=\"nofollow noreferrer\"><code>std::visit</code></a> can visit multiple variants at once, so that first snippet can be <code>std::visit([](auto const&amp; lhs, auto const&amp; rhs) { return lhs.area() &lt; rhs.area(); }, a, b)</code>"}, {"owner": {"reputation": 142, "user_id": 10923857, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c34d0bbd201d9b8aa373fb7209aa646?s=128&d=identicon&r=PG&f=1", "display_name": "Jonas B.", "link": "https://stackoverflow.com/users/10923857/jonas-b"}, "reply_to_user": {"reputation": 83151, "user_id": 3943312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc00b38b94ca7b6f820622b0a8af8ded?s=128&d=identicon&r=PG", "display_name": "Sam Varshavchik", "link": "https://stackoverflow.com/users/3943312/sam-varshavchik"}, "edited": false, "score": 0, "creation_date": 1547663076, "post_id": 54222962, "comment_id": 95272142, "body": "@SamVarshavchik Ah, I see. I guess that settles it, I have to use std::visit"}], "answers": [{"tags": [], "owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "is_accepted": false, "score": 2, "last_activity_date": 1547663118, "creation_date": 1547663118, "answer_id": 54223165, "question_id": 54222962, "link": "https://stackoverflow.com/questions/54222962/sorting-vectorvariant-does-not-work-correctly-via-operator/54223165#54223165", "title": "sorting vector&lt;variant&lt;...&gt;&gt; does not work correctly via operator&lt;", "body": "<p>You misunderstand how <code>std::variant</code>'s <code>operator&lt;</code> works. It first compares indexes, and only if indexes are equal, it compares the values: <a href=\"https://en.cppreference.com/w/cpp/utility/variant/operator_cmp\" rel=\"nofollow noreferrer\">https://en.cppreference.com/w/cpp/utility/variant/operator_cmp</a>. For unequal indexes, it returns <code>true</code> if index on the first variant is smaller than on second.</p>\n"}, {"tags": [], "owner": {"reputation": 245138, "user_id": 2069064, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/e4V2X.jpg?s=128&g=1", "display_name": "Barry", "link": "https://stackoverflow.com/users/2069064/barry"}, "is_accepted": true, "score": 7, "last_activity_date": 1547663358, "creation_date": 1547663358, "answer_id": 54223225, "question_id": 54222962, "link": "https://stackoverflow.com/questions/54222962/sorting-vectorvariant-does-not-work-correctly-via-operator/54223225#54223225", "title": "sorting vector&lt;variant&lt;...&gt;&gt; does not work correctly via operator&lt;", "body": "<p>This:</p>\n\n<pre><code>std::sort(std::begin(shapes), std::end(shapes));\n</code></pre>\n\n<p>uses the default <code>sort</code> comparison, which is <code>operator&lt;</code>. <code>operator&lt;</code> on <code>std::variant</code> is <a href=\"https://en.cppreference.com/w/cpp/utility/variant/operator_cmp\" rel=\"noreferrer\">defined as</a> comparing on indices <em>first</em> and then, if the two variants hold the same alternative, comparing the underlying values. </p>\n\n<p>In other words:</p>\n\n<pre><code>using V = std::variant&lt;char, int&gt;;\nV v1(static_cast&lt;char&gt;(42));  // holds a char\nV v2(15);                     // holds an int\nv1 &lt; v2;                      // this is true, because 'char' comes before 'int'\n</code></pre>\n\n<p>So when you sort your <code>variant</code>s, you're not sorting by area. You're effectively sorting by the tuple <code>(index, area)</code>. Which we could write out the long way:</p>\n\n<pre><code>std::sort(std::begin(shapes), std::end(shapes),\n    [](auto const&amp; lhs, auto const&amp; rhs)\n    {\n        auto tied = [](auto const&amp; x) {\n            return std::make_tuple(\n                // the index\n                x.index(),\n                // the area\n                std::visit([](auto const&amp; e){ return e.area(); }, x)\n                );\n        };\n        return tied(lhs) &lt; tied(rhs);\n    });\n</code></pre>\n\n<p>This gives the same ordering as your original example. And then if you remove the <code>x.index()</code> part of the tuple, you'll get the ordering that you want.</p>\n\n<p>But it's shorter to just use multiple visitation:</p>\n\n<pre><code>std::sort(std::begin(shapes), std::end(shapes),\n    [](auto const&amp; lhs, auto const&amp; rhs)\n    {\n        std::visit([](auto const&amp; x, auto const&amp; y){\n            return x.area() &lt; y.area();\n        }, lhs, rhs);\n    });\n</code></pre>\n\n<p>Which will become shorter still in C++20 with Ranges and projections:</p>\n\n<pre><code>std::ranges::sort(shapes, std::less(), [](auto const&amp; x){\n    return std::visit([](auto const&amp; e){ return e.area(); }, x);\n    });\n</code></pre>\n"}], "owner": {"reputation": 142, "user_id": 10923857, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c34d0bbd201d9b8aa373fb7209aa646?s=128&d=identicon&r=PG&f=1", "display_name": "Jonas B.", "link": "https://stackoverflow.com/users/10923857/jonas-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 264, "favorite_count": 1, "accepted_answer_id": 54223225, "answer_count": 2, "score": 4, "last_activity_date": 1547663358, "creation_date": 1547662272, "question_id": 54222962, "link": "https://stackoverflow.com/questions/54222962/sorting-vectorvariant-does-not-work-correctly-via-operator", "title": "sorting vector&lt;variant&lt;...&gt;&gt; does not work correctly via operator&lt;", "body": "<p>I wanted to sort a std::vector of type std::variant with two custom classes by their member return value. See code below.</p>\n\n<p>Now, using</p>\n\n<pre><code>std::sort(std::begin(shapes), std::end(shapes), [](auto const&amp; a, auto const&amp; b){\n        return std::visit([](auto const&amp; s) { return s.area(); }, a)\n            &lt; std::visit([](auto const&amp; s) { return s.area(); }, b);\n        });\n</code></pre>\n\n<p>does seem to work, but it is very ugly. Since std::variants operator&lt; operates on their respective values I thought supplying a templated comparison operator would look better. But why does it not work?</p>\n\n<h1>Code:</h1>\n\n<pre><code>#include &lt;algorithm&gt;\n#include &lt;iostream&gt;\n#include &lt;variant&gt;\n#include &lt;vector&gt;\n\nconstexpr double pi = 3.141592865;\n\nstruct Square {\n    double d{};\n    double area() const { return d * d; }\n};\n\nstruct Circle {\n    double r{};\n    double area() const { return pi * r * r; }\n};\n\n// comparison operator for using std::sort(begin, end);\ntemplate &lt;class S, class T&gt;\ndouble operator&lt;(S const&amp; a, T const&amp; b) {\n    return a.area() &lt; b.area();\n}\n\nint main (int, char**)\n{\n    std::vector&lt;std::variant&lt;Square, Circle&gt;&gt; shapes;\n\n    shapes.push_back(Circle{2});\n    shapes.push_back(Square{2});\n    shapes.push_back(Circle{1});\n    shapes.push_back(Square{3});\n\n    for (auto const&amp; e: shapes)\n    { std::cout &lt;&lt; std::visit([](auto const&amp; x) { return x.area(); }, e) &lt;&lt; \"\\n\"; }\n\n    std::cout &lt;&lt; \"\\n[SORT]\\n\\n\";\n    // Does not work\n    std::sort(std::begin(shapes), std::end(shapes));\n\n    /* works\n    std::sort(std::begin(shapes), std::end(shapes), [](auto const&amp; a, auto const&amp; b){\n            return std::visit([](auto const&amp; s) { return s.area(); }, a)\n                &lt; std::visit([](auto const&amp; s) { return s.area(); }, b);\n            });\n    */\n\n    for (auto const&amp; e: shapes)\n    { std::cout &lt;&lt; std::visit([](auto const&amp; x) { return x.area(); }, e) &lt;&lt; \"\\n\"; }\n\n    return 0;\n}\n</code></pre>\n\n<p>Anyone able to point me in the right direction? I suspect the problem lies within the <em>operator&lt;</em> not working with different types.</p>\n\n<p><strong>Compilation command:</strong>\n    $ g++8.2 -std=c++17 test.cpp -o test</p>\n\n<p><strong>Output:</strong></p>\n\n<pre><code>12.5664\n4\n3.14159\n9\n\n[SORT]\n\n4\n9\n3.14159\n12.5664\n</code></pre>\n\n<p>Weirdly, I run into compilation errors when using godbolts compile explorer and g++8.2, <em>but</em> not when using g++ trunk. See: <a href=\"https://gcc.godbolt.org/z/tKJa4t\" rel=\"nofollow noreferrer\">https://gcc.godbolt.org/z/tKJa4t</a></p>\n"}, {"tags": ["c++", "visual-studio-2013", "vectorization", "eigen", "eigen3"], "comments": [{"owner": {"reputation": 25324, "user_id": 1641621, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/h50hY.png?s=128&g=1", "display_name": "ggael", "link": "https://stackoverflow.com/users/1641621/ggael"}, "edited": false, "score": 2, "creation_date": 1547672340, "post_id": 54222956, "comment_id": 95276361, "body": "It&#39;s a problem of inlining, MSVC is pretty bad at that."}, {"owner": {"reputation": 14588, "user_id": 6870253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c7ce91530d2dddae7b9fc2bd828ed78?s=128&d=identicon&r=PG&f=1", "display_name": "chtz", "link": "https://stackoverflow.com/users/6870253/chtz"}, "edited": false, "score": 0, "creation_date": 1547675216, "post_id": 54222956, "comment_id": 95277655, "body": "Some of these problems could be solved by adding more <code>EIGEN_STRONG_INLINE</code> or <code>EIGEN_ALWAYS_INLINE</code> attributes to some methods inside Eigen. Perhaps you should first test the newest Eigen-version, and (if possible) newer MSVC versions. But currently, it does not look good indeed: <a href=\"https://godbolt.org/z/KpvMmd\" rel=\"nofollow noreferrer\">godbolt.org/z/KpvMmd</a>"}, {"owner": {"reputation": 21, "user_id": 2997657, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64243b0b526e0b24df586c327c17e55b?s=128&d=identicon&r=PG&f=1", "display_name": "Debbio", "link": "https://stackoverflow.com/users/2997657/debbio"}, "edited": false, "score": 0, "creation_date": 1547722785, "post_id": 54222956, "comment_id": 95293611, "body": "Thank you both, (nice online compiler btw). I can&#39;t switch compiler, and i tried with latest eigen, no luck. Looking at <code>::product_evaluator</code> src it seems already written with right attributes like <b>EIGEN_STRONG_INLINE</b>. Basically MSVC is not inlining, thats it."}], "owner": {"reputation": 21, "user_id": 2997657, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64243b0b526e0b24df586c327c17e55b?s=128&d=identicon&r=PG&f=1", "display_name": "Debbio", "link": "https://stackoverflow.com/users/2997657/debbio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 103, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1547662240, "creation_date": 1547662240, "question_id": 54222956, "link": "https://stackoverflow.com/questions/54222956/eigen-on-msvc-v120-vectorization-is-enabled-while-evaluation-is-not-performing", "title": "EIGEN on MSVC V120, vectorization is enabled while evaluation is not performing well ( maybe )", "body": "<p>I'm using Eigen version 3.3.5 with MSVC VC++ VS2013.</p>\n\n<p>I've read a lot of post on eigen and vectorization under MSVC and other compilers.</p>\n\n<p>Compiler relevant options :</p>\n\n<ul>\n<li>sse2 (checked, is vectorizing looking at test function assembly provided from eigen's doc)</li>\n<li>O2 , fast code</li>\n<li>inlining (tested various options )</li>\n<li>global code optimization </li>\n</ul>\n\n<p>I admit i'm fairly new to msvc compiler family, googling around it might be less efficient on templating operations than gcc or clang.</p>\n\n<pre><code>void fooa(Vector3f&amp; u, Vector3f&amp; v, Vector3f&amp; w, Affine3f &amp; t){\n  EIGEN_ASM_COMMENT(\"begin mul v*t\");\n  u = t*u;\n  v = t*u;\n  w = t*u;\n  EIGEN_ASM_COMMENT(\"end mul v*t\");\n}\n</code></pre>\n\n<p>The above code under msvc produces calls to :</p>\n\n<pre><code>Eigen::internal::evaluator&lt;Eigen::Block&lt;Eigen::Matrix&lt;float,4,1,0,4,1&gt;,3,1,0&gt; &gt;::evaluator&lt;Eigen::Block&lt;Eigen::Matrix&lt;float,4,1,0,4,1&gt;,3,1,0&gt; &gt;\n</code></pre>\n\n<p>and to :</p>\n\n<pre><code>Eigen::DenseStorage&lt;float,4,4,1,0&gt;::DenseStorage&lt;float,4,4,1,0&gt; (013F222370h)  \n</code></pre>\n\n<p>while gcc does not, affecting perfomances considerabily, my application uses a lot of operations of that kind.</p>\n\n<p>Is it vectorizing partially ? is it a template issue? or optimization issue?\nMost important, can i do something to produce an output similar to the one provided below related to gcc ? </p>\n\n<p>MSVC :</p>\n\n<pre><code>        EIGEN_ASM_COMMENT(\"inizio prova mul v*t\");\n    u = t*u;\n000000013F221431  test        al,0Fh  \n000000013F221433  je          fooa+4Fh (013F22144Fh)  \n000000013F221435  lea         rdx,[string L\"c:\\\\users\\\\user\\\\docume\"... (013F224550h)]  \n000000013F22143C  lea         rcx,[string L\"(internal::UIntPtr(a\"... (013F2245F0h)]  \n000000013F221443  mov         r8d,6Dh  \n000000013F221449  call        qword ptr [__imp__wassert (013F224160h)]  \n000000013F22144F  movss       xmm0,dword ptr [rbx]  \n000000013F221453  movss       xmm4,dword ptr [__real@3f800000 (013F224990h)]  \n000000013F22145B  lea         rax,[rbp+27h]  \n000000013F22145F  movss       dword ptr [rbp-39h],xmm0  \n000000013F221464  movss       xmm1,dword ptr [rbx+4]  \n000000013F221469  movss       dword ptr [rbp-35h],xmm1  \n000000013F22146E  movss       xmm3,dword ptr [rbx+8]  \n000000013F221473  movss       dword ptr [rbp-2Dh],xmm4  \n000000013F221478  movss       dword ptr [rbp-31h],xmm3  \n000000013F22147D  test        al,0Fh  \n000000013F22147F  je          fooa+0AFh (013F2214AFh)  \n000000013F221481  lea         rdx,[string L\"c:\\\\users\\\\user\\\\docume\"... (013F224550h)]  \n000000013F221488  lea         rcx,[string L\"(internal::UIntPtr(a\"... (013F2245F0h)]  \n000000013F22148F  mov         r8d,6Dh  \n000000013F221495  call        qword ptr [__imp__wassert (013F224160h)]  \n000000013F22149B  movss       xmm4,dword ptr [rbp-2Dh]  \n000000013F2214A0  movss       xmm3,dword ptr [rbp-31h]  \n000000013F2214A5  movss       xmm1,dword ptr [rbp-35h]  \n000000013F2214AA  movss       xmm0,dword ptr [rbp-39h]  \n000000013F2214AF  movss       xmm2,xmm0  \n000000013F2214B3  movaps      xmm0,xmm1  \n000000013F2214B6  movaps      xmm1,xmm3  \n    v = t*u;\n000000013F2214B9  lea         rcx,[rbp-39h]  \n    EIGEN_ASM_COMMENT(\"inizio prova mul v*t\");\n    u = t*u;\n000000013F2214BD  shufps      xmm0,xmm0,0  \n000000013F2214C1  shufps      xmm2,xmm2,0  \n000000013F2214C5  shufps      xmm1,xmm1,0  \n000000013F2214C9  mulps       xmm0,xmmword ptr [rdi+10h]  \n000000013F2214CD  mulps       xmm1,xmmword ptr [rdi+20h]  \n000000013F2214D1  mulps       xmm2,xmmword ptr [rdi]  \n000000013F2214D4  addps       xmm2,xmm0  \n000000013F2214D7  movss       xmm0,xmm4  \n000000013F2214DB  addps       xmm2,xmm1  \n000000013F2214DE  shufps      xmm0,xmm0,0  \n000000013F2214E2  mulps       xmm0,xmmword ptr [rdi+30h]  \n000000013F2214E6  addps       xmm2,xmm0  \n000000013F2214E9  movaps      xmm0,xmm2  \n000000013F2214EC  movaps      xmm1,xmm2  \n000000013F2214EF  shufps      xmm0,xmm2,55h  \n000000013F2214F3  shufps      xmm1,xmm2,0AAh  \n    EIGEN_ASM_COMMENT(\"inizio prova mul v*t\");\n    u = t*u;\n000000013F2214F7  movss       dword ptr [rbp-25h],xmm0  \n000000013F2214FC  movss       dword ptr [rbp-21h],xmm1  \n000000013F221501  movss       dword ptr [rbx],xmm2  \n000000013F221505  movss       xmm0,dword ptr [rbp-25h]  \n000000013F22150A  movss       dword ptr [rbx+4],xmm0  \n000000013F22150F  movss       xmm1,dword ptr [rbp-21h]  \n000000013F221514  movss       dword ptr [rbx+8],xmm1  \n    v = t*u;\n000000013F221519  call        Eigen::DenseStorage&lt;float,4,4,1,0&gt;::DenseStorage&lt;float,4,4,1,0&gt; (013F222370h)  \n000000013F22151E  movss       xmm0,dword ptr [rbx]  \n000000013F221522  lea         rcx,[rbp+27h]  \n000000013F221526  movss       dword ptr [rbp-39h],xmm0  \n000000013F22152B  movss       xmm1,dword ptr [rbx+4]  \n000000013F221530  movss       dword ptr [rbp-35h],xmm1  \n000000013F221535  movss       xmm0,dword ptr [rbx+8]  \n000000013F22153A  mov         dword ptr [rbp-2Dh],3F800000h  \n000000013F221541  movss       dword ptr [rbp-31h],xmm0  \n000000013F221546  call        Eigen::DenseStorage&lt;float,4,4,1,0&gt;::DenseStorage&lt;float,4,4,1,0&gt; (013F222370h)  \n000000013F22154B  lea         rax,[rbp-39h]  \n000000013F22154F  lea         rdx,[rbp+37h]  \n000000013F221553  mov         qword ptr [rbp-11h],rax  \n000000013F221557  lea         rax,[rbp-39h]  \n000000013F22155B  lea         rcx,[rbp-19h]  \n000000013F22155F  xor         r8d,r8d  \n000000013F221562  mov         qword ptr [rbp-19h],rdi  \n000000013F221566  mov         qword ptr [rbp-9],rdi  \n000000013F22156A  mov         qword ptr [rbp+7],rax  \n000000013F22156E  mov         qword ptr [rbp+17h],4  \n000000013F221576  call        Eigen::internal::product_evaluator&lt;Eigen::Product&lt;Eigen::Matrix&lt;float,4,4,0,4,4&gt;,Eigen::Matrix&lt;float,4,1,0,4,1&gt;,1&gt;,3,Eigen::DenseShape,Eigen::DenseShape,float,float&gt;::packet&lt;16,__m128&gt; (013F222420h)  \n    w = t*u;\n000000013F22157B  lea         rcx,[rbp-39h]  \n    v = t*u;\n000000013F22157F  movaps      xmm2,xmmword ptr [rax]  \n000000013F221582  movaps      xmm0,xmm2  \n000000013F221585  movaps      xmm1,xmm2  \n000000013F221588  shufps      xmm0,xmm2,55h  \n000000013F22158C  shufps      xmm1,xmm2,0AAh  \n000000013F221590  movss       dword ptr [rbp-25h],xmm0  \n000000013F221595  movss       dword ptr [rbp-21h],xmm1  \n000000013F22159A  movss       dword ptr [r14],xmm2  \n000000013F22159F  movss       xmm0,dword ptr [rbp-25h]  \n000000013F2215A4  movss       dword ptr [r14+4],xmm0  \n000000013F2215AA  movss       xmm1,dword ptr [rbp-21h]  \n000000013F2215AF  movss       dword ptr [r14+8],xmm1  \n    w = t*u;\n000000013F2215B5  call        Eigen::DenseStorage&lt;float,4,4,1,0&gt;::DenseStorage&lt;float,4,4,1,0&gt; (013F222370h)  \n000000013F2215BA  lea         rax,[rbp-39h]  \n000000013F2215BE  xor         r14d,r14d  \n000000013F2215C1  mov         qword ptr [rbp-19h],rax  \n000000013F2215C5  lea         rax,[rbp-39h]  \n000000013F2215C9  lea         rdx,[rbp-19h]  \n000000013F2215CD  lea         rcx,[rbp+27h]  \n000000013F2215D1  mov         qword ptr [rbp-1],r14  \n000000013F2215D5  mov         qword ptr [rbp+0Fh],4  \n000000013F2215DD  mov         qword ptr [rbp-9],rax  \n000000013F2215E1  call        Eigen::internal::evaluator&lt;Eigen::Block&lt;Eigen::Matrix&lt;float,4,1,0,4,1&gt;,3,1,0&gt; &gt;::evaluator&lt;Eigen::Block&lt;Eigen::Matrix&lt;float,4,1,0,4,1&gt;,3,1,0&gt; &gt; (013F2223B0h)  \n000000013F2215E6  mov         eax,dword ptr [rbx]  \n000000013F2215E8  mov         rcx,qword ptr [rbp+27h]  \n000000013F2215EC  mov         dword ptr [rcx],eax  \n000000013F2215EE  mov         eax,dword ptr [rbx+4]  \n000000013F2215F1  mov         dword ptr [rcx+4],eax  \n000000013F2215F4  mov         eax,dword ptr [rbx+8]  \n000000013F2215F7  mov         dword ptr [rcx+8],eax  \n000000013F2215FA  mov         dword ptr [rbp-2Dh],3F800000h  \n000000013F221601  lea         rcx,[rbp+37h]  \n000000013F221605  call        Eigen::DenseStorage&lt;float,4,4,1,0&gt;::DenseStorage&lt;float,4,4,1,0&gt; (013F222370h)  \n000000013F22160A  lea         rax,[rbp-39h]  \n000000013F22160E  lea         rdx,[rbp+47h]  \n000000013F221612  mov         qword ptr [rbp-11h],rax  \n000000013F221616  lea         rax,[rbp-39h]  \n000000013F22161A  lea         rcx,[rbp-19h]  \n000000013F22161E  xor         r8d,r8d  \n000000013F221621  mov         qword ptr [rbp-19h],rdi  \n000000013F221625  mov         qword ptr [rbp-9],rdi  \n000000013F221629  mov         qword ptr [rbp+7],rax  \n000000013F22162D  mov         qword ptr [rbp+17h],4  \n000000013F221635  call        Eigen::internal::product_evaluator&lt;Eigen::Product&lt;Eigen::Matrix&lt;float,4,4,0,4,4&gt;,Eigen::Matrix&lt;float,4,1,0,4,1&gt;,1&gt;,3,Eigen::DenseShape,Eigen::DenseShape,float,float&gt;::packet&lt;16,__m128&gt; (013F222420h)  \n000000013F22163A  lea         rdx,[rbp-19h]  \n000000013F22163E  lea         rcx,[rbp+27h]  \n000000013F221642  mov         qword ptr [rbp-1],r14  \n000000013F221646  movaps      xmm0,xmmword ptr [rax]  \n000000013F221649  movaps      xmmword ptr [rbp+37h],xmm0  \n000000013F22164D  lea         rax,[rbp+37h]  \n000000013F221651  mov         qword ptr [rbp+0Fh],4  \n000000013F221659  mov         qword ptr [rbp-19h],rax  \n000000013F22165D  lea         rax,[rbp+37h]  \n000000013F221661  mov         qword ptr [rbp-9],rax  \n000000013F221665  call        Eigen::internal::evaluator&lt;Eigen::Block&lt;Eigen::Matrix&lt;float,4,1,0,4,1&gt;,3,1,0&gt; &gt;::evaluator&lt;Eigen::Block&lt;Eigen::Matrix&lt;float,4,1,0,4,1&gt;,3,1,0&gt; &gt; (013F2223B0h)  \n000000013F22166A  mov         rax,qword ptr [rbp+27h]  \n    EIGEN_ASM_COMMENT(\"fine prova mul v*t\");\n}\n000000013F22166E  lea         r11,[rsp+0B0h]  \n    w = t*u;\n000000013F221676  movss       xmm2,dword ptr [rax]  \n000000013F22167A  movss       dword ptr [rbp-29h],xmm2  \n000000013F22167F  movss       xmm0,dword ptr [rax+4]  \n000000013F221684  movss       dword ptr [rbp-25h],xmm0  \n000000013F221689  movss       xmm1,dword ptr [rax+8]  \n    EIGEN_ASM_COMMENT(\"fine prova mul v*t\");\n}\n000000013F22168E  mov         rbx,qword ptr [r11+10h]  \n000000013F221692  mov         rdi,qword ptr [r11+20h]  \n000000013F221696  mov         r14,qword ptr [r11+28h]  \n    w = t*u;\n000000013F22169A  movss       dword ptr [rbp-21h],xmm1  \n000000013F22169F  movss       dword ptr [rsi],xmm2  \n000000013F2216A3  movss       xmm0,dword ptr [rbp-25h]  \n000000013F2216A8  movss       dword ptr [rsi+4],xmm0  \n000000013F2216AD  movss       xmm1,dword ptr [rbp-21h]  \n000000013F2216B2  movss       dword ptr [rsi+8],xmm1  \n    EIGEN_ASM_COMMENT(\"fine prova mul v*t\");\n}\n</code></pre>\n\n<p>GCC :</p>\n\n<pre><code># 18 \"main.cpp\" 1\n#inizio prova mul v*t\n# 0 \"\" 2\n#NO_APP\nmovss   4(%rdi), %xmm0\nshufps  $0, %xmm0, %xmm0\nmovss   (%rdi), %xmm1\nshufps  $0, %xmm1, %xmm1\nmovaps  (%rcx), %xmm2\nmulps   16(%rcx), %xmm0\nmulps   %xmm1, %xmm2\nmovaps  %xmm0, %xmm1\nmovss   8(%rdi), %xmm0\nshufps  $0, %xmm0, %xmm0\naddps   %xmm2, %xmm1\nmulps   32(%rcx), %xmm0\naddps   %xmm1, %xmm0\naddps   48(%rcx), %xmm0\nmovaps  %xmm0, (%rsp)\nmovss   (%rsp), %xmm0\nmovss   4(%rsp), %xmm1\nmovss   8(%rsp), %xmm3\nmovss   %xmm0, (%rdi)\nshufps  $0, %xmm0, %xmm0\nmovss   %xmm1, 4(%rdi)\nshufps  $0, %xmm1, %xmm1\nmovss   %xmm3, 8(%rdi)\nmovaps  (%rcx), %xmm2\nmulps   16(%rcx), %xmm1\nmulps   %xmm0, %xmm2\nmovaps  %xmm3, %xmm0\nshufps  $0, %xmm0, %xmm0\naddps   %xmm2, %xmm1\nmulps   32(%rcx), %xmm0\naddps   %xmm1, %xmm0\naddps   48(%rcx), %xmm0\nmovaps  %xmm0, (%rsp)\nmovss   (%rsp), %xmm0\nmovss   %xmm0, (%rsi)\nmovss   4(%rsp), %xmm0\nmovss   %xmm0, 4(%rsi)\nmovss   8(%rsp), %xmm0\nmovss   %xmm0, 8(%rsi)\nmovss   4(%rdi), %xmm0\nshufps  $0, %xmm0, %xmm0\nmovss   (%rdi), %xmm1\nshufps  $0, %xmm1, %xmm1\nmovaps  (%rcx), %xmm2\nmulps   16(%rcx), %xmm0\nmulps   %xmm1, %xmm2\nmovaps  %xmm0, %xmm1\nmovss   8(%rdi), %xmm0\nshufps  $0, %xmm0, %xmm0\naddps   %xmm2, %xmm1\nmulps   32(%rcx), %xmm0\naddps   %xmm1, %xmm0\naddps   48(%rcx), %xmm0\nmovaps  %xmm0, (%rsp)\nmovss   (%rsp), %xmm0\nmovss   %xmm0, (%rdx)\nmovss   4(%rsp), %xmm0\nmovss   %xmm0, 4(%rdx)\nmovss   8(%rsp), %xmm0\nmovss   %xmm0, 8(%rdx)\n#APP\n# 22 \"main.cpp\" 1\n#fine prova mul v*t\n# 0 \"\" 2\n</code></pre>\n"}, {"tags": ["c++", "pointers"], "comments": [{"owner": {"reputation": 5000, "user_id": 3856907, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ub3wd.jpg?s=128&g=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/3856907/erik"}, "edited": false, "score": 3, "creation_date": 1547661736, "post_id": 54222809, "comment_id": 95271483, "body": "What does Interpreter&#39;s constructor look like?"}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "edited": false, "score": 0, "creation_date": 1547663088, "post_id": 54222809, "comment_id": 95272150, "body": "Well, have you considered that you may have written the constructor to make a copy?"}], "answers": [{"tags": [], "owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "is_accepted": false, "score": 5, "last_activity_date": 1547662643, "last_edit_date": 1547662643, "creation_date": 1547662007, "answer_id": 54222893, "question_id": 54222809, "link": "https://stackoverflow.com/questions/54222809/object-creates-another-instance-instead-of-modifying-the-one-thats-pointed/54222893#54222893", "title": "Object creates another instance instead of modifying the one that&#39;s pointed", "body": "<p>That's what <a href=\"https://en.cppreference.com/w/cpp/memory/shared_ptr/make_shared\" rel=\"nofollow noreferrer\"><code>std::make_shared</code></a> <em>does</em>: Create a new object using the passed arguments to pass to a suitable constructor. In your case a copy-constructor.</p>\n\n<p>That is, the statement</p>\n\n<pre><code>std::shared_ptr&lt;MemoryManager&gt; wsk= std::make_shared&lt;MemoryManager&gt;(mem);\n</code></pre>\n\n<p>is equivalent to</p>\n\n<pre><code>std::shared_ptr&lt;MemoryManager&gt; wsk(new MemoryManager(mem));\n</code></pre>\n\n<hr>\n\n<p>If you want to have your shared pointer reference the existing object then you need to use e.g.</p>\n\n<pre><code>std::shared_ptr&lt;MemoryManager&gt; wsk(&amp;mem);\n</code></pre>\n\n<p>But that will bring with it other problems since when the last shared pointer is destructed then it will attempt to free the memory, which is not possible for object not created by <code>new</code>. There are two solutions to this: Either creating a (or using an existing) <em>null-deleter</em> which doesn't actually <code>delete</code> anything; Or by letting the shared pointer handle the complete ownership (from creation to destruction) of the object.</p>\n\n<p>And that's really how you should look at the smart pointers, not as a kind of self-deleting pointer, but in terms of resource <em>ownership</em>.</p>\n"}], "owner": {"reputation": 27, "user_id": 8935167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fa527753780f657fef69223d4e723b0?s=128&d=identicon&r=PG&f=1", "display_name": "Rainbow", "link": "https://stackoverflow.com/users/8935167/rainbow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1547662643, "creation_date": 1547661608, "question_id": 54222809, "link": "https://stackoverflow.com/questions/54222809/object-creates-another-instance-instead-of-modifying-the-one-thats-pointed", "title": "Object creates another instance instead of modifying the one that&#39;s pointed", "body": "<p>In my main I have variables:</p>\n\n<pre><code>ProcessManager mng;\nMemoryManager mem;\ndysk disk;\n</code></pre>\n\n<p>and I'm trying to use these pointers (also in main)</p>\n\n<pre><code>std::shared_ptr&lt;MemoryManager&gt; wsk= std::make_shared&lt;MemoryManager&gt;(mem) ;\nstd::shared_ptr&lt;dysk&gt; wsk_d = std::make_shared&lt;dysk&gt;(disk);\n</code></pre>\n\n<p>to pass these objects to an instance of my antoher object (through constructor:</p>\n\n<pre><code>Interpreter interpreter(wsk,wsk_d);\n</code></pre>\n\n<p>but it looks like intepreter creates his own instance of disk, why?</p>\n\n<pre><code>class Interpreter\n{\nprivate:\n    std::shared_ptr&lt;PCB&gt; pcb;\n    std::shared_ptr&lt;MemoryManager&gt; mm;\n    std::shared_ptr&lt;dysk&gt; disk;\n}\n\n</code></pre>\n"}, {"tags": ["c++", "qt", "qmessagebox", "qtwidgets"], "comments": [{"owner": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 1, "creation_date": 1547660771, "post_id": 54222576, "comment_id": 95270995, "body": "You should run all of this <i>within</i> the event loop, not <i>before</i> it."}, {"owner": {"reputation": 541, "user_id": 7559896, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/45ec66f72c97e2759cb0afa754b52432?s=128&d=identicon&r=PG&f=1", "display_name": "DEKKER", "link": "https://stackoverflow.com/users/7559896/dekker"}, "reply_to_user": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 0, "creation_date": 1547676955, "post_id": 54222576, "comment_id": 95278369, "body": "@JesperJuhl Hmmm I have no idea what is event loop here! any ideas?"}], "answers": [{"comments": [{"owner": {"reputation": 541, "user_id": 7559896, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/45ec66f72c97e2759cb0afa754b52432?s=128&d=identicon&r=PG&f=1", "display_name": "DEKKER", "link": "https://stackoverflow.com/users/7559896/dekker"}, "edited": false, "score": 0, "creation_date": 1547719503, "post_id": 54222837, "comment_id": 95291570, "body": "Thanks! This takes care of the first if-statement...but the second one where I show a critical messagebox still will not end the program correctly. Any ideas about that?"}, {"owner": {"reputation": 229, "user_id": 10918448, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc2226af4f3e09f4c922563448dbec69?s=128&d=identicon&r=PG&f=1", "display_name": "Unterfliege", "link": "https://stackoverflow.com/users/10918448/unterfliege"}, "reply_to_user": {"reputation": 541, "user_id": 7559896, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/45ec66f72c97e2759cb0afa754b52432?s=128&d=identicon&r=PG&f=1", "display_name": "DEKKER", "link": "https://stackoverflow.com/users/7559896/dekker"}, "edited": false, "score": 0, "creation_date": 1547739493, "post_id": 54222837, "comment_id": 95303306, "body": "QMessageBox::critical() has an internal event loop. So after you quit this internal event loop, you are still in the QApplication event loop. A simple fix would be to change <code>return a.exec();</code> to <code>return -1;</code>."}], "tags": [], "owner": {"reputation": 229, "user_id": 10918448, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc2226af4f3e09f4c922563448dbec69?s=128&d=identicon&r=PG&f=1", "display_name": "Unterfliege", "link": "https://stackoverflow.com/users/10918448/unterfliege"}, "is_accepted": true, "score": 2, "last_activity_date": 1547661777, "creation_date": 1547661777, "answer_id": 54222837, "question_id": 54222576, "link": "https://stackoverflow.com/questions/54222576/selecting-different-qmainwindow-at-program-startup-but-facing-strange-qmessagebo/54222837#54222837", "title": "Selecting different QMainWindow at program startup but facing strange QMessageBox exec() behavior", "body": "<p>Your MainWindow only exists inside the if statement. So it is destructed as soon as it shows up and leaves its scope.</p>\n\n<p>Change it to e.g.:</p>\n\n<pre><code>MainWindow w;\nif(msgBoxModeSelection.clickedButton() == btnModeDebug) {\n    w.show();\n}\n</code></pre>\n\n<p>or</p>\n\n<pre><code>if(msgBoxModeSelection.clickedButton() == btnModeDebug) {\n    MainWindow w;\n    w.show();\n    return a.exec();\n}\n</code></pre>\n"}], "owner": {"reputation": 541, "user_id": 7559896, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/45ec66f72c97e2759cb0afa754b52432?s=128&d=identicon&r=PG&f=1", "display_name": "DEKKER", "link": "https://stackoverflow.com/users/7559896/dekker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 54222837, "answer_count": 1, "score": 0, "last_activity_date": 1576545711, "creation_date": 1547660584, "last_edit_date": 1576545711, "question_id": 54222576, "link": "https://stackoverflow.com/questions/54222576/selecting-different-qmainwindow-at-program-startup-but-facing-strange-qmessagebo", "title": "Selecting different QMainWindow at program startup but facing strange QMessageBox exec() behavior", "body": "<p>I am working on a simple Qt Widget application where I have 2 different <code>QMainWindow</code> classes to show to user (at the moment only one is implemented).</p>\n\n<p>My idea is to show a message box with custom buttons to ask the user which mode of the program to be executed.</p>\n\n<p>I came up with the code below, but I am facing strange problems. You can try this code easily if you make a simple qt widget project.</p>\n\n<p>So the problem is, the message box is being shown and the buttons are shown correctly. When the user selects \"Debug Mode\"  the correct <code>MainWindow</code> will show up for a fraction of a second and then vanishes! but the program stays open and the return will not be reached!</p>\n\n<p>For the \"Operation Mode\"  the critical message box is shown but when user clicks <code>ok</code> all the message boxes go away but again return code is not reached!</p>\n\n<p>Same happens for the \"Exit\"  option...</p>\n\n<pre><code>#include \"mainwindow.h\"\n#include &lt;QApplication&gt;\n\n#include &lt;QMessageBox&gt;\n#include &lt;QAbstractButton&gt;\n#include &lt;QPushButton&gt;\n\nint main(int argc, char *argv[])\n{\n    QApplication a(argc, argv);\n\n    // At the start of the progam ask user which mode to show\n    QMessageBox msgBoxModeSelection;\n    msgBoxModeSelection.setIcon(QMessageBox::Question);\n    msgBoxModeSelection.setText(\"Please select the program mode:\");\n\n    QAbstractButton* btnModeDebug = msgBoxModeSelection.addButton(\n                                    \"Debug Mode\", QMessageBox::YesRole);\n    QAbstractButton* btnModeOperation = msgBoxModeSelection.addButton(\n                                    \"Operation Mode\", QMessageBox::NoRole);\n    QAbstractButton* btnModeExit = msgBoxModeSelection.addButton(\n                                    \"Exit\", QMessageBox::RejectRole);\n\n    msgBoxModeSelection.exec();\n\n    // Check which mode is being selected by user and continue accordingly\n    if(msgBoxModeSelection.clickedButton() == btnModeDebug) {\n        MainWindow w;\n        w.show();\n    } else if(msgBoxModeSelection.clickedButton() == btnModeOperation){ // Operation Mode\n        //TODO implement...for now just inform user that it is not implemented\n        QMessageBox::critical(nullptr, \"Error\", \"Operation Mode is not yet implemented\");\n        return a.exec();\n    } else if(msgBoxModeSelection.clickedButton() == btnModeExit){ // Just exit\n        // Just exit the program\n        QMessageBox::critical(nullptr, \"Goodbye!\", \"Sorry to see you go :(\");\n        return a.exec();\n    }\n\n    return a.exec();\n}\n</code></pre>\n\n<p>So basically the program vanishes but it is still somehow open and is being processed. The only way to terminate it is to stop the debugger or kill its process from the operating system.</p>\n\n<p>So I want the correct form to be shown as in there were no <code>messageBox</code> involved and the return code and exit of the program be normal again!</p>\n"}, {"tags": ["c++", "vector"], "comments": [{"owner": {"reputation": 12749, "user_id": 7976805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92a559df8b4b287aad23724b4c66d67c?s=128&d=identicon&r=PG&f=1", "display_name": "Yksisarvinen", "link": "https://stackoverflow.com/users/7976805/yksisarvinen"}, "edited": false, "score": 5, "creation_date": 1547659558, "post_id": 54222256, "comment_id": 95270395, "body": "Well, don&#39;t use variable length array? Why do you even need this array, you already have a nice collection to sum the numbers up."}, {"owner": {"reputation": 2396, "user_id": 2586447, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/567d7024898f875d97ed260321e8568a?s=128&d=identicon&r=PG&f=1", "display_name": "uchar", "link": "https://stackoverflow.com/users/2586447/uchar"}, "edited": false, "score": 0, "creation_date": 1547659632, "post_id": 54222256, "comment_id": 95270428, "body": "use <code>std::array</code> instead."}, {"owner": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 1, "creation_date": 1547659642, "post_id": 54222256, "comment_id": 95270434, "body": "Use <code>std::array</code> and/or <code>std::vector</code> instead of C-style arrays."}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "reply_to_user": {"reputation": 2396, "user_id": 2586447, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/567d7024898f875d97ed260321e8568a?s=128&d=identicon&r=PG&f=1", "display_name": "uchar", "link": "https://stackoverflow.com/users/2586447/uchar"}, "edited": false, "score": 3, "creation_date": 1547659652, "post_id": 54222256, "comment_id": 95270439, "body": "@Omid it&#39;s not known at compile time..."}], "answers": [{"comments": [{"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 1, "creation_date": 1547659927, "post_id": 54222364, "comment_id": 95270591, "body": "indeed, no reason to have <code>dizi</code>."}, {"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 3, "creation_date": 1547660579, "post_id": 54222364, "comment_id": 95270917, "body": "And even pass vector by const ref instead of by value."}, {"owner": {"reputation": 21, "user_id": 8300317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13d18a448df4ba3178354f9acfbcdfc6?s=128&d=identicon&r=PG&f=1", "display_name": "Emre Mutlu", "link": "https://stackoverflow.com/users/8300317/emre-mutlu"}, "edited": false, "score": 0, "creation_date": 1547660684, "post_id": 54222364, "comment_id": 95270961, "body": "how could i think. Thanks"}], "tags": [], "owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "is_accepted": false, "score": 8, "last_activity_date": 1547660815, "last_edit_date": 1592644375, "creation_date": 1547659818, "answer_id": 54222364, "question_id": 54222256, "link": "https://stackoverflow.com/questions/54222256/how-to-set-the-array-size-with-a-function-parameter/54222364#54222364", "title": "How to set the array size with a function parameter?", "body": "<p>You cannot set an array's size with a function parameter without a compiler that has a non-standard extension that allows <a href=\"https://en.wikipedia.org/wiki/Variable-length_array\" rel=\"nofollow noreferrer\">variable length arrays</a>. According to the C++ standard, array lengths MUST be a constant known when the program is compiled. Consider using another <code>std::vector</code> instead.</p>\n<h1>However...</h1>\n<p>There doesn't seem to be a need for an array here. May I suggest something more like,</p>\n<pre><code>float mean(vector&lt;float&gt; numbers){\n     int size=numbers.size();\n     float ort,toplam=0.0;\n     for(unsigned int i=0;i&lt;numbers.size();i++){\n         toplam+=numbers[i];\n     }\n     ort=toplam/numbers.size();\n     return ort;\n }\n</code></pre>\n<p>or</p>\n<pre><code>float mean(vector&lt;float&gt; numbers){\n     float toplam=0.0;\n     for(float num: numbers){\n         toplam+=num;\n     }\n     return toplam/numbers.size();\n }\n</code></pre>\n<p>or</p>\n<pre><code>float mean(vector&lt;float&gt; numbers){\n     return std::accumulate(numbers.begin(), numbers.end(), 0.0f)/numbers.size();\n }\n</code></pre>\n<p>?</p>\n<p><a href=\"https://en.cppreference.com/w/cpp/algorithm/accumulate\" rel=\"nofollow noreferrer\">Documentation for <code>std::accumulate</code></a>.</p>\n<p>In addition, as noted in the comments, consider passing <code>numbers</code> in as a constant reference (<code>float mean(const vector&lt;float&gt; &amp; numbers)</code>) to eliminate unnecessary copying without risk of accidentally changing <code>numbers</code>.</p>\n"}], "owner": {"reputation": 21, "user_id": 8300317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13d18a448df4ba3178354f9acfbcdfc6?s=128&d=identicon&r=PG&f=1", "display_name": "Emre Mutlu", "link": "https://stackoverflow.com/users/8300317/emre-mutlu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 0, "closed_date": 1547704161, "answer_count": 1, "score": -3, "last_activity_date": 1547665438, "creation_date": 1547659409, "last_edit_date": 1547665438, "question_id": 54222256, "link": "https://stackoverflow.com/questions/54222256/how-to-set-the-array-size-with-a-function-parameter", "closed_reason": "Not suitable for this site", "title": "How to set the array size with a function parameter?", "body": "<p>I got a problem when I wrote some code for practice. It's about array size settings. I tried several different ways but they did not work. </p>\n\n<p>Here is my code:</p>\n\n<pre><code>float mean(vector&lt;float&gt; numbers){\n     int size = numbers.size();\n     float dizi[size];\n     float ort,toplam = 0.0;\n     for(unsigned int i=0; i&lt;numbers.size(); i++){\n         dizi[i] = numbers[i];\n         toplam += dizi[i];\n     }\n\n     ort = toplam / numbers.size();\n\n     return ort;\n }\n</code></pre>\n\n<p>The errors I received were <code>\"variable length array used\"</code> and <code>\"variable length arrays are a C99 feature\"</code>. What is the solution?</p>\n"}, {"tags": ["c++", "memory-management"], "comments": [{"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 3, "creation_date": 1547659402, "post_id": 54222213, "comment_id": 95270330, "body": "Better not use raw pointers at all but <a href=\"https://en.cppreference.com/w/cpp/memory\" rel=\"nofollow noreferrer\">smart pointers</a> instead."}, {"owner": {"reputation": 3923, "user_id": 3002473, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/100005769998595/picture?type=large", "display_name": "user3002473", "link": "https://stackoverflow.com/users/3002473/user3002473"}, "edited": false, "score": 0, "creation_date": 1547659494, "post_id": 54222213, "comment_id": 95270363, "body": "I&#39;m not familiar with the concept, I&#39;m only a beginner in C++. Could you share some references or elaborate on how it solves my issue?"}, {"owner": {"reputation": 83151, "user_id": 3943312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc00b38b94ca7b6f820622b0a8af8ded?s=128&d=identicon&r=PG", "display_name": "Sam Varshavchik", "link": "https://stackoverflow.com/users/3943312/sam-varshavchik"}, "edited": false, "score": 2, "creation_date": 1547660533, "post_id": 54222213, "comment_id": 95270889, "body": "As I wrote, it takes at least a year to learn these advanced topics. See your C++ book, a year&#39;s worth of learning can&#39;t really be reduced to a brief answer on stackoverflow. C++ is hard."}, {"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "reply_to_user": {"reputation": 13757, "user_id": 1270003, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/d5ed9123b92a6e4dffa75f9f6dd9e382?s=128&d=identicon&r=PG&f=1", "display_name": "texasbruce", "link": "https://stackoverflow.com/users/1270003/texasbruce"}, "edited": false, "score": 2, "creation_date": 1547660879, "post_id": 54222213, "comment_id": 95271053, "body": "@texasbruce: My opinion is that a decade is needed to master C++. A year is certainly not enough. And very few people master C++ (and I don&#39;t claim to, even if I know some of it)."}], "answers": [{"tags": [], "owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "is_accepted": false, "score": 5, "last_activity_date": 1547659886, "last_edit_date": 1547659886, "creation_date": 1547659522, "answer_id": 54222283, "question_id": 54222213, "link": "https://stackoverflow.com/questions/54222213/what-is-the-proper-paradigm-of-creating-a-list-of-pointers/54222283#54222283", "title": "What is the proper paradigm of creating a list of pointers?", "body": "<p>No, there is no reason you would ever do this:</p>\n\n<pre><code>  OtherObject other_object = create_other_object();\n  other_objects.push_back(&amp;other_object);\n</code></pre>\n\n<p>This creates a temporary object, and you store the pointer in a list, and then the object is destroyed.</p>\n\n<p>This is the main difference with Python. In Python, every object is a reference to a Python object, even integers. In C++, you have object on the stack (like yours) or on the heap (created through <code>new</code>, <code>make_unique</code>...). If you want to mimick Python behavior, you need objects on the heap.</p>\n\n<p>There are only three valid patterns, depending on what <code>create_object()</code> does:</p>\n\n<ul>\n<li>it create an object and returns it by value. In that case, wrap it with <code>make_unique</code> to get a copy. This pattern is usually not very useful and not practical.</li>\n<li>it create a new object on the heap and expects the calling code to handle memory management. The prototype is thus: <code>std::unique_ptr&lt;OtherClass&gt; create_other_object();</code></li>\n<li>it creates a new object but doesn't expect the calling code to handle memory management, in which case the prototype should be <code>OtherClass* create_other_object();</code></li>\n</ul>\n\n<p>In your case, it's probably the second case:</p>\n\n<pre><code>std::vector&lt;std::unique_ptr&lt;OtherClass&gt;&gt; other_objects;\nvoid method() {\n    other_objects.push_back(create_other_object());\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "is_accepted": true, "score": 6, "last_activity_date": 1547705018, "last_edit_date": 1547705018, "creation_date": 1547659856, "answer_id": 54222375, "question_id": 54222213, "link": "https://stackoverflow.com/questions/54222213/what-is-the-proper-paradigm-of-creating-a-list-of-pointers/54222375#54222375", "title": "What is the proper paradigm of creating a list of pointers?", "body": "<blockquote>\n  <p>What is the proper paradigm of creating a list of pointers in C++?</p>\n</blockquote>\n\n<p>Combine <a href=\"https://en.cppreference.com/w/cpp/container/list\" rel=\"nofollow noreferrer\"><code>std::list</code></a> (or perhaps some other <a href=\"https://en.cppreference.com/w/cpp/container\" rel=\"nofollow noreferrer\">container</a>) with some <a href=\"https://en.wikipedia.org/wiki/Smart_pointer\" rel=\"nofollow noreferrer\">smart pointer</a> class (see <a href=\"https://en.cppreference.com/w/cpp/memory\" rel=\"nofollow noreferrer\">here</a>) such as <a href=\"https://en.cppreference.com/w/cpp/memory/shared_ptr\" rel=\"nofollow noreferrer\"><code>std::shared_ptr</code></a> or <a href=\"https://en.cppreference.com/w/cpp/memory/unique_ptr\" rel=\"nofollow noreferrer\"><code>std::unique_ptr</code></a>.</p>\n\n<p>As a rule of thumb (sometimes wrong) avoid <a href=\"https://en.wikipedia.org/wiki/Pointer_(computer_programming)#raw_pointer\" rel=\"nofollow noreferrer\">raw pointers</a> and prefer smart pointers. <a href=\"https://en.wikipedia.org/wiki/Memory_management\" rel=\"nofollow noreferrer\">Memory management</a> is a tricky topic. If you read some book on <a href=\"https://en.wikipedia.org/wiki/Garbage_collection_(computer_science)\" rel=\"nofollow noreferrer\">garbage collection</a> (e.g. the <a href=\"https://gchandbook.org/\" rel=\"nofollow noreferrer\">GC handbook</a>) you'll learn the relevant concepts, terminology and techniques (and these apply even with <a href=\"https://en.wikipedia.org/wiki/Manual_memory_management\" rel=\"nofollow noreferrer\">manual memory management</a> such as <a href=\"https://en.wikipedia.org/wiki/Reference_counting\" rel=\"nofollow noreferrer\">reference counting</a> - which some people view as a primitive form of GC). <a href=\"https://en.wikipedia.org/wiki/Circular_reference\" rel=\"nofollow noreferrer\">Circular references</a> are painful to handle (be aware of <a href=\"https://en.wikipedia.org/wiki/Weak_reference\" rel=\"nofollow noreferrer\">weak references</a>, e.g. <a href=\"https://en.cppreference.com/w/cpp/memory/weak_ptr\" rel=\"nofollow noreferrer\"><code>std::weak_ptr</code></a>).</p>\n\n<p>It would take a <em>lot</em> of space and time to explain all this in details (and I don't have time or motivation or even all the skills for that) here. Read a good <a href=\"http://stroustrup.com/Programming/\" rel=\"nofollow noreferrer\">C++ programming</a> book and refer to some <a href=\"https://en.cppreference.com/w/cpp\" rel=\"nofollow noreferrer\">C++ reference</a> (and later perhaps to the <a href=\"https://en.wikipedia.org/wiki/C++11\" rel=\"nofollow noreferrer\">C++11</a> standard <a href=\"http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2012/n3337.pdf\" rel=\"nofollow noreferrer\">n3337</a> or something newer). Be aware that the <a href=\"https://en.wikipedia.org/wiki/Memory_model_(programming)\" rel=\"nofollow noreferrer\">memory model</a> of C++ is difficult to understand (for anyone).</p>\n\n<p>Be aware of the <a href=\"https://en.wikipedia.org/wiki/Rule_of_three_(C%2B%2B_programming)\" rel=\"nofollow noreferrer\">rule of five</a>.</p>\n\n<p>On some operating systems and/or C++ implementations, you can find tools, such as <a href=\"https://valgrind.org/\" rel=\"nofollow noreferrer\">valgrind</a> or the <a href=\"https://en.wikipedia.org/wiki/AddressSanitizer\" rel=\"nofollow noreferrer\">address sanitizer</a> of <a href=\"https://clang.llvm.org/\" rel=\"nofollow noreferrer\">Clang</a> or <a href=\"https://gcc.gnu.org/\" rel=\"nofollow noreferrer\">GCC</a>, which should help you to debug then avoid <a href=\"https://en.wikipedia.org/wiki/Memory_leak\" rel=\"nofollow noreferrer\">memory leaks</a> (details are compiler and/or OS specific). And in <em>some few</em>  cases (probably a minority of them), you might consider using a garbage collector library (such as <a href=\"http://www.hboehm.info/gc/\" rel=\"nofollow noreferrer\">Boehm's GC</a>, see <a href=\"https://stackoverflow.com/a/8019003/841108\">this</a>, or <a href=\"http://www.ravenbrook.com/project/mps\" rel=\"nofollow noreferrer\">MPS</a>).</p>\n\n<blockquote>\n  <p>Is there a way to do this effectively in C++?</p>\n</blockquote>\n\n<p>I don't know of any efficient, universal and simple way (and <a href=\"https://en.wikipedia.org/wiki/Rice%27s_theorem\" rel=\"nofollow noreferrer\">Rice's theorem</a> make me believe there cannot be one) to manage memory. Your mileage will vary. You need to precisely understand your memory management and other programming constraints and objectives and make your own trade-offs. See Norvig's <a href=\"https://norvig.com/21-days.html\" rel=\"nofollow noreferrer\">opinion</a>. There is <a href=\"https://en.wikipedia.org/wiki/No_Silver_Bullet\" rel=\"nofollow noreferrer\"><em>No Silver Bullet</em></a>. </p>\n\n<hr>\n\n<p>PS. <strong>C++ is an <em>extremely difficult</em> programming language</strong>. Prepare yourself to spend a lot of time (years, not months; perhaps decades) and efforts to learn it. Look also, for inspiration, into the source code of some well written <a href=\"https://en.wikipedia.org/wiki/Free_software\" rel=\"nofollow noreferrer\">free software</a> coded in C++. I don't claim to be a C++ master (even if my daily job is about designing and implementing some static source code <a href=\"https://en.wikipedia.org/wiki/Static_program_analysis\" rel=\"nofollow noreferrer\">analyzers</a> for it). I believe that there might be only a few dozens (or perhaps a few hundreds) of C++ masters on this planet, and I am not among them.</p>\n\n<p>PPS. I am biased, but I recommend <a href=\"https://stackoverflow.com/a/54041928/841108\">using</a> Linux on your development machine to learn C++ programming, precisely because it has lots of useful tools.</p>\n"}], "owner": {"reputation": 3923, "user_id": 3002473, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/100005769998595/picture?type=large", "display_name": "user3002473", "link": "https://stackoverflow.com/users/3002473/user3002473"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 54222375, "answer_count": 2, "score": 0, "last_activity_date": 1547705018, "creation_date": 1547659232, "last_edit_date": 1547660009, "question_id": 54222213, "link": "https://stackoverflow.com/questions/54222213/what-is-the-proper-paradigm-of-creating-a-list-of-pointers", "title": "What is the proper paradigm of creating a list of pointers?", "body": "<p>I find myself <em>so frequently</em> thoughtlessly writing classes that add pointers to objects which are later destroyed to lists, which results in a lot of segfaults, but the problem is that sometimes I simply <em>can't</em> come up with a better solution than to store a list of pointers. It does my head in that there doesn't seem to be a simple way of just \"storing temporary objects that you can't copy\" in C++. Is there a paradigm I'm missing on how to do this effectively?</p>\n\n<p>For example, I'll have a class that looks something like this:</p>\n\n<pre><code>class MyClass\npublic:\n   std::vector&lt;OtherClass *&gt; other_objects;\n   void method() {\n      OtherObject other_object = create_other_object();\n      other_objects.push_back(&amp;other_object);\n   }\n</code></pre>\n\n<p>One reason you may want to do this is because you use the <code>other_objects</code> elsewhere (as arguments to other functions) and you can't copy <code>OtherObject</code> instances (which could happen if the <code>OtherObject</code> copy constructor was private for example).</p>\n\n<p>Of course, once you attempt to use <code>other_objects</code> elsewhere in code, the memory each pointer points to will have already been destroyed.</p>\n\n<p>I write a lot of Python code, and I use this sort of structure <em>very</em> often, where a method populates an iterable with objects that exist solely in the scope of the method. Is there a way to do this effectively in C++? Could I do my own memory management to keep the temporary objects in the method alive beyond the scope of the method?</p>\n"}, {"tags": ["c++", "class"], "comments": [{"owner": {"reputation": 34185, "user_id": 5470596, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BITFt.jpg?s=128&g=1", "display_name": "YSC", "link": "https://stackoverflow.com/users/5470596/ysc"}, "edited": false, "score": 3, "creation_date": 1547657970, "post_id": 54221854, "comment_id": 95269550, "body": "Where did you learn that <code>[4.1, 2.5, 7,2]</code> is a C++ notation for an array? If you haven&#39;t and simply try to guess the C++ grammar, don&#39;t. Get <a href=\"https://stackoverflow.com/questions/388242/the-definitive-c-book-guide-and-list/388282#388282\">a good book</a> instead."}, {"owner": {"reputation": 263, "user_id": 9654804, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "HaskellPlease", "link": "https://stackoverflow.com/users/9654804/haskellplease"}, "reply_to_user": {"reputation": 34185, "user_id": 5470596, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BITFt.jpg?s=128&g=1", "display_name": "YSC", "link": "https://stackoverflow.com/users/5470596/ysc"}, "edited": false, "score": 0, "creation_date": 1547658261, "post_id": 54221854, "comment_id": 95269727, "body": "I am trying to get something that works as similar as this. Please read the entire question first."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1547658680, "post_id": 54221854, "comment_id": 95269919, "body": "A <code>double[]</code> parameter is actually a <code>double*</code> parameter."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1547658829, "post_id": 54221854, "comment_id": 95270001, "body": "You are allowed to initialise arrays, you don&#39;t need to assign them elementwise \u2013 <code>double x[5] = {4.1, 2.5, 7.2};</code>"}, {"owner": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 0, "creation_date": 1547659904, "post_id": 54221854, "comment_id": 95270579, "body": "Use <code>std::array</code> (or <code>std::vector</code>)."}], "answers": [{"tags": [], "owner": {"reputation": 4826, "user_id": 193789, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/a17cc57e47435930a48f7c80bcd53863?s=128&d=identicon&r=PG", "display_name": "kebs", "link": "https://stackoverflow.com/users/193789/kebs"}, "is_accepted": false, "score": 4, "last_activity_date": 1547658806, "last_edit_date": 1547658806, "creation_date": 1547658470, "answer_id": 54222022, "question_id": 54221854, "link": "https://stackoverflow.com/questions/54221854/pass-an-array-containing-numbers-as-a-parameter-c/54222022#54222022", "title": "Pass an array containing numbers as a parameter c++", "body": "<p>I would suggest using standard library containers:</p>\n\n<pre><code>class Foo{\n   public:\n     Foo(int, const std::vector&lt;double&gt;&amp; vv ) : v(vv) \n     {\n       // other stuff here\n     }\n\n     std::vector&lt;double&gt; v;\n};\n</code></pre>\n\n<p>You can pass values this way, using <a href=\"https://en.cppreference.com/w/cpp/language/aggregate_initialization\" rel=\"nofollow noreferrer\">aggregate initialization</a>:</p>\n\n<pre><code>int main()\n{\n    Foo f( 1, {1.1,1.2,1.3} );\n}\n</code></pre>\n\n<p>Or use <a href=\"https://en.cppreference.com/w/cpp/container/array\" rel=\"nofollow noreferrer\"><code>std::array</code></a> if compile-time fixed size.</p>\n"}, {"comments": [{"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 0, "creation_date": 1547665251, "post_id": 54222138, "comment_id": 95273147, "body": "<i>&quot;Because initializer lists can&#39;t convert inline to arrays&quot;</i> In <code>Foo(int a, double b[], double c[])</code>, <code>b</code> and <code>c</code> are actually pointers, not arrays. If you use const reference on array (as you can&#39;t pass array by value) the conversion happens: <a href=\"http://coliru.stacked-crooked.com/a/cc7efd1017346aa4\" rel=\"nofollow noreferrer\">Demo</a>."}], "tags": [], "owner": {"reputation": 302, "user_id": 7618662, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FRMsr.jpg?s=128&g=1", "display_name": "ThatOneDeveloper", "link": "https://stackoverflow.com/users/7618662/thatonedeveloper"}, "is_accepted": false, "score": 1, "last_activity_date": 1547658889, "creation_date": 1547658889, "answer_id": 54222138, "question_id": 54221854, "link": "https://stackoverflow.com/questions/54221854/pass-an-array-containing-numbers-as-a-parameter-c/54222138#54222138", "title": "Pass an array containing numbers as a parameter c++", "body": "<p>Declaring lists using <code>[]</code> will not work. But you can use <a href=\"https://en.cppreference.com/w/cpp/language/aggregate_initialization\" rel=\"nofollow noreferrer\">brace enclosed initializer lists</a>:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>double b[] = {1.0, 2.0};\ndouble c[] = {5.3, 4.7};\nFoo f = Foo(1, b, c);\n</code></pre>\n\n<p>Note however, you cannot do this:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>Foo f = Foo(1, {1.0, 2.0}, {5.3, 4.7});\n</code></pre>\n\n<p>Why? Because initializer lists can't convert inline to arrays. You have to declare the arrays explicitly. If you want to do this inline, use a <code>std::vector&lt;double&gt;</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 22818, "user_id": 1387438, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/ad806758c356c915ea08a4bfd79131e3?s=128&d=identicon&r=PG", "display_name": "Marek R", "link": "https://stackoverflow.com/users/1387438/marek-r"}, "is_accepted": false, "score": 2, "last_activity_date": 1547659677, "creation_date": 1547659677, "answer_id": 54222328, "question_id": 54221854, "link": "https://stackoverflow.com/questions/54221854/pass-an-array-containing-numbers-as-a-parameter-c/54222328#54222328", "title": "Pass an array containing numbers as a parameter c++", "body": "<p>In such case <a href=\"https://en.cppreference.com/w/cpp/utility/initializer_list\" rel=\"nofollow noreferrer\">std::initializer_list</a> is best choice.</p>\n\n<pre><code>class Foo{\npublic:\n    Foo(int n, std::initializer_list&lt;double&gt; a, std::initializer_list&lt;double&gt; b);\n};\n\nFoo foo { 32, {}, { 2, 3, 1, 2 }};\n</code></pre>\n\n<p><a href=\"https://wandbox.org/permlink/4z3jDatribVs5EcS\" rel=\"nofollow noreferrer\">Live example</a>.</p>\n"}], "owner": {"reputation": 263, "user_id": 9654804, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "HaskellPlease", "link": "https://stackoverflow.com/users/9654804/haskellplease"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "answer_count": 3, "score": 3, "last_activity_date": 1547659677, "creation_date": 1547657865, "last_edit_date": 1547658178, "question_id": 54221854, "link": "https://stackoverflow.com/questions/54221854/pass-an-array-containing-numbers-as-a-parameter-c", "title": "Pass an array containing numbers as a parameter c++", "body": "<p>I have a class with a constructor that takes three arguments</p>\n\n<pre><code>class Foo{\npublic: Foo(int, double[], double[]);\n};\n\nFoo::Foo(int a, double b[], double c[]){\n// function\n}\n</code></pre>\n\n<p>Now what I'm trying is to call this class with arrays that have fixed numbers\nfor example</p>\n\n<pre><code>Foo(4, [4.1, 2.5, 7.2], [5.5, 6.1, 3.8]);\n</code></pre>\n\n<p>yet this doesn't work. Is such syntax possible in c++ or do I have to change it.</p>\n\n<p>I tried doing it by declaring array variables before like</p>\n\n<pre><code> double x[5];\n x[0] = 4.1;\n x[1] = 2.5;\n x[2] = 7.2;\n\n Foo(4, x, x);\n</code></pre>\n\n<p>this works but takes way to much time since I want to create multiple of these classes and this would make my code way bigger and unnecessary if there is a better way of doing it.</p>\n\n<p>Thanks in Advance</p>\n"}, {"tags": ["c++", "qt", "boost", "qfile"], "comments": [{"owner": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "edited": false, "score": 1, "creation_date": 1547658297, "post_id": 54221827, "comment_id": 95269746, "body": "What about <a href=\"http://doc.qt.io/qt-5/qiodevice.html#OpenModeFlag-enum\" rel=\"nofollow noreferrer\"><code>QIODevice::NewOnly</code></a>? (I found this when looking for what&#39;s available for <code>mode</code> in <a href=\"http://doc.qt.io/qt-5/qfile.html#open-1\" rel=\"nofollow noreferrer\"><code>QFile::open()</code></a> although I must admit that I didn&#39;t know before nor have ever tried personally.)"}, {"owner": {"reputation": 464288, "user_id": 34509, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/7FnYg.jpg?s=128&g=1", "display_name": "Johannes Schaub - litb", "link": "https://stackoverflow.com/users/34509/johannes-schaub-litb"}, "reply_to_user": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "edited": false, "score": 0, "creation_date": 1547658444, "post_id": 54221827, "comment_id": 95269816, "body": "@Scheff nice, thanks! Please add it as an answer so I can accept it. Unfortunately we are on 5.9 only, and update to 5.12 some time later. But at least I know it&#39;s resolved now."}, {"owner": {"reputation": 69264, "user_id": 256138, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ed9e8c0ff767e38f8fade11f5af00a45?s=128&d=identicon&r=PG", "display_name": "rubenvb", "link": "https://stackoverflow.com/users/256138/rubenvb"}, "edited": false, "score": 0, "creation_date": 1547660787, "post_id": 54221827, "comment_id": 95271003, "body": "If the filesystem time is fine-grained enough, perhaps open the file and then check the last modified date vs creation date?"}, {"owner": {"reputation": 9720, "user_id": 6371123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f90991c1b06c79ae4c6e79fb616d608?s=128&d=identicon&r=PG", "display_name": "G.M.", "link": "https://stackoverflow.com/users/6371123/g-m"}, "edited": false, "score": 1, "creation_date": 1547662232, "post_id": 54221827, "comment_id": 95271720, "body": "If you&#39;re not at 5.11 yet one alternative might be to use a <code>QTemporaryFile</code> with <code>setAutoRemove(false)</code>.  Write the data to that and then call <a href=\"http://doc.qt.io/qt-5/qfile.html#rename-1\" rel=\"nofollow noreferrer\"><code>QFile::rename</code></a>, taking advantage of the fact that <code>QFile::rename</code> will simply return <code>false</code> rather than overwrite an existing file.  A bit &quot;round the houses&quot; but..."}, {"owner": {"reputation": 464288, "user_id": 34509, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/7FnYg.jpg?s=128&g=1", "display_name": "Johannes Schaub - litb", "link": "https://stackoverflow.com/users/34509/johannes-schaub-litb"}, "reply_to_user": {"reputation": 9720, "user_id": 6371123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f90991c1b06c79ae4c6e79fb616d608?s=128&d=identicon&r=PG", "display_name": "G.M.", "link": "https://stackoverflow.com/users/6371123/g-m"}, "edited": false, "score": 0, "creation_date": 1547670236, "post_id": 54221827, "comment_id": 95275427, "body": "@G.M. thanks, nice workaround!"}], "answers": [{"comments": [{"owner": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "edited": false, "score": 0, "creation_date": 1547660048, "post_id": 54222079, "comment_id": 95270661, "body": "@JohannesSchaub-litb I added a small sample - seems to work (on Windows 10 and Qt 11)."}], "tags": [], "owner": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "is_accepted": true, "score": 5, "last_activity_date": 1547660333, "last_edit_date": 1547660333, "creation_date": 1547658669, "answer_id": 54222079, "question_id": 54221827, "link": "https://stackoverflow.com/questions/54221827/can-i-detect-the-pre-existance-of-a-qfile-after-opening-it-in-read-write-append/54222079#54222079", "title": "Can I detect the pre-existance of a QFile after opening it in read/write/append mode?", "body": "<p>I must admit that I never tried this personally.</p>\n\n<p>However, I remembered that the usual approach for preventing race conditions in file I/O is to try and handle the possible error case respectively.</p>\n\n<p>Hence, I had a look into <a href=\"http://doc.qt.io/qt-5/qfile.html#open-1\" rel=\"nofollow noreferrer\"><code>QFile::open()</code></a> what it does offer and found:</p>\n\n<p><a href=\"http://doc.qt.io/qt-5/qiodevice.html#OpenModeFlag-enum\" rel=\"nofollow noreferrer\"><strong><code>QIODevice::NewOnly</code></strong></a>:</p>\n\n<blockquote>\n  <p>Fail if the file to be opened already exists. Create and open the file only if it does not exist. There is a guarantee from the operating system that you are the only one creating and opening the file. Note that this mode implies WriteOnly, and combining it with ReadWrite is allowed. This flag currently only affects QFile. Other classes might use this flag in the future, but until then using this flag with any classes other than QFile may result in undefined behavior. (since Qt 5.11)</p>\n</blockquote>\n\n<hr>\n\n<p>I just realized that (beside of our productive Qt 5.9 installation) I have a newer one which I installed for private fiddling.</p>\n\n<p>Thus, I made a little sample to check this out:</p>\n\n<pre><code>#include &lt;QtWidgets&gt;\n\nint main()\n{\n  qDebug() &lt;&lt; \"Qt Version:\" &lt;&lt; QT_VERSION_STR;\n  for (int i = 1; i &lt;= 2; ++i) {\n    qDebug() &lt;&lt; \"Iteration\" &lt;&lt; i;\n    QFile qFile(\"test.txt\");\n    if (!qFile.open(QIODevice::WriteOnly | QIODevice::NewOnly)) {\n      qDebug() &lt;&lt; \"qFile.open failed! Error code\" &lt;&lt; qFile.error();\n    }\n    qFile.write(\"test\");\n    qFile.close();\n  }\n  return 0;\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Qt Version: 5.11.2\nIteration 1\nIteration 2\nqFile.open failed! Error code 5\nQIODevice::write (QFile, \"test.txt\"): device not open\n</code></pre>\n\n<p>I'm still not quite sure how to find out that it failed exactly due to the already existing file (and not for any other reason). In my case for sure but in general?</p>\n\n<p>(The error code 5 is simply <a href=\"http://doc.qt.io/qt-5/qfiledevice.html#FileError-enum\" rel=\"nofollow noreferrer\"><code>QFileDevice::OpenError</code></a>.)</p>\n"}], "owner": {"reputation": 464288, "user_id": 34509, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/7FnYg.jpg?s=128&g=1", "display_name": "Johannes Schaub - litb", "link": "https://stackoverflow.com/users/34509/johannes-schaub-litb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 285, "favorite_count": 0, "accepted_answer_id": 54222079, "answer_count": 1, "score": 5, "last_activity_date": 1547660333, "creation_date": 1547657775, "question_id": 54221827, "link": "https://stackoverflow.com/questions/54221827/can-i-detect-the-pre-existance-of-a-qfile-after-opening-it-in-read-write-append", "title": "Can I detect the pre-existance of a QFile after opening it in read/write/append mode?", "body": "<p>I want to write some text to a file with a randomly chosen filename, but want to require that the file doesn't exist yet. There's a race-condition between a simple <code>QFile::exists</code> check followed by an <code>open</code> with the checked name. </p>\n\n<p>What's the best way to ensure that the file wasn't pre-existing when I open it with <code>QFile</code>? The same thing with a <em>directory</em> works nicely when using <code>boost::filesystem::create_directory</code>, because it returns a boolean that indicates whether a directory was pre-existing or not. But I don't see how it works for files. </p>\n"}, {"tags": ["c++", "c++-concepts", "c++20"], "comments": [{"owner": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "edited": false, "score": 0, "creation_date": 1547658355, "post_id": 54221785, "comment_id": 95269769, "body": "Can you implement a traits template that answers those questions?  Can you convert a traits template into a concept?  Does that solve your problem?"}, {"owner": {"reputation": 4411, "user_id": 751579, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/iux9g.png?s=128&g=1", "display_name": "davidbak", "link": "https://stackoverflow.com/users/751579/davidbak"}, "edited": false, "score": 0, "creation_date": 1547658710, "post_id": 54221785, "comment_id": 95269941, "body": "Might have answers <a href=\"https://stackoverflow.com/questions/31762958/check-if-class-is-a-template-specialization\">here</a>?  Good question!"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user3624760"}, "edited": false, "score": 0, "creation_date": 1547658686, "post_id": 54222029, "comment_id": 95269922, "body": "&quot;If and only if&quot; was added by another user, I have restored the official wording which is &quot;do not unless&quot;."}, {"owner": {"reputation": 4411, "user_id": 751579, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/iux9g.png?s=128&g=1", "display_name": "davidbak", "link": "https://stackoverflow.com/users/751579/davidbak"}, "edited": false, "score": 0, "creation_date": 1547658779, "post_id": 54222029, "comment_id": 95269971, "body": "Isn&#39;t the overload resolution thing done by wrapping this in an <code>enable_if</code> to make use of SFINAE?"}, {"owner": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "edited": false, "score": 0, "creation_date": 1547658803, "post_id": 54222029, "comment_id": 95269982, "body": "@Lyberta Sorry, I was trying to get rid of the triple negative. I think the correct form would&#39;ve been &quot;only if&quot;, but I believe the intent was clear regardless."}, {"owner": {"reputation": 34388, "user_id": 2610810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8c6433073e71478e8da278a188e1d15?s=128&d=identicon&r=PG", "display_name": "Caleth", "link": "https://stackoverflow.com/users/2610810/caleth"}, "reply_to_user": {"reputation": 4411, "user_id": 751579, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/iux9g.png?s=128&g=1", "display_name": "davidbak", "link": "https://stackoverflow.com/users/751579/davidbak"}, "edited": false, "score": 1, "creation_date": 1547658887, "post_id": 54222029, "comment_id": 95270036, "body": "@davidbak not with concepts, this is the right syntax but gets the constraint backwards (needs to be <code>NotSpanNorArray</code>)"}, {"owner": {"reputation": 18020, "user_id": 580083, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/085edb5b64d5db3362d784bd9d35f99c?s=128&d=identicon&r=PG", "display_name": "Daniel Langr", "link": "https://stackoverflow.com/users/580083/daniel-langr"}, "reply_to_user": {"reputation": 245138, "user_id": 2069064, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/e4V2X.jpg?s=128&g=1", "display_name": "Barry", "link": "https://stackoverflow.com/users/2069064/barry"}, "edited": false, "score": 0, "creation_date": 1547660181, "post_id": 54222029, "comment_id": 95270711, "body": "@Barry updated, thanks. I am now just on my phone, will update demo as well."}], "tags": [], "owner": {"reputation": 18020, "user_id": 580083, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/085edb5b64d5db3362d784bd9d35f99c?s=128&d=identicon&r=PG", "display_name": "Daniel Langr", "link": "https://stackoverflow.com/users/580083/daniel-langr"}, "is_accepted": false, "score": 2, "last_activity_date": 1547660133, "last_edit_date": 1547660133, "creation_date": 1547658491, "answer_id": 54222029, "question_id": 54221785, "link": "https://stackoverflow.com/questions/54221785/disable-class-specialization-using-concepts/54222029#54222029", "title": "Disable class specialization using concepts", "body": "<p>You can use type traits to check whether some type is a specialization of <code>span</code> or <code>std::array</code>. This works for me:</p>\n\n<pre><code>#include &lt;type_traits&gt;\n\ntemplate&lt;typename, std::ptrdiff_t&gt; class span;\n\ntemplate &lt;typename T&gt;\nstruct is_array : std::false_type { };\ntemplate &lt;typename T, size_t N&gt;\nstruct is_array&lt;std::array&lt;T, N&gt;&gt; : std::true_type { };\n\ntemplate &lt;typename T&gt;\nstruct is_span : std::false_type { };\ntemplate &lt;typename T, std::ptrdiff_t P&gt;\nstruct is_span&lt;span&lt;T, P&gt;&gt; : std::true_type { };\n\ntemplate &lt;typename T&gt;\nconcept bool NotSpanNotArray = !is_array&lt;T&gt;::value &amp;&amp; !is_span&lt;T&gt;::value;\n\ntemplate&lt;typename, std::ptrdiff_t&gt; class span {\npublic:\n  template&lt;NotSpanNotArray T&gt; constexpr span(T&amp; cont);\n  // template&lt;NotSpanNotArray T&gt; constexpr span(const T&amp; cont);\n};\n</code></pre>\n\n<p>Working demo: <a href=\"https://wandbox.org/permlink/M0n60U8Hl4mpacuI\" rel=\"nofollow noreferrer\">https://wandbox.org/permlink/M0n60U8Hl4mpacuI</a></p>\n\n<p>Just I am not 100% sure whether such a solution meets that <em>participate in overload resolution if and only if</em> requirement. Some language-lawyer might clarify this.</p>\n\n<hr>\n\n<p><strong>UPDATE</strong></p>\n\n<p>I just realized that <code>std::is_array</code> works only for \"ordinary\" arrays, not <code>std::array</code>. Therefore I added a custom <code>is_array</code> type trait as well.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user3624760"}, "edited": false, "score": 0, "creation_date": 1547660130, "post_id": 54222366, "comment_id": 95270687, "body": "Is it possible to generalize <code>is_specialization</code> using variadics?"}, {"owner": {"reputation": 245138, "user_id": 2069064, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/e4V2X.jpg?s=128&g=1", "display_name": "Barry", "link": "https://stackoverflow.com/users/2069064/barry"}, "edited": false, "score": 0, "creation_date": 1547661713, "post_id": 54222366, "comment_id": 95271472, "body": "@Lyberta The problem is you have different <i>kinds</i> of template parameters: a type parameter and a non-type parameter. There&#39;s no &quot;any&quot; kind that you could put in there. This is exactly the case that an &quot;anykind&quot; parameter would be super useful."}], "tags": [], "owner": {"reputation": 245138, "user_id": 2069064, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/e4V2X.jpg?s=128&g=1", "display_name": "Barry", "link": "https://stackoverflow.com/users/2069064/barry"}, "is_accepted": true, "score": 2, "last_activity_date": 1547677646, "last_edit_date": 1547677646, "creation_date": 1547659822, "answer_id": 54222366, "question_id": 54221785, "link": "https://stackoverflow.com/questions/54221785/disable-class-specialization-using-concepts/54222366#54222366", "title": "Disable class specialization using concepts", "body": "<p>First, create a trait to check for specializations. <code>array</code> and <code>span</code> look the same in the sense that they take a type parameter and a non-type parameter:</p>\n\n<pre><code>template &lt;typename T, template &lt;typename, auto&gt; class Z&gt;\nstruct is_specialization : std::false_type { };\ntemplate &lt;typename A, auto V, template &lt;typename, auto&gt; class Z&gt;\nstruct is_specialization&lt;Z&lt;A,V&gt;, Z&gt; : std::true_type { };\n\ntemplate &lt;typename T, template &lt;typename, auto&gt; class Z&gt;\ninline constexpr bool is_specialization_v = is_specialization&lt;T, Z&gt;::value;\n</code></pre>\n\n<p>And then we can build up a concept from that:</p>\n\n<pre><code>// the last bullet point\ntemplate &lt;typename T, typename E&gt;\nconcept ValidForElement =\n    ConvertibleTo&lt;std::remove_pointer_t&lt;T&gt;(*)[], E(*)[]&gt;;\n\ntemplate &lt;typename T, typename E&gt;\nconcept AllowedContainer =\n    // not a specialization of span (note: requires forward declaration of span)\n    !is_specialization_v&lt;std::remove_cv_t&lt;T&gt;, std::span&gt;\n    // not a specialization of array\n    &amp;&amp; !is_specialization_v&lt;std::remove_cv_t&lt;T&gt;, std::array&gt;\n    // not a raw array\n    &amp;&amp; !std::is_array_v&lt;std::remove_cv_t&lt;T&gt;&gt;\n    &amp;&amp; requires (T cont) {\n        // data(cont) is well-formed and has a valid type\n        { data(cont); } -&gt; ValidForElement&lt;E&gt;\n        // size(cont) is well-formed\n        { size(cont); }\n    };\n</code></pre>\n\n<p>Which you would use like:</p>\n\n<pre><code>template &lt;typename Element, std::ptrdiff_t Extent = -1&gt;\nstruct span {\n    template &lt;typename C&gt; requires AllowedContainer&lt;C, Element&gt;\n    span(C&amp;);\n    template &lt;typename C&gt; requires AllowedContainer&lt;C const, Element&gt;\n    span(C const&amp;);\n};\n</code></pre>\n\n<hr />\n\n<p>The <code>const</code>-ness requirement there prevents the nice <em>partial-concept-id</em> syntax, but we could just add another concept for that I guess:</p>\n\n<pre><code>template &lt;typename T, typename E&gt;\nconcept ConstAllowedContainer = AllowedContainer&lt;T const, E&gt;;\n\ntemplate &lt;typename Element, std::ptrdiff_t Extent = -1&gt;\nstruct span {\n    template &lt;AllowedContainer&lt;E&gt; C&gt;      span(C&amp;);\n    template &lt;ConstAllowedContainer&lt;E&gt; C&gt; span(C const&amp;);\n};\n</code></pre>\n\n<p>Not sure if there's a cleverer approach here yet. </p>\n\n<hr />\n\n<p>But really this whole pair-of-constructor thing is probably a mistake and you want to do a forwarding reference:</p>\n\n<pre><code>template &lt;typename Element, std::ptrdiff_t Extent = -1&gt;\nstruct span {\n    template &lt;AllowedContainer&lt;E&gt; C&gt;\n    span(C&amp;&amp;);\n};\n</code></pre>\n\n<p>This last approach requires a few tweaks to the concept (all the <code>remove_cv_t</code>'s should become <code>remove_cvref_t</code>'s).</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user3624760"}, "edited": false, "score": 0, "creation_date": 1547672794, "post_id": 54225347, "comment_id": 95276559, "body": "<code>span</code> requires contiguous memory. AFAIK <code>Range</code> doesn&#39;t guarantee it."}, {"owner": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "edited": false, "score": 0, "creation_date": 1547672891, "post_id": 54225347, "comment_id": 95276611, "body": "@Lyberta thank you so I correct and use ContiguousRange instead! <a href=\"http://eel.is/c++draft/range.req#range.refinements-2\" rel=\"nofollow noreferrer\">eel.is/c++draft/range.req#range.refinements-2</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user3624760"}, "edited": false, "score": 0, "creation_date": 1547674178, "post_id": 54225347, "comment_id": 95277225, "body": "Well, on a practical point, this would require implementing ranges which is a huge amount of work. I only implement my span because it is not yet in the libstdc++ that I use. Maybe using ranges is a better interface, then it should be proposed for standardization."}, {"owner": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "edited": false, "score": 0, "creation_date": 1547676213, "post_id": 54225347, "comment_id": 95278058, "body": "@Lyberta In this case the concept check you are trying to implement will be unusefull. The reason is that <code>span</code> constructor list as described in <a href=\"https://en.cppreference.com/w/cpp/container/span/span\" rel=\"nofollow noreferrer\">en.cppreference.com/w/cpp/container/span/span</a> already proposes overloads for array specialization and span specialization. Implementing the concept check will be almost unusefull. I say almost because I suppose their is a design or cpp-reference mistakes in this list. Just add a <code>span(span&lt;U,N&gt;&amp;)</code> constructor and a <code>span(span&amp;)</code> constructor and the job will be done."}, {"owner": {"user_type": "does_not_exist", "display_name": "user3624760"}, "edited": false, "score": 0, "creation_date": 1547677183, "post_id": 54225347, "comment_id": 95278464, "body": "I implemented all 10 constructors that are in the standard."}, {"owner": {"reputation": 245138, "user_id": 2069064, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/e4V2X.jpg?s=128&g=1", "display_name": "Barry", "link": "https://stackoverflow.com/users/2069064/barry"}, "edited": false, "score": 0, "creation_date": 1547677554, "post_id": 54225347, "comment_id": 95278651, "body": "Except <code>span</code> has this additional dynamic/static extent concept, so it needs to treat contiguous ranges that have static extents separately"}, {"owner": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "reply_to_user": {"reputation": 245138, "user_id": 2069064, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/e4V2X.jpg?s=128&g=1", "display_name": "Barry", "link": "https://stackoverflow.com/users/2069064/barry"}, "edited": false, "score": 0, "creation_date": 1547677937, "post_id": 54225347, "comment_id": 95278797, "body": "@Barry I would put these constructors where there belong: the specialized class for dynamic or static extent that hold non static data members but that is a detail."}, {"owner": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "edited": false, "score": 0, "creation_date": 1547678063, "post_id": 54225347, "comment_id": 95278851, "body": "@Lyberta If you implement the concept check you will not follow the standard, ... so why not taking the fast path."}, {"owner": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "edited": false, "score": 0, "creation_date": 1547678236, "post_id": 54225347, "comment_id": 95278909, "body": "@Lyberta Because the concept check will only exclude <code>span(container&amp;)</code> when the argument is a <code>span&lt;...&gt;</code> so their is no point in implementing this huge machinery just for that. You define a <code>span(span&lt;...&gt; a&amp;):span(as_const(a)){}</code> and the job is done."}], "tags": [], "owner": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "is_accepted": false, "score": 0, "last_activity_date": 1547672806, "last_edit_date": 1547672806, "creation_date": 1547672641, "answer_id": 54225347, "question_id": 54221785, "link": "https://stackoverflow.com/questions/54221785/disable-class-specialization-using-concepts/54225347#54225347", "title": "Disable class specialization using concepts", "body": "<p>You are miss-using concepts. In a concept world span constructor will look like this with the concept-ts syntax:</p>\n\n<pre><code>struct span{\n   span(const ContiguousRange&amp;);\n   span(ContiguousRange&amp;);\n   span(const span&amp;) =default;\n   span(span&amp;) =default;\n   };\n</code></pre>\n\n<p>or with c++20:</p>\n\n<pre><code>struct span{\n   span(const ContiguousRange auto&amp;);\n   span(ContiguousRange auto&amp;);\n   span(const span&amp;) =default;\n   span(span&amp;) =default;\n   };\n</code></pre>\n\n<p>Concepts are here to ease abstraction. So that if your interface get more complex when using concepts then you have missed the abstraction. The abstraction here is <code>ContiguousRange</code> (thanks to @Lyberta).</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user3624760"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 1, "accepted_answer_id": 54222366, "answer_count": 3, "score": 8, "last_activity_date": 1547677646, "creation_date": 1547657614, "last_edit_date": 1547658620, "question_id": 54221785, "link": "https://stackoverflow.com/questions/54221785/disable-class-specialization-using-concepts", "title": "Disable class specialization using concepts", "body": "<p>I'm implementing my own version of <code>std::span</code> using Concepts TS. I got stuck implementing <a href=\"http://eel.is/c++draft/span.cons#14\" rel=\"noreferrer\">these constructors</a>:</p>\n\n<pre><code>template&lt;class Container&gt; constexpr span(Container&amp; cont);\ntemplate&lt;class Container&gt; constexpr span(const Container&amp; cont);\n</code></pre>\n\n<p>Remarks: These constructors shall not participate in overload resolution unless:</p>\n\n<ul>\n<li><code>Container</code> is not a specialization of <code>span</code>, and</li>\n<li><code>Container</code> is not a specialization of <code>array</code></li>\n</ul>\n\n<p>How to implement this using concepts?</p>\n"}, {"tags": ["c++", "struct", "compiler-errors"], "answers": [{"comments": [{"owner": {"reputation": 361, "user_id": 10750848, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OjwC2GFnC84/AAAAAAAAAAI/AAAAAAAAACs/uuek3B_ubhA/photo.jpg?sz=128", "display_name": "Clebo Sevic", "link": "https://stackoverflow.com/users/10750848/clebo-sevic"}, "edited": false, "score": 0, "creation_date": 1547657120, "post_id": 54221478, "comment_id": 95269085, "body": "I understand the request, but the problem is, that i would like to keep the template argument as generic as possible, because i might add more Tensor-classes later on. But i&#39;ll keep it in mind for now, thx"}, {"owner": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "reply_to_user": {"reputation": 361, "user_id": 10750848, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OjwC2GFnC84/AAAAAAAAAAI/AAAAAAAAACs/uuek3B_ubhA/photo.jpg?sz=128", "display_name": "Clebo Sevic", "link": "https://stackoverflow.com/users/10750848/clebo-sevic"}, "edited": false, "score": 0, "creation_date": 1547657180, "post_id": 54221478, "comment_id": 95269121, "body": "@CleboSevic The specialization thing was only as a demonstration/example, not a request that you should do it. The &quot;fixed&quot; code is indeed generic and should not need the specialization."}], "tags": [], "owner": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "is_accepted": true, "score": 1, "last_activity_date": 1547657132, "last_edit_date": 1547657132, "creation_date": 1547656547, "answer_id": 54221478, "question_id": 54221411, "link": "https://stackoverflow.com/questions/54221411/error-invalid-use-of-template-name-extree-without-an-argument-list-how-do/54221478#54221478", "title": "error: invalid use of template-name \u2018ExTree\u2019 without an argument list || How do if fix this? (Beginner)", "body": "<p>The correct syntax would be:</p>\n\n<pre><code>template &lt;typename T&gt;\nExTree&lt;T&gt;* newExTree(T tensor){\n    ExTree&lt;T&gt; *e = new ExTree&lt;T&gt;();\n    e-&gt;left = e-&gt;right = nullptr;\n    e-&gt;tensor = tensor;\n    return e;\n}\n</code></pre>\n\n<p>As the compiler tells you, <code>ExTree</code> is a template, not a type. If you write a template, that is not some \"super-type\" for all the types you create from it. It's basically just a block of code that is (re)created for every type (or combination of types) it is instantiated with; it is not some unifying concept. A template is <em>not</em> a type, and return <em>types</em> and variable <em>types</em> are, well, types, so you must specify which types to instantiate the template with to get a concrete type to use (ignoring certain C++14 rules that make things more muddy).</p>\n\n<p>Further, you should not repeat the template argument after the function name as you did. That is done in the specialization of templates, but not in their initial declaration. For example, if you wanted to specialize <code>newExTree</code> for <code>T = int</code>, you would write</p>\n\n<pre><code>template&lt;&gt; ExTree&lt;int&gt;* newExTree&lt;int&gt;(int x) {\n    // ...\n}\n</code></pre>\n"}], "owner": {"reputation": 361, "user_id": 10750848, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OjwC2GFnC84/AAAAAAAAAAI/AAAAAAAAACs/uuek3B_ubhA/photo.jpg?sz=128", "display_name": "Clebo Sevic", "link": "https://stackoverflow.com/users/10750848/clebo-sevic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 0, "closed_date": 1547704137, "accepted_answer_id": 54221478, "answer_count": 1, "score": -1, "last_activity_date": 1547657132, "creation_date": 1547656300, "last_edit_date": 1547656624, "question_id": 54221411, "link": "https://stackoverflow.com/questions/54221411/error-invalid-use-of-template-name-extree-without-an-argument-list-how-do", "closed_reason": "Not suitable for this site", "title": "error: invalid use of template-name \u2018ExTree\u2019 without an argument list || How do if fix this? (Beginner)", "body": "<p>Where is the missing part? Or the other way around, what is wrong here? I am still new to C++ and things like this are very difficult to google and search for specifically.</p>\n\n<pre><code>template &lt;typename T&gt;\nstruct ExTree{\n    T tensor;\n    ExTree* left, *right;\n};\n\ntemplate &lt;typename T&gt;\nExTree* newExTree&lt;T&gt;(T tensor){\n    ExTree *e = new ExTree&lt;T&gt;();\n    e-&gt;left = e-&gt;right = NULL;\n    e-&gt;tensor = tensor;\n    return e;\n}\n</code></pre>\n\n<p>This is the error-message:</p>\n\n<pre><code>In file included from main.cpp:5:0:\nexpression.hpp:47:1: error: invalid use of template-name \u2018ExTree\u2019 without an argument list\n ExTree* newExTree&lt;T&gt;(T tensor){\n</code></pre>\n\n<p>EDIT: I have found the error, but the reason behind it still eludes me, so my question is still kind of valid. I hope it is not to simple^^</p>\n"}, {"tags": ["c#", "c++"], "comments": [{"owner": {"reputation": 570607, "user_id": 505088, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/3c0aac2191718ef0309dbc034d9b9961?s=128&d=identicon&r=PG", "display_name": "David Heffernan", "link": "https://stackoverflow.com/users/505088/david-heffernan"}, "edited": false, "score": 0, "creation_date": 1547661390, "post_id": 54221375, "comment_id": 95271298, "body": "Your C++ code writes 70 times to the same pair. That ist what you meant to do is it."}], "answers": [{"comments": [{"owner": {"reputation": 28373, "user_id": 5015238, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8790f8091d3c6c58fd45664a165117a?s=128&d=identicon&r=PG", "display_name": "jdweng", "link": "https://stackoverflow.com/users/5015238/jdweng"}, "reply_to_user": {"reputation": 55, "user_id": 8321012, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-dXk9qWH_Gj8/AAAAAAAAAAI/AAAAAAAAAO4/UFN-4p3_fRE/photo.jpg?sz=128", "display_name": "CerraossoUC", "link": "https://stackoverflow.com/users/8321012/cerraossouc"}, "edited": false, "score": 0, "creation_date": 1547664095, "post_id": 54221844, "comment_id": 95272592, "body": "Make sure you are reading the actual data.  I just used a memory stream to show sample of the code."}, {"owner": {"reputation": 55, "user_id": 8321012, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-dXk9qWH_Gj8/AAAAAAAAAAI/AAAAAAAAAO4/UFN-4p3_fRE/photo.jpg?sz=128", "display_name": "CerraossoUC", "link": "https://stackoverflow.com/users/8321012/cerraossouc"}, "edited": false, "score": 0, "creation_date": 1547682082, "post_id": 54221844, "comment_id": 95280096, "body": "yep, i read acutal data but your logic still get same proglem, all array returning 0, but thx any way"}, {"owner": {"reputation": 28373, "user_id": 5015238, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8790f8091d3c6c58fd45664a165117a?s=128&d=identicon&r=PG", "display_name": "jdweng", "link": "https://stackoverflow.com/users/5015238/jdweng"}, "reply_to_user": {"reputation": 55, "user_id": 8321012, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-dXk9qWH_Gj8/AAAAAAAAAAI/AAAAAAAAAO4/UFN-4p3_fRE/photo.jpg?sz=128", "display_name": "CerraossoUC", "link": "https://stackoverflow.com/users/8321012/cerraossouc"}, "edited": false, "score": 0, "creation_date": 1547702104, "post_id": 54221844, "comment_id": 95283977, "body": "When returning a data from a method you have to allocate the memory before calling the method.  Variables are stored on the execution stack and the stack is not defined after returning.  I added some additional code to show how to allocate and get data when calling a method using Unmanaged memory."}], "tags": [], "owner": {"reputation": 28373, "user_id": 5015238, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8790f8091d3c6c58fd45664a165117a?s=128&d=identicon&r=PG", "display_name": "jdweng", "link": "https://stackoverflow.com/users/5015238/jdweng"}, "is_accepted": true, "score": 0, "last_activity_date": 1547701905, "last_edit_date": 1547701905, "creation_date": 1547657834, "answer_id": 54221844, "question_id": 54221375, "link": "https://stackoverflow.com/questions/54221375/buffer-blockcopy-array-2d-c-to-c-shared-memory/54221844#54221844", "title": "Buffer.BlockCopy Array 2d c++ to C# shared memory", "body": "<p>Try following :</p>\n\n<pre><code>              MemoryStream stream = new MemoryStream();\n              byte[] buffer = new byte[70 * 2 * sizeof(int)];\n              stream.Read(buffer, 0, 70 * 2 * sizeof(int));\n              for (int i = 0; i&lt; 70; i++)\n              {\n                  for (int j = 0; j &lt; 2; j++)\n                  {\n                      Console.WriteLine(BitConverter.ToUInt32(buffer,(i * 2 * sizeof(int)) + (j * sizeof(int))));\n                  }\n              }\n</code></pre>\n\n<hr>\n\n<pre><code>           IntPtr bufferPtr = Marshal.AllocHGlobal(BUFFER_SIZE);\n\n            //you need to allocate memory before calling the routing\n\n            byte[] buffer = new byte[BUFFER_SIZE];\n            Marshal.Copy(bufferPtr, buffer, 0, BUFFER_SIZE);\n            for (int i = 0; i &lt; 70; i++)\n            {\n                for (int j = 0; j &lt; 2; j++)\n                {\n                    Console.WriteLine(BitConverter.ToUInt32(buffer, (i * 2 * sizeof(int)) + (j * sizeof(int))));\n                }\n            }\n\n            //method 2\n            int[,] array = new int[40, 2];\n            IntPtr bufferPtr2 = Marshal.AllocHGlobal(Marshal.SizeOf(array));\n\n            //call routine then you code below to fill managed memory.\n            Marshal.PtrToStructure(bufferPtr2, array);\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 8321012, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-dXk9qWH_Gj8/AAAAAAAAAAI/AAAAAAAAAO4/UFN-4p3_fRE/photo.jpg?sz=128", "display_name": "CerraossoUC", "link": "https://stackoverflow.com/users/8321012/cerraossouc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "accepted_answer_id": 54221844, "answer_count": 1, "score": -2, "last_activity_date": 1547701905, "creation_date": 1547656183, "question_id": 54221375, "link": "https://stackoverflow.com/questions/54221375/buffer-blockcopy-array-2d-c-to-c-shared-memory", "title": "Buffer.BlockCopy Array 2d c++ to C# shared memory", "body": "<p>I write a c++ program that send via memorystream a array multi to c# aplication. But i dont know hot to use BlockCopy to array multi:</p>\n\n<p>this is my program c++ that send array multi</p>\n\n<pre><code>struct Pair {\n\n    std::pair&lt;int, int&gt; players;\n};\n\nstruct Pair* p;\nHANDLE handle;\n\nfloat dataSend[70];\n\nbool startShare()\n{\n    try\n    {\n        handle = CreateFileMappingW(INVALID_HANDLE_VALUE, NULL, PAGE_READWRITE, 0, sizeof(Pair), L\"DataSend\");\n        p = (struct Pair*) MapViewOfFile(handle, FILE_MAP_READ | FILE_MAP_WRITE, 0, 0, sizeof(Pair));\n        return true;\n    }\n    catch (...)\n    {\n        return false;\n    }\n\n}\nfor (int i = 0; i &lt; 70; i++)\n{\n\n    int r1 = rand() % 10 + 1;\n    int r2 = rand() % 10 + 1;\n    p-&gt;players = { r1,r2 };\n\n}\n</code></pre>\n\n<p>example aoutput:</p>\n\n<pre><code> players  0 - [10][2]\n players  1 - [100][22]\n players 2 - [1][26]\n players 3 - [50][211]\n players 4 - [32][23]\n</code></pre>\n\n<p>my c# program read:</p>\n\n<pre><code>public static int[,] data = new int[70, 1];\npublic static MemoryMappedFile mmf;\npublic static MemoryMappedViewStream mmfvs;\n\nstatic public bool MemOpen()\n{\n    try\n    {\n        mmf = MemoryMappedFile.OpenExisting(\"DataSend\");\n        mmfvs = mmf.CreateViewStream();\n        return true;\n    }\n    catch\n    {\n        return false;\n    }\n\n}\n\n// here need be somethings like   byte[,] bPosition = new byte[70,1];\nbyte[] bPosition = new byte[70];\nmmfvs.Read(bPosition, 0, 100);\nBuffer.BlockCopy(bPosition, 0, data, 0, bPosition.Length);\n for (int i = 0; i&lt; data.Length; i++)\n {\n    for(int j=0;j&lt;1;j++)\n    {\n\n      Console.WriteLine(data[i][j]);\n\n    }\n</code></pre>\n\n<p>}</p>\n\n<p>example receive :</p>\n\n<pre><code> data  0 - [10][2]\n data  1 - [100][22]\n data 2 - [1][26]\n data 3 - [50][211]\n data 4 - [32][23]\n</code></pre>\n\n<p>I write a c++ program that send via memorystream a array multi to c# aplication. But i dont know hot to use BlockCopy to array multi:</p>\n\n<p>this is my program c++ that send array multi</p>\n"}, {"tags": ["c++", "com", "ui-automation"], "comments": [{"owner": {"reputation": 116623, "user_id": 403671, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/454HU.jpg?s=128&g=1", "display_name": "Simon Mourier", "link": "https://stackoverflow.com/users/403671/simon-mourier"}, "edited": false, "score": 0, "creation_date": 1547656318, "post_id": 54220938, "comment_id": 95268610, "body": "Can&#39;t reproduce the issue. What Windows version are you using?"}, {"owner": {"reputation": 19, "user_id": 7951093, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8448c7391e0d0ac6411a25d8ddee2a5c?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Scott", "link": "https://stackoverflow.com/users/7951093/dan-scott"}, "reply_to_user": {"reputation": 116623, "user_id": 403671, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/454HU.jpg?s=128&g=1", "display_name": "Simon Mourier", "link": "https://stackoverflow.com/users/403671/simon-mourier"}, "edited": false, "score": 0, "creation_date": 1547656515, "post_id": 54220938, "comment_id": 95268731, "body": "windows 7 with SP 1, also running it on VS2015 (will add this to the original question)"}, {"owner": {"reputation": 116623, "user_id": 403671, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/454HU.jpg?s=128&g=1", "display_name": "Simon Mourier", "link": "https://stackoverflow.com/users/403671/simon-mourier"}, "edited": false, "score": 0, "creation_date": 1547663151, "post_id": 54220938, "comment_id": 95272190, "body": "<code>CUIAutomation8</code> is documented to need Windows 8 or higher <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/hh448746(v=vs.85).aspx\" rel=\"nofollow noreferrer\">msdn.microsoft.com/en-us/library/windows/desktop/&hellip;</a> for Windows 7, try <code>CUIAutomation</code> (w/o 8)"}, {"owner": {"reputation": 19, "user_id": 7951093, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8448c7391e0d0ac6411a25d8ddee2a5c?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Scott", "link": "https://stackoverflow.com/users/7951093/dan-scott"}, "reply_to_user": {"reputation": 116623, "user_id": 403671, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/454HU.jpg?s=128&g=1", "display_name": "Simon Mourier", "link": "https://stackoverflow.com/users/403671/simon-mourier"}, "edited": false, "score": 0, "creation_date": 1547735733, "post_id": 54220938, "comment_id": 95300880, "body": "ah perfect, that worked straight away, ofcourse it&#39;s just a simple &quot;read the documentation&quot; issue, thanks for your help! you&#39;ve posted as a comment, is there anyway i can mark your reply as the answer?"}], "answers": [{"tags": [], "owner": {"reputation": 116623, "user_id": 403671, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/454HU.jpg?s=128&g=1", "display_name": "Simon Mourier", "link": "https://stackoverflow.com/users/403671/simon-mourier"}, "is_accepted": true, "score": 1, "last_activity_date": 1547737681, "creation_date": 1547737681, "answer_id": 54238777, "question_id": 54220938, "link": "https://stackoverflow.com/questions/54220938/missing-registry-key-for-iuiautomation/54238777#54238777", "title": "Missing registry key for IUIAutomation", "body": "<p><code>CUIAutomation8</code> is documented to need <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/hh448746(v=vs.85).aspx\" rel=\"nofollow noreferrer\">Windows 8 or higher</a> for Windows 7, you want to use <code>CUIAutomation</code></p>\n"}], "owner": {"reputation": 19, "user_id": 7951093, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8448c7391e0d0ac6411a25d8ddee2a5c?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Scott", "link": "https://stackoverflow.com/users/7951093/dan-scott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 54238777, "answer_count": 1, "score": 0, "last_activity_date": 1547737681, "creation_date": 1547654561, "last_edit_date": 1547656543, "question_id": 54220938, "link": "https://stackoverflow.com/questions/54220938/missing-registry-key-for-iuiautomation", "title": "Missing registry key for IUIAutomation", "body": "<p>I'm trying to use the UI Automation sample on msdn located here;</p>\n\n<p><a href=\"https://code.msdn.microsoft.com/windowsdesktop/UI-Automation-Document-24a37c82#content\" rel=\"nofollow noreferrer\">https://code.msdn.microsoft.com/windowsdesktop/UI-Automation-Document-24a37c82#content</a></p>\n\n<p>i keep getting the error message: REGDB_E_CLASSNOTREG Class not registered</p>\n\n<p>The Microsoft example uses this line to create an instance of the CUIAutomation8;</p>\n\n<p>CoCreateInstance(__uuidof(CUIAutomation8), NULL, CLSCTX_INPROC_SERVER, IID_PPV_ARGS(&amp;_automation));</p>\n\n<p>which is the part it seems to be failing at, from digging around this seems to be getting the id of the class and then checking the registry key at that location ({E22AD333-B25F-460C-83D0-0581107395C9} in this case) however my machine doesn't have this key already entered which i think is causing the error, i'm not sure if i'm having to install anything extra that i'm currently missing? As of now all i've done is download the sample and tried compiling it</p>\n\n<p>any help would be much appreciated!</p>\n\n<p>note: I'm using windows 7 with SP1 and VS2015</p>\n\n<p>i've also tried changing CUIAutomation8 to IUIAutomation instead but i'm getting the same issue but as a different registry key</p>\n"}, {"tags": ["c++", "iostream", "rvalue-reference", "istream"], "comments": [{"owner": {"reputation": 168120, "user_id": 102937, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1233ec65168f4aae4d939ae8fe6cde1e?s=128&d=identicon&r=PG", "display_name": "Robert Harvey", "link": "https://stackoverflow.com/users/102937/robert-harvey"}, "edited": false, "score": 6, "creation_date": 1547654324, "post_id": 54220831, "comment_id": 95267428, "body": "Undoubtedly the C++ language lawyers will have a few things to say about this.   In the meantime, can you define the terms &quot;okay,&quot; &quot;safe,&quot; &quot;reasonable&quot; and &quot;dangerous&quot; within the context of your question, please?  One man&#39;s cognac is another man&#39;s poison."}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1547654455, "post_id": 54220831, "comment_id": 95267518, "body": "Safe from <b>what</b>? <b>OK</b> by whom? Dangerous by what?"}, {"owner": {"reputation": 83151, "user_id": 3943312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc00b38b94ca7b6f820622b0a8af8ded?s=128&d=identicon&r=PG", "display_name": "Sam Varshavchik", "link": "https://stackoverflow.com/users/3943312/sam-varshavchik"}, "edited": false, "score": 0, "creation_date": 1547654616, "post_id": 54220831, "comment_id": 95267623, "body": "Seems to me this is just a way to force this parameter to always be a temporary."}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1547654690, "post_id": 54220831, "comment_id": 95267666, "body": "Is your goal with <code>SomeObject parse (std::istream &amp;&amp; input)</code> is to get the function to only accept temporaries?"}, {"owner": {"reputation": 9602, "user_id": 7151494, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-a_FzvY-b2O0/AAAAAAAAAAI/AAAAAAAAAEw/kNwilSAvQTI/photo.jpg?sz=128", "display_name": "Fureeish", "link": "https://stackoverflow.com/users/7151494/fureeish"}, "reply_to_user": {"reputation": 83151, "user_id": 3943312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc00b38b94ca7b6f820622b0a8af8ded?s=128&d=identicon&r=PG", "display_name": "Sam Varshavchik", "link": "https://stackoverflow.com/users/3943312/sam-varshavchik"}, "edited": false, "score": 1, "creation_date": 1547654748, "post_id": 54220831, "comment_id": 95267704, "body": "@SamVarshavchik or to force a programmer to <code>std::move</code> the input stream that&#39;s worked on, which will indicate that noone should try to extract from it afterwards."}, {"owner": {"reputation": 14474, "user_id": 2064761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GoIUL.png?s=128&g=1", "display_name": "Michael Kenzel", "link": "https://stackoverflow.com/users/2064761/michael-kenzel"}, "edited": false, "score": 0, "creation_date": 1547655885, "post_id": 54220831, "comment_id": 95268354, "body": "It doesn&#39;t seem &quot;dangerous&quot; given the current state of the <code>std::istream</code> interface. But the semantics here are IMHO questionable. What does it mean for the calling code to &quot;give away ownership&quot; but at the same time &quot;not transferring it&quot;? Who &quot;owns&quot; the stream after <code>parse()</code> returns!? In what way exactly does <code>parse()</code> make the stream &quot;unusable&quot;? What if parsing fails due to some error before the entire stream is &quot;consumed&quot;? Is the stream &quot;unusable&quot; then!? Is &quot;ownership&quot; somehow &quot;given back&quot; to the calling code in this case?"}, {"owner": {"reputation": 34388, "user_id": 2610810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8c6433073e71478e8da278a188e1d15?s=128&d=identicon&r=PG", "display_name": "Caleth", "link": "https://stackoverflow.com/users/2610810/caleth"}, "edited": false, "score": 0, "creation_date": 1547656148, "post_id": 54220831, "comment_id": 95268514, "body": "Is this worth the WTF factor of somewhere down the line a caller being forced to write <code>parse(std::move(std::cin))</code>?"}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "reply_to_user": {"reputation": 34388, "user_id": 2610810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8c6433073e71478e8da278a188e1d15?s=128&d=identicon&r=PG", "display_name": "Caleth", "link": "https://stackoverflow.com/users/2610810/caleth"}, "edited": false, "score": 0, "creation_date": 1547656209, "post_id": 54220831, "comment_id": 95268556, "body": "@Caleth Consider that it could very well be used with other streams, and <code>prase(std::move(my_string_stream));</code> is much less shocking."}, {"owner": {"reputation": 9602, "user_id": 7151494, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-a_FzvY-b2O0/AAAAAAAAAAI/AAAAAAAAAEw/kNwilSAvQTI/photo.jpg?sz=128", "display_name": "Fureeish", "link": "https://stackoverflow.com/users/7151494/fureeish"}, "reply_to_user": {"reputation": 34388, "user_id": 2610810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8c6433073e71478e8da278a188e1d15?s=128&d=identicon&r=PG", "display_name": "Caleth", "link": "https://stackoverflow.com/users/2610810/caleth"}, "edited": false, "score": 1, "creation_date": 1547656212, "post_id": 54220831, "comment_id": 95268558, "body": "@Caleth and after the initial &quot;WTF&quot; you begin to understand that &quot;oh, so it will parse the entire input, since I am giving up the ownership of <code>std::cin</code> and I should not use it afterwads. Got it. Neat&quot;. At least in my perception. Consider also the usage of <code>std::stringstream</code>s and <code>std::fstream</code>s."}, {"owner": {"reputation": 14474, "user_id": 2064761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GoIUL.png?s=128&g=1", "display_name": "Michael Kenzel", "link": "https://stackoverflow.com/users/2064761/michael-kenzel"}, "edited": false, "score": 1, "creation_date": 1547656313, "post_id": 54220831, "comment_id": 95268607, "body": "So what can it possibly do to make <code>std::cin</code> unusable? This aspect particularly doesn&#39;t make any sense to me given the very concept of a stream. A stream can be at EOF. That doesn&#39;t make that stream object unusable. A stream can be in a bad state. That doesn&#39;t make the object unusable\u2026"}, {"owner": {"reputation": 9602, "user_id": 7151494, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-a_FzvY-b2O0/AAAAAAAAAAI/AAAAAAAAAEw/kNwilSAvQTI/photo.jpg?sz=128", "display_name": "Fureeish", "link": "https://stackoverflow.com/users/7151494/fureeish"}, "reply_to_user": {"reputation": 14474, "user_id": 2064761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GoIUL.png?s=128&g=1", "display_name": "Michael Kenzel", "link": "https://stackoverflow.com/users/2064761/michael-kenzel"}, "edited": false, "score": 0, "creation_date": 1547656451, "post_id": 54220831, "comment_id": 95268697, "body": "@MichaelKenzel whatever in the entire world the programmer of <code>parse</code> wants it to do. It&#39;s not promising that &quot;I will destroy this stream so much you won&#39;t even be able to recongise what&#39;s left&quot;. It&#39;s expressing that &quot;I want to own that stream, do whatever I want with it and you won&#39;t be using it for other things than assigning to it&quot;."}, {"owner": {"reputation": 14474, "user_id": 2064761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GoIUL.png?s=128&g=1", "display_name": "Michael Kenzel", "link": "https://stackoverflow.com/users/2064761/michael-kenzel"}, "edited": false, "score": 1, "creation_date": 1547656509, "post_id": 54220831, "comment_id": 95268728, "body": "But what&#39;s the point of introducing this arbitrary restriction to the interface when there&#39;s literally nothing an implementation could possibly do to &quot;take advantage&quot; of it!?"}, {"owner": {"reputation": 9602, "user_id": 7151494, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-a_FzvY-b2O0/AAAAAAAAAAI/AAAAAAAAAEw/kNwilSAvQTI/photo.jpg?sz=128", "display_name": "Fureeish", "link": "https://stackoverflow.com/users/7151494/fureeish"}, "edited": false, "score": 0, "creation_date": 1547656788, "post_id": 54220831, "comment_id": 95268880, "body": "To indicate that it will read everything. It&#39;s not about taking advantage of rvalue references. It&#39;s about using rvalue references to express the intent in a very clever way that&#39;s possible to perform a check on at compile time."}, {"owner": {"reputation": 14474, "user_id": 2064761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GoIUL.png?s=128&g=1", "display_name": "Michael Kenzel", "link": "https://stackoverflow.com/users/2064761/michael-kenzel"}, "edited": false, "score": 0, "creation_date": 1547657075, "post_id": 54220831, "comment_id": 95269053, "body": "By passing a reference to a non-const <code>std::istream</code>, the caller already has to assume that whoever gets the stream will read from it. If it reads beyond the end of the stream, the stream will be in an EOF state. If an error occurs, the stream will be in a bad state. In no case will the stream object itself be in an &quot;unusable&quot; state. That&#39;s what the whole concept of an <code>std::istream</code> is about\u2026"}, {"owner": {"reputation": 34388, "user_id": 2610810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8c6433073e71478e8da278a188e1d15?s=128&d=identicon&r=PG", "display_name": "Caleth", "link": "https://stackoverflow.com/users/2610810/caleth"}, "edited": false, "score": 1, "creation_date": 1547657127, "post_id": 54220831, "comment_id": 95269090, "body": "&quot;very clever way&quot; which a number of us think is <i>confusing</i>. And it isn&#39;t a great check, because you can fairly easily <i>lie</i>, see <code>parse(std::move(std::cin))</code>"}, {"owner": {"reputation": 9602, "user_id": 7151494, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-a_FzvY-b2O0/AAAAAAAAAAI/AAAAAAAAAEw/kNwilSAvQTI/photo.jpg?sz=128", "display_name": "Fureeish", "link": "https://stackoverflow.com/users/7151494/fureeish"}, "edited": false, "score": 0, "creation_date": 1547657309, "post_id": 54220831, "comment_id": 95269192, "body": "While it&#39;s not perfect (and a lot of discussions could fire off, since it&#39;s actually the first time I see something like that) and potentially tricky to &#39;get&#39;, I still think it actually expresses the intent very clearly. Also, I don&#39;t consider <code>parse(std::move(std::cin))</code> a <i>lie</i>. Go ahead and parse everything from <code>std::cin</code>. I <i>could</i> obviously do something with it afterwads (you <i>can</i> do pretty much everything in <code>C++</code>), but I know I shouldn&#39;t. If you want to read from <code>std::cin</code> in other way than <code>parse</code> does, then... don&#39;t use <code>parse</code>?"}, {"owner": {"reputation": 19146, "user_id": 635654, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/b8fb58eef98caeec6ab3366e0ac986d7?s=128&d=identicon&r=PG", "display_name": "CygnusX1", "link": "https://stackoverflow.com/users/635654/cygnusx1"}, "edited": false, "score": 0, "creation_date": 1547658147, "post_id": 54220831, "comment_id": 95269661, "body": "What if it is something more than a regular array of characters or a file. It could be, for example, a network connection, or an input-output pipe, or .... Just because <code>parse</code> will read everything, doesn&#39;t mean that it becomes useless to the caller. It could, for example, do something asynchronously in another thread. For example, reads from the stream could block current thread, waiting for another thread to write to the same object. But if you force it to be <code>std::move</code>-d, you hint that it shouldn&#39;t be used that way."}, {"owner": {"reputation": 9602, "user_id": 7151494, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-a_FzvY-b2O0/AAAAAAAAAAI/AAAAAAAAAEw/kNwilSAvQTI/photo.jpg?sz=128", "display_name": "Fureeish", "link": "https://stackoverflow.com/users/7151494/fureeish"}, "edited": false, "score": 0, "creation_date": 1547658536, "post_id": 54220831, "comment_id": 95269857, "body": "I will repeat this once again, since I already provided the answer to that question - if <code>parse</code> does something you don&#39;t want to do, then simply <b>don&#39;t</b> use <code>parse</code>."}, {"owner": {"reputation": 19146, "user_id": 635654, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/b8fb58eef98caeec6ab3366e0ac986d7?s=128&d=identicon&r=PG", "display_name": "CygnusX1", "link": "https://stackoverflow.com/users/635654/cygnusx1"}, "reply_to_user": {"reputation": 9602, "user_id": 7151494, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-a_FzvY-b2O0/AAAAAAAAAAI/AAAAAAAAAEw/kNwilSAvQTI/photo.jpg?sz=128", "display_name": "Fureeish", "link": "https://stackoverflow.com/users/7151494/fureeish"}, "edited": false, "score": 0, "creation_date": 1547659053, "post_id": 54220831, "comment_id": 95270133, "body": "@Fureeish If you are refering to my examples - I don&#39;t see <code>parse</code> doing anything that I don&#39;t want it to do, <i>except</i> for taking my <code>istream</code> by r-value reference - and that is the OP&#39;s question - or at least close to it - &quot;is it ok?&quot;, or as I interpret - &quot;do I lose something by doing so?&quot;"}, {"owner": {"reputation": 9602, "user_id": 7151494, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-a_FzvY-b2O0/AAAAAAAAAAI/AAAAAAAAAEw/kNwilSAvQTI/photo.jpg?sz=128", "display_name": "Fureeish", "link": "https://stackoverflow.com/users/7151494/fureeish"}, "edited": false, "score": 0, "creation_date": 1547659268, "post_id": 54220831, "comment_id": 95270260, "body": "<code>parse</code> could spawn a thread that will wait for any signal from given stream and in that case you would want to ensure that <i>nobody else will ever use such stream</i>. There are a few examples, but I think it&#39;s not the best place to discuss this idea. You certainly have valid points and I am leaning towards your position, but I still have some doubts. Let&#39;s wait for other possible answers."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547659278, "post_id": 54220831, "comment_id": 95270267, "body": "Whatever <code>parse</code> does, the premise of the question is that it renders the stream unreadable. If you can&#39;t agree that the premise might be true then replace <code>std::istream</code> with <code>foo</code> which can be anything compatible with the premise."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "reply_to_user": {"reputation": 9602, "user_id": 7151494, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-a_FzvY-b2O0/AAAAAAAAAAI/AAAAAAAAAEw/kNwilSAvQTI/photo.jpg?sz=128", "display_name": "Fureeish", "link": "https://stackoverflow.com/users/7151494/fureeish"}, "edited": false, "score": 0, "creation_date": 1547659326, "post_id": 54220831, "comment_id": 95270288, "body": "@Fureeish Watch out though. That example may not be appropriate here. If it performs asynchronous operations it either has to actually take ownership of the stream somehow to preserve it&#39;s lifetime or the function caller has a huge burden of making the the stream outlives the asynchronous operation."}], "answers": [{"comments": [{"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 3, "creation_date": 1547654486, "post_id": 54220905, "comment_id": 95267544, "body": "Taking <code>rvalue</code> reference and moving is not necessarily married to each other."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "reply_to_user": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1547654532, "post_id": 54220905, "comment_id": 95267578, "body": "@SergeyA Not seeing the purpose of an rvalue reference if you&#39;re not going to transfer ownership via a move (and you don&#39;t want to limit calls to rvalue expressions for arcane overloading reasons). Can you give an example of when this would be useful?"}, {"owner": {"reputation": 9602, "user_id": 7151494, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-a_FzvY-b2O0/AAAAAAAAAAI/AAAAAAAAAEw/kNwilSAvQTI/photo.jpg?sz=128", "display_name": "Fureeish", "link": "https://stackoverflow.com/users/7151494/fureeish"}, "edited": false, "score": 2, "creation_date": 1547654665, "post_id": 54220905, "comment_id": 95267651, "body": "&quot;<i>Can you give an example</i>&quot;, well, the code in the question... At least in my opinion, the fact that one will <i>transfer ownership</i> of the input stream (which passing by rvalue reference means) will indicate that noone should try to extract from it afterwards, which I consider a neat way of using <code>C++</code> syntax to express the intent. But that&#39;s just my opinion."}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1547654755, "post_id": 54220905, "comment_id": 95267708, "body": "You gave one yourself - you want your call be limited to rvalues. For example, (I am not saying this OPs case, I think the question isn&#39;t clear and closable) one might want to request that object provided to the function is a &quot;scratchpad&quot;. I am using it myself in a certain case."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547655071, "post_id": 54220905, "comment_id": 95267872, "body": "If the function must make the received object unusable it might as well end it&#39;s lifetime. You might not actually move in a sink function, you might just put that object in a limited functionality state (similar or identical to a moved-from state). But functionally, it looks exactly like it took ownership of the object. In a way it did even if it doesn&#39;t keep that ownership."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 1, "creation_date": 1547657152, "post_id": 54220905, "comment_id": 95269105, "body": "Transferring ownership is quite a well-defined context in C++ and it usually involves a move. You simply cannot do that with a <code>std::istream</code>. You can make your function accept only an rvalue to signify that it&#39;s going to read all the data from the stream, sure, but that&#39;s not what transferring ownership has ever meant in C++, so this would be quite strange IMO! I mean I can <i>kind of</i> see it, but I can&#39;t see that it&#39;s worthwhile."}, {"owner": {"reputation": 325120, "user_id": 501557, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/e4bac7ebd5f5a06c716f508af656e24b?s=128&d=identicon&r=PG", "display_name": "templatetypedef", "link": "https://stackoverflow.com/users/501557/templatetypedef"}, "edited": false, "score": 0, "creation_date": 1547657999, "post_id": 54220905, "comment_id": 95269566, "body": "Are you sure you can\u2019t move <code>std::istream</code>s? <a href=\"https://en.cppreference.com/w/cpp/io/basic_istream/basic_istream\" rel=\"nofollow noreferrer\">This suggests otherwise</a> and I\u2019m fairly certain that I\u2019ve done this before."}, {"owner": {"reputation": 5668, "user_id": 4083309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6b4ef5a2e912153069b82607789a717?s=128&d=identicon&r=PG&f=1", "display_name": "Arne Vogel", "link": "https://stackoverflow.com/users/4083309/arne-vogel"}, "edited": false, "score": 0, "creation_date": 1547659598, "post_id": 54220905, "comment_id": 95270414, "body": "@LightnessRacesinOrbit There are places in the standard library where an xvalue is taken, but not necessarily moved from, e.g. <code>std::string operator +(std::string&amp;&amp;, std::string&amp;&amp;)</code> (I know it&#39;s actually a template, I&#39;m following KISS.) As such, I don&#39;t think rvalues <i>imply</i> moving."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "reply_to_user": {"reputation": 325120, "user_id": 501557, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/e4bac7ebd5f5a06c716f508af656e24b?s=128&d=identicon&r=PG", "display_name": "templatetypedef", "link": "https://stackoverflow.com/users/501557/templatetypedef"}, "edited": false, "score": 1, "creation_date": 1547661932, "post_id": 54220905, "comment_id": 95271572, "body": "@templatetypedef Only from within derived types - the move ctor is protected."}], "tags": [], "owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "is_accepted": false, "score": 6, "last_activity_date": 1547657259, "last_edit_date": 1547657259, "creation_date": 1547654441, "answer_id": 54220905, "question_id": 54220831, "link": "https://stackoverflow.com/questions/54220831/is-it-reasonable-to-take-stdistream-as-a-argument/54220905#54220905", "title": "Is it reasonable to take std::istream&amp;&amp; as a argument?", "body": "<p><a href=\"https://stackoverflow.com/a/8591806/560648\">An <code>std::istream</code> isn't moveable</a>, so there's no practical benefit to this.</p>\n\n<p>This already signals that the thing may be \"modified\", without the confusion of suggesting you're transferring ownership of the <code>std::istream</code> object (which you're not doing, and can't do).</p>\n\n<p>I can <em>kind of</em> see the rationale behind using this to say that the stream is being logically moved, but I think you have to make a distinction between \"ownership of this thing is being transferred\", and \"I keep ownership of this thing but I will let you consume all of its services\". Ownership transfer is quite well understood as a convention in C++, and this is not really it. What will a user of your code think when they have to write <code>parse(std::move(std::cin))</code>?</p>\n\n<p>Your way isn't \"dangerous\" though; you won't be able to do anything with that rvalue reference that you can't with an lvalue reference.</p>\n\n<p>It would be far more self-documenting and conventional to just take an lvalue reference.</p>\n"}, {"comments": [{"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1547662136, "post_id": 54221352, "comment_id": 95271674, "body": "Mostly agreed but I still don&#39;t see why you&#39;d want to do that to a stream. It&#39;s unnecessarily constrictive unless there are domain constraints the OP hasn&#39;t mentioned. Michael&#39;s answer puts it quite nicely."}], "tags": [], "owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "is_accepted": false, "score": 6, "last_activity_date": 1547656109, "creation_date": 1547656109, "answer_id": 54221352, "question_id": 54220831, "link": "https://stackoverflow.com/questions/54220831/is-it-reasonable-to-take-stdistream-as-a-argument/54221352#54221352", "title": "Is it reasonable to take std::istream&amp;&amp; as a argument?", "body": "<p><code>std::move</code> just produces an rvalue reference from an object and nothing more. The nature of an rvalue is such that you can assume nobody else will care about it's state after you're done with it. <code>std::move</code> then is used to allow developpers to make that promise about objects with other value categories. In other words calling <code>std::move</code> in a meaningful context is equivalent to saying \"I promise I don't care about this object's state anymore\".</p>\n\n<p>Since you will be making the object essentially unusable and you want to make sure the caller won't use the object anymore using an rvalue reference enforces this expectation to some extent. It forces the caller to make that promise to your function. Failure to make the promise will result in a compiler error (assuming there isn't another valid overload). It does not matter if you actually move from the object or not, only that the original owner has agreed to forfeit it's ownership.</p>\n"}, {"tags": [], "owner": {"reputation": 14474, "user_id": 2064761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GoIUL.png?s=128&g=1", "display_name": "Michael Kenzel", "link": "https://stackoverflow.com/users/2064761/michael-kenzel"}, "is_accepted": false, "score": 2, "last_activity_date": 1547662463, "last_edit_date": 1547662463, "creation_date": 1547660426, "answer_id": 54222542, "question_id": 54220831, "link": "https://stackoverflow.com/questions/54220831/is-it-reasonable-to-take-stdistream-as-a-argument/54222542#54222542", "title": "Is it reasonable to take std::istream&amp;&amp; as a argument?", "body": "<p>What you're trying to do here is not \"dangerous\" in the sense that, given the current <code>std::istream</code> interface, there don't seem to be any circumstances under wich taking an rvalue reference here would necessarily lead to undefined behavior when taking an lvalue reference wouldn't have. But the semantics of this whole contraption are IMHO very questionable at best. What does it mean for the calling code to \"give away ownership\" but at the same time \"not transferring it\"? Who \"owns\" the stream after <code>parse()</code> returns!? In what way exactly does <code>parse()</code> make the stream \"unusable\"? What if parsing fails due to some error before the entire stream is \"consumed\"? Is the stream \"unusable\" then!? Is no one allowed to try read the rest? Is \"ownership\" somehow \"given back\" to the calling code in this case? </p>\n\n<p>A stream is an abstract concept. The purpose of the stream abstraction is to serve as an interface through which someone can consume input without having to know where the data comes from, lives, or how it is accessed and managed. If the purpose of <code>parse()</code> is to parse input from arbitrary sources, then it should not be concerned with the nature of the source. If it is concerned with the nature of the source, then it should request a specific kind of source. And this is where, IMHO, your interface contradicts itself. Currently, <code>parse()</code> takes an arbitrary source. The interface says: I take whatever stream you give me, I don't care how it's implemented. As long as it's a stream, I can work with it. At the same time, it requires the caller to relinquish the object that actually implements the stream. The interface requires the caller to hand over something that the interface itself prevents any implementation behind the interface to ever know about, access, or use in any way. For example, how would I have <code>parse()</code> read from an <code>std::ifstream</code>? Who closes the file afterwards? If can't be the parser. It also can't be me because calling the parser forced me to hand over the object. At the same time, I know that the parser could never even know it had to close the file I handed over\u2026</p>\n\n<p>It'll still do the right thing in the end because there was no way an implementation of the interface could've actually done what the interface suggested it would do and so my <code>std::ifstream</code> destructor will just run and close the file. But what exactly did we gain by lying to each other like that!? You promised to take over the object when you were never going to, I promised to never touch the object again when I knew I'll always have to\u2026</p>\n"}, {"comments": [{"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1547662003, "post_id": 54222815, "comment_id": 95271614, "body": "What are those purposes? I think that&#39;s the key point to this question. If you can explain what purpose this holds in that example, and how it relates to the OP&#39;s situation, that&#39;s probably the answer."}], "tags": [], "owner": {"reputation": 290304, "user_id": 187690, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/89a4da7af5bf1558b7d2704309f1f118?s=128&d=identicon&r=PG", "display_name": "AnT", "link": "https://stackoverflow.com/users/187690/ant"}, "is_accepted": false, "score": 2, "last_activity_date": 1547662473, "last_edit_date": 1547662473, "creation_date": 1547661651, "answer_id": 54222815, "question_id": 54220831, "link": "https://stackoverflow.com/questions/54220831/is-it-reasonable-to-take-stdistream-as-a-argument/54222815#54222815", "title": "Is it reasonable to take std::istream&amp;&amp; as a argument?", "body": "<p>Your assumption that rvalue reference parameter imply \"taking ownership\" is completely incorrect. Rvalue reference is just a specific kind of reference, which comes with its own initialization rules and overload resolution rules. No more, no less. Formally, it has no special affinity with \"moving\" or \"taking ownership\" of the referenced object. </p>\n\n<p>It is true that support for <em>move semantics</em> is considered one of the primary purposes of rvalue references, but still you should not assume that this is their <em>only</em> purpose and that these features are somehow inseparable. Just like any other language feature, it might allow a significant number of well-developed alternative idiomatic uses.</p>\n\n<p>An example quote similar to what you just quoted is actually present in the standard library itself. It is the extra overloads introduced in C++11 (and C++17, depending on some nuances)</p>\n\n<pre><code>template&lt; class CharT, class Traits, class T &gt;\nbasic_ostream&lt; CharT, Traits &gt;&amp; operator&lt;&lt;( basic_ostream&lt;CharT,Traits&gt;&amp;&amp; os, \n                                            const T&amp; value );\n\ntemplate&lt; class CharT, class Traits, class T &gt;\nbasic_istream&lt;CharT,Traits&gt;&amp; operator&gt;&gt;( basic_istream&lt;CharT,Traits&gt;&amp;&amp; st, T&amp;&amp; value );\n</code></pre>\n\n<p>Their main purpose is to \"bridge\" the difference in the behavior between member and non-member overloads of <code>operator &lt;&lt;</code></p>\n\n<pre><code>#include &lt;string&gt;\n#include &lt;sstream&gt;\n\nint main() \n{\n  std::string s;\n  int a;\n\n  std::istringstream(\"123 456\") &gt;&gt; a &gt;&gt; s;\n  std::istringstream(\"123 456\") &gt;&gt; s &gt;&gt; a;\n  // Despite the obvious similarity, the first line is well-formed in C++03\n  // while the second isn't. Both lines are well-formed in C++11\n}\n</code></pre>\n\n<p>It takes advantage of the fact that rvalue reference can bind to temporary objects and still see them as <em>modifiable</em> objects. In this case rvalue reference is used for purposes that have nothing to do with move semantics. This is perfectly normal.</p>\n"}], "owner": {"reputation": 29435, "user_id": 458742, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ee0a7599f30c29076a3c9a2c022e473b?s=128&d=identicon&r=PG", "display_name": "spraff", "link": "https://stackoverflow.com/users/458742/spraff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 559, "favorite_count": 2, "answer_count": 4, "score": 8, "last_activity_date": 1547662473, "creation_date": 1547654177, "question_id": 54220831, "link": "https://stackoverflow.com/questions/54220831/is-it-reasonable-to-take-stdistream-as-a-argument", "title": "Is it reasonable to take std::istream&amp;&amp; as a argument?", "body": "<p>I have encountered code which does this:</p>\n\n<pre><code>SomeObject parse (std::istream &amp;&amp; input) {....\n</code></pre>\n\n<p>The <code>input</code> argument is an rvalue reference, which normally means the function is intended to take ownership of the argument. That's not quite what is happening here.</p>\n\n<p>The <code>parse</code> function will completely consume the input stream, and it demands an rvalue reference because then calling code will give away ownership of the <code>istream</code> and hence this is a signal that the input stream will be unusable.</p>\n\n<p>I think this is okay because, since the <code>parse</code> function doesn't actually move the object around, there is no danger of slicing out the subtype. This is basically behaving as a normal reference from <code>parse</code>'s point of view, only there is a kind of compilable comment to the calling function that you have to give up ownership of the stream.</p>\n\n<p>Is this code actually safe? Or is there some overlooked subtlety which makes this dangerous?</p>\n"}, {"tags": ["c++", "move-semantics"], "comments": [{"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 3, "creation_date": 1547653721, "post_id": 54220686, "comment_id": 95267072, "body": "<code>MyMovingBase&lt;SubClass&gt;(std::move(src))</code> Note that <code>src</code> is an rvalue reference but is itself an lvalue so won&#39;t bind to another rvalue reference on it&#39;s own."}, {"owner": {"reputation": 4446, "user_id": 576448, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/hVxvC.jpg?s=128&g=1", "display_name": "peterk", "link": "https://stackoverflow.com/users/576448/peterk"}, "reply_to_user": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547653817, "post_id": 54220686, "comment_id": 95267135, "body": "will try it :) seems pretty nasty though.seems like a (Class &amp;&amp;) cast would be more language consistent."}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 4, "creation_date": 1547653871, "post_id": 54220686, "comment_id": 95267165, "body": "Save yourself and use the rule of zero <code>class Subclass     : public MyMovingBase&lt;SubClass&gt; {}</code> will automagically call the base class constructors for you since the compiler generated defaults &quot;do the right thing&quot;"}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 1, "creation_date": 1547653872, "post_id": 54220686, "comment_id": 95267166, "body": "Since <code>MyMovingBase</code> and <code>Subclass</code> are your own class, the guaranties regarding the post-move state is entirely in your hands. I don&#39;t see what&#39;s nasty about it."}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "edited": false, "score": 0, "creation_date": 1547653895, "post_id": 54220686, "comment_id": 95267179, "body": "What is <code>MtY</code> ?"}, {"owner": {"reputation": 4446, "user_id": 576448, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/hVxvC.jpg?s=128&g=1", "display_name": "peterk", "link": "https://stackoverflow.com/users/576448/peterk"}, "edited": false, "score": 1, "creation_date": 1547654022, "post_id": 54220686, "comment_id": 95267252, "body": "The nastiness in is the syntax not the flexibility :)"}, {"owner": {"reputation": 4446, "user_id": 576448, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/hVxvC.jpg?s=128&g=1", "display_name": "peterk", "link": "https://stackoverflow.com/users/576448/peterk"}, "edited": false, "score": 0, "creation_date": 1547654268, "post_id": 54220686, "comment_id": 95267395, "body": "Thanks for the duplicate pointer - their smart duplicate finder didn&#39;t show this one and I didn&#39;t see it :)"}, {"owner": {"reputation": 26945, "user_id": 771073, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/412bf39694cbe9d1fc0374deda225b18?s=128&d=identicon&r=PG", "display_name": "Martin Bonner supports Monica", "link": "https://stackoverflow.com/users/771073/martin-bonner-supports-monica"}, "edited": false, "score": 1, "creation_date": 1547654554, "post_id": 54220686, "comment_id": 95267592, "body": "@peterk If somebody has flagged up one of your questions as duplicate, you can close it yourself as duplicate.  (I found this myself on another site.)"}, {"owner": {"reputation": 4446, "user_id": 576448, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/hVxvC.jpg?s=128&g=1", "display_name": "peterk", "link": "https://stackoverflow.com/users/576448/peterk"}, "edited": false, "score": 0, "creation_date": 1547654907, "post_id": 54220686, "comment_id": 95267784, "body": "Often though having a number of ways of expressing the question in the database inproves seachability however :)  I have often found an answer by finding questions flagged as duplicates that led me to the best answer."}], "answers": [{"comments": [{"owner": {"reputation": 3700, "user_id": 2573127, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/J2n1Z.png?s=128&g=1", "display_name": "IceFire", "link": "https://stackoverflow.com/users/2573127/icefire"}, "reply_to_user": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1547654380, "post_id": 54220816, "comment_id": 95267470, "body": "@NathanOliver thanks for this detail, I have added a sentence addressing this"}], "tags": [], "owner": {"reputation": 3700, "user_id": 2573127, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/J2n1Z.png?s=128&g=1", "display_name": "IceFire", "link": "https://stackoverflow.com/users/2573127/icefire"}, "is_accepted": true, "score": 4, "last_activity_date": 1547654539, "last_edit_date": 1547654539, "creation_date": 1547654108, "answer_id": 54220816, "question_id": 54220686, "link": "https://stackoverflow.com/questions/54220686/how-does-one-call-a-move-constructor-in-a-base-class-in-c/54220816#54220816", "title": "How does one call a &quot;move&quot; &#39;&amp;&amp;&#39; constructor in a base class? in C++", "body": "<p>In general, marking some variable as <code>rvalue reference</code> with <code>&amp;&amp;</code> does not mean that it keeps this status when passing <code>src</code> further. I mean, after all, the variable has a name in the context of the constructor and can therefore obviously be used as <code>lvalue</code>. In fact, the expression <code>src</code> is indeed an <code>lvalue</code>. <code>src</code> is passed to your constructor as <code>rvalue</code> because the caller intended to have it interpreted as such.</p>\n\n<p>Now, in your constructor, the variable is actually named and using this name leads to an expression that needs to be explicitly marked as <code>rvalue reference</code> to be interpreted as such. Otherwise, it just is an lvalue. This is why you have to <code>move</code> it again to be interpreted by the callee (here, <code>MyMovingBase::ctor</code>) as <code>rvalue</code> whose contents are allowed to be moved out of the original object.</p>\n\n<p>Therefore, Fran\u00e7ois' comment is correct. Using</p>\n\n<pre><code>Subclass(Subclass &amp;&amp;src) : MyMovingBase&lt;SubClass&gt;(std::move(src))\n</code></pre>\n\n<p>does the trick.</p>\n"}], "owner": {"reputation": 4446, "user_id": 576448, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/hVxvC.jpg?s=128&g=1", "display_name": "peterk", "link": "https://stackoverflow.com/users/576448/peterk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 198, "favorite_count": 0, "closed_date": 1547654471, "accepted_answer_id": 54220816, "answer_count": 1, "score": 2, "last_activity_date": 1547654539, "creation_date": 1547653672, "question_id": 54220686, "link": "https://stackoverflow.com/questions/54220686/how-does-one-call-a-move-constructor-in-a-base-class-in-c", "closed_reason": "Duplicate", "title": "How does one call a &quot;move&quot; &#39;&amp;&amp;&#39; constructor in a base class? in C++", "body": "<p>I have a class containing pointers to objects and a subclass of it.  The subclass \"move\" constructor I want to call the base class move constructor for obvious reasons.  With MSVS 2017 compiler this does not seem to work.</p>\n\n<pre><code>template&lt;class SubT&gt;\nclass MyMovingBase {\n    typedef MyMovingBase&lt;MtY&gt; ThisT; \nprotected:\n    MyMovingBase(const ThisT &amp;src) {\n         // update copy and or reference DO NOT Move\n    }\n    MyMovingBase(ThisT &amp;&amp;src) { \n         // move stuff from src to this, invalidate src\n     }\n};\n\nclass Subclass\n    : public MyMovingBase&lt;SubClass&gt;\n{\npublic:\n    Subclass(const Subclass &amp;src) : MyMovingBase&lt;SubClass&gt;(src) {\n        // does what is expected, calls copy constructor.\n    }\n    Subclass(Subclass &amp;&amp;src) : MyMovingBase&lt;SubClass&gt;(src) {\n        // the above initializer calls copy constructor and NOT\n        // the move constructor for MyMovingBase !!!!!!\n    }\n};\n</code></pre>\n\n<p>How do I make this do what I want ??</p>\n\n<p>Of course I want it to work in gcc and clang as well.</p>\n"}, {"tags": ["c++", "qt", "sockets", "tcp"], "comments": [{"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 2, "creation_date": 1547653480, "post_id": 54220526, "comment_id": 95266915, "body": "A TCP stream has no structure. You can receive the data in any number of <code>readAll</code> calls. If you want a sequence of &quot;frames&quot;, you need to add that structure yourself."}, {"owner": {"reputation": 29, "user_id": 10567713, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-AmUjt7nCbZg/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbDCj9Bivm8UNlRrUpDKC52Y8WIBlA/mo/photo.jpg?sz=128", "display_name": "onur cevik", "link": "https://stackoverflow.com/users/10567713/onur-cevik"}, "reply_to_user": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1547657954, "post_id": 54220526, "comment_id": 95269535, "body": "@molbdnilo can you show me some example about the structure you talk about? I mean I am already can send frames the only problem is frame rate is low."}], "answers": [{"comments": [{"owner": {"reputation": 29, "user_id": 10567713, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-AmUjt7nCbZg/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbDCj9Bivm8UNlRrUpDKC52Y8WIBlA/mo/photo.jpg?sz=128", "display_name": "onur cevik", "link": "https://stackoverflow.com/users/10567713/onur-cevik"}, "edited": false, "score": 0, "creation_date": 1547658461, "post_id": 54220717, "comment_id": 95269822, "body": "but I am checking if there is any active connection with <code>if(socket-&gt;state()==QAbstractSocket::ConnectedState)</code> right ?Then hoow do I call <code>startConnection()</code> at each timer tick ? Am I missing something here ?"}, {"owner": {"reputation": 9720, "user_id": 6371123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f90991c1b06c79ae4c6e79fb616d608?s=128&d=identicon&r=PG", "display_name": "G.M.", "link": "https://stackoverflow.com/users/6371123/g-m"}, "reply_to_user": {"reputation": 29, "user_id": 10567713, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-AmUjt7nCbZg/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbDCj9Bivm8UNlRrUpDKC52Y8WIBlA/mo/photo.jpg?sz=128", "display_name": "onur cevik", "link": "https://stackoverflow.com/users/10567713/onur-cevik"}, "edited": false, "score": 1, "creation_date": 1547659876, "post_id": 54220717, "comment_id": 95270566, "body": "@onurcevik Why do you need to connect and disconnect for each frame?  With <code>TCP</code> you would usually connect once, leave the connection open while there is data to be exchanged and then disconnect."}, {"owner": {"reputation": 571, "user_id": 4096272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345c800d1d42a321a26ce5033e75f437?s=128&d=identicon&r=PG&f=1", "display_name": "Tony J", "link": "https://stackoverflow.com/users/4096272/tony-j"}, "edited": false, "score": 0, "creation_date": 1547665048, "post_id": 54220717, "comment_id": 95273044, "body": "Every call to startConnection() actually toggles the connection on and off, which explains why you get half the frames. startButton::clicked is already connected to startConnection(), you shouldn&#39;t need to connect/disconnect after sending each Frame."}, {"owner": {"reputation": 29, "user_id": 10567713, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-AmUjt7nCbZg/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbDCj9Bivm8UNlRrUpDKC52Y8WIBlA/mo/photo.jpg?sz=128", "display_name": "onur cevik", "link": "https://stackoverflow.com/users/10567713/onur-cevik"}, "reply_to_user": {"reputation": 9720, "user_id": 6371123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f90991c1b06c79ae4c6e79fb616d608?s=128&d=identicon&r=PG", "display_name": "G.M.", "link": "https://stackoverflow.com/users/6371123/g-m"}, "edited": false, "score": 0, "creation_date": 1547665091, "post_id": 54220717, "comment_id": 95273066, "body": "@G.M. I tried to implement server-client system here : <a href=\"https://stackoverflow.com/questions/20546750/qtcpsocket-reading-and-writing/20558939\" title=\"qtcpsocket reading and writing\">stackoverflow.com/questions/20546750/&hellip;</a>  I couldn&#39;t read socket to buffer fora single connection. But I can with multiple connections with <code>QBuffer* buffer = buffers.value(socket);</code> . How can I read from socket to buffer for single connection ?"}, {"owner": {"reputation": 9720, "user_id": 6371123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f90991c1b06c79ae4c6e79fb616d608?s=128&d=identicon&r=PG", "display_name": "G.M.", "link": "https://stackoverflow.com/users/6371123/g-m"}, "reply_to_user": {"reputation": 29, "user_id": 10567713, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-AmUjt7nCbZg/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbDCj9Bivm8UNlRrUpDKC52Y8WIBlA/mo/photo.jpg?sz=128", "display_name": "onur cevik", "link": "https://stackoverflow.com/users/10567713/onur-cevik"}, "edited": false, "score": 0, "creation_date": 1547666344, "post_id": 54220717, "comment_id": 95273626, "body": "@onurcevik It sounds like the basic issue you have is as described by @molbdnilo -- you expect one write from the server to correspond to exactly one read on the client.  The question you reference does provide an answer but, if you&#39;re not happy using that you might want to look at using the <a href=\"http://doc.qt.io/qt-5/qwebsocketserver.html\" rel=\"nofollow noreferrer\"><code>QWebSocketServer</code></a> framework instead of <code>QTcpServer</code>.  That way you can simply send each frame via <a href=\"http://doc.qt.io/qt-5/qwebsocket.html#sendBinaryMessage\" rel=\"nofollow noreferrer\">`QWebSocket::sendBinaryMessage</a>."}], "tags": [], "owner": {"reputation": 1571, "user_id": 2034218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/607f22adeb07d267b740a5441eb36d6d?s=128&d=identicon&r=PG", "display_name": "Tezirg", "link": "https://stackoverflow.com/users/2034218/tezirg"}, "is_accepted": false, "score": 1, "last_activity_date": 1547653776, "creation_date": 1547653776, "answer_id": 54220717, "question_id": 54220526, "link": "https://stackoverflow.com/questions/54220526/low-tcp-connection-performance-problem-in-qt/54220717#54220717", "title": "Low TCP Connection performance problem in QT", "body": "<p>You're calling <code>startConnection();</code> at each timer tick. That has the effect of alternating between closing and reopening the connection.</p>\n\n<ul>\n<li><p>You can either remove the call to <code>startConnection</code> in <code>sendFrame</code>, keeping the TCP connection open. </p></li>\n<li><p>Or double you timer tick rate to <code>timer.start(1000/48);</code></p></li>\n</ul>\n"}], "owner": {"reputation": 29, "user_id": 10567713, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-AmUjt7nCbZg/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbDCj9Bivm8UNlRrUpDKC52Y8WIBlA/mo/photo.jpg?sz=128", "display_name": "onur cevik", "link": "https://stackoverflow.com/users/10567713/onur-cevik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 271, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1551529098, "creation_date": 1547653191, "last_edit_date": 1551529098, "question_id": 54220526, "link": "https://stackoverflow.com/questions/54220526/low-tcp-connection-performance-problem-in-qt", "title": "Low TCP Connection performance problem in QT", "body": "<p>I am working on a Image Processing project where I get frames from camera and send the frame via TCP Connection built with Qt Libraries. <strong>I am trying to send 24 frames but when I run the program only 13 frames(roughly) arrive.</strong></p>\n\n<p>I use signals and slots to start connection with button and when connection establishes the timer starts and I send 24 frames in a second.</p>\n\n<p>Edit: I switched to single connection server but it didn't affect performance much also sometimes frames get corrupted(?) (I only see blank frame)</p>\n\n<p><strong>tcpsender.cpp</strong></p>\n\n<pre><code>#include \"tcpsender.h\"\n#include \"ui_tcpsender.h\"\n\n#include &lt;QtWidgets&gt;\n#include &lt;QtNetwork&gt;\n#include &lt;QtCore&gt;\n#include &lt;QDebug&gt;\n#include &lt;QBuffer&gt;\n#include &lt;QDataStream&gt;\n\n#define XRES 640\n#define YRES 480\n\n\nTCPSender::TCPSender(QWidget *parent) :\n    QWidget(parent),\n    ui(new Ui::TCPSender)\n{\n    ui-&gt;setupUi(this);\n    statusLabel = new QLabel(tr(\"Ready to send frames on port 6667\"));\n    statusLabel-&gt;setWordWrap(true);\n    startButton = new QPushButton(tr(\"&amp;Start\"));\n    auto quitButton = new QPushButton(tr(\"&amp;Quit\"));\n    auto buttonBox = new QDialogButtonBox;\n    buttonBox-&gt;addButton(startButton, QDialogButtonBox::ActionRole);\n    buttonBox-&gt;addButton(quitButton, QDialogButtonBox::RejectRole);\n\n    socket = new QTcpSocket(this);\n    connect(startButton, &amp;QPushButton::clicked, this, &amp;TCPSender::startConnection);\n    connect(quitButton, &amp;QPushButton::clicked, this, &amp;TCPSender::close);\n    connect(socket, SIGNAL(connected()), SLOT(startSending()));\n    connect(&amp;timer, &amp;QTimer::timeout, this, &amp;TCPSender::sendFrame);\n\n    auto mainLayout = new QVBoxLayout;\n    mainLayout-&gt;addWidget(statusLabel);\n    mainLayout-&gt;addWidget(buttonBox);\n    setLayout(mainLayout);\n\n    setWindowTitle(tr(\"Broadcast Sender\"));\n    camera = new Camera(\"/dev/video0\", XRES, YRES);\n\n    time = QTime::currentTime();\n\n}\n\nTCPSender::~TCPSender()\n{\n    delete ui;\n}\n\nbool TCPSender::startConnection()\n{\n    if (socket-&gt;state() == QAbstractSocket::UnconnectedState)\n    {\n\n        socket-&gt;connectToHost(ui-&gt;lineEdit-&gt;text(), 6667, QIODevice::WriteOnly);\n        return socket-&gt;waitForConnected();\n\n    }\n}\n\nvoid TCPSender::startSending()\n{\n    startButton-&gt;setEnabled(false);\n    timer.start(1000/24);\n    qDebug()&lt;&lt;\"Timer start\";\n}\n\nbool TCPSender::sendFrame()\n{\n    if(socket-&gt;state()==QAbstractSocket::ConnectedState){\n        auto frame = camera-&gt;frame();\n\n        image = new QImage(frame.data,XRES,YRES,QImage::Format_RGB888);\n        QImage im = image-&gt;convertToFormat(QImage::Format_Grayscale8);\n        QByteArray ba;\n        QBuffer buffer(&amp;ba);\n        im.save(&amp;buffer,\"BMP\");\n\n        qDebug()&lt;&lt;\"writing socket\";\n        socket-&gt;write(ba);\n\n        int speed = time.msecsTo(QTime::currentTime());\n        time = QTime::currentTime();\n        speed = 1000*300/speed;\n        ui-&gt;label-&gt;setText(QString(\"%1 kb/s\").arg(speed));\n        delete image;\n\n   }\n\n}\n</code></pre>\n\n<p><strong>receiver.cpp</strong></p>\n\n<pre><code>#include \"reciever.h\"    \n#include &lt;QBuffer&gt;\n#include &lt;QTcpSocket&gt;\n#include &lt;QImage&gt;\n#include &lt;QDebug&gt;\n#include &lt;iostream&gt;\n#include &lt;fstream&gt;\n#include &lt;string&gt;\n#include &lt;sstream&gt;\n#include &lt;unistd.h&gt;\n\nReciever::Reciever(QObject* parent): QTcpServer(parent)\n{\n    connect(this, SIGNAL(newConnection()), this, SLOT(addConnection()));\n}\n\nvoid Reciever::addConnection()\n{\n    qDebug()&lt;&lt;\"Adding Connection\";\n    QTcpSocket* connection = nextPendingConnection();\n    connect(connection, SIGNAL(readyRead()),\n            this, SLOT(receiveImage()));\n\n    connections.append(connection);\n    QBuffer* buffer = new QBuffer(this);\n    buffer-&gt;open(QIODevice::ReadWrite);\n    buffers.insert(connection, buffer);\n\n}\n\nvoid Reciever::receiveImage()\n{\n    qDebug()&lt;&lt;\"RECIEVE\";\n    QTcpSocket* socket = static_cast&lt;QTcpSocket*&gt;(sender());\n    QBuffer* buffer = buffers.value(socket);\n    qint64 bytes = buffer-&gt;write(socket-&gt;readAll());   \n    emit sendBuffer(buffer,bytes);\n}\n</code></pre>\n"}, {"tags": ["c++", "image", "matlab"], "comments": [{"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1547652337, "post_id": 54220140, "comment_id": 95266215, "body": "what exactly is a &quot;640 * 480 matrix&quot; ? what type should the data be in the end?"}, {"owner": {"reputation": 407, "user_id": 5112772, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/48db220796ff15413c08519cd5a1faa9?s=128&d=identicon&r=PG&f=1", "display_name": "humbleHacker", "link": "https://stackoverflow.com/users/5112772/humblehacker"}, "reply_to_user": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1547653385, "post_id": 54220140, "comment_id": 95266854, "body": "Sorry, matrix refers to a <code>Mat</code> type in OpenCV. The final data type should be unsigned char."}, {"owner": {"reputation": 184, "user_id": 5650378, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ti25t.jpg?s=128&g=1", "display_name": "najayaz", "link": "https://stackoverflow.com/users/5650378/najayaz"}, "edited": false, "score": 1, "creation_date": 1547653786, "post_id": 54220140, "comment_id": 95267118, "body": "Why not generate the C++ code from MATLAB itself and see what it&#39;s doing?"}, {"owner": {"reputation": 1680, "user_id": 5282154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a468ae12f72b587ad0c4e89ffde11839?s=128&d=identicon&r=PG", "display_name": "doug", "link": "https://stackoverflow.com/users/5282154/doug"}, "edited": false, "score": 0, "creation_date": 1547654493, "post_id": 54220140, "comment_id": 95267550, "body": "Looks like the raw data is a 640*480 size vector of bytes that is column major on disk. You want to access it in C++ as row major and probably flip the row index (lower left corner of the image is either 0 or 479). This is pretty easy to do with a short lambda. It would be helpful if you provide what pixel on the image is accessed by say, <code>pixel(row, col)</code>  Where on the image would you want <code>pixel(0,0)</code> to be? Top left? lower left?"}, {"owner": {"reputation": 407, "user_id": 5112772, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/48db220796ff15413c08519cd5a1faa9?s=128&d=identicon&r=PG&f=1", "display_name": "humbleHacker", "link": "https://stackoverflow.com/users/5112772/humblehacker"}, "reply_to_user": {"reputation": 184, "user_id": 5650378, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ti25t.jpg?s=128&g=1", "display_name": "najayaz", "link": "https://stackoverflow.com/users/5650378/najayaz"}, "edited": false, "score": 0, "creation_date": 1547655047, "post_id": 54220140, "comment_id": 95267860, "body": "@G-man, I didn&#39;t know that option existed so I;m checking that out."}, {"owner": {"reputation": 407, "user_id": 5112772, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/48db220796ff15413c08519cd5a1faa9?s=128&d=identicon&r=PG&f=1", "display_name": "humbleHacker", "link": "https://stackoverflow.com/users/5112772/humblehacker"}, "reply_to_user": {"reputation": 1680, "user_id": 5282154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a468ae12f72b587ad0c4e89ffde11839?s=128&d=identicon&r=PG", "display_name": "doug", "link": "https://stackoverflow.com/users/5282154/doug"}, "edited": false, "score": 0, "creation_date": 1547655113, "post_id": 54220140, "comment_id": 95267892, "body": "@doug, <code>pixel(0,0)</code> on the image is top left"}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1547655601, "post_id": 54220140, "comment_id": 95268177, "body": "if you know the size in advance you just need two nested loops read the values one by one and set the correct pixel, sorry, but without providing more information on what causes you problems I dont think you will get a better answer than that"}, {"owner": {"reputation": 1680, "user_id": 5282154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a468ae12f72b587ad0c4e89ffde11839?s=128&d=identicon&r=PG", "display_name": "doug", "link": "https://stackoverflow.com/users/5282154/doug"}, "edited": false, "score": 0, "creation_date": 1547656759, "post_id": 54220140, "comment_id": 95268861, "body": "Also, 2D arrays are normally kept in memory as 1D vectors and just accessed appropriately based on whether row or col major. Do not create a <code>vector&lt;vector&lt;BYTE&gt;&gt;</code> to access like <code>v[i][j]</code> as it&#39;s slower."}], "answers": [{"comments": [{"owner": {"reputation": 407, "user_id": 5112772, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/48db220796ff15413c08519cd5a1faa9?s=128&d=identicon&r=PG&f=1", "display_name": "humbleHacker", "link": "https://stackoverflow.com/users/5112772/humblehacker"}, "edited": false, "score": 0, "creation_date": 1547658095, "post_id": 54221303, "comment_id": 95269634, "body": "I&#39;m really sorry but I&#39;ve been out the game for a long while. I haven&#39;t come across lamdas in C++ and even reading about them just now, I&#39;m still confused how to implement your answer. I was guessing I&#39;d need two FOR loops to work through the width and height. I&#39;ll try to edit my question to make it more appealing to everyone."}, {"owner": {"reputation": 1680, "user_id": 5282154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a468ae12f72b587ad0c4e89ffde11839?s=128&d=identicon&r=PG", "display_name": "doug", "link": "https://stackoverflow.com/users/5282154/doug"}, "reply_to_user": {"reputation": 407, "user_id": 5112772, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/48db220796ff15413c08519cd5a1faa9?s=128&d=identicon&r=PG&f=1", "display_name": "humbleHacker", "link": "https://stackoverflow.com/users/5112772/humblehacker"}, "edited": false, "score": 0, "creation_date": 1547660351, "post_id": 54221303, "comment_id": 95270805, "body": "You will get more specific responses if you include a snippet that is compilable since it will include things like the declaration of <code>rawData</code>.  That wasn&#39;t needed for the lambda since the only operator needed was <code>[]</code> For the function you will likely need to change it."}], "tags": [], "owner": {"reputation": 1680, "user_id": 5282154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a468ae12f72b587ad0c4e89ffde11839?s=128&d=identicon&r=PG", "display_name": "doug", "link": "https://stackoverflow.com/users/5282154/doug"}, "is_accepted": false, "score": 0, "last_activity_date": 1547659450, "last_edit_date": 1547659450, "creation_date": 1547655952, "answer_id": 54221303, "question_id": 54220140, "link": "https://stackoverflow.com/questions/54220140/c-version-of-matlab-code-that-reads-raw-image-bytes-from-file-and-reshapes-the/54221303#54221303", "title": "C++ version of MATLAB code that reads raw image bytes from file and reshapes them to image dimensions", "body": "<p>You should be able to access with a lambda like this:</p>\n\n<pre><code>auto&amp; pixel=[rawData, width](int row, int col) {\n    return rawData[col+width*row];};\n</code></pre>\n\n<p>Alternately, you can write a function which does the same. Lambdas are short and convenient ways of creating a function.</p>\n\n<pre><code>BYTE&amp; pixel(vector&lt;BYTE&gt;&amp; rawData, int width, int row, int col) {\n    return rawData[col+width*row];\n};\n</code></pre>\n\n<p>To use the lambda:</p>\n\n<pre><code>auto value_at_lower_right = pixel(479,639);\n</code></pre>\n\n<p>To use the function:</p>\n\n<pre><code>BYTE value_at_lower_right = pixel(rawData, width, 479,639);\n</code></pre>\n\n<p>These can be used on the left side as well to change a value in the image:</p>\n\n<pre><code>pixel(rawData, width, 479,639) = 127;\n// or, for the lambda\npixel(479,639) = 127;\n</code></pre>\n"}], "owner": {"reputation": 407, "user_id": 5112772, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/48db220796ff15413c08519cd5a1faa9?s=128&d=identicon&r=PG&f=1", "display_name": "humbleHacker", "link": "https://stackoverflow.com/users/5112772/humblehacker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1547659450, "creation_date": 1547651835, "question_id": 54220140, "link": "https://stackoverflow.com/questions/54220140/c-version-of-matlab-code-that-reads-raw-image-bytes-from-file-and-reshapes-the", "title": "C++ version of MATLAB code that reads raw image bytes from file and reshapes them to image dimensions", "body": "<p>I have some simple MATLAB code that reads a RAW file, representing an image, reshapes and transposes the data to image dimensions and then shows the image:</p>\n\n<pre><code>    width = 640;\n    height = 480;\n    fin = fopen('image.raw','r');\n    I = fread(fin, width * height, 'uint8=&gt;uint8'); \n    img = reshape(I, width, height);\n    img = img';\n    imgFromRaw = imshow(img)\n</code></pre>\n\n<p>How do I produce the same code in C++, either using a vector to read the raw file data or a BYTE pointer? I can read the file data into a vector like this:</p>\n\n<pre><code>    ifstream file(\"image.raw\", ios::binary);\n    rawData.insert(rawData.begin(),\n        std::istream_iterator&lt;BYTE&gt;(file),\n        std::istream_iterator&lt;BYTE&gt;());\n</code></pre>\n\n<p>But I don't know now how to reshape the data manually to be a 640 * 480 matrix. Any ideas?</p>\n"}, {"tags": ["c++", "parallel-processing", "stl"], "comments": [{"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 3, "creation_date": 1547651304, "post_id": 54219949, "comment_id": 95265620, "body": "You should be holding the mutex while setting your <code>_conditionReady</code> variable. Also, <code>sleep</code> is <b>never</b> a solution."}, {"owner": {"reputation": 19779, "user_id": 878532, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/5fbebb625a289267abd098c0e676c760?s=128&d=identicon&r=PG", "display_name": "Klaus", "link": "https://stackoverflow.com/users/878532/klaus"}, "edited": false, "score": 0, "creation_date": 1547651644, "post_id": 54219949, "comment_id": 95265829, "body": "you can also synchronize via std::atomic&lt;&gt;. It may simplify your code a lot."}], "answers": [{"tags": [], "owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "is_accepted": false, "score": 3, "last_activity_date": 1547651445, "creation_date": 1547651445, "answer_id": 54220016, "question_id": 54219949, "link": "https://stackoverflow.com/questions/54219949/notify-with-confirmation-in-c/54220016#54220016", "title": "Notify with confirmation in C++", "body": "<p>First and foremost, <strong>sleep</strong> is never a solution for bugs. It should really generate a compiler warning everytime it is used, which would convey the same message.</p>\n\n<p>Now, whenever you modify a control variable which is guarded by condition, it should be done while holding a mutex - usually same one which is used in your <code>cond.wait()</code>. Your code doesn't do this.</p>\n"}, {"comments": [{"owner": {"reputation": 195, "user_id": 4547130, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/10161e09050fa66da6f37ffd9df07a24?s=128&d=identicon&r=PG&f=1", "display_name": "newt", "link": "https://stackoverflow.com/users/4547130/newt"}, "edited": false, "score": 0, "creation_date": 1547652821, "post_id": 54220020, "comment_id": 95266497, "body": "Thank you for the detailed answer!"}], "tags": [], "owner": {"reputation": 22416, "user_id": 5494370, "user_type": "registered", "profile_image": "https://graph.facebook.com/10152989584621642/picture?type=large", "display_name": "Alan Birtles", "link": "https://stackoverflow.com/users/5494370/alan-birtles"}, "is_accepted": true, "score": 2, "last_activity_date": 1547651460, "creation_date": 1547651460, "answer_id": 54220020, "question_id": 54219949, "link": "https://stackoverflow.com/questions/54219949/notify-with-confirmation-in-c/54220020#54220020", "title": "Notify with confirmation in C++", "body": "<p>You simply need to hold the mutex when you modify your <code>_conditionReady</code> variable. This avoids the race condition by ensuring that the variable is not modified between checking its value and starting wait. Make sure you release the mutex before or after calling <code>notify_one</code> to allow your waiting thread to wakeup (if you do it after calling notify you can introduce a small performance penalty by waking up the waiting thread and it then immediately going back to sleep as the mutex is locked before waking a second time when the mutex is unlocked). e.g.:</p>\n\n<pre><code>{\n  std::unique_lock &lt;std::mutex&gt; lock(_condLoopMutex);\n  _conditionReady = true;\n}\n_condLoopCondition.notify_one();\n</code></pre>\n"}], "owner": {"reputation": 195, "user_id": 4547130, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/10161e09050fa66da6f37ffd9df07a24?s=128&d=identicon&r=PG&f=1", "display_name": "newt", "link": "https://stackoverflow.com/users/4547130/newt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 54220020, "answer_count": 2, "score": 1, "last_activity_date": 1547652865, "creation_date": 1547651199, "last_edit_date": 1547652865, "question_id": 54219949, "link": "https://stackoverflow.com/questions/54219949/notify-with-confirmation-in-c", "title": "Notify with confirmation in C++", "body": "<p>I have some loop that runs in parallel and has these lines:</p>\n\n<pre><code>std::unique_lock &lt;std::mutex&gt; lock(_condLoopMutex);\n_condLoopCondition.wait(lock, [this]() { return _conditionReady || _condLoopStopped; });\n_conditionReady = false;\n\n// DO SOMETHING\n</code></pre>\n\n<p>The boolean variable</p>\n\n<pre><code>_conditionReady\n</code></pre>\n\n<p>is set in parallel thread by means of the following construction:</p>\n\n<pre><code>_conditionReady = true;\n_condLoopCondition.notify_one();\n</code></pre>\n\n<p>However, sometimes my program freezes. It seems that notification comes between function 'wait' passes arguments and checks '_conditionReady' variable.</p>\n\n<p>To avoid this, I implemented the following:</p>\n\n<pre><code>while (_conditionReady &amp;&amp; !_condLoopStopped)\n    {\n        _condLoopCondition.notify_one();\n        std::this_thread::sleep_for(std::chrono::microseconds(100));\n    }\n</code></pre>\n\n<p>So that it keeps notifying until</p>\n\n<pre><code>_conditionReady == false\n</code></pre>\n\n<p>which means that wait is over.</p>\n\n<p>Is this the only solution of this problem - renotifying until wait is over? Is there any other regular method of handling these issues?</p>\n"}, {"tags": ["c++", "visual-studio"], "comments": [{"owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "edited": false, "score": 1, "creation_date": 1547651266, "post_id": 54219894, "comment_id": 95265602, "body": "The problem is that your compilation settings are not compatible with the compilation settings used to compile the library. It&#39;s a common problem and usually easy to fix. Look at the code generation options and switch either to or from the DLL option. I.e. if you are using the DLL option then pick the equivalent without DLL, and vice versa."}, {"owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "edited": false, "score": 0, "creation_date": 1547651609, "post_id": 54219894, "comment_id": 95265812, "body": "This FAQ seems relevant <a href=\"https://www.mps.mpg.de/dislin/faq-other#q_8\" rel=\"nofollow noreferrer\">mps.mpg.de/dislin/faq-other#q_8</a> it states to use the <code>&#47;MT</code> code generation option as well as a bunch of other required settings"}, {"owner": {"reputation": 137, "user_id": 9783587, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "MaterialZ", "link": "https://stackoverflow.com/users/9783587/materialz"}, "reply_to_user": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "edited": false, "score": 0, "creation_date": 1547651725, "post_id": 54219894, "comment_id": 95265874, "body": "thx @john for your reply!..I&#39;m not familiar with VS..where can I modify the code generation options?"}, {"owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "edited": false, "score": 0, "creation_date": 1547651756, "post_id": 54219894, "comment_id": 95265888, "body": "As the FAQ says - Project -&gt; Properties -&gt; Configuration Properties -&gt; C/C++ -&gt; Code Generation -&gt; Runtime Library -&gt; Multi-threaded (/MT)"}, {"owner": {"reputation": 137, "user_id": 9783587, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "MaterialZ", "link": "https://stackoverflow.com/users/9783587/materialz"}, "reply_to_user": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "edited": false, "score": 0, "creation_date": 1547652392, "post_id": 54219894, "comment_id": 95266253, "body": "@john I followed the steps but still doesn&#39;t work"}, {"owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "edited": false, "score": 0, "creation_date": 1547669474, "post_id": 54219894, "comment_id": 95275054, "body": "Well something else wrong with your project setup. Hard to say without looking over your shoulder. Make sure you follow the instructions in setting up your project very carefully. Maybe a 32/64 bit incompatibility? Just a guess."}, {"owner": {"reputation": 137, "user_id": 9783587, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "MaterialZ", "link": "https://stackoverflow.com/users/9783587/materialz"}, "reply_to_user": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "edited": false, "score": 0, "creation_date": 1547691476, "post_id": 54219894, "comment_id": 95281871, "body": "ok ill take another look on that..thx"}, {"owner": {"reputation": 137, "user_id": 9783587, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "MaterialZ", "link": "https://stackoverflow.com/users/9783587/materialz"}, "reply_to_user": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "edited": false, "score": 0, "creation_date": 1547691627, "post_id": 54219894, "comment_id": 95281898, "body": "@john do you have any suggestions on other libraries that I can use for plotting?"}], "owner": {"reputation": 137, "user_id": 9783587, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "MaterialZ", "link": "https://stackoverflow.com/users/9783587/materialz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 456, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1547651465, "creation_date": 1547651056, "last_edit_date": 1547651465, "question_id": 54219894, "link": "https://stackoverflow.com/questions/54219894/using-dislin-libraries-in-c-project", "title": "Using Dislin libraries in C++ project", "body": "<p>I installed Dislin, added its headers and libraries to the include path and linker (using VS 2017) but I get the following errors:</p>\n\n<pre><code>Warning LNK4098 defaultlib 'LIBCMT' conflicts with use of other libs; use /NODEFAULTLIB:library ConsoleApplication1 C:\\Users\\roinr\\source\\repos\\ConsoleApplication1\\ConsoleApplication1\\LINK    1   \nError   LNK2001 unresolved external symbol fprintf  ConsoleApplication1 C:\\Users\\roinr\\source\\repos\\ConsoleApplication1\\ConsoleApplication1\\discpp.lib(resall.obj)  1   \nError   LNK2001 unresolved external symbol fprintf  ConsoleApplication1 C:\\Users\\roinr\\source\\repos\\ConsoleApplication1\\ConsoleApplication1\\discpp.lib(qqwini.obj)  1   \nError   LNK2001 unresolved external symbol fprintf  ConsoleApplication1 C:\\Users\\roinr\\source\\repos\\ConsoleApplication1\\ConsoleApplication1\\discpp.lib(disext.obj)  1   \nError   LNK2001 unresolved external symbol fprintf  ConsoleApplication1 C:\\Users\\roinr\\source\\repos\\ConsoleApplication1\\ConsoleApplication1\\discpp.lib(qqppng.obj)  1   \nError   LNK2001 unresolved external symbol fprintf  ConsoleApplication1 C:\\Users\\roinr\\source\\repos\\ConsoleApplication1\\ConsoleApplication1\\discpp.lib(disbs2.obj)  1   \nError   LNK2001 unresolved external symbol fprintf  ConsoleApplication1 C:\\Users\\roinr\\source\\repos\\ConsoleApplication1\\ConsoleApplication1\\discpp.lib(line.obj)    1   \nError   LNK2001 unresolved external symbol fprintf  ConsoleApplication1 C:\\Users\\roinr\\source\\repos\\ConsoleApplication1\\ConsoleApplication1\\discpp.lib(disini.obj)  1   \nError   LNK2001 unresolved external symbol fprintf  ConsoleApplication1 C:\\Users\\roinr\\source\\repos\\ConsoleApplication1\\ConsoleApplication1\\discpp.lib(errmes.obj)  1   \nError   LNK1120 1 unresolved externals  ConsoleApplication1 C:\\Users\\roinr\\source\\repos\\ConsoleApplication1\\x64\\Release\\ConsoleApplication1.exe 1\n</code></pre>\n\n<p>this is my code:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include \"discpp.h\"\nint main()\n{\n   Dislin g;\n   return 0;\n};\n</code></pre>\n\n<p>I tried to use the /NODEFAULTLIB switch but it didn't help. I'm new to both VS and C++ and not familiar with all the configurations that required in order to use additional libraries.\ncan you please help me find a source of relevant information? </p>\n\n<p>By the way, my goal is to create a simple scatter plot, any suggestions for other libraries I can use?</p>\n"}, {"tags": ["c++", "windows", "winapi", "com", "shell-extensions"], "comments": [{"owner": {"reputation": 82917, "user_id": 3501, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/1fd5f5cc203c393634379a3b3b7e7a87?s=128&d=identicon&r=PG", "display_name": "Anders", "link": "https://stackoverflow.com/users/3501/anders"}, "edited": false, "score": 0, "creation_date": 1547691196, "post_id": 54219810, "comment_id": 95281817, "body": "Did you register yourself in the approved key for shell extensions? This policy enforcement is usually not active though (but is has existed since NT4). Might also be because it is not signed (or not signed by Microsoft). Processes can opt in to this signing requirement."}, {"owner": {"reputation": 91, "user_id": 282644, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed1f7188f6ac53bf61a8ef77279f3df7?s=128&d=identicon&r=PG", "display_name": "Lasse Hassing", "link": "https://stackoverflow.com/users/282644/lasse-hassing"}, "reply_to_user": {"reputation": 82917, "user_id": 3501, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/1fd5f5cc203c393634379a3b3b7e7a87?s=128&d=identicon&r=PG", "display_name": "Anders", "link": "https://stackoverflow.com/users/3501/anders"}, "edited": false, "score": 0, "creation_date": 1547733576, "post_id": 54219810, "comment_id": 95299543, "body": "Thanks for the suggestion but it doesn&#39;t seem to make any difference."}], "answers": [{"tags": [], "owner": {"reputation": 91, "user_id": 282644, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed1f7188f6ac53bf61a8ef77279f3df7?s=128&d=identicon&r=PG", "display_name": "Lasse Hassing", "link": "https://stackoverflow.com/users/282644/lasse-hassing"}, "is_accepted": false, "score": 0, "last_activity_date": 1547733747, "creation_date": 1547733747, "answer_id": 54237594, "question_id": 54219810, "link": "https://stackoverflow.com/questions/54219810/com-shell-extension-to-override-run-as-administrator-fails-in-start-menu-searc/54237594#54237594", "title": "COM shell extension to override &quot;Run as Administrator&quot; fails in start menu search", "body": "<p>I solved the problem by switching from an InprocServer (DLL) to a LocalServer (EXE). Presumably because the security requirements is lower for an out-of-proc exe is lower than the DLL.</p>\n"}], "owner": {"reputation": 91, "user_id": 282644, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed1f7188f6ac53bf61a8ef77279f3df7?s=128&d=identicon&r=PG", "display_name": "Lasse Hassing", "link": "https://stackoverflow.com/users/282644/lasse-hassing"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 173, "favorite_count": 2, "answer_count": 1, "score": 3, "last_activity_date": 1547733747, "creation_date": 1547650776, "question_id": 54219810, "link": "https://stackoverflow.com/questions/54219810/com-shell-extension-to-override-run-as-administrator-fails-in-start-menu-searc", "title": "COM shell extension to override &quot;Run as Administrator&quot; fails in start menu search", "body": "<p>I'm working on a COM server DLL to override the \"Run as Administrator\" in Windows 10. I'm doing this by setting the DLL GUID as DelegateExecute on the Computer\\HKEY_CLASSES_ROOT\\exefile\\shell\\runas\\command registry key. I have the CLSID entries for both 32 and 64 bit versions created (as InprocServer32).</p>\n\n<p>This is working fine for the most part. Right clicking exe files in explorer and running as administrator is delegated to the DLL, if an installer tries to launch with elevated privileges it gets delegated to the DLL, right clicking on start menu items is delegated, and so on.</p>\n\n<p>The only problem is that when using the start menu search and hitting an item that is listed as \"Run command\" (search for \"wusa\" for example) then clicking \"run as administrator\" in the right side of the search (or by right clicking the result) does nothing.</p>\n\n<p>Using Process Monitor from sysinternals I can see that RuntimeBroker.exe correctly reads through the registry and detects that my DLL is the one need to be called but then it stops right after getting the filename and instead looks at a registry key called ...\\AppActivationErrorHandlers\\80270301 and then stops. 0x80270301 is the value of a symbol called E_SHELL_EXTENSION_BLOCKED so I'm assuming it's related. But I can find no information about why it is getting blocked.</p>\n\n<p>Can anyone help point me the right direction?</p>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 3, "creation_date": 1547650430, "post_id": 54219677, "comment_id": 95265037, "body": "Because a <code>Node</code> is not a <code>Tree</code>?"}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 3, "creation_date": 1547650558, "post_id": 54219677, "comment_id": 95265130, "body": "<code>if (this == NULL)</code>  this is guaranteed to be always false."}, {"owner": {"reputation": 3, "user_id": 5197757, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d628cec0e009ca04f05c6552bb867cd4?s=128&d=identicon&r=PG&f=1", "display_name": "shirley sven", "link": "https://stackoverflow.com/users/5197757/shirley-sven"}, "edited": false, "score": 0, "creation_date": 1547650579, "post_id": 54219677, "comment_id": 95265145, "body": "edited the question"}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 1, "creation_date": 1547650625, "post_id": 54219677, "comment_id": 95265172, "body": "Note that <code>main</code> is required to have the return type <code>int</code>. Anything else is at best not portable."}, {"owner": {"reputation": 893, "user_id": 6361694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62b808f24204076dfdb2fc9afa27a8b8?s=128&d=identicon&r=PG&f=1", "display_name": "Petok Lorand", "link": "https://stackoverflow.com/users/6361694/petok-lorand"}, "reply_to_user": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 0, "creation_date": 1547650666, "post_id": 54219677, "comment_id": 95265208, "body": "@MatthieuBrucher Not exactly, i&#39;ve seen cases with gcc when i could call a member function even if the pointer pointing to the object was a nullpointer"}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 1, "creation_date": 1547650678, "post_id": 54219677, "comment_id": 95265219, "body": "Does <code>right = NULL = left;</code> compiles?"}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "reply_to_user": {"reputation": 893, "user_id": 6361694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62b808f24204076dfdb2fc9afa27a8b8?s=128&d=identicon&r=PG&f=1", "display_name": "Petok Lorand", "link": "https://stackoverflow.com/users/6361694/petok-lorand"}, "edited": false, "score": 2, "creation_date": 1547650708, "post_id": 54219677, "comment_id": 95265236, "body": "@Lorand That&#39;s undefined behavior, meaning behaving as-if <code>this</code> wasn&#39;t <code>nullptr</code> would still be conformant. In other words, assuming <code>this</code> is never <code>nullptr</code> is a correct assumption."}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "reply_to_user": {"reputation": 893, "user_id": 6361694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62b808f24204076dfdb2fc9afa27a8b8?s=128&d=identicon&r=PG&f=1", "display_name": "Petok Lorand", "link": "https://stackoverflow.com/users/6361694/petok-lorand"}, "edited": false, "score": 0, "creation_date": 1547650724, "post_id": 54219677, "comment_id": 95265249, "body": "@Lorand try again with modern gcc, it will optimize it away."}, {"owner": {"reputation": 3, "user_id": 5197757, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d628cec0e009ca04f05c6552bb867cd4?s=128&d=identicon&r=PG&f=1", "display_name": "shirley sven", "link": "https://stackoverflow.com/users/5197757/shirley-sven"}, "edited": false, "score": 0, "creation_date": 1547650801, "post_id": 54219677, "comment_id": 95265295, "body": "Yes, it does compile"}, {"owner": {"reputation": 893, "user_id": 6361694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62b808f24204076dfdb2fc9afa27a8b8?s=128&d=identicon&r=PG&f=1", "display_name": "Petok Lorand", "link": "https://stackoverflow.com/users/6361694/petok-lorand"}, "reply_to_user": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 0, "creation_date": 1547650826, "post_id": 54219677, "comment_id": 95265316, "body": "@MatthieuBrucher I tried with gcc 5. But in any case i agree that the null  check wasn&#39;t what op actually intended on doing"}, {"owner": {"reputation": 19667, "user_id": 1312382, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FL8Fg.jpg?s=128&g=1", "display_name": "Aconcagua", "link": "https://stackoverflow.com/users/1312382/aconcagua"}, "edited": false, "score": 0, "creation_date": 1547650845, "post_id": 54219677, "comment_id": 95265328, "body": "<code>this</code> is only a pointer for backward compatibility reasons - if references existed already when <code>this</code> was specified, it would have gotten one for sure..."}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 0, "creation_date": 1547651038, "post_id": 54219677, "comment_id": 95265452, "body": "gcc 7 will remove it, clang will remove it. Calling a method through a null pointer is UB, as Francois indicated."}, {"owner": {"reputation": 19667, "user_id": 1312382, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FL8Fg.jpg?s=128&g=1", "display_name": "Aconcagua", "link": "https://stackoverflow.com/users/1312382/aconcagua"}, "edited": false, "score": 2, "creation_date": 1547651041, "post_id": 54219677, "comment_id": 95265455, "body": "<code>right = NULL = left;</code> - must be some strange definition of <code>NULL</code> then, if this really compiles. But with modern C++, you should prefer language <i>keywords</i> (<code>nullptr</code>) over outdated (obsolete?) C <i>macros</i> (<code>NULL</code>) anyway..."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547651160, "post_id": 54219677, "comment_id": 95265528, "body": "@shirleysven The problem is that <code>right = NULL = left;</code> is assigning <code>left</code> (an unitialized variable) to <code>right</code> and <code>NULL</code> (somehow). It shouldn&#39;t compile. And if it does, I have no idea what it is actually doing (even if <code>left</code> was initialized)."}, {"owner": {"reputation": 3, "user_id": 5197757, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d628cec0e009ca04f05c6552bb867cd4?s=128&d=identicon&r=PG&f=1", "display_name": "shirley sven", "link": "https://stackoverflow.com/users/5197757/shirley-sven"}, "edited": false, "score": 0, "creation_date": 1547651224, "post_id": 54219677, "comment_id": 95265581, "body": "Thanks, I understand about <code>nullptr</code>"}, {"owner": {"reputation": 3, "user_id": 5197757, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d628cec0e009ca04f05c6552bb867cd4?s=128&d=identicon&r=PG&f=1", "display_name": "shirley sven", "link": "https://stackoverflow.com/users/5197757/shirley-sven"}, "edited": false, "score": 0, "creation_date": 1547651704, "post_id": 54219677, "comment_id": 95265861, "body": "But still didn&#39;t understand what causes this error."}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 0, "creation_date": 1547651849, "post_id": 54219677, "comment_id": 95265939, "body": "This code is riddled with undefined behaviors. Delete everything and start from scratch."}], "answers": [{"tags": [], "owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "is_accepted": false, "score": 1, "last_activity_date": 1547652053, "creation_date": 1547652053, "answer_id": 54220209, "question_id": 54219677, "link": "https://stackoverflow.com/questions/54219677/cannot-convert-argument-from-this-to-nodet/54220209#54220209", "title": "Cannot convert argument from &#39;this&#39; to Node&lt;T&gt;*", "body": "<p>As the message says, you're passing <code>this</code>, which is a <code>Tree&lt;T&gt;* const</code>, to <code>insertion</code>, which expects a <code>Node&lt;T&gt;*</code>.  </p>\n\n<p>You probably meant <code>root = insertion(root, value);</code>.</p>\n\n<p>(There are countless other problems with that code, but this is the source of that particular error message.)</p>\n"}], "owner": {"reputation": 3, "user_id": 5197757, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d628cec0e009ca04f05c6552bb867cd4?s=128&d=identicon&r=PG&f=1", "display_name": "shirley sven", "link": "https://stackoverflow.com/users/5197757/shirley-sven"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "closed_date": 1547718491, "answer_count": 1, "score": -4, "last_activity_date": 1547652053, "creation_date": 1547650367, "last_edit_date": 1547650877, "question_id": 54219677, "link": "https://stackoverflow.com/questions/54219677/cannot-convert-argument-from-this-to-nodet", "closed_reason": "Not suitable for this site", "title": "Cannot convert argument from &#39;this&#39; to Node&lt;T&gt;*", "body": "<p>I'm working on a new project to understand templates better.\nI have a problem converting an augment; I'm not sure how I can handle this problem and would like to learn about this.\nIt's a project on Binary Search Tree.</p>\n\n<pre><code>template &lt;typename T&gt;\nNode&lt;T&gt;* Tree&lt;T&gt;::insertion(Node&lt;T&gt;* root , T value){\n    if (this == NULL) {\n        Node n = new Node(value);\n        return n;\n    }\n    if (value &lt; this-&gt;value)\n        this-&gt;left = insert(this-&gt;left, value);\n    else if (value &gt; this-&gt;value)\n        this-&gt;right = insert(this-&gt;right, value);\n    return root;\n}\n\ntemplate &lt;typename T&gt;\nvoid Tree&lt;T&gt;::insert(T value) {\n    insertion(this, value);\n}\n</code></pre>\n\n<p>class Tree:</p>\n\n<pre><code>class Tree {\nprivate:\n    Node&lt;T&gt;* root;\n\npublic:\n    Tree() {\n        this-&gt;root = NULL;\n    };\n    ~Tree() { recursiveDeletion(this-&gt;root);  }\n    void insert(T value);\n    int find(T value) const;\n    //int size() const;\n    friend ostream&amp; operator&lt;&lt;(ostream &amp;b, Tree const &amp;t);\n    Node&lt;T&gt;* insertion(Node&lt;T&gt; *root, T value);\n\n};\n</code></pre>\n\n<p>class Node:</p>\n\n<pre><code>template &lt;typename T&gt;\nclass Node {\nprivate:\n    Node *right, *left;\n    T value;\npublic:\n    Node() {\n        right = NULL = left;\n    }\n    Node(T value) { \n        this-&gt;value = value;\n        right = NULL = left;\n    };\n};\n</code></pre>\n\n<p>main:</p>\n\n<pre><code>void main()\n{\n    Tree&lt;int&gt; *root = new Tree&lt;int&gt;();\n    root-&gt;insert(1);\n    root-&gt;insert(2);\n    root-&gt;insert(-2);\n    root-&gt;insert(-1);\n    root-&gt;insert(2);\n    root-&gt;find(-1);\n    root-&gt;size();\n    cout &lt;&lt; root &lt;&lt; endl;\n}\n</code></pre>\n\n<blockquote>\n  <p>Error C2664   'Node *Tree::insertion(Node *,T)': cannot convert\n  argument 1 from 'Tree *const ' to 'Node *'</p>\n</blockquote>\n"}, {"tags": ["c++", "qt5", "qmouseevent", "rubber-band"], "answers": [{"tags": [], "owner": {"reputation": 9720, "user_id": 6371123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f90991c1b06c79ae4c6e79fb616d608?s=128&d=identicon&r=PG", "display_name": "G.M.", "link": "https://stackoverflow.com/users/6371123/g-m"}, "is_accepted": true, "score": 0, "last_activity_date": 1547652266, "creation_date": 1547652266, "answer_id": 54220274, "question_id": 54219597, "link": "https://stackoverflow.com/questions/54219597/how-to-constrain-a-qrubberband-within-a-qlabel/54220274#54220274", "title": "How to constrain a QRubberBand within a QLabel?", "body": "<p>I think that's the expected behaviour.  If you want to limit the extents of the rubber band then simply clamp them in the <code>mouseMoveEvent</code> override...</p>\n\n<pre><code>void frame_displayer::mouseMoveEvent(QMouseEvent *event)\n{\n    if(_rubberBand != nullptr)\n    {\n        if (this-&gt;underMouse())\n        {\n            if (_lastClickedBtn == Qt::LeftButton)\n            {\n                QPoint mouseCurrentPoint = event-&gt;pos();\n\n                /*\n                 * Clamp mouseCurrentPoint to the QRect of this widget.\n                 */\n                auto clamp_rect = rect();\n                mouseCurrentPoint.rx() = std::min(clamp_rect.right(), std::max(clamp_rect.left(), mouseCurrentPoint.x()));\n                mouseCurrentPoint.ry() = std::min(clamp_rect.bottom(), std::max(clamp_rect.top(), mouseCurrentPoint.y()));\n                _rubberBand-&gt;setGeometry(QRect(_mouseOriginClickPoint, mouseCurrentPoint).normalized());\n            }\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 9472137, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-UKoinL1AUjE/AAAAAAAAAAI/AAAAAAAAAX8/sL3uOPvK7Zo/photo.jpg?sz=128", "display_name": "LemuelKL", "link": "https://stackoverflow.com/users/9472137/lemuelkl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 206, "favorite_count": 1, "accepted_answer_id": 54220274, "answer_count": 1, "score": 0, "last_activity_date": 1547652266, "creation_date": 1547650142, "last_edit_date": 1592644375, "question_id": 54219597, "link": "https://stackoverflow.com/questions/54219597/how-to-constrain-a-qrubberband-within-a-qlabel", "title": "How to constrain a QRubberBand within a QLabel?", "body": "<p>I am building a Qt5 application that allows a user to draw a rubberband with his mouse over an image, to select certain area of the image for further processing.</p>\n<p>I got my code to only allow the user to start drawing the rubberband, by subclassing a QLabel to a custom class (frame_displayer) which <strong>mousePressEvent()</strong> is overridden and thus be only invoked when the mouse press happens within the custom classed widget.</p>\n<p>The problem is that when the initial click is inside the frame_displayer, <strong>mouseMoveEvent()</strong>, the function that I use to change the rubberband size accordingly, keeps getting called even when the mouse cursor has been dragged outside of the frame_displayer.</p>\n<p>I have tried using <strong>leaveEvent()</strong> and <strong>enterEvent()</strong> to control a class boolean flag that codes inside mouseMoveEvent could rely on to know whether the cursor is still within the widget. However, both <strong>leaveEvent()</strong> and <strong>enterEvent()</strong> are only called while a mouse button is not being held, thus rendering them no use for constraining the rubberband.</p>\n<p>Also, the <strong>underMouse()</strong> always return true, for a reason unknown to me.</p>\n<h2>Segment of frame_displayer.cpp</h2>\n<pre><code>frame_displayer::frame_displayer(QWidget * parent) : QLabel(parent)\n{\n    _rubberBand = new QRubberBand(QRubberBand::Rectangle, this);\n}\n\nvoid frame_displayer::mousePressEvent(QMouseEvent *event)\n{\n    _lastClickedBtn = event-&gt;button();\n    if (_lastClickedBtn == Qt::LeftButton)\n    {\n        _mouseOriginClickPoint = event-&gt;pos();\n        _rubberBand-&gt;setGeometry(QRect(_mouseOriginClickPoint, _mouseClickPoint));\n        _rubberBand-&gt;show();\n    }\n}\n\nvoid frame_displayer::mouseMoveEvent(QMouseEvent *event)\n{\n    if(_rubberBand != nullptr)\n    {\n        if (this-&gt;underMouse())\n        {\n            if (_lastClickedBtn == Qt::LeftButton)\n            {\n                QPoint mouseCurrentPoint = event-&gt;pos();\n                _rubberBand-&gt;setGeometry(QRect(_mouseOriginClickPoint, mouseCurrentPoint).normalized());\n            }\n        }\n    }\n}\n\nvoid frame_displayer::mouseReleaseEvent(QMouseEvent *event)\n{\n    _mouseOriginClickPoint = QPoint();\n    _lastClickedBtn = Qt::MidButton;\n    if(_rubberBand != nullptr)\n    {\n        _rubberBand-&gt;hide();\n        _rubberBand-&gt;clearMask();\n    }\n}\n\nvoid frame_displayer::leaveEvent(QEvent *event)\n{\n    qDebug() &lt;&lt; &quot;Leaving&quot;;\n}\n\nvoid frame_displayer::enterEvent(QEvent *event)\n{\n    qDebug() &lt;&lt; &quot;Entering&quot;;\n}\n\n</code></pre>\n<p>Thanks in advance!</p>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 480, "user_id": 6948160, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/129c8f620f47a08105f596962677b4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Gojita", "link": "https://stackoverflow.com/users/6948160/gojita"}, "edited": false, "score": 2, "creation_date": 1547650135, "post_id": 54219557, "comment_id": 95264855, "body": "<a href=\"https://en.cppreference.com/w/cpp/language/operator_precedence\" rel=\"nofollow noreferrer\">en.cppreference.com/w/cpp/language/operator_precedence</a>"}, {"owner": {"reputation": 147720, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 2, "creation_date": 1547650140, "post_id": 54219557, "comment_id": 95264861, "body": "Not being able to write code to check is fair. But if you are able to write an SO post, surely you can lookup <a href=\"https://en.cppreference.com/w/cpp/language/operator_precedence\" rel=\"nofollow noreferrer\">this table</a>"}, {"owner": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "edited": false, "score": 4, "creation_date": 1547650141, "post_id": 54219557, "comment_id": 95264862, "body": "<code>%</code> has higher precedence, so <code>x += y % 3</code> is <code>x += (y % 3)</code>, which increases <code>x</code> by <code>y % 3</code>."}, {"owner": {"reputation": 1727, "user_id": 5440453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3500f6dc5327b259bb48da3399268b0?s=128&d=identicon&r=PG&f=1", "display_name": "Algirdas Preid\u017eius", "link": "https://stackoverflow.com/users/5440453/algirdas-preid%c5%beius"}, "edited": false, "score": 0, "creation_date": 1547650251, "post_id": 54219557, "comment_id": 95264922, "body": "&quot;<i>But if i have an expression like <code>x += y % 3</code>, does that mean <code>x = (x + y) % 3</code> or <code>x = x + (y % 3)</code>?</i>&quot; Your expression doesn&#39;t have parenthesis, so it does <code>x = x + y % 3</code>. Order in which each operation is performed is governed by operator precedence."}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 7, "creation_date": 1547650259, "post_id": 54219557, "comment_id": 95264925, "body": "I&#39;m voting to close this question as off-topic because it is a clear, well-documented textbook question, and should not be a question stack overflow."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1547652486, "post_id": 54219557, "comment_id": 95266316, "body": "It&#39;s not a text replacement. <code>x += e</code> means &quot;add the value of <code>e</code> to the variable <code>x</code>, and your <code>e</code> is <code>y % 3</code>. (Note that precedence does not matter; <code>x *= 2 + 3;</code> is <code>x = x * (2 + 3)</code>, not <code>x = x * 2 + 3</code>.)"}, {"owner": {"reputation": 16695, "user_id": 10147399, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a6d433902192f8bb03857ae1b849d4f?s=128&d=identicon&r=PG&f=1", "display_name": "Ayxan Haqverdili", "link": "https://stackoverflow.com/users/10147399/ayxan-haqverdili"}, "edited": false, "score": 0, "creation_date": 1547652619, "post_id": 54219557, "comment_id": 95266393, "body": "Quoting K&amp;R  &quot;<code>expr1 = (expr1) op (expr2)</code> except that <code>expr1</code> is computed only once. Notice the parentheses around <code>expr2</code>:     <code>x *= y + 1</code> means     <code>x = x * (y + 1)</code>&quot;"}, {"owner": {"reputation": 7407, "user_id": 1757805, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/AMueI.jpg?s=128&g=1", "display_name": "Francis Cugler", "link": "https://stackoverflow.com/users/1757805/francis-cugler"}, "edited": false, "score": 0, "creation_date": 1547658617, "post_id": 54219557, "comment_id": 95269890, "body": "When it comes to the compound operators such as <code>+=</code>, <code>-=</code>, <code>^=</code> etc. The one thing that you have to remember is this: The entire right hand side is evaluated before the assignment happens. So when you look at the right hand expression, the most important thing to remember is operator precedence (the order of operations). You can always find a table of C++&#39;s operator precedence. As for being able to write &amp; compile code to test, there are various online compilers today; this is what Google is for..."}], "answers": [{"comments": [{"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 3, "creation_date": 1547650341, "post_id": 54219627, "comment_id": 95264975, "body": "<code>x += 1</code> should always be <b>semantically</b> equivalent to <code>x = x + 1</code>. Anything else is just evil."}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "reply_to_user": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 1, "creation_date": 1547650398, "post_id": 54219627, "comment_id": 95265011, "body": "@SergeyA agreed, it should be equivalent unless you are already rotting in hell."}], "tags": [], "owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "is_accepted": false, "score": 2, "last_activity_date": 1547650228, "creation_date": 1547650228, "answer_id": 54219627, "question_id": 54219557, "link": "https://stackoverflow.com/questions/54219557/what-exactly-does-the-operator-do/54219627#54219627", "title": "What exactly does the &quot;+=&quot; operator do?", "body": "<p>There is a confusion here, because you think <code>x += 1;</code> is always <code>x = x + 1</code>. This is true for integers, doubles... but generally NOT the case for other objects. Lots of implementations don't create a temporary object. Or could do something very evil.</p>\n\n<p>So then it's a call to <code>operator+=</code>, which takes as the argument the result of the right hand side of the assignment.</p>\n\n<p>So for integers, it's <code>x = x + (y % 3)</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 55059, "user_id": 212858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1166c87b6f3fc2e6746da96b60fefb46?s=128&d=identicon&r=PG", "display_name": "Useless", "link": "https://stackoverflow.com/users/212858/useless"}, "is_accepted": true, "score": 5, "last_activity_date": 1547658763, "last_edit_date": 1547658763, "creation_date": 1547650900, "answer_id": 54219849, "question_id": 54219557, "link": "https://stackoverflow.com/questions/54219557/what-exactly-does-the-operator-do/54219849#54219849", "title": "What exactly does the &quot;+=&quot; operator do?", "body": "<blockquote>\n  <p>The <code>=</code>-symbol allocates the value of the arithmetic expression on it's right to the variable on it's left</p>\n</blockquote>\n\n<p>It <em>assigns</em> the result. Allocation is something different, and it'll be important to remember the difference later (dynamic allocation in particular will be really confusing if you conflate it with assignment).</p>\n\n<blockquote>\n  <p>But if i have an expression like <code>x += y % 3</code>, does that mean <code>x = (x + y) % 3</code> or <code>x = x + (y % 3)</code>?</p>\n</blockquote>\n\n<p>Part of the reason for having the compound <code>+=</code>, <code>-=</code> etc. operators is that you <em>don't</em> expand the expression like this, avoiding the ambiguity created by your re-write.</p>\n\n<pre><code>x += y % 3\n</code></pre>\n\n<p>can be read as</p>\n\n<pre><code>tmp = y % 3; // evaluate right hand side\nx += tmp;    // assign to left hand side\n</code></pre>\n\n<p>(you can expand <code>x += tmp</code> to <code>x = x + tmp</code> if you really want to, <em>after</em> <code>tmp</code> has been evaluated).</p>\n\n<p>The rules are all documented <a href=\"https://en.cppreference.com/w/cpp/language/operator_precedence\" rel=\"nofollow noreferrer\">here</a> in any case, and anyway you absolutely <em>can</em> just test some code to check:  <a href=\"https://ideone.com/81tvjH\" rel=\"nofollow noreferrer\">https://ideone.com/81tvjH</a></p>\n"}], "owner": {"reputation": 45, "user_id": 10922778, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-cNp2tUCdpf4/AAAAAAAAAAI/AAAAAAAAABM/It7v0AaCtL4/photo.jpg?sz=128", "display_name": "Bob Michaelsen", "link": "https://stackoverflow.com/users/10922778/bob-michaelsen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 1, "closed_date": 1547651704, "accepted_answer_id": 54219849, "answer_count": 2, "score": -12, "last_activity_date": 1547658763, "creation_date": 1547650019, "last_edit_date": 1547651027, "question_id": 54219557, "link": "https://stackoverflow.com/questions/54219557/what-exactly-does-the-operator-do", "closed_reason": "Not suitable for this site", "title": "What exactly does the &quot;+=&quot; operator do?", "body": "<p>I already know that <code>x += 1</code> means <code>x = x + 1</code>.\nThe <code>=</code>-symbol allocates the value of the arithmetic expression on it's right to the variable on it's left.\nBut if i have an expression like <code>x += y % 3</code>, does that mean <code>x = (x + y) % 3</code>or <code>x = x + (y % 3)</code>?\nThe <code>+=</code> operator is both allocating a value to a variable and expressing arithmatics, which has me confused.</p>\n\n<p>Unfortunately I currently can't just test some code to check, so I hope I can get some help here.\nI'm new to C++, so some of these very basic things still confuse me...</p>\n"}, {"tags": ["c++", "delphi", "pointers", "sdk", "hikvision"], "comments": [{"owner": {"reputation": 5311, "user_id": 685746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/664abcb1763367ac9055b615ad1fd263?s=128&d=identicon&r=PG", "display_name": "Brian", "link": "https://stackoverflow.com/users/685746/brian"}, "edited": false, "score": 1, "creation_date": 1547651901, "post_id": 54219521, "comment_id": 95265969, "body": "See: <a href=\"https://stackoverflow.com/questions/100596/best-resources-for-converting-c-c-dll-headers-to-delphi\" title=\"best resources for converting c c dll headers to delphi\">stackoverflow.com/questions/100596/&hellip;</a>"}, {"owner": {"reputation": 570607, "user_id": 505088, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/3c0aac2191718ef0309dbc034d9b9961?s=128&d=identicon&r=PG", "display_name": "David Heffernan", "link": "https://stackoverflow.com/users/505088/david-heffernan"}, "edited": false, "score": 1, "creation_date": 1547653026, "post_id": 54219521, "comment_id": 95266620, "body": "Don&#39;t use <code>New</code>. If you need to allocate a record, use a local variable. If you need a pointer to that record, use <code>@</code> to get its address. It is more complicated to have to manage heap allocations that to use automatic allocation on the stack. As witnessed by your code leaking that allocation."}, {"owner": {"reputation": 570607, "user_id": 505088, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/3c0aac2191718ef0309dbc034d9b9961?s=128&d=identicon&r=PG", "display_name": "David Heffernan", "link": "https://stackoverflow.com/users/505088/david-heffernan"}, "edited": false, "score": 0, "creation_date": 1547653953, "post_id": 54219521, "comment_id": 95267215, "body": "In fact you don&#39;t need to copy the record. You can cast the pointer. The C++ code is wasteful in that regard too."}, {"owner": {"reputation": 43, "user_id": 10862724, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce25b85eb3c67ac6ba805157134a73da?s=128&d=identicon&r=PG&f=1", "display_name": "tomek", "link": "https://stackoverflow.com/users/10862724/tomek"}, "edited": false, "score": 0, "creation_date": 1547714311, "post_id": 54219521, "comment_id": 95288632, "body": "if you meant <code>struPlateResult := LPNET_ITS_PLATE_RESULT(pAlarmInfo);</code> instead of <code>New&#47;FillChar&#47;Move</code> then it works too :)"}], "answers": [{"tags": [], "owner": {"reputation": 65718, "user_id": 844416, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e39c2364935265593d76247ddc6d07c?s=128&d=identicon&r=PG", "display_name": "MBo", "link": "https://stackoverflow.com/users/844416/mbo"}, "is_accepted": true, "score": 1, "last_activity_date": 1547657758, "last_edit_date": 1547657758, "creation_date": 1547652630, "answer_id": 54220382, "question_id": 54219521, "link": "https://stackoverflow.com/questions/54219521/problem-with-sdk-pointers-c-to-delphi-translating/54220382#54220382", "title": "Problem with SDK pointers - c++ to Delphi translating", "body": "<p>Yes, <code>PByte</code> or <code>PByteArray</code> is correct translation.</p>\n\n<p>If buffer contains valid file contents, you can save it into file:</p>\n\n<pre><code>FS := TFileStream.Create('test.jpg', fmCreate);\ntry\n   FS.Write(struITSPlateResult.struPicInfo[0].pBuffer^,\n            struITSPlateResult.struPicInfo[0].dwDataLen);\nfinally\n  FS.Free;\nend;\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 10862724, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce25b85eb3c67ac6ba805157134a73da?s=128&d=identicon&r=PG&f=1", "display_name": "tomek", "link": "https://stackoverflow.com/users/10862724/tomek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 223, "favorite_count": 0, "accepted_answer_id": 54220382, "answer_count": 1, "score": 0, "last_activity_date": 1547657758, "creation_date": 1547649867, "question_id": 54219521, "link": "https://stackoverflow.com/questions/54219521/problem-with-sdk-pointers-c-to-delphi-translating", "title": "Problem with SDK pointers - c++ to Delphi translating", "body": "<p>I'm struggling with HikVision SDK, trying to get it work in Delphi. There's some samples in C++, but I've stuck with pointers issues while translating to Delphi. Till that moment code seems to work, as I get correct plate number.<br>\nIs this correct equivalent:  BYTE *pBuffer  -> PByte ?<br>\nHow to extract picture from pBuffer?</p>\n\n<p>C++ code:</p>\n\n<pre><code>typedef struct tagNET_ITS_PICTURE_INFO\n{\n    DWORD   dwDataLen;            //Media data length\n    BYTE    byType;                \n    BYTE    byAbsTime[32];\n    NET_VCA_RECT   struPlateRect;\n    BYTE    *pBuffer;              //Data pointer\n    DWORD   dwUTCTime;\n    //...\n}NET_ITS_PICTURE_INFO, *LPNET_ITS_PICTURE_INFO;\n\n\ntypedef struct tagNET_ITS_PLATE_RESULT\n{\n    //...\n    NET_DVR_PLATE_INFO  struPlateInfo;\n    NET_ITS_PICTURE_INFO struPicInfo[6];\n}NET_ITS_PLATE_RESULT, *LPNET_ITS_PLATE_RESULT;\n\n\nvoid CALLBACK MSesGCallback(LONG lCommand, NET_DVR_ALARMER *pAlarmer, char *pAlarmInfo, DWORD dwBufLen, void* pUser)\n{\n    char filename[100];\n    FILE *fSnapPic = NULL;\n\n    switch (lCommand) {\n\n        case COMM_ITS_PLATE_RESULT: {\n            NET_ITS_PLATE_RESULT struITSPlateResult = { 0 };\n            memcpy(&amp;struITSPlateResult, pAlarmInfo, sizeof(struITSPlateResult));\n\n            printf(\"Plate: %s\\n\", struITSPlateResult.struPlateInfo.sLicense);\n            if (struITSPlateResult.struPicInfo[0].dwDataLen != 0)\n            {\n                sprintf(filename, \"./pic/%d.jpg\", 0);\n                fSnapPic = fopen(filename, \"wb\");\n                fwrite(struITSPlateResult.struPicInfo[0].pBuffer, struITSPlateResult.struPicInfo[0].dwDataLen, 1, fSnapPic);\n                fclose(fSnapPic);\n            }\n        }\n    }\n    return;\n}\n</code></pre>\n\n<p>Delphi code:</p>\n\n<pre><code>  LPNET_ITS_PICTURE_INFO = ^NET_ITS_PICTURE_INFO;\n  NET_ITS_PICTURE_INFO = record\n    dwDataLen: DWORD;\n    byType: BYTE;\n    byAbsTime: array [0..31] of BYTE;\n    struPlateRect: NET_VCA_RECT;\n    pBuffer: PByte;                  // ????????\n    dwUTCTime: DWORD;\n    //(...)\n  end;\n\n\n  LPNET_ITS_PLATE_RESULT = ^NET_ITS_PLATE_RESULT;\n  NET_ITS_PLATE_RESULT = record\n    //(...)\n    struPlateInfo: NET_DVR_PLATE_INFO;\n    struPicInfo: Array [0..5] of NET_ITS_PICTURE_INFO;\n  end;\n\n\nprocedure MessageCallBack(lCommand:longint; pAlarmer:LPNET_DVR_ALARMER; pAlarmInfo:PAnsiChar; dwBufLen:LongInt; pUser:pointer); stdcall;\nvar\n struAlarmInfo: LPNET_DVR_ALARMINFO_V30;\n struPlateResult: LPNET_ITS_PLATE_RESULT;\nbegin\n  case lCommand of\n    COMM_ITS_PLATE_RESULT:\n      begin\n        New(struPlateResult);\n        FillChar(struPlateResult^, SizeOf(NET_ITS_PLATE_RESULT), 0);\n        Move(pAlarmInfo^, struPlateResult^, Sizeof(NET_ITS_PLATE_RESULT));\n        Form1.memoOut.Lines.Add('sLicense: ' + struPlateResult.struPlateInfo.sLicense);\n\n        if (struPlateResult.struPicInfo[0].dwDataLen &gt;0) then\n          ??? how to get the picture from struPlateResult.struPicInfo[0].pBuffer ?\n\n      end;\n  end;\nend;\n</code></pre>\n\n<p>Regards</p>\n"}, {"tags": ["c++", "windows", "process", "administrator"], "comments": [{"owner": {"reputation": 14821, "user_id": 5743288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ea16526477fd6f1d4cc57f976af38d0?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Sanders", "link": "https://stackoverflow.com/users/5743288/paul-sanders"}, "edited": false, "score": 1, "creation_date": 1547650852, "post_id": 54219481, "comment_id": 95265335, "body": "There&#39;s an example of how to launch a process from a service here: <a href=\"https://stackoverflow.com/a/50743993/5743288\">stackoverflow.com/a/50743993/5743288</a>"}, {"owner": {"reputation": 41, "user_id": 6635723, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/ziVHn.png?s=128&g=1", "display_name": "mikkel1156", "link": "https://stackoverflow.com/users/6635723/mikkel1156"}, "reply_to_user": {"reputation": 14821, "user_id": 5743288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ea16526477fd6f1d4cc57f976af38d0?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Sanders", "link": "https://stackoverflow.com/users/5743288/paul-sanders"}, "edited": false, "score": 0, "creation_date": 1547671256, "post_id": 54219481, "comment_id": 95275891, "body": "Will try it, but doesn&#39;t look like it would be the exact thing I&#39;m looking for since the launched program need to have admin rights. Might be a start."}, {"owner": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 0, "creation_date": 1547672418, "post_id": 54219481, "comment_id": 95276399, "body": "Since Vista the OS tries to prevent this from happening."}, {"owner": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 0, "creation_date": 1547672767, "post_id": 54219481, "comment_id": 95276541, "body": "Related: <a href=\"https://stackoverflow.com/questions/267838/how-can-a-windows-service-execute-a-gui-application\" title=\"how can a windows service execute a gui application\">stackoverflow.com/questions/267838/&hellip;</a>"}, {"owner": {"reputation": 41, "user_id": 6635723, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/ziVHn.png?s=128&g=1", "display_name": "mikkel1156", "link": "https://stackoverflow.com/users/6635723/mikkel1156"}, "reply_to_user": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 0, "creation_date": 1547673877, "post_id": 54219481, "comment_id": 95277076, "body": "@drescherjm that could work. Do you know if the WTSEnumerateSessionsA function would work if it&#39;s run in a non-RD server case (since the handle for that function is for such)? Or is there another function to get suck desktop session handles from a local machine or a simple way to just use WTSEnumerateSessionsA for the current machine without any RD server?  You guys&#39; help is greatly appreciated."}, {"owner": {"reputation": 41, "user_id": 6635723, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/ziVHn.png?s=128&g=1", "display_name": "mikkel1156", "link": "https://stackoverflow.com/users/6635723/mikkel1156"}, "edited": false, "score": 0, "creation_date": 1547674359, "post_id": 54219481, "comment_id": 95277283, "body": "LsaEnumerateLogonSession maybe?"}], "owner": {"reputation": 41, "user_id": 6635723, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/ziVHn.png?s=128&g=1", "display_name": "mikkel1156", "link": "https://stackoverflow.com/users/6635723/mikkel1156"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 715, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1547649709, "creation_date": 1547649709, "question_id": 54219481, "link": "https://stackoverflow.com/questions/54219481/run-gui-program-in-user-desktop-as-system-service", "title": "Run GUI program in user desktop as SYSTEM service", "body": "<p>I'm looking for a way to run a GUI program with admin privileges from an already privileged process (as with a service running as SYSTEM) - without having a prompt for admin password.</p>\n\n<p>What I know is that if a service as SYSTEM runs a GUI program, the process will start, but it won't be displayed for the user.</p>\n\n<p>Having read about impersonation and window stations and desktops, I'm wondering if the SYSTEM service would be able to launch a GUI program, and then somehow create a new process and then set it's window station and desktop to the default one where the user can interact with it.</p>\n\n<p>The use-case would be to open a program installation (which would require admin rights to install for all users - or to install at all) and then with some simulated keystrokes go through the installation setup (which is why it's important to have a GUI that can be interacted with).</p>\n\n<p>Is something like this even possible in the context of it being run as a SYSTEM process?</p>\n"}, {"tags": ["c++", "linux", "linux-kernel", "arm", "ptrace"], "comments": [{"owner": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "edited": false, "score": 0, "creation_date": 1547655448, "post_id": 54219463, "comment_id": 95268084, "body": "Maybe you see the state of registers as set by the kernel at system call entry. If that the case maybe it is possible to interrupt the system call by sending a signal, so that the kernel restore the state of the registers."}, {"owner": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "edited": false, "score": 0, "creation_date": 1547655755, "post_id": 54219463, "comment_id": 95268265, "body": "Look at PTRACE_INTERRUPT and PTRACE_SYSCALL. And in man ptrace/Stopped state you will find the answer!"}, {"owner": {"reputation": 18888, "user_id": 1880339, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/0PkGx.png?s=128&g=1", "display_name": "artless noise", "link": "https://stackoverflow.com/users/1880339/artless-noise"}, "edited": false, "score": 0, "creation_date": 1547659379, "post_id": 54219463, "comment_id": 95270315, "body": "They are two different concepts; <code>PTRACE_GETREGSET</code> and  <code>&#47;proc&#47;pid&#47;stack</code>.  One is the process and the other is kernel space.  The kernel and process have seperate <code>SP</code> values as determined by the mode.  The GETREGSET should be where user space called into the kernel and the <code>proc&#47;pid&#47;stack</code> is where the kernel is processing the user request."}, {"owner": {"reputation": 601, "user_id": 9069780, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49bf2ad1391fadfaac120f3bb4e625ef?s=128&d=identicon&r=PG&f=1", "display_name": "Desperado17", "link": "https://stackoverflow.com/users/9069780/desperado17"}, "edited": false, "score": 0, "creation_date": 1547665172, "post_id": 54219463, "comment_id": 95273105, "body": "Is there any other interface to process kernel information besides /proc?"}], "owner": {"reputation": 601, "user_id": 9069780, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49bf2ad1391fadfaac120f3bb4e625ef?s=128&d=identicon&r=PG&f=1", "display_name": "Desperado17", "link": "https://stackoverflow.com/users/9069780/desperado17"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 104, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1547991566, "creation_date": 1547649638, "last_edit_date": 1547991566, "question_id": 54219463, "link": "https://stackoverflow.com/questions/54219463/does-ptrace-access-user-or-kernel-space", "title": "Does ptrace access user or kernel space?", "body": "<p>I'm trying to read the instruction pointer / pc register of a process/thread on an arm Aarch64 linux which is stuck within a system call ( = kernel land ) via this C++ code:</p>\n\n<pre><code>ptrace( PTRACE_GETREGSET, threadProcessId, NULL, &amp;regs );\nprintf( \"Register dump: %lx\\n\", regs.pc );\n</code></pre>\n\n<p>However, the address printed out is not the same as the function address from the top of the stack returned by /proc/threadProcessId/stack. It doesn't even seem to be in kernel space.</p>\n\n<p>Am I doing something wrong? Can I access the kernel part pcs at all this way?</p>\n"}, {"tags": ["c++", "multithreading", "time", "clock", "chrono"], "comments": [{"owner": {"reputation": 177852, "user_id": 576911, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2a2941970f141aad669d13375dc57c4f?s=128&d=identicon&r=PG", "display_name": "Howard Hinnant", "link": "https://stackoverflow.com/users/576911/howard-hinnant"}, "edited": false, "score": 0, "creation_date": 1547650688, "post_id": 54219450, "comment_id": 95265227, "body": "Fwiw, here&#39;s a faster and easier way to convert <code>duration</code> to &quot;seconds in a double&quot;:  <code>auto durationSeconds = std::chrono::duration&lt;double&gt;{duration}.count();</code>"}, {"owner": {"reputation": 3700, "user_id": 2573127, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/J2n1Z.png?s=128&g=1", "display_name": "IceFire", "link": "https://stackoverflow.com/users/2573127/icefire"}, "reply_to_user": {"reputation": 177852, "user_id": 576911, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2a2941970f141aad669d13375dc57c4f?s=128&d=identicon&r=PG", "display_name": "Howard Hinnant", "link": "https://stackoverflow.com/users/576911/howard-hinnant"}, "edited": false, "score": 0, "creation_date": 1547650748, "post_id": 54219450, "comment_id": 95265267, "body": "@HowardHinnant Thanks! It automatically uses milliseconds?"}, {"owner": {"reputation": 177852, "user_id": 576911, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2a2941970f141aad669d13375dc57c4f?s=128&d=identicon&r=PG", "display_name": "Howard Hinnant", "link": "https://stackoverflow.com/users/576911/howard-hinnant"}, "edited": false, "score": 0, "creation_date": 1547650922, "post_id": 54219450, "comment_id": 95265383, "body": "Nope, it bypasses milliseconds.  It converts directly from whatever <code>high_resolution_clock</code> gives you (typically nanoseconds) to double-based seconds."}], "answers": [{"comments": [{"owner": {"reputation": 3700, "user_id": 2573127, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/J2n1Z.png?s=128&g=1", "display_name": "IceFire", "link": "https://stackoverflow.com/users/2573127/icefire"}, "edited": false, "score": 0, "creation_date": 1547650169, "post_id": 54219534, "comment_id": 95264876, "body": "So, it seems that I need to use <code>GetProcessTimes</code> with <code>lpKernelTime</code> on Windows?"}, {"owner": {"reputation": 35613, "user_id": 7582247, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OH0qZNY40Y4/AAAAAAAAAAI/AAAAAAAABbc/xAoU3i299E0/photo.jpg?sz=128", "display_name": "Ted Lyngmo", "link": "https://stackoverflow.com/users/7582247/ted-lyngmo"}, "edited": false, "score": 2, "creation_date": 1547650663, "post_id": 54219534, "comment_id": 95265207, "body": "The total CPU time should be <code>lpKernelTime</code> + <code>lpUserTime</code> if I read the docs correctly - but a better alternative is probably <a href=\"https://docs.microsoft.com/sv-se/windows/desktop/api/realtimeapiset/nf-realtimeapiset-queryprocesscycletime\" rel=\"nofollow noreferrer\">QueryProcessCycleTime</a>"}, {"owner": {"reputation": 3700, "user_id": 2573127, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/J2n1Z.png?s=128&g=1", "display_name": "IceFire", "link": "https://stackoverflow.com/users/2573127/icefire"}, "reply_to_user": {"reputation": 35613, "user_id": 7582247, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OH0qZNY40Y4/AAAAAAAAAAI/AAAAAAAABbc/xAoU3i299E0/photo.jpg?sz=128", "display_name": "Ted Lyngmo", "link": "https://stackoverflow.com/users/7582247/ted-lyngmo"}, "edited": false, "score": 0, "creation_date": 1547653867, "post_id": 54219534, "comment_id": 95267160, "body": "@TedLyngmo Sweet!"}], "tags": [], "owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "is_accepted": true, "score": 6, "last_activity_date": 1547649935, "creation_date": 1547649935, "answer_id": 54219534, "question_id": 54219450, "link": "https://stackoverflow.com/questions/54219450/clock-gives-usual-clocks-instead-of-cpu-clocks/54219534#54219534", "title": "`clock()` gives usual clocks instead of CPU clocks", "body": "<p>Yeah, it's broken on Windows.</p>\n\n<blockquote>\n  <p>The clock function tells how much wall-clock time has passed since the CRT initialization during process start. Note that this function does not strictly conform to ISO C, which specifies net CPU time as the return value. To obtain CPU times, use the Win32 <a href=\"https://docs.microsoft.com/en-us/windows/desktop/api/processthreadsapi/nf-processthreadsapi-getprocesstimes\" rel=\"noreferrer\">GetProcessTimes</a> function. </p>\n</blockquote>\n\n<p><sup><em>(from <a href=\"https://docs.microsoft.com/en-us/cpp/c-runtime-library/reference/clock?view=vs-2017\" rel=\"noreferrer\">Microsoft's <code>clock</code> docs</a>)</em></sup></p>\n"}], "owner": {"reputation": 3700, "user_id": 2573127, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/J2n1Z.png?s=128&g=1", "display_name": "IceFire", "link": "https://stackoverflow.com/users/2573127/icefire"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 54219534, "answer_count": 1, "score": 3, "last_activity_date": 1547649935, "creation_date": 1547649595, "last_edit_date": 1547649877, "question_id": 54219450, "link": "https://stackoverflow.com/questions/54219450/clock-gives-usual-clocks-instead-of-cpu-clocks", "title": "`clock()` gives usual clocks instead of CPU clocks", "body": "<p>I used to take <code>clock()</code> to get CPU time of my algorithms. However, it does not seem to work anymore. I have a Windows 10 VM with 8 CPUs as also seen in the resource monitor.</p>\n\n<p>Now, I measure time like this:</p>\n\n<pre><code>auto startTime = std::chrono::high_resolution_clock::now();\nauto startClocks = std::clock();\n\n// some code with TBB that uses multiple threads\n\nauto endTime = std::chrono::high_resolution_clock::now();\nauto endClocks = std::clock();\nauto duration = endTime - startTime;\nauto clockDuration = endClocks - startClocks;\n\nauto durationSeconds = static_cast&lt;double&gt;(std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(duration).count()) / 1000.;\nauto durationCpuSeconds = 1. * clockDuration / CLOCKS_PER_SEC;\n</code></pre>\n\n<p>The TBB part surely works, as I see in the resource monitor of Windows that all CPUs work with 100%. If I start some endless loop without parallelization, CPU usage is only 12.5% as expected.</p>\n\n<p>However, <code>durationSeconds</code> and <code>durationCpuSeconds</code> are exactly the same...</p>\n\n<p>I have measured the time with my watch and the result is the wall time. So, <code>clock()</code> clearly does not show the CPU time which should be substantially higher with 8 CPUs working 100% in parallel. Is <code>clock()</code> not reliable or am I missing something here?</p>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 156300, "user_id": 1782465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b45d92faaf9d122bfed585490e0bafc5?s=128&d=identicon&r=PG", "display_name": "Angew is no longer proud of SO", "link": "https://stackoverflow.com/users/1782465/angew-is-no-longer-proud-of-so"}, "edited": false, "score": 4, "creation_date": 1547648803, "post_id": 54219171, "comment_id": 95263972, "body": "<a href=\"https://en.cppreference.com/w/c/string/byte/strcpy\" rel=\"nofollow noreferrer\"><code>strcpy</code></a>"}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 1, "creation_date": 1547648823, "post_id": 54219171, "comment_id": 95263988, "body": "Why don&#39;t you use strings?"}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 1, "creation_date": 1547648844, "post_id": 54219171, "comment_id": 95264004, "body": "Have you researched any possible solutions? What did you find?"}, {"owner": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "edited": false, "score": 2, "creation_date": 1547648865, "post_id": 54219171, "comment_id": 95264013, "body": "You could do <code>&quot;Red\\0Blue\\0Green&quot;</code> to get continuous memory containing those three strings, but this sounds like an XY problem. What are you <i>really</i> trying to do?"}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1547648888, "post_id": 54219171, "comment_id": 95264026, "body": "That&#39;s similar to writing <code>int x = 1; x + 2 = 4;</code>."}, {"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1547648997, "post_id": 54219171, "comment_id": 95264100, "body": "<code>std::ostringstream os; os &lt;&lt; std::setw(10) &lt;&lt; std::left &lt;&lt; colors[0] &lt;&lt; std::setw(10) &lt;&lt; std::left &lt;&lt; colors[1] &lt;&lt; std::setw(10) &lt;&lt; std::left &lt;&lt; colors[2];</code>"}, {"owner": {"reputation": 620, "user_id": 4575304, "user_type": "registered", "profile_image": "https://graph.facebook.com/864249376951568/picture?type=large", "display_name": "Mel Viso Martinez", "link": "https://stackoverflow.com/users/4575304/mel-viso-martinez"}, "edited": false, "score": 0, "creation_date": 1547649003, "post_id": 54219171, "comment_id": 95264107, "body": "Second line is very strange. May be is      char *ptr = new char[30]; ?"}, {"owner": {"reputation": 10498, "user_id": 669576, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/mRhrB.jpg?s=128&g=1", "display_name": "Johnny Mopp", "link": "https://stackoverflow.com/users/669576/johnny-mopp"}, "edited": false, "score": 0, "creation_date": 1547649138, "post_id": 54219171, "comment_id": 95264202, "body": "<code>ptr = &quot;Red&quot;;</code> You&#39;ve just re-assigned the pointer so the mem you <code>new</code>d is lost."}, {"owner": {"reputation": 34388, "user_id": 2610810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8c6433073e71478e8da278a188e1d15?s=128&d=identicon&r=PG", "display_name": "Caleth", "link": "https://stackoverflow.com/users/2610810/caleth"}, "edited": false, "score": 0, "creation_date": 1547649454, "post_id": 54219171, "comment_id": 95264424, "body": "Whoever taught you that <code>char *</code> was an appropriate type for text was lying to you. Use <code>std::string</code>, it behaves how you want it here"}], "answers": [{"comments": [{"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 1, "creation_date": 1547649414, "post_id": 54219245, "comment_id": 95264396, "body": "please add some more explaination. Providing only the code is a good recipe to grow cargo cult programmers. Eg why does OPs code not work?"}, {"owner": {"reputation": 13, "user_id": 10441995, "user_type": "registered", "profile_image": "https://graph.facebook.com/1721492901234224/picture?type=large", "display_name": "Shubham Singla", "link": "https://stackoverflow.com/users/10441995/shubham-singla"}, "edited": false, "score": 0, "creation_date": 1547649419, "post_id": 54219245, "comment_id": 95264402, "body": "Thanks!! it works!! I feel so silly asking this question :D Do you have any idea why I was getting that error with the way I was trying to do it?"}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "reply_to_user": {"reputation": 13, "user_id": 10441995, "user_type": "registered", "profile_image": "https://graph.facebook.com/1721492901234224/picture?type=large", "display_name": "Shubham Singla", "link": "https://stackoverflow.com/users/10441995/shubham-singla"}, "edited": false, "score": 0, "creation_date": 1547649754, "post_id": 54219245, "comment_id": 95264637, "body": "@ShubhamSingla because you need to learn a little bit about C++ and built-in types and classes and..."}, {"owner": {"reputation": 480, "user_id": 6948160, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/129c8f620f47a08105f596962677b4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Gojita", "link": "https://stackoverflow.com/users/6948160/gojita"}, "edited": false, "score": 1, "creation_date": 1547649898, "post_id": 54219245, "comment_id": 95264732, "body": "ptr+10 = &quot;Blue&quot;; you&#39;re trying to assign a value to an object which is not an lvalue. You can still do something like *(ptr+10) = &quot;Blue&quot;; but this will not do what you want"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 13, "user_id": 10441995, "user_type": "registered", "profile_image": "https://graph.facebook.com/1721492901234224/picture?type=large", "display_name": "Shubham Singla", "link": "https://stackoverflow.com/users/10441995/shubham-singla"}, "edited": false, "score": 0, "creation_date": 1547650156, "post_id": 54219245, "comment_id": 95264871, "body": "@ShubhamSingla I edited my answer, saying the same as some other guys including Gojita above"}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1547651127, "post_id": 54219245, "comment_id": 95265505, "body": "&quot;is not a lvalue but a value&quot; -&gt; &quot; is not a lvalue but a rvalue&quot; ?"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1547653315, "post_id": 54219245, "comment_id": 95266799, "body": "@user463035818 no, if I am not wrong a <i>rvalue</i> (renamed <i>prvalue</i>)  can be assigned (<a href=\"https://stackoverflow.com/questions/3601602/what-are-rvalues-lvalues-xvalues-glvalues-and-prvalues\" title=\"what are rvalues lvalues xvalues glvalues and prvalues\">stackoverflow.com/questions/3601602/&hellip;</a>)"}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1547653370, "post_id": 54219245, "comment_id": 95266837, "body": "but &quot;value&quot; is just the most general term that does not imply that you cannot assign to it, no?"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1547653482, "post_id": 54219245, "comment_id": 95266918, "body": "@user463035818 in my personal a value cannot. What is the right name for you ?"}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 1, "creation_date": 1547654465, "post_id": 54219245, "comment_id": 95267526, "body": "dont know, thats why I asked, my standardese is rather crappy, I always try to break things down to something simple that i can understand, which in this case is just &quot;this wont work&quot; but that doesnt qualify as an answer"}], "tags": [], "owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "is_accepted": true, "score": 0, "last_activity_date": 1547650048, "last_edit_date": 1547650048, "creation_date": 1547648912, "answer_id": 54219245, "question_id": 54219171, "link": "https://stackoverflow.com/questions/54219171/how-to-covert-a-const-char-to-a-single-block-of-memory-say-char-ptr/54219245#54219245", "title": "How to covert a const char* [] to a single block of memory, say char* ptr", "body": "<p>you request that :</p>\n\n<pre><code>strcpy(ptr, \"red\");\nstrcpy(ptr+10, \"Blue\");\nstrcpy(ptr+20, \"Green\");\n</code></pre>\n\n<p>after it is your responsibility to know where you placed the strings</p>\n\n<p>Can be more practical/generic to have only one null char between each and at least two null char after the last ?</p>\n\n<p>But frankly there are more practical/safe solutions using std::vector ...</p>\n\n<hr>\n\n<p>About the error \"lvalue required as left operand of assignment\", you have it for the lines </p>\n\n<pre><code>ptr+10 = \"Blue\";\nptr+20 = \"Green\";\n</code></pre>\n\n<p><code>ptr+n</code> is not a <em>lvalue</em> but a value, typically it is not a variable</p>\n"}], "owner": {"reputation": 13, "user_id": 10441995, "user_type": "registered", "profile_image": "https://graph.facebook.com/1721492901234224/picture?type=large", "display_name": "Shubham Singla", "link": "https://stackoverflow.com/users/10441995/shubham-singla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "closed_date": 1547656287, "accepted_answer_id": 54219245, "answer_count": 1, "score": -1, "last_activity_date": 1547650048, "creation_date": 1547648703, "last_edit_date": 1547648830, "question_id": 54219171, "link": "https://stackoverflow.com/questions/54219171/how-to-covert-a-const-char-to-a-single-block-of-memory-say-char-ptr", "closed_reason": "Needs details or clarity", "title": "How to covert a const char* [] to a single block of memory, say char* ptr", "body": "<pre><code>const char* colors[] = {\"Red\", \"Blue\", \"Green\"};\n*ptr = new char[30];\nmemset(ptr,0,30);\n</code></pre>\n\n<p>I want to store colors(2-D) to ptr(1-D), something like this =></p>\n\n<pre><code>ptr = \"Red\";\nptr+10 = \"Blue\";\nptr+20 = \"Green\";\n</code></pre>\n\n<p>this gives me lvalue required as left operand of assignment</p>\n\n<p>Could someone guide me with this, please?</p>\n"}, {"tags": ["c++", "qt-creator"], "answers": [{"comments": [{"owner": {"reputation": 384, "user_id": 5038009, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/10207262991599114/picture?type=large", "display_name": "Du\u0161an Atanackovi\u0107", "link": "https://stackoverflow.com/users/5038009/du%c5%a1an-atanackovi%c4%87"}, "edited": false, "score": 0, "creation_date": 1547653664, "post_id": 54220092, "comment_id": 95267038, "body": "i am getting this error  qualified-id in declaration before &#39;=&#39; token"}, {"owner": {"reputation": 384, "user_id": 5038009, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/10207262991599114/picture?type=large", "display_name": "Du\u0161an Atanackovi\u0107", "link": "https://stackoverflow.com/users/5038009/du%c5%a1an-atanackovi%c4%87"}, "edited": false, "score": 0, "creation_date": 1547715789, "post_id": 54220092, "comment_id": 95289420, "body": "Thanks for the help, i have managed to make it with Unterfliege&#39;s suggestion of putting it in global space"}], "tags": [], "owner": {"reputation": 805, "user_id": 7908019, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-wBTC1gSxMPU/AAAAAAAAAAI/AAAAAAAAABY/85JVWoAxQI0/photo.jpg?sz=128", "display_name": "Gerard097", "link": "https://stackoverflow.com/users/7908019/gerard097"}, "is_accepted": false, "score": 1, "last_activity_date": 1547651702, "creation_date": 1547651702, "answer_id": 54220092, "question_id": 54219056, "link": "https://stackoverflow.com/questions/54219056/referencing-qwidget-from-different-class/54220092#54220092", "title": "Referencing QWidget from different class", "body": "<p>You have to initialize your static variable, in superfalcon.cpp:</p>\n\n<pre><code>QFrame* SuperFalcon::fWigdet = nullptr;\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 384, "user_id": 5038009, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/10207262991599114/picture?type=large", "display_name": "Du\u0161an Atanackovi\u0107", "link": "https://stackoverflow.com/users/5038009/du%c5%a1an-atanackovi%c4%87"}, "edited": false, "score": 0, "creation_date": 1547653648, "post_id": 54220196, "comment_id": 95267032, "body": "i am getting this error   qualified-id in declaration before &#39;=&#39; token"}, {"owner": {"reputation": 229, "user_id": 10918448, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc2226af4f3e09f4c922563448dbec69?s=128&d=identicon&r=PG&f=1", "display_name": "Unterfliege", "link": "https://stackoverflow.com/users/10918448/unterfliege"}, "reply_to_user": {"reputation": 384, "user_id": 5038009, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/10207262991599114/picture?type=large", "display_name": "Du\u0161an Atanackovi\u0107", "link": "https://stackoverflow.com/users/5038009/du%c5%a1an-atanackovi%c4%87"}, "edited": false, "score": 0, "creation_date": 1547656223, "post_id": 54220196, "comment_id": 95268565, "body": "You have to put the definition outside of any function in the global space of the source file. This should fix it."}, {"owner": {"reputation": 384, "user_id": 5038009, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/10207262991599114/picture?type=large", "display_name": "Du\u0161an Atanackovi\u0107", "link": "https://stackoverflow.com/users/5038009/du%c5%a1an-atanackovi%c4%87"}, "edited": false, "score": 0, "creation_date": 1547715698, "post_id": 54220196, "comment_id": 95289375, "body": "I don&#39;t know what kind of sorcery is this, but it works, thanks a lot."}], "tags": [], "owner": {"reputation": 229, "user_id": 10918448, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc2226af4f3e09f4c922563448dbec69?s=128&d=identicon&r=PG&f=1", "display_name": "Unterfliege", "link": "https://stackoverflow.com/users/10918448/unterfliege"}, "is_accepted": true, "score": 1, "last_activity_date": 1547660180, "last_edit_date": 1547660180, "creation_date": 1547652020, "answer_id": 54220196, "question_id": 54219056, "link": "https://stackoverflow.com/questions/54219056/referencing-qwidget-from-different-class/54220196#54220196", "title": "Referencing QWidget from different class", "body": "<p>You must have a definition of any static member variable.\nThis definition has to be in a source file because of the one definition rule.</p>\n\n<p>Simply add the line:</p>\n\n<pre><code>QFrame* SuperFalcon::fWidget;\n</code></pre>\n\n<p>to \"superfalcon.cpp\".</p>\n"}], "owner": {"reputation": 384, "user_id": 5038009, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/10207262991599114/picture?type=large", "display_name": "Du\u0161an Atanackovi\u0107", "link": "https://stackoverflow.com/users/5038009/du%c5%a1an-atanackovi%c4%87"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 54220196, "answer_count": 2, "score": 0, "last_activity_date": 1547660180, "creation_date": 1547648325, "question_id": 54219056, "link": "https://stackoverflow.com/questions/54219056/referencing-qwidget-from-different-class", "title": "Referencing QWidget from different class", "body": "<p>I'm sorry if this question is duplicate but i am really struggling with finding any answer.</p>\n\n<p>Please take in mind that i am novice in c++ programmming.</p>\n\n<p>My problem is this. I have an GUI made in <strong>QtCreator</strong>. There are <strong>two</strong> <strong>listeners</strong> binding <code>keyReleaseEvent</code>, one on main class (<code>SuperFalcon</code>) , one on <strong>QTextEdit</strong> ( which is separate and modified class ). I have <strong>QFrame</strong> which i would like to <strong>toggle</strong> hide/show on <strong>\"Ctrl + f\"</strong> key event. Since that <strong>QFrame</strong> (object name is <code>findWidget</code>) widget belongs to <strong>SuperFalcon->ui</strong>, there's no problem, everything works fine, problem starts when i try to make <strong>\"Ctrl + f\"</strong> in <strong>QTextEdit</strong> because it's separate event listener. Basically i tried this.</p>\n\n<p>main class name is \"SuperFalcon\" so:</p>\n\n<p>in <code>superfalcon.h</code> i've made an public static pointer like this:</p>\n\n<pre><code>public:\n\n    static QFrame *fWidget;\n</code></pre>\n\n<p>then in <code>superfalcon.cpp</code>, i firstly execute </p>\n\n<p><code>ui-&gt;findWidget-&gt;hide();</code> and then </p>\n\n<p><code>fWidget = ui-&gt;findWidget</code>;  hoping to get pointer on widget.</p>\n\n<p>Next in my QTextEdit class in <code>keyReleaseEvent</code> function i've tried to get that pointer like <code>SuperFalcon::fWidget-&gt;show()</code> but i get undefined reference on it.</p>\n\n<p>So , to make things simpler, i don't know how , if possible, to get reference of QFrame widget which is part of one class (SuperFalcon), from another class (QTextEdit class) in order to execute some commands on QFrame.</p>\n\n<p>If it's not clear enough i can provide some code.</p>\n"}, {"tags": ["c++", "iterator", "indexof"], "comments": [{"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 0, "creation_date": 1547648389, "post_id": 54218989, "comment_id": 95263697, "body": "Need extra indentation there, fixed."}, {"owner": {"reputation": 1727, "user_id": 5440453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3500f6dc5327b259bb48da3399268b0?s=128&d=identicon&r=PG&f=1", "display_name": "Algirdas Preid\u017eius", "link": "https://stackoverflow.com/users/5440453/algirdas-preid%c5%beius"}, "edited": false, "score": 0, "creation_date": 1547648410, "post_id": 54218989, "comment_id": 95263714, "body": "1) Documentation explains the behavior of <a href=\"https://en.cppreference.com/w/cpp/iterator/distance\" rel=\"nofollow noreferrer\"><code>std::distance</code></a> quite well, in my opinion. 2) Documentation, also explains the <a href=\"https://en.cppreference.com/w/cpp/types/ptrdiff_t\" rel=\"nofollow noreferrer\"><code>ptrdiff_t</code></a>, and it&#39;s difference from <code>int</code>. 3) &quot;Easier&quot; is opinionated concept. <code>std::string</code> has <a href=\"https://en.cppreference.com/w/cpp/string/basic_string/find\" rel=\"nofollow noreferrer\"><code>std::string::find</code></a>, however."}, {"owner": {"reputation": 194, "user_id": 9478697, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5181658f55f5c1d447f9072e5777f50a?s=128&d=identicon&r=PG&f=1", "display_name": "Gino Pensuni", "link": "https://stackoverflow.com/users/9478697/gino-pensuni"}, "reply_to_user": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 0, "creation_date": 1547648426, "post_id": 54218989, "comment_id": 95263728, "body": "Thank you @Jarod42 :D you are my hero :D"}, {"owner": {"reputation": 194, "user_id": 9478697, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5181658f55f5c1d447f9072e5777f50a?s=128&d=identicon&r=PG&f=1", "display_name": "Gino Pensuni", "link": "https://stackoverflow.com/users/9478697/gino-pensuni"}, "reply_to_user": {"reputation": 1727, "user_id": 5440453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3500f6dc5327b259bb48da3399268b0?s=128&d=identicon&r=PG&f=1", "display_name": "Algirdas Preid\u017eius", "link": "https://stackoverflow.com/users/5440453/algirdas-preid%c5%beius"}, "edited": false, "score": 0, "creation_date": 1547648560, "post_id": 54218989, "comment_id": 95263813, "body": "@AlgirdasPreid\u017eius isn&#39;t your first sentence also an opinionated concept, that the documentation explains it quite well? (;"}, {"owner": {"reputation": 1727, "user_id": 5440453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3500f6dc5327b259bb48da3399268b0?s=128&d=identicon&r=PG&f=1", "display_name": "Algirdas Preid\u017eius", "link": "https://stackoverflow.com/users/5440453/algirdas-preid%c5%beius"}, "edited": false, "score": 0, "creation_date": 1547648683, "post_id": 54218989, "comment_id": 95263889, "body": "@HardCodedCoder Since you didn&#39;t come up with questions, about what is unclear in the wording, presented in the documentation, I&#39;ll continue to assume that it explains it well."}, {"owner": {"reputation": 480, "user_id": 6948160, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/129c8f620f47a08105f596962677b4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Gojita", "link": "https://stackoverflow.com/users/6948160/gojita"}, "edited": false, "score": 1, "creation_date": 1547649438, "post_id": 54218989, "comment_id": 95264413, "body": "You can still use in C++ : std::string text = &quot;Hello world&quot;; auto index = text.find(&quot;d&quot;); It&#39;s as easy as in C#"}], "owner": {"reputation": 194, "user_id": 9478697, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5181658f55f5c1d447f9072e5777f50a?s=128&d=identicon&r=PG&f=1", "display_name": "Gino Pensuni", "link": "https://stackoverflow.com/users/9478697/gino-pensuni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 90, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1547651408, "creation_date": 1547648098, "last_edit_date": 1547651408, "question_id": 54218989, "link": "https://stackoverflow.com/questions/54218989/how-to-get-position-of-a-certain-element-in-strings-vector-to-use-it-as-an-inde", "title": "How to get position of a certain element in strings vector, to use it as an index in ints vector? (= original name of thread)", "body": "<p>because of not enough reputation I can't comment a post on the the thread:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/15099707/how-to-get-position-of-a-certain-element-in-strings-vector-to-use-it-as-an-inde\">How to get position of a certain element in strings vector, to use it as an index in ints vector?</a></p>\n\n<p>I want to know something regarding this answer: </p>\n\n<hr>\n\n<p><strong>Original answer on thread:</strong> </p>\n\n<p>To get a position of an element in a vector knowing an iterator pointing to the element, simply subtract <code>v.begin()</code> from the iterator:</p>\n\n<pre><code>ptrdiff_t pos = find(Names.begin(), Names.end(), old_name_) - Names.begin();\n</code></pre>\n\n<p>Now you need to check <code>pos</code> against <code>Names.size()</code> to see if it is out of bounds or not:</p>\n\n<pre><code>if(pos &gt;= Names.size()) {\n    //old_name_ not found\n}\n</code></pre>\n\n<p>vector iterators behave in ways similar to array pointers; most of what you know about pointer arithmetic can be applied to vector iterators as well.</p>\n\n<p>Starting with C++11 you can use <code>std::distance</code> in place of subtraction for both iterators and pointers:</p>\n\n<pre><code>ptrdiff_t pos = distance(Names.begin(), find(Names.begin(), Names.end(), old_name_));\n</code></pre>\n\n<hr>\n\n<p><strong>Questions:</strong></p>\n\n<ol>\n<li>How does this exactly work for the compiler? What happens in the background? </li>\n</ol>\n\n<p>I know, that im passing two iterators to the find method, which seems logic: I pass the start and the end position. In between, I'm searching for the element. std::find() returns an iterator of the first element satisfying the value passed as third parameter to the std::find() method. So is std::distance doing nothing else than incrementing in a for loop something like a counter until it reaches the \"end-point\" iterator? </p>\n\n<ol start=\"2\">\n<li><p>I could also write: </p>\n\n<pre><code>int index = distance(Names.begin(), find(Names.begin(), Names.end(), old_name_));\n</code></pre></li>\n</ol>\n\n<p>Why is it better to use <code>ptrdiff_t</code> than an integer? Someone commented in the original post that it lets you store the distance between any pair of iterators into the same container, even in situations when the result is negative. But I do not really get the point of it. Maybe you could explain that a bit further. (: </p>\n\n<ol start=\"3\">\n<li><p>I'm coming from C#, where you can use something like (demonstrated on a string):</p>\n\n<pre><code>string test = \"Hello World\";\nint index = test.IndexOf(\"d\");\n</code></pre></li>\n</ol>\n\n<p>This seems a lot easier compared to the methods used above in C++. Is there something equivalent in C++?</p>\n\n<p>Thank you very much for your help!</p>\n\n<p>Best regards</p>\n"}, {"tags": ["c++", "gcc", "destructor", "gcc-warning"], "comments": [{"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 3, "creation_date": 1547647972, "post_id": 54218914, "comment_id": 95263430, "body": "Please edit your question to add a tag for the compiler you&#39;re using, as this subject is very much compiler-specific."}, {"owner": {"reputation": 147720, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 2, "creation_date": 1547647994, "post_id": 54218914, "comment_id": 95263437, "body": "I honestly can&#39;t imagine why you&#39;d get that warning if the class has absolutely no virtual functions. Can you please provide some code to accompany your question?"}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 1, "creation_date": 1547647994, "post_id": 54218914, "comment_id": 95263438, "body": "imho 2-3 lines of code would help. maybe its just me, but I get dizzy after 2 sentences that talk about code already when I cannot see the code"}, {"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "reply_to_user": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1547647996, "post_id": 54218914, "comment_id": 95263439, "body": "@Someprogrammerdude: Unless I&#39;m smoking something I ought not to, I think this has a standard C++ answer."}, {"owner": {"reputation": 12749, "user_id": 7976805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92a559df8b4b287aad23724b4c66d67c?s=128&d=identicon&r=PG&f=1", "display_name": "Yksisarvinen", "link": "https://stackoverflow.com/users/7976805/yksisarvinen"}, "edited": false, "score": 1, "creation_date": 1547648001, "post_id": 54218914, "comment_id": 95263443, "body": "Do you declare any methods as <code>virtual</code> in your class?"}, {"owner": {"reputation": 147720, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "reply_to_user": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 0, "creation_date": 1547648142, "post_id": 54218914, "comment_id": 95263528, "body": "@Bathsheba - How can you know the compiler&#39;s QoI is such that an answer applies, if you don&#39;t know that compiler version?"}, {"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "reply_to_user": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 0, "creation_date": 1547648163, "post_id": 54218914, "comment_id": 95263535, "body": "@Bathsheba Maybe I latched on to that mentioned compiler-specific option a little to much?"}, {"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "reply_to_user": {"reputation": 147720, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 0, "creation_date": 1547648186, "post_id": 54218914, "comment_id": 95263549, "body": "@StoryTeller: You mean should we still be considering C++03 as the default C++ tag? Surely not? I&#39;m an old fuddy duddy but even I use a C++11 compiler."}, {"owner": {"reputation": 147720, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "reply_to_user": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 0, "creation_date": 1547648231, "post_id": 54218914, "comment_id": 95263581, "body": "@Bathsheba - <b>Compiler version</b>. Last I checked compilers provide different support at different points in time, and also have bugs."}, {"owner": {"reputation": 4966, "user_id": 9883438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e9176c9238126b88b11234a86f45cbe?s=128&d=identicon&r=PG&f=1", "display_name": "sebrockm", "link": "https://stackoverflow.com/users/9883438/sebrockm"}, "edited": false, "score": 1, "creation_date": 1547649150, "post_id": 54218914, "comment_id": 95264215, "body": "A blind guess: You say your class has no subcasses and doesn&#39;t have any virtual functions. But maybe your class itself <i>is</i> a subclass and maybe its baseclass does have a virtual function? Then your class has that virtual function, too, even if you don&#39;t see it in your class. In that case the base class is to be fixed, not yours. Otherwise it&#39;s a compiler bug. This warning must not arise for classes without virtual functions."}, {"owner": {"reputation": 68702, "user_id": 1593860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1361e47a8bf06d20ffda9a686ceb7e68?s=128&d=identicon&r=PG", "display_name": "Pete Becker", "link": "https://stackoverflow.com/users/1593860/pete-becker"}, "edited": false, "score": 0, "creation_date": 1547649854, "post_id": 54218914, "comment_id": 95264694, "body": "To be clear: the question here is how to rewrite <b>valid</b> code to satisfy some compiler writer&#39;s notion of good style."}, {"owner": {"reputation": 17, "user_id": 10922754, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-5NppCULkOug/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZSIFJFewgX80OqQL3b-ESaWSpIew/mo/photo.jpg?sz=128", "display_name": "Alon Lanyado", "link": "https://stackoverflow.com/users/10922754/alon-lanyado"}, "edited": false, "score": 0, "creation_date": 1547650237, "post_id": 54218914, "comment_id": 95264914, "body": "You are right, it is subclass of SerializableObject (which has virtual functions). Using final in the class declaration solves the problem"}, {"owner": {"reputation": 4966, "user_id": 9883438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e9176c9238126b88b11234a86f45cbe?s=128&d=identicon&r=PG&f=1", "display_name": "sebrockm", "link": "https://stackoverflow.com/users/9883438/sebrockm"}, "edited": false, "score": 0, "creation_date": 1547651140, "post_id": 54218914, "comment_id": 95265517, "body": "@AlonLanyado in that case you should accept Bathsheba&#39;s answer (click the hook next to the vote count)."}], "answers": [{"comments": [{"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 2, "creation_date": 1547648622, "post_id": 54218929, "comment_id": 95263854, "body": "<i>final</i> doesn&#39;t apply on cats number ?"}, {"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "reply_to_user": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1547648657, "post_id": 54218929, "comment_id": 95263880, "body": "@bruno: Alas not, more like <code>mutable</code> or possibly even <code>volatile</code>."}, {"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "reply_to_user": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1547648723, "post_id": 54218929, "comment_id": 95263922, "body": "Maybe <code>register</code> if they have no fixed address ;-)"}], "tags": [], "owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "is_accepted": true, "score": 4, "last_activity_date": 1547647920, "creation_date": 1547647920, "answer_id": 54218929, "question_id": 54218914, "link": "https://stackoverflow.com/questions/54218914/how-to-delete-pointer-to-a-class-without-virtual-functions-and-no-inheritance/54218929#54218929", "title": "How to delete pointer to a class without virtual functions and no inheritance", "body": "<p>Mark the class as <code>final</code> (from C++11).</p>\n\n<p>Then it can't have a child class, so you don't need to worry about the implications of having a non-virtual destructor. A compiler should be aware of that and suppress the warning.</p>\n\n<p>Reference: <a href=\"https://en.cppreference.com/w/cpp/language/final\" rel=\"nofollow noreferrer\">https://en.cppreference.com/w/cpp/language/final</a></p>\n"}], "owner": {"reputation": 17, "user_id": 10922754, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-5NppCULkOug/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZSIFJFewgX80OqQL3b-ESaWSpIew/mo/photo.jpg?sz=128", "display_name": "Alon Lanyado", "link": "https://stackoverflow.com/users/10922754/alon-lanyado"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 54218929, "answer_count": 1, "score": -1, "last_activity_date": 1591255389, "creation_date": 1547647833, "last_edit_date": 1591255389, "question_id": 54218914, "link": "https://stackoverflow.com/questions/54218914/how-to-delete-pointer-to-a-class-without-virtual-functions-and-no-inheritance", "title": "How to delete pointer to a class without virtual functions and no inheritance", "body": "<p>When a class has virtual method, you need to write a virtual destructor to properly free the memory in the destructor.</p>\n\n<p>In my case, I don't have a virtual method in the class and neither any sub-classes. </p>\n\n<p>When I compile the program using gcc with \"-Wdelete-non-virtual-dtor\" flag I get a warning.\nRewriting the destructor as virtual indeed removes the warning, but I don't want to rewrite the destructor of the class as virtual since it doesn't have any sub-classes. \nIs there any way to suppress the warning \"-Wdelete-non-virtual-dtor\" and tell the compiler there is no inheritance - sub-classes for this class?\nIt's not a specific gcc version or gcc question.</p>\n\n<p>UPDATE:\nDiscovered that my class has inheritance of other class that has virtual functions and thus itself has virtual functions.</p>\n\n<p>The accept answer was that I missed that the class is indeed virtual (since it inherits another class with virtual functions). Since it doesn't have sub-classes and should have ones, I can add \"final\" keyword to the class to solved the issue. </p>\n\n<p>Simple code example:</p>\n\n<pre><code>#include &lt;iostream&gt;\n\nclass A {\n    public:\n    int a;\n    virtual void f() {};\n};\n\ntemplate&lt;class T&gt; void foo() {\n    T *obj = new T;\n\n    delete obj;\n}\n\nint main()\n{\n    foo&lt;A&gt;();\n    std::cout &lt;&lt; \"Done\" &lt;&lt; std::endl;\n}\n</code></pre>\n\n<p>Adding final to class A - also removed the warning.</p>\n"}, {"tags": ["c++", "windows", "qt", "qprocess"], "comments": [{"owner": {"reputation": 7089, "user_id": 2852165, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/JwDJG.jpg?s=128&g=1", "display_name": "SHR", "link": "https://stackoverflow.com/users/2852165/shr"}, "edited": false, "score": 0, "creation_date": 1547647801, "post_id": 54218805, "comment_id": 95263301, "body": "Have you think about replace the cls with other app/batch in the running directory?"}, {"owner": {"reputation": 629, "user_id": 8124507, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/0f4c546e2ba73af5048a059d424cbd4c?s=128&d=identicon&r=PG&f=1", "display_name": "bluedragon", "link": "https://stackoverflow.com/users/8124507/bluedragon"}, "reply_to_user": {"reputation": 7089, "user_id": 2852165, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/JwDJG.jpg?s=128&g=1", "display_name": "SHR", "link": "https://stackoverflow.com/users/2852165/shr"}, "edited": false, "score": 0, "creation_date": 1547647866, "post_id": 54218805, "comment_id": 95263341, "body": "trying thanks, but is there any more elegant solution"}, {"owner": {"reputation": 629, "user_id": 8124507, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/0f4c546e2ba73af5048a059d424cbd4c?s=128&d=identicon&r=PG&f=1", "display_name": "bluedragon", "link": "https://stackoverflow.com/users/8124507/bluedragon"}, "reply_to_user": {"reputation": 7089, "user_id": 2852165, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/JwDJG.jpg?s=128&g=1", "display_name": "SHR", "link": "https://stackoverflow.com/users/2852165/shr"}, "edited": false, "score": 0, "creation_date": 1547648231, "post_id": 54218805, "comment_id": 95263582, "body": "nope it&#39;s still calling system command"}, {"owner": {"reputation": 35613, "user_id": 7582247, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OH0qZNY40Y4/AAAAAAAAAAI/AAAAAAAABbc/xAoU3i299E0/photo.jpg?sz=128", "display_name": "Ted Lyngmo", "link": "https://stackoverflow.com/users/7582247/ted-lyngmo"}, "edited": false, "score": 0, "creation_date": 1547648279, "post_id": 54218805, "comment_id": 95263617, "body": "<code>m_textEdit-&gt;insertPlainText(readAllStandardOutput());</code> inserts the <code>cls</code> characters directly without parsing. You probably need <code>auto str = readAllStandardOutput(); if(str==&lt;escape sequence for cls&gt;) m_textEdit-&gt;clear(); else m_textEdit-&gt;insertPlainText(str);</code>"}, {"owner": {"reputation": 629, "user_id": 8124507, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/0f4c546e2ba73af5048a059d424cbd4c?s=128&d=identicon&r=PG&f=1", "display_name": "bluedragon", "link": "https://stackoverflow.com/users/8124507/bluedragon"}, "edited": false, "score": 0, "creation_date": 1547649041, "post_id": 54218805, "comment_id": 95264127, "body": "i added this  <code>if (str == &quot;^[[2J&quot;) m_textEdit-&gt;clear();</code> but it doesn&#39;t seems to work, i am on windows"}, {"owner": {"reputation": 629, "user_id": 8124507, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/0f4c546e2ba73af5048a059d424cbd4c?s=128&d=identicon&r=PG&f=1", "display_name": "bluedragon", "link": "https://stackoverflow.com/users/8124507/bluedragon"}, "edited": false, "score": 0, "creation_date": 1547650076, "post_id": 54218805, "comment_id": 95264817, "body": "str is actually &#39;\\f&#39; when cls executes"}, {"owner": {"reputation": 629, "user_id": 8124507, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/0f4c546e2ba73af5048a059d424cbd4c?s=128&d=identicon&r=PG&f=1", "display_name": "bluedragon", "link": "https://stackoverflow.com/users/8124507/bluedragon"}, "edited": false, "score": 0, "creation_date": 1547650221, "post_id": 54218805, "comment_id": 95264905, "body": "I am using &#39;\\f&#39; as a marker for cls(clear the screen), seems to work, thanks, guys..."}], "owner": {"reputation": 629, "user_id": 8124507, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/0f4c546e2ba73af5048a059d424cbd4c?s=128&d=identicon&r=PG&f=1", "display_name": "bluedragon", "link": "https://stackoverflow.com/users/8124507/bluedragon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1547647470, "creation_date": 1547647470, "question_id": 54218805, "link": "https://stackoverflow.com/questions/54218805/catch-sytemcls-by-child-qprocess", "title": "catch sytem(&quot;cls&quot;) by child QProcess", "body": "<p>I am trying to capture the text output and input of child QProcess, now I need that whenever child use system(\"cls\") I get notified so that I can clear my QTextEdit for displaying and taking child output<br>\n<strong>editProcess.h</strong></p>\n\n<pre><code>#ifndef EDITPROCESS_H\n#define EDITPROCESS_H\n#include &lt;QPointer&gt;\n#include &lt;QProcess&gt;\n#include &lt;memory&gt;\n\nclass QPlainTextEdit;\n\n// a Process with plainTextEdit as output and input window\nclass EditProcess : public QProcess {\n  Q_OBJECT\npublic:\n  explicit EditProcess(QWidget *parent = nullptr);\n  QPointer&lt;QPlainTextEdit&gt; edit() { return m_textEdit; }\n  ~EditProcess();\nsignals:\n\npublic slots:\n\nprivate:\n  QPointer&lt;QPlainTextEdit&gt; m_textEdit;\n\nprotected:\n  bool eventFilter(QObject *, QEvent *event) override;\n};\n\n#endif // EDITPROCESS_H\n</code></pre>\n\n<p><strong>editProcess.cpp</strong></p>\n\n<pre><code>#include \"editprocess.h\"\n#include &lt;QDebug&gt;\n#include &lt;QKeyEvent&gt;\n#include &lt;QPlainTextEdit&gt;\n\nEditProcess::EditProcess(QWidget *parent)\n    : QProcess(parent), m_textEdit{new QPlainTextEdit}\n// zm_textEdit(std::make_shared&lt;QPlainTextEdit&gt;(parent))\n{\n  QObject::connect(this, &amp;EditProcess::readyReadStandardOutput, [this]() {\n    m_textEdit-&gt;insertPlainText(readAllStandardOutput());\n  });\n\n  QObject::connect(this, &amp;EditProcess::readyReadStandardError, [this]() {\n    m_textEdit-&gt;insertPlainText(readAllStandardError());\n  });\n\n  QObject::connect(\n      this,\n      static_cast&lt;void (EditProcess::*)(int, QProcess::ExitStatus)&gt;(\n          &amp;EditProcess::finished),\n      [this](int exitCode, QProcess::ExitStatus) -&gt; void {\n        m_textEdit-&gt;insertPlainText(readAllStandardOutput());\n        m_textEdit-&gt;insertPlainText(\n            QString(\"\\nProgram Finished with exit code: %1\").arg(exitCode));\n      });\n\n  m_textEdit-&gt;installEventFilter(this);\n}\n\nEditProcess::~EditProcess() { kill(); }\n\nbool EditProcess::eventFilter(QObject *, QEvent *event) {\n  if (event-&gt;type() == QEvent::KeyPress) {\n    auto keyEvent = dynamic_cast&lt;QKeyEvent *&gt;(event);\n    if (keyEvent-&gt;modifiers() == Qt::CTRL &amp;&amp; keyEvent-&gt;key() == Qt::Key_C)\n      kill();\n    else\n      write(keyEvent-&gt;text().toUtf8());\n  }\n  return false;\n}\n</code></pre>\n\n<p><strong>mainwidow.cpp</strong>  </p>\n\n<pre><code>MainWindow::MainWindow(QWidget *parent)\n    : QMainWindow(parent), ui(new Ui::MainWindow) {\n  ui-&gt;setupUi(this);\n\n  auto p = new EditProcess(parent);\n  p-&gt;edit()-&gt;setParent(centralWidget());\n  p-&gt;setProgram(\n      \"test.exe\");\n  p-&gt;start();\n  qDebug() &lt;&lt; p-&gt;errorString();\n}  \n</code></pre>\n\n<p>if I call <code>system(\"cls\")</code> from child process now, nothing happens, QTextEdit remains same, I didn't notice any change</p>\n"}, {"tags": ["c++", "binaries", "log4cplus", "conan"], "answers": [{"tags": [], "owner": {"reputation": 1993, "user_id": 2036859, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/N1Esm.jpg?s=128&g=1", "display_name": "uilianries", "link": "https://stackoverflow.com/users/2036859/uilianries"}, "is_accepted": false, "score": 0, "last_activity_date": 1547671008, "creation_date": 1547671008, "answer_id": 54224979, "question_id": 54218760, "link": "https://stackoverflow.com/questions/54218760/adding-binaries-to-other-peoples-conan-recipes/54224979#54224979", "title": "Adding binaries to other peoples conan recipes", "body": "<p>I do recommend open an issue for Bincrafters, requesting clang 3.9 support: <a href=\"https://github.com/bincrafters/community/issues/\" rel=\"nofollow noreferrer\">https://github.com/bincrafters/community/issues/</a></p>\n\n<p>Include a new package configuration is just one line in the Travis recipe.</p>\n\n<blockquote>\n  <p>How can I upload localy build binary with clang 6.0?</p>\n</blockquote>\n\n<p>You could use JFrog Artifactory, there is a Community Edition with Conan support. Also, you could create a \"mirror\" for your packages locally with Artifactory, instead to download from Bintray:\n<a href=\"https://docs.conan.io/en/latest/uploading_packages/artifactory_ce.html\" rel=\"nofollow noreferrer\">https://docs.conan.io/en/latest/uploading_packages/artifactory_ce.html</a></p>\n\n<p>However, Conan respects your remote list by it order, if your Conan client finds log4cplus first in Bincrafters' remote but the correct binary is only available in your local repository, Conan will ignore your local remote and will show a message error about missed binary package for log4cplus. Thus, in your case, you will need to copy ALL binaries to your local repository.</p>\n\n<p>Regards!</p>\n"}, {"tags": [], "owner": {"reputation": 114, "user_id": 10926098, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-4nxopaCNlR8/AAAAAAAAAAI/AAAAAAAAAps/qTa-TECvUwQ/photo.jpg?sz=128", "display_name": "tushar_ecmc", "link": "https://stackoverflow.com/users/10926098/tushar-ecmc"}, "is_accepted": false, "score": 0, "last_activity_date": 1550555451, "creation_date": 1550555451, "answer_id": 54759640, "question_id": 54218760, "link": "https://stackoverflow.com/questions/54218760/adding-binaries-to-other-peoples-conan-recipes/54759640#54759640", "title": "Adding binaries to other peoples conan recipes", "body": "<p>You will find the conan packages installed on your Linux system at <code>.conan/data/package_name/version/repo_name/tag</code>. There will be a package folder inside it. If you want to manually add binaries to existing packages then you can add the binary in <code>/bin</code> folder in packages.</p>\n\n<p>Or else you can look into the conan recipe in exports folder and look for the package, that from where it is getting its binaries from and add that binary in that path.</p>\n"}], "owner": {"reputation": 546, "user_id": 603044, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/02bbd74fd6cfd0e07604fb7902dbc894?s=128&d=identicon&r=PG&f=1", "display_name": "T4ng10r", "link": "https://stackoverflow.com/users/603044/t4ng10r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 150, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1550555451, "creation_date": 1547647351, "question_id": 54218760, "link": "https://stackoverflow.com/questions/54218760/adding-binaries-to-other-peoples-conan-recipes", "title": "Adding binaries to other peoples conan recipes", "body": "<p>I'm using given conan packages</p>\n\n<pre><code>gtest/1.8.0@bincrafters/stable\nboost/1.66.0@conan/stable\nlog4cplus/2.0.2@bincrafters/stable`\n</code></pre>\n\n<p>and clang (version at least 6.0). <br>\nWhile first two packages has binaries for clang 6.0, log4cplus doesn't (last is clang 3.9). I don't like the idea that on each workstation I would need to build this package by hand.</p>\n\n<p>How can I upload localy build binary with clang 6.0?<br>\n<code>conan upload</code> looks promising, however it suggest that it will be NEW package. <br>Second question - wouldn't I interfere with package author in any way?</p>\n"}, {"tags": ["c++", "c++11", "assembly", "c++14", "inline-assembly"], "comments": [{"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 4, "creation_date": 1547647702, "post_id": 54218733, "comment_id": 95263233, "body": "You might want to try something like <code>std::transform(begin(v), end(v), begin(v), [](int i) { return std::clamp(i, 255, 0); })</code>, as it allows for better parallelization or vectorization."}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 3, "creation_date": 1547647746, "post_id": 54218733, "comment_id": 95263259, "body": "maybe consider where the values are coming from and where do they go, the best optimization is when you dont need that loop at all"}, {"owner": {"reputation": 953, "user_id": 1095896, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f70f2db9cc735bfc663e9b0794125e2e?s=128&d=identicon&r=PG", "display_name": "james", "link": "https://stackoverflow.com/users/1095896/james"}, "reply_to_user": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1547648189, "post_id": 54218733, "comment_id": 95263551, "body": "Thanks! @Someprogrammerdude could you please elaborate a bit more on why using std::transform and std::clamp allows for better parallelization or vectorization? I thought the original for loop will be compiled the same way as yours, if not better."}, {"owner": {"reputation": 19667, "user_id": 1312382, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FL8Fg.jpg?s=128&g=1", "display_name": "Aconcagua", "link": "https://stackoverflow.com/users/1312382/aconcagua"}, "edited": false, "score": 0, "creation_date": 1547648482, "post_id": 54218733, "comment_id": 95263764, "body": "<i>&#39;An example [...]&#39;</i> - in assembler? That would be HW specific, so you&#39;d need to specify target architecture. Otherwise we&#39;ll be tied to C++ only optimisations..."}, {"owner": {"reputation": 953, "user_id": 1095896, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f70f2db9cc735bfc663e9b0794125e2e?s=128&d=identicon&r=PG", "display_name": "james", "link": "https://stackoverflow.com/users/1095896/james"}, "reply_to_user": {"reputation": 19667, "user_id": 1312382, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FL8Fg.jpg?s=128&g=1", "display_name": "Aconcagua", "link": "https://stackoverflow.com/users/1312382/aconcagua"}, "edited": false, "score": 0, "creation_date": 1547648632, "post_id": 54218733, "comment_id": 95263861, "body": "@Aconcagua just clarified that in my question. I&#39;m targeting at x86 machines."}, {"owner": {"reputation": 15145, "user_id": 4271923, "user_type": "registered", "profile_image": "https://graph.facebook.com/543414580/picture?type=large", "display_name": "Ped7g", "link": "https://stackoverflow.com/users/4271923/ped7g"}, "edited": false, "score": 0, "creation_date": 1547648923, "post_id": 54218733, "comment_id": 95264051, "body": "x86 32 bit or x86-64 (64 bit)? These are somewhat like two different machines... (BTW, I believe there are clamping instructions in MMX or SSE extensions, so depending what is your <code>v</code>, maybe you can use intrinsics over it... then again, if <code>v</code> is of favourable type, I would expect already your compiler to use those, with enough optimization switches used, so it depends a lot what is <code>v</code> and why does it prevent compiler from producing more performant machine code) ... hmmm, thinking about it, this requires <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> for meaningful example of how-to-improve."}, {"owner": {"reputation": 3140, "user_id": 1463557, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/52qXF.gif?s=128&g=1", "display_name": "MadScientist", "link": "https://stackoverflow.com/users/1463557/madscientist"}, "edited": false, "score": 0, "creation_date": 1547648955, "post_id": 54218733, "comment_id": 95264069, "body": "Have you tried to eliminate the branch by bit-twiddling? <code>y ^ ((x ^ y) &amp; -(x &lt; y))</code> gives the minimum of <code>x</code> and <code>y</code>, so use <code>x=i</code> and <code>y=0xff</code>."}, {"owner": {"reputation": 953, "user_id": 1095896, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f70f2db9cc735bfc663e9b0794125e2e?s=128&d=identicon&r=PG", "display_name": "james", "link": "https://stackoverflow.com/users/1095896/james"}, "reply_to_user": {"reputation": 15145, "user_id": 4271923, "user_type": "registered", "profile_image": "https://graph.facebook.com/543414580/picture?type=large", "display_name": "Ped7g", "link": "https://stackoverflow.com/users/4271923/ped7g"}, "edited": false, "score": 0, "creation_date": 1547649656, "post_id": 54218733, "comment_id": 95264569, "body": "@Ped7g v is a vector. thanks."}, {"owner": {"reputation": 953, "user_id": 1095896, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f70f2db9cc735bfc663e9b0794125e2e?s=128&d=identicon&r=PG", "display_name": "james", "link": "https://stackoverflow.com/users/1095896/james"}, "reply_to_user": {"reputation": 3140, "user_id": 1463557, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/52qXF.gif?s=128&g=1", "display_name": "MadScientist", "link": "https://stackoverflow.com/users/1463557/madscientist"}, "edited": false, "score": 0, "creation_date": 1547649751, "post_id": 54218733, "comment_id": 95264635, "body": "@MadScientist I&#39;m impressed by your solution but this is rather unreadable - Maybe even more unreadable than assembler code : ) I will give it a try and see how much speedup this can bring."}, {"owner": {"reputation": 19667, "user_id": 1312382, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FL8Fg.jpg?s=128&g=1", "display_name": "Aconcagua", "link": "https://stackoverflow.com/users/1312382/aconcagua"}, "edited": false, "score": 0, "creation_date": 1547650346, "post_id": 54218733, "comment_id": 95264976, "body": "@james It is not unusual that heavily optimised code is badly human-readable..."}, {"owner": {"reputation": 19667, "user_id": 1312382, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FL8Fg.jpg?s=128&g=1", "display_name": "Aconcagua", "link": "https://stackoverflow.com/users/1312382/aconcagua"}, "edited": false, "score": 0, "creation_date": 1547650493, "post_id": 54218733, "comment_id": 95265089, "body": "@james If you are interested in more of <a href=\"https://graphics.stanford.edu/~seander/bithacks.html\" rel=\"nofollow noreferrer\">such stuff</a>..."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 3140, "user_id": 1463557, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/52qXF.gif?s=128&g=1", "display_name": "MadScientist", "link": "https://stackoverflow.com/users/1463557/madscientist"}, "edited": false, "score": 1, "creation_date": 1547650801, "post_id": 54218733, "comment_id": 95265293, "body": "@MadScientist: Yuck, just write something the compiler can easily auto-vectorize into <a href=\"https://www.felixcloutier.com/x86/pminsd:pminsq\" rel=\"nofollow noreferrer\">SSE4.1 <code>pminsd</code></a> for signed-int clamping, assuming you&#39;re targeting SSE4.1."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1547651694, "post_id": 54218733, "comment_id": 95265855, "body": "Or just watching the video, he&#39;s disabling autovectorization so the compiler uses cmp/cmovge.  A conditional select ALU instruction is more efficient than what you&#39;d probably get from that bithack, even with one of the inputs being an immediate."}, {"owner": {"reputation": 953, "user_id": 1095896, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f70f2db9cc735bfc663e9b0794125e2e?s=128&d=identicon&r=PG", "display_name": "james", "link": "https://stackoverflow.com/users/1095896/james"}, "reply_to_user": {"reputation": 19667, "user_id": 1312382, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FL8Fg.jpg?s=128&g=1", "display_name": "Aconcagua", "link": "https://stackoverflow.com/users/1312382/aconcagua"}, "edited": false, "score": 0, "creation_date": 1547651954, "post_id": 54218733, "comment_id": 95265995, "body": "@Aconcagua thanks for the link."}, {"owner": {"reputation": 15145, "user_id": 4271923, "user_type": "registered", "profile_image": "https://graph.facebook.com/543414580/picture?type=large", "display_name": "Ped7g", "link": "https://stackoverflow.com/users/4271923/ped7g"}, "edited": false, "score": 0, "creation_date": 1547652271, "post_id": 54218733, "comment_id": 95266171, "body": "@james <code>std::vector</code> is from assembly point of view completely abstract and &quot;undefined&quot; type (undefined as in = not known how many bits and in what constellation will be used by single element). You can&#39;t produce assembly for such under-specified type. (EDIT: actually if one assumes you don&#39;t do implicit casting, <code>std::vector&lt;int&gt;</code> may be assumed, but it&#39;s safer to have that explicitly stated) That&#39;s why <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> helps a lot with this kind of questions, as everything must be defined enough to get working binary..."}, {"owner": {"reputation": 15145, "user_id": 4271923, "user_type": "registered", "profile_image": "https://graph.facebook.com/543414580/picture?type=large", "display_name": "Ped7g", "link": "https://stackoverflow.com/users/4271923/ped7g"}, "edited": false, "score": 0, "creation_date": 1547652778, "post_id": 54218733, "comment_id": 95266469, "body": "But the most important point is, that with modern C++ compilers and x86-64 target, it&#39;s very easy to make some trivial &quot;mistake&quot; in C++ source preventing compiler from using better solution (things related to aliasing rules, memory alignment, etc..). Carefully crafted example showing your actual planned lifecycle of those data and how they will be passed along to the function/etc can help to check all those tricky spots and suggest improvements to the original C++ source, avoiding the assembly for as long as possible. Using assembly in real (not for fun) projects should be one of last options."}, {"owner": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 0, "creation_date": 1547653194, "post_id": 54218733, "comment_id": 95266723, "body": "Seems relevant: <a href=\"https://en.cppreference.com/w/cpp/algorithm/clamp\" rel=\"nofollow noreferrer\">en.cppreference.com/w/cpp/algorithm/clamp</a>"}], "answers": [{"comments": [{"owner": {"reputation": 953, "user_id": 1095896, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f70f2db9cc735bfc663e9b0794125e2e?s=128&d=identicon&r=PG", "display_name": "james", "link": "https://stackoverflow.com/users/1095896/james"}, "edited": false, "score": 0, "creation_date": 1547648543, "post_id": 54219021, "comment_id": 95263798, "body": "Thanks for your answer. &quot;How would you want to apply the code changes to assembler code in such a system?&quot; this is exactly where my question is coming from."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 953, "user_id": 1095896, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f70f2db9cc735bfc663e9b0794125e2e?s=128&d=identicon&r=PG", "display_name": "james", "link": "https://stackoverflow.com/users/1095896/james"}, "edited": false, "score": 3, "creation_date": 1547650485, "post_id": 54219021, "comment_id": 95265081, "body": "@james: Chandler modified the compiler&#39;s asm output because that&#39;s an easy way to do a one-off <i>experiment</i> to find out whether a change would be useful; compiler-generated asm is usally a good starting point for an optimized loop.  It&#39;s <i>not</i> a good or even viable way to actually maintain an asm implementation of a loop as part of a program.  Plus it defeats the purpose of having any other functions in the file written in C++ and being available for link-time optimization."}], "tags": [], "owner": {"reputation": 19667, "user_id": 1312382, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FL8Fg.jpg?s=128&g=1", "display_name": "Aconcagua", "link": "https://stackoverflow.com/users/1312382/aconcagua"}, "is_accepted": true, "score": 2, "last_activity_date": 1547648217, "creation_date": 1547648217, "answer_id": 54219021, "question_id": 54218733, "link": "https://stackoverflow.com/questions/54218733/optimisation-advice-on-value-clamping-in-a-loop/54219021#54219021", "title": "optimisation advice on value clamping in a loop", "body": "<blockquote>\n  <p>My question is, in practice, in a production code, what is the recommended approach to optimise this? Shall we use inline assembly in c++ code? Or like Chandler did, compile C++ code into assembly then optimise the assembler?</p>\n</blockquote>\n\n<p>For production code you need to consider that the software might be compiled and linked in an automatic build system.</p>\n\n<p>How would you want to apply the code changes to assembler code in such a system? You might apply a diff file, but that might break if if optimisation (or other) settings are changed, if switching to another compiler or ...</p>\n\n<p>Now remaining two options: write the entire function in an assembler file (.s) or have inline assembler code inside the C++ code &ndash; the latter possibly with the advantage of keeping related code in the same translation unit.</p>\n\n<p>Still I'd let the compiler generate assembler code <em>once</em> &ndash; with highest optimisation level available. This code can then serve as a (already pre-optimised) base for your hand-made optimisations, of which the outcome should then be pasted back as inline assembly to the C++ source file or placed into a separate assembly source file.</p>\n"}, {"tags": [], "owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "is_accepted": false, "score": 2, "last_activity_date": 1547669730, "creation_date": 1547669730, "answer_id": 54224681, "question_id": 54218733, "link": "https://stackoverflow.com/questions/54218733/optimisation-advice-on-value-clamping-in-a-loop/54224681#54224681", "title": "optimisation advice on value clamping in a loop", "body": "<p><strong>Chandler modified the compiler's asm output because that's an easy way to do a one-off experiment to find out whether a change would be useful</strong>, <em>without</em> doing all the stuff you'd normally want to include an asm loop or function as part of the source code for a project.</p>\n\n<p>Compiler-generated asm is usually a good starting point for an optimized loop, but actually keeping the whole file as-is isn't a good or even viable way to actually maintain an asm implementation of a loop as part of a program.  See @Aconcagua's answer.</p>\n\n<p>Plus it defeats the purpose of having any other functions in the file written in C++ and being available for link-time optimization.</p>\n\n<hr>\n\n<p><strong>Re: actually clamping:</strong></p>\n\n<p>Note that Chandler was just experimenting with changes to the non-vectorized code-gen, and disabled unrolling + auto-vectorization.  In real life hopefully you can target SSE4.1 or AVX2 and let the compiler auto-vectorize with <a href=\"https://www.felixcloutier.com/x86/PMINSD:PMINSQ.html\" rel=\"nofollow noreferrer\"><code>pminsd</code></a> or <a href=\"https://www.felixcloutier.com/x86/PMINUD:PMINUQ.html\" rel=\"nofollow noreferrer\"><code>pminud</code></a> for signed or unsigned int clamping to an upper bound.  (Also available in other element sizes.  Or without SSE4.1, just SSE2, maybe you can 2x <code>PACKSSDW</code> => <a href=\"https://www.felixcloutier.com/x86/packuswb\" rel=\"nofollow noreferrer\"><code>packuswb</code></a> (unsigned saturation) then unpack with zeros back up to 4 vectors of dword elements.  (If you can't just use an output of <code>uint8_t[]</code>!)</p>\n\n<p>And BTW, <a href=\"https://www.youtube.com/watch?v=2EWejmkKlxs&amp;lc=UgwGVzkWvgJ687jzYJF4AaABAg.8ZZuRtso72u8_kIWoRq8q0\" rel=\"nofollow noreferrer\">in the comments of the video, Chandler said</a> it turns out that he made a mistake and the effect he was seeing wasn't really due to a predictable branch vs. a cmov.  It might have been a code-alignment thing, because changing from <code>mov %ebx, (%rdi)</code> to <code>movl $255, (%rdi)</code> made a difference!</p>\n\n<p>(AMD CPUs aren't known to have register-read stalls the way P6-family did, should have no trouble hiding the dep chain of a cmov coupling a store to a load vs. breaking it with branch prediction + speculation past a branch.)</p>\n\n<hr>\n\n<p>You very <em>rarely</em> would actually want to use a hand-written loop.  Often you can hand-hold and/or trick your compiler into making asm more like what you want, just by modifying the C++ source.  Then a future compiler is free to tune differently for <code>-march=some_future_cpu</code>.</p>\n"}], "owner": {"reputation": 953, "user_id": 1095896, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f70f2db9cc735bfc663e9b0794125e2e?s=128&d=identicon&r=PG", "display_name": "james", "link": "https://stackoverflow.com/users/1095896/james"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "accepted_answer_id": 54219021, "answer_count": 2, "score": 1, "last_activity_date": 1547669730, "creation_date": 1547647245, "last_edit_date": 1547649595, "question_id": 54218733, "link": "https://stackoverflow.com/questions/54218733/optimisation-advice-on-value-clamping-in-a-loop", "title": "optimisation advice on value clamping in a loop", "body": "<p>I have a tight loop exactly like what Chandler Carruth presented in CPP CON 2017:\n<a href=\"https://www.youtube.com/watch?v=2EWejmkKlxs\" rel=\"nofollow noreferrer\">https://www.youtube.com/watch?v=2EWejmkKlxs</a>\nat 25 mins in this video, there is a loop like this:</p>\n\n<pre><code>for (int&amp; i:v)\n    i = i&gt;255?255:i;\n</code></pre>\n\n<p>where <code>v</code> is a vector. This is exactly the same code used in my program which after profiling, proves to take a good amount of time.</p>\n\n<p>In his presentation, Chandler modified the assembly and speed up the loop. My question is, in practice, in a production code, what is the recommended approach to optimise this? Shall we use inline assembly in c++ code? Or like Chandler did, compile C++ code into assembly then optimise the assembler?</p>\n\n<p>An example to optimise the above for loop will be really appreciated, assuming x86 architecture.</p>\n"}, {"tags": ["c++", "boost", "c++17", "variant"], "comments": [{"owner": {"reputation": 147720, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 1, "creation_date": 1547647255, "post_id": 54218595, "comment_id": 95262981, "body": "A cast or <code>std::get&lt;int_ref&gt;(v).get()</code>, to be fair."}, {"owner": {"reputation": 42006, "user_id": 3807729, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UEUbF.jpg?s=128&g=1", "display_name": "Galik", "link": "https://stackoverflow.com/users/3807729/galik"}, "edited": false, "score": 0, "creation_date": 1547647396, "post_id": 54218595, "comment_id": 95263068, "body": "You can use pointers though no?"}, {"owner": {"reputation": 122530, "user_id": 2756719, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b06a9c91425630fdb69e861abe483d7e?s=128&d=identicon&r=PG&f=1", "display_name": "T.C.", "link": "https://stackoverflow.com/users/2756719/t-c"}, "edited": false, "score": 4, "creation_date": 1547650757, "post_id": 54218595, "comment_id": 95265270, "body": "Same problems as <code>optional&lt;T&amp;&gt;</code>: do you assign through or reseat the reference?"}, {"owner": {"reputation": 615, "user_id": 6173694, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-FWVTscLbv7w/AAAAAAAAAAI/AAAAAAAAADY/skh9BkqfV0I/photo.jpg?sz=128", "display_name": "olq_plo", "link": "https://stackoverflow.com/users/6173694/olq-plo"}, "reply_to_user": {"reputation": 42006, "user_id": 3807729, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UEUbF.jpg?s=128&g=1", "display_name": "Galik", "link": "https://stackoverflow.com/users/3807729/galik"}, "edited": false, "score": 0, "creation_date": 1547673526, "post_id": 54218595, "comment_id": 95276902, "body": "@Galik In my application I could make it work with pointers, but I would have to write a lot of extra code. I have a lot of <code>boost::get</code> calls, which work seamlessly if the variant holds full types or references. It wouldn&#39;t work a seamlessly with pointers."}, {"owner": {"reputation": 615, "user_id": 6173694, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-FWVTscLbv7w/AAAAAAAAAAI/AAAAAAAAADY/skh9BkqfV0I/photo.jpg?sz=128", "display_name": "olq_plo", "link": "https://stackoverflow.com/users/6173694/olq-plo"}, "edited": false, "score": 0, "creation_date": 1547674449, "post_id": 54218595, "comment_id": 95277316, "body": "Sorry, should have said <code>boost::get</code> and <code>boost::apply_visitor</code> calls. I could simply wrap the first to handle pointers seamlessly, but it is not easy to wrap second."}], "answers": [{"comments": [{"owner": {"reputation": 615, "user_id": 6173694, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-FWVTscLbv7w/AAAAAAAAAAI/AAAAAAAAADY/skh9BkqfV0I/photo.jpg?sz=128", "display_name": "olq_plo", "link": "https://stackoverflow.com/users/6173694/olq-plo"}, "edited": false, "score": 3, "creation_date": 1547674205, "post_id": 54220508, "comment_id": 95277234, "body": "The explanation makes sense, thank you. As a naive user, though, I expect my variant to behave exactly like the type it currently holds. I cannot rebind references, so I wouldn&#39;t expect variant to rebind upon assignment."}, {"owner": {"reputation": 615, "user_id": 6173694, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-FWVTscLbv7w/AAAAAAAAAAI/AAAAAAAAADY/skh9BkqfV0I/photo.jpg?sz=128", "display_name": "olq_plo", "link": "https://stackoverflow.com/users/6173694/olq-plo"}, "edited": false, "score": 2, "creation_date": 1547674677, "post_id": 54220508, "comment_id": 95277427, "body": "&quot;rebind is a more sound implementation and is what you really want&quot; I guess you mean &quot;you&quot; in the general sense and not me personally, because I don&#39;t want it to rebind."}, {"owner": {"reputation": 245138, "user_id": 2069064, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/e4V2X.jpg?s=128&g=1", "display_name": "Barry", "link": "https://stackoverflow.com/users/2069064/barry"}, "reply_to_user": {"reputation": 615, "user_id": 6173694, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-FWVTscLbv7w/AAAAAAAAAAI/AAAAAAAAADY/skh9BkqfV0I/photo.jpg?sz=128", "display_name": "olq_plo", "link": "https://stackoverflow.com/users/6173694/olq-plo"}, "edited": false, "score": 1, "creation_date": 1547735080, "post_id": 54220508, "comment_id": 95300519, "body": "@olq_plo I agree that the naive expectation is that <code>optional&lt;T&amp;&gt;</code> does assign-through. But that is a bad choice for that type. Note that <code>boost::optional&lt;T&amp;&gt;</code> <a href=\"https://www.boost.org/doc/libs/1_69_0/libs/optional/doc/html/boost_optional/rebinding_semantics_for_assignment_of_optional_references.html\" rel=\"nofollow noreferrer\">rebinds</a> ."}, {"owner": {"reputation": 5668, "user_id": 4083309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6b4ef5a2e912153069b82607789a717?s=128&d=identicon&r=PG&f=1", "display_name": "Arne Vogel", "link": "https://stackoverflow.com/users/4083309/arne-vogel"}, "edited": false, "score": 0, "creation_date": 1547754510, "post_id": 54220508, "comment_id": 95310884, "body": "Host Jason Turner and Guest Jonathan M&#252;ller discuss this issue a bit starting at around 18:54 in <a href=\"https://cppcast.com/2018/02/jonathan-muller/\" rel=\"nofollow noreferrer\">episode 136 of CppCast</a>."}, {"owner": {"reputation": 615, "user_id": 6173694, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-FWVTscLbv7w/AAAAAAAAAAI/AAAAAAAAADY/skh9BkqfV0I/photo.jpg?sz=128", "display_name": "olq_plo", "link": "https://stackoverflow.com/users/6173694/olq-plo"}, "edited": false, "score": 1, "creation_date": 1547768876, "post_id": 54220508, "comment_id": 95316356, "body": "It is a reasonable choice for variant, though, so I perhaps optional and variant shouldn&#39;t be forced to act alike."}, {"owner": {"reputation": 245138, "user_id": 2069064, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/e4V2X.jpg?s=128&g=1", "display_name": "Barry", "link": "https://stackoverflow.com/users/2069064/barry"}, "reply_to_user": {"reputation": 615, "user_id": 6173694, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-FWVTscLbv7w/AAAAAAAAAAI/AAAAAAAAADY/skh9BkqfV0I/photo.jpg?sz=128", "display_name": "olq_plo", "link": "https://stackoverflow.com/users/6173694/olq-plo"}, "edited": false, "score": 1, "creation_date": 1547826470, "post_id": 54220508, "comment_id": 95338663, "body": "@olq_plo I disagree both that (a) it&#39;s a reasonable choice for variant and (b) that optional and variant are meaningfully different. If <code>optional&lt;T&gt;</code> had different semantics from <code>variant&lt;nullopt, T&gt;</code>, that would be very confusing"}], "tags": [], "owner": {"reputation": 245138, "user_id": 2069064, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/e4V2X.jpg?s=128&g=1", "display_name": "Barry", "link": "https://stackoverflow.com/users/2069064/barry"}, "is_accepted": true, "score": 19, "last_activity_date": 1547735292, "last_edit_date": 1547735292, "creation_date": 1547653140, "answer_id": 54220508, "question_id": 54218595, "link": "https://stackoverflow.com/questions/54218595/why-are-references-forbidden-in-stdvariant/54220508#54220508", "title": "Why are references forbidden in std::variant?", "body": "<p>Fundamentally, the reason that <code>optional</code> and <code>variant</code> don't allow reference types is that there's disagreement on what assignment (and, to a lesser extent, comparison) should do for such cases. <code>optional</code> is easier than <code>variant</code> to show in examples, so I'll stick with that:</p>\n\n<pre><code>int i = 4, j = 5;\nstd::optional&lt;int&amp;&gt; o = i;\no = j; // (*)\n</code></pre>\n\n<p>The marked line can be interpreted to either:</p>\n\n<ol>\n<li>Rebind <code>o</code>, such that <code>&amp;*o == &amp;j</code>. As a result of this line, the values of <code>i</code> and <code>j</code> themselves remain changed.</li>\n<li>Assign through <code>o</code>, such <code>&amp;*o == &amp;i</code> is still true but now <code>i == 5</code>.</li>\n<li>Disallow assignment entirely.</li>\n</ol>\n\n<p>Assign-through is the behavior you get by just pushing <code>=</code> through to <code>T</code>'s <code>=</code>, rebind is a more sound implementation and is what you really want (see also <a href=\"https://stackoverflow.com/a/39985029/2069064\">this question</a>, as well as a Matt Calabrese talk on <a href=\"https://www.youtube.com/watch?v=hKIYbf1fsLw\" rel=\"noreferrer\">Reference Types</a>).  </p>\n\n<p>A different way of explaining the difference between (1) and (2) is how we might implement both externally:</p>\n\n<pre><code>// rebind\no.emplace(j);\n\n// assign through\nif (o) {\n    *o = j;\n} else {\n    o.emplace(j);\n}\n</code></pre>\n\n<p>The <a href=\"https://www.boost.org/doc/libs/1_69_0/libs/optional/doc/html/boost_optional/rebinding_semantics_for_assignment_of_optional_references.html\" rel=\"noreferrer\">Boost.Optional</a> documentation provides this rationale:</p>\n\n<blockquote>\n  <p>Rebinding semantics for the assignment of <em>initialized</em> optional references has been chosen to provide <strong>consistency among initialization states</strong> even at the expense of lack of consistency with the semantics of bare C++ references. It is true that <code>optional&lt;U&gt;</code> strives to behave as much as possible as U does whenever it is initialized; but in the case when <code>U</code> is <code>T&amp;</code>, doing so would result in inconsistent behavior w.r.t to the lvalue initialization state.</p>\n  \n  <p>Imagine <code>optional&lt;T&amp;&gt;</code> forwarding assignment to the referenced object (thus changing the referenced object value but not rebinding), and consider the following code:</p>\n\n<pre><code>optional&lt;int&amp;&gt; a = get();\nint x = 1 ;\nint&amp; rx = x ;\noptional&lt;int&amp;&gt; b(rx);\na = b ;\n</code></pre>\n  \n  <p>What does the assignment do?</p>\n  \n  <p>If <code>a</code> is <em>uninitialized</em>, the answer is clear: it binds to <code>x</code> (we now have another reference to <code>x</code>). But what if a is already <em>initialized</em>? it would change the value of the referenced object (whatever that is); which is inconsistent with the other possible case.</p>\n  \n  <p>If <code>optional&lt;T&amp;&gt;</code> would assign just like <code>T&amp;</code> does, you would never be able to use Optional's assignment without explicitly handling the previous initialization state unless your code is capable of functioning whether after the assignment, <code>a</code> aliases the same object as <code>b</code> or not.</p>\n  \n  <p>That is, you would have to discriminate in order to be consistent.</p>\n  \n  <p>If in your code rebinding to another object is not an option, then it is very likely that binding for the first time isn't either. In such case, assignment to an <em>uninitialized</em> <code>optional&lt;T&amp;&gt;</code> shall be prohibited. It is quite possible that in such a scenario it is a precondition that the lvalue must be already initialized. If it isn't, then binding for the first time is OK while rebinding is not which is IMO very unlikely. In such a scenario, you can assign the value itself directly, as in:</p>\n\n<pre><code>assert(!!opt);\n*opt=value;\n</code></pre>\n</blockquote>\n\n<hr />\n\n<p>Lack of agreement on what that line should do meant it was easier to just disallow references entirely, so that most of the value of <code>optional</code> and <code>variant</code> can at least make it for C++17 and start being useful. References could always be added later - or so the argument went. </p>\n"}], "owner": {"reputation": 615, "user_id": 6173694, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-FWVTscLbv7w/AAAAAAAAAAI/AAAAAAAAADY/skh9BkqfV0I/photo.jpg?sz=128", "display_name": "olq_plo", "link": "https://stackoverflow.com/users/6173694/olq-plo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3080, "favorite_count": 3, "accepted_answer_id": 54220508, "answer_count": 1, "score": 19, "last_activity_date": 1547735292, "creation_date": 1547646798, "last_edit_date": 1547647078, "question_id": 54218595, "link": "https://stackoverflow.com/questions/54218595/why-are-references-forbidden-in-stdvariant", "title": "Why are references forbidden in std::variant?", "body": "<p>I use <code>boost::variant</code> a lot and am quite familiar with it. <code>boost::variant</code> does not restrict the bounded types in any way, in particular, they may be references:</p>\n\n<pre><code>#include &lt;boost/variant.hpp&gt;\n#include &lt;cassert&gt;\nint main() {\n  int x = 3;\n  boost::variant&lt;int&amp;, char&amp;&gt; v(x); // v can hold references\n  boost::get&lt;int&gt;(v) = 4; // manipulate x through v\n  assert(x == 4);\n}\n</code></pre>\n\n<p>I have a real use-case for using a variant of references as a view of some other data.</p>\n\n<p>I was then surprised to find, that <code>std::variant</code> does not allow references as bounded types, <code>std::variant&lt;int&amp;, char&amp;&gt;</code> does not compile and it says <a href=\"https://en.cppreference.com/w/cpp/utility/variant\" rel=\"noreferrer\">here</a> explicitly:</p>\n\n<p><em>A variant is not permitted to hold references, arrays, or the type void.</em></p>\n\n<p>I wonder why this is not allowed, I don't see a technical reason. I know that the implementations of <code>std::variant</code> and <code>boost::variant</code> are different, so maybe it has to do with that? Or did the authors think it is unsafe?</p>\n\n<p>PS: I cannot really work around the limitation of <code>std::variant</code> using <code>std::reference_wrapper</code>, because the reference wrapper does not allow assignment from the base type.</p>\n\n<pre><code>#include &lt;variant&gt;\n#include &lt;cassert&gt;\n#include &lt;functional&gt;\n\nint main() {\n  using int_ref = std::reference_wrapper&lt;int&gt;;\n  int x = 3;\n  std::variant&lt;int_ref&gt; v(std::ref(x)); // v can hold references\n  static_cast&lt;int&amp;&gt;(std::get&lt;int_ref&gt;(v)) = 4; // manipulate x through v, extra cast needed\n  assert(x == 4);\n}\n</code></pre>\n"}, {"tags": ["c++", "visual-c++", "dumpbin"], "comments": [{"owner": {"reputation": 870071, "user_id": 17034, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cii6b.png?s=128&g=1", "display_name": "Hans Passant", "link": "https://stackoverflow.com/users/17034/hans-passant"}, "edited": false, "score": 1, "creation_date": 1547649486, "post_id": 54218337, "comment_id": 95264458, "body": "You misinterpret what you see.  The raw bytes show linker directives that were injected with #pragma comment.  The intention of the /FAILIFMISMATCH linker option is to generate a diagnostic when you try to link a .lib file that was created by a different version of the compiler.  Important, linking libraries that were built with old #include files can cause very hard to diagnose runtime errors, especially so for the standard C++ library template classes.  Those tests are based on the major toolset version, expectation is that minor version increases are not breaking."}], "owner": {"reputation": 73, "user_id": 9795200, "user_type": "registered", "profile_image": "https://graph.facebook.com/10156465211276869/picture?type=large", "display_name": "Nele", "link": "https://stackoverflow.com/users/9795200/nele"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 227, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1547646020, "creation_date": 1547646020, "question_id": 54218337, "link": "https://stackoverflow.com/questions/54218337/dumpbin-and-msc-ver", "title": "Dumpbin and _MSC_VER", "body": "<p>I am developing C++ in Visual Studio 2017, version 15.7, VCToolsVersion 14.14.26428.</p>\n\n<p>I noticed that when I run <code>dumpbin</code> on a static library, I get a different version for _MSC_VER than expected.</p>\n\n<p>To illustrate my problem, I created a static library testDumpbin.lib containing a simple class, testClass:</p>\n\n<p>testClass.h: </p>\n\n<pre><code>#pragma once\n\nclass testClass\n{\npublic:\n    testClass();\n\nprivate:\n    int n;\n};\n</code></pre>\n\n<p>testClass.cpp:</p>\n\n<pre><code>#include \"testClass.h\"\n#include &lt;string&gt;\n\n#define STRING2(x) #x\n#define STRING(x) STRING2(x)\n#pragma message(\"\")\n#pragma message( \"_MSC_VER (compiler verion) \" STRING(_MSC_VER))\n#pragma message(\"\")\n\ntestClass::testClass()\n{\n    n = 3;\n}\n</code></pre>\n\n<p>I added some preprocessor lines that print the _MSC_VER macro. </p>\n\n<p>When I compile this code in debug mode (turned off Precompiled headers in properties \u2013 C/C++), I get: </p>\n\n<pre><code>1&gt;_MSC_VER (compiler verion) 1914\n</code></pre>\n\n<p>Which is what I expected since I am running toolset 14.14 (see also <a href=\"https://en.wikipedia.org/wiki/Microsoft_Visual_C%2B%2B\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Microsoft_Visual_C%2B%2B</a>)</p>\n\n<p>I then went on to use <code>dumpbin</code> (can be ran from the VS Developer Command Prompt which you can launch from C:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Enterprise\\Common7\\Tools\\LaunchDevCmd.bat ):</p>\n\n<pre><code>dumpbin testDumpbinLib.lib /rawdata:1 &gt; dumpbin.log\n</code></pre>\n\n<p>And in there I find that _MSC_VER = 1900:</p>\n\n<pre><code>  00000000: 20 20 20 2F 46 41 49 4C 49 46 4D 49 53 4D 41 54     /FAILIFMISMAT\n  00000010: 43 48 3A 22 5F 4D 53 43 5F 56 45 52 3D 31 39 30  CH:\"_MSC_VER=190\n  00000020: 30 22 20 2F 46 41 49 4C 49 46 4D 49 53 4D 41 54  0\" /FAILIFMISMAT\n  00000030: 43 48 3A 22 5F 49 54 45 52 41 54 4F 52 5F 44 45  CH:\"_ITERATOR_DE\n  00000040: 42 55 47 5F 4C 45 56 45 4C 3D 32 22 20 2F 46 41  BUG_LEVEL=2\" /FA\n</code></pre>\n\n<p>Why isn't it _MSC_VER = 1914 in the <code>dumpbin</code> output? </p>\n\n<p>Thanks a lot for your help!</p>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 2, "creation_date": 1547646204, "post_id": 54218331, "comment_id": 95262302, "body": "You need an <code>A</code> to call <code>A::*fn</code>. Which <code>A</code> object should it be called on? <code>a</code>?"}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1547646725, "post_id": 54218331, "comment_id": 95262635, "body": "Perhaps they were looking for the answer  &quot;given that code, you can&#39;t&quot; so they could continue with &quot;why not, and what changes would you suggest?&quot;"}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "reply_to_user": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1547648348, "post_id": 54218331, "comment_id": 95263669, "body": "@molbdnilo Personally I&#39;d offer up both parts of that answer in one go. Just saying &quot;you can&#39;t&quot; isn&#39;t an impressive interview answer! :)"}], "answers": [{"comments": [{"owner": {"reputation": 5673, "user_id": 2376156, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/2s2R4.jpg?s=128&g=1", "display_name": "edtheprogrammerguy", "link": "https://stackoverflow.com/users/2376156/edtheprogrammerguy"}, "edited": false, "score": 0, "creation_date": 1547646739, "post_id": 54218442, "comment_id": 95262645, "body": "So, in this example, why bother to pass <code>&amp;A::fn2</code> at all?  Why not just call <code>ptr-&gt;fn2();</code>?"}, {"owner": {"reputation": 331, "user_id": 1434287, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/febc28ddca96272600049a2b40331128?s=128&d=identicon&r=PG", "display_name": "user1434287", "link": "https://stackoverflow.com/users/1434287/user1434287"}, "edited": false, "score": 0, "creation_date": 1547647303, "post_id": 54218442, "comment_id": 95263012, "body": "in that case I am getting error; error: invalid use of incomplete type \u2018class A\u2019         ptr-&gt;fn2(); If I declare B after A; still I get incomplete type B"}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "reply_to_user": {"reputation": 5673, "user_id": 2376156, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/2s2R4.jpg?s=128&g=1", "display_name": "edtheprogrammerguy", "link": "https://stackoverflow.com/users/2376156/edtheprogrammerguy"}, "edited": false, "score": 1, "creation_date": 1547648277, "post_id": 54218442, "comment_id": 95263616, "body": "@edtheprogrammerguy Presumably it&#39;s a minimal working example. Of course in this contrived example you could just invoke it directly."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "reply_to_user": {"reputation": 331, "user_id": 1434287, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/febc28ddca96272600049a2b40331128?s=128&d=identicon&r=PG", "display_name": "user1434287", "link": "https://stackoverflow.com/users/1434287/user1434287"}, "edited": false, "score": 0, "creation_date": 1547648300, "post_id": 54218442, "comment_id": 95263636, "body": "@user1434287 To your original code, I only made the changes described, and I provided a live demo showing that it works. You must have changed something?"}], "tags": [], "owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "is_accepted": true, "score": 6, "last_activity_date": 1547646412, "creation_date": 1547646412, "answer_id": 54218442, "question_id": 54218331, "link": "https://stackoverflow.com/questions/54218331/how-to-call-function-to-pointer-of-a-class/54218442#54218442", "title": "how to call function to pointer of a class?", "body": "<p>Pointers-to-member-functions need an object to call the function on.</p>\n\n<p>The quickest change to your code is to simply pass in a pointer to the object you want to use. I assume that's the <code>A</code> that you called <code>fn3</code> on.</p>\n\n<p>So:</p>\n\n<pre><code>void fn1(void (A::*fn)(), A* ptr)\n{\n   (ptr-&gt;*fn)();   // Yeah, the syntax is kind of weird\n}\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>void fn3()\n{\n    b-&gt;fn1(&amp;A::fn2, this);\n}\n</code></pre>\n\n<h3>(<a href=\"http://coliru.stacked-crooked.com/a/02d722af9bf6cb96\" rel=\"noreferrer\">live demo</a>)</h3>\n\n<p>In an interview I'd give this solution, then discuss how in modern C++ we'd prefer to have <code>fn1</code> take a <code>std::function</code> (or a template callable), and bind the argument using <code>std::bind</code> or pass a lambda.</p>\n"}], "owner": {"reputation": 331, "user_id": 1434287, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/febc28ddca96272600049a2b40331128?s=128&d=identicon&r=PG", "display_name": "user1434287", "link": "https://stackoverflow.com/users/1434287/user1434287"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 54218442, "answer_count": 1, "score": 2, "last_activity_date": 1547646441, "creation_date": 1547646001, "last_edit_date": 1547646441, "question_id": 54218331, "link": "https://stackoverflow.com/questions/54218331/how-to-call-function-to-pointer-of-a-class", "title": "how to call function to pointer of a class?", "body": "<pre><code>class A;\nclass B;\n\nclass B\n{\npublic:\n    void fn1(void (A::*fn)() )\n    {\n\n       //(*A::fn) ();how to call fn()?\n    }\n};\n\n\nclass A\n{\n    B *b;\npublic:\n    A():b(new B){}\n    void fn2()\n    {\n        cout&lt;&lt;\"fn2\"&lt;&lt;endl;\n    }\n    void fn3()\n    {\n        b-&gt;fn1(&amp;A::fn2);\n    }\n\n};\n\n\nint main()\n{\n    A a;\n    a.fn3();\n}\n</code></pre>\n\n<p>I was asked this question in an interview: how to call fn2() from fn1(). That is what I am trying to solve. Can someone help me with that?\nMy main objective is to call fn2() from fn1(); if any other way is possible, please mention that</p>\n"}, {"tags": ["c++", "qt", "qml"], "comments": [{"owner": {"reputation": 22670, "user_id": 955273, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/79903a88026b021e89735578bb71fd22?s=128&d=identicon&r=PG", "display_name": "Steve Lorimer", "link": "https://stackoverflow.com/users/955273/steve-lorimer"}, "edited": false, "score": 0, "creation_date": 1547655311, "post_id": 54218261, "comment_id": 95267995, "body": "what is <code>in</code>? Is that the name of your <code>QVariant</code> parameter in <code>connectToEmulatorService</code>?"}, {"owner": {"reputation": 1448, "user_id": 2769062, "user_type": "registered", "accept_rate": 18, "profile_image": "https://i.stack.imgur.com/KLVcR.png?s=128&g=1", "display_name": "Dmitry", "link": "https://stackoverflow.com/users/2769062/dmitry"}, "reply_to_user": {"reputation": 22670, "user_id": 955273, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/79903a88026b021e89735578bb71fd22?s=128&d=identicon&r=PG", "display_name": "Steve Lorimer", "link": "https://stackoverflow.com/users/955273/steve-lorimer"}, "edited": false, "score": 0, "creation_date": 1547656343, "post_id": 54218261, "comment_id": 95268621, "body": "yes, sorry for confusing. Just edited my message"}], "answers": [{"tags": [], "owner": {"reputation": 1448, "user_id": 2769062, "user_type": "registered", "accept_rate": 18, "profile_image": "https://i.stack.imgur.com/KLVcR.png?s=128&g=1", "display_name": "Dmitry", "link": "https://stackoverflow.com/users/2769062/dmitry"}, "is_accepted": false, "score": 0, "last_activity_date": 1548162683, "creation_date": 1548162683, "answer_id": 54309069, "question_id": 54218261, "link": "https://stackoverflow.com/questions/54218261/qt-5-12-sporadic-sigsegv-when-calling-c-from-qml/54309069#54309069", "title": "Qt 5.12 sporadic SIGSEGV when calling C++ from Qml", "body": "<p>Here is an official response from the Qt-JIRA :</p>\n\n<p>\"You're accessing your m_connectionParams from two different threads without locking. The main thread writes it in connectToEmulatorService() and the worker thread reads it in connectToEmulatorServiceImpl(). If the main thread writes again while the worker thread is just reading the previous iteration, you get a crash. That's the most glaringly obvious problem.</p>\n\n<p>However, even if you did lock a mutex for access to m_connectionParams, this would still not be safe. The variant you have there is internally a QJSValue. In order to convert that to a map, we have to call deep into the JavaScript engine, construct scopes, and interact with the JavaScript heap. If any other JavaScript is running at the same time in a different thread, you're in trouble.</p>\n\n<p>Just extract the QVariantMap in the main thread and pass that to your functor as parameter.\"</p>\n\n<p>So, having a copy of QVariant is not enough...it's somewhere deep inside Qt sources.</p>\n"}], "owner": {"reputation": 1448, "user_id": 2769062, "user_type": "registered", "accept_rate": 18, "profile_image": "https://i.stack.imgur.com/KLVcR.png?s=128&g=1", "display_name": "Dmitry", "link": "https://stackoverflow.com/users/2769062/dmitry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 246, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1548162683, "creation_date": 1547645752, "last_edit_date": 1547656311, "question_id": 54218261, "link": "https://stackoverflow.com/questions/54218261/qt-5-12-sporadic-sigsegv-when-calling-c-from-qml", "title": "Qt 5.12 sporadic SIGSEGV when calling C++ from Qml", "body": "<p>There is a Qml Button with 2 states( connect/disconnect ) inside my App. Here is the respective code :</p>\n\n<pre><code>        Button {\n           id : connectDisconnectButton\n           anchors.centerIn: parent\n           property bool isConnected : false\n           text : isConnected ? qsTr(\"Disconnect\") : qsTr(\"Connect\")\n           antialiasing: true\n\n           property var currentConnectionParams : ({})\n\n           onClicked: {\n              if ( isConnected ) {\n                 proxy.disconnectFromEmulatorService();\n              } else {\n                 connectDisconnectButton.currentConnectionParams[\"port\"] = serviceConnectionPort.getValue();\n                 connectDisconnectButton.currentConnectionParams[\"ip_addr\"] = String(serviceConnectionIpPart_0.getValue())\n                       + String(\".\") + String(serviceConnectionIpPart_1.getValue())\n                 + String(\".\") + String(serviceConnectionIpPart_2.getValue())\n                 + String(\".\") + String(serviceConnectionIpPart_3.getValue());\n\n                 proxy.connectToEmulatorService( connectDisconnectButton.currentConnectionParams );\n              }\n\n              isConnected = !isConnected;\n           }\n        }\n</code></pre>\n\n<p>What I see is that from time to time I get SIGSEGV while calling connectToEmulatorService method of my C++ proxy. Here is the respective c++ code :</p>\n\n<pre><code>Q_INVOKABLE void connectToEmulatorService( QVariant in )\n{\n   m_serviceConnectionParams = in;\n   emit connectionInitiatedSignal();\n   m_functorExecutor-&gt;executeFunctor( boost::bind(&amp;EmulatorControlProxy::connectToEmulatorServiceImpl, this ) );\n}\n\nvoid connectToEmulatorServiceImpl()\n{\n   QMap&lt;QString, QVariant&gt; connectionParams_ = m_serviceConnectionParams.toMap();\n   try {\n      emit connectionOkSignal();\n   }catch(...) {\n      Error(\"connectToEmulatorServiceImpl failure : ip = %s, port = %s\",\n            connectionParams_[\"ip_addr\"].toString().toStdString().c_str(),\n            connectionParams_[\"port\"].toString().toStdString().c_str() );\n      emit connectionFailedSignal();\n   }\n}\n</code></pre>\n\n<p>GDB backtrace gives the following output :</p>\n\n<pre><code>(gdb) backtrace\n#0  0x00007ffff6e0777b in QV4::QObjectWrapper::virtualGet(QV4::Managed const*, QV4::PropertyKey, QV4::Value const*, bool*) ()\n    at /home/developer/Qt5.12.0/5.12.0/gcc_64/lib/libQt5Qml.so.5\n#1  0x00007ffff6e8802b in QV4::Runtime::method_loadProperty(QV4::ExecutionEngine*, QV4::Value const&amp;, int) () at /home/developer/Qt5.12.0/5.12.0/gcc_64/lib/libQt5Qml.so.5\n#2  0x00007fffe0003d9a in  ()\n#3  0x0000000000000000 in  ()\n</code></pre>\n\n<p>What could be the reason for this? How to overcome this ? \nQt 5.12 Ubuntu 18.10 g++ 7.3</p>\n\n<p>PS. The problem is somehow related to </p>\n\n<pre><code>QMap&lt;QString, QVariant&gt; connectionParams_ = m_serviceConnectionParams.toMap();\n</code></pre>\n\n<p>It seems that temporary QML object map is being deleted before functorExecutor thread tries to access it. But why does it happen, if I copy incoming QVariant to a class member variable? As a workaround I declared a bunch of Q_PROPERTY for my proxy to store QML data there before invoke C++. And that seems to work. But I believe there is an issue somewhere in Qt. Any help is appreciated.</p>\n"}, {"tags": ["c++", "visual-studio", "asynchronous", "uwp", "windows-10"], "comments": [{"owner": {"reputation": 7891, "user_id": 6782612, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KuUfK.jpg?s=128&g=1", "display_name": "Xie Steven", "link": "https://stackoverflow.com/users/6782612/xie-steven"}, "edited": false, "score": 0, "creation_date": 1547789917, "post_id": 54218213, "comment_id": 95320685, "body": "I&#39;ve reported it, the relevant team was investigating it."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 10922565, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-yTWf0B19Yc8/AAAAAAAAAAI/AAAAAAAAAOI/MHwPnvM7zoQ/photo.jpg?sz=128", "display_name": "Varun Bhal", "link": "https://stackoverflow.com/users/10922565/varun-bhal"}, "edited": false, "score": 0, "creation_date": 1549474019, "post_id": 54538722, "comment_id": 95918062, "body": "Yes, i got this working by adding arbitrary task continuation context but forgot to put the solution over here. Thanks for helping me out. It works!!"}, {"owner": {"reputation": 1, "user_id": 5140233, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-7S2yIrMUV2Y/AAAAAAAAAAI/AAAAAAAAATc/rT7o6HIhZmE/photo.jpg?sz=128", "display_name": "Tyler Roesler", "link": "https://stackoverflow.com/users/5140233/tyler-roesler"}, "reply_to_user": {"reputation": 1, "user_id": 10922565, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-yTWf0B19Yc8/AAAAAAAAAAI/AAAAAAAAAOI/MHwPnvM7zoQ/photo.jpg?sz=128", "display_name": "Varun Bhal", "link": "https://stackoverflow.com/users/10922565/varun-bhal"}, "edited": false, "score": 0, "creation_date": 1549480056, "post_id": 54538722, "comment_id": 95920854, "body": "Glad it works! Since this is the solution, could you go ahead and mark it?"}], "tags": [], "owner": {"reputation": 1, "user_id": 5140233, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-7S2yIrMUV2Y/AAAAAAAAAAI/AAAAAAAAATc/rT7o6HIhZmE/photo.jpg?sz=128", "display_name": "Tyler Roesler", "link": "https://stackoverflow.com/users/5140233/tyler-roesler"}, "is_accepted": false, "score": 0, "last_activity_date": 1549394066, "last_edit_date": 1549394066, "creation_date": 1549383657, "answer_id": 54538722, "question_id": 54218213, "link": "https://stackoverflow.com/questions/54218213/in-uwp-application-future-wait-keep-waiting-while-trying-to-synchronize-the-r/54538722#54538722", "title": "In UWP application, future.wait() keep waiting while trying to synchronize the response from async methods", "body": "<p>I was able to take the above code and create a simple application that reproduced this issue. Long story short, I was able to get <code>future.wait()</code> to return by telling the continuation in <code>asyncTaskExceptionHandler</code> to run on a background thread:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>template &lt;typename T, typename CallbackLambda&gt;\nvoid asyncTaskExceptionHandler(concurrency::task&lt;T&gt; mainTask, CallbackLambda&amp;&amp; onResult) {\n    // debug\n    printString(mainTask.is_apartment_aware().ToString());\n\n    auto t1 = mainTask.then([onResult = std::move(onResult)](concurrency::task&lt;T&gt; t) {\n        bool didFail = true;\n        T result;\n        try {\n            result = t.get();\n            didFail = false;\n        }\n        catch (concurrency::task_canceled&amp;) {\n            OutputDebugStringA(\"Win10 call was canceled.\");\n        }\n        catch (Platform::Exception^ e) {\n            OutputDebugStringA(\"Error during a Win10 call:\");\n        }\n        catch (std::exception&amp;) {\n            OutputDebugStringA(\"There was a C++ exception during a Win10 call.\");\n        }\n        catch (...) {\n            OutputDebugStringA(\"There was a generic exception during a Win10 call.\");\n        }\n\n    // It works with this\n    }, concurrency::task_continuation_context::use_arbitrary());\n}\n</code></pre>\n\n<p>Assuming the code I used was correct, what I believe to be happening is that we created a deadlock. What we are saying with the above code is:</p>\n\n<ol>\n<li>On the UI/STA thread, create/handle an async operation from <code>GetFolderFromPathAsync</code></li>\n<li>Pass this task off to our <code>syncAsyncTask</code>, which in turn passes this off to <code>asyncTaskExceptionHandler</code>.\n\n<ul>\n<li><code>asyncTaskExceptionHandler</code> adds a continuation to this task which schedules it to run. By default, tasks run on the thread that called them. In this case, it is the UI/STA thread!</li>\n</ul></li>\n<li>Once the thread is scheduled, we return back to <code>syncAsyncTask</code> to finish. After our call to <code>asyncTaskExceptionHandler</code> we have a <code>future.wait()</code> which <em>blocks until the promise value is set</em>.\n\n<ul>\n<li>This prevents our UI thread from finished execution of the <code>syncAsyncTask</code>, but <em>also</em> prevents our continuation from running since it is scheduled to run on the same thread that is blocking!</li>\n</ul></li>\n</ol>\n\n<p>In other words, we are waiting on the UI thread for an operation to complete that cannot begin until the UI thread is finished, thus causing our deadlock.</p>\n\n<p>By using <code>concurrency::task_continuation_context::use_arbitrary()</code> we tell the task that it's okay to use a background thread if necessary (which in this case it is) and everything completes as intended.</p>\n\n<p>For documentation on this, as well as some example code illustrating async behavior, see the <a href=\"https://docs.microsoft.com/en-us/cpp/parallel/concrt/creating-asynchronous-operations-in-cpp-for-windows-store-apps?view=vs-2017\" rel=\"nofollow noreferrer\">Creating Asynchronous Operations in C++ for UWP Apps documentation</a>.</p>\n"}], "owner": {"reputation": 1, "user_id": 10922565, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-yTWf0B19Yc8/AAAAAAAAAAI/AAAAAAAAAOI/MHwPnvM7zoQ/photo.jpg?sz=128", "display_name": "Varun Bhal", "link": "https://stackoverflow.com/users/10922565/varun-bhal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 120, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1549394066, "creation_date": 1547645604, "question_id": 54218213, "link": "https://stackoverflow.com/questions/54218213/in-uwp-application-future-wait-keep-waiting-while-trying-to-synchronize-the-r", "title": "In UWP application, future.wait() keep waiting while trying to synchronize the response from async methods", "body": "<p>I am working on developing an UWP application which would load the file from Application local data on click of a <code>Button</code>. For this, I need the <code>StorageFolder</code> object for Application LocalFolder using <code>StorageFolder::GetFolderFromPathAsync()</code> method then i will have to use <code>GetFileAsync()</code> method to read the <code>StorageFile</code> object to read. </p>\n\n<p>I have written the templates to wait for the response from async methods like <code>GetFolderFromPathAsync(), GetFileAsync(),</code> etc. before proceeding. </p>\n\n<pre><code>template &lt;typename T&gt;\nT syncAsyncTask(concurrency::task&lt;T&gt; mainTask) {\n    std::shared_ptr&lt;std::promise&lt;T&gt;&gt; done = std::make_shared&lt;std::promise&lt;T&gt;&gt;();\n    auto future = done-&gt;get_future();\n\n    asyncTaskExceptionHandler&lt;T&gt;(mainTask, [&amp;done](bool didFail, T result) {\n        done-&gt;set_value(didFail ? nullptr : result);\n    });\n    future.wait();\n    return future.get();\n}\n\n\ntemplate &lt;typename T, typename CallbackLambda&gt;\nvoid asyncTaskExceptionHandler(concurrency::task&lt;T&gt; mainTask, CallbackLambda&amp;&amp; onResult) {\n    auto t1 = mainTask.then([onResult = std::move(onResult)](concurrency::task&lt;T&gt; t) {\n        bool didFail = true;\n        T result;\n        try {\n            result = t.get();\n            didFail = false;\n        }\n        catch (concurrency::task_canceled&amp;) {\n            OutputDebugStringA(\"Win10 call was canceled.\");\n        }\n        catch (Platform::Exception^ e) {\n            OutputDebugStringA(\"Error during a Win10 call:\");\n        }\n        catch (std::exception&amp;) {\n            OutputDebugStringA(\"There was a C++ exception during a Win10 call.\");\n        }\n        catch (...) {\n            OutputDebugStringA(\"There was a generic exception during a Win10 call.\");\n        }\n        onResult(didFail, result);\n    });\n\n}\n</code></pre>\n\n<p><strong>Issue :</strong> </p>\n\n<blockquote>\n  <p>When i call <code>syncAsyncTask()</code> method with any task to get\n  its response, it keeps waiting at <code>future.wait()</code> as <code>mainTask</code> never\n  complete and <code>promise</code> never set its value. </p>\n  \n  <p>See below code :</p>\n</blockquote>\n\n<pre><code>void testStorage::MainPage::Btn_Click(Platform::Object^ sender, Windows::UI::Xaml::RoutedEventArgs^ e)\n{\n    Windows::Storage::StorageFolder^ localFolder = Windows::Storage::ApplicationData::Current-&gt;LocalFolder;\n    auto task = concurrency::create_task(Windows::Storage::StorageFolder::GetFolderFromPathAsync(localFolder-&gt;Path));\n    auto folder = syncAsyncTask&lt;Windows::Storage::StorageFolder^&gt;(task);\n    printString(folder-&gt;Path);\n}\n\nvoid printString(Platform::String^ text) {\n    std::wstring fooW(text-&gt;Begin());\n    std::string fooA(fooW.begin(), fooW.end());\n    const char* charStr = fooA.c_str();\n    OutputDebugStringA(charStr);\n}\n</code></pre>\n\n<blockquote>\n  <p><strong>Running environment :</strong></p>\n  \n  <ol>\n  <li><p>VS2017</p></li>\n  <li><p>Tried with C++14 and C++17, facing same issue.</p></li>\n  <li>Windows 10 RS5 Build#17763</li>\n  </ol>\n</blockquote>\n\n<p>Has anyone ever faced this issue? </p>\n\n<p>Please help!! Thanks in advance.</p>\n"}, {"tags": ["c++", "visual-studio-2010"], "comments": [{"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 1, "creation_date": 1547645111, "post_id": 54217950, "comment_id": 95261636, "body": "You can&#39;t do that. I think the only way to accomplish it is to add configuration-specific preprocessor definitions. (Or possibly by tweaking the vcxproj file, but that&#39;s opening a truckful of worm cans.)"}], "answers": [{"tags": [], "owner": {"reputation": 127, "user_id": 5159404, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a0bffa1bbeb067f7b298d4ceb44a485a?s=128&d=identicon&r=PG&f=1", "display_name": "Wing", "link": "https://stackoverflow.com/users/5159404/wing"}, "is_accepted": true, "score": 0, "last_activity_date": 1547645476, "creation_date": 1547645476, "answer_id": 54218171, "question_id": 54217950, "link": "https://stackoverflow.com/questions/54217950/how-to-use-visual-studio-macros-at-compile-time-in-a-c-project/54218171#54218171", "title": "How to use Visual Studio Macros at compile time in a c++ project", "body": "<p>Turns out it cannot be done as I wanted but through an indirect step:</p>\n\n<p>In project Properties-> configuration Properties -> C/C++ -> Preprocessor I can simply define a preprocessor variable for each configuration and then use that preprocessor variable as I wanted.</p>\n"}], "owner": {"reputation": 127, "user_id": 5159404, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a0bffa1bbeb067f7b298d4ceb44a485a?s=128&d=identicon&r=PG&f=1", "display_name": "Wing", "link": "https://stackoverflow.com/users/5159404/wing"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "accepted_answer_id": 54218171, "answer_count": 1, "score": 0, "last_activity_date": 1547645476, "creation_date": 1547644771, "question_id": 54217950, "link": "https://stackoverflow.com/questions/54217950/how-to-use-visual-studio-macros-at-compile-time-in-a-c-project", "title": "How to use Visual Studio Macros at compile time in a c++ project", "body": "<p>I would like my code to behave differently at compile time by using the configuration parameter.</p>\n\n<p>Something like the sample code below.\nI need my project to include different headers in each configuration.</p>\n\n<pre><code>#if $(Configuration) == \"my_csutom_config\"\n#include \"my_custom_header.h\"\n#elif\n#include \"std_header.h\"\n#endif\n</code></pre>\n"}, {"tags": ["c++", "constructor", "reference", "constants"], "comments": [{"owner": {"reputation": 58398, "user_id": 3233393, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c4c576e0ebcdf0efd653269a5b020347?s=128&d=identicon&r=PG", "display_name": "Quentin", "link": "https://stackoverflow.com/users/3233393/quentin"}, "edited": false, "score": 2, "creation_date": 1547645674, "post_id": 54217894, "comment_id": 95261980, "body": "What&#39;s wrong with <code>const U *</code>? Also, removing <code>const</code> won&#39;t help: the problem is that the <i>reference</i> itself is not assignable."}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "reply_to_user": {"reputation": 58398, "user_id": 3233393, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c4c576e0ebcdf0efd653269a5b020347?s=128&d=identicon&r=PG", "display_name": "Quentin", "link": "https://stackoverflow.com/users/3233393/quentin"}, "edited": false, "score": 1, "creation_date": 1547645840, "post_id": 54217894, "comment_id": 95262080, "body": "@Quentin <code>const U *</code> opens you up to lifetime issues.  While you could still have the issue taking by reference, you would really have break the &quot;rules&quot; to do so."}, {"owner": {"reputation": 58398, "user_id": 3233393, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c4c576e0ebcdf0efd653269a5b020347?s=128&d=identicon&r=PG", "display_name": "Quentin", "link": "https://stackoverflow.com/users/3233393/quentin"}, "reply_to_user": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 2, "creation_date": 1547645972, "post_id": 54217894, "comment_id": 95262159, "body": "@NathanOliver I&#39;m advocating <code>const U &amp;</code> for parameters and <code>const U *</code> for storage, under the assumption that the &quot;no raw owning pointer&quot; rule is followed."}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "reply_to_user": {"reputation": 58398, "user_id": 3233393, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c4c576e0ebcdf0efd653269a5b020347?s=128&d=identicon&r=PG", "display_name": "Quentin", "link": "https://stackoverflow.com/users/3233393/quentin"}, "edited": false, "score": 0, "creation_date": 1547646207, "post_id": 54217894, "comment_id": 95262307, "body": "@Quentin Ah.  That makes sense."}, {"owner": {"reputation": 473, "user_id": 8800839, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50ab71298e09d7df19b9741966f9af09?s=128&d=identicon&r=PG&f=1", "display_name": "JFFIGK", "link": "https://stackoverflow.com/users/8800839/jffigk"}, "edited": false, "score": 0, "creation_date": 1547646866, "post_id": 54217894, "comment_id": 95262726, "body": "Thanks for the answers and also your input Quentin, I actually did not think about that."}], "answers": [{"comments": [{"owner": {"reputation": 473, "user_id": 8800839, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50ab71298e09d7df19b9741966f9af09?s=128&d=identicon&r=PG&f=1", "display_name": "JFFIGK", "link": "https://stackoverflow.com/users/8800839/jffigk"}, "edited": false, "score": 0, "creation_date": 1547645934, "post_id": 54218240, "comment_id": 95262142, "body": "What ptr should that be? `const T*? Would I not have the same problem there? (smart pointers would be inappropriate, because I don&#39;t own the object)"}, {"owner": {"reputation": 14474, "user_id": 2064761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GoIUL.png?s=128&g=1", "display_name": "Michael Kenzel", "link": "https://stackoverflow.com/users/2064761/michael-kenzel"}, "reply_to_user": {"reputation": 473, "user_id": 8800839, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50ab71298e09d7df19b9741966f9af09?s=128&d=identicon&r=PG&f=1", "display_name": "JFFIGK", "link": "https://stackoverflow.com/users/8800839/jffigk"}, "edited": false, "score": 1, "creation_date": 1547646093, "post_id": 54218240, "comment_id": 95262243, "body": "The fundamental problem you have is that references are not objects themselves (they are merely entities that refer to objects). Wrapping them in an object type like <code>std::reference_wrapper&lt;T&gt;</code> solves this problem. A <code>const T*</code> is also an object type that is copyable and assignable, so it also does not suffer from the same issue as a plain reference\u2026"}], "tags": [], "owner": {"reputation": 14474, "user_id": 2064761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GoIUL.png?s=128&g=1", "display_name": "Michael Kenzel", "link": "https://stackoverflow.com/users/2064761/michael-kenzel"}, "is_accepted": true, "score": 1, "last_activity_date": 1547646301, "last_edit_date": 1547646301, "creation_date": 1547645679, "answer_id": 54218240, "question_id": 54217894, "link": "https://stackoverflow.com/questions/54217894/use-stdreference-wrapperconst-t-to-handle-const-t-in-constructor-appropri/54218240#54218240", "title": "Use std::reference_wrapper&lt;const T&gt; to handle const T&amp; in constructor - appropriate?", "body": "<p>This should be doing what you want. It's using <code>std::reference_wrapper&lt;T&gt;</code> in the way it was intended to be used (passing around references in a way that makes them copyable and assignable). I don't see anything wrong with it. From <a href=\"https://en.cppreference.com/w/cpp/utility/functional/reference_wrapper\" rel=\"nofollow noreferrer\">cppreference.com</a>:</p>\n\n<blockquote>\n  <p>std::reference_wrapper is a class template that wraps a reference in a copyable, assignable object. It is frequently used as a mechanism to store references inside standard containers (like std::vector) which cannot normally hold references. </p>\n</blockquote>\n\n<p>The only potential downside I see is that an <code>std::reference_wrapper&lt;T&gt;</code> may be a bit akward to use and unfamiliar to some. A more common solution to your problem would probably be to just store a pointer in your object instead of a reference. For example:</p>\n\n<pre><code>class T {\nprivate:\n    const U* _u;\n\npublic:\n    T(const U&amp; u)\n        : _u(&amp;u) {}\n    \u2026\n};\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 473, "user_id": 8800839, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50ab71298e09d7df19b9741966f9af09?s=128&d=identicon&r=PG&f=1", "display_name": "JFFIGK", "link": "https://stackoverflow.com/users/8800839/jffigk"}, "edited": false, "score": 0, "creation_date": 1547645856, "post_id": 54218253, "comment_id": 95262091, "body": "If I have multiple such parameters, do I have to delete all combinations? <code>const U&amp;&amp;, const T&amp;&amp;</code> <code>const U&amp;, const T&amp;&amp;</code>, \u2026?"}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "reply_to_user": {"reputation": 473, "user_id": 8800839, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50ab71298e09d7df19b9741966f9af09?s=128&d=identicon&r=PG&f=1", "display_name": "JFFIGK", "link": "https://stackoverflow.com/users/8800839/jffigk"}, "edited": false, "score": 2, "creation_date": 1547646061, "post_id": 54218253, "comment_id": 95262219, "body": "@JFFIGK Most likely.  You &quot;need&quot; (in the sense that you the compiler to catch mistakes) to have a deleted constructor for every constructor that could take a temporary.  If you have <code>T(const U&amp; u)</code>, <code>T(const U&amp; u, const X&amp;x)</code> and <code>T(const U&amp; u, const Y&amp; y const Z&amp; z)</code> then you need to add  <code>T(const U&amp;&amp;) = delete</code>, <code>T(const U&amp;&amp;, const X&amp;&amp;) = delete</code> and <code>T(const U&amp;&amp;, const Y&amp;&amp;, const Z&amp;&amp;) = delete</code>"}, {"owner": {"reputation": 473, "user_id": 8800839, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50ab71298e09d7df19b9741966f9af09?s=128&d=identicon&r=PG&f=1", "display_name": "JFFIGK", "link": "https://stackoverflow.com/users/8800839/jffigk"}, "edited": false, "score": 0, "creation_date": 1547646280, "post_id": 54218253, "comment_id": 95262356, "body": "What about already expecting a std::reference_wrapper in the constructor? Code: <a href=\"https://onlinegdb.com/rkter3nz4\" rel=\"nofollow noreferrer\">onlinegdb.com/rkter3nz4</a> Why: <a href=\"https://stackoverflow.com/questions/23973439/why-does-stdreference-wrapperconst-t-not-accept-a-temporary\" title=\"why does stdreference wrapperconst t not accept a temporary\">stackoverflow.com/questions/23973439/&hellip;</a>"}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "reply_to_user": {"reputation": 473, "user_id": 8800839, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50ab71298e09d7df19b9741966f9af09?s=128&d=identicon&r=PG&f=1", "display_name": "JFFIGK", "link": "https://stackoverflow.com/users/8800839/jffigk"}, "edited": false, "score": 1, "creation_date": 1547646397, "post_id": 54218253, "comment_id": 95262429, "body": "@JFFIGK That would work.  <code>std::reference_wrapper</code> does this for you so you can save yourself some work.  If you do so though you commit to that interface and expose the internals.  That could/will make it harder to change latter if you decide to."}], "tags": [], "owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "is_accepted": false, "score": 2, "last_activity_date": 1547645726, "creation_date": 1547645726, "answer_id": 54218253, "question_id": 54217894, "link": "https://stackoverflow.com/questions/54217894/use-stdreference-wrapperconst-t-to-handle-const-t-in-constructor-appropri/54218253#54218253", "title": "Use std::reference_wrapper&lt;const T&gt; to handle const T&amp; in constructor - appropriate?", "body": "<p>One major issue with your interface is that <code>T</code>'s only constructor takes a <code>const U&amp;</code>.  This means you could pass a temporary to <code>T</code> and be left with a <code>reference_wrapper</code> to a dead object since <code>const&amp;</code> in an object does not extend the lifetime of the temporary.</p>\n\n<p>To solve this you need to add a deleted constructor that stops you from accepting temporaries.  Adding</p>\n\n<pre><code>T(const U&amp;&amp;) = delete;\n</code></pre>\n\n<p>will do that.</p>\n"}], "owner": {"reputation": 473, "user_id": 8800839, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50ab71298e09d7df19b9741966f9af09?s=128&d=identicon&r=PG&f=1", "display_name": "JFFIGK", "link": "https://stackoverflow.com/users/8800839/jffigk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 1, "accepted_answer_id": 54218240, "answer_count": 2, "score": 0, "last_activity_date": 1547646301, "creation_date": 1547644617, "last_edit_date": 1547645357, "question_id": 54217894, "link": "https://stackoverflow.com/questions/54217894/use-stdreference-wrapperconst-t-to-handle-const-t-in-constructor-appropri", "title": "Use std::reference_wrapper&lt;const T&gt; to handle const T&amp; in constructor - appropriate?", "body": "<p>A class owns an object of type <code>U</code>. Through a method it exposes this object as a <code>const U&amp;</code> using a getter (not cheaply copyable, modification is not desired). </p>\n\n<p>A client, now, wants to make use of this API. He wishes to use the instance of <code>U</code> as part of a complex object (which has no interest in changing the API object).\nTherefore, he has at least the following option:\nCreate a class <code>T</code> with <code>const U&amp;</code> as parameter and a private field of type <code>const U&amp;</code>, where the constructor stores the instance of the API.\nThis has the extreme disadvantage of making the instances of the class extremely unflexible (e.g. no management using std::vectors), which is not desired.</p>\n\n<p>Not a long time ago, I found that one also could use a <code>std::reference_wrapper&lt;const U&gt;</code>, to store the <code>const U&amp;</code>, which would not impose those disadvantages on instances of type <code>T</code>.</p>\n\n<p>The question now is, does this behave like it is expected and is it a good practice to do so? </p>\n\n<p>In the following and <a href=\"https://onlinegdb.com/HypATinM4\" rel=\"nofollow noreferrer\">here</a>, you can find a working code using this strategy and the types described.</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;memory&gt;\n\nclass U{\n    public: \n    uint value;\n};\n\nclass T{\nprivate:\n    std::reference_wrapper&lt;const U&gt; _u;\n\npublic:\n    T(const U&amp; u)\n        :_u(u) {}\n\n    const U&amp; GetU(){\n        return _u;\n    }\n};\n\nconst U&amp; provideValue(U&amp; u){\n    return u;\n}\n\nint main()\n{\n    U internalApiValue;\n    internalApiValue.value = 5;\n\n    auto apiValue = provideValue(internalApiValue);\n\n    T container(apiValue);\n\n    std::cout &lt;&lt; container.GetU().value;\n}\n</code></pre>\n\n<p>I guess if this is not a good idea, the only alternative would be avoiding const, because else I would impose high restrictions on the users of such methods (methods exposing <code>const U&amp;</code> instead of <code>U&amp;</code> or <code>U</code>)?</p>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1547644636, "post_id": 54217776, "comment_id": 95261359, "body": "<code>Base&amp; b = d;</code> just memorizes an address (as reference), there is no constructor nor destructor involved"}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 2, "creation_date": 1547644782, "post_id": 54217776, "comment_id": 95261434, "body": "Please be more specific than &quot;I saw some differences&quot; \u2013 include them in your question."}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 2, "creation_date": 1547644845, "post_id": 54217776, "comment_id": 95261474, "body": "The pointer to the vtable needs to be set, that&#39;s probably what you saw."}, {"owner": {"reputation": 147720, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 3, "creation_date": 1547644862, "post_id": 54217776, "comment_id": 95261489, "body": "<i>&quot;and only constructors in Derived class beacause there is no virtual destructor&quot;</i> - Ah, no. The Derived class isn&#39;t crippled just because the base has a non-virtual destructor. It still gets one all of its own. But it isn&#39;t invocable polymorphically."}, {"owner": {"reputation": 480, "user_id": 6948160, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/129c8f620f47a08105f596962677b4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Gojita", "link": "https://stackoverflow.com/users/6948160/gojita"}, "edited": false, "score": 0, "creation_date": 1547645065, "post_id": 54217776, "comment_id": 95261613, "body": "If I well remember C++ member generation, the assignment operator is also generated at the same time than the copy constructor. I speak about the operator=(const&amp;);"}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 0, "creation_date": 1547649458, "post_id": 54217776, "comment_id": 95264429, "body": "Nothing gets generated that I don&#39;t expect: <a href=\"https://godbolt.org/z/sZwivk\" rel=\"nofollow noreferrer\">godbolt.org/z/sZwivk</a> no move constructor, copy constructor..."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9957106"}, "reply_to_user": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 0, "creation_date": 1547652074, "post_id": 54217776, "comment_id": 95266064, "body": "@MatthieuBrucher I mean gets generated by compiler, not gets invoked in runtime"}, {"owner": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "edited": false, "score": 0, "creation_date": 1547657054, "post_id": 54217776, "comment_id": 95269041, "body": "Gcc only generate the destructors. It does that only once base destructor is user-defined because in this case the destructor is not trivial neither for the base nor for the derived."}], "owner": {"user_type": "does_not_exist", "display_name": "user9957106"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 107, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1547644999, "creation_date": 1547644196, "last_edit_date": 1547644999, "question_id": 54217776, "link": "https://stackoverflow.com/questions/54217776/c-default-constructors-created-by-compiler", "title": "c++ default constructors created by compiler", "body": "<p>I recently discover this page (<a href=\"https://cppinsights.io/\" rel=\"nofollow noreferrer\">https://cppinsights.io/</a>). I try in it some code:</p>\n\n<pre><code>class Base {\n};\n\nclass Derived : public Base {\n};\n\nint main() {\n  Derived d;\n  Base&amp; b = d;\n}\n</code></pre>\n\n<p>I understand that compilator creates constructor, move constructor, copy constructor and destructor in Base class, and only constructors in Derived class beacause there is no virtual destructor in Base class. But when I add </p>\n\n<pre><code>public :\n  ~Base(){}\n</code></pre>\n\n<p>and then</p>\n\n<pre><code>public :\n  virtual ~Base(){}\n</code></pre>\n\n<p>and I saw some differences in constructors. After first addition compilator also generates move assigment operator and destructor in Derrived class, after second addition - virtual destructor, assigment operator and move assigment operator. Why?</p>\n"}, {"tags": ["java", "c++", "oop"], "comments": [{"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 1, "creation_date": 1547643705, "post_id": 54217615, "comment_id": 95260867, "body": "evil MACRO in C++, but what&#39;s wrong with <code>Adder&lt;MyClass&gt;().add(myObject)</code> ?"}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 2, "creation_date": 1547643744, "post_id": 54217615, "comment_id": 95260887, "body": "dont confuse java generics with c++ templates, they are quite different beasts. Its basically two questions in one"}, {"owner": {"reputation": 147720, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 1, "creation_date": 1547643913, "post_id": 54217615, "comment_id": 95260975, "body": "Wait what? How on earth would it not matter to you if it was in Java or C++? Do you even have a goal in mind?"}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1547644238, "post_id": 54217615, "comment_id": 95261154, "body": "if you want the method to have different names, then why are they supposed to be instantiations of the same template? Suggest you read on the <a href=\"https://meta.stackexchange.com/questions/66377/what-is-the-xy-problem\">xy problem</a>. Knowing a use case can help to answer the question (and sometimes it is necessary to give a correct answer)"}, {"owner": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "edited": false, "score": 0, "creation_date": 1547644268, "post_id": 54217615, "comment_id": 95261167, "body": "The only option in c++ is <code>obj.add&lt;MyClass&gt;</code> and <code>obj.add&lt;ClassTwo&gt;</code>"}, {"owner": {"reputation": 383, "user_id": 7811473, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/96b79b4c5c94f27e26323d52684c6850?s=128&d=identicon&r=PG&f=1", "display_name": "LBald", "link": "https://stackoverflow.com/users/7811473/lbald"}, "reply_to_user": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 0, "creation_date": 1547644285, "post_id": 54217615, "comment_id": 95261180, "body": "@Jarod42, it may be useful when using more then one input parameter. Just updated the question"}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1547644343, "post_id": 54217615, "comment_id": 95261204, "body": "implementation of those methods should be the same, only different names?"}, {"owner": {"reputation": 5295, "user_id": 2513200, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3d4b041c512a4e708a42494eb465b40f?s=128&d=identicon&r=PG", "display_name": "Hulk", "link": "https://stackoverflow.com/users/2513200/hulk"}, "edited": false, "score": 1, "creation_date": 1547644392, "post_id": 54217615, "comment_id": 95261238, "body": "@LBald but would these methods do different things, or do they do the same thing? If they do the same thing, why should they be named differently? If they do different things, how could they be generic?"}, {"owner": {"reputation": 956, "user_id": 6449949, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6a920ba06a595d7137a076ab1de7425?s=128&d=identicon&r=PG&f=1", "display_name": "paler123", "link": "https://stackoverflow.com/users/6449949/paler123"}, "edited": false, "score": 0, "creation_date": 1547644797, "post_id": 54217615, "comment_id": 95261440, "body": "@LBald I would not recommend choosing language based on that. Java and C++ are really different. You should probably choose one or the other based e.g. on performance constraints and make your design fit particular language."}, {"owner": {"reputation": 383, "user_id": 7811473, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/96b79b4c5c94f27e26323d52684c6850?s=128&d=identicon&r=PG&f=1", "display_name": "LBald", "link": "https://stackoverflow.com/users/7811473/lbald"}, "reply_to_user": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1547645447, "post_id": 54217615, "comment_id": 95261847, "body": "Thanks @user463035818, just updated the question"}, {"owner": {"reputation": 5295, "user_id": 2513200, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3d4b041c512a4e708a42494eb465b40f?s=128&d=identicon&r=PG", "display_name": "Hulk", "link": "https://stackoverflow.com/users/2513200/hulk"}, "edited": false, "score": 0, "creation_date": 1547645756, "post_id": 54217615, "comment_id": 95262022, "body": "@LBald how would you use that interface <code>VectorSpace</code>?"}, {"owner": {"reputation": 383, "user_id": 7811473, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/96b79b4c5c94f27e26323d52684c6850?s=128&d=identicon&r=PG&f=1", "display_name": "LBald", "link": "https://stackoverflow.com/users/7811473/lbald"}, "edited": false, "score": 0, "creation_date": 1547646602, "post_id": 54217615, "comment_id": 95262558, "body": "Maybe I&#39;m making a storm in a teacup. Thanks everyone ^^"}], "answers": [{"comments": [{"owner": {"reputation": 5295, "user_id": 2513200, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3d4b041c512a4e708a42494eb465b40f?s=128&d=identicon&r=PG", "display_name": "Hulk", "link": "https://stackoverflow.com/users/2513200/hulk"}, "edited": false, "score": 0, "creation_date": 1547644599, "post_id": 54217823, "comment_id": 95261340, "body": "This would only work in java if <code>T</code> and <code>R</code> are bounded to yield different erasure."}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1547644720, "post_id": 54217823, "comment_id": 95261401, "body": "in c++ also only when <code>T</code> is not the same as <code>R</code>"}], "tags": [], "owner": {"reputation": 689, "user_id": 9185797, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HJqOX.jpg?s=128&g=1", "display_name": "Phins", "link": "https://stackoverflow.com/users/9185797/phins"}, "is_accepted": true, "score": 0, "last_activity_date": 1547644783, "last_edit_date": 1547644783, "creation_date": 1547644348, "answer_id": 54217823, "question_id": 54217615, "link": "https://stackoverflow.com/questions/54217615/dynamically-name-function-with-template-or-generics/54217823#54217823", "title": "Dynamically name function with template or generics", "body": "<p>No and there is no need for such a feature. In your example you could easily use <strong>Method Overloading</strong>. (Does not work in Java)</p>\n\n<pre><code>// c++\ntemplate &lt;typename T, typename R&gt;\nclass Adder\n{\n    void add(T t);\n    void add(R r);\n}\n</code></pre>\n\n<p>The correct function is selected automatically at compile time. (Note: Does only work if T and R do not have the same Type)</p>\n"}, {"comments": [{"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 1, "creation_date": 1547645013, "post_id": 54217960, "comment_id": 95261581, "body": "I can&#39;t see a real life reason to do this, but yes it is tricky uncommon and error prone :P"}, {"owner": {"reputation": 689, "user_id": 9185797, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HJqOX.jpg?s=128&g=1", "display_name": "Phins", "link": "https://stackoverflow.com/users/9185797/phins"}, "edited": false, "score": 0, "creation_date": 1547645099, "post_id": 54217960, "comment_id": 95261629, "body": "Isnt that different from what the OP asked? I think he meant both adds in the same class with a method posfix"}, {"owner": {"reputation": 33645, "user_id": 2630032, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hQF09.jpg?s=128&g=1", "display_name": "Stephan Lechner", "link": "https://stackoverflow.com/users/2630032/stephan-lechner"}, "reply_to_user": {"reputation": 6230, "user_id": 924820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d35254b4ba07fdb455b7ceb44cd3d279?s=128&d=identicon&r=PG", "display_name": "BigMike", "link": "https://stackoverflow.com/users/924820/bigmike"}, "edited": false, "score": 1, "creation_date": 1547645127, "post_id": 54217960, "comment_id": 95261644, "body": "@BigMike: yes, it&#39;s &quot;beautifull&quot; (for someone with a very special sense of aesthetics) :-)"}, {"owner": {"reputation": 33645, "user_id": 2630032, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hQF09.jpg?s=128&g=1", "display_name": "Stephan Lechner", "link": "https://stackoverflow.com/users/2630032/stephan-lechner"}, "reply_to_user": {"reputation": 689, "user_id": 9185797, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HJqOX.jpg?s=128&g=1", "display_name": "Phins", "link": "https://stackoverflow.com/users/9185797/phins"}, "edited": false, "score": 0, "creation_date": 1547645256, "post_id": 54217960, "comment_id": 95261717, "body": "@Phins: yes; question seems to have changed while writing my answer. In this case, a makro just for the method definition would be sufficient."}], "tags": [], "owner": {"reputation": 33645, "user_id": 2630032, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hQF09.jpg?s=128&g=1", "display_name": "Stephan Lechner", "link": "https://stackoverflow.com/users/2630032/stephan-lechner"}, "is_accepted": false, "score": 2, "last_activity_date": 1547645021, "last_edit_date": 1547645021, "creation_date": 1547644805, "answer_id": 54217960, "question_id": 54217615, "link": "https://stackoverflow.com/questions/54217615/dynamically-name-function-with-template-or-generics/54217960#54217960", "title": "Dynamically name function with template or generics", "body": "<p>I personally think that - as mentioned by @Jarod42 - a solution like  <code>Adder&lt;MyClass&gt;().add(myObject)</code> is sufficient; There is in my opinion no need to express the context of <code>MyClass</code> twice, i.e. once through template parameter and a second time through the name of a member function of this parametrized class.</p>\n\n<p>Anyway, if you are looking for something like that, you'll need something in the preprocessor, since you are about generating tokens. You could achieve this through token concatenation makro <code>##</code> as follows.</p>\n\n<p>But caution: such kind of code is usually rather tricky, uncommon, and error prone and I do not recommend using it: </p>\n\n<pre><code>#define CLASSDEF(NAME) class NAME ## Adder { public:  void add(NAME ## Adder a); }\n\nCLASSDEF(MyClass);\nCLASSDEF(AnotherClass);\n\nint main() {\n    MyClassAdder x;\n    x.add(x);\n\n    AnotherClassAdder y;\n    y.add(y);\n}\n</code></pre>\n\n<p>For java, in contrast, I don't think that you can achieve something similar; To my knowledge, there is no way to \"dynamically\" create tokens in some sort of preprocessor. </p>\n"}], "owner": {"reputation": 383, "user_id": 7811473, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/96b79b4c5c94f27e26323d52684c6850?s=128&d=identicon&r=PG&f=1", "display_name": "LBald", "link": "https://stackoverflow.com/users/7811473/lbald"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 1, "accepted_answer_id": 54217823, "answer_count": 2, "score": 0, "last_activity_date": 1547646661, "creation_date": 1547643608, "last_edit_date": 1547646661, "question_id": 54217615, "link": "https://stackoverflow.com/questions/54217615/dynamically-name-function-with-template-or-generics", "title": "Dynamically name function with template or generics", "body": "<p>Is there any way of dynamically or precompile name a method or function in Java or C++ based on the generics or template used? Here is a code to draw the idea:</p>\n\n<p>Java:</p>\n\n<pre><code>class Adder&lt;T, R&gt; {\n    add\"T\"(T t);\n    add\"R\"(R r);\n}\n...\nobj = new Adder&lt;MyClass, ClassTwo&gt;();\nobj.addMyClass(myObject);\nobj.addClassTwo(objectTwo);\n</code></pre>\n\n<p>A more concrete example: A Vector Space defined in Matrix set, in Real set, has definied a matrix multiplication that returns a matrix (Matrix X Matrix) and a real multiplication that also return a matrix (Real X Matrix), with diferrent implementations. e.g.:</p>\n\n<pre><code>intereface VectorSpace&lt;T, R&gt; {\n    ...\n    T multiply\"T\" (T arg0, T arg1);\n    T multiply\"R\" (T arg0, R arg1);\n}\n...\nclass RealMatrixVectorSpace implements VectorSpace&lt;Matrix, Real&gt; {\n    Matrix multiplyMatrix (Matrix arg0, Matrix arg1) { ... }\n    Matrix multiplyReal (Matrix arg0, Real arg1) { ... }\n}\n</code></pre>\n\n<p>But a vector space can be defined with other inputs, that what I'm trying to define for a program to utilize this generic concept.</p>\n"}, {"tags": ["c++", "linux", "windows", "cross-platform", "large-files"], "comments": [{"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 3, "creation_date": 1547643590, "post_id": 54217552, "comment_id": 95260799, "body": "Have you experienced a problem with <code>std::fstream</code> and co with files of this size?"}, {"owner": {"reputation": 252, "user_id": 5364211, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ixqyo.jpg?s=128&g=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/5364211/tom"}, "edited": false, "score": 0, "creation_date": 1547643611, "post_id": 54217552, "comment_id": 95260810, "body": "Do you have to read the whole thing into memory at once? If not I think you&#39;re totally correct to want to split the files up."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 1, "creation_date": 1547643658, "post_id": 54217552, "comment_id": 95260834, "body": "<a href=\"https://stackoverflow.com/a/30610742/560648\">stackoverflow.com/a/30610742/560648</a> <a href=\"https://stackoverflow.com/q/32080076/560648\">stackoverflow.com/q/32080076/560648</a> <a href=\"https://stackoverflow.com/q/34751873/560648\">stackoverflow.com/q/34751873/560648</a> <a href=\"https://stackoverflow.com/q/7135598/560648\">stackoverflow.com/q/7135598/560648</a> et al"}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "reply_to_user": {"reputation": 252, "user_id": 5364211, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ixqyo.jpg?s=128&g=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/5364211/tom"}, "edited": false, "score": 0, "creation_date": 1547643678, "post_id": 54217552, "comment_id": 95260852, "body": "@Tom I disagree - splitting the files up on the filesystem should ideally not be necessary. Of course you wouldn&#39;t read the whole file into memory at once but you shouldn&#39;t do that anyway"}, {"owner": {"reputation": 252, "user_id": 5364211, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ixqyo.jpg?s=128&g=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/5364211/tom"}, "reply_to_user": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1547643743, "post_id": 54217552, "comment_id": 95260886, "body": "@LightnessRacesinOrbit I hear what your saying - there are of course many ways to process files in chunks i.e using buffers, paging etc"}, {"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1547643808, "post_id": 54217552, "comment_id": 95260916, "body": "What data are you writing to the file? Is it a text or a &quot;binary&quot; file? Do you need to read <i>all</i> of the file or just part of it? Can you read and process the data from the file in smaller chunks? And what are you doing with the file once written, what are the files for?"}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 0, "creation_date": 1547644194, "post_id": 54217552, "comment_id": 95261131, "body": "Agreed, never had an issue with stream on binary files on clusters, I don&#39;t think anyone had such a problem."}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 0, "creation_date": 1547644310, "post_id": 54217552, "comment_id": 95261190, "body": "even fread can on 64bits systems (size_t is 64bits in that case)."}, {"owner": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "edited": false, "score": 1, "creation_date": 1547644664, "post_id": 54217552, "comment_id": 95261375, "body": "What about mapping the entire file to memory? Only accessed memory region of the mapping will actually cause a page fault, so that the system will only reserve the physical memory necessary for your application. What is provided by the stl is really primitive compared to what provides the system."}, {"owner": {"reputation": 171, "user_id": 3786065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/baf3d0cf84168949ed56c93005fe95c3?s=128&d=identicon&r=PG", "display_name": "vin", "link": "https://stackoverflow.com/users/3786065/vin"}, "reply_to_user": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "edited": false, "score": 0, "creation_date": 1547644817, "post_id": 54217552, "comment_id": 95261453, "body": "@Oliv When I said &#39;use platform API&#39; I meant even this memory mapping you suggest. I want to get there only as the last resort."}, {"owner": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "edited": false, "score": 0, "creation_date": 1547645116, "post_id": 54217552, "comment_id": 95261639, "body": "@vin It is simpler to use than you imagine. Maybe simpler than the standard library. And the way more efficient if used correctly. Actualy I do not see any reason to use the standard library or the c library for files stored on block devices."}, {"owner": {"reputation": 2943, "user_id": 9014308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b6e0464313ca63c239f5d973213daf9?s=128&d=identicon&r=PG&f=1", "display_name": "kunif", "link": "https://stackoverflow.com/users/9014308/kunif"}, "edited": false, "score": 0, "creation_date": 1547656781, "post_id": 54217552, "comment_id": 95268876, "body": "Programming is also important, but you need to be careful not to use FAT32 format DISK (USB memory etc.). The max size of the volume can be up to 2TB, but the max size of each file is up to 4GB."}], "answers": [{"tags": [], "owner": {"reputation": 15641, "user_id": 126995, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bdd0d42e87a7c2636f0570ce12d069e5?s=128&d=identicon&r=PG", "display_name": "Soonts", "link": "https://stackoverflow.com/users/126995/soonts"}, "is_accepted": false, "score": 0, "last_activity_date": 1547653135, "creation_date": 1547653135, "answer_id": 54220505, "question_id": 54217552, "link": "https://stackoverflow.com/questions/54217552/how-to-process-large-files-4-gb-correctly-and-portably-in-c/54220505#54220505", "title": "How to process large files (4+ GB) correctly and portably in C++?", "body": "<p>I don\u2019t think you can do portably, but this workaround might help (untested).</p>\n\n<pre><code>#include &lt;stdint.h&gt;\n#include &lt;stdio.h&gt;\n#ifdef _MSC_VER\ninline int seek64( FILE *stream, int64_t offset, int origin )\n{\n    return _fseeki64( stream, offset, origin );\n}\n#else\n#define _LARGEFILE64_SOURCE\n#include &lt;sys/types.h&gt;\n#include &lt;unistd.h&gt;\ninline int seek64( FILE *stream, int64_t offset, int origin )\n{\n    const int fd = fileno( stream );\n    return (int)lseek64( fd, offset, origin );\n}\n#endif\n</code></pre>\n"}], "owner": {"reputation": 171, "user_id": 3786065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/baf3d0cf84168949ed56c93005fe95c3?s=128&d=identicon&r=PG", "display_name": "vin", "link": "https://stackoverflow.com/users/3786065/vin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 132, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1547653135, "creation_date": 1547643377, "last_edit_date": 1547644184, "question_id": 54217552, "link": "https://stackoverflow.com/questions/54217552/how-to-process-large-files-4-gb-correctly-and-portably-in-c", "title": "How to process large files (4+ GB) correctly and portably in C++?", "body": "<p>In my career I never had to deal with files this large as the central aspect of my application and I am a bit stumped.</p>\n\n<p>My application will record a lot of things in a file and it might grow to several giga bytes. The application will have to run on Windows (7 onward) and all modern Linux (kernel 4 onward), for both 32 bit and 64 bit machines</p>\n\n<p>I tried using <code>fread</code> and friends since they are portable but they all use <code>long</code>. I mused splitting the file into multiple 2 GB files so as to continue working with signed <code>long</code>, but this seems a bit too much processing overhead.</p>\n\n<p>Is there a set of portable library functions that will help with the task, or do I have to write a thin wrapper around the platform API?</p>\n\n<hr>\n\n<p>EDIT: To answer some questions in the comment.</p>\n\n<ol>\n<li>This is a binary data file.</li>\n<li>I don't need to load it all in memory but will have to seek to offsets.</li>\n<li>About using fstream, it seems it wouldn't work based on <a href=\"https://stackoverflow.com/questions/11448713/seeking-in-large-files-with-ifstream\">this</a>, so I didn't factor it in.</li>\n</ol>\n"}, {"tags": ["c++", "arm", "embedded", "startup", "keil"], "answers": [{"tags": [], "owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "is_accepted": true, "score": 3, "last_activity_date": 1547649699, "last_edit_date": 1547649699, "creation_date": 1547649382, "answer_id": 54219385, "question_id": 54217269, "link": "https://stackoverflow.com/questions/54217269/transform-keil5-c-project-to-c-project-error-with-the-interrupt-function/54219385#54219385", "title": "Transform Keil5 C Project to C++ Project Error with the Interrupt Function", "body": "<p>The interrupt handlers require C linkage if using C++ compilation:</p>\n\n<pre><code>extern \"C\" void USART1_IRQHandler(void)      \n{\n    if(USART_GetITStatus(USART1, USART_IT_RXNE) != RESET)   \n    {                                                                        \n        USART_ClearITPendingBit(USART1, USART_IT_RXNE);\n    }\n}\n</code></pre>\n\n<p>Without C linkage the function <code>USART1_IRQHandler</code> will not replace the default handler of the same name but with C linkage which is an endless-loop, hence it appears to be \"<em>stuck in the interrupt function</em>\", which it is... just a different interrupt function.</p>\n\n<p>The C linkage prevents C++ \"name mangling\" that otherwise causes the symbol to not be the same as the interrupt handler weak-link symbol name.</p>\n"}], "owner": {"reputation": 3, "user_id": 10922290, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e406f0f59487f4b4894a6b90eb67410?s=128&d=identicon&r=PG&f=1", "display_name": "WJB", "link": "https://stackoverflow.com/users/10922290/wjb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 54219385, "answer_count": 1, "score": 0, "last_activity_date": 1547649699, "creation_date": 1547642334, "last_edit_date": 1547649418, "question_id": 54217269, "link": "https://stackoverflow.com/questions/54217269/transform-keil5-c-project-to-c-project-error-with-the-interrupt-function", "title": "Transform Keil5 C Project to C++ Project Error with the Interrupt Function", "body": "<p>After I transform the Project from C to C++, the program is seem to be stuck in the interrupt function.</p>\n\n<p>I've wrote a keil embedded project with C, and then I tried to write it with C++. Then I found the program was stuck in the interrupt function even I write the IRQHandler functions properly (they do work in C project).\nThe USART1 will be stuck meanwhile the CAN receive/transmit are still working.</p>\n\n<pre><code>// this is the USART_IRQHandler   \n\nvoid USART1_IRQHandler(void)      \n{\n    if(USART_GetITStatus(USART1, USART_IT_RXNE) != RESET)   \n    {                                                                        \n        USART_ClearITPendingBit(USART1, USART_IT_RXNE);\n    }\n}\n</code></pre>\n"}, {"tags": ["c++", "boost", "comparison"], "comments": [{"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 1, "creation_date": 1547641985, "post_id": 54217030, "comment_id": 95259890, "body": "those two are defining not the same symbols. And imho the first cost much less effort to read and understand (something that is more valuable than a couple of kb disc space or 1-2 minutes of typing)"}, {"owner": {"reputation": 756, "user_id": 6023984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73604f61ae59e5916e663b1c9045100e?s=128&d=identicon&r=PG&f=1", "display_name": "l4m2", "link": "https://stackoverflow.com/users/6023984/l4m2"}, "reply_to_user": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1547648155, "post_id": 54217030, "comment_id": 95263533, "body": "@user463035818 They&#39;re just reversed output which doesn&#39;t matter much. I&#39;d say the second one is easier read, but if they think the first one is and that&#39;s the reason then this queston is over"}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1547648326, "post_id": 54217030, "comment_id": 95263654, "body": "of course it matters, when both the call and the result are different then its not an alternative (maybe a &quot;reverse alternative&quot; ;). Anyhow, only the authors of the library can know why they made the decisions they made to arrive at that code"}], "answers": [{"comments": [{"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1547651195, "post_id": 54219786, "comment_id": 95265553, "body": "answering your own question is nothing to be sorry about :). You can even accept it and you should if it is answering the question. Nice that it turned out that the question has an answer"}], "tags": [], "owner": {"reputation": 756, "user_id": 6023984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73604f61ae59e5916e663b1c9045100e?s=128&d=identicon&r=PG&f=1", "display_name": "l4m2", "link": "https://stackoverflow.com/users/6023984/l4m2"}, "is_accepted": true, "score": 1, "last_activity_date": 1547651161, "last_edit_date": 1547651161, "creation_date": 1547650725, "answer_id": 54219786, "question_id": 54217030, "link": "https://stackoverflow.com/questions/54217030/c-boost-preprosessor-equality-testing/54219786#54219786", "title": "C++ Boost preprosessor equality testing", "body": "<p>Boost considered environment where <code>...</code> is not allowed(<code>BOOST_PP_VARIADICS</code>).</p>\n"}], "owner": {"reputation": 756, "user_id": 6023984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73604f61ae59e5916e663b1c9045100e?s=128&d=identicon&r=PG&f=1", "display_name": "l4m2", "link": "https://stackoverflow.com/users/6023984/l4m2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 30, "favorite_count": 0, "accepted_answer_id": 54219786, "answer_count": 1, "score": 0, "last_activity_date": 1547651161, "creation_date": 1547641432, "question_id": 54217030, "link": "https://stackoverflow.com/questions/54217030/c-boost-preprosessor-equality-testing", "title": "C++ Boost preprosessor equality testing", "body": "<p>The equality testing of Boost PP looks like</p>\n\n<pre><code># define NOT_EQUAL_I(x, y) CAT(NOT_EQUAL_CHECK_, NOT_EQUAL_ ## x(0, NOT_EQUAL_ ## y))\n# define NOT_EQUAL_CHECK_NIL 1\n# define NOT_EQUAL_CHECK_NOT_EQUAL_0(c, y) 0\n# define NOT_EQUAL_CHECK_NOT_EQUAL_1(c, y) 0\n# define NOT_EQUAL_CHECK_NOT_EQUAL_2(c, y) 0\n# define NOT_EQUAL_CHECK_NOT_EQUAL_3(c, y) 0\n# define NOT_EQUAL_0(c, y) IIF(c, NIL, y(1, NIL))\n# define NOT_EQUAL_1(c, y) IIF(c, NIL, y(1, NIL))\n# define NOT_EQUAL_2(c, y) IIF(c, NIL, y(1, NIL))\n# define NOT_EQUAL_3(c, y) IIF(c, NIL, y(1, NIL))\n</code></pre>\n\n<p>which relies on the fact that macro expands for once in this situation.</p>\n\n<p>However, another solution is easily thought, and seems to cost less (space):</p>\n\n<pre><code>#define EQ_0_0 ,\n#define EQ_1_1 ,\n#define EQ_2_2 ,\n#define EQ_3_3 ,\n#define SECOND(_,x,...) x\n#define PARSE(...) __VA_ARGS__\n#define EQ(x,y) PARSE(SECOND PARSE() (0 EQ_##x##_##y 1, 0 ))\n</code></pre>\n\n<p>So why does Boost choose the former form rather than the latter one? What are the goods and bads of them?</p>\n"}, {"tags": ["c++", "replace"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1547641822, "post_id": 54217017, "comment_id": 95259811, "body": "Does <a href=\"https://stackoverflow.com/a/236803/752976\">this answer</a> help? It seems you just need a string split, which isn&#39;t available in standard C++."}, {"owner": {"reputation": 252, "user_id": 5364211, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ixqyo.jpg?s=128&g=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/5364211/tom"}, "edited": false, "score": 1, "creation_date": 1547642038, "post_id": 54217017, "comment_id": 95259920, "body": "The simplest and most conventional way to do this is to add a the delimiter parameter to your getline() call"}, {"owner": {"reputation": 1465, "user_id": 5122006, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/d5d9f38947aef246351984de8786ce8c?s=128&d=identicon&r=PG&f=1", "display_name": "okovko", "link": "https://stackoverflow.com/users/5122006/okovko"}, "reply_to_user": {"reputation": 252, "user_id": 5364211, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ixqyo.jpg?s=128&g=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/5364211/tom"}, "edited": false, "score": 0, "creation_date": 1547647046, "post_id": 54217017, "comment_id": 95262852, "body": "@Tom When using <code>getline</code>: &quot;If the delimiter is found, it is extracted and discarded (i.e. it is not stored and the next input operation will begin after it).&quot; That&#39;s still a good suggestion if you store the user input in a <code>std::stringstream</code> and call <code>getline</code> on that. You&#39;d just need to add the delimiters back in :P for the desired output of OP."}, {"owner": {"reputation": 1465, "user_id": 5122006, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/d5d9f38947aef246351984de8786ce8c?s=128&d=identicon&r=PG&f=1", "display_name": "okovko", "link": "https://stackoverflow.com/users/5122006/okovko"}, "reply_to_user": {"reputation": 252, "user_id": 5364211, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ixqyo.jpg?s=128&g=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/5364211/tom"}, "edited": false, "score": 0, "creation_date": 1547648386, "post_id": 54217017, "comment_id": 95263695, "body": "@Tom <code>getline</code> is also not quuuiiite that desirable because you may want to specify more than one delimiter. I actually like my solution for this problem a lot (by the way, I have a link to a compiling tested example in my answer you can check out). The style is simple, there are only four logical cases, and it&#39;s all done in a single loop. I&#39;d appreciate at least an up vote, @Jules! :P"}], "answers": [{"comments": [{"owner": {"reputation": 1465, "user_id": 5122006, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/d5d9f38947aef246351984de8786ce8c?s=128&d=identicon&r=PG&f=1", "display_name": "okovko", "link": "https://stackoverflow.com/users/5122006/okovko"}, "edited": false, "score": 0, "creation_date": 1547648510, "post_id": 54217196, "comment_id": 95263781, "body": "Can you give a complete example of your vector implementation?"}, {"owner": {"reputation": 689, "user_id": 9185797, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HJqOX.jpg?s=128&g=1", "display_name": "Phins", "link": "https://stackoverflow.com/users/9185797/phins"}, "reply_to_user": {"reputation": 1465, "user_id": 5122006, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/d5d9f38947aef246351984de8786ce8c?s=128&d=identicon&r=PG&f=1", "display_name": "okovko", "link": "https://stackoverflow.com/users/5122006/okovko"}, "edited": false, "score": 1, "creation_date": 1547648983, "post_id": 54217196, "comment_id": 95264092, "body": "@okovko I dont want to fight with you, its my personal opinion. The OP asked for a &quot;direction to follow&quot; so I didnt wrote any code. His intention is only to learn and not to have a solution."}, {"owner": {"reputation": 1465, "user_id": 5122006, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/d5d9f38947aef246351984de8786ce8c?s=128&d=identicon&r=PG&f=1", "display_name": "okovko", "link": "https://stackoverflow.com/users/5122006/okovko"}, "edited": false, "score": 1, "creation_date": 1547649079, "post_id": 54217196, "comment_id": 95264158, "body": "Post suggestions and directions as comments. Post complete working solutions as answers."}, {"owner": {"reputation": 689, "user_id": 9185797, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HJqOX.jpg?s=128&g=1", "display_name": "Phins", "link": "https://stackoverflow.com/users/9185797/phins"}, "reply_to_user": {"reputation": 1465, "user_id": 5122006, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/d5d9f38947aef246351984de8786ce8c?s=128&d=identicon&r=PG&f=1", "display_name": "okovko", "link": "https://stackoverflow.com/users/5122006/okovko"}, "edited": false, "score": 1, "creation_date": 1547835995, "post_id": 54217196, "comment_id": 95343199, "body": "@okovko My reason for down vote was never revange or similar and not because of your comment. In my opinion your code provides bad coding habits to a learning programmer. We should really end this discussion, its going nowhere and wont change anything."}], "tags": [], "owner": {"reputation": 689, "user_id": 9185797, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HJqOX.jpg?s=128&g=1", "display_name": "Phins", "link": "https://stackoverflow.com/users/9185797/phins"}, "is_accepted": false, "score": -1, "last_activity_date": 1547642339, "last_edit_date": 1547642339, "creation_date": 1547642058, "answer_id": 54217196, "question_id": 54217017, "link": "https://stackoverflow.com/questions/54217017/ask-for-text-to-edit-text-formatting/54217196#54217196", "title": "ask for text to edit, text formatting", "body": "<p>The next thing you would need to do is to split your input by a deltimeter (in your case ',') into a vector and later combine everything with pre and posfixes. <strong>C++</strong> does not support splitting by default, you would have to be creative or search for a solution like <a href=\"https://stackoverflow.com/questions/14265581/parse-split-a-string-in-c-using-string-delimiter-standard-c\">here</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 1465, "user_id": 5122006, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/d5d9f38947aef246351984de8786ce8c?s=128&d=identicon&r=PG&f=1", "display_name": "okovko", "link": "https://stackoverflow.com/users/5122006/okovko"}, "reply_to_user": {"reputation": 21, "user_id": 10412944, "user_type": "registered", "profile_image": "https://graph.facebook.com/2689917231033793/picture?type=large", "display_name": "Jules", "link": "https://stackoverflow.com/users/10412944/jules"}, "edited": false, "score": 0, "creation_date": 1547780029, "post_id": 54218114, "comment_id": 95318578, "body": "@Jules you could accept my answer it if you found it helpful. If you need help to understand the code I can explain it better."}], "tags": [], "owner": {"reputation": 1465, "user_id": 5122006, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/d5d9f38947aef246351984de8786ce8c?s=128&d=identicon&r=PG&f=1", "display_name": "okovko", "link": "https://stackoverflow.com/users/5122006/okovko"}, "is_accepted": false, "score": -2, "last_activity_date": 1547647861, "last_edit_date": 1547647861, "creation_date": 1547645272, "answer_id": 54218114, "question_id": 54217017, "link": "https://stackoverflow.com/questions/54217017/ask-for-text-to-edit-text-formatting/54218114#54218114", "title": "ask for text to edit, text formatting", "body": "<p>If you want to keep it really simple, you can detect word boundaries by checking two characters at a time. Here's a working <a href=\"https://repl.it/repls/FirmPapayawhipArtificialintelligence\" rel=\"nofollow noreferrer\">example</a>.</p>\n\n<pre><code>using namespace std;\n\n#include &lt;iostream&gt;\n#include &lt;string&gt;\n\n#include &lt;cctype&gt;\n\ntypedef enum boundary_type_e {\n    E_BOUNDARY_TYPE_ERROR = -1,\n    E_BOUNDARY_TYPE_NONE,\n    E_BOUNDARY_TYPE_LEFT,\n    E_BOUNDARY_TYPE_RIGHT,\n} boundary_type_t;\n\ntypedef struct boundary_s {\n    boundary_type_t type;\n    int pos;\n} boundary_t;\n\nbool is_word_char(int c) {\n    return ' ' &lt;= c &amp;&amp; c &lt;= '~' &amp;&amp; !isspace(c) &amp;&amp; c != ',';\n}\n\nboundary_t maybe_word_boundary(string str, int pos) {\n    int len = str.length();\n    if (pos &lt; 0 || pos &gt;= len) {\n        return (boundary_t){.type = E_BOUNDARY_TYPE_ERROR};\n    } else {\n        if (pos == 0 &amp;&amp; is_word_char(str[pos])) {\n            // if the first character is word-y, we have a left boundary at the beginning\n            return (boundary_t){.type = E_BOUNDARY_TYPE_LEFT, .pos = pos};\n        } else if (pos == len - 1 &amp;&amp; is_word_char(str[pos])) {\n            // if the last character is word-y, we have a right boundary left of the null terminator\n            return (boundary_t){.type = E_BOUNDARY_TYPE_RIGHT, .pos = pos + 1};\n        } else if (!is_word_char(str[pos]) &amp;&amp; is_word_char(str[pos + 1])) {\n            // if we have a delimiter followed by a word char, we have a left boundary left of the word char\n            return (boundary_t){.type = E_BOUNDARY_TYPE_LEFT, .pos = pos + 1};\n        } else if (is_word_char(str[pos]) &amp;&amp; !is_word_char(str[pos + 1])) {\n            // if we have a word char followed by a delimiter, we have a right boundary right of the word char\n            return (boundary_t){.type = E_BOUNDARY_TYPE_RIGHT, .pos = pos + 1};\n        }\n        return (boundary_t){.type = E_BOUNDARY_TYPE_NONE};\n    }\n}\n\nint main() {\n    string str;\n    string ins_left(\"&lt;tag&gt;\");\n    string ins_right(\"&lt;/tag&gt;\");\n    getline(cin, str);\n\n    // can't use length for the loop condition without recalculating it all the time\n    for (int i = 0; str[i] != '\\0'; i++) {\n        boundary_t boundary = maybe_word_boundary(str, i);\n        if (boundary.type == E_BOUNDARY_TYPE_LEFT) {\n            str.insert(boundary.pos, ins_left);\n            i += ins_left.length();\n        } else if (boundary.type == E_BOUNDARY_TYPE_RIGHT) {\n            str.insert(boundary.pos, ins_right);\n            i += ins_right.length();\n        }\n    }\n}\n</code></pre>\n\n<p>It would be better to use <code>enum class</code> but I forgot the notation. You can also copy to a buffer instead of generating the new string in-place, I was just trying to keep it simple. Feel free to expand it to a class based C++ style. To get your exact desired output, strip the spaces first and add spaces to ins_left and ins_right.</p>\n"}], "owner": {"reputation": 21, "user_id": 10412944, "user_type": "registered", "profile_image": "https://graph.facebook.com/2689917231033793/picture?type=large", "display_name": "Jules", "link": "https://stackoverflow.com/users/10412944/jules"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 94, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1547647861, "creation_date": 1547641393, "last_edit_date": 1547645197, "question_id": 54217017, "link": "https://stackoverflow.com/questions/54217017/ask-for-text-to-edit-text-formatting", "title": "ask for text to edit, text formatting", "body": "<p>I would like to make a program that asks for text (a paragraph with several words) that would be separated by commas.\nTo transform the text and add a tag between the two, like to format the text to html text</p>\n\n<p>Example:\n<code>word1, word2, word3</code>\nto\n<code>&lt;a&gt; word1 &lt;/a&gt;, &lt;a&gt; word2 &lt;/a&gt;, &lt;a&gt; word3 &lt;/a&gt;</code></p>\n\n<p>So I started doing this code but I do not know how to continue. How can I test the text to find the front of the word? I imagine with ASCII tests?\nMaybe with a table that will test every case ? </p>\n\n<p>I do not necessarily ask the complete answer but maybe a direction to follow could help.</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;iomanip&gt;\n#include &lt;string&gt; //For getline()\n\nusing namespace std;\n\n// Creating class\nclass GetText\n{\npublic:\n    string text;\n    string line; //Using this as a buffer\n\n    void userText()\n    {\n        cout &lt;&lt; \"Please type a message: \";\n\n        do\n        {\n            getline(cin, line);\n            text += line;\n        }\n        while(line != \"\");\n    }\n\n    void to_string()\n    {\n        cout &lt;&lt; \"\\n\" &lt;&lt; \"User's Text: \" &lt;&lt; \"\\n\" &lt;&lt; text &lt;&lt; endl;\n    }\n};\n\n\nint main() {\n    GetText test;\n    test.userText();\n    test.to_string();\n    system(\"pause\");\n\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c++", "boost", "parameter-passing"], "comments": [{"owner": {"reputation": 3524, "user_id": 4950448, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/907276442666522/picture?type=large", "display_name": "Antoine Morrier", "link": "https://stackoverflow.com/users/4950448/antoine-morrier"}, "edited": false, "score": 0, "creation_date": 1547641971, "post_id": 54216877, "comment_id": 95259884, "body": "Use <code>using</code> instead of <code>typedef</code>"}, {"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 1, "creation_date": 1547643575, "post_id": 54216877, "comment_id": 95260789, "body": "Can you make the function template to avoid copy ?"}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "reply_to_user": {"reputation": 3524, "user_id": 4950448, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/907276442666522/picture?type=large", "display_name": "Antoine Morrier", "link": "https://stackoverflow.com/users/4950448/antoine-morrier"}, "edited": false, "score": 0, "creation_date": 1547644951, "post_id": 54216877, "comment_id": 95261543, "body": "@AntoineMorrier why?"}, {"owner": {"reputation": 3524, "user_id": 4950448, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/907276442666522/picture?type=large", "display_name": "Antoine Morrier", "link": "https://stackoverflow.com/users/4950448/antoine-morrier"}, "edited": false, "score": 0, "creation_date": 1547645356, "post_id": 54216877, "comment_id": 95261786, "body": "It is not an answer to the question, but it is an advice since <code>using</code> is preferred as <code>typedef</code> in cpp"}], "answers": [{"comments": [{"owner": {"reputation": 5040, "user_id": 1302888, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/zUnRf.png?s=128&g=1", "display_name": "BmyGuest", "link": "https://stackoverflow.com/users/1302888/bmyguest"}, "edited": false, "score": 0, "creation_date": 1547642560, "post_id": 54216935, "comment_id": 95260186, "body": "Thanks for the tip. The overload does not really work for me, but the constructor-overload does. (The method belongs to a class which should not know about the derived objects.)"}, {"owner": {"reputation": 34388, "user_id": 2610810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8c6433073e71478e8da278a188e1d15?s=128&d=identicon&r=PG", "display_name": "Caleth", "link": "https://stackoverflow.com/users/2610810/caleth"}, "edited": false, "score": 0, "creation_date": 1547645272, "post_id": 54216935, "comment_id": 95261726, "body": "I&#39;d also suggest overloading the function with a template that takes a pair of iterators"}], "tags": [], "owner": {"reputation": 83151, "user_id": 3943312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc00b38b94ca7b6f820622b0a8af8ded?s=128&d=identicon&r=PG", "display_name": "Sam Varshavchik", "link": "https://stackoverflow.com/users/3943312/sam-varshavchik"}, "is_accepted": true, "score": 4, "last_activity_date": 1547641096, "creation_date": 1547641096, "answer_id": 54216935, "question_id": 54216877, "link": "https://stackoverflow.com/questions/54216877/passing-a-vector-of-smart-pointers-of-derived-objects-what-is-the-best-solutio/54216935#54216935", "title": "Passing a vector of smart pointers of derived objects - what is the best solution?", "body": "<p>Simply use the <code>std::vector</code> constructor overload that takes two iterators, to construct a temporary:</p>\n\n<pre><code> Method( {myVec.begin(), myVec.end()} )\n</code></pre>\n\n<p>You can also declare an overload of <code>Method()</code> that takes the vector of derived pointers, for convenience, and just does this. This will prevent some code bloat when this is done frequently.</p>\n"}], "owner": {"reputation": 5040, "user_id": 1302888, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/zUnRf.png?s=128&g=1", "display_name": "BmyGuest", "link": "https://stackoverflow.com/users/1302888/bmyguest"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 54216935, "answer_count": 1, "score": 0, "last_activity_date": 1547641096, "creation_date": 1547640883, "question_id": 54216877, "link": "https://stackoverflow.com/questions/54216877/passing-a-vector-of-smart-pointers-of-derived-objects-what-is-the-best-solutio", "title": "Passing a vector of smart pointers of derived objects - what is the best solution?", "body": "<p>I'm using boost smart pointers of two classes</p>\n\n<pre><code>class Foo{\n};\n\nclass Derived : public Foo{\n};\n\ntypedef boost::shared_ptr&lt;Foo&gt; FooPtr;\ntypedef boost::shared_ptr&lt;Derived&gt; DerivedPtr;\n</code></pre>\n\n<p>And I keep a vector of my objects as</p>\n\n<pre><code>std::vector&lt;DerivedPtr&gt; myVec;\n</code></pre>\n\n<p>which I want to use in a method requesting a vector of the base class smart pointers. </p>\n\n<pre><code>Method( std::vector&lt;FooPtr&gt; input ){\n... }\n</code></pre>\n\n<p>Using the vector directly, gives an error on compiling.  </p>\n\n<blockquote>\n  <p><code>cannot convert argument 1 from 'std::vector&lt;DerivedPtr,std::allocator&lt;_Ty&gt;&gt;' to 'std::vector&lt;FooPtr, std::allocator&lt;_Ty&gt;&gt;'</code></p>\n</blockquote>\n\n<p>So my current <em>solution</em> is to first 'down-cast' my vector into a new vector of the base class pointers before passing it on:</p>\n\n<pre><code>std::vector&lt;FooPtr&gt; downCastVec;\nfor ( auto &amp; iter : myVec )\n    downCastVec.push_back( iter );\n\nMethod( downCastVec );\n</code></pre>\n\n<p>This works, but my actual question is:</p>\n\n<p><strong>Is there a better/more elegant way to deal with this problem?</strong></p>\n"}, {"tags": ["c++", "qt", "sockets"], "comments": [{"owner": {"reputation": 9720, "user_id": 6371123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f90991c1b06c79ae4c6e79fb616d608?s=128&d=identicon&r=PG", "display_name": "G.M.", "link": "https://stackoverflow.com/users/6371123/g-m"}, "edited": false, "score": 1, "creation_date": 1547642472, "post_id": 54216722, "comment_id": 95260147, "body": "Does Win 8.1 Pro implement a  <code>POSIX.1-2001</code> layer?  If so a call to <code>::setsockopt(mNetServer.socketDescriptor(), SOL_SOCKET, SO_REUSEADDR, ...)</code> should do the trick and should be portable across most OSs."}, {"owner": {"reputation": 1205, "user_id": 2846068, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kHfXv.jpg?s=128&g=1", "display_name": "MasterAler", "link": "https://stackoverflow.com/users/2846068/masteraler"}, "reply_to_user": {"reputation": 9720, "user_id": 6371123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f90991c1b06c79ae4c6e79fb616d608?s=128&d=identicon&r=PG", "display_name": "G.M.", "link": "https://stackoverflow.com/users/6371123/g-m"}, "edited": false, "score": 0, "creation_date": 1547643097, "post_id": 54216722, "comment_id": 95260511, "body": "@G.M., Maybe I&#39;m wrong, but socketDescriptor is set either in <code>listen()</code> implicitly or in <code>setSocketDescriptor()</code> explicitly, where it has to be in a &quot;listen&quot; state. Do you mean I&#39;ll have to implement everything -- configuring, binding &amp; listening of the socket myself? \u043e\u041e"}], "answers": [{"tags": [], "owner": {"reputation": 1205, "user_id": 2846068, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kHfXv.jpg?s=128&g=1", "display_name": "MasterAler", "link": "https://stackoverflow.com/users/2846068/masteraler"}, "is_accepted": true, "score": 0, "last_activity_date": 1548260371, "creation_date": 1548260371, "answer_id": 54331518, "question_id": 54216722, "link": "https://stackoverflow.com/questions/54216722/qtcpserver-bind-socket-with-custom-options/54331518#54331518", "title": "QTcpServer: bind socket with custom options", "body": "<p>Took me a while to consider all the possible solutions, though there were not many of them at all.</p>\n\n<ol>\n<li><a href=\"https://stackoverflow.com/questions/47268023/how-to-set-so-reuseaddr-on-the-socket-used-by-qtcpserver\">Here</a> I found something looking much like my problem. Made an adaptation of the code, provided there... Okay, just took most of it from that answer =)</li>\n<li>@G.M.'s comment  pushed me to the idea that socket api in this case should differ only in headers</li>\n</ol>\n\n<p>Manuals told me that <strong>SO_LINGER</strong> flag is often a result of bad architecture (client should close the connection in most cases, not server), after several experiments it occured this flag wasn't of much use in my case. </p>\n\n<p>Binding to the exact IP lead to several complexities, more of a crutch than a solution IMHO.</p>\n\n<p>So, after minor adaptations the socket listening class became something like that:</p>\n\n<p><strong>QTcpServer2.h</strong></p>\n\n<pre><code>#pragma once\n\n#include &lt;QTcpServer&gt;\n#include &lt;QMutex&gt;\n\nclass QTcpServer2 : public QTcpServer\n{\n  QMutex            mConnectionMutex;\n  QList&lt;qintptr&gt;    mSocketDescriptors;\n  const int         mPort;\n  bool              mConnectionSuccessful;\n\nprivate:\n  /*override */virtual void incomingConnection(qintptr socketDescriptor) Q_DECL_OVERRIDE;\n\npublic:\n  bool TakeIncomingSocketDescription(qintptr&amp; socketDescriptor);\n\n  bool isConnectionSuccessfull() const\n  { return mConnectionSuccessful; }\n\npublic:\n  QTcpServer2(int port);\n};\n</code></pre>\n\n<p><strong>QTcpServer.cpp</strong></p>\n\n<pre><code>#include \"QTcpServer2.h\"\n\n#include &lt;QMutexLocker&gt;\n\n#ifdef Q_OS_WIN\n    #include &lt;Windows.h&gt;\n    #pragma comment(lib, \"ws2_32.lib\")\n#endif\n\n#ifdef Q_OS_LINUX\n    #include &lt;sys/socket.h&gt;\n    #include &lt;netinet/in.h&gt;\n    #include &lt;netinet/tcp.h&gt;\n#endif\n\nvoid QTcpServer2::incomingConnection(qintptr socketDescriptor)\n{\n    QMutexLocker lock(&amp;mConnectionMutex);\n    mSocketDescriptors.append(socketDescriptor);\n}\n\nbool QTcpServer2::TakeIncomingSocketDescription(qintptr&amp; socketDescriptor)\n{\n    QMutexLocker lock(&amp;mConnectionMutex);\n    if (mSocketDescriptors.empty()) {\n        return false;\n    }\n    socketDescriptor = mSocketDescriptors.takeFirst();\n    return true;\n}\n\nQTcpServer2::QTcpServer2(int port)\n    : QTcpServer()\n    , mPort(port)\n    , mConnectionSuccessful(false)\n{\n    // open server and listen on given port\n    int sockfd = 0;\n    struct sockaddr_in serv_addr;\n    memset(&amp;serv_addr, 0, sizeof(serv_addr));\n\n    sockfd = ::socket(AF_INET, SOCK_STREAM, 0);\n    if(sockfd &lt; 0)\n    {\n        qDedug() &lt;&lt; \"QTcpServer2: socket couldn't be opened successfully!\";\n        return; //RET\n    }\n\n#ifdef Q_OS_WIN\n    // Not required in Linux, won't make any good \n    int flag = 1;\n    if(::setsockopt(sockfd, SOL_SOCKET, SO_REUSEADDR, reinterpret_cast&lt;char*&gt;(&amp;flag), sizeof(int)) &lt; 0)\n    {\n        qDedug() &lt;&lt; \"QTcpServer2: Can't set SO_REUSEADDR\";\n        return; //RET\n    }\n#endif\n\n    //set Address,IFace, Port...\n    serv_addr.sin_family = AF_INET;\n    serv_addr.sin_addr.s_addr = INADDR_ANY;\n    serv_addr.sin_port = htons(static_cast&lt;ushort&gt;(mPort));\n\n\n    if (::bind(sockfd, (struct sockaddr *) &amp;serv_addr, sizeof(sockaddr_in)) &lt; 0)\n    {\n        qDedug() &lt;&lt; \"QTcpServer2: can't bind socket\" ;\n        return; //RET\n    }\n\n    if(::listen(sockfd, SOMAXCONN) &lt; 0)\n    {\n        qDedug() &lt;&lt; \"QTcpServer2: can't listen on port\";\n        return; //RET\n    }\n\n    //forward our descriptor with SO_REUSEPORT to QTcpServer member\n    setSocketDescriptor(sockfd);\n    mConnectionSuccessful = true;\n    qDedug() &lt;&lt; \"QTcpServer2: socket success =)\";\n}\n</code></pre>\n\n<p>As long as the \"magical problem with sockets\" appeared on Windows 8.1 only, <code>#define</code> makes <strong>SO_REUSEADDR</strong> used on Windows only. On Linux Qt already sets this flag by itself (as shown in the question), so this small patch only improved Windows behavior to match the desired one, provided on Linux without problems.</p>\n\n<p>Hopefully, nothing like that would ever be of need on other platforms.</p>\n"}], "owner": {"reputation": 1205, "user_id": 2846068, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kHfXv.jpg?s=128&g=1", "display_name": "MasterAler", "link": "https://stackoverflow.com/users/2846068/masteraler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 498, "favorite_count": 1, "accepted_answer_id": 54331518, "answer_count": 1, "score": 1, "last_activity_date": 1548260415, "creation_date": 1547640337, "last_edit_date": 1548260415, "question_id": 54216722, "link": "https://stackoverflow.com/questions/54216722/qtcpserver-bind-socket-with-custom-options", "title": "QTcpServer: bind socket with custom options", "body": "<p>So, here I've got some complex client-server application and some part of it opens port for listening and further network interactions. <code>QTcpServer</code> + <code>QTcpSocket</code> are used (the details will be described below).</p>\n\n<p>This \"network layer\" of the application worked fine everywhere, except Windows 8.1 Pro. Just don't ask, why our client de\u0441ided, that it could be used as a server... It occured, that incorrect restarting of the process, which opened TCP connection on a specific port for listening causes sometimes this port to be unsuitable for any following attempts to bind it. It looks like some sort of magic, but the behavior occured as follows:</p>\n\n<ul>\n<li>Port 8554 was listened (\"conection -- established\") by a process</li>\n<li>Process crashes or killed somehow while having clients connected via this socket</li>\n<li>Process restarts and attempts to listen on the port again. It fails with \"already in use\".</li>\n<li>I stop the server and try to check the port via <code>netstat -an</code>. It's free.</li>\n<li><p>I wait for some time and try to check the port via powershell, like: </p>\n\n<pre><code>$Listener = [System.Net.Sockets.TcpListener]8554\n$Listener.Start()\n</code></pre>\n\n<p>No, this leads to the same error like \"already in use\".</p></li>\n<li>I can bind socket to the other port, powershell snippet also works on them. But emergency restart of our server \"breaks\" them as well, scenario is the same.</li>\n<li>Once the port is \"broken\", windows restart is the only cure to it.</li>\n<li>Binding to \"any address\", i.e. <code>0.0.0.0:8554</code> behaves as described. Binding to exact IP, like <code>10.11.12.123:8554</code> is better, checked it while trying to bind FileZilla on the \"broken port\".</li>\n</ul>\n\n<p>Now goes the coding problem. Providing exact IP for binding looks like a bad idea, a least in our architecture, so I decided to use <strong>SO_REUSEADDR</strong> on Windows. But looks like I have to set this option <em>before</em> bind/listen calls, which leads to significant <code>QTcpServer</code> usage customizing. Keep in mind that the application is crossplatform (WinSock + sys/socket + some #defines if something other than Qt methods are to be used...). Aaaand there goes my favourite legacy version of <code>QTcpServer</code> customization, take a look:</p>\n\n<p><strong>QTcpServer2.h</strong></p>\n\n<pre><code>#pragma once\n\n#include &lt;QTcpServer&gt;\n#include &lt;QMutex&gt;\n\nclass QTcpServer2 : public QTcpServer\n{\n  QMutex         mConnectionMutex;\n  QList&lt;qintptr&gt; mSocketDescriptors;\n\nprivate:\n  virtual void incomingConnection(qintptr socketDescriptor) override;\n\npublic:\n  bool TakeIncomingSocketDescription(qintptr&amp; socketDescriptor);\n\npublic:\n  QTcpServer2();\n};\n</code></pre>\n\n<p><strong>QTcpServer2.cpp</strong></p>\n\n<pre><code>#include &lt;QMutexLocker&gt;\n\n#include \"QTcpServer2.h\"\n\nvoid QTcpServer2::incomingConnection(qintptr socketDescriptor)\n{\n  QMutexLocker lock(&amp;mConnectionMutex);\n  mSocketDescriptors.append(socketDescriptor);\n}\n\nbool QTcpServer2::TakeIncomingSocketDescription(qintptr&amp; socketDescriptor)\n{\n  QMutexLocker lock(&amp;mConnectionMutex);\n  if (mSocketDescriptors.empty()) {\n    return false;\n  }\n  socketDescriptor = mSocketDescriptors.takeFirst();\n  return true;\n}\n\nQTcpServer2::QTcpServer2()\n{ }\n</code></pre>\n\n<p><strong>Usage:</strong></p>\n\n<pre><code>bool NetServer::DoInitConnection()\n{\n  mNetServer = QSharedPointer&lt;QTcpServer2&gt;(new QTcpServer2);\n  if (!mNetServer-&gt;listen(QHostAddress::AnyIPv4, mPort)) {\n    Log.Fatal(QString(\"Listen port fail (port: %1)\").arg(mPort), true);\n    return false;\n  }\n  return true;\n}\n</code></pre>\n\n<p><em>Sigh...</em> Yeah, I know about pending connections mechanism, about signal-slot idea, but that's out code for now. <code>TakeIncomingSocketDescription</code> is used to pass socket descriptor somewhere. And threaded access, yes. Anyway, this piece of... code needs refactoring and I badly need your piece of advice: <strong>what's the apropriate way to customize socket binding here?</strong> Assume that subclassing stays, list of descriptors is also something not-so-easy to get rid of.</p>\n\n<p>Qt Sources showed me the following:</p>\n\n<pre><code>/*! \\internal\n*/\nvoid QTcpServerPrivate::configureCreatedSocket()\n{\n#if defined(Q_OS_UNIX)\n    // Under Unix, we want to be able to bind to the port, even if a socket on\n    // the same address-port is in TIME_WAIT. Under Windows this is possible\n    // anyway -- furthermore, the meaning of reusable on Windows is different:\n    // it means that you can use the same address-port for multiple listening\n    // sockets.\n    // Don't abort though if we can't set that option. For example the socks\n    // engine doesn't support that option, but that shouldn't prevent us from\n    // trying to bind/listen.\n    socketEngine-&gt;setOption(QAbstractSocketEngine::AddressReusable, 1);\n#endif\n}\n</code></pre>\n\n<p>That's exactly what I want, but there is no access to these internals from the Qt classes interface. <code>QTcpServer</code> performs <code>bind</code> call implicitly, so I cannot pass <code>QAbstractSocket::ReuseAddressHint</code> there. </p>\n\n<p>Possibly, there is some neat solution, possibly not. I would be grateful for any ideas.</p>\n"}, {"tags": ["c++", "class", "cuda"], "comments": [{"owner": {"reputation": 252, "user_id": 5364211, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ixqyo.jpg?s=128&g=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/5364211/tom"}, "edited": false, "score": 0, "creation_date": 1547641688, "post_id": 54216689, "comment_id": 95259745, "body": "Where exactly do you get this error?"}, {"owner": {"reputation": 51, "user_id": 10340933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4a4ff90d83b4be3729bebd13cc3a5b1?s=128&d=identicon&r=PG&f=1", "display_name": "subratappt", "link": "https://stackoverflow.com/users/10340933/subratappt"}, "reply_to_user": {"reputation": 252, "user_id": 5364211, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ixqyo.jpg?s=128&g=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/5364211/tom"}, "edited": false, "score": 0, "creation_date": 1547642404, "post_id": 54216689, "comment_id": 95260115, "body": "during <code>.&#47;a.out</code>"}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 1, "creation_date": 1547642693, "post_id": 54216689, "comment_id": 95260257, "body": "You can&#39;t use host-allocated memory (the stuff you got from <code>new</code>) in a kernel."}, {"owner": {"reputation": 51, "user_id": 10340933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4a4ff90d83b4be3729bebd13cc3a5b1?s=128&d=identicon&r=PG&f=1", "display_name": "subratappt", "link": "https://stackoverflow.com/users/10340933/subratappt"}, "edited": false, "score": 0, "creation_date": 1547642933, "post_id": 54216689, "comment_id": 95260404, "body": "could you please explain this ?"}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1547643215, "post_id": 54216689, "comment_id": 95260574, "body": "You&#39;re also misunderstanding how the memory allocation works. To allocate device memory for an object of type <code>T</code>, you would <code>T* p = nullptr; cudaError_t error = cudaMallocManaged(&amp;p, sizeof(T));</code> and if it succeeds, <code>p</code> holds the address of the allocated memory (but not of an object; the memory is unintialised). It&#39;s very similar to <code>T* p = malloc(sizeof(T));</code> in C."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1547643438, "post_id": 54216689, "comment_id": 95260702, "body": "@subratappt A CUDA kernel can only use memory that was allocated for kernel use through the CUDA API. <code>new</code> allocates host (CPU) memory. I suspect that you need to study some more before continuing."}, {"owner": {"reputation": 51, "user_id": 10340933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4a4ff90d83b4be3729bebd13cc3a5b1?s=128&d=identicon&r=PG&f=1", "display_name": "subratappt", "link": "https://stackoverflow.com/users/10340933/subratappt"}, "edited": false, "score": 0, "creation_date": 1547649195, "post_id": 54216689, "comment_id": 95264242, "body": "I could not find any solution for this, can you help ?"}], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 10340933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4a4ff90d83b4be3729bebd13cc3a5b1?s=128&d=identicon&r=PG&f=1", "display_name": "subratappt", "link": "https://stackoverflow.com/users/10340933/subratappt"}, "edited": false, "score": 0, "creation_date": 1547662094, "post_id": 54222522, "comment_id": 95271656, "body": "Thank you sir, thanks a lot... I just read the article also <a href=\"https://devblogs.nvidia.com/unified-memory-in-cuda-6/\" rel=\"nofollow noreferrer\">link</a>. Your answer and the article make everything clear."}, {"owner": {"reputation": 51, "user_id": 10340933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4a4ff90d83b4be3729bebd13cc3a5b1?s=128&d=identicon&r=PG&f=1", "display_name": "subratappt", "link": "https://stackoverflow.com/users/10340933/subratappt"}, "edited": false, "score": 0, "creation_date": 1547824651, "post_id": 54222522, "comment_id": 95337584, "body": "Can I write different version of constructor, copy constructor etc for <code>host</code> and <code>device</code>  using <code>#ifdef __CUDA_ARCH__</code> then <code>device</code> constructor which will contain <code>new</code>, else the host code which will contain  <code>cudaMallocManaged</code> etc. <code>#endif</code>, so that I can call the class inside device code."}, {"owner": {"reputation": 119299, "user_id": 1695960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f557c03db19232aa410540af2f966?s=128&d=identicon&r=PG", "display_name": "Robert Crovella", "link": "https://stackoverflow.com/users/1695960/robert-crovella"}, "reply_to_user": {"reputation": 51, "user_id": 10340933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4a4ff90d83b4be3729bebd13cc3a5b1?s=128&d=identicon&r=PG&f=1", "display_name": "subratappt", "link": "https://stackoverflow.com/users/10340933/subratappt"}, "edited": false, "score": 0, "creation_date": 1547824794, "post_id": 54222522, "comment_id": 95337689, "body": "Yes, it should be possible.  Why not just try it?  However, a <code>Matrix</code> object created on the device with in-kernel <code>new</code> operator will not be interoperable with the host.  That is, there would be no way to directly transfer that matrix object to the host.  You would have to copy that matrix object to some other matrix object that was created in host code, before you could transfer the contents to the host."}, {"owner": {"reputation": 144, "user_id": 8299684, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/13e72908732ef4648880cd34f9b0279d?s=128&d=identicon&r=PG", "display_name": "Raskell", "link": "https://stackoverflow.com/users/8299684/raskell"}, "edited": false, "score": 0, "creation_date": 1578497874, "post_id": 54222522, "comment_id": 105459456, "body": "@RobertCrovella is there any semantic difference between passing an <code>int</code> to <code>Matrix</code> compared to <code>size_t</code>?"}, {"owner": {"reputation": 119299, "user_id": 1695960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f557c03db19232aa410540af2f966?s=128&d=identicon&r=PG", "display_name": "Robert Crovella", "link": "https://stackoverflow.com/users/1695960/robert-crovella"}, "edited": false, "score": 0, "creation_date": 1578498676, "post_id": 54222522, "comment_id": 105459934, "body": "on linux, <code>int</code> is 32 bits (signed), <code>size_t</code> (on 64-bit linux, which is the only thing that matters currently) is 64-bits (unsigned).  But with respect to this code, I believe I am simply following the prompt given by OP&#39;s code."}], "tags": [], "owner": {"reputation": 119299, "user_id": 1695960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f557c03db19232aa410540af2f966?s=128&d=identicon&r=PG", "display_name": "Robert Crovella", "link": "https://stackoverflow.com/users/1695960/robert-crovella"}, "is_accepted": false, "score": 3, "last_activity_date": 1547660349, "creation_date": 1547660349, "answer_id": 54222522, "question_id": 54216689, "link": "https://stackoverflow.com/questions/54216689/how-to-pass-class-object-to-cuda-kernel/54222522#54222522", "title": "How to pass Class object to CUDA kernel", "body": "<p>There are a variety of problems with your code.  I'm not sure I will mention all of them, so study the differences between my files and yours.</p>\n\n<ol>\n<li><p>If you want to allocate data that is usable on both host and device from host code, you must use <code>cudaMallocManaged</code>.  You cannot use host <code>new</code> operator (unless you have overloaded it for a specific class, which you haven't and is not possible for base classes like <code>double</code>).</p></li>\n<li><p>Likewise you have to free those allocations using <code>cudaFree</code>.  </p></li>\n<li><p>Your host allocation of the R matrix is not correct.  You assigned <code>pR</code> to the address of <code>R</code>, which won't work, because R is not a managed allocation, and you then overwrote that with a call to <code>cudaMallocManaged</code>.  Just broken.</p></li>\n<li><p>When we use <code>cudaMallocManaged</code>,  a class method using that cannot be marked <code>__device__</code>.  That API is only usable in host code.</p></li>\n</ol>\n\n<p>The following represents the smallest number of changes I could make, covering the items above, to get your code working:</p>\n\n<pre><code>$ cat matrixCU.h\n#ifndef __MATRIXCUDA_H__\n#define __MATRIXCUDA_H__\n#include &lt;iostream&gt;\nclass Matrix{\n    private:\n    std::size_t height,width,sizeArray;\n    double *array;\n\npublic:\n           __host__ Matrix();\n           __host__ Matrix(std::size_t);\n           __host__ Matrix(std::size_t,std::size_t);\n           __host__ Matrix(const Matrix &amp;);\n           __host__ Matrix &amp;operator=(const Matrix &amp;mat);\n           __host__ ~Matrix();\n__device__ __host__ void assignValue(std::size_t,std::size_t, double);\n__device__ __host__ void assignValue(std::size_t , double );\n__device__ __host__ void displayArray();\n};\n#endif\n$ cat matrixCU.cu\n#include &lt;iostream&gt;\n#include &lt;cstdio&gt;\n        #include\"matrixCU.h\"\n        Matrix::Matrix(){\n            height = 1;\n            width = 1;\n            sizeArray = height*width;\n            cudaError_t err = cudaMallocManaged(&amp;array,sizeArray*sizeof(array[0]));\n            if (err != cudaSuccess)\n            {\n                //cout &lt;&lt; \"Memory allocation failed\"&lt;&lt;endl;\n                printf(\"Memory allocation failed\");\n            }\n        }\n\n        Matrix::Matrix(size_t h){\n            height = h;\n            width = 1;\n            sizeArray = height*width;\n            cudaError_t err = cudaMallocManaged(&amp;array,sizeArray*sizeof(array[0]));\n            if (err != cudaSuccess)\n            {\n                //cout &lt;&lt; \"Memory allocation failed\"&lt;&lt;endl;\n                printf(\"Memory allocation failed\");\n            }\n        }\n\n        Matrix::Matrix(size_t h,size_t w){\n            height = h;\n            width = w;\n            sizeArray = height*width;\n            cudaError_t err = cudaMallocManaged(&amp;array,sizeArray*sizeof(array[0]));\n\n            if (err != cudaSuccess)\n            {\n                //cout &lt;&lt; \"Memory allocation failed\"&lt;&lt;endl;\n                printf(\"Memory allocation failed\");\n            }\n\n        }\n\n        Matrix::Matrix(const Matrix &amp;mat){\n            height = mat.height;\n            width = mat.width;\n            sizeArray = mat.sizeArray;\n            cudaError_t err = cudaMallocManaged(&amp;array,sizeArray*sizeof(array[0]));\n            if (err != cudaSuccess)\n            {\n                //cout &lt;&lt; \"Memory allocation failed\"&lt;&lt;endl;\n                printf(\"Memory allocation failed\");\n            }\n\n            for(size_t i = 0;i&lt;sizeArray;++i){\n            array[i] = mat.array[i];\n            }\n\n        //copy(mat.array,mat.array+mat.sizeArray,array);\n        }\n\n        Matrix &amp;Matrix::operator=(const Matrix &amp;mat){\n            height = mat.height;\n            width = mat.width;\n            sizeArray = mat.sizeArray;\n            cudaError_t err = cudaMallocManaged(&amp;array,sizeArray*sizeof(array[0]));\n            if (err != cudaSuccess)\n            {\n                //cout &lt;&lt; \"Memory allocation failed\"&lt;&lt;endl;\n                printf(\"Memory allocation failed\");\n            }\n\n            for(size_t i = 0;i&lt;sizeArray;++i){\n            array[i] = mat.array[i];\n            }\n\n            //copy(mat.array,mat.array+mat.sizeArray,array);\n            return *this;\n        }\n\n        Matrix::~Matrix(){\n            cudaFree(array);\n        }\n        void Matrix::assignValue(size_t i,size_t j, double value){\n            size_t l = i*width + j;\n            array[l] = value;\n        }\n\n        void Matrix::assignValue(size_t l, double value){\n            array[l] = value;\n        }\n\n        void Matrix::displayArray(){\n            size_t i,j,l;\n            for(i=0;i&lt;height;++i){\n                for(j=0;j&lt;width;++j){\n                    l =i*width + j;\n                    //cout&lt;&lt;array[l]&lt;&lt;\"\\t\";\n                    printf(\"%f\\t\",array[l]);\n                }\n                //cout&lt;&lt;endl;\n                printf(\"\\n\");\n            }\n        }\n$ cat main.cu\n     #include&lt;iostream&gt;\n        #include\"matrixCU.h\"\n        #include&lt;curand_kernel.h&gt;\n\n        const int N=1000;\n\n        __global__ void initialize(Matrix *R){\n            int i= blockIdx.x*blockDim.x + threadIdx.x;\n            if(i&lt;N){\n                curandState state;\n                curand_init(clock64(), i, 0, &amp;state);\n                R-&gt;assignValue(i,curand_uniform(&amp;state));\n            }\n        }\n\n        int main(){\n            Matrix R(N);\n            Matrix *pR;\n            cudaMallocManaged(&amp;pR,sizeof(Matrix));\n            *pR = R;\n            initialize&lt;&lt;&lt;4,256&gt;&gt;&gt;(pR);\n            cudaDeviceSynchronize();\n            pR-&gt;displayArray();\n            return 0;\n        }\n$ nvcc -rdc=true -o test matrixCU.cu main.cu\n$ cuda-memcheck ./test\n========= CUDA-MEMCHECK\n0.071004\n0.881221\n0.136314\n0.365471\n0.869905\n0.786048\n0.072587\n0.977478\n0.090027\n0.784501\n0.956906\n0.886720\n0.716731\n0.990675\n0.855763\n0.572306\n0.926382\n0.088547\n0.690107\n0.693889\n0.603796\n0.380563\n0.535087\n0.162159\n0.130997\n0.791521\n0.033966\n0.186036\n0.717896\n0.737800\n0.401380\n0.298967\n0.437803\n0.783576\n0.644548\n0.180492\n0.048909\n0.058355\n0.890834\n0.822247\n0.957458\n0.464835\n0.260732\n0.765984\n0.095627\n0.696827\n0.967914\n0.648809\n0.475668\n0.724241\n0.329649\n0.651475\n0.783935\n0.061218\n0.193391\n0.731417\n0.001546\n0.057500\n0.549647\n0.923320\n0.480090\n0.780765\n0.562150\n0.415062\n0.993346\n0.619210\n0.573613\n0.788595\n0.089867\n0.126398\n0.393461\n0.031120\n0.562209\n0.860722\n0.029709\n0.020258\n0.032154\n0.959066\n0.539097\n0.051973\n0.597740\n0.309279\n0.064356\n0.165475\n0.936288\n0.936569\n0.940147\n0.809314\n0.385906\n0.737780\n0.245182\n0.617622\n0.804020\n0.075155\n0.014515\n0.142879\n0.705339\n0.163538\n0.318771\n0.065821\n0.501200\n0.488487\n0.554761\n0.026746\n0.731280\n0.591759\n0.402278\n0.027762\n0.646197\n0.483466\n0.636325\n0.958660\n0.284055\n0.688907\n0.863734\n0.177655\n0.372774\n0.309040\n0.890085\n0.892424\n0.559866\n0.890482\n0.746828\n0.664398\n0.082499\n0.519862\n0.822739\n0.930987\n0.375726\n0.761936\n0.609439\n0.508076\n0.297762\n0.831960\n0.277791\n0.810657\n0.605123\n0.454552\n0.239150\n0.983239\n0.912615\n0.724977\n0.280365\n0.738776\n0.299132\n0.011427\n0.816369\n0.101436\n0.486195\n0.969667\n0.641677\n0.891698\n0.558882\n0.872550\n0.105379\n0.161112\n0.530537\n0.366833\n0.097867\n0.121119\n0.827264\n0.533857\n0.874313\n0.405111\n0.982588\n0.191437\n0.950727\n0.036380\n0.284657\n0.344919\n0.727332\n0.086354\n0.403660\n0.156581\n0.113123\n0.909607\n0.032325\n0.993558\n0.780771\n0.189485\n0.337643\n0.368653\n0.975085\n0.607430\n0.637252\n0.102953\n0.431206\n0.505485\n0.581307\n0.674293\n0.916469\n0.334928\n0.000439\n0.364342\n0.311674\n0.824597\n0.364305\n0.624897\n0.094010\n0.244369\n0.295886\n0.686752\n0.237741\n0.418019\n0.429948\n0.808117\n0.641755\n0.874406\n0.780955\n0.843963\n0.280321\n0.644448\n0.973191\n0.656018\n0.413099\n0.666328\n0.098870\n0.488157\n0.813085\n0.310812\n0.603307\n0.935658\n0.681021\n0.730611\n0.271459\n0.618244\n0.546704\n0.420874\n0.847286\n0.837329\n0.571176\n0.162310\n0.969490\n0.814732\n0.620176\n0.285194\n0.565309\n0.827454\n0.381201\n0.354889\n0.120400\n0.559674\n0.784813\n0.784853\n0.204673\n0.026896\n0.942334\n0.191417\n0.599667\n0.623399\n0.171693\n0.664806\n0.550268\n0.182918\n0.546951\n0.515124\n0.310977\n0.626322\n0.755771\n0.814052\n0.577685\n0.921988\n0.809203\n0.880358\n0.628649\n0.826777\n0.466531\n0.522288\n0.650234\n0.642578\n0.692523\n0.925580\n0.417366\n0.744375\n0.212205\n0.100794\n0.682757\n0.349675\n0.448193\n0.763235\n0.446690\n0.626758\n0.479309\n0.966294\n0.095116\n0.247121\n0.423500\n0.694378\n0.684999\n0.436070\n0.985427\n0.124690\n0.830675\n0.523437\n0.290435\n0.477991\n0.607785\n0.583163\n0.887029\n0.594623\n0.282790\n0.981283\n0.345953\n0.132277\n0.052429\n0.419485\n0.495071\n0.716816\n0.019688\n0.046086\n0.556042\n0.175318\n0.858782\n0.587863\n0.229087\n0.248072\n0.151296\n0.930247\n0.583634\n0.200742\n0.602250\n0.243866\n0.937832\n0.964248\n0.541182\n0.566934\n0.528167\n0.455638\n0.337338\n0.915541\n0.014845\n0.812097\n0.387962\n0.814644\n0.561018\n0.446411\n0.196474\n0.529297\n0.027990\n0.143012\n0.486798\n0.501173\n0.103471\n0.492401\n0.165220\n0.262854\n0.306416\n0.891005\n0.148543\n0.488292\n0.560061\n0.139010\n0.741020\n0.592255\n0.877501\n0.094123\n0.853003\n0.953739\n0.468713\n0.038470\n0.055537\n0.785538\n0.032234\n0.653423\n0.006316\n0.742476\n0.262429\n0.538420\n0.948191\n0.422741\n0.947780\n0.118863\n0.251957\n0.491484\n0.657505\n0.467903\n0.379952\n0.670963\n0.635206\n0.218026\n0.246661\n0.019329\n0.353579\n0.738275\n0.115951\n0.245934\n0.362565\n0.339475\n0.195376\n0.287473\n0.610410\n0.711066\n0.295927\n0.602231\n0.085744\n0.783727\n0.211958\n0.558423\n0.581048\n0.840549\n0.919790\n0.908709\n0.710892\n0.142209\n0.259798\n0.358526\n0.982587\n0.729312\n0.355643\n0.972439\n0.066963\n0.766495\n0.455677\n0.335058\n0.105249\n0.347533\n0.556705\n0.642309\n0.449140\n0.237073\n0.923077\n0.855320\n0.121969\n0.686332\n0.543143\n0.281068\n0.167924\n0.207383\n0.808131\n0.665351\n0.441563\n0.628264\n0.834018\n0.730585\n0.119630\n0.214248\n0.118301\n0.998303\n0.345904\n0.907547\n0.575551\n0.498900\n0.031708\n0.056363\n0.971347\n0.048892\n0.904331\n0.728991\n0.860126\n0.929356\n0.775998\n0.082585\n0.848793\n0.491587\n0.465580\n0.839088\n0.489764\n0.559898\n0.988726\n0.166667\n0.478742\n0.314910\n0.556671\n0.903586\n0.789367\n0.084805\n0.525357\n0.010694\n0.801187\n0.924251\n0.115619\n0.222583\n0.564765\n0.777636\n0.083258\n0.432392\n0.325102\n0.051917\n0.771337\n0.244661\n0.410936\n0.067163\n0.058883\n0.206597\n0.926144\n0.910277\n0.931427\n0.318363\n0.952857\n0.262882\n0.031549\n0.853218\n0.864200\n0.740018\n0.421445\n0.778487\n0.607826\n0.383871\n0.733917\n0.054857\n0.123307\n0.403572\n0.667892\n0.978576\n0.770972\n0.148966\n0.093849\n0.434403\n0.745678\n0.680830\n0.365104\n0.548875\n0.857006\n0.027067\n0.505060\n0.684357\n0.653154\n0.978205\n0.554004\n0.933031\n0.835429\n0.261711\n0.707497\n0.453605\n0.771771\n0.133137\n0.409224\n0.719492\n0.595178\n0.835815\n0.043639\n0.688801\n0.328865\n0.211282\n0.864362\n0.353246\n0.633998\n0.189601\n0.860122\n0.732243\n0.930049\n0.330278\n0.211297\n0.553998\n0.410360\n0.145061\n0.594688\n0.753200\n0.426088\n0.311669\n0.513507\n0.599102\n0.540097\n0.907585\n0.361541\n0.925146\n0.344398\n0.091586\n0.931670\n0.868378\n0.584575\n0.161473\n0.078835\n0.599470\n0.453735\n0.649924\n0.752617\n0.717426\n0.724703\n0.007661\n0.466130\n0.082873\n0.823317\n0.803449\n0.681720\n0.247576\n0.370960\n0.685922\n0.968702\n0.972480\n0.145600\n0.215099\n0.576238\n0.529124\n0.122174\n0.873409\n0.096452\n0.688353\n0.461451\n0.220745\n0.596305\n0.654279\n0.814172\n0.485580\n0.691178\n0.284079\n0.755656\n0.640800\n0.235559\n0.526888\n0.881339\n0.464136\n0.515479\n0.701673\n0.766042\n0.748992\n0.637216\n0.680738\n0.264244\n0.513140\n0.612362\n0.219023\n0.181888\n0.942823\n0.979810\n0.007846\n0.051845\n0.153540\n0.658704\n0.163448\n0.018833\n0.150050\n0.482700\n0.766370\n0.380305\n0.718186\n0.185659\n0.397264\n0.637206\n0.896022\n0.755381\n0.171956\n0.208321\n0.472355\n0.043897\n0.557638\n0.543795\n0.281032\n0.896003\n0.226191\n0.288041\n0.203736\n0.247533\n0.891655\n0.103003\n0.533880\n0.513406\n0.023316\n0.865172\n0.909065\n0.820183\n0.889483\n0.902325\n0.808454\n0.172596\n0.595968\n0.959205\n0.763288\n0.811832\n0.094167\n0.655713\n0.570013\n0.456017\n0.335148\n0.709506\n0.197503\n0.469100\n0.036439\n0.867685\n0.866681\n0.089328\n0.758056\n0.919974\n0.540013\n0.737209\n0.245158\n0.480957\n0.119510\n0.680165\n0.473584\n0.746352\n0.812241\n0.164265\n0.645677\n0.408948\n0.646678\n0.996313\n0.266382\n0.786109\n0.102574\n0.081793\n0.042725\n0.901320\n0.903022\n0.370827\n0.116377\n0.148513\n0.641947\n0.988185\n0.534740\n0.290124\n0.488126\n0.688406\n0.635819\n0.041061\n0.488130\n0.903068\n0.805637\n0.379594\n0.060992\n0.070235\n0.245431\n0.885446\n0.459276\n0.405332\n0.170523\n0.221524\n0.351225\n0.610599\n0.098554\n0.494537\n0.714730\n0.292618\n0.753696\n0.677983\n0.279188\n0.041242\n0.177235\n0.445418\n0.486639\n0.883625\n0.439943\n0.906762\n0.611522\n0.702600\n0.192586\n0.701352\n0.902904\n0.831730\n0.171905\n0.611947\n0.043654\n0.358982\n0.896191\n0.371733\n0.387501\n0.867840\n0.474686\n0.285156\n0.948178\n0.265145\n0.383775\n0.880716\n0.178402\n0.876509\n0.651860\n0.479228\n0.395485\n0.812722\n0.714489\n0.974786\n0.843317\n0.873842\n0.649662\n0.901662\n0.018448\n0.909130\n0.557107\n0.973801\n0.833762\n0.667875\n0.445815\n0.125707\n0.032208\n0.381092\n0.854889\n0.432165\n0.842306\n0.102883\n0.488534\n0.317390\n0.106481\n0.252802\n0.537869\n0.821866\n0.402344\n0.580133\n0.548850\n0.950169\n0.729780\n0.283909\n0.878742\n0.896967\n0.542452\n0.706111\n0.201831\n0.796350\n0.573107\n0.547780\n0.693936\n0.381239\n0.896723\n0.259790\n0.462630\n0.097504\n0.392813\n0.434247\n0.338579\n0.519444\n0.936378\n0.550385\n0.080931\n0.668805\n0.794754\n0.145421\n0.657209\n0.816712\n0.183759\n0.417871\n0.377352\n0.561842\n0.531488\n0.468831\n0.398729\n0.367924\n0.105588\n0.435630\n0.272374\n0.600957\n0.175964\n0.424843\n0.474066\n0.880879\n0.860876\n0.388000\n0.075704\n0.065552\n0.394633\n0.602822\n0.926586\n0.807954\n0.539659\n0.688340\n0.677482\n0.798851\n0.787824\n0.616043\n0.187996\n0.094416\n0.093962\n0.569587\n0.165626\n0.534022\n0.328510\n0.410343\n0.932529\n0.362764\n0.567724\n0.045575\n0.035658\n0.320007\n0.510330\n0.979675\n0.550351\n0.566846\n0.636248\n0.082698\n0.037850\n0.000394\n0.604477\n0.791728\n0.061347\n0.273769\n0.112541\n0.736046\n0.388991\n0.697102\n0.048412\n0.235050\n0.178021\n0.346823\n0.033713\n0.540851\n0.009417\n0.843037\n0.493029\n0.252058\n0.233311\n0.493194\n0.110216\n0.308569\n0.877967\n0.889423\n0.185219\n0.119037\n0.066453\n0.323729\n0.736569\n0.131080\n0.276096\n0.911724\n0.174000\n0.769194\n0.016669\n0.907405\n0.544761\n0.904297\n0.050780\n0.149629\n0.979373\n0.636944\n0.742445\n0.699408\n0.468510\n0.031924\n0.504938\n0.020986\n0.024615\n0.847139\n0.182187\n0.479723\n0.315336\n0.539866\n0.289621\n0.539520\n0.798866\n0.619036\n0.565818\n0.205962\n0.947796\n0.572376\n0.128618\n0.444346\n0.429170\n0.009642\n0.543231\n0.239307\n0.684082\n0.075309\n0.903709\n0.912572\n0.125115\n0.525312\n0.973700\n0.143969\n0.368056\n0.949429\n0.228075\n0.483487\n0.660288\n0.590635\n0.968287\n0.425279\n0.540247\n0.240592\n0.728381\n0.552722\n0.470203\n0.252317\n0.225089\n0.743435\n0.918008\n0.095599\n0.423085\n0.181413\n0.532619\n0.713325\n0.283655\n0.533130\n0.667046\n0.721132\n0.019322\n0.715479\n0.456797\n0.301829\n0.829011\n0.041646\n0.005163\n0.731412\n0.121360\n0.279593\n0.905235\n0.109898\n0.697796\n0.209563\n0.330866\n0.657715\n0.427852\n0.716525\n0.588886\n0.998937\n0.376172\n0.518517\n0.027857\n0.224398\n0.532648\n0.259146\n0.898033\n0.950872\n0.935855\n========= ERROR SUMMARY: 0 errors\n$\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 10340933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4a4ff90d83b4be3729bebd13cc3a5b1?s=128&d=identicon&r=PG&f=1", "display_name": "subratappt", "link": "https://stackoverflow.com/users/10340933/subratappt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1018, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547660349, "creation_date": 1547640189, "question_id": 54216689, "link": "https://stackoverflow.com/questions/54216689/how-to-pass-class-object-to-cuda-kernel", "title": "How to pass Class object to CUDA kernel", "body": "<p>I am trying to pass a <code>Class</code> obj from host to device CUDA kernel. I am getting some error like <code>Bus error: 10</code>. Please help how to pass Class object that contains an <code>Array</code>. Here is my code.</p>\n\n<ol>\n<li><p><code>matrixCU.h</code></p>\n\n<pre><code>#ifndef __MATRIXCUDA_H__\n#define __MATRIXCUDA_H__\n#include &lt;iostream&gt;\nclass Matrix{\n    private:\n    std::size_t height,width,sizeArray;\n    double *array;\n\npublic:\n__device__ __host__ Matrix();\n__device__ __host__ Matrix(std::size_t);\n__device__ __host__ Matrix(std::size_t,std::size_t);\n__device__ __host__ Matrix(const Matrix &amp;);\n__device__ __host__ Matrix &amp;operator=(const Matrix &amp;mat);\n__device__ __host__ ~Matrix();\n__device__ __host__ void assignValue(std::size_t,std::size_t, double);\n__device__ __host__ void assignValue(std::size_t , double );\n__device__ __host__ void displayArray();\n};\n#endif\n</code></pre></li>\n<li><p><code>matrixCU.cu</code></p>\n\n<pre><code>        #include &lt;iostream&gt;\n        #include\"matrixCU.h\"\n        Matrix::Matrix(){\n            height = 1;\n            width = 1;\n            sizeArray = height*width;\n            array= new double[sizeArray];\n            if (!array)\n            {\n                //cout &lt;&lt; \"Memory allocation failed\"&lt;&lt;endl;\n                printf(\"Memory allocation failed\");\n            }\n        }\n\n        Matrix::Matrix(size_t h){\n            height = h;\n            width = 1;\n            sizeArray = height*width;\n            array = new double[sizeArray];\n            if (!array)\n            {\n                //cout &lt;&lt; \"Memory allocation failed\"&lt;&lt;endl;\n                printf(\"Memory allocation failed\");\n            }\n        }\n\n        Matrix::Matrix(size_t h,size_t w){\n            height = h;\n            width = w;\n            sizeArray = height*width;\n            array= new double[sizeArray];\n\n            if (!array)\n            {\n                //cout &lt;&lt; \"Memory allocation failed\"&lt;&lt;endl;\n                printf(\"Memory allocation failed\");\n            }\n\n        }\n\n        Matrix::Matrix(const Matrix &amp;mat){\n            height = mat.height;\n            width = mat.width;\n            sizeArray = mat.sizeArray;\n            array = new double[sizeArray];\n\n            for(size_t i = 0;i&lt;sizeArray;++i){\n            array[i] = mat.array[i];\n            }\n\n        //copy(mat.array,mat.array+mat.sizeArray,array);\n        }\n\n        Matrix &amp;Matrix::operator=(const Matrix &amp;mat){\n            height = mat.height;\n            width = mat.width;\n            sizeArray = mat.sizeArray;\n            array = new double[sizeArray];\n\n            for(size_t i = 0;i&lt;sizeArray;++i){\n            array[i] = mat.array[i];\n            }\n\n            //copy(mat.array,mat.array+mat.sizeArray,array);\n            return *this;\n        }\n\n        Matrix::~Matrix(){\n            delete [] array;\n        }\n        void Matrix::assignValue(size_t i,size_t j, double value){\n            size_t l = i*width + j;\n            array[l] = value;\n        }\n\n        void Matrix::assignValue(size_t l, double value){\n            array[l] = value;\n        }\n\n        void Matrix::displayArray(){\n            size_t i,j,l;\n            for(i=0;i&lt;height;++i){\n                for(j=0;j&lt;width;++j){\n                    l =i*width + j;\n                    //cout&lt;&lt;array[l]&lt;&lt;\"\\t\";\n                    printf(\"%f\\t\",array[l]);\n                }\n                //cout&lt;&lt;endl;\n                printf(\"\\n\");\n            }\n        }\n</code></pre></li>\n</ol>\n\n<p>and here is the main code</p>\n\n<ol start=\"3\">\n<li><p><code>main.cu</code></p>\n\n<pre><code>        #include&lt;iostream&gt;\n        #include\"matrixCU.h\"\n        #include&lt;curand_kernel.h&gt;\n\n        const int N=1000;\n\n        __global__ void initialize(Matrix *R){\n            int i= blockIdx.x*blockDim.x + threadIdx.x;\n            if(i&lt;N){\n                curandState state;\n                curand_init(clock64(), i, 0, &amp;state);\n                R-&gt;assignValue(i,curand_uniform(&amp;state));\n            }\n        }\n\n        int main(){\n            Matrix R(N);\n            Matrix *pR;\n            pR=&amp;R;\n            cudaMallocManaged(&amp;pR,N*sizeof(Matrix));\n            initialize&lt;&lt;&lt;4,256&gt;&gt;&gt;(pR);\n            cudaDeviceSynchronize();\n            pR-&gt;displayArray();\n            return 0;\n        }\n</code></pre></li>\n</ol>\n\n<p>I compiled and run this code as\n<code>nvcc -dc main.cu matrixCU.cu</code> and\n<code>nvcc main.o matrixCU.cu</code> then <code>./a.out</code></p>\n\n<p>And I am getting the error like <code>Bus error: 10</code>. Please help, I am new to CUDA.</p>\n"}, {"tags": ["c++", "c++11", "templates"], "comments": [{"owner": {"reputation": 44802, "user_id": 2752075, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5oQlf.png?s=128&g=1", "display_name": "HolyBlackCat", "link": "https://stackoverflow.com/users/2752075/holyblackcat"}, "edited": false, "score": 0, "creation_date": 1547639712, "post_id": 54216484, "comment_id": 95258665, "body": "Not the answer, but I suggest not storing the result of <code>std::bind</code> in a <code>std::function</code>. If you use <code>auto</code> instead, you avoid the overhead of type erasure that <code>std::function</code> adds."}, {"owner": {"reputation": 83151, "user_id": 3943312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc00b38b94ca7b6f820622b0a8af8ded?s=128&d=identicon&r=PG", "display_name": "Sam Varshavchik", "link": "https://stackoverflow.com/users/3943312/sam-varshavchik"}, "edited": false, "score": 1, "creation_date": 1547639791, "post_id": 54216484, "comment_id": 95258714, "body": "&quot;&amp;args...&quot; is not how you expand a parameter pack, in this instance. Try <code>std::forward&lt;Args&gt;(args)...</code>. And the template parameters should be <code>Args ... &amp;&amp;args</code>. There may be other issues here, but this is the first obvious one."}, {"owner": {"reputation": 7216, "user_id": 167973, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/4f114223f6a38683d92ad30e5f0616da?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/167973/carl"}, "reply_to_user": {"reputation": 44802, "user_id": 2752075, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5oQlf.png?s=128&g=1", "display_name": "HolyBlackCat", "link": "https://stackoverflow.com/users/2752075/holyblackcat"}, "edited": false, "score": 0, "creation_date": 1547639857, "post_id": 54216484, "comment_id": 95258750, "body": "@HolyBlackCat yep, learned that earlier trying to build-up some of the other pieces."}, {"owner": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "edited": false, "score": 1, "creation_date": 1547639863, "post_id": 54216484, "comment_id": 95258754, "body": "Also, it has to be <code>class ... Args</code> in the template list, not just <code>Args...</code>."}, {"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 0, "creation_date": 1547639890, "post_id": 54216484, "comment_id": 95258769, "body": "&quot;like, for example&quot;? Why don&#39;t you post the exact code you tried instead so we don&#39;t get silly &quot;\u2018Args\u2019 has not been declared&quot; kind of errors?"}, {"owner": {"reputation": 7216, "user_id": 167973, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/4f114223f6a38683d92ad30e5f0616da?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/167973/carl"}, "edited": false, "score": 0, "creation_date": 1547639950, "post_id": 54216484, "comment_id": 95258806, "body": "apologies re the <code>Args</code> part - had fixed that in earlier version of Q, must have gotten lost in edits."}, {"owner": {"reputation": 44802, "user_id": 2752075, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5oQlf.png?s=128&g=1", "display_name": "HolyBlackCat", "link": "https://stackoverflow.com/users/2752075/holyblackcat"}, "reply_to_user": {"reputation": 83151, "user_id": 3943312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc00b38b94ca7b6f820622b0a8af8ded?s=128&d=identicon&r=PG", "display_name": "Sam Varshavchik", "link": "https://stackoverflow.com/users/3943312/sam-varshavchik"}, "edited": false, "score": 0, "creation_date": 1547639976, "post_id": 54216484, "comment_id": 95258818, "body": "@SamVarshavchik I think it&#39;s <code>Args &amp;&amp;... args</code>."}, {"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 1, "creation_date": 1547639989, "post_id": 54216484, "comment_id": 95258825, "body": "<a href=\"https://stackoverflow.com/questions/213761/what-are-some-uses-of-template-template-parameters\">Template template parameters</a>"}, {"owner": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "edited": false, "score": 0, "creation_date": 1547640264, "post_id": 54216484, "comment_id": 95258985, "body": "The default args part is unclear. You can use template parameters to specify a type <b>or</b> a compile-time <b>integral</b> value. It seems you are trying to do both at once here (and with doubles), which won&#39;t work. You <b>can</b> specify all argument types for the distribution. With some extra work, you might also be able to include default arguments for integral values, but you cannot really communicate floating point values with templates."}, {"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 1, "creation_date": 1547640492, "post_id": 54216484, "comment_id": 95259112, "body": "<a href=\"https://stackoverflow.com/questions/3053561/how-do-i-assign-an-alias-to-a-function-name-in-c\">How do I assign an alias to a function name in C++? - Stack Overflow</a>"}, {"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 0, "creation_date": 1547640823, "post_id": 54216484, "comment_id": 95259305, "body": "Do you want the <code>args</code> part of template parameters, or passed as function input?"}, {"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 0, "creation_date": 1547640856, "post_id": 54216484, "comment_id": 95259326, "body": "Is the type of elements of <code>args</code> the same as <code>NUMERIC</code>?"}, {"owner": {"reputation": 7216, "user_id": 167973, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/4f114223f6a38683d92ad30e5f0616da?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/167973/carl"}, "reply_to_user": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 0, "creation_date": 1547641265, "post_id": 54216484, "comment_id": 95259540, "body": "@user202729 not necessarily - they are whatever the distribution functions use as parameters.  Re template parameters vs args, I&#39;m not precisely sure I understand q - I ultimately use the functions like <code>auto xmeans = generate_means(rng, 100, 0, 1), ymeans = generate_means(rng, 100, 0, 1);</code> etc.  I would like to be able to call <code>generate_means(rng, 100)</code> with defaults set when instantiating function from template, but still allowing occasional use with non defaults."}], "answers": [{"tags": [], "owner": {"reputation": 7216, "user_id": 167973, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/4f114223f6a38683d92ad30e5f0616da?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/167973/carl"}, "is_accepted": false, "score": 0, "last_activity_date": 1547640959, "creation_date": 1547640959, "answer_id": 54216895, "question_id": 54216484, "link": "https://stackoverflow.com/questions/54216484/c-template-function-multiple-types-default-and-arguments/54216895#54216895", "title": "C++ template function - multiple types, default and ... arguments?", "body": "<p>Thanks assorted commenters, this is now working (when added to working blocks from Q):</p>\n\n<pre><code>template &lt;class NUMERIC, template&lt;class&gt; class DIST, class ... Args&gt;\nstd::vector&lt;NUMERIC&gt; generator_template(\n  std::mt19937&amp; g, unsigned int N,\n  Args &amp;&amp;... args\n) {\n  DIST&lt;NUMERIC&gt; dist(std::forward&lt;Args&gt;(args)...);\n  generator&lt;NUMERIC&gt; gen = std::bind(dist, g);\n  return series(N, gen);\n};\n\nauto generate_test = generator_template&lt;double, std::uniform_real_distribution, double, double&gt;;\n</code></pre>\n\n<p>Happy to see other answers, however - still trying to understand C++ template syntax generally, and would prefer a version that let's me set default arguments.</p>\n"}, {"tags": [], "owner": {"reputation": 3524, "user_id": 4950448, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/907276442666522/picture?type=large", "display_name": "Antoine Morrier", "link": "https://stackoverflow.com/users/4950448/antoine-morrier"}, "is_accepted": true, "score": 2, "last_activity_date": 1547642786, "last_edit_date": 1547642786, "creation_date": 1547641595, "answer_id": 54217064, "question_id": 54216484, "link": "https://stackoverflow.com/questions/54216484/c-template-function-multiple-types-default-and-arguments/54217064#54217064", "title": "C++ template function - multiple types, default and ... arguments?", "body": "<p>It is impossible to have floating point number as template parameter.\nHowever, you can do something as follow :</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>#include &lt;random&gt;\n#include &lt;limits&gt;\n#include &lt;algorithm&gt;\n#include &lt;vector&gt;\n#include &lt;iostream&gt;\n\ntemplate&lt;typename T, template&lt;typename&gt; typename Distribution&gt;\nauto generate_random_template(T min = std::numeric_limits&lt;T&gt;::lowest(),\n                              T max = std::numeric_limits&lt;T&gt;::max()) {\n    return [distribution = Distribution&lt;double&gt;{min, max}]\n        (auto &amp;&amp;generator, std::size_t number) mutable {\n        std::vector&lt;T&gt; result;\n        result.reserve(number);\n        auto generate = [&amp;](){return distribution(generator);};\n        std::generate_n(std::back_inserter(result), number, generate);\n        return result;\n    };\n}\n\nint main() {\n    auto generate_means = generate_random_template&lt;double, std::uniform_real_distribution&gt;(0.0, 1.0);\n    std::mt19937 g;\n    std::vector&lt;double&gt; randoms = generate_means(g, 10);\n\n    for(auto r : randoms) std::cout &lt;&lt; r &lt;&lt; std::endl;\n\n    return 0;\n}\n</code></pre>\n\n<p>EDIT: Use <code>generate_n</code> instead of <code>generate</code> for performances reasons</p>\n\n<p>EDIT2 : If you want to use default parameters like you did for x, y, and z, you can also do something like that :</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>#include &lt;random&gt;\n#include &lt;limits&gt;\n#include &lt;algorithm&gt;\n#include &lt;vector&gt;\n#include &lt;iostream&gt;\n\ntemplate&lt;typename T, template&lt;typename&gt; typename Distribution&gt;\nauto generate_random_template(T min = std::numeric_limits&lt;T&gt;::lowest(),\n                              T max = std::numeric_limits&lt;T&gt;::max()) {\n    return [distribution = Distribution&lt;double&gt;{min, max}, min, max]\n        (auto &amp;&amp;generator, std::size_t number, auto ...args) mutable {\n        std::vector&lt;T&gt; result;\n        result.reserve(number);\n\n        if constexpr(sizeof...(args) &gt; 0)\n            distribution.param(typename Distribution&lt;T&gt;::param_type(args...));\n\n        else\n            distribution.param(typename Distribution&lt;T&gt;::param_type(min, max));\n\n        auto generate = [&amp;](){return distribution(generator);};\n        std::generate_n(std::back_inserter(result), number, generate);\n        return result;\n    };\n}\n\nint main() {\n    auto generate_means = generate_random_template&lt;double, std::uniform_real_distribution&gt;(-1.0, 1.0);\n    std::mt19937 g;\n    // x and y are between -1 and 1\n    std::vector&lt;double&gt; x = generate_means(g, 10);\n    std::vector&lt;double&gt; y = generate_means(g, 10);\n    std::vector&lt;double&gt; z = generate_means(g, 10, 0.0, 1.0); // z is between 0 and 1\n\n    for(int i = 0; i &lt; 10; ++i) {\n        std::cout &lt;&lt; x[i] &lt;&lt; \",\" &lt;&lt; y[i] &lt;&lt; \",\" &lt;&lt; z[i] &lt;&lt; std::endl;   \n    }\n    return 0;\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 34388, "user_id": 2610810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8c6433073e71478e8da278a188e1d15?s=128&d=identicon&r=PG", "display_name": "Caleth", "link": "https://stackoverflow.com/users/2610810/caleth"}, "is_accepted": false, "score": 0, "last_activity_date": 1547644867, "creation_date": 1547644867, "answer_id": 54217984, "question_id": 54216484, "link": "https://stackoverflow.com/questions/54216484/c-template-function-multiple-types-default-and-arguments/54217984#54217984", "title": "C++ template function - multiple types, default and ... arguments?", "body": "<p>I'd be tempted to just accept a constructed distribution object. </p>\n\n<pre><code>template &lt;typename Dist, typename URBG&gt;\nstd::vector&lt;typename Dist::value_type&gt; generate(Dist&amp;&amp; dist, URBG&amp;&amp; gen, std::size_t N)\n{\n    std::vector&lt;typename Dist::value_type&gt; res(N);\n    std::generate(res.begin(), res.end(), std::bind(std::forward&lt;Dist&gt;(dist), std::forward&lt;URBG&gt;(gen)));\n    return res;\n}\n</code></pre>\n"}], "owner": {"reputation": 7216, "user_id": 167973, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/4f114223f6a38683d92ad30e5f0616da?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/167973/carl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1394, "favorite_count": 0, "accepted_answer_id": 54217064, "answer_count": 3, "score": 1, "last_activity_date": 1547644867, "creation_date": 1547639479, "last_edit_date": 1547641885, "question_id": 54216484, "link": "https://stackoverflow.com/questions/54216484/c-template-function-multiple-types-default-and-arguments", "title": "C++ template function - multiple types, default and ... arguments?", "body": "<p>I have a couple of boiler-plate functions I would like to replace with a template.  They look roughly like:</p>\n\n<pre><code>std::vector&lt;double&gt; generate_means(\n  std::mt19937&amp; g, unsigned int N,\n  double lower = -1.0, double upper = 1.0\n) {\n  std::uniform_real_distribution&lt;double&gt; dist(lower, upper);\n  std::function&lt;double()&gt; rng = std::bind(dist, g);\n  std::vector&lt;double&gt; res(N);\n  std::generate(std::begin(res), std::end(res), gen);\n  return res;\n}\n</code></pre>\n\n<p>The elements that need abstraction are return type (only contained type, always <code>vector</code> is fine) the arguments after <code>N</code> (e.g., <code>lower</code> and <code>upper</code> in this case) and the distribution (e.g., <code>std::uniform_real_distribution</code>).</p>\n\n<p>What I'd like roughly to be able write:</p>\n\n<pre><code>auto generate_means = generate_template&lt;\n  double, // results vector&lt;double&gt;\n  std::uniform_real_distribution, // uses uniform distro\n  double=-1.0,double=1.0 // with default args\n&gt;\nauto generate_norm_deviates = generate_template&lt;\n  double, // still provides vector&lt;double&gt;\n  std::normal_distribution, // different distro\n  double=0, double=1.0 // different defaults\n&gt;\nauto generate_category_ids = generate_template&lt;\n  unsigned int,\n  std::uniform_int_distribution,\n  unsigned int=0, unsigned int // again with two args, but only one default\n&gt;\n</code></pre>\n\n<p>I have some sub-pieces</p>\n\n<pre><code>template &lt;class NUMERIC&gt;\nusing generator = std::function&lt;NUMERIC()&gt;;\n\ntemplate &lt;class NUMERIC&gt;\nstd::vector&lt;NUMERIC&gt; series(unsigned int length, generator&lt;NUMERIC&gt; gen) {\n  std::vector&lt;NUMERIC&gt; res(length);\n  std::generate(std::begin(res), std::end(res), gen);\n  return res;\n};\n</code></pre>\n\n<p>but when I try assembling like, for example</p>\n\n<pre><code>template &lt;class NUMERIC, class DIST, class...Args&gt;\nstd::vector&lt;NUMERIC&gt; generator_template(\n  std::mt19937&amp; g, unsigned int N,\n  Args... args\n) {\n  DIST&lt;NUMERIC&gt; dist(&amp;args...);\n  generator&lt;NUMERIC&gt; gen = std::bind(dist, g);\n  return series(N, gen);\n} \n</code></pre>\n\n<p>I run into compile errors (in this case <code>error: expected unqualified-id</code>). Is what I'd like approximately achievable? Is this approach in the right direction, or do I need do something fundamentally different?  If it is in the right direction, what am I missing?</p>\n\n<p>EDIT:</p>\n\n<p>For application constraints: I'd like to be able to declare the generators with defaults for arguments, but I do need to occasionally use them without the defaults.  Not having defaults is just inconvenient, however, not fatal.  Example:</p>\n\n<pre><code>//... assorted calculations...\nauto xmeans = generate_means(rng, 100); // x on (-1,1);\nauto ymeans = generate_means(rng, 100); // y on (-1,1);\nauto zmeans = generate_means(rng, 100, 0, 1); // z on (0,1);\n</code></pre>\n"}, {"tags": ["c++", "winapi", "visual-c++", "gis"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 1603185, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/10edaba133707dc8dde30d3ea7f7eefb?s=128&d=identicon&r=PG", "display_name": "user1603185", "link": "https://stackoverflow.com/users/1603185/user1603185"}, "edited": false, "score": 0, "creation_date": 1547735031, "post_id": 54216732, "comment_id": 95300492, "body": "Hi , Thanks for your reply, Geolocation need location permission enabled to get data, I want to know which technology I can use to get GeoLoaction without any permission, Ex &quot;<a href=\"https://www.whatismyip.net/\" rel=\"nofollow noreferrer\">whatismyip.net</a>&quot; by hitting URL"}, {"owner": {"reputation": 13, "user_id": 1603185, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/10edaba133707dc8dde30d3ea7f7eefb?s=128&d=identicon&r=PG", "display_name": "user1603185", "link": "https://stackoverflow.com/users/1603185/user1603185"}, "edited": false, "score": 0, "creation_date": 1547735161, "post_id": 54216732, "comment_id": 95300557, "body": "Sensor API sample code always return &quot;No Data&quot;, May this application required permission to read the location!"}, {"owner": {"reputation": 8766, "user_id": 451321, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/7Sdao.jpg?s=128&g=1", "display_name": "Michael Chourdakis", "link": "https://stackoverflow.com/users/451321/michael-chourdakis"}, "reply_to_user": {"reputation": 13, "user_id": 1603185, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/10edaba133707dc8dde30d3ea7f7eefb?s=128&d=identicon&r=PG", "display_name": "user1603185", "link": "https://stackoverflow.com/users/1603185/user1603185"}, "edited": false, "score": 0, "creation_date": 1547740448, "post_id": 54216732, "comment_id": 95303911, "body": "For desktop apps, you don&#39;t need any extra permissions. Getting the location from IP based services is something entirely different."}], "tags": [], "owner": {"reputation": 8766, "user_id": 451321, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/7Sdao.jpg?s=128&g=1", "display_name": "Michael Chourdakis", "link": "https://stackoverflow.com/users/451321/michael-chourdakis"}, "is_accepted": false, "score": 0, "last_activity_date": 1547640758, "last_edit_date": 1547640758, "creation_date": 1547640360, "answer_id": 54216732, "question_id": 54216276, "link": "https://stackoverflow.com/questions/54216276/how-to-read-geographical-data-programatically-using-c/54216732#54216732", "title": "How to read Geographical data programatically using c++", "body": "<p>You did not say way you do not want the desktop version if using c++. Anyway, you can use the <a href=\"https://docs.microsoft.com/en-us/uwp/api/windows.devices.geolocation\" rel=\"nofollow noreferrer\">Geolocation</a> namespace.</p>\n\n<p>Example project <a href=\"https://github.com/Microsoft/Windows-universal-samples/tree/master/Samples/Geolocation\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>For desktop-only, you can use <a href=\"https://docs.microsoft.com/en-us/windows/desktop/api/locationapi/nn-locationapi-ilocation\" rel=\"nofollow noreferrer\">ILocation</a>. The <a href=\"https://docs.microsoft.com/en-us/windows/desktop/api/sensorsapi/nn-sensorsapi-isensormanager\" rel=\"nofollow noreferrer\">Sensor API</a> also works, check correct SDK/VS toolset configuration.</p>\n"}], "owner": {"reputation": 13, "user_id": 1603185, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/10edaba133707dc8dde30d3ea7f7eefb?s=128&d=identicon&r=PG", "display_name": "user1603185", "link": "https://stackoverflow.com/users/1603185/user1603185"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 85, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547644399, "creation_date": 1547638672, "last_edit_date": 1547644399, "question_id": 54216276, "link": "https://stackoverflow.com/questions/54216276/how-to-read-geographical-data-programatically-using-c", "title": "How to read Geographical data programatically using c++", "body": "<p>I want to read Geographical data(i.e. Public IP, Latitude, Longitude, ZipCode etc...) of machine for almost all windows desktop/server version.</p>\n\n<p>Is there any win32 API's to read these above data programmatically.</p>\n\n<p>I have tried Sensor API's in windows 10, getting error (\" fatal error C1083: Cannot open include file: 'sensorsapi.h': No such file or directory\"), Is there any updates required to get required headers and binaries.\nand also it supports only desktop version <a href=\"https://docs.microsoft.com/en-us/windows/desktop/api/sensorsapi/nn-sensorsapi-isensor\" rel=\"nofollow noreferrer\">https://docs.microsoft.com/en-us/windows/desktop/api/sensorsapi/nn-sensorsapi-isensor</a></p>\n\n<p>Can you please help with the different standard ways I can read Geo details of the windows OS using C++?</p>\n"}, {"tags": ["c++", "arduino"], "comments": [{"owner": {"reputation": 710, "user_id": 1803062, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/UUnf0.png?s=128&g=1", "display_name": "uv_", "link": "https://stackoverflow.com/users/1803062/uv"}, "edited": false, "score": 0, "creation_date": 1547638809, "post_id": 54216231, "comment_id": 95258139, "body": "Why would you use a macro for that? Why not just declare and define another <code>some_func(int a)</code> function to call the more specific <code>some_func(int, Foo&amp;)</code>?"}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "reply_to_user": {"reputation": 710, "user_id": 1803062, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/UUnf0.png?s=128&g=1", "display_name": "uv_", "link": "https://stackoverflow.com/users/1803062/uv"}, "edited": false, "score": 0, "creation_date": 1547638873, "post_id": 54216231, "comment_id": 95258183, "body": "@uv_ because OP thinks that the <code>createFoo</code> is then called only once."}, {"owner": {"reputation": 6463, "user_id": 6387170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d425edf9cc20e61c8cc3be162915f06?s=128&d=identicon&r=PG&f=1", "display_name": "UKMonkey", "link": "https://stackoverflow.com/users/6387170/ukmonkey"}, "edited": false, "score": 0, "creation_date": 1547640754, "post_id": 54216231, "comment_id": 95259263, "body": "&quot; but i&#39;m shooting myself in the foot now&quot; correct.  Remove the macros, they&#39;re not doing what you think they&#39;re doing."}, {"owner": {"reputation": 6463, "user_id": 6387170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d425edf9cc20e61c8cc3be162915f06?s=128&d=identicon&r=PG&f=1", "display_name": "UKMonkey", "link": "https://stackoverflow.com/users/6387170/ukmonkey"}, "reply_to_user": {"reputation": 147720, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 0, "creation_date": 1547640872, "post_id": 54216231, "comment_id": 95259333, "body": "@StoryTeller At least there&#39;s not a strawman holding them... or a delete ^_^"}, {"owner": {"reputation": 7855, "user_id": 1022707, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/7ceaaf20ad52edf11c49125c8bf0a0e8?s=128&d=identicon&r=PG", "display_name": "clankill3r", "link": "https://stackoverflow.com/users/1022707/clankill3r"}, "reply_to_user": {"reputation": 147720, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 0, "creation_date": 1547640974, "post_id": 54216231, "comment_id": 95259388, "body": "@StoryTeller sorry it was not on purpose, i thought abstracting the problem helped. Your answer was still very helpfull."}, {"owner": {"reputation": 7855, "user_id": 1022707, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/7ceaaf20ad52edf11c49125c8bf0a0e8?s=128&d=identicon&r=PG", "display_name": "clankill3r", "link": "https://stackoverflow.com/users/1022707/clankill3r"}, "reply_to_user": {"reputation": 147720, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 0, "creation_date": 1547641436, "post_id": 54216231, "comment_id": 95259628, "body": "@StoryTeller I got it now and I could have never done it without you. If you provide <code>#define debounce(val) ({int r; for(static auto d = create_debounce(); r = debounce(d, val), false;) ; r; }) </code> as a answer I will give you the mark up."}, {"owner": {"reputation": 147720, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 1, "creation_date": 1547641788, "post_id": 54216231, "comment_id": 95259793, "body": "@clankill3r - Alright. I have the other approach edited in. It&#39;s standard C++, though I mention statement expressions."}], "answers": [{"tags": [], "owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "is_accepted": false, "score": 1, "last_activity_date": 1547638840, "creation_date": 1547638840, "answer_id": 54216314, "question_id": 54216231, "link": "https://stackoverflow.com/questions/54216231/create-a-instance-within-a-define-macro/54216314#54216314", "title": "create a instance within a #define macro", "body": "<p>When the loop is run again, then the <code>Foo</code> instances are created again, they are not restore from the previous run.</p>\n\n<p>I suspect what you want to do is using a set of static variables. Or refactor your code for clarity.</p>\n\n<p>This macro is not helping you in this matter, don't use it, use explicit variables and then you will see the lifetime of objects. A macro is not part of the compiler, but of the preprocessor.</p>\n"}, {"tags": [], "owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "is_accepted": false, "score": 0, "last_activity_date": 1547639033, "creation_date": 1547639033, "answer_id": 54216359, "question_id": 54216231, "link": "https://stackoverflow.com/questions/54216231/create-a-instance-within-a-define-macro/54216359#54216359", "title": "create a instance within a #define macro", "body": "<p>Besides being ill-formed, your macro isn't useful for what you want because you're calling <code>create_foo</code> on each invocation.</p>\n\n<p>You can use static variables:</p>\n\n<pre><code>void loop() {\n    static Foo f1, f2;\n    some_func(3, f1);\n    some_func(40, f2);\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 1, "creation_date": 1547639522, "post_id": 54216416, "comment_id": 95258557, "body": "Ouch that hurts :p"}, {"owner": {"reputation": 34185, "user_id": 5470596, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BITFt.jpg?s=128&g=1", "display_name": "YSC", "link": "https://stackoverflow.com/users/5470596/ysc"}, "edited": false, "score": 0, "creation_date": 1547645194, "post_id": 54216416, "comment_id": 95261684, "body": "Ho I understand. I&#39;m sad though, I really believed for an instant that <code>for(static auto n = ...); for(static auto n = ...);</code> would create only one <code>n</code>."}], "tags": [], "owner": {"reputation": 147720, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "is_accepted": true, "score": 3, "last_activity_date": 1547642117, "last_edit_date": 1547642117, "creation_date": 1547639205, "answer_id": 54216416, "question_id": 54216231, "link": "https://stackoverflow.com/questions/54216231/create-a-instance-within-a-define-macro/54216416#54216416", "title": "create a instance within a #define macro", "body": "<p>If you are willing to get <em>really</em> ugly, you can accomplish practically anything. I'm only answering this because this is a brain teaser.</p>\n\n<p>You can define the macro like this:</p>\n\n<pre><code>#define some_func(a) for(static auto f = create_foo(); some_func(a, f), false;)\n</code></pre>\n\n<p>Yes, this will work. In standard C++, the init clause of a for loop can contain a static variable declaration. So the variable will be initialized only once. Then the \"condition\" is the actual call to <code>some_func</code> followed by the comma operator with <code>false</code>, so the function is only execute once each time the for loop is entered.</p>\n\n<p>Adapting your code from Arduino to standard C++, and simulating the four cycles, generated the same output you wanted. <a href=\"http://coliru.stacked-crooked.com/a/d6252000ab9855de\" rel=\"nofollow noreferrer\">See it live</a>.</p>\n\n<hr>\n\n<p>Alternatively, if you want to appear slightly less cryptic (but why would you?), you can opt for this:</p>\n\n<pre><code>#define some_func(a) do {static auto f = create_foo(); some_func(a, f); } while(0)\n</code></pre>\n\n<p>Same thing really.</p>\n\n<hr>\n\n<p>Alright, applying it to your <em>actual</em> problem calls for something different:</p>\n\n<pre><code>#define debounce(a) [](int v){static Debounce d = create_debounce(); \\\n                              return debounce(d, v); }(a)\n</code></pre>\n\n<p>This defines and immediately invokes a lambda. Since a lambda creates a unique closure type everywhere it appears in a program, this will create a unique static object for every expression you write <code>debounce(...)</code> in. An alternative is the GCC specific statement expression. But unlike a lambda, that is an extension. Which you may or may not want to use, YMMV.</p>\n"}, {"tags": [], "owner": {"reputation": 6463, "user_id": 6387170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d425edf9cc20e61c8cc3be162915f06?s=128&d=identicon&r=PG&f=1", "display_name": "UKMonkey", "link": "https://stackoverflow.com/users/6387170/ukmonkey"}, "is_accepted": false, "score": 0, "last_activity_date": 1547641589, "creation_date": 1547641589, "answer_id": 54217062, "question_id": 54216231, "link": "https://stackoverflow.com/questions/54216231/create-a-instance-within-a-define-macro/54217062#54217062", "title": "create a instance within a #define macro", "body": "<p>The first thing to note, is that your state is a boolean.  This will save you a few bytes of RAM.</p>\n\n<p>The next thing to point out is that you want to ignore changes to the input for a period of time; this means you don't need to store the \"current\" state; just the last state... which will end up being the same.  This might not save you anything, since the 2 booleans and 1 boolean will likely just take a byte; but it gives the compiler a chance, and most importantly, makes things simpler.</p>\n\n<p>With those 2 fairly minor improvements made, we get to the bigger ones.  Don't use macros unless you really know what you're doing; and even then reconsider.</p>\n\n<p>Arduino example code tends to offer them because someone thought it would make it easier to learn; but honestly, they don't.  They're not a function, and your usage of it really isn't doing what you think it's doing.  Arduino offer limited ways to debug it, so you can't actually tell that your state will ALWAYS be high, because the macro expansion is this:</p>\n\n<pre><code>int state = true; \nfor(static auto d = create_debounce(); \n    debounce(d, val), \n    false;);\n//New lines added for clarity.\n</code></pre>\n\n<p>Move it to a function; let the compiler optimise the code because it will <em>ALWAYS</em> do a better job than you as long as you write the code in a way that lets it.</p>\n"}], "owner": {"reputation": 7855, "user_id": 1022707, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/7ceaaf20ad52edf11c49125c8bf0a0e8?s=128&d=identicon&r=PG", "display_name": "clankill3r", "link": "https://stackoverflow.com/users/1022707/clankill3r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 54216416, "answer_count": 4, "score": 0, "last_activity_date": 1547642117, "creation_date": 1547638518, "last_edit_date": 1547640725, "question_id": 54216231, "link": "https://stackoverflow.com/questions/54216231/create-a-instance-within-a-define-macro", "title": "create a instance within a #define macro", "body": "<p>I wan't something like:\n<code>#define some_func(a) some_func(a, create_foo())</code></p>\n\n<p>and then when using:</p>\n\n<pre><code> void loop() {\n     some_func(3);\n     some_func(40);\n }\n</code></pre>\n\n<p>the <code>Foo</code> instance should only be created once for each line.\nSo in the above case, 2 times. And when loop is running again, it should not create the <code>Foo</code> instances again.</p>\n\n<p>Is such a thing possible?</p>\n\n<p>Here is the complete non working program:\nThe output should be <code>3, 40, 6, 80, 9, 120, 12, 160, ...</code></p>\n\n<pre><code>typedef struct {\n  int a;\n} Foo;\n\nFoo create_foo() {\n  return {0};\n}\n\nvoid some_func(int a, Foo &amp;f) {\n  f.a += a;\n  Serial.println(f.a);\n}\n\n#define some_func(a) some_func(a, create_foo())\n\n\nvoid setup() {\n  Serial.begin(9600);\n}\n\nvoid loop() {\n  some_func(3); // 3, 6, 9, 12\n  some_func(40); // 40, 80, 120, 160\n}\n</code></pre>\n\n<p>Edit.</p>\n\n<p>I tried to isolate the example to a bare minimum, but i'm shooting myself in the foot now. In the actual thing, I don't have a <code>void</code> as return type but a <code>boolean</code>. </p>\n\n<p>So I try something like this now:</p>\n\n<p><code>#define debounce(val) for(static auto d = create_debounce(); debounce(d, val), false;)\n</code></p>\n\n<p>But that of course fails when used with:\n<code>int state = debounce(digitalRead(BUTTON_FIRE));</code></p>\n\n<p>Cause the macro is not giving a value back so no assignment can happen.</p>\n\n<p>So I need something like:\n<code>#define debounce(val) true; for(static auto d = create_debounce(); debounce(d, val), false;)</code></p>\n\n<p>where <code>true</code> is the result of the <code>create_debounce</code> function.</p>\n\n<p>So can poison it even more to make it possible? Here is the complete code:</p>\n\n<pre><code>// ----------------- L I B R A R Y .  S T U F F -------------------------\n\n#define debounce_delay 50\n\ntypedef struct {\n    int state;\n    int last_state;\n    unsigned long last_state_change_time;    \n} Debounce;\n\nDebounce create_debounce() {\n    return {0, 0, 0L};\n}\n\nboolean debounce(Debounce &amp;deb, int val) {\n\n    if (val != deb.last_state) {\n        deb.last_state_change_time = millis();\n        deb.last_state = val;\n    }\n    else if ((millis() - deb.last_state_change_time) &gt; debounce_delay) {\n        deb.state = val;\n    }\n    return deb.state;\n}\n\n\n\n//#define debounce(val) for(static auto d = create_debounce(); debounce(d, val), false;)\n#define debounce(val) true; for(static auto d = create_debounce(); debounce(d, val), false;)\n\n\n// ----------------- S K E T C H -------------------------\n\n#define BUTTON_FIRE 7\n\n\nvoid setup() {\n  Serial.begin(9600);\n}\n\n\nvoid loop() {\n\n  int state = debounce(digitalRead(BUTTON_FIRE));\n\n  if (state == HIGH) {\n    Serial.println(\"HIGH\");\n  }\n  else {\n    Serial.println(\"LOW\");\n  }\n\n}\n</code></pre>\n"}, {"tags": ["c++", "pointers", "data-structures", "linked-list"], "comments": [{"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 9, "creation_date": 1547638406, "post_id": 54216131, "comment_id": 95257895, "body": "It&#39;s naughty code since it has a type <code>int</code> but no explicit return value. Best study a decent linked list implementation."}, {"owner": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "edited": false, "score": 0, "creation_date": 1547638948, "post_id": 54216131, "comment_id": 95258230, "body": "@YSC alright, I added it as an answer."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1547639976, "post_id": 54216131, "comment_id": 95258816, "body": "Looks like a badly designed list interface. I would recommend researching somewhere else."}], "answers": [{"comments": [{"owner": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "reply_to_user": {"reputation": 34185, "user_id": 5470596, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BITFt.jpg?s=128&g=1", "display_name": "YSC", "link": "https://stackoverflow.com/users/5470596/ysc"}, "edited": false, "score": 1, "creation_date": 1547642252, "post_id": 54216335, "comment_id": 95260037, "body": "@YSC thank you for your corrections, I changed that passage. With the &quot;always representing a number&quot; bit I meant that the underlying memory is always going to have a bit pattern which can be interpreted as a number. I can&#39;t seem to word it in a way that makes much sense in the context of this question and it&#39;s going off a tangent anyway, so I removed it."}, {"owner": {"reputation": 34185, "user_id": 5470596, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BITFt.jpg?s=128&g=1", "display_name": "YSC", "link": "https://stackoverflow.com/users/5470596/ysc"}, "edited": false, "score": 1, "creation_date": 1547645356, "post_id": 54216335, "comment_id": 95261787, "body": "About <i>&quot;underlying memory is always going to have a bit pattern which can be interpreted as a number&quot;</i> FYI you cannot. This is specifically disallowed to read/interpret uninitialized memory in C++."}], "tags": [], "owner": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "is_accepted": false, "score": 1, "last_activity_date": 1547642075, "last_edit_date": 1547642075, "creation_date": 1547638923, "answer_id": 54216335, "question_id": 54216131, "link": "https://stackoverflow.com/questions/54216131/may-i-know-why-the-parameter-to-this-function-isnt-of-int-type-i-dont-underst/54216335#54216335", "title": "May I know why the parameter to this function isn&#39;t of int type? I don&#39;t understand the whole concept of the pointer here", "body": "<blockquote>\n  <p>Shouldn't the parameter to the function addatEnd() be of int type?</p>\n</blockquote>\n\n<p>It could be implemented in a different way, but as it currently is, it makes sense for it to take a <code>node*</code> instead.</p>\n\n<blockquote>\n  <p>But if it really is a pointer, does it mean it will have to point to a\n  certain memory address?</p>\n</blockquote>\n\n<p>Generally, pointers that are passed as a parameter don't have to point to a valid memory address. They can also be null pointers, and the function could detect that and proceed accordingly.</p>\n\n<p>In this case, a valid pointer has to be passed, however, because the function is trying to modify the object, at least if <code>head == NULL</code>:</p>\n\n<pre><code>n-&gt;next = NULL;\n</code></pre>\n\n<p>If <code>n</code> doesn't point to a valid <code>node</code>, this is undefined behavior and will likely crash the program, or do even worse.</p>\n"}, {"comments": [{"owner": {"reputation": 13, "user_id": 10434061, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-RaXpZ_NpsUc/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DUAvD-j4vIxS7Jtx7vmohKg_AGJfQ/mo/photo.jpg?sz=128", "display_name": "Ray", "link": "https://stackoverflow.com/users/10434061/ray"}, "edited": false, "score": 0, "creation_date": 1547640483, "post_id": 54216577, "comment_id": 95259110, "body": "Is it correct to say that a node is itself a pointer ? which contains a next pointer that points to another node?"}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "reply_to_user": {"reputation": 13, "user_id": 10434061, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-RaXpZ_NpsUc/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DUAvD-j4vIxS7Jtx7vmohKg_AGJfQ/mo/photo.jpg?sz=128", "display_name": "Ray", "link": "https://stackoverflow.com/users/10434061/ray"}, "edited": false, "score": 1, "creation_date": 1547640819, "post_id": 54216577, "comment_id": 95259303, "body": "@Ray It would not be correct, or at least it would be highly unconventional. <code>node</code> is a class type. Technically, it is a wrapper for a pointer (or pointers in case of doubly linked list) just like a smart pointer is, but it also carries the data associated with the list element, so being a wrapper around pointer(s) is not its only purpose."}], "tags": [], "owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "is_accepted": true, "score": 3, "last_activity_date": 1547641176, "last_edit_date": 1547641176, "creation_date": 1547639814, "answer_id": 54216577, "question_id": 54216131, "link": "https://stackoverflow.com/questions/54216131/may-i-know-why-the-parameter-to-this-function-isnt-of-int-type-i-dont-underst/54216577#54216577", "title": "May I know why the parameter to this function isn&#39;t of int type? I don&#39;t understand the whole concept of the pointer here", "body": "<blockquote>\n  <p>Shouldn't the parameter to the function addatEnd() be of int type?</p>\n</blockquote>\n\n<p>No.</p>\n\n<p>A linked list consists of nodes. Each node will indirectly link (i.e. refer, i.e. point) to the next node, until the last node which terminates the list. An integer cannot indirectly point to the next node, so nodes of a linked list cannot be an integers.</p>\n\n<blockquote>\n  <p>But if it really is a pointer, does it mean it will have to point to a certain memory address?</p>\n</blockquote>\n\n<p>Yes. It will have to point to some <code>node</code> instance (because the function indirects through the pointer). That instance will be stored in some memory address.</p>\n\n<hr>\n\n<p>P.S. The function is broken.</p>\n\n<p>It sets <code>n-&gt;next</code> to null only if it is the only element of the list. It fails to set <code>n-&gt;next</code> when there are other nodes.</p>\n\n<p>Furthermore, it is declared to return <code>int</code> but fails to do so. The behaviour of the program is undefined.</p>\n"}, {"tags": [], "owner": {"reputation": 78, "user_id": 6162459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a5ec22a9e2a1a0f196a0bdbe3b56adb?s=128&d=identicon&r=PG&f=1", "display_name": "Rhnbmpl", "link": "https://stackoverflow.com/users/6162459/rhnbmpl"}, "is_accepted": false, "score": 0, "last_activity_date": 1547640522, "creation_date": 1547640522, "answer_id": 54216779, "question_id": 54216131, "link": "https://stackoverflow.com/questions/54216131/may-i-know-why-the-parameter-to-this-function-isnt-of-int-type-i-dont-underst/54216779#54216779", "title": "May I know why the parameter to this function isn&#39;t of int type? I don&#39;t understand the whole concept of the pointer here", "body": "<p><code>node</code> is a separate data structure. And the <code>node* n</code> means, whoever is calling <code>addatEnd(node* n)</code> is passing the node's address as an argument. Callee(the one calling your function) is doing : </p>\n\n<pre><code>Node n;//Instaniating node data structure\naddatEnd(&amp;node);//Passing the address of the node data structure to your function\n</code></pre>\n\n<p>The address of node is passed so that it does not make a separate copy the node structure and do operations on it, and whatever operations we do on the copy of the node will not be reflected on the original node. </p>\n\n<p>We want to do operations on the original node data structure, hence passing the address of node so we can do operations on the memory location where the node was originally instantiated.</p>\n"}], "owner": {"reputation": 13, "user_id": 10434061, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-RaXpZ_NpsUc/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DUAvD-j4vIxS7Jtx7vmohKg_AGJfQ/mo/photo.jpg?sz=128", "display_name": "Ray", "link": "https://stackoverflow.com/users/10434061/ray"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "closed_date": 1547656540, "accepted_answer_id": 54216577, "answer_count": 3, "score": 0, "last_activity_date": 1547642075, "creation_date": 1547638154, "question_id": 54216131, "link": "https://stackoverflow.com/questions/54216131/may-i-know-why-the-parameter-to-this-function-isnt-of-int-type-i-dont-underst", "closed_reason": "Needs more focus", "title": "May I know why the parameter to this function isn&#39;t of int type? I don&#39;t understand the whole concept of the pointer here", "body": "<p>I am learning data structures and algorithms and came across Linked list, which uses pointers. However, I don't understand how they are being used in the codes below. Can anyone guide me on this?</p>\n\n<pre><code>int Linkedlist :: addatEnd(node* n){\n    if(head == NULL){\n        head = n;\n        n-&gt;next = NULL;\n    }else{\n        node* n2 = getlastnode();\n        n2-&gt;next = n;\n    }\n}\n</code></pre>\n\n<p>Shouldn't the parameter to the function addatEnd() be of int type? But if it really is a pointer, does it mean it will have to point to a certain memory address?</p>\n"}, {"tags": ["c++", "arrays"], "comments": [{"owner": {"reputation": 18020, "user_id": 580083, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/085edb5b64d5db3362d784bd9d35f99c?s=128&d=identicon&r=PG", "display_name": "Daniel Langr", "link": "https://stackoverflow.com/users/580083/daniel-langr"}, "edited": false, "score": 2, "creation_date": 1547637100, "post_id": 54215676, "comment_id": 95257148, "body": "I would recommend to read some <a href=\"https://stackoverflow.com/q/388242/580083\">good book about C++</a>. It seems to me that you have not much knowledge about how arrays work in C++. Also, than &quot;plain C&quot; arrays, using some container from C++ standard library (such as <code>std::vector</code>) is usually a better option."}, {"owner": {"reputation": 706, "user_id": 4070330, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5de272559ba2ec727fe9b3108afa222f?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Kashpur", "link": "https://stackoverflow.com/users/4070330/andrew-kashpur"}, "edited": false, "score": 0, "creation_date": 1547637423, "post_id": 54215676, "comment_id": 95257302, "body": "what i usually do if i have to read data with specified text format: 1) make struct which corresponds for text format and operator &gt;&gt; for reading from stream 2) use std::copy to read content of file into back_inserter of vector of struct from (1) . So basically you code shrinks to struct (you need it anyway) and 1 line of actual reading from file. If you need to do something that can be done by algorithm from standard library - it usually best way to do it (leaves no room for errors and easy to read/understand for others)"}, {"owner": {"reputation": 5339, "user_id": 1714692, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/bd72cbc200eb7c9aa507624f154b21a7?s=128&d=identicon&r=PG", "display_name": "Francesco Boi", "link": "https://stackoverflow.com/users/1714692/francesco-boi"}, "edited": false, "score": 0, "creation_date": 1547638215, "post_id": 54215676, "comment_id": 95257758, "body": "<code>Product::setData</code> cannot be a constructor: a constructor must have the same name of the class."}, {"owner": {"reputation": 626, "user_id": 2769944, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5fbc09e20c33cb1318804359fae1029d?s=128&d=identicon&r=PG&f=1", "display_name": "Greg K.", "link": "https://stackoverflow.com/users/2769944/greg-k"}, "edited": false, "score": 0, "creation_date": 1547638466, "post_id": 54215676, "comment_id": 95257936, "body": "Are you sure it doesn&#39;t crash because of a seg fault? Are you properly initializing the arrP array? I think we need to check out your entire code to make sure."}, {"owner": {"reputation": 5339, "user_id": 1714692, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/bd72cbc200eb7c9aa507624f154b21a7?s=128&d=identicon&r=PG", "display_name": "Francesco Boi", "link": "https://stackoverflow.com/users/1714692/francesco-boi"}, "edited": false, "score": 0, "creation_date": 1547638598, "post_id": 54215676, "comment_id": 95258018, "body": "Please add some information about crashing. It might crash also because you are reading more elements than the ones stored. <code>addptoarray(infile, arrP[N])</code> is reading the <code>N+1</code> element."}, {"owner": {"reputation": 1, "user_id": 10921840, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/23e1e93d580e0344d135c9aefdc706e2?s=128&d=identicon&r=PG&f=1", "display_name": "Xfighter", "link": "https://stackoverflow.com/users/10921840/xfighter"}, "edited": false, "score": 0, "creation_date": 1547639286, "post_id": 54215676, "comment_id": 95258424, "body": "It exits when it tries to execute that line with return value 3221225477"}, {"owner": {"reputation": 5339, "user_id": 1714692, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/bd72cbc200eb7c9aa507624f154b21a7?s=128&d=identicon&r=PG", "display_name": "Francesco Boi", "link": "https://stackoverflow.com/users/1714692/francesco-boi"}, "edited": false, "score": 0, "creation_date": 1547639512, "post_id": 54215676, "comment_id": 95258554, "body": "Also  notes: in your function you are not returning any value. Plus you are defining the function as <code>int addptoarray(ifstream &amp;fin, Product arrP[])</code> which is expecting an array but you are calling it <code>addptoarray(infile, arrP[N]);</code>: can you try <code>addptoarray(infile, arrP)</code>;?"}], "answers": [{"tags": [], "owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "is_accepted": false, "score": 1, "last_activity_date": 1547645829, "creation_date": 1547645829, "answer_id": 54218278, "question_id": 54215676, "link": "https://stackoverflow.com/questions/54215676/how-to-add-read-data-to-array/54218278#54218278", "title": "How to add read data to array?", "body": "<pre><code>char pname[21];\n</code></pre>\n\n<p>Okay, <code>pname</code> is an array with 21 entries.</p>\n\n<pre><code>void Product::setData(int pcode1, char pname1[], float pprice1)\n{\n    pcode = pcode1;\n    pname[21] = pname1[21];\n    pprice = pprice1;\n}\n</code></pre>\n\n<p>That middle line doesn't make any sense. The middle line tries to set the value of the 22nd entry in <code>pname</code>. Why? Because <code>pname[0]</code> is the first entry in <code>pname</code> and <code>pname[1]</code> is the second entry. So <code>pname[21] = ...</code> tries to set the 22nd entry in <code>pname</code> to something.</p>\n\n<p>But <code>pname</code> only has 21 entries. Trying to set its 22nd entry to something is an access to the array out of bounds.</p>\n\n<p>If you're expecting <code>pname</code> to be a string, you have no code that reflects that. It's not actually a string type (C++ has those) and you don't use C-style string function (like <code>strcpy</code>) to manipulate it. So it's not going to act like a string at all.</p>\n"}], "owner": {"reputation": 1, "user_id": 10921840, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/23e1e93d580e0344d135c9aefdc706e2?s=128&d=identicon&r=PG&f=1", "display_name": "Xfighter", "link": "https://stackoverflow.com/users/10921840/xfighter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547645829, "creation_date": 1547636673, "last_edit_date": 1547637992, "question_id": 54215676, "link": "https://stackoverflow.com/questions/54215676/how-to-add-read-data-to-array", "title": "How to add read data to array?", "body": "<p>I have a text file with six Product Codes, Product Names and Product Prices, grouped per line. Each line has a diferrent product. I used <code>for</code> and <code>fin</code> to read data. Now I want to add those data to an array. </p>\n\n<p>The product codes are set as <code>pcode</code>, product names as <code>pname</code>, product prices as <code>pprice</code> and the array as <code>arrP[]</code>. I'm told to add those data to an array using <code>setData</code>, for which I have a constructor in class <code>Product</code>. </p>\n\n<p>Data reading works. However I cannot understand how to use <code>setData</code> to add those to <code>arrP[]</code>. I've tried <code>arrP[i].setData(pcode, pname, pprice);</code> in the same <code>for</code> that reads the data but it's obviously wrong because it crashes when it's about to execute that line. Below I quote my code about this part.</p>\n\n<p>This is the code of the function that reads the data and moves it to the array (N is defined as 6):</p>\n\n<pre><code>int addptoarray(ifstream &amp;fin, Product arrP[])\n{\n  Product p;\n  int pcode;\n  int i;\n  char pname[21];\n  float pprice;\n\n  n = 0;\n\n\n  for(i=0; i&lt;N; i=i+1){\n\n  fin &gt;&gt; pcode;\n\n  fin.get(pname, 21);\n\n  fin &gt;&gt; pprice;\n\n\n  arrP[i].setData(pcode, pname, pprice);\n\n\n  n = n+1;\n\n  }\n\n\n}\n</code></pre>\n\n<p>This is the part on main that triggers the function (<code>N</code> is defined as 6):</p>\n\n<pre><code>[...]\naddptoarray(infile, arrP[N]);\n[...]\n</code></pre>\n\n<p>This is the code of the constructor for <code>setData</code> in <code>Product</code> class:</p>\n\n<pre><code>void Product::setData(int pcode1, char pname1[], float pprice1)\n{\npcode = pcode1;\npname[21] = pname1[21];\npprice = pprice1;\n}\n</code></pre>\n"}, {"tags": ["c++", "cpp-core-guidelines", "guideline-support-library"], "comments": [{"owner": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 0, "creation_date": 1547635247, "post_id": 54215216, "comment_id": 95256131, "body": "It is pretty much useless unless they properly implement checked iterators..."}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1547635311, "post_id": 54215216, "comment_id": 95256166, "body": "this is either too broad or opinion based. Its a library like any other, use it when you think it helps, dont if you dont like the dependency"}, {"owner": {"reputation": 4410, "user_id": 329855, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f0238262f35f4cb5cc9cbffbe5720afb?s=128&d=identicon&r=PG", "display_name": "smichak", "link": "https://stackoverflow.com/users/329855/smichak"}, "edited": false, "score": 0, "creation_date": 1547639244, "post_id": 54215216, "comment_id": 95258401, "body": "Would you rather I re-phrased the question as &quot;What are the pros and cons of using GSL?&quot;."}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1547641457, "post_id": 54215216, "comment_id": 95259640, "body": "not sure, i voted to close but at the same time i think it is an interesting question. Sometimes its just a matter of wording, maybe &quot;Can I use the GSL when I dont strictly follow the guidelines or vice versa?&quot; is a bit more objective while leading to the same answer"}], "answers": [{"comments": [{"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1547636195, "post_id": 54215352, "comment_id": 95256644, "body": "how does GSL relate to eg boost? Is it to be expected that GSL stuff will make it into the standard library at some point?"}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "reply_to_user": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1547636771, "post_id": 54215352, "comment_id": 95256939, "body": "I hope <code>gsl::index</code> does, and I think there are a few bits that are also reasonnable enough, like <code>not_null</code>. <code>span</code> is already on the path to inclusion (AFAIK)."}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1547636868, "post_id": 54215352, "comment_id": 95256996, "body": "actually thats something I would consider as argument against using it, tough I just learned that it is header only with is again a strong argument to use it... I think time will tell how it will evolve"}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "reply_to_user": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1547637397, "post_id": 54215352, "comment_id": 95257287, "body": "The fact that things are going inside the language? After, it&#39;s just a matter of replacing the namespace, not a big deal. But in general, it&#39;s far lighter than Boost in terms of usage, it&#39;s just for support, not for fundamental stuff."}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1547637540, "post_id": 54215352, "comment_id": 95257362, "body": "i just meant that if eventually it goes into the standard then my motivation is less to consider it now unless i urgently need it, but maybe i should take a closer look before making such unqualified statements ;)"}], "tags": [], "owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "is_accepted": false, "score": 3, "last_activity_date": 1547635536, "creation_date": 1547635536, "answer_id": 54215352, "question_id": 54215216, "link": "https://stackoverflow.com/questions/54215216/should-i-use-the-guidelines-support-library-gsl-in-a-new-c-project/54215352#54215352", "title": "Should I use the Guidelines Support Library (GSL) in a new C++ project?", "body": "<p>The GSL is just a support library for the C++ core guidelines. If you are using the GSL, then these core guidelines should be the guidelines you apply to your code (not Google's or any other found online). You don't need the GSL for the core guidelines nor do you need to use everything in the GSL. Personnally I have started using it for simple bits like <code>index</code> and <code>not_null</code>.</p>\n\n<p>The GSL is not perfect, there are many things that could/should be added, it doesn't impede me for doing crazy things, but it helps adding a framework/some kind of verification to what I'm doing. Also it removes the signed/unsigned issues with <code>index</code>.</p>\n\n<p>I would advise to use it in a new project, as its run-time overhead should be null, but it's a matter of taste. If your project has lots of new developers (or toddlers), then it's something considering to help them growing up.</p>\n"}], "owner": {"reputation": 4410, "user_id": 329855, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f0238262f35f4cb5cc9cbffbe5720afb?s=128&d=identicon&r=PG", "display_name": "smichak", "link": "https://stackoverflow.com/users/329855/smichak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 919, "favorite_count": 0, "closed_date": 1547635594, "answer_count": 1, "score": 2, "last_activity_date": 1547635536, "creation_date": 1547635049, "question_id": 54215216, "link": "https://stackoverflow.com/questions/54215216/should-i-use-the-guidelines-support-library-gsl-in-a-new-c-project", "closed_reason": "Opinion-based", "title": "Should I use the Guidelines Support Library (GSL) in a new C++ project?", "body": "<p>What are the pros and cons in favor of and against using the Guidelines Support Library (GSL) in a new C++ project? I find some constructs there very attractive but am a bit scared of including and relying on such a fundamental library. </p>\n"}, {"tags": ["c++", "makefile", "protocol-buffers", "grpc", "opensuse"], "comments": [{"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 0, "creation_date": 1547635008, "post_id": 54215184, "comment_id": 95255993, "body": "Where did you manually install <code>protoc</code>? In a path that is in your <code>PATH</code> I hope?"}, {"owner": {"reputation": 790, "user_id": 10862144, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DPt16.png?s=128&g=1", "display_name": "RC0993", "link": "https://stackoverflow.com/users/10862144/rc0993"}, "reply_to_user": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 0, "creation_date": 1547635668, "post_id": 54215184, "comment_id": 95256371, "body": "Hi @MatthieuBrucher I have no <code>PATH</code> set in <code>.bashrc</code>. Is that what you are asking? that said, I think protobuff is installed in some default location, say <code>&#47;usr&#47;include</code> and <code>&#47;usr&#47;lib64</code>. <b>How do I make sure of it though?</b> also when I do <code>protoc --IPATH</code> it gives <b>Missing value for flag: --IPATH</b>"}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 0, "creation_date": 1547635775, "post_id": 54215184, "comment_id": 95256428, "body": "You will have to figure this out, because the path but be added to the environment variable <code>PATH</code>. Not sure what you think <code>protoc -IPATH</code> is supposed to do."}, {"owner": {"reputation": 5566, "user_id": 530160, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/xRnFS.jpg?s=128&g=1", "display_name": "Nick ODell", "link": "https://stackoverflow.com/users/530160/nick-odell"}, "edited": false, "score": 0, "creation_date": 1547659702, "post_id": 54215184, "comment_id": 95270465, "body": "If you type <code>which protoc</code>, it will search your <code>PATH</code>, and tell you where it is installed, if it can find it."}, {"owner": {"reputation": 790, "user_id": 10862144, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DPt16.png?s=128&g=1", "display_name": "RC0993", "link": "https://stackoverflow.com/users/10862144/rc0993"}, "reply_to_user": {"reputation": 5566, "user_id": 530160, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/xRnFS.jpg?s=128&g=1", "display_name": "Nick ODell", "link": "https://stackoverflow.com/users/530160/nick-odell"}, "edited": false, "score": 0, "creation_date": 1548309792, "post_id": 54215184, "comment_id": 95496707, "body": "Hi @NickODell and @MatthieuBrucher, This was definitely <code>protobuf</code> installation problem. As I reinstalled the protobuff again this problem was solved. apparently I downloaded erroneous git repo which is now fixed. <i>Since I am new to SO I don&#39;t know how to close this Issue without any answer.</i>"}, {"owner": {"reputation": 5566, "user_id": 530160, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/xRnFS.jpg?s=128&g=1", "display_name": "Nick ODell", "link": "https://stackoverflow.com/users/530160/nick-odell"}, "edited": false, "score": 0, "creation_date": 1548344369, "post_id": 54215184, "comment_id": 95515891, "body": "We only close questions if the question cannot be answered. (E.g. &quot;Is cereal a soup?&quot;) Write an answer to your question, so the next person to have this problem knows how to solve it."}], "answers": [{"tags": [], "owner": {"reputation": 790, "user_id": 10862144, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DPt16.png?s=128&g=1", "display_name": "RC0993", "link": "https://stackoverflow.com/users/10862144/rc0993"}, "is_accepted": true, "score": 2, "last_activity_date": 1548649569, "creation_date": 1548649569, "answer_id": 54395538, "question_id": 54215184, "link": "https://stackoverflow.com/questions/54215184/make-protoc-command-not-found-while-installing-grpc-from-source/54395538#54395538", "title": "\u201cmake: protoc: Command not found\u201d while installing grpc from source", "body": "<p>I have resolved this problem by installing protocol buffer compiler <strong>properly</strong>.</p>\n\n<p>The important step which I forgot to do earlier is to update the submodules with <code>git submodule update --init --recursive</code> when you are building protoc with git repository.</p>\n\n<p>The steps for C++ version are mentioned at <a href=\"https://github.com/protocolbuffers/protobuf/tree/master/src\" rel=\"nofollow noreferrer\">this link</a>.</p>\n\n<p>Thanks,</p>\n"}], "owner": {"reputation": 790, "user_id": 10862144, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DPt16.png?s=128&g=1", "display_name": "RC0993", "link": "https://stackoverflow.com/users/10862144/rc0993"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1281, "favorite_count": 0, "accepted_answer_id": 54395538, "answer_count": 1, "score": -1, "last_activity_date": 1568175218, "creation_date": 1547634954, "last_edit_date": 1568175218, "question_id": 54215184, "link": "https://stackoverflow.com/questions/54215184/make-protoc-command-not-found-while-installing-grpc-from-source", "title": "\u201cmake: protoc: Command not found\u201d while installing grpc from source", "body": "<p>I have cloned this repository <code>https://github.com/grpc/grpc.git</code> for installing the grpc. I want to use the framework with <code>C++</code> programming so I followed the instructions given in folder <code>src/cpp</code>.</p>\n\n<p>To build grpc for C++ from the source (in OpenSUSE) there are some pre-requisites <em><a href=\"https://github.com/grpc/grpc/blob/master/BUILDING.md\" rel=\"nofollow noreferrer\">given in this link</a></em></p>\n\n<pre><code> $ [sudo] apt-get install build-essential autoconf libtool pkg-config\n</code></pre>\n\n<p>As mentioned, to build from source and run tests, one needs</p>\n\n<pre><code>$ [sudo] apt-get install libgflags-dev libgtest-dev\n$ [sudo] apt-get install clang libc++-dev\n</code></pre>\n\n<p>I could not find any <code>build-essential</code>, <code>libgflags-dev</code> and <code>libgtest-dev</code>. I don't know whether this is the reason for not getting grpc installed.</p>\n\n<p>Later,\nI have manually installed protocol buffer compiler <code>protoc</code> before running the  <code>make</code>.</p>\n\n<p>When I run <code>make</code> in the grpc root directory. I get this error</p>\n\n<pre><code>[PROTOC]  Generating protobuf CC file from src/proto/grpc/channelz/channelz.proto\nmake: protoc: Command not found\nmake: *** [Makefile:2601: /home/rohan/Downloads/grpc/gens/src/proto/grpc/channelz/channelz.pb.cc] Error 127\n</code></pre>\n\n<p>Unable to figure out why this error is showing as I already have installed <code>protoc</code>. Is some linking problem, then please share how to solve it. I am new to Linux so I really am a little bit hesitant to change and <code>env</code> file or some <code>make</code> file by my own.</p>\n\n<p>Please suggest some help. Thanks for your time.</p>\n"}, {"tags": ["c++", "templates", "enums"], "comments": [{"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 2, "creation_date": 1547633584, "post_id": 54214721, "comment_id": 95255185, "body": "<code>typename xEnum&lt;index&gt;::val</code>?"}, {"owner": {"reputation": 241, "user_id": 1499280, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4ab982fda3b67e302b9aebaefdd92314?s=128&d=identicon&r=PG", "display_name": "Ravi", "link": "https://stackoverflow.com/users/1499280/ravi"}, "reply_to_user": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 0, "creation_date": 1547637190, "post_id": 54214721, "comment_id": 95257183, "body": "Thanks Matthieu and VTT."}], "owner": {"reputation": 241, "user_id": 1499280, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4ab982fda3b67e302b9aebaefdd92314?s=128&d=identicon&r=PG", "display_name": "Ravi", "link": "https://stackoverflow.com/users/1499280/ravi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "closed_date": 1547633761, "answer_count": 0, "score": 0, "last_activity_date": 1547633381, "creation_date": 1547633381, "question_id": 54214721, "link": "https://stackoverflow.com/questions/54214721/c-inheriting-a-template-class-with-enum", "closed_reason": "Duplicate", "title": "C++ inheriting a template class with enum", "body": "<p>I have a program which looks like this</p>\n\n<pre><code>    // tuple example\n    #include &lt;iostream&gt;     // std::cout\n    #include &lt;tuple&gt;        // std::tuple, std::get, std::tie, std::ignore\n    using namespace std;\n    template &lt;int i&gt; class  xEnum\n    {\n    public:\n        enum  val\n        {\n        x1,\n        x2\n        };\n    };\n    template &lt;&gt; class  xEnum&lt;0&gt;\n    {\n    public:\n        enum val\n        {\n        RED,\n        GREEN,\n        WHITE\n        };\n    };\n    template &lt;&gt; class  xEnum&lt;1&gt;\n    {\n    public:\n        enum val\n        {\n        BANANA,\n        ORANGE,\n        APPLE\n        };\n    };\n\n    class color:public xEnum&lt;0&gt;\n    {\n    public:\n        static tuple&lt;int, int, int&gt; var;\n        template&lt; xEnum&lt;0&gt;::val i &gt; static auto getVal()\n        {\n            return get&lt;i&gt;( var );\n        }\n    };\n    tuple&lt;int, int, int&gt; color::var(10, 11, 12);\n\n    class fruit:public xEnum&lt;1&gt;\n    {\n    public:\n\n        static tuple&lt;int, int, int&gt; var;\n        template&lt; xEnum&lt;1&gt;::val i &gt; static auto getVal()\n        {\n            return get&lt;i&gt;( var );\n        }\n    };\n    tuple&lt;int, int, int&gt; fruit::var(20, 21, 22);\n    template &lt;int index&gt; class variable:public xEnum&lt;index&gt;\n    {\n    public:\n        static tuple&lt;int, int, int&gt; var;\n        template&lt; xEnum&lt;index&gt;::val i &gt; static auto getVal()\n        {\n            return get&lt;i&gt;( var );\n        }\n\n    };\n    int main ()\n    {\n      cout&lt;&lt;\"Value is \"&lt;&lt;color::getVal&lt;color::RED&gt;()&lt;&lt;endl;\n      cout&lt;&lt;\"Value is \"&lt;&lt;color::getVal&lt;color::GREEN&gt;()&lt;&lt;endl;\n      cout&lt;&lt;\"Value is \"&lt;&lt;color::getVal&lt;color::WHITE&gt;()&lt;&lt;endl;\n      cout&lt;&lt;\"Value is \"&lt;&lt;fruit::getVal&lt;fruit::BANANA&gt;()&lt;&lt;endl;\n      cout&lt;&lt;\"Value is \"&lt;&lt;fruit::getVal&lt;fruit::ORANGE&gt;()&lt;&lt;endl;\n      cout&lt;&lt;\"Value is \"&lt;&lt;fruit::getVal&lt;fruit::APPLE&gt;()&lt;&lt;endl;\n\n      return 0;\n    }\n</code></pre>\n\n<p>This program compiles without any issues. Output of the program is</p>\n\n<pre><code>    $ g++ -Os -std=c++1y prog.cpp\n    $ ./a.exe\n    Value is 10\n    Value is 11\n    Value is 12\n    Value is 20\n    Value is 21\n    Value is 22\n</code></pre>\n\n<p>Looking at the class color and fruit shows that they have a similar pattern. So I tried putting a generic class in place of the two classes, which looked like below</p>\n\n<pre><code>    template &lt;int index&gt; class variable:public xEnum&lt;index&gt;\n    {\n    public:\n        static tuple&lt;int, int, int&gt; var;\n        template&lt; xEnum&lt;index&gt;::val i &gt; static auto getVal()\n        {\n            return get&lt;i&gt;( var );\n        }\n\n    };\n</code></pre>\n\n<p>But with above template class I get compiler error below:</p>\n\n<pre><code>     error: 'xEnum::val' is not a type\n         template&lt; xEnum&lt;index&gt;::val i &gt; static auto getVal()\n</code></pre>\n\n<p>Could someone please suggest a way to get rid of this compiler error or a way to define the two classes fruit and color in a generic way?</p>\n\n<p>Thanks in advance.</p>\n\n<p>Only way I could come up with is </p>\n\n<pre><code>    #define var_class(x, y)  class x:public xEnum&lt;y&gt; \\\n                             { \\\n                             public:  \\\n                                 static tuple&lt;int, int, int&gt; var; \\\n                                 template&lt; xEnum&lt;y&gt;::val i &gt; static auto getVal() \\\n                                 { \\\n                                     return get&lt;i&gt;( var ); \\\n                                 } \\\n                             }\\\n</code></pre>\n\n<p>Above macro works, but I am not too keen on using macros to avoid repetition of code in c++. There should be some elegant c++ template solution to avoid this.</p>\n"}, {"tags": ["c++", "templates"], "answers": [{"tags": [], "owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "is_accepted": false, "score": 4, "last_activity_date": 1547633490, "creation_date": 1547633490, "answer_id": 54214742, "question_id": 54214714, "link": "https://stackoverflow.com/questions/54214714/template-the-value-of-a-member-variable/54214742#54214742", "title": "Template the value of a member variable", "body": "<p>Yes, that's one use of templates:</p>\n\n<pre><code>template&lt;int size&gt;\nstruct color\n{\n    int width;\n    int height;\n    uint8_t data[size];\n};\n</code></pre>\n\n<p>Templates arguments can be a class, but they can also be some simple values like ints.</p>\n"}, {"comments": [{"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 0, "creation_date": 1547634631, "post_id": 54214864, "comment_id": 95255769, "body": "It is used often in linear algebra (Eigen, Blaze, MLT, Armadillo...)."}, {"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "reply_to_user": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 0, "creation_date": 1547634717, "post_id": 54214864, "comment_id": 95255823, "body": "@MatthieuBrucher: Indeed it is - because you <i>want</i> different sized elements to be unrelated, insofar that say an <code>int</code> and a <code>double</code> are unrelated."}], "tags": [], "owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "is_accepted": true, "score": 5, "last_activity_date": 1547633903, "creation_date": 1547633903, "answer_id": 54214864, "question_id": 54214714, "link": "https://stackoverflow.com/questions/54214714/template-the-value-of-a-member-variable/54214864#54214864", "title": "Template the value of a member variable", "body": "<p>You <em>could</em> write something of the form</p>\n\n<pre><code>template&lt;int size&gt;\nstruct Foo\n{\n    // ToDo - other members here\n    uint8_t data[size];\n};\n\ntypedef Foo&lt;32*32&gt; Gray;\ntypedef Foo&lt;32*32*3&gt; color;\n</code></pre>\n\n<p><strong>But</strong> note then than <code>Gray</code> and <code>color</code> are completely different types. As such this pattern is not used that often. One extension would be to use a non-template base class for <code>Foo</code> for perhaps the <code>height</code> and <code>width</code> members. But unless you really do need compile-time features that templates offer, and don't want to use <code>constexpr</code> which is another alternative, regular run-time polymorphism is probably the best fit for most purposes.</p>\n"}], "owner": {"reputation": 517, "user_id": 7340306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd32b68e03c772583ca2fe0f524c3825?s=128&d=identicon&r=PG&f=1", "display_name": "Gaetan", "link": "https://stackoverflow.com/users/7340306/gaetan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 54214864, "answer_count": 2, "score": 0, "last_activity_date": 1547642813, "creation_date": 1547633372, "last_edit_date": 1547642813, "question_id": 54214714, "link": "https://stackoverflow.com/questions/54214714/template-the-value-of-a-member-variable", "title": "Template the value of a member variable", "body": "<p>Consider the following two classes: </p>\n\n<pre><code>Struct Gray\n{\nconst int data_size = 32*32;\nint width;\nint height;\nuint8_t data[data_size ]\n}\n\nStruct color\n{\nconst int data_size = 32*32*3;\nint width;\nint height;\nuint8_t data[data_size ]\n}\n</code></pre>\n\n<p>I want to combine this 2 classes into one template class.</p>\n\n<p>How can I write such a template class that takes as template parameter the value of data_size, something like <code>template&lt;int data_size&gt; struct</code> ? Do we actually use template for such purposes in c++? I know that template are use to tricky variable type but never saw a use case for variable value.</p>\n"}, {"tags": ["c++", "c++11", "posix"], "comments": [{"owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 0, "creation_date": 1547632659, "post_id": 54214423, "comment_id": 95254624, "body": "<a href=\"https://en.cppreference.com/w/cpp/utility/functional/function/target\" rel=\"nofollow noreferrer\">target()</a>, maybe?"}, {"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1547632665, "post_id": 54214423, "comment_id": 95254628, "body": "You need to use a pointer to the actual function."}], "answers": [{"comments": [{"owner": {"reputation": 32126, "user_id": 2666289, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/746dd23bbe20769fbd758421e67f455c?s=128&d=identicon&r=PG", "display_name": "Holt", "link": "https://stackoverflow.com/users/2666289/holt"}, "edited": false, "score": 0, "creation_date": 1547635673, "post_id": 54214586, "comment_id": 95256375, "body": "You need to pass a template argument to <code>target()</code>, e.g., <code>callcbk.target&lt;void(*)(union sigval)&gt;</code>, and this will only work if the stored object was a pointer to such function."}, {"owner": {"reputation": 23, "user_id": 10821804, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/291bbf53bda9b9705cacb53737b85392?s=128&d=identicon&r=PG&f=1", "display_name": "abacus", "link": "https://stackoverflow.com/users/10821804/abacus"}, "edited": false, "score": 0, "creation_date": 1547639358, "post_id": 54214586, "comment_id": 95258476, "body": "Thanks, I get the point. Anyway I still get an error: se.sigev_notify_function = callcbk.target&lt;void(<i>)(union sigval)&gt;();   error: cannot convert \u2018void (*</i>)(sigval)\u2019 to \u2018void (<i>)(sigval_t) {aka void (</i>)(sigval)}\u2019 in assignment      se.sigev_notify_function = callcbk.target&lt;void(*)(union sigval)&gt;();"}, {"owner": {"reputation": 32126, "user_id": 2666289, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/746dd23bbe20769fbd758421e67f455c?s=128&d=identicon&r=PG", "display_name": "Holt", "link": "https://stackoverflow.com/users/2666289/holt"}, "reply_to_user": {"reputation": 23, "user_id": 10821804, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/291bbf53bda9b9705cacb53737b85392?s=128&d=identicon&r=PG&f=1", "display_name": "abacus", "link": "https://stackoverflow.com/users/10821804/abacus"}, "edited": false, "score": 0, "creation_date": 1547640054, "post_id": 54214586, "comment_id": 95258863, "body": "@abacus You need to dereference because <code>.target()</code> returns a pointer to the target, so a pointer to a pointer to a function: <code>se.sigev_notify_function = *callcbk.target&lt;void(*)(union sigval)&gt;()</code>. But how do you create the function in the first place?"}], "tags": [], "owner": {"reputation": 26959, "user_id": 1294207, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/Inny3.jpg?s=128&g=1", "display_name": "Fantastic Mr Fox", "link": "https://stackoverflow.com/users/1294207/fantastic-mr-fox"}, "is_accepted": false, "score": 0, "last_activity_date": 1547640709, "last_edit_date": 1547640709, "creation_date": 1547632949, "answer_id": 54214586, "question_id": 54214423, "link": "https://stackoverflow.com/questions/54214423/how-do-i-assign-a-stdfunction-type-to-sigevent-sigev-notify-function-posix-ti/54214586#54214586", "title": "How do I assign a std::function type to sigevent.sigev_notify_function (POSIX timers)", "body": "<p>The <a href=\"http://man7.org/linux/man-pages/man7/sigevent.7.html\" rel=\"nofollow noreferrer\"><code>sigevent</code></a> structures <code>sigev_notify_function</code> is not expecting a <code>std::function</code> object, it is expecting a function pointer:</p>\n\n<pre><code>void       (*sigev_notify_function) (union sigval);\n</code></pre>\n\n<p>A <code>std::function</code> object can be created implicitly from a function pointer, but the reverse is not possible. You must use a pointer to the actual function.</p>\n\n<p>You can achieve this by using <code>callcbk.target&lt;void(*)(union sigval)&gt;()</code> to get a pointer to the original function pointer, but then <code>callcbk</code> is somewhat pointless.</p>\n"}, {"tags": [], "owner": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "is_accepted": false, "score": 1, "last_activity_date": 1547658023, "creation_date": 1547658023, "answer_id": 54221898, "question_id": 54214423, "link": "https://stackoverflow.com/questions/54214423/how-do-i-assign-a-stdfunction-type-to-sigevent-sigev-notify-function-posix-ti/54221898#54221898", "title": "How do I assign a std::function type to sigevent.sigev_notify_function (POSIX timers)", "body": "<p>A well designed C callback API lets you pass a value to the callback function.  This lets you have stateful callbacks.</p>\n\n<p>In this case, <code>union sigval</code> is a union of an <code>int</code> and a <code>void*</code>.  You are supposed to stick your state in either of those two.</p>\n\n<p><code>std::function&lt;Sig&gt;</code> can store state, so you need to pass that state through.</p>\n\n<p>A <code>std::function</code> is not a function pointer.  In order to pass it to a C function callback API, you need to wrap it up and pass it as the <code>void*</code> portion.</p>\n\n<pre><code>struct sig_cb {\n  void(* function)(sigval_t);\n  void* pvoid;\n};\nsig_cb make_signal_callback( std::function&lt;void()&gt;* pf ) {\n  return {\n    [](sigval_t v) { (*static_cast&lt;std::function&lt;void()&gt;*&gt;(v.sival_ptr))(); },\n    pf\n  };\n}\n</code></pre>\n\n<p>then modify your code:</p>\n\n<pre><code>functionCbType callcbk;\n...\nstruct sigevent se;\nauto cb = make_signal_callback(&amp;callcbk);\nse.sigev_notify = SIGEV_THREAD;\nse.sigev_notify_function = cb.function;\nse.sigev_value.sival_ptr = cb.pvoid;\nse.sigev_notify_attributes = NULL;\n\nint status = timer_create(CLOCK_MONOTONIC, &amp;se, &amp;timer_id);\n</code></pre>\n\n<p>and it should work.  Naturally the lifetime of your <code>std::function</code> must be managed separately.</p>\n"}], "owner": {"reputation": 23, "user_id": 10821804, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/291bbf53bda9b9705cacb53737b85392?s=128&d=identicon&r=PG&f=1", "display_name": "abacus", "link": "https://stackoverflow.com/users/10821804/abacus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 331, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1593914931, "creation_date": 1547632492, "last_edit_date": 1593914931, "question_id": 54214423, "link": "https://stackoverflow.com/questions/54214423/how-do-i-assign-a-stdfunction-type-to-sigevent-sigev-notify-function-posix-ti", "title": "How do I assign a std::function type to sigevent.sigev_notify_function (POSIX timers)", "body": "<p>I'm using a POSIX timer to call a function that is defined with std::function template: </p>\n\n<pre><code>typedef std::function&lt;void (union sigval)&gt; functionCbType;\n</code></pre>\n\n<p>I get the following error in assignment to field sigev_notify_function of struct sigevent:</p>\n\n<p>error: cannot convert \u2018functionCbType {aka std::function}\u2019 to \u2018void (<em>)(sigval_t) {aka void (</em>)(sigval)}\u2019 in assignment\n     se.sigev_notify_function = callcbk;</p>\n\n<pre><code>functionCbType callcbk;\n...\nstruct sigevent se;\nse.sigev_notify = SIGEV_THREAD;\nse.sigev_notify_function = callcbk;\nse.sigev_notify_attributes = NULL;\n\nint status = timer_create(CLOCK_MONOTONIC, &amp;se, &amp;timer_id);\n</code></pre>\n\n<p>se.sigev_notify_function expects </p>\n\n<pre><code>void       (*sigev_notify_function) (union sigval);\n</code></pre>\n\n<p>What is the correct way to do this?</p>\n"}, {"tags": ["c++", "vector", "struct", "erase-remove-idiom"], "comments": [{"owner": {"reputation": 147720, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 0, "creation_date": 1547632422, "post_id": 54214304, "comment_id": 95254479, "body": "... IOW, post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> please."}, {"owner": {"reputation": 11, "user_id": 10919443, "user_type": "registered", "profile_image": "https://graph.facebook.com/2094017693967532/picture?type=large", "display_name": "djankooo", "link": "https://stackoverflow.com/users/10919443/djankooo"}, "edited": false, "score": 0, "creation_date": 1547632526, "post_id": 54214304, "comment_id": 95254550, "body": "Sorry, I&#39;ve corrected question."}], "answers": [{"tags": [], "owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "is_accepted": true, "score": 6, "last_activity_date": 1547632760, "creation_date": 1547632760, "answer_id": 54214513, "question_id": 54214304, "link": "https://stackoverflow.com/questions/54214304/how-to-erase-value-from-vector-of-struct-using-erase-remove-idiom/54214513#54214513", "title": "How to erase value from vector of struct using erase-remove idiom?", "body": "<p>I guess what you want to do is to remove all objects that have <code>k==0</code>, so create a lambda for that:</p>\n\n<pre><code>tabu.erase(\n    std::remove_if(tabu.begin(), tabu.end(),[](const tabuRecord&amp; t){return t.k == 0;}),\n    tabu.end());\n</code></pre>\n\n<p><code>std::remove</code> cannot work because it's not one value that you want to remove, but all values with a specific pattern, which is what <code>std::remove_if</code> does.</p>\n"}, {"tags": [], "owner": {"reputation": 9427, "user_id": 7703024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94e363e0e11695395e04f814233b6274?s=128&d=identicon&r=PG", "display_name": "super", "link": "https://stackoverflow.com/users/7703024/super"}, "is_accepted": false, "score": 4, "last_activity_date": 1547632859, "creation_date": 1547632859, "answer_id": 54214551, "question_id": 54214304, "link": "https://stackoverflow.com/questions/54214304/how-to-erase-value-from-vector-of-struct-using-erase-remove-idiom/54214551#54214551", "title": "How to erase value from vector of struct using erase-remove idiom?", "body": "<p><code>std::remove</code> needs a <code>tabuRecord</code> to match against, so you need to do something like.</p>\n\n<pre><code>tabuRecord value_to_remove(1,2,3);\ntabu.erase(std::remove(tabu.begin(), tabu.end(), value_to_remove), tabu.end());\n</code></pre>\n\n<p>If you want to remove only based on the <code>k</code> member, you need to use <code>std::remove_if</code> and pass an appropriate function to match for it.</p>\n\n<pre><code>auto match_func = [](const tabuRecord&amp; obj) { return obj.k == 2; };\ntabu.erase(std::remove_if(tabu.begin(), tabu.end(), match_func), tabu.end());\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "is_accepted": false, "score": 3, "last_activity_date": 1547632929, "creation_date": 1547632929, "answer_id": 54214577, "question_id": 54214304, "link": "https://stackoverflow.com/questions/54214304/how-to-erase-value-from-vector-of-struct-using-erase-remove-idiom/54214577#54214577", "title": "How to erase value from vector of struct using erase-remove idiom?", "body": "<p>Try something like this:</p>\n\n<pre><code>tabu.erase(\n    std::remove_if(tabu.begin(), tabu.end(), [valueToErase](const tabuRecord &amp; t) {\n    return (t.x==valueToErase.x) &amp;&amp; (t.y == valueToErase.y) &amp;&amp; (t.k == valueToErase.k);\n}), tabu.end());\n</code></pre>\n\n<p>This uses a <a href=\"https://en.cppreference.com/w/cpp/language/lambda\" rel=\"nofollow noreferrer\">lambda</a> that returns <code>true</code> if the three fields are equal, and it removes all values where this is the case.</p>\n\n<p>Here's a full example:</p>\n\n<pre><code>#include &lt;vector&gt;\n#include &lt;algorithm&gt;\n#include &lt;iostream&gt;\n\nint main(int argc, char **argv)\n{\n    tabuRecord valueToErase(1, 2, 3); // example value to remove\n\n    tabu.push_back({ 1, 2, 3 });\n    tabu.push_back({ 4, 5, 6 });\n    tabu.push_back({ 1, 2, 3 });\n    tabu.push_back({ 7, 8, 9 });\n\n    tabu.erase(\n        std::remove_if(tabu.begin(), tabu.end(), [valueToErase](const tabuRecord &amp; t) {\n        return (t.x==valueToErase.x) &amp;&amp; (t.y == valueToErase.y) &amp;&amp; (t.k == \n        valueToErase.k);\n    }), tabu.end());\n\n    for (tabuRecord t : tabu) {\n        std::cout &lt;&lt; \"x: \" &lt;&lt; t.x &lt;&lt; \" y: \" &lt;&lt; t.y &lt;&lt; \" k: \" &lt;&lt; t.k &lt;&lt; std::endl;\n    } // print all entries to verify that the correct ones were removed\n\n    return 0;\n}\n</code></pre>\n\n<p>Also, there's an error in your construtor, you probably wanted this instead of setting all fields to the same value:</p>\n\n<pre><code>: x(x), y(y), k(k) {}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 10919443, "user_type": "registered", "profile_image": "https://graph.facebook.com/2094017693967532/picture?type=large", "display_name": "djankooo", "link": "https://stackoverflow.com/users/10919443/djankooo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "accepted_answer_id": 54214513, "answer_count": 3, "score": 0, "last_activity_date": 1547633689, "creation_date": 1547632147, "last_edit_date": 1547633689, "question_id": 54214304, "link": "https://stackoverflow.com/questions/54214304/how-to-erase-value-from-vector-of-struct-using-erase-remove-idiom", "title": "How to erase value from vector of struct using erase-remove idiom?", "body": "<p>How to erase all values from vector of struct, where struct value k equals to 0?</p>\n\n<pre><code>struct tabuRecord {\nint x;\nint y;\nint k;\ntabuRecord( int x, int y, int k)\n    : x(x), y(y), k(k){}\n};  \n\nvector &lt;tabuRecord&gt; tabu;\n\nv.insert(v.begin(), tabuRecord(1, 2, 3));\nv.insert(v.begin(), tabuRecord(4, 5, 0));\nv.insert(v.begin(), tabuRecord(7, 8, 9));\nv.insert(v.begin(), tabuRecord(10, 11, 0));\n</code></pre>\n\n<p>I have tried to </p>\n\n<pre><code>tabu.erase(std::remove(tabu.begin(), tabu.end(), tabu.k=0), tabu.end());\n</code></pre>\n\n<p>and</p>\n\n<pre><code>tabu.erase(std::remove(tabu.begin(), tabu.end(), tabuRecord.k=0), tabu.end());\n</code></pre>\n"}, {"tags": ["c++", "c", "macos", "qt", "native"], "comments": [{"owner": {"reputation": 11609, "user_id": 233944, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/231ea4f1017c30d4fabcda7671c91f27?s=128&d=identicon&r=PG", "display_name": "TheNextman", "link": "https://stackoverflow.com/users/233944/thenextman"}, "edited": false, "score": 0, "creation_date": 1547655064, "post_id": 54214268, "comment_id": 95267865, "body": "The crash reports are in ~/Library/Logs/DiagnosticReports, you can read them from there. It&#39;s not a &quot;hard way&quot; :)"}], "answers": [{"tags": [], "owner": {"reputation": 753, "user_id": 6229173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f20c8a9b53939417106f864f2d347038?s=128&d=identicon&r=PG&f=1", "display_name": "markus-nm", "link": "https://stackoverflow.com/users/6229173/markus-nm"}, "is_accepted": true, "score": 0, "last_activity_date": 1547639829, "creation_date": 1547639829, "answer_id": 54216585, "question_id": 54214268, "link": "https://stackoverflow.com/questions/54214268/retrieve-crash-report-programmatically-on-macos/54216585#54216585", "title": "Retrieve crash report programmatically on macOS", "body": "<p>Yes, but only if you publish your software via App Store. Crash reports are then gathered by the OS and can be retrieved on the App-Store-developer site. The user has the last say in whether the reports are delivered to Apple/you however.</p>\n"}], "owner": {"reputation": 35, "user_id": 10804781, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b7e77282e0cb612c2b79e3c3963a72d?s=128&d=identicon&r=PG&f=1", "display_name": "Ivelin Krastev", "link": "https://stackoverflow.com/users/10804781/ivelin-krastev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 54216585, "answer_count": 1, "score": 0, "last_activity_date": 1547639829, "creation_date": 1547632061, "question_id": 54214268, "link": "https://stackoverflow.com/questions/54214268/retrieve-crash-report-programmatically-on-macos", "title": "Retrieve crash report programmatically on macOS", "body": "<p>I am implementing my own C/C++ app using the Qt framework.\nI want to retrieve the last crash log of my app at the time it crashes and send it to my API.\nIs there a Apple native or terminal way to retrieve the log or do I have to retrieve it the hard way?</p>\n\n<p>Thank you in advance.</p>\n"}, {"tags": ["c++", "pthreads", "glib", "gtkmm"], "answers": [{"comments": [{"owner": {"reputation": 734, "user_id": 2118693, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vVRBY.jpg?s=128&g=1", "display_name": "jmgonet", "link": "https://stackoverflow.com/users/2118693/jmgonet"}, "edited": false, "score": 0, "creation_date": 1548489263, "post_id": 54271109, "comment_id": 95567100, "body": "Yes, Glib::Dispatcher, that was the answer. Thank you very much."}], "tags": [], "owner": {"reputation": 51182, "user_id": 172999, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b2014c8170f4d16a313cfa79071fd861?s=128&d=identicon&r=PG", "display_name": "ptomato", "link": "https://stackoverflow.com/users/172999/ptomato"}, "is_accepted": true, "score": 1, "last_activity_date": 1547929757, "creation_date": 1547929757, "answer_id": 54271109, "question_id": 54214243, "link": "https://stackoverflow.com/questions/54214243/in-gtkmm-on-draw-method-stops-being-called-after-invalidate-occurs-in-separated/54271109#54271109", "title": "In GTKMM, on_draw method stops being called after invalidate occurs in separated thread", "body": "<p>You can't use GTK methods from any other thread than the one in which you started the GTK main loop. Probably the <code>win-&gt;invalidate()</code> call is causing things to go wrong here.</p>\n\n<p>Instead, use <a href=\"https://developer.gnome.org/gtkmm-tutorial/stable/sec-using-glib-dispatcher.html.en\" rel=\"nofollow noreferrer\"><code>Glib::Dispatcher</code></a> to communicate with the main thread, or use <code>gdk_threads_add_idle()</code> for a more C-style solution.</p>\n"}, {"tags": [], "owner": {"reputation": 734, "user_id": 2118693, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vVRBY.jpg?s=128&g=1", "display_name": "jmgonet", "link": "https://stackoverflow.com/users/2118693/jmgonet"}, "is_accepted": false, "score": 0, "last_activity_date": 1548490547, "creation_date": 1548490547, "answer_id": 54376746, "question_id": 54214243, "link": "https://stackoverflow.com/questions/54214243/in-gtkmm-on-draw-method-stops-being-called-after-invalidate-occurs-in-separated/54376746#54376746", "title": "In GTKMM, on_draw method stops being called after invalidate occurs in separated thread", "body": "<p>Based on the answer form @ptomato, I've rewritten my example code. The golden rule is <strong>do not call GUI functions from another thread, but if you do, then acquire some specific GDK locks first</strong>. That's the purpose of <a href=\"https://developer.gnome.org/gtkmm-tutorial/stable/sec-using-glib-dispatcher.html.en\" rel=\"nofollow noreferrer\">Glib::Dispatcher</a> : </p>\n\n<blockquote>\n  <p>If a Glib::Dispatcher object is constructed in the main GUI thread (which will therefore be the receiver thread), any worker thread can emit on it and have the connected slots safely execute gtkmm functions. </p>\n</blockquote>\n\n<p>Based on that, I've added a new private member <code>Glib::Dispatcher refreshDrawingDispatcher</code> that will allow threads to safely the <code>invalidate</code> the windows area:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>    #ifndef CAMERA_DRAWING_AREA_HPP\n    #define CAMERA_DRAWING_AREA_HPP\n\n    #include &lt;gtkmm.h&gt;\n    #include &lt;thread&gt;\n\n    class CameraDrawingArea :\n    public Gtk::DrawingArea {\n    public:\n        CameraDrawingArea();\n        virtual ~CameraDrawingArea();\n\n    protected:\n        bool on_draw(const Cairo::RefPtr&lt;Cairo::Context&gt;&amp; cr) override;\n\n    private:\n        bool keepCapturing;\n        void doCapture();\n        void refreshDrawing();\n        Glib::Dispatcher refreshDrawingDispatcher;\n        std::thread* captureThread;\n        Pango::FontDescription fontDescription;\n    };\n    #endif\n</code></pre>\n\n<p>Then, I've connected the dispatcher to the <code>refreshDrawing</code> method. I do this in the class constructor, which is called during GUI start up and therefore in the main GUI thread:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>    CameraDrawingArea::CameraDrawingArea():\n    refreshDrawingDispatcher(),\n    captureThread(nullptr) {\n        fontDescription.set_family(\"Monospace\");\n        fontDescription.set_weight(Pango::WEIGHT_BOLD);\n        fontDescription.set_size(30 * Pango::SCALE);\n\n        keepCapturing = true;\n        captureThread = new std::thread([this] {\n                doCapture(); \n                });\n\n        refreshDrawingDispatcher.connect(sigc::mem_fun(*this, &amp;CameraDrawingArea::refreshDrawing));\n    }   \n</code></pre>\n\n<p>Finally, the thread has to call the dispatcher:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>    void CameraDrawingArea::doCapture() {\n        while (keepCapturing) {\n            float f = 0.0;\n            for (int n = 0; n &lt; 1000; n++) {\n                for (int m = 0; m &lt; 1000; m++) {\n                    for (int o = 0; o &lt; 500; o++) {\n                        f += 1.2;\n                    }\n                }\n            }\n            std::cout &lt;&lt; \"doCapture - \" &lt;&lt; f &lt;&lt; std::endl; \n            refreshDrawingDispatcher.emit();\n        }\n    }\n</code></pre>\n\n<p>And now, this works without further problems.</p>\n"}], "owner": {"reputation": 734, "user_id": 2118693, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vVRBY.jpg?s=128&g=1", "display_name": "jmgonet", "link": "https://stackoverflow.com/users/2118693/jmgonet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 294, "favorite_count": 0, "accepted_answer_id": 54271109, "answer_count": 2, "score": 0, "last_activity_date": 1548490547, "creation_date": 1547631998, "question_id": 54214243, "link": "https://stackoverflow.com/questions/54214243/in-gtkmm-on-draw-method-stops-being-called-after-invalidate-occurs-in-separated", "title": "In GTKMM, on_draw method stops being called after invalidate occurs in separated thread", "body": "<p>Using GTKMM, I'm extending the <em>DrawingArea</em> widget with the idea that an external process provides it with images. My <em>CameraDrawingArea</em> will then  display the images at the right size using <em>Cairo</em>.</p>\n\n<p>Each time an image arrives, I store it and I call the <code>invalidate</code> method, which eventually ends up in a call to <code>on_draw</code>, where I can resize and display the image.</p>\n\n<p>My problem is the following:</p>\n\n<ul>\n<li>The first 10 or 20 images are displayed as I expected.</li>\n<li>After a while, the images keep coming from the provider process, I keep calling <code>invalidate</code></li>\n<li>but <code>on_draw</code> is not called any more. </li>\n</ul>\n\n<p>To show it here, I've simplified the code so that there is nothing external to the class, and no link with other libraries. I've replaced the process providing the images by a method with for-loops, and the display of the image by printing a simple text in the middle of the widget area:</p>\n\n<ul>\n<li>In the constructor I launch a new <code>std::thread</code> to call the <code>doCapture</code> method in the same instance. I also set up a font description, to use it later.</li>\n<li>The <code>doCapture</code> method is a silly CPU eater, that does nothing except calling from time to time the <code>refreshDrawing</code> method, as long as <code>keepCapturing</code> is not <code>false</code>.</li>\n<li><code>refreshDrawing</code> invalidates the whole window's rectangle via a call to <code>invalidate</code>.</li>\n<li>Gtk's magic is suppose to call <code>on_draw</code> and provide a <em>Cairo</em> context to draw whatever. In my case, for tests purposes, I draw a brownish centered integer.</li>\n<li>The class destructor stops the thread by set <code>keepCapturing</code> to false, and waits for termination with a <code>join</code>.</li>\n</ul>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>    #include \"camera-drawing-area.hpp\"\n\n    #include &lt;iostream&gt;\n\n    CameraDrawingArea::CameraDrawingArea():\n    captureThread(nullptr) {\n        fontDescription.set_family(\"Monospace\");\n        fontDescription.set_weight(Pango::WEIGHT_BOLD);\n        fontDescription.set_size(30 * Pango::SCALE);\n\n        keepCapturing = true;\n        captureThread = new std::thread([this] { \n                doCapture(); \n                });\n    }\n\n    void CameraDrawingArea::doCapture() {\n        while (keepCapturing) {\n            float f = 0.0;\n            for (int n = 0; n &lt; 1000; n++) {\n                for (int m = 0; m &lt; 1000; m++) {\n                    for (int o = 0; o &lt; 500; o++) {\n                        f += 1.2;\n                    }\n                }\n            }\n            std::cout &lt;&lt; \"doCapture - \" &lt;&lt; f &lt;&lt; std::endl; \n            refreshDrawing();\n        }\n    }\n\n    void CameraDrawingArea::refreshDrawing() {\n        auto win = get_window();\n        if (win) {\n            win-&gt;invalidate(false);\n            std::cout &lt;&lt; \"refreshDrawing\" &lt;&lt; std::endl; \n        }\n    }\n\n    bool CameraDrawingArea::on_draw(const Cairo::RefPtr&lt;Cairo::Context&gt;&amp; cr) {\n        std::cout &lt;&lt; \"on_draw\" &lt;&lt; std::endl; \n\n        static char buffer[50];\n        static int n = 0;\n        sprintf(buffer, \"-%d-\", n++);\n\n        Gtk::Allocation allocation = get_allocation();\n        const int width = allocation.get_width();\n        const int height = allocation.get_height();\n\n\n        auto layout = create_pango_layout(buffer);\n        layout-&gt;set_font_description(fontDescription);\n\n        int textWidth, textHeight;\n        layout-&gt;get_pixel_size(textWidth, textHeight);\n        cr-&gt;set_source_rgb(0.5, 0.2, 0.1);\n        cr-&gt;move_to((width - textWidth) / 2, (height - textHeight) / 2);\n        layout-&gt;show_in_cairo_context(cr);\n        cr-&gt;stroke();\n\n        return true;\n    }\n\n    CameraDrawingArea::~CameraDrawingArea() {\n        keepCapturing = false;\n        captureThread-&gt;join();\n        free(captureThread);\n    }\n</code></pre>\n\n<p>And this is my header file:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>    #ifndef CAMERA_DRAWING_AREA_HPP\n    #define CAMERA_DRAWING_AREA_HPP\n\n    #include &lt;gtkmm.h&gt;\n    #include &lt;thread&gt;\n\n    class CameraDrawingArea : public Gtk::DrawingArea {\n    public:\n        CameraDrawingArea();\n        virtual ~CameraDrawingArea();\n\n    protected:\n        bool on_draw(const Cairo::RefPtr&lt;Cairo::Context&gt;&amp; cr) override;\n\n    private:\n        bool keepCapturing;\n        void doCapture();\n        void refreshDrawing();\n        std::thread* captureThread;\n        Pango::FontDescription fontDescription;\n    };\n    #endif\n</code></pre>\n\n<p>The problem manifests itself as follows:</p>\n\n<ul>\n<li>When starting the application, it faithfully displays 1, 2, 3...</li>\n<li>Between 5th and 20th iteration (it's random, but rarely outside these ranges), it stops refreshing.</li>\n<li>Because of the <code>cout</code>, I can see that <code>refreshDrawing</code> is called be sure that <code>invalidate</code> is also called, but <code>on_draw</code> isn't.</li>\n</ul>\n\n<p>Also, if I stop the application before it stops refreshing, then it ends up nicely. But, if I stop the application after it stops refreshing, then I see this message below (the ID value varies):</p>\n\n<pre><code>GLib-CRITICAL **: 10:05:04.716: Source ID 25 was not found when attempting to remove it\n</code></pre>\n\n<p>I'm quite sure that I do something wrong, but clueless about what. Any help would be appreciated.</p>\n\n<p>I also checked the following questions, but they don't seem to be related with my case:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/36554190/draw-signal-doesnt-get-fired-in-gtkmm-when-derived-class-doesnt-call-a-superc\">Draw signal doesn&#39;t get fired in GTKMM, when derived class doesn&#39;t call a superclass&#39;s constructor</a></li>\n</ul>\n"}, {"tags": ["c++", "memory-management", "access-violation", "memcpy", "crash-dumps"], "comments": [{"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 3, "creation_date": 1547631255, "post_id": 54213917, "comment_id": 95253730, "body": "Writing to (or even reading from) memory you don&#39;t &quot;own&quot; leads to <i>undefined behavior</i>. Without source it&#39;s really going to be extremely hard to find the problem and what caused it. It&#39;s also going to be nigh impossible to fix it anyway. As for <i>guessing</i> about possible reasons, perhaps an uninitialized local pointer variable was used?"}, {"owner": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "edited": false, "score": 0, "creation_date": 1547631442, "post_id": 54213917, "comment_id": 95253850, "body": "All the <code>??</code> let me think that memory at this address doesn not belong to the debugged process. (Even the debugger is not willing or able to read it.) So, this really looks like an &quot;Access violation&quot;."}, {"owner": {"reputation": 8351, "user_id": 4279155, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/841b7391f3f7873bec1a8d9d8d2dc759?s=128&d=identicon&r=PG&f=1", "display_name": "Dominique", "link": "https://stackoverflow.com/users/4279155/dominique"}, "reply_to_user": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "edited": false, "score": 0, "creation_date": 1547631707, "post_id": 54213917, "comment_id": 95254021, "body": "@Scheff: What do you mean by &quot;not belonging to the debugged process&quot;? I thought that, in Windows, every process has the permission to use every piece of free memory to do its job, without limitation (except when the computer runs out of memory, of course). Can you confirm this and where can I find information about this?"}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1547631783, "post_id": 54213917, "comment_id": 95254055, "body": "The memory could be write-protected. Also, if the only thing on the call stack is <code>memcpy</code>, you&#39;ve probably smashed the stack very badly."}, {"owner": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "edited": false, "score": 0, "creation_date": 1547631845, "post_id": 54213917, "comment_id": 95254100, "body": "Definitely not. Every process has to request blocks of memory from the OS (the Windows kernel). Afterwards it may read/write access exclusively this memory. Other parts of overall memory must be in-accessable. This is for protection of processes against each other. <a href=\"https://en.wikipedia.org/wiki/Memory_protection\" rel=\"nofollow noreferrer\">Wikipedia: Memory Protection</a>"}, {"owner": {"reputation": 8351, "user_id": 4279155, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/841b7391f3f7873bec1a8d9d8d2dc759?s=128&d=identicon&r=PG&f=1", "display_name": "Dominique", "link": "https://stackoverflow.com/users/4279155/dominique"}, "reply_to_user": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "edited": false, "score": 0, "creation_date": 1547632022, "post_id": 54213917, "comment_id": 95254204, "body": "@Scheff: so we could have the following situation here: some applications are using quite a lot of memory. One application wants to use some more (while it already using quite some memory). In order to do this, it wants to reserve a block of memory from the OS kernel. However, there are no more blocks available, and the application crashes. When this is the case, shouldn&#39;t I get an <code>Out-of-Memory</code> error instead of an access violation?"}, {"owner": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "edited": false, "score": 0, "creation_date": 1547632303, "post_id": 54213917, "comment_id": 95254399, "body": "Yepp - out-of-memory. Though, there are multiple ways to handle out-of-memory - throwing an exception, just remember a null pointer, or trying to use the address without checking. The latter is good for the access violation but the not so bad address value does not look like this. May be, this is an out of bound access that happened just at the end of granted address space. However, it&#39;s all guessing without more details..."}, {"owner": {"reputation": 32386, "user_id": 4706785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdee2789e9bac57bfdd97abc4e533a4d?s=128&d=identicon&r=PG&f=1", "display_name": "Peter", "link": "https://stackoverflow.com/users/4706785/peter"}, "edited": false, "score": 0, "creation_date": 1547632318, "post_id": 54213917, "comment_id": 95254412, "body": "@Dominique - that depends on a lot of things.   If a program doesn&#39;t check if an allocation succeeds, and attempts to use the memory anyway, then using the memory can result in an access violation.     The cause of an access violation, and also other symptoms related to abnormal program termination, is often the operating  system detecting a program accessing something it shouldn&#39;t (e.g. memory that the operating system has not provided to that program) and then forceably terminating the program."}, {"owner": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "edited": false, "score": 0, "creation_date": 1547632416, "post_id": 54213917, "comment_id": 95254474, "body": "When I went out of memory on Windows last time, it looked very different: At first, everything became very slow as system started to swap memory pages. Finally, the overload was so heavy that even the mouse pointer stopped to move. After waiting a bit the whole system was totally unresponsive (though it still did uninterruptedly things with the HDD) and I switched the computer off. :-)"}, {"owner": {"reputation": 8351, "user_id": 4279155, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/841b7391f3f7873bec1a8d9d8d2dc759?s=128&d=identicon&r=PG&f=1", "display_name": "Dominique", "link": "https://stackoverflow.com/users/4279155/dominique"}, "edited": false, "score": 0, "creation_date": 1547632627, "post_id": 54213917, "comment_id": 95254608, "body": "Scheff and Peter: thanks a lot for your very quick responses. It&#39;s now clear to me that the real problem here is not the access violation, but the simple fact that my program went so high in memory usage. I&#39;ll advise the operation engineers to keep a close look on that program and once the memory consumption raises too high, a temporary memory dump should be taken in order to see if that memory consumption can be reduced. Scheff, if you summarise your comments into an answer, I&#39;ll accept it."}, {"owner": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "edited": false, "score": 0, "creation_date": 1547632752, "post_id": 54213917, "comment_id": 95254681, "body": "Thanks for the offer but I think it&#39;s not worth a good answer as lacking a clear problem to be answered. It&#39;s a lot of guessing. However, if I could help to make things clearer I&#39;m happy with that. ;-)"}, {"owner": {"reputation": 16907, "user_id": 4832499, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/76532994f6efa8d7dc8a3bb5b7b262a8?s=128&d=identicon&r=PG&f=1", "display_name": "Passer By", "link": "https://stackoverflow.com/users/4832499/passer-by"}, "edited": false, "score": 0, "creation_date": 1547635754, "post_id": 54213917, "comment_id": 95256419, "body": "As it stands, the question will probably be closed due to a lack of a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>, I suggest you provide one."}], "answers": [{"tags": [], "owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "is_accepted": false, "score": 1, "last_activity_date": 1547631406, "creation_date": 1547631406, "answer_id": 54214069, "question_id": 54213917, "link": "https://stackoverflow.com/questions/54213917/can-an-access-violation-be-a-disguised-out-of-memory-error/54214069#54214069", "title": "Can an access violation be a disguised out-of-memory error?", "body": "<p>Without seeing the source code, there's no way to know what it might do if it encounters an out-of-memory error. There are certainly lots of programs out there that don't check every memory allocation for failure and their code could go completely off the rails as a result.</p>\n\n<p>The most common result of an out-of-memory error that isn't checked is an access violation, but it's usually at an address that's either very small or has some obvious nonsenical pattern in it. This is because many memory allocation functions return zero when they're out of memory and a failure to check could result in accessing an address near the returned value. Also, some functions leave the result uninitialized and return a separate error. Failing to check that error might result in using the uninitialized value to access memory and that usually looks very strange.</p>\n\n<p>Here, the address looks reasonable. But who knows. Maybe the code allocates a new buffer, frees the old one, and switches the old address for the new one but, on an error, doesn't switch addresses but does free the old address, causing an access after free. Without the source code, there's no way to know.</p>\n"}, {"tags": [], "owner": {"reputation": 8351, "user_id": 4279155, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/841b7391f3f7873bec1a8d9d8d2dc759?s=128&d=identicon&r=PG&f=1", "display_name": "Dominique", "link": "https://stackoverflow.com/users/4279155/dominique"}, "is_accepted": true, "score": 0, "last_activity_date": 1547640624, "creation_date": 1547640624, "answer_id": 54216796, "question_id": 54213917, "link": "https://stackoverflow.com/questions/54213917/can-an-access-violation-be-a-disguised-out-of-memory-error/54216796#54216796", "title": "Can an access violation be a disguised out-of-memory error?", "body": "<p>It is indeed possible that an access violation is in fact an out-of-memory error (or other kind of memory related error), as mentioned in the comments of Scheff and Peter.</p>\n\n<p>In this particular case, the large size of the dump (\u00b133Gb) is an indication that the application (together with other applications) might consume too much memory.</p>\n"}, {"tags": [], "owner": {"reputation": 18530, "user_id": 3344003, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/988af95d5692ee66b1fc2fe725ba738e?s=128&d=identicon&r=PG&f=1", "display_name": "user3344003", "link": "https://stackoverflow.com/users/3344003/user3344003"}, "is_accepted": false, "score": 0, "last_activity_date": 1547680673, "creation_date": 1547680673, "answer_id": 54226833, "question_id": 54213917, "link": "https://stackoverflow.com/questions/54213917/can-an-access-violation-be-a-disguised-out-of-memory-error/54226833#54226833", "title": "Can an access violation be a disguised out-of-memory error?", "body": "<p>Intuitively, it does not look to me like an out of memory error. Memory allocation system services on some poorly designed operating systems will return successfully values when they have failed to allocate the memory. As many flaws as Windoze has, I do not believe it is such a system. If you were running on a system that does do some kind of delayed allocation, then I'd suspect what you suspect.</p>\n\n<p>Methinks, that you are getting a memory overrun that is causing a write to a page that has not been mapped into the address space. </p>\n"}], "owner": {"reputation": 8351, "user_id": 4279155, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/841b7391f3f7873bec1a8d9d8d2dc759?s=128&d=identicon&r=PG&f=1", "display_name": "Dominique", "link": "https://stackoverflow.com/users/4279155/dominique"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 869, "favorite_count": 0, "accepted_answer_id": 54216796, "answer_count": 3, "score": 3, "last_activity_date": 1547680673, "creation_date": 1547630862, "question_id": 54213917, "link": "https://stackoverflow.com/questions/54213917/can-an-access-violation-be-a-disguised-out-of-memory-error", "title": "Can an access violation be a disguised out-of-memory error?", "body": "<p>I'm debugging a 64-bit C++ (managed) crash dump (access violation).</p>\n\n<p>The dump has a total size of 32.374.535 kb.</p>\n\n<p>The application is multi-threaded, and the corresponding call stack only mentions <code>mscvrt.dll!memcpy</code> (I don't know which other thread is creating this one). Obviously there is no corresponding source code.</p>\n\n<p>The Visual Studio <code>Locals</code> window is empty.</p>\n\n<p>The unhandled exception mentions <code>Access violation writing location 0x000000F02A6BB000</code>, but on that location, there seems to be nothing:</p>\n\n<pre><code>0x000000F02A6BAF84  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ..............................................................\n0x000000F02A6BAFC2  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ..............................................................\n0x000000F02A6BB000  ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??  .............................................................. &lt;= here it is.\n0x000000F02A6BB03E  ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??  ..............................................................\n</code></pre>\n\n<p>I don't see any reason why the writing on this memory location would cause any problem, therefore I believe (based on the size of the dump) that I'm dealing with a memory error (meaning it would impossible to copy something into memory, because so many memory is already used that there's no room left). However, if this would be true, shouldn't there be some information in that memory location?</p>\n\n<p>Does anybody have an idea about this?</p>\n"}, {"tags": ["c++", "qt", "qlineedit"], "comments": [{"owner": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "edited": false, "score": 0, "creation_date": 1547641586, "post_id": 54213701, "comment_id": 95259703, "body": "Your question raised my attention. I investigated a little bit and am about to prepare answer. Before, I would like to ask: Why do you need to know the start position of text?"}, {"owner": {"reputation": 14632, "user_id": 399908, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/56ea829e87b7772e36a35782dde9fb94?s=128&d=identicon&r=PG", "display_name": "Martin Hennings", "link": "https://stackoverflow.com/users/399908/martin-hennings"}, "edited": false, "score": 0, "creation_date": 1547642119, "post_id": 54213701, "comment_id": 95259968, "body": "AFAIK that&#39;s not possible. Perhaps you could describe what you <i>want</i> to do?"}, {"owner": {"reputation": 3000, "user_id": 7611028, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/070114bcdaeea4fc70434718b584f0e0?s=128&d=identicon&r=PG&f=1", "display_name": "thibsc", "link": "https://stackoverflow.com/users/7611028/thibsc"}, "reply_to_user": {"reputation": 14632, "user_id": 399908, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/56ea829e87b7772e36a35782dde9fb94?s=128&d=identicon&r=PG", "display_name": "Martin Hennings", "link": "https://stackoverflow.com/users/399908/martin-hennings"}, "edited": false, "score": 0, "creation_date": 1547642761, "post_id": 54213701, "comment_id": 95260304, "body": "@MartinHennings and @Scheff I want to know the start to begin draw at the right x position for my <a href=\"https://github.com/thibDev/qtCustomPlugins\" rel=\"nofollow noreferrer\">LineEditTag</a> when I have QAction. I think to a possible solution, use the <a href=\"http://doc.qt.io/qt-5/qlineedit.html#cursorRect\" rel=\"nofollow noreferrer\"><code>cursorRect()</code></a> and manage something with position of the rect."}, {"owner": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "edited": false, "score": 0, "creation_date": 1547644517, "post_id": 54213701, "comment_id": 95261300, "body": "If you use a &quot;one line high&quot; <code>QTextEdit</code> - embedding of images would become much easier. Another option could be to use a specific character for this e.g. <code>\u2715</code> (U+2715). Finally, I believe it&#39;s easier to derive a custom widget for this where you make painting and mouse interaction on your own than trying to tweak the <code>QLineEdit</code>. The <a href=\"http://doc.qt.io/qt-5/qtwidgets-draganddrop-fridgemagnets-example.html\" rel=\"nofollow noreferrer\">Fridge Magnets Example</a> could be a good start."}, {"owner": {"reputation": 3000, "user_id": 7611028, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/070114bcdaeea4fc70434718b584f0e0?s=128&d=identicon&r=PG&f=1", "display_name": "thibsc", "link": "https://stackoverflow.com/users/7611028/thibsc"}, "reply_to_user": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "edited": false, "score": 0, "creation_date": 1547645475, "post_id": 54213701, "comment_id": 95261863, "body": "@Scheff it&#39;s seems to be work with the <code>cursorRect()</code> method, the x position of the returned rect looks to be the offset"}, {"owner": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "edited": false, "score": 0, "creation_date": 1547645792, "post_id": 54213701, "comment_id": 95262043, "body": "I sent my answer though I believe it leads rather into a dead end. Please, take this as another argument for my previous recommendations."}], "answers": [{"comments": [{"owner": {"reputation": 3000, "user_id": 7611028, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/070114bcdaeea4fc70434718b584f0e0?s=128&d=identicon&r=PG&f=1", "display_name": "thibsc", "link": "https://stackoverflow.com/users/7611028/thibsc"}, "edited": false, "score": 0, "creation_date": 1547646395, "post_id": 54218192, "comment_id": 95262426, "body": "Pretty explanation and investigation. From my side, the cursorRect() method seems to be a viable solution. You idea to use the geometry method of the QAction is an interesting way to get the offset, <code>actions.size()*actions.first().geometry.width()</code>. Thank you very much"}, {"owner": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "reply_to_user": {"reputation": 3000, "user_id": 7611028, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/070114bcdaeea4fc70434718b584f0e0?s=128&d=identicon&r=PG&f=1", "display_name": "thibsc", "link": "https://stackoverflow.com/users/7611028/thibsc"}, "edited": false, "score": 0, "creation_date": 1547646570, "post_id": 54218192, "comment_id": 95262535, "body": "@ThibautB.  It&#39;s a bit fragile. - Please, see my update."}, {"owner": {"reputation": 3000, "user_id": 7611028, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/070114bcdaeea4fc70434718b584f0e0?s=128&d=identicon&r=PG&f=1", "display_name": "thibsc", "link": "https://stackoverflow.com/users/7611028/thibsc"}, "edited": false, "score": 0, "creation_date": 1547646935, "post_id": 54218192, "comment_id": 95262773, "body": "Effectively, It can&#39;t work in every case, I continue my investigation to a better solution ;)"}], "tags": [], "owner": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "is_accepted": false, "score": 3, "last_activity_date": 1547648940, "last_edit_date": 1547648940, "creation_date": 1547645525, "answer_id": 54218192, "question_id": 54213701, "link": "https://stackoverflow.com/questions/54213701/how-to-get-the-qlineedit-text-offset-when-have-qaction-at-leading-position/54218192#54218192", "title": "How to get the QLineEdit text offset when have QAction at leading position", "body": "<p>I must admit that (before reading OPs question) I was not aware about <a href=\"http://doc.qt.io/qt-5/qlineedit.html#addAction-1\" rel=\"nofollow noreferrer\"><code>QLineEdit::addAction()</code></a>. Thus, I wrote a little sample <code>testQLineEditAction.cc</code>:</p>\n\n<pre><code>#include &lt;QtWidgets&gt;\n\nint main(int argc, char **argv)\n{\n  qDebug() &lt;&lt; \"Qt Version:\" &lt;&lt; QT_VERSION_STR;\n  QApplication app(argc, argv);\n  // init GUI\n  QLineEdit qEdit;\n  qEdit.addAction(QIcon(\"./document-properties.svg\"), QLineEdit::LeadingPosition);\n  qEdit.addAction(QIcon(\"./document-save.svg\"), QLineEdit::TrailingPosition);\n  qEdit.show();\n  // runtime loop\n  return app.exec();\n}\n</code></pre>\n\n<p>and this is how it looks (compiled in <a href=\"http://www.cygwin.org\" rel=\"nofollow noreferrer\">cygwin64</a>):</p>\n\n<p><a href=\"https://i.stack.imgur.com/W4Igy.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/W4Igy.png\" alt=\"Snapshot of testQLineEditAction\"></a></p>\n\n<p>Afterwards, I digged a bit through <a href=\"https://code.woboq.org/\" rel=\"nofollow noreferrer\">woboq.org</a> to find out how it is implemented.</p>\n\n<p>I started in <a href=\"https://code.woboq.org/qt5/qtbase/src/widgets/widgets/qlineedit.cpp.html#_ZN9QLineEdit10paintEventEP11QPaintEvent\" rel=\"nofollow noreferrer\"><code>QLineEdit::paintEvent()</code></a>:</p>\n\n<pre><code>void QLineEdit::paintEvent(QPaintEvent *)\n{\n</code></pre>\n\n<p>...</p>\n\n<pre><code>  QStyleOptionFrame panel;\n  initStyleOption(&amp;panel);\n</code></pre>\n\n<p>...</p>\n\n<pre><code>  QRect r = style()-&gt;subElementRect(QStyle::SE_LineEditContents, &amp;panel, this);\n  r.setX(r.x() + d-&gt;effectiveLeftTextMargin());\n  r.setY(r.y() + d-&gt;topTextMargin);\n  r.setRight(r.right() - d-&gt;effectiveRightTextMargin());\n  r.setBottom(r.bottom() - d-&gt;bottomTextMargin);\n</code></pre>\n\n<p>This is interesting: The rectangle for contents is retrieved and then corrected by inner offsets.</p>\n\n<pre><code>  QFontMetrics fm = fontMetrics();\n</code></pre>\n\n<p>...</p>\n\n<pre><code>  QRect lineRect(r.x() + d-&gt;horizontalMargin, d-&gt;vscroll, r.width() - 2*d-&gt;horizontalMargin, fm.height());\n</code></pre>\n\n<p>About the <code>d-&gt;horizontalMargin</code>, I'm not quite sure but I ignored it for now and followed instead <a href=\"https://code.woboq.org/qt5/qtbase/src/widgets/widgets/qlineedit_p.cpp.html#_ZNK16QLineEditPrivate23effectiveLeftTextMarginEv\" rel=\"nofollow noreferrer\"><code>d-&gt;effectiveLeftTextMargin()</code></a>:</p>\n\n<pre><code>int QLineEditPrivate::effectiveLeftTextMargin() const\n{\n    return effectiveTextMargin(leftTextMargin, leftSideWidgetList(), sideWidgetParameters());\n}\n</code></pre>\n\n<p>...</p>\n\n<pre><code>static int effectiveTextMargin(int defaultMargin, const QLineEditPrivate::SideWidgetEntryList &amp;widgets,\n                               const QLineEditPrivate::SideWidgetParameters &amp;parameters)\n{\n    if (widgets.empty())\n        return defaultMargin;\n    return defaultMargin + (parameters.margin + parameters.widgetWidth) *\n           int(std::count_if(widgets.begin(), widgets.end(),\n                             [](const QLineEditPrivate::SideWidgetEntry &amp;e) {\n                                 return e.widget-&gt;isVisibleTo(e.widget-&gt;parentWidget()); }));\n}\n</code></pre>\n\n<p>So, I came to the conclusion that <code>QLineEditPrivate::effectiveLeftTextMargin()</code> considers the space for action icons when effective size of text rectangle is determined.</p>\n\n<p>It's a pity that all these functions are <code>private</code> and thus not accessable from outside. After thinking a while how to get access to these from outside and looking into doc. whether I haven't overseen something, I got the idea to use the <code>QAction</code>s directly for this:</p>\n\n<pre><code>#include &lt;QtWidgets&gt;\n\nvoid inspect(const QString &amp;cmd, QAction &amp;qCmd)\n{\n  qDebug() &lt;&lt; (cmd + \"-&gt;associatedWidgets().size():\")\n    &lt;&lt; qCmd.associatedWidgets().size();\n  int i = 0;\n  for (QWidget *const pQWidget : qCmd.associatedWidgets()) {\n    qDebug() &lt;&lt; '[' &lt;&lt; i++ &lt;&lt; \"]:\"\n      &lt;&lt; typeid(*pQWidget).name()\n      &lt;&lt; \"geometry:\" &lt;&lt; pQWidget-&gt;geometry();\n  }\n}\n\nint main(int argc, char **argv)\n{\n  qDebug() &lt;&lt; \"Qt Version:\" &lt;&lt; QT_VERSION_STR;\n  QApplication app(argc, argv);\n  // init GUI\n  QLineEdit qEdit;\n  qEdit.setText(\"012345678901234567890123456789\");\n  QAction *const pQCmd1\n    = qEdit.addAction(QIcon(\"./document-properties.svg\"), QLineEdit::LeadingPosition);\n  QAction *const pQCmd2\n    = qEdit.addAction(QIcon(\"./document-save.svg\"), QLineEdit::TrailingPosition);\n  qEdit.show();\n  qDebug() &lt;&lt; \"qEdit.geometry():\" &lt;&lt; qEdit.geometry();\n  inspect(\"pQCmd1\", *pQCmd1);\n  inspect(\"pQCmd2\", *pQCmd2);\n  // runtime loop\n  return app.exec();\n}\n</code></pre>\n\n<p>Console output:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Qt Version: 5.9.4\nqEdit.geometry(): QRect(0,0 200x23)\n\"pQCmd1-&gt;associatedWidgets().size():\" 2\n[ 0 ]: 9QLineEdit geometry: QRect(0,0 200x23)\n[ 1 ]: 19QLineEditIconButton geometry: QRect(4,2 22x18)\n\"pQCmd2-&gt;associatedWidgets().size():\" 2\n[ 0 ]: 9QLineEdit geometry: QRect(0,0 200x23)\n[ 1 ]: 19QLineEditIconButton geometry: QRect(174,2 22x18)\n</code></pre>\n\n<p>To compare the values, another snapshot with modified icons (frame drawn in SVGs to show icon size) which has been magnified (factor 5):</p>\n\n<p><a href=\"https://i.stack.imgur.com/tyDVt.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/tyDVt.png\" alt=\"Magnified Snapshot of testQLineEditAction (factor 5)\"></a></p>\n\n<p>Left <code>QLineEditIconButton</code> reported position (4, 2) but the left frame of icon is 8 pixels away from left border of <code>QLineEdit</code>. There is surely a frame around the <code>QLineEditIconButton</code> which has to be considered as well (and I didn't investigate how to retrieve it). The width of frame might be subject of style engine and thus vary between platforms. To make such attempt robust and portable, the respective values should be retrieved from the widgets or from style. This starts to become a tedious fiddling with more or less chance for success.</p>\n\n<p>I ended up once in a similar situation when trying to answer <a href=\"https://stackoverflow.com/a/42690033/7478597\">SO: How to automatically increase/decrease text size in label in Qt</a>.</p>\n\n<hr>\n\n<p>Concerning <a href=\"http://doc.qt.io/qt-5/qlineedit.html#cursorRect\" rel=\"nofollow noreferrer\"><code>QLineEdit::cursorRect()</code></a>:</p>\n\n<p>I believe that using <code>QLineEdit::cursorRect()</code> is (as well) at best fragile.</p>\n\n<p>I modified my above example to check this out:</p>\n\n<pre><code>#include &lt;QtWidgets&gt;\n\nclass LineEdit: public QLineEdit {\n\n  public:\n    QRect cursorRect() const { return QLineEdit::cursorRect(); }\n};\n\nint main(int argc, char **argv)\n{\n  qDebug() &lt;&lt; \"Qt Version:\" &lt;&lt; QT_VERSION_STR;\n  QApplication app(argc, argv);\n  // init GUI\n  LineEdit qEdit;\n  qEdit.setText(\"012345678901234567890123456789\");\n  qEdit.addAction(QIcon(\"./document-properties.svg\"), QLineEdit::LeadingPosition);\n  qEdit.addAction(QIcon(\"./document-save.svg\"), QLineEdit::TrailingPosition);\n  qEdit.show();\n  qDebug() &lt;&lt; \"qEdit.cursorRect():\" &lt;&lt; qEdit.cursorRect();\n  // runtime loop\n  return app.exec();\n}\n</code></pre>\n\n<p>Console output:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Qt Version: 5.9.4\nqEdit.geometry(): QRect(0,0 200x23)\nqEdit.cursorRect(): QRect(253,0 9x16)\n</code></pre>\n\n<p>Funny, that the cursor x-position is not only quite high &ndash; it's even higher than the width of <code>qEdit</code>. How comes? The initial text <code>\"012345678901234567890123456789\"</code> I put into <code>qEdit</code> causes the cursor to be close to the right whereby horizontal scrolling happens. The cursor position seems to be related to the virtual text width (including the clipped range on the left side).</p>\n"}], "owner": {"reputation": 3000, "user_id": 7611028, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/070114bcdaeea4fc70434718b584f0e0?s=128&d=identicon&r=PG&f=1", "display_name": "thibsc", "link": "https://stackoverflow.com/users/7611028/thibsc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 512, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1547648940, "creation_date": 1547630120, "question_id": 54213701, "link": "https://stackoverflow.com/questions/54213701/how-to-get-the-qlineedit-text-offset-when-have-qaction-at-leading-position", "title": "How to get the QLineEdit text offset when have QAction at leading position", "body": "<p>I have a <a href=\"http://doc.qt.io/qt-5/qlineedit.html\" rel=\"nofollow noreferrer\"><code>QLineEdit</code></a> with a <a href=\"http://doc.qt.io/qt-5/qaction.html\" rel=\"nofollow noreferrer\"><code>QAction</code></a> at leading position. I want to know the start position of the text but I don't find how to do:</p>\n\n<pre><code>QLineEdit *le = new QLineEdit(parent);\nle-&gt;addAction(QIcon(\":/myicon\"), QLineEdit::LeadingPosition);\n// Now I want to get the text start position\n// but both return \"QMargins(0, 0, 0, 0) QMargins(0, 0, 0, 0)\"\nqDebug() &lt;&lt; le-&gt;textMargins() &lt;&lt; le-&gt;contentsMargins();\n</code></pre>\n\n<p>I searched in the qt's github sources to find if the <a href=\"http://doc.qt.io/qt-5/qlineedit.html#addAction-1\" rel=\"nofollow noreferrer\"><code>addAction()</code></a> method does something on the contents or text margins but without success.</p>\n"}]