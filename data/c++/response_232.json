[{"tags": ["c++", "concurrency", "posix", "pty"], "comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1560988296, "post_id": 56677228, "comment_id": 99921387, "body": "When you call <code>fork</code> the two new processes don&#39;t share memory between each other (usually). So even if the parent adds some messages to the buffer, the child won&#39;t see them because it has its own message buffer which is still empty."}, {"owner": {"reputation": 83151, "user_id": 3943312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc00b38b94ca7b6f820622b0a8af8ded?s=128&d=identicon&r=PG", "display_name": "Sam Varshavchik", "link": "https://stackoverflow.com/users/3943312/sam-varshavchik"}, "edited": false, "score": 0, "creation_date": 1560988475, "post_id": 56677228, "comment_id": 99921417, "body": "And even if the processes did share memory, or if this was a proper multi-threaded program, this is guaranteed to result in a crash, because there is absolutely no mutex protection whatsoever, and none of the C++ library classes are thread-safe."}, {"owner": {"reputation": 944, "user_id": 1499575, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/82374abfce29c20a6f214de4fa2226f5?s=128&d=identicon&r=PG", "display_name": "mreff555", "link": "https://stackoverflow.com/users/1499575/mreff555"}, "edited": false, "score": 0, "creation_date": 1560989133, "post_id": 56677228, "comment_id": 99921538, "body": "Thats what I figured.  Is there a way to join the threads.  As for Mutex locks, I&#39;m in the proof of concept phase.  Be patient."}, {"owner": {"reputation": 944, "user_id": 1499575, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/82374abfce29c20a6f214de4fa2226f5?s=128&d=identicon&r=PG", "display_name": "mreff555", "link": "https://stackoverflow.com/users/1499575/mreff555"}, "edited": false, "score": 0, "creation_date": 1560989407, "post_id": 56677228, "comment_id": 99921585, "body": "I think I found an answer to my question here: <a href=\"https://stackoverflow.com/questions/5656530/how-to-use-shared-memory-with-linux-in-c\" title=\"how to use shared memory with linux in c\">stackoverflow.com/questions/5656530/&hellip;</a>"}, {"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 0, "creation_date": 1560989596, "post_id": 56677228, "comment_id": 99921614, "body": "Before messing with shared memory I&#39;d make certain that fork is the right solution for the message-handling problem. You&#39;re already using <code>select</code>, can you not expand that to running a <code>select</code>-based server and keep all of the communications in one process or thread?"}, {"owner": {"reputation": 944, "user_id": 1499575, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/82374abfce29c20a6f214de4fa2226f5?s=128&d=identicon&r=PG", "display_name": "mreff555", "link": "https://stackoverflow.com/users/1499575/mreff555"}, "edited": false, "score": 0, "creation_date": 1560990090, "post_id": 56677228, "comment_id": 99921700, "body": "I tried messing with select, given the documentation is fairly limited.  can you recommend a path forward?"}], "owner": {"reputation": 944, "user_id": 1499575, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/82374abfce29c20a6f214de4fa2226f5?s=128&d=identicon&r=PG", "display_name": "mreff555", "link": "https://stackoverflow.com/users/1499575/mreff555"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1560987608, "creation_date": 1560987608, "question_id": 56677228, "link": "https://stackoverflow.com/questions/56677228/attempting-to-read-from-a-file-descriptor-into-a-buffer-fails-when-accessed-outs", "title": "Attempting to read from a file descriptor into a buffer fails when accessed outside the object", "body": "<p>I've never worked with file descriptors and I'm a bit confused about some of this behavior. I'm also fairly new to concurrency and the documentation for these functions is fairly lacking.</p>\n\n<p>My MessageReciever constructor opens a pty. Upon calling the Receive message, as I understand it, the code forks. The master should hit the next conditional and return from the function. I know this is happening because the code in main doesn't block.  The child reads in the file descriptor, converts it to a string and saves it in a vector.  Currently I'm printing the buffer directly but I also can print the last element in the vector and it acts basically the same. However, when I attempt to access this outside the class, in main, I get nothing. I thought this might be some type of concurrency problem, but I'm not really sure how to address. </p>\n\n<p><strong>CODE</strong></p>\n\n<pre><code>#include &lt;sys/time.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;sys/select.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;util.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;sys/wait.h&gt;\n#include &lt;string&gt;\n#include &lt;vector&gt;\n\nclass MessageReceiver\n{\n  public:\n  MessageReceiver()\n  {\n    openpty(&amp;master, &amp;slave, NULL, NULL, NULL);\n  }\n\n  ~MessageReceiver()\n  {\n    close(master);\n    close(slave);\n  }\n\n  void receiveMessage()\n  {\n    pid_t pid = fork();\n    printf(\"PID = %d\\n\",pid);\n    if(pid &gt; 0)\n    {\n      fd_set rfds;\n      struct timeval tv;\n      tv.tv_sec = 0;\n      tv.tv_usec = 0;\n      char buf[4097];\n      ssize_t size;\n      size_t count = 0;\n\n      while (1)\n      {\n        if (waitpid(pid, NULL, WNOHANG) == pid) \n        {\n          break;\n        }\n        FD_ZERO(&amp;rfds);\n        FD_SET(master, &amp;rfds);\n        if (select(master + 1, &amp;rfds, NULL, NULL, &amp;tv)) \n        {\n          size = read(master, buf, 4096);\n          printf(\"Buffer = %s\", buf);\n          messageBuffer.push_back(std::string(buf));\n          buf[size] = '\\0';\n          count += size;\n        }\n      }\n\n    }\n\n  }\n\n  std::string getLastMessage()\n  {\n    std::string s;\n    if(messageBuffer.size() &gt; 0)\n    {\n      s = messageBuffer.back();\n    }\n    else\n    {\n      s = \"NULL\";\n    }\n    return s;\n  }\n\n  private:\n  int master, slave;\n  std::vector&lt;std::string&gt; messageBuffer;\n};\n\nint main()\n{\n  MessageReceiver m;\n  m.receiveMessage();\n  std::string lastMessage = m.getLastMessage();\n  printf(\"Printing message buffer:\\n\");\n  for(;;)\n  {\n    if(m.getLastMessage() != lastMessage)\n    {\n      printf(\"Message: %s\\n\", m.getLastMessage().c_str());\n    }\n  }\n  return 0;\n}\n</code></pre>\n\n<p><strong>Initial output</strong></p>\n\n<pre><code>PID = 8170\nPID = 0\nPrinting message buffer:\n</code></pre>\n\n<p><strong>Additional output when hello is echoed to the pty</strong></p>\n\n<pre><code>Buffer = hello\n</code></pre>\n"}, {"tags": ["c++", "boost-asio", "asio"], "comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1560989072, "post_id": 56677214, "comment_id": 99921527, "body": "It might be caused by the fact you are trying to start an infinite number of asynchronous read operations at the same time. You shouldn&#39;t start a new asynchronous read until the previous one finished."}, {"owner": {"reputation": 4955, "user_id": 5699329, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/86758f7ce8c15546da5968c504360e55?s=128&d=identicon&r=PG", "display_name": "rsjaffe", "link": "https://stackoverflow.com/users/5699329/rsjaffe"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1560994747, "post_id": 56677214, "comment_id": 99922442, "body": "Yes, that&#39;s it. You may want to post that as an answer. Now I&#39;m blocked on the <code>read_until</code>. I&#39;ll post another question if I can&#39;t figure out why."}], "answers": [{"tags": [], "owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "is_accepted": true, "score": 1, "last_activity_date": 1560994905, "creation_date": 1560994905, "answer_id": 56677934, "question_id": 56677214, "link": "https://stackoverflow.com/questions/56677214/async-read-until-insufficient-buffer-space-or-queue-is-full/56677934#56677934", "title": "async_read_until: insufficient buffer space or queue is full", "body": "<p>You are trying to start an infinite number of asynchronous read operations at the same time. You shouldn't start a new asynchronous read until the previous one finished.</p>\n\n<p><code>async_read_until</code> returns immediately, even though the data hasn't been received yet. That's the point of \"async\".</p>\n"}], "owner": {"reputation": 4955, "user_id": 5699329, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/86758f7ce8c15546da5968c504360e55?s=128&d=identicon&r=PG", "display_name": "rsjaffe", "link": "https://stackoverflow.com/users/5699329/rsjaffe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 56677934, "answer_count": 1, "score": 0, "last_activity_date": 1560994905, "creation_date": 1560987483, "last_edit_date": 1560987786, "question_id": 56677214, "link": "https://stackoverflow.com/questions/56677214/async-read-until-insufficient-buffer-space-or-queue-is-full", "title": "async_read_until: insufficient buffer space or queue is full", "body": "<p>I'm converting an application from using Juce asynchronous i/o to asio. The first part is to rewrite the code that receives traffic from another application on the same machine (it's a Lightroom Lua plugin that sends <code>\\n</code> delimited messages on port 58764). Whenever I successfully connect to that port with my C++ program, I get a series of error codes, all the same:</p>\n\n<blockquote>\n  <p>An operation on a socket could not be performed because the system lacked sufficient buffer space or because a queue was full.</p>\n</blockquote>\n\n<p>Can someone point out my error? I can see that the socket is successfully opened. I've reduced this from my full program to a minimal example. I also tried it with <code>connect</code> instead of <code>async_connect</code> and had the same problem.</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>#include &lt;iostream&gt;\n#include \"asio.hpp\"\n\nasio::io_context io_context_;\nasio::ip::tcp::socket socket_{io_context_};\n\nvoid loop_me()\n{\n   asio::streambuf streambuf{};\n   while (true) {\n      if (!socket_.is_open()) {\n         return;\n      }\n      else {\n         asio::async_read_until(socket_, streambuf, '\\n',\n             [&amp;streambuf](const asio::error_code&amp; error_code, std::size_t bytes_transferred) {\n                if (error_code) {\n                   std::cerr &lt;&lt; \"Socket error \" &lt;&lt; error_code.message() &lt;&lt; std::endl;\n                   return;\n                }\n                // Extract up to the first delimiter.\n                std::string command{buffers_begin(streambuf.data()),\n                    buffers_begin(streambuf.data()) + bytes_transferred};\n                std::cout &lt;&lt; command &lt;&lt; std::endl;\n                streambuf.consume(bytes_transferred);\n             });\n\n      }\n   }\n}\n\nint main()\n{\n   auto work_{asio::make_work_guard(io_context_)};\n   std::thread io_thread_;\n   std::thread run_thread_;\n   io_thread_ = std::thread([] { io_context_.run(); });\n   socket_.async_connect(asio::ip::tcp::endpoint(asio::ip::address_v4::loopback(), 58764),\n       [&amp;run_thread_](const asio::error_code&amp; error) {\n          if (!error) {\n             std::cout &lt;&lt; \"Socket connected in LR_IPC_In\\n\";\n             run_thread_ = std::thread(loop_me);\n          }\n          else {\n             std::cerr &lt;&lt; \"LR_IPC_In socket connect failed \" &lt;&lt; error.message() &lt;&lt; std::endl;\n          }\n       });\n   std::this_thread::sleep_for(std::chrono::seconds(1));\n   socket_.close();\n   io_context_.stop();\n   if (io_thread_.joinable())\n      io_thread_.join();\n   if (run_thread_.joinable())\n      run_thread_.join();\n}\n</code></pre>\n"}, {"tags": ["c++", "image-processing", "nnapi"], "owner": {"reputation": 23, "user_id": 11673070, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e058a023f4cd9c0c62a863dfbc4addde?s=128&d=identicon&r=PG&f=1", "display_name": "grizzleKat45", "link": "https://stackoverflow.com/users/11673070/grizzlekat45"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 246, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1561030744, "creation_date": 1560986214, "last_edit_date": 1561030744, "question_id": 56677068, "link": "https://stackoverflow.com/questions/56677068/nhwc-vs-nchw-benefits", "title": "NHWC vs NCHW benefits", "body": "<p>I believe I understand the differences between NHWC and HCHW. </p>\n\n<p>NHWC (batch, height, width, channels) has output index order of, assuming 3 input channels representing RGB, R0, G0, B0, R1, G1, B1, ..., Rc, Gc, Bc. </p>\n\n<p>NCHW (batch, channels, height, width) has output index order of, assuming 3 input channels representing RGB, R0, R1, ..., Rc, G0, G1 ,..., Gc, B0, B1, ..., Bc. </p>\n\n<p>(is this the only difference?)</p>\n\n<p>What I am wondering, is why is NCHW better/faster when it comes to GPU performance.</p>\n"}, {"tags": ["c++", "scipy", "stl", "sparse-matrix"], "comments": [{"owner": {"reputation": 4562, "user_id": 9254539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b45538511384660bfaef5092e30b7ea?s=128&d=identicon&r=PG&f=1", "display_name": "BessieTheCookie", "link": "https://stackoverflow.com/users/9254539/bessiethecookie"}, "edited": false, "score": 1, "creation_date": 1560986687, "post_id": 56677044, "comment_id": 99921048, "body": "The C++ standard library doesn&#39;t have matrix facilities. Do you have in mind a library that you want to use, or do you want us to recommend one? Software recommendations (including libraries) are off-topic here."}], "answers": [{"comments": [{"owner": {"reputation": 4432, "user_id": 2151087, "user_type": "registered", "accept_rate": 8, "profile_image": "https://www.gravatar.com/avatar/d94716cf8b5f1dd4f3487de368251c72?s=128&d=identicon&r=PG", "display_name": "Beautiful Mind", "link": "https://stackoverflow.com/users/2151087/beautiful-mind"}, "edited": false, "score": 0, "creation_date": 1561333659, "post_id": 56699659, "comment_id": 100016700, "body": "Thank you for your reply. I do not understand your code. Please check the example in (<a href=\"https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.rand.html\" rel=\"nofollow noreferrer\">docs.scipy.org/doc/scipy/reference/generated/&hellip;</a>). The example is creating a 3 by 4 matrix, where density is 0.25. The 3 by 4 matrix contains 12 (3*4) elements. The density 0.25 means. Out of 12 elements, 3 (12*0.25) elements will be non-zero and others will be zero. I ran your code. It is not create something like this. Please let me know I can I replicate the example provided in the following link (<a href=\"https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.rand.html\" rel=\"nofollow noreferrer\">docs.scipy.org/doc/scipy/reference/generated/&hellip;</a>)"}, {"owner": {"reputation": 5008, "user_id": 5762796, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/b3acb5c2021f4c279f29d61481b28e15?s=128&d=identicon&r=PG&f=1", "display_name": "Aleph0", "link": "https://stackoverflow.com/users/5762796/aleph0"}, "reply_to_user": {"reputation": 4432, "user_id": 2151087, "user_type": "registered", "accept_rate": 8, "profile_image": "https://www.gravatar.com/avatar/d94716cf8b5f1dd4f3487de368251c72?s=128&d=identicon&r=PG", "display_name": "Beautiful Mind", "link": "https://stackoverflow.com/users/2151087/beautiful-mind"}, "edited": false, "score": 0, "creation_date": 1561353053, "post_id": 56699659, "comment_id": 100019600, "body": "@BeautifulMind: I updated the question. Please check the link above to see the code at work."}, {"owner": {"reputation": 4432, "user_id": 2151087, "user_type": "registered", "accept_rate": 8, "profile_image": "https://www.gravatar.com/avatar/d94716cf8b5f1dd4f3487de368251c72?s=128&d=identicon&r=PG", "display_name": "Beautiful Mind", "link": "https://stackoverflow.com/users/2151087/beautiful-mind"}, "edited": false, "score": 0, "creation_date": 1561390309, "post_id": 56699659, "comment_id": 100038398, "body": "I know it is working, but it is not providing the correct answer. Your code generates 10 non-zero elements and 6 zero elements. However, it should generate 12 zero elements (for 4 by 4 matrix - 4*4 elements) and 4 (16*0.25 = 4 ) non-zero elements. Please check the python <a href=\"https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.rand.html\" rel=\"nofollow noreferrer\">link</a> that I provided. It has an example for 3 by 4 matrix."}], "tags": [], "owner": {"reputation": 5008, "user_id": 5762796, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/b3acb5c2021f4c279f29d61481b28e15?s=128&d=identicon&r=PG&f=1", "display_name": "Aleph0", "link": "https://stackoverflow.com/users/5762796/aleph0"}, "is_accepted": false, "score": 0, "last_activity_date": 1561353024, "last_edit_date": 1561353024, "creation_date": 1561105839, "answer_id": 56699659, "question_id": 56677044, "link": "https://stackoverflow.com/questions/56677044/c-equivalent-of-pythons-scipy-sparse-rand/56699659#56699659", "title": "C++ equivalent of Python&#39;s scipy.sparse.rand", "body": "<p>If you have <code>boost</code> on your hands it might be a good idea to use a combination of <a href=\"https://www.boost.org/doc/libs/1_65_1/libs/numeric/ublas/doc/index.html\" rel=\"nofollow noreferrer\">boost-ublas</a> and <a href=\"https://www.boost.org/doc/libs/1_66_0/doc/html/boost_random.html\" rel=\"nofollow noreferrer\">boost-random</a> to do the job. \nFor this you have to install the <a href=\"https://www.boost.org/\" rel=\"nofollow noreferrer\">boost</a> libraries beforehand.</p>\n\n<p>You might optimize the code if you know beforehand the number of non-zero elements.</p>\n\n<p>You can watch the code work at:\n<a href=\"https://coliru.stacked-crooked.com/a/097ea92bb336c774\" rel=\"nofollow noreferrer\">https://coliru.stacked-crooked.com/a/097ea92bb336c774</a></p>\n\n<pre><code>#include &lt;boost/numeric/ublas/matrix_sparse.hpp&gt;\n#include &lt;boost/numeric/ublas/io.hpp&gt;\n#include &lt;boost/random/mersenne_twister.hpp&gt;\n#include &lt;boost/random/uniform_01.hpp&gt;\n\nint main() {\n    int rows{ 4 };\n    int cols{ 4 };\n    double density{ 0.25 };\n    boost::random::uniform_01&lt;&gt; dist;\n    boost::random::mt19937 gen;\n\n    boost::numeric::ublas::mapped_matrix&lt;double&gt; m(rows, cols, 3 * 3);\n    for (unsigned i = 0; i &lt; m.size1(); ++i)\n        for (unsigned j = 0; j &lt; m.size2(); ++j)\n            if (dist(gen)&gt;density) m(i, j) = dist(gen);\n\n    std::cout &lt;&lt; m &lt;&lt; std::endl;\n}\n</code></pre>\n"}], "owner": {"reputation": 4432, "user_id": 2151087, "user_type": "registered", "accept_rate": 8, "profile_image": "https://www.gravatar.com/avatar/d94716cf8b5f1dd4f3487de368251c72?s=128&d=identicon&r=PG", "display_name": "Beautiful Mind", "link": "https://stackoverflow.com/users/2151087/beautiful-mind"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 125, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1561353024, "creation_date": 1560986031, "question_id": 56677044, "link": "https://stackoverflow.com/questions/56677044/c-equivalent-of-pythons-scipy-sparse-rand", "title": "C++ equivalent of Python&#39;s scipy.sparse.rand", "body": "<p>I need C++ equivalent of Python's <code>scipy.sparse.rand</code> function (<a href=\"https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.rand.html\" rel=\"nofollow noreferrer\">https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.rand.html</a>). I will input <code>m, n, density</code> parameters and <code>rand()</code> function will generate a matrix (preferably COO  matrix) for me. How can I do it? </p>\n"}, {"tags": ["c++", "c++11", "lambda", "functional-programming"], "comments": [{"owner": {"reputation": 2528, "user_id": 4658169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b351ed2ce7ddde5ab5ac9bd96200a62d?s=128&d=identicon&r=PG&f=1", "display_name": "CuriouslyRecurringThoughts", "link": "https://stackoverflow.com/users/4658169/curiouslyrecurringthoughts"}, "edited": false, "score": 1, "creation_date": 1560982071, "post_id": 56676460, "comment_id": 99920065, "body": "You are capturing by reference in the second lambda, try capturing by value with [=] ."}, {"owner": {"reputation": 86516, "user_id": 701092, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xYrM0.jpg?s=128&g=1", "display_name": "0x499602D2", "link": "https://stackoverflow.com/users/701092/0x499602d2"}, "edited": false, "score": 2, "creation_date": 1560982200, "post_id": 56676460, "comment_id": 99920088, "body": "You need to either copy or move <code>w</code> into the lambda.(i.e <code>[w=move(w)]</code>)"}, {"owner": {"reputation": 9602, "user_id": 7151494, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-a_FzvY-b2O0/AAAAAAAAAAI/AAAAAAAAAEw/kNwilSAvQTI/photo.jpg?sz=128", "display_name": "Fureeish", "link": "https://stackoverflow.com/users/7151494/fureeish"}, "reply_to_user": {"reputation": 86516, "user_id": 701092, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xYrM0.jpg?s=128&g=1", "display_name": "0x499602D2", "link": "https://stackoverflow.com/users/701092/0x499602d2"}, "edited": false, "score": 1, "creation_date": 1560982234, "post_id": 56676460, "comment_id": 99920096, "body": "@0x499602D2 that should be an answer"}, {"owner": {"reputation": 50273, "user_id": 167958, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0defa74609a4ce5d51f2467b69c509be?s=128&d=identicon&r=PG", "display_name": "Omnifarious", "link": "https://stackoverflow.com/users/167958/omnifarious"}, "edited": false, "score": 0, "creation_date": 1560982238, "post_id": 56676460, "comment_id": 99920097, "body": "The <code>w</code> you are using inside your inner lambda function is a reference to the <code>w</code> parameter passed into the outer lambda function. That parameter is destroyed as soon as the outer lambda function exits and the inner lambda function then has a dangling reference."}, {"owner": {"reputation": 4175, "user_id": 1082038, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IEql2.jpg?s=128&g=1", "display_name": "Nevin", "link": "https://stackoverflow.com/users/1082038/nevin"}, "reply_to_user": {"reputation": 86516, "user_id": 701092, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xYrM0.jpg?s=128&g=1", "display_name": "0x499602D2", "link": "https://stackoverflow.com/users/701092/0x499602d2"}, "edited": false, "score": 0, "creation_date": 1560984667, "post_id": 56676460, "comment_id": 99920632, "body": "@0x499602D2 You cannot move into the lambda in C++11."}], "answers": [{"comments": [{"owner": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "edited": false, "score": 1, "creation_date": 1561001676, "post_id": 56676670, "comment_id": 99923645, "body": "What is this <code>move</code>  you are calling; when I tried it, I got a pile of ambiguous overloads found by ADL.  Maybe I shouldn&#39;t have free move function in global namespace, or maybe you shoud std."}, {"owner": {"reputation": 8430, "user_id": 2742717, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d1dec1aa6accf3589489ebd42634f7a0?s=128&d=identicon&r=PG", "display_name": "Swift - Friday Pie", "link": "https://stackoverflow.com/users/2742717/swift-friday-pie"}, "reply_to_user": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "edited": false, "score": 1, "creation_date": 1561022031, "post_id": 56676670, "comment_id": 99931113, "body": "@Yakk-AdamNevraumont or someone should not use <code>using namespace std</code> in global scope, more than one of those things had happened and they are mentioned as UB. but that&#39;s <code>std::move</code> from C++11, yet this syntax may work only in C++14 compliant compiler"}, {"owner": {"reputation": 8430, "user_id": 2742717, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d1dec1aa6accf3589489ebd42634f7a0?s=128&d=identicon&r=PG", "display_name": "Swift - Friday Pie", "link": "https://stackoverflow.com/users/2742717/swift-friday-pie"}, "edited": false, "score": 1, "creation_date": 1561022472, "post_id": 56676670, "comment_id": 99931363, "body": "<code>cout</code> and <code>endl</code> require qualificators.  Their absesne at least hints that somewhere there is <code>using</code> and I really hope it&#39;s not <code>using namespace</code>. <a href=\"https://wandbox.org/permlink/8nNQzS223bCI8LDg\" rel=\"nofollow noreferrer\">wandbox.org/permlink/8nNQzS223bCI8LDg</a>"}, {"owner": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "reply_to_user": {"reputation": 8430, "user_id": 2742717, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d1dec1aa6accf3589489ebd42634f7a0?s=128&d=identicon&r=PG", "display_name": "Swift - Friday Pie", "link": "https://stackoverflow.com/users/2742717/swift-friday-pie"}, "edited": false, "score": 1, "creation_date": 1561029088, "post_id": 56676670, "comment_id": 99934979, "body": "@swift Oh, I also have a cout in the global namespace.  It composes emails to random people in my address book.  I assume that is what is used here."}], "tags": [], "owner": {"reputation": 86516, "user_id": 701092, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xYrM0.jpg?s=128&g=1", "display_name": "0x499602D2", "link": "https://stackoverflow.com/users/701092/0x499602d2"}, "is_accepted": true, "score": 5, "last_activity_date": 1561147967, "last_edit_date": 1561147967, "creation_date": 1560983230, "answer_id": 56676670, "question_id": 56676460, "link": "https://stackoverflow.com/questions/56676460/%d0%a1-wrapping-lambda-in-another-lambda-inside-a-function/56676670#56676670", "title": "\u0421++ wrapping lambda in another lambda inside a function", "body": "<p>The by-reference capture <code>[&amp;]</code> causes the lambda to hold a reference to <code>w</code> after it has expired. You either need to copy <code>w</code> <code>[=]</code> or move it into the lambda (C++14):</p>\n\n<pre><code>r.receive([w=std::move(w)]() {\n    cout &lt;&lt; \"Before\" &lt;&lt; endl;   \n    w();\n    cout &lt;&lt; \"After\" &lt;&lt; endl;    \n});\n</code></pre>\n"}], "owner": {"reputation": 806, "user_id": 1038085, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/ce6d21224aed68d188a049407073578b?s=128&d=identicon&r=PG", "display_name": "Alexander Taran", "link": "https://stackoverflow.com/users/1038085/alexander-taran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "accepted_answer_id": 56676670, "answer_count": 1, "score": 1, "last_activity_date": 1561147967, "creation_date": 1560981705, "question_id": 56676460, "link": "https://stackoverflow.com/questions/56676460/%d0%a1-wrapping-lambda-in-another-lambda-inside-a-function", "title": "\u0421++ wrapping lambda in another lambda inside a function", "body": "<p>Basically, I'm having this code:</p>\n\n<pre><code>struct Receiver {\n    void receive(std::function&lt;void()&gt; f) {\n        func_ = f;\n    }\n    std::function&lt;void()&gt; func_;\n};\n\nvoid pusher(Receiver&amp; r) {\n    auto wrapper=[&amp;](std::function&lt;void()&gt; w) {\n        r.receive([&amp;]() {\n            cout &lt;&lt; \"Before\" &lt;&lt; endl;   \n            w();\n            cout &lt;&lt; \"After\" &lt;&lt; endl;    \n        });\n    };\n\n\n    wrapper([&amp;]() {\n        cout &lt;&lt; \"Original\" &lt;&lt; endl; \n    });\n}\n\nint main() {\n    Receiver r;\n    pusher(r);\n    r.func_();\n    return 0;\n}\n</code></pre>\n\n<p>There's a class which stores std::function and we store a function into that class.\nFunction is created in a \"wrapper\" local lambda of another function.</p>\n\n<p>The code prints \"Before\" and crashes.\nIf I put the whole code inside \"pusher\" into main(), then everything works.</p>\n\n<p>I suspect the problem us that when r.receive() is called, it contains reference to \"w\" which is invalid after returning from \"pusher\".</p>\n\n<p>But I need to pass a lambda to a receiver which is created by \"decoration\" with another lambda.</p>\n\n<p>How do I properly (in general) decorate a lambda with a reference to some local lambda and pass it somewhere else?</p>\n"}, {"tags": ["c++", "winapi"], "answers": [{"tags": [], "owner": {"reputation": 2023, "user_id": 2309279, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/b6f77ad82a31d963002374d9287f1397?s=128&d=identicon&r=PG", "display_name": "KostasRim", "link": "https://stackoverflow.com/users/2309279/kostasrim"}, "is_accepted": false, "score": 1, "last_activity_date": 1560983725, "last_edit_date": 1560983725, "creation_date": 1560982414, "answer_id": 56676564, "question_id": 56676424, "link": "https://stackoverflow.com/questions/56676424/converting-and-printing-the-module-names-of-a-process/56676564#56676564", "title": "Converting and printing the module names of a process", "body": "<p><code>_tprintf()</code> is a <code>typedef</code> for <code>wprintf()</code> if <code>_UNICODE</code> is defined, according to <a href=\"https://docs.microsoft.com/en-us/cpp/c-runtime-library/reference/printf-printf-l-wprintf-wprintf-l?view=vs-2019\" rel=\"nofollow noreferrer\">Microsoft's documentation</a>.</p>\n\n<p>Take a look at <a href=\"https://en.cppreference.com/w/cpp/io/cout\" rel=\"nofollow noreferrer\"><code>std::wcout</code></a>.</p>\n"}, {"tags": [], "owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "is_accepted": true, "score": 2, "last_activity_date": 1560983960, "last_edit_date": 1560983960, "creation_date": 1560983642, "answer_id": 56676727, "question_id": 56676424, "link": "https://stackoverflow.com/questions/56676424/converting-and-printing-the-module-names-of-a-process/56676727#56676727", "title": "Converting and printing the module names of a process", "body": "<p>Your project is being compiled with <code>UNICODE</code> defined (as evident by you being able to pass a wide string to <code>FindWindow()</code>).  That causes <code>Module32(First|Next)</code> to map to <code>Module32(First|Next)W</code>, and <code>MODULEENTRY32</code> to map to <code>MODULEENTRY32W</code> (and <code>FindWindow()</code> to map to <code>FindWindowW()</code>).  Thus, the <code>szModule</code> field is a <code>wchar_t[]</code> array instead of a <code>char[]</code> array, like you are expecting.  <code>std::cout</code> does not have an overload of <code>operator&lt;&lt;</code> for <code>wchar_t</code> data, only <code>char</code> data, but it has an overload for <code>void*</code>, and a fixed array decays into a pointer that can then be assigned to <code>void*</code>.  That is why your code is printing out the string data as a memory address - you are printing out the <em>address</em> of the <code>szModule</code> field rather than its <em>content</em>.</p>\n\n<p>You need to either:</p>\n\n<ul>\n<li><p>use <code>std::wcout</code> instead, and preferably also explicitly use the <code>W</code> version of the API functions to match:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>#include &lt;windows.h&gt;\n#include &lt;TlHelp32.h&gt;\n#include &lt;iostream&gt;\n#include &lt;string&gt;\n\nint main() {\n\n    MODULEENTRY32W me32;\n    HWND hwnd = FindWindowW(0, L\"Window Name\");\n    DWORD dwPID;\n    GetWindowThreadProcessId(hwnd, &amp;dwPID);\n\n    HANDLE hModuleSnap = CreateToolhelp32Snapshot(TH32CS_SNAPMODULE, dwPID);\n\n    me32.dwSize = sizeof(me32);\n    if (Module32FirstW(hModuleSnap, &amp;me32))\n    {\n        do\n        {\n            std::wstring moduleName = me32.szModule;\n            std::wcout &lt;&lt; moduleName &lt;&lt; std::endl; // important line\n        }\n        while (Module32NextW(hModuleSnap, &amp;me32));\n    }\n\n    return 0;\n}\n</code></pre></li>\n<li><p>explicitly use the <code>A</code> version of the API functions to match your use of <code>std::cout</code>:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>#include &lt;windows.h&gt;\n#include &lt;TlHelp32.h&gt;\n#include &lt;iostream&gt;\n#include &lt;string&gt;\n\nint main() {\n\n    MODULEENTRY32A me32;\n    HWND hwnd = FindWindow(0, L\"Window Name\");\n    DWORD dwPID;\n    GetWindowThreadProcessId(hwnd, &amp;dwPID);\n\n    HANDLE hModuleSnap = CreateToolhelp32Snapshot(TH32CS_SNAPMODULE, dwPID);\n\n    me32.dwSize = sizeof(MODULEENTRY32A);\n    if (Module32FirstA(hModuleSnap, &amp;me32))\n    {\n        do\n        {\n            std::string moduleName = me32.szModule;\n            std::cout &lt;&lt; moduleName &lt;&lt; std::endl; // important line\n        }\n        while (Module32NextA(hModuleSnap, &amp;me32));\n    }\n\n    return 0;\n}\n</code></pre></li>\n</ul>\n"}], "owner": {"reputation": 49, "user_id": 8276872, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d46fe3344e779842246709012c8f4e31?s=128&d=identicon&r=PG&f=1", "display_name": "MineII CrafterII", "link": "https://stackoverflow.com/users/8276872/mineii-crafterii"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "closed_date": 1560987413, "accepted_answer_id": 56676727, "answer_count": 2, "score": -1, "last_activity_date": 1560987587, "creation_date": 1560981463, "last_edit_date": 1560983685, "question_id": 56676424, "link": "https://stackoverflow.com/questions/56676424/converting-and-printing-the-module-names-of-a-process", "closed_reason": "Duplicate", "title": "Converting and printing the module names of a process", "body": "<p>I am trying to print and save the module names of a process.</p>\n\n<p>But when printing the char array I get something that looks like an address.</p>\n\n<pre><code>#include &lt;windows.h&gt;\n#include &lt;TlHelp32.h&gt;\n#include &lt;iostream&gt;\n\nint main() {\n\n    MODULEENTRY32 me32;\n    HWND hwnd = FindWindow(0, L\"Window Name\");\n    DWORD dwPID;\n    GetWindowThreadProcessId(hwnd, &amp;dwPID);\n\n    HANDLE hModuleSnap = CreateToolhelp32Snapshot(TH32CS_SNAPMODULE, dwPID);\n\n    me32.dwSize = sizeof(MODULEENTRY32);\n    Module32First(hModuleSnap, &amp;me32);\n    std::cout &lt;&lt; me32.szModule &lt;&lt; std::endl;\n\n    do\n    {\n        std::cout &lt;&lt; me32.szModule &lt;&lt; std::endl; // important line\n\n    } while (Module32Next(hModuleSnap, &amp;me32));\n\n    return 0;\n}\n</code></pre>\n\n<p>The output of this in my case was <code>00AFF53C</code> for every module.</p>\n\n<p><code>me32.szModule</code> holds the name of the module as a char array.</p>\n\n<p>Microsoft used the following in <a href=\"https://docs.microsoft.com/de-de/windows/desktop/ToolHelp/traversing-the-module-list\" rel=\"nofollow noreferrer\">their example</a> to convert and print the module name:</p>\n\n<p><code>_tprintf( TEXT(\"\\n\\n     MODULE NAME:     %s\"), me32.szModule );</code></p>\n\n<p>But I think you can only use this to print the string.</p>\n\n<p>So how do I convert and save the string in <code>me32</code>?</p>\n"}, {"tags": ["c++", "struct", "mpi", "stdvector"], "comments": [{"owner": {"reputation": 83151, "user_id": 3943312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc00b38b94ca7b6f820622b0a8af8ded?s=128&d=identicon&r=PG", "display_name": "Sam Varshavchik", "link": "https://stackoverflow.com/users/3943312/sam-varshavchik"}, "edited": false, "score": 1, "creation_date": 1560981958, "post_id": 56676170, "comment_id": 99920033, "body": "Despite not knowing much about MPI, it is rather obvious that there is a very basic misunderstanding here of what C++ vectors are, and how they work. Can&#39;t help but notice that <code>offsets</code> is initialized exactly the same for a <code>std::vector&lt;double&gt;</code> as well as a plain <code>double</code>. This can&#39;t be right. &quot;offsetof&quot; on a <code>std::vector</code> does not, I repeat, <b><i>does not</i></b> tell you where the actual values in a vector are, when that vector itself is a part of a <code>struct</code>. C++ does not work this way. This appears to be a C library that has no clue about C++ classes, how they work, and what they are."}, {"owner": {"reputation": 39, "user_id": 9910283, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/urBmS.png?s=128&g=1", "display_name": "ming.vase", "link": "https://stackoverflow.com/users/9910283/ming-vase"}, "reply_to_user": {"reputation": 83151, "user_id": 3943312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc00b38b94ca7b6f820622b0a8af8ded?s=128&d=identicon&r=PG", "display_name": "Sam Varshavchik", "link": "https://stackoverflow.com/users/3943312/sam-varshavchik"}, "edited": false, "score": 0, "creation_date": 1560983937, "post_id": 56676170, "comment_id": 99920484, "body": "Hi Sam, I appreciate your answer. I am indeed new to offsets. However within MPI and the attached link, it is emphasized (I believe) that the offsets refer to the number of elements in the container, and this is what I thought I was dealing properly with. Is it correct that an array might fix the problem, because the vector points to an array, and passing a vector in a struct  buries the pointer a layer deeper? If you have some  comment other than about my ignorance/inability about what exactly is wrong about the structure of my code, I would appreciate that. @SamVarshavchik"}, {"owner": {"reputation": 83151, "user_id": 3943312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc00b38b94ca7b6f820622b0a8af8ded?s=128&d=identicon&r=PG", "display_name": "Sam Varshavchik", "link": "https://stackoverflow.com/users/3943312/sam-varshavchik"}, "edited": false, "score": 1, "creation_date": 1560988022, "post_id": 56676170, "comment_id": 99921340, "body": "The &quot;attached link&quot; tells you exactly what you need to do with <code>std::vector</code>s. Which isn&#39;t anything like what you are doing in the shown code. Do you see a connection between the <code>std::vector</code>s in your code, and a chapter in the link called &quot;Handling std::vector&quot;? Do you think that there might be a connection between the two. Which part of your shown code implements the instructions given in that chapter in the &quot;attached link&quot;?"}, {"owner": {"reputation": 23130, "user_id": 8586227, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BRnwg.png?s=128&g=1", "display_name": "Davis Herring", "link": "https://stackoverflow.com/users/8586227/davis-herring"}, "edited": false, "score": 1, "creation_date": 1560995606, "post_id": 56676170, "comment_id": 99922589, "body": "You seem to have missed the significance of having <b>nested</b> <code>std::vector</code> objects.  You can\u2019t use the <code>std::vector&lt;double&gt;</code> strategy for <code>std::vector&lt;non-trivial&gt;</code>, and <code>std::vector&lt;double&gt;</code> is itself non-trivial."}, {"owner": {"reputation": 1153, "user_id": 11345381, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3322e1e397dd7f2626bd3b7280585b1?s=128&d=identicon&r=PG&f=1", "display_name": "rtoijala", "link": "https://stackoverflow.com/users/11345381/rtoijala"}, "edited": false, "score": 1, "creation_date": 1561013985, "post_id": 56676170, "comment_id": 99927130, "body": "In this case, it seems that the nested structs <code>com</code> and <code>crossing_count</code> are hard-coded to be of length 3, e.g. in <code>register_mpi_type</code>. If that is true, you could avoid the problem of nested <code>std::vector</code> objects by using <code>double com[3]</code> and <code>double crossing_count[3]</code> instead, assuming this does not make the rest of your code too complicated."}, {"owner": {"reputation": 39, "user_id": 9910283, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/urBmS.png?s=128&g=1", "display_name": "ming.vase", "link": "https://stackoverflow.com/users/9910283/ming-vase"}, "reply_to_user": {"reputation": 83151, "user_id": 3943312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc00b38b94ca7b6f820622b0a8af8ded?s=128&d=identicon&r=PG", "display_name": "Sam Varshavchik", "link": "https://stackoverflow.com/users/3943312/sam-varshavchik"}, "edited": false, "score": 0, "creation_date": 1561049240, "post_id": 56676170, "comment_id": 99946556, "body": "@SamVarshavchik : I get the fundamental type thing (now). I was am guilty of skipping that section to jump to what I thought was more important (std::vector&lt;struct&gt;). Thank you for your first comment: I was actually able to solve it from your clues there."}, {"owner": {"reputation": 39, "user_id": 9910283, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/urBmS.png?s=128&g=1", "display_name": "ming.vase", "link": "https://stackoverflow.com/users/9910283/ming-vase"}, "edited": false, "score": 0, "creation_date": 1561050859, "post_id": 56676170, "comment_id": 99947274, "body": "Everyone: thank you for your feedback. I have gotten the code to work by modifying my struct to use arrays instead of vector. Now I can send and receive the vector of structs without issue."}], "owner": {"reputation": 39, "user_id": 9910283, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/urBmS.png?s=128&g=1", "display_name": "ming.vase", "link": "https://stackoverflow.com/users/9910283/ming-vase"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 74, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1560980032, "creation_date": 1560980032, "question_id": 56676170, "link": "https://stackoverflow.com/questions/56676170/how-to-send-and-receive-variable-length-processor-dependent-stdvectormystru", "title": "How to send and receive variable length (processor dependent) std::vector&lt;myStruct&gt; using MPI", "body": "<p>I have a vector of custom structs living on each processor. These vectors are all different sizes. I am struggling to receive the data from processors 1 through N on processor 0.</p>\n\n<p>I have attempted to implement the advice on pages 31-33 of the attached slide show, where std::vector are sent and received. I have also implemented the MPI_register and MPI_deregister.</p>\n\n<p>I'm compiling and running this code on osx.</p>\n\n<p><a href=\"https://www.sharcnet.ca/help/images/f/fa/MPI_Datatypes_with_Opaque_Types_seminar_2014.pdf\" rel=\"nofollow noreferrer\">https://www.sharcnet.ca/help/images/f/fa/MPI_Datatypes_with_Opaque_Types_seminar_2014.pdf</a></p>\n\n<pre><code>#include &lt;mpi.h&gt;\n#include &lt;vector&gt;\n#include &lt;iostream&gt;\n#include &lt;string&gt;\n#include &lt;algorithm&gt;\n#include &lt;cstddef&gt;\n\nstruct crab_claw\n{\n    crab_claw()  : com(), number(), weight(), crossing_count(), com0_id() {}\n    /////////\n    crab_claw(\n             std::vector&lt;double&gt; c,\n             int n,\n             double w,\n             std::vector&lt;double&gt; cc,\n             int id\n             ) : com( c ), number( n ), weight( w ), crossing_count( cc ), com0_id( id ) {}\n    std::vector&lt;double&gt; com = std::vector&lt;double&gt;(3);\n    int number;\n    double weight;\n    std::vector&lt;double&gt; crossing_count = std::vector&lt;double&gt;(3);\n    int com0_id;\n};\n\nMPI_Datatype register_mpi_type(crab_claw)// const&amp;)\n{\n    constexpr std::size_t num_members = 5;\n    int lengths[num_members] = {3,1,1,3,1};\n\n    MPI_Aint offsets[num_members] =  {\n                                      offsetof(crab_claw, com), //vector (of doubles)\n                                      offsetof(crab_claw, number),     //int\n                                      offsetof(crab_claw, weight),     //double\n                                      offsetof(crab_claw, crossing_count),       //vector (of doubles)\n                                      offsetof(crab_claw, com0_id)  //int\n                                      };\n\n    MPI_Datatype types[num_members] = { MPI_DOUBLE, MPI_INT, MPI_DOUBLE, MPI_DOUBLE, MPI_INT };\n    MPI_Datatype type;\n    MPI_Type_struct(num_members, lengths, offsets, types, &amp;type);\n    MPI_Type_commit(&amp;type);\n    return type;\n}\n\nvoid deregister_mpi_type(MPI_Datatype type)\n{\n    MPI_Type_free(&amp;type);\n}\n\nint main(\n         int argc,\n         char* argv[]\n         )\n{\n    MPI_Init(&amp;argc, &amp;argv);\n    int mpi_nprocessors;  MPI_Comm_size(MPI_COMM_WORLD, &amp;mpi_nprocessors);\n    int mpi_my_id;        MPI_Comm_rank(MPI_COMM_WORLD, &amp;mpi_my_id);\n    const int mpi_master_id = 0;\n\n    std::vector&lt;crab_claw&gt; h; double j = mpi_my_id;\n\n    for(int i = 0; i &lt; (2*mpi_my_id+1); ++i)\n    {\n        crab_claw h_1;\n        std::vector&lt;double&gt; h_com(3,0.);\n        h_com[0] = ((i+1)/20. * 2*j)/(i+1);\n        h_com[1] = ((i+1)/20. * 2*j)/(i+1);\n        h_com[2] = ((i+1)/20. * 2*j)/(i+1);\n        j /= 0.5;\n        std::vector&lt;double&gt; crossing_count(3,0.);\n\n        h_1.com            = h_com;\n        h_1.number         = i*mpi_my_id+1;\n        h_1.weight         = j*0.3;\n        h_1.crossing_count = crossing_count;\n        h_1.com0_id        = mpi_my_id;\n        h.push_back(h_1);\n    }\n\n    MPI_Barrier(MPI_COMM_WORLD);\n    /* create a type for struct crab_claw */\n\n    std::vector&lt;crab_claw&gt; storage;\n\n    MPI_Datatype type = register_mpi_type(h[0]);\n    if (mpi_my_id != mpi_master_id)\n    {\n        int       tag    = mpi_my_id;\n        unsigned length = h.size();\n        const int destination = mpi_master_id;\n        MPI_Send(\n                 &amp;length,\n                 1,\n                 MPI_UNSIGNED,\n                 destination,\n                 tag+mpi_nprocessors,\n                 MPI_COMM_WORLD\n                 );\n\n        if(length != 0)\n        {\n            MPI_Send(\n                     h.data(),\n                     length,\n                     type,\n                     destination,\n                     mpi_my_id,\n                     MPI_COMM_WORLD\n                     );\n        }\n    }\n\n    MPI_Barrier(MPI_COMM_WORLD);\n    if (mpi_my_id == mpi_master_id)\n    {\n        for(int j = 0; j &lt; mpi_nprocessors; ++j)\n        {\n            if(j == 0)\n            {\n                storage.insert(storage.end(), h.begin(), h.end());\n\n                std::cout &lt;&lt; \"inert insert\" &lt;&lt; '\\n';\n            }\n\n            if(j &gt; 0)\n            {\n                unsigned length;\n                MPI_Status s;\n\n                MPI_Recv(\n                         &amp;length,\n                         1,\n                         MPI_UNSIGNED,\n                         j,\n                         j+mpi_nprocessors,\n                         MPI_COMM_WORLD,\n                         &amp;s\n                         );\n\n                std::vector&lt;crab_claw&gt; rec;\n\n                //std::cout &lt;&lt; \"MPIMYID \" &lt;&lt; mpi_my_id &lt;&lt; \" LENGTH OF RECEIVED OBJ \" &lt;&lt; length &lt;&lt; \" j \" &lt;&lt; j &lt;&lt; '\\n';\n\n                if (length != 0)\n                {\n                    h.resize(length);\n                    MPI_Recv(\n                             h.data(),\n                             length,\n                             type,\n                             j,\n                             j,\n                             MPI_COMM_WORLD,\n                             &amp;s\n                             );\n\n\n                    std::cout &lt;&lt; \"SIZE() \" &lt;&lt; h.size() &lt;&lt; \" MY MPI ID \" &lt;&lt; mpi_my_id &lt;&lt; \" h[0].number \" &lt;&lt; h[0].weight &lt;&lt; '\\n';\n\n\n                //storage.insert(storage.end(), h.begin(), h.end());\n\n                } else\n                {\n                    h.clear();\n                }\n\n            }\n        }\n    }\n\n\n    //std::cout &lt;&lt; mpi_my_id &lt;&lt; '\\n';\n    MPI_Finalize();\n    return 0;\n}\n</code></pre>\n\n<p>This is the error I receive. I think it's saying that the data from h sent by anyone but the master processor is being freed without having been allocated?</p>\n\n<p>parallel(32428,0x7fff7d3e6000) malloc: <strong>* error for object 0x7fcb2bf07d10: pointer being freed was not allocated\n*</strong> set a breakpoint in malloc_error_break to debug</p>\n"}, {"tags": ["c++", "string", "function", "for-loop", "vigenere"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 11672731, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a50a90edbab7d4b93a27a9a88a3fd905?s=128&d=identicon&r=PG", "display_name": "exef", "link": "https://stackoverflow.com/users/11672731/exef"}, "edited": false, "score": 0, "creation_date": 1560991747, "post_id": 56676803, "comment_id": 99921971, "body": "Thank you that actually did work for it. That line was originally for resetting the loop through the keyword for an earlier version of the function but I guess I forgot to remove it, being tired will do that to ya :/. Since part of the requirement for the function was for it to discriminate letters from non letters I thought having the count reset on non letters that way would work , it does for some inputs but your edit makes it work for everything."}], "tags": [], "owner": {"reputation": 1055, "user_id": 5724584, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed0f7d757209d03b9142fc728dbc0602?s=128&d=identicon&r=PG&f=1", "display_name": "Vahid", "link": "https://stackoverflow.com/users/5724584/vahid"}, "is_accepted": true, "score": 0, "last_activity_date": 1560984140, "creation_date": 1560984140, "answer_id": 56676803, "question_id": 56676104, "link": "https://stackoverflow.com/questions/56676104/c-function-for-vigenere-cipher-only-sometimes-working-works-for-some-inputs/56676803#56676803", "title": "C++ function for vigenere cipher only sometimes working (works for some inputs, skips shifts for others)", "body": "<p>Your problem here is not with the first letter of the keyword being ignored (try <code>fake</code> instead of <code>cake</code> and confirm that it does change the output).</p>\n\n<p>It appears that your real problem lays with the way the <code>encryptVigenere</code> function is written. </p>\n\n<p>I'm no expert in cryptography and I can't tell you whether or not this is the right way to implement vigenere cipher but I couldn't make much sense of this line:</p>\n\n<pre><code>            ciphercount -= keyword.length();\n</code></pre>\n\n<p>and as it turned out you'll get the result you want if you remove it.</p>\n\n<p>So, here's your new <code>encryptVigenere</code> function:</p>\n\n<pre><code>string encryptVigenere(string plaintext, string keyword){ \n\n    char encrypted;\n    string vigenere; \n    int ciphercount = 0;\n\n        for(int i = 0; i &lt; plaintext.length(); ++i) {\n\n            if(isalpha(plaintext[i])) {\n                encrypted = shiftChar(plaintext[i], getShift(keyword[ciphercount])); \n                vigenere += encrypted; \n                ciphercount ++;\n            } \n            else { \n                //ciphercount -= keyword.length();\n                vigenere += plaintext[i]; \n            }\n            ciphercount = ciphercount % keyword.length();\n        }  \n\n    return vigenere;    \n\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 11672731, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a50a90edbab7d4b93a27a9a88a3fd905?s=128&d=identicon&r=PG", "display_name": "exef", "link": "https://stackoverflow.com/users/11672731/exef"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 230, "favorite_count": 0, "accepted_answer_id": 56676803, "answer_count": 1, "score": -1, "last_activity_date": 1560984140, "creation_date": 1560979689, "question_id": 56676104, "link": "https://stackoverflow.com/questions/56676104/c-function-for-vigenere-cipher-only-sometimes-working-works-for-some-inputs", "title": "C++ function for vigenere cipher only sometimes working (works for some inputs, skips shifts for others)", "body": "<p>For an in class assignment I had to write a function that puts a user input string through the vigenere cipher with the optional help from helper function. I was able to reach a partial solution using a helper function that gets the correct shift for a character based on its place in the alphabet as well as another function that shifts the characters in the string by this place if they are letters. </p>\n\n<p>The program only occasionally works with one example being \"Hello, world!\" with a keyword of \"cake\" being properly encrypted into \"Jevpq, Wyvnd!\", however the auto-graders' input of \"hDcT+T EtL5V71\" and keyword of \"vpkbncc\" returns \"cSmU+V OuY5Q71\" instead of \"cSmU+G GvG5K71\". I know why this is happening; first character is being skipped over every iteration so \"cake\" ends up being \"ake\", however I have no idea how to fix this. Here is my code: </p>\n\n<pre><code>/*Author: Xavier f.*/\n\n#include &lt;iostream&gt; \n#include &lt;string&gt;  \n#include &lt;cctype&gt;  \n\nusing namespace std;\n\nint getShift(char c); // helper function that converts chars into their place in the alphabet as an int \nchar shiftChar(char c, int rshift); // this function handles the character value shifting part of the problem\nstring encryptVigenere(string plaintext, string keyword); //implemntation of Vigenere cypher  , needs to loop around keyword\n\n\nint main(){ \n\n    string text, key, debug; \n    cout &lt;&lt; \"Enter a sentence: \";\n    getline(cin, text); \n    cout &lt;&lt; \"Enter the keyword  : \"; \n    getline(cin, key); \n\n    debug = encryptVigenere(text, key);\n    cout &lt;&lt; \"Ciphertext     : \" &lt;&lt; debug;  \n\n    return 0; \n\n}\n\nint getShift(char c) { \n\n    if (isupper(c)) { \n\n        return (int)c-(int)'A';\n    }\n    else { \n\n        return (int)c-(int)'a';\n\n    }\n\n\n}  \n\nchar shiftChar(char c, int rshift) { \n\n    char shifted;\n\n\n    if (isalpha(c)) { //if it is a letter\n\n        if (isupper(c)){\n\n            shifted = ((int)c + rshift - 'A')%26 + 'A';        //65-90 for uppercase , 97-122 for lowercase\n        } \n        else { //dont have to put condition since if its not uppercase its obviously lowercase  \n\n            shifted = ((int)c + rshift - 'a')%26 + 'a'; \n\n        } \n\n        return shifted;\n    } \n    else { \n\n        return c; \n\n    } \n\n} \n\nstring encryptVigenere(string plaintext, string keyword){ \n\n    char encrypted;\n    string vigenere; \n    int ciphercount = 0;\n\n        for(int i = 0; i &lt; plaintext.length(); ++i) {\n\n            if(isalpha(plaintext[i])) {\n\n                encrypted = shiftChar(plaintext[i], getShift(keyword[ciphercount])); \n                vigenere += encrypted; \n                ciphercount ++;\n\n            } \n            else { \n                ciphercount -= keyword.length();\n                vigenere += plaintext[i]; \n            }\n            ciphercount = ciphercount % keyword.length();\n        }  \n\n    return vigenere;    \n\n}\n</code></pre>\n\n<p>Like I mentioned before the \"Hello, world!\" example works even though the first character in cake is skipped in the for loop for some reason: </p>\n\n<pre><code>Enter a sentence: Hello, world!\nEnter the keyword  : cake\nCiphertext     : Jevpq, wyvnd! \n\ndebug: og ciphercount: c/ debug: plaintext[i]: H / debug: keyword[ciphercount]: a / debug: cyphercount isalpha: 1 / debug: encrypted: J / debug: vigenere: J\ndebug: cyphercount loop through: 1\n</code></pre>\n\n<p>However with autograders' input this problem becomes more disastrous: </p>\n\n<pre><code>Enter a sentence: hDcT+T EtL5V71\nEnter the keyword  : vpkbncc\nCiphertext     : cSmU+V OuY5Q71 \n\ndebug: og ciphercount: v / debug: plaintext[i]: h / debug: keyword[ciphercount]: p / debug: cyphercount isalpha: 1 / debug: encrypted: c / debug: vigenere: c\ndebug: cyphercount loop through: 1\n</code></pre>\n\n<p>The output is supposed to be \"cSmU+G GvG5K71\" but since the first shift character is skipped the shift the text is put through is pkbn_bn_c_p__ which is wrong. </p>\n\n<p>Does anyone know how I can go about fixing this?</p>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 4, "creation_date": 1560978456, "post_id": 56675769, "comment_id": 99918936, "body": "The local variables in <code>add_func()</code> are completely unrelated to the variables declared in <code>main()</code>. It seems you need to get a <a href=\"https://stackoverflow.com/questions/388242/the-definitive-c-book-guide-and-list\">good book</a> to learn about the basics."}, {"owner": {"reputation": 2663, "user_id": 6301420, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9f4693f2fcba86b5f59737b94120acc2?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Schepler", "link": "https://stackoverflow.com/users/6301420/daniel-schepler"}, "edited": false, "score": 0, "creation_date": 1560981031, "post_id": 56675769, "comment_id": 99919780, "body": "Also with <code>op</code> being <code>char</code> then <code>cin &gt;&gt; op</code> inputs a single character and then you compare its ASCII value to 1,2,3,4.  So, the only way to select an addition operation would be to type Control+V Control+A (on Unix systems at least)."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10957435"}, "edited": false, "score": 0, "creation_date": 1560981572, "post_id": 56675769, "comment_id": 99919918, "body": "Something like <code>if(op == 1)</code> won&#39;t fly. you either need to do <code>if(op == &#39;1&#39;)</code>, or <code>op</code> needs to be an int instead."}], "answers": [{"comments": [{"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 0, "creation_date": 1560978810, "post_id": 56675870, "comment_id": 99919055, "body": "<i>&quot;You need to use function arguments to pass values between functions.&quot;</i> Well, variables at global scope could do the same, not that I&#39;d recommend to do so :-P ..."}], "tags": [], "owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "is_accepted": false, "score": 1, "last_activity_date": 1560978844, "last_edit_date": 1560978844, "creation_date": 1560978527, "answer_id": 56675870, "question_id": 56675769, "link": "https://stackoverflow.com/questions/56675769/c-my-simple-calculator-program-wont-print-out-i-also-think-my-variable-nami/56675870#56675870", "title": "C++: My simple calculator program won&#39;t print out. I also think my variable naming is incorrect", "body": "<p>You need to use <em>function arguments</em> to pass values between functions. Two variables in different functions are never the same variable even when they have the same name.</p>\n\n<p>And you have to choose whether you are going to do your <code>cout &lt;&lt;</code> inside your main function, or inside your add function. You seem to be trying to do both.</p>\n\n<p>Here's how to do it (I choose to do <code>cout &lt;&lt;</code> in the add function not the main function).</p>\n\n<pre><code>void add_func(double x, double y);\n\n...\n\nif(op == 1)\n    add_func(a, b);\n\n...\n\nvoid add_func(double x, double y)\n{\n    double sum = x + y;\n    cout &lt;&lt; x &lt;&lt; \" + \" &lt;&lt; y &lt;&lt; \" = \" &lt;&lt; sum &lt;&lt; endl;\n}\n</code></pre>\n\n<p>See the <em>parameters</em> in the add function (which I've called <code>x</code> and <code>y</code>, you can call them what you like). And see the <code>a</code> and <code>b</code> variables are passed as <em>arguments</em> when the add function is called.</p>\n\n<p>Your C++ book must talk about function parameters and passing arguments, it's absolutely fundamental to C++ programmming. Time to revise that chapter I think.</p>\n"}, {"tags": [], "owner": {"reputation": 435402, "user_id": 179910, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8962238339d771f0348967be6f97b1b?s=128&d=identicon&r=PG", "display_name": "Jerry Coffin", "link": "https://stackoverflow.com/users/179910/jerry-coffin"}, "is_accepted": false, "score": 2, "last_activity_date": 1560979586, "creation_date": 1560979586, "answer_id": 56676081, "question_id": 56675769, "link": "https://stackoverflow.com/questions/56675769/c-my-simple-calculator-program-wont-print-out-i-also-think-my-variable-nami/56676081#56676081", "title": "C++: My simple calculator program won&#39;t print out. I also think my variable naming is incorrect", "body": "<p>I'm pretty sure this: <code>if(op != (1 ^ 2 ^ 3 ^ 4))</code> isn't doing what you think it is. </p>\n\n<p>The <code>^</code> operator is a bitwise exclusive-OR, which gives a 0 bit in the result if both inputs are 0, or if both inputs are 1. If one input is a 1 and the other is a 0, the result is a 1.</p>\n\n<p>The operations are evaluated left to right, so let's work through them one at a time. To make it apparent how a result comes about, we'll include the binary equivalents of the numbers: </p>\n\n<ul>\n<li><code>1 ^ 2</code> -> <code>0001 ^ 0010</code> -> <code>0011</code>, which is <code>3</code></li>\n<li><code>3 ^ 3</code> -> <code>0011 ^ 0011</code> -> <code>0000</code>, which is <code>0</code>  </li>\n<li><code>0 ^ 4</code> -> <code>0000 ^ 0100</code> -> <code>0100</code>, which is <code>4</code></li>\n</ul>\n\n<p>So your code is equivalent to: <code>if (op != 4)</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 295, "user_id": 11667390, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/R3E8a.jpg?s=128&g=1", "display_name": "Lucifer Morningstar", "link": "https://stackoverflow.com/users/11667390/lucifer-morningstar"}, "is_accepted": false, "score": 0, "last_activity_date": 1561128043, "last_edit_date": 1561128043, "creation_date": 1560985700, "answer_id": 56677004, "question_id": 56675769, "link": "https://stackoverflow.com/questions/56675769/c-my-simple-calculator-program-wont-print-out-i-also-think-my-variable-nami/56677004#56677004", "title": "C++: My simple calculator program won&#39;t print out. I also think my variable naming is incorrect", "body": "<p>please consider using a simple online tutorial to learn the basics.\nFor example: <a href=\"https://www.tutorialspoint.com/cplusplus/index.htm\" rel=\"nofollow noreferrer\">https://www.tutorialspoint.com/cplusplus/index.htm</a>\nor: <a href=\"https://www.w3schools.com/cpp/default.asp\" rel=\"nofollow noreferrer\">https://www.w3schools.com/cpp/default.asp</a>\nAlso, when writing code, try to to pick the simplest solution.\nIt would get complicated later anyway :)\nFor a purpose of a simple calculator, a simple switch would suffice.\nPlease consider the following C code:</p>\n\n<pre><code>#include &lt;iostream&gt;\n\nint main()\n{\n    double a;\n    double b;\n    char op;\n\n    while(true)\n    {\n        std::cout &lt;&lt; \"Input 1st Number: \" &lt;&lt; std::endl;\n        std::cin &gt;&gt; a;\n        std::cout &lt;&lt; \"Select Operation: (+) (-) (*) (/) or (x) to exit: \" &lt;&lt; std::endl;\n        std::cin &gt;&gt; op;\n        std::cout &lt;&lt; \"Input 2nd Number: \" &lt;&lt; std::endl;\n        std::cin &gt;&gt; b;\n\n        switch (op)\n        {\n        case '+':\n            std::cout &lt;&lt; std::to_string(a+b) &lt;&lt; std::endl;\n            break;\n        case '-':\n            std::cout &lt;&lt; std::to_string(a-b) &lt;&lt; std::endl;\n            break;\n        case '*':\n            std::cout &lt;&lt; std::to_string(a*b) &lt;&lt; std::endl;\n            break;\n        case '/':\n            std::cout &lt;&lt; std::to_string(a/b) &lt;&lt; std::endl;\n            break;\n        case 'x':\n            return 0;\n            break;        \n        default:\n            std::cout &lt;&lt; \"Invalid Operation Selected\" &lt;&lt; std::endl;\n            break;\n        }\n    }\n}\n</code></pre>\n\n<p>It is ugly, it has ugly output, but it does the job :)\nTry to play around with, for example to achieve nicer output.\nChange it from switch statement back to if statements, and add function calls if you want. Learn about the above concepts in the tutorials available online, and do not be shy to ask questions if you get stuck. Failure and failure again is OK, that's how you learn - by trying to get better :) </p>\n"}], "owner": {"reputation": 7, "user_id": 11672662, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-lY5P6UiITFc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdYrtsxfDx24fY47PWbptq-2ps52A/mo/photo.jpg?sz=128", "display_name": "Pilf", "link": "https://stackoverflow.com/users/11672662/pilf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "answer_count": 3, "score": -2, "last_activity_date": 1561128043, "creation_date": 1560978039, "question_id": 56675769, "link": "https://stackoverflow.com/questions/56675769/c-my-simple-calculator-program-wont-print-out-i-also-think-my-variable-nami", "title": "C++: My simple calculator program won&#39;t print out. I also think my variable naming is incorrect", "body": "<p>The calculator program will accept inputs for the 1st number, operation, and 2nd number. </p>\n\n<p>I've set up the program to select the operation with conditional statements. The program does not output however.</p>\n\n<p>I also tried to print out an error message for improper operation selection using xor logic. </p>\n\n<p>I think the problem lies with how I'm using my variables. Any critique or advice is appreciated.</p>\n\n<p>I'm new to learning C++, so I'm trying to make a simple two input calculator. I'm trying to challenge my understanding of variables and conditional statements.</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>\nvoid add_func();\nvoid sub_func();\nvoid mult_func();\nvoid divi_func();\n\nint main()\n{\n        double a;\n        double b;\n        char op;\n\n        cout &lt;&lt; \"Input 1st Number:\" &lt;&lt; endl;\n        cin &gt;&gt; a;\n        cout &lt;&lt; \"Select Operation: (1 = +) (2 = -) (3 = *) (4 = /)\" &lt;&lt; endl;\n        cin &gt;&gt; op;\n        cout &lt;&lt; \"Input 2nd Number:\" &lt;&lt; endl;\n        cin &gt;&gt; b;\n\n        if(op == 1)\n                cout &lt;&lt; add_func();\n        if(op == 2)\n                sub_func();\n        if(op == 3)\n                mult_func();\n        if(op == 4)\n                divi_func();\n        if(op != (1 ^ 2 ^ 3 ^ 4))\n                cout &lt;&lt; \"Invalid Operation Selected\" &lt;&lt; endl;\n\n        return 0;\n}\n\nvoid add_func()\n{\n        double a;\n        double b;\n        double c;\n\n        c = a + b;\n        cout &lt;&lt; a &lt;&lt; \" + \" &lt;&lt; b &lt;&lt; \" = \" &lt;&lt; c &lt;&lt; endl;\n}\n\n</code></pre>\n\n<p>I've truncated the code to include only the add function. It should be adding the numbers and printing out the result.</p>\n"}, {"tags": ["python", "c++", "numpy", "swig", "numpy-ndarray"], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 11501167, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-5uDyWB74xFM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re5AyOmSoGgEhViLHmcCTK0RWNnJw/mo/photo.jpg?sz=128", "display_name": "Sean Rice", "link": "https://stackoverflow.com/users/11501167/sean-rice"}, "edited": false, "score": 0, "creation_date": 1561142377, "post_id": 56708183, "comment_id": 99980999, "body": "Hey, thanks man, that answers it pretty well! I think that I did check that out at some point but I am so new that I don&#39;t always (AKA usually don&#39;t) know what I am looking at if it&#39;s not my own code. Thank you for the explanation!"}], "tags": [], "owner": {"reputation": 81653, "user_id": 168175, "user_type": "moderator", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/qxeUf.jpg?s=128&g=1", "display_name": "Flexo", "link": "https://stackoverflow.com/users/168175/flexo"}, "is_accepted": true, "score": 1, "last_activity_date": 1561138936, "creation_date": 1561138936, "answer_id": 56708183, "question_id": 56675315, "link": "https://stackoverflow.com/questions/56675315/does-numpy-i-send-actual-pointers-to-c-or-make-copies-of-memory/56708183#56708183", "title": "Does numpy.i send actual pointers to C++, or make copies of memory?", "body": "<p>You can investigate this fairly easily in the code that SWIG generates. There are two parts to this - a .py file and a .cxx file. In each of these there's some code generate for your <code>getMid()</code> function. The Python code just directly passes everything into the C++ code, which on my system ended up looking like this:</p>\n\n<pre><code>SWIGINTERN PyObject *_wrap_getMid(PyObject *SWIGUNUSEDPARM(self), PyObject *args) {\n  PyObject *resultobj = 0;\n  double *arg1 = (double *) 0 ;\n  int arg2 ;\n  PyArrayObject *array1 = NULL ;\n  int is_new_object1 = 0 ;\n  PyObject * obj0 = 0 ;\n  double result;\n\n  if (!PyArg_ParseTuple(args,(char *)\"O:getMid\",&amp;obj0)) SWIG_fail;\n  {\n    npy_intp size[1] = {\n      -1 \n    };\n    array1 = obj_to_array_contiguous_force_conversion(obj0, NPY_DOUBLE,\n      &amp;is_new_object1);\n    if (!array1 || !require_dimensions(array1, 1) ||\n      !require_size(array1, size, 1)) SWIG_fail;\n    arg1 = (double*) array_data(array1);\n    arg2 = (int) array_size(array1,0);\n  }\n  result = (double)getMid(arg1,arg2);\n  resultobj = SWIG_From_double(static_cast&lt; double &gt;(result));\n  {\n    if (is_new_object1 &amp;&amp; array1)\n    {\n      Py_DECREF(array1); \n    }\n  }\n  return resultobj;\nfail:\n...\n</code></pre>\n\n<p>It won't change much between SWIG and Python versions, although some of the SWIG options will change it a little bit.</p>\n\n<p>The important point from the perspective of your question though seems to be the call to <code>obj_to_array_contiguous_force_conversion</code>. It has an argument that's used as an output parameter to indicate if a new object was allocated. If that ends up being set to true then after the call an object ends up getting released also.</p>\n\n<p>From that alone it's pretty safe to conclude that the answer to your question is that it depends what input you pass to the function. If it already satisfies the constraints (i.e. it's contiguous) then you won't end up making a copy. Otherwise it will, since your C++ function requires a contiguous region.</p>\n\n<p>It should also be a safe bet that if you use any of the numpy double types then you'll end up meeting this requirement and not making a copy, but for other data types that's less likely unless you've gone to a bit of effort.</p>\n"}], "owner": {"reputation": 33, "user_id": 11501167, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-5uDyWB74xFM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re5AyOmSoGgEhViLHmcCTK0RWNnJw/mo/photo.jpg?sz=128", "display_name": "Sean Rice", "link": "https://stackoverflow.com/users/11501167/sean-rice"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 56708183, "answer_count": 1, "score": 3, "last_activity_date": 1561138936, "creation_date": 1560975768, "question_id": 56675315, "link": "https://stackoverflow.com/questions/56675315/does-numpy-i-send-actual-pointers-to-c-or-make-copies-of-memory", "title": "Does numpy.i send actual pointers to C++, or make copies of memory?", "body": "<p>I am learning about C++, swig, and numpy for a lab I am working in. It has been specified that I must use swig (no scypy), I must use numpy arrays, and I may not \"bring C code into the python world\" such as by using %import \"std_vector\" in my interface file and just having the python user create one to send in. That being said, I am trying to get a 1d numpy array (if they need more dimensions I will just flatten it) to be passed into my C code by pointer exclusively - my boss doesn't want to have to take the time to copy everything because efficiency is very important. I believe we use c++ 14, python 2.7, and the latest version of swig, and I am using numpy.i as well. </p>\n\n<p>I will provide the code below that I am currently using (just trying to get a minimum viable going here) but I am pretty new, and while it does work, I am not sure that is actually passing a pointer and not copying anything like I would like. Could someone please either confirm that it is, or show me how to make it do so? Thanks x10^99</p>\n\n<pre><code>//The C++ file I am wrapping: \n#ifndef _np_array_to_array_h\n#define _np_array_to_array_h\n\nusing namespace std;\ndouble getMid(double* myArray, int size){\n    int half = size / 2;\n    return myArray[half];\n}\n#endif\n\n///\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\//\\/\\\n\n//The interface file: \n%module np_array_to_array\n\n%{\n#define SWIG_FILE_WITH_INIT\n#include \"np_array_to_array.h\"\n#include &lt;numpy/arrayobject.h&gt;\n%}\n%include \"numpy.i\"\n%init %{\nimport_array();\n%}\n%apply (double* IN_ARRAY1, int DIM1){(double* myArray, int size)};\n%include \"np_array_to_array.h\"\n\n//\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\n\n//How I compile on terminal: \nswig -python -c++ np_array_to_array.i\ng++ -fpic -c np_array_to_array_wrap.cxx -I/usr/include/python2.7 \n-I/home/sean/Desktop/SerangLab/Swig/numpy/numpy/core/include/ -I/home/sean/.local/lib/python2.7/site-packages/numpy/core/include/numpy/\n g++ -shared np_array_to_array_wrap.o -o _np_array_to_array.so\n</code></pre>\n\n<p>This will compile and run, and create a successfully working python module that I import with (when in the same directory) \"from np_array_to_array import *\" and I can successfully run the getMid method, passing in a numpyArray and getting a double back out. As stated above, I am simply not sure if this is actually pass by pointer (not making any copies) or not, as I have not found anything that says one way or the other. Could someone please tell me, and if it is not, explain how one would do this? I believe it should be possible as I think numpy array uses c types and stores memory contiguously like c does.</p>\n"}, {"tags": ["c++", "r", "rcpp"], "comments": [{"owner": {"reputation": 2528, "user_id": 4658169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b351ed2ce7ddde5ab5ac9bd96200a62d?s=128&d=identicon&r=PG&f=1", "display_name": "CuriouslyRecurringThoughts", "link": "https://stackoverflow.com/users/4658169/curiouslyrecurringthoughts"}, "edited": false, "score": 0, "creation_date": 1560977421, "post_id": 56675308, "comment_id": 99918533, "body": "I checked the docs very fast, here you are trying to go from C++ to R with your last as&lt;&gt;, when you try to get ComplexVector, correct? In such a case you should use wrap . Secondly you use malloc, so you are losing information on the length, I find difficult to believe that as or wrap can get the length of F. I suggest you look at this example for vector of double : <a href=\"https://stackoverflow.com/a/19866956/4658169\">stackoverflow.com/a/19866956/4658169</a>"}, {"owner": {"reputation": 369, "user_id": 6041579, "user_type": "registered", "profile_image": "https://graph.facebook.com/10154700448353146/picture?type=large", "display_name": "Ben", "link": "https://stackoverflow.com/users/6041579/ben"}, "reply_to_user": {"reputation": 2528, "user_id": 4658169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b351ed2ce7ddde5ab5ac9bd96200a62d?s=128&d=identicon&r=PG&f=1", "display_name": "CuriouslyRecurringThoughts", "link": "https://stackoverflow.com/users/4658169/curiouslyrecurringthoughts"}, "edited": false, "score": 0, "creation_date": 1560984787, "post_id": 56675308, "comment_id": 99920660, "body": "Thank you, I changed the last as to wrap and it fixed that error. I see what you&#39;re saying about the length of F, but I&#39;ve set it up that way because of how the finufft routine runs. I don&#39;t think I can change how I&#39;m carrying that object around without breaking that function call. There should be N entries in F, is there a good way for me to use that information to construct an object that wrap can handle out of the pointer F? I tried something like Fd.attr(&quot;dim&quot;) = Dimension(1, N), but I get an error in Exporter.h: &quot;cannot convert &#39;SEXP {aka SEXPREC*}&#39; to &#39;double*&#39; in initialization&quot;"}, {"owner": {"reputation": 2528, "user_id": 4658169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b351ed2ce7ddde5ab5ac9bd96200a62d?s=128&d=identicon&r=PG&f=1", "display_name": "CuriouslyRecurringThoughts", "link": "https://stackoverflow.com/users/4658169/curiouslyrecurringthoughts"}, "edited": false, "score": 0, "creation_date": 1560985544, "post_id": 56675308, "comment_id": 99920826, "body": "std::&#39;vector has a member function called data() that returns the raw pointer to the heap-allocated buffer vector uses. When I invoke c functions from c++ I usually use data()"}], "answers": [{"tags": [], "owner": {"reputation": 24192, "user_id": 8416610, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-cmim3CrZ9Wo/AAAAAAAAAAI/AAAAAAAAAjs/hnKTOHALc6M/photo.jpg?sz=128", "display_name": "Ralf Stubner", "link": "https://stackoverflow.com/users/8416610/ralf-stubner"}, "is_accepted": true, "score": 5, "last_activity_date": 1561017778, "last_edit_date": 1561017778, "creation_date": 1560977757, "answer_id": 56675716, "question_id": 56675308, "link": "https://stackoverflow.com/questions/56675308/no-matching-function-for-call-to-as-in-rcpp/56675716#56675716", "title": "No matching function for call to &#39;as&#39; in Rcpp", "body": "<p><code>Rcpp::as&lt;T&gt;</code> converts from an R data type (<code>SEXP</code>) to a C++ data type, e.g. <code>Rcpp::ComplexVector</code>. This does not fit your situation, where you try to convert from a C-style array to C++. Fortunately <code>Rcpp::Vector</code>, which is the basis for <code>Rcpp::ComplexVector</code>, has a constructor for this task: <code>Vector (InputIterator first, InputIterator last)</code>. For the other direction (going from C++ to C-style array) you can use <code>vector.begin()</code> or <code>&amp;vector[0]</code>.</p>\n\n<p>However, one needs a <code>reinterpret_cast</code> to convert between <code>Rcomplex*</code> and <code>std::complex&lt;double&gt;*</code>. That should cause no problems, though, since <code>Rcomplex</code> (a.k.a. <code>complex double</code> in C) and <code>std::complex&lt;doulbe&gt;</code> are <a href=\"https://stackoverflow.com/a/10540346/8416610\">compatible</a>.</p>\n\n<p>A minimal example:</p>\n\n<pre><code>#include &lt;Rcpp.h&gt;\n#include &lt;complex&gt;\nusing namespace Rcpp;\n\n// [[Rcpp::export]]\nComplexVector foo(ComplexVector v) {\n    std::complex&lt;double&gt;* F = reinterpret_cast&lt;std::complex&lt;double&gt;*&gt;(v.begin());\n    int N = v.length();\n    // do something with F\n    ComplexVector Fd(reinterpret_cast&lt;Rcomplex*&gt;(F), \n                     reinterpret_cast&lt;Rcomplex*&gt;(F + N));\n    return Fd;\n}\n\n/*** R\nset.seed(42)\nfoo(runif(4)*(1+1i))\n*/\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>&gt; Rcpp::sourceCpp('56675308/code.cpp')\n\n&gt; set.seed(42)\n\n&gt; foo(runif(4)*(1+1i))\n[1] 0.9148060+0.9148060i 0.9370754+0.9370754i 0.2861395+0.2861395i 0.8304476+0.8304476i\n</code></pre>\n\n<p>BTW, you can move these <code>reinterpret_cast</code>s out of sight by using <code>std::vector&lt;std::complex&lt;double&gt;&gt;</code> as argument and return types for your function. Rcpp does the rest for you. This also helps getting rid of the naked <code>malloc</code>:</p>\n\n<pre><code>#include &lt;Rcpp.h&gt;\n// dummy function with reduced signature\nint finufft1d1(int M, double *xd, std::complex&lt;double&gt; *cd, int N, std::complex&lt;double&gt; *Fd) {\n    return 0;\n}\n\n// [[Rcpp::export]]\nstd::vector&lt;std::complex&lt;double&gt;&gt; finufft(int M, \n                                          std::vector&lt;double&gt; x, \n                                          std::vector&lt;std::complex&lt;double&gt;&gt; c, \n                                          int N) {\n\n    // allocate output array for the finufft routine:\n    std::vector&lt;std::complex&lt;double&gt;&gt; F(N);\n    // Change vector inputs from R types to C++ types\n    double* xd = x.data();\n    std::complex&lt;double&gt;* cd = c.data();      \n    std::complex&lt;double&gt;* Fd = F.data();      \n\n    int ier = finufft1d1(M, xd, cd, N, Fd);\n\n    return F;\n}\n</code></pre>\n"}], "owner": {"reputation": 369, "user_id": 6041579, "user_type": "registered", "profile_image": "https://graph.facebook.com/10154700448353146/picture?type=large", "display_name": "Ben", "link": "https://stackoverflow.com/users/6041579/ben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 903, "favorite_count": 0, "accepted_answer_id": 56675716, "answer_count": 1, "score": 3, "last_activity_date": 1561017778, "creation_date": 1560975736, "question_id": 56675308, "link": "https://stackoverflow.com/questions/56675308/no-matching-function-for-call-to-as-in-rcpp", "title": "No matching function for call to &#39;as&#39; in Rcpp", "body": "<p>I'm trying to write an R wrapper for the <a href=\"https://finufft.readthedocs.io/en/latest/\" rel=\"nofollow noreferrer\">FINUFFT</a> routines for calculating the FFT of an unevenly sampled series. I have virtually no experience with C/C++, so I'm working from an example that compares the traditional Fourier transform to the NUFFT. The example code follows.</p>\n\n<pre><code>// this is all you must include for the finufft lib...\n#include \"finufft.h\"\n#include &lt;complex&gt;\n\n// also needed for this example...\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\nusing namespace std;\n\nint main(int argc, char* argv[])\n/* Simple example of calling the FINUFFT library from C++, using plain\n   arrays of C++ complex numbers, with a math test. Barnett 3/10/17\n   Double-precision version (see example1d1f for single-precision)\n\n   Compile with:\n   g++ -fopenmp example1d1.cpp -I ../src ../lib-static/libfinufft.a -o example1d1  -lfftw3 -lfftw3_omp -lm\n   or if you have built a single-core version:\n   g++ example1d1.cpp -I ../src ../lib-static/libfinufft.a -o example1d1 -lfftw3 -lm\n\n   Usage: ./example1d1\n*/\n{\n  int M = 1e6;            // number of nonuniform points\n  int N = 1e6;            // number of modes\n  double acc = 1e-9;      // desired accuracy\n  nufft_opts opts; finufft_default_opts(&amp;opts);\n  complex&lt;double&gt; I = complex&lt;double&gt;(0.0,1.0);  // the imaginary unit\n\n  // generate some random nonuniform points (x) and complex strengths (c):\n  double *x = (double *)malloc(sizeof(double)*M);\n  complex&lt;double&gt;* c = (complex&lt;double&gt;*)malloc(sizeof(complex&lt;double&gt;)*M);\n  for (int j=0; j&lt;M; ++j) {\n    x[j] = M_PI*(2*((double)rand()/RAND_MAX)-1);  // uniform random in [-pi,pi)\n    c[j] = 2*((double)rand()/RAND_MAX)-1 + I*(2*((double)rand()/RAND_MAX)-1);\n  }\n  // allocate output array for the Fourier modes:\n  complex&lt;double&gt;* F = (complex&lt;double&gt;*)malloc(sizeof(complex&lt;double&gt;)*N);\n\n  // call the NUFFT (with iflag=+1): note N and M are typecast to BIGINT\n  int ier = finufft1d1(M,x,c,+1,acc,N,F,opts);\n\n  int n = 142519;   // check the answer just for this mode...\n  complex&lt;double&gt; Ftest = complex&lt;double&gt;(0,0);\n  for (int j=0; j&lt;M; ++j)\n    Ftest += c[j] * exp(I*(double)n*x[j]);\n  int nout = n+N/2;        // index in output array for freq mode n\n  double Fmax = 0.0;       // compute inf norm of F\n  for (int m=0; m&lt;N; ++m) {\n    double aF = abs(F[m]);\n    if (aF&gt;Fmax) Fmax=aF;\n  }\n  double err = abs(F[nout] - Ftest)/Fmax;\n  printf(\"1D type-1 NUFFT done. ier=%d, err in F[%d] rel to max(F) is %.3g\\n\",ier,n,err);\n\n  free(x); free(c); free(F);\n  return ier;\n}\n</code></pre>\n\n<p>Much of this I don't need, such as generating the test series and comparing to the traditional FFT. Further, I want to return the values of the transform, not just an error code indicating success. Below is my code.</p>\n\n<pre><code>#include \"finufft.h\"\n#include &lt;complex&gt;\n#include &lt;Rcpp.h&gt;\n#include &lt;stdlib.h&gt;\nusing namespace Rcpp;\nusing namespace std;\n\n// [[Rcpp::export]]\n\nComplexVector finufft(int M, NumericVector x, ComplexVector c, int N) {\n\n  // From example code for finufft, sets precision and default options\n  double acc = 1e-9;\n  nufft_opts opts; finufft_default_opts(&amp;opts);\n  // allocate output array for the finufft routine:\n  complex&lt;double&gt;* F = (complex&lt;double&gt;*)malloc(sizeof(complex&lt;double&gt;*)*N);\n\n  // Change vector inputs from R types to C++ types\n  double* xd = as&lt; double* &gt;(x);\n  complex&lt;double&gt;* cd = as&lt; complex&lt;double&gt;* &gt;(c);      \n\n  // call the NUFFT (with iflag=-1): note N and M are typecast to BIGINT\n  int ier = finufft1d1(M,xd,cd,-1,acc,N,F,opts);\n  ComplexVector Fd = as&lt;ComplexVector&gt;(*F);\n\n  return Fd;\n}\n</code></pre>\n\n<p>When I try to source this in Rstudio, I get the error \"no matching function for call to 'as(std::complex&lt;double&gt;*&amp;)'\", pointing to the line declaring <code>Fd</code> towards the end. I believe the error indicates that either the function 'as' isn't defined (which I know is false), or the argument to 'as' isn't the correct type. The examples <a href=\"http://adv-r.had.co.nz/Rcpp.html\" rel=\"nofollow noreferrer\">here</a> include one using 'as' to convert to a NumericVector, so unless there's some complication with complex values I don't see why it should be a problem here.</p>\n\n<p>I know there are potential problems using two namespaces, but I don't believe that's the issue here. My best guess is that there's an issue with how I'm trying to use pointers, but I lack the experience to identify it and I can't find any similar examples online to guide me. </p>\n"}, {"tags": ["c++", "multidimensional-array", "fstream"], "comments": [{"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 1, "creation_date": 1560975496, "post_id": 56675153, "comment_id": 99917815, "body": "Voting to close as a typo.  You have an off by one error in your for loops."}, {"owner": {"reputation": 6556, "user_id": 874660, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/45a7738c334183bff552bcf73c4dcd65?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/874660/ben"}, "edited": false, "score": 0, "creation_date": 1560975949, "post_id": 56675153, "comment_id": 99917992, "body": "Instead of C arrays, use C++ arrays. So <code>std::array&lt;std::array&lt;int, 8&gt; 8&gt; num;</code> then you can do <code>for (size_t n = 0; n != num.size(); ++n) { for (size_t q = 0; q != num[n].size(); ++q) { ...</code> Also <code>TempStorage</code> should be a <code>std::vector&lt;int&gt;</code> and you should do <code>TempStorage.push_back(maybe);</code> otherwise you have undefined behavior depending on the input file."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 11491398, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb5e5b91f7dad039b1830fc7a314f189?s=128&d=identicon&r=PG&f=1", "display_name": "Sr_Sabetodo", "link": "https://stackoverflow.com/users/11491398/sr-sabetodo"}, "edited": false, "score": 0, "creation_date": 1560981110, "post_id": 56675250, "comment_id": 99919799, "body": "I can&#39;t believe it was that simple. I thought my arrays were the correct size, but clearly not. Thanks!!"}], "tags": [], "owner": {"reputation": 8766, "user_id": 451321, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/7Sdao.jpg?s=128&g=1", "display_name": "Michael Chourdakis", "link": "https://stackoverflow.com/users/451321/michael-chourdakis"}, "is_accepted": true, "score": 1, "last_activity_date": 1560975490, "creation_date": 1560975490, "answer_id": 56675250, "question_id": 56675153, "link": "https://stackoverflow.com/questions/56675153/problem-copying-values-to-multidimensional-array/56675250#56675250", "title": "Problem Copying Values to Multidimensional Array", "body": "<pre><code>for(int n=0;n&lt;9;n++) \n</code></pre>\n\n<p>Your multidimensional array has an [8] size, which means it can get from 0 to 7.</p>\n"}], "owner": {"reputation": 1, "user_id": 11491398, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb5e5b91f7dad039b1830fc7a314f189?s=128&d=identicon&r=PG&f=1", "display_name": "Sr_Sabetodo", "link": "https://stackoverflow.com/users/11491398/sr-sabetodo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 56675250, "answer_count": 1, "score": -1, "last_activity_date": 1560975545, "creation_date": 1560974954, "last_edit_date": 1560975545, "question_id": 56675153, "link": "https://stackoverflow.com/questions/56675153/problem-copying-values-to-multidimensional-array", "title": "Problem Copying Values to Multidimensional Array", "body": "<p>I'm trying to make write a program that can take 81 integers from a text file, and add them to a multidimensional array. </p>\n\n<p>I'm reading from a text file containing these integers:</p>\n\n<pre><code>1  2  3  4  5  6  7  8  9 \n10 11 12 13 14 15 16 17 18\n19 20 21 22 23 24 25 26 27 \n28 29 30 31 32 33 34 35 36 \n37 38 39 40 41 42 43 44 45 \n46 47 48 49 50 51 52 53 54 \n55 56 57 58 59 60 61 62 63\n64 65 66 67 68 69 70 71 72\n73 74 75 76 77 78 79 80 81\n</code></pre>\n\n<p>This is the code that I'm using to do this</p>\n\n<pre><code>int main() \n{\n    ifstream myFile; //ifstream object\n\n    int num[8][8]; //multidimensional array\n    int TempStorage[80]; //temporary storage for reading numbers off of text file\n    int maybe; //no clue what this one does\n\n    int i=0; //used for temp storage input\n    int x=0; //used to copy values to multidimensional array\n\n    myFile.open(\"numbers.txt\"); //open document\n\n    if(myFile.is_open()) //check if document is open\n    {\n        while(myFile &gt;&gt; maybe) //while numbers are still on document\n        {\n            TempStorage[i] = maybe; //input numbers into temporary array\n            i++; //index \n        }\n        myFile.close(); //close document\n\n        for(int n=0;n&lt;9;n++) //first loop to control first index n\n        {\n            for(int q=0;q&lt;9;q++) //second loop to control second index q        \n            {\n                num[n][q] = TempStorage[x];//read numbers into multidimensional array\n                x++;    \n            }\n        }\n    }\n    return 0;\n}\n</code></pre>\n\n<p>However, when I output all the values stored in the multidimensional array, I get the  following output. For some reason, it seems that the value of a previous index and the value of the first new index are equal. </p>\n\n<pre><code>1  2  3  4  5  6  7  8  10\n10 11 12 13 14 15 16 17 19\n19 20 21 22 23 24 25 26 28\n28 29 30 31 32 33 34 35 37\n37 38 39 40 41 42 43 44 46\n46 47 48 49 50 51 52 53 55\n55 56 57 58 59 60 61 62 64\n64 65 66 67 68 69 70 71 73\n73 74 75 76 77 78 79 80 1\n</code></pre>\n\n<p>I have changed the conditions on my for loops to just about everything that I could think of. Is this just some woefully simple problem that I am overlooking or is it something else?</p>\n"}, {"tags": ["c++", "templates", "operator-overloading", "wrapper", "ostream"], "comments": [{"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1560974626, "post_id": 56675021, "comment_id": 99917445, "body": "Are you trying to use <code>decltype(ostream() &lt;&lt; T(), Foo)</code> as SFINAE?"}, {"owner": {"reputation": 196207, "user_id": 434551, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/8Wzl8.png?s=128&g=1", "display_name": "R Sahu", "link": "https://stackoverflow.com/users/434551/r-sahu"}, "edited": false, "score": 0, "creation_date": 1560974651, "post_id": 56675021, "comment_id": 99917456, "body": "Any reason why you are not using <code>Foo&amp;</code> as the return type?"}, {"owner": {"reputation": 34957, "user_id": 2642059, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Jonathan Mee", "link": "https://stackoverflow.com/users/2642059/jonathan-mee"}, "reply_to_user": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1560974775, "post_id": 56675021, "comment_id": 99917508, "body": "@NathanOliver I mean I&#39;m not defining an alternate... but I do want an error in the calling code, not in my code if the user attempts to call a type that can&#39;t be inserted."}, {"owner": {"reputation": 34957, "user_id": 2642059, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Jonathan Mee", "link": "https://stackoverflow.com/users/2642059/jonathan-mee"}, "reply_to_user": {"reputation": 196207, "user_id": 434551, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/8Wzl8.png?s=128&g=1", "display_name": "R Sahu", "link": "https://stackoverflow.com/users/434551/r-sahu"}, "edited": false, "score": 0, "creation_date": 1560975151, "post_id": 56675021, "comment_id": 99917653, "body": "@RSahu I... I thought I was. That should be what the <code>decltype(ostream() &lt;&lt; T(), Foo)&amp;</code> evaluates to shouldn&#39;t it?"}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 0, "creation_date": 1560979007, "post_id": 56675021, "comment_id": 99919122, "body": "I don&#39;t understand the need to use <code>&lt;&lt;</code> inside of <code>decltype</code> at all.  Why not just use <code>Foo&amp; operator &lt;&lt;(const T&amp; param)</code> ? What are you trying to accomplish with such a complicated <code>decltype</code>?"}, {"owner": {"reputation": 35613, "user_id": 7582247, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OH0qZNY40Y4/AAAAAAAAAAI/AAAAAAAABbc/xAoU3i299E0/photo.jpg?sz=128", "display_name": "Ted Lyngmo", "link": "https://stackoverflow.com/users/7582247/ted-lyngmo"}, "reply_to_user": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 0, "creation_date": 1560980087, "post_id": 56675021, "comment_id": 99919482, "body": "@RemyLebeau The error message when using an unsupported type became: <code>no match for \u2018operator&lt;&lt;\u2019 (operand types are \u2018Foo\u2019 and \u2018bork\u2019</code> instead of <code>no match for \u2018operator&lt;&lt;\u2019 (operand types are \u2018std::ostringstream\u2019 {aka \u2018std::__cxx11::basic_ostringstream&lt;char&gt;\u2019} and \u2018const bork\u2019</code>. Pretty nice imo."}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "reply_to_user": {"reputation": 35613, "user_id": 7582247, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OH0qZNY40Y4/AAAAAAAAAAI/AAAAAAAABbc/xAoU3i299E0/photo.jpg?sz=128", "display_name": "Ted Lyngmo", "link": "https://stackoverflow.com/users/7582247/ted-lyngmo"}, "edited": false, "score": 0, "creation_date": 1560980379, "post_id": 56675021, "comment_id": 99919578, "body": "@TedLyngmo That doesn&#39;t answer my question. What is the point of using <code>decltype(ostream() &lt;&lt; T(), Foo)&amp;</code> at all over just using <code>Foo&amp;</code>? What is the <code>ostream() &lt;&lt; T()</code> supposed to be accomplishing when the result will still be just <code>Foo</code>? To see if <code>ostream</code> has an <code>operator&lt;&lt;</code> for <code>T</code>? If so, seems like something that should be handled with <code>std::enabled_if</code> instead"}, {"owner": {"reputation": 35613, "user_id": 7582247, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OH0qZNY40Y4/AAAAAAAAAAI/AAAAAAAABbc/xAoU3i299E0/photo.jpg?sz=128", "display_name": "Ted Lyngmo", "link": "https://stackoverflow.com/users/7582247/ted-lyngmo"}, "edited": false, "score": 0, "creation_date": 1560980417, "post_id": 56675021, "comment_id": 99919591, "body": "Ah, sorry, misunderstood. I can&#39;t manage to get that nice error if I use <code>Foo&amp; there but the </code>decltype` works."}, {"owner": {"reputation": 65594, "user_id": 459640, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/bc790307b3c4cdbd25f582d9067651f1?s=128&d=identicon&r=PG", "display_name": "aschepler", "link": "https://stackoverflow.com/users/459640/aschepler"}, "reply_to_user": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 0, "creation_date": 1560984274, "post_id": 56675021, "comment_id": 99920553, "body": "@RemyLebeau Expression SFINAE is much easier to do with <code>decltype</code> than with <code>std::enable_if_t</code>."}, {"owner": {"reputation": 65594, "user_id": 459640, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/bc790307b3c4cdbd25f582d9067651f1?s=128&d=identicon&r=PG", "display_name": "aschepler", "link": "https://stackoverflow.com/users/459640/aschepler"}, "edited": false, "score": 1, "creation_date": 1560984651, "post_id": 56675021, "comment_id": 99920629, "body": "I would consider creating a type derived from <code>std::streambuf</code> for this, so that your <code>Foo</code> can actually be a <code>std::ostream</code> with all its functionality. Boost.Iostreams can help. A somewhat old but good article: <a href=\"http://gabisoft.free.fr/articles/fltrsbf1.html\" rel=\"nofollow noreferrer\">gabisoft.free.fr/articles/fltrsbf1.html</a>"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1561008924, "post_id": 56675021, "comment_id": 99925209, "body": "This won&#39;t work for T without a default ctor, you need std::declval."}, {"owner": {"reputation": 34957, "user_id": 2642059, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Jonathan Mee", "link": "https://stackoverflow.com/users/2642059/jonathan-mee"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1561041243, "post_id": 56675021, "comment_id": 99942103, "body": "@n.m. Yeah I actually did that locally, just hacking together a toy example here."}], "answers": [{"comments": [{"owner": {"reputation": 34957, "user_id": 2642059, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Jonathan Mee", "link": "https://stackoverflow.com/users/2642059/jonathan-mee"}, "edited": false, "score": 0, "creation_date": 1560975034, "post_id": 56675110, "comment_id": 99917607, "body": "It&#39;s probably a problem with my architecture, but I can&#39;t seem to get this to handle <code>Foo() &lt;&lt; endl</code>. I would have expected that to be supported? <a href=\"https://ideone.com/b6nYrY\" rel=\"nofollow noreferrer\">ideone.com/b6nYrY</a>"}, {"owner": {"reputation": 86516, "user_id": 701092, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xYrM0.jpg?s=128&g=1", "display_name": "0x499602D2", "link": "https://stackoverflow.com/users/701092/0x499602d2"}, "reply_to_user": {"reputation": 34957, "user_id": 2642059, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Jonathan Mee", "link": "https://stackoverflow.com/users/2642059/jonathan-mee"}, "edited": false, "score": 0, "creation_date": 1560975243, "post_id": 56675110, "comment_id": 99917697, "body": "@JonathanMee Well, <code>std::endl</code> is a function template - so in order for <code>Foo() &lt;&lt; endl</code> to work, there needs to be a way for the compiler to select the correct instantiation of the function. The standard <code>std::ostream</code> has hard-coded overloads for manipulators (i.e <code>operator&lt;&lt;(std::ostream&amp; (*manip)(std::ostream&amp;))</code>). If you want that to work you probably should do the same."}, {"owner": {"reputation": 34957, "user_id": 2642059, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Jonathan Mee", "link": "https://stackoverflow.com/users/2642059/jonathan-mee"}, "edited": false, "score": 0, "creation_date": 1560975604, "post_id": 56675110, "comment_id": 99917860, "body": "I think you are telling me that I also need to implement <code>https:&#47;&#47;en.cppreference.com&#47;w&#47;cpp&#47;io&#47;basic_ostream&#47;operator_&zwnj;&#8203;ltlt</code> operators 10, 11, and 12 from this list. My question is why? These are just methods accepting function pointers right? Shouldn&#39;t that be defined in my template already?"}, {"owner": {"reputation": 86516, "user_id": 701092, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xYrM0.jpg?s=128&g=1", "display_name": "0x499602D2", "link": "https://stackoverflow.com/users/701092/0x499602d2"}, "reply_to_user": {"reputation": 34957, "user_id": 2642059, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Jonathan Mee", "link": "https://stackoverflow.com/users/2642059/jonathan-mee"}, "edited": false, "score": 1, "creation_date": 1560975894, "post_id": 56675110, "comment_id": 99917961, "body": "@JonathanMee No, they are not already defined. The problem with <code>Foo() &lt;&lt; endl</code> is <i>exactly</i> the same problem with <code>template&lt;class T&gt;void f(T); template&lt;class&gt;void g(); f(g);</code>. This will error because <code>g</code>, just like <code>std::endl</code>, is not a function, it is a function template which represents a <i>family</i> of functions. The compiler needs more information in order to instantiate <code>g</code> with the correct template arguments. You can manually do <code>Foo() &lt;&lt; endl&lt;char, char_traits&lt;char&gt;&gt;</code> but this is quite ugly. So instead the <code>std::ostream</code> defines its own extraction operators with function pointers..."}], "tags": [], "owner": {"reputation": 86516, "user_id": 701092, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xYrM0.jpg?s=128&g=1", "display_name": "0x499602D2", "link": "https://stackoverflow.com/users/701092/0x499602d2"}, "is_accepted": true, "score": 3, "last_activity_date": 1560974753, "creation_date": 1560974753, "answer_id": 56675110, "question_id": 56675021, "link": "https://stackoverflow.com/questions/56675021/getting-ostreams-insertion-operators/56675110#56675110", "title": "Getting ostream&#39;s Insertion Operators", "body": "<p><code>std::ostream</code> does not have a default constructor, and <code>Foo</code> is not an expression that can be used in <code>decltype</code>. Instead, you can directly use <code>os</code> in the first expression. In order to return <code>Foo&amp;</code> easier I'd use a trailing return type and use <code>*this</code>. </p>\n\n<pre><code>template &lt;typename T&gt;\nauto operator&lt;&lt;(const T&amp; param) -&gt; decltype(os &lt;&lt; param, *this);\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 35613, "user_id": 7582247, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OH0qZNY40Y4/AAAAAAAAAAI/AAAAAAAABbc/xAoU3i299E0/photo.jpg?sz=128", "display_name": "Ted Lyngmo", "link": "https://stackoverflow.com/users/7582247/ted-lyngmo"}, "is_accepted": false, "score": 2, "last_activity_date": 1561021186, "last_edit_date": 1561021186, "creation_date": 1560980738, "answer_id": 56676311, "question_id": 56675021, "link": "https://stackoverflow.com/questions/56675021/getting-ostreams-insertion-operators/56676311#56676311", "title": "Getting ostream&#39;s Insertion Operators", "body": "<p>This is purely based on <a href=\"https://stackoverflow.com/users/701092/0x499602d2\">0x499602D2</a>'s answer and your link to the <a href=\"https://en.cppreference.com/w/cpp/io/basic_ostream/operator_ltlt\" rel=\"nofollow noreferrer\">missing overloads 10-12</a>.</p>\n\n<p>I'm not sure what functions to use to test overload 11, but 10 and 12 are tested with <code>std::hex</code> and <code>std::endl</code>.</p>\n\n<pre><code>#include &lt;iomanip&gt;\n#include &lt;iostream&gt;\n#include &lt;sstream&gt;\n\nclass Foo {\nprivate:\n    std::ostringstream os{};\n\npublic:\n    using char_type = std::ostringstream::char_type;\n    using traits_type = std::ostringstream::traits_type;\n\n    // generic, with perfect forwarding instead of \"const T&amp;\"\n    template&lt;typename T&gt;\n    auto operator&lt;&lt;(T&amp;&amp; param) -&gt; decltype(os &lt;&lt; std::forward&lt;T&gt;(param), *this) {\n        os &lt;&lt; std::forward&lt;T&gt;(param);\n        return *this;\n    }\n\n    // overload 10\n    Foo&amp; operator&lt;&lt;(std::ios_base&amp; (*func)(std::ios_base&amp;)) {\n        func(os);\n        return *this;\n    }\n\n    // overload 11\n    Foo&amp; operator&lt;&lt;(std::basic_ios&lt;char_type, traits_type&gt;&amp; (*func)(\n        std::basic_ios&lt;char_type, traits_type&gt;&amp;)) {\n        func(os);\n        return *this;\n    }\n\n    // overload 12\n    Foo&amp; operator&lt;&lt;(std::basic_ostream&lt;char_type, traits_type&gt;&amp; (*func)(\n        std::basic_ostream&lt;char_type, traits_type&gt;&amp;)) {\n        func(os);\n        return *this;\n    }\n\n    auto str() { return os.str(); }\n};\n\nint main() {\n    Foo a;\n\n    a &lt;&lt; \"Hello Worl\";      // generic\n    a &lt;&lt; std::hex &lt;&lt; 13;    // 10 + generic\n    a &lt;&lt; std::endl;         // 12\n\n    std::cout &lt;&lt; a.str() &lt;&lt; \"\\n\";\n}\n</code></pre>\n"}], "owner": {"reputation": 34957, "user_id": 2642059, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Jonathan Mee", "link": "https://stackoverflow.com/users/2642059/jonathan-mee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 1, "accepted_answer_id": 56675110, "answer_count": 2, "score": 1, "last_activity_date": 1561021186, "creation_date": 1560974307, "question_id": 56675021, "link": "https://stackoverflow.com/questions/56675021/getting-ostreams-insertion-operators", "title": "Getting ostream&#39;s Insertion Operators", "body": "<p>I have a class that I want to wrap an <code>ostringstream</code>. I've gone about it like this:</p>\n\n<pre><code>class Foo {\n    ostringstream os;\npublic:\n    template &lt;typename T&gt;\n    decltype(ostream() &lt;&lt; T(), Foo)&amp; operator &lt;&lt;(const T&amp; param) {\n        os &lt;&lt; param;\n        return *this;\n    }\n}\n</code></pre>\n\n<p>My intent there is that I'd get any operator defined for <code>ostream</code> for free. But I'm getting the compilation error:</p>\n\n<blockquote>\n  <p>error C2893: Failed to specialize function template <code>unknown-type &amp;Foo::operator &lt;&lt;(const T &amp;)</code></p>\n</blockquote>\n\n<p>Am I using the <code>decltype</code> wrong or something?</p>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1560975047, "post_id": 56674994, "comment_id": 99917613, "body": "You should not have a global variable. A <code>MyStack</code> instance should contain all the necessary things as members. Also, you should never store a pointer you acquire with <code>&amp;</code> for later use."}, {"owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "edited": false, "score": 0, "creation_date": 1560978227, "post_id": 56674994, "comment_id": 99918847, "body": "If the head of your list is stored in a global variable, then you won&#39;t be able to have more than a single list in your code (because two lists won&#39;t be able to share the same global variable). That&#39;s a pretty significant limitation and you&#39;ll defintely lose marks for it. Don&#39;t use global variables."}], "owner": {"reputation": 7, "user_id": 11669785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0dacc9a0dd795c76d9073b8c1ba794e?s=128&d=identicon&r=PG&f=1", "display_name": "user123455", "link": "https://stackoverflow.com/users/11669785/user123455"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 25, "favorite_count": 0, "closed_date": 1560975983, "answer_count": 0, "score": 0, "last_activity_date": 1560974207, "creation_date": 1560974207, "question_id": 56674994, "link": "https://stackoverflow.com/questions/56674994/cpp-program-for-stack-using-link-list", "closed_reason": "Duplicate", "title": "cpp program for stack using link list", "body": "<p>I was trying to implement the stack using linked list,I created a global variable \n<code>head=NULL</code> and created push and pop functions But I observed while that for first query that is when first value was pushed head was pointing to it correctly \nBut when i  control goes to main came back to push  then before executing for the current value I checked that head value was changed to some garbage value.</p>\n\n<pre><code>void MyStack::push(int x) {\n    StackNode temp(x);\n    if (head == NULL) {\n        head = &amp;temp;\n    }\n    else {\n        temp.next = head;\n        head-&gt;next = &amp;temp;\n    }\n}\n/* The method pop which return the element\n  poped out of the stack*/\nint MyStack::pop() {\n    if (head == NULL)return -1;\n    else if (head-&gt;next == NULL) {\n        int t = head-&gt;data;\n        head = NULL;\n        return t;\n    }\n    else {\n        int t = head-&gt;data;\n        head = head-&gt;next;\n        return t;\n    }\n}\n</code></pre>\n\n<p>My main program</p>\n\n<pre><code>#include &lt;iostream&gt;\n\nusing namespace std;\nstruct StackNode {\n    int data;\n    StackNode *next;\n    StackNode(int a) {\n        data = a;\n        next = NULL;\n    }\n};\nStackNode* head = NULL; /// Global variable to hold linked list\nclass MyStack {\nprivate:\n    StackNode *top;\npublic:\n    void push(int);\n    int pop();\n    MyStack() { top = NULL; }\n};\nint main() {\n    int T;\n    cin &gt;&gt; T;\n    while (T--) {\n        MyStack *sq = new MyStack();\n        int Q;\n        cin &gt;&gt; Q;\n        while (Q--) {\n            int QueryType = 0;\n            cin &gt;&gt; QueryType;\n            if (QueryType == 1) {\n                int a;\n                cin &gt;&gt; a;\n                sq-&gt;push(a);\n            }\n            else if (QueryType == 2) {\n                cout &lt;&lt; sq-&gt;pop() &lt;&lt; \" \";\n            }\n        }\n        cout &lt;&lt; endl;\n    }\n}\n\n\n\n/*This is a function problem.You only need to complete the function given below*/\n/*\nThe structure of the node of the stack is\nstruct StackNode\n{\n    int data;\n    StackNode *next;\n    StackNode(int a)\n    {\n        data = a;\n        next = NULL;\n    }\n};\n// And this is structure of MyStack\nclass MyStack {\nprivate:\nStackNode *top;\npublic :\n    void push(int);\n    int pop();\n    MyStack()\n    {\n        top = NULL;\n    }\n};\n/* The method push to push element\n   into the stack */\n\nvoid MyStack::push(int x) {\n    StackNode temp(x);\n    if (head == NULL) {\n        head = &amp;temp;\n    }\n    else {\n        temp.next = head;\n        head-&gt;next = &amp;temp;\n    }\n}\n/* The method pop which return the element\n  poped out of the stack*/\nint MyStack::pop() {\n    if (head == NULL)return -1;\n    else if (head-&gt;next == NULL) {\n        int t = head-&gt;data;\n        head = NULL;\n        return t;\n    }\n    else {\n        int t = head-&gt;data;\n        head = head-&gt;next;\n        return t;\n    }\n}\n</code></pre>\n\n<p><a href=\"https://practice.geeksforgeeks.org/problems/implement-stack-using-linked-list/1\" rel=\"nofollow noreferrer\">problem link</a></p>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 8766, "user_id": 451321, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/7Sdao.jpg?s=128&g=1", "display_name": "Michael Chourdakis", "link": "https://stackoverflow.com/users/451321/michael-chourdakis"}, "edited": false, "score": 2, "creation_date": 1560974098, "post_id": 56674929, "comment_id": 99917235, "body": "Read your compiler&#39;s warnings."}, {"owner": {"reputation": 13848, "user_id": 276193, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/3d9b60ead1b0c8420c03b203832e8d5f?s=128&d=identicon&r=PG", "display_name": "learnvst", "link": "https://stackoverflow.com/users/276193/learnvst"}, "edited": false, "score": 0, "creation_date": 1560974781, "post_id": 56674929, "comment_id": 99917511, "body": "Take a peek at my answer to a very related question <a href=\"https://stackoverflow.com/a/56424762/276193\">stackoverflow.com/a/56424762/276193</a>"}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 1, "creation_date": 1560975251, "post_id": 56674929, "comment_id": 99917703, "body": "It&#39;s implementation-defined whether <code>char</code> is signed or unsigned. If it is signed, overflow has undefined behaviour."}, {"owner": {"reputation": 10359, "user_id": 1216776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504692de390dabd9ca22fd716e178993?s=128&d=identicon&r=PG", "display_name": "stark", "link": "https://stackoverflow.com/users/1216776/stark"}, "edited": false, "score": 0, "creation_date": 1560976258, "post_id": 56674929, "comment_id": 99918122, "body": "Change <code>char</code> to <code>unsigned char</code> if you want to represent 0 .. 255."}, {"owner": {"reputation": 68702, "user_id": 1593860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1361e47a8bf06d20ffda9a686ceb7e68?s=128&d=identicon&r=PG", "display_name": "Pete Becker", "link": "https://stackoverflow.com/users/1593860/pete-becker"}, "edited": false, "score": 1, "creation_date": 1561000678, "post_id": 56674929, "comment_id": 99923448, "body": "There are no casts in this code. The question seems to be about a <b>conversion</b>. A <b>cast</b> is something you write in your source code to tell the compiler to do a conversion l"}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 11511843, "user_type": "registered", "profile_image": "https://graph.facebook.com/815185545518453/picture?type=large", "display_name": "Theodor3699", "link": "https://stackoverflow.com/users/11511843/theodor3699"}, "edited": false, "score": 0, "creation_date": 1560974771, "post_id": 56674955, "comment_id": 99917506, "body": "it&#39;s an example from my OOP course, not some code written by me. Can you please explain the calculation such that the example lead to -126 and -30? I didn&#39;t really understand how it &quot;wraps&quot; around"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "reply_to_user": {"reputation": 23, "user_id": 11511843, "user_type": "registered", "profile_image": "https://graph.facebook.com/815185545518453/picture?type=large", "display_name": "Theodor3699", "link": "https://stackoverflow.com/users/11511843/theodor3699"}, "edited": false, "score": 1, "creation_date": 1560975216, "post_id": 56674955, "comment_id": 99917684, "body": "Signed integer numbers in modern machines are stored in <a href=\"https://en.wikipedia.org/wiki/Two&#39;s_complement\" rel=\"nofollow noreferrer\">Two&#39;s Complement</a>. An 8-bit value (<code>char</code>) can either be unsigned (<code>0</code>..<code>255</code>) or signed with Two&#39;s Complement (<code>-128</code>..<code>127</code>). No other values can be represented. In the case of signed, <code>char x = 127 + 1</code> assigns <code>-128</code> to <code>x</code>. In your case, 130 is precisely 3 over the limit, so it&#39;s the same as <code>127 + 3</code> where that&#39;s <code>-126</code> wrapped around."}], "tags": [], "owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "is_accepted": false, "score": 0, "last_activity_date": 1560974014, "creation_date": 1560974014, "answer_id": 56674955, "question_id": 56674929, "link": "https://stackoverflow.com/questions/56674929/cast-from-int-to-char/56674955#56674955", "title": "Cast from int to char", "body": "<p>The numerical range for <code>char</code> is <code>-128</code>..<code>127</code>. <code>10 + 20 + 100</code> is <code>130</code> and outside of that range, so it wraps around when expressed as <code>char</code>.</p>\n\n<p>To fix you need to use a data type that can contain values large enough:</p>\n\n<pre><code>auto f = [&amp;value] (int x, int y) -&gt; int { return x + y + value; };\n</code></pre>\n\n<p>Or use values &lt; 127.</p>\n"}], "owner": {"reputation": 23, "user_id": 11511843, "user_type": "registered", "profile_image": "https://graph.facebook.com/815185545518453/picture?type=large", "display_name": "Theodor3699", "link": "https://stackoverflow.com/users/11511843/theodor3699"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 80, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1560974233, "creation_date": 1560973899, "question_id": 56674929, "link": "https://stackoverflow.com/questions/56674929/cast-from-int-to-char", "title": "Cast from int to char", "body": "<p>I'd like to know how this cast works :</p>\n\n<pre><code>int value = 100;\nauto f = [&amp;value] (int x, int y) -&gt; char { return x + y + value; };\nprintf(\"%d\\n\", f(10, 20));\nvalue = 200;\nprintf(\"%d\\n\", f(10, 20));\nreturn 0;\n</code></pre>\n\n<p>It prints -126 and -30 but i don't understand how is it possible to print a negative integer.</p>\n"}, {"tags": ["c++", "openpose"], "comments": [{"owner": {"reputation": 12540, "user_id": 11089932, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N9t0d.jpg?s=128&g=1", "display_name": "HansHirse", "link": "https://stackoverflow.com/users/11089932/hanshirse"}, "edited": false, "score": 0, "creation_date": 1561006523, "post_id": 56674830, "comment_id": 99924539, "body": "I tried to edit your question, but I still think, it&#39;s quite unclear what you&#39;re trying to achieve. Also, <code>putTextOnCvMat</code> is an <a href=\"https://github.com/CMU-Perceptual-Computing-Lab/openpose/blob/master/include/openpose/utilities/openCv.hpp\" rel=\"nofollow noreferrer\">OpenPose</a> function, so I&#39;m not sure, if the opencv tag is justified here..."}, {"owner": {"reputation": 19, "user_id": 11672256, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-2BlMTKje8ko/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reFL9P97yXdDmVAdT90kUqoLvbnjQ/mo/photo.jpg?sz=128", "display_name": "hbtousa", "link": "https://stackoverflow.com/users/11672256/hbtousa"}, "reply_to_user": {"reputation": 12540, "user_id": 11089932, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N9t0d.jpg?s=128&g=1", "display_name": "HansHirse", "link": "https://stackoverflow.com/users/11089932/hanshirse"}, "edited": false, "score": 0, "creation_date": 1561037470, "post_id": 56674830, "comment_id": 99939714, "body": "Thanks. Sorry about the post. I fixed it a little bit more to clarify the question. What I am try to do is to display poseIds and poseKeypoints values either on the screen and/or csv file."}], "owner": {"reputation": 19, "user_id": 11672256, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-2BlMTKje8ko/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reFL9P97yXdDmVAdT90kUqoLvbnjQ/mo/photo.jpg?sz=128", "display_name": "hbtousa", "link": "https://stackoverflow.com/users/11672256/hbtousa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 121, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1561037152, "creation_date": 1560973502, "last_edit_date": 1561037152, "question_id": 56674830, "link": "https://stackoverflow.com/questions/56674830/how-to-display-data-from-arrays", "title": "How to display data from arrays?", "body": "<p>I am trying to read and display the values off two arrays. I understand that one array has the values <code>(x, y)</code>, and the other one has an ID part number as.</p>\n\n<p>The code has Opencv, C++, and I believe Python as well, which makes it very confusing for a novice like me. The code below displays the variables <code>framenumber</code> and <code>numberpeople</code> on the screen as it is supposed to do it. I tried to print the arrays <code>poseIds</code> and <code>poseKeypoints</code> without luck.</p>\n\n<p>Here's the code:</p>\n\n<pre><code>// Add each person ID\nvoid GuiInfoAdder::addInfo(cv::Mat&amp; cvOutputData, const int \nnumberPeople, const unsigned long long id, const std::string&amp; \nelementRenderedName, const  unsigned long long frameNumber, const \nArray&lt;long long&gt;&amp;  poseIds, const  Array&lt;float&gt;&amp; poseKeypoints)\n\n// Frame number\nputTextOnCvMat(cvOutputData, \"Frame: \" + std::to_string(frameNumber), \n{borderMargin, (int)(cvOutputData.rows - borderMargin)}, WHITE_SCALAR, \nfalse, cvOutputData.cols);\n\n// Number people\nputTextOnCvMat(cvOutputData, \"People: \" + std::to_string(numberPeople), \n{(int)(cvOutputData.cols - borderMargin), (int)(cvOutputData.rows - \nborderMargin)}, WHITE_SCALAR, true, cvOutputData.cols);\n</code></pre>\n\n<p>I will try to accommodate the line codes below I found on line to see if I can accomplish the task.Not so sure if I can use them and make them work</p>\n\n<pre><code>void PrintArrays()\n{\n    cout &lt;&lt; text &lt;&lt; \"   \" &lt;&lt; IDpart &lt;&lt;\"   \"&lt;&lt; valuex &lt;&lt; \"   \" &lt;&lt; valuey &lt;&lt; \nendl;\n}\n</code></pre>\n"}, {"tags": ["c++", "c++11", "inheritance", "final", "virtual-functions"], "comments": [{"owner": {"reputation": 8766, "user_id": 451321, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/7Sdao.jpg?s=128&g=1", "display_name": "Michael Chourdakis", "link": "https://stackoverflow.com/users/451321/michael-chourdakis"}, "edited": false, "score": 1, "creation_date": 1560973071, "post_id": 56674679, "comment_id": 99916800, "body": "It&#39;s redundant, but this can be also seen for example when doing private inheritance, where all the members are rendered private; You still have the private keyword for some of them, but the private inheritance supersedes all."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10670669"}, "edited": false, "score": 0, "creation_date": 1560973225, "post_id": 56674679, "comment_id": 99916871, "body": "Check out <a href=\"https://stackoverflow.com/questions/11704406/whats-the-point-of-a-final-virtual-function\" title=\"whats the point of a final virtual function\">stackoverflow.com/questions/11704406/&hellip;</a>"}, {"owner": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "edited": false, "score": 1, "creation_date": 1560973251, "post_id": 56674679, "comment_id": 99916881, "body": "&quot;Adding final to the class D prevents it from further derivation.&quot; =&gt; &quot; prevents it (f) from being overridden in a class derived from D&quot;. So it is redundant, no doubt."}, {"owner": {"reputation": 59936, "user_id": 6022656, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bf138f6c424001ac8491ca86b1976c0c?s=128&d=identicon&r=PG&f=1", "display_name": "max66", "link": "https://stackoverflow.com/users/6022656/max66"}, "edited": false, "score": 1, "creation_date": 1560973357, "post_id": 56674679, "comment_id": 99916929, "body": "It seems to me that is redundant, in this case. As is redundant (if I&#39;m not wrong) using <code>override</code> together with <code>final</code>."}, {"owner": {"reputation": 19910, "user_id": 8012646, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/T8yOZ.png?s=128&g=1", "display_name": "\u30ed\u30fc\u30a6", "link": "https://stackoverflow.com/users/8012646/%e3%83%ad%e3%83%bc%e3%82%a6"}, "reply_to_user": {"reputation": 59936, "user_id": 6022656, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bf138f6c424001ac8491ca86b1976c0c?s=128&d=identicon&r=PG&f=1", "display_name": "max66", "link": "https://stackoverflow.com/users/6022656/max66"}, "edited": false, "score": 0, "creation_date": 1560973764, "post_id": 56674679, "comment_id": 99917098, "body": "@max66 because <code>final</code> already implies that the member function has to be <code>virtual</code>?"}, {"owner": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "edited": false, "score": 0, "creation_date": 1560973900, "post_id": 56674679, "comment_id": 99917156, "body": "I think the standard is clear, see <a href=\"http://eel.is/c++draft/class#4\" rel=\"nofollow noreferrer\">eel.is/c++draft/class#4</a> and <a href=\"http://eel.is/c++draft/class.virtual#4\" rel=\"nofollow noreferrer\">eel.is/c++draft/class.virtual#4</a>"}, {"owner": {"reputation": 59936, "user_id": 6022656, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bf138f6c424001ac8491ca86b1976c0c?s=128&d=identicon&r=PG&f=1", "display_name": "max66", "link": "https://stackoverflow.com/users/6022656/max66"}, "edited": false, "score": 1, "creation_date": 1560977599, "post_id": 56674679, "comment_id": 99918601, "body": "&quot;because final already implies that the member function has to be virtual?&quot; - Exactly."}], "answers": [{"tags": [], "owner": {"reputation": 35327, "user_id": 27678, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/7496124d499d578df1e3a6ff85e7ae03?s=128&d=identicon&r=PG", "display_name": "AndyG", "link": "https://stackoverflow.com/users/27678/andyg"}, "is_accepted": true, "score": 2, "last_activity_date": 1560973959, "creation_date": 1560973959, "answer_id": 56674946, "question_id": 56674679, "link": "https://stackoverflow.com/questions/56674679/why-adding-final-to-a-member-function-of-a-final-class/56674946#56674946", "title": "Why adding final to a member function of a final class?", "body": "<p><code>final</code> on a <code>virtual</code> function in a <code>final</code> derived class is redundant.</p>\n\n<p>Just like saying <code>virtual</code> on a method marked <code>override</code> is redundant. C++ just is that way sometimes.</p>\n"}], "owner": {"reputation": 19910, "user_id": 8012646, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/T8yOZ.png?s=128&g=1", "display_name": "\u30ed\u30fc\u30a6", "link": "https://stackoverflow.com/users/8012646/%e3%83%ad%e3%83%bc%e3%82%a6"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 56674946, "answer_count": 1, "score": 1, "last_activity_date": 1560973959, "creation_date": 1560972797, "last_edit_date": 1560973689, "question_id": 56674679, "link": "https://stackoverflow.com/questions/56674679/why-adding-final-to-a-member-function-of-a-final-class", "title": "Why adding final to a member function of a final class?", "body": "<p>Consider the following code:</p>\n\n<pre><code>#include &lt;iostream&gt;\n\nclass B {\n   virtual void f() {\n      std::cout &lt;&lt; \"Base\" &lt;&lt; '\\n';\n   }\n};\n\nclass D final: public Base {\n   void f() final override {\n      std::cout &lt;&lt; \"Derived\" &lt;&lt; '\\n';\n   }\n};\n</code></pre>\n\n<p>Paying attention to the two uses of the <a href=\"https://en.cppreference.com/w/cpp/language/final\" rel=\"nofollow noreferrer\"><code>final</code></a> contextual keyword above \u2013 available since C++11 \u2013 we can observe the following:</p>\n\n<ul>\n<li>Adding <code>final</code> to <code>D</code>'s member function <code>f()</code> prevents <code>f()</code> from being <em>overridden</em> in a class derived from <code>D</code>.</li>\n<li>Adding <code>final</code> to the class <code>D</code> prevents it from further <em>derivation</em>. </li>\n</ul>\n\n<p>Therefore, it is not possible that the member function <code>f()</code> is overridden by a class derived from <code>D</code>, since such a derived class can't exist due to the <code>final</code> applied to the class <code>D</code>.</p>\n\n<p>Is there any point in using <code>final</code> as override control for a <code>virtual</code> member function of a class declared as <code>final</code>? Or is it merely redundant?</p>\n"}, {"tags": ["c++", "windows", "winapi"], "comments": [{"owner": {"reputation": 1239, "user_id": 4452971, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/og0oX.png?s=128&g=1", "display_name": "Castorix", "link": "https://stackoverflow.com/users/4452971/castorix"}, "edited": false, "score": 1, "creation_date": 1560983247, "post_id": 56674622, "comment_id": 99920347, "body": "The method used in Windows 10 is <b>IApplicationAssociationRegistrationInternal</b> which generates automatically the hash (I had answered with more details in another thread...)"}], "answers": [{"tags": [], "owner": {"reputation": 82917, "user_id": 3501, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/1fd5f5cc203c393634379a3b3b7e7a87?s=128&d=identicon&r=PG", "display_name": "Anders", "link": "https://stackoverflow.com/users/3501/anders"}, "is_accepted": false, "score": 1, "last_activity_date": 1560973756, "creation_date": 1560973756, "answer_id": 56674894, "question_id": 56674622, "link": "https://stackoverflow.com/questions/56674622/alternative-to-iapplicationassociationregistration-interface-on-windows-8-8-1-a/56674894#56674894", "title": "Alternative to IApplicationAssociationRegistration Interface on Windows 8, 8.1 and 10", "body": "<p>There is no real alternative, Microsoft does not want applications to change the defaults because of badly behaved 3rd-party applications.</p>\n\n<p>If you want to go into undocumented land, a subkey in the Explorer key stores the \"encrypted\" default progid for each claimed file-extension.</p>\n"}], "owner": {"reputation": 121, "user_id": 9468747, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-UuxLY820USA/AAAAAAAAAAI/AAAAAAAAAC0/Mdfl6jVg3x8/photo.jpg?sz=128", "display_name": "Namig Ismayilov", "link": "https://stackoverflow.com/users/9468747/namig-ismayilov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1560979313, "creation_date": 1560972480, "last_edit_date": 1560979313, "question_id": 56674622, "link": "https://stackoverflow.com/questions/56674622/alternative-to-iapplicationassociationregistration-interface-on-windows-8-8-1-a", "title": "Alternative to IApplicationAssociationRegistration Interface on Windows 8, 8.1 and 10", "body": "<p>I am new to the subject. If something looks unclear and needs clarification, please comment and I will try to provide more details.</p>\n\n<p>I have been working on a project that was implemented a couple of years ago and needs some tuning to fit today's needs.</p>\n\n<p>This Windows Desktop Application has a feature to set the app as a default, using a couple of methods of the <a href=\"https://docs.microsoft.com/en-us/windows/desktop/api/shobjidl_core/nn-shobjidl_core-iapplicationassociationregistration\" rel=\"nofollow noreferrer\"><code>IApplicationAssociationRegistration</code></a> interface.</p>\n\n<p>Part of the code:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>BOOL CDefaultPrograms::SetActiveSendAllDefaults()\n{\n    BOOL bRet = FALSE;\n    IApplicationAssociationRegistration *pAAR;\n\n    try\n    {\n        HRESULT hr = CoCreateInstance(\n                    CLSID_ApplicationAssociationRegistration,\n                    NULL,\n                    CLSCTX_INPROC,\n                    __uuidof(IApplicationAssociationRegistration),\n                    (void**)&amp;pAAR);\n\n        if (SUCCEEDED(hr))\n        {\n            hr = pAAR-&gt;SetAppAsDefaultAll(ACTIVESEND_REGNAME);\n\n            bRet = SUCCEEDED(hr);\n\n            pAAR-&gt;Release();\n        }\n    }\n    catch(...)\n    {\n    }\n\n    return bRet;\n}\n</code></pre>\n\n<p>According to the documentation, this feature works only for prior to Windows 8.</p>\n\n<p><a href=\"https://i.stack.imgur.com/X6Fk4.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/X6Fk4.png\" alt=\"image\"></a></p>\n\n<p><strong>Question:</strong> What is the alternative for the same feature for Windows 8+? </p>\n"}, {"tags": ["c++", "opengl", "fbo", "depth-buffer"], "comments": [{"owner": {"reputation": 698, "user_id": 2323908, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/80b84a0e679c6c32e168f2b8865cd4cb?s=128&d=identicon&r=PG&f=1", "display_name": "Joakim Thor&#233;n", "link": "https://stackoverflow.com/users/2323908/joakim-thor%c3%a9n"}, "edited": false, "score": 1, "creation_date": 1560970438, "post_id": 56674073, "comment_id": 99915670, "body": "You should try to rephrase your post into a question. Currently, your post is a series of statements."}, {"owner": {"reputation": 93, "user_id": 11618989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fkJSg.jpg?s=128&g=1", "display_name": "Kiord", "link": "https://stackoverflow.com/users/11618989/kiord"}, "reply_to_user": {"reputation": 698, "user_id": 2323908, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/80b84a0e679c6c32e168f2b8865cd4cb?s=128&d=identicon&r=PG&f=1", "display_name": "Joakim Thor&#233;n", "link": "https://stackoverflow.com/users/2323908/joakim-thor%c3%a9n"}, "edited": false, "score": 0, "creation_date": 1560970845, "post_id": 56674073, "comment_id": 99915851, "body": "@JoakimThor&#233;n Ok ! editing"}, {"owner": {"reputation": 93, "user_id": 11618989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fkJSg.jpg?s=128&g=1", "display_name": "Kiord", "link": "https://stackoverflow.com/users/11618989/kiord"}, "reply_to_user": {"reputation": 698, "user_id": 2323908, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/80b84a0e679c6c32e168f2b8865cd4cb?s=128&d=identicon&r=PG&f=1", "display_name": "Joakim Thor&#233;n", "link": "https://stackoverflow.com/users/2323908/joakim-thor%c3%a9n"}, "edited": false, "score": 0, "creation_date": 1560971310, "post_id": 56674073, "comment_id": 99916046, "body": "@JoakimThor&#233;n Is it better ?"}, {"owner": {"reputation": 9720, "user_id": 6371123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f90991c1b06c79ae4c6e79fb616d608?s=128&d=identicon&r=PG", "display_name": "G.M.", "link": "https://stackoverflow.com/users/6371123/g-m"}, "edited": false, "score": 0, "creation_date": 1560971510, "post_id": 56674073, "comment_id": 99916145, "body": "The fact that mistakenly specifying <code>GL_DEPTH_COMPONENT16</code> instead of <code>GL_DEPTH_ATTACHMENT</code> when attaching <code>rbo</code> resulted in the FBO being considered complete suggests, perhaps, that <code>rbo</code> does not pass the <a href=\"https://www.khronos.org/opengl/wiki/Framebuffer_Object#Attachment_Completeness\" rel=\"nofollow noreferrer\">attachment complete</a> requirements.  Maybe?"}, {"owner": {"reputation": 138010, "user_id": 5577765, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LoGpC.jpg?s=128&g=1", "display_name": "Rabbid76", "link": "https://stackoverflow.com/users/5577765/rabbid76"}, "reply_to_user": {"reputation": 9720, "user_id": 6371123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f90991c1b06c79ae4c6e79fb616d608?s=128&d=identicon&r=PG", "display_name": "G.M.", "link": "https://stackoverflow.com/users/6371123/g-m"}, "edited": false, "score": 0, "creation_date": 1560971834, "post_id": 56674073, "comment_id": 99916290, "body": "@G.M. I don&#39;t know what you mean the 2nd parameter of  <a href=\"https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/glRenderbufferStorage.xhtml\" rel=\"nofollow noreferrer\"><code>glRenderbufferStorage</code></a> has to be the internal format (e.g. <code>GL_DEPTH_COMPONENT16 </code>) and the 3rd parameter of  <a href=\"https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/glFramebufferRenderbuffer.xhtml\" rel=\"nofollow noreferrer\"><code>glFramebufferRenderbuffer</code></a> has to be <code>GL_DEPTH_ATTACHMENT</code> for the depth buffer."}, {"owner": {"reputation": 9720, "user_id": 6371123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f90991c1b06c79ae4c6e79fb616d608?s=128&d=identicon&r=PG", "display_name": "G.M.", "link": "https://stackoverflow.com/users/6371123/g-m"}, "reply_to_user": {"reputation": 138010, "user_id": 5577765, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LoGpC.jpg?s=128&g=1", "display_name": "Rabbid76", "link": "https://stackoverflow.com/users/5577765/rabbid76"}, "edited": false, "score": 0, "creation_date": 1560972216, "post_id": 56674073, "comment_id": 99916470, "body": "@Rabbid76 The code I&#39;m referring to was removed by the 1st edit unfortunately.  The OP reported that the FBO was considered complete when they mistakenly invoked <code>glFramebufferRenderbuffer</code> with a 2nd parameter of <code>GL_DEPTH_COMPONENT16</code> rather than <code>GL_DEPTH_ATTACHMENT</code>."}, {"owner": {"reputation": 138010, "user_id": 5577765, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LoGpC.jpg?s=128&g=1", "display_name": "Rabbid76", "link": "https://stackoverflow.com/users/5577765/rabbid76"}, "reply_to_user": {"reputation": 9720, "user_id": 6371123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f90991c1b06c79ae4c6e79fb616d608?s=128&d=identicon&r=PG", "display_name": "G.M.", "link": "https://stackoverflow.com/users/6371123/g-m"}, "edited": false, "score": 0, "creation_date": 1560972312, "post_id": 56674073, "comment_id": 99916511, "body": "@G.M. Ah, I see. Of course the framebuffer is complete in this case, because the depth buffer is not attached at all (<code>GL_DEPTH_COMPONENT16</code> is not a valid attachment point). A framebuffer with a color buffer only is complete."}, {"owner": {"reputation": 93, "user_id": 11618989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fkJSg.jpg?s=128&g=1", "display_name": "Kiord", "link": "https://stackoverflow.com/users/11618989/kiord"}, "reply_to_user": {"reputation": 138010, "user_id": 5577765, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LoGpC.jpg?s=128&g=1", "display_name": "Rabbid76", "link": "https://stackoverflow.com/users/5577765/rabbid76"}, "edited": false, "score": 0, "creation_date": 1560979259, "post_id": 56674073, "comment_id": 99919205, "body": "@Rabbid76 @G.M. I&#39;m back, thanks for you replies. Ok so <code>GL_DEPTH_COMPONENT16</code> instead of  <code>GL_DEPTH_ATTACHMENT</code> just doesn&#39;t attach the buffer, I see."}, {"owner": {"reputation": 93, "user_id": 11618989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fkJSg.jpg?s=128&g=1", "display_name": "Kiord", "link": "https://stackoverflow.com/users/11618989/kiord"}, "reply_to_user": {"reputation": 138010, "user_id": 5577765, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LoGpC.jpg?s=128&g=1", "display_name": "Rabbid76", "link": "https://stackoverflow.com/users/5577765/rabbid76"}, "edited": false, "score": 0, "creation_date": 1560979376, "post_id": 56674073, "comment_id": 99919255, "body": "@Rabbid76 I tried both <code>GL_DEPTH_COMPONENT24</code> and <code>GL_DEPTH24_STENCIL8</code> and the same problem occurs..."}, {"owner": {"reputation": 93, "user_id": 11618989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fkJSg.jpg?s=128&g=1", "display_name": "Kiord", "link": "https://stackoverflow.com/users/11618989/kiord"}, "reply_to_user": {"reputation": 138010, "user_id": 5577765, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LoGpC.jpg?s=128&g=1", "display_name": "Rabbid76", "link": "https://stackoverflow.com/users/5577765/rabbid76"}, "edited": false, "score": 0, "creation_date": 1560979616, "post_id": 56674073, "comment_id": 99919348, "body": "@Rabbid76 Yes ."}, {"owner": {"reputation": 93, "user_id": 11618989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fkJSg.jpg?s=128&g=1", "display_name": "Kiord", "link": "https://stackoverflow.com/users/11618989/kiord"}, "reply_to_user": {"reputation": 138010, "user_id": 5577765, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LoGpC.jpg?s=128&g=1", "display_name": "Rabbid76", "link": "https://stackoverflow.com/users/5577765/rabbid76"}, "edited": false, "score": 0, "creation_date": 1560980719, "post_id": 56674073, "comment_id": 99919690, "body": "@Rabbid76 I changed several lines and it works now, figuring out why."}, {"owner": {"reputation": 698, "user_id": 2323908, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/80b84a0e679c6c32e168f2b8865cd4cb?s=128&d=identicon&r=PG&f=1", "display_name": "Joakim Thor&#233;n", "link": "https://stackoverflow.com/users/2323908/joakim-thor%c3%a9n"}, "edited": false, "score": 0, "creation_date": 1560981179, "post_id": 56674073, "comment_id": 99919824, "body": "@Kiord I think its better now"}], "answers": [{"comments": [{"owner": {"reputation": 138010, "user_id": 5577765, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LoGpC.jpg?s=128&g=1", "display_name": "Rabbid76", "link": "https://stackoverflow.com/users/5577765/rabbid76"}, "edited": false, "score": 0, "creation_date": 1561011359, "post_id": 56676397, "comment_id": 99926017, "body": "Oh yes, because by default the value of <code>GL_TEXTURE_MIN_FILTER</code> is <code>GL_NEAREST_MIPMAP_LINEAR</code>"}, {"owner": {"reputation": 93, "user_id": 11618989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fkJSg.jpg?s=128&g=1", "display_name": "Kiord", "link": "https://stackoverflow.com/users/11618989/kiord"}, "reply_to_user": {"reputation": 138010, "user_id": 5577765, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LoGpC.jpg?s=128&g=1", "display_name": "Rabbid76", "link": "https://stackoverflow.com/users/5577765/rabbid76"}, "edited": false, "score": 0, "creation_date": 1561017463, "post_id": 56676397, "comment_id": 99928777, "body": "Ok, It makes sense now."}], "tags": [], "owner": {"reputation": 93, "user_id": 11618989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fkJSg.jpg?s=128&g=1", "display_name": "Kiord", "link": "https://stackoverflow.com/users/11618989/kiord"}, "is_accepted": true, "score": 1, "last_activity_date": 1560981274, "creation_date": 1560981274, "answer_id": 56676397, "question_id": 56674073, "link": "https://stackoverflow.com/questions/56674073/incomplete-fbo-when-attaching-rbo/56676397#56676397", "title": "Incomplete FBO when attaching RBO", "body": "<p><strong>Solved</strong></p>\n\n<p>I followed step by step this tutorial : <a href=\"http://www.opengl-tutorial.org/fr/intermediate-tutorials/tutorial-14-render-to-texture/\" rel=\"nofollow noreferrer\">http://www.opengl-tutorial.org/fr/intermediate-tutorials/tutorial-14-render-to-texture/</a> </p>\n\n<p>The errror occurs when this block of code is missing :</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_NEAREST);\nglTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_NEAREST);\nglTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE);\nglTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE);\n</code></pre>\n\n<p>It's the parameters of the texture (color buffer).\nIn particular, only the second line is necessary to avoid the <code>GL_FRAMEBUFFER_INCOMPLETE_ATTACHMENT</code> error.</p>\n\n<p>It seems that adding a depth buffer without setting some of the texture filtering parameters won't work. (However, it works when there is only a color buffer, surprinsing)</p>\n"}], "owner": {"reputation": 93, "user_id": 11618989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fkJSg.jpg?s=128&g=1", "display_name": "Kiord", "link": "https://stackoverflow.com/users/11618989/kiord"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "accepted_answer_id": 56676397, "answer_count": 1, "score": 2, "last_activity_date": 1560981274, "creation_date": 1560970048, "last_edit_date": 1560979524, "question_id": 56674073, "link": "https://stackoverflow.com/questions/56674073/incomplete-fbo-when-attaching-rbo", "title": "Incomplete FBO when attaching RBO", "body": "<p>I'm trying to attach a RenderBuffer Object to a FrameBuffer object, and <code>glCheckFramebufferStatus(GL_FRAMEBUFFER)</code> keeps returning me the error code : <code>GL_FRAMEBUFFER_INCOMPLETE_ATTACHMENT</code></p>\n\n<p>(I'm trying attach a DepthBuffer)</p>\n\n<p>Here is my code (simplified):</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>// Create and bind the new FBO (1920x1080)\n\nGLuint gBuffer; \nglGenFramebuffers(1, &amp;gBuffer);\nglBindFramebuffer(GL_FRAMEBUFFER, gBuffer);\n\n\n// Create, initialize, bind and attach the new RBO (purpose : depth buffering)\n\nGLuint rbo;\nglGenRenderbuffers(1, &amp;rbo);\nglRenderbufferStorage(GL_RENDERBUFFER, GL_DEPTH_COMPONENT16, width, height);\nglBindRenderbuffer(GL_RENDERBUFFER, rbo);\nglFramebufferRenderbuffer(GL_FRAMEBUFFER, GL_DEPTH_ATTACHMENT, GL_RENDERBUFFER, rbo);\n\n\n// Create, bind, and initialize, and attach a texture (the FBO's Color Buffer)\n\nGLuint idMap;\nglGenTextures(1, &amp;idMap);\nglBindTexture(GL_TEXTURE_2D, idMap);\nglTexImage2D(GL_TEXTURE_2D, 0, GL_RGB, width, height, 0, GL_RGB, GL_UNSIGNED_BYTE, NULL);\nglFramebufferTexture2D(GL_FRAMEBUFFER, GL_COLOR_ATTACHMENT0, GL_TEXTURE_2D, idMap, 0);\n\nstd::cout &lt;&lt; std::to_string(glCheckFramebufferStatus(GL_FRAMEBUFFER)) &lt;&lt; std::endl; // Gives me 36054 ( incomplete ???)\n\n\n// Re-binding orignal FBO and RBO\n\nglBindFramebuffer(GL_FRAMEBUFFER, 0);\nglBindRenderbuffer(GL_RENDERBUFFER, 0);\n</code></pre>\n\n<p>What am I doing wrong ? </p>\n\n<hr>\n\n<p>Things I noticed</p>\n\n<p>I accidentally wrote </p>\n\n<pre><code>glFramebufferRenderbuffer(GL_FRAMEBUFFER, GL_DEPTH_COMPONENT16, GL_RENDERBUFFER, rbo);\n</code></pre>\n\n<p>Instead of </p>\n\n<pre><code>glFramebufferRenderbuffer(GL_FRAMEBUFFER, GL_DEPTH_ATTACHMENT, GL_RENDERBUFFER, rbo);\n</code></pre>\n\n<p>...And there was no error, but the depth test wasn't working at all. </p>\n\n<p><strong>EDIT : It is simply because <code>GL_DEPTH_ATTACHMENT</code> is necessary to attach the buffer. It was just out of the framebuffer...</strong></p>\n\n<p>When rendering in the FBO, I do :</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>glBindFramebuffer(GL_FRAMEBUFFER, gBuffer); // Use secondary FBO\nglBindRenderbuffer(GL_RENDERBUFFER, rbo);   // Use secondary DepthBuffer\nglDepthMask(GL_TRUE);                       // Allow depth writing\nglEnable(GL_DEPTH_TEST);                    // Enable Depth testing\nglDepthFunc(GL_LESS);                       // Pass if fragment is nearer\nglClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT); // clear color and depth buffers\n\nRender(); \n\nglBindFramebuffer(GL_FRAMEBUFFER, 0);       // Go back to original FBO  \nglBindRenderbuffer(GL_RENDERBUFFER, 0);     // to original Depth Buffer\n\n</code></pre>\n"}, {"tags": ["c++", "multithreading", "language-lawyer", "stdatomic", "data-race"], "comments": [{"owner": {"reputation": 32882, "user_id": 1870760, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/NAAkp.png?s=128&g=1", "display_name": "Hatted Rooster", "link": "https://stackoverflow.com/users/1870760/hatted-rooster"}, "edited": false, "score": 11, "creation_date": 1560969919, "post_id": 56673990, "comment_id": 99915442, "body": "AFAIK the standard doesn&#39;t give you that protection."}, {"owner": {"reputation": 50273, "user_id": 167958, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0defa74609a4ce5d51f2467b69c509be?s=128&d=identicon&r=PG", "display_name": "Omnifarious", "link": "https://stackoverflow.com/users/167958/omnifarious"}, "edited": false, "score": 4, "creation_date": 1560970268, "post_id": 56673990, "comment_id": 99915600, "body": "I do not even fully understand what guarantees you think you&#39;re supposed to get. The wording is convoluted and hard to parse. If you can clarify that, I can write you an answer that explains why you don&#39;t get them in practical terms."}, {"owner": {"reputation": 6260, "user_id": 10933809, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IR53l.jpg?s=128&g=1", "display_name": "Oblivion", "link": "https://stackoverflow.com/users/10933809/oblivion"}, "edited": false, "score": 0, "creation_date": 1560970323, "post_id": 56673990, "comment_id": 99915623, "body": "<code>std::atomic_thread_fence</code> should guarantee the order of read and write but that doesn&#39;t change anything about the race."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "reply_to_user": {"reputation": 50273, "user_id": 167958, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0defa74609a4ce5d51f2467b69c509be?s=128&d=identicon&r=PG", "display_name": "Omnifarious", "link": "https://stackoverflow.com/users/167958/omnifarious"}, "edited": false, "score": 0, "creation_date": 1560971872, "post_id": 56673990, "comment_id": 99916308, "body": "@Omnifarious Ideally a guarantee that the sequence of operations can&#39;t happen so <code>x</code> and <code>y</code> keep their original zero value;"}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1560978118, "post_id": 56673990, "comment_id": 99918803, "body": "The C++ memory model allows value-prediction (which no real hardware does AFAIK), so the <code>y = r1;</code> store really can happen before the load result of <code>r1 = x</code> is ready even if you did use <code>std::atomic</code> with  <code>mo_relaxed</code> to make this code free from data-race UB.  Some models of the famously-weak DEC Alpha really can violate causality for pointed-to data (<code>mo_consume</code>), but not I think for just loading and then storing the load result."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 2, "creation_date": 1560978336, "post_id": 56673990, "comment_id": 99918876, "body": "Oh, and in this case a compiler can easily prove that inside the <code>if(r1 == 42)</code>, it can do <code>y = 42;</code> instead of <code>y = r1;</code> breaking the data dependency.  So normal branch speculation can let the store happen before the load, on a weakly-ordered ISA like ARM or PowerPC.  (Again assuming <code>std::atomic</code> with <code>mo_relaxed</code>, or that the unsafe C was basically transliterated to asm using plain loads/stores, for some particular ISA where we can then reason about that hardware&#39;s memory model.)"}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "reply_to_user": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1560978375, "post_id": 56673990, "comment_id": 99918899, "body": "@PeterCordes What does &quot;violate causality for pointed-to data (mo_consume)&quot; look like?"}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 2, "creation_date": 1560978749, "post_id": 56673990, "comment_id": 99919046, "body": "Like <code>int *p = atomic_load(a_pointer);</code>  <code>int value = atomic_load(p);</code> (but with mo_relaxed, i.e. ordinary asm loads).  Even if the writing thread used barriers to make sure the pointed-to data was globally visible before storing the pointer, the read side could still reorder and read the pointed-to data before reading the pointer (thus ending up with <code>value</code> = old contents of <code>*p</code>).  See also <a href=\"//stackoverflow.com/q/55741148\">Memory order consume usage in C11</a>.  Also Guarantees in <a href=\"https://www.kernel.org/doc/Documentation/memory-barriers.txt\" rel=\"nofollow noreferrer\">kernel.org/doc/Documentation/memory-barriers.txt</a>"}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1569184303, "post_id": 56673990, "comment_id": 102504255, "body": "Update: my earlier comments are kind of off-topic (not wrong, though).  Cross-thread speculation <i>and</i> memory reordering are both needed to make this happen in practice.  And since neither condition <i>should</i> be taken, I think having this happen for non-atomic variables would violate the as-if rule.  I posted an answer to that effect."}, {"owner": {"reputation": 462, "user_id": 5452170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16bfc7d23c7bad37f5832e8e01cf849d?s=128&d=identicon&r=PG&f=1", "display_name": "Xiao-Feng Li", "link": "https://stackoverflow.com/users/5452170/xiao-feng-li"}, "edited": false, "score": 2, "creation_date": 1569876858, "post_id": 56673990, "comment_id": 102731031, "body": "@curiousguy I don&#39;t think the result is allowed. It breaks the fundamental causality relation. The causality relation has nothing to do with any memory model (be it language&#39;s or processors&#39;). It is the basic logic and is the foundation of programming language design. It is the fundamental contract between human and computer. Any memory model should abide by it. Otherwise it is a bug."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "reply_to_user": {"reputation": 462, "user_id": 5452170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16bfc7d23c7bad37f5832e8e01cf849d?s=128&d=identicon&r=PG&f=1", "display_name": "Xiao-Feng Li", "link": "https://stackoverflow.com/users/5452170/xiao-feng-li"}, "edited": false, "score": 0, "creation_date": 1572248588, "post_id": 56673990, "comment_id": 103487770, "body": "@Xiao-FengLi &quot;<i>has nothing to do with any memory model</i>&quot; OK then  1) is specified formally? 2) how does it interact w/ the memory model? 3) can&#39;t a &quot;weak&quot; memory model cause effects that seem to violate &quot;causality&quot;?"}, {"owner": {"reputation": 462, "user_id": 5452170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16bfc7d23c7bad37f5832e8e01cf849d?s=128&d=identicon&r=PG&f=1", "display_name": "Xiao-Feng Li", "link": "https://stackoverflow.com/users/5452170/xiao-feng-li"}, "edited": false, "score": 1, "creation_date": 1572389455, "post_id": 56673990, "comment_id": 103542409, "body": "@curiousguy  the causality here refers to the intra-thread dependence between operations of one thread, such as data dependence (e.g., read after write in same location) and control dependence (e.g., operation in a branch). They cannot be violated by any processor design in its committed result (i.e., externally visible result). Memory model is only about memory operation ordering among multi-processors, they should never violate the intra-thread dependence, although a weak model may allow the causality happening in one processor to be violated (or unseen) in another processor."}, {"owner": {"reputation": 462, "user_id": 5452170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16bfc7d23c7bad37f5832e8e01cf849d?s=128&d=identicon&r=PG&f=1", "display_name": "Xiao-Feng Li", "link": "https://stackoverflow.com/users/5452170/xiao-feng-li"}, "edited": false, "score": 1, "creation_date": 1572389900, "post_id": 56673990, "comment_id": 103542509, "body": "(Cont.) In your code snippet, both threads have (intra-thread) data dependence (load-&gt;check) and control dependence (check-&gt;store) that ensure their respective executions (in one thread) are ordered. That means, we can check the later op&#39;s output to determine if the earlier op has executed. Then we can use simple logic to deduce that, if both r1 and r2 are 42, there must be a dependence cycle, which is impossible, unless you remove the condition checks, which essentially removes the dependence. This has nothing to do with memory model, but intra-thread data dependence."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "reply_to_user": {"reputation": 462, "user_id": 5452170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16bfc7d23c7bad37f5832e8e01cf849d?s=128&d=identicon&r=PG&f=1", "display_name": "Xiao-Feng Li", "link": "https://stackoverflow.com/users/5452170/xiao-feng-li"}, "edited": false, "score": 0, "creation_date": 1574375319, "post_id": 56673990, "comment_id": 104221944, "body": "@Xiao-FengLi That causality requirement seems to be elementary, but is it plainly written in the C++ std?"}, {"owner": {"reputation": 462, "user_id": 5452170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16bfc7d23c7bad37f5832e8e01cf849d?s=128&d=identicon&r=PG&f=1", "display_name": "Xiao-Feng Li", "link": "https://stackoverflow.com/users/5452170/xiao-feng-li"}, "edited": false, "score": 0, "creation_date": 1574491191, "post_id": 56673990, "comment_id": 104259860, "body": "@curiousguy Causality (or more accurately, dependence here) is defined in C++ std, but not so explicitly, because dependence is more of micro-architecture and compiler terminology.  In language spec, it is usually defined using terms like &quot;name scope&quot;, &quot;if statement&quot;, etc, to define the operational semantics. The semantics implicitly satisfies the causality. For example, the control dependence formed by &quot;if statement&quot; is defined in <a href=\"https://timsong-cpp.github.io/cppwp/n3337/stmt.if\" rel=\"nofollow noreferrer\">timsong-cpp.github.io/cppwp/n3337/stmt.if</a>, &quot;If the condition yields true the first substatement is executed. &quot;"}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "reply_to_user": {"reputation": 462, "user_id": 5452170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16bfc7d23c7bad37f5832e8e01cf849d?s=128&d=identicon&r=PG&f=1", "display_name": "Xiao-Feng Li", "link": "https://stackoverflow.com/users/5452170/xiao-feng-li"}, "edited": false, "score": 0, "creation_date": 1574517467, "post_id": 56673990, "comment_id": 104264966, "body": "@Xiao-FengLi That you seem to imply that a read inside a then clause can&#39;t be executed before the condition is true."}, {"owner": {"reputation": 462, "user_id": 5452170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16bfc7d23c7bad37f5832e8e01cf849d?s=128&d=identicon&r=PG&f=1", "display_name": "Xiao-Feng Li", "link": "https://stackoverflow.com/users/5452170/xiao-feng-li"}, "edited": false, "score": 0, "creation_date": 1574528416, "post_id": 56673990, "comment_id": 104268033, "body": "@curiousguy Yes, that is the semantics requirement. That said, the compiler and processor can schedule one or more operations of the if-branch to be executed before the if-condition is resolved.  But no matter how the compiler and processor schedule the operations, the result of the if-branch cannot be committed (i.e., become visible to the program) before the if-condition is resolved. One should distinguish between semantics requirement and implementation details. One is language spec, the other is how the compiler and processor implement the language spec."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "reply_to_user": {"reputation": 462, "user_id": 5452170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16bfc7d23c7bad37f5832e8e01cf849d?s=128&d=identicon&r=PG&f=1", "display_name": "Xiao-Feng Li", "link": "https://stackoverflow.com/users/5452170/xiao-feng-li"}, "edited": false, "score": 0, "creation_date": 1574528696, "post_id": 56673990, "comment_id": 104268132, "body": "@Xiao-FengLi So in <code>if (a.load(relaxed)) { r = b.load(relaxed); acquire_fence(); c.store(r,relaxed); }</code> the value of <code>b</code> can&#39;t be loaded before the value of <code>a</code>, or if it is, the read must be cancelled if <code>a</code> is <code>true</code> so that the incorrect value in <code>r</code> isn&#39;t written to <code>c</code>?"}, {"owner": {"reputation": 462, "user_id": 5452170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16bfc7d23c7bad37f5832e8e01cf849d?s=128&d=identicon&r=PG&f=1", "display_name": "Xiao-Feng Li", "link": "https://stackoverflow.com/users/5452170/xiao-feng-li"}, "edited": false, "score": 0, "creation_date": 1574530635, "post_id": 56673990, "comment_id": 104268735, "body": "@curiousguy The compiler/processor may load <code>b</code> before <code>a</code>&#39;s value is resolved - because both <code>a</code> and <code>b</code> are relaxed atomics. But <code>b</code>&#39;s value cannot be written to <code>r</code> before the true branch is taken. That is, the value of <code>b</code> is speculatively loaded. The loading itself is useless - in this context. Actually with relaxed order, <code>b</code>&#39;s value can even be loaded ahead of <code>a</code>&#39;s value - but still it cannot be stored into <code>r</code>. If there is a <code>fence</code> before <code>b</code>&#39;s loading, then it cannot be loaded before <code>a</code>&#39;s loading, but this is where the memory model kicks in."}, {"owner": {"reputation": 462, "user_id": 5452170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16bfc7d23c7bad37f5832e8e01cf849d?s=128&d=identicon&r=PG&f=1", "display_name": "Xiao-Feng Li", "link": "https://stackoverflow.com/users/5452170/xiao-feng-li"}, "edited": false, "score": 0, "creation_date": 1574531626, "post_id": 56673990, "comment_id": 104269011, "body": "@curiousguy What you described is largely correct but that, &quot;loading of <code>b</code>&quot; is not the same as &quot;writing of <code>r</code>&quot;, because <code>r</code> is program visible. Writing to <code>r</code> means the result of speculative loading <code>b</code> is committed. The compiler/processor may write <code>b</code>&#39;s value to somewhere temporarily and internally in the system, but not <code>r</code>."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "reply_to_user": {"reputation": 462, "user_id": 5452170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16bfc7d23c7bad37f5832e8e01cf849d?s=128&d=identicon&r=PG&f=1", "display_name": "Xiao-Feng Li", "link": "https://stackoverflow.com/users/5452170/xiao-feng-li"}, "edited": false, "score": 0, "creation_date": 1574534461, "post_id": 56673990, "comment_id": 104269818, "body": "@Xiao-FengLi Even with relaxed loads?"}, {"owner": {"reputation": 462, "user_id": 5452170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16bfc7d23c7bad37f5832e8e01cf849d?s=128&d=identicon&r=PG&f=1", "display_name": "Xiao-Feng Li", "link": "https://stackoverflow.com/users/5452170/xiao-feng-li"}, "edited": false, "score": 0, "creation_date": 1574535391, "post_id": 56673990, "comment_id": 104270088, "body": "@curiousguy Would you please clarify your question a little bit? I don&#39;t know which of my statements you are referring to."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1574545645, "post_id": 56673990, "comment_id": 104272758, "body": "@curiousguy: updated my answer with more evidence from later standards that out-of-thin-air values are intended to be disallowed, but the formalism fails to do that so they added a note.  Later standards word it more clearly.  Your question is worded confusingly because your examples don&#39;t actually contain a data race.  They would if out-of-thin-air values were allowed, so the question is what protects you from out-of-thin-air values, not what protects you from data races.  <b>My answer reconciles that mo_relaxed note/example with sane non-atomic behaviour.</b>  I&#39;d suggest accepting it."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "reply_to_user": {"reputation": 462, "user_id": 5452170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16bfc7d23c7bad37f5832e8e01cf849d?s=128&d=identicon&r=PG&f=1", "display_name": "Xiao-Feng Li", "link": "https://stackoverflow.com/users/5452170/xiao-feng-li"}, "edited": false, "score": 0, "creation_date": 1574548528, "post_id": 56673990, "comment_id": 104273386, "body": "@Xiao-FengLi &quot;<i>The compiler/processor may write b&#39;s value to somewhere temporarily and internally in the system, but not r.</i>&quot; Even w/ the use of a relaxed load, the CPU can&#39;t do that?"}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "reply_to_user": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1574548888, "post_id": 56673990, "comment_id": 104273451, "body": "@PeterCordes The example contains a race if ... it contains a race, allowing other values then the one in the past to be read. Also I don&#39;t think there is a universally accepted definition for &quot;out-of-thin-air values&quot; (although some things are universally considered out-of-thin-air), like there is maybe no universal definition of what counts as a German shepherd (or a chihuahua) but no one calls a chihuahua what others call a German shepherd."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1574549406, "post_id": 56673990, "comment_id": 104273551, "body": "Anything that&#39;s less obviously &quot;out-of-thin-air&quot; would be potential data-race UB from an assignment unsynchronized with a load.  So I don&#39;t think there&#39;d be any case where you could say that a result was because of an out-of-thin-air value and that data-race UB definitely didn&#39;t happen.  (I&#39;m assuming that doing some actual stores to the objects would be necessary to &quot;prime&quot; value-prediction, along with cross-thread mutually-confirming speculation.)"}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1574549435, "post_id": 56673990, "comment_id": 104273557, "body": "Speaking of definitions, cross-thread mutually-confirming speculation is required (I think) for this on CPUs anything like what we&#39;re used to.  That&#39;s a pretty clear demarcation."}, {"owner": {"reputation": 462, "user_id": 5452170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16bfc7d23c7bad37f5832e8e01cf849d?s=128&d=identicon&r=PG&f=1", "display_name": "Xiao-Feng Li", "link": "https://stackoverflow.com/users/5452170/xiao-feng-li"}, "edited": false, "score": 0, "creation_date": 1574549592, "post_id": 56673990, "comment_id": 104273578, "body": "@curiousguy Writing into <code>r</code> here means to cause effect in the system that the program can see and use. No matter how relaxed the memory model it is, the value of new <code>r</code> should never be seen by the program before the if-condition is resolved. This has nothing to do with memory model, as evidenced by the fact that the code you gave is just single-threaded. It is very easy to mix these two concepts (dependence vs. memory order). OTOH, if we really want to say <code>r</code> can be written before the if-condition is resolved, it is fine - as long as <code>r</code>&#39;s value is not seen/used by the program."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 2, "creation_date": 1574562619, "post_id": 56673990, "comment_id": 104275693, "body": "I rephrased your question significantly to avoid the confusion that led to the existing answers and the upvotes on them.  At the time they looked correct to me, too.  Only after carefully looking at the example was it clear that this wasn&#39;t obviously broken."}, {"owner": {"reputation": 1397, "user_id": 3525027, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/MpqEO.jpg?s=128&g=1", "display_name": "Daniel Nitzan", "link": "https://stackoverflow.com/users/3525027/daniel-nitzan"}, "reply_to_user": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1614422481, "post_id": 56673990, "comment_id": 117384210, "body": "@PeterCordes &quot;<i>a compiler can easily prove that inside the if(r1 == 42), it can do y = 42; instead of y = r1; breaking the data dependency. So normal branch speculation can let the store happen before the load, on a weakly-ordered ISA</i>&quot; but it&#39;s not allowed to make speculative stores visible to other threads? <code>r1 = x</code> and <code>y = 42</code> can be <i>executed</i> out of order but never <i>retire</i> out of order, not even on a weak ISA? <a href=\"https://www.cl.cam.ac.uk/~pes20/cpp/notes42.html#example-lbctrldatactrl-single-language-could-and-should-forbid\" rel=\"nofollow noreferrer\">Reference here</a>"}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 1397, "user_id": 3525027, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/MpqEO.jpg?s=128&g=1", "display_name": "Daniel Nitzan", "link": "https://stackoverflow.com/users/3525027/daniel-nitzan"}, "edited": false, "score": 0, "creation_date": 1614425329, "post_id": 56673990, "comment_id": 117384930, "body": "@DanielNitzan: That&#39;s correct, but it still means the store value isn&#39;t dependency-ordered after the load.  Loads interact with global state when they execute, not when they retire.  (However, stores can&#39;t become globally visible until after retirement, and the load + branch must execute before retirement.  But if this thread reloads <code>y</code>, it can see its own store before it becomes globally visible (store forwarding).  So maybe a better example could be cooked up, but there&#39;s some effect here I think?  I&#39;d have to look at it again more carefully)"}, {"owner": {"reputation": 1397, "user_id": 3525027, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/MpqEO.jpg?s=128&g=1", "display_name": "Daniel Nitzan", "link": "https://stackoverflow.com/users/3525027/daniel-nitzan"}, "reply_to_user": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1614427633, "post_id": 56673990, "comment_id": 117385485, "body": "@PeterCordes to be fair, I&#39;ve written the previous comment before reading your answer, especially the section about a hypothetical SMT cross-thread speculation architecture that can actually reproduce such a scenario (but would break the no-UB for DRF guarantee of C++). Also, there seems to have been a confusion around the original question that had led to confusing comments."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 1397, "user_id": 3525027, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/MpqEO.jpg?s=128&g=1", "display_name": "Daniel Nitzan", "link": "https://stackoverflow.com/users/3525027/daniel-nitzan"}, "edited": false, "score": 0, "creation_date": 1614428068, "post_id": 56673990, "comment_id": 117385583, "body": "@DanielNitzan: right, yeah, cross-confirming speculation would break the <code>if (global_id == mine) shared_var = 123;</code> example I argued is legal in my answer.  Unless implementations work around it by using anti-speculation barriers every time they load and/or store non-atomic vars, with only <code>mo_relaxed</code> exposing the underlying DeathStation 9000 creatively terrible hardware behaviour. Hypothetical implementations don&#39;t have to be efficient at all, let alone commercially viable. :P Not that we needed to invent one, since we don&#39;t <i>want</i> an impl like this to exist, and ISO C++ says it shouldn&#39;t :/"}, {"owner": {"reputation": 1397, "user_id": 3525027, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/MpqEO.jpg?s=128&g=1", "display_name": "Daniel Nitzan", "link": "https://stackoverflow.com/users/3525027/daniel-nitzan"}, "reply_to_user": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1614428454, "post_id": 56673990, "comment_id": 117385693, "body": "@PeterCordes LOL"}], "answers": [{"comments": [{"owner": {"reputation": 50273, "user_id": 167958, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0defa74609a4ce5d51f2467b69c509be?s=128&d=identicon&r=PG", "display_name": "Omnifarious", "link": "https://stackoverflow.com/users/167958/omnifarious"}, "edited": false, "score": 1, "creation_date": 1560970677, "post_id": 56674147, "comment_id": 99915775, "body": "That special case is basically grandfathered in from C90 with the language updated."}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "reply_to_user": {"reputation": 50273, "user_id": 167958, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0defa74609a4ce5d51f2467b69c509be?s=128&d=identicon&r=PG", "display_name": "Omnifarious", "link": "https://stackoverflow.com/users/167958/omnifarious"}, "edited": false, "score": 3, "creation_date": 1560970867, "post_id": 56674147, "comment_id": 99915861, "body": "@Omnifarious and is pretty much the only portable way of communicating between a signal handler and rest of the program."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1560972362, "post_id": 56674147, "comment_id": 99916528, "body": "Does that meant that almost all programs are actually broken?"}, {"owner": {"reputation": 19619, "user_id": 4151599, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dpkLj.jpg?s=128&g=1", "display_name": "Miles Budnek", "link": "https://stackoverflow.com/users/4151599/miles-budnek"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 3, "creation_date": 1560973537, "post_id": 56674147, "comment_id": 99916999, "body": "@curiousguy Most multithreaded programs use a mutexes or other synchronization primitives (or <code>std::atomic</code> types) to protect shared data.  If you don&#39;t then yes, your program is broken."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "reply_to_user": {"reputation": 19619, "user_id": 4151599, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dpkLj.jpg?s=128&g=1", "display_name": "Miles Budnek", "link": "https://stackoverflow.com/users/4151599/miles-budnek"}, "edited": false, "score": 0, "creation_date": 1560974688, "post_id": 56674147, "comment_id": 99917474, "body": "@MilesBudnek MT programs typically use mutexes for code like the one in the question?"}, {"owner": {"reputation": 50273, "user_id": 167958, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0defa74609a4ce5d51f2467b69c509be?s=128&d=identicon&r=PG", "display_name": "Omnifarious", "link": "https://stackoverflow.com/users/167958/omnifarious"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 1, "creation_date": 1560975984, "post_id": 56674147, "comment_id": 99918006, "body": "@curiousguy - If <code>x</code> and <code>y</code> are truly the same piece of memory being accessed by more than one thread, then often they will, yes. Some very carefully written code for lock-free data structures will use multiple atomic variables in very specific ways without using mutexes. But that is very tricky code to write and get correct. In this particular case, if your main concerns is that if both <code>x</code> and <code>y</code> are <code>0</code> before either thread enters, that they both stay <code>0</code>, you could probably just use atomics and the more constrained memory orders."}, {"owner": {"reputation": 2640, "user_id": 5195699, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f85291bb71f55981b1d412f1efcb7603?s=128&d=identicon&r=PG&f=1", "display_name": "R_Kapp", "link": "https://stackoverflow.com/users/5195699/r-kapp"}, "edited": false, "score": 7, "creation_date": 1560976029, "post_id": 56674147, "comment_id": 99918021, "body": "Minor note: <a href=\"https://stackoverflow.com/questions/11276259/are-data-races-and-race-condition-actually-the-same-thing-in-context-of-conc\">data races and race conditions are not the same thing</a>. Data races are undefined behavior, race conditions are not. In the case of a race condition, the order specific commands occur in is unspecified (leading to (potentially) different results on different runs), but the behavior is indeed defined."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1574554645, "post_id": 56674147, "comment_id": 104274547, "body": "Downvoted for not answering the part of the question shown in the examples, only the clumsy wording.  If you want to undo Nathan&#39;s roll back to re-add my edit, or find a less clumsy way of making the same change, I&#39;d be happy to undo the downvote.  Neither example contains data-race UB, most obviously the 2nd one which uses <code>atomic&lt;T&gt;</code>"}], "tags": [], "owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "is_accepted": false, "score": 8, "last_activity_date": 1574554057, "last_edit_date": 1592644375, "creation_date": 1560970332, "answer_id": 56674147, "question_id": 56673990, "link": "https://stackoverflow.com/questions/56673990/what-formally-guarantees-that-non-atomic-variables-cant-see-out-of-thin-air-val/56674147#56674147", "title": "What formally guarantees that non-atomic variables can&#39;t see out-of-thin-air values and create a data race like atomic relaxed theoretically can?", "body": "<blockquote>\n<p>When a race condition potentially exists, what guarantees that a read of a shared variable (normal, non atomic) cannot see a write</p>\n</blockquote>\n<p>There is no such guarantee.</p>\n<p>When race condition exists, the behaviour of the program is undefined:</p>\n<blockquote>\n<p>[intro.races]</p>\n<p>Two actions are potentially concurrent if</p>\n<ul>\n<li>they are performed by different threads, or</li>\n<li>they are unsequenced, at least one is performed by a signal handler, and they are not both performed by the same signal handler invocation.</li>\n</ul>\n<p>The execution of a program contains a data race if it contains two potentially concurrent conflicting actions, at least one of which is not atomic, and neither happens before the other, except for the special case for signal handlers described below. <strong>Any such data race results in undefined behavior</strong>. ...</p>\n</blockquote>\n<p>The <em>special case</em> is not very relevant to the question, but I'll include it for completeness:</p>\n<blockquote>\n<p>Two accesses to the same object of type <code>volatile std::sig_\u00adatomic_\u00adt</code> do not result in a data race if both occur in the same thread, even if one or more occurs in a signal handler. ...</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1560972680, "post_id": 56674166, "comment_id": 99916642, "body": "If that&#39;s the case, I can&#39;t imagine any real world MT program being correct"}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 2, "creation_date": 1560972889, "post_id": 56674166, "comment_id": 99916723, "body": "@curiousguy As long as you use sequentially consistent mode you are guaranteed to have a single total order of your code.  This is offered by C++ so it is perfectly capable of writing multi-threaded code that is 100% portable and guaranteed."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1560972917, "post_id": 56674166, "comment_id": 99916735, "body": "How do I activate that &quot;mode&quot;?"}, {"owner": {"reputation": 50273, "user_id": 167958, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0defa74609a4ce5d51f2467b69c509be?s=128&d=identicon&r=PG", "display_name": "Omnifarious", "link": "https://stackoverflow.com/users/167958/omnifarious"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 1, "creation_date": 1560972917, "post_id": 56674166, "comment_id": 99916736, "body": "@curiousguy - Well, that&#39;s not true at all. There&#39;s a reason the standard added atomics and thread synchronization primitives to the language. If you use them, you get guarantees that ordinarily wouldn&#39;t apply at all."}, {"owner": {"reputation": 50273, "user_id": 167958, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0defa74609a4ce5d51f2467b69c509be?s=128&d=identicon&r=PG", "display_name": "Omnifarious", "link": "https://stackoverflow.com/users/167958/omnifarious"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 2, "creation_date": 1560972994, "post_id": 56674166, "comment_id": 99916766, "body": "@curiousguy - Use <code>memory_order_seq_cst</code> instead of <code>memory_order_relaxed</code>."}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 2, "creation_date": 1560973040, "post_id": 56674166, "comment_id": 99916780, "body": "@curiousguy Generally by just using the defaults.  If you have a <code>std::atomic&lt;int&gt;</code> for example and you do <code>++name_of_atomic_int</code> in multiple threads it is guaranteed that the result will be correct since by default the operators are sequentially consistent."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1560973421, "post_id": 56674166, "comment_id": 99916953, "body": "@NathanOliver For a store you can use <code>memory_order_seq_cst</code> but what about the destructor?"}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1560973594, "post_id": 56674166, "comment_id": 99917023, "body": "@curiousguy Two threads won&#39;t both try to destroy an atomic. If they do, you have a larger problem. It&#39;s the same as if two threads tried to both destroy anything else."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "reply_to_user": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1560973675, "post_id": 56674166, "comment_id": 99917055, "body": "@Fran&#231;oisAndrieux If only one thread is destroying an object, you don&#39;t have an issue, but if only one thread is writing to an object, you have one?"}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "reply_to_user": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1560973902, "post_id": 56674166, "comment_id": 99917160, "body": "@Fran&#231;oisAndrieux But in my question, only one thread is writing to each variable."}, {"owner": {"reputation": 50273, "user_id": 167958, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0defa74609a4ce5d51f2467b69c509be?s=128&d=identicon&r=PG", "display_name": "Omnifarious", "link": "https://stackoverflow.com/users/167958/omnifarious"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 6, "creation_date": 1560974311, "post_id": 56674166, "comment_id": 99917320, "body": "@curiousguy - I think you&#39;re tying yourself in knots trying to wrap your head around some complex ideas. Instead of trying to come up with some top-down understanding of things, try out a few very specific examples (ideally code that can actually run). Maybe post them on SO and ask what the expected behavior is. Build your understanding from the bottom up until it clicks."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 2, "creation_date": 1560974402, "post_id": 56674166, "comment_id": 99917352, "body": "@curiousguy No. If you have one thread destroying the object, it&#39;s fine. If you have two threads trying to destroy the object, it&#39;s not fine. But this is not a multithreading issue. It&#39;s just as bad as if you had a single thread try to destroy the object twice."}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 2, "creation_date": 1560974490, "post_id": 56674166, "comment_id": 99917391, "body": "@curiousguy You can&#39;t have an object shared by multiple threads that would be destroyed by both threads.  If it is a global it is destroyed at the end of the program.  If it is passed by reference, then it is destroyed by the call site, not the threads.  If you pass a <code>shared_ptr</code> to the threads then once they end they destroy their own copy of the <code>shared_ptr</code> and <code>shared_ptr</code> uses atomic reference counting to determine when it should destroy the pointed to object."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "reply_to_user": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1560975021, "post_id": 56674166, "comment_id": 99917600, "body": "@Fran&#231;oisAndrieux If you have one thread trying to destroy an object and the other might use (not destroy) the object, then what precaution should you use?"}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 2, "creation_date": 1560975091, "post_id": 56674166, "comment_id": 99917629, "body": "@curiousguy That is what <code>std::shared_ptr</code> is for.  It allows two or more things to share ownership and will only destroy the pointed to object once all <code>shared_ptr</code> are destroyed."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1560977800, "post_id": 56674166, "comment_id": 99918688, "body": "@NathanOliver Yes but that&#39;s essentially pushing the problem to the implementer. How can the C++ code of a smart ptr ensure correct sequential behavior? If all operations on an atomic object must be <code>memory_order_seq_cst</code>, how does <code>std::shared_ptr</code> ensure same destruction? Is the destruction <code>memory_order_seq_cst</code>?"}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 2, "creation_date": 1560978187, "post_id": 56674166, "comment_id": 99918832, "body": "@curiousguy Yes.  The C++ standard mandates that <code>shared_ptr</code> does the right thing.  You don&#39;t need to worry about it."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1560978272, "post_id": 56674166, "comment_id": 99918856, "body": "@NathanOliver I need to worry in order to understand how to ever write correct code. Do I need to use <code>memory_order_seq_cst</code> in the destructor of the object managed by <code>std::shared_ptr</code>?"}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 4, "creation_date": 1560978739, "post_id": 56674166, "comment_id": 99919042, "body": "@curiousguy No.  <code>shared_ptr</code> handles all of this behind the scenes for you.  It use an atomic reference counter to keep track of how man instances there are.  The destructor checks the reference count and if it is more than one it just atomically decreases it by one.  If the reference counter is at one, then the destructor knows it is the only object that owns the pointer so it deletes the pointer it holds."}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1560979021, "post_id": 56674166, "comment_id": 99919128, "body": "@curiousguy If you really want to understand multi-threaded code in C++ I would suggest getting a book dedicated to that like <a href=\"https://rads.stackoverflow.com/amzn/click/com/1933988770\" rel=\"nofollow noreferrer\" rel=\"nofollow noreferrer\">this one</a>.  It can do a much better job of building a solid foundation than we can."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1569092599, "post_id": 56674166, "comment_id": 102486798, "body": "@NathanOliver &quot;<i>As long as you use sequentially consistent mode you are guaranteed to have a single total order of your code</i>&quot; If you only ever use atomics, yes. But then, you can&#39;t even have polymorphism! (Calling a ctor isn&#39;t atomic.)"}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1574554541, "post_id": 56674166, "comment_id": 104274533, "body": "In the second example (quoted from the ISO C++ standard, C++14 I think), the only shared variables are <code>atomic&lt;T&gt;</code>.  There is no data-race UB, and in general unsynchronized access to atomic variables is only maybe a garden variety logic bug, not UB.  Sorry about the mess my edits left your answer in (I made the first one before I understood the question as being about out-of-thin-air values), but this state is even worse than the state after my last edit, IMO.  Going to have to downvote for making incorrect claims about these specific examples."}], "tags": [], "owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "is_accepted": false, "score": 5, "last_activity_date": 1574554110, "last_edit_date": 1574554110, "creation_date": 1560970459, "answer_id": 56674166, "question_id": 56673990, "link": "https://stackoverflow.com/questions/56673990/what-formally-guarantees-that-non-atomic-variables-cant-see-out-of-thin-air-val/56674166#56674166", "title": "What formally guarantees that non-atomic variables can&#39;t see out-of-thin-air values and create a data race like atomic relaxed theoretically can?", "body": "<blockquote>\n  <p>What part of the so called \"memory model\" protects non atomic objects from these interactions caused by reads that see the interaction?</p>\n</blockquote>\n\n<p>None.  In fact, you get the opposite and the standard explicitly calls this out as undefined behavior.  In <a href=\"https://timsong-cpp.github.io/cppwp/intro.races#21\" rel=\"nofollow noreferrer\">[intro.races]\\21</a> we have</p>\n\n<blockquote>\n  <p>The execution of a program contains a data race if it contains two potentially concurrent conflicting actions, at least one of which is not atomic, and neither happens before the other, except for the special case for signal handlers described below. Any such data race results in undefined behavior.</p>\n</blockquote>\n\n<p>which covers your second example.</p>\n\n<hr>\n\n<p>The rule is that if you have shared data in multiple threads, and at least one of those threads write to that shared data, then you need synchronization.  Without that you have a data race and undefined behavior.  Do note that <code>volatile</code> is not a valid synchronization mechanism.  You need atomics/mutexs/condition variables to protect shared access.</p>\n"}, {"comments": [{"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1560980011, "post_id": 56674620, "comment_id": 99919464, "body": "&quot;<i>The compiler would generally be allowed to completely get rid of any reference to x and y at all</i>&quot; how so? &quot;<i>if they weren&#39;t atomic.</i>&quot; What is they are, then the compiler can&#39;t &quot;completely get rid&quot; of atomic variables?"}, {"owner": {"reputation": 50273, "user_id": 167958, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0defa74609a4ce5d51f2467b69c509be?s=128&d=identicon&r=PG", "display_name": "Omnifarious", "link": "https://stackoverflow.com/users/167958/omnifarious"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1560981595, "post_id": 56674620, "comment_id": 99919925, "body": "@curiousguy - No, the compiler cannot elide operations on atomic variables out of existence. Though if the atomic variables are local and the compiler can prove they are never shared, it can get rid of the variables completely. Non atomic variables that are shared (like they&#39;re global, or you&#39;ve given a pointer to them to someone or something) can&#39;t be gotten rid of either. But any access to them can be removed as long as the final result looks <i>as if</i> the code your wrote is what was executed. That is not true for atomic variables. All accesses you put in the code must appear in the assembly."}, {"owner": {"reputation": 50273, "user_id": 167958, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0defa74609a4ce5d51f2467b69c509be?s=128&d=identicon&r=PG", "display_name": "Omnifarious", "link": "https://stackoverflow.com/users/167958/omnifarious"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1560981650, "post_id": 56674620, "comment_id": 99919944, "body": "@curiousguy - Of course, that &#39;no eliding accesses&#39; rule is also true for <code>volatile</code> variables. But atomic variables have a few more constraints (like the cache line boundary constraint) that volatile variables don&#39;t."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1560981991, "post_id": 56674620, "comment_id": 99920041, "body": "&quot;<i>All accesses you put in the code must appear in the assembly.</i>&quot; Why exactly?"}, {"owner": {"reputation": 50273, "user_id": 167958, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0defa74609a4ce5d51f2467b69c509be?s=128&d=identicon&r=PG", "display_name": "Omnifarious", "link": "https://stackoverflow.com/users/167958/omnifarious"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1560982731, "post_id": 56674620, "comment_id": 99920217, "body": "@curiousguy - I think I&#39;m wrong about that actually. It <i>is</i> true for <code>volatile</code>. That&#39;s the rule there. For atomics it&#39;s more complicated. The memory orders you use dictate exactly which access may be elided. If you use sequential access, none of them may be. The semantics dictate that. It&#39;s because <code>memory_order_seq_cst</code> requires that the value you write be visible to all other threads that might read with <code>memory_order_acquire</code> or higher. And similarly, any read with <code>memory_order_seq_cst</code> must pick up any value written by another thread with <code>memory_order_release</code> or higher."}, {"owner": {"reputation": 50273, "user_id": 167958, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0defa74609a4ce5d51f2467b69c509be?s=128&d=identicon&r=PG", "display_name": "Omnifarious", "link": "https://stackoverflow.com/users/167958/omnifarious"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1560982901, "post_id": 56674620, "comment_id": 99920266, "body": "@curiousguy - For <code>memory_order_relaxed</code> accesses may be freely reordered or even elided. The only requirement is that any actual read or write must write or read the entire value and may not read or write a partial value."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 4, "creation_date": 1560998846, "post_id": 56674620, "comment_id": 99923115, "body": "@curiousguy and Omni: ISO C++11/14/17 as written <i>allows</i> compilers to optimize away multiple back-to-back atomic stores, but current compilers <i>choose not to do so</i> (treating them like <code>volatile atomic</code>) because there&#39;s no obvious way to do that without possibly doing things we <i>don&#39;t</i> want, like collapsing all the stores to update a progress bar counter into one at the end.  See <a href=\"//stackoverflow.com/q/45960387\">Why don&#39;t compilers merge redundant std::atomic writes?</a> for details on current compilers and standards discussion / ideas."}, {"owner": {"reputation": 50273, "user_id": 167958, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0defa74609a4ce5d51f2467b69c509be?s=128&d=identicon&r=PG", "display_name": "Omnifarious", "link": "https://stackoverflow.com/users/167958/omnifarious"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1561074583, "post_id": 56674620, "comment_id": 99955382, "body": "@curiousguy - You might find this question interesting - <a href=\"https://stackoverflow.com/questions/12346487/what-do-each-memory-order-mean\" title=\"what do each memory order mean\">stackoverflow.com/questions/12346487/&hellip;</a>"}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 1, "creation_date": 1569127546, "post_id": 56674620, "comment_id": 102491751, "body": "The mechanism you propose (doing <code>y=42</code> and then conditionally setting it back to the old value) is not generally legal.  Compilers can&#39;t invent writes along paths that don&#39;t (in the C++ abstract machine) write <code>y</code> at all.  That would introduce correctness problems if it turned out this thread shouldn&#39;t have written <code>y</code> and another thread was writing <code>y</code> at the same time.  (@curiousguy we were talking about this problem in comments on <a href=\"https://stackoverflow.com/questions/40320254\">another thread</a>).  IDK if value-prediction for loads + other crazy stuff could allow it on a hypothetical ISA."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1569183920, "post_id": 56674620, "comment_id": 102504173, "body": "Update: posted an answer.  I don&#39;t think r1=r2=42 is allowed for non-atomic variables.  There&#39;s no UB in the C++ abstract machine: given those starting x and y values, neither thread writes x or y.  Code that doesn&#39;t write a variable isn&#39;t allowed to disturb what other threads read from it, even if it conditionally might have."}, {"owner": {"reputation": 462, "user_id": 5452170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16bfc7d23c7bad37f5832e8e01cf849d?s=128&d=identicon&r=PG&f=1", "display_name": "Xiao-Feng Li", "link": "https://stackoverflow.com/users/5452170/xiao-feng-li"}, "reply_to_user": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 2, "creation_date": 1569876331, "post_id": 56674620, "comment_id": 102730840, "body": "@PeterCordes Yes. This answer is incorrect in that, it exposes the possible processor&#39;s &quot;internal&quot; speculative operation state to the program and assumes the compiler can do the same thing. Processor&#39;s internal state should be hidden from the program execution result, and should never be visible, let alone be &quot;implemented&quot; by the compiler. If they do, it is a bug no mater it is introduced by the processor design or the compiler implementation."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1571779653, "post_id": 56674620, "comment_id": 103352443, "body": "@Omnifarious: software speculation <i>is</i> allowed in some cases.  e.g. if <code>y</code> was already unconditionally written with one value or another, e.g. <code>y = condition ? a : b;</code> could be compiled to <code>y=b;</code> then a conditional store of <code>b</code> if a compiler wanted to.  But like I commented earlier, inventing writes to objects that <i>aren&#39;t</i> written along the correct path of execution is not legal."}], "tags": [], "owner": {"reputation": 50273, "user_id": 167958, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0defa74609a4ce5d51f2467b69c509be?s=128&d=identicon&r=PG", "display_name": "Omnifarious", "link": "https://stackoverflow.com/users/167958/omnifarious"}, "is_accepted": false, "score": 2, "last_activity_date": 1571881197, "last_edit_date": 1571881197, "creation_date": 1560972478, "answer_id": 56674620, "question_id": 56673990, "link": "https://stackoverflow.com/questions/56673990/what-formally-guarantees-that-non-atomic-variables-cant-see-out-of-thin-air-val/56674620#56674620", "title": "What formally guarantees that non-atomic variables can&#39;t see out-of-thin-air values and create a data race like atomic relaxed theoretically can?", "body": "<p><strong>Note:</strong> The specific examples I give here are apparently not accurate. I've assumed the optimizer can be somewhat more aggressive than it's apparently allowed to be. There is <a href=\"https://stackoverflow.com/questions/56673990/what-formally-guarantees-that-reads-dont-see-a-write-with-race-condition-in-o/56674620#comment103352443_56674620\">some excellent discussion about this in the comments</a>. I'm going to have to investigate this further, but wanted to leave this note here as a warning.</p>\n\n<p>Other people have given you answers quoting the appropriate parts of the standard that flat out state that the guarantee you think exists, doesn't. It appears that you're interpreting a part of the standard that says a certain weird behavior is permitted for atomic objects if you use <code>memory_order_relaxed</code> as meaning that this behavior is not permitted for non-atomic objects. This is a leap of inference that is explicitly addressed by other parts of the standard that declare the behavior undefined for non-atomic objects.</p>\n\n<p>In practical terms, here is an order of events that might happen in thread 1 that would be perfectly reasonable, but result in the behavior you think is barred even if the hardware guaranteed that all memory access was completely serialized between CPUs. Keep in mind that the standard has to not only take into account the behavior of the hardware, but the behavior of optimizers, which often aggressively re-order and re-write code.</p>\n\n<p>Thread 1 could be re-written by an optimizer to look this way:</p>\n\n<pre><code>old_y = y; // old_y is a hidden variable (perhaps a register) created by the optimizer\ny = 42;\nif (x != 42) y = old_y;\n</code></pre>\n\n<p>There might be perfectly reasonable reasons for an optimizer to do this. For example, it may decide that it's far more likely than not for <code>42</code> to be written into <code>y</code>, and for dependency reasons, the pipeline might work a lot better if the store into <code>y</code> occurs sooner rather than later.</p>\n\n<p>The rule is that the apparent result must look <em>as if</em> the code you wrote is what was executed. But there is no requirement that the code you write bears any resemblance at all to what the CPU is actually told to do.</p>\n\n<p>The atomic variables impose constraints on the ability of the compiler to re-write code as well as instructing the compiler to issue special CPU instructions that impose constraints on the ability of the CPU to re-order memory accesses. The constraints involving <code>memory_order_relaxed</code> are much stronger than what is ordinarily allowed. The compiler would generally be allowed to completely get rid of any reference to <code>x</code> and <code>y</code> at all if they weren't atomic.</p>\n\n<p>Additionally, if they are atomic, the compiler must ensure that other CPUs see the entire variable as either with the new value or the old value. For example, if the variable is a 32-bit entity that crosses a cache line boundary and a modification involves changing bits on both sides of the cache line boundary, one CPU may see a value of the variable that is never written because it only sees an update to the bits on one side of the cache line boundary. But this is not allowed for atomic variables modified with <code>memory_order_relaxed</code>.</p>\n\n<p>That is why data races are labeled as undefined behavior by the standard. The space of the possible things that could happen is probably a lot wilder than your imagination could account for, and certainly wider than any standard could reasonably encompass.</p>\n"}, {"comments": [{"owner": {"reputation": 462, "user_id": 5452170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16bfc7d23c7bad37f5832e8e01cf849d?s=128&d=identicon&r=PG&f=1", "display_name": "Xiao-Feng Li", "link": "https://stackoverflow.com/users/5452170/xiao-feng-li"}, "edited": false, "score": 0, "creation_date": 1569879495, "post_id": 58049046, "comment_id": 102731892, "body": "Relaxed-atomics should be no more relaxed than non-atomics. And no matter what, speculation should only be confirmed by non-speculative result, instead of cyclic self-proof. But your answer is a good thoughts exercise anyway. :)"}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 462, "user_id": 5452170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16bfc7d23c7bad37f5832e8e01cf849d?s=128&d=identicon&r=PG&f=1", "display_name": "Xiao-Feng Li", "link": "https://stackoverflow.com/users/5452170/xiao-feng-li"}, "edited": false, "score": 0, "creation_date": 1569898801, "post_id": 58049046, "comment_id": 102735493, "body": "@Xiao-FengLi: &quot;should be&quot; - yes, that&#39;s why the C++ standard says implementations <i>should</i> not allow this.  Also why designers of real HW have never AFAIK built HW that could do this.  Yes, it&#39;s a thought exercise about the kind of insanity that&#39;s possible if the rules are too weak, and I think I&#39;ve heard of it in a CPU-architecture context (outside C++).  As I said in the answer, the ordering rules in the Atomics chapter might allow this, but perhaps not when combined with <i>other</i> parts of the C++ standard.  I&#39;m not sure it needed to be mentioned as a possibility in the atomics chapter."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 462, "user_id": 5452170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16bfc7d23c7bad37f5832e8e01cf849d?s=128&d=identicon&r=PG&f=1", "display_name": "Xiao-Feng Li", "link": "https://stackoverflow.com/users/5452170/xiao-feng-li"}, "edited": false, "score": 1, "creation_date": 1569899110, "post_id": 58049046, "comment_id": 102735563, "body": "<i>Relaxed-atomics should be no more relaxed than non-atomics.</i> Yes, agreed.  That&#39;s part of why I think relaxed atomics probably can&#39;t do this either, because it makes no sense for non-atomic vars to be able to do this because there&#39;s no UB, therefore relaxed atomics shouldn&#39;t be able to do it either.  So it&#39;s sort of a reductio ad absurdum argument.  Fortunately that note is just a note, not normative.  And it just leaves the door open, doesn&#39;t require that it&#39;s possible on any implementation."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 462, "user_id": 5452170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16bfc7d23c7bad37f5832e8e01cf849d?s=128&d=identicon&r=PG&f=1", "display_name": "Xiao-Feng Li", "link": "https://stackoverflow.com/users/5452170/xiao-feng-li"}, "edited": false, "score": 1, "creation_date": 1574544369, "post_id": 58049046, "comment_id": 104272424, "body": "@Xiao-FengLi: I found some more evidence that the note is non-normative <i>only</i> because they couldn&#39;t find an acceptable way to formalize it.  Updated my answer.  And yes, the formalism for <code>mo_relaxed</code> ends up lacking this guarantee where I <i>think</i> non-atomic objects still have it.  This is something the committee would like to fix, but for now we can take it as a given that it&#39;s actually disallowed.  This is only a problem for formal verification, not real life."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1574551483, "post_id": 58049046, "comment_id": 104273932, "body": "&quot;<i>interesting thought-experiment into crazy consequences of very weak ordering rules</i>&quot; That&#39;s what ppl said re: things that are UB but &quot;work in practice&quot;: It&#39;s a crazy to think you don&#39;t get 2compl on those CPU as the only asm instr mult instr is in 2compl... until the analyser determines that x&gt;0 so that x<i>a&gt;x</i>b means a&gt;b and your code relying on 2compl mult is broken. Of course naive compilation of MT doesn&#39;t produce anything funny, but what about a future aggressive compilers? My no race code was very straightforward so that the issue should have clear cut, but other examples are less clear"}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1574551789, "post_id": 58049046, "comment_id": 104273999, "body": "@curiousguy: My main argument here is not based on compilation for any specific ISA.  It&#39;s based on the rules of the C abstract machine itself, which set the boundaries for what the &quot;as-if&quot; rule allows optimizers to do.  I do have a section about plausible HW that could make this happen, which couldn&#39;t run C++ because it <i>could</i> invent values out of thin air.  But that&#39;s not the point of this answer <i>at all</i>."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1574552391, "post_id": 58049046, "comment_id": 104274113, "body": "You say that crazytown isn&#39;t the real world, OTOH fixing the semantics would be lead to changes in the asm emitted: &quot;<i>This change would effectively imply stronger semantics for memory_order_relaxed, which would imply additional overhead for memory_order_relaxed on a number of architectures, including ARM, current Nvidia architectures, and possibly POWER.</i>&quot;"}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1574552648, "post_id": 58049046, "comment_id": 104274160, "body": "@curiousguy: <i>this change</i> being the proposal in <i>p0668r5: Revising the C++ memory model</i>.  The bullet point makes is clear that does <i>not</i> close this loophole.  It&#39;s an unrelated change.  They simply note the out-of-thin-air problem while talking about a fixes for an unrelated issue.  I cited it as evidence about the intent of the standards committee.  So no, closing the out-of-thin-air loophole would not result in any change to the asm.  The change they&#39;re talking about would disallow IRIW reordering so all threads can agree on a global order of stores, i.e. multi-copy-atomic model."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1574553812, "post_id": 58049046, "comment_id": 104274373, "body": "@PeterCordes n3710 confuses everything: low level/high level definitions of &quot;carries a dependency&quot; which are only vaguely connected. The main idea is buried: whether a SE becomes unavoidable at some point. At some point the writers really seemed lost (&quot;require recompilation of existing code&quot;... hello? that&#39;s really not the most serious issue here). The crux of the matter: authors think you need to define &quot;dependency chains&quot; to exclude unwanted behaviors; doing so is either syntax-based (horrible) or general (&quot;we are treating every relaxed store as though it were dependent on every prior load&quot;)"}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "reply_to_user": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1574554130, "post_id": 58049046, "comment_id": 104274439, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/202953/discussion-between-curiousguy-and-peter-cordes\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "is_accepted": true, "score": 5, "last_activity_date": 1598091026, "last_edit_date": 1598091026, "creation_date": 1569153972, "answer_id": 58049046, "question_id": 56673990, "link": "https://stackoverflow.com/questions/56673990/what-formally-guarantees-that-non-atomic-variables-cant-see-out-of-thin-air-val/58049046#58049046", "title": "What formally guarantees that non-atomic variables can&#39;t see out-of-thin-air values and create a data race like atomic relaxed theoretically can?", "body": "<p>The text of your question seems to be missing the point of the example and out-of-thin-air values.  Your example does not contain data-race UB.  (It might if <code>x</code> or <code>y</code> were set to <code>42</code> before those threads ran, in which case all bets are off and the other answers citing data-race UB apply.)</p>\n<p><strong>There is no protection against real data races, only against out-of-thin-air values.</strong></p>\n<p>I think you're really asking how to reconcile that <code>mo_relaxed</code> example with sane and well-defined behaviour for non-atomic variables.  That's what this answer covers.</p>\n<hr />\n<h2>The note is pointing out a hole in the atomic <code>mo_relaxed</code> formalism, <em>not</em> warning you of a real possible effect on some implementations.</h2>\n<p>This gap does not (I think) apply to non-atomic objects, <em>only</em> to <code>mo_relaxed</code>.</p>\n<p>They say <em>However, implementations should not allow such behavior. \u2013 end note]</em>.  Apparently the standards committee couldn't find a way to formalize that requirement so for now it's just a note, but is not intended to be optional.</p>\n<p>It's clear that even though this isn't strictly normative, the C++ standard <em>intends</em> to disallow out-of-thin-air values for relaxed atomic (and in general I assume).  Later standards discussion, e.g. <a href=\"http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/p0668r5.html\" rel=\"nofollow noreferrer\">2018's p0668r5: Revising the C++ memory model</a> (which doesn't &quot;fix&quot; this, it's an unrelated change) includes juicy side-nodes like:</p>\n<blockquote>\n<p><strong>We still do not have an acceptable way to make our informal (since C++14) prohibition of out-of-thin-air results precise</strong>. The primary practical effect of that is that formal verification of C++ programs using relaxed atomics remains unfeasible. The above paper suggests a solution similar to <a href=\"http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3710.html\" rel=\"nofollow noreferrer\">http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3710.html</a> . We continue to ignore the problem here ...</p>\n</blockquote>\n<p>So yes, the normative parts of the standard are apparently weaker for relaxed_atomic than they are for non-atomic.  This seems to be an unfortunately side effect of how they define the rules.</p>\n<p>AFAIK no implementations can produce out-of-thin-air values in real life.</p>\n<hr />\n<p><strong>Later versions of the standard phrase the informal recommendation more clearly</strong>, e.g. in the current draft: <a href=\"https://timsong-cpp.github.io/cppwp/atomics.order#8\" rel=\"nofollow noreferrer\">https://timsong-cpp.github.io/cppwp/atomics.order#8</a></p>\n<blockquote>\n<ol start=\"8\">\n<li><strong>Implementations should ensure that no \u201cout-of-thin-air\u201d values are computed</strong> that circularly depend on their own computation.<br />\n...</li>\n</ol>\n</blockquote>\n<blockquote>\n<ol start=\"9\">\n<li><p>[ Note: The <strong>recommendation [of 8.] similarly</strong> disallows <code>r1 == r2 == 42</code> in the following example, with x and y again initially zero:</p>\n<pre><code>   // Thread 1:\n   r1 = x.load(memory_order::relaxed);\n   if (r1 == 42) y.store(42, memory_order::relaxed);\n   // Thread 2:\n   r2 = y.load(memory_order::relaxed);\n   if (r2 == 42) x.store(42, memory_order::relaxed);\n</code></pre>\n<p>\u2014 end note ]</p>\n</li>\n</ol>\n</blockquote>\n<hr />\n<p>(This rest of the answer was written before I was sure that the standard <em>intended</em> to disallow this for <code>mo_relaxed</code>, too.)</p>\n<p><strong>I'm pretty sure the C++ abstract machine does <em>not</em> allow <code>r1 == r2 == 42</code></strong>.<br />\nEvery possible ordering of operations in the C++ abstract machine operations leads to <code>r1=r2=0</code> without UB, even without synchronization.  Therefore the program has no UB and <strong>any non-zero result would violate the &quot;as-if&quot; rule</strong>.</p>\n<p>Formally, ISO C++ allows an implementation to implement functions / programs in any way that gives the same result as the C++ abstract machine would.  For multi-threaded code, an implementation can pick one possible abstract-machine ordering and decide that's the ordering that always happens.  (e.g. when reordering relaxed atomic stores when compiling to asm for a strongly-ordered ISA.  The standard as written even allows coalescing atomic stores but <a href=\"https://stackoverflow.com/questions/45960387/why-dont-compilers-merge-redundant-stdatomic-writes\">compilers choose not to</a>).  <strong>But the result of the program always has to be something the abstract machine <em>could</em> have produced</strong>.  (Only the Atomics chapter introduces the possibility of one thread observing the actions of another thread without mutexes.  Otherwise that's not possible without data-race UB).</p>\n<p>I think the other answers didn't look carefully enough at this.  (And neither did I when it was first posted).  <strong>Code that doesn't execute doesn't cause UB</strong> (including data-race UB), and <strong>compilers aren't allowed to invent writes</strong> to objects.  (Except in code paths that already <em>unconditionally</em> write them, like <code>y = (x==42) ? 42 : y;</code> which <em>would</em> obviously create data-race UB.)</p>\n<p>For any non-atomic object, if don't <em>actually</em> write it then other threads might also be reading it, regardless of code inside not-executed <code>if</code> blocks.  The standard allows this and doesn't allow a variable to suddenly read as a different value when the abstract machine hasn't written it.  (And for objects we don't even read, like neighbouring array elements, another thread might even be writing them.)</p>\n<p>Therefore we can't do anything that would let another thread temporarily see a different value for the object, or step on its write.  Inventing writes to non-atomic objects is basically always a compiler bug; this is well known and universally agreed upon because it can break code that doesn't contain UB (and has done so in practice for a few cases of compiler bugs that created it, e.g. IA-64 GCC I think had such a bug at one point that broke the Linux kernel).  IIRC, Herb Sutter mentioned such bugs in part 1 or 2 of his talk, <a href=\"https://herbsutter.com/2013/02/11/atomic-weapons-the-c-memory-model-and-modern-hardware/\" rel=\"nofollow noreferrer\">atomic&lt;&gt; Weapons: The C++ Memory Model and Modern Hardware&quot;</a>, saying that it was already usually considered a compiler bug before C++11, but C++11 codified that and made it easier to be sure.</p>\n<p>Or another recent example with ICC for x86:\n<a href=\"https://stackoverflow.com/questions/54524947/crash-with-icc-can-the-compiler-invent-writes-where-none-existed-in-the-abstrac\">Crash with icc: can the compiler invent writes where none existed in the abstract machine?</a></p>\n<hr />\n<p><strong>In the C++ abstract machine</strong>, there's no way for execution to reach either <code>y = r1;</code> or <code>x = r2;</code>, regardless of sequencing or simultaneity of the loads for the branch conditions.  <code>x</code> and <code>y</code> both read as <code>0</code> and neither thread ever writes them.</p>\n<p>No synchronization is required to avoid UB because no order of abstract-machine operations leads to a data-race.  The ISO C++ standard doesn't have anything to say about speculative execution or what happens when mis-speculation reaches code.  That's because speculation is a feature of real implementations, <em>not</em> of the abstract machine.  It's up to implementations (HW vendors and compiler writers) to ensure the &quot;as-if&quot; rule is respected.</p>\n<hr />\n<p><strong>It's legal in C++ to write code like <code>if (global_id == mine) shared_var = 123;</code></strong> and have all threads execute it, as long as at most one thread actually runs the <code>shared_var = 123;</code> statement.  (And as long as synchronization exists to avoid a data race on non-atomic <code>int global_id</code>).  If things like <em>this</em> broke down, it would be chaos.  For example, you could apparently draw wrong conclusions like <a href=\"https://stackoverflow.com/questions/40320254/reordering-atomic-operations-in-c/58041255#58041255\">reordering atomic operations in C++</a></p>\n<p>Observing that a non-write didn't happen isn't data-race UB.</p>\n<p>It's also not UB to run <code>if(i&lt;SIZE) return arr[i];</code> because the array access only happens if <code>i</code> is in bounds.</p>\n<p><strong>I think the &quot;out of the blue&quot; value-invention note <em>only</em> applies to relaxed-atomics,</strong> apparently as a special caveat for them in the Atomics chapter.  (And even then, AFAIK it can't actually happen on any real C++ implementations, certainly not mainstream ones.  At this point implementations don't have to take any special measures to make sure it can't happen for non-atomic variables.)</p>\n<p>I'm not aware of any similar language outside the atomics chapter of the standard that allows an implementation to allow values to appear out of the blue like this.</p>\n<p>I don't see any sane way to argue that the C++ abstract machine causes UB at any point when executing this, but seeing <code>r1 == r2 == 42</code> would imply that unsynchronized read+write had happened, but that's data-race UB.  If that can happen, can an implementation invent UB because of speculative execution (or some other reason)?  The answer has to be &quot;no&quot; for the C++ standard to be usable at all.</p>\n<p>For relaxed atomics, inventing the <code>42</code> out of nowhere wouldn't imply that UB had happened; perhaps that's why the standard says it's allowed by the rules?  As far as I know, nothing <em>outside</em> the Atomics chapter of the standard allows it.</p>\n<hr />\n<h3>A hypothetical asm / hardware mechanism that could cause this</h3>\n<p>(Nobody wants this, hopefully everyone agrees that it would be a bad idea to build hardware like this.  It seems unlikely that coupling speculation across logical cores would ever be worth the downside of having to roll back all cores when one detects a mispredict or other mis-speculation.)</p>\n<p>For <code>42</code> to be possible, <strong>thread 1 has to see thread 2's speculative store</strong> and the store from thread 1 has to be seen by thread 2's load.  (Confirming that branch speculation as good, allowing this path of execution to become the real path that was actually taken.)</p>\n<p>i.e. speculation across threads: Possible on current HW if they ran on the same core with only a lightweight context switch, e.g. coroutines or <a href=\"https://en.wikipedia.org/wiki/Green_threads\" rel=\"nofollow noreferrer\">green threads</a>.</p>\n<p>But on current HW, memory reordering between threads is impossible in that case.  Out-of-order execution of code on the same core gives the illusion of everything happening in program order.  To get memory reordering between threads, they need to be running on different cores.</p>\n<p><strong>So we'd need a design that coupled together speculation between two logical cores.</strong>  Nobody does that because it means more state needs to rollback if a mispredict <em>is</em> detected.  But it is hypothetically possible.  For example an OoO SMT core that allows store-forwarding between its logical cores even before they've retired from the out-of-order core (i.e. become non-speculative).</p>\n<p>PowerPC allows store-forwarding between logical cores for <em>retired</em> stores, meaning that threads can disagree about the global order of stores.  But waiting until they &quot;graduate&quot; (i.e. retire) and become non-speculative means it doesn't tie together speculation on separate logical cores.  So when one is recovering from a branch miss, the others can keep the back-end busy.  If they all had to rollback on a mispredict on any logical core, that would defeat a significant part of the benefit of SMT.</p>\n<p>I thought for a while I'd found an ordering that lead to this on single core of a real weakly-ordered CPUs (with user-space context switching between the threads), but the final step store can't forward to the first step load because this is program order and OoO exec preserves that.</p>\n<ul>\n<li><p>T2: <code>r2 = y;</code> stalls (e.g. cache miss)</p>\n</li>\n<li><p>T2: branch prediction predicts that <code>r2 == 42</code> will be true.  ( <code>x = 42</code> should run.</p>\n</li>\n<li><p>T2: <code>x = 42</code> runs.  (Still speculative; r2 = y<code>hasn't obtained a value yet so the</code>r2 == 42` compare/branch is still waiting to confirm that speculation).</p>\n</li>\n<li><p>a context switch to Thread 1 happens <em>without</em> rolling back the CPU to retirement state or otherwise waiting for speculation to be confirmed as good or detected as mis-speculation.</p>\n<p>This part won't happen on real C++ implementations unless they use an M:N thread model, not the more common 1:1 C++ thread to OS thread.  Real CPUs don't rename the privilege level: they don't take interrupts or otherwise enter the kernel with speculative instructions in flight that might need to rollback and redo entering kernel mode from a different architectural state.</p>\n</li>\n<li><p>T1: <code>r1 = x;</code> takes its value from the speculative <code>x = 42</code> store</p>\n</li>\n<li><p>T1: <code>r1 == 42</code> is found to be true.  (Branch speculation happens here, too, not actually waiting for store-forwarding to complete.  But along this path of execution, where the <code>x = 42</code> did happen, this branch condition will execute and confirm the prediction).</p>\n</li>\n<li><p>T1: <code>y = 42</code> runs.</p>\n</li>\n<li><p>this was all on the same CPU core so this <code>y=42</code> store is after the <code>r2=y</code> load in program-order; it can't give that load a <code>42</code> to let the <code>r2==42</code> speculation be confirmed.  <strong>So this possible ordering doesn't demonstrate this in action after all.</strong>  This is why threads have to be running on separate cores with inter-thread speculation for effects like this to be possible.</p>\n</li>\n</ul>\n<p>Note that <code>x = 42</code> doesn't have a data dependency on <code>r2</code> so value-prediction isn't required to make this happen.  And the <code>y=r1</code> is inside an <code>if(r1 == 42)</code> anyway so the compiler can optimize to <code>y=42</code> if it wants, breaking the data dependency in the other thread and making things symmetric.</p>\n<p>Note that the arguments about Green Threads or other context switch on a single core isn't actually relevant: we need separate cores for the memory reordering.</p>\n<hr />\n<p>I commented earlier that I thought this might involve value-prediction.  The ISO C++ standard's memory model is certainly weak enough to allow the kinds of crazy &quot;reordering&quot; that value-prediction can create to use, but it's not necessary for this reordering.  <code>y=r1</code> can be optimized to <code>y=42</code>, and the original code includes <code>x=42</code> anyway so there's no data dependency of that store on the <code>r2=y</code> load.  Speculative stores of <code>42</code> are easily possible without value prediction.  (The problem is getting the other thread to see them!)</p>\n<p><strong>Speculating because of branch prediction instead of value prediction has the same effect here</strong>.  And in both cases the loads need to eventually see <code>42</code> to confirm the speculation as correct.</p>\n<p>Value-prediction doesn't even help make this reordering more plausible.  We still need inter-thread speculation <em>and</em> memory reordering for the two speculative stores to confirm each other and bootstrap themselves into existence.</p>\n<hr />\n<p>ISO C++ chooses to allow this for relaxed atomics, but AFAICT is disallows this non-atomic variables.  I'm not sure I see exactly what in the standard <em>does</em> allow the relaxed-atomic case in ISO C++ beyond the note saying it's not explicitly disallowed.  If there was any other code that did anything with <code>x</code> or <code>y</code> then maybe, but I think my argument <em>does</em> apply to the relaxed atomic case as well.  No path through the source in the C++ abstract machine can produce it.</p>\n<p>As I said, it's not possible in practice AFAIK on any real hardware (in asm), or in C++ on any real C++ implementation.  It's more of an interesting thought-experiment into crazy consequences of very weak ordering rules, like C++'s relaxed-atomic.  (<em>Those</em> ordering rules don't disallow it, but I think the as-if rule and the rest of the standard does, unless there's some provision that allows relaxed atomics to read a value that was <em>never</em> actually written by any thread.)</p>\n<p>If there is such a rule, it would only be for relaxed atomics, not for non-atomic variables.  Data-race UB is pretty much all the standard needs to say about non-atomic vars and memory ordering, but we don't have that.</p>\n"}, {"comments": [{"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1574546256, "post_id": 59012035, "comment_id": 104272890, "body": "<i>The causality here is reflected by the intra-thread dependences between operations within a thread, such as ... control dependence</i>.  That&#39;s a bit too strong.  From <i>within</i> the same CPU core, you would see the operations in program order, but other cores don&#39;t have to.  Branch prediction + speculative execution breaks control dependencies.  If those were both loads, the second load <i>could</i> happen before the first, despite being inside a branch controlled by the first.  (So for example, two ordered stores could be seen in the opposite order: LoadLoad reordering)."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1574546298, "post_id": 59012035, "comment_id": 104272902, "body": "But for a store, yes, it&#39;s necessary that all previous control and data dependencies are non-speculative before making a store visible to other threads, on any sane hardware."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1574546486, "post_id": 59012035, "comment_id": 104272934, "body": "Note that formally the standard still only says &quot;should&quot; not &quot;must&quot;.  The <i>disallows</i> you bolded only applies <i>if</i> the implementation follows the <i>recommendation</i> in the previous bullet.  But yes, this is much more forcefully worded than the previous &quot;should disallow&quot; at the bottom.  Good idea to quote the new wording, though; I did the same in my answer (with a different choice of what to bold).  Upvoted for the reasoning about sequential execution for non-atomic stuff; I don&#39;t think all your reasoning fully holds up but overall the right idea."}, {"owner": {"reputation": 462, "user_id": 5452170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16bfc7d23c7bad37f5832e8e01cf849d?s=128&d=identicon&r=PG&f=1", "display_name": "Xiao-Feng Li", "link": "https://stackoverflow.com/users/5452170/xiao-feng-li"}, "reply_to_user": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1574547120, "post_id": 59012035, "comment_id": 104273082, "body": "@PeterCordes Yes, two loads for if-condition and if-branch can happen out of order (either scheduled by the compiler or by the processor pipeline), but the result cannot be visible to the program. That is, the loaded value in the if-branch cannot be stored into a variable of the program. This is (intra-thread) causality, not related to other thread or core. Other core does not have to see this causality (unless in a causality memory consistency model). They may see out-of-order. The point here is that, the semantics of a program (within thread) should always satisfy &quot;intra-thread causality&quot;."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1574547227, "post_id": 59012035, "comment_id": 104273111, "body": "<i>the loaded value in the if-branch cannot be stored into a variable of the program</i>  Yes it can.  I&#39;m pretty sure you can observe LoadLoad reordering in real life on a weakly-ordered ISA even with the 2nd load inside a dependent conditional branch in the asm, without compile-time hoisting."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1574547446, "post_id": 59012035, "comment_id": 104273147, "body": "With all the loads + the branch not executed yet in the out-of-order backend, this order is possible:  2nd load takes a value from cache.  1st load takes a value from cache.  cmp+branch confirms the branch speculation based on the 1st load&#39;s value.  Then later the 2nd load value can get stored from a register into memory.  The store has to wait for the branch to become non-speculative to leave the store buffer, but the critical time for loads is when they read L1d cache during exec, not when they retire."}, {"owner": {"reputation": 462, "user_id": 5452170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16bfc7d23c7bad37f5832e8e01cf849d?s=128&d=identicon&r=PG&f=1", "display_name": "Xiao-Feng Li", "link": "https://stackoverflow.com/users/5452170/xiao-feng-li"}, "reply_to_user": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1574547458, "post_id": 59012035, "comment_id": 104273153, "body": "@PeterCordes  It depends on how you define &quot;visible&quot;. If the value only stores into a variable but not used anywhere, i.e., leading any effect, that is fine. From processor internal point of view, this is always possible, while my point is from &quot;external program&#39;s point of view&quot;. I guess here is what our definitions were not fully aligned."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1574547605, "post_id": 59012035, "comment_id": 104273190, "body": "Adding to my previous comment: or the thread could store both load results to global variables where other threads could see that it had observed loads out of order with some known store order.  This is very much a real thing.  Branch speculation breaks data dependencies.  The asm dependency ordering that <code>mo_consume</code> was designed to model doesn&#39;t work across control dependencies, only ALU data dependencies.  Anyway, I&#39;m not sure if you were disagreeing with this concrete example or if we were just misunderstanding each other."}, {"owner": {"reputation": 462, "user_id": 5452170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16bfc7d23c7bad37f5832e8e01cf849d?s=128&d=identicon&r=PG&f=1", "display_name": "Xiao-Feng Li", "link": "https://stackoverflow.com/users/5452170/xiao-feng-li"}, "reply_to_user": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1574548131, "post_id": 59012035, "comment_id": 104273297, "body": "@PeterCordes Yes, for observing threads, it is possible to see out-of-order loads, unless in a causality consistency model which is apparently not what the C++ std relaxed-order defines."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1574548390, "post_id": 59012035, "comment_id": 104273356, "body": "There&#39;s a reason the default is <code>seq_cst</code>: so intuition about causality does work.  For LoadLoad it would also work if the first load is an acquire-load."}], "tags": [], "owner": {"reputation": 462, "user_id": 5452170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16bfc7d23c7bad37f5832e8e01cf849d?s=128&d=identicon&r=PG&f=1", "display_name": "Xiao-Feng Li", "link": "https://stackoverflow.com/users/5452170/xiao-feng-li"}, "is_accepted": false, "score": 1, "last_activity_date": 1574546296, "last_edit_date": 1574546296, "creation_date": 1574541524, "answer_id": 59012035, "question_id": 56673990, "link": "https://stackoverflow.com/questions/56673990/what-formally-guarantees-that-non-atomic-variables-cant-see-out-of-thin-air-val/59012035#59012035", "title": "What formally guarantees that non-atomic variables can&#39;t see out-of-thin-air values and create a data race like atomic relaxed theoretically can?", "body": "<p>(Stackoverflow complains about too many comments I put above, so I gathered them into an answer with some modifications.)</p>\n\n<p>The intercept you cite from from C++ standard working draft N3337 was wrong. </p>\n\n<blockquote>\n  <p>[Note: The requirements do allow r1 == r2 == 42 in the following\n  example, with x and y initially zero:</p>\n  \n  <p><code>\n  // Thread 1: \n  r1 = x.load(memory_order_relaxed); \n  if (r1 == 42)\n      y.store(r1, memory_order_relaxed); \n  // Thread 2: \n  r2 = y.load(memory_order_relaxed); \n  if (r2 == 42) \n     x.store(42, memory_order_relaxed);\n  </code></p>\n</blockquote>\n\n<p>A programming language should never allow this \"<code>r1 == r2 == 42</code>\" to happen.\nThis has nothing to do with memory model. This is required by causality, which is the basic logic methodology and the foundation of any programming language design. It is the fundamental contract between human and computer. Any memory model should abide by it. Otherwise it is a bug. </p>\n\n<p>The causality here is reflected by the intra-thread dependences between operations within a thread, such as data dependence (e.g., read after write in same location) and control dependence (e.g., operation in a branch), etc. They cannot be violated by any language specification. Any compiler/processor design should respect the dependence in its committed result (i.e., externally visible result or program visible result). </p>\n\n<p>Memory model is mainly about memory operation ordering among multi-processors, which should never violate the intra-thread dependence, although a weak model may allow the causality happening in one processor to be violated (or unseen) in another processor. </p>\n\n<p>In your code snippet, both threads have (intra-thread) data dependence (load->check) and control dependence (check->store) that ensure their respective executions (within a thread) are ordered. That means, we can check the later op's output to determine if the earlier op has executed. </p>\n\n<p>Then we can use simple logic to deduce that, if both <code>r1</code> and <code>r2</code> are <code>42</code>, there must be a dependence cycle, which is impossible, unless you remove one condition check, which essentially breaks the dependence cycle. This has nothing to do with memory model, but intra-thread data dependence. </p>\n\n<p>Causality (or more accurately, intra-thread dependence here) is defined in C++ std, but not so explicitly in early drafts, because dependence is more of micro-architecture and compiler terminology. In language spec, it is usually defined as operational semantics. For example, the control dependence formed by \"if statement\" is defined in the same version of draft you cited as \"If the condition yields true the first substatement is executed. \"  That defines the sequential execution order. </p>\n\n<p>That said, the compiler and processor can schedule one or more operations of the if-branch to be executed before the if-condition is resolved. But no matter how the compiler and processor schedule the operations, the result of the if-branch cannot be committed (i.e., become visible to the program) before the if-condition is resolved. One should distinguish between semantics requirement and implementation details. One is language spec, the other is how the compiler and processor implement the language spec.</p>\n\n<p>Actually the current C++ standard draft has corrected this bug in <a href=\"https://timsong-cpp.github.io/cppwp/atomics.order#9\" rel=\"nofollow noreferrer\">https://timsong-cpp.github.io/cppwp/atomics.order#9</a> with a slight change.</p>\n\n<blockquote>\n  <p>[ Note: The recommendation similarly <strong>disallows</strong> r1 == r2 == 42 in the following example, with x and y again initially zero:</p>\n  \n  <p><code>\n  // Thread 1: \n  r1 = x.load(memory_order_relaxed); \n  if (r1 == 42)\n      y.store(42, memory_order_relaxed); \n  // Thread 2: \n  r2 = y.load(memory_order_relaxed); \n  if (r2 == 42) \n     x.store(42, memory_order_relaxed);\n  </code></p>\n</blockquote>\n"}], "owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1037, "favorite_count": 3, "accepted_answer_id": 58049046, "answer_count": 5, "score": 5, "last_activity_date": 1598091026, "creation_date": 1560969714, "last_edit_date": 1574562523, "question_id": 56673990, "link": "https://stackoverflow.com/questions/56673990/what-formally-guarantees-that-non-atomic-variables-cant-see-out-of-thin-air-val", "title": "What formally guarantees that non-atomic variables can&#39;t see out-of-thin-air values and create a data race like atomic relaxed theoretically can?", "body": "<p>This is a question about the <strong>formal guarantees</strong> of the C++ standard.</p>\n\n<p>The standard points out that the rules for <code>std::memory_order_relaxed</code> atomic variables allow \"out of thin air\" / \"out of the blue\" values to appear.</p>\n\n<p>But for non-atomic variables, can this example have UB?  Is <code>r1 == r2 == 42</code> possible in the C++ abstract machine?  Neither variable <code>== 42</code> initially so  you'd expect neither <code>if</code> body should execute, meaning no writes to the shared variables.</p>\n\n<pre><code>// Global state\nint x = 0, y = 0;\n\n// Thread 1:\nr1 = x;\nif (r1 == 42) y = r1;\n\n// Thread 2:\nr2 = y;\nif (r2 == 42) x = 42;\n</code></pre>\n\n<p>The above example is adapted from the standard, which <a href=\"https://timsong-cpp.github.io/cppwp/n3337/atomics.order#11\" rel=\"nofollow noreferrer\">explicitly says such behavior is allowed by the specification</a> for atomic objects:</p>\n\n<blockquote>\n  <p>[Note: The requirements do allow r1 == r2 == 42 in the following\n  example, with x and y initially zero:</p>\n\n<pre><code>// Thread 1:\nr1 = x.load(memory_order_relaxed);\nif (r1 == 42) y.store(r1, memory_order_relaxed);\n// Thread 2:\nr2 = y.load(memory_order_relaxed);\nif (r2 == 42) x.store(42, memory_order_relaxed);\n</code></pre>\n  \n  <p>However, implementations should not allow such behavior. \u2013 end note]</p>\n</blockquote>\n\n<p>What part of the so called \"memory model\" <strong>protects non atomic objects from these interactions caused by reads seeing out-of-thin-air values</strong>?</p>\n\n<hr>\n\n<p>When a race condition <em>would</em> exist with <em>different</em> values for <code>x</code> and <code>y</code>, what guarantees that read of a shared variable (normal, non atomic) cannot see such values?</p>\n\n<p>Can not-executed <code>if</code> bodies create self-fulfilling conditions that lead to a data-race?</p>\n"}, {"tags": ["c++", "inheritance", "friend"], "answers": [{"comments": [{"owner": {"reputation": 213, "user_id": 10627427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2c5ad331ecbe974b9afe0bede4f9103?s=128&d=identicon&r=PG&f=1", "display_name": "Maple", "link": "https://stackoverflow.com/users/10627427/maple"}, "edited": false, "score": 0, "creation_date": 1560969306, "post_id": 56673780, "comment_id": 99915126, "body": "Oh, interesting! So, what you are saying, it is not enough for calling context to have an access to class C and class C be a friend of A. It is also necessary for a calling context to be a friend of A as well, right?"}, {"owner": {"reputation": 156300, "user_id": 1782465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b45d92faaf9d122bfed585490e0bafc5?s=128&d=identicon&r=PG", "display_name": "Angew is no longer proud of SO", "link": "https://stackoverflow.com/users/1782465/angew-is-no-longer-proud-of-so"}, "reply_to_user": {"reputation": 213, "user_id": 10627427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2c5ad331ecbe974b9afe0bede4f9103?s=128&d=identicon&r=PG&f=1", "display_name": "Maple", "link": "https://stackoverflow.com/users/10627427/maple"}, "edited": false, "score": 0, "creation_date": 1560969478, "post_id": 56673780, "comment_id": 99915228, "body": "@Maple It&#39;s the caller of <code>foo</code> who does the conversion from <code>B*</code> to <code>A*</code>, which requires the protected access."}, {"owner": {"reputation": 213, "user_id": 10627427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2c5ad331ecbe974b9afe0bede4f9103?s=128&d=identicon&r=PG&f=1", "display_name": "Maple", "link": "https://stackoverflow.com/users/10627427/maple"}, "edited": false, "score": 0, "creation_date": 1560970094, "post_id": 56673780, "comment_id": 99915519, "body": "@Angew made sure the calling context is a friend of &quot;A&quot; and it works! thanks a lot for the explanation!"}], "tags": [], "owner": {"reputation": 156300, "user_id": 1782465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b45d92faaf9d122bfed585490e0bafc5?s=128&d=identicon&r=PG", "display_name": "Angew is no longer proud of SO", "link": "https://stackoverflow.com/users/1782465/angew-is-no-longer-proud-of-so"}, "is_accepted": true, "score": 13, "last_activity_date": 1561019607, "last_edit_date": 1561019607, "creation_date": 1560968816, "answer_id": 56673780, "question_id": 56673706, "link": "https://stackoverflow.com/questions/56673706/inaccessible-base-class-despite-friendship/56673780#56673780", "title": "Inaccessible base class despite friendship", "body": "<p>The problem is that the conversion from <code>B*</code> to <code>A*</code> (the one which requires friendship) does not happen in a member function of <code>C</code>, but in the context of the code containing <code>b</code> and <code>c</code> (i.e. the unrelated function <code>bar()</code>).</p>\n\n<p>It would work fine if you created a member function in <code>C</code> accepting a <code>B*</code>, and then called <code>foo()</code> from within it. That would have the conversion happen within the context of <code>C</code> which has the necessary access rights (thanks to friendship).</p>\n"}, {"tags": [], "owner": {"reputation": 2673, "user_id": 11292489, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cucr6.jpg?s=128&g=1", "display_name": "Gilles-Philippe Paill&#233;", "link": "https://stackoverflow.com/users/11292489/gilles-philippe-paill%c3%a9"}, "is_accepted": false, "score": 14, "last_activity_date": 1560969210, "last_edit_date": 1560969210, "creation_date": 1560968832, "answer_id": 56673785, "question_id": 56673706, "link": "https://stackoverflow.com/questions/56673706/inaccessible-base-class-despite-friendship/56673785#56673785", "title": "Inaccessible base class despite friendship", "body": "<p>Your code is equivalent to this:</p>\n\n<pre><code>B b;\nC c;\nA * a = &amp;b; // &lt;- This cast produces the error\nc.foo(a);\n</code></pre>\n\n<p>You cannot cast <code>&amp;b</code> as <code>A*</code> since the base class is protected, regardless of the friendship of <code>C</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 213, "user_id": 10627427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2c5ad331ecbe974b9afe0bede4f9103?s=128&d=identicon&r=PG&f=1", "display_name": "Maple", "link": "https://stackoverflow.com/users/10627427/maple"}, "reply_to_user": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1560970500, "post_id": 56674023, "comment_id": 99915696, "body": "@formerlyknownas_463035818 You are correct, the placement of a call turns out to be important and should have been included in the example. Ironically, this became obvious to me only <i>after</i> I got an answer. I updated the code in the question."}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "reply_to_user": {"reputation": 213, "user_id": 10627427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2c5ad331ecbe974b9afe0bede4f9103?s=128&d=identicon&r=PG&f=1", "display_name": "Maple", "link": "https://stackoverflow.com/users/10627427/maple"}, "edited": false, "score": 0, "creation_date": 1560970667, "post_id": 56674023, "comment_id": 99915769, "body": "@Maple nothing personal, but i dislike the term &quot;obvious&quot;. nothing is really obvious ;) still <code>foo</code> is not accesible but at least your example now has the error you report. If you dont mind I&#39;ll add the error message to your quesiton"}, {"owner": {"reputation": 213, "user_id": 10627427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2c5ad331ecbe974b9afe0bede4f9103?s=128&d=identicon&r=PG&f=1", "display_name": "Maple", "link": "https://stackoverflow.com/users/10627427/maple"}, "reply_to_user": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1560971236, "post_id": 56674023, "comment_id": 99916010, "body": "@formerlyknownas_463035818 I returned that &quot;public&quot; back into code to avoid any confusion and focus on actual problem"}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "reply_to_user": {"reputation": 213, "user_id": 10627427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2c5ad331ecbe974b9afe0bede4f9103?s=128&d=identicon&r=PG&f=1", "display_name": "Maple", "link": "https://stackoverflow.com/users/10627427/maple"}, "edited": false, "score": 0, "creation_date": 1560971456, "post_id": 56674023, "comment_id": 99916121, "body": "@Maple yep. Note that changeing the code after you got an answer is actually not optimal either because it can break answers. Luckily this answer still applies with minial change (global scope -&gt; bar scope). I know it isnt easy to create a good mvce, but leaving out stuff is confusing rather than simplifying most of the time"}, {"owner": {"reputation": 19667, "user_id": 1312382, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FL8Fg.jpg?s=128&g=1", "display_name": "Aconcagua", "link": "https://stackoverflow.com/users/1312382/aconcagua"}, "edited": false, "score": 0, "creation_date": 1560981375, "post_id": 56674023, "comment_id": 99919874, "body": "Hm \u2013 if we just consider accessibility, the answer is fine. Having a separate <code>B</code> instance is, globally seen, critical, though, as foo might modify it \u2013 but later in main, the unmodified <code>b</code> might be used. Possibly having two public foo overloads, one accepting <code>A*</code>, one accepting <code>B*</code> and the latter one just doing the cast as needed for calling the former might be less intervening..."}], "tags": [], "owner": {"reputation": 3890, "user_id": 1201701, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/VCVHT.jpg?s=128&g=1", "display_name": "StPiere", "link": "https://stackoverflow.com/users/1201701/stpiere"}, "is_accepted": false, "score": 1, "last_activity_date": 1560970685, "last_edit_date": 1560970685, "creation_date": 1560969826, "answer_id": 56674023, "question_id": 56673706, "link": "https://stackoverflow.com/questions/56673706/inaccessible-base-class-despite-friendship/56674023#56674023", "title": "Inaccessible base class despite friendship", "body": "<p>In the global scope B is not visible as A, because of protected inheritance.</p>\n\n<p>Only class B itself, classes inherited from B and class C (because the friendship relation) \"know\" that B is inheriting A. But the rest of the world (including global scope) doesnt'.</p>\n\n<p>So to achieve what you want, you could call</p>\n\n<pre><code>c.foo(&amp;b)\n</code></pre>\n\n<p>within C scope, for example using some wrapper function, something like (although bad design decision):</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;cstdlib&gt;\n\nclass C;\n\n\nclass A {\n    friend class C;  // this does not help\n};\n\nclass B : protected A {\n    friend class C;  // this does not help either\n};\n\nclass C {\npublic:\n    void foo() {\n        B b;\n        foo(&amp;b);  // this call is OK within C-scope\n    }\nprivate:\n    void foo(A* /*a*/) {\n        std::cout &lt;&lt; \"C::foo(A* a)\\n\";\n    };\n};\n\n\nint main()\n{\n    std::cout &lt;&lt; \"Hello, Wandbox!\" &lt;&lt; std::endl;\n    B b;\n    C c;\n    //c.foo(&amp;b);  // this produces error: class A is an inaccessible base of B\n    c.foo();      // this is calling c.foo(A*) internally\n}\n</code></pre>\n\n<p>or <a href=\"https://wandbox.org/permlink/F2qF9VYwbEGzYny6\" rel=\"nofollow noreferrer\">live</a>:</p>\n"}], "owner": {"reputation": 213, "user_id": 10627427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2c5ad331ecbe974b9afe0bede4f9103?s=128&d=identicon&r=PG&f=1", "display_name": "Maple", "link": "https://stackoverflow.com/users/10627427/maple"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1346, "favorite_count": 1, "accepted_answer_id": 56673780, "answer_count": 3, "score": 11, "last_activity_date": 1561019607, "creation_date": 1560968452, "last_edit_date": 1560971113, "question_id": 56673706, "link": "https://stackoverflow.com/questions/56673706/inaccessible-base-class-despite-friendship", "title": "Inaccessible base class despite friendship", "body": "<p>There are tons of questions regarding this error and all of the answers seem to imply that downcasting is impossible. Only <a href=\"https://stackoverflow.com/a/44488594/10627427\">this answer</a> mentions friendship as possible solution, at least as I understand it. However the following code (irrelevant stuff removed for clarity) does not compile:</p>\n\n<pre><code>class C;\n\nclass A {\n    friend class C;  // this does not help\n};\n\nclass B : protected A {\n    friend class C;  // this does not help either\n};\n\nclass C {\n    public:\n    void foo(A* a) {};\n};\n\nB b;\nC c;\n\nvoid bar()\n{\n    c.foo(&amp;b);  // this produces error: class A is an inaccessible base of B\n}\n</code></pre>\n\n<p>Why friendship does not work on a reference? After all, \"C\" is perfectly capable of calling protected methods of \"A\" through pointer to \"B\".</p>\n\n<p>The full error is </p>\n\n<pre><code>prog.cc: In function 'void bar()':\nprog.cc:20:13: error: 'A' is an inaccessible base of 'B'\n   20 |     c.foo(&amp;b);\n</code></pre>\n"}, {"tags": ["c++", "caffe"], "comments": [{"owner": {"reputation": 88, "user_id": 2066337, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ccc37ab54ea0d26cd60692f0855b9ed?s=128&d=identicon&r=PG", "display_name": "user2066337", "link": "https://stackoverflow.com/users/2066337/user2066337"}, "edited": false, "score": 0, "creation_date": 1560969799, "post_id": 56673704, "comment_id": 99915380, "body": "If I&#39;m understanding correctly, you&#39;d like to run test on a pretrained network?  The default functionality of the dropout layer at test time is (for lack of a better term), &quot;no dropout&quot;.  so at test time for the Dropout layer input = output.    Documentation: <a href=\"http://caffe.berkeleyvision.org/doxygen/classcaffe_1_1DropoutLayer.html\" rel=\"nofollow noreferrer\">caffe.berkeleyvision.org/doxygen/&hellip;</a>"}, {"owner": {"reputation": 107, "user_id": 11631874, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/318a2bf621cd9a79a6dd1984b3af87f4?s=128&d=identicon&r=PG&f=1", "display_name": "Walklikeapenguin", "link": "https://stackoverflow.com/users/11631874/walklikeapenguin"}, "reply_to_user": {"reputation": 88, "user_id": 2066337, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ccc37ab54ea0d26cd60692f0855b9ed?s=128&d=identicon&r=PG", "display_name": "user2066337", "link": "https://stackoverflow.com/users/2066337/user2066337"}, "edited": false, "score": 0, "creation_date": 1560974923, "post_id": 56673704, "comment_id": 99917558, "body": "Yes, I&#39;d like to run a test on a pre-trained network. I modified the dropout_layer.cpp and dropout_layer.cu files to always enable dropout. The idea behind this is to run a few forward passed with dropout enabled and use the standard deviation of them for confidence metrics. With that being said, I&#39;d like to run a forward pass with different dropout_ratio values without creating new deploy.prototxt files.."}, {"owner": {"reputation": 88, "user_id": 2066337, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ccc37ab54ea0d26cd60692f0855b9ed?s=128&d=identicon&r=PG", "display_name": "user2066337", "link": "https://stackoverflow.com/users/2066337/user2066337"}, "edited": false, "score": 0, "creation_date": 1561035345, "post_id": 56673704, "comment_id": 99938416, "body": "I&#39;ve got no firsthand experience with the c++ implementation of caffe, but in pycaffe (to my knowledge), train/test phases rely on the writing out of a prototxt in order to execute.  More clearly in this case, you should be able to directly modify the prototxt so the dropout_ratio is 0.5, load your caffemodel and this modified prototxt, and it should work."}], "owner": {"reputation": 107, "user_id": 11631874, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/318a2bf621cd9a79a6dd1984b3af87f4?s=128&d=identicon&r=PG&f=1", "display_name": "Walklikeapenguin", "link": "https://stackoverflow.com/users/11631874/walklikeapenguin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 104, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1560975236, "creation_date": 1560968445, "last_edit_date": 1560975236, "question_id": 56673704, "link": "https://stackoverflow.com/questions/56673704/can-you-change-layer-parameters-in-a-loaded-caffe-network", "title": "Can you change layer parameters in a loaded caffe network?", "body": "<p>I would like to edit a layer parameter of a caffe network that has already been loaded. More specifically, I would like to edit the 'dropout_ratio' param of a dropout layer after the network is loaded and then run a forward pass.</p>\n\n<p>My current issues are:\n1) How do I access the params of a specific layer?\n2) If I can access the params of a specific layer, how can I change them?</p>\n\n<p>My dropout layer in my deploy.prototxt looks like this:</p>\n\n<pre><code>layer {\n  name: \"drop\"\n  type: \"Dropout\"\n  bottom: \"fc6\"\n  top: \"fc6\"\n  dropout_param {\n    dropout_ratio: 0.1\n  }\n}\n</code></pre>\n\n<p>Here is a rough example of something I've tried to no avail:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>// Say the index of my dropout layer is '3'\nint index = 3;\n// Change the 'dropout_ratio' param to 0.5\nnet_-&gt;layers()[index]-&gt;dropout_params().dropout_ratio = 0.5;\n// Continue as needed\n</code></pre>\n\n<p>Ideally I would like to do something like this to run the network with a custom dropout ratio, even though it is '0.1' in the deploy.prototxt. Is this something that is possible?</p>\n\n<p>Additional Data: I have modified caffe's dropout layer so that dropout is always active- even during testing. The idea behind this experiment is to test the trained network with multiple 'dropout_ratio' values without creating different deploy.prototxt files</p>\n"}, {"tags": ["c++", "c++11", "stl", "move-semantics", "unordered-map"], "comments": [{"owner": {"reputation": 6556, "user_id": 874660, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/45a7738c334183bff552bcf73c4dcd65?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/874660/ben"}, "edited": false, "score": 0, "creation_date": 1560975169, "post_id": 56673642, "comment_id": 99917666, "body": "It is a dupe, but one suggestion: rather than <code>int dummyArg</code>, do  struct S {     std::mutex m;     S() {}     struct default_construct_t {};     static constexpr auto default_construct = default_construct_t();     S(default_construct_t) : S() {} }; ``` so then you can do <code>u.emplace(0, S::default_construct);</code> which at least to me is clearer than <code>u.emplace(std::piecewise_construct, std::make_tuple(0), std::make_tuple());</code>"}], "owner": {"reputation": 7371, "user_id": 1510211, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4acda0216d7fd2ea07c31c0cfc53a714?s=128&d=identicon&r=PG", "display_name": "Shachar Shemesh", "link": "https://stackoverflow.com/users/1510211/shachar-shemesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 50, "favorite_count": 0, "closed_date": 1560968540, "answer_count": 0, "score": 2, "last_activity_date": 1560968423, "creation_date": 1560968220, "question_id": 56673642, "link": "https://stackoverflow.com/questions/56673642/cannot-add-unmovable-type-to-unordered-map", "closed_reason": "Duplicate", "title": "Cannot add unmovable type to unordered_map", "body": "<p>Please consider the following code:</p>\n\n<pre><code>#include &lt;mutex&gt;\n#include &lt;unordered_map&gt;\n\nstruct S {\n    std::mutex m;\n};\n\nint main() {\n    std::unordered_map&lt; int, S &gt; u;\n\n    u.emplace( 0, S() );\n}\n</code></pre>\n\n<p>While the error message reported by gcc is unreadable, the gist of it is that because <code>std::mutex</code> is unmovable, I cannot create an element in the map of type <code>S</code>. Since the actual elements of the map never move, this is not a real problem. Indeed, the following program does compile:</p>\n\n<pre><code>#include &lt;mutex&gt;\n#include &lt;unordered_map&gt;\n\nstruct S {\n    std::mutex m;\n\n    explicit S( int dummyArg ) {}\n};\n\nint main() {\n    std::unordered_map&lt; int, S &gt; u;\n\n    u.emplace( 0, 1 );\n}\n</code></pre>\n\n<p>I am looking for a way to emplace an instance of <code>S</code> in the map without generating a dummy argument constructor.</p>\n"}, {"tags": ["c++", "visual-studio", "googletest"], "comments": [{"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1560968454, "post_id": 56673524, "comment_id": 99914734, "body": "what are the numerical values?"}, {"owner": {"reputation": 147, "user_id": 11046237, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc57cedaf756420184ae20c4fad6b14b?s=128&d=identicon&r=PG&f=1", "display_name": "finnahuss", "link": "https://stackoverflow.com/users/11046237/finnahuss"}, "reply_to_user": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1560974128, "post_id": 56673524, "comment_id": 99917249, "body": "Above I&#39;ve posted the error flags being produced within the Test Explorer"}], "answers": [{"comments": [{"owner": {"reputation": 147, "user_id": 11046237, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc57cedaf756420184ae20c4fad6b14b?s=128&d=identicon&r=PG&f=1", "display_name": "finnahuss", "link": "https://stackoverflow.com/users/11046237/finnahuss"}, "edited": false, "score": 0, "creation_date": 1560976159, "post_id": 56675216, "comment_id": 99918081, "body": "ahhh, thank you for the input! The abs_error function with the negative value was definitely the root issue. It passed after implementing this :)"}, {"owner": {"reputation": 147, "user_id": 11046237, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc57cedaf756420184ae20c4fad6b14b?s=128&d=identicon&r=PG&f=1", "display_name": "finnahuss", "link": "https://stackoverflow.com/users/11046237/finnahuss"}, "edited": false, "score": 0, "creation_date": 1561067490, "post_id": 56675216, "comment_id": 99953852, "body": "Any suggestions when the test fails within the tolerance bounds, even when the value is positive? I recently ran into a similar issue as above, enough though the output is positive."}], "tags": [], "owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "is_accepted": false, "score": 1, "last_activity_date": 1560975300, "last_edit_date": 1592644375, "creation_date": 1560975300, "answer_id": 56675216, "question_id": 56673524, "link": "https://stackoverflow.com/questions/56673524/error-using-expect-near-where-the-output-is-within-the-declared-tolerance/56675216#56675216", "title": "Error using EXPECT_NEAR where the output is within the declared tolerance", "body": "<p>From <a href=\"https://github.com/google/googletest/blob/master/googletest/docs/advanced.md\" rel=\"nofollow noreferrer\">here</a>:</p>\n<blockquote>\n<p><strong>Nonfatal assertion</strong></p>\n<pre><code>EXPECT_NEAR(val1, val2, abs_error);\n</code></pre>\n<p><strong>Verifies</strong></p>\n<p>the difference between val1 and val2 doesn't exceed the given absolute error</p>\n</blockquote>\n<p>An <strong>absolute</strong> error is positive by definition. I didn't check, but I suspect the implementation is something along the line of</p>\n<pre><code>abs(val1 - val2) &lt; abs_error\n</code></pre>\n<p>Use</p>\n<pre><code>EXPECT_NEAR(annual_energy, -1.83517e7, 1.83517e7 * m_error_tolerance_lo) &lt;&lt; &quot;Annual Energy&quot;;\n</code></pre>\n<p>or</p>\n<pre><code>EXPECT_NEAR(annual_energy, -1.83517e7,std::abs( -1.83517e7 * m_error_tolerance_lo)) &lt;&lt; &quot;Annual Energy&quot;;\n</code></pre>\n"}], "owner": {"reputation": 147, "user_id": 11046237, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc57cedaf756420184ae20c4fad6b14b?s=128&d=identicon&r=PG&f=1", "display_name": "finnahuss", "link": "https://stackoverflow.com/users/11046237/finnahuss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 485, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1560975300, "creation_date": 1560967647, "last_edit_date": 1560974082, "question_id": 56673524, "link": "https://stackoverflow.com/questions/56673524/error-using-expect-near-where-the-output-is-within-the-declared-tolerance", "title": "Error using EXPECT_NEAR where the output is within the declared tolerance", "body": "<p>Using the Google Test Framework, I am using the EXPECT_NEAR function to determine whether a test is outputting a value that is acceptable. </p>\n\n<p>The (3) values or parameters that are causing my test to fail are actually within the 1.0% % 0.1% tolerance of the test. </p>\n\n<p>I've simply tried hand calculating the tolerance to see whether or not the parameter has fallen outside of the limit. They prove to be within, where even Google Test Framework acknowledges this, where it still flags a failed test. </p>\n\n<pre><code>EXPECT_FALSE(test_errors);\n    if (!test_errors)\n    {\n        ssc_number_t annual_energy;\n        ssc_data_get_number(data, \"annual_energy\", &amp;annual_energy);\n        EXPECT_NEAR(annual_energy, -1.83517e7, -1.83517e7 * \nm_error_tolerance_lo) &lt;&lt; \"Annual Energy\";  // choose either \nm_error_tolerance_lo or m_error_tolerance_hi\n</code></pre>\n\n<ul>\n<li>Above here shows (1) of the (3) parameters that are causing a test to fail. </li>\n</ul>\n\n<p>class CMTcsMoltenSalt : public ::testing::Test{</p>\n\n<pre><code>public:\n\n    ssc_data_t data;\n    ssc_number_t calculated_value;\n    ssc_number_t * calculated_array;\n    double m_error_tolerance_hi = 0.01;     // 1.0%\n    double m_error_tolerance_lo = 0.001;    // 0.1%\n\n    void SetUp()\n    {\n        data = ssc_data_create();\n        tcsmolten_salt_default(data);\n        calculated_array = new ssc_number_t[8760];\n    }\n    void TearDown() {...\n</code></pre>\n\n<p>* The testing framework declaring the tolerance of the test, where the output falls within an acceptable range. </p>\n\n<p>I'd expect the test to pass, yet something is causing a flag to be raised, where the output values are for some reason, unacceptable.</p>\n\n<p>Below I've copied the flags being raised within the Test Explorer. They should pass, as they are within the tolerance mathematically. Despite this, Google Test Framework is saying how they are causing the error. \n:\nMessage: \nS_decode ==> Please fix the year: 0 [1950-2050]\nS_decode ==> Please fix the day-of-year: 0</p>\n\n<h1>1 - The difference between annual_energy and -1.83517e7 is 1.5710115097463131, which exceeds -1.83517e7 * m_error_tolerance_lo, where</h1>\n\n<p>annual_energy evaluates to -18351701.57101151,\n-1.83517e7 evaluates to -18351700, and\n-1.83517e7 * m_error_tolerance_lo evaluates to -18351.700000000001.\nAnnual Energy</p>\n\n<h1>2 - The difference between capacity_factor and -2.0241 is 3.3119740638909434e-07, which exceeds -2.0241 * m_error_tolerance_lo, where</h1>\n\n<p>capacity_factor evaluates to -2.0240996688025934,\n-2.0241 evaluates to -2.0240999999999998, and\n-2.0241 * m_error_tolerance_lo evaluates to -0.0020241.\nCapacity Factor</p>\n\n<h1>3 - The difference between kwh_per_kw and -177.311 is 0.00013098710715553352, which exceeds -177.311 * m_error_tolerance_lo, where</h1>\n\n<p>kwh_per_kw evaluates to -177.31113098710716,\n-177.311 evaluates to -177.31100000000001, and\n-177.311 * m_error_tolerance_lo evaluates to -0.17731100000000002.\nkwh per kw</p>\n"}, {"tags": ["c++", "c++11", "post", "boost", "asio"], "comments": [{"owner": {"reputation": 17331, "user_id": 8950365, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c6ba3b19f86f1bea8cf76e691db4349?s=128&d=identicon&r=PG&f=1", "display_name": "rafix07", "link": "https://stackoverflow.com/users/8950365/rafix07"}, "edited": false, "score": 0, "creation_date": 1560966895, "post_id": 56673167, "comment_id": 99914047, "body": "You should show more code, for example how <code>ConstructorStuff</code> is created, where is <code>io_service::run</code> called, and what is the lifetime of <code>ConstructorStuff</code>."}, {"owner": {"reputation": 759, "user_id": 4567788, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/izcAg.png?s=128&g=1", "display_name": "Kyle J", "link": "https://stackoverflow.com/users/4567788/kyle-j"}, "reply_to_user": {"reputation": 17331, "user_id": 8950365, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c6ba3b19f86f1bea8cf76e691db4349?s=128&d=identicon&r=PG&f=1", "display_name": "rafix07", "link": "https://stackoverflow.com/users/8950365/rafix07"}, "edited": false, "score": 0, "creation_date": 1560967915, "post_id": 56673167, "comment_id": 99914506, "body": "@rafix07 Added two new code samples, bottom one calls the one above it."}, {"owner": {"reputation": 17331, "user_id": 8950365, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c6ba3b19f86f1bea8cf76e691db4349?s=128&d=identicon&r=PG&f=1", "display_name": "rafix07", "link": "https://stackoverflow.com/users/8950365/rafix07"}, "edited": false, "score": 0, "creation_date": 1560968197, "post_id": 56673167, "comment_id": 99914626, "body": "<code>stuff</code> is local variable inside <code>SetupServer</code>, after <code>CreateTheServer</code> is called, <code>stuff</code> is detroyed when function <code>SetupServer</code> ends , then <i>somewhere (by io_service)</i> <code>ListenForConection</code> is called for unexisted object (that is why you are getting strange results), so it is undefined behaviour. <code>stuff</code> must exist as long as you call its method. You can create <code>ConstructorStuff </code> onto heap, or make <code>stuff</code> to be data member of some class to extend its lifetime. You need to be aware that <code>post</code> queues passed handler, and they are called by <code>io_service</code> in <code>run</code> method."}, {"owner": {"reputation": 17331, "user_id": 8950365, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c6ba3b19f86f1bea8cf76e691db4349?s=128&d=identicon&r=PG&f=1", "display_name": "rafix07", "link": "https://stackoverflow.com/users/8950365/rafix07"}, "edited": false, "score": 0, "creation_date": 1560968576, "post_id": 56673167, "comment_id": 99914783, "body": "But when these handlers are called you don&#39;t know. But you need to ensure that handler created from member function will be called on existing object i.e. on <code>stuff</code>."}, {"owner": {"reputation": 759, "user_id": 4567788, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/izcAg.png?s=128&g=1", "display_name": "Kyle J", "link": "https://stackoverflow.com/users/4567788/kyle-j"}, "reply_to_user": {"reputation": 17331, "user_id": 8950365, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c6ba3b19f86f1bea8cf76e691db4349?s=128&d=identicon&r=PG&f=1", "display_name": "rafix07", "link": "https://stackoverflow.com/users/8950365/rafix07"}, "edited": false, "score": 1, "creation_date": 1560968921, "post_id": 56673167, "comment_id": 99914945, "body": "I&#39;m actually working on this right now to see if it pulls through, I believe you might be right."}, {"owner": {"reputation": 759, "user_id": 4567788, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/izcAg.png?s=128&g=1", "display_name": "Kyle J", "link": "https://stackoverflow.com/users/4567788/kyle-j"}, "reply_to_user": {"reputation": 17331, "user_id": 8950365, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c6ba3b19f86f1bea8cf76e691db4349?s=128&d=identicon&r=PG&f=1", "display_name": "rafix07", "link": "https://stackoverflow.com/users/8950365/rafix07"}, "edited": false, "score": 0, "creation_date": 1560969317, "post_id": 56673167, "comment_id": 99915134, "body": "@rafix07 If you draft up an answer, I&#39;ll vote it as so. The problem was indeed losing sight of the object. I would&#39;ve thought that it would throw a seg fault error to better illustrate that it lost scope =O"}], "answers": [{"tags": [], "owner": {"reputation": 17331, "user_id": 8950365, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c6ba3b19f86f1bea8cf76e691db4349?s=128&d=identicon&r=PG&f=1", "display_name": "rafix07", "link": "https://stackoverflow.com/users/8950365/rafix07"}, "is_accepted": true, "score": 1, "last_activity_date": 1560969803, "creation_date": 1560969803, "answer_id": 56674019, "question_id": 56673167, "link": "https://stackoverflow.com/questions/56673167/boost-strands-post-causing-segmentation-faults-when-accessing-inserting-values/56674019#56674019", "title": "Boost strands post causing segmentation faults when accessing/inserting values", "body": "<p>The problem comes from <code>SetupServer</code> where <code>stuff</code> is local variable, so after <code>CreateTheServer</code> was called, <code>stuff</code> was destroyed and somewhere by <code>io_service::run</code> handler posted by <code>mStrand.post(std::bind(&amp;ConstructorStuff::ListenForConnection, this));</code> was called on deleted object. Then <code>std::cout &lt;&lt; mySockets.size() &lt;&lt; std::endl;</code> printed strange result - it is a simple example of undefined behaviour.</p>\n"}], "owner": {"reputation": 759, "user_id": 4567788, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/izcAg.png?s=128&g=1", "display_name": "Kyle J", "link": "https://stackoverflow.com/users/4567788/kyle-j"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "accepted_answer_id": 56674019, "answer_count": 1, "score": 0, "last_activity_date": 1561212748, "creation_date": 1560965861, "last_edit_date": 1561212748, "question_id": 56673167, "link": "https://stackoverflow.com/questions/56673167/boost-strands-post-causing-segmentation-faults-when-accessing-inserting-values", "title": "Boost strands post causing segmentation faults when accessing/inserting values", "body": "<p>I'm currently writing a networking structure that merely enacts a server to listen on it's own strand, simple. Whenever the strand is called to call a function and that function calls any members from within the class, segmentation faults occur.</p>\n\n<p>There are a few exceptions but notably these segmentation faults occur when</p>\n\n<ol>\n<li>tcp::acceptor myAcceptor(my_io_service, myEndpoint)</li>\n<li>mySockets.insert(...)</li>\n</ol>\n\n<p>Now I could easily swap myAcceptor and place it within the initializer list within the constructor and treat it as a class member but I would like to avoid that.</p>\n\n<p>So whats next to validate my claim? My latest attempt was checking the size of the mySockets which, I should note, is a <strong>map</strong>. I checked the size <strong>prior</strong> to calling myStrand.post(...) and checked the size within the function call. Here is what I noticed.</p>\n\n<p>The mySockets map sizes:</p>\n\n<ol>\n<li><strong>Prior to post</strong>: 0 (Nothings been inserted, great!)</li>\n<li><strong>Within function call, called by post</strong>: 999929272 (Ughhhh)</li>\n</ol>\n\n<p>It appears something went airy but what exactly? Did it create a new instance but oddly wouldn't this be 0? It couldn't have lost the address as this would surely cause a segmentation fault, wouldn't it? </p>\n\n<p>This is where I'm at right now in my debugging process.</p>\n\n<p><strong>Goal</strong></p>\n\n<p>The final goal is to be able to have access to mySockets and my_io_service within the post strand.</p>\n\n<p><strong>Layout flow</strong></p>\n\n<p>This explains the layout, the good ol code is below</p>\n\n<ol>\n<li>Create 'work' by passing io_service</li>\n<li>Start the io_service by invoking .run()</li>\n<li>Create the TCP server</li>\n<li>Assign parameters to the class member types</li>\n<li>Invoke myStrand.post(...) to call the servers, listen for connecting clients</li>\n<li>Wait for client to connect, etc</li>\n</ol>\n\n<p>I've selected code samples that detail the problem.</p>\n\n<p><strong>Header file</strong></p>\n\n<pre><code>using boost::asio::ip::tcp;\nbool amIConnected = false;\nboost::asio::io_service::strand myStrand;\nboost::asio::io_service&amp; my_io_service;\nstd::map&lt;std::string, std::shared_ptr&lt;tcp::socket&gt;&gt; mySockets;\ntcp::acceptor myAcceptor\n</code></pre>\n\n<p><strong>Source file</strong></p>\n\n<pre><code>ConstructorStuff::ConstructorStuff(boost::asio::io_service&amp; the_service) : \nmyStrand(the_service), \nmy_io_service(the_service),\nmyAcceptor(the_service, tcp::endpoint(tcp::v4(), 1337))\n{}\n\nvoid ConstructorStuff::CreateTheServer()\n{\n    amIConnected = true;\n    // std::cout &lt;&lt; mySockets.size() &lt;&lt; std::endl; Returns 0\n    mStrand.post(std::bind(&amp;ConstructorStuff::ListenForConnection, this));\n}\n\nvoid ConstructorStuff::ListenForConection()\n{\n    // std::cout &lt;&lt; mySockets.size() &lt;&lt; std::endl; Crazy size\n    tcp::acceptor tryAgain(my_io_service, tcp::endpoint(tcp::v4(), 1338)); // Just to showcase the error doesn't just occur through mySockets.\n}\n</code></pre>\n\n<p><strong>Where ConstructorStuff is called</strong></p>\n\n<pre><code>void SetupServer()\n{\n    ConstructorStuff stuff(some_service);\n    stuff.CreateTheServer();\n}\n</code></pre>\n\n<p><strong>This calls the function above</strong></p>\n\n<pre><code>ServiceStarter spinup(service);\nspinup.Start(); // Just queues reference_service.run()\nstd::shared_ptr&lt;SomeClass&gt; server_interface(new SomeClass ( service ));\nserver_interface-&gt;SetupServer();\nboost::this_thread::sleep(boost::posix_time::seconds(20));\nserver_interface-&gt;Cancel(); // Just another function that kills the server.\n</code></pre>\n\n<p>Any suggestions would be great!</p>\n\n<p><strong>Side notes</strong>: </p>\n\n<ul>\n<li>Any additional values like say <strong>myPort</strong> placed in the header file, initialized to 1337 in <strong>CreateTheServer()</strong> and then called in <strong>ListenForConnection()</strong> will abruptly be different.</li>\n<li>To reassure anyone that may ask, these values may be accessed <strong>OUTSIDE</strong> the strand, thus locking down this problem to a strand related issue that I'm having.</li>\n</ul>\n\n<p><strong>Edit</strong></p>\n\n<p>I added two new source files. I'm quite limited to what I can show but this should be enough to illustrate the problem. </p>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 14358, "user_id": 3962537, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AI0Bc.png?s=128&g=1", "display_name": "Dan Ma\u0161ek", "link": "https://stackoverflow.com/users/3962537/dan-ma%c5%a1ek"}, "edited": false, "score": 8, "creation_date": 1560965367, "post_id": 56673004, "comment_id": 99913347, "body": "Read the <a href=\"https://docs.opencv.org/3.4.3/d3/d63/classcv_1_1Mat.html#details\" rel=\"nofollow noreferrer\">detailed description</a> in the documentation of <code>cv::Mat</code> and you shall be educated. :)"}, {"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 4, "creation_date": 1560966153, "post_id": 56673004, "comment_id": 99913699, "body": "Sidenote: <code>&lt;&lt;</code> is sometimes referred to as the Insertion Operator. <code>&gt;&gt;</code> is sometimes called the Extraction Operator. Whether or not insertion or extraction is involved depends on context."}], "answers": [{"tags": [], "owner": {"reputation": 196207, "user_id": 434551, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/8Wzl8.png?s=128&g=1", "display_name": "R Sahu", "link": "https://stackoverflow.com/users/434551/r-sahu"}, "is_accepted": true, "score": 2, "last_activity_date": 1560966699, "last_edit_date": 1560966699, "creation_date": 1560965931, "answer_id": 56673177, "question_id": 56673004, "link": "https://stackoverflow.com/questions/56673004/the-meaning-of-the-matrix-operator/56673177#56673177", "title": "The meaning of the &lt;&lt; matrix operator", "body": "<p>That is a shortcut for:</p>\n\n<pre><code>cv::Mat_&lt;double&gt; myMat_(3, 3);\n\nmyMat_.at(0, 0) = 1.0;\nmyMat_.at(0, 1) = 2.0;\nmyMat_.at(0, 2) = 3.0;\n\nmyMat_.at(1, 0) = 4.0;\nmyMat_.at(1, 1) = 5.0;\nmyMat_.at(1, 2) = 6.0;\n\nmyMat_.at(2, 0) = 7.0;\nmyMat_.at(2, 1) = 8.0;\nmyMat_.at(2, 2) = 9.0;\n</code></pre>\n\n<p>The <code>&lt;&lt;</code> and the <code>,</code> operators are overloaded to implement that behavior.</p>\n"}], "owner": {"reputation": 3860, "user_id": 6807211, "user_type": "registered", "accept_rate": 7, "profile_image": "https://www.gravatar.com/avatar/3b4e615f42b0a0880467650ae5e229c7?s=128&d=identicon&r=PG&f=1", "display_name": "jingweimo", "link": "https://stackoverflow.com/users/6807211/jingweimo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 56673177, "answer_count": 1, "score": -11, "last_activity_date": 1561030438, "creation_date": 1560965080, "last_edit_date": 1561030438, "question_id": 56673004, "link": "https://stackoverflow.com/questions/56673004/the-meaning-of-the-matrix-operator", "title": "The meaning of the &lt;&lt; matrix operator", "body": "<p>I see some code using <code>&lt;&lt;</code> with <code>Mat_</code> for matrix operations.</p>\n\n<p>Example#A: </p>\n\n<pre><code>cv::Mat_&lt;double&gt; myMat_ = ( cv::Mat_&lt;double&gt;(3, 3) &lt;&lt; \n    1.0, 2.0, 3.0,\n    4.0, 5.0, 6.0,\n    7.0, 8.0, 9.0);\n</code></pre>\n\n<p>Example#B:</p>\n\n<pre><code>cv::Mat myMat = (Mat_&lt;float&gt;(2,3)&lt;&lt;1,skew,-0.5*SZ*skew,0,1,0)\ncv::Mat sampleMat = (Mat_&lt;float&gt;(1,2) &lt;&lt; j,i);\n</code></pre>\n\n<p>What does <code>&lt;&lt;</code> mean in this code? Can anyone educate me a little bit?</p>\n"}, {"tags": ["c++", "sqlite", "qt", "qt5", "qsqlquery"], "answers": [{"comments": [{"owner": {"reputation": 687, "user_id": 1557855, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ccbc2fbb4fade748593da7e45bc20d7c?s=128&d=identicon&r=PG", "display_name": "Ramiro", "link": "https://stackoverflow.com/users/1557855/ramiro"}, "edited": false, "score": 0, "creation_date": 1560974698, "post_id": 56675057, "comment_id": 99917482, "body": "Where is this <code>last_id</code> variable defined?"}, {"owner": {"reputation": 185819, "user_id": 6622587, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gAYS0.jpg?s=128&g=1", "display_name": "eyllanesc", "link": "https://stackoverflow.com/users/6622587/eyllanesc"}, "reply_to_user": {"reputation": 687, "user_id": 1557855, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ccbc2fbb4fade748593da7e45bc20d7c?s=128&d=identicon&r=PG", "display_name": "Ramiro", "link": "https://stackoverflow.com/users/1557855/ramiro"}, "edited": false, "score": 0, "creation_date": 1560974867, "post_id": 56675057, "comment_id": 99917545, "body": "@Ramiro I forgot to erase it, I was doing the function test with several insert, in this case it is not necessary"}], "tags": [], "owner": {"reputation": 185819, "user_id": 6622587, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gAYS0.jpg?s=128&g=1", "display_name": "eyllanesc", "link": "https://stackoverflow.com/users/6622587/eyllanesc"}, "is_accepted": true, "score": 1, "last_activity_date": 1560974813, "last_edit_date": 1560974813, "creation_date": 1560974472, "answer_id": 56675057, "question_id": 56672561, "link": "https://stackoverflow.com/questions/56672561/how-to-get-the-id-from-a-newly-inserted-row-with-qsqlquery-and-sqlite/56675057#56675057", "title": "How to get the ID from a newly inserted row with QSqlQuery and SQLite?", "body": "<p>You have to use the <a href=\"https://doc.qt.io/qt-5/qsqlquery.html#lastInsertId\" rel=\"nofollow noreferrer\"><code>lastInsertId()</code></a> method of <a href=\"https://doc.qt.io/qt-5/qsqlquery.html\" rel=\"nofollow noreferrer\"><code>QSqlQuery</code></a>:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>QSqlDatabase db = QSqlDatabase::database();\nif(db.driver()-&gt;hasFeature(QSqlDriver::LastInsertId)){\n    QSqlQuery insert;\n    bool res = insert.exec(\"INSERT INTO T (f) VALUES (0)\");\n    Q_ASSERT(res);\n\n    QVariant id = insert.lastInsertId();\n    Q_ASSERT(id.isValid() &amp;&amp; !id.isNull());\n    qDebug() &lt;&lt; id.toInt();\n}\n</code></pre>\n"}], "owner": {"reputation": 687, "user_id": 1557855, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ccbc2fbb4fade748593da7e45bc20d7c?s=128&d=identicon&r=PG", "display_name": "Ramiro", "link": "https://stackoverflow.com/users/1557855/ramiro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 56675057, "answer_count": 1, "score": 1, "last_activity_date": 1561124547, "creation_date": 1560963212, "last_edit_date": 1561124547, "question_id": 56672561, "link": "https://stackoverflow.com/questions/56672561/how-to-get-the-id-from-a-newly-inserted-row-with-qsqlquery-and-sqlite", "title": "How to get the ID from a newly inserted row with QSqlQuery and SQLite?", "body": "<p>I have a table <code>T</code> that has an field <code>id</code>, which is an <code>INTEGER PRIMARY KEY AUTOINCREMENT</code>, and a <code>INTEGER</code> field <code>f</code>. With Qt5 I insert a row with the following code:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>QSqlQuery insert;\ninsert.exec(\"INSERT INTO T (f) VALUES (0)\");\n</code></pre>\n\n<p>But how do I get the <code>id</code> of the newly inserted field?</p>\n"}, {"tags": ["c++", "c++17", "stdoptional"], "comments": [{"owner": {"reputation": 4939, "user_id": 6292621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a024e1125c7f69a49d7f1a4861d7b63?s=128&d=identicon&r=PG&f=1", "display_name": "lorro", "link": "https://stackoverflow.com/users/6292621/lorro"}, "edited": false, "score": 0, "creation_date": 1560961158, "post_id": 56671989, "comment_id": 99911521, "body": "Re: <code>has_value()</code> remained <code>true</code>: this depends on <code>f()</code>. Do you actually alter <code>a</code> in <code>f()</code>?"}, {"owner": {"reputation": 245138, "user_id": 2069064, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/e4V2X.jpg?s=128&g=1", "display_name": "Barry", "link": "https://stackoverflow.com/users/2069064/barry"}, "reply_to_user": {"reputation": 4939, "user_id": 6292621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a024e1125c7f69a49d7f1a4861d7b63?s=128&d=identicon&r=PG&f=1", "display_name": "lorro", "link": "https://stackoverflow.com/users/6292621/lorro"}, "edited": false, "score": 1, "creation_date": 1560963498, "post_id": 56671989, "comment_id": 99912503, "body": "@lorro It actually does not depend on <code>f</code> -- note that <code>f</code> gets an <code>A</code>, it doesn&#39;t get <code>optA</code>. <code>has_value()</code> would only change if <code>f</code> somehow accessed <code>optA</code> directly (as a global?)"}, {"owner": {"reputation": 4939, "user_id": 6292621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a024e1125c7f69a49d7f1a4861d7b63?s=128&d=identicon&r=PG&f=1", "display_name": "lorro", "link": "https://stackoverflow.com/users/6292621/lorro"}, "reply_to_user": {"reputation": 245138, "user_id": 2069064, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/e4V2X.jpg?s=128&g=1", "display_name": "Barry", "link": "https://stackoverflow.com/users/2069064/barry"}, "edited": false, "score": 0, "creation_date": 1560966210, "post_id": 56671989, "comment_id": 99913723, "body": "@Barry : after moving out from an optional itself, it is in a valid but indetermined state (to my knowledge). Your implementation might leaveit as-is. Or it might set it to nullopt. Or any global value - highly unrealistic but possible, esp. with aggregate types. On contrary, when you access value(), it is guaranteed that the optional is kept as-is b/c it\u2019s a non-movable reference."}, {"owner": {"reputation": 245138, "user_id": 2069064, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/e4V2X.jpg?s=128&g=1", "display_name": "Barry", "link": "https://stackoverflow.com/users/2069064/barry"}, "reply_to_user": {"reputation": 4939, "user_id": 6292621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a024e1125c7f69a49d7f1a4861d7b63?s=128&d=identicon&r=PG&f=1", "display_name": "lorro", "link": "https://stackoverflow.com/users/6292621/lorro"}, "edited": false, "score": 0, "creation_date": 1560966508, "post_id": 56671989, "comment_id": 99913870, "body": "@lorro Nothing here is moving out of the optional."}, {"owner": {"reputation": 4939, "user_id": 6292621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a024e1125c7f69a49d7f1a4861d7b63?s=128&d=identicon&r=PG&f=1", "display_name": "lorro", "link": "https://stackoverflow.com/users/6292621/lorro"}, "reply_to_user": {"reputation": 245138, "user_id": 2069064, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/e4V2X.jpg?s=128&g=1", "display_name": "Barry", "link": "https://stackoverflow.com/users/2069064/barry"}, "edited": false, "score": 0, "creation_date": 1560966582, "post_id": 56671989, "comment_id": 99913892, "body": "@Barry : std::move(optA).value() will choose value() &amp;&amp; over value()."}, {"owner": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "reply_to_user": {"reputation": 4939, "user_id": 6292621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a024e1125c7f69a49d7f1a4861d7b63?s=128&d=identicon&r=PG&f=1", "display_name": "lorro", "link": "https://stackoverflow.com/users/6292621/lorro"}, "edited": false, "score": 2, "creation_date": 1560968351, "post_id": 56671989, "comment_id": 99914685, "body": "@lorro Which moves a value stored in the optional.  It doesn&#39;t move the optional.  It is akin to <code>std::vector&lt;Type&gt; foo(100); auto x = std::move(foo[0]);</code> vs <code>auto y = std::move(foo);</code> -- one moves something stored in the vector, the other moves the vector.  All of the operations are moving something <i>stored in</i> the optional, none move the optional."}, {"owner": {"reputation": 4939, "user_id": 6292621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a024e1125c7f69a49d7f1a4861d7b63?s=128&d=identicon&r=PG&f=1", "display_name": "lorro", "link": "https://stackoverflow.com/users/6292621/lorro"}, "reply_to_user": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "edited": false, "score": 0, "creation_date": 1560970686, "post_id": 56671989, "comment_id": 99915778, "body": "@Yakk-AdamNevraumont: Can you please point me where the standard says that <code>std::optional&lt;T&gt;::value() &amp;&amp;</code> (note the <code>&amp;&amp;</code>) guarantees that <code>*this</code> is not empty after the call (i.e., that it does not flip the flag to describe if it&#39;s empty - note that it does not have to be the same flag as to destruct or not the object in the storage)? My current knowledge is that <code>value() &amp;&amp;</code> guarantees that the <code>optional</code> is in valid-but-indeterminate state, while <code>value()</code> guarantees that it remains non-empty <i>and</i> the contained object is in valid-but-indeterminate state."}, {"owner": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "reply_to_user": {"reputation": 4939, "user_id": 6292621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a024e1125c7f69a49d7f1a4861d7b63?s=128&d=identicon&r=PG&f=1", "display_name": "lorro", "link": "https://stackoverflow.com/users/6292621/lorro"}, "edited": false, "score": 0, "creation_date": 1560971139, "post_id": 56671989, "comment_id": 99915969, "body": "@lorro 23.6.3.5 [optional.observe]/16?  As in, the spot where <code>value()&amp;&amp;</code> is defined?  &quot;Equivalent to <code>return bool(*this) ? std::move(*val) : throw bad_optional_access()</code>&quot;.  <code>operator*</code> does not disengage the <code>optional</code>, and moving from the data within the optional may not change the engagement state of the optional.  I could find the bit where &quot;the standard library is not allowed to mess with you&quot;, but there is a general rule that when you interact with object A you cannot mess with object B unless the standard says so."}, {"owner": {"reputation": 4939, "user_id": 6292621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a024e1125c7f69a49d7f1a4861d7b63?s=128&d=identicon&r=PG&f=1", "display_name": "lorro", "link": "https://stackoverflow.com/users/6292621/lorro"}, "reply_to_user": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "edited": false, "score": 0, "creation_date": 1560971381, "post_id": 56671989, "comment_id": 99916077, "body": "@Yakk-AdamNevraumont : Thx, TIL something. So in this case the above can&#39;t be done by the compiler and thus the optional will keep its value (if it had one). Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 91345, "user_id": 481267, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/DMvoo.png?s=128&g=1", "display_name": "Brian Bi", "link": "https://stackoverflow.com/users/481267/brian-bi"}, "is_accepted": true, "score": 4, "last_activity_date": 1560980287, "last_edit_date": 1560980287, "creation_date": 1560961824, "answer_id": 56672215, "question_id": 56671989, "link": "https://stackoverflow.com/questions/56671989/stdoptional-effective-difference-between-simple-and-ref-qualified-value/56672215#56672215", "title": "std::optional: Effective difference between simple and ref-qualified value()", "body": "<p>There's no difference between <code>std::move(optA).value()</code> and <code>std::move(optA.value())</code>. <code>value()</code> just returns a glvalue referring to the contained value, and either you can have <code>value()</code> return an lvalue which is then converted to an xvalue by <code>std::move</code>, or you can call <code>std::move</code> first and have <code>value()</code> give you an xvalue right away (in reality, the conversion from lvalue to xvalue will be occurring somewhere within the <code>value()</code> method itself). The ref-qualified overloads are obviously not very useful in this simple case, but can be useful when the optional was passed by forwarding reference <code>O&amp;&amp; o</code>, and you want <code>std::forward&lt;O&gt;(o).value()</code> to \"do the right thing\".</p>\n"}, {"comments": [{"owner": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "edited": false, "score": 0, "creation_date": 1560968126, "post_id": 56672374, "comment_id": 99914596, "body": "Your first sentence doesn&#39;t make sense.  <code>std::move</code> does not move.  <code>std::move(x)</code> <b>does not move x</b>.  Stating that the OP &quot;moved out&quot; <code>optA</code> doesn&#39;t make sense (or, more accurately, is false).  You clarify later, but you start out with something that isn&#39;t true.  Confusing the issue with false statements isn&#39;t a great plan for an answer."}, {"owner": {"reputation": 15204, "user_id": 453271, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/G7rcK.png?s=128&g=1", "display_name": "Andriy Tylychko", "link": "https://stackoverflow.com/users/453271/andriy-tylychko"}, "reply_to_user": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "edited": false, "score": 0, "creation_date": 1560974182, "post_id": 56672374, "comment_id": 99917267, "body": "@Yakk-AdamNevraumont: and you blame me? they called it <code>move</code> after all :) I tried to paraphrase the answer, and failed"}], "tags": [], "owner": {"reputation": 15204, "user_id": 453271, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/G7rcK.png?s=128&g=1", "display_name": "Andriy Tylychko", "link": "https://stackoverflow.com/users/453271/andriy-tylychko"}, "is_accepted": false, "score": 3, "last_activity_date": 1560974110, "last_edit_date": 1560974110, "creation_date": 1560962469, "answer_id": 56672374, "question_id": 56671989, "link": "https://stackoverflow.com/questions/56671989/stdoptional-effective-difference-between-simple-and-ref-qualified-value/56672374#56672374", "title": "std::optional: Effective difference between simple and ref-qualified value()", "body": "<pre><code>f(std::move(optA).value()); // OPTION 1\n</code></pre>\n\n<p>You \"moved\" <code>optA</code>, but this doesn't mean you changed it. Usually you shouldn't use value after it was \"moved out\", as it's in a valid but indeterminate state. <code>std::move</code> is just a type cast (exactly same as <code>static_cast&lt;A&amp;&amp;&gt;(optA)</code>). Moving constructor wasn't called because no new instance of <code>std::optional&lt;A&gt;</code> was created. Hence <code>has_value</code> returns <code>true</code>. </p>\n\n<p>In this case <code>T &amp;&amp; value() &amp;&amp;</code> is called indeed. </p>\n\n<pre><code>f(std::move(optA.value())); // OPTION 2\n</code></pre>\n\n<p><code>T &amp;&amp; value() &amp;&amp;</code> is not called here, because <code>optA</code> is not <code>&amp;&amp;</code>. So you get <code>A&amp;</code> and cast it to <code>A&amp;&amp;</code> by <code>std::move</code>, then pass to <code>f</code> which presumably does nothing. <code>optA</code> wasn't changed and still reports that it contains value.</p>\n"}, {"tags": [], "owner": {"reputation": 374849, "user_id": 734069, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a356923f858fbe363dad1dc566837fc6?s=128&d=identicon&r=PG", "display_name": "Nicol Bolas", "link": "https://stackoverflow.com/users/734069/nicol-bolas"}, "is_accepted": false, "score": 1, "last_activity_date": 1560971471, "creation_date": 1560971471, "answer_id": 56674393, "question_id": 56671989, "link": "https://stackoverflow.com/questions/56671989/stdoptional-effective-difference-between-simple-and-ref-qualified-value/56674393#56674393", "title": "std::optional: Effective difference between simple and ref-qualified value()", "body": "<blockquote>\n  <p>Is there any possible situation where value() &amp;&amp; makes a difference over std::move and value()?</p>\n</blockquote>\n\n<p>Consider the following:</p>\n\n<pre><code>optional&lt;A&gt; func() {...}\n\nvoid f(optional&lt;A&gt; opt) {...}\nvoid g(A a) {...}\n\nf(func());\ng(func().value());\n</code></pre>\n\n<p><code>f</code>'s <code>opt</code> parameter will be initialized by move. Well technically, it will be initialized directly by the prvalue, but pre-C++17 means that it gets move-initialized. That initialization can get elided, but if it isn't, then it is done via move. Always.</p>\n\n<p>But what about <code>g</code>'s parameter? What should happen? Well, consider what this would do:</p>\n\n<pre><code>struct C {string s;};\nC func2() {...}\n\nvoid h(string s);\n\nh(func2().s);\n</code></pre>\n\n<p>The parameter of <code>h</code> is initialized by <em>move</em>. Why? Because if you access a member subobject of a prvalue, the resulting expression is an xvalue, and is therefore eligible for movement without explicitly using <code>std::move</code>.</p>\n\n<p>The <code>&amp;&amp;</code> constructor of <code>optional</code> ensures that <code>value</code> works the same way. If you call it on a prvalue temporary, then it will return an xvalue, which can be moved from without an explicit <code>std::move</code> call. So in the original case, <code>g</code>'s parameter is initialized by move, exactly as it would have if it were accessing a member subobject of a prvalue.</p>\n"}, {"tags": [], "owner": {"reputation": 10055, "user_id": 2466431, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/gSQh3.png?s=128&g=1", "display_name": "JVApen", "link": "https://stackoverflow.com/users/2466431/jvapen"}, "is_accepted": false, "score": 0, "last_activity_date": 1560973141, "creation_date": 1560973141, "answer_id": 56674752, "question_id": 56671989, "link": "https://stackoverflow.com/questions/56671989/stdoptional-effective-difference-between-simple-and-ref-qualified-value/56674752#56674752", "title": "std::optional: Effective difference between simple and ref-qualified value()", "body": "<p>I would assume both versions are the same, however, the answer of Nicol Bolas looks interesting.</p>\n\n<p>Assuming they both result in an rvalue and the code doesn't matter, we don't have a reason to ignore readability.</p>\n\n<pre><code>  std::move(optA).value()\n</code></pre>\n\n<p>This suggests that you move the variable and you rely on the writer of the class to provide the right overloads. If missing, you might miss out.</p>\n\n<p>Some linters also recognize this as variable that no longer should be touched, preventing you from use-after-move.</p>\n\n<pre><code>std::move(optA.value())\n</code></pre>\n\n<p>This however converts the return value to an rvalue. I mostly consider this code as a bug. Either the function returns by value (or const reference) and we wrote to much code. Otherwise, the function returns an lvalue and you potentially ruined the internal state of the variable.</p>\n\n<p>With this, I recommend to consistently move the variable and trigger the move of a function call as a code smell. (Even for std::optional, where it shouldn't matter)</p>\n"}], "owner": {"reputation": 14718, "user_id": 163454, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/bdef8bbea2467810a6a8164fc41db6e7?s=128&d=identicon&r=PG", "display_name": "Notinlist", "link": "https://stackoverflow.com/users/163454/notinlist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "accepted_answer_id": 56672215, "answer_count": 4, "score": 1, "last_activity_date": 1560980287, "creation_date": 1560960841, "question_id": 56671989, "link": "https://stackoverflow.com/questions/56671989/stdoptional-effective-difference-between-simple-and-ref-qualified-value", "title": "std::optional: Effective difference between simple and ref-qualified value()", "body": "<p>This is an academic question. The <code>std::optional&lt;T&gt;</code> type has a <code>T &amp;&amp; value() &amp;&amp;</code> method. I have the following definitions:</p>\n\n<pre><code>class A { ... };\nvoid f(A &amp;&amp;a);\n</code></pre>\n\n<p>And the following program:</p>\n\n<pre><code>std::optional&lt;A&gt; optA;\noptA = A(1337);\nf(std::move(optA).value()); // OPTION 1\nf(std::move(optA.value())); // OPTION 2\nstd::cout &lt;&lt; optA.has_value() &lt;&lt; std::endl;\n</code></pre>\n\n<p>Is there any meaningful difference between OPTION 1 and OPTION 2? For OPTION 1 will I have <code>1</code>, <code>0</code> or unspecified as output? According to my tests has_value() remained true in both cases.</p>\n\n<p>Is there any possible situation where <code>value() &amp;&amp;</code> makes a difference over <code>std::move</code> and <code>value()</code>?</p>\n"}, {"tags": ["c++", "http", "indy", "indy10", "c++builder-xe7"], "comments": [{"owner": {"reputation": 5074, "user_id": 5522303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c236ba3d52af53355a4d1a44a5145b04?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/5522303/kevin"}, "edited": false, "score": 1, "creation_date": 1560960689, "post_id": 56671908, "comment_id": 99911336, "body": "What does your debugger tell you? Also, I don&#39;t see why you need to use <code>new</code> and <code>delete</code> here."}, {"owner": {"reputation": 29, "user_id": 2532027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7319a4f8205548208e28e6bb67f5b80e?s=128&d=identicon&r=PG", "display_name": "Jonathan Wiens", "link": "https://stackoverflow.com/users/2532027/jonathan-wiens"}, "reply_to_user": {"reputation": 5074, "user_id": 5522303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c236ba3d52af53355a4d1a44a5145b04?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/5522303/kevin"}, "edited": false, "score": 0, "creation_date": 1560960907, "post_id": 56671908, "comment_id": 99911430, "body": "@Kevin I haven&#39;t been able to replicate the problem in the debugger."}, {"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 0, "creation_date": 1560960911, "post_id": 56671908, "comment_id": 99911431, "body": "<i>&quot;I&#39;m using C++Builder XE7&quot;</i> That&#39;s quite old."}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 1, "creation_date": 1560961083, "post_id": 56671908, "comment_id": 99911491, "body": "There is no need to assign an <code>Owner</code> if you are going to manage the lifetime manually, <i>especially</i> if the <code>Owner</code> belongs to another thread. The RTL&#39;s object ownership model is not thread-safe. Set the <code>Owner</code> to NULL, and use a smart pointer (<code>std::auto_ptr</code> prior to C++11, <code>std::unique_ptr</code> in C++11 onwards). After making that change, if you are still getting the AV, the error message suggests a NULL pointer is being accessed, so debug your code to find it. You have the exact address of the code that causes the AV, jump to that address in the debugger and look at what code is running there"}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1560961171, "post_id": 56671908, "comment_id": 99911529, "body": "Based on the address, I would guess that you&#39;re accessing something through a null pointer. The two most likely culprits are lack of synchronisation and flawed lifetime management. Actually, since you can&#39;t replicate in debug, the <i>three</i> most likely culprits are uninitialised variables and the two previous factors."}], "answers": [{"tags": [], "owner": {"reputation": 29, "user_id": 2532027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7319a4f8205548208e28e6bb67f5b80e?s=128&d=identicon&r=PG", "display_name": "Jonathan Wiens", "link": "https://stackoverflow.com/users/2532027/jonathan-wiens"}, "is_accepted": false, "score": 0, "last_activity_date": 1561391346, "creation_date": 1561391346, "answer_id": 56740067, "question_id": 56671908, "link": "https://stackoverflow.com/questions/56671908/periodic-access-violations-when-setting-up-a-tidhttp-object/56740067#56740067", "title": "Periodic Access Violations when setting up a TIdHTTP object", "body": "<p>As per the comment by Remy Lebeau, the solution was to remove the owner from the TIdHTTP object:</p>\n\n<p>Change </p>\n\n<pre><code>TIdHTTP* httpClient = new TIdHTTP(Application-&gt;MainForm);\n</code></pre>\n\n<p>to </p>\n\n<pre><code>TIdHTTP* httpClient = new TIdHTTP(NULL);\n</code></pre>\n"}], "owner": {"reputation": 29, "user_id": 2532027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7319a4f8205548208e28e6bb67f5b80e?s=128&d=identicon&r=PG", "display_name": "Jonathan Wiens", "link": "https://stackoverflow.com/users/2532027/jonathan-wiens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 47, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1561391346, "creation_date": 1560960471, "last_edit_date": 1560960995, "question_id": 56671908, "link": "https://stackoverflow.com/questions/56671908/periodic-access-violations-when-setting-up-a-tidhttp-object", "title": "Periodic Access Violations when setting up a TIdHTTP object", "body": "<p>I'm struggling with periodic access violations when setting up a TIdHTTP object.  I'm using the following code:</p>\n\n<pre><code>TIdHTTP* httpClient = new TIdHTTP(Application-&gt;MainForm);\nhttpClient-&gt;HTTPOptions = (httpClient-&gt;HTTPOptions &gt;&gt; hoForceEncodeParams);\nhttpClient-&gt;HTTPOptions = (httpClient-&gt;HTTPOptions &lt;&lt; hoKeepOrigProtocol);\nhttpClient-&gt;HTTPOptions = (httpClient-&gt;HTTPOptions &lt;&lt; hoInProcessAuth);\nhttpClient-&gt;Request-&gt;ContentType = L\"application/json\";\nhttpClient-&gt;Request-&gt;CharSet = L\"UTF-8\";\n\nTIdSSLIOHandlerSocketOpenSSL* sslIOHandler = new TIdSSLIOHandlerSocketOpenSSL;\nsslIOHandler-&gt;SSLOptions-&gt;SSLVersions = TIdSSLVersions() &lt;&lt; sslvTLSv1 &lt;&lt; sslvTLSv1_1 &lt;&lt; sslvTLSv1_2;\n\nhttpClient-&gt;IOHandler = sslIOHandler;\n\nhttpClient-&gt;Request-&gt;BasicAuthentication = false;\nhttpClient-&gt;Request-&gt;Authentication = new TIdSSPINTLMAuthentication;\nhttpClient-&gt;Request-&gt;Username = connectionInfo-&gt;AuthUsername;\nhttpClient-&gt;Request-&gt;Password = connectionInfo-&gt;AuthPassword;\n\n// Make a request from a REST API\n\ndelete sslIOHandler;\ndelete httpClient;\n</code></pre>\n\n<p>This code runs in a thread (TThread).  There could be several threads active at any given time, making seperate requests.  As each request is completed, the thread is destroyed.</p>\n\n<p>This code works <em>most of the time</em>, but after running for a seemingly random amount of time will start throwing access violations, usually in the form:</p>\n\n<pre><code>Access violation at address 5016C927 in module 'rtl210.bpl'. Read of address 00000008\n</code></pre>\n\n<p>Once access violations start, all subsequent threads will throw similar access violations.  The only way to get things back on track is to shutdown the application and restart.</p>\n\n<p>I'm using C++Builder XE7, with the version of Indy which shipped with the compiler (Indy 10.6.1.5182 ???)</p>\n\n<p>So far I have been unable to replicate this problem in the debugger to get any additional information.</p>\n\n<p>Any ideas what might be causing the access violation?</p>\n"}, {"tags": ["c++", "code-coverage", "lcov"], "comments": [{"owner": {"reputation": 22818, "user_id": 1387438, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/ad806758c356c915ea08a4bfd79131e3?s=128&d=identicon&r=PG", "display_name": "Marek R", "link": "https://stackoverflow.com/users/1387438/marek-r"}, "edited": false, "score": 3, "creation_date": 1560958524, "post_id": 56671342, "comment_id": 99910227, "body": "there is no code to execute in this lines. Why are you surprised? It is more important that LCOV do not shows <code>0</code> for any line."}, {"owner": {"reputation": 22818, "user_id": 1387438, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/ad806758c356c915ea08a4bfd79131e3?s=128&d=identicon&r=PG", "display_name": "Marek R", "link": "https://stackoverflow.com/users/1387438/marek-r"}, "edited": false, "score": 0, "creation_date": 1560958741, "post_id": 56671342, "comment_id": 99910333, "body": "The only line you can have doubts is line <code>13</code>. Note that your <code>domath</code> class has trivial constructor. There is noting to do in constructor so respective code is not generated. As a result there is nothing to measure in line <code>13</code> too."}, {"owner": {"reputation": 73, "user_id": 11535226, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-R_-orOcgd3Y/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdo6DQ7RGaNqsXE0iKpAf9IjX9vLw/mo/photo.jpg?sz=128", "display_name": "Weiyu He", "link": "https://stackoverflow.com/users/11535226/weiyu-he"}, "reply_to_user": {"reputation": 22818, "user_id": 1387438, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/ad806758c356c915ea08a4bfd79131e3?s=128&d=identicon&r=PG", "display_name": "Marek R", "link": "https://stackoverflow.com/users/1387438/marek-r"}, "edited": false, "score": 0, "creation_date": 1560961717, "post_id": 56671342, "comment_id": 99911762, "body": "But then why is line 19 and 27 counts as a executed line?"}, {"owner": {"reputation": 1636, "user_id": 3370124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73352b4adb282c092738f34883488dd?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Critten", "link": "https://stackoverflow.com/users/3370124/richard-critten"}, "edited": false, "score": 0, "creation_date": 1560973750, "post_id": 56671342, "comment_id": 99917089, "body": "Function returns <code>return</code> or just <code>}</code> generate code. Unwinding the stack frame, doing the return to the caller etc.  Note the coverage on lines 12 and 22 for function entry."}], "owner": {"reputation": 73, "user_id": 11535226, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-R_-orOcgd3Y/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdo6DQ7RGaNqsXE0iKpAf9IjX9vLw/mo/photo.jpg?sz=128", "display_name": "Weiyu He", "link": "https://stackoverflow.com/users/11535226/weiyu-he"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 88, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1560958394, "creation_date": 1560958394, "question_id": 56671342, "link": "https://stackoverflow.com/questions/56671342/why-is-lcov-ignoring-lines", "title": "Why is LCOV ignoring lines?", "body": "<p>I tried running code coverage to see how good my test cases is. Then I found out there are some lines that got ignored by LCOV, like line 6,7,10,13 below. Why does LCOV does not take these into account when lines like line 6 (<code>class domain {</code> ) clearly ran during the test.</p>\n\n<pre><code>   1             : #include \"ros/ros.h\"\n   2             : #include \"gtest/gtest.h\"\n   3             : \n   4             : \n   5             : \n   6             : class domath {\n   7             :         public:\n   8           1 :                 int multiply(int a, int b) {return a * b;}\n   9             : \n  10             : };\n  11             : \n  12           5 : TEST(TestSuite, multiply_test_case1){\n  13             :         domath math1;\n  14           1 :         int a = 3;\n  15           1 :         int b = 4;\n  16           1 :         int c = math1.multiply(a,b);\n  17           1 :         EXPECT_EQ(c,12) &lt;&lt; \"value should be 12\";\n  18             : \n  19           1 : }\n  20             : \n  21             : \n  22           1 : int main(int argc, char **argv){\n  23             : \n  24           1 :         testing::InitGoogleTest(&amp;argc , argv);\n  25           1 :         return RUN_ALL_TESTS();\n  26             : \n  27           3 : }\n  28             : \n</code></pre>\n"}, {"tags": ["c++", "qt", "qml"], "comments": [{"owner": {"reputation": 861, "user_id": 4156301, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-jZcC1Xqf-d4/AAAAAAAAAAI/AAAAAAAAAKg/Px0JaE_dlVk/photo.jpg?sz=128", "display_name": "SilvanoCerza", "link": "https://stackoverflow.com/users/4156301/silvanocerza"}, "edited": false, "score": 0, "creation_date": 1560959016, "post_id": 56671191, "comment_id": 99910491, "body": "Have you tried to set <code>contentY</code> to its previous value after the model data changed?"}, {"owner": {"reputation": 2669, "user_id": 1228771, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SF8S5.png?s=128&g=1", "display_name": "Amfasis", "link": "https://stackoverflow.com/users/1228771/amfasis"}, "edited": false, "score": 0, "creation_date": 1561014038, "post_id": 56671191, "comment_id": 99927160, "body": "I think your problem might be solved in a better way, by actually inserting/removing the rows instead of resetting the model. Is this a possibility in your code?"}, {"owner": {"reputation": 1544, "user_id": 6475652, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/8d783a89da27c7d36c0935fc2af7b38e?s=128&d=identicon&r=PG&f=1", "display_name": "Fryz", "link": "https://stackoverflow.com/users/6475652/fryz"}, "edited": false, "score": 0, "creation_date": 1561034558, "post_id": 56671191, "comment_id": 99937947, "body": "Unfortunately it&#39;s not possible"}], "answers": [{"comments": [{"owner": {"reputation": 1544, "user_id": 6475652, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/8d783a89da27c7d36c0935fc2af7b38e?s=128&d=identicon&r=PG&f=1", "display_name": "Fryz", "link": "https://stackoverflow.com/users/6475652/fryz"}, "edited": false, "score": 0, "creation_date": 1561034820, "post_id": 56671687, "comment_id": 99938110, "body": "It does not work even though the slot are actually called"}], "tags": [], "owner": {"reputation": 861, "user_id": 4156301, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-jZcC1Xqf-d4/AAAAAAAAAAI/AAAAAAAAAKg/Px0JaE_dlVk/photo.jpg?sz=128", "display_name": "SilvanoCerza", "link": "https://stackoverflow.com/users/4156301/silvanocerza"}, "is_accepted": false, "score": 1, "last_activity_date": 1560959625, "creation_date": 1560959625, "answer_id": 56671687, "question_id": 56671191, "link": "https://stackoverflow.com/questions/56671191/qml-listview-default-behavior-when-model-is-updated/56671687#56671687", "title": "QML ListView default behavior when model is updated", "body": "<p>Add this inside your <code>ListView</code>, any time the model data changes you reset the <code>contentY</code> property. Here I'm assuming <code>contentX</code> doesn't change.</p>\n\n<pre><code>property real previousContentY\n\nConnections {\n    target: model\n    onModelAboutToBeReset: view.previousContentY = view.contentY\n    onModelReset: view.contentY = view.previousContentY\n}\n</code></pre>\n\n<p>And you probably want to also add <code>snapMode: ListView.SnapToItem</code> if you want to show only certain items.</p>\n"}, {"tags": [], "owner": {"reputation": 1731, "user_id": 4503757, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b601ab4a895e9d814b2ebe797632637?s=128&d=identicon&r=PG&f=1", "display_name": "augre", "link": "https://stackoverflow.com/users/4503757/augre"}, "is_accepted": false, "score": 1, "last_activity_date": 1561021268, "creation_date": 1561021268, "answer_id": 56682514, "question_id": 56671191, "link": "https://stackoverflow.com/questions/56671191/qml-listview-default-behavior-when-model-is-updated/56682514#56682514", "title": "QML ListView default behavior when model is updated", "body": "<p>A solution can be to wrap <code>ListView</code> with an external <code>Flickable</code> that will be responsible for the scroll.</p>\n\n<p>This solution does not require to manually reset the previous <code>ListView</code> <code>contentY</code>, since the scroll position is not dependant on the <code>ListView</code> itself anymore.</p>\n\n<p>Here is a basic working example:</p>\n\n<pre><code>Button {\n    id: button\n    text: 'change model'\n    onClicked: view.aModel = !view.aModel\n}\n\nFlickable {\n    anchors.top: button.bottom\n    width: parent.width\n    height: 100\n    interactive: true // the scroll will be managed by this external Flickable\n    contentHeight: view.contentHeight\n    clip: true\n\n    ListView {\n        id: view\n        property bool aModel: true\n        anchors.fill: parent\n        interactive: false // deactivate scroll on the internal Flickable\n        model: aModel\n               ? [\"a\", \"a\", \"a\", \"a\", \"a\", \"a\", \"a\", \"a\", \"a\", \"a\", \"a\", \"a\", \"a\", \"a\"]\n               : [\"b\", \"b\", \"b\", \"b\", \"b\", \"b\", \"b\", \"b\", \"b\", \"b\", \"b\", \"b\", \"b\", \"b\"]\n        delegate: Text {\n            width: parent.width\n            height: 20\n            text: modelData + index\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1544, "user_id": 6475652, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/8d783a89da27c7d36c0935fc2af7b38e?s=128&d=identicon&r=PG&f=1", "display_name": "Fryz", "link": "https://stackoverflow.com/users/6475652/fryz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 785, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1561034947, "creation_date": 1560957909, "last_edit_date": 1561034947, "question_id": 56671191, "link": "https://stackoverflow.com/questions/56671191/qml-listview-default-behavior-when-model-is-updated", "title": "QML ListView default behavior when model is updated", "body": "<p>I have the following <code>ListView</code> that always show the beginning of the list when the <code>QStringListModel</code> is updated by using <code>setStringList</code> on the C++ side. </p>\n\n<p>For example, the user can scroll up and down in the view, and when the model is updated, the view goes back to the beginning of the list.</p>\n\n<p>How to disable this behavior ? </p>\n\n<p>Also i need the view to display exactly X items ( 2 in my example ) at once. The view is not in itself scrollable ( <code>interactive: false</code> ) but the user can navigate the list by clicking up and down <code>Button</code>'s somewhere in the UI. </p>\n\n<p>Is there a suitable approach for that ? ( following <a href=\"https://stackoverflow.com/questions/28941043/is-it-possible-to-show-only-certain-indexes-of-a-qml-listview\">Is it possible to show only certain indexes of a QML listview?</a> ) </p>\n\n<p><strong>EDIT :</strong> i have added 2 functions for the \"up/down\" problem and it seems to work as expected but i am still interesting to know if there is a better way.</p>\n\n<p>Thank you.</p>\n\n<pre><code>        ListView {\n            id: view\n            anchors.top = parent.top\n            anchors.left = parent.left\n            readonly property int visibleItems: 2\n            readonly property int itemHeight: 20\n            height: visibleItems * itemHeight\n            width: 100\n            clip: true\n\n            model: listModel // a QStringListModel\n\n            delegate: Rectangle {\n                border.width: 1\n                border.color: \"black\"\n                height: view.itemHeight\n                width: 100\n                Text { text: model.display }\n            }\n\n            interactive: false\n\n            function up() {\n                var currentTopIndex =  indexAt(view.width / 2, contentY)\n\n                if (currentTopIndex !== -1) {\n\n                    var newTopIndex = currentTopIndex - view.visibleItems\n\n                    if (newTopIndex &gt;= 0)\n                        view.positionViewAtIndex(newTopIndex, ListView.Beginning)\n                 }\n            }\n\n            function down() {\n                var currentTopIndex =  indexAt(view.width / 2, contentY)\n\n                if (currentTopIndex !== -1) {\n\n                    var newTopIndex = currentTopIndex + view.visibleItems\n\n                    if (newTopIndex &lt; view.count)\n                        view.positionViewAtIndex(newTopIndex, ListView.Beginning)\n                 }\n            }\n</code></pre>\n"}, {"tags": ["c++", "stl", "std", "boyer-moore"], "comments": [{"owner": {"reputation": 55059, "user_id": 212858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1166c87b6f3fc2e6746da96b60fefb46?s=128&d=identicon&r=PG", "display_name": "Useless", "link": "https://stackoverflow.com/users/212858/useless"}, "edited": false, "score": 0, "creation_date": 1560957721, "post_id": 56671106, "comment_id": 99909712, "body": "Did you enable C++17? Because the doc you linked says it&#39;s a C++17 feature."}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1560957758, "post_id": 56671106, "comment_id": 99909737, "body": "<a href=\"https://devblogs.microsoft.com/cppblog/cpp17-20-features-and-fixes-in-vs-2019/\" rel=\"nofollow noreferrer\">this info page</a> suggests that VS 16.0 does include it, maybe you need to enable c++17 support ?"}, {"owner": {"reputation": 9602, "user_id": 7151494, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-a_FzvY-b2O0/AAAAAAAAAAI/AAAAAAAAAEw/kNwilSAvQTI/photo.jpg?sz=128", "display_name": "Fureeish", "link": "https://stackoverflow.com/users/7151494/fureeish"}, "edited": false, "score": 0, "creation_date": 1560958176, "post_id": 56671106, "comment_id": 99910030, "body": "Can you clarify your second question? What do you mean by <i>jump table</i>?"}, {"owner": {"reputation": 2528, "user_id": 4658169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b351ed2ce7ddde5ab5ac9bd96200a62d?s=128&d=identicon&r=PG&f=1", "display_name": "CuriouslyRecurringThoughts", "link": "https://stackoverflow.com/users/4658169/curiouslyrecurringthoughts"}, "edited": false, "score": 0, "creation_date": 1560958839, "post_id": 56671106, "comment_id": 99910391, "body": "You can try <a href=\"https://godbolt.org/\" rel=\"nofollow noreferrer\">godbolt.org</a> an online compiler to check. Be careful because the compiler switch for c++17 for msvc and the one for GCC/clang are different."}, {"owner": {"reputation": 59348, "user_id": 522663, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/OKOEw.png?s=128&g=1", "display_name": "Jonathan Wood", "link": "https://stackoverflow.com/users/522663/jonathan-wood"}, "reply_to_user": {"reputation": 9602, "user_id": 7151494, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-a_FzvY-b2O0/AAAAAAAAAAI/AAAAAAAAAEw/kNwilSAvQTI/photo.jpg?sz=128", "display_name": "Fureeish", "link": "https://stackoverflow.com/users/7151494/fureeish"}, "edited": false, "score": 0, "creation_date": 1560959588, "post_id": 56671106, "comment_id": 99910804, "body": "@Fureeish: The Boyer Moore Algorithm requires that a jump table is created so that the algorithm knows how many characters it can skip when it finds a mismatch."}, {"owner": {"reputation": 17343, "user_id": 445976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c82b2b9bdcf1baaf4677238d59cf745f?s=128&d=identicon&r=PG", "display_name": "Blastfurnace", "link": "https://stackoverflow.com/users/445976/blastfurnace"}, "edited": false, "score": 0, "creation_date": 1560959877, "post_id": 56671106, "comment_id": 99910943, "body": "Have you enabled C++17 features with the <code>&#47;std:c++17</code> option or project properties?"}], "answers": [{"comments": [{"owner": {"reputation": 59348, "user_id": 522663, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/OKOEw.png?s=128&g=1", "display_name": "Jonathan Wood", "link": "https://stackoverflow.com/users/522663/jonathan-wood"}, "edited": false, "score": 0, "creation_date": 1560959519, "post_id": 56671573, "comment_id": 99910766, "body": "This was mostly implied by the question. For <code>char</code>, a 256-element array is generally the implementation used. I was just curious if <code>boyer_moore_searcher</code> avoided creating a great big table for Unicode."}, {"owner": {"reputation": 13563, "user_id": 992490, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac727873c5724326c84ed245faa9fe6c?s=128&d=identicon&r=PG", "display_name": "Marshall Clow", "link": "https://stackoverflow.com/users/992490/marshall-clow"}, "reply_to_user": {"reputation": 59348, "user_id": 522663, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/OKOEw.png?s=128&g=1", "display_name": "Jonathan Wood", "link": "https://stackoverflow.com/users/522663/jonathan-wood"}, "edited": false, "score": 0, "creation_date": 1560959753, "post_id": 56671573, "comment_id": 99910886, "body": "I suppose it&#39;s up to the implementation, but all the ones I&#39;ve looked at use a <code>unordered_map</code> for anything other than plain old <code>char</code>"}], "tags": [], "owner": {"reputation": 13563, "user_id": 992490, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac727873c5724326c84ed245faa9fe6c?s=128&d=identicon&r=PG", "display_name": "Marshall Clow", "link": "https://stackoverflow.com/users/992490/marshall-clow"}, "is_accepted": false, "score": 1, "last_activity_date": 1560959186, "creation_date": 1560959186, "answer_id": 56671573, "question_id": 56671106, "link": "https://stackoverflow.com/questions/56671106/finding-stdboyer-moore-searcher/56671573#56671573", "title": "Finding std::boyer_moore_searcher", "body": "<blockquote>\n  <p>One of the issues with the Boyer Moore algorithm is that the jump table must be very large for Unicode characters</p>\n</blockquote>\n\n<p>This is not really an answer, but too long for a comment.</p>\n\n<p>The \"skip table\" for Boyer-Moore needs to have an entry for every \"character\" in the pattern that you're searching for. </p>\n\n<p>For <code>char</code>, the simplest (and fastest) way to do that is to have a 256-element array (and that's how the B-M algorithm was described in the original papers). But that's not a requirement; just an implementation detail.</p>\n"}, {"tags": [], "owner": {"reputation": 6260, "user_id": 10933809, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IR53l.jpg?s=128&g=1", "display_name": "Oblivion", "link": "https://stackoverflow.com/users/10933809/oblivion"}, "is_accepted": false, "score": 0, "last_activity_date": 1560961673, "creation_date": 1560961673, "answer_id": 56672171, "question_id": 56671106, "link": "https://stackoverflow.com/questions/56671106/finding-stdboyer-moore-searcher/56672171#56672171", "title": "Finding std::boyer_moore_searcher", "body": "<p>This is the answer to the first question:</p>\n\n<blockquote>\n  <p>Where is it? I'm using Visual Studio 2019 but it reports \"namespace\n  std has no member boyer_moore_searcher\".</p>\n</blockquote>\n\n<p><code>boyer_moore_searcher</code> is introduced in c++17 so to compile you need to enable c++17 option:\n<a href=\"https://godbolt.org/z/tS28t2\" rel=\"nofollow noreferrer\">MSVC Compile</a> option <code>/std:c++17</code> or:</p>\n\n<blockquote>\n  <p>propertie->C/C++->All Options->C++ Language Standard</p>\n</blockquote>\n\n<p>.</p>\n"}], "owner": {"reputation": 59348, "user_id": 522663, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/OKOEw.png?s=128&g=1", "display_name": "Jonathan Wood", "link": "https://stackoverflow.com/users/522663/jonathan-wood"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 457, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1560961673, "creation_date": 1560957575, "question_id": 56671106, "link": "https://stackoverflow.com/questions/56671106/finding-stdboyer-moore-searcher", "title": "Finding std::boyer_moore_searcher", "body": "<p>I'd like to try using the <a href=\"https://en.cppreference.com/w/cpp/utility/functional/boyer_moore_searcher\" rel=\"nofollow noreferrer\">std::boyer_moore_searcher</a> class. But I've run into two questions:</p>\n\n<ol>\n<li>Where is it? I'm using Visual Studio 2019 but it reports <em>\"namespace std has no member boyer_moore_searcher\"</em>.</li>\n<li>One of the issues with the Boyer Moore algorithm is that the jump table must be very large for Unicode characters. Can anyone tell me how the <code>boyer_moore_searcher</code> class deals with this?</li>\n</ol>\n"}, {"tags": ["java", "c++", "file"], "comments": [{"owner": {"reputation": 8766, "user_id": 451321, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/7Sdao.jpg?s=128&g=1", "display_name": "Michael Chourdakis", "link": "https://stackoverflow.com/users/451321/michael-chourdakis"}, "edited": false, "score": 0, "creation_date": 1560957435, "post_id": 56671033, "comment_id": 99909503, "body": "It doesn&#39;t write the entire BMP file, only the BITMAPINFOHEADER."}, {"owner": {"reputation": 17331, "user_id": 8950365, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c6ba3b19f86f1bea8cf76e691db4349?s=128&d=identicon&r=PG&f=1", "display_name": "rafix07", "link": "https://stackoverflow.com/users/8950365/rafix07"}, "edited": false, "score": 1, "creation_date": 1560957713, "post_id": 56671033, "comment_id": 99909707, "body": "This <code>outPixels[0]</code> gives you first element, but this <code>&amp;outPixels[0]</code> gives you address of first element, when you know address of first byte and the entire size of buffer by one call <code>fwrite</code> you can write the whole file (I mean content of BMP image, not its header, you didn&#39;t show the code which does it)."}, {"owner": {"reputation": 24653, "user_id": 254306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/0745d192010b591257e771df7f439524?s=128&d=identicon&r=PG", "display_name": "Travis Gockel", "link": "https://stackoverflow.com/users/254306/travis-gockel"}, "edited": false, "score": 3, "creation_date": 1560957724, "post_id": 56671033, "comment_id": 99909716, "body": "Changing to <code>fwrite(outPixels.data(), infoHeader.biSizeImage, 1, file)</code> would probably make things a lot more clear."}, {"owner": {"reputation": 77, "user_id": 9243846, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/I6S0M.jpg?s=128&g=1", "display_name": "George Zorikov", "link": "https://stackoverflow.com/users/9243846/george-zorikov"}, "reply_to_user": {"reputation": 17331, "user_id": 8950365, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c6ba3b19f86f1bea8cf76e691db4349?s=128&d=identicon&r=PG&f=1", "display_name": "rafix07", "link": "https://stackoverflow.com/users/8950365/rafix07"}, "edited": false, "score": 0, "creation_date": 1560958185, "post_id": 56671033, "comment_id": 99910036, "body": "@rafix07 So we just pass the pointer to the array. I got it. Thank you"}, {"owner": {"reputation": 22818, "user_id": 1387438, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/ad806758c356c915ea08a4bfd79131e3?s=128&d=identicon&r=PG", "display_name": "Marek R", "link": "https://stackoverflow.com/users/1387438/marek-r"}, "edited": false, "score": 0, "creation_date": 1560960076, "post_id": 56671033, "comment_id": 99911034, "body": "I wonder if values in <code>std::vector</code> have warranty to be tightly packed?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user10957435"}, "edited": false, "score": 0, "creation_date": 1560964374, "post_id": 56671033, "comment_id": 99912892, "body": "I&#39;m not going to answer, because I can&#39;t say how this applies to the Java side of things, but to clear things up, <code>fwrite()</code> does not take a single char, that is, <code>outPixels[0]</code>. It takes a <b>pointer</b> to a char, or <code>&amp;outPixels[0]</code> (the address of <code>outPixels[0]</code>). Because the data is stored sequentially (I think this is guaranteed for <code>std::vector</code>) <code>fwrite()</code> can access all the data even if it only knows the pointer."}], "answers": [{"tags": [], "owner": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "is_accepted": true, "score": 2, "last_activity_date": 1560958454, "creation_date": 1560958454, "answer_id": 56671360, "question_id": 56671033, "link": "https://stackoverflow.com/questions/56671033/passing-c-vector-into-file-writer/56671360#56671360", "title": "Passing C++ vector into file writer", "body": "<p><code>&amp;outPixels[0]</code> is a worse way to say <code>outPixels.data()</code>.  It is a pointer to the contents of the <code>vector</code>'s buffer.</p>\n"}], "owner": {"reputation": 77, "user_id": 9243846, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/I6S0M.jpg?s=128&g=1", "display_name": "George Zorikov", "link": "https://stackoverflow.com/users/9243846/george-zorikov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 56671360, "answer_count": 1, "score": 0, "last_activity_date": 1560960006, "creation_date": 1560957346, "last_edit_date": 1560960006, "question_id": 56671033, "link": "https://stackoverflow.com/questions/56671033/passing-c-vector-into-file-writer", "title": "Passing C++ vector into file writer", "body": "<p>I am translating C++ program into Java. There's a piece of code that writes a BMP file. And I cannot understand <code>fwrite(&amp;outPixels[0], infoHeader.biSizeImage, 1, file);</code> line. How does it write the entire BMP-file if it only takes the 0th element of vector (this line not in any loop)?</p>\n\n<pre><code>typedef std::array&lt;uint8, 3&gt; TPixelBGRU8;\n\nstd::vector&lt;TPixelBGRU8&gt; outPixels;\noutPixels.resize(c_numPixels);\n\nfor (size_t i = 0; i &lt; c_numPixels; ++i) {\n    const TPixelRGBF32&amp; src = g_pixels[i];\n    TPixelBGRU8&amp; dest = outPixels[i];\n\n    dest[0] = uint8(Clamp(correctedPixel[2] * 255.0f, 0.0f, 255.0f));\n    dest[1] = uint8(Clamp(correctedPixel[1] * 255.0f, 0.0f, 255.0f));\n    dest[2] = uint8(Clamp(correctedPixel[0] * 255.0f, 0.0f, 255.0f));\n}\n\n//\n// setting a header info\n//\n\nFILE *file;\nfopen_s(&amp;file, fileName, \"wb\");\nfwrite(&amp;outPixels[0], infoHeader.biSizeImage, 1, file);\n</code></pre>\n\n<p>This is what I did:</p>\n\n<pre><code>// Vector is my own class like array&lt;uint8, 3&gt;\nList&lt;Vector&gt; outPixel = new ArrayList&lt;&gt;(numPixels);\n\nfor (int i = 0; i &lt; numPixels; i++) {\n    Vector src = pixels.get(i);\n    Vector dest = outPixel.get(i);\n\n    dest.setX((int) clamp(correctedPixel.getZ() * 255.0, 0.0, 255.0));\n    dest.setY((int) clamp(correctedPixel.getY() * 255.0, 0.0, 255.0));\n    dest.setZ((int) clamp(correctedPixel.getX() * 255.0, 0.0, 255.0));\n}\n\nBufferedImage img = new BufferedImage(imageWidth, imageHeight, \n                             BufferedImage.TYPE_INT_BGR);\n\n// I suppose I did it wrong:\nfor (int i = 0; i &lt; imageWidth; i++) {\n    for (int j = 0; j &lt; imageHeight; j++) {\n        img.setRGB(i, j, (int) outPixel.get(i * j));\n    }\n}\n</code></pre>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 5, "creation_date": 1560957157, "post_id": 56670944, "comment_id": 99909311, "body": "Any reason you aren&#39;t just using <a href=\"https://en.cppreference.com/w/cpp/algorithm/max_element\" rel=\"nofollow noreferrer\"><code>std::max_element</code></a>?"}, {"owner": {"reputation": 35327, "user_id": 27678, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/7496124d499d578df1e3a6ff85e7ae03?s=128&d=identicon&r=PG", "display_name": "AndyG", "link": "https://stackoverflow.com/users/27678/andyg"}, "edited": false, "score": 11, "creation_date": 1560957177, "post_id": 56670944, "comment_id": 99909325, "body": "<code>this-&gt;~Max();</code>??? Why would you do this?"}, {"owner": {"reputation": 58398, "user_id": 3233393, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c4c576e0ebcdf0efd653269a5b020347?s=128&d=identicon&r=PG", "display_name": "Quentin", "link": "https://stackoverflow.com/users/3233393/quentin"}, "edited": false, "score": 1, "creation_date": 1560957271, "post_id": 56670944, "comment_id": 99909382, "body": "Same as NathanOliver, and <code>std::vector</code> as well..."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 3, "creation_date": 1560957278, "post_id": 56670944, "comment_id": 99909388, "body": "And dynamically allocating an <code>int</code> wrapped in a class, and returning a ref to a local variable..  do you not have compiler warnings switched on?"}, {"owner": {"reputation": 17, "user_id": 11100244, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-waNgnWSHPv0/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPvQ_txWWhf_AiwtvpAKC9TSdnFPA/mo/photo.jpg?sz=128", "display_name": "M C", "link": "https://stackoverflow.com/users/11100244/m-c"}, "edited": false, "score": 0, "creation_date": 1560957934, "post_id": 56670944, "comment_id": 99909861, "body": "yes, I get that there can be other easier ways of dealing with this problem, but still, I&#39;d like to know where&#39;s the fault in this code. How can I deal with that out of scope issue in getMax()? Is there a particular problem with that destructor call?"}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 1, "creation_date": 1560958145, "post_id": 56670944, "comment_id": 99910008, "body": "Doing it at all is the problem! Can you explain why you do it?"}, {"owner": {"reputation": 711, "user_id": 4611211, "user_type": "registered", "profile_image": "https://graph.facebook.com/958083580869419/picture?type=large", "display_name": "Kevin Kouketsu", "link": "https://stackoverflow.com/users/4611211/kevin-kouketsu"}, "edited": false, "score": 0, "creation_date": 1560958261, "post_id": 56670944, "comment_id": 99910077, "body": "You could use vector, unique_ptr (even you don&#39;t need). And don&#39;t call a destructor like that, you probably will never need that"}, {"owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "edited": false, "score": 0, "creation_date": 1560959875, "post_id": 56670944, "comment_id": 99910941, "body": "Why all the classes? C++ isn&#39;t java, you don&#39;t have to put everything into a class. And there&#39;s no reason for any classes at all to do this task."}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 1, "creation_date": 1560961706, "post_id": 56670944, "comment_id": 99911757, "body": "Why are you using an <code>int*</code> to a dynamically allocated <code>int</code> to hold a value that is clearly better handled with a simple non-dynamic <code>int</code> instead? You don&#39;t need a pointer in this scenario at all, especially since your <code>Max</code> class is not following the <a href=\"https://en.cppreference.com/w/cpp/language/rule_of_three\" rel=\"nofollow noreferrer\">Rule of 3/5/0</a> correctly. Also, <code>Test::getMax()</code> returns a <code>Max&amp;</code> reference to a local <code>Max</code> object that is destroyed when <code>getMax()</code> returns, leaving the caller with a dangling reference."}], "answers": [{"comments": [{"owner": {"reputation": 42446, "user_id": 902497, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff13ece6277497484bfa2911c6183a30?s=128&d=identicon&r=PG", "display_name": "Raymond Chen", "link": "https://stackoverflow.com/users/902497/raymond-chen"}, "edited": false, "score": 0, "creation_date": 1560958524, "post_id": 56671273, "comment_id": 99910228, "body": "(3) returns a copy not a reference. However the code violates the rule of three and will encounter memory corruption."}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1560958550, "post_id": 56671273, "comment_id": 99910244, "body": "5. a) Remember not to call <code>delete</code> each time you do not use <code>new</code>, because a <code>std::vector</code> already does manage the memory for you. ;)"}, {"owner": {"reputation": 14893, "user_id": 4645334, "user_type": "registered", "accept_rate": 87, "profile_image": "https://lh6.googleusercontent.com/-hoIJVId9WIY/AAAAAAAAAAI/AAAAAAAAGQw/r7Es0WqE4rs/photo.jpg?sz=128", "display_name": "Thomas Sablik", "link": "https://stackoverflow.com/users/4645334/thomas-sablik"}, "reply_to_user": {"reputation": 42446, "user_id": 902497, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff13ece6277497484bfa2911c6183a30?s=128&d=identicon&r=PG", "display_name": "Raymond Chen", "link": "https://stackoverflow.com/users/902497/raymond-chen"}, "edited": false, "score": 0, "creation_date": 1560958594, "post_id": 56671273, "comment_id": 99910274, "body": "@RaymondChen (3) In the original code returns a reference. I already fixed it. Now I changed it back to show the problem."}, {"owner": {"reputation": 6463, "user_id": 6387170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d425edf9cc20e61c8cc3be162915f06?s=128&d=identicon&r=PG&f=1", "display_name": "UKMonkey", "link": "https://stackoverflow.com/users/6387170/ukmonkey"}, "edited": false, "score": 0, "creation_date": 1560962215, "post_id": 56671273, "comment_id": 99911975, "body": "&quot;Don&#39;t call a destructor&quot; - it&#39;s not that calling a destructor is bad - it certainly has its place (which isn&#39;t here).  It&#39;s that calling once more than once is UB; and it gets called once by default."}], "tags": [], "owner": {"reputation": 14893, "user_id": 4645334, "user_type": "registered", "accept_rate": 87, "profile_image": "https://lh6.googleusercontent.com/-hoIJVId9WIY/AAAAAAAAAAI/AAAAAAAAGQw/r7Es0WqE4rs/photo.jpg?sz=128", "display_name": "Thomas Sablik", "link": "https://stackoverflow.com/users/4645334/thomas-sablik"}, "is_accepted": false, "score": 2, "last_activity_date": 1560959660, "last_edit_date": 1560959660, "creation_date": 1560958170, "answer_id": 56671273, "question_id": 56670944, "link": "https://stackoverflow.com/questions/56670944/max-value-in-a-vector/56671273#56671273", "title": "Max value in a vector", "body": "<p>The best way would be to use <code>std::vector</code>/<code>std::array</code> with <code>std::max_element</code>. I recommend to first learn modern c++ with stl containers and algorithms and later you can learn about low level features. </p>\n\n<p>But for you to learn here are the errors in your code:</p>\n\n<ol>\n<li><p>Use <code>nullptr</code> instead of <code>NULL</code></p>\n\n<pre><code>Max() {\n    max = nullptr;\n}\n</code></pre></li>\n<li><p>Don't call a destructor</p>\n\n<pre><code>this-&gt;~Max();\n</code></pre></li>\n<li><p>Don't return a reference to a local variable</p>\n\n<pre><code>static Max&amp; getMax(int N[], int n) { // \n    Max m;\n    m.compute(N, n);\n    return m;\n}\n</code></pre></li>\n<li><p>Don't use <code>using namespace std;</code></p></li>\n<li><p>Remember to call a <code>delete</code> for each <code>new</code> and a <code>delete[]</code> for each <code>new []</code>. (Avoid <code>new</code>, <code>new []</code>, <code>delete</code> and <code>delete[]</code> if possible)</p></li>\n<li><p>You don't need a pointer for <code>max</code>. <code>int max;</code> would also work after you adept your code a little bit.</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 55059, "user_id": 212858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1166c87b6f3fc2e6746da96b60fefb46?s=128&d=identicon&r=PG", "display_name": "Useless", "link": "https://stackoverflow.com/users/212858/useless"}, "is_accepted": true, "score": 0, "last_activity_date": 1560959138, "last_edit_date": 1560959138, "creation_date": 1560958411, "answer_id": 56671345, "question_id": 56670944, "link": "https://stackoverflow.com/questions/56670944/max-value-in-a-vector/56671345#56671345", "title": "Max value in a vector", "body": "<blockquote>\n  <p>Max value in a vector</p>\n</blockquote>\n\n<p>That isn't a vector. It's an array. Vectors of integers are called <code>std::vector&lt;int&gt;</code>. You should probably use one.</p>\n\n<pre><code>void compute(int N[], int n) {\n    this-&gt;~Max();\n</code></pre>\n\n<p>The object referred to as <code>*this</code> is officially <em>dead</em> after this line. You can't legally do anything with it except de-allocate the memory, or use placement new to construct another instance over its corpse.</p>\n\n<p>What you <em>actually</em> do - being neither of those things - is illegal and immoral.</p>\n\n<p>Having a pointer here (and re/de/allocating it) doesn't even achieve anything, as far as I can tell. If you can just write <code>int max;</code> and avoid dynamic allocation, do that.</p>\n\n<pre><code>static Max&amp; getMax(int N[], int n) {\n    Max m;\n    m.compute(N, n);\n    return m;\n}\n</code></pre>\n\n<p>Returning a reference to a temporary is also illegal. Either</p>\n\n<ul>\n<li>return <code>m</code> by value (you'll need to write proper copy and move constructors and assignment operators if you want the dynamic allocation to work correctly, although just removing it would save a lot of work and bugs)</li>\n<li>or just return the calculated max value and print it outside (there's no obvious reason the <code>Max</code> class should be coupled to <code>std::cout</code>).</li>\n</ul>\n\n<hr>\n\n<p>To sum up, my recommendations in preference order are:</p>\n\n<ol>\n<li>use <a href=\"https://en.cppreference.com/w/cpp/container/vector\" rel=\"nofollow noreferrer\"><code>std::vector&lt;int&gt;</code></a> and <a href=\"https://en.cppreference.com/w/cpp/algorithm/max_element\" rel=\"nofollow noreferrer\"><code>std::max_element</code></a></li>\n<li><p>if you <em>must</em> write your own versions, <code>max</code> should still be a function returning the result, rather than a method which mutates an object to ... store the result for later? So:</p>\n\n<pre><code>int compute_max(int const *n, int nlen) {\n    // handle corner cases\n    if (nlen &lt; 1) return std::numeric_limits&lt;int&gt;::min();\n\n    int result = n[0];\n    for (int i = 1; i &lt; nlen; i++)\n        if (result &lt; n[i])\n            result = n[i];\n    return result;\n}\n</code></pre></li>\n<li><p>if you <em>must</em> have a stateful <code>Max</code> class (which still seems like a very odd design to me), just remove the dynamic allocation</p></li>\n<li>if you <em>must</em> have the dynamic allocation, you still need to stop explicitly calling the destructor, will need to implement copy and move constructors/assignment operators, and should ideally use <code>std::unique_ptr&lt;int&gt;</code> instead of a raw pointer</li>\n</ol>\n\n<p>Whichever implementation of <code>Max</code> you prefer (and I want to stress  that options 3&amp;4 are very distant third and fourth best options, for use only under very unsual or artificial conditions), you <em>must</em> not return a reference to a local variable in <code>getMax()</code>. Or anywhere else, obviously.</p>\n"}, {"tags": [], "owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "is_accepted": false, "score": 1, "last_activity_date": 1560960267, "creation_date": 1560960267, "answer_id": 56671859, "question_id": 56670944, "link": "https://stackoverflow.com/questions/56670944/max-value-in-a-vector/56671859#56671859", "title": "Max value in a vector", "body": "<p>Of course you can use <code>std::vector</code> and <code>std::max_element</code> but the real issue with your code (apart from the many bugs) is how convoluted it is. Programming in C++ is easier than you are making out.</p>\n\n<p>Here's how to write the same code in a straightforward manner, no classes are needed for this simple task.</p>\n\n<pre><code>#include &lt;iostream&gt;\nusing namespace std;\n\nint compute(int N[], int n) {\n    int max = N[0];\n    for (int i = 0; i &lt; n; i++)\n        if (max &lt; N[i])\n            max = N[i];\n    return max;\n}\n\nvoid print(int max) {\n    cout &lt;&lt; \"Max= \" &lt;&lt; max &lt;&lt; endl;\n}\n\nint main() {\n    int N[] = { 8,9,7,8,10,6 };\n    print(compute(N, sizeof(N) / sizeof(int)));\n}\n</code></pre>\n\n<p>Untested code.</p>\n"}], "owner": {"reputation": 17, "user_id": 11100244, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-waNgnWSHPv0/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPvQ_txWWhf_AiwtvpAKC9TSdnFPA/mo/photo.jpg?sz=128", "display_name": "M C", "link": "https://stackoverflow.com/users/11100244/m-c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 1, "accepted_answer_id": 56671345, "answer_count": 3, "score": -2, "last_activity_date": 1560960267, "creation_date": 1560957088, "question_id": 56670944, "link": "https://stackoverflow.com/questions/56670944/max-value-in-a-vector", "title": "Max value in a vector", "body": "<p>I am trying to compute the maximum value in an int[]. The program below crashes but I can't understand why. Is there a problem with the <code>Test</code> class? Thank you.</p>\n\n<pre><code>class Max {\n    int *max;\npublic:\n    Max() {\n        max = NULL;\n    }\n    ~Max() {\n        if (max)\n            delete max;\n    }\n    void compute(int N[], int n) {\n        this-&gt;~Max();\n        max = new int(N[0]);\n        for (int i = 0; i &lt; n; i++)\n            if (*max &lt; N[i])\n                *max = N[i];\n    }\n    void print() {\n        cout &lt;&lt; \"Max= \" &lt;&lt; *max &lt;&lt; endl;\n    }\n};\n\nclass Test {\npublic:\n    static Max&amp; getMax(int N[], int n) {\n        Max m;\n        m.compute(N, n);\n        return m;\n    }\n};\n\n\nvoid main() {\n    int N[] = { 8,9,7,8,10,6 };\n    Test::getMax(N, sizeof(N) / sizeof(int)).print();\n}\n</code></pre>\n"}, {"tags": ["c++", "mysql", "datetime"], "comments": [{"owner": {"reputation": 51, "user_id": 10951969, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1563dc0e2cfd32cd503eb8546b7594b6?s=128&d=identicon&r=PG&f=1", "display_name": "GoQuestion", "link": "https://stackoverflow.com/users/10951969/goquestion"}, "edited": false, "score": 0, "creation_date": 1560958730, "post_id": 56670935, "comment_id": 99910329, "body": "Here is the code:  <code>std::time_t t = std::stof(time);      std::stringstream sstime;      sstime &lt;&lt; std::put_time(std::gmtime(&amp;t), &quot;%F&quot;) &lt;&lt; &#39;\\n&#39;;   Poco::Data::Statement sql_insert(*session);     sql_insert &lt;&lt; &quot;INSERT into history (uid,  time) \\                    VALUES (?,?)&quot;,                    Poco::Data::Keywords::bind(uid),                    Poco::Data::Keywords::bind(sstime.str());</code>"}, {"owner": {"reputation": 195413, "user_id": 634824, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/889cf720c96957e615463b5c903a5e18?s=128&d=identicon&r=PG", "display_name": "Matt Johnson-Pint", "link": "https://stackoverflow.com/users/634824/matt-johnson-pint"}, "edited": false, "score": 0, "creation_date": 1560962521, "post_id": 56670935, "comment_id": 99912094, "body": "<a href=\"https://codeofmatt.com/please-dont-call-it-epoch-time/\" rel=\"nofollow noreferrer\">codeofmatt.com/please-dont-call-it-epoch-time</a>"}, {"owner": {"reputation": 195413, "user_id": 634824, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/889cf720c96957e615463b5c903a5e18?s=128&d=identicon&r=PG", "display_name": "Matt Johnson-Pint", "link": "https://stackoverflow.com/users/634824/matt-johnson-pint"}, "edited": false, "score": 0, "creation_date": 1560962559, "post_id": 56670935, "comment_id": 99912108, "body": "Also, please delete the code in comments.  If necessary you can edit your post instead."}], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 10951969, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1563dc0e2cfd32cd503eb8546b7594b6?s=128&d=identicon&r=PG&f=1", "display_name": "GoQuestion", "link": "https://stackoverflow.com/users/10951969/goquestion"}, "edited": false, "score": 0, "creation_date": 1560994844, "post_id": 56672407, "comment_id": 99922461, "body": "Thanks for the comments, i will try both method."}], "tags": [], "owner": {"reputation": 606, "user_id": 7613480, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e656d2636b29735656db88af1a10b0f7?s=128&d=identicon&r=PG&f=1", "display_name": "UdonN00dle", "link": "https://stackoverflow.com/users/7613480/udonn00dle"}, "is_accepted": true, "score": 1, "last_activity_date": 1561030579, "last_edit_date": 1561030579, "creation_date": 1560962581, "answer_id": 56672407, "question_id": 56670935, "link": "https://stackoverflow.com/questions/56670935/save-epoch-string-to-mysql-datetime-only-year-month-date-but-no-hour-minute-seco/56672407#56672407", "title": "Save epoch string to mysql datetime only year/month/date but no hour minute seconds", "body": "<p>Here are two possible solutions: </p>\n\n<p>One is to do some pre-processing to the epoch timestamp to change its format to <code>YYYY-MM-DD HH24:MI:SS</code>, and then bind it to the SQL statement. </p>\n\n<p>The other one is a bit weird and risky in my opinion, I found it in the comment section of the <a href=\"https://dev.mysql.com/doc/refman/8.0/en/datetime.html\" rel=\"nofollow noreferrer\">DATETIME documentation</a> on MySQL website, here's how: </p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>SET @@timestamp := 1559333386;\nINSERT INTO history (time) VALUES (NOW());\nSET @@timestamp := DEFAULT;\n</code></pre>\n\n<p>More about this in MySQL documentation for <a href=\"https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_timestamp\" rel=\"nofollow noreferrer\">timestamp system variable</a>.</p>\n\n<p>The above are just some recommendations, I didn't do any testing and validation not having desired environments, please do test it thoroughly before you implement it anywhere. </p>\n"}], "owner": {"reputation": 51, "user_id": 10951969, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1563dc0e2cfd32cd503eb8546b7594b6?s=128&d=identicon&r=PG&f=1", "display_name": "GoQuestion", "link": "https://stackoverflow.com/users/10951969/goquestion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 56672407, "answer_count": 1, "score": 0, "last_activity_date": 1561030579, "creation_date": 1560957058, "last_edit_date": 1560958849, "question_id": 56670935, "link": "https://stackoverflow.com/questions/56670935/save-epoch-string-to-mysql-datetime-only-year-month-date-but-no-hour-minute-seco", "title": "Save epoch string to mysql datetime only year/month/date but no hour minute seconds", "body": "<p>I have some C++ code that saves an epoch string (converted from <code>time_t</code> object) to MySQL database <code>time</code> column (data type <code>datetime</code>).</p>\n\n<p>The epoch time string in C++ is <code>1559333386</code>, however, when saved to MySQL, it only shows the date, with hour, minute and second all showing as zero: <code>2019-05-31 00:00:00</code>.</p>\n\n<p>Question is how to save the epoch timestamp with the full info to MySQL database in <code>year-month-day hour:minute:second</code> format?</p>\n\n<p>Thanks.</p>\n\n<p>Here is the code:</p>\n\n<pre><code>std::time_t t = std::stof(time);\nstd::stringstream sstime;\nsstime &lt;&lt; std::put_time(std::gmtime(&amp;t), \"%F\") &lt;&lt; '\\n';\nPoco::Data::Statement sql_insert(*session);\nsql_insert &lt;&lt; \"INSERT into history (uid,  time) \\\n               VALUES (?,?)\",\n               Poco::Data::Keywords::bind(uid),\n\n               Poco::Data::Keywords::bind(sstime.str());\n</code></pre>\n"}, {"tags": ["c++", "opencv"], "answers": [{"comments": [{"owner": {"reputation": 405, "user_id": 9578256, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PHuq_9WxWGc/AAAAAAAAAAI/AAAAAAAAAH4/gdEOiQt8qN4/photo.jpg?sz=128", "display_name": "Hordon", "link": "https://stackoverflow.com/users/9578256/hordon"}, "edited": false, "score": 0, "creation_date": 1560957918, "post_id": 56671051, "comment_id": 99909847, "body": "Thank you! The problem was with the image, not with the code. From now I will check this first always."}], "tags": [], "owner": {"reputation": 4650, "user_id": 6755083, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/CVobU.png?s=128&g=1", "display_name": "seccpur", "link": "https://stackoverflow.com/users/6755083/seccpur"}, "is_accepted": true, "score": 0, "last_activity_date": 1560957402, "creation_date": 1560957402, "answer_id": 56671051, "question_id": 56670869, "link": "https://stackoverflow.com/questions/56670869/how-to-fix-opencv-assertion-failed-error/56671051#56671051", "title": "How to fix OpenCV assertion failed error?", "body": "<p>Check if the image was read correctly before further processing</p>\n\n<pre><code>image = cv::imread(\".\\\\csillam.jpg\");\nif (!image.data)    // image was not created \n{\n    exit(1);\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 598, "user_id": 2962048, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XNIxJ.png?s=128&g=1", "display_name": "zteffi", "link": "https://stackoverflow.com/users/2962048/zteffi"}, "is_accepted": false, "score": 0, "last_activity_date": 1560958043, "creation_date": 1560958043, "answer_id": 56671227, "question_id": 56670869, "link": "https://stackoverflow.com/questions/56670869/how-to-fix-opencv-assertion-failed-error/56671227#56671227", "title": "How to fix OpenCV assertion failed error?", "body": "<blockquote>\n  <p>But that would be strange since I copied the image directly next to the EXE</p>\n</blockquote>\n\n<p>By default, Visual studio will set working directory elsewhere. <a href=\"https://stackoverflow.com/questions/143174/how-do-i-get-the-directory-that-a-program-is-running-from\">You can find your current working directory</a> or <a href=\"https://codeyarns.com/2013/12/30/how-to-change-working-directory-in-visual-studio/\" rel=\"nofollow noreferrer\">change it</a></p>\n"}], "owner": {"reputation": 405, "user_id": 9578256, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PHuq_9WxWGc/AAAAAAAAAAI/AAAAAAAAAH4/gdEOiQt8qN4/photo.jpg?sz=128", "display_name": "Hordon", "link": "https://stackoverflow.com/users/9578256/hordon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1495, "favorite_count": 0, "closed_date": 1560958482, "accepted_answer_id": 56671051, "answer_count": 2, "score": -2, "last_activity_date": 1560958043, "creation_date": 1560956877, "question_id": 56670869, "link": "https://stackoverflow.com/questions/56670869/how-to-fix-opencv-assertion-failed-error", "closed_reason": "Duplicate", "title": "How to fix OpenCV assertion failed error?", "body": "<p>When I try to run the code below in Visual Studio I getting an error message:</p>\n\n<p>Unhandled exception at 0x00007FFC976DA839 in TestOpenCV.exe: Microsoft C++ exception: cv::Exception at memory location 0x0000003DAEEFF360.</p>\n\n<p>And the command window show this message:</p>\n\n<p>OpenCV(4.1.0-dev) Error: Assertion failed (size.width>0 &amp;&amp; size.height>0) in cv::imshow, file C:\\Users\\hordon\\opencv\\modules\\highgui\\src\\window.cpp, line 352</p>\n\n<p>I can't figure out whats is wrong. My best guess is that I use a virtual Windows 10 on a Mac with Parallels Desktop and something is wrong with the path. But that would be strange since I copied the image directly next to the EXE. Any idea how to fix this?</p>\n\n<pre><code>#include \"pch.h\"\n#include &lt;iostream&gt;\n#include &lt;opencv2/core.hpp&gt;\n#include &lt;opencv2/highgui.hpp&gt;\n#include &lt;opencv2/imgproc.hpp&gt;\n\ncv::Mat image;\n\nvoid myMouseCallback(int event, int x, int y, int flags, void* userdata)\n{\n    if (flags &amp; cv::MouseEventFlags::EVENT_FLAG_LBUTTON) {\n        if (flags &amp; cv::MouseEventFlags::EVENT_FLAG_SHIFTKEY) {\n            cv::rectangle(image, { x,y }, { y, x }, CV_RGB(255, (x*y) % 255, (x + y) % 255));\n        } else if (flags &amp;cv::MouseEventFlags::EVENT_FLAG_ALTKEY) {\n            cv::line(image, { x, y }, { y, x }, CV_RGB((y * x) % 255, (int)(sin((double)x / image.cols) * 255), (x * y * x - y) % 255));\n        } else {\n            cv::circle(image, { x,y }, (x + y) % 10, 0);\n        }\n    }\n\n    cv::imshow(\"Ablak\", image);\n}\n\nint main()\n{\n    image = cv::imread(\".\\\\csillam.jpg\");\n\n    cv::Mat greyScale(image.rows, image.cols, CV_8UC1);\n    for (int i = 0; i &lt; greyScale.rows; ++i) {\n        for (int j = 0; j &lt; greyScale.cols; j++) {\n            cv::Vec3b pixel = image.at&lt;cv::Vec3b&gt;(i, j);\n\n            greyScale.at&lt;uint8_t&gt;(i, j) = (pixel[0] + pixel[1] + pixel[2]) / 3;\n        }\n    }\n    cv::imshow(\"Greyscale\", greyScale);\n\n    cv::imshow(\"Ablak\", image);\n    cv::setMouseCallback(\"Ablak\", myMouseCallback);\n\n    cv::waitKey(0);\n}\n</code></pre>\n"}, {"tags": ["java", "android", "c++", "java-native-interface"], "comments": [{"owner": {"reputation": 27440, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1561034713, "post_id": 56670677, "comment_id": 99938035, "body": "I see way too many lines of code that make calls to the JVM that utterly ignore the possibility of a failed call or an exception being thrown.  The entire wall of code seems to assume every call to the JVM <code>env</code> works as intended and doesn&#39;t throw any exceptions.  Once you get one failed call, or ignore one exception, you can get results similar to what you&#39;re seeing at any time."}, {"owner": {"reputation": 1, "user_id": 11670405, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3ai-5sm2U7s/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rezNjc14BIS-Ualjt4fqJqgHIUeFw/mo/photo.jpg?sz=128", "display_name": "Robert Livandovsky", "link": "https://stackoverflow.com/users/11670405/robert-livandovsky"}, "reply_to_user": {"reputation": 27440, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1561110331, "post_id": 56670677, "comment_id": 99965529, "body": "@AndrewHenle you are right, it fixed by adding <code>env-&gt;ExceptionClear();</code> after problem line, thank you!"}], "owner": {"reputation": 1, "user_id": 11670405, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3ai-5sm2U7s/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rezNjc14BIS-Ualjt4fqJqgHIUeFw/mo/photo.jpg?sz=128", "display_name": "Robert Livandovsky", "link": "https://stackoverflow.com/users/11670405/robert-livandovsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 73, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1560957324, "creation_date": 1560956234, "last_edit_date": 1560957324, "question_id": 56670677, "link": "https://stackoverflow.com/questions/56670677/env-stopped-working-correctly-after-calling-opendexfile-function-in-jni-case", "title": "Env stopped working correctly after calling openDexFile function in JNI case", "body": "<p>I have application that encrypt classes.dex file in android apps for reverse protection. After decryption classes.dex dynamically loading from memory, but I've trouble with android 4.4 KitKat (api level 19). After launching encrypted apk on emulator (AVD from Android studio) it crashes.</p>\n\n<p>Problem is in this piece of code:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>jint mCookie = mem_loadDex_dvm(env, (char *)szDexPath);\n// error appears in line below\njclass DexFileClass = env-&gt;FindClass(\"dalvik/system/DexFile\");\n</code></pre>\n\n<p><a href=\"https://github.com/woxihuannisja/Bangcle/blob/76f84a741bdfc25504992327c8addcf4f000e403/jni/packer.cpp#L836\" rel=\"nofollow noreferrer\">line in github</a></p>\n\n<p>exactly if to jump in mem_loadDex_dvm function, problem appear after this line</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>openDexFile(args, &amp;pResult);\n</code></pre>\n\n<p><a href=\"https://github.com/woxihuannisja/Bangcle/blob/76f84a741bdfc25504992327c8addcf4f000e403/jni/packer.cpp#L213\" rel=\"nofollow noreferrer\">line in github</a></p>\n\n<p>Error text:</p>\n\n<pre><code>W/dalvikvm: JNI WARNING: JNI function FindClass called with exception pending\nW/dalvikvm:              in Lcom/storm/fengyue/Native;.attachBaseContext:(Landroid/content/Context;)V (FindClass)\nW/dalvikvm: Pending exception is:\nI/dalvikvm: java.lang.RuntimeException: unable to open in-memory DEX file\nI/dalvikvm:     at com.storm.fengyue.Native.attachBaseContext(Native Method)\nI/dalvikvm:     at com.storm.fengyue.StubApplication.attachBaseContext(StubApplication.java:105)\nI/dalvikvm:     at android.app.Application.attach(Application.java:181)\nI/dalvikvm:     at android.app.Instrumentation.newApplication(Instrumentation.java:991)\nI/dalvikvm:     at android.app.Instrumentation.newApplication(Instrumentation.java:975)\nI/dalvikvm:     at android.app.LoadedApk.makeApplication(LoadedApk.java:511)\nI/dalvikvm:     at android.app.ActivityThread.handleBindApplication(ActivityThread.java:4317)\nI/dalvikvm:     at android.app.ActivityThread.access$1500(ActivityThread.java:135)\nI/dalvikvm:     at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1256)\nI/dalvikvm:     at android.os.Handler.dispatchMessage(Handler.java:102)\nI/dalvikvm:     at android.os.Looper.loop(Looper.java:136)\nI/dalvikvm:     at android.app.ActivityThread.main(ActivityThread.java:5017)\nI/dalvikvm:     at java.lang.reflect.Method.invokeNative(Native Method)\nI/dalvikvm:     at java.lang.reflect.Method.invoke(Method.java:515)\nI/dalvikvm:     at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:779)\nI/dalvikvm:     at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:595)\nI/dalvikvm:     at dalvik.system.NativeStart.main(Native Method)\nI/dalvikvm: \"main\" prio=5 tid=1 NATIVE\nI/dalvikvm:   | group=\"main\" sCount=0 dsCount=0 obj=0x9cd62bd8 self=0xb8d0e4a0\nI/dalvikvm:   | sysTid=2388 nice=0 sched=0/0 cgrp=[fopen-error:2] handle=-1216544672\nI/dalvikvm:   | state=R schedstat=( 0 0 0 ) utm=16 stm=0 core=3\nI/dalvikvm:   #00  pc 000bd4b6  /system/lib/libdvm.so (dvmDumpNativeStack(DebugOutputTarget const*, int)+86)\nI/dalvikvm:   #01  pc 00098093  /system/lib/libdvm.so (dvmDumpThreadEx(DebugOutputTarget const*, Thread*, bool)+1155)\nI/dalvikvm:   #02  pc 00098386  /system/lib/libdvm.so (dvmDumpThread(Thread*, bool)+86)\nI/dalvikvm:   #03  pc 0004ce17  /system/lib/libdvm.so (ScopedCheck::checkThread(int)+455)\nI/dalvikvm:   #04  pc 000601e5  /system/lib/libdvm.so\nI/dalvikvm:   #05  pc 00008a26  /data/data/home.blank/files/.jiagu/libdexload.so (mem_loadDex(_JNIEnv*, _jobject*, char const*)+1334)\nI/dalvikvm:   #06  pc 00009158  /data/data/home.blank/files/.jiagu/libdexload.so (native_attachBaseContext(_JNIEnv*, _jobject*, _jobject*)+1096)\nI/dalvikvm:   #07  pc 0002a0eb  /system/lib/libdvm.so (dvmPlatformInvoke+79)\nI/dalvikvm:     at com.storm.fengyue.Native.attachBaseContext(Native Method)\nI/dalvikvm:     at com.storm.fengyue.StubApplication.attachBaseContext(StubApplication.java:105)\nI/dalvikvm:     at android.app.Application.attach(Application.java:181)\nI/dalvikvm:     at android.app.Instrumentation.newApplication(Instrumentation.java:991)\nI/dalvikvm:     at android.app.Instrumentation.newApplication(Instrumentation.java:975)\nI/dalvikvm:     at android.app.LoadedApk.makeApplication(LoadedApk.java:511)\nI/dalvikvm:     at android.app.ActivityThread.handleBindApplication(ActivityThread.java:4317)\nI/dalvikvm:     at android.app.ActivityThread.access$1500(ActivityThread.java:135)\nI/dalvikvm:     at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1256)\nI/dalvikvm:     at android.os.Handler.dispatchMessage(Handler.java:102)\nI/dalvikvm:     at android.os.Looper.loop(Looper.java:136)\nI/dalvikvm:     at android.app.ActivityThread.main(ActivityThread.java:5017)\nI/dalvikvm:     at java.lang.reflect.Method.invokeNative(Native Method)\nI/dalvikvm:     at java.lang.reflect.Method.invoke(Method.java:515)\nI/dalvikvm:     at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:779)\nI/dalvikvm:     at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:595)\nI/dalvikvm:     at dalvik.system.NativeStart.main(Native Method)\nE/dalvikvm: VM aborting\n</code></pre>\n\n<p>It's no depend of FindClass, other functions give same error (env->GetFieldID or env->SetFieldID).\nTried to display env hex value, it similar before and after problem line.\nChecked that JNI is attached of current thread.</p>\n\n<p>All code are in <a href=\"https://github.com/woxihuannisja/Bangcle/blob/76f84a741bdfc25504992327c8addcf4f000e403/jni/packer.cpp#L213\" rel=\"nofollow noreferrer\">github</a></p>\n"}, {"tags": ["c++", "sparse-matrix", "matrix-multiplication", "suitesparse"], "answers": [{"tags": [], "owner": {"reputation": 189, "user_id": 4623781, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a82f769072d15a8d3ccb94f1d6ab80b0?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/4623781/david"}, "is_accepted": true, "score": 0, "last_activity_date": 1561065822, "creation_date": 1561065822, "answer_id": 56694049, "question_id": 56670660, "link": "https://stackoverflow.com/questions/56670660/cholmod-sparse-dense-multiplication-issue/56694049#56694049", "title": "CHOLMOD sparse dense multiplication issue", "body": "<p>The issue was an increadibly stupid mistake, there isn't the long prefix in the method name!\nThis won't throw any error but it won't execute the multiplication.\nWith <code>cholmod_l_sdmult(A, 0, alpha, beta, xe, b, c);</code> instead of <code>cholmod_sdmult(A, 0, alpha, beta, xe, b, c);</code> everything works fine.. </p>\n"}], "owner": {"reputation": 189, "user_id": 4623781, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a82f769072d15a8d3ccb94f1d6ab80b0?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/4623781/david"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 1, "accepted_answer_id": 56694049, "answer_count": 1, "score": 0, "last_activity_date": 1561065822, "creation_date": 1560956174, "question_id": 56670660, "link": "https://stackoverflow.com/questions/56670660/cholmod-sparse-dense-multiplication-issue", "title": "CHOLMOD sparse dense multiplication issue", "body": "<p>I am testing out cholmod to solve a sparse matrix system. As b of the Ax=b equation I want to use something that will lead to a known result, so I choose to declare as xe a vector of ones and b=A*xe.</p>\n\n<p>I tried some different approaches to do the sparse-matrix dense-vector multiplication without any success.\nAs first test I am using the ex15 matrix from <a href=\"https://sparse.tamu.edu/FIDAP/ex15\" rel=\"nofollow noreferrer\">SuitSparse matrix collection</a></p>\n\n<pre><code>#include \"cholmod.h\"\n#include &lt;iostream&gt;\n#pragma warning(disable:4996)\nint main()\n{\n    const char* matFile = \"C:/www/CholeskyMatGPU/ex15.mtx\";\n    const char* bfile = \"C:/www/CholeskyMatGPU/b.mtx\";\n    FILE* bp = fopen(bfile, \"w\");\n    FILE* fp = fopen(matFile, \"r\");\n    cholmod_sparse *A;\n    cholmod_dense *x, *xe, *b;\n    cholmod_factor *L;\n\n    cholmod_common* c = (cholmod_common*)malloc(sizeof(cholmod_common));\n    cholmod_l_start(c); /* start CHOLMOD */\n    c-&gt;useGPU = 0;\n    c-&gt;supernodal = CHOLMOD_SUPERNODAL;\n\n    A = cholmod_l_read_sparse(fp, c); /* read in a matrix */\n    cholmod_l_print_sparse(A, \"A\", c); /* print the matrix */\n    fclose(fp);\n\n    double alpha[2] = { 1., 0. };\n    double beta[2] = { 0., 0. };\n    xe = cholmod_l_ones(A-&gt;nrow, 1, A-&gt;xtype, c); \n    b = cholmod_l_allocate_dense(A-&gt;nrow, 1, A-&gt;nrow, CHOLMOD_LONG, c); //attempt1\n    b = cholmod_copy_dense(xe, c); //attempt2\n    b = cholmod_l_zeros(A-&gt;nrow, 1, A-&gt;xtype, c); //attempt3\n    cholmod_sdmult(A, 0, alpha, beta, xe, b, c); //b = A*xe\n    cholmod_l_write_dense(bp, b, \"\", c);\n    L = cholmod_l_analyze(A, c); /* analyze */\n    cholmod_l_factorize(A, L, c); /* factorize */\n    x = cholmod_l_solve(CHOLMOD_A, L, b, c); /* solve Ax=b */\n}\n</code></pre>\n\n<p>I expect b to be the result of the A*xe operation, so something like</p>\n\n<pre><code>-4487487.55116591\n228083519.121975\n0.0561846979753665\n18213301.5299736\n...\n30383411.1062435\n8073.91311889887\n0.00602254606925790\n-7101038.89577146\n378419792.843878\n0.0931721845637848\n</code></pre>\n\n<p>(checked from matlab)\nbut the shown code will print a vector of zeros, there is something wrong with what I am doing with sdmult.</p>\n\n<pre><code>A = Problem.A;\nn = length(A);\nxe(1:n,1) = 1;\nb=A*xe;\nR=chol(A);\ntmp=(R'\\b);\nx=R\\tmp;\n</code></pre>\n"}, {"tags": ["c++", "inheritance"], "answers": [{"comments": [{"owner": {"reputation": 52, "user_id": 11193005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ioR94.png?s=128&g=1", "display_name": "CodeStix", "link": "https://stackoverflow.com/users/11193005/codestix"}, "edited": false, "score": 0, "creation_date": 1560956342, "post_id": 56670484, "comment_id": 99908794, "body": "That&#39;s it! I fixed it by adding a &#39;forward declaration&#39; to <i>Circuit</i> in Component.hpp. Thank you so mush!"}], "tags": [], "owner": {"reputation": 156300, "user_id": 1782465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b45d92faaf9d122bfed585490e0bafc5?s=128&d=identicon&r=PG", "display_name": "Angew is no longer proud of SO", "link": "https://stackoverflow.com/users/1782465/angew-is-no-longer-proud-of-so"}, "is_accepted": true, "score": 5, "last_activity_date": 1560955668, "creation_date": 1560955668, "answer_id": 56670484, "question_id": 56670409, "link": "https://stackoverflow.com/questions/56670409/what-is-causing-these-unexpected-tokens-errors-after-constructor/56670484#56670484", "title": "What is causing these &#39;unexpected tokens&#39; errors after constructor?", "body": "<p>You haven't shown <code>Wire.hpp</code>, but my guess is that it includes <code>Component.hpp</code>, which gives you a cycle in header inclusion (because <code>Component.hpp</code> includes <code>Circuit.hpp</code>, and <code>Circuit.hpp</code> includes <code>Wire.hpp</code>).</p>\n\n<p>You will have to replace some of these inclusions with forward declarations to break the cycle.</p>\n"}], "owner": {"reputation": 52, "user_id": 11193005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ioR94.png?s=128&g=1", "display_name": "CodeStix", "link": "https://stackoverflow.com/users/11193005/codestix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 459, "favorite_count": 0, "accepted_answer_id": 56670484, "answer_count": 1, "score": 1, "last_activity_date": 1560955668, "creation_date": 1560955433, "question_id": 56670409, "link": "https://stackoverflow.com/questions/56670409/what-is-causing-these-unexpected-tokens-errors-after-constructor", "title": "What is causing these &#39;unexpected tokens&#39; errors after constructor?", "body": "<p>I am working on a circuit simulator/pathfinding system, but I keep getting these weird compilation errors. I am not yet that experienced with OO C++ to figure it out myself...</p>\n\n<h1>Object Tree</h1>\n\n<p>The objects in my project are implemented in this way:</p>\n\n<ul>\n<li><strong>Object</strong>\n\n<ul>\n<li>Component\n\n<ul>\n<li>Wire</li>\n<li>Switch</li>\n</ul></li>\n<li>Ciruit</li>\n</ul></li>\n</ul>\n\n<p>My <strong>Object</strong> class is the base class for everything in my project, this is great for debugging by giving everything a name and an id. \nI required that every component needs a Circuit to with (see it as a parent for components). I implemented this by creating a constructor in the Component class that requires a reference to a Circuit object.</p>\n\n<p>At first, everything worked and compiled fine, but when I introduced the Circuit class and when I added a constructor in Component with a Circuit reference parameter, everything went wrong...</p>\n\n<p><strong>Compilation errors</strong></p>\n\n<p>Now I keep getting these seemingly random syntax and missing tokens errors. (Intellisense does not mark them?)</p>\n\n<p>The first four errors that pop up are: </p>\n\n<p><code>C2238: unexpected token(s) preceding ';'</code>. </p>\n\n<p>At line 10 of Component.hpp. And at line 12 in file Circuit.hpp.\nBoth just after the constructor definition. (See in code below)</p>\n\n<p>The next four errors point tot the same locations, but it notes: </p>\n\n<p><code>C2143: syntax error: missing ';' before '*'</code>.</p>\n\n<p>Then, 30 more errors follow, but I think they are a result of these errors, to be sure, here they are:</p>\n\n<p>(Lol, cannot embed image, caused by not having enough reputation, so a link instead...)</p>\n\n<p><a href=\"https://i.imgur.com/O1jNN76.png\" rel=\"nofollow noreferrer\">Click here for errors</a></p>\n\n<p><strong>What I tried</strong></p>\n\n<p>I tried the following:</p>\n\n<ul>\n<li>Using a reference instead of pointer. (changed <code>Circuit* c</code> to <code>Circuit&amp; c</code>)</li>\n<li>Removing the name string concationation thing in constructor initializer list. (changed <code>... : Object(name + \"blah\")</code> to <code>... : Object(name)</code>)</li>\n<li>Rewriting the whole Visual Studio project to a new Visual Studio project.</li>\n<li>Placing the constructor initializer list in the header file.</li>\n<li>Lots of googling... and not lots of solving...</li>\n</ul>\n\n<p><strong>How to fix?</strong></p>\n\n<p>This frustrating problem is stopping me from working further on this project, what is causing it and how do I fix it? I would be pretty happy to know. </p>\n\n<h3>Object.hpp</h3>\n\n<pre><code>#pragma once\n#include &lt;string&gt;\n\nusing std::string;\n\nclass Object\n{\npublic:\n    Object();\n    Object(string name);\n    string name;\n    const int id;\n    virtual string toString();\nprivate:\n    static int currentId;\n};\n</code></pre>\n\n<h3>Object.cpp</h3>\n\n<pre><code>#include \"Object.hpp\"\n\nint Object::currentId = 0;\n\nObject::Object() : id(++Object::currentId), name(\"Object\")\n{ }\n\nObject::Object(string name) : id(++Object::currentId), name(name)\n{ }\n\nstring Object::toString()\n{\n    return name + \"#\" + std::to_string(id);\n}\n</code></pre>\n\n<h3>Component.hpp</h3>\n\n<pre><code>#pragma once\n#include \"Object.hpp\"\n#include \"Circuit.hpp\"\n\nclass Component : public Object\n{\npublic:\n    Component(std::string name, Circuit* container);\n    Circuit *container; // &lt;- Error points to the beginning of this line\n};\n</code></pre>\n\n<h3>Component.cpp</h3>\n\n<pre><code>#include \"Component.hpp\"\n\nComponent::Component(string name, Circuit* container) : Object(name), container(container)\n{ }\n</code></pre>\n\n<h3>Switch.hpp</h3>\n\n<pre><code>#pragma once\n#include \"Component.hpp\"\n#include \"Wire.hpp\"\n\nclass Switch : public Component\n{\npublic:\n    Switch(string name, Circuit* container, Wire&amp; wire1, Wire&amp; wire2);\n    Wire* wire1;\n    Wire* wire2;\n    void setEnabled(bool enabled);\n    bool getEnabled();\n\nprivate:\n    bool enabled;\n};\n</code></pre>\n\n<h3>Switch.cpp</h3>\n\n<pre><code>Switch::Switch(string name, Circuit* container, Wire&amp; wire1, Wire&amp; wire2) : Component(name + \"-Switch\", container), wire1(&amp;wire1), wire2(&amp;wire2), enabled(false)\n{ }\n\n...\n</code></pre>\n\n<h3>Circuit.hpp</h3>\n\n<pre><code>#pragma once\n#include \"Object.hpp\"\n#include \"Wire.hpp\"\n\nclass Circuit : public Object\n{\npublic:\n    Circuit(std::string name);\n    Wire* powerWire; // &lt;- Error points to the beginning of this line\n    bool isPowered(Wire&amp; wire);\n    bool getActive();\n    void setActive(bool active);\nprivate:\n    bool active;\n};\n</code></pre>\n\n<h3>Circuit.cpp</h3>\n\n<pre><code>#include \"Circuit.hpp\"\n#include \"Util.hpp\"\n\nCircuit::Circuit(string name) : Object(name + \"-Circuit\")\n{\n    active = false;\n    powerWire = new Wire(name + \"-PowerWire\", this);\n}\n\n...\n</code></pre>\n"}, {"tags": ["python", "c++", "cmake", "pip", "pybind11"], "comments": [{"owner": {"reputation": 55797, "user_id": 7976758, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/512cfbaf98d63ca4acd57b2df792aec6?s=128&d=identicon&r=PG", "display_name": "phd", "link": "https://stackoverflow.com/users/7976758/phd"}, "edited": false, "score": 0, "creation_date": 1560970335, "post_id": 56670376, "comment_id": 99915631, "body": "<a href=\"https://stackoverflow.com/search?q=%5Bpybind11%5D+ld%3A+library+not+found+for+%22-lstdc%2B%2B%22\">stackoverflow.com/&hellip;</a>"}, {"owner": {"reputation": 55797, "user_id": 7976758, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/512cfbaf98d63ca4acd57b2df792aec6?s=128&d=identicon&r=PG", "display_name": "phd", "link": "https://stackoverflow.com/users/7976758/phd"}, "edited": false, "score": 0, "creation_date": 1560970377, "post_id": 56670376, "comment_id": 99915651, "body": "For Mojave the setting <a href=\"https://github.com/ContinuumIO/anaconda-issues/issues/10135#issuecomment-426736042\" rel=\"nofollow noreferrer\">should be</a> <code>10.14</code>."}, {"owner": {"reputation": 43, "user_id": 7961269, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0abacdeda8df8619f94bdc5dd748549?s=128&d=identicon&r=PG&f=1", "display_name": "craig zhang", "link": "https://stackoverflow.com/users/7961269/craig-zhang"}, "reply_to_user": {"reputation": 55797, "user_id": 7976758, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/512cfbaf98d63ca4acd57b2df792aec6?s=128&d=identicon&r=PG", "display_name": "phd", "link": "https://stackoverflow.com/users/7976758/phd"}, "edited": false, "score": 0, "creation_date": 1561040365, "post_id": 56670376, "comment_id": 99941516, "body": "thank you @phd, It did work!!! But is there a way to tell pip automatically set this value if needed?"}, {"owner": {"reputation": 55797, "user_id": 7976758, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/512cfbaf98d63ca4acd57b2df792aec6?s=128&d=identicon&r=PG", "display_name": "phd", "link": "https://stackoverflow.com/users/7976758/phd"}, "edited": false, "score": 0, "creation_date": 1561045670, "post_id": 56670376, "comment_id": 99944706, "body": "No idea. Perhaps not as it&#39;s a <code>clang</code>&#39;s trick, not <code>pip</code>&#39;s."}], "answers": [{"tags": [], "owner": {"reputation": 152528, "user_id": 981959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04798ba8ef6591a9c23c5868dc0bf664?s=128&d=identicon&r=PG", "display_name": "Jonathan Wakely", "link": "https://stackoverflow.com/users/981959/jonathan-wakely"}, "is_accepted": false, "score": 0, "last_activity_date": 1560955859, "creation_date": 1560955859, "answer_id": 56670556, "question_id": 56670376, "link": "https://stackoverflow.com/questions/56670376/why-ld-library-not-found-for-lstdc-when-i-package-my-python-binding-for-a/56670556#56670556", "title": "Why `ld: library not found for -lstdc++` when I package my python binding for a c++ library using pybind11", "body": "<p>The error suggests that something in the python build is automatically adding <code>-lstdc++</code> to the compiler flags, but because you've told clang to use <code>-stdlib=libc++</code> it isn't looking in the directory that contains libstdc++ (which is correct, because you told it not to use libstdc++).</p>\n\n<p>I think the python build system is not compatible with libc++, or you need to find some way to tell it to stop adding <code>-lstdc++</code> automatically.</p>\n"}], "owner": {"reputation": 43, "user_id": 7961269, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0abacdeda8df8619f94bdc5dd748549?s=128&d=identicon&r=PG&f=1", "display_name": "craig zhang", "link": "https://stackoverflow.com/users/7961269/craig-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 451, "favorite_count": 0, "closed_date": 1561040160, "answer_count": 1, "score": 1, "last_activity_date": 1560955859, "creation_date": 1560955323, "question_id": 56670376, "link": "https://stackoverflow.com/questions/56670376/why-ld-library-not-found-for-lstdc-when-i-package-my-python-binding-for-a", "closed_reason": "Duplicate", "title": "Why `ld: library not found for -lstdc++` when I package my python binding for a c++ library using pybind11", "body": "<p>I want to package my <code>python binding</code> for a <code>c++ library</code> using <code>pybind11</code> and upload it to <code>pip</code>. It's easy to run <code>Cmake</code> and <code>make</code> to compile the binding project individually.\nHowever, when I use python setup.py, Cmake throws <code>ld: library not found for -lstdc++</code> on my <code>Mac Mojave</code>.</p>\n\n<ol>\n<li>I've tried <code>xcode-select --install</code></li>\n<li><p>And <code>open /Library/Developer/CommandLineTools/Packages/macOS_SDK_headers_for_macOS_10.14.pkg</code>\nBoth of them installed properly.</p></li>\n<li><p>Also, I've tried <code>sudo python setup.py sdist build</code> and then <code>python setup.py sdist build</code>, amazingly it did work! But the the same error throws when I download and compile from <code>pip install my-package</code>.</p></li>\n<li>Strangly, I used anaconda <code>python3.6</code> on two Mac, it failed both, I create new conda env <code>py3.7</code>, It installed successfully!!! I also used /usr/local/bin/python3 (3.4) and also succeed!!!</li>\n</ol>\n\n<p>My setup.py is like this:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>import os\nimport sys\nimport pathlib\n\nfrom setuptools import setup, Extension\nfrom setuptools.command.build_ext import build_ext as build_ext_orig\n\nclass CMakeExtension(Extension):\n    def __init__(self, name):\n        # don't invoke the original build_ext for this special extension\n        super().__init__(name, sources=[])\n\nclass build_ext(build_ext_orig):\n    def run(self):\n        for ext in self.extensions:\n            self.build_cmake(ext)\n        super().run()\n\n    def build_cmake(self, ext):\n        # example of build args\n        build_args = ['--config', 'Release', '--', '-j4']\n\n        cwd = pathlib.Path().absolute()\n        build_temp = pathlib.Path(self.build_temp)\n        build_temp.mkdir(parents=True, exist_ok=True)\n\n        os.chdir(str(build_temp))\n        self.spawn(['cmake', str(cwd)])\n        if not self.dry_run:\n            self.spawn(['cmake', '--build', '.'] + build_args)\n        os.chdir(str(cwd))\n\nsetup(\n    ...\n    install_requires=['numpy', 'pybind11'],\n    include_package_data=True,\n    ext_modules=[CMakeExtension('xxx')],\n    cmdclass={\n        'build_ext': build_ext,\n    }\n)\n</code></pre>\n\n<p>which I mostly copied from <a href=\"https://stackoverflow.com/a/48015772/7961269\">https://stackoverflow.com/a/48015772/7961269</a></p>\n\n<p>And my CMakeLists.txt is:</p>\n\n<pre><code>cmake_minimum_required(VERSION 2.8.12)\nproject(xxx)\n\nset(CMAKE_BUILD_TYPE Release)\nset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -std=c++11 -stdlib=libc++\")\n\nfind_package(pybind11 REQUIRED)\ninclude_directories(...)\npybind11_add_module(xxx xxx/xxx.cpp)\n</code></pre>\n\n<p>Hope I can <code>pip install my-package</code> successfully without any errors</p>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 2568, "user_id": 8548828, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C4qkl.png?s=128&g=1", "display_name": "Tarick Welling", "link": "https://stackoverflow.com/users/8548828/tarick-welling"}, "edited": false, "score": 1, "creation_date": 1560956493, "post_id": 56670321, "comment_id": 99908897, "body": "Please add your results to your question so people can see where you&#39;ve made a mistake."}], "answers": [{"tags": [], "owner": {"reputation": 35327, "user_id": 27678, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/7496124d499d578df1e3a6ff85e7ae03?s=128&d=identicon&r=PG", "display_name": "AndyG", "link": "https://stackoverflow.com/users/27678/andyg"}, "is_accepted": false, "score": 7, "last_activity_date": 1560955983, "creation_date": 1560955983, "answer_id": 56670599, "question_id": 56670321, "link": "https://stackoverflow.com/questions/56670321/integer-sequences-implementation-c/56670599#56670599", "title": "Integer sequences implementation C++", "body": "<p><code>RS&lt;2&gt;()</code> instantiates <code>rev_seq&lt;2, 2&gt;::type</code></p>\n\n<p><code>rev_seq&lt;2, 2&gt;::type</code> is the primary template (not the specialized one) for rev_seq:</p>\n\n<pre><code>template&lt;int C, int N, int... Is&gt;\nstruct rev_seq : rev_seq&lt;C - 1, N, N - C, Is...&gt;{}\n</code></pre>\n\n<p>This is a recursive declaration, so it derives from a version of itself like so:</p>\n\n<pre><code>rev_seq&lt;2, 2, (empty int... Is pack)&gt;\n</code></pre>\n\n<p>derives from </p>\n\n<pre><code>rev_seq&lt;2-1, 2, 2 - 2&gt;\n</code></pre>\n\n<p>which is <code>rev_seq&lt;1, 2, 0&gt;</code></p>\n\n<p>That <code>0</code> on the end is part of the <code>int... Is</code> pack on the base class</p>\n\n<p>This again recurses</p>\n\n<pre><code>rev_seq&lt;1, 2, 0&gt;\n</code></pre>\n\n<p>derives from </p>\n\n<pre><code>rev_seq&lt;1-1, 2, 2-1, 0&gt;\n</code></pre>\n\n<p>which is <code>rev_seq&lt;0, 2, (1, 0)&gt;</code></p>\n\n<p>See how the last parameter argument gets appended to the pack?</p>\n\n<p><code>rev_seq&lt;0, 2, (1, 0)&gt;</code> matches the following template <em>specialization</em> for <code>rev_seq</code>:</p>\n\n<pre><code>template&lt;int N, int... Is&gt;\nstruct rev_seq&lt;0, N, Is...&gt;\n{\n    using type = ints&lt;N, Is...&gt;;\n};\n</code></pre>\n\n<p>Note that this <code>struct</code> doesn't derive from anything</p>\n\n<p>At this point, the <code>type</code> type in the class becomes</p>\n\n<pre><code>ints&lt;2, 1, 0&gt;\n</code></pre>\n\n<p>See how the specialization causes us to append <code>N</code> to the front of the sequence?</p>\n\n<p>Finally, we pass the constructed <code>ints</code> to a function:</p>\n\n<pre><code>template&lt;int... Is&gt;\nvoid fU(ints&lt;Is...&gt;&amp;&amp; s)\n{\n    for (auto i : { Is... }) std::cout &lt;&lt; i &lt;&lt; \" \";\n    std::cout &lt;&lt; std::endl;\n}\n</code></pre>\n\n<p>The loop iterates over the integers</p>\n\n<pre><code>for (auto i : { Is... })\n</code></pre>\n\n<p>Here <code>{ Is...}</code> is a pack expansion, creating an initializer list for us to iterate over. It's fun to note that this is one of the very few places you can just create and use an initializer list, almost all other cases are relegated to matching a std::initializer_list constructor overload for some class (e.g., <code>std::vector</code>)</p>\n"}, {"tags": [], "owner": {"reputation": 8510, "user_id": 6040181, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh3.googleusercontent.com/-dQXdInUPrE0/AAAAAAAAAAI/AAAAAAAAAdg/_OLdfGWclsw/photo.jpg?sz=128", "display_name": "Biagio Festa", "link": "https://stackoverflow.com/users/6040181/biagio-festa"}, "is_accepted": true, "score": 2, "last_activity_date": 1560956996, "creation_date": 1560956996, "answer_id": 56670910, "question_id": 56670321, "link": "https://stackoverflow.com/questions/56670321/integer-sequences-implementation-c/56670910#56670910", "title": "Integer sequences implementation C++", "body": "<p>Assuming you already know the theory behind <code>variadic template</code>, the best approach I may suggest is to \"manually unroll\" template definitions.</p>\n\n<p>Most of the cases variadic templates exploit a recursive approaches.</p>\n\n<hr>\n\n<p>Let's try to do this exercise.</p>\n\n<p>The core part is: <code>RS&lt;5&gt;()</code>. That's just an instance of <code>rev_seq&lt;5, 5&gt;::type</code>. Well, let's go deep into <code>rev_seq</code>.</p>\n\n<p>Its declaration: </p>\n\n<pre><code>template&lt;int C, int N, int... Is&gt; \nstruct rev_seq // ...\n</code></pre>\n\n<p>So that instance will be \"mapped\":</p>\n\n<pre><code>template&lt;5, 5, $&gt; \nstruct rev_seq // ...\n</code></pre>\n\n<p>where <code>$</code> is just a placeholder symbol to indicate an empty variadic list.</p>\n\n<p><code>rev_seq</code> inherits recursively:</p>\n\n<pre><code>template&lt;5, 5, $&gt; \nstruct rev_seq : rev_seq &lt;4, 5, 0, $&gt; {}\n</code></pre>\n\n<p>Of course <code>rev_seq &lt;4, 5, 0, $&gt;</code> (i.e., <code>rev_seq&lt;4, 5, {0}&gt;</code>) inherits and so on.</p>\n\n<pre><code>&lt;5, 5, $&gt;                -&gt; \n&lt;4, 5, {0}&gt;              -&gt; \n&lt;3, 5, {1, 0}&gt;           -&gt; \n&lt;2, 5, {2, 1, 0}&gt;        -&gt;\n&lt;1, 5, {3, 2, 1, 0}&gt;     -&gt;\n&lt;0, 5, {4, 3, 2, 1, 0}&gt;\n</code></pre>\n\n<p>When the first template parameter is <code>0</code> we stop. Because in that case we have a <em>partial template specialization</em>.\nHere you can see the analogy with the <em>\"base case\"</em> in the recursion strategy.</p>\n\n<p>Therefore, we finally get this inheritance:</p>\n\n<pre><code>struct rev_seq&lt;0, N, Is...&gt;\n{\n    using type = ints&lt;N, Is...&gt;;\n};\n</code></pre>\n\n<p>In your case:</p>\n\n<pre><code>struct rev_seq&lt;0, 5, {4, 3, 2, 1, 0}&gt;\n{\n    using type = ints&lt;5, {4, 3, 2, 1, 0}&gt;;\n};\n</code></pre>\n\n<p>Note that <code>ints</code> is just a variadic list. That is: <code>ints&lt;5, {4, 3, 2, 1, 0}&gt;</code> actually is <code>ints&lt;{5, 4, 3, 2, 1, 0}&gt;</code>.</p>\n\n<p>So, in the end, you are just calling the \"print function\" with this particular instance of <code>ints</code>:</p>\n\n<pre><code>template&lt;{5, 4, 3, 2, 1, 0}&gt;\nvoid fU(ints&lt;{5, 4, 3, 2, 1, 0}&gt;&amp;&amp; s)\n{\n    for (auto i : { 5, 4, 3, 2, 1, 0 }) std::cout &lt;&lt; i &lt;&lt; \" \";\n    std::cout &lt;&lt; std::endl;\n}\n</code></pre>\n\n<p>Please note that is not a valid <em>C++</em> syntax, but more just a \"graphical representation\" aimed to show the recursive process.</p>\n"}], "owner": {"reputation": 183, "user_id": 11654695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4abeec2351b2f1cd779fe7d1a9e24548?s=128&d=identicon&r=PG&f=1", "display_name": "starrk", "link": "https://stackoverflow.com/users/11654695/starrk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 330, "favorite_count": 2, "accepted_answer_id": 56670910, "answer_count": 2, "score": 6, "last_activity_date": 1596624430, "creation_date": 1560955202, "last_edit_date": 1596624430, "question_id": 56670321, "link": "https://stackoverflow.com/questions/56670321/integer-sequences-implementation-c", "title": "Integer sequences implementation C++", "body": "<p>I have been reading up on compile time sequences and I have a hard time understanding how the program below works. Can anyone out there explain the program below in detail? Thanks!</p>\n<pre><code>#include&lt;iostream&gt;\ntemplate&lt;int...&gt;\nstruct ints\n{\n\n};\n\ntemplate&lt;int N, int...args&gt;\nstruct rev_seq : rev_seq&lt;N - 1, 2 * args..., 1&gt; {};\n\ntemplate&lt;int...args&gt;\nstruct rev_seq&lt;0, args...&gt;\n{\n    using type = ints&lt;args...&gt;;\n\n};\n\ntemplate&lt;int N&gt;\nusing RS = typename rev_seq&lt;N + 1&gt;::type;\n\ntemplate&lt;int... args&gt;\nvoid fU(ints&lt;args...&gt;&amp;&amp; s)\n{\n    for (const auto&amp; i : { args... }) std::cout &lt;&lt; i &lt;&lt; &quot; &quot;;\n    std::cout &lt;&lt; std::endl;\n}\nint main()\n{\n    fU(RS&lt;5&gt;());\n}\n</code></pre>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 3108, "user_id": 4641116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gc52U.png?s=128&g=1", "display_name": "Eljay", "link": "https://stackoverflow.com/users/4641116/eljay"}, "edited": false, "score": 5, "creation_date": 1560955205, "post_id": 56670295, "comment_id": 99908046, "body": "The temporary lives until the <code>;</code> ... so referencing its buffer after that is going to be problematic."}], "answers": [{"comments": [{"owner": {"reputation": 325, "user_id": 6220486, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/16b0fd0714b6147991aece5929542eb3?s=128&d=identicon&r=PG&f=1", "display_name": "user34299", "link": "https://stackoverflow.com/users/6220486/user34299"}, "edited": false, "score": 0, "creation_date": 1560959994, "post_id": 56670435, "comment_id": 99911000, "body": "Do I understand you to be saying that the returned value, <code>ss.str()</code>, goes out of scope by virtue of the outer enclosing parentheses, i.e., <code>(ReadShader(&quot;Shader&#47;Vertex_Shader.vs&quot;))</code>, such that the subsequent call to <code>c_str()</code> is converting nonsense memory?  If that is the case, than I cannot do what I wanted without passing in a reference or pointer to the <code>ReadShader()</code> function.  I think that would work.  Do you agree?  Thanks for your answer."}, {"owner": {"reputation": 152528, "user_id": 981959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04798ba8ef6591a9c23c5868dc0bf664?s=128&d=identicon&r=PG", "display_name": "Jonathan Wakely", "link": "https://stackoverflow.com/users/981959/jonathan-wakely"}, "reply_to_user": {"reputation": 325, "user_id": 6220486, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/16b0fd0714b6147991aece5929542eb3?s=128&d=identicon&r=PG&f=1", "display_name": "user34299", "link": "https://stackoverflow.com/users/6220486/user34299"}, "edited": false, "score": 0, "creation_date": 1560960496, "post_id": 56670435, "comment_id": 99911243, "body": "No, the parentheses have absolutely nothing to do with it, they&#39;re completely redundant and make no difference to anything. The return value goes out of scope because it&#39;s a temporary variable and you don&#39;t copy it anywhere. Simply calling a member function to get a pointer from the temporary variable doesn&#39;t extend its lifetime and make it stay alive. It goes away at the end of the statement, and the pointer is left dangling, referring to deallocated memory. This is &quot;a C++ basic something&quot; that you&#39;re missing :-)"}, {"owner": {"reputation": 152528, "user_id": 981959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04798ba8ef6591a9c23c5868dc0bf664?s=128&d=identicon&r=PG", "display_name": "Jonathan Wakely", "link": "https://stackoverflow.com/users/981959/jonathan-wakely"}, "reply_to_user": {"reputation": 325, "user_id": 6220486, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/16b0fd0714b6147991aece5929542eb3?s=128&d=identicon&r=PG&f=1", "display_name": "user34299", "link": "https://stackoverflow.com/users/6220486/user34299"}, "edited": false, "score": 0, "creation_date": 1560960616, "post_id": 56670435, "comment_id": 99911305, "body": "What&#39;s wrong with the first version of your code, copying the returned value into a local <code>std::string</code> variable, then calling <code>c_str()</code> on that? Why do you need to do it in one line?"}, {"owner": {"reputation": 325, "user_id": 6220486, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/16b0fd0714b6147991aece5929542eb3?s=128&d=identicon&r=PG&f=1", "display_name": "user34299", "link": "https://stackoverflow.com/users/6220486/user34299"}, "edited": false, "score": 0, "creation_date": 1560961304, "post_id": 56670435, "comment_id": 99911590, "body": "There is nothing wrong with doing it in two lines.  I was just being ornery and wanted to do it in one line!  By so attempting, I learned something.  Thanks for taking the time."}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "reply_to_user": {"reputation": 325, "user_id": 6220486, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/16b0fd0714b6147991aece5929542eb3?s=128&d=identicon&r=PG&f=1", "display_name": "user34299", "link": "https://stackoverflow.com/users/6220486/user34299"}, "edited": false, "score": 1, "creation_date": 1560961947, "post_id": 56670435, "comment_id": 99911852, "body": "@user34299 It is safe to use the one-line approach only if you are passing the pointer to the temp object&#39;s data as a function parameter, eg: <code>someFunc(ReadShader(&quot;Shader&#47;Vertex_Shader.vs&quot;).c_str());</code> but it is not safe if you are saving the pointer after the temp is destroyed."}], "tags": [], "owner": {"reputation": 152528, "user_id": 981959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04798ba8ef6591a9c23c5868dc0bf664?s=128&d=identicon&r=PG", "display_name": "Jonathan Wakely", "link": "https://stackoverflow.com/users/981959/jonathan-wakely"}, "is_accepted": true, "score": 4, "last_activity_date": 1560955514, "creation_date": 1560955514, "answer_id": 56670435, "question_id": 56670295, "link": "https://stackoverflow.com/questions/56670295/returning-a-stdstring-converting-to-char/56670435#56670435", "title": "Returning a std::string, converting to char*", "body": "<p>Your second version of the code is similar to this:</p>\n\n<pre><code>const GLchar * vertexShaderSource;\n{\n  std::string tmp = ReadShader(\"Shader/Vertex_Shader.vs\");\n  vertexShaderSource = tmp.c_str();\n} // tmp is destroyed here\n</code></pre>\n\n<p>I hope this makes it more obvious that your pointer is referring to the contents of a <code>std::string</code> that has gone out of scope and deallocated its memory.</p>\n"}], "owner": {"reputation": 325, "user_id": 6220486, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/16b0fd0714b6147991aece5929542eb3?s=128&d=identicon&r=PG&f=1", "display_name": "user34299", "link": "https://stackoverflow.com/users/6220486/user34299"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 56670435, "answer_count": 1, "score": 0, "last_activity_date": 1560955514, "creation_date": 1560955111, "question_id": 56670295, "link": "https://stackoverflow.com/questions/56670295/returning-a-stdstring-converting-to-char", "title": "Returning a std::string, converting to char*", "body": "<p>I have a function,</p>\n\n<pre><code>std::string ReadShader(const std::string&amp; filePath) {\n\n    std::ifstream stream(filePath);\n    std::string line;\n    std::stringstream ss;\n\n    while (getline(stream, line)) {\n\n        ss &lt;&lt; line &lt;&lt; '\\n';\n    }\n\n    return ss.str();\n}\n</code></pre>\n\n<p>which works when I use these two lines of code,</p>\n\n<pre><code>std::string vertexShaderString = ReadShader(\"Shader/Vertex_Shader.vs\");\nconst GLchar * vertexShaderSource = vertexShaderString.c_str();\n</code></pre>\n\n<p>i.e., <code>vertexShaderString</code> contains the expected string, and <code>vertexShaderSource</code> shows the first character of the expected string.</p>\n\n<p>However, when I try a single line of code, viz.,</p>\n\n<pre><code>const GLchar * vertexShaderSource = (ReadShader(\"Shader/Vertex_Shader.vs\")).c_str();\n</code></pre>\n\n<p><code>vertexShaderString</code> has a consistent line of characters with a hex code of 0xdd, and <code>vertexShaderSource</code> shows the same 0xdd first character.  That is, there is nothing of the expected string in either.</p>\n\n<p><code>GLchar</code> is an OpenGL typedef for <code>char</code>.</p>\n\n<p>I think there is a C++ basic something I am missing.</p>\n"}, {"tags": ["c++", "qt", "qframe"], "answers": [{"tags": [], "owner": {"reputation": 25, "user_id": 10789226, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-KrjHzyAzta4/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jbZkaxk8h4uMuz9A1ez4HJCgqunA/mo/photo.jpg?sz=128", "display_name": "VivekVar", "link": "https://stackoverflow.com/users/10789226/vivekvar"}, "is_accepted": false, "score": 0, "last_activity_date": 1560958480, "creation_date": 1560958480, "answer_id": 56671368, "question_id": 56670170, "link": "https://stackoverflow.com/questions/56670170/qframe-is-not-adjusting-its-size-as-per-the-size-adjustment-of-parent-widget/56671368#56671368", "title": "QFrame is not adjusting its size as per the size adjustment of parent widget", "body": "<p>I managed to fix the problem. </p>\n\n<p>I missed to implement the event handler resizeEvent(QResizeEvent *event) in parent widget. \nI implemented the same and called the resizeEvent of FrameDemo. Inside this event handler, I called setGeometry().</p>\n"}], "owner": {"reputation": 25, "user_id": 10789226, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-KrjHzyAzta4/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jbZkaxk8h4uMuz9A1ez4HJCgqunA/mo/photo.jpg?sz=128", "display_name": "VivekVar", "link": "https://stackoverflow.com/users/10789226/vivekvar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 185, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1560958480, "creation_date": 1560954702, "last_edit_date": 1560955797, "question_id": 56670170, "link": "https://stackoverflow.com/questions/56670170/qframe-is-not-adjusting-its-size-as-per-the-size-adjustment-of-parent-widget", "title": "QFrame is not adjusting its size as per the size adjustment of parent widget", "body": "<p>I created a widget class. This class will be maintaining child_1 of type QFrame(which is of type QWidget) and also a child_2 of type QGridLayout . child_2 will be adding child_1 to itself. The child_1 will be having a child of type QGridLayout and ultimately QGridLayout will be having some push buttons.</p>\n\n<p>*I am unable to adjust the size of QFrame child(child_1)as per the adjustment of parent widget.\nAlso, I am trying to set the size of QFrame child that of parent. Even this isn't happening.\nI have tried using methods setFrameRect(), setGeometry() and resize(). \nI have implemented evenhandler resizeEvent(QResizeEvent <em>event). But while application is running, I am trying to resize the widget and I see that log isn't printing.</em></p>\n\n<p><strong>main.cpp</strong></p>\n\n<pre><code>int main(int argc, char *argv[])\n{\n    QApplication a(argc, argv);\n    Widget w;\n    w.show();\n\n    return a.exec();\n}\n</code></pre>\n\n<p><strong>widget.h</strong></p>\n\n<pre><code>namespace Ui {\nclass Widget;\n}\n\nclass Widget : public QWidget\n{\n    Q_OBJECT\n\npublic:\n    explicit Widget(QWidget *parent = 0);\n    ~Widget();\n\nprivate:\n    Ui::Widget *ui;\n    QGridLayout* p_mPanelLayout; // Instance of QGridLayout.\n    FrameDemo* framePtr;\n};\n</code></pre>\n\n<p><strong>widget.cpp</strong></p>\n\n<pre><code>Widget::Widget(QWidget *parent) :\n    QWidget(parent),\n    ui(new Ui::Widget)\n{\n    ui-&gt;setupUi(this);\n    p_mPanelLayout = new QGridLayout(this);\n    framePtr = new FrameDemo(this);\n    framePtr-&gt;createPushButtonUtility();\n\n    p_mPanelLayout-&gt;addWidget(framePtr, 0, 0, Qt::AlignCenter);\n}\n\nWidget::~Widget()\n{\n    delete ui;\n}\n</code></pre>\n\n<p><strong>framedemo.h</strong></p>\n\n<pre><code>#define LOG(message){\\\nqDebug()&lt;&lt; __LINE__&lt;&lt;__FUNCTION__&lt;&lt;message&lt;&lt;\"\\n\";\\\n }\n\nclass FrameDemo : public QFrame\n{\n    Q_OBJECT\npublic:\n    FrameDemo(QWidget *parent = 0);\n    void createPushButtonUtility();\nprivate:\n    QGridLayout* m_pLayout;\nprotected:\n    void resizeEvent(QResizeEvent * event);\n};\n</code></pre>\n\n<p><strong>framedemo.cpp</strong></p>\n\n<pre><code>FrameDemo::FrameDemo(QWidget *parent):QFrame(parent)\n{\n    m_pLayout = new QGridLayout(this);\n//    m_pLayout-&gt;setRowStretch(0, parent-&gt;width());\n\n    QRect defaultRect = rect();\n    QSize currentSize = size();\n    LOG(currentSize.height())\n    LOG(currentSize.width())\n\n    int xP1 = 0;\n    int yP1 = 0;\n    int xP2 = 0;\n    int yP2 = 0;\n\n    defaultRect.getCoords(&amp;xP1, &amp;yP1, &amp;xP2, &amp;yP2);\n    LOG(xP1)\n    LOG(yP1)\n    LOG(xP2)\n    LOG(yP2)\n    LOG(parent-&gt;width())\n    LOG(defaultRect.height())\n//            QRect newRect = QRect(xP1,yP1,parent-&gt;width(),defaultRect.height());\n//            QRect newRect = QRect(0, 0, 0, defaultRect.height());\n//            setFrameRect(newRect);\n            resize(QSize(400, currentSize.height()));\n\n            setFrameShape(QFrame::Box);\n//            setGeometry(0, 0, parent-&gt;width(), defaultRect.height());\n}\n\n\nvoid FrameDemo::createPushButtonUtility()\n{\n    QPushButton *readButton = new QPushButton(\"Read\", this);\n    m_pLayout-&gt;addWidget(readButton, 0, 0, Qt::AlignCenter);\n    QPushButton *writeButton = new QPushButton(\"Write\", this);\n    m_pLayout-&gt;addWidget(writeButton, 0, 1, Qt::AlignCenter);\n    QPushButton *updateButton = new QPushButton(\"Update\", this);\n    m_pLayout-&gt;addWidget(updateButton, 0, 2, Qt::AlignCenter);\n}\n\nvoid FrameDemo::resizeEvent(QResizeEvent *event)\n{\n    LOG(\"resize\")\n}\n</code></pre>\n"}, {"tags": ["c++", "linux"], "comments": [{"owner": {"reputation": 6463, "user_id": 6387170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d425edf9cc20e61c8cc3be162915f06?s=128&d=identicon&r=PG&f=1", "display_name": "UKMonkey", "link": "https://stackoverflow.com/users/6387170/ukmonkey"}, "edited": false, "score": 1, "creation_date": 1560960565, "post_id": 56670145, "comment_id": 99911272, "body": "&quot;but I think there are some platforms that will call terminate if it occurs.&quot; why do you think that?  <a href=\"https://www.gnu.org/software/libc/manual/html_node/Miscellaneous-Signals.html\" rel=\"nofollow noreferrer\">gnu.org/software/libc/manual/html_node/&hellip;</a> states (my highlighting) &quot;the <i>DEFAULT</i> action is to terminate&quot; - not &quot;it will always terminate&quot;.  As long as you don&#39;t call <code>exit()</code> and you&#39;re using something that supports signals (eg not arduino) then it shouldn&#39;t be an issue."}, {"owner": {"reputation": 601, "user_id": 9069780, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49bf2ad1391fadfaac120f3bb4e625ef?s=128&d=identicon&r=PG&f=1", "display_name": "Desperado17", "link": "https://stackoverflow.com/users/9069780/desperado17"}, "reply_to_user": {"reputation": 6463, "user_id": 6387170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d425edf9cc20e61c8cc3be162915f06?s=128&d=identicon&r=PG&f=1", "display_name": "UKMonkey", "link": "https://stackoverflow.com/users/6387170/ukmonkey"}, "edited": false, "score": 0, "creation_date": 1561012862, "post_id": 56670145, "comment_id": 99926600, "body": "Ok, is there a signal that doesn&#39;t usually terminate, even on default? And that is caught by gdb by default (or with little effort)?"}], "owner": {"reputation": 601, "user_id": 9069780, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49bf2ad1391fadfaac120f3bb4e625ef?s=128&d=identicon&r=PG&f=1", "display_name": "Desperado17", "link": "https://stackoverflow.com/users/9069780/desperado17"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 43, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1560973999, "creation_date": 1560954626, "last_edit_date": 1560973999, "question_id": 56670145, "link": "https://stackoverflow.com/questions/56670145/pthread-kill-what-signal-to-use-so-it-doesnt-interfere-with-program-execution", "title": "pthread_kill: What signal to use so it doesn&#39;t interfere with program execution?", "body": "<p>I'm currently implementing a tracing system in our program that relies sending signals to individual threads / lightweight processes using pthread_kill. My problem lies in deciding what signal to use so it doesn't interfere with program execution otherwise. Basically, I have 3 requirements for the signal type:</p>\n\n<ul>\n<li>It should be sendable to a signal thread / lightweight process</li>\n<li>It should not terminate the program</li>\n<li>It should be catcheable by common tracing tools like gdb or strace.</li>\n</ul>\n\n<p>I used SIGUSR2 at the beginning, but I think there are some platforms that will call terminate if it occurs.</p>\n\n<p>Is there a signal type that is guaranteed to be visible by the abovementioned tracing tools and not terminate the process?</p>\n\n<p>Regards</p>\n"}, {"tags": ["c++", "double", "vectorization", "sse", "simd"], "comments": [{"owner": {"reputation": 8510, "user_id": 6040181, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh3.googleusercontent.com/-dQXdInUPrE0/AAAAAAAAAAI/AAAAAAAAAdg/_OLdfGWclsw/photo.jpg?sz=128", "display_name": "Biagio Festa", "link": "https://stackoverflow.com/users/6040181/biagio-festa"}, "edited": false, "score": 1, "creation_date": 1560954752, "post_id": 56670132, "comment_id": 99907759, "body": "Strict optimizations of this kind are architecture-specific. Maybe you want to add some details about your platform?"}, {"owner": {"reputation": 321, "user_id": 938126, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a6cf8c07921b4c70077e298d7630c1ca?s=128&d=identicon&r=PG", "display_name": "Sindbag", "link": "https://stackoverflow.com/users/938126/sindbag"}, "reply_to_user": {"reputation": 8510, "user_id": 6040181, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh3.googleusercontent.com/-dQXdInUPrE0/AAAAAAAAAAI/AAAAAAAAAdg/_OLdfGWclsw/photo.jpg?sz=128", "display_name": "Biagio Festa", "link": "https://stackoverflow.com/users/6040181/biagio-festa"}, "edited": false, "score": 0, "creation_date": 1560955223, "post_id": 56670132, "comment_id": 99908052, "body": "@BiagioFesta yes, of course, I believe our cluster is based on Xeon and AVX2 is available, but I am not sure about AVX512 (I assume it is not allowed)"}, {"owner": {"reputation": 14588, "user_id": 6870253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c7ce91530d2dddae7b9fc2bd828ed78?s=128&d=identicon&r=PG&f=1", "display_name": "chtz", "link": "https://stackoverflow.com/users/6870253/chtz"}, "edited": false, "score": 3, "creation_date": 1560955648, "post_id": 56670132, "comment_id": 99908350, "body": "Compiling this with clang gives some decent auto-vectorized SIMD code: <a href=\"https://godbolt.org/z/lnwLPc\" rel=\"nofollow noreferrer\">godbolt.org/z/lnwLPc</a> (without the <code>__restrict</code> there is some additional code which first checks if the memory areas overlap)"}, {"owner": {"reputation": 14588, "user_id": 6870253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c7ce91530d2dddae7b9fc2bd828ed78?s=128&d=identicon&r=PG&f=1", "display_name": "chtz", "link": "https://stackoverflow.com/users/6870253/chtz"}, "edited": false, "score": 3, "creation_date": 1560956196, "post_id": 56670132, "comment_id": 99908698, "body": "If you are ok with calculating <code>left[i] - 0.0</code> in the true-case, you could replace the <code>vblendvpd</code> by <code>vandpd</code> of <code>drop</code> with the result of <code>!(right[i]&gt;=th)</code> and subtract that result from <code>left[i]</code>: <a href=\"https://godbolt.org/z/-LIbSY\" rel=\"nofollow noreferrer\">godbolt.org/z/-LIbSY</a>"}, {"owner": {"reputation": 52741, "user_id": 555045, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/182d0ce855c8324a596648c04643e8f9?s=128&d=identicon&r=PG", "display_name": "nicomp", "link": "https://stackoverflow.com/users/555045/nicomp"}, "edited": false, "score": 2, "creation_date": 1560967500, "post_id": 56670132, "comment_id": 99914324, "body": "Can the whole thing be done with actual <code>float</code> instead of <code>double</code>? That would be a non-local change.."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 14588, "user_id": 6870253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c7ce91530d2dddae7b9fc2bd828ed78?s=128&d=identicon&r=PG&f=1", "display_name": "chtz", "link": "https://stackoverflow.com/users/6870253/chtz"}, "edited": false, "score": 2, "creation_date": 1561062662, "post_id": 56670132, "comment_id": 99952141, "body": "Updated my answer with a version that uses @chtz&#39;s suggestion: it auto-vectorizes even with GCC (without <code>-ffast-math</code>), and auto-vectorizes more efficiently for clang."}], "answers": [{"comments": [{"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1561011437, "post_id": 56679885, "comment_id": 99926047, "body": "chtz&#39;s comment suggested avoiding <code>blendvpd</code> in favour of unconditional subtract of an <code>andps</code> result.  That&#39;s both more efficient and only requires SSE2, with the only possible difference being with NaN inputs."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1561011892, "post_id": 56679885, "comment_id": 99926233, "body": "During the AVX &quot;warm up&quot; time, Agner Fog reports something like 1/4 performance on Intel.  That&#39;s still ~= scalar for, or better if the scalar was inefficient.  And the AVX upper lane stays powered on / warmed up for milliseconds, so that can only bite if you use 256-bit vectors very infrequently, and thus it can&#39;t be a throughput problem.  (But possibly latency if you need to respond quickly to a rare event.)"}, {"owner": {"reputation": 15641, "user_id": 126995, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bdd0d42e87a7c2636f0570ce12d069e5?s=128&d=identicon&r=PG", "display_name": "Soonts", "link": "https://stackoverflow.com/users/126995/soonts"}, "reply_to_user": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1561015493, "post_id": 56679885, "comment_id": 99927828, "body": "@PeterCordes About substraction trick, I\u2019m not sure about faster, <code>blendpd</code> has 1 cycle latency, the throughput is 2-3 instructions/cycle; <code>andpd</code> also 1 cycle latency but before skylake the throughput was only 1 instruction/cycle, which may suggest it was only executed by a single EU. But indeed, definitely more compatible, and faster than 3 bitwise operations workaround I\u2019ve mentioned."}, {"owner": {"reputation": 52741, "user_id": 555045, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/182d0ce855c8324a596648c04643e8f9?s=128&d=identicon&r=PG", "display_name": "nicomp", "link": "https://stackoverflow.com/users/555045/nicomp"}, "edited": false, "score": 2, "creation_date": 1561016525, "post_id": 56679885, "comment_id": 99928312, "body": "<code>blendpd</code> is not the same thing as <code>blendvpd</code> though"}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1561016713, "post_id": 56679885, "comment_id": 99928401, "body": "@Soonts: on Ryzen, variable blends are no more expensive than immediate blends.  But on Intel they are, except for Skylake with the non-VEX legacy SSE encoding (implicit blend-control source in XMM0).  On all other Intel CPUs, variable blends are extra uops or even limited to the shuffle port.  Have a look at <a href=\"https://agner.org/optimize/\" rel=\"nofollow noreferrer\">Agner Fog&#39;s instruction tables</a> outside of the Skylake and Ryzen tabs.  (Although those <i>are</i> the most relevant microarchitectures going forward: Ryzen and SKL (and KBL / CFL) are more and more widespread.  But that doesn&#39;t help for AVX <code>vblendvpd</code>.)"}], "tags": [], "owner": {"reputation": 15641, "user_id": 126995, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bdd0d42e87a7c2636f0570ce12d069e5?s=128&d=identicon&r=PG", "display_name": "Soonts", "link": "https://stackoverflow.com/users/126995/soonts"}, "is_accepted": false, "score": 4, "last_activity_date": 1561010655, "creation_date": 1561010655, "answer_id": 56679885, "question_id": 56670132, "link": "https://stackoverflow.com/questions/56670132/simd-for-float-threshold-operation/56679885#56679885", "title": "SIMD for float threshold operation", "body": "<p>Here you go (untested), I\u2019ve tried to explain in the comments what they do.</p>\n\n<pre><code>void func_sse41( const double* left, const double* right, double* res,\n    const size_t size, double th, double drop )\n{\n    // Verify the size is even.\n    // If it's not, you'll need extra code at the end to process last value the old way.\n    assert( 0 == ( size % 2 ) );\n\n    // Load scalar values into 2 registers.\n    const __m128d threshold = _mm_set1_pd( th );\n    const __m128d dropVec = _mm_set1_pd( drop );\n\n    for( size_t i = 0; i &lt; size; i += 2 )\n    {\n        // Load 4 double values into registers, 2 from right, 2 from left\n        const __m128d r = _mm_loadu_pd( right + i );\n        const __m128d l = _mm_loadu_pd( left + i );\n        // Compare ( r &gt;= threshold ) for 2 values at once\n        const __m128d comp = _mm_cmpge_pd( r, threshold );\n        // Compute ( left[ i ] - drop ), for 2 values at once\n        const __m128d dropped = _mm_sub_pd( l, dropVec );\n        // Select either left or ( left - drop ) based on the comparison.\n        // This is the only instruction here that requires SSE 4.1.\n        const __m128d result = _mm_blendv_pd( l, dropped, comp );\n        // Store the 2 result values\n        _mm_storeu_pd( res, result );\n    }\n}\n</code></pre>\n\n<p>The code will crash with \u201cinvalid instruction\u201d runtime error if the CPU doesn\u2019t have SSE 4.1. For best result, detect with CPU ID to fail gracefully. I think now in 2019 it\u2019s quite reasonable to assume it\u2019s supported, Intel did in 2008, AMD in 2011, steam survey says \u201c96.3%\u201d. If you want to support older CPUs, possible to emulate _mm_blendv_pd with 3 other instructions, _mm_and_pd, _mm_andnot_pd, _mm_or_pd.</p>\n\n<p>If you can guarantee the data is aligned, replacing loads with <code>_mm_load_pd</code> will be slightly faster, _mm_cmpge_pd compiles into CMPPD <a href=\"https://www.felixcloutier.com/x86/cmppd\" rel=\"nofollow noreferrer\">https://www.felixcloutier.com/x86/cmppd</a> which can take one of the arguments directly from RAM.</p>\n\n<p>Potentially, you can get further 2x improvement by writing AVX version. But I hope even SSE version is faster than your code, it handles 2 values per iteration, and doesn\u2019t have conditions inside the loop. If you\u2019re unlucky, AVX will be slower, many CPUs need some time to power on their AVX units, takes many thousands of cycles. Until powered, AVX code runs very slowly.</p>\n"}, {"comments": [{"owner": {"reputation": 15641, "user_id": 126995, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bdd0d42e87a7c2636f0570ce12d069e5?s=128&d=identicon&r=PG", "display_name": "Soonts", "link": "https://stackoverflow.com/users/126995/soonts"}, "edited": false, "score": 0, "creation_date": 1561018972, "post_id": 56681744, "comment_id": 99929578, "body": "This line of assembly: <code>vcmplepd ymm3, ymm4, YMMWORD PTR [rsi+rax]</code> Won\u2019t this instruction crash in runtime unless the caller code aligns these buffers with AVX in mind? My version uses <code>_mm_loadu_pd</code> for compatibility with non-SIMD aware layouts, such as <code>std::vector&lt;double&gt;</code>"}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 15641, "user_id": 126995, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bdd0d42e87a7c2636f0570ce12d069e5?s=128&d=identicon&r=PG", "display_name": "Soonts", "link": "https://stackoverflow.com/users/126995/soonts"}, "edited": false, "score": 3, "creation_date": 1561019562, "post_id": 56681744, "comment_id": 99929868, "body": "@Soonts: VEX-encoded instructions don&#39;t require alignment of their memory-source operands, except for instructions that specifically <i>do</i> have alignment requirements (like <code>vmovaps</code> or <code>vmovntps</code>).  This is one of the many advantages of VEX encoding, even for 128-bit instructions.  If you compile your version with <code>-march=sandybridge</code>, you&#39;ll see that the compile can fold <code>_mm_loadu_pd</code> into a memory operand for a compare.  (If it can find a predicate that fits with <code>right[]</code> as the 2nd source; but AVX does add a bunch of new comparison predicates for <code>vcmppd</code>)"}, {"owner": {"reputation": 15641, "user_id": 126995, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bdd0d42e87a7c2636f0570ce12d069e5?s=128&d=identicon&r=PG", "display_name": "Soonts", "link": "https://stackoverflow.com/users/126995/soonts"}, "edited": false, "score": 0, "creation_date": 1561020730, "post_id": 56681744, "comment_id": 99930475, "body": "Interesting, thanks. Couple years ago I\u2019ve fixed a bug where I forgot to align one thing, and in 32-bit builds _mm_and_si128 sometimes crashed accessing the value. I was building C++ with VS2015, not sure about instruction encoding."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 15641, "user_id": 126995, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bdd0d42e87a7c2636f0570ce12d069e5?s=128&d=identicon&r=PG", "display_name": "Soonts", "link": "https://stackoverflow.com/users/126995/soonts"}, "edited": false, "score": 0, "creation_date": 1561054760, "post_id": 56681744, "comment_id": 99948947, "body": "@Soonts: you must have been building without <code>&#47;arch:AVX</code>, where only a <code>_mm_load_si128()</code> can fold into a memory operand for legacy SSE2 <code>pand</code>.  The VEX encoding, <code>vpand</code>, will never fault for alignment."}, {"owner": {"reputation": 6533, "user_id": 1918193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b70a14318e0f417ecac47809f38fafc?s=128&d=identicon&r=PG", "display_name": "Marc Glisse", "link": "https://stackoverflow.com/users/1918193/marc-glisse"}, "edited": false, "score": 3, "creation_date": 1561059695, "post_id": 56681744, "comment_id": 99950966, "body": "<code>-fno-trapping-math</code> seems sufficient for gcc to vectorize."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 6533, "user_id": 1918193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b70a14318e0f417ecac47809f38fafc?s=128&d=identicon&r=PG", "display_name": "Marc Glisse", "link": "https://stackoverflow.com/users/1918193/marc-glisse"}, "edited": false, "score": 1, "creation_date": 1561059895, "post_id": 56681744, "comment_id": 99951054, "body": "@MarcGlisse: That&#39;s a missed optimization for AVX512, then: My understanding is that a masked subtract will not even compute the subtract in the masked elements, so they won&#39;t raise FP exceptions (or set exception bits in MXCSR).  So we get FP fault suppression as well as memory fault suppression for memory sources.  (Of course this would require GCC to actually do a masked subtract, instead of a separate blend.)"}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 6533, "user_id": 1918193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b70a14318e0f417ecac47809f38fafc?s=128&d=identicon&r=PG", "display_name": "Marc Glisse", "link": "https://stackoverflow.com/users/1918193/marc-glisse"}, "edited": false, "score": 1, "creation_date": 1561060689, "post_id": 56681744, "comment_id": 99951370, "body": "@Marc: Hoisting <code>double ldrop = left[i]-drop;</code> out of the ternary means the C always computes it, like branchless asm wants to. GCC still won&#39;t auto-vec unless we use <code>-fno-trapping-math</code> <a href=\"https://godbolt.org/z/1K_1L2\" rel=\"nofollow noreferrer\">godbolt.org/z/1K_1L2</a>.  The non-vectorized scalar version uses a branch, so it <i>doesn&#39;t</i> cause an FP exception if <code>right[i]&gt;th</code>, for <code>left[i]</code> or <code>drop</code> being NaN.  Is that a bug? (I&#39;m also not clear on whether trapping-math considers the <i>number</i> of FP exceptions a visible side-effect (i.e. unmasked and actually trapping) or if it&#39;s just whether or not the sticky exception bits in MXCSR ever get set.)"}, {"owner": {"reputation": 6533, "user_id": 1918193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b70a14318e0f417ecac47809f38fafc?s=128&d=identicon&r=PG", "display_name": "Marc Glisse", "link": "https://stackoverflow.com/users/1918193/marc-glisse"}, "edited": false, "score": 4, "creation_date": 1561063481, "post_id": 56681744, "comment_id": 99952463, "body": "<code>-ftrapping-math</code> and <code>-frounding-math</code> are completely broken, they never worked. Expecting them to make consistent, sensible choices is rather optimistic."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 6533, "user_id": 1918193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b70a14318e0f417ecac47809f38fafc?s=128&d=identicon&r=PG", "display_name": "Marc Glisse", "link": "https://stackoverflow.com/users/1918193/marc-glisse"}, "edited": false, "score": 2, "creation_date": 1561064912, "post_id": 56681744, "comment_id": 99952995, "body": "@MarcGlisse: Has anyone proposed turning them off by default?  If they don&#39;t work then they&#39;re just creating missed optimizations for no(?) benefit."}, {"owner": {"reputation": 6533, "user_id": 1918193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b70a14318e0f417ecac47809f38fafc?s=128&d=identicon&r=PG", "display_name": "Marc Glisse", "link": "https://stackoverflow.com/users/1918193/marc-glisse"}, "edited": false, "score": 3, "creation_date": 1561072548, "post_id": 56681744, "comment_id": 99954998, "body": "rounding is off by default, and for trapping it is PR54192."}, {"owner": {"reputation": 14588, "user_id": 6870253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c7ce91530d2dddae7b9fc2bd828ed78?s=128&d=identicon&r=PG&f=1", "display_name": "chtz", "link": "https://stackoverflow.com/users/6870253/chtz"}, "edited": false, "score": 2, "creation_date": 1561115488, "post_id": 56681744, "comment_id": 99967935, "body": "Another (in most cases irrelevant) effect of adding instead of subtracting: <code>-0.0 + 0.0 == +0.0</code>, whereas <code>-0.0 - 0.0 == -0.0</code>, i.e., <code>-0.0</code> inside <code>left</code> will get converted to <code>+0.0</code>."}], "tags": [], "owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "is_accepted": true, "score": 7, "last_activity_date": 1567116551, "last_edit_date": 1567116551, "creation_date": 1561018339, "answer_id": 56681744, "question_id": 56670132, "link": "https://stackoverflow.com/questions/56670132/simd-for-float-threshold-operation/56681744#56681744", "title": "SIMD for float threshold operation", "body": "<p><strong>Clang already auto-vectorizes this pretty much the way Soonts suggested doing manually.</strong>  Use <code>__restrict</code> on your pointers so it doesn't need a fallback version that works for overlap between some of the arrays.  It still auto-vectorizes, but it bloats the function.</p>\n\n<p>Unfortunately gcc only auto-vectorizes with <code>-ffast-math</code>.  It turns out only <strong><code>-fno-trapping-math</code></strong> is required: that's generally safe especially if you aren't using <code>fenv</code> access to unmask any FP exceptions (<code>feenableexcept</code>) or looking at MXCSR sticky FP exception flags (<code>fetestexcept</code>).</p>\n\n<p>With that option, then GCC too will use <code>(v)pblendvpd</code> with <code>-march=nehalem</code> or <code>-march=znver1</code>.  <strong><a href=\"https://godbolt.org/#z:OYLghAFBqd5QCxAYwPYBMCmBRdBLAF1QCcAaPECAKxAEZSAbAQwDtQB9T5UgZ1QFdiyTCADkAUgBMAZjwtkDflgDU46QGEeBdFgBmAOgRrs4gAwBBM%2BYBuqPOmW7%2B8iGhZbl6AQCMGmZQBUnMSYWsR4yATKfroEpMpuHl78vv5B7CFhEVHhwAhxnj5%2BgcGhBOGRypmkVsoJqO5RPHgAXpjsTa2Y8YlRyanKBAg9DUlF/ujEqAAOAJRW4gDsAEK1dY4kyhDNbR3KeKrSACLKpmrL%2B4fqyjuY56qSq494s6ora%2Bvr/cUMkzOHJwgMQI4gArMs8GCTgBaTxTOb3ZQAeiR%2BxYgwQmBIAE9lJiGNN6gBbaZ4PzEHjKIlMADW/m8xFYyAQfh4lLQKm8uOpNLkwAxeEpzjc%2BAIeAaTAYH0%2B6xRygA4uprloyQxlCxMJh0JToboWKhoeUmNNSWxodShtLPpkwRCoQCqng8iDwZDQSdjGoTkNDgAxaKYWK2t0nEDRP6E87SpZHBaLWMWBYWWz2RzCySuUZ9cYlDJlCpRYEjRqFFLFdKZcrZR3O%2BLfNKlLKVaprXo3Lp7W7FsZl/xDbvZ3twmbzRPvCyfXSbbYdqIHL2ne7zjTttr3KRPCGvJarCcyur1m4pB25fLB%2B2e44Yv2nfSmZRhiNRvf7m2ui9X4Hn93KWE8FLPuYnwxnGCaWImyZ2A4TjyNImYloeFb5tWRb1AhOZIU2OROvkdYYY2VbNqENR7m2tydl0A6lgM/ZoT2AwRqOljjkB6xTsQWzkXODpnNIFzLsqXTro8G4vG8u6sfuh5MDoJ44S6do/pe3oIDeph3g%2Bv5PnxVrrG%2Bikep%2BgYKSGDwXDJ6CAcB8agVYoizIwYigqIpAsGIpguagYjKgIQj%2BFI0i0C5BDufZDk0iAAAsoL6AAnKY0iRUliygpFpiSJFgWOaIkUuW5ogeaQXmiC5PAgKYpAhQV9mkHAsAwIgKCoCSZKYGQFCZi15IoAorDAAAHKYFW6GSBBtWVEDeKFpDeHITDENiYhBaQaBEkSmAsAQADyLAMIt1WkFg1JsH4034CEkR4NYoTTZgAAemDIPwY1LS5chjQw00MHgDLzdi6gYCIojLVWRKvQ5zBsCAnDsNw33eGVkAOTMYqjGI0IAOqSmqmP3Uav5bdIv7UkIRjHBqCCSpgRKlb5wh0BDTl5dNxV3f1ABs0Ls5FCSQ/y/V3hpEC4IQmwBfQygA11bUPIFrzqMFoWzOFICpXesXs6CWsZaCsUpYs2W5aQYNJfo7OmNzoKDZINsZbQkiuSzYileVlVK7VDUQEgq2kuS5CUD7rXECgwCxfQI0MGNFKUFNB2zSwf2vStzXrZtO17Wd1N9adB3nY9YrXWVB33Y9z1A8t72YJ9B3w4yC0A1gSeg%2BDjB9dDXCMD9iMQMj0yo%2B46NYwwOMY3jjIE0T5rzcyXo8DS2LMHStOCPTtCM6IzmOwdrMc1zPPAMgyDKLF%2Bi0FsItEBx4vxFLvsywFkjy4r1XK4bLlg1r%2BjSLF0ipbQeuLEAVbfqW9CrFRdhVKqHlX4RTVqYDWWtQQ6z1qCA21dpDM23s7N2L916SHfnQIaoDPLYKgWFUg10KTijcpFIAA%3D%3D\" rel=\"nofollow noreferrer\">See it on Godbolt</a></strong></p>\n\n<p>Also, your C function is broken.  <code>th</code> and <code>drop</code> are scalar double, but you declare them as <code>const double *</code></p>\n\n<hr>\n\n<p>AVX512F would let you do a <code>!(right[i] &gt;= thresh)</code> compare and use the resulting mask for a merge-masked subtract.</p>\n\n<p>Elements where the predicate was true will get <code>left[i] - drop</code>, other elements will keep their <code>left[i]</code> value, because you merge info a vector of <code>left</code> values.</p>\n\n<p>Unfortunately GCC with <code>-march=skylake-avx512</code> uses a normal <code>vsubpd</code> and then a separate <code>vmovapd zmm2{k1}, zmm5</code> to blend, which is obviously a missed optimization.  The blend destination is already one of the inputs to the SUB.</p>\n\n<p>Using AVX512VL for 256-bit vectors (in case the rest of your program can't efficiently use 512-bit, so you don't suffer reduced turbo clock speeds):</p>\n\n<pre><code>__m256d left = ...;\n__m256d right = ...;\n__mmask8 cmp = _mm256_cmp_pd_mask(right, set1(th), _CMP_NGE_UQ);\n__m256d res = _mm256_mask_sub_pd (left, cmp, left, set1(drop));\n</code></pre>\n\n<p>So (besides the loads and store) it's 2 instructions with AVX512F / VL.</p>\n\n<hr>\n\n<h3>If you don't need the specific NaN behaviour of your version, GCC can auto-vectorize too</h3>\n\n<p><strong>And it's more efficient with all compilers because you just need an AND, not a variable-blend.</strong>  So it's significantly better with just SSE2, and also better on most CPUs even when they do support SSE4.1 <code>blendvpd</code>, because that instruction isn't as efficient.</p>\n\n<p>You can subtract <code>0.0</code> or <code>drop</code> from <code>left[i]</code> based on the compare result.</p>\n\n<p>Producing <code>0.0</code> or a constant based on a compare result is extremely efficient: just an <code>andps</code> instruction.  (The bit-pattern for <code>0.0</code> is all-zeros, and SIMD compares produce vectors of all-1 or all-0 bits.  So AND keeps the old value or zeros it.)</p>\n\n<p>We can also add <code>-drop</code> instead of subtracting <code>drop</code>.  This costs an extra negation on input, but with AVX allows a memory-source operand for <code>vaddpd</code>.  GCC chooses to use an indexed addressing mode so that doesn't actually help reduce the front-end uop count on Intel CPUs, though; it will \"unlaminate\".  But even with <code>-ffast-math</code>, gcc doesn't do this optimization on its own to allow folding a load.  (It wouldn't be worth doing separate pointer increments unless we unroll the loop, though.)</p>\n\n<pre><code>void func3(const double *__restrict left, const double *__restrict right, double *__restrict res,\n  const size_t size, const double th, const double drop)\n{\n    for (size_t i = 0; i &lt; size; ++i) {\n        double add = right[i] &gt;= th ? 0.0 : -drop;\n        res[i] = left[i] + add;\n    }\n}\n</code></pre>\n\n<p>GCC 9.1's inner loop (without any <code>-march</code> options and without <code>-ffast-math</code>) from the Godbolt link above:</p>\n\n<pre><code># func3 main loop\n# gcc -O3 -march=skylake       (without fast-math)\n.L33:\n    vcmplepd        ymm2, ymm4, YMMWORD PTR [rsi+rax]\n    vandnpd ymm2, ymm2, ymm3\n    vaddpd  ymm2, ymm2, YMMWORD PTR [rdi+rax]\n    vmovupd YMMWORD PTR [rdx+rax], ymm2\n    add     rax, 32\n    cmp     r8, rax\n    jne     .L33\n</code></pre>\n\n<p>Or the plain SSE2 version has an inner loop that's basically the same as with <code>left - zero_or_drop</code> instead of <code>left + zero_or_minus_drop</code>, so unless you can promise the compiler 16-byte alignment or you're making an AVX version, negating <code>drop</code> is just extra overhead.</p>\n\n<p><strong>Negating <code>drop</code> takes a constant from memory (to XOR the sign bit), and that's the only static constant this function needs</strong>, so that tradeoff is worth considering for your case where the loop doesn't run a huge number of times.  (Unless <code>th</code> or <code>drop</code> are also compile-time constants after inlining, and are getting loaded anyway.  Or especially if <code>-drop</code> can be computed at compile time.  Or if you can get your program to work with a negative <code>drop</code>.)</p>\n\n<p>Another difference between adding and subtracting is that subtracting doesn't destroy the sign of zero.  <code>-0.0 - 0.0 = -0.0</code>, <code>+0.0 - 0.0 = +0.0</code>.  In case that matters.</p>\n\n<pre><code># gcc9.1 -O3\n.L26:\n    movupd  xmm5, XMMWORD PTR [rsi+rax]\n    movapd  xmm2, xmm4                    # duplicate  th\n    movupd  xmm6, XMMWORD PTR [rdi+rax]\n    cmplepd xmm2, xmm5                    # destroy the copy of th\n    andnpd  xmm2, xmm3                    # _mm_andnot_pd\n    addpd   xmm2, xmm6                    # _mm_add_pd\n    movups  XMMWORD PTR [rdx+rax], xmm2\n    add     rax, 16\n    cmp     r8, rax\n    jne     .L26\n</code></pre>\n\n<p>GCC uses unaligned loads so (without AVX) it can't fold a memory source operand into <code>cmppd</code> or <code>subpd</code></p>\n"}, {"tags": [], "owner": {"reputation": 29002, "user_id": 2542702, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fW5ka.jpg?s=128&g=1", "display_name": "Z boson", "link": "https://stackoverflow.com/users/2542702/z-boson"}, "is_accepted": false, "score": 2, "last_activity_date": 1561031839, "creation_date": 1561031839, "answer_id": 56685477, "question_id": 56670132, "link": "https://stackoverflow.com/questions/56670132/simd-for-float-threshold-operation/56685477#56685477", "title": "SIMD for float threshold operation", "body": "<p>You can use GCC's and Clang's vector extensions to implement a ternary select function (see <a href=\"https://stackoverflow.com/a/48538557/2542702\">https://stackoverflow.com/a/48538557/2542702</a>).</p>\n\n<pre><code>#include &lt;stddef.h&gt;\n#include &lt;inttypes.h&gt;\n\n#if defined(__clang__)\ntypedef  double double4 __attribute__ ((ext_vector_type(4)));\ntypedef int64_t   long4 __attribute__ ((ext_vector_type(4)));\n#else\ntypedef  double double4 __attribute__ ((vector_size (sizeof(double)*4)));\ntypedef int64_t   long4 __attribute__ ((vector_size (sizeof(int64_t)*4)));\n#endif\n\ndouble4 select(long4 s, double4 a, double4 b) {\n  double4 c;\n  #if defined(__GNUC__) &amp;&amp; !defined(__INTEL_COMPILER) &amp;&amp; !defined(__clang__)\n  c = s ? a : b;\n  #else\n  for(int i=0; i&lt;4; i++) c[i] = s[i] ? a[i] : b[i];\n  #endif\n  return c;\n}\n\nvoid func(double* left, double* right, double* res, size_t size, double th, double drop) {\n  size_t i;\n  for (i = 0; i&lt;(size&amp;-4); i+=4) {\n    double4 leftv = *(double4*)&amp;left[i];\n    double4 rightv = *(double4*)&amp;right[i];\n    *(double4*)&amp;res[i] = select(rightv &gt;= th, leftv, leftv - drop);\n  }\n  for(;i&lt;size; i++) res[i] = right[i] &gt;= th ? left[i] : (left[i] - drop);\n}\n</code></pre>\n\n<p><a href=\"https://godbolt.org/z/h4OKMl\" rel=\"nofollow noreferrer\">https://godbolt.org/z/h4OKMl</a></p>\n"}], "owner": {"reputation": 321, "user_id": 938126, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a6cf8c07921b4c70077e298d7630c1ca?s=128&d=identicon&r=PG", "display_name": "Sindbag", "link": "https://stackoverflow.com/users/938126/sindbag"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 470, "favorite_count": 1, "accepted_answer_id": 56681744, "answer_count": 3, "score": 3, "last_activity_date": 1567116551, "creation_date": 1560954584, "last_edit_date": 1561042858, "question_id": 56670132, "link": "https://stackoverflow.com/questions/56670132/simd-for-float-threshold-operation", "title": "SIMD for float threshold operation", "body": "<p>I would like to make some vector computation faster, and I believe that SIMD instructions for float comparison and manipulation could help, here is the operation:</p>\n\n<pre><code>void func(const double* left, const double* right, double* res, const size_t size, const double th, const double drop) {\n        for (size_t i = 0; i &lt; size; ++i) {\n            res[i] = right[i] &gt;= th ? left[i] : (left[i] - drop) ;\n        }\n    }\n</code></pre>\n\n<p>Mainly, it drops the <code>left</code> value by <code>drop</code> in case <code>right</code> value is higher than <code>threshold</code>.</p>\n\n<p>The size is around 128-256 (not that big), but computation is called heavily.</p>\n\n<p>I tried to start with loop unrolling, but did not win a lot of performance, but may be some compile instructions are needed.</p>\n\n<p>Could you please suggest some improvement into the code for faster computation?</p>\n"}, {"tags": ["c++", "sockets", "ip", "client", "boost-asio"], "comments": [{"owner": {"reputation": 17331, "user_id": 8950365, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c6ba3b19f86f1bea8cf76e691db4349?s=128&d=identicon&r=PG&f=1", "display_name": "rafix07", "link": "https://stackoverflow.com/users/8950365/rafix07"}, "edited": false, "score": 2, "creation_date": 1560955666, "post_id": 56669994, "comment_id": 99908365, "body": "Use <a href=\"https://www.boost.org/doc/libs/1_70_0/doc/html/boost_asio/reference/basic_datagram_socket/receive_from.html\" rel=\"nofollow noreferrer\">receive_from</a>. When you get data, check <code>sender_endpoint</code>, it will be filled by sender ip."}], "answers": [{"comments": [{"owner": {"reputation": 326119, "user_id": 85371, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/6d52c235ec6dd15f30bab444103e7af2?s=128&d=identicon&r=PG", "display_name": "sehe", "link": "https://stackoverflow.com/users/85371/sehe"}, "edited": false, "score": 0, "creation_date": 1561066942, "post_id": 56670614, "comment_id": 99953678, "body": "This answer doesn&#39;t use the language or any of the libraries used by OP. It also doesn&#39;t address the special considerations surrounding UDP, because that&#39;s a connectionless protocol and you do need other provisions to get the peer address with a datagram received. Finally, you are using printf to print the address that accept bound to (that&#39;s not the sender), regardless of the fact that this does not result in the endpoint in usable form. @rafix07&#39; comment has the correct approach and predates this answer."}], "tags": [], "owner": {"reputation": 220, "user_id": 11277878, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uePcL.jpg?s=128&g=1", "display_name": "grizzly", "link": "https://stackoverflow.com/users/11277878/grizzly"}, "is_accepted": false, "score": -1, "last_activity_date": 1560956020, "creation_date": 1560956020, "answer_id": 56670614, "question_id": 56669994, "link": "https://stackoverflow.com/questions/56669994/get-the-ip-address-from-a-remote-client-remote-endpoint-transport-endpoint-is/56670614#56670614", "title": "get the ip address from a remote client: remote_endpoint: Transport endpoint is not connected", "body": "<pre><code>struct sockaddr_in sAddr;\nsocklen_t sLen = sizeof sAddr;\n[your socket] = accept([socket to listen], (struct sockaddr *) &amp;sAddr, &amp;sLen);\n\nprintf(\"%s\",inet_ntoa(sAddr.sin_addr));\n</code></pre>\n\n<p>Replace <code>your socket</code> and <code>socket to listen</code> with yours'.</p>\n"}], "owner": {"reputation": 1, "user_id": 11260952, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vFklCt_l2WM/AAAAAAAAAAI/AAAAAAAAAFA/4vXDsT6Wm0w/photo.jpg?sz=128", "display_name": "Meriem OUADAH", "link": "https://stackoverflow.com/users/11260952/meriem-ouadah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 189, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1560956020, "creation_date": 1560954192, "question_id": 56669994, "link": "https://stackoverflow.com/questions/56669994/get-the-ip-address-from-a-remote-client-remote-endpoint-transport-endpoint-is", "title": "get the ip address from a remote client: remote_endpoint: Transport endpoint is not connected", "body": "<p>does anyone know how to get the ip address of a remote client from a socket \ni have tried this function : \ni have tried to use this function :</p>\n\n<pre><code>std::string s =socket.remote_endpoint().address().to_string();    \n</code></pre>\n\n<p>but i always get the following error even if i can ping from and to the client :\nterminate called after throwing an instance of 'boost::exception_detail::clone_impl >'\n  what():  remote_endpoint: Transport endpoint is not connected\n^[[AAbandon (core dumped)</p>\n\n<p>is there any way to retrieve the ip address of the sender (ps :want to use it for a checkup before sending data)</p>\n\n<pre><code>boost::asio::io_service io_service;\nboost::asio::ip::udp::socket socket(io_service);\nsocket.open(boost::asio::ip::udp::v4());\nsocket.bind(boost::asio::ip::udp::endpoint(\nboost::asio::ip::udp::v4(),port));\n\nstd::cout &lt;&lt; \"Ready to receive\" &lt;&lt; std::endl;\n\n//information about where the packets come from\nboost::asio::ip::udp::endpoint sender;\n/////retrieve ip\nstd::string s =socket.remote_endpoint().address().to_string(); \nstd::cout &lt;&lt; \"The client's ip is:\" &lt;&lt; s &lt;&lt; std::endl;\n</code></pre>\n"}, {"tags": ["c++", "qt", "vector", "nested"], "comments": [{"owner": {"reputation": 219644, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "edited": false, "score": 1, "creation_date": 1560953406, "post_id": 56669658, "comment_id": 99906932, "body": "You could declare the vector the following way std::vector&lt;std::vector&lt;Cells&gt; &gt; cells( size, std::vector&lt;Cells&gt;( size ) ); provided that the class Cells has the default constructor. Otherwise use method push_back instead of indices."}, {"owner": {"reputation": 13, "user_id": 3326452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c266f53ac09aae4bc641f3d32f4c887d?s=128&d=identicon&r=PG&f=1", "display_name": "Kang_HM", "link": "https://stackoverflow.com/users/3326452/kang-hm"}, "reply_to_user": {"reputation": 219644, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "edited": false, "score": 0, "creation_date": 1560954691, "post_id": 56669658, "comment_id": 99907732, "body": "@VladfromMoscow thank you thank you so much!!!!!!!!!!!!!!!!!!!!!!!!! i solved it!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 3326452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c266f53ac09aae4bc641f3d32f4c887d?s=128&d=identicon&r=PG&f=1", "display_name": "Kang_HM", "link": "https://stackoverflow.com/users/3326452/kang-hm"}, "edited": false, "score": 0, "creation_date": 1560958485, "post_id": 56669998, "comment_id": 99910207, "body": "but if i do that, i always get this message  -&gt;   The inferior stopped because it received a signal from the operating system.  Signal name :  SIGSEGV Signal meaning :  Segmentation fault"}], "tags": [], "owner": {"reputation": 15189, "user_id": 477771, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e1e6012428cc236ed32cf9a13376f0f3?s=128&d=identicon&r=PG", "display_name": "Mark Storer", "link": "https://stackoverflow.com/users/477771/mark-storer"}, "is_accepted": false, "score": 1, "last_activity_date": 1560954203, "creation_date": 1560954203, "answer_id": 56669998, "question_id": 56669658, "link": "https://stackoverflow.com/questions/56669658/problem-2d-vector-nested-vector-with-datatype-of-new-class/56669998#56669998", "title": "Problem: 2d Vector (nested Vector) with datatype of new class", "body": "<p>You need to allocate to your vectors, not just write to them hoping there is something there on which to write.</p>\n\n<pre><code>std::vector&lt;std::vector&lt;Cells&gt; &gt; cells;\ncells.resize(size);\n\nfor(unsigned long i = 0; i &lt; size; i++) {\n    cells[i].resize(size)\n    for(unsigned long j = 0; j &lt; size; j++) {\n        Cells contentOftheCell(matrixPotential,\n                               deltaMatrixPotential);\n        cells[i][j] = contentOftheCell;\n    }\n}\n</code></pre>\n\n<p>This example allocates the memory via resize, which is more efficient than using vector::push_back to add space as you go.  It's possible to Properly Construct your vectors in the first place which would be a bit better, but I leave that as an exercise for the reader.</p>\n"}], "owner": {"reputation": 13, "user_id": 3326452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c266f53ac09aae4bc641f3d32f4c887d?s=128&d=identicon&r=PG&f=1", "display_name": "Kang_HM", "link": "https://stackoverflow.com/users/3326452/kang-hm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1560954203, "creation_date": 1560953185, "last_edit_date": 1560953512, "question_id": 56669658, "link": "https://stackoverflow.com/questions/56669658/problem-2d-vector-nested-vector-with-datatype-of-new-class", "title": "Problem: 2d Vector (nested Vector) with datatype of new class", "body": "<p>I made 2 classes, one of them is \"Cells\" and another one is \"Calculation\". </p>\n\n<p>cells is a 2d vector with a datatype of class \"Cells\" \nand i want to put the object of \"Cells\" - content of the Cell - in a 2d vector \"Cells\" </p>\n\n<p>later i will calculate matrixPotential and deltaMatrixPotential. </p>\n\n<p>but i even cannot put the object in a 2d Vector. </p>\n\n<pre><code>Cells::Cells(double matrixPotential,\n             double deltaMatrixPotential)\n{\n    this-&gt;matrixPotential = matrixPotential;\n    this-&gt;deltaMatrixPotential = deltaMatrixPotential;\n}\n\nCalculation::Calculation()\n{\n    std::vector&lt;std::vector&lt;Cells&gt; &gt; cells;\n\n    for(unsigned long i = 0; i &lt; size; i++){\n        for(unsigned long j = 0; j &lt; size; j++){\n            Cells contentOftheCell(matrixPotential,\n                                   deltaMatrixPotential);\n            cells[i][j] = contentOftheCell;\n        }\n    }\n}\n</code></pre>\n\n<p>How can i make it possible? \nI could do it in a normal vector but it seems impossible in a 2d Vector</p>\n"}, {"tags": ["c++", "mysql", "libmysql"], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 12744369, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/d509b59a74a2a7a370824feb6fa05887?s=128&d=identicon&r=PG", "display_name": "Valentin", "link": "https://stackoverflow.com/users/12744369/valentin"}, "is_accepted": false, "score": 0, "last_activity_date": 1579475532, "creation_date": 1579475532, "answer_id": 59815258, "question_id": 56669539, "link": "https://stackoverflow.com/questions/56669539/batch-insert-in-mysql-c-connector/59815258#59815258", "title": "Batch Insert in Mysql C++ Connector", "body": "<p>You forgot to delete the Prepared Statement stmt.</p>\n\n<p><a href=\"https://dev.mysql.com/doc/connector-cpp/1.1/en/connector-cpp-examples-prepared-statements.html\" rel=\"nofollow noreferrer\">https://dev.mysql.com/doc/connector-cpp/1.1/en/connector-cpp-examples-prepared-statements.html</a></p>\n\n<p>Note</p>\n\n<p>You must free the sql::PreparedStatement and sql::Connection objects explicitly using delete.</p>\n"}], "owner": {"reputation": 541, "user_id": 1164505, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/25143a36659550c9126832c22ba9d55b?s=128&d=identicon&r=PG", "display_name": "tolgatanriverdi", "link": "https://stackoverflow.com/users/1164505/tolgatanriverdi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 364, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1579475532, "creation_date": 1560952896, "last_edit_date": 1560953669, "question_id": 56669539, "link": "https://stackoverflow.com/questions/56669539/batch-insert-in-mysql-c-connector", "title": "Batch Insert in Mysql C++ Connector", "body": "<p>We are using mysql connector for c++(official library), however there is no <code>batchupdate</code> or <code>batchinsert</code> method in the c++ library (Although in java those methods do exist).</p>\n\n<p>For accomplishing this I've tried something like below and it worked. However in this case if we insert thousands of rows of data in every minute, in approximately 30 minutes mysql consumes all the memory in our computer(which has 32G of memory).</p>\n\n<p>Is this usage wrong, if so what should we do? (We ran the code below in a loop):</p>\n\n<pre><code> try {\n        //autoClose parameter is false in our case\n        if (!autoClose) {\n            con-&gt;setAutoCommit(false);\n        }\n\n        stmt = con-&gt;prepareStatement(queryBuilder);\n\n        this-&gt;setPreparedStatements(insertData);\n\n        result = stmt-&gt;executeUpdate();\n        stmt-&gt;close();\n\n        if (getAutoGeneratedKey) {\n            std::string lastIdQuery = \"SELECT LAST_INSERT_ID()\";\n            stmt = con-&gt;prepareStatement(lastIdQuery);\n            ResultSet *rs = stmt-&gt;executeQuery();\n            while (rs-&gt;next()) {\n                result = rs-&gt;getInt(1);\n            }\n\n            rs-&gt;close();\n            delete rs;\n            stmt-&gt;close();\n        }\n\n        if (autoClose) { //autoClose parameter is false in our case\n            con-&gt;close();\n        }\n</code></pre>\n\n<p>Thanks</p>\n"}, {"tags": ["c++", "keil", "guideline-support-library"], "comments": [{"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1560953570, "post_id": 56669463, "comment_id": 99907034, "body": "Have a search for <code>gsl_HAVE_ARRAY</code>.  That is coming up as defined which is breaking your build."}, {"owner": {"reputation": 2568, "user_id": 8548828, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C4qkl.png?s=128&g=1", "display_name": "Tarick Welling", "link": "https://stackoverflow.com/users/8548828/tarick-welling"}, "reply_to_user": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1560955684, "post_id": 56669463, "comment_id": 99908378, "body": "I think my problem is that <code>_cplusplus</code> holds no value because keil is annoying. Even when i declared <code>gsl_CPLUSPLUS</code> as <code>199711L</code> it didn&#39;t work because the compiler couldn&#39;t <code>delete</code> a <code>gsl::owner&lt;int *&gt;</code> because it is expecting a bare pointer."}], "answers": [{"tags": [], "owner": {"reputation": 2568, "user_id": 8548828, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C4qkl.png?s=128&g=1", "display_name": "Tarick Welling", "link": "https://stackoverflow.com/users/8548828/tarick-welling"}, "is_accepted": false, "score": 0, "last_activity_date": 1560955780, "creation_date": 1560955780, "answer_id": 56670528, "question_id": 56669463, "link": "https://stackoverflow.com/questions/56669463/why-is-gsl-lite-trying-to-include-array/56670528#56670528", "title": "Why is GSL-Lite trying to include &lt;array&gt;?", "body": "<p>I think my problem is that <code>_cplusplus</code> holds no value because keil doesn't add it. Even when I declared <code>gsl_CPLUSPLUS</code> as <code>199711L</code> it didn't work because the compiler couldn't <code>delete</code> a <code>gsl::owner&lt;int *&gt;</code> because it is expecting a bare pointer.</p>\n\n<p>It seems like that the compiler just is too old to handle the gsl.</p>\n"}], "owner": {"reputation": 2568, "user_id": 8548828, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C4qkl.png?s=128&g=1", "display_name": "Tarick Welling", "link": "https://stackoverflow.com/users/8548828/tarick-welling"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 75, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1560955780, "creation_date": 1560952668, "last_edit_date": 1592644375, "question_id": 56669463, "link": "https://stackoverflow.com/questions/56669463/why-is-gsl-lite-trying-to-include-array", "title": "Why is GSL-Lite trying to include &lt;array&gt;?", "body": "<p>I'm trying to use a gsl inside my embedded STM32 Keil project. My Keil project uses an outdated semi c++11 compiler at most. (It is a constraint put on me by my ST library for LoRaWAN). I'm using the V5.06 update 6 (build 750) ARM Compiler bundled by keil. Keil has chosen not to implement the <code>std::aray</code> of the STL. I'm very disappointed about this but hey wat can I do.</p>\n<p>I've chosen to use the <a href=\"https://github.com/martinmoene/gsl-lite\" rel=\"nofollow noreferrer\">gsl-Lite</a>. It is supposed to be <code>C++98</code> and <code>C++03</code> compatible. So no <code>std::array</code> needed, but when I try to compile my code with the library included in my include path I get this build message:</p>\n<blockquote>\n<p>..\\Core\\inc\\gsl/gsl-lite.hpp(405): error:  #5: cannot open source input file &quot;array&quot;: No such file or directory<br>\n<code># include &lt;array&gt;</code></p>\n</blockquote>\n<p>But <a href=\"https://github.com/martinmoene/gsl-lite/blob/master/include/gsl/gsl-lite.hpp#L404\" rel=\"nofollow noreferrer\">line 404</a> starts with this piece of code:</p>\n<pre><code>#if gsl_HAVE( ARRAY )\n# include &lt;array&gt;\n#endif\n</code></pre>\n<p>Seems to me that they are trying to determine if <code>&lt;array&gt;</code> can be included. My editor greys this block out as if it hasn't been defined.</p>\n<p><code>gsl_HAVE</code> <a href=\"https://github.com/martinmoene/gsl-lite/blob/master/include/gsl/gsl-lite.hpp#L231\" rel=\"nofollow noreferrer\">is defined as:</a></p>\n<pre><code>#define gsl_HAVE(             feature )  ( gsl_HAVE_##feature )\n</code></pre>\n<p>I don't understand how this work and how I can check if <code>ARRAY</code> was properly not defined.</p>\n<p>I wan't to not include <code>&lt;array&gt;</code> so my code can build and use the gsl-lite. My preferred option is something with a define.</p>\n<h1>update</h1>\n<p>As far as I understand the include system:</p>\n<pre><code>#define gsl_HAVE_ARRAY                  gsl_CPP11_110\n</code></pre>\n<p>Is defined to automatically exclude a feature (<code>gsl_HAVE_ARRAY</code> in this case) when</p>\n<pre><code>#define gsl_CPP11_OR_GREATER  ( gsl_CPLUSPLUS &gt;= 201103L )\n</code></pre>\n<p>Is evaluated to be true. <code>gsl_CPLUSPLUS</code> is defined as</p>\n<pre><code>#  define gsl_CPLUSPLUS  __cplusplus\n</code></pre>\n<p>But I can't seem to figure out the value of <code>__cplusplus</code>.</p>\n"}, {"tags": ["c++", "llvm", "llvm-ir"], "comments": [{"owner": {"reputation": 615, "user_id": 6552577, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-f4beEqcNq_s/AAAAAAAAAAI/AAAAAAAAAv4/TUMNBquywhA/photo.jpg?sz=128", "display_name": "uben", "link": "https://stackoverflow.com/users/6552577/uben"}, "edited": false, "score": 0, "creation_date": 1579529962, "post_id": 56669456, "comment_id": 105787243, "body": "I think it&#39;s because you are dereferencing &#39;returnBB&#39;. These iterator functions familly expect pointers, so give them &#39;returnBB&#39; and not &#39;*returnBB&#39;"}], "owner": {"reputation": 195, "user_id": 8274517, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194b766cf9082f7a6fa715c5036379f9?s=128&d=identicon&r=PG&f=1", "display_name": "Firmin Martin", "link": "https://stackoverflow.com/users/8274517/firmin-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 278, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1560953796, "creation_date": 1560952655, "last_edit_date": 1560953796, "question_id": 56669456, "link": "https://stackoverflow.com/questions/56669456/llvm-depth-first-search-from-return-block", "title": "llvm depth first search from return block", "body": "<p>I'm writing my first llvm pass and would want to do a DFS from the return basic block of a function.</p>\n\n<p>To obtain the return basic block of a function (if there is one), I used the <code>UnifyFunctionExitNodes</code> pass which provides the <code>getReturnBlock()</code> method. Then, I found what I need in <code>llvm/ADT/DepthFirstIterator.h</code> to do a DFS on the inverse CFG from its return's block. I think this is rather a C++ problem than a <code>llvm</code> problem, but I'm completely stuck.  </p>\n\n<p>N.B. I'm quite new in C++ and <code>llvm</code> but rather familiar with C.</p>\n\n<p>There is a minimal-not-working example :</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>#include \"llvm/Pass.h\"\n#include \"llvm/IR/BasicBlock.h\"\n#include \"llvm/IR/Function.h\"\n#include \"llvm/Transforms/Utils/UnifyFunctionExitNodes.h\"\n#include \"llvm/Support/raw_ostream.h\"\n#include \"llvm/ADT/DepthFirstIterator.h\"\n\nusing namespace llvm;\n\nnamespace {\nstruct Exploration : public llvm::FunctionPass {\n\n    static char ID;\n\n    Exploration() : FunctionPass(ID) {}\n\n    void getAnalysisUsage(llvm::AnalysisUsage &amp;au) const {\n        au.setPreservesAll();\n        au.addRequiredTransitive&lt;UnifyFunctionExitNodes&gt;();\n    }\n\n    virtual bool runOnFunction(llvm::Function &amp;F) override {\n        UnifyFunctionExitNodes *UFEN = &amp;getAnalysis&lt;UnifyFunctionExitNodes&gt;();\n        BasicBlock *returnBB = UFEN-&gt;getReturnBlock();\n\n        if (returnBB != nullptr) {\n            errs() &lt;&lt; \"Return Block : \";\n            errs().write_escaped(returnBB-&gt;getName()) &lt;&lt; '\\n';\n\n        } else {\n            errs() &lt;&lt; \"There is no return block\\n\";\n        }\n\n        // first try\n        for (BasicBlock *BB : inverse_depth_first(*returnBB)) {\n            // visit *BB\n        }\n        // second try        \n        for (auto BB = idf_begin(*returnBB); BB != idf_end(*returnBB); BB++) {\n            // visit BB\n        }\n\n        return false; // didn't alter the IR\n    }\n\n};\n}\n\nchar Exploration::ID = 0;\n// Register the pass with llvm, so that we can call it\nstatic RegisterPass&lt;Exploration&gt; X(\"Exploration\", \"Exploration Pass\",\n                                   false /* Only looks at CFG */,\n                                   false /* Analysis Pass */);\n</code></pre>\n\n<p>The first loop gives me</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>llvm-pass/Exploration/Exploration.cpp:34:60: error: no matching function for call to \u2018inverse_depth_first(llvm::BasicBlock&amp;)\u2019\n         for (BasicBlock *BB : inverse_depth_first(*returnBB)) {\n                                                            ^\nIn file included from llvm-pass/Exploration/Exploration.cpp:6:0:\n/usr/local/include/llvm/ADT/DepthFirstIterator.h:276:33: note: candidate: template&lt;class T&gt; llvm::iterator_range&lt;llvm::idf_iterator&lt;T&gt; &gt; llvm::inverse_depth_first(const T&amp;)\n iterator_range&lt;idf_iterator&lt;T&gt;&gt; inverse_depth_first(const T&amp; G) {\n                                 ^~~~~~~~~~~~~~~~~~~\n</code></pre>\n\n<p>while the second yields</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>llvm-pass/Exploration/Exploration.cpp:37:43: error: no matching function for call to \u2018idf_begin(llvm::BasicBlock&amp;)\u2019\n         for (auto BB = idf_begin(*returnBB); BB != idf_end(*returnBB); BB++) {\n                                           ^\nIn file included from llvm-pass/Exploration/Exploration.cpp:6:0:\n/usr/local/include/llvm/ADT/DepthFirstIterator.h:265:17: note: candidate: template&lt;class T&gt; llvm::idf_iterator&lt;T&gt; llvm::idf_begin(const T&amp;)\n idf_iterator&lt;T&gt; idf_begin(const T&amp; G) {\n                 ^~~~~~~~~\n/usr/local/include/llvm/ADT/DepthFirstIterator.h:265:17: note:   substitution of deduced template arguments resulted in errors seen above\nllvm-pass/Exploration/Exploration.cpp:37:69: error: no matching function for call to \u2018idf_end(llvm::BasicBlock&amp;)\u2019\n         for (auto BB = idf_begin(*returnBB); BB != idf_end(*returnBB); BB++) {\n                                                                     ^\n</code></pre>\n\n<p>I don't know how to pass <code>returnBB</code> in both cases so that <code>inverse_depth_first</code>/<code>idf_begin</code>/<code>idf_end</code> don't produce typing errors.</p>\n"}, {"tags": ["c++", "cmake", "c++17", "property-based-testing"], "answers": [{"tags": [], "owner": {"reputation": 15445, "user_id": 3446, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b785d79619fc2a21e66d5b849341952a?s=128&d=identicon&r=PG", "display_name": "rcreswick", "link": "https://stackoverflow.com/users/3446/rcreswick"}, "is_accepted": false, "score": 1, "last_activity_date": 1584050848, "creation_date": 1584050848, "answer_id": 60662452, "question_id": 56668990, "link": "https://stackoverflow.com/questions/56668990/how-to-use-cmake-to-get-rapidcheck-property-based-testing-working-in-c/60662452#60662452", "title": "How to use cmake to get rapidcheck (property based testing) working in C++?", "body": "<p>This is probably not the right way to do this, but maybe it will help:</p>\n\n<p>I was able to get this working by doing the following:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code># from within the root of the rapidcheck repo:\n$ cmake -DBUILD_SHARED_LIBS=true -G \"Unix Makefiles\" -DCMAKE_BUILD_TYPE=Debug .\n# Leave off the BUILD_SHARED_LIBS flag if you don't need an SO.\n$ make\n</code></pre>\n\n<p>That built: <code>librapidcheck.so</code> and <code>librapidcheck.a</code>, which you can then copy / install as needed.</p>\n\n<p>You'll also need the <code>include</code> directory with the headers for rapidcheck, but that's just in the source tree.</p>\n\n<p>Add the include path to your compile commands using whatever build tool you want, and link with the compiled libraries (the <code>.so</code> and <code>.a</code>)</p>\n"}], "owner": {"reputation": 557, "user_id": 3180151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xeh1I.jpg?s=128&g=1", "display_name": "Sebastian", "link": "https://stackoverflow.com/users/3180151/sebastian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 195, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1584050848, "creation_date": 1560951326, "question_id": 56668990, "link": "https://stackoverflow.com/questions/56668990/how-to-use-cmake-to-get-rapidcheck-property-based-testing-working-in-c", "title": "How to use cmake to get rapidcheck (property based testing) working in C++?", "body": "<p>I'd like to do some property-based testing in a C++ library I'm working on, and was thinking of going with RapidCheck unless somebody has a better idea. (I will need, for example, to generate arbitrary <code>std::set&lt;int&gt;</code>, and if I can place bounds on the range of <code>int</code> in the sets and the size of the sets, all the better.)</p>\n\n<p>All this being said, I'm still a bit of a cmake newb. There appear to be no instructions in RapidCheck except to include it as part of the source code (although downloading it would be better). I have gotten to the point where I can include the headers for RapidCheck in my code, but when I try to build any app using RapidCheck, I'm told that there are symbols from RapidCheck missing or that the rapidcheck library is missing.</p>\n\n<p>I'm assuming that I have to build RapidCheck itself as part of the project to generate the library, but I'm not entirely sure how to do this and it seems difficult to find any examples where this is done.</p>\n\n<p>Does anyone have any suggestions of examples where such things are done so that I can see the string of commands necessary to build a 3rd party API and include the library when building the executables, or - even better - an example of a project using RapidCheck that does exactly this? The lack of documentation on how to set this up is discouraging.</p>\n\n<p>I hope this is not overly vague. To summarize, what I'd like to do from cmake:</p>\n\n<ol>\n<li>Preferably download RapidTest (although including the files directly from the RapidTest project would be fine as well).</li>\n<li>Run the required commands and set up the necessary variables to have my test code (in <code>${PROJECT_SOURCE_DIR}/test</code>) be able to access RapidTest headers.</li>\n<li>Generate (if necessary) the RapidTest library and make it so that I can link it to the tests I'm running.</li>\n</ol>\n\n<p>Thanks in advance for any help you might be able to offer!</p>\n"}, {"tags": ["c++", "multithreading", "opencv", "unity3d", "background-thread"], "answers": [{"tags": [], "owner": {"reputation": 1193, "user_id": 1309503, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1k5QJ.jpg?s=128&g=1", "display_name": "divyang4481", "link": "https://stackoverflow.com/users/1309503/divyang4481"}, "is_accepted": true, "score": 0, "last_activity_date": 1560950751, "creation_date": 1560950751, "answer_id": 56668764, "question_id": 56668600, "link": "https://stackoverflow.com/questions/56668600/using-background-threads-for-image-processing-in-c-in-unity-leads-to-a-crash/56668764#56668764", "title": "Using background threads for image processing in C++ in unity leads to a crash", "body": "<p>Use Span and Memory in .net to share data between managed or unmanaged  </p>\n\n<p>ref :</p>\n\n<p><a href=\"https://docs.microsoft.com/en-us/dotnet/standard/memory-and-spans/memory-t-usage-guidelines\" rel=\"nofollow noreferrer\">https://docs.microsoft.com/en-us/dotnet/standard/memory-and-spans/memory-t-usage-guidelines</a></p>\n\n<p><a href=\"https://medium.com/@antao.almada/p-invoking-using-span-t-a398b86f95d3\" rel=\"nofollow noreferrer\">https://medium.com/@antao.almada/p-invoking-using-span-t-a398b86f95d3</a></p>\n"}], "owner": {"reputation": 5, "user_id": 11374783, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b57ad0a1f62053fea2551a9ac4ca2d4?s=128&d=identicon&r=PG&f=1", "display_name": "SomeRandomName", "link": "https://stackoverflow.com/users/11374783/somerandomname"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 303, "favorite_count": 0, "accepted_answer_id": 56668764, "answer_count": 1, "score": 0, "last_activity_date": 1560952669, "creation_date": 1560950218, "last_edit_date": 1560952669, "question_id": 56668600, "link": "https://stackoverflow.com/questions/56668600/using-background-threads-for-image-processing-in-c-in-unity-leads-to-a-crash", "title": "Using background threads for image processing in C++ in unity leads to a crash", "body": "<p>I am trying to do some image processing in Unity and OpenCV in the background because it needs around 60ms-100ms to complete and slows down the application drastically when executed on the main thread.</p>\n\n<p>I do this inside a \"camera frame available\" callback which executes 30 times a second. I am using \"Task Parallel\" from the asset store.</p>\n\n<p><strong>C# Code</strong></p>\n\n<pre><code>private const int numMaximumThreads = 3;\nprivate volatile int currentNumberOfWorkingThreads = 0;\n\nunsafe private void OnRawVideoFrameAvailableYUV(MLCameraResultExtras resultExtras, YUVFrameInfo frameInfo, MLCameraFrameMetadata frameMetadata)\n{\n    //only have a maximum of 3 threads\n    if(currentNumberOfWorkingThreads &lt; numMaximumThreads)\n    {\n        //run on background\n        UnityTask.Run(() =&gt;\n        {\n            currentNumberOfWorkingThreads++;\n            MLCamera.GetFramePose(resultExtras.VcamTimestampUs * 1000, out translationMatrix);\n\n            float x = 0, y = 0, z = 0, rx = 0, ry = 0, rz = 0;\n            //fix the bytearray for OpenCV on c++ side\n            fixed (byte* yBuffer = frameInfo.Y.Data)//camera uses YUV instead of RGB\n            {\n                fixed (byte* uBuffer = frameInfo.U.Data)\n                {\n                    fixed (byte* vBuffer = frameInfo.V.Data)\n                    {   //call OpenCV / c++ function\n                        Interop.Detect((IntPtr)yBuffer, (IntPtr)uBuffer, (IntPtr)vBuffer, camWidth, camHeight, ref x, ref y, ref z, ref rx, ref ry, ref rz);\n                    }\n                }\n            }\n            //r to rz are translation and rotation vectors that OpenCV returns\n            return new float[6] { x, y, z, rx, ry, rz };\n        //after completion, move gameobjects on unity main thread\n        }).ContinueOnUIThread((r) =&gt;\n        {\n            if (!(r.Result[0] == 0 &amp;&amp; r.Result[3] == 0))//very probably not detected when x and rx are 0\n            {\n                Utils.UpdatePosition(r.Result[0], r.Result[1], r.Result[2]);\n                Utils.UpdateRotation(r.Result[3], r.Result[4], r.Result[5]);\n                Utils.PlaceArucoObject(markerCube, virtualCamera, translationMatrix);\n            }\n            currentNumberOfWorkingThreads--;\n        });\n    }\n}\n</code></pre>\n\n<p>My Interop function is as follows:</p>\n\n<p><strong>C# Code</strong></p>\n\n<pre><code>[DllImport(\"ml_aruco_api\")]\ninternal static extern void Detect(IntPtr yBuffer, IntPtr uBuffer, IntPtr vBuffer, int width, int height, ref float x, ref float y, ref float z, ref float rx, ref float ry, ref float rz);\n</code></pre>\n\n<p>And finally, the OpenCV <strong>C++</strong> side (shortened)</p>\n\n<pre><code>extern \"C\" void Detect(unsigned char* yBuffer, unsigned char* uBuffer, unsigned char* vBuffer, int width, int height, float&amp; x, float&amp; y, float&amp; z, float&amp; rx, float&amp; ry, float&amp; rz) {\n    //(reconstruct image and detect markers on it...)\n\n    if (detected) {\n        x = m4.Tvec.at&lt;float&gt;(0, 0);\n        y = m4.Tvec.at&lt;float&gt;(0, 1);\n        z = m4.Tvec.at&lt;float&gt;(0, 2);\n        rx = m4.Rvec.at&lt;float&gt;(0, 0);\n        ry = m4.Rvec.at&lt;float&gt;(0, 1);\n        rz = m4.Rvec.at&lt;float&gt;(0, 2);\n    }\n    else {\n        x = y = z = rx = ry = rz = 0;\n    }\n}\n</code></pre>\n\n<p>This all works for a few seconds, then crashes. And it doesn't run at 60fps but fluctuates strongly around 15-30fps.\nI don't know much about memory handling between C# and C++ so that's probably the problem here. I also don't understand why the application runs so slowly when it's supposedly run on a background thread. I also tried Unity's job system to no avail, it was working without crashing but slowly as well.</p>\n\n<p>Could someone point me to the right direction?</p>\n\n<p>Edit: I limited the number of maximum threads to 1 and it stopped the crashing. The FPS are now around 30-40 and I wonder why it's not on 60 fps. Commenting out the Interop.Detect() function gives me 60. Do I have to thread the OpenCV function itself?</p>\n"}, {"tags": ["c++", "opengl", "glfw", "assimp"], "comments": [{"owner": {"reputation": 15619, "user_id": 1548468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0745dce203d52699e63a575b3103ad70?s=128&d=identicon&r=PG", "display_name": "Botje", "link": "https://stackoverflow.com/users/1548468/botje"}, "edited": false, "score": 1, "creation_date": 1560954665, "post_id": 56668490, "comment_id": 99907717, "body": "I would not rely on <code>vertices.data()</code> being NULL for an empty array. Better to check <code>.size()</code>"}, {"owner": {"reputation": 15619, "user_id": 1548468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0745dce203d52699e63a575b3103ad70?s=128&d=identicon&r=PG", "display_name": "Botje", "link": "https://stackoverflow.com/users/1548468/botje"}, "edited": false, "score": 1, "creation_date": 1560955090, "post_id": 56668490, "comment_id": 99907969, "body": "To rule out as many other factors as possible, start by hacking your fragment shader to assign a flat color instead of reading from the texture. <code>color = vec4( 1.0f, 0.0f, 0.0f, 1.0f);</code> If that produces a red shape on the screen, I think your issue may be in your fragment shader linkage: <code>modelLoading.frag</code> needs <code>texture_diffuse</code> while Mesh.h line 87 assigns <code>texture_diffuse1</code> (see the &quot; + number&quot; there.)"}, {"owner": {"reputation": 1094, "user_id": 5476399, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/A0F2n.jpg?s=128&g=1", "display_name": "blkpingu", "link": "https://stackoverflow.com/users/5476399/blkpingu"}, "reply_to_user": {"reputation": 15619, "user_id": 1548468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0745dce203d52699e63a575b3103ad70?s=128&d=identicon&r=PG", "display_name": "Botje", "link": "https://stackoverflow.com/users/1548468/botje"}, "edited": false, "score": 0, "creation_date": 1560957239, "post_id": 56668490, "comment_id": 99909368, "body": "@Botje added an edit to the equestion. i applied both suggestions, but so far nothing is showing in the window. I also threw the &quot;nanosuit.obj&quot; from the tutorial back in, wich consists of multiple parts. you can see it in the repos res/models . still nothing."}], "answers": [{"comments": [{"owner": {"reputation": 47449, "user_id": 44729, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/tyWaU.png?s=128&g=1", "display_name": "genpfault", "link": "https://stackoverflow.com/users/44729/genpfault"}, "edited": false, "score": 1, "creation_date": 1561050508, "post_id": 56690781, "comment_id": 99947129, "body": "Nah, GLM <i>used to</i> default-init vectors and matrices.  <a href=\"https://github.com/g-truc/glm/releases/tag/0.9.9.0\" rel=\"nofollow noreferrer\">They stopped in min-2018 with 0.9.9.0</a>: &quot;Removed default initialization, use <code>GLM_FORCE_CTOR_INIT</code> to restore the old behavior&quot;"}, {"owner": {"reputation": 1094, "user_id": 5476399, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/A0F2n.jpg?s=128&g=1", "display_name": "blkpingu", "link": "https://stackoverflow.com/users/5476399/blkpingu"}, "reply_to_user": {"reputation": 47449, "user_id": 44729, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/tyWaU.png?s=128&g=1", "display_name": "genpfault", "link": "https://stackoverflow.com/users/44729/genpfault"}, "edited": false, "score": 0, "creation_date": 1561052942, "post_id": 56690781, "comment_id": 99948164, "body": "@genpfault I see a model now. I don&#39;t see a model without this. What would I have to change in order to have it auto load? Higher GLM version? Current version is 0.9.9.3 ( as per header search path <code>&#47;usr&#47;local&#47;Cellar&#47;glm&#47;0.9.9.3&#47;include&#47;</code>)."}, {"owner": {"reputation": 47449, "user_id": 44729, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/tyWaU.png?s=128&g=1", "display_name": "genpfault", "link": "https://stackoverflow.com/users/44729/genpfault"}, "edited": false, "score": 1, "creation_date": 1561053767, "post_id": 56690781, "comment_id": 99948551, "body": "I was referring to the &quot;The tutorial was just garbage for not doing it.&quot; statement: when the tutorial was written/last updated GLM would default-init things.  If you built the tutorial against a pre-2018 GLM I suspect it would still work."}, {"owner": {"reputation": 1094, "user_id": 5476399, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/A0F2n.jpg?s=128&g=1", "display_name": "blkpingu", "link": "https://stackoverflow.com/users/5476399/blkpingu"}, "reply_to_user": {"reputation": 47449, "user_id": 44729, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/tyWaU.png?s=128&g=1", "display_name": "genpfault", "link": "https://stackoverflow.com/users/44729/genpfault"}, "edited": false, "score": 1, "creation_date": 1561053985, "post_id": 56690781, "comment_id": 99948647, "body": "Ooooooh i&#39;m so sorry, yes, you are absolutely right. They went back to explicit initialising. Edited my answer. Thanks for the history lesson!"}], "tags": [], "owner": {"reputation": 1094, "user_id": 5476399, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/A0F2n.jpg?s=128&g=1", "display_name": "blkpingu", "link": "https://stackoverflow.com/users/5476399/blkpingu"}, "is_accepted": true, "score": 2, "last_activity_date": 1562967777, "last_edit_date": 1562967777, "creation_date": 1561050210, "answer_id": 56690781, "question_id": 56668490, "link": "https://stackoverflow.com/questions/56668490/assimp-loads-vertices-but-model-is-not-getting-displayed/56690781#56690781", "title": "Assimp loads vertices, but model is not getting displayed", "body": "<p>Got it. Model was never initialised. The tutorial was pre 2018, which is when GLM went away from auto initialising.</p>\n\n<p>In the snippet I posted was the error.</p>\n\n<p>It's supposed to be:</p>\n\n<pre><code>// Draw the loaded model\nglm::mat4 model = glm::mat4(1.0f); \n</code></pre>\n\n<p>Instead of: </p>\n\n<pre><code>// Draw the loaded model\nglm::mat4 model;\n</code></pre>\n\n<h3>What happend?</h3>\n\n<p>My GLM version is <code>0.9.9.3</code>, while the tutorials is most certainly pre <a href=\"https://github.com/g-truc/glm/releases/tag/0.9.9.0\" rel=\"nofollow noreferrer\"><code>0.9.9.0</code></a>, the version they changed it.</p>\n\n<p>Noted, a lot of tutorials use this code.</p>\n\n<p>The one <a href=\"https://www.youtube.com/watch?v=yQx_pMsYqzU\" rel=\"nofollow noreferrer\">I worked with</a> didn't <a href=\"https://github.com/SonarSystems/Modern-OpenGL-Tutorials/blob/228ac36f91c14f9c42d5cfb56ff559c712f3ac50/%5BMODEL%20LOADING%5D/%5B16%5D%20Model%20Class/main.cpp#L124\" rel=\"nofollow noreferrer\">change it either</a>.</p>\n\n<blockquote>\n  <p><strong>You can check your GLM version</strong> in xcode by clicking on the project in\n  your file browser, selecting the App in the Tartget list and then </p>\n  \n  <p>Build Settings > Search Paths > Header Search Paths </p>\n  \n  <p>Double click to open the list.</p>\n</blockquote>\n"}], "owner": {"reputation": 1094, "user_id": 5476399, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/A0F2n.jpg?s=128&g=1", "display_name": "blkpingu", "link": "https://stackoverflow.com/users/5476399/blkpingu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 254, "favorite_count": 0, "accepted_answer_id": 56690781, "answer_count": 1, "score": 0, "last_activity_date": 1562967777, "creation_date": 1560949880, "last_edit_date": 1561090554, "question_id": 56668490, "link": "https://stackoverflow.com/questions/56668490/assimp-loads-vertices-but-model-is-not-getting-displayed", "title": "Assimp loads vertices, but model is not getting displayed", "body": "<p><strong>IDE:</strong> xcode</p>\n\n<p><strong>System:</strong> MacOS</p>\n\n<h3>What I'm trying to do</h3>\n\n<p>My <a href=\"https://github.com/BlkPingu/GLFW_SolarSystem/tree/005/model_loading/CG\" rel=\"nofollow noreferrer\">project [repo]</a> is at the point where I successfully made a <a href=\"https://github.com/SonarSystems/Modern-OpenGL-Tutorials/tree/master/%5BADVANCED%20OPENGL%5D/%5B17%5D%20Cubemap:Skybox\" rel=\"nofollow noreferrer\">skybox [tutorial link]</a> work, but I'm struggling with <a href=\"https://github.com/SonarSystems/Modern-OpenGL-Tutorials/tree/master/%5BMODEL%20LOADING%5D/%5B16%5D%20Model%20Class\" rel=\"nofollow noreferrer\">assimp's model loading [tutorial link]</a>.</p>\n\n<h3>The problem</h3>\n\n<p>I don't recieve any errors. The model is just not loading into the window, even though I added <a href=\"https://github.com/BlkPingu/GLFW_SolarSystem/blob/b068906210fb44b129559d557bab0848152c44ec/CG/src/Model.h#L165\" rel=\"nofollow noreferrer\"><code>cout &lt;&lt; vertices.data() &lt;&lt; endl;</code> [github line link]</a> at the respective line in the <a href=\"https://github.com/BlkPingu/GLFW_SolarSystem/blob/b068906210fb44b129559d557bab0848152c44ec/CG/src/Model.h#L1\" rel=\"nofollow noreferrer\"><code>model.h</code> [github line link]</a>, after it get's initialised in <a href=\"http://%20%20%20%20Model%20ourModel(%20%22res/models/earth_2.5k_combined_png_optimised_export.obj%22%20);\" rel=\"nofollow noreferrer\"><code>main.cpp</code> [github line link]</a>  which is printing <code>0x106e6b000</code>, so the models vertices are loading.</p>\n\n<p>However, the window remains empty, apart from the background color.\n<a href=\"https://youtu.be/yQx_pMsYqzU?t=3247\" rel=\"nofollow noreferrer\">In the tutorial [youtube video link with timestamp]</a>, which i followed faithfully, it's working.</p>\n\n<h3>What I'm trying to accieve:</h3>\n\n<p>I'm trying to render the model <code>nanosuit.obj</code>, which is proven to be red in. <code>ourModel.Draw( shader );</code>should draw it, but doesn't or it's not being displayed.\nFor some reason it's not being displayed, despite no errors that data cant be found or exceptions triggered.</p>\n\n<p>I would love to give a MCVE, but the code it very much interconnected, hence the github links. </p>\n\n<p>As far as I can say this should draw the model, unless it complains.</p>\n\n<pre><code>// Draw the loaded model\n        glm::mat4 model;\n        model = glm::translate( model, glm::vec3( 0.0f, -1.75f, 0.0f ) ); // Translate it down a bit so it's at the center of the scene\n        model = glm::scale( model, glm::vec3( 0.2f, 0.2f, 0.2f ) ); // It's a bit too big for our scene, so scale it down\n        glUniformMatrix4fv( glGetUniformLocation( shader.Program, \"model\" ), 1, GL_FALSE, glm::value_ptr( model ) );\n        ourModel.Draw( shader );\n</code></pre>\n\n<p>Stuff I tried: </p>\n\n<ul>\n<li>Rotating the camera to check if the model rendered outside of my FOV</li>\n<li>playing around with scaling</li>\n<li>loading other <code>.obj</code>s</li>\n<li>printing variables that are being passed around, only to see that indeed the model is being loaded, just not displayed</li>\n</ul>\n\n<p><a href=\"https://i.stack.imgur.com/62kek.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/62kek.png\" alt=\"enter image description here\"></a></p>\n\n<p>I'm trying not to code dump, hence the line links. Feel free to tell me if you want code snippets. I'm kind of lost here as for why this is happening.</p>\n\n<h3>Edit:</h3>\n\n<p>@Botje suggested I try these things:</p>\n\n<ol>\n<li><a href=\"https://github.com/BlkPingu/GLFW_SolarSystem/blob/005/model_loading/CG/src/res/shaders/modelLoading.frag\" rel=\"nofollow noreferrer\"><code>modelLoading.frag</code> [repo, line link]</a> to apply red color instead of the textures to try to minimise the risk of something being wrong with the models textures. Was ineffective. Still no model. </li>\n</ol>\n\n<pre><code>     void main( )\n        {\n            //color = vec4( texture( texture_diffuse, TexCoords ));\n            color = vec4( 1.0f, 0.0f, 0.0f, 1.0f);\n        }\n</code></pre>\n\n<ol start=\"2\">\n<li><p>In <code>model.h</code>, edited <a href=\"https://github.com/BlkPingu/GLFW_SolarSystem/blob/1ba7dcba6adad10f5a319cfa5ec3d996256339ec/CG/src/Model.h#L165\" rel=\"nofollow noreferrer\"><code>cout &lt;&lt; vertices.size() &lt;&lt; endl;</code> [repo, line link]</a> prints, which is correct for the <code>nanosuit.obj</code> model from the tutorial. I had a planet in there, wich was not part of the tutorial, therefore the <code>0x106e6b000</code> from previously. I now get for <code>vertices.size()</code>:</p>\n\n<blockquote>\n  <p>156 15222 19350 78 6804 7248 8316</p>\n</blockquote>\n\n<p>So the model is definitely loading, just not rendering. The problem must me somewhere after the model loading but before the rendering.</p></li>\n</ol>\n"}, {"tags": ["c++", "vulkan"], "answers": [{"comments": [{"owner": {"reputation": 175, "user_id": 2079157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f38c64fba3d9948332ac64e5a14a0eab?s=128&d=identicon&r=PG", "display_name": "Vladimir Nazarenko", "link": "https://stackoverflow.com/users/2079157/vladimir-nazarenko"}, "edited": false, "score": 0, "creation_date": 1561125123, "post_id": 56669015, "comment_id": 99972880, "body": "Could you please give some links/elaborate on not submitting to a queue multiple times? From my experience, submitting takes only around 0.05ms of CPU time. Perhaps, it starves a GPU?"}, {"owner": {"reputation": 374849, "user_id": 734069, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a356923f858fbe363dad1dc566837fc6?s=128&d=identicon&r=PG", "display_name": "Nicol Bolas", "link": "https://stackoverflow.com/users/734069/nicol-bolas"}, "reply_to_user": {"reputation": 175, "user_id": 2079157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f38c64fba3d9948332ac64e5a14a0eab?s=128&d=identicon&r=PG", "display_name": "Vladimir Nazarenko", "link": "https://stackoverflow.com/users/2079157/vladimir-nazarenko"}, "edited": false, "score": 3, "creation_date": 1561125315, "post_id": 56669015, "comment_id": 99972999, "body": "@VladimirNazarenko: The Vulkan specification itself says, &quot;Submission can be a high overhead operation, and applications should attempt to batch work together into as few calls to <code>vkQueueSubmit</code> as possible.&quot;"}], "tags": [], "owner": {"reputation": 374849, "user_id": 734069, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a356923f858fbe363dad1dc566837fc6?s=128&d=identicon&r=PG", "display_name": "Nicol Bolas", "link": "https://stackoverflow.com/users/734069/nicol-bolas"}, "is_accepted": true, "score": 6, "last_activity_date": 1560951391, "creation_date": 1560951391, "answer_id": 56669015, "question_id": 56668424, "link": "https://stackoverflow.com/questions/56668424/is-it-possible-to-wait-for-a-transfer-from-the-staging-buffer-to-complete-withou/56669015#56669015", "title": "Is it possible to wait for a transfer from the staging buffer to complete without calling vkQueueWaitIdle", "body": "<p>You wait for the fence for the previous upload <em>after</em> you have already written the data to the staging buffer. That's too late; the fence is there to prevent you from writing data to memory that's being read.</p>\n\n<p>But really, your problem is that your design is wrong. Your design is such that sequential updates all use the same memory. They shouldn't. Instead, sequential updates should use different regions of the same memory, so that they <em>cannot</em> overlap. That way, you can perform the transfers and not have to wait on fences at all (or at least, not until next frame).</p>\n\n<p>Basically, you should treat your staging buffer like a ring buffer. Every operation that wants to do some staged transfer work should \"allocate\" X bytes of memory from the staging ring buffer. The staging buffer system allocates memory sequentially, wrapping around if there is insufficient space. But it also remembers where the last memory region is that it synchronized with. If you try to stage too much work, then it has to synchronize.</p>\n\n<p>Also, one of the purposes behind mapping memory is that you can write directly to that memory, rather than writing to some other CPU memory and copying it in. So instead of passing in a <code>VULKAN_BUFFER</code> (whatever that is), the process that generated that data should have fetched a pointer to a region of the active staging buffer and written its data into that.</p>\n\n<p>Oh, and one more thing: never, <strong><em>ever</em></strong> create a command buffer and immediately submit it. Just don't do it. There's a reason why <code>vkQueueSubmit</code> can take multiple command buffers, and multiple <em>batches</em> of command buffers. For any one queue, you should never be submitting more than once (or maybe twice) per frame.</p>\n"}], "owner": {"reputation": 55, "user_id": 5927456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f5cce22981f9e3fa7f80aac6693c7b2?s=128&d=identicon&r=PG&f=1", "display_name": "Kazuya", "link": "https://stackoverflow.com/users/5927456/kazuya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 308, "favorite_count": 2, "accepted_answer_id": 56669015, "answer_count": 1, "score": 5, "last_activity_date": 1560951391, "creation_date": 1560949701, "question_id": 56668424, "link": "https://stackoverflow.com/questions/56668424/is-it-possible-to-wait-for-a-transfer-from-the-staging-buffer-to-complete-withou", "title": "Is it possible to wait for a transfer from the staging buffer to complete without calling vkQueueWaitIdle", "body": "<p>The following piece of code show you how i transfer a vertex buffer data from the staging buffer to a local memory buffer :</p>\n\n<pre><code>bool Vulkan::UpdateVertexBuffer(std::vector&lt;VERTEX&gt;&amp; data, VULKAN_BUFFER&amp; vertex_buffer)\n{\n    std::memcpy(this-&gt;staging_buffer.pointer, &amp;data[0], vertex_buffer.size);\n\n    size_t flush_size = static_cast&lt;size_t&gt;(vertex_buffer.size);\n    unsigned int multiple = static_cast&lt;unsigned int&gt;(flush_size / this-&gt;physical_device.properties.limits.nonCoherentAtomSize);\n    flush_size = this-&gt;physical_device.properties.limits.nonCoherentAtomSize * ((uint64_t)multiple + 1);\n\n    VkMappedMemoryRange flush_range = {};\n    flush_range.sType = VK_STRUCTURE_TYPE_MAPPED_MEMORY_RANGE;\n    flush_range.pNext = nullptr;\n    flush_range.memory = this-&gt;staging_buffer.memory;\n    flush_range.offset = 0;\n    flush_range.size = flush_size;\n    vkFlushMappedMemoryRanges(this-&gt;device, 1, &amp;flush_range);\n\n    VkResult result = vkWaitForFences(this-&gt;device, 1, &amp;this-&gt;transfer.fence, VK_FALSE, 1000000000);\n    if(result != VK_SUCCESS) {\n        #if defined(_DEBUG)\n        std::cout &lt;&lt; \"UpdateVertexBuffer =&gt; vkWaitForFences : Timeout\" &lt;&lt; std::endl;\n        #endif\n        return false;\n    }\n    vkResetFences(this-&gt;device, 1, &amp;this-&gt;transfer.fence);\n\n    VkCommandBufferBeginInfo command_buffer_begin_info = {};\n    command_buffer_begin_info.sType = VK_STRUCTURE_TYPE_COMMAND_BUFFER_BEGIN_INFO;\n    command_buffer_begin_info.pNext = nullptr; \n    command_buffer_begin_info.flags = VK_COMMAND_BUFFER_USAGE_ONE_TIME_SUBMIT_BIT;\n    command_buffer_begin_info.pInheritanceInfo = nullptr;\n\n    vkBeginCommandBuffer(this-&gt;transfer.command_buffer, &amp;command_buffer_begin_info);\n\n    VkBufferCopy buffer_copy_info = {};\n    buffer_copy_info.srcOffset = 0;\n    buffer_copy_info.dstOffset = 0;\n    buffer_copy_info.size = vertex_buffer.size;\n\n    vkCmdCopyBuffer(this-&gt;transfer.command_buffer, this-&gt;staging_buffer.handle, vertex_buffer.handle, 1, &amp;buffer_copy_info);\n\n    VkBufferMemoryBarrier buffer_memory_barrier = {};\n    buffer_memory_barrier.sType = VK_STRUCTURE_TYPE_BUFFER_MEMORY_BARRIER;\n    buffer_memory_barrier.pNext = nullptr;\n    buffer_memory_barrier.srcAccessMask = VK_ACCESS_MEMORY_WRITE_BIT;\n    buffer_memory_barrier.dstAccessMask = VK_ACCESS_VERTEX_ATTRIBUTE_READ_BIT;\n    buffer_memory_barrier.srcQueueFamilyIndex = this-&gt;queue_stack[this-&gt;transfer_stack_index].index;\n    buffer_memory_barrier.dstQueueFamilyIndex = this-&gt;queue_stack[this-&gt;graphics_stack_index].index;\n    buffer_memory_barrier.buffer = vertex_buffer.handle;\n    buffer_memory_barrier.offset = 0;\n    buffer_memory_barrier.size = VK_WHOLE_SIZE;\n\n    vkCmdPipelineBarrier(this-&gt;transfer.command_buffer, VK_PIPELINE_STAGE_TRANSFER_BIT, VK_PIPELINE_STAGE_VERTEX_INPUT_BIT, 0, 0, nullptr, 1, &amp;buffer_memory_barrier, 0, nullptr);\n\n    vkEndCommandBuffer(this-&gt;transfer.command_buffer);\n\n    VkSubmitInfo submit_info = {};\n    submit_info.sType = VK_STRUCTURE_TYPE_SUBMIT_INFO;\n    submit_info.pNext = nullptr;\n    submit_info.waitSemaphoreCount = 0;\n    submit_info.pWaitSemaphores = nullptr;\n    submit_info.pWaitDstStageMask = nullptr;\n    submit_info.commandBufferCount = 1;\n    submit_info.pCommandBuffers = &amp;this-&gt;transfer.command_buffer;\n    submit_info.signalSemaphoreCount = 0;\n    submit_info.pSignalSemaphores = nullptr;\n\n    VkResult result = vkQueueSubmit(this-&gt;queue_stack[this-&gt;transfer_stack_index].handle, 1, &amp;submit_info, this-&gt;transfer.fence);\n    if(result != VK_SUCCESS) {\n        #if defined(_DEBUG)\n        std::cout &lt;&lt; \"UpdateVertexBuffer =&gt; vkQueueSubmit : Failed\" &lt;&lt; std::endl;\n        #endif\n        return false;\n    }\n\n    #if defined(_DEBUG)\n    std::cout &lt;&lt; \"UpdateVertexBuffer : Success\" &lt;&lt; std::endl;\n    #endif\n    return true;\n}\n</code></pre>\n\n<p>It works perfectly without any validation layer warning. But when i call i twice, both buffers contains the same data, from the second call. For example :</p>\n\n<pre><code>UpdateVertexBuffer(cube_data, cube_buffer);\nUpdateVertexBuffer(prism_data, prism_buffer);\n</code></pre>\n\n<p>This will result in having a prism inside both cube_buffer and prism_buffer. To fix this, i can simply wait for a few milliseconds between the two calls :</p>\n\n<pre><code>UpdateVertexBuffer(cube_data, cube_buffer);\nstd::this_thread::sleep_for(std::chrono::milliseconds(100));\nUpdateVertexBuffer(prism_data, prism_buffer);\n</code></pre>\n\n<p>or preferably, i can replace the fence by a call to \n<code>vkQueueWaitIdle(this-&gt;queue_stack[this-&gt;transfer_stack_index].handle);</code></p>\n\n<p>In my opinion this will result in performance loss and the fence is supposed to be the optimal way to wait for transfer operation to complete properly, so why is my first buffer filled by second when i'm using a fence. And is there a way to do this properly without using <code>vkQueueWaitIdle</code>.</p>\n\n<p>Thanks for your help.</p>\n"}, {"tags": ["c++", "cmake", "conan"], "answers": [{"tags": [], "owner": {"reputation": 1993, "user_id": 2036859, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/N1Esm.jpg?s=128&g=1", "display_name": "uilianries", "link": "https://stackoverflow.com/users/2036859/uilianries"}, "is_accepted": true, "score": 1, "last_activity_date": 1560950875, "creation_date": 1560950875, "answer_id": 56668815, "question_id": 56668289, "link": "https://stackoverflow.com/questions/56668289/error-installing-header-only-package-via-conan/56668815#56668815", "title": "Error installing header only package via conan", "body": "<p>When uploading Conan packages you need to be explicit when you want to upload binary packages too.</p>\n\n<p>The command <code>conan upload kvapi* -r genetec</code> only upload the recipe, not the package created. To upload both recipe package and binary package, which contains those headers, you need to add the argument <code>--all</code></p>\n\n<p><code>conan upload kvapi* -r genetec --all</code></p>\n\n<p>reference: <a href=\"https://docs.conan.io/en/latest/uploading_packages/uploading_to_remotes.html\" rel=\"nofollow noreferrer\">https://docs.conan.io/en/latest/uploading_packages/uploading_to_remotes.html</a></p>\n"}], "owner": {"reputation": 11354, "user_id": 70600, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/6123be50f7a10302e7bf59dcdc5e2623?s=128&d=identicon&r=PG", "display_name": "ruipacheco", "link": "https://stackoverflow.com/users/70600/ruipacheco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 486, "favorite_count": 0, "accepted_answer_id": 56668815, "answer_count": 1, "score": 0, "last_activity_date": 1560950875, "creation_date": 1560949283, "question_id": 56668289, "link": "https://stackoverflow.com/questions/56668289/error-installing-header-only-package-via-conan", "title": "Error installing header only package via conan", "body": "<p>I have an internal header-only C++ library built with CMake. I followed conan's <a href=\"https://docs.conan.io/en/latest/howtos/header_only.html\" rel=\"nofollow noreferrer\">instructions</a> on how to package header-only libraries and ended up with this conanfile.py:</p>\n\n<pre><code>#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n\n\"\"\"\nConan file for KVAPI.\n\nhttps://docs.conan.io/en/latest/howtos/header_only.html\n\"\"\"\n\nfrom conans import ConanFile, CMake\n\n\nclass KVAPIConan(ConanFile):\n    name = \"kvapi\"\n    version = \"0.1.0.0\"\n    description = \"Kiwi API library\"\n    exports_sources = \"include/*\"\n    topics = (\"kv\", \"kvapi\", \"C++\")\n    no_copy_source = True\n\n    def package(self):\n        self.copy(\"*.hpp\")\n\n    def package_id(self):\n        self.info.header_only()\n</code></pre>\n\n<p>I create the package thus:</p>\n\n<pre><code>&gt; conan create . kvapi/0.1.0.0@kiwi/testing\n&gt; conan upload kvapi* -r genetec\n</code></pre>\n\n<p>and install it thusly:</p>\n\n<pre><code>&gt; conan install kvapi/0.1.0.0@kiwi/testing\n</code></pre>\n\n<p>which results in the error:</p>\n\n<pre><code>Configuration:\n[settings]\narch=x86_64\narch_build=x86_64\nbuild_type=Release\ncompiler=Visual Studio\ncompiler.runtime=MD\ncompiler.version=15\nos=Windows\nos_build=Windows\n[options]\n[build_requires]\n[env]\n\nkvapi/0.1.0.0@kiwi/testing: Retrieving from server 'genetec'\nkvapi/0.1.0.0@kiwi/testing: Trying with 'genetec'...\nDownloading conanmanifest.txt\n[==================================================] 848B/638B\nDownloading conanfile.py\n[==================================================] 513B/456B\nkvapi/0.1.0.0@kiwi/testing: Downloaded recipe revision 0\nInstalling package: kvapi/0.1.0.0@kiwi/testing\nRequirements\n    kvapi/0.1.0.0@kiwi/testing from 'genetec' - Downloaded\nPackages\n    kvapi/0.1.0.0@kiwi/testing:5ab84d6acfe1f23c4fae0ab88f26e3a396351ac9 - Missing\n\nkvapi/0.1.0.0@kiwi/testing: WARN: Can't find a 'kvapi/0.1.0.0@kiwi/testing' package for the specified settings, options and dependencies:\n- Settings:\n- Options:\n- Dependencies:\n- Package ID: 5ab84d6acfe1f23c4fae0ab88f26e3a396351ac9\n\nERROR: Missing prebuilt package for 'kvapi/0.1.0.0@kiwi/testing'\nTry to build it from sources with \"--build kvapi\"\nOr read \"http://docs.conan.io/en/latest/faq/troubleshooting.html#error-missing-prebuilt-package\"\n</code></pre>\n\n<p>Is this expected for a header-only library?</p>\n"}, {"tags": ["c++", "x86-64", "compiler-optimization", "calling-convention", "abi"], "comments": [{"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 4, "creation_date": 1561011978, "post_id": 56668186, "comment_id": 99926268, "body": "On Godbolt you can mouseover a number to see it in Hex.  If you look at asm often, you&#39;re going to get used to <code>4294967...</code> being about 2^32 and thus a huge clue that you should look at the hex to see the upper/lower 32 bits.  (Or for numbers just <i>below</i> 2^32, that it&#39;s actually a negative 32-bit integer.)"}], "answers": [{"comments": [{"owner": {"reputation": 26945, "user_id": 771073, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/412bf39694cbe9d1fc0374deda225b18?s=128&d=identicon&r=PG", "display_name": "Martin Bonner supports Monica", "link": "https://stackoverflow.com/users/771073/martin-bonner-supports-monica"}, "edited": false, "score": 0, "creation_date": 1561008780, "post_id": 56668369, "comment_id": 99925166, "body": "D&#39;oh!  Thanks sasha for proposing the edit, and caf for doing it."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 3, "creation_date": 1561012396, "post_id": 56668369, "comment_id": 99926428, "body": "Fun fact: with BMI2 a probably more optimal way to compile this would be <code>mov edx, 2</code> and then <a href=\"https://www.felixcloutier.com/x86/RORX.html\" rel=\"nofollow noreferrer\"><code>rorx rax, rdx, 33</code></a>  to create <code>1&lt;&lt;32</code> from the <code>1&lt;&lt;1</code>.  <code>movabs</code> is so big (10 bytes) that it&#39;s slow to decode and can take extra space in the uop cache.  <code>rorx</code> is 6 bytes (3-byte VEX + opcode + modrm + imm8) but its immediate is small.  It does have a dependency on the <code>mov</code>-immediate and can only run on the shift ports on Intel CPUs, but normally that&#39;s not a bottleneck (especially in a code path that leads to a <code>ret</code>, not contained in a tight loop)"}, {"owner": {"reputation": 26945, "user_id": 771073, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/412bf39694cbe9d1fc0374deda225b18?s=128&d=identicon&r=PG", "display_name": "Martin Bonner supports Monica", "link": "https://stackoverflow.com/users/771073/martin-bonner-supports-monica"}, "reply_to_user": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1561026260, "post_id": 56668369, "comment_id": 99933524, "body": "@PeterCordes I think the optimizer can be forgiven for not spotting this particular possibility - it&#39;s <i>very</i> specific to the particular data pattern!"}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1561066036, "post_id": 56668369, "comment_id": 99953379, "body": "clang does look for things like <code>lea r64, [reg + disp8]</code> to create a 2nd large constant instead of 2x <code>movabs</code>.  e.g. see <a href=\"//stackoverflow.com/a/56531252\">Signed saturated add of 64-bit ints?</a> where clang uses <code>movabs  rcx, 9223372036854775807</code> ; <code>lea  rax, [rcx + 1]</code> to materialize <code>INT64_MAX</code> and <code>INT64_MIN</code> in RCX and RAX respectively, in versions of the function that need both.  <a href=\"https://godbolt.org/z/iD6Ml8\" rel=\"nofollow noreferrer\">godbolt.org/z/iD6Ml8</a>  GCC just uses 2x <code>movabs</code> even with <code>-Os</code>"}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1561066352, "post_id": 56668369, "comment_id": 99953484, "body": "GCC and clang both look for optimizations like that in some cases: <a href=\"https://godbolt.org/z/wctons\" rel=\"nofollow noreferrer\">godbolt.org/z/wctons</a> like using a <code>sub  rax, 120</code> to create a 2nd nearby constant instead of using another <code>movabs</code>.  They&#39;re not very good at it, though, and yeah probably aren&#39;t looking for the possibility of rotating :P"}], "tags": [], "owner": {"reputation": 26945, "user_id": 771073, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/412bf39694cbe9d1fc0374deda225b18?s=128&d=identicon&r=PG", "display_name": "Martin Bonner supports Monica", "link": "https://stackoverflow.com/users/771073/martin-bonner-supports-monica"}, "is_accepted": true, "score": 40, "last_activity_date": 1561008760, "last_edit_date": 1561008760, "creation_date": 1560949538, "answer_id": 56668369, "question_id": 56668186, "link": "https://stackoverflow.com/questions/56668186/array-initialization-optimization/56668369#56668369", "title": "Array initialization optimization", "body": "<p>A <code>std::array&lt;int, 3&gt;</code> is 96 bits wide on your implementation.  As such the ABI declares that it should be returned in RAX + the low 32 bits of RDX (aka EDX).</p>\n\n<p>4294967296 is 2<sup>32</sup>, in hex it is <code>$1'0000'0000</code>.  So the <code>movabs</code> stores 0 in the low order 32 bits of RAX, and 1 in the high order bits of RAX.  The <code>mov</code> stores 2 in EDX (which is exactly what you wanted).</p>\n"}], "owner": {"reputation": 96896, "user_id": 2296458, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/wbG2s.png?s=128&g=1", "display_name": "Cory Kramer", "link": "https://stackoverflow.com/users/2296458/cory-kramer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1219, "favorite_count": 2, "accepted_answer_id": 56668369, "answer_count": 1, "score": 33, "last_activity_date": 1561011952, "creation_date": 1560948963, "last_edit_date": 1561011952, "question_id": 56668186, "link": "https://stackoverflow.com/questions/56668186/array-initialization-optimization", "title": "Array initialization optimization", "body": "<p>When compiling the following code snippet (clang x86-64 <code>-O3</code>)</p>\n\n<pre><code>std::array&lt;int, 5&gt; test()\n{\n    std::array&lt;int, 5&gt; values {{0, 1, 2, 3, 4}};\n    return values;\n}\n</code></pre>\n\n<p><a href=\"https://godbolt.org/z/iKXTAK\" rel=\"noreferrer\">It produced</a> the typical assembly that I would expect</p>\n\n<pre><code>test():                               # @test()\n        mov     rax, rdi\n        mov     ecx, dword ptr [rip + .L__const.test().values+16]\n        mov     dword ptr [rdi + 16], ecx\n        movups  xmm0, xmmword ptr [rip + .L__const.test().values]\n        movups  xmmword ptr [rdi], xmm0\n        ret\n.L__const.test().values:\n        .long   0                       # 0x0\n        .long   1                       # 0x1\n        .long   2                       # 0x2\n        .long   3                       # 0x3\n        .long   4                       # 0x4\n</code></pre>\n\n<p>However for small arrays, it seems to have figured out a trick?</p>\n\n<pre><code>std::array&lt;int, 3&gt; test()\n{\n    std::array&lt;int, 3&gt; values {{0, 1, 2}};\n    return values;\n}\n</code></pre>\n\n<p><a href=\"https://godbolt.org/z/080Sp4\" rel=\"noreferrer\">This</a> was the corresponding assembly</p>\n\n<pre><code>test():                               # @test()\n        movabs  rax, 4294967296\n        mov     edx, 2\n        ret\n</code></pre>\n\n<p>Where did that magic number (<code>4294967296</code>) come from? Is that essentially a value that can be <code>reinterpret_cast</code> back into an array of <code>int</code> somehow?</p>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 1727, "user_id": 5440453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3500f6dc5327b259bb48da3399268b0?s=128&d=identicon&r=PG&f=1", "display_name": "Algirdas Preid\u017eius", "link": "https://stackoverflow.com/users/5440453/algirdas-preid%c5%beius"}, "edited": false, "score": 2, "creation_date": 1560948959, "post_id": 56668161, "comment_id": 99904090, "body": "&quot;<i>So I got questions: Is calling order of paramters an undefined behavior?</i>&quot; No, not really. The order of evaluation, of function arguments, is <b>unspecified</b>. Edit: I don&#39;t really, agree with the current duplicate, since such code doesn&#39;t exhibit undefined behavior, and it doesn&#39;t talk about order, of evaluation, of function arguments."}, {"owner": {"reputation": 606, "user_id": 3496382, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b1d5358aca39b65581c1a1c2750dc2?s=128&d=identicon&r=PG&f=1", "display_name": "gan_", "link": "https://stackoverflow.com/users/3496382/gan"}, "edited": false, "score": 0, "creation_date": 1560949083, "post_id": 56668161, "comment_id": 99904166, "body": "The order of evaluation of arguments is unspecified. As far as I know, there is no way to change that without rewriting your code."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2269707"}, "reply_to_user": {"reputation": 1727, "user_id": 5440453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3500f6dc5327b259bb48da3399268b0?s=128&d=identicon&r=PG&f=1", "display_name": "Algirdas Preid\u017eius", "link": "https://stackoverflow.com/users/5440453/algirdas-preid%c5%beius"}, "edited": false, "score": 0, "creation_date": 1560949096, "post_id": 56668161, "comment_id": 99904177, "body": "@AlgirdasPreid\u017eius yeah,  unspecified or implementation-defined is more correct."}, {"owner": {"reputation": 26945, "user_id": 771073, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/412bf39694cbe9d1fc0374deda225b18?s=128&d=identicon&r=PG", "display_name": "Martin Bonner supports Monica", "link": "https://stackoverflow.com/users/771073/martin-bonner-supports-monica"}, "edited": false, "score": 0, "creation_date": 1560949119, "post_id": 56668161, "comment_id": 99904190, "body": "The only way to sequence the calls is to declare temporary variables which store the results and <i>then</i> construct <code>bar</code>.  So:  <code>const auto r1 = f1(); const auto r2 = f2() Bar bar(r1, r2);</code>"}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 4, "creation_date": 1560949141, "post_id": 56668161, "comment_id": 99904213, "body": "If the order matters, use variables. <code>auto i1 = f1(); auto i2 = f2(); Bar bar(i1, i2);</code>. It&#39;s very likely to produce exactly the same code except for the order."}, {"owner": {"reputation": 26945, "user_id": 771073, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/412bf39694cbe9d1fc0374deda225b18?s=128&d=identicon&r=PG", "display_name": "Martin Bonner supports Monica", "link": "https://stackoverflow.com/users/771073/martin-bonner-supports-monica"}, "edited": false, "score": 3, "creation_date": 1560949175, "post_id": 56668161, "comment_id": 99904235, "body": "@reavenisadesk Unspecified, not implementation-defined (the implementation doesn&#39;t have to say how it does it, and it doesn&#39;t even have to be consistent)."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2269707"}, "reply_to_user": {"reputation": 26945, "user_id": 771073, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/412bf39694cbe9d1fc0374deda225b18?s=128&d=identicon&r=PG", "display_name": "Martin Bonner supports Monica", "link": "https://stackoverflow.com/users/771073/martin-bonner-supports-monica"}, "edited": false, "score": 0, "creation_date": 1560949251, "post_id": 56668161, "comment_id": 99904280, "body": "@MartinBonner aren&#39;t they the same thing? <code>implementation-defined behavior: unspecified behavior where each implementation documents how the choice is made</code> from C standard."}, {"owner": {"reputation": 7825, "user_id": 3684343, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5bee557e309dc42d91a706c70c8c0c9f?s=128&d=identicon&r=PG&f=1", "display_name": "mch", "link": "https://stackoverflow.com/users/3684343/mch"}, "edited": false, "score": 2, "creation_date": 1560949452, "post_id": 56668161, "comment_id": 99904415, "body": "The better duplicate is: <a href=\"https://stackoverflow.com/questions/2934904/order-of-evaluation-in-c-function-parameters\" title=\"order of evaluation in c function parameters\">stackoverflow.com/questions/2934904/&hellip;</a>"}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "reply_to_user": {"reputation": 7825, "user_id": 3684343, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5bee557e309dc42d91a706c70c8c0c9f?s=128&d=identicon&r=PG&f=1", "display_name": "mch", "link": "https://stackoverflow.com/users/3684343/mch"}, "edited": false, "score": 1, "creation_date": 1560949632, "post_id": 56668161, "comment_id": 99904517, "body": "@mch I&#39;ve added that to the target list"}, {"owner": {"reputation": 26945, "user_id": 771073, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/412bf39694cbe9d1fc0374deda225b18?s=128&d=identicon&r=PG", "display_name": "Martin Bonner supports Monica", "link": "https://stackoverflow.com/users/771073/martin-bonner-supports-monica"}, "edited": false, "score": 3, "creation_date": 1560949634, "post_id": 56668161, "comment_id": 99904518, "body": "@reavenisadesk No.  &quot;Implenentation defined&quot; means the implementation has to document the order.  In the case of order of evaluation, it doesn&#39;t."}], "owner": {"user_type": "does_not_exist", "display_name": "user2269707"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 58, "favorite_count": 0, "closed_date": 1560948959, "answer_count": 0, "score": 2, "last_activity_date": 1560949656, "creation_date": 1560948878, "question_id": 56668161, "link": "https://stackoverflow.com/questions/56668161/is-calling-order-of-functions-in-parameters-an-undefined-behavior", "closed_reason": "Duplicate", "title": "Is calling order of functions in parameters an undefined behavior?", "body": "<p>I got code like this:</p>\n\n<pre><code>#include &lt;iostream&gt;\n\nint f1() {\n  std::cout &lt;&lt; 1 &lt;&lt; std::endl;\n  return 1;\n}\n\nint f2() {\n  std::cout &lt;&lt; 2 &lt;&lt; std::endl;\n  return 2;\n}\n\nclass Bar {\n public:\n  Bar(int i, int j) {}\n};\n\nint main() {\n  Bar bar(f1(), f2());\n}\n</code></pre>\n\n<p>When the code compiled using gcc 7.4.0, the out put is <code>2 1</code>, while when using clang 6.0, the out put is <code>1 2</code>.</p>\n\n<p>So I got questions:\nIs calling order of paramters an undefined behavior? If so, can I force compiler to call in order if <code>f1()</code> and <code>f2()</code> in order(in some cases the order of <code>f1()</code> and <code>f2()</code> matters)? And is this a good practice(compare with call them orderly and pass the result to the function)? </p>\n"}, {"tags": ["c++", "templates", "template-specialization", "enable-if", "template-variables"], "answers": [{"tags": [], "owner": {"reputation": 59936, "user_id": 6022656, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bf138f6c424001ac8491ca86b1976c0c?s=128&d=identicon&r=PG&f=1", "display_name": "max66", "link": "https://stackoverflow.com/users/6022656/max66"}, "is_accepted": false, "score": 7, "last_activity_date": 1560962523, "last_edit_date": 1560962523, "creation_date": 1560948631, "answer_id": 56668078, "question_id": 56667847, "link": "https://stackoverflow.com/questions/56667847/why-must-specializing-argument-be-void/56668078#56668078", "title": "Why Must Specializing Argument be void?", "body": "<p>Not sure to understand what you don't understand but...</p>\n\n<p>If you write</p>\n\n<pre><code>template &lt;typename T, typename = void&gt;\nconstexpr details::subscript_function&lt;T&gt; my_temp[] = { &amp;details::X&lt;T&gt;, &amp;details::Y&lt;T&gt; };\n\ntemplate &lt;typename T&gt;\nconstexpr details::subscript_function&lt;T&gt; my_temp&lt;T, enable_if_t&lt;is_floating_point_v&lt;decltype(details::X(T()))&gt;, T&gt;&gt;[] = { &amp;details::X&lt;T&gt;, &amp;details::Y&lt;T&gt;, &amp;details::Z&lt;T&gt; };\n</code></pre>\n\n<p>you have a first, main, template variable with two templates: a type and a type with a default (<code>void</code>).</p>\n\n<p>The second template variable is enabled when <code>std::enable_if_t</code> is <code>void</code>.</p>\n\n<p>What's happen when you write</p>\n\n<pre><code>for(const auto i : my_temp&lt;decltype(foo)&gt;) \n</code></pre>\n\n<p>?</p>\n\n<p>The compiler:</p>\n\n<p>1) find <code>my_temp&lt;decltype(foo)&gt;</code> that has a single template parameter</p>\n\n<p>2) look for a matching <code>my_temp</code> template variable</p>\n\n<p>3) find only a <code>my_temp</code> with two template parameters but the second has a default, so</p>\n\n<p>4) decide that <code>my_temp&lt;decltype(foo)&gt;</code> can be only <code>my_temp&lt;decltype(foo), void&gt;</code> (or <code>my_temp&lt;vec, void&gt;</code>, if you prefer)</p>\n\n<p>5) see that the main <code>my_temp</code> matches</p>\n\n<p>6) see that the <code>my_temp</code> specialization doesn't matches because</p>\n\n<pre><code>enable_if_t&lt;is_floating_point_v&lt;decltype(details::X(T()))&gt;, T&gt;\n</code></pre>\n\n<p>is <code>T</code> (that is <code>vec</code>), so could match only <code>my_temp&lt;vec, vec&gt;</code> that is different from <code>my_temp&lt;vec, void&gt;</code>.</p>\n\n<p>7) choose the only template variable available: the main one.</p>\n\n<p>If you want that the specialization is enabled by </p>\n\n<pre><code>enable_if_t&lt;is_floating_point_v&lt;decltype(details::X(T()))&gt;, T&gt;\n</code></pre>\n\n<p>you should use <code>T</code></p>\n\n<pre><code>// ..............................V   T! not void\ntemplate &lt;typename T, typename = T&gt;\nconstexpr details::subscript_function&lt;T&gt; my_temp[] = { &amp;details::X&lt;T&gt;, &amp;details::Y&lt;T&gt; };\n</code></pre>\n\n<p>as default for second template type in the main template variable.</p>\n\n<p>Off Topic suggestion: better use <code>std::declval</code> inside the <code>std::is_floating_point_v</code> test; I suggest</p>\n\n<pre><code>std::enable_if_t&lt;std::is_floating_point_v&lt;decltype(details::X(std::declval&lt;T&gt;()))&gt;&gt;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "is_accepted": false, "score": 2, "last_activity_date": 1560950687, "creation_date": 1560950687, "answer_id": 56668737, "question_id": 56667847, "link": "https://stackoverflow.com/questions/56667847/why-must-specializing-argument-be-void/56668737#56668737", "title": "Why Must Specializing Argument be void?", "body": "<p>How template specialization works:</p>\n\n<p>There is a <strong>primary specialization</strong>.  This one basically defines the arguments and defaults.</p>\n\n<pre><code>template &lt;typename T, typename = void&gt;\n</code></pre>\n\n<p>This is the template part of your primary specialization.  It takes one type, then another type that defaults to <code>void</code>.</p>\n\n<p>This is the \"interface\" of your template.</p>\n\n<pre><code>template &lt;typename T&gt;\n[...] &lt;T, enable_if_t&lt;is_floating_point_v&lt;decltype(details::X(T()))&gt;, T&gt;&gt; [...]\n</code></pre>\n\n<p>here is a <strong>secondary specialization</strong>.</p>\n\n<p>In this case, the <code>template &lt;typename T&gt;</code> is fundamentally different.  In the primary specialization, it defined an interface; here, it defines \"variables\" that are used below.</p>\n\n<p>Then we have the part where we do the pattern matching.  This is after the name of the template (variable in this case).  Reformatted for sanity:</p>\n\n<pre><code>&lt;\n  T,\n  enable_if_t\n  &lt;\n    is_floating_point_v\n    &lt;\n      decltype\n      (\n        details::X(T())\n      )\n    &gt;,\n    T\n  &gt;\n&gt;\n</code></pre>\n\n<p>now we can see the structure.  There are two arguments, matching the two arguments in the primary specialization.</p>\n\n<p>The first one is <code>T</code>.  Now, this matches the <em>name</em> in the primary specialization, but that means nothing.  It is like calling a function <code>make_point(int x, int y)</code> with variables <code>x,y</code> -- it could be <code>y,x</code> or <code>m,n</code> and <code>make_point</code> doesn't care.</p>\n\n<p>We introduced a completely new variable <code>T</code> in this specialization.  Then we bound it to the first argument.</p>\n\n<p>The second argument is complex.  Complex enough that it is in a \"non-deduced context\".  Typically, template specialization arguments are deduced from the arguments passed to template as defined in the primary specialization; non-deduced arguments are not.</p>\n\n<p>If we do <code>some_template&lt; Foo &gt;</code>, matching a type <code>T</code> against <code>Foo</code> gets ... <code>Foo</code>.  Pretty easy pattern match.  Fancier pattern matches are permitted, like a specialization that takes a <code>T*</code>; this fails to match against <code>some_template&lt;int&gt;</code>, but matches against <code>some_template&lt;int*&gt;</code> with <code>T=int</code>.</p>\n\n<p>Non-deduced arguments do not participate in this game.  Instead, the arguments that <em>do</em> match are plugged in, and the resulting type is generated.  And if and only if that matches the type passed to the template in that slot does the specialization match.</p>\n\n<p>So lets examine what happens we pass <code>vec</code> as the first argument to <code>my_temp</code></p>\n\n<p>First we go to the primary specialization</p>\n\n<pre><code>template&lt;typename T, typename=void&gt;\nmy_temp\n</code></pre>\n\n<p>now <code>my_temp&lt;vec&gt;</code> has a default argument.  It becomes <code>my_temp&lt;vec,void&gt;</code>.</p>\n\n<p>We then examine each <em>other</em> specialization to see if any of them match; if none do, we stay as the primary specialization.</p>\n\n<p>The other specialization is:</p>\n\n<pre><code>template&lt;typename T&gt;\n[...] my_temp&lt;\n  T,\n  enable_if_t\n  &lt;\n    is_floating_point_v\n    &lt;\n      decltype\n      (\n        details::X(T())\n      )\n    &gt;,\n    T\n  &gt;\n&gt;[...]\n</code></pre>\n\n<p>with <code>[...]</code> for stuff that doesn't matter.</p>\n\n<p>Ok, the first argument is bound to <code>T</code>.  Well, the first argument is <code>vec</code>, so that is easy.  We substitute:</p>\n\n<pre><code>template&lt;typename T&gt;\n[...] my_temp&lt;\n  vec,\n  enable_if_t\n  &lt;\n    is_floating_point_v\n    &lt;\n      decltype\n      (\n        details::X(vec())\n      )\n    &gt;,\n    vec\n  &gt;\n&gt;[...]\n</code></pre>\n\n<p>then evaluate:</p>\n\n<pre><code>template&lt;typename T&gt;\n[...] my_temp&lt;\n  vec,\n  enable_if_t\n  &lt;\n    is_floating_point_v\n    &lt;\n      double\n    &gt;,\n    vec\n  &gt;\n&gt;[...]\n</code></pre>\n\n<p>and more:</p>\n\n<pre><code>template&lt;typename T&gt;\n[...] my_temp&lt;\n  vec,\n  enable_if_t\n  &lt;\n    true,\n    vec\n  &gt;\n&gt;[...]\n</code></pre>\n\n<p>and more:</p>\n\n<pre><code>template&lt;typename T&gt;\n[...] my_temp&lt;\n  vec,\n  vec\n&gt;[...]\n</code></pre>\n\n<p>ok, remember we where trying to match against <code>my_temp&lt;vec,void&gt;</code>.  But this specialization evaluated to <code>my_temp&lt;vec,vec&gt;</code>, and those don't match.  <strong>Rejected.</strong></p>\n\n<p>Remove the <code>,T</code> from <code>enable_if</code>, or make it <code>,void</code> (same thing), and the last line of the above argument becomes <code>my_temp&lt;vec,void&gt;</code> matches <code>my_temp&lt;vec,void&gt;</code>, and the secondary specialization is chosen over the primary one.</p>\n\n<hr>\n\n<p>It is confusing.  The same syntax means fundamentally different things in primary specialization and secondary ones.  You have to understand pattern matching of template arguments and non-deduced contexts.</p>\n\n<p>And what you usually get is someone using it like a magic black box that you copy.</p>\n\n<p>The magic black box -- the patterns -- are useful because they mean you don't have to think about the details of how you got there.  But understanding pattern matching of template arguments, deduced and non-deduced contexts, and the differences between primary and secondary specializations is key to get why the black box works.</p>\n"}, {"tags": [], "owner": {"reputation": 19667, "user_id": 1312382, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FL8Fg.jpg?s=128&g=1", "display_name": "Aconcagua", "link": "https://stackoverflow.com/users/1312382/aconcagua"}, "is_accepted": false, "score": 0, "last_activity_date": 1560952459, "last_edit_date": 1560952459, "creation_date": 1560952021, "answer_id": 56669243, "question_id": 56667847, "link": "https://stackoverflow.com/questions/56667847/why-must-specializing-argument-be-void/56669243#56669243", "title": "Why Must Specializing Argument be void?", "body": "<p>With</p>\n\n<pre><code>struct vec\n{\n    double x;\n    double y;\n    double z;\n};\n</code></pre>\n\n<p>and</p>\n\n<pre><code>template &lt;typename T&gt;\nconstexpr double X(const T&amp; param) { return param.x; }\n</code></pre>\n\n<p>we'll find out that</p>\n\n<pre><code>is_floating_point_v&lt;decltype(details::X(T()))\n</code></pre>\n\n<p>evaluates to <code>true</code> (unless you're going to specialise <code>X</code> for <code>vec</code> not to return floating point...).</p>\n\n<p>So we actually have:</p>\n\n<pre><code>template &lt;typename T&gt;\nconstexpr details::subscript_function&lt;T&gt; my_temp&lt;T, enable_if_t&lt;true, T&gt;&gt;[]\n    = { /*...*/ };\n</code></pre>\n\n<p>or shorter:</p>\n\n<pre><code>template &lt;typename T&gt;\nconstexpr details::subscript_function&lt;T&gt; my_temp&lt;T, T&gt;[]\n    = { /*...*/ };\n</code></pre>\n\n<p>(if it exists at all, of course...). Explicitly choosing one or the other:</p>\n\n<pre><code>my_temp&lt;decltype(foo), void&gt;\nmy_temp&lt;decltype(foo), int&gt;\nmy_temp&lt;decltype(foo), double&gt;\n</code></pre>\n\n<p>all match the main template, but none of the specialisation.</p>\n\n<pre><code>my_temp&lt;decltype(foo), decltype(foo)&gt;\n</code></pre>\n\n<p>now <em>does</em> match the specialisation (which exists because of <code>X(foo)</code> returning double...).</p>\n\n<p>Finally back to <code>my_temp&lt;decltype(foo)&gt;</code> \u2013 well, only one template parameter given. Which is the type of the second one? The default parameter tells you (or better: the compiler), it is <code>void</code>. And according to above...</p>\n\n<p>So if you want to match the specialisation, either this one needs <code>void</code> as type of second template parameter (as you discovered already) or you change the default in the non-specialized template to being equal to first template parameter (<code>typename T, typename = T</code>).</p>\n\n<p>Actually, you could select <em>any</em> type for the default and the specialisation, as long as you choose the same for <em>both</em> (e. g. twice <code>int</code>, <code>std::string</code>, <code>MyVeryComplexCustomClass</code>, ...).</p>\n"}], "owner": {"reputation": 34957, "user_id": 2642059, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Jonathan Mee", "link": "https://stackoverflow.com/users/2642059/jonathan-mee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "answer_count": 3, "score": 5, "last_activity_date": 1560962523, "creation_date": 1560947927, "question_id": 56667847, "link": "https://stackoverflow.com/questions/56667847/why-must-specializing-argument-be-void", "title": "Why Must Specializing Argument be void?", "body": "<p>So yet another question in <a href=\"https://stackoverflow.com/q/56649481/2642059\">this saga</a>. <a href=\"https://stackoverflow.com/users/2104697/guillaume-racicot\">Guillaume Racicot</a> has been good enough to provide me with <a href=\"https://stackoverflow.com/a/56650205/2642059\">yet another workaround</a> so this is the code I'll be basing this question off of:</p>\n\n<pre><code>struct vec\n{\n    double x;\n    double y;\n    double z;\n};\n\nnamespace details\n{\ntemplate &lt;typename T&gt;\nusing subscript_function = double(*)(const T&amp;);\n\ntemplate &lt;typename T&gt;\nconstexpr double X(const T&amp; param) { return param.x; }\n\ntemplate &lt;typename T&gt;\nconstexpr double Y(const T&amp; param) { return param.y; }\n\ntemplate &lt;typename T&gt;\nconstexpr double Z(const T&amp; param) { return param.z; }\n}\n\ntemplate &lt;typename T, typename = void&gt;\nconstexpr details::subscript_function&lt;T&gt; my_temp[] = { &amp;details::X&lt;T&gt;, &amp;details::Y&lt;T&gt; };\n\ntemplate &lt;typename T&gt;\nconstexpr details::subscript_function&lt;T&gt; my_temp&lt;T, enable_if_t&lt;is_floating_point_v&lt;decltype(details::X(T()))&gt;, T&gt;&gt;[] = { &amp;details::X&lt;T&gt;, &amp;details::Y&lt;T&gt;, &amp;details::Z&lt;T&gt; };\n\n\nint main() {\n    vec foo = { 1.0, 2.0, 3.0 };\n\n    for(const auto i : my_temp&lt;decltype(foo)&gt;) {\n        cout &lt;&lt; (*i)(foo) &lt;&lt; endl;\n    }\n}\n</code></pre>\n\n<p>The problem seems to arise in my specialization when I return something <em>other</em> than <code>void</code>. In the code above for example, <code>enable_if_t&lt;is_floating_point_v&lt;decltype(details::X(T()))&gt;, T&gt;</code> prevents specialization, while simply removing the last argument and allowing <code>enable_if</code> to return <code>void</code> allows specialization.</p>\n\n<p>I think this points to my misunderstanding of what is really happening here. Why must the specialized type always be <code>void</code> for this to work?</p>\n\n<p><a href=\"https://ideone.com/pYqiUS\" rel=\"noreferrer\"><kbd>Live Example</kbd></a></p>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "edited": false, "score": 3, "creation_date": 1560947631, "post_id": 56667667, "comment_id": 99903234, "body": "&#39;This works&#39;. Not really, you are writing to a zero length string. <code>sprintf</code> doesn&#39;t resize the string to fit the characters you are putting in it. I guess it&#39;s only working in practise because the common implementation technique of <i>short string optimization</i> means you have a few bytes to play with in the string object itself."}, {"owner": {"reputation": 8766, "user_id": 451321, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/7Sdao.jpg?s=128&g=1", "display_name": "Michael Chourdakis", "link": "https://stackoverflow.com/users/451321/michael-chourdakis"}, "edited": false, "score": 2, "creation_date": 1560947684, "post_id": 56667667, "comment_id": 99903276, "body": "What&#39;s the point in inserting an array of ints in a vector of chars?"}, {"owner": {"reputation": 18971, "user_id": 2674506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QvQN8.jpg?s=128&g=1", "display_name": "vahancho", "link": "https://stackoverflow.com/users/2674506/vahancho"}, "edited": false, "score": 0, "creation_date": 1560947777, "post_id": 56667667, "comment_id": 99903325, "body": "<code>tmp.data()</code> is read only. No?"}, {"owner": {"reputation": 474, "user_id": 11310636, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/243689119dbf710ab44923faff266fcf?s=128&d=identicon&r=PG&f=1", "display_name": "Narase", "link": "https://stackoverflow.com/users/11310636/narase"}, "edited": false, "score": 0, "creation_date": 1560947787, "post_id": 56667667, "comment_id": 99903336, "body": "if its about the data you can do this <code>char* data = (char*)val;</code> and avoid sprintf"}, {"owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "edited": false, "score": 0, "creation_date": 1560947844, "post_id": 56667667, "comment_id": 99903369, "body": "A few people seem to be missing that the OP is trying to convert the integers to character digits. It&#39;s not the bytes that are being inserted to the vector but the (ASCII) digits."}, {"owner": {"reputation": 18971, "user_id": 2674506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QvQN8.jpg?s=128&g=1", "display_name": "vahancho", "link": "https://stackoverflow.com/users/2674506/vahancho"}, "edited": false, "score": 1, "creation_date": 1560947964, "post_id": 56667667, "comment_id": 99903440, "body": "Hm, but what do you expect when trying to convert <code>9000</code> to a char?"}, {"owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "reply_to_user": {"reputation": 18971, "user_id": 2674506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QvQN8.jpg?s=128&g=1", "display_name": "vahancho", "link": "https://stackoverflow.com/users/2674506/vahancho"}, "edited": false, "score": 0, "creation_date": 1560947992, "post_id": 56667667, "comment_id": 99903458, "body": "@vahancho I think four chars, <code>&quot;9000&quot;</code>. That&#39;s what the code nearly does."}, {"owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "reply_to_user": {"reputation": 18971, "user_id": 2674506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QvQN8.jpg?s=128&g=1", "display_name": "vahancho", "link": "https://stackoverflow.com/users/2674506/vahancho"}, "edited": false, "score": 0, "creation_date": 1560948455, "post_id": 56667667, "comment_id": 99903763, "body": "@vahancho <code>tmp.data()</code> is writable in C++17"}, {"owner": {"reputation": 4654, "user_id": 332733, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BR7yE.jpg?s=128&g=1", "display_name": "Mgetz", "link": "https://stackoverflow.com/users/332733/mgetz"}, "edited": false, "score": 0, "creation_date": 1560948545, "post_id": 56667667, "comment_id": 99903820, "body": "Strictly speaking <a href=\"https://en.cppreference.com/w/cpp/utility/to_chars\" rel=\"nofollow noreferrer\"><code>std::to_chars</code></a> should be the fastest conversion to local invariant representation. That said you will need to allocate buffer for that."}, {"owner": {"reputation": 77, "user_id": 11665953, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/170b62cb1d7f628f722648c6cf9cbec4?s=128&d=identicon&r=PG&f=1", "display_name": "vddox", "link": "https://stackoverflow.com/users/11665953/vddox"}, "reply_to_user": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "edited": false, "score": 0, "creation_date": 1560948579, "post_id": 56667667, "comment_id": 99903849, "body": "@john Yeah you&#39;re right, forgot to init the size of the string in the code I posted here."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "reply_to_user": {"reputation": 474, "user_id": 11310636, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/243689119dbf710ab44923faff266fcf?s=128&d=identicon&r=PG&f=1", "display_name": "Narase", "link": "https://stackoverflow.com/users/11310636/narase"}, "edited": false, "score": 1, "creation_date": 1560949758, "post_id": 56667667, "comment_id": 99904603, "body": "@Narase No, this is a lexical conversion."}], "answers": [{"comments": [{"owner": {"reputation": 4654, "user_id": 332733, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BR7yE.jpg?s=128&g=1", "display_name": "Mgetz", "link": "https://stackoverflow.com/users/332733/mgetz"}, "edited": false, "score": 3, "creation_date": 1560948593, "post_id": 56667902, "comment_id": 99903853, "body": "Or they could just use <a href=\"https://en.cppreference.com/w/cpp/utility/to_chars\" rel=\"nofollow noreferrer\"><code>std::to_chars</code></a>"}, {"owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "reply_to_user": {"reputation": 4654, "user_id": 332733, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BR7yE.jpg?s=128&g=1", "display_name": "Mgetz", "link": "https://stackoverflow.com/users/332733/mgetz"}, "edited": false, "score": 0, "creation_date": 1560959414, "post_id": 56667902, "comment_id": 99910706, "body": "@Mgetz Yes, didn&#39;t know about that one."}], "tags": [], "owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "is_accepted": false, "score": 2, "last_activity_date": 1560948501, "last_edit_date": 1560948501, "creation_date": 1560948070, "answer_id": 56667902, "question_id": 56667667, "link": "https://stackoverflow.com/questions/56667667/optimize-inserting-stduint32-ts-into-a-stdvectorchar/56667902#56667902", "title": "Optimize inserting std::uint32_t&#39;s into a std::vector&lt;char&gt;", "body": "<p>I would make a couple of changes (and fix the bug).</p>\n\n<p>Firstly the number of digits in an integer is limited so there's no need to use a dynamic object like <code>std::string</code>, a simple char array will do. Since you are using <code>uint32_t</code> and decimal digits 10 characters are sufficient, 11 if you include a nul terminator.</p>\n\n<p>Secondly <code>sprintf</code> and similar are inefficient because they have to interpret the format string, <code>\"%u\"</code> in your case. A hand written function to perform the conversion from <code>uint32_t</code> to digits would be more efficient.</p>\n"}, {"comments": [{"owner": {"reputation": 77, "user_id": 11665953, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/170b62cb1d7f628f722648c6cf9cbec4?s=128&d=identicon&r=PG&f=1", "display_name": "vddox", "link": "https://stackoverflow.com/users/11665953/vddox"}, "edited": false, "score": 0, "creation_date": 1560949072, "post_id": 56668059, "comment_id": 99904156, "body": "I like this solution, I don&#39;t strictly need to use vectors, they are just quicker to std::move() than strings due to SSO."}, {"owner": {"reputation": 4654, "user_id": 332733, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BR7yE.jpg?s=128&g=1", "display_name": "Mgetz", "link": "https://stackoverflow.com/users/332733/mgetz"}, "reply_to_user": {"reputation": 77, "user_id": 11665953, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/170b62cb1d7f628f722648c6cf9cbec4?s=128&d=identicon&r=PG&f=1", "display_name": "vddox", "link": "https://stackoverflow.com/users/11665953/vddox"}, "edited": false, "score": 1, "creation_date": 1560950957, "post_id": 56668059, "comment_id": 99905373, "body": "@vddox I&#39;d profile before assuming, most strings move extremely quick even with SSO."}], "tags": [], "owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "is_accepted": true, "score": 4, "last_activity_date": 1560948575, "creation_date": 1560948575, "answer_id": 56668059, "question_id": 56667667, "link": "https://stackoverflow.com/questions/56667667/optimize-inserting-stduint32-ts-into-a-stdvectorchar/56668059#56668059", "title": "Optimize inserting std::uint32_t&#39;s into a std::vector&lt;char&gt;", "body": "<blockquote>\n  <p>Is there a more idiomatic way of doing this?</p>\n</blockquote>\n\n<p>A character stream is idiomatic for this. Unfortunately, the standard only has a stream for building a string; not a vector. You can copy the string into a vector though. This is not most efficient way:</p>\n\n<pre><code>std::ostringstream ss;\nunsigned val[10] {1,200,3,4,5,6000,7,8,9000};\nfor (auto v : val)\n    ss &lt;&lt; v;\nstd::string str = ss.str();\n\n// if you need a vector for some reason\nstd::vector&lt;char&gt; chars(std::begin(str), std::end(str));\n</code></pre>\n\n<p>Or you could write your own custom vector stream, but that will be a lot of boilerplate.</p>\n"}], "owner": {"reputation": 77, "user_id": 11665953, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/170b62cb1d7f628f722648c6cf9cbec4?s=128&d=identicon&r=PG&f=1", "display_name": "vddox", "link": "https://stackoverflow.com/users/11665953/vddox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 216, "favorite_count": 0, "accepted_answer_id": 56668059, "answer_count": 2, "score": 0, "last_activity_date": 1560949331, "creation_date": 1560947339, "last_edit_date": 1560949331, "question_id": 56667667, "link": "https://stackoverflow.com/questions/56667667/optimize-inserting-stduint32-ts-into-a-stdvectorchar", "title": "Optimize inserting std::uint32_t&#39;s into a std::vector&lt;char&gt;", "body": "<p>I'm attempting to insert an array of unsigned ints into a std::vector.</p>\n\n<p>Here is my current code:</p>\n\n<pre><code>auto add_chars(std::vector&lt;char&gt; &amp; vec, unsigned val[]){\n    std::string tmp;\n    tmp.resize(11) // Max chars a uint can be represented by, including the '\\n' for sprintf\n    for (auto x = 0; x&lt; 10; x++){\n        auto char_count = sprintf(tmp.data(),\"%u\", val[x]);\n        vec.insert(vec.begin()+vec.size(),tmp.data(), tmp.data()+char_count);\n    }\n\n}\n\nint main(){\n    std::vector&lt;char&gt; chars;\n    unsigned val[10] {1,200,3,4,5,6000,7,8,9000};\n    add_chars(chars,val);\n    for (auto &amp; item : chars){\n        std::cout &lt;&lt; item;\n    }\n}\n</code></pre>\n\n<p>This solution works, however I question its efficiency (and elegance).</p>\n\n<p>Two questions:</p>\n\n<ul>\n<li>Is there a more idiomatic way of doing this?</li>\n<li>Is there a more efficient way of doing this?</li>\n</ul>\n\n<p>*edit Fixed a bug in the code made while transferring over to here.</p>\n\n<p>Also, i'm aware that '9000' can't be represented as 1 char, whats why im using the buffer and sprintf to generate multiple chars for the one uint.</p>\n"}, {"tags": ["c++", "ifstream"], "comments": [{"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1560946975, "post_id": 56667482, "comment_id": 99902843, "body": "what do you enter as input?"}, {"owner": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 1, "creation_date": 1560947092, "post_id": 56667482, "comment_id": 99902899, "body": "If the error is can&#39;t open a file then the default folder is not the one that you think. Or perhaps you named the file differently from what you typed. Be careful with windows the hiding extensions of known types feature may cause you a few headaches if your files are really named <code>myfile.txt.txt</code> and you typed <code>myfile.txt</code>"}, {"owner": {"reputation": 119, "user_id": 8334537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc8744184b883d32db033dfc80d3c8b0?s=128&d=identicon&r=PG&f=1", "display_name": "s_diaconu", "link": "https://stackoverflow.com/users/8334537/s-diaconu"}, "edited": false, "score": 0, "creation_date": 1560947127, "post_id": 56667482, "comment_id": 99902917, "body": "Any input I enter is getting error. I tried <code>myin</code>, <code>myin.txt</code> or any other name. The <code>error(&quot;Can&#39;t open input file &quot;,iname);</code> is from the library created by the author."}, {"owner": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 1, "creation_date": 1560947170, "post_id": 56667482, "comment_id": 99902941, "body": "Make sure the file exists and you have the file in the working directory! If this is Visual Studio the file probably needs to be in the same folder as the project. If it is some other IDE the default folder is probably the same as the executable."}, {"owner": {"reputation": 219644, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "edited": false, "score": 1, "creation_date": 1560947281, "post_id": 56667482, "comment_id": 99903006, "body": "@s_diaconu Try ifstream ist( iname.c_str() );"}, {"owner": {"reputation": 219644, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "edited": false, "score": 0, "creation_date": 1560947366, "post_id": 56667482, "comment_id": 99903073, "body": "@s_diaconu Or check whether the file is created in the work/current directory."}, {"owner": {"reputation": 2336, "user_id": 3936002, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/utGjG.png?s=128&g=1", "display_name": "H Walters", "link": "https://stackoverflow.com/users/3936002/h-walters"}, "edited": false, "score": 0, "creation_date": 1560947461, "post_id": 56667482, "comment_id": 99903135, "body": "&quot;when ifstream is creating&quot; ...what gave you the impression ifstream would create files here?  ifstream&#39;s for reading files."}, {"owner": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 1, "creation_date": 1560947607, "post_id": 56667482, "comment_id": 99903217, "body": "<b><i>Any input I enter is getting error. I tried myin, myin.txt or any other name.</i></b> This must be an existing file that you created using some other program like notepad and put in your working directory."}, {"owner": {"reputation": 119, "user_id": 8334537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc8744184b883d32db033dfc80d3c8b0?s=128&d=identicon&r=PG&f=1", "display_name": "s_diaconu", "link": "https://stackoverflow.com/users/8334537/s-diaconu"}, "reply_to_user": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 0, "creation_date": 1560947841, "post_id": 56667482, "comment_id": 99903367, "body": "Yes @drescherjm, this is a file from the same directory with <code>main.cpp</code> and created with <code>TextEdit</code> from Mac using the format for plain text."}, {"owner": {"reputation": 119, "user_id": 8334537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc8744184b883d32db033dfc80d3c8b0?s=128&d=identicon&r=PG&f=1", "display_name": "s_diaconu", "link": "https://stackoverflow.com/users/8334537/s-diaconu"}, "reply_to_user": {"reputation": 219644, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "edited": false, "score": 0, "creation_date": 1560947934, "post_id": 56667482, "comment_id": 99903420, "body": "@VladfromMoscow I tried with <code>ifstream ist( iname.c_str() )</code> and is the same error."}, {"owner": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 1, "creation_date": 1560947937, "post_id": 56667482, "comment_id": 99903423, "body": "It may need to be in the same folder as the executable. You should mention what IDE you use and someone probably can help with that. I don&#39;t use macOS so I can&#39;t help with this OS related problem."}, {"owner": {"reputation": 219644, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "edited": false, "score": 1, "creation_date": 1560948019, "post_id": 56667482, "comment_id": 99903471, "body": "@s_diaconu So check what directory is current."}, {"owner": {"reputation": 119, "user_id": 8334537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc8744184b883d32db033dfc80d3c8b0?s=128&d=identicon&r=PG&f=1", "display_name": "s_diaconu", "link": "https://stackoverflow.com/users/8334537/s-diaconu"}, "reply_to_user": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 0, "creation_date": 1560948689, "post_id": 56667482, "comment_id": 99903913, "body": "@drescherjm I should put the OS and IDE in the original questions, but in the rush the fix the issue I forgot."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1560948707, "post_id": 56667482, "comment_id": 99903923, "body": "Don&#39;t write code with TextEdit, use an editor meant for programming (Vim, Emacs, Sublime, Atom, VS Code, ...), or an IDE."}, {"owner": {"reputation": 119, "user_id": 8334537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc8744184b883d32db033dfc80d3c8b0?s=128&d=identicon&r=PG&f=1", "display_name": "s_diaconu", "link": "https://stackoverflow.com/users/8334537/s-diaconu"}, "reply_to_user": {"reputation": 219644, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "edited": false, "score": 0, "creation_date": 1560948725, "post_id": 56667482, "comment_id": 99903934, "body": "@VladfromMoscow I am using Xcode and I thought that the working directory is the folder where the program is. I tried also to add the file from Xcode, but the same error. I figured out how to find the current directory and placed the file in there and it is working. Good to know for the future. Thanks."}, {"owner": {"reputation": 119, "user_id": 8334537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc8744184b883d32db033dfc80d3c8b0?s=128&d=identicon&r=PG&f=1", "display_name": "s_diaconu", "link": "https://stackoverflow.com/users/8334537/s-diaconu"}, "reply_to_user": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 1, "creation_date": 1560948945, "post_id": 56667482, "comment_id": 99904083, "body": "@molbdnilo I used TextEdit and choose <code>Format &gt; Make Plain Text</code> and save <code>file.txt</code> and is equivalent to Notepad from Windows, but I think is a matter of choice."}, {"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 2, "creation_date": 1560950279, "post_id": 56667482, "comment_id": 99904942, "body": "@s_diaconu Why not first, convince yourself that the file could actually be opened by hard-coding the name of the file you&#39;re trying to open?  <code>ifstream ist(&quot;filename.txt&quot;);</code>.  If you can&#39;t open the file that way, then inputting that same name into a string isn&#39;t going to work."}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 2, "creation_date": 1560952797, "post_id": 56667482, "comment_id": 99906545, "body": "I allowed myself to edit your comments into the question, as this was important information to make the quesiton answerable. If you dont like it, just roll back the edit"}], "answers": [{"tags": [], "owner": {"reputation": 2636, "user_id": 4635560, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iv67d.jpg?s=128&g=1", "display_name": "Manthan Tilva", "link": "https://stackoverflow.com/users/4635560/manthan-tilva"}, "is_accepted": false, "score": 1, "last_activity_date": 1560949993, "creation_date": 1560949993, "answer_id": 56668523, "question_id": 56667482, "link": "https://stackoverflow.com/questions/56667482/why-do-i-get-error-when-ifstream-is-creating-file-with-string-read-from-keyboard/56668523#56668523", "title": "Why do I get error when ifstream is creating file with string read from keyboard?", "body": "<p>There must be some confusion in passing argument. You should try to pass absolute path of input file.</p>\n\n<p>Below is your modified application. This will create One test file and use it instead of asking file name for Case 1. For case 2, it use file which doesn't exist.(Delete if present) </p>\n\n<pre><code>#include &lt;cstdio&gt;\n#include &lt;fstream&gt;\n#include &lt;iostream&gt;\n#include &lt;vector&gt;\nusing namespace std;\ntemplate &lt;typename T&gt; void error(const T &amp;t) { cout &lt;&lt; t; }\ntemplate &lt;typename T, typename... Args&gt; void error(const T &amp;t, Args... args) {\n  cout &lt;&lt; t &lt;&lt; \" \";\n  error(args...);\n  cout &lt;&lt; \"\\n\";\n}\n\nint main(int argc, const char *argv[]) {\n  // insert code here...\n  // cout &lt;&lt; \"Plese enter the input file name: \" &lt;&lt; endl;\n  string iname = \"a.txt\";\n  ofstream ofs{iname};\n  ofs &lt;&lt; 1 &lt;&lt; \" \" &lt;&lt; 2 &lt;&lt; \" \" &lt;&lt; 3 &lt;&lt; \" \" &lt;&lt; 4;\n  ofs.close();\n  //  cin &gt;&gt; iname;\n  // part 1\n  {\n    cout &lt;&lt; \"Case1: Reading file a.txt which is just created\\n\";\n    ifstream ist{iname};\n    if (!ist)\n      error(\"Can't open input file \", iname);\n    if (ist.is_open()) {\n      vector&lt;int&gt; numbers;\n      int sum = 0;\n      int n = 0;\n      while (ist &gt;&gt; n) {\n        numbers.push_back(n);\n      }\n      for (int i = 0; i &lt; numbers.size(); ++i) {\n        sum += numbers[i];\n      }\n      cout &lt;&lt; sum &lt;&lt; endl;\n      ist.close();\n    } else {\n      error(\"can't open file to read\", iname);\n    }\n  }\n  // part 2\n  {\n    cout &lt;&lt; \"Case2:reading file which is not present\\n\";\n    iname = \"b.txt\";\n    std::remove(iname.c_str()); // delete if present\n    ifstream ist{iname};\n    if (!ist)\n      error(\"Can't open input file \", iname);\n    if (ist.is_open()) {\n      vector&lt;int&gt; numbers;\n      int sum = 0;\n      int n = 0;\n      while (ist &gt;&gt; n) {\n        numbers.push_back(n);\n      }\n      for (int i = 0; i &lt; numbers.size(); ++i) {\n        sum += numbers[i];\n      }\n      cout &lt;&lt; sum &lt;&lt; endl;\n      ist.close();\n    } else {\n      error(\"can't open file to read\", iname);\n    }\n  }\n  return 0;\n}\n</code></pre>\n\n<p>Note: Construct of <code>std::ifstream</code> always create object. You need to its object either as you did or <code>is_open()</code> method.</p>\n"}, {"comments": [{"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1560953588, "post_id": 56669573, "comment_id": 99907049, "body": "It&#39;s not the executable&#39;s path either. It&#39;s the environment&#39;s <i>current working directory</i> when you run the program."}], "tags": [], "owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "is_accepted": true, "score": 3, "last_activity_date": 1560954738, "last_edit_date": 1560954738, "creation_date": 1560953009, "answer_id": 56669573, "question_id": 56667482, "link": "https://stackoverflow.com/questions/56667482/why-do-i-get-error-when-ifstream-is-creating-file-with-string-read-from-keyboard/56669573#56669573", "title": "Why do I get error when ifstream is creating file with string read from keyboard?", "body": "<blockquote>\n  <p>[...] in the same directory with main.cpp [...]</p>\n</blockquote>\n\n<p>It does not really matter where you put the input file relative to the source file. \nThe file should be in the environment's current working directory when you run the program.</p>\n"}], "owner": {"reputation": 119, "user_id": 8334537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc8744184b883d32db033dfc80d3c8b0?s=128&d=identicon&r=PG&f=1", "display_name": "s_diaconu", "link": "https://stackoverflow.com/users/8334537/s-diaconu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 0, "accepted_answer_id": 56669573, "answer_count": 2, "score": 1, "last_activity_date": 1560954738, "creation_date": 1560946765, "last_edit_date": 1560952757, "question_id": 56667482, "link": "https://stackoverflow.com/questions/56667482/why-do-i-get-error-when-ifstream-is-creating-file-with-string-read-from-keyboard", "title": "Why do I get error when ifstream is creating file with string read from keyboard?", "body": "<p>I am doing exercises from Bjarne Stroustrup's book, <em>Programming Principles and Practice Using C++</em>. I am on the first exercise in <em>Chapter 10</em>, where it says to write a program that produces the sum of all the numbers in a file of whitespace-separated integers. I based my code below on what's used for Exercise 2 of <em>Chapter 10.5</em>. I get an error when the <code>ifstream</code> object is created. Here is the code I am trying to run:</p>\n\n<pre><code>#include \"../../std_lib_facilities.h\"\n\nint main(int argc, const char * argv[]) {\n    // insert code here...\n\n    cout &lt;&lt; \"Plese enter the input file name: \" &lt;&lt; endl;\n    string iname;\n    cin &gt;&gt; iname;\n    ifstream ist {iname};\n    if (!ist) error(\"Can't open input file \",iname);\n\n    vector&lt;int&gt; numbers;\n    int sum;\n    int n;\n    while(ist&gt;&gt;n) {\n        numbers.push_back(n);\n    }\n\n    for (int i=0; i&lt;numbers.size(); ++i) {\n        sum += numbers[i];\n    }\n    cout &lt;&lt; sum &lt;&lt; endl;\n\n    return 0;\n}\n</code></pre>\n\n<p>Any input I enter is getting error. I tried myin, myin.txt or any other name. The <code>error(\"Can't open input file \",iname);</code> is from the library created by the author.</p>\n\n<p>I know the file does exist in the same directory with main.cpp and created with TextEdit from Mac using the format for plain text. </p>\n"}, {"tags": ["c++", "inheritance", "virtual", "destructor", "definition"], "comments": [{"owner": {"reputation": 219644, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "edited": false, "score": 0, "creation_date": 1560946771, "post_id": 56667425, "comment_id": 99902748, "body": "@ser11669150 You did not define the destructor ~B()"}, {"owner": {"reputation": 26945, "user_id": 771073, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/412bf39694cbe9d1fc0374deda225b18?s=128&d=identicon&r=PG", "display_name": "Martin Bonner supports Monica", "link": "https://stackoverflow.com/users/771073/martin-bonner-supports-monica"}, "edited": false, "score": 0, "creation_date": 1560950857, "post_id": 56667425, "comment_id": 99905301, "body": "Specifically <a href=\"https://stackoverflow.com/a/15113814/\">stackoverflow.com/a/15113814</a> is the answer."}], "answers": [{"tags": [], "owner": {"reputation": 219644, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": false, "score": 0, "last_activity_date": 1560946885, "creation_date": 1560946885, "answer_id": 56667513, "question_id": 56667425, "link": "https://stackoverflow.com/questions/56667425/undefined-reference-to-vtable-for-derived-class-and-deconstructor-of-that/56667513#56667513", "title": "Undefined Reference to &#39;vtable&#39; for derived class and deconstructor of that", "body": "<p>As the error text says</p>\n\n<blockquote>\n  <p>undefined reference to `B::~B()</p>\n</blockquote>\n\n<p>you did not define the destructor <code>~B()</code>. It is only declared in the class definition of <code>B</code> but not defined.</p>\n\n<p>You could write for example</p>\n\n<pre><code>~B() = default;\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 11669150, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/870ffb1ae4135f0f1157431070d32704?s=128&d=identicon&r=PG&f=1", "display_name": "Qiuren", "link": "https://stackoverflow.com/users/11669150/qiuren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 43, "favorite_count": 0, "closed_date": 1560950817, "answer_count": 1, "score": 0, "last_activity_date": 1560947022, "creation_date": 1560946587, "last_edit_date": 1560947022, "question_id": 56667425, "link": "https://stackoverflow.com/questions/56667425/undefined-reference-to-vtable-for-derived-class-and-deconstructor-of-that", "closed_reason": "Duplicate", "title": "Undefined Reference to &#39;vtable&#39; for derived class and deconstructor of that", "body": "<p>I think something is wrong with the deconstructor  but have no idea. In fact, I don't understand the usage of deconstructor.\nThe code is like this</p>\n\n<pre><code>#include &lt;iostream&gt;\nusing namespace std;\nclass A\n{\npublic:\nexplicit A(int x);\nvirtual ~A()=default;\nprotected:\nint a;\nvoid function1(int X);\n};\n\nclass B:public A\n{\npublic:\nexplicit B(int x);\n~B();\nprivate:\nint c;\n};\n\nvoid A::function1(int X){\n  std::cout &lt;&lt; \"function1 \" &lt;&lt; X&lt;&lt; endl;\n}\n\nA::A(int x):a(0)\n{\nstd::cout &lt;&lt; \"A \" &lt;&lt; x+a&lt;&lt; endl;\n}\n\nB::B(int x):A(x),c(3)\n{\n  std::cout &lt;&lt; \"B \" &lt;&lt; x+c&lt;&lt; endl;\n}\n\nint main()\n{\nB b1(1);\nreturn 0;\n}\n</code></pre>\n\n<p>It shows</p>\n\n<p>/home/qiuyilin/projects/inheritance/main.cpp:36: undefined reference to <code>vtable for B'\nCMakeFiles/inheritance.dir/main.cpp.o: In function</code>main':\n/home/qiuyilin/projects/inheritance/main.cpp:43: undefined reference to `B::~B()'\ncollect2: error: ld returned 1 exit status</p>\n"}, {"tags": ["c++", "node.js", "visual-studio", "visual-studio-2019", "node-addon-api"], "comments": [{"owner": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 1, "creation_date": 1560946202, "post_id": 56667266, "comment_id": 99902428, "body": "I don&#39;t exactly understand your question. I think you just need to modify your &quot;Additional include directory&quot; setting for your project. There is also a system wide version of that but unless you want to use this header in every project its best to use the per project version."}, {"owner": {"reputation": 158, "user_id": 3238415, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/937d4ff566908d4dd234b6d3a17768e8?s=128&d=identicon&r=PG&f=1", "display_name": "user3238415", "link": "https://stackoverflow.com/users/3238415/user3238415"}, "reply_to_user": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 0, "creation_date": 1560947995, "post_id": 56667266, "comment_id": 99903460, "body": "@drescherjm Thanks for the post. I&#39;m not opening a project, I&#39;m opening a folder and I cannot find such a option when opening a regular folder"}, {"owner": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 0, "creation_date": 1560948109, "post_id": 56667266, "comment_id": 99903531, "body": "You could use the system wide setting in your IDE compiler settings. I don&#39;t have 2019 installed here so I can&#39;t point you through the menus to the setting,"}], "owner": {"reputation": 158, "user_id": 3238415, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/937d4ff566908d4dd234b6d3a17768e8?s=128&d=identicon&r=PG&f=1", "display_name": "user3238415", "link": "https://stackoverflow.com/users/3238415/user3238415"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 159, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1560945954, "creation_date": 1560945954, "question_id": 56667266, "link": "https://stackoverflow.com/questions/56667266/how-can-i-force-visual-studio-to-find-a-header-file-when-opening-a-folder", "title": "How can I force visual studio to find a header file when opening a folder", "body": "<p>Visual Studio 2019 does not discover <code>napi.h</code>unless I use relative paths while opening a npm project as a folder. The file is located in <code>node_modules/node-addon-api/napi.h</code>. How can I force VS to find this header? Is there an <code>Additional include directory</code> type option when opening a folder?</p>\n\n<p>The header is automatically discovered on my laptop with the same version of VS2019 and the same environment path. I have <code>nodejs</code> tools installed for Visual Studio.</p>\n\n<p>I want to be able to do <code>#include &lt;napi.h&gt;</code> and have the header discovered. At the moment I must do <code>#include \"../node_modules/node-addon-api/napi.h\"</code></p>\n"}, {"tags": ["c++", "c++11", "gcc8"], "comments": [{"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "edited": false, "score": 2, "creation_date": 1560946140, "post_id": 56667263, "comment_id": 99902389, "body": "Create a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>"}, {"owner": {"reputation": 16020, "user_id": 9716597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f97c613dca0b157b40551a0d756abeb?s=128&d=identicon&r=PG&f=1", "display_name": "L. F.", "link": "https://stackoverflow.com/users/9716597/l-f"}, "edited": false, "score": 0, "creation_date": 1560946416, "post_id": 56667263, "comment_id": 99902546, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/12573816/what-is-an-undefined-reference-unresolved-external-symbol-error-and-how-do-i-fix\">What is an undefined reference/unresolved external symbol error and how do I fix it?</a>"}, {"owner": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "edited": false, "score": 1, "creation_date": 1560946536, "post_id": 56667263, "comment_id": 99902613, "body": "This symbol is defined in libstdc++.so. Do you compile with g++?"}, {"owner": {"reputation": 67, "user_id": 4057216, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba24fd5be3dd088adaf279da8b9ba49d?s=128&d=identicon&r=PG&f=1", "display_name": "mmm", "link": "https://stackoverflow.com/users/4057216/mmm"}, "edited": false, "score": 0, "creation_date": 1560947434, "post_id": 56667263, "comment_id": 99903113, "body": "Yes, I am compiling with g++, I have tried linking libstdc++ but it is not working."}, {"owner": {"reputation": 2298, "user_id": 6427477, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oYQ8Y.png?s=128&g=1", "display_name": "C.M.", "link": "https://stackoverflow.com/users/6427477/c-m"}, "edited": false, "score": 0, "creation_date": 1560953131, "post_id": 56667263, "comment_id": 99906765, "body": "<a href=\"https://en.cppreference.com/w/cpp/memory/new/operator_delete\" rel=\"nofollow noreferrer\">this</a>? (see cases 5 and 6)"}], "owner": {"reputation": 67, "user_id": 4057216, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba24fd5be3dd088adaf279da8b9ba49d?s=128&d=identicon&r=PG&f=1", "display_name": "mmm", "link": "https://stackoverflow.com/users/4057216/mmm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3105, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1560945943, "creation_date": 1560945943, "question_id": 56667263, "link": "https://stackoverflow.com/questions/56667263/undefined-reference-to-operator-deletevoid-unsigned-long", "title": "undefined reference to `operator delete(void*, unsigned long)&#39;", "body": "<p>I am getting lots of undefined reference to `operator delete(void*, unsigned long)' linking error's while building our c++ code with the gcc 8.2 on RHEL7, earlier we ware building with the gcc 4.8 and it was building fine.</p>\n\n<pre><code> ~Destructor()\n    {\n        delete PointerToDynamicallyAllacatedAnotherClassObject;\n    }\n</code></pre>\n\n<p>Linker Error: undefined reference to `operator delete(void*, unsigned long)'</p>\n"}, {"tags": ["c++", "security", "winapi", "teamviewer"], "comments": [{"owner": {"reputation": 8766, "user_id": 451321, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/7Sdao.jpg?s=128&g=1", "display_name": "Michael Chourdakis", "link": "https://stackoverflow.com/users/451321/michael-chourdakis"}, "edited": false, "score": 0, "creation_date": 1560945956, "post_id": 56667231, "comment_id": 99902308, "body": "SendInput() function?"}, {"owner": {"reputation": 570607, "user_id": 505088, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/3c0aac2191718ef0309dbc034d9b9961?s=128&d=identicon&r=PG", "display_name": "David Heffernan", "link": "https://stackoverflow.com/users/505088/david-heffernan"}, "edited": false, "score": 2, "creation_date": 1560948948, "post_id": 56667231, "comment_id": 99904084, "body": "No, not SendInput"}, {"owner": {"reputation": 570607, "user_id": 505088, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/3c0aac2191718ef0309dbc034d9b9961?s=128&d=identicon&r=PG", "display_name": "David Heffernan", "link": "https://stackoverflow.com/users/505088/david-heffernan"}, "edited": false, "score": 1, "creation_date": 1560948979, "post_id": 56667231, "comment_id": 99904098, "body": "@lorand there is open source remote sotware, what does it do?"}, {"owner": {"reputation": 8766, "user_id": 451321, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/7Sdao.jpg?s=128&g=1", "display_name": "Michael Chourdakis", "link": "https://stackoverflow.com/users/451321/michael-chourdakis"}, "edited": false, "score": 0, "creation_date": 1560956483, "post_id": 56667231, "comment_id": 99908891, "body": "In my own app which uses <a href=\"https://docs.microsoft.com/en-us/windows/desktop/api/rdpencomapi/nn-rdpencomapi-irdpsrapisharingsession\" rel=\"nofollow noreferrer\">Sharing Session</a>  there is a send keystroke API."}, {"owner": {"reputation": 570607, "user_id": 505088, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/3c0aac2191718ef0309dbc034d9b9961?s=128&d=identicon&r=PG", "display_name": "David Heffernan", "link": "https://stackoverflow.com/users/505088/david-heffernan"}, "reply_to_user": {"reputation": 8766, "user_id": 451321, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/7Sdao.jpg?s=128&g=1", "display_name": "Michael Chourdakis", "link": "https://stackoverflow.com/users/451321/michael-chourdakis"}, "edited": false, "score": 1, "creation_date": 1561008209, "post_id": 56667231, "comment_id": 99925003, "body": "@michael It is well known that the SAS can&#39;t be generated by faking input"}, {"owner": {"reputation": 820, "user_id": 1611543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1b5dfd5323c06552bcb9dce6ddf7feb?s=128&d=identicon&r=PG", "display_name": "Lorlin", "link": "https://stackoverflow.com/users/1611543/lorlin"}, "reply_to_user": {"reputation": 570607, "user_id": 505088, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/3c0aac2191718ef0309dbc034d9b9961?s=128&d=identicon&r=PG", "display_name": "David Heffernan", "link": "https://stackoverflow.com/users/505088/david-heffernan"}, "edited": false, "score": 0, "creation_date": 1561018742, "post_id": 56667231, "comment_id": 99929458, "body": "@David Heffernan - more precisely?"}, {"owner": {"reputation": 8787, "user_id": 6601582, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd0a2f69702729da5aaa628bc58811a7?s=128&d=identicon&r=PG&f=1", "display_name": "Rita Han", "link": "https://stackoverflow.com/users/6601582/rita-han"}, "edited": false, "score": 1, "creation_date": 1561364689, "post_id": 56667231, "comment_id": 100024264, "body": "@Lorlin Please check <a href=\"https://stackoverflow.com/questions/597959/sending-the-message-ctrlaltdel-from-my-application\">this thread</a>. It seems using an API of SASLib that is not public."}, {"owner": {"reputation": 1239, "user_id": 4452971, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/og0oX.png?s=128&g=1", "display_name": "Castorix", "link": "https://stackoverflow.com/users/4452971/castorix"}, "edited": false, "score": 2, "creation_date": 1563202029, "post_id": 56667231, "comment_id": 100612071, "body": "I just tested with <b>UiAutomation</b>.. It works (at least on my OS ( <i>Windows 10 - 1803, 17134.829</i> )), but it is not the best method..."}], "answers": [{"tags": [], "owner": {"reputation": 820, "user_id": 1611543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1b5dfd5323c06552bcb9dce6ddf7feb?s=128&d=identicon&r=PG", "display_name": "Lorlin", "link": "https://stackoverflow.com/users/1611543/lorlin"}, "is_accepted": false, "score": 1, "last_activity_date": 1561549920, "last_edit_date": 1561549920, "creation_date": 1561535109, "answer_id": 56767732, "question_id": 56667231, "link": "https://stackoverflow.com/questions/56667231/how-teamviewer-simulates-ctrl-alt-del-on-windows-programmatically/56767732#56767732", "title": "How TeamViewer simulates Ctrl-Alt-Del on Windows programmatically?", "body": "<p>I found out, that there is an undocumented <em>Secure Desktop LRPC Interface</em> aka. <em>Winlogon RPC Interface</em> used by the Windows components themselves and some third party libraries as well. Here is everything I got about it:</p>\n\n<ul>\n<li><a href=\"https://www.microsoftpressstore.com/articles/article.aspx?p=2228450&amp;seqNum=8\" rel=\"nofollow noreferrer\">Internals of SAS implementation</a> from Mark E. Russinovich book gives a very good overview what is happening behind the scenes</li>\n<li>Two obscure sites give some details about the interface itself, but for me this is too little to use them. (<a href=\"http://redplait.blogspot.com/2010/11/winlogonexe-rpc-interfaces.html\" rel=\"nofollow noreferrer\">Link 1</a>, <a href=\"https://gist.github.com/masthoon/510dd757b21f04da47431e9d4e0a3f6e\" rel=\"nofollow noreferrer\">Link 2</a>)</li>\n</ul>\n"}], "owner": {"reputation": 820, "user_id": 1611543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1b5dfd5323c06552bcb9dce6ddf7feb?s=128&d=identicon&r=PG", "display_name": "Lorlin", "link": "https://stackoverflow.com/users/1611543/lorlin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1111, "favorite_count": 1, "answer_count": 1, "score": 8, "last_activity_date": 1562864334, "creation_date": 1560945832, "last_edit_date": 1562864334, "question_id": 56667231, "link": "https://stackoverflow.com/questions/56667231/how-teamviewer-simulates-ctrl-alt-del-on-windows-programmatically", "title": "How TeamViewer simulates Ctrl-Alt-Del on Windows programmatically?", "body": "<p>How TeamViewer and other remote control software simulate the Alt-Ctr-Del keypress, also known as the Windows Secure Attention Sequence (SAS)?</p>\n\n<ol>\n<li>Many forums state that this is not possible, but the facts are against them. :)</li>\n<li><a href=\"https://docs.microsoft.com/en-us/windows/desktop/api/sas/nf-sas-sendsas\" rel=\"nofollow noreferrer\">SendSAS</a> function looks the most obvious answer, but that requires Group Policy changes, <a href=\"https://en.wikipedia.org/wiki/User_Interface_Privilege_Isolation\" rel=\"nofollow noreferrer\">UIPI bypass</a>, etc. so it's definitely not what that the run-only TeamViewer does.</li>\n<li>Another common suggestion is using the proprietary SasLibEx library, but that is discontinued and <a href=\"https://www.remkoweijnen.nl/blog/2008/12/23/locking-a-workstation-part-2/\" rel=\"nofollow noreferrer\">works only up to Windows Vista</a>.</li>\n<li><a href=\"https://stackoverflow.com/questions/5047344/net-simulate-ctrlaltdel-sendkeys\">An old Stackoverflow answer</a> has a near miss, but it does not work with newer Windows</li>\n<li><code>SendInput</code> does not work for Alt-Ctrl-Del, neither if it is sent to <code>winsta0\\winlogon</code> desktop</li>\n<li><code>PostMessage(HWND_BROADCAST, WM_HOTKEY, 0, MAKELONG( MOD_CONTROL | MOD_ALT, VK_DELETE));</code> - nope</li>\n<li><a href=\"http://www.atelierweb.com/ctrlaltdel/\" rel=\"nofollow noreferrer\">WmsgSendMessage</a> was tried on the next man's suggestion, it proved no better or different than SendSAS.</li>\n<li><a href=\"https://github.com/microsoft/Windows-driver-samples/tree/master/input/kbfiltr\" rel=\"nofollow noreferrer\">Keyboard filter drivers</a> could be a solution, but they need code signing and special privileges to install, and implementing them is neither for the faint hearted. I also verified with <code>driverquery</code> that the run-only Team Viewer does not install drivers.</li>\n</ol>\n\n<p><strong>So, any idea how others do it?</strong></p>\n\n<p>The <a href=\"https://www.microsoftpressstore.com/articles/article.aspx?p=2228450&amp;seqNum=8\" rel=\"nofollow noreferrer\">Internals of SAS implementation</a> gives a good overview of what it is happening behind the scenes.</p>\n"}, {"tags": ["c++", "c", "json", "file", "elasticsearch"], "comments": [{"owner": {"reputation": 163519, "user_id": 4604579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/reC2t.jpg?s=128&g=1", "display_name": "Val", "link": "https://stackoverflow.com/users/4604579/val"}, "edited": false, "score": 0, "creation_date": 1560946139, "post_id": 56667128, "comment_id": 99902388, "body": "Elasticdump is the solution here. See this answer: <a href=\"https://stackoverflow.com/a/40778254/4604579\">stackoverflow.com/a/40778254/4604579</a>"}, {"owner": {"reputation": 35, "user_id": 11670131, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed7bac3e904b3b0e37b23047f727e17b?s=128&d=identicon&r=PG&f=1", "display_name": "Varuzhan", "link": "https://stackoverflow.com/users/11670131/varuzhan"}, "reply_to_user": {"reputation": 163519, "user_id": 4604579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/reC2t.jpg?s=128&g=1", "display_name": "Val", "link": "https://stackoverflow.com/users/4604579/val"}, "edited": false, "score": 0, "creation_date": 1560946455, "post_id": 56667128, "comment_id": 99902573, "body": "@Val it is using another tool to get it. I want to use c++ commands to get it."}, {"owner": {"reputation": 163519, "user_id": 4604579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/reC2t.jpg?s=128&g=1", "display_name": "Val", "link": "https://stackoverflow.com/users/4604579/val"}, "edited": false, "score": 0, "creation_date": 1560946542, "post_id": 56667128, "comment_id": 99902619, "body": "How about using the <code>system()</code> call in C++ to run the <code>elasticdump</code> command?"}, {"owner": {"reputation": 35, "user_id": 11670131, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed7bac3e904b3b0e37b23047f727e17b?s=128&d=identicon&r=PG&f=1", "display_name": "Varuzhan", "link": "https://stackoverflow.com/users/11670131/varuzhan"}, "reply_to_user": {"reputation": 163519, "user_id": 4604579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/reC2t.jpg?s=128&g=1", "display_name": "Val", "link": "https://stackoverflow.com/users/4604579/val"}, "edited": false, "score": 0, "creation_date": 1560946756, "post_id": 56667128, "comment_id": 99902739, "body": "@Val elasticdump is a command of this tool(<a href=\"https://github.com/taskrabbit/elasticsearch-dump\" rel=\"nofollow noreferrer\">github.com/taskrabbit/elasticsearch-dump</a>). I do not want to use this tool."}], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 11670131, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed7bac3e904b3b0e37b23047f727e17b?s=128&d=identicon&r=PG&f=1", "display_name": "Varuzhan", "link": "https://stackoverflow.com/users/11670131/varuzhan"}, "edited": false, "score": 0, "creation_date": 1560947918, "post_id": 56667534, "comment_id": 99903409, "body": "Thanks for help.But is it store data on disk in json format?"}], "tags": [], "owner": {"reputation": 163519, "user_id": 4604579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/reC2t.jpg?s=128&g=1", "display_name": "Val", "link": "https://stackoverflow.com/users/4604579/val"}, "is_accepted": true, "score": 0, "last_activity_date": 1560946928, "creation_date": 1560946928, "answer_id": 56667534, "question_id": 56667128, "link": "https://stackoverflow.com/questions/56667128/how-to-save-data-of-elasticsearch-in-format-of-json/56667534#56667534", "title": "How to save data of elasticsearch in format of json?", "body": "<p>You can use a C++ Elastic client, like <a href=\"https://seznam.github.io/elasticlient/\" rel=\"nofollow noreferrer\">this one</a>.</p>\n\n<p>You can then retrieve all your data in JSON by leveraging the <a href=\"https://seznam.github.io/elasticlient/classelasticlient_1_1Scroll.html\" rel=\"nofollow noreferrer\">scroll API</a>. Sample usage can be found <a href=\"https://github.com/seznam/elasticlient#usage-of-scroll-api\" rel=\"nofollow noreferrer\">here</a></p>\n"}], "owner": {"reputation": 35, "user_id": 11670131, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed7bac3e904b3b0e37b23047f727e17b?s=128&d=identicon&r=PG&f=1", "display_name": "Varuzhan", "link": "https://stackoverflow.com/users/11670131/varuzhan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 225, "favorite_count": 0, "closed_date": 1560989663, "accepted_answer_id": 56667534, "answer_count": 1, "score": 0, "last_activity_date": 1561101672, "creation_date": 1560945426, "last_edit_date": 1561101672, "question_id": 56667128, "link": "https://stackoverflow.com/questions/56667128/how-to-save-data-of-elasticsearch-in-format-of-json", "closed_reason": "Needs details or clarity", "title": "How to save data of elasticsearch in format of json?", "body": "<p>I want to get document from elasticsearch and save it in format of json. This I need in my c++ code.Searching in the web I have found a command:</p>\n\n<blockquote>\n  <p>curl -XGET 'localhost:9200/</p>\n</blockquote>\n\n<p>But I need to get data in json format, store it and then work with it in my c++ code. </p>\n\n<p>I think I must use curl.h library.</p>\n\n<p>But this is all that I know.\nHow can I do it?</p>\n"}, {"tags": ["c++", "qt", "qvariant"], "comments": [{"owner": {"reputation": 15619, "user_id": 1548468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0745dce203d52699e63a575b3103ad70?s=128&d=identicon&r=PG", "display_name": "Botje", "link": "https://stackoverflow.com/users/1548468/botje"}, "edited": false, "score": 0, "creation_date": 1560945088, "post_id": 56666955, "comment_id": 99901781, "body": "There is only an overload for <code>QList&lt;QVariant&gt;&amp;</code>, so you will need to transform your <code>QList&lt;CDataEntry&gt;</code> into a <code>QList&lt;QVariant</code> first."}, {"owner": {"reputation": 15619, "user_id": 1548468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0745dce203d52699e63a575b3103ad70?s=128&d=identicon&r=PG", "display_name": "Botje", "link": "https://stackoverflow.com/users/1548468/botje"}, "edited": false, "score": 0, "creation_date": 1560945173, "post_id": 56666955, "comment_id": 99901836, "body": "Possibly related: <a href=\"https://stackoverflow.com/questions/44436386/how-to-convert-qlistt-to-qvariant?rq=1\" title=\"how to convert qlistt to qvariant\">stackoverflow.com/questions/44436386/&hellip;</a>"}, {"owner": {"reputation": 2255, "user_id": 1036082, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/a291efdfec6f8802d64589cd992131fb?s=128&d=identicon&r=PG", "display_name": "\u0141ukasz Przenios\u0142o", "link": "https://stackoverflow.com/users/1036082/%c5%81ukasz-przenios%c5%82o"}, "reply_to_user": {"reputation": 15619, "user_id": 1548468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0745dce203d52699e63a575b3103ad70?s=128&d=identicon&r=PG", "display_name": "Botje", "link": "https://stackoverflow.com/users/1548468/botje"}, "edited": false, "score": 0, "creation_date": 1560945574, "post_id": 56666955, "comment_id": 99902071, "body": "Both of the provided solutions make the error dissapear, but then I get further errors: <code>C:\\Qt\\5.12.3\\mingw73_64\\include&#47;QtCore&#47;qmetatype.h:804:20: error: use of deleted function &#39;CDataEntry::CDataEntry(const CDataEntry&amp;)&#39;              return new (where) T(*static_cast&lt;const T*&gt;(t));</code> Do I need a default constructor or something?"}, {"owner": {"reputation": 15619, "user_id": 1548468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0745dce203d52699e63a575b3103ad70?s=128&d=identicon&r=PG", "display_name": "Botje", "link": "https://stackoverflow.com/users/1548468/botje"}, "edited": false, "score": 1, "creation_date": 1560945856, "post_id": 56666955, "comment_id": 99902252, "body": "Oh, missed that in your code. <a href=\"https://doc.qt.io/qt-5/qobject.html#no-copy-constructor-or-assignment-operator\" rel=\"nofollow noreferrer\">QObject has neither a copy constructor nor an assignment operator.</a>"}, {"owner": {"reputation": 2255, "user_id": 1036082, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/a291efdfec6f8802d64589cd992131fb?s=128&d=identicon&r=PG", "display_name": "\u0141ukasz Przenios\u0142o", "link": "https://stackoverflow.com/users/1036082/%c5%81ukasz-przenios%c5%82o"}, "reply_to_user": {"reputation": 15619, "user_id": 1548468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0745dce203d52699e63a575b3103ad70?s=128&d=identicon&r=PG", "display_name": "Botje", "link": "https://stackoverflow.com/users/1548468/botje"}, "edited": false, "score": 0, "creation_date": 1560945927, "post_id": 56666955, "comment_id": 99902288, "body": "So I need a default constructor and a copy constructor."}], "answers": [{"comments": [{"owner": {"reputation": 2255, "user_id": 1036082, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/a291efdfec6f8802d64589cd992131fb?s=128&d=identicon&r=PG", "display_name": "\u0141ukasz Przenios\u0142o", "link": "https://stackoverflow.com/users/1036082/%c5%81ukasz-przenios%c5%82o"}, "edited": false, "score": 0, "creation_date": 1560948038, "post_id": 56667456, "comment_id": 99903489, "body": "Can you provide the <code>operator=</code> body?"}, {"owner": {"reputation": 1830, "user_id": 1047746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82514a7e1e60593716e3460af8676a0d?s=128&d=identicon&r=PG", "display_name": "Xplatforms", "link": "https://stackoverflow.com/users/1047746/xplatforms"}, "reply_to_user": {"reputation": 2255, "user_id": 1036082, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/a291efdfec6f8802d64589cd992131fb?s=128&d=identicon&r=PG", "display_name": "\u0141ukasz Przenios\u0142o", "link": "https://stackoverflow.com/users/1036082/%c5%81ukasz-przenios%c5%82o"}, "edited": false, "score": 0, "creation_date": 1560948558, "post_id": 56667456, "comment_id": 99903834, "body": "@Bremen, it is empty {} but in your case it could look like this: CDataEntry&amp; operator=(const CDataEntry&amp; old)     {         this-&gt;m_nodePath = old.nodePath();         return *this;     }  But m_nodePath could not be const in class definition in this case."}, {"owner": {"reputation": 2255, "user_id": 1036082, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/a291efdfec6f8802d64589cd992131fb?s=128&d=identicon&r=PG", "display_name": "\u0141ukasz Przenios\u0142o", "link": "https://stackoverflow.com/users/1036082/%c5%81ukasz-przenios%c5%82o"}, "edited": false, "score": 0, "creation_date": 1560948674, "post_id": 56667456, "comment_id": 99903900, "body": "Yes, this is a problem. Will need to think this through."}], "tags": [], "owner": {"reputation": 1830, "user_id": 1047746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82514a7e1e60593716e3460af8676a0d?s=128&d=identicon&r=PG", "display_name": "Xplatforms", "link": "https://stackoverflow.com/users/1047746/xplatforms"}, "is_accepted": true, "score": 1, "last_activity_date": 1560946669, "creation_date": 1560946669, "answer_id": 56667456, "question_id": 56666955, "link": "https://stackoverflow.com/questions/56666955/store-qlistcustom-in-qvariant/56667456#56667456", "title": "Store QList&lt;Custom&gt; in QVariant", "body": "<p>You need to add default constructor, copy constructor and copy/assignment  operator to your QObject subclass.</p>\n\n<p>Like this:</p>\n\n<pre><code>CDataEntry&amp; operator=(const CDataEntry&amp;){}\nCDataEntry(QObject* parent = nullptr):QObject(parent){}\nCDataEntry(const CDataEntry&amp;){}\n//...\nCDataEntry(const QString&amp; np, QObject* parent = nullptr)\n</code></pre>\n\n<p>after that you can use it in QVariant like that:</p>\n\n<pre><code>    CDataEntry test;\n    QList&lt;CDataEntry&gt; list;    \n    list.append(test);\n\n    QVariant var = QVariant::fromValue&lt;QList&lt;CDataEntry&gt;&gt;( list );\n    auto t = var.value&lt;QList&lt;CDataEntry&gt;&gt;();\n    qDebug() &lt;&lt; t.first().nodePath();\n</code></pre>\n"}], "owner": {"reputation": 2255, "user_id": 1036082, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/a291efdfec6f8802d64589cd992131fb?s=128&d=identicon&r=PG", "display_name": "\u0141ukasz Przenios\u0142o", "link": "https://stackoverflow.com/users/1036082/%c5%81ukasz-przenios%c5%82o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 249, "favorite_count": 0, "accepted_answer_id": 56667456, "answer_count": 1, "score": 0, "last_activity_date": 1560946669, "creation_date": 1560944799, "question_id": 56666955, "link": "https://stackoverflow.com/questions/56666955/store-qlistcustom-in-qvariant", "title": "Store QList&lt;Custom&gt; in QVariant", "body": "<p>I have a class defined as this:</p>\n\n<p>cdataentry.h:</p>\n\n<pre><code>#ifndef CDATAENTRY_H\n#define CDATAENTRY_H\n\n#include &lt;QObject&gt;\n#include &lt;QString&gt;\n#include &lt;QVariant&gt;\n#include &lt;QtOpcUa&gt;\n#include &lt;QMetaType&gt;\n\n#include &lt;cnodetype.h&gt;\n#include &lt;cdatastatus.h&gt;\n\n/**\n * @brief   A class providing data and methods to describe a single OPCUA ua\n *          node in the user input table.\n */\nclass CDataEntry : public QObject\n{\n    Q_OBJECT\n\npublic:\n\n    CDataEntry(const QString&amp; np, QObject* parent = nullptr);\n    ~CDataEntry();\n\n    QString nodePath() const;\n\nprivate:\n\n    /**\n     * @brief   Obsolute path to the node on the MDE server\n     */\n    const QString m_nodePath;\n\n};\n\nQ_DECLARE_METATYPE(CDataEntry); // to be able to store it in QVariant.\n\n#endif // CDATAENTRY_H\n</code></pre>\n\n<p>I am trying to store a <code>QList&lt;CDataEntry&gt;</code> object in a <code>QVariant</code>. For that end, I have provided the <code>Q_DECLARE_METATYPE(CDataEntry);</code>\nThe problem is that the code doesnt compile, what I get is:</p>\n\n<pre><code>error: no matching function for call to 'QVariant::QVariant(QList&lt;CDataEntry&gt;&amp;)'\n</code></pre>\n\n<p>What am I missing here?</p>\n"}, {"tags": ["c++", "publish-subscribe", "ignite"], "answers": [{"tags": [], "owner": {"reputation": 17487, "user_id": 36498, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/040b73282faf88b2eea3dc64507339c0?s=128&d=identicon&r=PG", "display_name": "alamar", "link": "https://stackoverflow.com/users/36498/alamar"}, "is_accepted": false, "score": 1, "last_activity_date": 1561035310, "creation_date": 1561035310, "answer_id": 56686473, "question_id": 56666649, "link": "https://stackoverflow.com/questions/56666649/does-ignite-c-client-support-publish-subscribe/56686473#56686473", "title": "Does ignite C++ client support publish subscribe", "body": "<p><a href=\"https://apacheignite-cpp.readme.io/docs/continuous-queries\" rel=\"nofollow noreferrer\">Apache Ignite C++ supports Continuous Queries</a> which let you subscribe to updates on a cache, get called back when data is published to that cache.</p>\n"}], "owner": {"reputation": 229, "user_id": 3956846, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b24ac1493497986f81e66001cf2980a3?s=128&d=identicon&r=PG&f=1", "display_name": "Nidhin MS", "link": "https://stackoverflow.com/users/3956846/nidhin-ms"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1561035310, "creation_date": 1560943704, "question_id": 56666649, "link": "https://stackoverflow.com/questions/56666649/does-ignite-c-client-support-publish-subscribe", "title": "Does ignite C++ client support publish subscribe", "body": "<p>I am currently reading input from an ignite cache using C++ client.\nFor performance improvements I am trying to switch to pub sub model. But I was unable to find documentation about pub sub mechanism using C++ api.</p>\n\n<p>Does ignite C++ support publish subscribe mechanism</p>\n"}, {"tags": ["c++", "opencv", "ros"], "comments": [{"owner": {"reputation": 2568, "user_id": 8548828, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C4qkl.png?s=128&g=1", "display_name": "Tarick Welling", "link": "https://stackoverflow.com/users/8548828/tarick-welling"}, "edited": false, "score": 0, "creation_date": 1560943103, "post_id": 56666338, "comment_id": 99900624, "body": "which of those includes creates the problem? <code>opencv</code> or <code>flair</code>"}, {"owner": {"reputation": 3213, "user_id": 6084430, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/B0TaE.jpg?s=128&g=1", "display_name": "DimChtz", "link": "https://stackoverflow.com/users/6084430/dimchtz"}, "edited": false, "score": 0, "creation_date": 1560943920, "post_id": 56666338, "comment_id": 99901113, "body": "<code>DescriptionMatcher</code> is in <code>features2d.hpp</code> Try to inlcude: <code>#include &quot;opencv2&#47;core.hpp&quot;</code> and <code>#include &quot;opencv2&#47;features2d.hpp&quot;</code>"}, {"owner": {"reputation": 1288, "user_id": 6470918, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/2ff387fcec6f17ed29d33030643efeb8?s=128&d=identicon&r=PG&f=1", "display_name": "Grzegorz Brz\u0119czyszczykiewicz", "link": "https://stackoverflow.com/users/6470918/grzegorz-brz%c4%99czyszczykiewicz"}, "reply_to_user": {"reputation": 2568, "user_id": 8548828, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C4qkl.png?s=128&g=1", "display_name": "Tarick Welling", "link": "https://stackoverflow.com/users/8548828/tarick-welling"}, "edited": false, "score": 0, "creation_date": 1560944220, "post_id": 56666338, "comment_id": 99901283, "body": "@TarickWelling flair"}, {"owner": {"reputation": 1288, "user_id": 6470918, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/2ff387fcec6f17ed29d33030643efeb8?s=128&d=identicon&r=PG&f=1", "display_name": "Grzegorz Brz\u0119czyszczykiewicz", "link": "https://stackoverflow.com/users/6470918/grzegorz-brz%c4%99czyszczykiewicz"}, "reply_to_user": {"reputation": 3213, "user_id": 6084430, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/B0TaE.jpg?s=128&g=1", "display_name": "DimChtz", "link": "https://stackoverflow.com/users/6084430/dimchtz"}, "edited": false, "score": 0, "creation_date": 1560944528, "post_id": 56666338, "comment_id": 99901448, "body": "@DimChtz check out my edited question"}, {"owner": {"reputation": 3213, "user_id": 6084430, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/B0TaE.jpg?s=128&g=1", "display_name": "DimChtz", "link": "https://stackoverflow.com/users/6084430/dimchtz"}, "edited": false, "score": 0, "creation_date": 1560959456, "post_id": 56666338, "comment_id": 99910737, "body": "@GrzegorzBrz\u0119czyszczykiewicz Yeah, just noticed that flair includes: <code>opencv2&#47;opencv.hpp</code>. Which means you only need to include flair and select features2d module during building. Alternatively, you could remove the include line from flair.hpp and then include manually: <code>opencv2&#47;core.hpp</code>, <code>opencv2&#47;highgui.hpp</code>, <code>opencv2&#47;features2d.hpp</code> and finally <code>flair.hpp</code> ."}, {"owner": {"reputation": 1288, "user_id": 6470918, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/2ff387fcec6f17ed29d33030643efeb8?s=128&d=identicon&r=PG&f=1", "display_name": "Grzegorz Brz\u0119czyszczykiewicz", "link": "https://stackoverflow.com/users/6470918/grzegorz-brz%c4%99czyszczykiewicz"}, "reply_to_user": {"reputation": 3213, "user_id": 6084430, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/B0TaE.jpg?s=128&g=1", "display_name": "DimChtz", "link": "https://stackoverflow.com/users/6084430/dimchtz"}, "edited": false, "score": 0, "creation_date": 1560961375, "post_id": 56666338, "comment_id": 99911622, "body": "@DimChtz I&#39;ve changed it so now flair.hpp doesn&#39;t include anything, and my file includes: #include &quot;opencv2/core.hpp&quot; #include &quot;opencv2/highgui.hpp&quot; #include &quot;opencv2/features2d.hpp&quot; #include &quot;flair.hpp&quot; but I got so many errors that they do not even fit in the console."}], "owner": {"reputation": 1288, "user_id": 6470918, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/2ff387fcec6f17ed29d33030643efeb8?s=128&d=identicon&r=PG&f=1", "display_name": "Grzegorz Brz\u0119czyszczykiewicz", "link": "https://stackoverflow.com/users/6470918/grzegorz-brz%c4%99czyszczykiewicz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 73, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1560944509, "creation_date": 1560942714, "last_edit_date": 1560944509, "question_id": 56666338, "link": "https://stackoverflow.com/questions/56666338/running-opencv-code-in-ros-error-descriptormatcher-was-not-declared-in-this", "title": "Running OpenCV code in ROS- error: \u2018DescriptorMatcher\u2019 was not declared in this scope", "body": "<p>I have installed the OpenCV on my machine along with the <code>opencv_bridge</code>. I am trying to use this script in my ROS package:</p>\n\n<p><a href=\"https://github.com/spillai/recognition-utils/blob/master/FLAIR/flair.hpp\" rel=\"nofollow noreferrer\">https://github.com/spillai/recognition-utils/blob/master/FLAIR/flair.hpp</a></p>\n\n<p>The problem is that when I include it in my file (like this):</p>\n\n<pre><code>#include \"opencv2/core/version.hpp\"\n#include \"flair.hpp\"\n</code></pre>\n\n<p>I am getting this error:</p>\n\n<pre><code>/home/osboxes/catkin_ws/src/cipek/src/flair.hpp:71:11: error: \u2018DescriptorMatcher\u2019 was not declared in this scope\n   cv::Ptr&lt;DescriptorMatcher&gt; _matcher;\n</code></pre>\n\n<p>There are many more errors which follow this one, but I don't want to put it all here, because it is long, unless someone needs it. I haven't modified the file from the GitHub repository. How can I fix this issue? </p>\n\n<p>EDIT</p>\n\n<p>After adding:</p>\n\n<pre><code>#include \"opencv2/core.hpp\"\n#include \"opencv2/features2d.hpp\"\n</code></pre>\n\n<p>To <code>flair.hpp</code> file, I am getting this error:</p>\n\n<pre><code>In file included from /usr/local/include/opencv2/core.hpp:52:0,\n             from /home/osboxes/catkin_ws/src/cipek/src/flair.hpp:23,\n             from /home/osboxes/catkin_ws/src/cipek/src/ardrone_test_CPP.cpp:8:\n/usr/local/include/opencv2/core/cvdef.h:234:15: error: redefinition of \u2018union Cv32suf\u2019\n typedef union Cv32suf\n</code></pre>\n"}, {"tags": ["c++", "templates", "c++17", "metaprogramming"], "comments": [{"owner": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "edited": false, "score": 2, "creation_date": 1560942254, "post_id": 56665977, "comment_id": 99900159, "body": "I don&#39;t think you can match a template of unknown signature against anything (except concrete instantiations of course). You can have template template parameters but only for known template signatures. You similarly can&#39;t match a function template against anything (except, again, something that deduces the instantiation to use). But I&#39;d be happy to be proven wrong."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 6, "creation_date": 1560942475, "post_id": 56665977, "comment_id": 99900282, "body": "It looks like this is impossible."}, {"owner": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "edited": false, "score": 3, "creation_date": 1560942710, "post_id": 56665977, "comment_id": 99900407, "body": "In other words, the issue here is first and foremost the lack of an &quot;interface&quot; for passing arbitrary templates (or function templates) to such a &quot;tester&quot;. If each template to be tested was wrapped in a type (and had a fixed name in that type - compare <code>operator()</code> for functors) then things would look differently, because then you could pass these templates around (and not just their instantiations). But as it stands you&#39;ve arrived at one of the limitations of the C++ templating system."}, {"owner": {"reputation": 3936, "user_id": 1675804, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f375fecf87753c214d732aaa119d59c6?s=128&d=identicon&r=PG", "display_name": "xception", "link": "https://stackoverflow.com/users/1675804/xception"}, "edited": false, "score": 0, "creation_date": 1560946053, "post_id": 56665977, "comment_id": 99902347, "body": "not sure if I understood the question correctly, but is what you&#39;re asking the same thing as the <code>is_any</code> template function answer to <a href=\"https://stackoverflow.com/questions/17032310/how-to-make-a-variadic-is-same\">this other question</a>?"}, {"owner": {"reputation": 245138, "user_id": 2069064, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/e4V2X.jpg?s=128&g=1", "display_name": "Barry", "link": "https://stackoverflow.com/users/2069064/barry"}, "edited": false, "score": 2, "creation_date": 1560946722, "post_id": 56665977, "comment_id": 99902720, "body": "Note that this approach fails if you have multiple options, e.g. <code>static_assert(Pack&lt;Tmpl&lt;1&gt;, int, Tmpl&lt;2&gt;&gt;::has_tmpl&lt;Tmpl&gt;());</code>"}, {"owner": {"reputation": 2077, "user_id": 4694124, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c4e2b18d7cefdae9b599a884d2ae4e4c?s=128&d=identicon&r=PG", "display_name": "Lukas Barth", "link": "https://stackoverflow.com/users/4694124/lukas-barth"}, "reply_to_user": {"reputation": 3936, "user_id": 1675804, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f375fecf87753c214d732aaa119d59c6?s=128&d=identicon&r=PG", "display_name": "xception", "link": "https://stackoverflow.com/users/1675804/xception"}, "edited": false, "score": 0, "creation_date": 1560951136, "post_id": 56665977, "comment_id": 99905489, "body": "@xception: No, that <code>is_any</code> only works for classes, not templates, right?"}, {"owner": {"reputation": 3936, "user_id": 1675804, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f375fecf87753c214d732aaa119d59c6?s=128&d=identicon&r=PG", "display_name": "xception", "link": "https://stackoverflow.com/users/1675804/xception"}, "edited": false, "score": 0, "creation_date": 1560954022, "post_id": 56665977, "comment_id": 99907314, "body": "works for classes as well as templated classes, but not templates with a undefined type if that&#39;s what you&#39;re looking for..."}, {"owner": {"reputation": 23130, "user_id": 8586227, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BRnwg.png?s=128&g=1", "display_name": "Davis Herring", "link": "https://stackoverflow.com/users/8586227/davis-herring"}, "reply_to_user": {"reputation": 245138, "user_id": 2069064, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/e4V2X.jpg?s=128&g=1", "display_name": "Barry", "link": "https://stackoverflow.com/users/2069064/barry"}, "edited": false, "score": 0, "creation_date": 1560957698, "post_id": 56665977, "comment_id": 99909699, "body": "@Barry: It should be pretty easy to repair it by declaring each function template in an indirect base class instantiated with the class template detected via partial specialization."}], "answers": [{"comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1560963891, "post_id": 56671366, "comment_id": 99912661, "body": "OP wants to be able to check against <code>template&lt;int&gt; struct Baz{};</code>."}, {"owner": {"reputation": 768, "user_id": 10765031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19818c272f28b0be58edab2373192e34?s=128&d=identicon&r=PG&f=1", "display_name": "fdan", "link": "https://stackoverflow.com/users/10765031/fdan"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1560970386, "post_id": 56671366, "comment_id": 99915656, "body": "ah I see. you could easily make this work with non-type template params, but it won&#39;t work with types and non-types mixed. not flexible enough, my bad."}], "tags": [], "owner": {"reputation": 768, "user_id": 10765031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19818c272f28b0be58edab2373192e34?s=128&d=identicon&r=PG&f=1", "display_name": "fdan", "link": "https://stackoverflow.com/users/10765031/fdan"}, "is_accepted": false, "score": 1, "last_activity_date": 1560958478, "creation_date": 1560958478, "answer_id": 56671366, "question_id": 56665977, "link": "https://stackoverflow.com/questions/56665977/c17-generic-multiple-inheritance-based-check-for-template-in-parameter-pac/56671366#56671366", "title": "C++17: Generic (multiple-inheritance based?) check for template in parameter pack", "body": "<p>I hope this is what you are looking for (I implemented the <code>Pack</code> class, without testing your inheritance \"trick\").</p>\n\n<pre><code>#include &lt;type_traits&gt;\n\n// just for testing\ntemplate &lt;typename... Ts&gt; struct Foo {};\ntemplate &lt;typename... Ts&gt; struct Bar {};\n\n// compare templates\ntemplate &lt;template &lt;typename...&gt; typename, typename&gt;\nstruct is_same : std::false_type {};\n\ntemplate &lt;template &lt;typename...&gt; typename T, typename... Ts&gt;\nstruct is_same&lt;T, T&lt;Ts...&gt;&gt; : std::true_type {};\n\n// find templates in list\ntemplate &lt;template &lt;typename...&gt; typename T, typename... Pack&gt;\nstruct searcher\n    : std::integral_constant&lt;bool, std::disjunction_v&lt;is_same&lt;T, Pack&gt;...&gt;&gt; {};\n\n// your class (only template params changed)\ntemplate &lt;class... Ts&gt;\nstruct Pack {\n  template &lt;template &lt;typename...&gt; class T&gt;\n  static constexpr bool has_tmpl() {\n    return searcher&lt;T, Ts...&gt;::value;\n  }\n};\n\nint main() {\n  static_assert(Pack&lt;int, long, Foo&lt;int&gt;&gt;::has_tmpl&lt;Foo&gt;());\n  static_assert(Pack&lt;int, long, Foo&lt;int, short&gt;&gt;::has_tmpl&lt;Foo&gt;());\n  static_assert(Pack&lt;int, long, Foo&lt;int, short, long&gt;&gt;::has_tmpl&lt;Foo&gt;());\n\n  static_assert(!Pack&lt;int, long, long&gt;::has_tmpl&lt;Foo&gt;());\n  static_assert(!Pack&lt;int, long, Bar&lt;int&gt;&gt;::has_tmpl&lt;Foo&gt;());\n  static_assert(!Pack&lt;int, long, Bar&lt;int, short&gt;&gt;::has_tmpl&lt;Foo&gt;());\n  static_assert(!Pack&lt;int, long, Bar&lt;int, short, long&gt;&gt;::has_tmpl&lt;Foo&gt;());\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 10203, "user_id": 4672588, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edcbc85fb3b43202dab37afb2bd5281e?s=128&d=identicon&r=PG&f=1", "display_name": "cpplearner", "link": "https://stackoverflow.com/users/4672588/cpplearner"}, "is_accepted": true, "score": 3, "last_activity_date": 1560987911, "creation_date": 1560987911, "answer_id": 56677266, "question_id": 56665977, "link": "https://stackoverflow.com/questions/56665977/c17-generic-multiple-inheritance-based-check-for-template-in-parameter-pac/56677266#56677266", "title": "C++17: Generic (multiple-inheritance based?) check for template in parameter pack", "body": "<p>As @MaxLanghof mentioned in comments, it's not even possible to declare a <code>has_tmpl</code> that accept arbitrary kinds of templates. It's possible to have overloads of <code>has_tmpl</code> with different template parameters (<code>template&lt;std::size_t&gt; class</code>, <code>template&lt;std::size_t, typename&gt; class</code>, <code>template &lt;typename, typename&gt; class</code>, etc), but an infinite number of overloads are needed.</p>\n\n<p>Instead, let's use a type that wraps the template, and expose everything we need. The simplest way AFAIK is (ab)using a lambda: <code>[]&lt;std::size_t I&gt;(type_identity&lt;Tmpl&lt;I&gt;&gt;){}</code>.</p>\n\n<p>And then the problem is almost trivial: <code>has_tmpl</code> can be simply defined to return <code>(std::is_invocable_v&lt;Lambda,type_identity&lt;Ts&gt;&gt; || ...)</code>.</p>\n\n<p>Complete example:</p>\n\n<pre><code>#include &lt;type_traits&gt;\n\ntemplate&lt;class&gt; struct type_identity {};\n\ntemplate &lt;class... Ts&gt;\nstruct Pack\n{\n    template&lt;class Lambda&gt;\n    static constexpr bool has_tmpl(Lambda) {\n        return (std::is_invocable_v&lt;Lambda, type_identity&lt;Ts&gt;&gt; || ...);\n    }\n};\n\ntemplate&lt;std::size_t I&gt;\nclass Tmpl {};\n\nint main() {\n    static_assert(Pack&lt;Tmpl&lt;1&gt;, int&gt;::has_tmpl([]&lt;std::size_t I&gt;(type_identity&lt;Tmpl&lt;I&gt;&gt;){}));\n    static_assert(!Pack&lt;int&gt;::has_tmpl([]&lt;std::size_t I&gt;(type_identity&lt;Tmpl&lt;I&gt;&gt;){}));\n}\n</code></pre>\n\n<p>Note that this uses a GNU extension that is standardized in C++20 (template-parameter-list for generic lambdas). I don't think this is avoidable.</p>\n\n<p>It should be possible to use multiple inheritance, but fold expression is much shorter ;)</p>\n"}], "owner": {"reputation": 2077, "user_id": 4694124, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c4e2b18d7cefdae9b599a884d2ae4e4c?s=128&d=identicon&r=PG", "display_name": "Lukas Barth", "link": "https://stackoverflow.com/users/4694124/lukas-barth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 339, "favorite_count": 1, "accepted_answer_id": 56677266, "answer_count": 2, "score": 9, "last_activity_date": 1560987911, "creation_date": 1560941547, "last_edit_date": 1560946530, "question_id": 56665977, "link": "https://stackoverflow.com/questions/56665977/c17-generic-multiple-inheritance-based-check-for-template-in-parameter-pac", "title": "C++17: Generic (multiple-inheritance based?) check for template in parameter pack", "body": "<p>I need some code to check whether a certain template is part of a parameter pack. To implement the check for normal classes, I use the multiple-inheritance based approach outlined e.g. by <a href=\"http://ldionne.com/2015/11/29/efficient-parameter-pack-indexing/\" rel=\"nofollow noreferrer\">Louis Dionne here</a> or <a href=\"http://talesofcpp.fusionfenix.com/post-22/true-story-efficient-packing\" rel=\"nofollow noreferrer\">Agust\u00edn Berg\u00e9 here</a>. </p>\n\n<h1>Testing for a Class</h1>\n\n<p>The idea is that you wrap every class <code>T</code> in the pack in an <code>PackEntry</code> class, and then have <code>PackIndex</code> inherit from all <code>PackEntry</code> classes. This way, if you are looking for a class <code>A</code>, all you need to do is check if a <code>PackIndex</code> can be converted to the correct <code>PackEntry</code>. Throwing everything together, it looks like this:</p>\n\n<pre><code>#include &lt;cstddef&gt;\n#include &lt;utility&gt;\n\ntemplate &lt;class T&gt;\nstruct PackEntry\n{\n    using type = T;\n};\n\ntemplate &lt;class... Ts&gt;\nstruct PackIndex : PackEntry&lt;Ts&gt;...\n{};\n\ntemplate &lt;class T, class... Ts&gt;\nstruct PackSearcher\n{\n    static constexpr std::false_type check(...);\n\n    // This overload is used if the PackIndex below \n    // derives from PackEntry&lt;T&gt;, the overload above \n    // otherwise. \n    static constexpr std::true_type check(PackEntry&lt;T&gt;);\n\n    using type =\n        decltype(check(PackIndex&lt;Ts...&gt;{}));\n\n    static constexpr bool\n    value()\n    {\n        return type{};\n    }\n};\n\ntemplate &lt;class... Ts&gt;\nstruct Pack\n{\n    template&lt;class T&gt;\n    static constexpr bool has() {\n        return PackSearcher&lt;T, Ts...&gt;::value();\n    }\n};\n\nint main() {\n    static_assert(Pack&lt;int, void&gt;::has&lt;int&gt;());\n    static_assert(! Pack&lt;int, void&gt;::has&lt;bool&gt;());\n}\n</code></pre>\n\n<h1>Testing for a Specific Template</h1>\n\n<p>Now, this is all neat, but say that I have a template <code>Tmpl</code>, and I want to know whether my pack contains <em>any</em> specialization of that template. I's easy to do if the template has a specific form, say <code>template &lt;std::size_t&gt; class Tmpl {};</code> Basically, the only difference is that inside the <code>PackSearcher</code> (which I now call <code>TmplPackSearcher</code>, you make the compiler derive the correct <code>N</code> template parameter for the template.</p>\n\n<pre><code>#include &lt;cstddef&gt;\n#include &lt;utility&gt;\n\ntemplate &lt;class T&gt;\nstruct PackEntry\n{\n    using type = T;\n};\n\ntemplate &lt;class... Ts&gt;\nstruct PackIndex : PackEntry&lt;Ts&gt;...\n{\n};\n\ntemplate &lt;template &lt;std::size_t&gt; class T, class... Ts&gt;\nstruct TmplPackSearcher\n{ \n    static constexpr std::false_type check(...);\n\n    template &lt;std::size_t N&gt;\n    static constexpr std::true_type check(PackEntry&lt;T&lt;N&gt;&gt;);\n\n    using type =\n        decltype(check(PackIndex&lt;Ts...&gt;{}));\n\n    static constexpr bool\n    value()\n    {\n        return type{};\n    }\n};\n\ntemplate &lt;class... Ts&gt;\nstruct Pack\n{\n    template&lt;template &lt;std::size_t&gt; class T&gt;\n    static constexpr bool has_tmpl() {\n        return TmplPackSearcher&lt;T, Ts...&gt;::value();\n    }\n};\n\ntemplate&lt;std::size_t I&gt;\nclass Tmpl {};\n\nint main() {\n    static_assert(Pack&lt;Tmpl&lt;1&gt;, int&gt;::has_tmpl&lt;Tmpl&gt;());\n    static_assert(!Pack&lt;int&gt;::has_tmpl&lt;Tmpl&gt;());\n}\n</code></pre>\n\n<h1>The Question</h1>\n\n<p>Now, my question is: How do I test for the presence of a template in a parameter pack <em>without making any assumption how the template looks like</em>? I.e., I don't want to write separate code for <code>template&lt;std::size_t&gt;</code>, <code>template&lt;std::size_t, typename&gt;</code>, <code>template &lt;typename, typename&gt;</code>, etc.</p>\n\n<p>Bonus points if it can be done using the same multiple-inheritance trick.</p>\n"}, {"tags": ["c++", "windows", "winapi", "device-instance-id"], "comments": [{"owner": {"reputation": 1239, "user_id": 4452971, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/og0oX.png?s=128&g=1", "display_name": "Castorix", "link": "https://stackoverflow.com/users/4452971/castorix"}, "edited": false, "score": 0, "creation_date": 1560942042, "post_id": 56665891, "comment_id": 99900057, "body": "Have you tried  <i>DEVPKEY_Device_Parent</i> ?"}], "answers": [{"comments": [{"owner": {"reputation": 2568, "user_id": 8548828, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C4qkl.png?s=128&g=1", "display_name": "Tarick Welling", "link": "https://stackoverflow.com/users/8548828/tarick-welling"}, "edited": false, "score": 0, "creation_date": 1560942591, "post_id": 56666274, "comment_id": 99900347, "body": "that was C# and with links so please update your answer with case specific parameters."}, {"owner": {"reputation": 4915, "user_id": 11128312, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ufn85.jpg?s=128&g=1", "display_name": "Strive Sun", "link": "https://stackoverflow.com/users/11128312/strive-sun"}, "reply_to_user": {"reputation": 2568, "user_id": 8548828, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C4qkl.png?s=128&g=1", "display_name": "Tarick Welling", "link": "https://stackoverflow.com/users/8548828/tarick-welling"}, "edited": false, "score": 0, "creation_date": 1560944252, "post_id": 56666274, "comment_id": 99901296, "body": "@TarickWelling The API can be called not only by C#, but also by C++. For clarity, I&#39;ve added a sample."}, {"owner": {"reputation": 2568, "user_id": 8548828, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C4qkl.png?s=128&g=1", "display_name": "Tarick Welling", "link": "https://stackoverflow.com/users/8548828/tarick-welling"}, "edited": false, "score": 0, "creation_date": 1560944615, "post_id": 56666274, "comment_id": 99901500, "body": "I know it is a C# and C++ API ;). I just hoped for a more fleshed out answer than a simple link to an answer for a C# question. (your answer still feels like a code dump so more commenting on what you did will still improve the answer) From -1 to +1 at least"}, {"owner": {"reputation": 4915, "user_id": 11128312, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ufn85.jpg?s=128&g=1", "display_name": "Strive Sun", "link": "https://stackoverflow.com/users/11128312/strive-sun"}, "reply_to_user": {"reputation": 2568, "user_id": 8548828, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C4qkl.png?s=128&g=1", "display_name": "Tarick Welling", "link": "https://stackoverflow.com/users/8548828/tarick-welling"}, "edited": false, "score": 1, "creation_date": 1560944888, "post_id": 56666274, "comment_id": 99901672, "body": "@TarickWelling Thank you for your reminder. I just hope to find a solution for OP faster. Code sample has been verified and can fulfill the requirements of OP :)"}], "tags": [], "owner": {"reputation": 4915, "user_id": 11128312, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ufn85.jpg?s=128&g=1", "display_name": "Strive Sun", "link": "https://stackoverflow.com/users/11128312/strive-sun"}, "is_accepted": true, "score": 5, "last_activity_date": 1560945655, "last_edit_date": 1560945655, "creation_date": 1560942504, "answer_id": 56666274, "question_id": 56665891, "link": "https://stackoverflow.com/questions/56665891/get-parent-information-of-a-usb-device-c/56666274#56666274", "title": "Get parent information of a USB device C++", "body": "<p><code>CM_Locate_DevNode</code> opens a device handle given a device ID;</p>\n\n<p><code>CM_Get_Parent</code> finds the parent device;</p>\n\n<p><code>CM_Get_Device_ID_Size</code> and <code>CM_Get_Device_ID</code> take the device handle and return the device ID.</p>\n\n<p>Sample:</p>\n\n<pre><code>#include &lt;Windows.h&gt;\n#include &lt;setupapi.h&gt;\n#include &lt;cfgmgr32.h&gt;\n#include &lt;tchar.h&gt;\n#include &lt;stdio.h&gt;\n#define ARRAY_SIZE(arr)     (sizeof(arr)/sizeof(arr[0]))\n\n#pragma comment (lib, \"setupapi.lib\")\n\nint main()\n{\n    HDEVINFO hDevInfo;\n    GUID guid;\n    BYTE buffer[1024];\n    DWORD dwRequiredSize;\n    DEVINST devInstParent;\n    SP_DEVICE_INTERFACE_DATA devInterfaceData;\n    SP_DEVINFO_DATA devInfoData;\n    PSP_DEVICE_INTERFACE_DETAIL_DATA pDevDetail;\n    CONFIGRET status;\n    TCHAR szDeviceInstanceID[MAX_DEVICE_ID_LEN];\n    BOOL bSuccess;\n\n    guid = GUID_DEVINTERFACE_VOLUME;\n    hDevInfo = SetupDiGetClassDevs(&amp;guid, NULL, NULL, DIGCF_DEVICEINTERFACE | DIGCF_PRESENT);\n    if (hDevInfo == INVALID_HANDLE_VALUE) {\n        return 1;\n    }\n\n    for (DWORD dwIndex = 0;; dwIndex++)\n    {\n        ZeroMemory(&amp;devInterfaceData, sizeof(devInterfaceData));\n        devInterfaceData.cbSize = sizeof(devInterfaceData);\n\n        if (!SetupDiEnumDeviceInterfaces(hDevInfo, NULL, &amp;guid, dwIndex, &amp;devInterfaceData)) {\n            DWORD dwErrorCode = GetLastError();\n            if (dwErrorCode == ERROR_NO_MORE_ITEMS)\n                break;\n            else\n                return 1;  \n        }\n\n        ZeroMemory(&amp;devInfoData, sizeof(devInfoData));\n        devInfoData.cbSize = sizeof(devInfoData);\n        pDevDetail = (PSP_DEVICE_INTERFACE_DETAIL_DATA)buffer;\n        pDevDetail-&gt;cbSize = sizeof(SP_DEVICE_INTERFACE_DETAIL_DATA);\n\n        // Get device interface detail data to get Device Instance from\n        // SP_DEVINFO_DATA and Device Path from SP_DEVICE_INTERFACE_DETAIL_DATA\n        bSuccess = SetupDiGetDeviceInterfaceDetail(hDevInfo, &amp;devInterfaceData,\n            pDevDetail,// SP_DEVICE_INTERFACE_DETAIL_DATA\n            sizeof(buffer), &amp;dwRequiredSize, &amp;devInfoData); // SP_DEVINFO_DATA\n\n        status = CM_Get_Parent(&amp;devInstParent, devInfoData.DevInst, 0);\n        if (status == CR_SUCCESS) \n        {\n            status = CM_Get_Device_ID(devInstParent, szDeviceInstanceID, ARRAY_SIZE(szDeviceInstanceID), 0);\n            if (status == CR_SUCCESS)\n                _tprintf(TEXT(\"    %s\\n\"), szDeviceInstanceID);\n        }\n        else \n        {\n            continue;\n        }\n    }\n\n    return 0;\n}\n</code></pre>\n\n<p>Debug result: </p>\n\n<p><a href=\"https://i.stack.imgur.com/FlopR.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/FlopR.png\" alt=\"1\"></a></p>\n\n<p><a href=\"https://i.stack.imgur.com/TdsoO.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/TdsoO.png\" alt=\"2\"></a></p>\n"}], "owner": {"reputation": 103, "user_id": 8350610, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/409addc96c23a388874c99fc30f6da84?s=128&d=identicon&r=PG&f=1", "display_name": "TiYan", "link": "https://stackoverflow.com/users/8350610/tiyan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2058, "favorite_count": 0, "accepted_answer_id": 56666274, "answer_count": 1, "score": 4, "last_activity_date": 1562600256, "creation_date": 1560941271, "last_edit_date": 1562600256, "question_id": 56665891, "link": "https://stackoverflow.com/questions/56665891/get-parent-information-of-a-usb-device-c", "title": "Get parent information of a USB device C++", "body": "<p>I'm working on an MFC tool that check some driver information's of connected USB device such as location info, parent, hardware id, etc. I have got all other information i want but i'm stuck in getting device parent information.</p>\n\n<p>I have used <strong>Setupapi.dll</strong> to get device information in my code. \nGot USB device information handle using <strong>SetupDiGetClassDevs</strong> function.\nGot specific device info data using <strong>SetupDiEnumDeviceInfo</strong> function. \nGot device description and hardware id using <strong>SetupDiGetDeviceRegistryProperty</strong> function.  </p>\n\n<pre><code>// List all connected USB devices\nhDevInfo = SetupDiGetClassDevs(pClassGuid, pszEnumerator, \n    NULL, pClassGuid != NULL ? DIGCF_PRESENT : DIGCF_ALLCLASSES | \n    DIGCF_PRESENT);\n\n// Get device info data\nSetupDiEnumDeviceInfo(hDevInfo, i, &amp;DeviceInfoData);\n\n// Get device instance id\nCM_Get_Device_ID(DeviceInfoData.DevInst, szDeviceInstanceID, MAX_PATH, \n    0);\n\n// Get device description\nSetupDiGetDeviceRegistryProperty(hDevInfo, &amp;DeviceInfoData, \n    SPDRP_DEVICEDESC,\n    &amp;dwPropertyRegDataType, (BYTE*)szDesc, sizeof(szDesc), &amp;dwSize);\n\n#define DEFINE_DEVPROPKEY(name, l, w1, w2, b1, b2, b3, b4, b5, b6, b7, \n    b8, pid) EXTERN_C const DEVPROPKEY DECLSPEC_SELECTANY \n    name = { { l, w1, w2, { b1, b2,  b3,  b4,  b5,  b6, b7,  b8 } }, pid \n}\n\n// DEVPROP_TYPE_STRING \nDEFINE_DEVPROPKEY(DEVPKEY_Device_Manufacturer, 0xa45c254e, 0xdf1c, \n    0x4efd, 0x80, 0x20, 0x67, 0xd1, 0x46, 0xa8, 0x50, 0xe0, 13);        \n// DEVPROP_TYPE_GUID\nDEFINE_DEVPROPKEY(DEVPKEY_Device_ContainerId, 0x8c7ed206, 0x3f8a, 0x4827, \n    0xb3, 0xab, 0xae, 0x9e, 0x1f, 0xae, 0xfc, 0x6c, 2);     \n\ntypedef BOOL(WINAPI *FN_SetupDiGetDevicePropertyW)(\n    __in       HDEVINFO DeviceInfoSet,\n    __in       PSP_DEVINFO_DATA DeviceInfoData,\n    __in       const DEVPROPKEY *PropertyKey,\n    __out      DEVPROPTYPE *PropertyType,\n    __out_opt  PBYTE PropertyBuffer,\n    __in       DWORD PropertyBufferSize,\n    __out_opt  PDWORD RequiredSize,\n    __in       DWORD Flags\n);\n\nFN_SetupDiGetDevicePropertyW fn_SetupDiGetDevicePropertyW = \n    (FN_SetupDiGetDevicePropertyW) \n    GetProcAddress(GetModuleHandle(TEXT(\"Setupapi.dll\")), \n    \"SetupDiGetDevicePropertyW\");\n\nif (fn_SetupDiGetDevicePropertyW(hDevInfo, &amp;DeviceInfoData, \n    &amp;DEVPKEY_Device_Manufacturer, &amp;ulPropertyType, (BYTE*)szBuffer, \n    sizeof(szBuffer), &amp;dwSize, 0)) \n{\n    _tprintf(TEXT(\"    Device Manufacturer: \\\"%ls\\\"\\n\"), szBuffer);\n}\n\nif (fn_SetupDiGetDevicePropertyW(hDevInfo, &amp;DeviceInfoData, \n    &amp;DEVPKEY_Device_ContainerId, &amp;ulPropertyType, (BYTE*)szDesc, \n    sizeof(szDesc), &amp;dwSize, 0)) \n{\n    StringFromGUID2((REFGUID)szDesc, szBuffer, ARRAY_SIZE(szBuffer));\n    _tprintf(TEXT(\"    ContainerId: \\\"%ls\\\"\\n\"), szBuffer);\n}\n</code></pre>\n\n<p>It is very useful for me to get the parent information of USB device. Please help with some clues.</p>\n\n<p><a href=\"https://i.stack.imgur.com/l8XZm.png\" rel=\"nofollow noreferrer\">please look into image</a></p>\n"}, {"tags": ["c++", "visual-studio", "c++11", "list-initialization"], "comments": [{"owner": {"reputation": 97030, "user_id": 189205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c60305494593d556e57a3cf8e4a8c163?s=128&d=identicon&r=PG", "display_name": "interjay", "link": "https://stackoverflow.com/users/189205/interjay"}, "edited": false, "score": 3, "creation_date": 1560941642, "post_id": 56665797, "comment_id": 99899856, "body": "clang <a href=\"https://godbolt.org/z/QRPncY\" rel=\"nofollow noreferrer\">gives</a> an error for this, while gcc gives a warning."}, {"owner": {"reputation": 2568, "user_id": 8548828, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C4qkl.png?s=128&g=1", "display_name": "Tarick Welling", "link": "https://stackoverflow.com/users/8548828/tarick-welling"}, "edited": false, "score": 0, "creation_date": 1560942791, "post_id": 56665797, "comment_id": 99900446, "body": "what compilation flags are you using? Are<code>-Wall</code> or <code>-Wnarrowing</code> used? (or their visual studio equivalents.)"}, {"owner": {"reputation": 2568, "user_id": 8548828, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C4qkl.png?s=128&g=1", "display_name": "Tarick Welling", "link": "https://stackoverflow.com/users/8548828/tarick-welling"}, "edited": false, "score": 0, "creation_date": 1560943203, "post_id": 56665797, "comment_id": 99900691, "body": "Seems like Biagio Festa&#39;s answer is the correct one with a visual studio bug."}], "answers": [{"comments": [{"owner": {"reputation": 8510, "user_id": 6040181, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh3.googleusercontent.com/-dQXdInUPrE0/AAAAAAAAAAI/AAAAAAAAAdg/_OLdfGWclsw/photo.jpg?sz=128", "display_name": "Biagio Festa", "link": "https://stackoverflow.com/users/6040181/biagio-festa"}, "reply_to_user": {"reputation": 5093, "user_id": 6039995, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/QuCId.png?s=128&g=1", "display_name": "Stack Danny", "link": "https://stackoverflow.com/users/6039995/stack-danny"}, "edited": false, "score": 0, "creation_date": 1560943489, "post_id": 56666272, "comment_id": 99900855, "body": "Which C++ standard are you using? If you fill a bug report, I think it could be useful to add the link as a comment to this answer. Thanks"}, {"owner": {"reputation": 5093, "user_id": 6039995, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/QuCId.png?s=128&g=1", "display_name": "Stack Danny", "link": "https://stackoverflow.com/users/6039995/stack-danny"}, "edited": false, "score": 0, "creation_date": 1560943568, "post_id": 56666272, "comment_id": 99900899, "body": "I actually switched through C++11 - C++14 - C++17 to see if it makes a difference, but there was none so I just tagged C++11 for the post."}, {"owner": {"reputation": 8510, "user_id": 6040181, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh3.googleusercontent.com/-dQXdInUPrE0/AAAAAAAAAAI/AAAAAAAAAdg/_OLdfGWclsw/photo.jpg?sz=128", "display_name": "Biagio Festa", "link": "https://stackoverflow.com/users/6040181/biagio-festa"}, "reply_to_user": {"reputation": 5093, "user_id": 6039995, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/QuCId.png?s=128&g=1", "display_name": "Stack Danny", "link": "https://stackoverflow.com/users/6039995/stack-danny"}, "edited": false, "score": 0, "creation_date": 1560943602, "post_id": 56666272, "comment_id": 99900925, "body": "Yeah you just need C++11 or above"}, {"owner": {"reputation": 5093, "user_id": 6039995, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/QuCId.png?s=128&g=1", "display_name": "Stack Danny", "link": "https://stackoverflow.com/users/6039995/stack-danny"}, "edited": false, "score": 1, "creation_date": 1560943789, "post_id": 56666272, "comment_id": 99901048, "body": "And yes, I wrote a short summary as well as linking this post. Shall it be helpful."}], "tags": [], "owner": {"reputation": 8510, "user_id": 6040181, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh3.googleusercontent.com/-dQXdInUPrE0/AAAAAAAAAAI/AAAAAAAAAdg/_OLdfGWclsw/photo.jpg?sz=128", "display_name": "Biagio Festa", "link": "https://stackoverflow.com/users/6040181/biagio-festa"}, "is_accepted": true, "score": 11, "last_activity_date": 1560944867, "last_edit_date": 1560944867, "creation_date": 1560942494, "answer_id": 56666272, "question_id": 56665797, "link": "https://stackoverflow.com/questions/56665797/why-is-this-narrowing-conversion-not-detected/56666272#56666272", "title": "Why is this narrowing conversion not detected?", "body": "<p>Yes. You are right: the program is <em>ill-formed</em>.</p>\n\n<p>In such a case (<em>standard \u00a71.4</em>):</p>\n\n<blockquote>\n  <p>a conforming implementation shall issue at least one diagnostic message.</p>\n</blockquote>\n\n<p>Indeed, <code>gcc</code> produces a warning message. <code>clang</code> directly rejects the code as a compiler error.</p>\n\n<p>This specific topic has already been discussed <a href=\"https://gcc.gnu.org/bugzilla/show_bug.cgi?id=55783\" rel=\"noreferrer\">here</a> for <em>gcc</em><sup>1</sup>.</p>\n\n<p><code>Visual Studio</code> is supposed to produce a diagnostic message (I suggest you check your compilation options. Did you disable warnings? Are you compiling with <em>C++(11/14/17)</em>?, ...). If this is not the case, it's an implementation bug.</p>\n\n<p><strong>Update:</strong></p>\n\n<p><a href=\"https://godbolt.org/z/6G8Num\" rel=\"noreferrer\">Visual Studio v19.20</a> does not produce any diagnostic message (even with <code>/Wall</code> flag).</p>\n\n<p><a href=\"https://developercommunity.visualstudio.com/content/problem/613834/compiler-allows-specific-narrowing-conversion.html\" rel=\"noreferrer\">A bug report</a> has been filled here.</p>\n\n<hr>\n\n<p><sup>1</sup> <em>For additional information regarding gcc implementation for narrowing check <a href=\"https://gcc.gnu.org/wiki/FAQ#Wnarrowing\" rel=\"noreferrer\">here</a>.</em></p>\n"}], "owner": {"reputation": 5093, "user_id": 6039995, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/QuCId.png?s=128&g=1", "display_name": "Stack Danny", "link": "https://stackoverflow.com/users/6039995/stack-danny"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 807, "favorite_count": 1, "accepted_answer_id": 56666272, "answer_count": 1, "score": 15, "last_activity_date": 1560944867, "creation_date": 1560940965, "last_edit_date": 1560944345, "question_id": 56665797, "link": "https://stackoverflow.com/questions/56665797/why-is-this-narrowing-conversion-not-detected", "title": "Why is this narrowing conversion not detected?", "body": "<p>when constructing variables using the list-initialization (like <code>int x{ 5 };</code>) <a href=\"http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2014/n4296.pdf\" rel=\"noreferrer\">the standard</a> \u00a78.5.4 says:</p>\n\n<blockquote>\n  <p>If a narrowing conversion [\u2026] is required to convert any of the arguments, the program is ill-formed. \n   <Sub>(7)</Sub> A narrowing conversion is an implicit conversion -\n  <Sub>(7.4)</Sub> from an integer type or unscoped enumeration type to an integer type that cannot represent all the values of the original type, except where the source is a constant expression whose value after integral promotions will \ufb01t into the target type. </p>\n</blockquote>\n\n<p>So why does this compile?</p>\n\n<pre><code>char c{ 'A' };\nchar x{ c + c };\n</code></pre>\n\n<hr>\n\n<p>As a reminder, <code>c + c</code> yields an <code>int</code> </p>\n\n<pre><code>static_assert(std::is_same_v&lt;decltype(c + c), int&gt;, \"\");\n</code></pre>\n\n<p>so the compiler should complain about a narrowing conversion which is certainly not a constant expression.</p>\n\n<hr>\n\n<p>Interestingly, declaring <code>x</code> to be an <code>unsigned char</code> correctly fails to compile:</p>\n\n<pre><code>char c{ 'A' };\nunsigned char x{ c + c }; \n</code></pre>\n\n<blockquote>\n  <p>C2397 conversion from 'int' to 'unsigned char' requires a narrowing conversion    </p>\n</blockquote>\n\n<p>As does introducing a temporary:</p>\n\n<pre><code>char c{ 'A' };\nint sum{ c + c };\nchar x{ sum }; //C2397 conversion from 'int' to 'char' requires [...]\n</code></pre>\n\n<hr>\n\n<p>So why does the first version compile? I'm using Visual Studio Community 2017 Version 15.9.5 and compile it with <code>/wall</code> and all warnings are errors enabled in a <code>x64</code> debug build. Setting the standard C++11, C++14 and C++17 all compile. </p>\n\n<hr>\n\n<p><strong>I filed the bug report <a href=\"https://developercommunity.visualstudio.com/content/problem/613834/compiler-allows-specific-narrowing-conversion.html\" rel=\"noreferrer\">here</a></strong></p>\n"}, {"tags": ["c++", "serialization", "c++14", "deserialization"], "comments": [{"owner": {"reputation": 12749, "user_id": 7976805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92a559df8b4b287aad23724b4c66d67c?s=128&d=identicon&r=PG&f=1", "display_name": "Yksisarvinen", "link": "https://stackoverflow.com/users/7976805/yksisarvinen"}, "edited": false, "score": 1, "creation_date": 1560940893, "post_id": 56665678, "comment_id": 99899458, "body": "<code>memcpy(&amp;s[0], reinterpret_cast&lt;const char*&gt;(&amp;OriNumber), s.size());</code> My Undefined-Behaviour-o-meter run out of scale on this line. What are you trying to achieve here? And are you sure you need a text file and not a binary file?"}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 1, "creation_date": 1560941483, "post_id": 56665678, "comment_id": 99899772, "body": "The <code>*(reinterpret_cast&lt;const size_t*&gt;...</code> has undefined behaviour. Use <code>memcpy</code> like you did when writing."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1560941536, "post_id": 56665678, "comment_id": 99899802, "body": "Why don&#39;t you just <a href=\"https://en.cppreference.com/w/cpp/io/basic_ostream/write\" rel=\"nofollow noreferrer\">write</a> and <a href=\"https://en.cppreference.com/w/cpp/io/basic_istream/read\" rel=\"nofollow noreferrer\">read</a> the <code>size_t</code>?"}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1560942253, "post_id": 56665678, "comment_id": 99900157, "body": "After fixing the compilation errors, that code outputs <code>26</code> for me. Please post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 3805, "user_id": 4165552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18b32c5e142791fca01cbf252f663ac?s=128&d=identicon&r=PG&f=1", "display_name": "pptaszni", "link": "https://stackoverflow.com/users/4165552/pptaszni"}, "reply_to_user": {"reputation": 12749, "user_id": 7976805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92a559df8b4b287aad23724b4c66d67c?s=128&d=identicon&r=PG&f=1", "display_name": "Yksisarvinen", "link": "https://stackoverflow.com/users/7976805/yksisarvinen"}, "edited": false, "score": 0, "creation_date": 1560945495, "post_id": 56665678, "comment_id": 99902024, "body": "@Yksisarvinen, why undefined behavior? According to <a href=\"https://stackoverflow.com/questions/1986966/does-s0-point-to-contiguous-characters-in-a-stdstring\">this post</a> it&#39;s rather safe to assume that <code>&amp;[s0]</code> points to contiguous memory. <code>reinterpret_cast</code> also looks ok, although I would rather cast to <code>const void*</code>. Similar tricks are used when dealing with big endian vs little endian archs."}, {"owner": {"reputation": 91, "user_id": 7849529, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh5.googleusercontent.com/-MTSoZt9gyw4/AAAAAAAAAAI/AAAAAAAAACE/AXCjMJ4rbCo/photo.jpg?sz=128", "display_name": "van con Nguyen", "link": "https://stackoverflow.com/users/7849529/van-con-nguyen"}, "reply_to_user": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1560945971, "post_id": 56665678, "comment_id": 99902313, "body": "1. I haven&#39;t tested this issue on linux yet. but it is happening on windows(10), and the str1 is read as empty string. I&#39;ve edited the my code sample, and it is compilable now. 2. I think that you got undefined behavior by missing this line <code>str.resize(sizeof(size_t));</code>. till now. it is working well with my on both MSVC++ and MingW-GCC. and the syntax is valid. 3. @molbdnilo: I want to read entire file to memory instead of read byte to byte or line by line(this is a small example, in real code it is a bigger file). then I used iterator instead. thanks."}, {"owner": {"reputation": 3805, "user_id": 4165552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18b32c5e142791fca01cbf252f663ac?s=128&d=identicon&r=PG&f=1", "display_name": "pptaszni", "link": "https://stackoverflow.com/users/4165552/pptaszni"}, "edited": false, "score": 1, "creation_date": 1560946576, "post_id": 56665678, "comment_id": 99902643, "body": "For me it works on Debian9, valgrind doesn&#39;t complain. Maybe try to use <code>ofs(filename, std::ios::binary)</code> ?"}, {"owner": {"reputation": 1038, "user_id": 9636903, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DZZnv.png?s=128&g=1", "display_name": "Gabriella Giordano", "link": "https://stackoverflow.com/users/9636903/gabriella-giordano"}, "edited": false, "score": 0, "creation_date": 1560951549, "post_id": 56665678, "comment_id": 99905735, "body": "On windows the default stream read/write mode is text. Do as Ptag666 suggested. See <a href=\"https://docs.microsoft.com/en-us/cpp/standard-library/binary-output-files?view=vs-2019\" rel=\"nofollow noreferrer\">here</a> for reference."}, {"owner": {"reputation": 91, "user_id": 7849529, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh5.googleusercontent.com/-MTSoZt9gyw4/AAAAAAAAAAI/AAAAAAAAACE/AXCjMJ4rbCo/photo.jpg?sz=128", "display_name": "van con Nguyen", "link": "https://stackoverflow.com/users/7849529/van-con-nguyen"}, "edited": false, "score": 0, "creation_date": 1560954955, "post_id": 56665678, "comment_id": 99907886, "body": "Thanks for suggestion, I tested on linux, It can read the character 26 into memory but ignore rest of the file. it is a little bit different that windows that in windows it reads nothing into memory.  Then I&#39;m looking for a suggestion to read entire file without ignoring all subsequent chars after &#39;26&#39;. thanks,"}, {"owner": {"reputation": 91, "user_id": 7849529, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh5.googleusercontent.com/-MTSoZt9gyw4/AAAAAAAAAAI/AAAAAAAAACE/AXCjMJ4rbCo/photo.jpg?sz=128", "display_name": "van con Nguyen", "link": "https://stackoverflow.com/users/7849529/van-con-nguyen"}, "edited": false, "score": 0, "creation_date": 1560956060, "post_id": 56665678, "comment_id": 99908615, "body": "Finally, I had an idea to solve the problem. 1. when write the file, write the buffer&#39;s size first: <code>ofs &lt;&lt; str.size() &lt;&lt; str &lt;&lt; std::endl;</code> 2. when read the file, read the buffer&#39;s size first then allocate memory to read entire the file: <code>size_t size; ifs &gt;&gt; size; if(size)   {     str1.resize(size);     ifs.read(&amp;str1[0], size); } </code> This works quite perfect. then thanks all of you for your ideas!"}, {"owner": {"reputation": 665, "user_id": 7612635, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20d79d7ae01a9e70dc15aa231eb1c482?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Mahni\u010d", "link": "https://stackoverflow.com/users/7612635/marko-mahni%c4%8d"}, "edited": false, "score": 0, "creation_date": 1560966320, "post_id": 56665678, "comment_id": 99913768, "body": "@van con Nguyen: <code>ofs &lt;&lt; str.size() &lt;&lt; str &lt;&lt; std::endl;</code> will not work if str begins with a digit. Your code for reading will then try to read too much. You have to insert some kind of delimiter between str.size() and str and skip it when reading back."}], "owner": {"reputation": 91, "user_id": 7849529, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh5.googleusercontent.com/-MTSoZt9gyw4/AAAAAAAAAAI/AAAAAAAAACE/AXCjMJ4rbCo/photo.jpg?sz=128", "display_name": "van con Nguyen", "link": "https://stackoverflow.com/users/7849529/van-con-nguyen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 103, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1560945408, "creation_date": 1560940551, "last_edit_date": 1560945408, "question_id": 56665678, "link": "https://stackoverflow.com/questions/56665678/cannot-read-character-value-26-from-filesubstitute-character-in-c", "title": "cannot read character value &#39;26&#39; from file(substitute character) in c++", "body": "<p><strong>hi,</strong></p>\n\n<p><strong>I've just done something like below in c++:</strong> - <strong><em>ON - WINDOWS 10</em></strong></p>\n\n<pre><code>   //1. Serialize a number into string then write it to file\n        std::string filename = \"D:\\\\Hello.txt\";\n        size_t OriNumber = 26;\n        std::string str;\n        str.resize(sizeof(size_t));\n        memcpy(&amp;str[0], reinterpret_cast&lt;const char*&gt;(&amp;OriNumber), str.size());\n\n        std::ofstream ofs(filename);\n        ofs &lt;&lt; str &lt;&lt; std::endl;\n        ofs.close();\n\n        //2. Now read back the string from file and deserialize it\n        std::ifstream ifs(filename);\n        std::string str1{std::istreambuf_iterator&lt;char&gt;(ifs), std::istreambuf_iterator&lt;char&gt;()};\n\n        // 3. Expect that the string str1 will not be empty here.\n        size_t DeserializedNumber = *(reinterpret_cast&lt;const size_t*&gt;(str1.c_str()));\n        std::cout &lt;&lt; DeserializedNumber &lt;&lt; std::endl;\n</code></pre>\n\n<p>At step 3, I could not read the string from file, even if I opened the file with notepad++, it showed several characters. At last line we still have the value of DeserializedNumber got printed, but it is due to str1.c_str() is now a valid pointer with some garbage value.</p>\n\n<p>After debugged the program, I found that std:ifstream will get the value -1(EOF) at beginning of the file, and as explanation of wikipedia, 26 is value of Substitue Character and sometime is considered as EOF.</p>\n\n<p><strong>My question is:</strong></p>\n\n<ol>\n<li>if I can't read value 26 from file as above, then how can serialization library serialize this value to bytes?</li>\n<li>and Do we have some way to read/write/transfer this value properly if still serialize the value 26 as my way above?</li>\n</ol>\n\n<p>thanks,</p>\n"}, {"tags": ["c++", "visual-studio", "environment-variables"], "comments": [{"owner": {"reputation": 2568, "user_id": 8548828, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C4qkl.png?s=128&g=1", "display_name": "Tarick Welling", "link": "https://stackoverflow.com/users/8548828/tarick-welling"}, "edited": false, "score": 0, "creation_date": 1560939804, "post_id": 56665398, "comment_id": 99898962, "body": "Hello and welcome to StackOverflow. Please take some time to read the <a href=\"https://stackoverflow.com/help\">help page</a>, especially the sections named <a href=\"https://stackoverflow.com/help/how-to-ask\">How to Ask</a>. You might also want to learn about <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> and how to <a href=\"https://stackoverflow.com/editing-help\">format your question</a>. Do you want a run time environment variable or a compile time define?"}, {"owner": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 0, "creation_date": 1560944829, "post_id": 56665398, "comment_id": 99901642, "body": "You may be able to edit the Visual Studio <code>.user</code> file with commands in CMake. <a href=\"https://cmake.org/cmake/help/latest/command/file.html\" rel=\"nofollow noreferrer\">cmake.org/cmake/help/latest/command/file.html</a> It&#39;s just xml."}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 11311214, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dfe31d7fd720e48028770f2a678c85a?s=128&d=identicon&r=PG&f=1", "display_name": "MiguelVega", "link": "https://stackoverflow.com/users/11311214/miguelvega"}, "edited": false, "score": 0, "creation_date": 1561067757, "post_id": 56665989, "comment_id": 99953932, "body": "Actually putting the DLLs alongside the executable works fine, but I would like to set the environment variables (specifically the PATH variable) before building my project i.e. before the creation of the executable. I think, maybe It could be done by the configuration of the CMake.txt file, but I still don&#39;t know how."}, {"owner": {"reputation": 1, "user_id": 7708798, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qLavG.jpg?s=128&g=1", "display_name": "snik", "link": "https://stackoverflow.com/users/7708798/snik"}, "reply_to_user": {"reputation": 3, "user_id": 11311214, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dfe31d7fd720e48028770f2a678c85a?s=128&d=identicon&r=PG&f=1", "display_name": "MiguelVega", "link": "https://stackoverflow.com/users/11311214/miguelvega"}, "edited": false, "score": 0, "creation_date": 1561296870, "post_id": 56665989, "comment_id": 100008765, "body": "Re: [<a href=\"https://stackoverflow.com/questions/7584602](this\">stackoverflow.com/questions/7584602](this</a> question), you might have to set the path var before calling cmake, rather than from within it.  Unless you&#39;re manually loading your dlls with LoadLibrary, you&#39;ll be restricted on where dlls are automatically searched for (eg if they&#39;re in a sub directory), see [<a href=\"https://stackoverflow.com/a/35311436/7708798](this\">stackoverflow.com/a/35311436/7708798](this</a> answer) for more information."}], "tags": [], "owner": {"reputation": 1, "user_id": 7708798, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qLavG.jpg?s=128&g=1", "display_name": "snik", "link": "https://stackoverflow.com/users/7708798/snik"}, "is_accepted": false, "score": 0, "last_activity_date": 1560941598, "creation_date": 1560941598, "answer_id": 56665989, "question_id": 56665398, "link": "https://stackoverflow.com/questions/56665398/set-debug-run-environment-variable-in-visual-studio-2017-c-project/56665989#56665989", "title": "Set debug/run environment variable in Visual Studio 2017 C++ project?", "body": "<p>If your dll is one you are intending to use, <a href=\"https://stackoverflow.com/a/4953976/7708798\">this answer</a> details how to quickly ensure it is found at runtime (putting the DLL alongside the executable)</p>\n\n<p>If by 'automatic' you mean in code, you can set environment variables in code using _putenv as described in <a href=\"https://stackoverflow.com/a/17258181/7708798\">this answer</a> similar to what you seem to be describing.</p>\n\n<pre><code>ostringstream classSize;\nclassSize &lt;&lt; \"classSize=\" &lt;&lt; howManyInClass;\n_putenv(classSize.str().c_str());\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3, "user_id": 11311214, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dfe31d7fd720e48028770f2a678c85a?s=128&d=identicon&r=PG&f=1", "display_name": "MiguelVega", "link": "https://stackoverflow.com/users/11311214/miguelvega"}, "is_accepted": false, "score": 0, "last_activity_date": 1563102845, "creation_date": 1563102845, "answer_id": 57026884, "question_id": 56665398, "link": "https://stackoverflow.com/questions/56665398/set-debug-run-environment-variable-in-visual-studio-2017-c-project/57026884#57026884", "title": "Set debug/run environment variable in Visual Studio 2017 C++ project?", "body": "<p>The solution I found is base on <a href=\"https://stackoverflow.com/a/1307784/11311214\">this answer</a>.</p>\n\n<p><strong>Steps for the solution:</strong></p>\n\n<ol>\n<li>Create a <code>UserTemplate.vcxproj.user</code> file next to the <code>CMakeLists.txt</code> file, with the next content:</li>\n</ol>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n    &lt;Project ToolsVersion=\"15.0\" xmlns=\"http://schemas.microsoft.com/developer/msbuild/2003\"&gt;\n      &lt;PropertyGroup Condition=\"'$(Configuration)|$(Platform)'=='Debug|x64'\"&gt;\n        &lt;LocalDebuggerEnvironment&gt;PATH=..\\Your\\Path\\to\\Binaries;%PATH%\".&lt;/LocalDebuggerEnvironment&gt;\n        &lt;DebuggerFlavor&gt;WindowsLocalDebugger&lt;/DebuggerFlavor&gt;\n      &lt;/PropertyGroup&gt;\n    &lt;/Project&gt;\n</code></pre>\n\n<p>Where <code>..\\Your\\Path\\to\\Binaries</code> is the relative path to your binary\n    files (the two points at the beginning <code>..</code> are optional, if you\n    want to go up in the relative directory path, you may want to use\n    them).</p>\n\n<ol start=\"2\">\n<li>Add the next lines of code in the <code>CMakeLists.txt</code> file.</li>\n</ol>\n\n<pre class=\"lang-sh prettyprint-override\"><code>    # Configure the template file\n    SET(USER_FILE main.vcxproj.user)\n    SET(OUTPUT_PATH ${CMAKE_CURRENT_BINARY_DIR}/${USER_FILE})\n    CONFIGURE_FILE(UserTemplate.vcxproj.user ${USER_FILE} @ONLY)\n</code></pre>\n\n<p>Where <code>ProjectName</code> is the name of the VS project where you want to define your PATH variable.</p>\n"}], "owner": {"reputation": 3, "user_id": 11311214, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dfe31d7fd720e48028770f2a678c85a?s=128&d=identicon&r=PG&f=1", "display_name": "MiguelVega", "link": "https://stackoverflow.com/users/11311214/miguelvega"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 295, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1563102845, "creation_date": 1560939619, "last_edit_date": 1560939859, "question_id": 56665398, "link": "https://stackoverflow.com/questions/56665398/set-debug-run-environment-variable-in-visual-studio-2017-c-project", "title": "Set debug/run environment variable in Visual Studio 2017 C++ project?", "body": "<p>I'm trying to set automatically run/debug environmental variables for my project in Visual Studio.\nI mean, is there any CMake or C++ code line to do this not needing to do it manually?</p>\n\n<p><a href=\"https://stackoverflow.com/a/155363/11311214\">Here</a> are the instructions how to do it manually (what I want to avoid).</p>\n\n<p><a href=\"https://developercommunity.visualstudio.com/content/problem/484364/setting-rundebug-environment-variables-for-c-cmake.html\" rel=\"nofollow noreferrer\">Here</a> there is an still unsolved question about how to do it with Cmake (seems not to be possible).</p>\n\n<p>I also tried with <code>setenv()</code> and <code>putenv()</code> in different ways but it didn't work, because the main function doesn't even run until that line of code, before an error message shows up: \"Some.dll was not found\" and the program stops.</p>\n"}, {"tags": ["c++", "windows", "manifest", "uac", "createprocessasuser"], "comments": [{"owner": {"reputation": 1636, "user_id": 3370124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73352b4adb282c092738f34883488dd?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Critten", "link": "https://stackoverflow.com/users/3370124/richard-critten"}, "edited": false, "score": 2, "creation_date": 1560938859, "post_id": 56664985, "comment_id": 99898416, "body": "It can also fail during process initialisation (after CreateProcess has returned) see the last para in the <b>Return Value</b> section here: <a href=\"https://docs.microsoft.com/en-us/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera\" rel=\"nofollow noreferrer\">docs.microsoft.com/en-us/windows/desktop/api/processthreadsa&zwnj;&#8203;pi/&hellip;</a>"}, {"owner": {"reputation": 1524, "user_id": 492034, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f88b5ee10330dd2e3558ca0d69db070c?s=128&d=identicon&r=PG", "display_name": "marco", "link": "https://stackoverflow.com/users/492034/marco"}, "reply_to_user": {"reputation": 1636, "user_id": 3370124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73352b4adb282c092738f34883488dd?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Critten", "link": "https://stackoverflow.com/users/3370124/richard-critten"}, "edited": false, "score": 0, "creation_date": 1560939357, "post_id": 56664985, "comment_id": 99898701, "body": "@Richard exitCode = 0"}, {"owner": {"reputation": 1524, "user_id": 492034, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f88b5ee10330dd2e3558ca0d69db070c?s=128&d=identicon&r=PG", "display_name": "marco", "link": "https://stackoverflow.com/users/492034/marco"}, "reply_to_user": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 0, "creation_date": 1560939428, "post_id": 56664985, "comment_id": 99898744, "body": "@VTT I don&#39;t see where the opposite is. The title says <b>fails</b> with no error. It fails."}, {"owner": {"reputation": 1524, "user_id": 492034, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f88b5ee10330dd2e3558ca0d69db070c?s=128&d=identicon&r=PG", "display_name": "marco", "link": "https://stackoverflow.com/users/492034/marco"}, "reply_to_user": {"reputation": 1636, "user_id": 3370124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73352b4adb282c092738f34883488dd?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Critten", "link": "https://stackoverflow.com/users/3370124/richard-critten"}, "edited": false, "score": 0, "creation_date": 1560939763, "post_id": 56664985, "comment_id": 99898940, "body": "@Richard Critten  With your hint I ran all from a cmd and checked if something was written there. <i>&quot;FATAL in ProcessService Test: Error calling method via RPC: Exception occurred: Could not start process as user due to an unexpected error&quot;</i>.  At least now I have a trace. Thanks"}, {"owner": {"reputation": 1524, "user_id": 492034, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f88b5ee10330dd2e3558ca0d69db070c?s=128&d=identicon&r=PG", "display_name": "marco", "link": "https://stackoverflow.com/users/492034/marco"}, "reply_to_user": {"reputation": 1636, "user_id": 3370124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73352b4adb282c092738f34883488dd?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Critten", "link": "https://stackoverflow.com/users/3370124/richard-critten"}, "edited": false, "score": 0, "creation_date": 1560939950, "post_id": 56664985, "comment_id": 99899032, "body": "Ah no, the exception is thrown because <code>CreateProcessAsUser()</code> returns false. So no trace, still stuck"}, {"owner": {"reputation": 82917, "user_id": 3501, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/1fd5f5cc203c393634379a3b3b7e7a87?s=128&d=identicon&r=PG", "display_name": "Anders", "link": "https://stackoverflow.com/users/3501/anders"}, "edited": false, "score": 0, "creation_date": 1560940536, "post_id": 56664985, "comment_id": 99899312, "body": "What happens if you have a asInvoker middle-man process that then does the elevation?"}, {"owner": {"reputation": 1524, "user_id": 492034, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f88b5ee10330dd2e3558ca0d69db070c?s=128&d=identicon&r=PG", "display_name": "marco", "link": "https://stackoverflow.com/users/492034/marco"}, "reply_to_user": {"reputation": 82917, "user_id": 3501, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/1fd5f5cc203c393634379a3b3b7e7a87?s=128&d=identicon&r=PG", "display_name": "Anders", "link": "https://stackoverflow.com/users/3501/anders"}, "edited": false, "score": 0, "creation_date": 1560946726, "post_id": 56664985, "comment_id": 99902722, "body": "@Anders Didn&#39;t try that but I gave up. I used <code>ProcMon</code> to see if at least it tries to start the process but nope. I switched to <code>ShellExecuteEx</code> that is starting the process but not showing the gui. So I think that the service has no access to the desktop even thought <i>&quot;Allow service to interact with the desktop&quot;</i> is enabled"}, {"owner": {"reputation": 29355, "user_id": 205580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/460e6e299e385fd46df156c85a1dd55f?s=128&d=identicon&r=PG", "display_name": "Eryk Sun", "link": "https://stackoverflow.com/users/205580/eryk-sun"}, "edited": false, "score": 0, "creation_date": 1560975401, "post_id": 56664985, "comment_id": 99917765, "body": "A system should not be manually configured to allow services to use interactive WinSta0 in Session 0. Allowing interactive services was a transitional step when Vista was released 13 years ago. Relying on that nowadays is wrong. The token should be associated with an interactive session (e.g. from <code>WTSQueryUserToken</code>) if the application needs an interactive graphical or console user interface."}, {"owner": {"reputation": 29355, "user_id": 205580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/460e6e299e385fd46df156c85a1dd55f?s=128&d=identicon&r=PG", "display_name": "Eryk Sun", "link": "https://stackoverflow.com/users/205580/eryk-sun"}, "edited": false, "score": 0, "creation_date": 1560975532, "post_id": 56664985, "comment_id": 99917827, "body": "That doesn&#39;t explain why <code>CreateProcessAsUser</code> would return <code>FALSE</code> without setting an error. Are you calling another function in between? Anyway, if elevation is required, and we have a UAC-limited token (<code>TokenElevationTypeLimited</code>), then we need to get the full token (<code>TokenElevationTypeFull</code>) by querying the <code>TokenLinkedToken</code> information."}, {"owner": {"reputation": 29355, "user_id": 205580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/460e6e299e385fd46df156c85a1dd55f?s=128&d=identicon&r=PG", "display_name": "Eryk Sun", "link": "https://stackoverflow.com/users/205580/eryk-sun"}, "reply_to_user": {"reputation": 1636, "user_id": 3370124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73352b4adb282c092738f34883488dd?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Critten", "link": "https://stackoverflow.com/users/3370124/richard-critten"}, "edited": false, "score": 0, "creation_date": 1560975941, "post_id": 56664985, "comment_id": 99917986, "body": "@RichardCritten, it&#39;s stated that <code>CreateProcessAsUser</code> returns false. If it were a failure during process initialization, <code>CreateProcessAsUser</code> would return true. Initialization occurs in the main thread after <code>CreateProcess[AsUser]</code> resumes the thread and returns. It doesn&#39;t wait around for a signal from the child process that it initialized successfully."}], "owner": {"reputation": 1524, "user_id": 492034, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f88b5ee10330dd2e3558ca0d69db070c?s=128&d=identicon&r=PG", "display_name": "marco", "link": "https://stackoverflow.com/users/492034/marco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 78, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1560938333, "creation_date": 1560938333, "question_id": 56664985, "link": "https://stackoverflow.com/questions/56664985/c-windows-createprocessasuser-fails-but-with-no-error-if-manifest-requires", "title": "C++ Windows - CreateProcessAsUser() fails but with no error if manifest requires administrator rights", "body": "<p>I have a simple program, just an empty GUI, that is launched from a SYSTEM service (mine) in the following way:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>    DWORD creationFlags = CREATE_NEW_PROCESS_GROUP | CREATE_UNICODE_ENVIRONMENT | DETACHED_PROCESS | EXTENDED_STARTUPINFO_PRESENT;\n\n    auto returnCode = ::CreateProcessAsUser(\n        *m_userToken,\n        nullptr,\n        LPWSTR(commandLineUtf16),\n        nullptr,\n        nullptr,\n        FALSE, // lets not inherit any handles from the service!\n        creationFlags,\n        environmentBuffer,\n        LPWSTR(effectiveWorkingDirectory.utf16()),\n        reinterpret_cast&lt;LPSTARTUPINFO&gt;(&amp;startupInfo),\n        &amp;processInformation\n    );\n</code></pre>\n\n<p>If the program's manifest has a <code>requestedExecutionLevel=\"asInvoker\"</code> all is fine. It can be started from a admin and non admin user.\nOtherwise, if <strong>not</strong> \"asInvoker\", <code>CreateProcessAsUser(...)</code> returns FALSE and <code>GetLastError()</code> is 0.</p>\n\n<p>I'm totally stuck. If there's no error, why does it fail?\nIf I run the program directly, it always works (admin, non admin, asInvoker, requireAdministrator...).</p>\n\n<p>How can I find the reason of the fail?</p>\n\n<p>Running on Windows 10 Enterprise Evaluation 64 bits VM, UAC full on</p>\n"}, {"tags": ["c++", "casting"], "comments": [{"owner": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 0, "creation_date": 1560937942, "post_id": 56664836, "comment_id": 99897866, "body": "<i>&quot;which means that it cannot modify the member variable items_&quot;</i> - it does not mean that. <code>const_cast</code> here makes no sense because you first remove <code>const</code> qualifier from reference but then immediately add it back when returning that reference from function."}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1560938663, "post_id": 56664836, "comment_id": 99898323, "body": "I didnt really understand why you think the cast is needed, please eloborate, if the answer does not yet convince you"}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "reply_to_user": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 0, "creation_date": 1560944287, "post_id": 56664836, "comment_id": 99901326, "body": "@VTT: <i>&quot;&#39;which means that it cannot modify the member variable items&#39; - it does not mean that&quot;</i> That&#39;s exactly what it means. A member function qualified with <code>const</code> has only <code>const</code> access to data members."}], "answers": [{"comments": [{"owner": {"reputation": 32386, "user_id": 4706785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdee2789e9bac57bfdd97abc4e533a4d?s=128&d=identicon&r=PG&f=1", "display_name": "Peter", "link": "https://stackoverflow.com/users/4706785/peter"}, "edited": false, "score": 0, "creation_date": 1560941914, "post_id": 56664919, "comment_id": 99899997, "body": "If it&#39;s really necessary for a <code>const</code> member function to return a non-<code>const</code> reference to a member, then that member can be made <code>mutable</code>.   No need to muck around with <code>const_cast</code> at all - and it reduces the risk of introducing undefined behaviour.    Of course, the circumstances where it makes sense to return a non-<code>const</code> reference to a member from a <code>const</code> function are pretty uncommon in practice."}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "reply_to_user": {"reputation": 32386, "user_id": 4706785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdee2789e9bac57bfdd97abc4e533a4d?s=128&d=identicon&r=PG&f=1", "display_name": "Peter", "link": "https://stackoverflow.com/users/4706785/peter"}, "edited": false, "score": 0, "creation_date": 1560943363, "post_id": 56664919, "comment_id": 99900774, "body": "@Peter yes, the example is rather contrived, and <code>mutable</code> would be the way to go, no reason for <code>const_cast</code>, no risk of ub, though the question wasnt really about how to return a mutable ref from a <code>const</code> method, so I didnt go into more detail in the answer"}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "reply_to_user": {"reputation": 32386, "user_id": 4706785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdee2789e9bac57bfdd97abc4e533a4d?s=128&d=identicon&r=PG&f=1", "display_name": "Peter", "link": "https://stackoverflow.com/users/4706785/peter"}, "edited": false, "score": 0, "creation_date": 1560943506, "post_id": 56664919, "comment_id": 99900867, "body": "@Peter added a PS to clarify"}], "tags": [], "owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "is_accepted": false, "score": 5, "last_activity_date": 1560943452, "last_edit_date": 1560943452, "creation_date": 1560938142, "answer_id": 56664919, "question_id": 56664836, "link": "https://stackoverflow.com/questions/56664836/understanding-const-cast-in-c/56664919#56664919", "title": "Understanding const_cast in C++", "body": "<p>It is not only unnecessary but it is plain wrong in that place. </p>\n\n<p>Consider what happens when you remove the <code>const</code> from the return type:</p>\n\n<pre><code>/*const*/ std::vector&lt;mv::Item&gt;&amp; mv::Workloads::getItems() const\n{\nreturn const_cast&lt;std::vector&lt;Item&gt;&amp;&gt;(items_);\n}\n</code></pre>\n\n<p>Now the method returns a non-const reference to a <code>const</code> object! Note that the method itself is declared as <code>const</code>, hence <code>this</code> is <code>const</code> in the context of this method and also <code>items_</code> is <code>const</code>. Using the reference returned by that method would lead to undefined behaviour when the method is called on a <code>const test</code> instance. </p>\n\n<p>In that sense, the only effect of the <code>const_cast</code> here is to potentially silence an important compiler error should you ever decide to change the return type. </p>\n\n<p>On the other hand, in the method as is (ie returning a <code>const</code> reference) there is no reason for the cast. <code>items_</code> is <code>const</code> and a <code>const</code> reference to it is returned. </p>\n\n<p><code>const_cast</code> is useful eg to avoid code duplication for <code>const</code> and non-<code>const</code> methods when you do know for sure that the object you cast <code>const</code> away really is not <code>const</code>, see <a href=\"https://stackoverflow.com/questions/123758/how-do-i-remove-code-duplication-between-similar-const-and-non-const-member-func/123995\">here</a> for details.</p>\n\n<p><strong>PS</strong>: in case you actually do want to return a mutable reference to a member from a <code>const</code> method, you would declare the member <code>mutable</code>. Also then no <code>const_cast</code> would be required. Though, <code>mutable</code> should be used with care and usually isnt needed in the first place.</p>\n"}, {"comments": [{"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "edited": false, "score": 0, "creation_date": 1560939423, "post_id": 56665153, "comment_id": 99898739, "body": "Furthermore, binding a const reference to a non const object would also be allowed, so it doesn&#39;t really matter whether the object is const or not."}], "tags": [], "owner": {"reputation": 820, "user_id": 1611543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1b5dfd5323c06552bcb9dce6ddf7feb?s=128&d=identicon&r=PG", "display_name": "Lorlin", "link": "https://stackoverflow.com/users/1611543/lorlin"}, "is_accepted": false, "score": 3, "last_activity_date": 1560938831, "creation_date": 1560938831, "answer_id": 56665153, "question_id": 56664836, "link": "https://stackoverflow.com/questions/56664836/understanding-const-cast-in-c/56665153#56665153", "title": "Understanding const_cast in C++", "body": "<p>It is not neccessary, simply return the <code>_items</code>.</p>\n\n<p>Const member functions see the the object itself (<code>*this</code>) as const, so every data member is seen as const, from which building and returning const reference is allowed.</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>#include &lt;iostream&gt;\nusing namespace std;\nclass test {\n\nstd::vector&lt;Item&gt; items_;\npublic:\nconst std::vector&lt;Item&gt;&amp; getItems() const;\n};\nconst std::vector&lt;mv::Item&gt;&amp; mv::Workloads::getItems() const\n{\nreturn items_;\n}\n</code></pre>\n"}], "owner": {"reputation": 319, "user_id": 11226898, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-suvAg66YwmA/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcIggdXEKD-19IaYC84ilb6AvEm8Q/mo/photo.jpg?sz=128", "display_name": "black sheep", "link": "https://stackoverflow.com/users/11226898/black-sheep"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1560943452, "creation_date": 1560937846, "last_edit_date": 1560938932, "question_id": 56664836, "link": "https://stackoverflow.com/questions/56664836/understanding-const-cast-in-c", "title": "Understanding const_cast in C++", "body": "<p>I am trying to to understand <code>const_cast</code>.</p>\n\n<p>In the example below, <code>items_</code> is a private member variable.</p>\n\n<p>The method <code>getItems()</code> is a <code>const</code> method, which means that it cannot modify the member variable <code>items_</code>.</p>\n\n<p><code>getItems()</code> returns a <code>const vector</code> reference which means that you cannot modify the member variable <code>items_</code>.</p>\n\n<p>My question is, is <code>const_cast</code> necessary here? I don't think so as I don't need to cast away constness?</p>\n\n<pre><code>#include &lt;iostream&gt;\n\nclass test {  \n  std::vector&lt;Item&gt; items_;\npublic:\n  const std::vector&lt;Item&gt;&amp; getItems() const;\n};\n\nconst std::vector&lt;mv::Item&gt;&amp; mv::Workloads::getItems() const\n{\n  return const_cast&lt;std::vector&lt;Item&gt;&amp;&gt;(items_);\n}\n</code></pre>\n"}, {"tags": ["c++", "raspberry-pi", "mqtt", "nodemcu", "esp32"], "comments": [{"owner": {"reputation": 2568, "user_id": 8548828, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C4qkl.png?s=128&g=1", "display_name": "Tarick Welling", "link": "https://stackoverflow.com/users/8548828/tarick-welling"}, "edited": false, "score": 0, "creation_date": 1560945076, "post_id": 56664817, "comment_id": 99901775, "body": "did you try to connect with a public mqtt server?"}, {"owner": {"reputation": 31, "user_id": 8531317, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mU4NTXU2H34/AAAAAAAAAAI/AAAAAAAAAAA/TZ8z6OGtgsc/photo.jpg?sz=128", "display_name": "Adarsh SR", "link": "https://stackoverflow.com/users/8531317/adarsh-sr"}, "reply_to_user": {"reputation": 2568, "user_id": 8548828, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C4qkl.png?s=128&g=1", "display_name": "Tarick Welling", "link": "https://stackoverflow.com/users/8548828/tarick-welling"}, "edited": false, "score": 0, "creation_date": 1560974827, "post_id": 56664817, "comment_id": 99917527, "body": "Actually problem solved . And I did it with MQTT server on rpi . I guess it&#39;s not public . So when these devices are in same network they are connecting and sending data but when in different network they are giving the error I mentioned above . Anyway thanks for your query @Tarick Welling .. that&#39;s where I had the issue."}], "owner": {"reputation": 31, "user_id": 8531317, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mU4NTXU2H34/AAAAAAAAAAI/AAAAAAAAAAA/TZ8z6OGtgsc/photo.jpg?sz=128", "display_name": "Adarsh SR", "link": "https://stackoverflow.com/users/8531317/adarsh-sr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1973, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1563963688, "creation_date": 1560937781, "last_edit_date": 1560938179, "question_id": 56664817, "link": "https://stackoverflow.com/questions/56664817/mqtt-software-caused-connection-abort-error", "title": "Mqtt &quot;Software caused connection abort&quot; error", "body": "<p>I am trying to send data from nodemcu(esp32) to raspberry pi using mqtt. After connecting Wifi network this error occurs. Error : Attempting MQTT connection...[E][WiFiClient.cpp:365] write(): fail on fd 55, errno: 113, \"Software caused connection abort\"\nfailed, rc=-4 try again in 5 seconds</p>\n\n<p>Nodemcu fails to connect to mosquitto mqtt broker running on raspberry pi. I have tried checking whether the 1883 port is open or if there is any issues on rpi mqtt broker. Found no issues there. Tried multiple libraries. But the result remains same.\nThis is the code that Iam using :</p>\n\n<pre><code>#include \"EspMQTTClient.h\"\n\nEspMQTTClient client(\n  \"XXXXX\",\n  \"XXXXX\",\n  \"XXXXXX\",  // MQTT Broker server ip\n     // Can be omitted if not needed\n     // Can be omitted if not needed\n  \"TestClient\",     // Client name that uniquely identify your device\n  1883              // The MQTT port, default to 1883. this line can be omitted\n);\n\nvoid setup()\n{\n  Serial.begin(9600);\n\n  // Optionnal functionnalities of EspMQTTClient : \n  client.enableDebuggingMessages(); // Enable debugging messages sent to serial output\n  client.enableHTTPWebUpdater(); // Enable the web updater. User and password default to values of MQTTUsername and MQTTPassword. These can be overrited with enableHTTPWebUpdater(\"user\", \"password\").\n  client.enableLastWillMessage(\"TestClient/lastwill\", \"I am going offline\");  // You can activate the retain flag by setting the third parameter to true\n}\n\n// This function is called once everything is connected (Wifi and MQTT)\n// WARNING : YOU MUST IMPLEMENT IT IF YOU USE EspMQTTClient\nvoid onConnectionEstablished()\n{\n  // Subscribe to \"mytopic/test\" and display received message to Serial\n  client.subscribe(\"refrigerator/temp\", [](const String &amp; payload) {\n    Serial.println(payload);\n  });\n\n  // Publish a message to \"mytopic/test\"\n  client.publish(\"refrigerator/temp\", \"Temp=34\"); // You can activate the retain flag by setting the third parameter to true\n\n  // Execute delayed instructions\n  client.executeDelayed(5 * 1000, []() {\n    client.publish(\"refrigerator/temp\", \"Temp=23\");\n  });\n}\n\nvoid loop()\n{\n  client.loop();\n}\n</code></pre>\n"}, {"tags": ["c++", "arrays", "multidimensional-array"], "comments": [{"owner": {"reputation": 695, "user_id": 9149062, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4decf954ed74739c4eb30a683ed7f5e5?s=128&d=identicon&r=PG&f=1", "display_name": "wohe1", "link": "https://stackoverflow.com/users/9149062/wohe1"}, "edited": false, "score": 0, "creation_date": 1560936532, "post_id": 56664313, "comment_id": 99897042, "body": "I think you should be fine by simply treating the multidimensional array as a flat one. (if you have <code>double a[5][5]</code>, then <code>a[8]</code> should return the value of <code>a[1][3]</code>)."}], "answers": [{"tags": [], "owner": {"reputation": 45749, "user_id": 21974, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/61d62f97373c96dea8ad1e774b127cdd?s=128&d=identicon&r=PG", "display_name": "ypnos", "link": "https://stackoverflow.com/users/21974/ypnos"}, "is_accepted": false, "score": 1, "last_activity_date": 1560936433, "creation_date": 1560936433, "answer_id": 56664375, "question_id": 56664313, "link": "https://stackoverflow.com/questions/56664313/how-to-convert-between-flat-and-multidimensional-arrays-without-copying-data/56664375#56664375", "title": "How to convert between flat and multidimensional arrays without copying data?", "body": "<p>I would assume the most popular way to do it is:</p>\n\n<p><code>double *flat = &amp;multi[0][0];</code></p>\n\n<p>This is how it is done in C, and you do operate with simple C arrays.</p>\n\n<p>You could also have a look at <code>std::array</code> in your use case (dimensions known at compile time), but that one is not multi-dimensional, so if you would cascade it, you would lose the contiguous layout.</p>\n"}, {"comments": [{"owner": {"reputation": 2722, "user_id": 531971, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/1dae62a5efd2fcf36a9571bf9f1a774a?s=128&d=identicon&r=PG", "display_name": "Hydrargyrum", "link": "https://stackoverflow.com/users/531971/hydrargyrum"}, "edited": false, "score": 0, "creation_date": 1560936562, "post_id": 56664381, "comment_id": 99897056, "body": "I need to convert back to a concrete multidimensional array type, rather than a pointer, for interoperation with external code which is supplying and expecting those."}], "tags": [], "owner": {"reputation": 119228, "user_id": 412080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/239e18525e4c29872d85b2b553b2e4d2?s=128&d=identicon&r=PG", "display_name": "Maxim Egorushkin", "link": "https://stackoverflow.com/users/412080/maxim-egorushkin"}, "is_accepted": false, "score": 1, "last_activity_date": 1560936447, "creation_date": 1560936447, "answer_id": 56664381, "question_id": 56664313, "link": "https://stackoverflow.com/questions/56664313/how-to-convert-between-flat-and-multidimensional-arrays-without-copying-data/56664381#56664381", "title": "How to convert between flat and multidimensional arrays without copying data?", "body": "<blockquote>\n  <p>What's the most correct and readable way to typecast between multidimensional and flat arrays of the same total size?</p>\n</blockquote>\n\n<p>The address of the first array element coincides with the address of the array. You can pass around the address of the first element, no casting is necessary.</p>\n"}, {"tags": [], "owner": {"reputation": 2234, "user_id": 3052438, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/X9OWu.png?s=128&g=1", "display_name": "NO_NAME", "link": "https://stackoverflow.com/users/3052438/no-name"}, "is_accepted": false, "score": 0, "last_activity_date": 1560937542, "creation_date": 1560937542, "answer_id": 56664747, "question_id": 56664313, "link": "https://stackoverflow.com/questions/56664313/how-to-convert-between-flat-and-multidimensional-arrays-without-copying-data/56664747#56664747", "title": "How to convert between flat and multidimensional arrays without copying data?", "body": "<p>You can use cast to a reference to an array. This require to use some fancy C++ type syntax but in return it allows to use all features that work on arrays, like for each loop.</p>\n\n<pre><code>#include &lt;iostream&gt;\n\nusing namespace std;\n\nint main()\n{\n    static constexpr size_t x = 5, y = 3;\n    unsigned multiArray[x][y];\n    for (size_t i = 0; i != x; ++i)\n        for (size_t j = 0; j != y; ++j)\n            multiArray[i][j] = i * j;\n\n    static constexpr size_t z = x * y;\n    unsigned (&amp;singleArray)[z] = (unsigned (&amp;)[z])multiArray[0][0];\n    for (const unsigned value : singleArray)\n        cout &lt;&lt; value &lt;&lt; ' ';\n    cout &lt;&lt; endl;\n\n    return 0;\n}\n</code></pre>\n\n<p>Take into account that this and other methods basing on casts work only with real multi-dimensional arrays. If it is an array of arrays (like <code>unsigned **multiArray;</code>), it isn't allocated in a continuous block of memory and a cast cannot bypass that.</p>\n"}, {"comments": [{"owner": {"reputation": 2234, "user_id": 3052438, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/X9OWu.png?s=128&g=1", "display_name": "NO_NAME", "link": "https://stackoverflow.com/users/3052438/no-name"}, "edited": false, "score": 0, "creation_date": 1561037453, "post_id": 56664911, "comment_id": 99939701, "body": "Aren&#39;t multidimensional arrays guaranteed to be in a continuous block of memory?"}, {"owner": {"reputation": 119882, "user_id": 3545273, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/RDWxl.png?s=128&g=1", "display_name": "Serge Ballesta", "link": "https://stackoverflow.com/users/3545273/serge-ballesta"}, "reply_to_user": {"reputation": 2234, "user_id": 3052438, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/X9OWu.png?s=128&g=1", "display_name": "NO_NAME", "link": "https://stackoverflow.com/users/3052438/no-name"}, "edited": false, "score": 0, "creation_date": 1561037643, "post_id": 56664911, "comment_id": 99939813, "body": "Yes they are. But that is not enough <i>according to the wordings of the standard</i> to make that an array. Long story short, an array is required to be a contiguous bloc of elements, but being a contiguous bloc does not constitute a declared array."}, {"owner": {"reputation": 2234, "user_id": 3052438, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/X9OWu.png?s=128&g=1", "display_name": "NO_NAME", "link": "https://stackoverflow.com/users/3052438/no-name"}, "edited": false, "score": 0, "creation_date": 1561038321, "post_id": 56664911, "comment_id": 99940221, "body": "That&#39;s interesting. Still, I cannot think of anything that could go wrong here. I believe that they woudn&#39;t write anything to the standard unless they have a good reason but, perhaps, it is just an oversight. Or they explicitly stated that this kind of array conversion is not allowed?"}, {"owner": {"reputation": 119882, "user_id": 3545273, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/RDWxl.png?s=128&g=1", "display_name": "Serge Ballesta", "link": "https://stackoverflow.com/users/3545273/serge-ballesta"}, "reply_to_user": {"reputation": 2234, "user_id": 3052438, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/X9OWu.png?s=128&g=1", "display_name": "NO_NAME", "link": "https://stackoverflow.com/users/3052438/no-name"}, "edited": false, "score": 1, "creation_date": 1561041626, "post_id": 56664911, "comment_id": 99942336, "body": "AFAIK, nothing explicitely states that it is incorrect. Simply as it is not defined, using it implies undefined behaviour... Of course, it used to be common in old C code, and in order not to break large code base, compilers still accept it. It is up to you to know whether you want to use that in new code..."}], "tags": [], "owner": {"reputation": 119882, "user_id": 3545273, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/RDWxl.png?s=128&g=1", "display_name": "Serge Ballesta", "link": "https://stackoverflow.com/users/3545273/serge-ballesta"}, "is_accepted": true, "score": 2, "last_activity_date": 1560938119, "creation_date": 1560938119, "answer_id": 56664911, "question_id": 56664313, "link": "https://stackoverflow.com/questions/56664313/how-to-convert-between-flat-and-multidimensional-arrays-without-copying-data/56664911#56664911", "title": "How to convert between flat and multidimensional arrays without copying data?", "body": "<p>The <em>most correct</em> way has been given by @Maxim Egorushkin and @ypnos: <code>double *flat = &amp;multi[0][0];</code>. And it will work fine with any decent compiler. But unfortunately is not valid C++ code and invokes Undefined Bahaviour.</p>\n\n<p>The problem is that for an array <code>double multi[N][M];</code> (<code>N</code> and <code>M</code> being compile time contant expressions), <code>&amp;multi[0][0]</code> is the address of the first element of an array of size <code>M</code>. So it is legal to do pointer arithmetics only up to <code>M</code>. See this other <a href=\"https://stackoverflow.com/q/42951932/3545273\">question of mine</a> for more details.</p>\n"}], "owner": {"reputation": 2722, "user_id": 531971, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/1dae62a5efd2fcf36a9571bf9f1a774a?s=128&d=identicon&r=PG", "display_name": "Hydrargyrum", "link": "https://stackoverflow.com/users/531971/hydrargyrum"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 56664911, "answer_count": 4, "score": 1, "last_activity_date": 1560938119, "creation_date": 1560936250, "last_edit_date": 1560936470, "question_id": 56664313, "link": "https://stackoverflow.com/questions/56664313/how-to-convert-between-flat-and-multidimensional-arrays-without-copying-data", "title": "How to convert between flat and multidimensional arrays without copying data?", "body": "<p>I've got some data structured as a multi-dimensional array, i.e. <code>double[][]</code>, and I need to pass it to a function that expects a single linear array of <code>double[]</code> along with dimensional metadata for the multi-dimensional representation.</p>\n\n<p>For example, I might have a 3 x 5 multidimensional array, which I need to pass as a 15-element flat array along with height and width parameters so that the function knows it is a 3x5 array rather than a 5x3 array.</p>\n\n<p>The function will then return a flat array and size metadata, which I need to use to convert the data back into a multidimensional type.</p>\n\n<p>I believe the data layout in memory is exactly the same for both the flat and multi-dimensional representations; the only difference is how the indexing operations are performed. So I'd like to do the \"conversion\" with typecasting rather than copying the array values.</p>\n\n<p>What's the most correct and readable way to typecast between multidimensional and flat arrays of the same total size?</p>\n\n<p>I actually know what the dimensions of the multi-dimensional array will be at compile time. The array sizes aren't dynamic.</p>\n"}, {"tags": ["c++", "c"], "comments": [{"owner": {"reputation": 13124, "user_id": 1419272, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dcbff46aa5cd0a98d13d76595b3375f0?s=128&d=identicon&r=PG", "display_name": "alinsoar", "link": "https://stackoverflow.com/users/1419272/alinsoar"}, "edited": false, "score": 1, "creation_date": 1560936615, "post_id": 56664281, "comment_id": 99897093, "body": "the only chance to define different types in function of architecture is by using conditional  #define"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 5, "creation_date": 1560936619, "post_id": 56664281, "comment_id": 99897096, "body": "Portability is a big topic. Regarding types specifically, you should be using <code>stdint.h</code> and pick the type for each variable with care. Porting code containing small integer types to 8 bit MCUs takes quite a lot of C skill - why I recommend all beginners to stay clear of crap like Arduino."}, {"owner": {"reputation": 32176, "user_id": 2173773, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/M8yh6.jpg?s=128&g=1", "display_name": "H&#229;kon H&#230;gland", "link": "https://stackoverflow.com/users/2173773/h%c3%a5kon-h%c3%a6gland"}, "edited": false, "score": 0, "creation_date": 1560936705, "post_id": 56664281, "comment_id": 99897145, "body": "See also <a href=\"https://stackoverflow.com/q/47697926/2173773\">BYTE, WORD and DWORD macros definition</a>"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1560937328, "post_id": 56664281, "comment_id": 99897509, "body": "Oh and also, keeping code portable between C and C++ is another major pain... so you might want to settle for pure C, as that gets significantly easier to port. Except then you can&#39;t port to Arduino..."}, {"owner": {"reputation": 6746, "user_id": 1143634, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/e7lca.png?s=128&g=1", "display_name": "StaceyGirl", "link": "https://stackoverflow.com/users/1143634/staceygirl"}, "edited": false, "score": 2, "creation_date": 1560937473, "post_id": 56664281, "comment_id": 99897590, "body": "It is impossible and doesn&#39;t make sense to support <i>every platform</i>. Your code is never &quot;portable&quot; or &quot;not-portable&quot;, it is always portable to some degree which can be measured as a number of supported platforms. You need to understand what platforms you need to support before you start writing &quot;portable&quot; code."}, {"owner": {"reputation": 32386, "user_id": 4706785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdee2789e9bac57bfdd97abc4e533a4d?s=128&d=identicon&r=PG&f=1", "display_name": "Peter", "link": "https://stackoverflow.com/users/4706785/peter"}, "edited": false, "score": 2, "creation_date": 1560937777, "post_id": 56664281, "comment_id": 99897769, "body": "First, decide if you are using C or C++ - coding to a &quot;common subset&quot; of the two makes portability harder to achieve. Use standard types (built-in or in the standard library) where you can, or types that can be created using them (structures, pointers, etc) - but account for implementation-defined properties. Failing that, use types that the standard specifies, but that are not guaranteed for all compilers (e.g. <code>int64_t</code>).  If you must define types differently for different compilers, do it sparingly, and use the preprocessor to detect each compiler and do definitions accordingly."}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "edited": false, "score": 3, "creation_date": 1560939589, "post_id": 56664281, "comment_id": 99898836, "body": "What do you expect from a type called <code>word</code>?"}, {"owner": {"reputation": 32386, "user_id": 4706785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdee2789e9bac57bfdd97abc4e533a4d?s=128&d=identicon&r=PG&f=1", "display_name": "Peter", "link": "https://stackoverflow.com/users/4706785/peter"}, "edited": false, "score": 0, "creation_date": 1560940396, "post_id": 56664281, "comment_id": 99899256, "body": "@eeronika - personally, I&#39;d expect to be able to check variables of that type with a spell-checker.  ;-)"}], "answers": [{"comments": [{"owner": {"reputation": 32386, "user_id": 4706785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdee2789e9bac57bfdd97abc4e533a4d?s=128&d=identicon&r=PG&f=1", "display_name": "Peter", "link": "https://stackoverflow.com/users/4706785/peter"}, "edited": false, "score": 1, "creation_date": 1560937404, "post_id": 56664618, "comment_id": 99897552, "body": "<code>bool</code> is not a reserved keyword in C.  It is in C++."}, {"owner": {"reputation": 1199, "user_id": 6356744, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0c12512db0046c6637c3e4b084cff575?s=128&d=identicon&r=PG&f=1", "display_name": "tttapa", "link": "https://stackoverflow.com/users/6356744/tttapa"}, "reply_to_user": {"reputation": 32386, "user_id": 4706785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdee2789e9bac57bfdd97abc4e533a4d?s=128&d=identicon&r=PG&f=1", "display_name": "Peter", "link": "https://stackoverflow.com/users/4706785/peter"}, "edited": false, "score": 0, "creation_date": 1560937553, "post_id": 56664618, "comment_id": 99897636, "body": "@Peter You&#39;re right, I just assumed C++ here because it was the first tag, I updated my answer :)"}, {"owner": {"reputation": 75, "user_id": 5506984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3790e63edf14b2f538cf9bd1ea4705a?s=128&d=identicon&r=PG&f=1", "display_name": "Hneel", "link": "https://stackoverflow.com/users/5506984/hneel"}, "edited": false, "score": 0, "creation_date": 1561022279, "post_id": 56664618, "comment_id": 99931265, "body": "I&#39;ve decided to gonna use a section for each known compiler, like in the example."}], "tags": [], "owner": {"reputation": 1199, "user_id": 6356744, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0c12512db0046c6637c3e4b084cff575?s=128&d=identicon&r=PG&f=1", "display_name": "tttapa", "link": "https://stackoverflow.com/users/6356744/tttapa"}, "is_accepted": true, "score": 5, "last_activity_date": 1560937511, "last_edit_date": 1560937511, "creation_date": 1560937157, "answer_id": 56664618, "question_id": 56664281, "link": "https://stackoverflow.com/questions/56664281/how-to-write-generic-compiler-independent-code/56664618#56664618", "title": "How to write generic compiler-independent code?", "body": "<p>All platforms should support <code>bool</code> as it is a reserved keyword for a built-in type in C++.</p>\n\n<p>The only platform I know of that has <code>byte</code> and <code>word</code> is Arduino. They are just typedef'ed aliases to <code>uint8_t</code> and <code>unsigned int</code> respectively. (<a href=\"https://github.com/arduino/ArduinoCore-avr/blob/b7c607663fecc232e598f2c0acf419ceb0b7078c/cores/arduino/Arduino.h#L121\" rel=\"noreferrer\">Source</a>)</p>\n\n<p>If you have existing Arduino code that uses <code>byte</code> and <code>word</code>, the easiest solution would be to check if your code runs in the Arduino environment, and define the Arduino types yourself if that's not the case:</p>\n\n<pre><code>#ifdef ARDUINO\n#include &lt;Arduino.h&gt;\n#else\n#include &lt;cstdint&gt;\ntypedef uint16_t word; // or unsigned int, depending on your needs\ntypedef uint8_t byte;\n#endif\n</code></pre>\n\n<p>However, my preferred solution is to just use the standard integers of <code>stdint.h</code> directly when I need a specific number of bits. Using <code>byte</code> and <code>word</code> just adds to the confusion, because it is non-standard. <code>uint16_t</code> tells you exactly what it is, you know exactly what the largest possible value is, and whether it's signed or not.</p>\n"}], "owner": {"reputation": 75, "user_id": 5506984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3790e63edf14b2f538cf9bd1ea4705a?s=128&d=identicon&r=PG&f=1", "display_name": "Hneel", "link": "https://stackoverflow.com/users/5506984/hneel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "accepted_answer_id": 56664618, "answer_count": 1, "score": 1, "last_activity_date": 1560937511, "creation_date": 1560936158, "question_id": 56664281, "link": "https://stackoverflow.com/questions/56664281/how-to-write-generic-compiler-independent-code", "title": "How to write generic compiler-independent code?", "body": "<p>In my work I work with many different compilers for many platforms (Windows, embedded microcontrollers, Arduino, etc). \nNow I want to write a generic routine that should work with all of them, but I'm getting conflicts with data types.\nIt's mostly low-level stuff, so I would like to work with types like 'byte', 'word', 'bool' etc.</p>\n\n<p>For some compilers these types are not yet defined, but for some they are and in these cases that will result in errors of conflicting types.</p>\n\n<p>I have learned that typedef are prefered above #define. \nAnd in <a href=\"https://stackoverflow.com/questions/6772802/in-c-c-is-there-a-directive-similar-to-ifndef-for-typedefs\">this question</a> it is made clear that there is no way to make a conditional typedef. </p>\n\n<p>I already thought of using unique types like for example:</p>\n\n<pre><code>typedef unsigned char mybyte\ntypedef unsigned short int myword\netc...\n</code></pre>\n\n<p>But that would make my sourcecode look very ugly IMHO.</p>\n"}, {"tags": ["c++", "assembly", "g++"], "comments": [{"owner": {"reputation": 1636, "user_id": 3370124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73352b4adb282c092738f34883488dd?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Critten", "link": "https://stackoverflow.com/users/3370124/richard-critten"}, "edited": false, "score": 0, "creation_date": 1560935287, "post_id": 56663701, "comment_id": 99896362, "body": "Try compiling with optimizations on.  Slightly modified live: <a href=\"https://godbolt.org/z/4pio0o\" rel=\"nofollow noreferrer\">godbolt.org/z/4pio0o</a> (to ensure <code>a</code> is used)"}, {"owner": {"reputation": 12749, "user_id": 7976805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92a559df8b4b287aad23724b4c66d67c?s=128&d=identicon&r=PG&f=1", "display_name": "Yksisarvinen", "link": "https://stackoverflow.com/users/7976805/yksisarvinen"}, "edited": false, "score": 1, "creation_date": 1560935320, "post_id": 56663701, "comment_id": 99896377, "body": "This seems to be only added if <code>fetch_add()</code> is used on the object, even though godbolt marks it as result of declaration of <code>std::atomic</code>. No idea what it is though. <a href=\"https://godbolt.org/z/6p89Xd\" rel=\"nofollow noreferrer\">godbolt.org/z/6p89Xd</a>"}, {"owner": {"reputation": 2357, "user_id": 4074081, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/emDh4.png?s=128&g=1", "display_name": "dewaffled", "link": "https://stackoverflow.com/users/4074081/dewaffled"}, "edited": false, "score": 2, "creation_date": 1560939405, "post_id": 56663701, "comment_id": 99898724, "body": "I suspect, <code>5</code> is the value of <a href=\"https://github.com/gcc-mirror/gcc/blob/master/libstdc%2B%2B-v3/include/bits/atomic_base.h#L80\" rel=\"nofollow noreferrer\">memory_order_seq_cst</a> mode."}], "answers": [{"comments": [{"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1560961909, "post_id": 56665439, "comment_id": 99911840, "body": "<code>-O0</code> is the default, and obviously what the OP used when compiling.  (You can tell from making a frame pointer, using <code>mov eax,0</code> instead of <code>xor eax,eax</code>, and not optimizing to <code>lock add</code> instead of <code>xadd</code> when the result of <code>fetch_add</code> isn&#39;t used.)"}, {"owner": {"reputation": 447, "user_id": 6071697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ea2947bcc835bb3b6ab9ca5303272b8b?s=128&d=identicon&r=PG&f=1", "display_name": "Epic", "link": "https://stackoverflow.com/users/6071697/epic"}, "edited": false, "score": 0, "creation_date": 1561018887, "post_id": 56665439, "comment_id": 99929529, "body": "If <code>fetch_add</code> is compiled to <code>lock xadd</code>, does this mean that <code>enum memory_order</code> is not used?"}], "tags": [], "owner": {"reputation": 55059, "user_id": 212858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1166c87b6f3fc2e6746da96b60fefb46?s=128&d=identicon&r=PG", "display_name": "Useless", "link": "https://stackoverflow.com/users/212858/useless"}, "is_accepted": true, "score": 4, "last_activity_date": 1560939734, "creation_date": 1560939734, "answer_id": 56665439, "question_id": 56663701, "link": "https://stackoverflow.com/questions/56663701/why-does-std-atomic-insert-5-to-the-stack/56665439#56665439", "title": "Why does std atomic insert 5 to the stack", "body": "<p>If you take the godbolt link Richard Critten very helpfully posted in a comment, and change the GCC command line to use <code>-O0</code>, the literal 5 reappears. Tellingly, it also shows up in</p>\n\n<pre><code>std::__atomic_base&lt;int&gt;::operator int() const:\n        push    rbp\n        mov     rbp, rsp\n        sub     rsp, 32\n        ...\n        mov     DWORD PTR [rbp-12], 5\n        mov     eax, DWORD PTR [rbp-12]\n        mov     esi, 65535\n        mov     edi, eax\n        call    std::operator&amp;(std::memory_order, std::__memory_order_modifier)\n</code></pre>\n\n<p>so the literal <code>5</code> is eventually passed as an argument to that call, in <code>%edi</code>.</p>\n\n<p>Since the argument is <code>std::memory_order</code>, we can look at the <a href=\"https://en.cppreference.com/w/cpp/atomic/memory_order\" rel=\"nofollow noreferrer\">documentation</a> and see</p>\n\n<pre><code>typedef enum memory_order {\n    memory_order_relaxed,\n    memory_order_consume,\n    memory_order_acquire,\n    memory_order_release,\n    memory_order_acq_rel,\n    memory_order_seq_cst\n} memory_order;\n</code></pre>\n\n<p>which, literally implemented, will give <code>memory_order_seq_cst = 5</code>.</p>\n\n<p>Note that <code>memory_order_seq_cst</code> is the default for <a href=\"https://en.cppreference.com/w/cpp/atomic/atomic/fetch_add\" rel=\"nofollow noreferrer\"><code>fetch_add</code></a>'s ordering parameter, so you'd expect to see it passed as an argument.</p>\n"}], "owner": {"reputation": 447, "user_id": 6071697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ea2947bcc835bb3b6ab9ca5303272b8b?s=128&d=identicon&r=PG&f=1", "display_name": "Epic", "link": "https://stackoverflow.com/users/6071697/epic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 668, "favorite_count": 0, "accepted_answer_id": 56665439, "answer_count": 1, "score": 4, "last_activity_date": 1560939734, "creation_date": 1560934329, "last_edit_date": 1560936022, "question_id": 56663701, "link": "https://stackoverflow.com/questions/56663701/why-does-std-atomic-insert-5-to-the-stack", "title": "Why does std atomic insert 5 to the stack", "body": "<p>I wanted to see how <code>std::atomic</code> is translated to assembly. To do that I wrote the following code but there is something I do not understand.</p>\n\n<p>The following code:</p>\n\n<pre><code>int main(void)\n{\n    std::atomic&lt;int&gt; a;\n    a.fetch_add(0);\n    return 0;\n}\n</code></pre>\n\n<p>Is compiled by GCC to:</p>\n\n<pre><code>1 |  push    rbp\n2 |  mov     rbp, rsp\n3 |  mov     DWORD PTR [rbp-4], 0\n4 |  mov     DWORD PTR [rbp-8], 5\n5 |  mov     edx, DWORD PTR [rbp-4]\n6 |  lea     rax, [rbp-12]\n7 |  lock xadd       DWORD PTR [rax], edx\n8 |  mov     eax, 0\n9 |  pop     rbp\n10|  ret\n</code></pre>\n\n<p>Why does GCC push \"5\" (on line 4) onto the stack?</p>\n"}, {"tags": ["c++", "boost", "introspection", "typetraits", "member-functions"], "answers": [{"tags": [], "owner": {"reputation": 2569, "user_id": 1922763, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/75228956a9f2a90a98b473672b91d807?s=128&d=identicon&r=PG", "display_name": "Takatoshi Kondo", "link": "https://stackoverflow.com/users/1922763/takatoshi-kondo"}, "is_accepted": false, "score": 0, "last_activity_date": 1561795403, "creation_date": 1561795403, "answer_id": 56816014, "question_id": 56663584, "link": "https://stackoverflow.com/questions/56663584/how-to-check-callable-member-function-existence-of-derived-class/56816014#56816014", "title": "How to check callable member function existence of derived class?", "body": "<p>This is not a perfect answer but I achieve my goal introducing one convention.\nAdding base class alias as member type that has a specific name. In my example, the name is <code>base</code>.</p>\n\n<p>Boost.TTI only check the target class, so if the target class doesn't have <code>base</code> then simply returns member function checked result. Otherwise, if the target class has the member function, then return true, if it doesn't applay the same process for <code>base</code> type.</p>\n\n<p>Here is complete example:</p>\n\n<pre><code>#include &lt;utility&gt;\n\n#include &lt;boost/tti/has_member_function.hpp&gt;\n#include &lt;boost/tti/has_type.hpp&gt;\n\nBOOST_TTI_HAS_TYPE(base);\n\nBOOST_TTI_HAS_MEMBER_FUNCTION(func1);\nBOOST_TTI_HAS_MEMBER_FUNCTION(func2);\n\nstruct b1 {\n    void func1() {}\n};\n\nstruct b2 {\n};\n\nstruct d1 : b1 {\n    using base = b1; // This convention is required\n};\n\nstruct d2 : b2 {\n    using base = b2;\n    void func1() {}\n};\n\ntemplate &lt;template &lt;typename...&gt; typename Func, typename T, typename... Params&gt;\nconstexpr bool recursive_apply() {\n    if constexpr(has_type_base&lt;T&gt;::value) {\n        return\n            Func&lt;T, Params...&gt;::value ||\n            recursive_apply&lt;Func, typename T::base, Params...&gt;();\n    }\n    else {\n        return Func&lt;T, Params...&gt;::value;\n    }\n}\n\nint main() {\n    static_assert( recursive_apply&lt;has_member_function_func1, b1, void&gt;());\n    static_assert( recursive_apply&lt;has_member_function_func1, d1, void&gt;());\n\n    static_assert(!recursive_apply&lt;has_member_function_func2, b1, void&gt;());\n    static_assert(!recursive_apply&lt;has_member_function_func2, d1, void&gt;());\n\n    static_assert(!recursive_apply&lt;has_member_function_func1, b2, void&gt;());\n    static_assert( recursive_apply&lt;has_member_function_func1, d2, void&gt;());\n}\n</code></pre>\n\n<p>Running Demo: <a href=\"https://wandbox.org/permlink/IFFzenEFWX4GY8OD\" rel=\"nofollow noreferrer\">https://wandbox.org/permlink/IFFzenEFWX4GY8OD</a></p>\n\n<p>I use C++17 feature <code>if constexpr</code>. I tried to replace it with template partial specilization with SFINAE. But I couldn't do that, so far. The problem is template template parameter can't deduced in partial specialization.</p>\n\n<p>This answer works well with C++17 and one convention <code>base</code>.</p>\n"}], "owner": {"reputation": 2569, "user_id": 1922763, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/75228956a9f2a90a98b473672b91d807?s=128&d=identicon&r=PG", "display_name": "Takatoshi Kondo", "link": "https://stackoverflow.com/users/1922763/takatoshi-kondo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 216, "favorite_count": 2, "answer_count": 1, "score": 1, "last_activity_date": 1561795403, "creation_date": 1560933935, "question_id": 56663584, "link": "https://stackoverflow.com/questions/56663584/how-to-check-callable-member-function-existence-of-derived-class", "title": "How to check callable member function existence of derived class?", "body": "<p>I'm using <a href=\"https://www.boost.org/doc/libs/1_70_0/libs/tti/doc/html/the_type_traits_introspection_library/tti_detail_has_member_function.html\" rel=\"nofollow noreferrer\">Boost.TTI</a> to check member function existence. I want to check not only existing functions but also non existing functions.</p>\n\n<p>Boost.TTI doesn't seem to work for derived classes even if I use <code>using</code> the target member functions.</p>\n\n<pre><code>#include &lt;boost/tti/has_member_function.hpp&gt;\n\nBOOST_TTI_HAS_MEMBER_FUNCTION(func1);\nBOOST_TTI_HAS_MEMBER_FUNCTION(func2);\n\nstruct base {\n    void func1() {}\n};\n\nstruct derived : base {\n};\n\nstruct derived_using : base {\n    using base::func1;\n};\n\nint main() {\n    static_assert( has_member_function_func1&lt;base, void&gt;::value);\n    static_assert(!has_member_function_func2&lt;base, void&gt;::value);\n\n    static_assert( has_member_function_func1&lt;derived, void&gt;::value); // error\n    static_assert(!has_member_function_func2&lt;derived, void&gt;::value);\n\n    static_assert( has_member_function_func1&lt;derived_using, void&gt;::value); // error\n    static_assert(!has_member_function_func2&lt;derived_using, void&gt;::value);\n}\n</code></pre>\n\n<p>Runnin Demo: <a href=\"https://wandbox.org/permlink/5XkyCoeo0xEGVm3M\" rel=\"nofollow noreferrer\">https://wandbox.org/permlink/5XkyCoeo0xEGVm3M</a></p>\n\n<p>I want to check the member function, not any elements (types, variables) that has the name such as <code>func1</code> <code>func2</code>.</p>\n\n<p>Also I tried <code>std::is_invocable</code>. It works as I expected for derived class but compile error happens for non existing functions.</p>\n\n<pre><code>#include &lt;type_traits&gt;\n\nstruct base {\n    void func1() {}\n};\n\nstruct derived : base {\n};\n\nint main() {\n    static_assert( std::is_invocable&lt;decltype(&amp;base::func1), base&gt;::value);\n    static_assert(!std::is_invocable&lt;decltype(&amp;base::func2), base&gt;::value);\n\n    static_assert( std::is_invocable&lt;decltype(&amp;derived::func1), derived&gt;::value);\n    static_assert(!std::is_invocable&lt;decltype(&amp;derived::func2), derived&gt;::value);\n}\n</code></pre>\n\n<p>Running Demo: <a href=\"https://wandbox.org/permlink/3v9H0CFVxPnfGj3t\" rel=\"nofollow noreferrer\">https://wandbox.org/permlink/3v9H0CFVxPnfGj3t</a></p>\n\n<p>Is there any good way to check a member function existence that supports both derived classes and non existence member functions.</p>\n"}, {"tags": ["c++", "mfc"], "comments": [{"owner": {"reputation": 5085, "user_id": 1181353, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/zqKlZ.jpg?s=128&g=1", "display_name": "Joseph Willcoxson", "link": "https://stackoverflow.com/users/1181353/joseph-willcoxson"}, "edited": false, "score": 1, "creation_date": 1560952538, "post_id": 56663558, "comment_id": 99906367, "body": "Why are you adding what maybe appears to be message map entries for IDOK and IDCANCEL? There are already virtual functions that you can overreid for OnOK() and OnCancel() that are in the CDialog class."}, {"owner": {"reputation": 31, "user_id": 11664675, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LbqMP.jpg?s=128&g=1", "display_name": "Najat Ismail", "link": "https://stackoverflow.com/users/11664675/najat-ismail"}, "reply_to_user": {"reputation": 5085, "user_id": 1181353, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/zqKlZ.jpg?s=128&g=1", "display_name": "Joseph Willcoxson", "link": "https://stackoverflow.com/users/1181353/joseph-willcoxson"}, "edited": false, "score": 0, "creation_date": 1560952731, "post_id": 56663558, "comment_id": 99906507, "body": "Thank you the problem is solved now."}], "owner": {"reputation": 31, "user_id": 11664675, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LbqMP.jpg?s=128&g=1", "display_name": "Najat Ismail", "link": "https://stackoverflow.com/users/11664675/najat-ismail"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1048, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1560965524, "creation_date": 1560933866, "last_edit_date": 1560965524, "question_id": 56663558, "link": "https://stackoverflow.com/questions/56663558/my-mfc-control-buttons-in-my-mfc-dialog-are-not-working", "title": "My MFC control buttons in my MFC dialog are not working", "body": "<p>My <code>OK</code> and <code>Cancel</code> buttons stopped working after I've added tab dialog to my main dialog.</p>\n\n<pre><code>void CFirstMfcProjectDlg::OnBnClickedOk()\n{\n    // TODO: Add your control notification handler code here\n    CDialogEx::OnOK();\n}\n\n\nvoid CFirstMfcProjectDlg::OnBnClickedCancel()\n{\n    // TODO: Add your control notification handler code here\n    CDialogEx::OnCancel();\n}\n</code></pre>\n\n<p>These are the tabs that I've created:</p>\n\n<pre><code>    m_Dialog[0]-&gt;Create(m_DialogID[0], this);\n    m_Dialog[1]-&gt;Create(m_DialogID[1], this);\n    m_Dialog[2]-&gt;Create(m_DialogID[2], this);\n</code></pre>\n"}, {"tags": ["c++", "multithreading", "mfc"], "comments": [{"owner": {"reputation": 1499, "user_id": 1372577, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4819b4e5fd753e26319b41b632182e0?s=128&d=identicon&r=PG", "display_name": "Constantine Georgiou", "link": "https://stackoverflow.com/users/1372577/constantine-georgiou"}, "edited": false, "score": 1, "creation_date": 1560962581, "post_id": 56663519, "comment_id": 99912121, "body": "Both dialogs you create this way belong to the main (UI) thread. <code>EndDialog()</code> must be called from within the &quot;dialog procedure&quot;, and this runs in the main thread too. So the problem seems to be that you call <code>EndDialog()</code> from the download thread. An easy workaround (and imo technically correct) could be to post a custom message (eg <code>WM_APP + nn</code>) from the download thread to the dialog window, when the download completes or fails. In response to this message you can call <code>EndDialog()</code> with the desired return value."}], "answers": [{"tags": [], "owner": {"reputation": 2033, "user_id": 9250490, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-HV9vU_hCaQI/AAAAAAAAAAI/AAAAAAAAACg/Ue4zHkbC6Mc/photo.jpg?sz=128", "display_name": "Zhang", "link": "https://stackoverflow.com/users/9250490/zhang"}, "is_accepted": false, "score": 0, "last_activity_date": 1560965626, "last_edit_date": 1560965626, "creation_date": 1560934175, "answer_id": 56663654, "question_id": 56663519, "link": "https://stackoverflow.com/questions/56663519/how-do-i-close-a-mfc-modal-dialog-in-another-thread-and-can-get-the-dialog-retur/56663654#56663654", "title": "How do I close a MFC Modal Dialog in another thread and can get the dialog return value?", "body": "<p>Maybe this is a workaround.</p>\n\n<p><a href=\"https://stackoverflow.com/questions/6111809/can-i-return-a-custom-value-from-a-dialog-boxs-domodal-function\">Can I return a custom value from a dialog box&#39;s DoModal function?</a></p>\n\n<p>Don't use the DoModal's return value. Just add a member function for <code>CProgressBarTest</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 14021, "user_id": 7571258, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/fBP6e.png?s=128&g=1", "display_name": "zett42", "link": "https://stackoverflow.com/users/7571258/zett42"}, "is_accepted": true, "score": 2, "last_activity_date": 1561114933, "last_edit_date": 1561114933, "creation_date": 1561114581, "answer_id": 56702064, "question_id": 56663519, "link": "https://stackoverflow.com/questions/56663519/how-do-i-close-a-mfc-modal-dialog-in-another-thread-and-can-get-the-dialog-retur/56702064#56702064", "title": "How do I close a MFC Modal Dialog in another thread and can get the dialog return value?", "body": "<p>Post an <a href=\"https://docs.microsoft.com/en-us/windows/desktop/winmsg/wm-app\" rel=\"nofollow noreferrer\">application-defined message</a> from the download thread to your main GUI thread like this:</p>\n\n<pre><code>BOOL CProgressBarTest::OnInitDialog()\n{\n    CDialog::OnInitDialog();\n\n    auto funDownload = []( HWND hwnd ){\n        auto const downloadRetValue = ::SomeDownloadAPI(funDownloadCallback);\n\n        ::PostMessage( hwnd, WM_APP_DOWNLOAD_FINISHED, static_cast&lt;WPARAM&gt;( downloadRetValue ), 0 );\n    };\n\n    m_thDownload = std::thread(funDownload, GetSafeHwnd());\n\n    return TRUE;\n}\n</code></pre>\n\n<p><strong>Note 1:</strong> I'm using <code>OnInitDialog()</code> to launch the thread because <code>DoDataExchange()</code> is a really bad choice as it will be called multiple times. <code>OnInitDialog()</code> will be called exactly once.</p>\n\n<p><strong>Note 2:</strong> A captureless lambda is used to better decouple the download thread from the GUI thread. Passing <code>this</code> from a GUI dialog to a worker thread is a recipe for disaster as it makes it so tempting to just write to GUI thread variables, ignoring required synchronization. Apart from that, less coupling comes with less dependencies which is always a good thing.</p>\n\n<p>What is <code>WM_APP_DOWNLOAD_FINISHED</code>? This is my <a href=\"https://docs.microsoft.com/en-us/windows/desktop/winmsg/wm-app\" rel=\"nofollow noreferrer\">application-defined message ID</a> which I usually define like this:</p>\n\n<pre><code>enum {\n    WM_APP_0 = WM_APP,\n    WM_APP_DOWNLOAD_FINISHED\n    // for future extension...\n};\n</code></pre>\n\n<p>Add a message map entry:</p>\n\n<pre><code>BEGIN_MESSAGE_MAP(CProgressBarTest, CDialog)\n    ON_MESSAGE( WM_APP_DOWNLOAD_FINISHED, &amp;CProgressBarTest::OnDownloadFinished )\nEND_MESSAGE_MAP()\n</code></pre>\n\n<p>And define the message handler to return a value from the dialog that depends on the download result:</p>\n\n<pre><code>LRESULT CProgressBarTest::OnDownloadFinished( WPARAM wp, LPARAM lp ) \n{    \n    m_thDownload.join();\n\n    auto const downloadRetValue = wp;\n    EndDialog( downloadRetValue == ERROR_SUCCESS ? IDYES : IDCANCEL );\n\n    return 0; \n}\n</code></pre>\n\n<p>Make sure to <code>join()</code> the thread as I did above to avoid a crash in the <code>std::thread</code> destructor, which requires that the thread has been joined.</p>\n"}], "owner": {"reputation": 2033, "user_id": 9250490, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-HV9vU_hCaQI/AAAAAAAAAAI/AAAAAAAAACg/Ue4zHkbC6Mc/photo.jpg?sz=128", "display_name": "Zhang", "link": "https://stackoverflow.com/users/9250490/zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 512, "favorite_count": 0, "accepted_answer_id": 56702064, "answer_count": 2, "score": 0, "last_activity_date": 1561114933, "creation_date": 1560933722, "question_id": 56663519, "link": "https://stackoverflow.com/questions/56663519/how-do-i-close-a-mfc-modal-dialog-in-another-thread-and-can-get-the-dialog-retur", "title": "How do I close a MFC Modal Dialog in another thread and can get the dialog return value?", "body": "<p>I have a MFC dialog project. There is a download button in the main dialog, click it would prompt a progress bar and start download. When the download finished, I want to it closed automatically.</p>\n\n<pre><code>void CProgressBarTest::DoDataExchange(CDataExchange* pDX)\n{\n    static auto funDownload = [&amp;]() {\n        m_downloadRetValue = ::SomeDownloadAPI(funDownloadCallback);\n\n        //When download finished, close the current dialog (progress bar). Here are two options:\n        //EndDialog(IDYES); // causes crash\n        //::PostMessage(this-&gt;GetSafeHwnd(), WM_CLOSE, 0, 0);// doesn't crash, but without return valud IDYES.\n    };\n\n    m_thDownload = std::thread(funDownload);\n}\n</code></pre>\n\n<p>Here are two methods to close the progress bar:</p>\n\n<p><code>EndDialog(IDYES)</code>: it causes crash.</p>\n\n<p><code>::PostMessage(this-&gt;GetSafeHwnd(), WM_CLOSE, 0, 0)</code>: it can close the window without crash, but there also no return value (IDYES).</p>\n\n<p>I want to do such check on the outside,</p>\n\n<pre><code>void CGUIThreadTestDlg::OnBnClickedButton3()\n{\n    CProgressBarTest dlg(this);\n    INT_PTR nRet = dlg.DoModal();\n    switch (nRet)\n    {\n    case -1:\n        AfxMessageBox(_T(\"Dialog box could not be created!\"));\n        break;\n    case IDYES:\n        AfxMessageBox(_T(\"Yes!\"));\n        break;\n    case IDOK:\n        // Do something \n        break;\n    case IDCANCEL:\n        AfxMessageBox(_T(\"IDCANCEL!\"));\n        break;\n    default:\n        // Do something \n        break;\n    }\n}\n</code></pre>\n"}, {"tags": ["c++", "templates", "instantiation", "specialization"], "comments": [{"owner": {"reputation": 1038, "user_id": 9636903, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DZZnv.png?s=128&g=1", "display_name": "Gabriella Giordano", "link": "https://stackoverflow.com/users/9636903/gabriella-giordano"}, "edited": false, "score": 0, "creation_date": 1560934583, "post_id": 56663393, "comment_id": 99895944, "body": "Templates and their specializations should be defined in header files (.h not .cpp). Can you show the contents of each .h and .cpp files of this minimal example? Looks like an implicit instantiation is taking place, due to wrong placing of the global template function Create."}], "answers": [{"tags": [], "owner": {"reputation": 63, "user_id": 3690269, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001502364928/picture?type=large", "display_name": "MagicFr", "link": "https://stackoverflow.com/users/3690269/magicfr"}, "is_accepted": false, "score": 0, "last_activity_date": 1560935875, "last_edit_date": 1560935875, "creation_date": 1560935702, "answer_id": 56664125, "question_id": 56663393, "link": "https://stackoverflow.com/questions/56663393/error-c2908-explicit-specialization-has-already-been-instantiated/56664125#56664125", "title": "error C2908: explicit specialization; &#39;&#39; has already been instantiated", "body": "<p>All those classes are in a DLL library, but I got the compiler / link error when building the library only.</p>\n\n<p>I forgot to check the dllimport/dllexport signatures. Adding those in front of my Singleton class and Create func solved this error.</p>\n"}], "owner": {"reputation": 63, "user_id": 3690269, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001502364928/picture?type=large", "display_name": "MagicFr", "link": "https://stackoverflow.com/users/3690269/magicfr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 759, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1560935875, "creation_date": 1560933328, "question_id": 56663393, "link": "https://stackoverflow.com/questions/56663393/error-c2908-explicit-specialization-has-already-been-instantiated", "title": "error C2908: explicit specialization; &#39;&#39; has already been instantiated", "body": "<p>I have a simple template singleton class , I simplified if to keep is simple to read ( removed safeguard , asserts, etc.. it's not the subject of the question )</p>\n\n<pre><code>template&lt; class  T&gt; T* Create();\n\ntemplate &lt;class T&gt;\nclass CSingleton\n{\n    public:\n    static  T*      CreateInstance() { return m_instance = Create&lt;T&gt;(); }\n    static  void    DestroyInstance() { delete m_instance;}\n\n    protected:\n    static T* m_instance;\n};\n</code></pre>\n\n<p>As you can see I use a global function T* Create() to new the pointer as my class could be an abstract class. so if instead I define CreateInstance like this :</p>\n\n<pre><code>static  T*      CreateInstance() { return m_instance = new T; }\n</code></pre>\n\n<p>It will generate an error that I can't instantiate an abstract class.</p>\n\n<p>So here a very simple exemple that generate the error ,\nThe class :</p>\n\n<pre><code>class MyClass : public CSingleton&lt;MyClass&gt;\n{\n};\n</code></pre>\n\n<p>and the definition of the global function in my cpp</p>\n\n<pre><code>template&lt; &gt; MyClass* Create&lt; MyClass &gt;()\n{\n    return nullptr;// just for the compilation demonstration\n}\n</code></pre>\n\n<p>If I dont define this , the linker will output error that it can't find Create(), If I define the function, I get this error :</p>\n\n<pre><code>error C2908:  explicit specialization; 'T *Create&lt;T&gt;(void)' has already been instantiated\nerror C2908:         with\nerror C2908:         [\nerror C2908:             T=MyClass\nerror C2908:         ]\n</code></pre>\n\n<p>I'm stuck for 2 hours on this problem, I can't find a solution, i googled and search on StackOverflow, coudln't find a similar problem and solution.</p>\n\n<p>Cheers,\nSeb</p>\n"}, {"tags": ["c++", "math", "average", "mean"], "comments": [{"owner": {"reputation": 2568, "user_id": 8548828, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C4qkl.png?s=128&g=1", "display_name": "Tarick Welling", "link": "https://stackoverflow.com/users/8548828/tarick-welling"}, "edited": false, "score": 0, "creation_date": 1560932525, "post_id": 56663116, "comment_id": 99894845, "body": "use an int128_t?"}, {"owner": {"reputation": 2568, "user_id": 8548828, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C4qkl.png?s=128&g=1", "display_name": "Tarick Welling", "link": "https://stackoverflow.com/users/8548828/tarick-welling"}, "edited": false, "score": 3, "creation_date": 1560932612, "post_id": 56663116, "comment_id": 99894881, "body": "<a href=\"https://stackoverflow.com/questions/45765087/how-to-avoid-the-potential-of-an-overflow-when-computing-an-average-of-times\">try this incremental approach</a>"}, {"owner": {"reputation": 59603, "user_id": 60281, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/29ebf39f3857b4fc4f51e93e7b9c4af4?s=128&d=identicon&r=PG", "display_name": "DevSolar", "link": "https://stackoverflow.com/users/60281/devsolar"}, "reply_to_user": {"reputation": 2568, "user_id": 8548828, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C4qkl.png?s=128&g=1", "display_name": "Tarick Welling", "link": "https://stackoverflow.com/users/8548828/tarick-welling"}, "edited": false, "score": 1, "creation_date": 1560932709, "post_id": 56663116, "comment_id": 99894917, "body": "@TarickWelling: There is no such type in the standard, and even if it were, it wouldn&#39;t really answer the question (which, I admit, should probably have been phrased in terms of <code>intmax_t</code>). Now, if you would turn that link into an answer, <i>that</i> would be helpful..."}, {"owner": {"reputation": 2568, "user_id": 8548828, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C4qkl.png?s=128&g=1", "display_name": "Tarick Welling", "link": "https://stackoverflow.com/users/8548828/tarick-welling"}, "edited": false, "score": 0, "creation_date": 1560932907, "post_id": 56663116, "comment_id": 99895017, "body": "you didn&#39;t specify your platform or compiler so: GCC and CLANG do support a non standard variant of the 128 bit int. But I think I would prefer the incremental approach"}, {"owner": {"reputation": 3936, "user_id": 1675804, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f375fecf87753c214d732aaa119d59c6?s=128&d=identicon&r=PG", "display_name": "xception", "link": "https://stackoverflow.com/users/1675804/xception"}, "edited": false, "score": 0, "creation_date": 1560933469, "post_id": 56663116, "comment_id": 99895322, "body": "gcc also has __builtin_add_overflow which will tell you if an overflow occurs, which might also help"}], "answers": [{"comments": [{"owner": {"reputation": 3936, "user_id": 1675804, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f375fecf87753c214d732aaa119d59c6?s=128&d=identicon&r=PG", "display_name": "xception", "link": "https://stackoverflow.com/users/1675804/xception"}, "edited": false, "score": 0, "creation_date": 1560933647, "post_id": 56663458, "comment_id": 99895413, "body": "nicely done, I was just about to suggest a more complicated approach based on the same idea"}, {"owner": {"reputation": 7865, "user_id": 2331956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ede184a71447fbba327ad6190c079888?s=128&d=identicon&r=PG", "display_name": "Mike Vine", "link": "https://stackoverflow.com/users/2331956/mike-vine"}, "edited": false, "score": 0, "creation_date": 1560934053, "post_id": 56663458, "comment_id": 99895643, "body": "Interesting solution. It does however require you to know <code>n</code> in advance of feeding in the <i>first</i> number but if you do then this works well."}, {"owner": {"reputation": 3936, "user_id": 1675804, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f375fecf87753c214d732aaa119d59c6?s=128&d=identicon&r=PG", "display_name": "xception", "link": "https://stackoverflow.com/users/1675804/xception"}, "edited": false, "score": 0, "creation_date": 1560934174, "post_id": 56663458, "comment_id": 99895704, "body": "is there a way to refer this answer to the question others suggested in the comments to the OP? I feel this is a much better answer than the one provided there"}, {"owner": {"reputation": 2234, "user_id": 3052438, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/X9OWu.png?s=128&g=1", "display_name": "NO_NAME", "link": "https://stackoverflow.com/users/3052438/no-name"}, "edited": false, "score": 0, "creation_date": 1560936330, "post_id": 56663458, "comment_id": 99896941, "body": "Careful, if <code>n</code> is big, there may be a corner case where <code>((N1 % n) + (N2 % n) +.....+ (Nn-1 % n) + (Nn % n))</code> overflows."}, {"owner": {"reputation": 3936, "user_id": 1675804, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f375fecf87753c214d732aaa119d59c6?s=128&d=identicon&r=PG", "display_name": "xception", "link": "https://stackoverflow.com/users/1675804/xception"}, "reply_to_user": {"reputation": 2234, "user_id": 3052438, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/X9OWu.png?s=128&g=1", "display_name": "NO_NAME", "link": "https://stackoverflow.com/users/3052438/no-name"}, "edited": false, "score": 0, "creation_date": 1560940102, "post_id": 56663458, "comment_id": 99899128, "body": "@NO_NAME N would have to be &gt; 2^32 for that, I think this serves most cases, if someone needs, I believe I can come up with an algorithm that can support a theoretically infinite N (not known beforehand)"}], "tags": [], "owner": {"reputation": 630, "user_id": 5141682, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b29f5b1a276d5ed23eaace729b8be71?s=128&d=identicon&r=PG&f=1", "display_name": "Christina Jacob", "link": "https://stackoverflow.com/users/5141682/christina-jacob"}, "is_accepted": true, "score": 7, "last_activity_date": 1560933956, "last_edit_date": 1560933956, "creation_date": 1560933567, "answer_id": 56663458, "question_id": 56663116, "link": "https://stackoverflow.com/questions/56663116/how-to-calculate-average-of-int64-t/56663458#56663458", "title": "How to calculate average of int64_t", "body": "<p>Average of two nos without overflow </p>\n\n<pre><code>  Average = (a / 2) + (b / 2) + (((a % 2) + (b % 2)) / 2)\n</code></pre>\n\n<p>This can be extended to n numbers as well.</p>\n\n<p>Suppose you have n numbers from N1, N2....Nn-1, Nn</p>\n\n<pre><code>Average = (N1 / n) + (N2 / n) +.....+ (Nn-1 / n) + (Nn / n)\n\n                            +\n\n          ((N1 % n) + (N2 % n) +.....+ (Nn-1 % n) + (Nn % n)) / n\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 6060127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eedc48abc7929509e93da752792afdc0?s=128&d=identicon&r=PG&f=1", "display_name": "Patryk Kaczmarek", "link": "https://stackoverflow.com/users/6060127/patryk-kaczmarek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "closed_date": 1560944683, "accepted_answer_id": 56663458, "answer_count": 1, "score": 1, "last_activity_date": 1560933956, "creation_date": 1560932425, "question_id": 56663116, "link": "https://stackoverflow.com/questions/56663116/how-to-calculate-average-of-int64-t", "closed_reason": "Duplicate", "title": "How to calculate average of int64_t", "body": "<p>I need to calculate the average of n numbers. N is unknown at compile time. Each of the numbers could be an int64_t type but I know that also average fits in int64_t type. Problem is that the sum of n numbers could be too large for int64_t.\nAny suggestions?</p>\n"}, {"tags": ["c++", "debugging"], "comments": [{"owner": {"reputation": 1145, "user_id": 2509099, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6b943869aa8e032e04aae5d8b637d47c?s=128&d=identicon&r=PG", "display_name": "rafael gonzalez", "link": "https://stackoverflow.com/users/2509099/rafael-gonzalez"}, "edited": false, "score": 5, "creation_date": 1560932321, "post_id": 56663082, "comment_id": 99894757, "body": "have you tried lookign at the call stack?"}, {"owner": {"reputation": 51, "user_id": 11230376, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-cVwwAuhxxyc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rehbXKwY5EPBgFlDjY83FPsh7k9Jw/mo/photo.jpg?sz=128", "display_name": "rog ogr", "link": "https://stackoverflow.com/users/11230376/rog-ogr"}, "reply_to_user": {"reputation": 1145, "user_id": 2509099, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6b943869aa8e032e04aae5d8b637d47c?s=128&d=identicon&r=PG", "display_name": "rafael gonzalez", "link": "https://stackoverflow.com/users/2509099/rafael-gonzalez"}, "edited": false, "score": 0, "creation_date": 1560933121, "post_id": 56663082, "comment_id": 99895124, "body": "Oh thanks ! I never heard of it."}], "owner": {"reputation": 51, "user_id": 11230376, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-cVwwAuhxxyc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rehbXKwY5EPBgFlDjY83FPsh7k9Jw/mo/photo.jpg?sz=128", "display_name": "rog ogr", "link": "https://stackoverflow.com/users/11230376/rog-ogr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 53, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1560932281, "creation_date": 1560932281, "question_id": 56663082, "link": "https://stackoverflow.com/questions/56663082/how-can-i-see-where-my-program-crashes-in-a-given-file", "title": "How can I see where my program crashes in a given file?", "body": "<p>My problem is that when I debug my modification on a c++ project (it is very huge) and when the program crashes, the visual studio shows me another cpp file where the program crashes. I know it shows me that because it is related to it, but I need the root where the crash started to I can fix my code. I have tried doing \"step out\" SHIFT + F11, not worked. So how can I make the debugger strict to my file ?</p>\n\n<p>I know this question is gonna be underrated, but I can only explain this way.</p>\n"}, {"tags": ["c++", "qt", "qslider"], "answers": [{"tags": [], "owner": {"reputation": 321, "user_id": 1694302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e12e17a0affc86ad42f8c4e58545ed9?s=128&d=identicon&r=PG", "display_name": "Marcel Petrick", "link": "https://stackoverflow.com/users/1694302/marcel-petrick"}, "is_accepted": false, "score": 0, "last_activity_date": 1560935353, "creation_date": 1560935353, "answer_id": 56663999, "question_id": 56662698, "link": "https://stackoverflow.com/questions/56662698/qslider-with-ticks-not-properly-drawn/56663999#56663999", "title": "QSlider with ticks not properly drawn", "body": "<p>I would recommend to add <strong>VerticalSpacers</strong> at the <strong>top</strong> and <strong>bottom</strong>, which are set to \"<strong>expanding</strong>\" So that the slider is sandwiched. So when you resize the whole widget, for vertical changes th slider stays <strong>minimumHeight</strong>, but for horizontal changes it expands (at least this is what I expect what you want to achieve).</p>\n"}, {"tags": [], "owner": {"reputation": 1773, "user_id": 8805095, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a4948ba17681551aa212dbc7be9bff40?s=128&d=identicon&r=PG&f=1", "display_name": "Moia", "link": "https://stackoverflow.com/users/8805095/moia"}, "is_accepted": true, "score": 0, "last_activity_date": 1560952828, "creation_date": 1560952828, "answer_id": 56669514, "question_id": 56662698, "link": "https://stackoverflow.com/questions/56662698/qslider-with-ticks-not-properly-drawn/56669514#56669514", "title": "QSlider with ticks not properly drawn", "body": "<p>The practical way I found to solve this is to set the minimum size manually to the bare minumum to avoid the incorrect render:</p>\n\n<pre><code>ds.setMinimumHeight(30);\n</code></pre>\n"}], "owner": {"reputation": 1773, "user_id": 8805095, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a4948ba17681551aa212dbc7be9bff40?s=128&d=identicon&r=PG&f=1", "display_name": "Moia", "link": "https://stackoverflow.com/users/8805095/moia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 523, "favorite_count": 0, "accepted_answer_id": 56669514, "answer_count": 2, "score": 0, "last_activity_date": 1560952828, "creation_date": 1560930949, "last_edit_date": 1560930993, "question_id": 56662698, "link": "https://stackoverflow.com/questions/56662698/qslider-with-ticks-not-properly-drawn", "title": "QSlider with ticks not properly drawn", "body": "<p>Enabling a ticks for QSlider seems to mess up the sizeHint of the slider itself.</p>\n\n<p>Consider this simple code:</p>\n\n<pre><code>#include &lt;QApplication&gt;\n\nint main(int argc, char *argv[])\n{\n   QApplication a(argc, argv);\n   QSlider ds{Qt::Horizontal};\n\n   ds.setRange(0, 100);\n   ds.setTickPosition(QSlider::TicksAbove);\n   ds.setTickInterval(20);\n   ds.show();\n\n   return a.exec();\n}\n</code></pre>\n\n<p>and this is how is rendered:</p>\n\n<p><a href=\"https://i.stack.imgur.com/Coi5Z.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Coi5Z.png\" alt=\"enter image description here\"></a></p>\n\n<p>notice how the slider is cropped below.</p>\n\n<p>this behaviour is the same in a complex widget too of course:</p>\n\n<p><a href=\"https://i.stack.imgur.com/o740Q.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/o740Q.png\" alt=\"enter image description here\"></a></p>\n\n<p>Resizing the window of the first slider tick position does not follow the slider itself.</p>\n\n<p><a href=\"https://i.stack.imgur.com/PanTp.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/PanTp.png\" alt=\"enter image description here\"></a></p>\n\n<p>So the question is how have a QSlider rendered properly with ticks enabled?</p>\n"}, {"tags": ["c++", "pointers", "dynamic-memory-allocation", "realloc"], "comments": [{"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1560930975, "post_id": 56662671, "comment_id": 99894078, "body": "C or C++? The answer is different!"}, {"owner": {"reputation": 31, "user_id": 10040262, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--dsyfb2dxKA/AAAAAAAAAAI/AAAAAAAAAAc/HKgDSlz6Ecs/photo.jpg?sz=128", "display_name": "Parvez Mia", "link": "https://stackoverflow.com/users/10040262/parvez-mia"}, "reply_to_user": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1560931101, "post_id": 56662671, "comment_id": 99894144, "body": "this code is written in c++ @BasileStarynkevitch"}, {"owner": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "edited": false, "score": 0, "creation_date": 1560931104, "post_id": 56662671, "comment_id": 99894145, "body": "IMHO, if <code>realloc()</code> failed the mission is nearly lost. That application might have a huge requirement of memory or the available memory might be very limited. (Is this an embedded system?) Either you have to look for memory leaks in your application or this application really needs much memory. In the latter case, I would think about to split data (read from file?) to process it in portions."}, {"owner": {"reputation": 4325, "user_id": 384556, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/f0302a4256808b94f1037e0dd2806759?s=128&d=identicon&r=PG", "display_name": "leon22", "link": "https://stackoverflow.com/users/384556/leon22"}, "edited": false, "score": 0, "creation_date": 1560931438, "post_id": 56662671, "comment_id": 99894319, "body": "This is not really C++, but C code! Please update your question!"}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 2, "creation_date": 1560931728, "post_id": 56662671, "comment_id": 99894459, "body": "Do you think the allocator refuses to allocate out of spite, and there&#39;s a hidden memory stash somewhere that you can reach through other means than <code>realloc</code>?"}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 2, "creation_date": 1560932099, "post_id": 56662671, "comment_id": 99894640, "body": "&quot;<i>Here <b>T</b> is the template parameter</i>&quot; - so the code is C++, even though it is using a very C-ish way of allocating memory"}, {"owner": {"reputation": 7865, "user_id": 2331956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ede184a71447fbba327ad6190c079888?s=128&d=identicon&r=PG", "display_name": "Mike Vine", "link": "https://stackoverflow.com/users/2331956/mike-vine"}, "edited": false, "score": 1, "creation_date": 1560933820, "post_id": 56662671, "comment_id": 99895515, "body": "Note (not related to the question): <i>If</i> this is <code>c++</code> and <code>T</code> is a template type then you must be very careful to manually call its placement constructor / destructor in the right times - you dont supply all the code so we canht verify you&#39;re doing this. Infact using <code>realloc</code> doesn&#39;t even give you the chance to get this right - it can and will move memory sometimes and you wont get a chance to call the destructors. You <i>simply</i> dont want to do it this way - it will only work in a limited number of scenarios and is simply too dangerous."}, {"owner": {"reputation": 34388, "user_id": 2610810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8c6433073e71478e8da278a188e1d15?s=128&d=identicon&r=PG", "display_name": "Caleth", "link": "https://stackoverflow.com/users/2610810/caleth"}, "edited": false, "score": 0, "creation_date": 1560936046, "post_id": 56662671, "comment_id": 99896789, "body": "&quot;How to reallocate memory anyhow, even if realloc() failed&quot; You don&#39;t. In all probability, you can&#39;t."}], "answers": [{"tags": [], "owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "is_accepted": false, "score": 6, "last_activity_date": 1560932919, "last_edit_date": 1592644375, "creation_date": 1560931067, "answer_id": 56662732, "question_id": 56662671, "link": "https://stackoverflow.com/questions/56662671/how-to-reallocate-memory-anyhow-even-if-realloc-failed-in-c/56662732#56662732", "title": "How to reallocate memory anyhow, even if realloc() failed in c++", "body": "<blockquote>\n<h2>How to reallocate memory anyhow, even if realloc() failed in c++</h2>\n</blockquote>\n<p><strong>In genuine C++, you never use <code>malloc</code> or <code>realloc</code></strong>, just <a href=\"https://en.cppreference.com/w/cpp/language/new\" rel=\"nofollow noreferrer\"><code>new</code></a> (which is implemented in your <a href=\"https://en.wikipedia.org/wiki/C%2B%2B_Standard_Library\" rel=\"nofollow noreferrer\">C++ standard library</a> implementation, and will call <code>malloc</code> internally!) and <a href=\"https://en.cppreference.com/w/cpp/language/delete\" rel=\"nofollow noreferrer\"><code>delete</code></a> (it usually calls <code>free</code>), and preferably <a href=\"https://en.cppreference.com/w/cpp/container\" rel=\"nofollow noreferrer\">standard containers</a> and <a href=\"https://en.cppreference.com/w/cpp/memory\" rel=\"nofollow noreferrer\">smart pointers</a>. Out of memory conditions are handled by exceptions (such as <a href=\"https://en.cppreference.com/w/cpp/memory/new/bad_alloc\" rel=\"nofollow noreferrer\"><code>std::bad_alloc</code></a>) and you could <a href=\"https://en.cppreference.com/w/cpp/language/try_catch\" rel=\"nofollow noreferrer\"><code>catch</code></a> these exceptions.</p>\n<p><strong>In C, the robust solution would be to not use <code>realloc</code> and just use <code>malloc</code>, <code>calloc</code>, and <code>free</code></strong> (with <code>memset</code> to clear the area, and <code>memcpy</code> to copy it).</p>\n<p>The real issue is how to cleverly handle out-of-memory conditions. This is a design issue, and is application specific. Be aware of <a href=\"https://en.wikipedia.org/wiki/Memoization\" rel=\"nofollow noreferrer\">memoization</a> and <strong><a href=\"https://en.wikipedia.org/wiki/Garbage_collection_(computer_science)\" rel=\"nofollow noreferrer\">garbage collection</a> techniques, concepts</strong>, and terminology. Observe that <a href=\"https://en.wikipedia.org/wiki/Reference_counting\" rel=\"nofollow noreferrer\">reference counting</a> is a primitive, but often used in C++, garbage collection technique. So read the <a href=\"https://gchandbook.org/\" rel=\"nofollow noreferrer\">GC handbook</a> or at least the <a href=\"https://en.wikipedia.org/wiki/Tracing_garbage_collection\" rel=\"nofollow noreferrer\">tracing garbage collection</a> wikipage for the <em>concepts</em> it will teach you.</p>\n<p>Be aware of <a href=\"https://en.wikipedia.org/wiki/Memory_overcommitment\" rel=\"nofollow noreferrer\">memory over-commitment</a>. It is an OS feature that I dislike.</p>\n<p>Be also aware that <code>malloc</code> and <code>free</code> (implemented in your <a href=\"https://en.wikipedia.org/wiki/C_standard_library\" rel=\"nofollow noreferrer\">C standard library</a> implementation) are using operating system primitives (usually <a href=\"https://en.wikipedia.org/wiki/System_call\" rel=\"nofollow noreferrer\">system calls</a>). So read more about OSes, e.g. <a href=\"http://pages.cs.wisc.edu/%7Eremzi/OSTEP/\" rel=\"nofollow noreferrer\"><em>Operating Systems: Three Easy Pieces</em></a>. On Linux, these OS primitives are (very often) <a href=\"http://man7.org/linux/man-pages/man2/mmap.2.html\" rel=\"nofollow noreferrer\">mmap(2)</a> and <a href=\"http://man7.org/linux/man-pages/man2/mmap.2.html\" rel=\"nofollow noreferrer\">munmap(2)</a>. Because system calls are costly, your standard library will try to avoid them, and prefer marking <code>free</code>-d memory zones as reusable in future <code>malloc</code>-s.</p>\n<p>Use <a href=\"http://valgrind.org\" rel=\"nofollow noreferrer\">valgrind</a> to hunt <a href=\"https://en.wikipedia.org/wiki/Memory_leak\" rel=\"nofollow noreferrer\">memory leaks</a>. You would prefer developing your C++ code on some <a href=\"https://en.wikipedia.org/wiki/Linux_distribution\" rel=\"nofollow noreferrer\">Linux distribution</a> just to have <code>valgrind</code>. My opinion is that Linux provides a very developer-friendly software environment, so I recommend Linux for most programmers and students. Don't forget to compile with <code>g++ -Wall -g</code> (maybe also <code>-O2</code>, when benchmarking) and use when needed the <a href=\"https://en.wikipedia.org/wiki/AddressSanitizer\" rel=\"nofollow noreferrer\">address sanitizer</a>.</p>\n<p>More generally, read <a href=\"http://norvig.com/21-days.html\" rel=\"nofollow noreferrer\">http://norvig.com/21-days.html</a> - it gives a wonderful insight.</p>\n"}], "owner": {"reputation": 31, "user_id": 10040262, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--dsyfb2dxKA/AAAAAAAAAAI/AAAAAAAAAAc/HKgDSlz6Ecs/photo.jpg?sz=128", "display_name": "Parvez Mia", "link": "https://stackoverflow.com/users/10040262/parvez-mia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1560932919, "creation_date": 1560930864, "last_edit_date": 1560931065, "question_id": 56662671, "link": "https://stackoverflow.com/questions/56662671/how-to-reallocate-memory-anyhow-even-if-realloc-failed-in-c", "title": "How to reallocate memory anyhow, even if realloc() failed in c++", "body": "<p>After a <strong>successful allocation using malloc()</strong>, sometimes the program needs to increase the size of the array. Though malloc() worked successfully, but <strong>realloc()</strong> failed.</p>\n\n<p>I've used this piece of code to handle the failure of realloc().\nHere <strong>T</strong> is the template parameter. <strong>array</strong> is a pointer of type T, <strong>_size</strong> is the total index of the array has been already used, <strong>_maxSize</strong> is the maximum number of usable index.\n<em>Reallocation is needed when _size reaches _maxSize</em>.</p>\n\n<pre><code>if(_size == _maxSize){\n    _maxSize *= 2;\n    T *temp;\n    temp = (T *) realloc( array, sizeof( T ) * (_maxSize) ) ;\n    if(temp == NULL){\n        printf(\"...reallocation of memory failed...\\n\");\n        exit(0);\n    }\n    else{\n        array = temp;\n    }\n}\n</code></pre>\n\n<p>Although the failure of realloc() was handled, <strong>the program really needs to increase the array size</strong> and I don't really know about how to perform the reallocation even if realloc() failed.</p>\n"}, {"tags": ["c++", "syntax", "expression", "shared-ptr", "declaration"], "comments": [{"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1560931057, "post_id": 56662637, "comment_id": 99894115, "body": "The problem is about scoping, shadowing variable names in an inner scope, and a weird (but valid) syntax to declare variables."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 1, "creation_date": 1560933144, "post_id": 56662637, "comment_id": 99895134, "body": "If it were a temporary, your code wouldn&#39;t compile because <code>q</code> would be an <code>int*</code>."}, {"owner": {"reputation": 474, "user_id": 11310636, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/243689119dbf710ab44923faff266fcf?s=128&d=identicon&r=PG&f=1", "display_name": "Narase", "link": "https://stackoverflow.com/users/11310636/narase"}, "reply_to_user": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1560934091, "post_id": 56662637, "comment_id": 99895658, "body": "@molbdnilo It compiles <a href=\"https://godbolt.org/z/fPwchN\" rel=\"nofollow noreferrer\">godbolt.org/z/fPwchN</a> I expect shadowing even if I didnt know this can happen with different types"}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "reply_to_user": {"reputation": 474, "user_id": 11310636, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/243689119dbf710ab44923faff266fcf?s=128&d=identicon&r=PG&f=1", "display_name": "Narase", "link": "https://stackoverflow.com/users/11310636/narase"}, "edited": false, "score": 0, "creation_date": 1560934805, "post_id": 56662637, "comment_id": 99896079, "body": "@Narase It compiles because there is no temporary. <a href=\"https://godbolt.org/z/G_2IqV\" rel=\"nofollow noreferrer\">Here</a> is the same code but with an actual temporary. (&quot;error: request for member &#39;use_count&#39; in &#39;q&#39;, which is of non-class type &#39;int*&#39;&quot;)"}], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 3041122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4434dfe0dc7c6fdedfe3e35093254292?s=128&d=identicon&r=PG&f=1", "display_name": "Sohof", "link": "https://stackoverflow.com/users/3041122/sohof"}, "edited": false, "score": 0, "creation_date": 1560932270, "post_id": 56662676, "comment_id": 99894726, "body": "Sorry but this does not answer my question and furthermore it seems to misunderstand my question. There is nothing &quot;I want&quot;, my question is why has the newly created shared_ptr q reference count 0, when according to C++ primer it should have reference count 1."}, {"owner": {"reputation": 144568, "user_id": 3309790, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7d1c7e499132b9945b412ac79d0e22f7?s=128&d=identicon&r=PG&f=1", "display_name": "songyuanyao", "link": "https://stackoverflow.com/users/3309790/songyuanyao"}, "reply_to_user": {"reputation": 41, "user_id": 3041122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4434dfe0dc7c6fdedfe3e35093254292?s=128&d=identicon&r=PG&f=1", "display_name": "Sohof", "link": "https://stackoverflow.com/users/3041122/sohof"}, "edited": false, "score": 2, "creation_date": 1560932385, "post_id": 56662676, "comment_id": 99894790, "body": "@Sohof <code>shared_ptr&lt;int&gt;(q);</code> is same as <code>shared_ptr&lt;int&gt; q;</code>, i.e. declare a <code>shared_ptr</code> pointing to nothing."}, {"owner": {"reputation": 474, "user_id": 11310636, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/243689119dbf710ab44923faff266fcf?s=128&d=identicon&r=PG&f=1", "display_name": "Narase", "link": "https://stackoverflow.com/users/11310636/narase"}, "reply_to_user": {"reputation": 41, "user_id": 3041122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4434dfe0dc7c6fdedfe3e35093254292?s=128&d=identicon&r=PG&f=1", "display_name": "Sohof", "link": "https://stackoverflow.com/users/3041122/sohof"}, "edited": false, "score": 1, "creation_date": 1560932982, "post_id": 56662676, "comment_id": 99895058, "body": "@Sohof You misunderstand the answer. Sure you want something, its a second shared_ptr pointing to q and youre wondering why its count is 0. Its because you never linked them because you created an empty shared_ptr which, of course, has a count a 0, because it doesnt point to anything"}, {"owner": {"reputation": 41, "user_id": 3041122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4434dfe0dc7c6fdedfe3e35093254292?s=128&d=identicon&r=PG&f=1", "display_name": "Sohof", "link": "https://stackoverflow.com/users/3041122/sohof"}, "edited": false, "score": 0, "creation_date": 1560933341, "post_id": 56662676, "comment_id": 99895252, "body": "@Narase so you mean when the book writes &quot;// undefined two independent shared_ptrs point to the same memory&quot; and further takes about destroying q makes p into a dangling pointer, that somehow they are never linked to begin with? And further why does the book say that q should have a reference count of 1 then? (According to my knowledge C++ Primer by Lippman is supposed to be a well respected book). Or am I still misunderstanding your answer?"}, {"owner": {"reputation": 474, "user_id": 11310636, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/243689119dbf710ab44923faff266fcf?s=128&d=identicon&r=PG&f=1", "display_name": "Narase", "link": "https://stackoverflow.com/users/11310636/narase"}, "reply_to_user": {"reputation": 41, "user_id": 3041122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4434dfe0dc7c6fdedfe3e35093254292?s=128&d=identicon&r=PG&f=1", "display_name": "Sohof", "link": "https://stackoverflow.com/users/3041122/sohof"}, "edited": false, "score": 1, "creation_date": 1560933440, "post_id": 56662676, "comment_id": 99895311, "body": "@Sohof Are you 100% sure the line in your book says <code>shared_ptr&lt;int&gt;(q);</code> ?"}, {"owner": {"reputation": 41, "user_id": 3041122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4434dfe0dc7c6fdedfe3e35093254292?s=128&d=identicon&r=PG&f=1", "display_name": "Sohof", "link": "https://stackoverflow.com/users/3041122/sohof"}, "edited": false, "score": 0, "creation_date": 1560933777, "post_id": 56662676, "comment_id": 99895495, "body": "@Narase, Yes I am, at least in my version second printing 2012 (which is the latest one I believe. I suspected it being a typo in the book, but it was not listed in any errata. And the book is well respected, while I am a novice.. so.. I thought I must be wrong."}, {"owner": {"reputation": 474, "user_id": 11310636, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/243689119dbf710ab44923faff266fcf?s=128&d=identicon&r=PG&f=1", "display_name": "Narase", "link": "https://stackoverflow.com/users/11310636/narase"}, "reply_to_user": {"reputation": 41, "user_id": 3041122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4434dfe0dc7c6fdedfe3e35093254292?s=128&d=identicon&r=PG&f=1", "display_name": "Sohof", "link": "https://stackoverflow.com/users/3041122/sohof"}, "edited": false, "score": 0, "creation_date": 1560933944, "post_id": 56662676, "comment_id": 99895578, "body": "@Sohof Understandable. Its a mistake in the book then. Try the example again but with the line <code>shared_ptr&lt;int&gt; p2(q);</code> and you should see the expected results"}], "tags": [], "owner": {"reputation": 474, "user_id": 11310636, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/243689119dbf710ab44923faff266fcf?s=128&d=identicon&r=PG&f=1", "display_name": "Narase", "link": "https://stackoverflow.com/users/11310636/narase"}, "is_accepted": false, "score": 3, "last_activity_date": 1560933057, "last_edit_date": 1560933057, "creation_date": 1560930875, "answer_id": 56662676, "question_id": 56662637, "link": "https://stackoverflow.com/questions/56662637/c-shared-ptr-reference-count-while-binding-another-smart-pointer-to-pointer-re/56662676#56662676", "title": "C++ shared_ptr reference count while binding another smart pointer to pointer returned by get", "body": "<blockquote>\n  <p><code>shared_ptr&lt;int&gt;(q);</code></p>\n</blockquote>\n\n<p>This creates a shared_ptr with the name q and is equivalent to</p>\n\n<pre><code>shared_ptr&lt;int&gt; q;\n</code></pre>\n\n<p>Which does not point to anything and thus its count is 0</p>\n\n<p>If you want a second shared_ptr pointing to q, you need this</p>\n\n<pre><code> shared_ptr&lt;int&gt; p2(q); \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 41, "user_id": 3041122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4434dfe0dc7c6fdedfe3e35093254292?s=128&d=identicon&r=PG&f=1", "display_name": "Sohof", "link": "https://stackoverflow.com/users/3041122/sohof"}, "edited": false, "score": 0, "creation_date": 1560934220, "post_id": 56663406, "comment_id": 99895731, "body": "I suspected something was wrong but wasn&#39;t sure about it being a bug in the book. As shown from my first question on this subject that I linked to, I had initially thought that a temporary was being created because the syntax really resembles that."}], "tags": [], "owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "is_accepted": false, "score": 2, "last_activity_date": 1560933713, "last_edit_date": 1560933713, "creation_date": 1560933384, "answer_id": 56663406, "question_id": 56662637, "link": "https://stackoverflow.com/questions/56662637/c-shared-ptr-reference-count-while-binding-another-smart-pointer-to-pointer-re/56663406#56663406", "title": "C++ shared_ptr reference count while binding another smart pointer to pointer returned by get", "body": "<p>There is a bug in the book - in the inner block, <code>q</code> is an empty <code>shared_ptr</code>, unrelated to <code>p.get()</code>.  </p>\n\n<p>It seems that this has not made its way into any published errata.</p>\n\n<p>The following should print what you expect, and be as undefined as the author intended:</p>\n\n<pre><code>shared_ptr&lt;int&gt; p(new int(42));\n{ \n  shared_ptr&lt;int&gt; q(p.get()); \n  cout &lt;&lt; p.use_count() &lt;&lt; '\\n' &lt;&lt; q.use_count() &lt;&lt;'\\n';\n}\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 3041122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4434dfe0dc7c6fdedfe3e35093254292?s=128&d=identicon&r=PG&f=1", "display_name": "Sohof", "link": "https://stackoverflow.com/users/3041122/sohof"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1560933713, "creation_date": 1560930718, "last_edit_date": 1560933145, "question_id": 56662637, "link": "https://stackoverflow.com/questions/56662637/c-shared-ptr-reference-count-while-binding-another-smart-pointer-to-pointer-re", "title": "C++ shared_ptr reference count while binding another smart pointer to pointer returned by get", "body": "<p>According to \"C++ Primer\" page 466, it is an error to bind another smart pointer to the pointer returned by <code>get()</code>. This is followed by some code and further explanation. I am having trouble understanding part of the explanation, which states verbatim:</p>\n\n<blockquote>\n  <p>In this case, both p and q point to the same memory. Because they were created independently from each other, each has a reference count of 1. When the block in which q was defined ends, q is destroyed. Destroying q frees the memory to which q points. That makes p into a dangling pointer, meaning that what happens when we attempt to use p is undefined. </p>\n</blockquote>\n\n<p>This question is related to a previous question I asked, <a href=\"https://stackoverflow.com/questions/56652083/\">Understanding C++ std::shared_ptr when used with temporary objects</a>, where I was toying with my own examples and erroneously believed that a temporary <code>shared_ptr</code> was being created on line 5.</p>\n\n<pre><code>shared_ptr&lt;int&gt; p(new int(42));\nint *q = p.get();\n{ // new block\n  // undefined: two independent shared_ptrs point to same memory\n  shared_ptr&lt;int&gt;(q); \n  cout &lt;&lt; p.use_count() &lt;&lt; '\\n' &lt;&lt; q.use_count() &lt;&lt;'\\n';\n}\n</code></pre>\n\n<blockquote>\n<pre><code>Output:\n1\n0\n</code></pre>\n</blockquote>\n\n<p>According to the explanation above, both <code>p</code> and <code>q</code> have a reference count of 1.</p>\n\n<p>But when adding a print statement to output the reference counts. I get that <code>p</code> has use count of 1 but <code>q</code> has a use count of 0. Shouldn't <code>q</code> also have a use count of 1? Or am I missing something? I would understand if <code>q</code> reference count was 0 after the block.</p>\n"}, {"tags": ["c++", "c++17", "unordered-map"], "comments": [{"owner": {"reputation": 34185, "user_id": 5470596, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BITFt.jpg?s=128&g=1", "display_name": "YSC", "link": "https://stackoverflow.com/users/5470596/ysc"}, "edited": false, "score": 0, "creation_date": 1560930898, "post_id": 56662493, "comment_id": 99894037, "body": "You could guess by yourself: what would happen if <code>if-&gt;first</code> was a value rather than a reference? <code>&amp;it-&gt;first</code> would be taking the address of a temporary."}], "answers": [{"tags": [], "owner": {"reputation": 474, "user_id": 11310636, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/243689119dbf710ab44923faff266fcf?s=128&d=identicon&r=PG&f=1", "display_name": "Narase", "link": "https://stackoverflow.com/users/11310636/narase"}, "is_accepted": false, "score": 0, "last_activity_date": 1560930429, "creation_date": 1560930429, "answer_id": 56662577, "question_id": 56662493, "link": "https://stackoverflow.com/questions/56662493/what-type-does-it-first-give/56662577#56662577", "title": "What type does it-&gt;first give?", "body": "<p>The iterator holds the key/value pair. So ->first will give a an std::string as reference</p>\n"}, {"tags": [], "owner": {"reputation": 32126, "user_id": 2666289, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/746dd23bbe20769fbd758421e67f455c?s=128&d=identicon&r=PG", "display_name": "Holt", "link": "https://stackoverflow.com/users/2666289/holt"}, "is_accepted": true, "score": 7, "last_activity_date": 1560933331, "last_edit_date": 1560933331, "creation_date": 1560930861, "answer_id": 56662669, "question_id": 56662493, "link": "https://stackoverflow.com/questions/56662493/what-type-does-it-first-give/56662669#56662669", "title": "What type does it-&gt;first give?", "body": "<p>You want to remove the <code>&amp;</code> after <code>auto</code> because <code>try_emplace</code> does not return references:</p>\n\n<pre><code>auto [it, inserted] = stringCollection.try_emplace(pString);\n</code></pre>\n\n<p>In this case, the type of <code>it</code> is <code>std::unordered_map&lt;std::string, Info&gt;::iterator</code> which satisfies <a href=\"https://en.cppreference.com/w/cpp/named_req/ForwardIterator\" rel=\"nofollow noreferrer\"><em>LegacyForwardIterator</em></a> which implies <a href=\"https://en.cppreference.com/w/cpp/named_req/InputIterator\" rel=\"nofollow noreferrer\"><em>LegacyInputIterator</em></a>:</p>\n\n<ul>\n<li><code>it-&gt;m</code> is equivalent to <code>(*it).m</code>;</li>\n<li><code>*it</code> returns <code>std::iterator_traits&lt;It&gt;::reference</code> (where <code>It</code> is the type of <code>it</code>).</li>\n</ul>\n\n<p>So the type of <code>*it</code> in your case is <code>std::pair&lt;const std::string, Info&gt;&amp;</code> (a reference), so if you access its member <code>first</code>, you get a reference to a <code>const std::string</code> as you expect.</p>\n"}], "owner": {"reputation": 9396, "user_id": 2261538, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4e60dd44745bd1518ee933e081119de?s=128&d=identicon&r=PG", "display_name": "darune", "link": "https://stackoverflow.com/users/2261538/darune"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 56662669, "answer_count": 2, "score": 2, "last_activity_date": 1560933331, "creation_date": 1560930102, "question_id": 56662493, "link": "https://stackoverflow.com/questions/56662493/what-type-does-it-first-give", "title": "What type does it-&gt;first give?", "body": "<p>Consider the following code:</p>\n\n<pre><code>  static std::unordered_map&lt;std::string, Info&gt; stringCollection;\n\n  auto&amp; [it, inserted] = stringCollection.try_emplace(pString);\n  if (inserted) {\n    it-&gt;second.str = &amp;it-&gt;first;\n  }\n  return it-&gt;second;\n</code></pre>\n\n<p>This line <code>it-&gt;second.str = &amp;it-&gt;first</code> is supposed to copy the address of the key (pointer) - but I cannot seem to verify if this will be the case (cannot find reference). Basicly does <code>it-&gt;first</code> give me a copy or reference ?</p>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 405, "user_id": 784996, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/ee9c492d2be23fd6908b5e91892f11ed?s=128&d=identicon&r=PG", "display_name": "Izzy", "link": "https://stackoverflow.com/users/784996/izzy"}, "reply_to_user": {"reputation": 2357, "user_id": 4074081, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/emDh4.png?s=128&g=1", "display_name": "dewaffled", "link": "https://stackoverflow.com/users/4074081/dewaffled"}, "edited": false, "score": 0, "creation_date": 1560930215, "post_id": 56662419, "comment_id": 99893721, "body": "@dewaffled no its not. Overloading and overriding are two different things"}, {"owner": {"reputation": 2357, "user_id": 4074081, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/emDh4.png?s=128&g=1", "display_name": "dewaffled", "link": "https://stackoverflow.com/users/4074081/dewaffled"}, "edited": false, "score": 0, "creation_date": 1560930363, "post_id": 56662419, "comment_id": 99893792, "body": "@lzzy Yes, but the <a href=\"https://stackoverflow.com/a/3682076/4074081\">the answer there</a> answers your question as well and looked clear enough to repost here: &#167;13.1 where the Standard.. Parameter declarations that differ only in the presence or absence of const and/or volatile are equivalent. That is, the const and volatile type-specifiers for each parameter type are ignored"}, {"owner": {"reputation": 405, "user_id": 784996, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/ee9c492d2be23fd6908b5e91892f11ed?s=128&d=identicon&r=PG", "display_name": "Izzy", "link": "https://stackoverflow.com/users/784996/izzy"}, "reply_to_user": {"reputation": 2357, "user_id": 4074081, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/emDh4.png?s=128&g=1", "display_name": "dewaffled", "link": "https://stackoverflow.com/users/4074081/dewaffled"}, "edited": false, "score": 0, "creation_date": 1560930651, "post_id": 56662419, "comment_id": 99893925, "body": "@dewaffled Yes you are right, the answer does answer my question, but my question <i>is</i> different."}], "answers": [{"comments": [{"owner": {"reputation": 405, "user_id": 784996, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/ee9c492d2be23fd6908b5e91892f11ed?s=128&d=identicon&r=PG", "display_name": "Izzy", "link": "https://stackoverflow.com/users/784996/izzy"}, "edited": false, "score": 0, "creation_date": 1560930422, "post_id": 56662486, "comment_id": 99893818, "body": "Thanks. Just one fast question: does overridden method with const use const signature? Or is dropped as I see in your comment?"}, {"owner": {"reputation": 144568, "user_id": 3309790, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7d1c7e499132b9945b412ac79d0e22f7?s=128&d=identicon&r=PG&f=1", "display_name": "songyuanyao", "link": "https://stackoverflow.com/users/3309790/songyuanyao"}, "reply_to_user": {"reputation": 405, "user_id": 784996, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/ee9c492d2be23fd6908b5e91892f11ed?s=128&d=identicon&r=PG", "display_name": "Izzy", "link": "https://stackoverflow.com/users/784996/izzy"}, "edited": false, "score": 3, "creation_date": 1560930599, "post_id": 56662486, "comment_id": 99893901, "body": "@Izzy As the quote says, <i>but doesn&#39;t modify the property of the parameter</i>, so the parameter is still <code>const</code> in the function, i.e. you can&#39;t modify the parameter <code>a</code> inside the body of <code>Derived::func</code>. <a href=\"https://wandbox.org/permlink/opOprhy9NmjP1PTP\" rel=\"nofollow noreferrer\">LIVE</a>"}], "tags": [], "owner": {"reputation": 144568, "user_id": 3309790, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7d1c7e499132b9945b412ac79d0e22f7?s=128&d=identicon&r=PG&f=1", "display_name": "songyuanyao", "link": "https://stackoverflow.com/users/3309790/songyuanyao"}, "is_accepted": true, "score": 9, "last_activity_date": 1560930070, "creation_date": 1560930070, "answer_id": 56662486, "question_id": 56662419, "link": "https://stackoverflow.com/questions/56662419/why-does-overriding-a-method-and-adding-const-to-a-parameter-type-work/56662486#56662486", "title": "Why does overriding a method and adding const to a parameter type work?", "body": "<p>Because their <a href=\"https://en.cppreference.com/w/cpp/language/function#Parameter_list\" rel=\"noreferrer\">signatures</a> are the same in fact.</p>\n\n<blockquote>\n  <p>The type of each function parameter in the parameter list is determined according to the following rules:</p>\n  \n  <p>...</p>\n  \n  <p>4) Top-level cv-qualifiers are dropped from the parameter type (This adjustment only affects the function type, but doesn't modify the property of the parameter: <code>int f(const int p, decltype(p)*);</code> and <code>int f(int, const int*);</code> declare the same function)</p>\n</blockquote>\n\n<p>That means, <code>void func(int a)</code> and <code>void func(const int a)</code> are considered as the same function type; then the overriding is valid.</p>\n"}], "owner": {"reputation": 405, "user_id": 784996, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/ee9c492d2be23fd6908b5e91892f11ed?s=128&d=identicon&r=PG", "display_name": "Izzy", "link": "https://stackoverflow.com/users/784996/izzy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 314, "favorite_count": 2, "closed_date": 1561040277, "accepted_answer_id": 56662486, "answer_count": 1, "score": 7, "last_activity_date": 1560943358, "creation_date": 1560929844, "last_edit_date": 1560943358, "question_id": 56662419, "link": "https://stackoverflow.com/questions/56662419/why-does-overriding-a-method-and-adding-const-to-a-parameter-type-work", "closed_reason": "Duplicate", "title": "Why does overriding a method and adding const to a parameter type work?", "body": "<p>Consider the following example:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;string&gt;\n\nclass Base {\npublic:\n    virtual void func(int a) {}\n};\n\nclass Derived : public Base {\n    public:\n    void func( const int a) override {\n    }\n};\n\n\nint main()\n{\n    Derived d;\n    d.func(1);\n\n    return 1;\n}\n\n</code></pre>\n\n<p>I override the <code>func</code> method but <em>add const</em> to the parameter, in which case the linker should scream that something is wrong. Either the function is not overridden or the function parameter should not be const.</p>\n\n<p>But to my surprise, this code links and works.</p>\n\n<p>You can find an <a href=\"https://www.onlinegdb.com/rJekBvvkH\" rel=\"nofollow noreferrer\">online example here</a>.</p>\n\n<p>Am I missing something? Why does this code work?</p>\n\n<p>Although similar to <a href=\"https://stackoverflow.com/questions/3682049/functions-with-const-arguments-and-overloading\">Functions with const arguments and Overloading</a> it addresses a different problem. That question was about not being possible to <em>overload</em> a method of the base class, while this question addresses the problem of being able to <em>override</em> a derived method.</p>\n"}, {"tags": ["c++", "arrays", "string"], "answers": [{"tags": [], "owner": {"reputation": 42880, "user_id": 982161, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/kutcC.png?s=128&g=1", "display_name": "\u03a6Xoc\u0119 \uc6c3 \u041fepe&#250;pa \u30c4", "link": "https://stackoverflow.com/users/982161/%ce%a6xoc%c4%99-%ec%9b%83-%d0%9fepe%c3%bapa-%e3%83%84"}, "is_accepted": false, "score": 1, "last_activity_date": 1560930789, "creation_date": 1560930789, "answer_id": 56662650, "question_id": 56662409, "link": "https://stackoverflow.com/questions/56662409/c-iterate-words-in-a-string-where-spaces-are-not-regular/56662650#56662650", "title": "C++ Iterate words in a string where spaces are not regular", "body": "<p>You can remove multiple spaces 1st and then split to sigle space</p>\n\n<p>example:</p>\n\n<pre><code>std::string input = \"roberto           1007   2.3  6.4  7127016 534260   ??  S    10:18AM   5:32.46 /Applications/Firefox.app/Contents/MacOS/firefox  \";\nauto lambdaPredicate = [](char lhs, char rhs)\n{\n    return (lhs == rhs) &amp;&amp; (lhs == ' ');\n};\n// remove multiple spaces\nstd::string::iterator new_end = std::unique(input.begin(), input.end(), lambdaPredicate);\ninput.erase(new_end, input.end());\n//split the string to a vector using space as delimitor\nstd::istringstream iss(input);\nstd::vector&lt;std::string&gt; results(std::istream_iterator&lt;std::string&gt;{iss}, std::istream_iterator&lt;std::string&gt;());\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1867, "user_id": 1416225, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/sMRhL.jpg?s=128&g=1", "display_name": "meth", "link": "https://stackoverflow.com/users/1416225/meth"}, "is_accepted": false, "score": 1, "last_activity_date": 1560930827, "creation_date": 1560930827, "answer_id": 56662660, "question_id": 56662409, "link": "https://stackoverflow.com/questions/56662409/c-iterate-words-in-a-string-where-spaces-are-not-regular/56662660#56662660", "title": "C++ Iterate words in a string where spaces are not regular", "body": "<p>Directly split string with a space. There will be empty strings in the list. Remove them by using erase/remove.    </p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;algorithm&gt;\n#include &lt;string&gt;\n#include &lt;vector&gt;\n#include &lt;sstream&gt;\n\nstd::vector&lt;std::string&gt; splitString(std::string input, const char splitter ) {\n        std::istringstream ss(input);\n        std::string token;\n        std::vector&lt;std::string&gt; values;\n        while(std::getline(ss, token, splitter)) {\n            values.push_back(token);\n        }\n        return values;\n}\n\nint main() {\n    std::string str = \"roberto           1007   2.3  6.4  7127016 534260   ??  S    10:18AM   5:32.46 /Applications/Firefox.app/Contents/MacOS/firefox\";\n\n    std::vector&lt;std::string&gt; res = splitString(str, ' ');\n\n    res.erase(std::remove_if(res.begin(), res.end(), [](std::string&amp; s){ return s.length() == 0; }), res.end());\n\n    printf(\"%d\", res.size());\n\n    return 0;\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1616, "user_id": 9935369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K8dgW.png?s=128&g=1", "display_name": "Roberto Manfreda", "link": "https://stackoverflow.com/users/9935369/roberto-manfreda"}, "edited": false, "score": 0, "creation_date": 1560938658, "post_id": 56663401, "comment_id": 99898317, "body": "This is the best answer! Thank you so much!"}], "tags": [], "owner": {"reputation": 34388, "user_id": 2610810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8c6433073e71478e8da278a188e1d15?s=128&d=identicon&r=PG", "display_name": "Caleth", "link": "https://stackoverflow.com/users/2610810/caleth"}, "is_accepted": true, "score": 2, "last_activity_date": 1560933372, "creation_date": 1560933372, "answer_id": 56663401, "question_id": 56662409, "link": "https://stackoverflow.com/questions/56662409/c-iterate-words-in-a-string-where-spaces-are-not-regular/56663401#56663401", "title": "C++ Iterate words in a string where spaces are not regular", "body": "<p>Streaming operations remove leading whitespace.</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;string&gt;\n#include &lt;vector&gt;\n#include &lt;iterator&gt;\n#include &lt;sstream&gt;\n\ntemplate&lt;typename T&gt;\nstd::ostream&amp; operator&lt;&lt;(std::ostream&amp; os, const std::vector&lt;T&gt;&amp; vec)\n{\n    for (auto&amp; el : vec)\n    {\n        os &lt;&lt; el &lt;&lt; std::endl;\n    }\n    return os;\n}\n\nint main()\n{\n    std::string input = \"roberto           1007   2.3  6.4  7127016 534260   ??  S    10:18AM   5:32.46 /Applications/Firefox.app/Contents/MacOS/firefox  \";\n    std::istringstream iss(input);\n    std::vector&lt;std::string&gt; results(std::istream_iterator&lt;std::string&gt;{iss}, {});\n\n    std::cout &lt;&lt; results &lt;&lt; std::endl;\n}\n</code></pre>\n\n<p><a href=\"http://coliru.stacked-crooked.com/a/f886a7dafe34cdc6\" rel=\"nofollow noreferrer\">See it live</a></p>\n"}], "owner": {"reputation": 1616, "user_id": 9935369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K8dgW.png?s=128&g=1", "display_name": "Roberto Manfreda", "link": "https://stackoverflow.com/users/9935369/roberto-manfreda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 56663401, "answer_count": 3, "score": 1, "last_activity_date": 1560963844, "creation_date": 1560929814, "last_edit_date": 1560963844, "question_id": 56662409, "link": "https://stackoverflow.com/questions/56662409/c-iterate-words-in-a-string-where-spaces-are-not-regular", "title": "C++ Iterate words in a string where spaces are not regular", "body": "<p>Supposing we have a string, <strong>where spaces beetween words are not regular</strong>, like this:  </p>\n\n<pre><code>roberto           1007   2.3  6.4  7127016 534260   ??  S    10:18AM   5:32.46 /Applications/Firefox.app/Contents/MacOS/firefox  \n</code></pre>\n\n<p>how  create an array containing all the words?    </p>\n\n<p>This was my elementary solution:  </p>\n\n<pre><code>std:: string = \"roberto           1007   2.3  6.4  7127016 534260   ??  S    10:18AM   5:32.46 /Applications/Firefox.app/Contents/MacOS/firefox  \";   \nsize_t length = strlen(string.data());\nstd::vector&lt;std::string&gt; words;\nstd::string temp;\nfor (int i = 0; i &lt; length; i++) {\n    if (string[i] != ' ') {\n        temp.push_back(string[i]);\n    } else {\n        if (!temp.empty()) {\n            words.push_back(temp);\n            temp = \"\";\n        }\n    }\n}\n\nstd::cout &lt;&lt; \"words are: \" &lt;&lt; std::endl;\nfor (const auto &amp;word : words) {\n    std::cout &lt;&lt; word &lt;&lt; std::endl;\n}\n</code></pre>\n\n<p>Thanks for your attention.</p>\n"}, {"tags": ["c++", "implicit-conversion"], "comments": [{"owner": {"reputation": 32126, "user_id": 2666289, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/746dd23bbe20769fbd758421e67f455c?s=128&d=identicon&r=PG", "display_name": "Holt", "link": "https://stackoverflow.com/users/2666289/holt"}, "edited": false, "score": 2, "creation_date": 1560929279, "post_id": 56662187, "comment_id": 99893237, "body": "You don&#39;t get warning because the compiler knows at compile time that these conversion are okay, if  you use something that not know at compile you&#39;ll get warning as expected."}], "answers": [{"tags": [], "owner": {"reputation": 156300, "user_id": 1782465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b45d92faaf9d122bfed585490e0bafc5?s=128&d=identicon&r=PG", "display_name": "Angew is no longer proud of SO", "link": "https://stackoverflow.com/users/1782465/angew-is-no-longer-proud-of-so"}, "is_accepted": false, "score": 6, "last_activity_date": 1560929451, "creation_date": 1560929451, "answer_id": 56662313, "question_id": 56662187, "link": "https://stackoverflow.com/questions/56662187/no-implicit-conversion-warnings-when-passing-integer-literals/56662313#56662313", "title": "No implicit conversion warnings when passing integer literals?", "body": "<p>The warning \"converting signed to unsigned\" exists because <em>some</em> of these conversions can produce bad/unexpected results. Converting a signed <code>1</code> to unsigned yields <code>1</code> without any issues. Converting <code>-3</code> to unsigned is problematic.</p>\n\n<p>With a variable, the compiler cannot (in the general case) know what its value will be at runtime, and so it has to warn about a potential conversion issue. With a literal, its value is known at compile time and so the compiler can either silently do the right thing (when the value converts OK), or warn/error out when necessary (when the conversion is problematic).</p>\n"}, {"comments": [{"owner": {"reputation": 517, "user_id": 1011113, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/b13371c0b32f4f0a307a5ceed5fa5ae8?s=128&d=identicon&r=PG", "display_name": "user1011113", "link": "https://stackoverflow.com/users/1011113/user1011113"}, "edited": false, "score": 0, "creation_date": 1560949824, "post_id": 56662314, "comment_id": 99904652, "body": "I see, thanks! Is this behavior guaranteed by the standard or is it compiler-dependent? I&#39;m wondering if it&#39;s better to guard yourself and be explicit &quot;e.g. array[0U]&quot; in case some compiler has a strange behavior here. For example PClint complains about this when running static analysis (MISRA C++ 2008 5-0-4)"}, {"owner": {"reputation": 32126, "user_id": 2666289, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/746dd23bbe20769fbd758421e67f455c?s=128&d=identicon&r=PG", "display_name": "Holt", "link": "https://stackoverflow.com/users/2666289/holt"}, "reply_to_user": {"reputation": 517, "user_id": 1011113, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/b13371c0b32f4f0a307a5ceed5fa5ae8?s=128&d=identicon&r=PG", "display_name": "user1011113", "link": "https://stackoverflow.com/users/1011113/user1011113"}, "edited": false, "score": 0, "creation_date": 1560958444, "post_id": 56662314, "comment_id": 99910179, "body": "@user1011113 You cannot have guarantees regarding warning for such code because warning are not imposed by the standard. What you can be sure is that <code>array[0]</code> must compile on any compiler, eventhough some may emit warning. I would personally use <code>array[0]</code> because I do not see advantages in being explicit but that&#39;s a matter of choice."}], "tags": [], "owner": {"reputation": 32126, "user_id": 2666289, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/746dd23bbe20769fbd758421e67f455c?s=128&d=identicon&r=PG", "display_name": "Holt", "link": "https://stackoverflow.com/users/2666289/holt"}, "is_accepted": true, "score": 8, "last_activity_date": 1560945190, "last_edit_date": 1560945190, "creation_date": 1560929455, "answer_id": 56662314, "question_id": 56662187, "link": "https://stackoverflow.com/questions/56662187/no-implicit-conversion-warnings-when-passing-integer-literals/56662314#56662314", "title": "No implicit conversion warnings when passing integer literals?", "body": "<p>The compiler does not warn you because it knows <strong>at compile time</strong> that this conversion if <em>safe</em>, i.e., the original and target value are identical. When you do:</p>\n\n<pre><code>vec[1.0F]\n</code></pre>\n\n<p>From a compiler point-of-view, there is no change of value (loss of precision) between <code>1.0F</code> and <code>1</code>, so the compiler does not warn you. If you try:</p>\n\n<pre><code>vec[1.2F]\n</code></pre>\n\n<p>...the compiler will warn you because, eventhough <code>1.2F</code> will be converted to <code>1</code>, there is a precision loss.</p>\n\n<p>If you use a value that is not known at compile time, e.g.:</p>\n\n<pre><code>float get_float();\n\nvec[get_float()];\n</code></pre>\n\n<p>You will get a warning as expected because the compiler does not know the value of <code>get_float()</code> beforehand and thus cannot be sure that the conversion is <em>safe</em>.</p>\n\n<p>Note that you will never get such warning when constant expressions are expected (e.g., in <code>std::array&lt;int, 10&gt;</code>), because, by definition, constant expressions are known at compile time, so the compiler knows if there is an issue between the given value and the converted one.</p>\n"}], "owner": {"reputation": 517, "user_id": 1011113, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/b13371c0b32f4f0a307a5ceed5fa5ae8?s=128&d=identicon&r=PG", "display_name": "user1011113", "link": "https://stackoverflow.com/users/1011113/user1011113"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 277, "favorite_count": 0, "accepted_answer_id": 56662314, "answer_count": 2, "score": 4, "last_activity_date": 1560945190, "creation_date": 1560929005, "last_edit_date": 1560929620, "question_id": 56662187, "link": "https://stackoverflow.com/questions/56662187/no-implicit-conversion-warnings-when-passing-integer-literals", "title": "No implicit conversion warnings when passing integer literals?", "body": "<p>I'm trying to understand when implicit conversions happen and to detect them to improve the quality of my codebase.</p>\n\n<p>I have enabled <code>Wconversion</code> and <code>Wsign-conversion</code> for this. However I came across a situation where the compiler doesn't give any error. Example:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;array&gt;\n\nint main()\n{\n   std::array&lt;int, 10&gt; vec{};\n   std::cout &lt;&lt; vec[1] &lt;&lt; std::endl; \n}\n</code></pre>\n\n<p>Compiling:</p>\n\n<pre><code>$ g++ --std=c++14 -Wall -Wextra -Werror -pedantic -Wsign-conversion -Wconversion test.cpp \n$ \n</code></pre>\n\n<p>Both the size of the array and the index to <code>operator[]</code> should be of type <code>std::size_t</code> (unsigned). However I'm passing signed literals and there seems to be no problem. I could even pass <code>1.0F</code> to <code>operator[]</code> and the compiler would be fine.</p>\n\n<p>If I create a signed variable for the index to <code>operator[]</code>, however, then the compiler does warn about implicit conversion.</p>\n\n<p>What's happening under the hood? Are implicit conversions happening when using literals? Why doesn't the compiler give an error? I'm using GCC 7.4 on Ubuntu 18.04.</p>\n"}, {"tags": ["c++", "class", "mutex"], "comments": [{"owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 3, "creation_date": 1560929323, "post_id": 56662177, "comment_id": 99893273, "body": "Why not use C++11 threads and mutexes so you can take advantage of things like <code>std::lock_guard</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 7481, "user_id": 2527795, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8359590ce3a66e5c58407ae5c83c9bbe?s=128&d=identicon&r=PG&f=1", "display_name": "vll", "link": "https://stackoverflow.com/users/2527795/vll"}, "is_accepted": true, "score": 1, "last_activity_date": 1560930626, "creation_date": 1560930626, "answer_id": 56662621, "question_id": 56662177, "link": "https://stackoverflow.com/questions/56662177/ensuring-mutex-lock-is-called-before-unlock/56662621#56662621", "title": "Ensuring mutex lock is called before unlock", "body": "<p>You set a boolean to indicate whether the mutex is locked or not. You can also check that value outside the class:</p>\n\n<pre><code>class mutexclass\n{\npublic:\n    mutexclass(pthread_mutex_t* inmutex)\n    {   \n        mutex = inmutex;\n        int err = pthread_mutex_lock(mutex);\n        if(err == 0) locked_ = true;\n    }\n    ~mutexclass()\n    {\n        if(locked_) {\n            pthread_mutex_unlock(mutex);\n        }\n    }\n    bool locked() const { return locked_; }\n\nprivate:\n    pthread_mutex_t *mutex;\n    bool locked_ = false;\n};  \n\nvoid mainclass::calling1()\n{\n    mutexclass m = mutexclass(&amp;lock);\n    //call cout only if mutex lock is successful\n    if (m.locked()) {\n        cout&lt;&lt;\"calling1\";\n    }\n}\n</code></pre>\n\n<p>You could also use <a href=\"https://en.cppreference.com/w/cpp/thread/mutex\" rel=\"nofollow noreferrer\">std::mutex</a>, which throws an exception on errors.</p>\n"}, {"tags": [], "owner": {"reputation": 46978, "user_id": 856199, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/CPtki.png?s=128&g=1", "display_name": "Nikos C.", "link": "https://stackoverflow.com/users/856199/nikos-c"}, "is_accepted": false, "score": 4, "last_activity_date": 1560933431, "last_edit_date": 1560933431, "creation_date": 1560931886, "answer_id": 56662973, "question_id": 56662177, "link": "https://stackoverflow.com/questions/56662177/ensuring-mutex-lock-is-called-before-unlock/56662973#56662973", "title": "Ensuring mutex lock is called before unlock", "body": "<p>You should really use <a href=\"https://en.cppreference.com/w/cpp/thread/mutex\" rel=\"nofollow noreferrer\">std::mutex</a> and <a href=\"https://en.cppreference.com/w/cpp/thread/lock_guard\" rel=\"nofollow noreferrer\">std::lock_guard</a>, and in general the <a href=\"https://en.cppreference.com/w/cpp/thread\" rel=\"nofollow noreferrer\">standard C++ threading support</a>. But if for some reason you can't (maybe this is a learning exercise?) then I recommend preventing <code>mutexclass</code> from ever being in a state where the mutex is not locked. That should be an error, so throw an exception if the lock can't be acquired.</p>\n\n<p>It's also important to prevent instances from being copied. Otherwise, the same mutex will be unlocked multiple times in the destructor of each copy. To prevent that, delete the copy constructor and assignment operator.</p>\n\n<pre><code>#include &lt;system_error&gt;\n\nclass mutexclass\n{\npublic:\n    explicit mutexclass(pthread_mutex_t* inmutex)\n        : mutex(inmutex)\n    {\n        int err = pthread_mutex_lock(mutex);\n        if (err != 0) {\n            throw std::system_error(err, std::generic_category(),\n                \"pthread mutex lock acquisition failure\");\n        }\n    }\n\n    ~mutexclass()\n    {\n        pthread_mutex_unlock(mutex);\n    }\n\n    mutexclass(const mutexclass&amp;) = delete;\n    mutexclass&amp; operator=(const mutexclass&amp;) = delete;\n\nprivate:\n    pthread_mutex_t* mutex;\n};\n</code></pre>\n\n<p>Now you can implement the <code>calling*</code> functions like this:</p>\n\n<pre><code>void mainclass::calling1()\n{\n    try {\n        mutexclass m(&amp;lock);\n        cout &lt;&lt; \"calling1\\n\";\n    } catch (const std::exception&amp; e) {\n        // Could not lock.\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 868, "user_id": 4402433, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/9bce35bd631fc9215f7885d6d0c84366?s=128&d=identicon&r=PG&f=1", "display_name": "Sathiya", "link": "https://stackoverflow.com/users/4402433/sathiya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 56662621, "answer_count": 2, "score": 1, "last_activity_date": 1560933431, "creation_date": 1560928993, "question_id": 56662177, "link": "https://stackoverflow.com/questions/56662177/ensuring-mutex-lock-is-called-before-unlock", "title": "Ensuring mutex lock is called before unlock", "body": "<p>Was trying to execute a piece of code only when mutex is locked. Methods in class <code>mainclass</code> does the task only when the mutex is locked. To avoid creating undefined behaviour when the mutex is unlocked without locking ( considering case where locking may fail),  lock and unlock is handled with constructor and destructor of <code>mutexclass</code>.</p>\n\n<p>I want to check if mutex is locked before executing the code from <code>mainclass</code> methods <code>calling1()</code> and <code>calling2()</code>. As constructor won't return values, want to know alternate methods of doing this.</p>\n\n<pre><code>#include &lt;iostream&gt;\nusing namespace std;\n\nclass mutexclass\n{\n    public:\n    pthread_mutex_t *mutex;\n    bool a = true;\n    mutexclass(pthread_mutex_t* inmutex)\n    {   mutex= inmutex;\n        int err=pthread_mutex_lock(mutex);\n        cout&lt;&lt;\"automutex constructor\";\n        if(err != 0)\n        a = false;\n    };\n    ~mutexclass()\n    {\n        if(a)\n        {\n            pthread_mutex_unlock(mutex);\n            cout&lt;&lt;\"automutex destructor\";\n        }\n        else\n            cout&lt;&lt;\"a is not true\";\n    };\n};  \nclass mainclass{\n    public:\n    mainclass();\n    ~mainclass();\n    pthread_mutex_t lock;\n    void calling1();\n    void calling2();\n};\nmainclass::mainclass()\n{\n    pthread_mutex_init(&amp;lock,NULL);\n}\nmainclass::~mainclass()\n{\n    pthread_mutex_destroy(&amp;lock);\n}\nvoid mainclass::calling1()\n{\n    mutexclass m = mutexclass(&amp;lock);\n    //call cout only if mutex lock is successful\n    cout&lt;&lt;\"calling1\";\n}\nvoid mainclass::calling2()\n{\n    mutexclass m = mutexclass(&amp;lock);\n    cout&lt;&lt;\"calling2\";\n}\n\nint main() {\n    mainclass s;\n\n    s.calling1();\n    s.calling2();\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c++", "c++11", "auto"], "comments": [{"owner": {"reputation": 2055, "user_id": 6564148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/u3HL5.png?s=128&g=1", "display_name": "George", "link": "https://stackoverflow.com/users/6564148/george"}, "edited": false, "score": 2, "creation_date": 1560928495, "post_id": 56661878, "comment_id": 99892815, "body": "There is an overhead but it&#39;s very low. However there are situations where auto is just syntax sugar for a template, when using it as a function parameter for example, and obviously there the cost can start to increase. Personally I would say that I&#39;ve never worked in a codebase where use of auto has been the main reason for poor compile times."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 1, "creation_date": 1560929147, "post_id": 56661878, "comment_id": 99893154, "body": "The compiler always has to determine the type of every expression, so all the information <code>auto</code> needs is already available to it. On the other hand, not using <code>auto</code> might add some overhead for determining if any conversions are necessary and possibly generating code for them."}], "answers": [{"tags": [], "owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "is_accepted": true, "score": 6, "last_activity_date": 1560928314, "creation_date": 1560928314, "answer_id": 56661989, "question_id": 56661878, "link": "https://stackoverflow.com/questions/56661878/c-auto-type-specifier-compile-time/56661989#56661989", "title": "C++ auto type specifier compile time", "body": "<p>As the compiler is already aware of the static type of an expression, you can expect the effect on compilation time to be minimal, if any.</p>\n\n<p>Probably of the same order as using <code>decltype</code> or <code>sizeof</code>.</p>\n"}], "owner": {"reputation": 2157, "user_id": 2122457, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/hGUcg.png?s=128&g=1", "display_name": "Ugnius Mal\u016bkas", "link": "https://stackoverflow.com/users/2122457/ugnius-mal%c5%abkas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 56661989, "answer_count": 1, "score": 3, "last_activity_date": 1560928314, "creation_date": 1560927947, "question_id": 56661878, "link": "https://stackoverflow.com/questions/56661878/c-auto-type-specifier-compile-time", "title": "C++ auto type specifier compile time", "body": "<p>Just for curiosity:</p>\n\n<p>is it big difference in compile time if <code>auto</code> type specifiers  have been used?</p>\n\n<p>I haven't found any information regarding that.</p>\n"}, {"tags": ["c++", "windows", "boost"], "comments": [{"owner": {"reputation": 4535, "user_id": 59081, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c17b54bbea172f608e552f9bf67d4f9?s=128&d=identicon&r=PG", "display_name": "Tanveer Badar", "link": "https://stackoverflow.com/users/59081/tanveer-badar"}, "edited": false, "score": 0, "creation_date": 1560927988, "post_id": 56661801, "comment_id": 99892555, "body": "Where&#39;s the error in that?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user3646905"}, "reply_to_user": {"reputation": 4535, "user_id": 59081, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c17b54bbea172f608e552f9bf67d4f9?s=128&d=identicon&r=PG", "display_name": "Tanveer Badar", "link": "https://stackoverflow.com/users/59081/tanveer-badar"}, "edited": false, "score": 0, "creation_date": 1560928073, "post_id": 56661801, "comment_id": 99892607, "body": "I edit my question. @TanveerBadar"}], "answers": [{"tags": [], "owner": {"reputation": 3808, "user_id": 2922611, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f26420ac1fcb58b3d0c0f63273eaf3f5?s=128&d=identicon&r=PG&f=1", "display_name": "kenba", "link": "https://stackoverflow.com/users/2922611/kenba"}, "is_accepted": false, "score": 0, "last_activity_date": 1561012601, "creation_date": 1561012601, "answer_id": 56680285, "question_id": 56661801, "link": "https://stackoverflow.com/questions/56661801/how-can-i-install-boost-in-windows-10-with-vs-2019-preview/56680285#56680285", "title": "How can I Install boost in Windows 10 with VS 2019 Preview", "body": "<p>I suspect that you are <em>not</em> building <code>boost</code> in a <code>Visual Studio tools Command Prompt</code> window.</p>\n\n<p>See the answers I gave here: <a href=\"https://stackoverflow.com/questions/56603575/how-to-build-64-bit-boost-for-visual-studio-on-windows-using-the-address-model-f/56608193#56608193\">How to build 64-bit boost for visual studio on windows using the address-model flag?</a> and here <a href=\"https://stackoverflow.com/questions/43946538/how-to-build-boost-1-64-in-64-bits/43950508#43950508\">How to build Boost 1.64 in 64 bits?</a></p>\n"}, {"tags": [], "owner": {"reputation": 1377, "user_id": 3277889, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/0cfdedc7a964f0be935e8823188be028?s=128&d=identicon&r=PG&f=1", "display_name": "OrangeSherbet", "link": "https://stackoverflow.com/users/3277889/orangesherbet"}, "is_accepted": false, "score": 6, "last_activity_date": 1596478579, "last_edit_date": 1596478579, "creation_date": 1561521019, "answer_id": 56764902, "question_id": 56661801, "link": "https://stackoverflow.com/questions/56661801/how-can-i-install-boost-in-windows-10-with-vs-2019-preview/56764902#56764902", "title": "How can I Install boost in Windows 10 with VS 2019 Preview", "body": "<p>You cannot currently build Boost with <em>Preview</em>, but you can with the regular 2019 just released. I had this same issue. It takes like ten minutes to install 2019 regular with required features. You can have both at the same time.</p>\n<p>For future reference, here are my notes for how to build boost on windows with MPI and python support.</p>\n<h2>Building Boost on Windows with VS 2019</h2>\n<p>Need Visual Studio 2019 Non-Preview, any version, all the C++ and Windows SDK stuff.</p>\n<p><em>Note: temporarily uninstall the C++ and Windows SDK stuff from VS Preview if you have both. Ideally have only one compiler on the system so <code>Boost.build</code> doesn't get confused.</em></p>\n<p>Next, assuming you have git-for-windows installed, execute</p>\n<pre><code>git clone https://github.com/boostorg/boost.git --recursive \n</code></pre>\n<p>the boost superproject repo to an UNPROTECTED folder called <code>/Boost/</code> (must be unprotected!)</p>\n<pre><code>cd boost\n</code></pre>\n<p>Now your in <code>/Boost/boost</code>.\nCheckout the developer branch (get recent updates) with</p>\n<pre><code>git checkout develop -f\n</code></pre>\n<p>Where -f forces updates.</p>\n<p>Run bootstrap inside the boost folder using Visual Studio Developer Console. To activate this console, either use the Windows search bar <em>&quot;Type here to search&quot;</em> for &quot;Developer Command Prompt&quot;, or open visual studio and use the search bar at the top.</p>\n<p><em>Note: If you are getting access errors, you have to activate administrative visual studio developer console.\nOpen <code>cmd</code> in administrative mode and run VsDevCmd.bat, the file that activates the visual studio developer console.</em></p>\n<pre><code>bootstrap\n</code></pre>\n<p>If you haven't already done so, install Microsoft MPI by installing both files available for latest version of Microsoft MPI.\nIts known to be working with <a href=\"https://www.microsoft.com/en-us/download/details.aspx?id=57467\" rel=\"nofollow noreferrer\">Version 10</a>, requires installing BOTH the SDK (an .msi file) and non-SDK (a .exe file) files to the DEFAULT locations. Do not modify these locations.</p>\n<p>Then modify project-config.jam in the <code>/Boost/boost/</code> directory to the following:</p>\n<p>(btw, there is white space [a regular space] after each line, even empty lines)</p>\n<pre><code># Boost.Build Configuration \n# Automatically generated by bootstrap.bat \n \nimport option ; \n \nusing msvc ; \n \noption.set keep-going : false ; \n \nusing python ; \n \nusing mpi ; \n</code></pre>\n<p>The last two lines assume you want mpi and python support.</p>\n<p>Now open Visual Studio Developer Console and navigate (cd) to the boost folder <code>/Boost/boost</code>. Since we're using the Visual C++ compiler from VS 2019, apparently we don't need to <code>b2 install</code> anything (see sections 5.1 - 5.2 in the Getting Started guide). Then the only thing we need next is to run</p>\n<pre><code>b2 -j8 --address-model=64\n</code></pre>\n<p>Options include</p>\n<ul>\n<li><code>--toolset=14.xx</code>[to specify vs compiler version 14.15, etc] (or <code>toolset</code> without the <code>--</code>, someone told me, not sure which is correct please let me know, for me it was <code>--</code>)</li>\n<li><code>-a</code> for rebuild all</li>\n<li><code>-j8</code> for 8 cores compilation</li>\n<li><code>--address-model=64</code> (or <code>address-model</code> without the <code>--</code>, someone told me, not sure which is correct please let me know, for me it was <code>--</code>) for 64-bit</li>\n<li><code>&gt; my_log.txt</code> at the end to record the ridiculous amounts of text output from the build, for later use (making sure it went ok).</li>\n</ul>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user3646905"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11748, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1596478579, "creation_date": 1560927674, "last_edit_date": 1560928129, "question_id": 56661801, "link": "https://stackoverflow.com/questions/56661801/how-can-i-install-boost-in-windows-10-with-vs-2019-preview", "title": "How can I Install boost in Windows 10 with VS 2019 Preview", "body": "<p>I search a lot, but I didn't find any useful step by step guide to install and configure and build boost in Windows 10 with VS 2019 Preview. Can anyone of you guide me through this task?</p>\n\n<p>I have download boost 1.70 but when I execute bootstrap.bat it gives the following message:</p>\n\n<pre><code>C:\\libraries\\boost\\boost_1_70_0&gt;bootstrap.bat\nBuilding Boost.Build engine\n\nFailed to build Boost.Build engine.\nPlease consult bootstrap.log for further diagnostics.\n\nC:\\libraries\\boost\\boost_1_70_0&gt;\n</code></pre>\n\n<p>this file have the following text in itself:</p>\n\n<pre><code>c:\\libraries\\boost\\boost_1_70_0\\tools\\build\\src\\engine&gt;if exist bootstrap rd /S /Q bootstrap \n\nc:\\libraries\\boost\\boost_1_70_0\\tools\\build\\src\\engine&gt;md bootstrap \n\nc:\\libraries\\boost\\boost_1_70_0\\tools\\build\\src\\engine&gt;cl /nologo /RTC1 /Zi /MTd /Fobootstrap/ /Fdbootstrap/ -DNT -DYYDEBUG -wd4996 kernel32.lib advapi32.lib user32.lib /Febootstrap\\jam0  command.c compile.c constants.c debug.c execcmd.c execnt.c filent.c frames.c function.c glob.c hash.c hdrmacro.c headers.c jam.c jambase.c jamgram.c lists.c make.c make1.c object.c option.c output.c parse.c pathnt.c pathsys.c regexp.c rules.c scan.c search.c subst.c timestamp.c variable.c modules.c strings.c filesys.c builtins.c md5.c class.c cwd.c w32_getreg.c native.c modules/set.c modules/path.c modules/regex.c modules/property-set.c modules/sequence.c modules/order.c \ncommand.c\ncompile.c\nconstants.c\ndebug.c\nexeccmd.c\nexecnt.c\nfilent.c\nframes.c\nfunction.c\nglob.c\nhash.c\nhdrmacro.c\nheaders.c\njam.c\njambase.c\njamgram.c\nlists.c\nmake.c\nmake1.c\nobject.c\nGenerating Code...\nCompiling...\noption.c\noutput.c\nparse.c\npathnt.c\npathsys.c\nregexp.c\nrules.c\nscan.c\nsearch.c\nsubst.c\ntimestamp.c\nvariable.c\nmodules.c\nstrings.c\nfilesys.c\nbuiltins.c\nmd5.c\nclass.c\ncwd.c\nw32_getreg.c\nGenerating Code...\nCompiling...\nnative.c\nset.c\npath.c\nregex.c\nproperty-set.c\nsequence.c\norder.c\nGenerating Code...\n</code></pre>\n\n<p>When I try the boost 1.68, I could run bootstrap.bat successfully, but when I execute b2.exe it gives me the following message:</p>\n\n<pre><code>warning: Did not find command for MSVC toolset. If you have Visual Studio 2017 installed you will need to specify the full path to the command, set VS150COMNTOOLS for your installation, or build from the 'Visual Studio Command Prompt for VS 2017'.\n</code></pre>\n"}, {"tags": ["c++", "qt", "qvariant"], "comments": [{"owner": {"reputation": 6673, "user_id": 777689, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/19JOo.jpg?s=128&g=1", "display_name": "PeterT", "link": "https://stackoverflow.com/users/777689/petert"}, "edited": false, "score": 0, "creation_date": 1560936999, "post_id": 56661692, "comment_id": 99897309, "body": "also, just for completeness sake, the actual type of a char-literal  in C is <code>int</code> and not <code>char</code>. In C++ simple char literals like <code>&#39;a&#39;</code> should be <code>char</code> but multicharacter-literals like <code>&#39;abcd&#39;</code> are still <code>int</code>"}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 10789226, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-KrjHzyAzta4/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jbZkaxk8h4uMuz9A1ez4HJCgqunA/mo/photo.jpg?sz=128", "display_name": "VivekVar", "link": "https://stackoverflow.com/users/10789226/vivekvar"}, "edited": false, "score": 0, "creation_date": 1560929837, "post_id": 56661893, "comment_id": 99893552, "body": "Thanks for the quick response dave. I did not look into the constructors of QVariant. This means, the user will have to pass QChar to the list of QVariant in order to work it as char."}, {"owner": {"reputation": 1615, "user_id": 10362622, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54067bb99c90afda4a7ac844255dc6b5?s=128&d=identicon&r=PG&f=1", "display_name": "dave", "link": "https://stackoverflow.com/users/10362622/dave"}, "reply_to_user": {"reputation": 25, "user_id": 10789226, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-KrjHzyAzta4/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jbZkaxk8h4uMuz9A1ez4HJCgqunA/mo/photo.jpg?sz=128", "display_name": "VivekVar", "link": "https://stackoverflow.com/users/10789226/vivekvar"}, "edited": false, "score": 1, "creation_date": 1560930174, "post_id": 56661893, "comment_id": 99893711, "body": "@VivekVar that depends on your use case I guess. You can also just let the type be <code>int</code> and use <code>toChar()</code> to convert it back. <code>QVariant v3 = &#39;C&#39;; qDebug() &lt;&lt; v3.toChar(); &#47;&#47;prints &#39;C&#39;</code>"}], "tags": [], "owner": {"reputation": 1615, "user_id": 10362622, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54067bb99c90afda4a7ac844255dc6b5?s=128&d=identicon&r=PG&f=1", "display_name": "dave", "link": "https://stackoverflow.com/users/10362622/dave"}, "is_accepted": true, "score": 2, "last_activity_date": 1560928350, "last_edit_date": 1560928350, "creation_date": 1560927977, "answer_id": 56661893, "question_id": 56661692, "link": "https://stackoverflow.com/questions/56661692/why-is-qvariant-treating-char-type-as-an-integer-type/56661893#56661893", "title": "Why is QVariant treating char type as an integer type?", "body": "<p>The <code>char</code> type of <code>QVariant</code> is the same as the type of <code>int</code>. If you want to store an actual character, you probably want the type <code>QChar</code>.</p>\n\n<p>Notice that <code>QVariant</code> only has constructors for <code>QChar</code> and <code>int</code>. A C++ <code>char</code> will be cast to <code>int</code> in this case.</p>\n\n<p>To treat your example as a character, you can cast explicitly to <code>QChar</code></p>\n\n<pre><code>QVariant v1 = QChar('A');\nQVariant v2(QVariant::Type::Char);\nv2 = 'B';\nqDebug() &lt;&lt; v1 &lt;&lt; v2;\n//Output: QVariant(QChar, 'A') QVariant(int, 66)\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 10789226, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-KrjHzyAzta4/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jbZkaxk8h4uMuz9A1ez4HJCgqunA/mo/photo.jpg?sz=128", "display_name": "VivekVar", "link": "https://stackoverflow.com/users/10789226/vivekvar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 0, "accepted_answer_id": 56661893, "answer_count": 1, "score": 2, "last_activity_date": 1560928350, "creation_date": 1560927220, "last_edit_date": 1560927676, "question_id": 56661692, "link": "https://stackoverflow.com/questions/56661692/why-is-qvariant-treating-char-type-as-an-integer-type", "title": "Why is QVariant treating char type as an integer type?", "body": "<p>I am trying to write a code snippet which would take a QList of QVariants and would populate the list using ListView. </p>\n\n<p>Use cases with types QString, int, bool, double etc. are successful. However, when I am trying to pass char data type as list elements, it is being treated as integer i.e ASCII value is being taken.</p>\n\n<p>Is there any way to make QVariant treat char as char?</p>\n\n<p>Note: \nI am using Qt5.6.0.\nI have tried to probe the type by using QVariant::type() expecting it to return QVariant::Char so that I convert it to string and use it. But, QVariant::type() returned QVariant::Int.</p>\n\n<pre><code>int main()\n{\n    QVariant charVar = 'A';\n    qDebug()&lt;&lt; charVar&lt;&lt; \"\\n\";\n    return 0;\n}\n</code></pre>\n\n<p>Actual result:</p>\n\n<pre><code>QVariant(int, 65)\n</code></pre>\n\n<p>Expectation:</p>\n\n<pre><code>QVariant(char, 'A')\n</code></pre>\n"}, {"tags": ["c++", "standards", "c++-standard-library"], "comments": [{"owner": {"reputation": 214, "user_id": 11547818, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/557fedadaf09f7ab92c99d4a42b34833?s=128&d=identicon&r=PG&f=1", "display_name": "bahij zeineh", "link": "https://stackoverflow.com/users/11547818/bahij-zeineh"}, "edited": false, "score": 6, "creation_date": 1560925964, "post_id": 56661378, "comment_id": 99891575, "body": "not that im aware of, just NULL and nullptr"}, {"owner": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "edited": false, "score": 3, "creation_date": 1560926015, "post_id": 56661378, "comment_id": 99891603, "body": "Nothing stops you from making a <code>null</code> macro, just like how <code>NULL</code> is a macro."}, {"owner": {"reputation": 219644, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "edited": false, "score": 2, "creation_date": 1560926039, "post_id": 56661378, "comment_id": 99891612, "body": "@Top-Master int* p5 = null; can be valid or invalid depending on how null is defined.:)"}, {"owner": {"reputation": 33577, "user_id": 9593596, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JdCIQ.jpg?s=128&g=1", "display_name": "lubgr", "link": "https://stackoverflow.com/users/9593596/lubgr"}, "reply_to_user": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "edited": false, "score": 1, "creation_date": 1560926085, "post_id": 56661378, "comment_id": 99891642, "body": "@blaze Hopefully an idea of engineering sanity would stop you from doing that."}, {"owner": {"reputation": 219644, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "edited": false, "score": 0, "creation_date": 1560926117, "post_id": 56661378, "comment_id": 99891651, "body": "@Top-Master And my advice: never do assignments in an interview. Interview is not an exam.:)"}, {"owner": {"reputation": 147720, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 3, "creation_date": 1560926139, "post_id": 56661378, "comment_id": 99891662, "body": "Strictly speaking, <code>int* p2 = 2-2;</code> is not valid either."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1560926244, "post_id": 56661378, "comment_id": 99891700, "body": "I would avoid the lowercase <code>null</code> just from a readability standpoint. When someone is scanning your code the will either be looking for <code>NULL</code> or <code>nullptr</code>. <code>null</code> would just provide a double-head-turn or be skimmed over entirely."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 147720, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 0, "creation_date": 1560926292, "post_id": 56661378, "comment_id": 99891716, "body": "@StoryTeller Does C++ make it invalid? It&#39;s perfectly valid C."}, {"owner": {"reputation": 539, "user_id": 11424134, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/683bddfb4b9fe78da33d52f53e1106a8?s=128&d=identicon&r=PG&f=1", "display_name": "Raffallo", "link": "https://stackoverflow.com/users/11424134/raffallo"}, "edited": false, "score": 0, "creation_date": 1560926477, "post_id": 56661378, "comment_id": 99891801, "body": "<code>int* p4 = z;</code> also depending on what the <code>z</code> variable is"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 539, "user_id": 11424134, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/683bddfb4b9fe78da33d52f53e1106a8?s=128&d=identicon&r=PG&f=1", "display_name": "Raffallo", "link": "https://stackoverflow.com/users/11424134/raffallo"}, "edited": false, "score": 0, "creation_date": 1560926530, "post_id": 56661378, "comment_id": 99891832, "body": "@Raffallo <code>int z = 0;     int* p4 = z;</code> is a single example. <code>z</code> is an <code>int</code>."}, {"owner": {"reputation": 147720, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1560926533, "post_id": 56661378, "comment_id": 99891835, "body": "@melpomene - Very sneakily so, it does <a href=\"https://stackoverflow.com/questions/55780426/implementing-the-linux-kernels-is-constexpr-ice-p-macro-in-pure-c\" title=\"implementing the linux kernels is constexpr ice p macro in pure c\">stackoverflow.com/questions/55780426/&hellip;</a>"}, {"owner": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "reply_to_user": {"reputation": 33577, "user_id": 9593596, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JdCIQ.jpg?s=128&g=1", "display_name": "lubgr", "link": "https://stackoverflow.com/users/9593596/lubgr"}, "edited": false, "score": 1, "creation_date": 1560927004, "post_id": 56661378, "comment_id": 99892057, "body": "@lubgr true that - in C++ even using <code>NULL</code> is questionable when there&#39;s <code>nullptr</code>."}], "answers": [{"comments": [{"owner": {"reputation": 147720, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 5, "creation_date": 1560926659, "post_id": 56661458, "comment_id": 99891887, "body": "Well, yeah, that does it."}, {"owner": {"reputation": 2844, "user_id": 8740349, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FRL1s.jpg?s=128&g=1", "display_name": "Top-Master", "link": "https://stackoverflow.com/users/8740349/top-master"}, "edited": false, "score": 1, "creation_date": 1560929102, "post_id": 56661458, "comment_id": 99893130, "body": "It would be better with a reference-link or something, but still, this seems to be the right answer."}, {"owner": {"reputation": 46978, "user_id": 856199, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/CPtki.png?s=128&g=1", "display_name": "Nikos C.", "link": "https://stackoverflow.com/users/856199/nikos-c"}, "reply_to_user": {"reputation": 2844, "user_id": 8740349, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FRL1s.jpg?s=128&g=1", "display_name": "Top-Master", "link": "https://stackoverflow.com/users/8740349/top-master"}, "edited": false, "score": 5, "creation_date": 1560929495, "post_id": 56661458, "comment_id": 99893377, "body": "@Top-Master Yeah, this requires proving a negative. The evidence of absence here is the lack of any section in the C++ standard that mentions <code>null</code> as a valid token. So really, &quot;no&quot; is pretty much the perfect answer IMO. :-)"}, {"owner": {"reputation": 42370, "user_id": 3980929, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/xyKrD.png?s=128&g=1", "display_name": "Rakete1111", "link": "https://stackoverflow.com/users/3980929/rakete1111"}, "reply_to_user": {"reputation": 2844, "user_id": 8740349, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FRL1s.jpg?s=128&g=1", "display_name": "Top-Master", "link": "https://stackoverflow.com/users/8740349/top-master"}, "edited": false, "score": 1, "creation_date": 1561116957, "post_id": 56661458, "comment_id": 99968657, "body": "@Top-Master The only guarantee you have is that advanced C++ programmers looked at this answer and agree due to the lack of comments :)"}], "tags": [], "owner": {"reputation": 46978, "user_id": 856199, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/CPtki.png?s=128&g=1", "display_name": "Nikos C.", "link": "https://stackoverflow.com/users/856199/nikos-c"}, "is_accepted": true, "score": 22, "last_activity_date": 1560926216, "creation_date": 1560926216, "answer_id": 56661458, "question_id": 56661378, "link": "https://stackoverflow.com/questions/56661378/is-lowercase-null-valid-in-c/56661458#56661458", "title": "Is lowercase null valid in C++?", "body": "<blockquote>\n  <p>Is there any lowercase <code>null</code> in any version of the C++ language specification?</p>\n</blockquote>\n\n<p>No.</p>\n"}, {"tags": [], "owner": {"reputation": 630, "user_id": 5141682, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b29f5b1a276d5ed23eaace729b8be71?s=128&d=identicon&r=PG&f=1", "display_name": "Christina Jacob", "link": "https://stackoverflow.com/users/5141682/christina-jacob"}, "is_accepted": false, "score": 8, "last_activity_date": 1560926705, "creation_date": 1560926705, "answer_id": 56661574, "question_id": 56661378, "link": "https://stackoverflow.com/questions/56661378/is-lowercase-null-valid-in-c/56661574#56661574", "title": "Is lowercase null valid in C++?", "body": "<p>A one word answer would be NO.</p>\n\n<p>try the below code</p>\n\n<pre><code>  #include &lt;iostream&gt;\n#include &lt;stdlib.h&gt;\nusing namespace std;\nint main(){\n    int *p = null;\n    int *q = NULL;\n    return 0;\n}\n</code></pre>\n\n<p>This gives the below error on compilation:</p>\n\n<p>error: \u2018null\u2019 was not declared in this scope</p>\n\n<p>Which is self explanatory.</p>\n"}, {"tags": [], "owner": {"reputation": 132, "user_id": 11645986, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89133dfb99c82778981765f01f65eaa?s=128&d=identicon&r=PG&f=1", "display_name": "dragon", "link": "https://stackoverflow.com/users/11645986/dragon"}, "is_accepted": false, "score": 2, "last_activity_date": 1560927958, "creation_date": 1560927958, "answer_id": 56661883, "question_id": 56661378, "link": "https://stackoverflow.com/questions/56661378/is-lowercase-null-valid-in-c/56661883#56661883", "title": "Is lowercase null valid in C++?", "body": "<p>The answer is written in some of the header files. NULL is the predefined macro in those header files such as **</p>\n\n<blockquote>\n  <p><strong> -> #define NULL 0</strong></p>\n</blockquote>\n\n<p>**. Hence we can only define with uppercase \"NULL\" to avoid the compilation termination. </p>\n\n<p>However, if you wish for lower case null, you can do so by defining the new macro or make charges in predefined macro in the header file. but be careful before you want to make these changes.    </p>\n"}], "owner": {"reputation": 2844, "user_id": 8740349, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FRL1s.jpg?s=128&g=1", "display_name": "Top-Master", "link": "https://stackoverflow.com/users/8740349/top-master"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4751, "favorite_count": 0, "accepted_answer_id": 56661458, "answer_count": 3, "score": 4, "last_activity_date": 1588338409, "creation_date": 1560925892, "last_edit_date": 1588338409, "question_id": 56661378, "link": "https://stackoverflow.com/questions/56661378/is-lowercase-null-valid-in-c", "title": "Is lowercase null valid in C++?", "body": "<p>Is there any lowercase <code>null</code> in any version of C++ language specification?</p>\n\n<h3>Background:</h3>\n\n<p>I was asked in an interview \"Which of the following pointer initializations are valid?\", and I filled the form something like:</p>\n\n<pre><code>// valid\n    int* p1 = 0;\n    int* p2 = 2-2;\n    int* p6 = new int;\n// invalid\n    int* p3 = 1; \n\n    int z = 0;\n    int* p4 = z;\n// ???\n    int* p5 = null;\n</code></pre>\n"}, {"tags": ["c++", "multithreading", "thread-safety"], "comments": [{"owner": {"reputation": 474, "user_id": 11310636, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/243689119dbf710ab44923faff266fcf?s=128&d=identicon&r=PG&f=1", "display_name": "Narase", "link": "https://stackoverflow.com/users/11310636/narase"}, "edited": false, "score": 0, "creation_date": 1560924273, "post_id": 56660923, "comment_id": 99890886, "body": "static_assert seems the solution to me. You can give your threads IDs and when accessing the variables you check via static_assert. It shouldnt be overhead after compile time"}, {"owner": {"reputation": 15, "user_id": 10190132, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-yQHYkzNrG3Y/AAAAAAAAAAI/AAAAAAAAAyg/hddeWXj5oNE/photo.jpg?sz=128", "display_name": "TechNeko", "link": "https://stackoverflow.com/users/10190132/techneko"}, "reply_to_user": {"reputation": 474, "user_id": 11310636, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/243689119dbf710ab44923faff266fcf?s=128&d=identicon&r=PG&f=1", "display_name": "Narase", "link": "https://stackoverflow.com/users/11310636/narase"}, "edited": false, "score": 0, "creation_date": 1560924524, "post_id": 56660923, "comment_id": 99890979, "body": "@Narase can you give some example code? Short of setters/getters I&#39;m not where sure to actually PUT the static_assert, though I do agree it&#39;s going to play at least some role in this."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10957435"}, "edited": false, "score": 2, "creation_date": 1560924856, "post_id": 56660923, "comment_id": 99891116, "body": "Can you provide an example of what you&#39;re doing? That makes answering much easier."}, {"owner": {"reputation": 35613, "user_id": 7582247, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OH0qZNY40Y4/AAAAAAAAAAI/AAAAAAAABbc/xAoU3i299E0/photo.jpg?sz=128", "display_name": "Ted Lyngmo", "link": "https://stackoverflow.com/users/7582247/ted-lyngmo"}, "edited": false, "score": 2, "creation_date": 1560925242, "post_id": 56660923, "comment_id": 99891261, "body": "&quot;<i>I&#39;d like a check to be run and an error to be thrown if one of these functions or variables is accessed from an illegal thread,</i>&quot; - Why not just make the variables inaccessible from other threads? No need to check, no overhead. Wrap the thread object in a class and add private members to the class. Example: <a href=\"https://stackoverflow.com/questions/56588075/how-to-extract-taskidtid-of-a-pthread-from-the-parent-thread/56588190#56588190\" title=\"how to extract taskidtid of a pthread from the parent thread\">stackoverflow.com/questions/56588075/&hellip;</a>"}, {"owner": {"reputation": 474, "user_id": 11310636, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/243689119dbf710ab44923faff266fcf?s=128&d=identicon&r=PG&f=1", "display_name": "Narase", "link": "https://stackoverflow.com/users/11310636/narase"}, "edited": false, "score": 0, "creation_date": 1560925385, "post_id": 56660923, "comment_id": 99891321, "body": "@TechNeko Put a wrapper around them like &quot;template&lt;T&gt; ProtectedVariable&quot; with the value inside via &quot;T&amp; get(int id)&quot;. It checks the id via static_assert and when no expection is thrown it returns the reference. Since the static_assert is only evaluated at compile time, Im pretty sure the optimizer will throw the whole thing away after compiling"}, {"owner": {"reputation": 1247, "user_id": 9107647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a43594ef3d74c11a31be7f9d5ebddc0?s=128&d=identicon&r=PG&f=1", "display_name": "Humphrey Winnebago", "link": "https://stackoverflow.com/users/9107647/humphrey-winnebago"}, "reply_to_user": {"reputation": 474, "user_id": 11310636, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/243689119dbf710ab44923faff266fcf?s=128&d=identicon&r=PG&f=1", "display_name": "Narase", "link": "https://stackoverflow.com/users/11310636/narase"}, "edited": false, "score": 0, "creation_date": 1561230700, "post_id": 56660923, "comment_id": 99998238, "body": "@Narase <code>static_assert</code> won&#39;t work here because the condition to be check is a runtime condition (e.g. Which thread is running this)."}], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 10190132, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-yQHYkzNrG3Y/AAAAAAAAAAI/AAAAAAAAAyg/hddeWXj5oNE/photo.jpg?sz=128", "display_name": "TechNeko", "link": "https://stackoverflow.com/users/10190132/techneko"}, "edited": false, "score": 0, "creation_date": 1561433417, "post_id": 56718366, "comment_id": 100051165, "body": "I appreciate the information, certainly helpful. The real question though is where do I PUT an assert macro? Is a requirement that I write setters and getters for all my thread protected variables then declare them as inline and hope they get optimised out in the final release?"}, {"owner": {"reputation": 1247, "user_id": 9107647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a43594ef3d74c11a31be7f9d5ebddc0?s=128&d=identicon&r=PG&f=1", "display_name": "Humphrey Winnebago", "link": "https://stackoverflow.com/users/9107647/humphrey-winnebago"}, "reply_to_user": {"reputation": 15, "user_id": 10190132, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-yQHYkzNrG3Y/AAAAAAAAAAI/AAAAAAAAAyg/hddeWXj5oNE/photo.jpg?sz=128", "display_name": "TechNeko", "link": "https://stackoverflow.com/users/10190132/techneko"}, "edited": false, "score": 0, "creation_date": 1561531839, "post_id": 56718366, "comment_id": 100089585, "body": "I have updated the answer. Hopefully it answer these questions"}], "tags": [], "owner": {"reputation": 1247, "user_id": 9107647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a43594ef3d74c11a31be7f9d5ebddc0?s=128&d=identicon&r=PG&f=1", "display_name": "Humphrey Winnebago", "link": "https://stackoverflow.com/users/9107647/humphrey-winnebago"}, "is_accepted": false, "score": 0, "last_activity_date": 1561531805, "last_edit_date": 1561531805, "creation_date": 1561230612, "answer_id": 56718366, "question_id": 56660923, "link": "https://stackoverflow.com/questions/56660923/c-how-do-i-create-thread-restricted-protected-variables-and-functions/56718366#56718366", "title": "c++, how do I create thread-restricted/protected variables and functions?", "body": "<p>What you described is exactly what <code>assert</code> macro is for. </p>\n\n<p><code>assert(condition)</code></p>\n\n<p>In a debug build <code>condition</code> is checked. If it is false, the program will throw an exception at that line. In a release build, the <code>assert</code> and whatever is inside the parentheses aren't  compiled. </p>\n\n<p>Without being harsh, it would have been more helpful if you had explained the variables you are trying to protect. What type are they? Where do they come from? What's their lifetime? Are they global? Why do you need to protect a returned type if it's void? How did you end up in a situation where one thread might accidentally access something. I kinda have to guess but I'll throw out some ideas here:</p>\n\n<pre><code>#include &lt;thread&gt;\n#include &lt;cassert&gt;\n\n\nvoid protectedFunction()\n{\n    assert(std::this_thread::get_id() == g_thread1.get_id());\n}\n\n// protect a global singleton (full program lifetime)\nstd::string&amp; protectedGlobalString()\n{\n    static std::string inst;\n    assert(std::this_thread::get_id() == g_thread1.get_id());\n    return inst;\n}\n\n// protect a class member\nint SomeClass::protectedInt()\n{\n    assert(std::this_thread::get_id() == g_thread1.get_id());\n    return this-&gt;m_theVar;\n}\n\n// thread protected wrapper\ntemplate &lt;typename T&gt;\nclass ThreadProtected\n{\n    std::thread::id m_expected;\n    T               m_val;\npublic:\n    ThreadProtected(T init, std::thread::id expected)\n        : m_val(init), m_expected(expected)\n    { }\n\n    T Get()\n    {\n        assert(std::this_thread::get_id() == m_expected);\n        return m_val;\n    }\n};\n\n// specialization for void\ntemplate &lt;&gt;\nclass ThreadProtected&lt;void&gt;\n{\npublic:\n    ThreadProtected(std::thread::id expected)\n    {\n        assert(std::this_thread::get_id() == expected);\n    }\n};\n</code></pre>\n\n<p><code>assert</code> is oldschool. We were actually told to stop using it at work because it was causing resource leaks (the exception was being caught high up in the stack). It has the potential to cause debugging headaches because the debug behavior is different from the release behavior. A lot of the time if the asserted condition is false, there isn't really a good choice of what to do; you usually don't want to continue running the function but you also don't know what value to return. <code>assert</code> is still very useful when developing code. I personally use <code>assert</code> all the time.</p>\n\n<p><code>static_assert</code> will not help here because the condition you are checking for (e.g. \"Which thread is running this code?\") is a runtime condition.</p>\n\n<p>Another note:</p>\n\n<p>Don't put things that you want to be compiled inside an <code>assert</code>. It seems obvious now, but it's easy to do something dumb like </p>\n\n<pre><code>int* p;\nassert(p = new(nothrow) int);  // check that `new` returns a value -- BAD!!\n</code></pre>\n\n<p>It's good to check the allocation of <code>new</code>, but the allocation won't happen in a release build, and you won't even notice until you start release testing!</p>\n\n<pre><code>int* p;\np = new(nothrow) int;\nassert(p);  // check that `new` returns a value -- BETTER...\n</code></pre>\n\n<p>Lastly, if you write the protected accessor functions in a class body or in a .h, you can goad the compiler into inlining them.</p>\n\n<hr>\n\n<p><strong>Update to address the question:</strong></p>\n\n<blockquote>\n  <p>The real question though is where do I PUT an assert macro? Is a\n  requirement that I write setters and getters for all my thread\n  protected variables then declare them as inline and hope they get\n  optimised out in the final release?</p>\n</blockquote>\n\n<p>You said there are variables that should be checked (in the debug build only) when accessed to make sure the correct thread is accessing them. So, theoretically, you would want an assert macro before <em>every</em> such access. This is easy if there are only a few places (if this is the the case, you can ignore everything I'm about to say). However, if there are so many places that it starts to violate the DRY Principal, I suggest writing getters/setters and putting the assert inside (This is what I've casually given examples of above). But while the assert won't add overhead in release mode (since it's conditionally compiled), using extra functions (probably) adds function call overhead. However, if you write them in the .h, there's a good chance they'll be inlined. </p>\n\n<p>Your requirement for me was to come up with a way to do this without release overhead. Now that I've mentioned inlining I'm obligated to say that the compiler knows best. There usually are compiler-specific ways to force inlining (since the compiler is allowed to ignore the <code>inline</code> keyword). You should be profiling the code before trying to inline things. See the answer to this question. <a href=\"https://stackoverflow.com/questions/3017264/is-it-good-practice-to-make-getters-and-setters-inline\">Is it good practice to make getters and setters inline?</a>. You can easily see if the compiler is inlining the function by looking at the assembly. Don't worry, you don't have to be good at assembly. Just find the calling function and look for a <code>call</code> to the getter/setter. If the function was inlined, you won't see a <code>call</code> and you'll see probably a <code>mov</code> instead.</p>\n"}], "owner": {"reputation": 15, "user_id": 10190132, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-yQHYkzNrG3Y/AAAAAAAAAAI/AAAAAAAAAyg/hddeWXj5oNE/photo.jpg?sz=128", "display_name": "TechNeko", "link": "https://stackoverflow.com/users/10190132/techneko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 154, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1561531805, "creation_date": 1560924030, "question_id": 56660923, "link": "https://stackoverflow.com/questions/56660923/c-how-do-i-create-thread-restricted-protected-variables-and-functions", "title": "c++, how do I create thread-restricted/protected variables and functions?", "body": "<p>I have three threads in an application I'm building, all of which remain open for the lifetime of the application. Several variables and functions should only be accessed from specific threads. In my debug compile, I'd like a check to be run and an error to be thrown if one of these functions or variables is accessed from an illegal thread, but I don't want this as overhead in my final compilation. I really just want this so I the programmer don't make stupid mistakes, not to protect my executing program from making mistakes.</p>\n\n<p>Originally, I had a 'thread protected' class template that would wrap around return types for functions, and run a check on construction before implicitly converting to the intended return type, but this didn't seem to work for void return types without disabling important warnings, and it didn't resolve my issue for protected variables.</p>\n\n<p>Is there a method of doing this, or is it outside the scope of the language? 'If you need this solution, you're doing it wrong' comments not appreciated, I managed to near halve my program's execution time with this methodology, but it's just too likely I'm going to make a mistake that results in a silent race condition and ultimately undefined behavior.</p>\n"}, {"tags": ["c++", "list", "debugging", "iterator"], "answers": [{"comments": [{"owner": {"reputation": 1160, "user_id": 2349125, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/7c96908756230e62221445a99c384cdc?s=128&d=identicon&r=PG&f=1", "display_name": "Donald", "link": "https://stackoverflow.com/users/2349125/donald"}, "edited": false, "score": 0, "creation_date": 1560924554, "post_id": 56660983, "comment_id": 99890991, "body": "+1 Thanks for the clarification. I interpreted it as, the erase happens first, followed by the decrement. Hence, I got messed up."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10957435"}, "edited": false, "score": 1, "creation_date": 1560924645, "post_id": 56660983, "comment_id": 99891033, "body": "In other words, because the decrement operator returns the value of the original iterator, the <code>erase</code> can happen and the iterator can still be valid. As opposed to the other code, which decrements an already invalid iterator. Just trying to say things different ways, so maybe more people can understand easier."}, {"owner": {"reputation": 144568, "user_id": 3309790, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7d1c7e499132b9945b412ac79d0e22f7?s=128&d=identicon&r=PG&f=1", "display_name": "songyuanyao", "link": "https://stackoverflow.com/users/3309790/songyuanyao"}, "reply_to_user": {"reputation": 1160, "user_id": 2349125, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/7c96908756230e62221445a99c384cdc?s=128&d=identicon&r=PG&f=1", "display_name": "Donald", "link": "https://stackoverflow.com/users/2349125/donald"}, "edited": false, "score": 0, "creation_date": 1560924743, "post_id": 56660983, "comment_id": 99891071, "body": "@LanceHAOH You must miss the nice point of post-decrement operator. :)"}, {"owner": {"reputation": 1160, "user_id": 2349125, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/7c96908756230e62221445a99c384cdc?s=128&d=identicon&r=PG&f=1", "display_name": "Donald", "link": "https://stackoverflow.com/users/2349125/donald"}, "edited": false, "score": 0, "creation_date": 1560925464, "post_id": 56660983, "comment_id": 99891353, "body": "@songyuanyao I feel bad now. You are right. From the STL docs &quot;Post-increment and post-decrement creates a copy of the object, increments or decrements the value of the object and returns the copy from before the increment or decrement.&quot;. All my life, I thought that post-decrement/increment operator will return the original value followed by applying the increment/decrement operation."}, {"owner": {"reputation": 1160, "user_id": 2349125, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/7c96908756230e62221445a99c384cdc?s=128&d=identicon&r=PG&f=1", "display_name": "Donald", "link": "https://stackoverflow.com/users/2349125/donald"}, "reply_to_user": {"reputation": 630, "user_id": 5141682, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b29f5b1a276d5ed23eaace729b8be71?s=128&d=identicon&r=PG&f=1", "display_name": "Christina Jacob", "link": "https://stackoverflow.com/users/5141682/christina-jacob"}, "edited": false, "score": 1, "creation_date": 1560925567, "post_id": 56660983, "comment_id": 99891398, "body": "@ChristinaJacob Undefined Behavior = Anything could happen."}, {"owner": {"reputation": 144568, "user_id": 3309790, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7d1c7e499132b9945b412ac79d0e22f7?s=128&d=identicon&r=PG&f=1", "display_name": "songyuanyao", "link": "https://stackoverflow.com/users/3309790/songyuanyao"}, "reply_to_user": {"reputation": 1160, "user_id": 2349125, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/7c96908756230e62221445a99c384cdc?s=128&d=identicon&r=PG&f=1", "display_name": "Donald", "link": "https://stackoverflow.com/users/2349125/donald"}, "edited": false, "score": 1, "creation_date": 1560925674, "post_id": 56660983, "comment_id": 99891450, "body": "@LanceHAOH Look at it from another angle, as an operator (or function), when it returns, the invocation ends. It&#39;s impossible to perform decrement after returning. So it must perform the decrement then return the original value copied."}], "tags": [], "owner": {"reputation": 144568, "user_id": 3309790, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7d1c7e499132b9945b412ac79d0e22f7?s=128&d=identicon&r=PG&f=1", "display_name": "songyuanyao", "link": "https://stackoverflow.com/users/3309790/songyuanyao"}, "is_accepted": true, "score": 5, "last_activity_date": 1560924627, "last_edit_date": 1560924627, "creation_date": 1560924274, "answer_id": 56660983, "question_id": 56660920, "link": "https://stackoverflow.com/questions/56660920/decrementing-iterator-after-each-loop-iteration-shows-weird-behavior/56660983#56660983", "title": "Decrementing iterator after each loop iteration shows weird behavior", "body": "<p>The 1st code has undefined behavior. As you said, <code>erase</code> makes the iterator invalid, the <code>it--</code> evaluated after that leads to UB.</p>\n\n<p>The 2nd code is fine; note the evaluation order is different. <code>it--</code> will decrement the iterator, then return the original value (that's the point of post-decrement operator). The original value is passed to <code>erase</code> later. Decrement happens before <code>erase</code> so it's fine.</p>\n"}], "owner": {"reputation": 1160, "user_id": 2349125, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/7c96908756230e62221445a99c384cdc?s=128&d=identicon&r=PG&f=1", "display_name": "Donald", "link": "https://stackoverflow.com/users/2349125/donald"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 56660983, "answer_count": 1, "score": 4, "last_activity_date": 1560924731, "creation_date": 1560924017, "last_edit_date": 1560924731, "question_id": 56660920, "link": "https://stackoverflow.com/questions/56660920/decrementing-iterator-after-each-loop-iteration-shows-weird-behavior", "title": "Decrementing iterator after each loop iteration shows weird behavior", "body": "<p>I created a program to try to practice on the semantics of the list data structure. I noticed a weird difference in the following pieces of code:</p>\n\n<p>First code:</p>\n\n<pre><code>#include&lt;iostream&gt;\n#include&lt;list&gt;\n\nusing namespace std;\n\nint main() {\n    list&lt;int&gt; l;\n    int n = 100;\n    for(int i = 0; i &lt; n; i++) {\n        l.push_back(i);\n    }\n    list&lt;int&gt;::iterator it = l.end();\n    it--;\n    for(; !l.empty(); it--) {\n        cout &lt;&lt; \"the size of l is \" &lt;&lt; (int) l.size() &lt;&lt; endl;\n        l.erase(it);\n    }\n}\n</code></pre>\n\n<p>Second code:</p>\n\n<pre><code>#include&lt;iostream&gt;\n#include&lt;list&gt;\n\nusing namespace std;\n\nint main() {\n    list&lt;int&gt; l;\n    int n = 100;\n    for(int i = 0; i &lt; n; i++) {\n        l.push_back(i);\n    }\n    list&lt;int&gt;::iterator it = l.end();\n    it--;\n    for(; !l.empty();) {\n        cout &lt;&lt; \"the size of l is \" &lt;&lt; (int) l.size() &lt;&lt; endl;\n        l.erase(it--);\n    }\n}\n</code></pre>\n\n<p>The objective of both pieces of code is simple - to simply erase all the elements in a list.</p>\n\n<p>The only difference between them is the place where the list iterator is decremented.\nIn the first code sample, I used the for-loop control flow to decrement the iterator. In the second, I used the post-decrement operator to decrement the iterator.</p>\n\n<p>Based on my understanding, the above code samples should be equivalent because I decrement the iterator <b>immediately</b> after I erase an element from the list. Furthermore, according to the STL docs, only the iterator to the erased element in the list is invalidated. So there should not be any undefined behavior.</p>\n\n<p>The problem is, the second code sample works as expected - it stops after erasing all elements in the list. However, for the first sample, the list size could even become negative?! When I tried increasing the initial number of elements in the list, the first program crashes halfway.</p>\n\n<p>Could someone kindly advise me on why these code samples behave differently?</p>\n"}, {"tags": ["c++", "oop", "design-patterns", "entity"], "comments": [{"owner": {"reputation": 16907, "user_id": 4832499, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/76532994f6efa8d7dc8a3bb5b7b262a8?s=128&d=identicon&r=PG&f=1", "display_name": "Passer By", "link": "https://stackoverflow.com/users/4832499/passer-by"}, "edited": false, "score": 0, "creation_date": 1560923598, "post_id": 56660747, "comment_id": 99890634, "body": "ECS is to literally not have inheritance, if that&#39;s what you&#39;re aiming for, read ECS again. It is typical for a game engine to require checking for the type of an object, so you will have something like <code>dynamic_cast&lt;Mage*&gt;(&amp;someCharachter)</code> in your current design, as well as making <code>Character</code> polymorphic."}, {"owner": {"reputation": 533, "user_id": 2121816, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/2ef34f3675b36942ffbc6ed7e502a9c8?s=128&d=identicon&r=PG", "display_name": "Raghav Malik", "link": "https://stackoverflow.com/users/2121816/raghav-malik"}, "reply_to_user": {"reputation": 16907, "user_id": 4832499, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/76532994f6efa8d7dc8a3bb5b7b262a8?s=128&d=identicon&r=PG&f=1", "display_name": "Passer By", "link": "https://stackoverflow.com/users/4832499/passer-by"}, "edited": false, "score": 0, "creation_date": 1560923991, "post_id": 56660747, "comment_id": 99890765, "body": "@PasserBy I know its supposed to avoid complex inheritance hierarchies but the concept of &quot;all <code>Character</code>s that are <code>Mage</code>s can <code>cast</code>&quot; basically seems identical to java&#39;s <code>interface</code> or c++&#39;s virtual class paradigms. Also I know I would have to dynamic cast, my problem was how would I know just given a <code>Character</code> instance which components it implements to know what to cast"}, {"owner": {"reputation": 606, "user_id": 3496382, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b1d5358aca39b65581c1a1c2750dc2?s=128&d=identicon&r=PG&f=1", "display_name": "gan_", "link": "https://stackoverflow.com/users/3496382/gan"}, "edited": false, "score": 0, "creation_date": 1560936923, "post_id": 56660747, "comment_id": 99897264, "body": "@Raghav Malik In this specific case they are very similar. The problem isn&#39;t about calling one method on one object, but how to handle many thousands of objects with potentially hundreds of components each. In this case, they are very different. The simplest way to implement a component system is to make a <code>GameObject</code> class and give it a pointer to each possible component type. If you want all mages, just iterate over all objects and grab those which have a non null pointer to a <code>MageComponent</code>"}], "answers": [{"tags": [], "owner": {"reputation": 2298, "user_id": 7699037, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae22aa9776941949ddf401f3eb7fc318?s=128&d=identicon&r=PG&f=1", "display_name": "Mike van Dyke", "link": "https://stackoverflow.com/users/7699037/mike-van-dyke"}, "is_accepted": false, "score": 0, "last_activity_date": 1560935365, "last_edit_date": 1560935365, "creation_date": 1560934552, "answer_id": 56663759, "question_id": 56660747, "link": "https://stackoverflow.com/questions/56660747/is-it-possible-to-use-inheritance-to-implement-an-ecs-in-c/56663759#56663759", "title": "Is it possible to use inheritance to implement an ECS in c++?", "body": "<p>You could use the <a href=\"https://en.wikipedia.org/wiki/Visitor_pattern\" rel=\"nofollow noreferrer\">visitor pattern</a> in your Engine:</p>\n\n<p>Each character would override the pure virtual accept method of the <code>Character</code> class.</p>\n\n<pre><code>class Engine;\nclass Spell {};\nclass Direction {};\n\nclass Character {\n public:\n  virtual void accept(Engine&amp; engine) = 0;\n};\n\nclass Fighter {\n public:\n  virtual Direction attack() = 0;\n};\n\nclass Mage {\n public:\n  virtual Spell cast() = 0;\n};\n</code></pre>\n\n<p>Inheriting <code>Character</code> in <code>Mage</code> and <code>Fighter</code> would include less boilerplate code. If you want to stick to your form of inheritance, you need to provide an overload of the <code>accept</code> method in each character, which just calls the <code>visit</code> function of the <code>Engine</code>:</p>\n\n<pre><code>class ElvenMage : public Character, Mage {\n public:\n  ElvenMage() {}\n  virtual Spell cast() {\n    std::cout &lt;&lt; \"Casting from ElvenMage\"\n              &lt;&lt; \"\\n\";\n    return Spell{};\n  }\n\n  void accept(Engine&amp; visitor) override { visitor.visit(*this); }\n};\n\nclass Player : public Character, Fighter, Mage {\n public:\n  Player() {}\n  virtual Direction attack() {\n    std::cout &lt;&lt; \"Attacking from Player\"\n              &lt;&lt; \"\\n\";\n    return Direction{};\n  }\n\n  virtual Spell cast() {\n    std::cout &lt;&lt; \"Casting from Player\"\n              &lt;&lt; \"\\n\";\n    return Spell{};\n  }\n\n  void accept(Engine&amp; visitor) override { \n    // cast to Player if it should attack instead of casting\n    visitor.visit(static_cast&lt;Mage&amp;&gt;(*this)); \n  }\n};\n</code></pre>\n\n<p>The <code>visit</code> method is where the magic happens: </p>\n\n<pre><code>class Engine {\n  std::vector&lt;std::unique_ptr&lt;Character&gt;&gt; characters;\n  void do_stuff_with_spell(Spell spell) {\n    // ...\n  }\n  void do_stuff_with_attack(Direction direction) {\n    // ...\n  }\n\n public:\n  void visit(Mage&amp; mage) { do_stuff_with_spell(mage.cast()); }\n  void visit(Player&amp; player) { do_stuff_with_attack(player.attack()); }\n\n};\n</code></pre>\n\n<p>Note, that I have a circular dependency in the code above, which should be resolved when splitting up the declarations and definitions.</p>\n"}], "owner": {"reputation": 533, "user_id": 2121816, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/2ef34f3675b36942ffbc6ed7e502a9c8?s=128&d=identicon&r=PG", "display_name": "Raghav Malik", "link": "https://stackoverflow.com/users/2121816/raghav-malik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 322, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1560935365, "creation_date": 1560923120, "question_id": 56660747, "link": "https://stackoverflow.com/questions/56660747/is-it-possible-to-use-inheritance-to-implement-an-ecs-in-c", "title": "Is it possible to use inheritance to implement an ECS in c++?", "body": "<p>I'm trying to architect a game I'm writing in C++ as an Entity/Component system (the basic idea being I would have a set of \"Entity\" classes representing different kinds of  data and a set of \"Component\" classes representing various behaviors a given entity could have). I wanted to implement it using virtual base classes for the components. For instance, I could have a <code>Character</code> entity:</p>\n\n<pre><code>class Character {\npublic:\n    int armor;\n    int health;\n    std::string name;\n};\n</code></pre>\n\n<p>as well as a <code>Fighter</code> component representing something that can use melee weapons:</p>\n\n<pre><code>class Fighter {\npublic:\n    int damage;\n    virtual Direction attack() = 0;\n}\n</code></pre>\n\n<p>and a <code>Mage</code> component representing something that can cast spells</p>\n\n<pre><code>class Mage {\npublic:\n    std::vector&lt;Spell&gt; spellList;\n    virtual Spell cast() = 0;\n}\n</code></pre>\n\n<p>Using multiple inheritance to use these, I'd have</p>\n\n<pre><code>class ElvenMage : Character, Mage {\npublic:\n    ElvenMage() {\n        this-&gt;armor = 0;\n        this-&gt;health = 10;\n        this-&gt;name = \"elven mage\";\n        this-&gt;spellList = ...;\n    }\n    virtual Spell cast() {\n        // some AI logic to figure out which spell to cast\n    }\n};\n</code></pre>\n\n<p>and</p>\n\n<pre><code>class Player : Character, Fighter, Mage {\npublic:\n    Player() {\n        this-&gt;armor = 5;\n        this-&gt;health = 20;\n        this-&gt;name = \"Player\";\n    }\n    virtual Direction attack() {\n        // some logic to handle player melee input\n    }\n    virtual Spell cast() {\n        // some logic to handle player spell casting input\n    }\n};\n</code></pre>\n\n<p>To keep track of all current characters on the map I could do something like</p>\n\n<pre><code>class Engine {\npublic:\n    std::vector&lt;std::unique_ptr&lt;Character&gt;&gt; characters;\n</code></pre>\n\n<p>I have to store them directly as <code>Characters</code> (not as <code>Fighters</code> or <code>Mages</code>), yet I would need to process fighters and mages separately (for instance, looping through all <code>Characters</code> and if they can cast a spell they do so otherwise they attack with a melee weapon). In the actual game logic, how would I distinguish between an instance of <code>Character</code> that also implements <code>Mage</code> vs. an instance of <code>Character</code> that also implements <code>Fighter</code>?</p>\n\n<p>Is there an easy way to do what I am trying to, or should I completely rethink my design?</p>\n\n<p>(note: this isn't actual code; in the real world I'd actually use a factory or something to create elves or whatever instead of trying to put all the information in the constructor, and I'd probably separate the logic differently, but it illustrates the problem I'm having). </p>\n"}]