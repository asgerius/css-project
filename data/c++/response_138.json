[{"tags": ["c++", "nested"], "comments": [{"owner": {"reputation": 133051, "user_id": 501250, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c39ae7fe43cf30bc0f4d4051defcbd87?s=128&d=identicon&r=PG", "display_name": "cdhowie", "link": "https://stackoverflow.com/users/501250/cdhowie"}, "edited": false, "score": 0, "creation_date": 1504139419, "post_id": 45971249, "comment_id": 78902047, "body": "<i>&quot;How can I implement this situation with the <code>B</code> class implemented elsewhere, like a template?&quot;</i> Please elaborate on this. I&#39;m not sure what you mean."}, {"owner": {"reputation": 700, "user_id": 4337367, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/4e10812e7d10f1fd7f76102f6d99cd4e?s=128&d=identicon&r=PG&f=1", "display_name": "Adama", "link": "https://stackoverflow.com/users/4337367/adama"}, "reply_to_user": {"reputation": 133051, "user_id": 501250, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c39ae7fe43cf30bc0f4d4051defcbd87?s=128&d=identicon&r=PG", "display_name": "cdhowie", "link": "https://stackoverflow.com/users/501250/cdhowie"}, "edited": false, "score": 0, "creation_date": 1504170280, "post_id": 45971249, "comment_id": 78913532, "body": "@cdhowie Thank you for your feedback, I elaborated on what I am trying to achieve. Please let me know if more clarifications are needed. :)"}, {"owner": {"reputation": 133051, "user_id": 501250, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c39ae7fe43cf30bc0f4d4051defcbd87?s=128&d=identicon&r=PG", "display_name": "cdhowie", "link": "https://stackoverflow.com/users/501250/cdhowie"}, "edited": false, "score": 0, "creation_date": 1504191002, "post_id": 45971249, "comment_id": 78928446, "body": "It&#39;s still not clear to me what your actual goal is. A practical example would help. Pseudocode isn&#39;t that useful here because I can see multiple ways to simplify it that may not work with the real code. (<a href=\"http://coliru.stacked-crooked.com/a/8d4e84fefc1bb2f1\" rel=\"nofollow noreferrer\">For example</a>)"}], "answers": [{"tags": [], "owner": {"reputation": 133051, "user_id": 501250, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c39ae7fe43cf30bc0f4d4051defcbd87?s=128&d=identicon&r=PG", "display_name": "cdhowie", "link": "https://stackoverflow.com/users/501250/cdhowie"}, "is_accepted": false, "score": 1, "last_activity_date": 1504190708, "last_edit_date": 1504190708, "creation_date": 1504139400, "answer_id": 45971531, "question_id": 45971249, "link": "https://stackoverflow.com/questions/45971249/decoupling-nested-classes-conflicting-declaration-of-template-error-when-usin/45971531#45971531", "title": "Decoupling nested classes: &quot;conflicting declaration of template&quot; error when using template aliases", "body": "<p>In the second example, you have this, which forward-declares a template class:</p>\n\n<pre><code>template &lt;typename T&gt; class BImpl;\n</code></pre>\n\n<p>Then you try to do this, which declares a template alias:</p>\n\n<pre><code>template &lt;typename T&gt;\nusing BImpl = Bbase&lt; AImpl&lt;T&gt; &gt;;\n</code></pre>\n\n<p>But an alias is not a class -- you can't define a class by using an alias.  The compiler tells you this:</p>\n\n<pre><code>foo.cpp:22:32: error: conflicting declaration of template \u2018template&lt;class T&gt; using BImpl = Bbase&lt;AImpl&lt;T&gt; &gt;\u2019\n</code></pre>\n\n<blockquote>\n  <p>Why does the first code snippet work? Is it implementation in the first case and (re)definition in the latter?</p>\n</blockquote>\n\n<p>The first code snippet works because it's well-formed; quite simply, there's nothing about it that makes it not work.  In the second case, you define an alias with the same name as a class, and that's not allowed.</p>\n\n<blockquote>\n  <p>Can I forward-declare <code>B</code> as a template class and later down declare it as an alias class?</p>\n</blockquote>\n\n<p>No.</p>\n"}], "owner": {"reputation": 700, "user_id": 4337367, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/4e10812e7d10f1fd7f76102f6d99cd4e?s=128&d=identicon&r=PG&f=1", "display_name": "Adama", "link": "https://stackoverflow.com/users/4337367/adama"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 194, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1504190708, "creation_date": 1504136732, "last_edit_date": 1504170250, "question_id": 45971249, "link": "https://stackoverflow.com/questions/45971249/decoupling-nested-classes-conflicting-declaration-of-template-error-when-usin", "title": "Decoupling nested classes: &quot;conflicting declaration of template&quot; error when using template aliases", "body": "<p>Following the advice of <a href=\"https://stackoverflow.com/questions/16966686/forward-declare-typedef-within-c-class\">this question</a>, I have used late template instantiation to decouple two classes, <code>A</code> and <code>B</code>, which both refer to each other:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;memory&gt;\n\ntemplate &lt;typename T&gt;\nclass Bbase {\n};      \n\ntemplate &lt;typename T&gt; class BImpl;\n\ntemplate &lt;typename T&gt;\nclass AImpl\n{\npublic:\n    typedef boost::shared_ptr&lt;AImpl&gt; Ptr;\n    typename BImpl&lt;T&gt;::Ptr foo();\n};\n\ntemplate &lt;typename T&gt;\nclass BImpl\n{\npublic:\n    typedef boost::shared_ptr&lt;BImpl&gt; Ptr;\n    typename AImpl&lt;T&gt;::Ptr bar();\n};\n\n\ntypedef AImpl&lt;void&gt; A;\ntypedef BImpl&lt;void&gt; B;\n\nint main () {\n        A a;\n        B b;\n        return 0;\n}\n</code></pre>\n\n<p>The above compiles with no errors.</p>\n\n<p>However, if I try to implement <code>B</code> elsewhere and define an alias class, I get the following compilation errors:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;memory&gt;\n\ntemplate &lt;typename U&gt;\nclass Bbase {\npublic:\n    typedef std::shared_ptr&lt;Bbase&gt; Ptr;\n    typename U::Ptr bar();\n};      \n\ntemplate &lt;typename T&gt; class BImpl;\n\ntemplate &lt;typename T&gt;\nclass AImpl\n{\npublic:\n    typedef std::shared_ptr&lt;AImpl&gt; Ptr;\n    typename BImpl&lt;T&gt;::Ptr foo();\n};\n\ntemplate &lt;typename T&gt;\nusing BImpl = Bbase&lt; AImpl&lt;T&gt; &gt;;\n\ntypedef AImpl&lt;void&gt; A;\ntypedef BImpl&lt;void&gt; B;\n\nint main () {\n        A a;\n        B b;\n        return 0;\n}\n</code></pre>\n\n<p>Compiler:</p>\n\n<pre><code>$ g++ foo.cpp --std=c++14                                                                                                                                                                        \nfoo.cpp:22:32: error: conflicting declaration of template \u2018template&lt;class T&gt; using BImpl = Bbase&lt;AImpl&lt;T&gt; &gt;\u2019                                                                                                                                                  \n using BImpl = Bbase&lt; AImpl&lt;T&gt; &gt;;\n                                ^\nfoo.cpp:11:29: note: previous declaration \u2018template&lt;class T&gt; class BImpl\u2019\n template &lt;typename T&gt; class BImpl;\n                             ^\nfoo.cpp: In instantiation of \u2018class AImpl&lt;void&gt;\u2019:\nfoo.cpp:28:4:   required from here\nfoo.cpp:18:28: error: invalid use of incomplete type \u2018class BImpl&lt;void&gt;\u2019\n     typename BImpl&lt;T&gt;::Ptr foo();\n                            ^\nfoo.cpp:11:29: error: declaration of \u2018class BImpl&lt;void&gt;\u2019\n template &lt;typename T&gt; class BImpl;\n                             ^\nfoo.cpp: In function \u2018int main()\u2019:\nfoo.cpp:29:4: error: aggregate \u2018B b\u2019 has incomplete type and cannot be defined\n  B b;\n    ^\n</code></pre>\n\n<p>I understand the compiler error, that I am trying to redefine a template, but I do not comprehend:</p>\n\n<ul>\n<li>Why does the first code snippet work? Is it implementation in the first case and (re)definition in the latter?</li>\n<li>Can I forward-declare <code>B</code> as a template class and later down declare it as an alias class?</li>\n</ul>\n\n<p>What I would ideally like to do is this:</p>\n\n<pre><code>using A = std::vector&lt; B::iterator &gt;;\nusing B = std::vector&lt; A::iterator &gt;;\n</code></pre>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 27279, "user_id": 857132, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4fd51ed5980999c7c6ce3729d6cb2184?s=128&d=identicon&r=PG", "display_name": "John3136", "link": "https://stackoverflow.com/users/857132/john3136"}, "edited": false, "score": 4, "creation_date": 1504136032, "post_id": 45971152, "comment_id": 78901445, "body": "Logic to do &quot;stuff based on state&quot; has to exist somewhere..."}, {"owner": {"reputation": 56117, "user_id": 845092, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/50ccdbac5f0f9ff683e4b30a248189bf?s=128&d=identicon&r=PG", "display_name": "Mooing Duck", "link": "https://stackoverflow.com/users/845092/mooing-duck"}, "edited": false, "score": 1, "creation_date": 1504136154, "post_id": 45971152, "comment_id": 78901462, "body": "Avoid tons of functions that basically do the same thing but change the way they do it. Make objects and use dynamic dispatch."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1504136636, "post_id": 45971152, "comment_id": 78901553, "body": "You need a dispatch table, often just a humble <code>switch</code> statement."}, {"owner": {"reputation": 52656, "user_id": 225074, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/dea26ac1ef8259140d28aa8b5ba4f1b3?s=128&d=identicon&r=PG", "display_name": "Thomas Matthews", "link": "https://stackoverflow.com/users/225074/thomas-matthews"}, "edited": false, "score": 0, "creation_date": 1504139457, "post_id": 45971152, "comment_id": 78902052, "body": "Search the internet for &quot;c++ double dispatch&quot; and &quot;c++ dispatch&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 12222, "user_id": 128581, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7fad01453b6f78fd4401c935f0daedd3?s=128&d=identicon&r=PG", "display_name": "Josh", "link": "https://stackoverflow.com/users/128581/josh"}, "is_accepted": true, "score": 2, "last_activity_date": 1504136535, "creation_date": 1504136535, "answer_id": 45971220, "question_id": 45971152, "link": "https://stackoverflow.com/questions/45971152/overriding-same-class-method-at-run-time-c/45971220#45971220", "title": "overriding same class method at run-time c++", "body": "<p>I think the case you describe is not a very good case for polymorphism. I think you should consider using Composition along with the Strategy pattern.</p>\n\n<p>This concept is where you encapsulate some work or algorithm in a function or callable object, of which you have several, then choose which one to use based on the parents state. You can hold a reference to a pointer or callable object (functor) in a std::function, which can be a member of the parent class.</p>\n\n<p>Or, even more simply, if the system doesn't call for such complexity, you have member functions which contain each method for resolving the new input, and choose which one to use with if statements.</p>\n"}], "owner": {"reputation": 33, "user_id": 7954819, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7668cdb7ec17b0ac7fed26acf6c86dfe?s=128&d=identicon&r=PG&f=1", "display_name": "NAD", "link": "https://stackoverflow.com/users/7954819/nad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 45971220, "answer_count": 1, "score": 1, "last_activity_date": 1504136535, "creation_date": 1504135927, "last_edit_date": 1504136369, "question_id": 45971152, "link": "https://stackoverflow.com/questions/45971152/overriding-same-class-method-at-run-time-c", "title": "overriding same class method at run-time c++", "body": "<p>say I have a class like this in c++:</p>\n\n<pre><code>class MyClass\n{\n    public:\n        int MyMethod1 (/*Some Cool Args*/)\n        {\n            //do something\n        }\n        int MyMethod2 (/*More Args*/)\n        {\n            //do something\n        }\n        .\n        .\n        .\n        int MyMethodN (/*More Args*/)\n        {\n            //do something\n        }\n}\n</code></pre>\n\n<p>now, lets say that depending on the state of the object at runtime, i need to use either MyMethode1, MyMethode2, ..., or MyMethodeN, wich all do bassically the same but change the way they do it based on the object state at run-time.</p>\n\n<p><em>So, my question is</em>: Is there a way to have something like...</p>\n\n<pre><code>class MyClass\n{\n    public:\n        int MyMethod (/*Some Cool Args*/)\n        {\n            //do something in consideration to the current object state\n        }\n}\n</code></pre>\n\n<p>Basically what I mean is if a polymorphic behavior can be achieved within a same class without having to call derived objects or use pointers to member methods or have a sequence of ifs or a switch</p>\n"}, {"tags": ["c++", "gcc", "clang", "fpic"], "answers": [{"comments": [{"owner": {"reputation": 10709, "user_id": 3212865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B6qLg.jpg?s=128&g=1", "display_name": "spectras", "link": "https://stackoverflow.com/users/3212865/spectras"}, "reply_to_user": {"reputation": 245138, "user_id": 2069064, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/e4V2X.jpg?s=128&g=1", "display_name": "Barry", "link": "https://stackoverflow.com/users/2069064/barry"}, "edited": false, "score": 0, "creation_date": 1504275932, "post_id": 45972300, "comment_id": 78965437, "body": "@Barry&gt; Glad you found it useful, I did learn interesting stuff investigating this question. I was curious about <code>last</code> as well and did a few tests; added some findings to the post."}, {"owner": {"reputation": 245138, "user_id": 2069064, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/e4V2X.jpg?s=128&g=1", "display_name": "Barry", "link": "https://stackoverflow.com/users/2069064/barry"}, "edited": false, "score": 0, "creation_date": 1504276856, "post_id": 45972300, "comment_id": 78966066, "body": "What&#39;s the advantage of the alias attribute over <code>visibility(&quot;hidden&quot;)</code>?"}, {"owner": {"reputation": 10709, "user_id": 3212865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B6qLg.jpg?s=128&g=1", "display_name": "spectras", "link": "https://stackoverflow.com/users/3212865/spectras"}, "reply_to_user": {"reputation": 245138, "user_id": 2069064, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/e4V2X.jpg?s=128&g=1", "display_name": "Barry", "link": "https://stackoverflow.com/users/2069064/barry"}, "edited": false, "score": 0, "creation_date": 1504277495, "post_id": 45972300, "comment_id": 78966491, "body": "@Barry&gt; that what just to keep the attribute visible, so that the semantic remains equivalent, but for the lack of interposition support. Granted, if there is not intent of actually exporting them, one can just do away with the aliases and have visibility(&quot;hidden&quot;). I didn&#39;t test it btw, but I believe compiling with <code>-fvisibility=hidden -fvisibility-inlines-hidden</code> and manually marking relevant symbols with <code>__attribute__((visibility(&quot;default&quot;)))</code> should yield the same result."}, {"owner": {"reputation": 15544, "user_id": 1908347, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/e1305fee562b70958e65b557ce049e31?s=128&d=identicon&r=PG", "display_name": "Nir Friedman", "link": "https://stackoverflow.com/users/1908347/nir-friedman"}, "edited": false, "score": 0, "creation_date": 1504326212, "post_id": 45972300, "comment_id": 78981385, "body": "This seems to imply that any codebase written with shared libraries (common nowadays) which is very likely to be -fpic compiled, which doesn&#39;t bother with symbol visibility and leaves it at the linux default (visible), is going to have very crippled performance on gcc because things cannot be inlined (even functions declared in header files, which will be <code>inline</code> but usually not <code>static</code>). Can this really be right? Is there a reason why the effect is less dramatic than I&#39;m understanding it to be?"}, {"owner": {"reputation": 10709, "user_id": 3212865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B6qLg.jpg?s=128&g=1", "display_name": "spectras", "link": "https://stackoverflow.com/users/3212865/spectras"}, "reply_to_user": {"reputation": 15544, "user_id": 1908347, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/e1305fee562b70958e65b557ce049e31?s=128&d=identicon&r=PG", "display_name": "Nir Friedman", "link": "https://stackoverflow.com/users/1908347/nir-friedman"}, "edited": false, "score": 0, "creation_date": 1504353981, "post_id": 45972300, "comment_id": 78987206, "body": "@NirFriedman&gt; I would suspect that such cases are not that common. First, because the cost is limited: PLT is very likely to be in cache already, call is unconditional so cpu should have no issue with predictive execution, and functions small enough to be inlined are likely to have all there arguments passed as registers anyway. Add to that that it only occurs when there is an inlining opportunity, which may not be <i>that</i> frequent, and that most code is not performance-critical to begin with."}, {"owner": {"reputation": 10709, "user_id": 3212865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B6qLg.jpg?s=128&g=1", "display_name": "spectras", "link": "https://stackoverflow.com/users/3212865/spectras"}, "reply_to_user": {"reputation": 15544, "user_id": 1908347, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/e1305fee562b70958e65b557ce049e31?s=128&d=identicon&r=PG", "display_name": "Nir Friedman", "link": "https://stackoverflow.com/users/1908347/nir-friedman"}, "edited": false, "score": 0, "creation_date": 1504354173, "post_id": 45972300, "comment_id": 78987266, "body": "@NirFriedman&gt; In addition, the trend seems to be to compile more and more with <code>-fvisibility=hidden</code>, manually exporting relevant symbols. That cuts down on symbols, drastically improving both static linking and loading (dynamic linking) times. And avoids accidental symbol interposition, which is a thing in C: it&#39;s easy to prefix public API with lib name, but it&#39;s also easy to forget internal functions get exported by default too."}, {"owner": {"reputation": 2652, "user_id": 1395620, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd851cb368a0747715f41fda62a49ca8?s=128&d=identicon&r=PG", "display_name": "Daniel Santos", "link": "https://stackoverflow.com/users/1395620/daniel-santos"}, "reply_to_user": {"reputation": 15544, "user_id": 1908347, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/e1305fee562b70958e65b557ce049e31?s=128&d=identicon&r=PG", "display_name": "Nir Friedman", "link": "https://stackoverflow.com/users/1908347/nir-friedman"}, "edited": false, "score": 0, "creation_date": 1504490773, "post_id": 45972300, "comment_id": 79018826, "body": "@Nir Friedman I don&#39;t know about crippling, but it is a performance hit.  Obviously the context matters and rather or not the other code in the hot path inundates the instruction cache, etc.  To my understanding, -flto still isn&#39;t stable enough to use it to build a whole system, but that will solve a lot of these problems as well (once it matures)."}, {"owner": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "edited": false, "score": 0, "creation_date": 1504728216, "post_id": 45972300, "comment_id": 79128837, "body": "Could the last code snipest be simpler if one set the visibility to protected?"}, {"owner": {"reputation": 10709, "user_id": 3212865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B6qLg.jpg?s=128&g=1", "display_name": "spectras", "link": "https://stackoverflow.com/users/3212865/spectras"}, "reply_to_user": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "edited": false, "score": 0, "creation_date": 1504733030, "post_id": 45972300, "comment_id": 79131123, "body": "@Oliv&gt; one would believe so, and clang does output what one would expect. However, a quick test shows that <code>gcc</code> sticks to using the GOT for <code>last</code> variable despite <code>protected</code> visibility. It does inline the call to <code>next</code> though."}, {"owner": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "edited": false, "score": 0, "creation_date": 1504765904, "post_id": 45972300, "comment_id": 79140254, "body": "@spectras Do you think <code>gcc</code> does it to follow x86-abi spec or <code>gcc</code> is just missing an optimization oportunity?"}, {"owner": {"reputation": 10709, "user_id": 3212865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B6qLg.jpg?s=128&g=1", "display_name": "spectras", "link": "https://stackoverflow.com/users/3212865/spectras"}, "reply_to_user": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "edited": false, "score": 1, "creation_date": 1504792001, "post_id": 45972300, "comment_id": 79157990, "body": "@Oliv&gt; interestingly, with protected visibility on <code>last</code>, <code>clang -O2 -fPIC -shared foo.cxx</code> fails with error <code>relocation R_X86_64_PC32 against protected symbol &#39;last&#39; can not be used when making a shared object</code>. So I would say that clang (3.8.0)&#39;s implementation is dubious."}, {"owner": {"reputation": 10709, "user_id": 3212865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B6qLg.jpg?s=128&g=1", "display_name": "spectras", "link": "https://stackoverflow.com/users/3212865/spectras"}, "reply_to_user": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "edited": false, "score": 0, "creation_date": 1504793336, "post_id": 45972300, "comment_id": 79159047, "body": "@oliv&gt; digging more, it seems clang is plain wrong on that one. A protected data symbol <i>can</i> be external. Marking it as protected only ensures it cannot be interposed. However, with copy-relocation, it will be transferred to the executable&#39;s <code>.bss</code> section at runtime. Which won&#39;t work with <code>clang</code>&#39;s output. Said otherwise, clang 3.8.0 fails to compile shared objects that include protected data symbols."}, {"owner": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "edited": false, "score": 1, "creation_date": 1504813154, "post_id": 45972300, "comment_id": 79170630, "body": "@spectras I have continue to digg in that direction. This clang bug can be fixed by declaring the variable extern and defining it an other source file. I have checked with readelf, the 3 symbols have the same protected visibility. More over, clang and gcc both load <code>last</code> from a dynamic location :)!"}, {"owner": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "edited": false, "score": 0, "creation_date": 1504859847, "post_id": 45972300, "comment_id": 79186602, "body": "@spectras Finally, it seems that Clang is not wrong, putting protected visibility in the header file will also lead to an error with gcc but at link time, when linking the shared library with an executable."}, {"owner": {"reputation": 10709, "user_id": 3212865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B6qLg.jpg?s=128&g=1", "display_name": "spectras", "link": "https://stackoverflow.com/users/3212865/spectras"}, "reply_to_user": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "edited": false, "score": 0, "creation_date": 1504868412, "post_id": 45972300, "comment_id": 79191857, "body": "@Oliv&gt; interesting as it is, it&#39;s getting too far from this example to follow and be sure we talk about the exact same thing :)"}], "tags": [], "owner": {"reputation": 10709, "user_id": 3212865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B6qLg.jpg?s=128&g=1", "display_name": "spectras", "link": "https://stackoverflow.com/users/3212865/spectras"}, "is_accepted": true, "score": 14, "last_activity_date": 1504275796, "last_edit_date": 1504275796, "creation_date": 1504146395, "answer_id": 45972300, "question_id": 45971091, "link": "https://stackoverflow.com/questions/45971091/gcc-vs-clang-inlining-a-function-with-fpic/45972300#45972300", "title": "gcc vs clang: inlining a function with -fPIC", "body": "<p>I don't think the standard goes into that much detail. It merely says that roughly if the symbol has external linkage in different translation units, it is the same symbol. That makes clang's version correct.</p>\n\n<p>From that point on, to the best of my knowledge, we're out of the standard. Compilers choices differ on what they consider a useful <code>-fPIC</code> output.</p>\n\n<p>Note that <code>g++ -c -std=c++11 -O3 -fPIE</code> outputs:</p>\n\n<pre><code>0000000000000000 &lt;_Z4nextv&gt;:\n   0:   8b 05 00 00 00 00       mov    0x0(%rip),%eax        # 6 &lt;_Z4nextv+0x6&gt;\n   6:   83 c0 01                add    $0x1,%eax\n   9:   89 05 00 00 00 00       mov    %eax,0x0(%rip)        # f &lt;_Z4nextv+0xf&gt;\n   f:   c3                      retq   \n\n0000000000000010 &lt;_Z5indexi&gt;:\n  10:   8b 05 00 00 00 00       mov    0x0(%rip),%eax        # 16 &lt;_Z5indexi+0x6&gt;\n  16:   89 f9                   mov    %edi,%ecx\n  18:   83 c0 01                add    $0x1,%eax\n  1b:   89 05 00 00 00 00       mov    %eax,0x0(%rip)        # 21 &lt;_Z5indexi+0x11&gt;\n  21:   d3 e0                   shl    %cl,%eax\n  23:   c3                      retq\n</code></pre>\n\n<p>So GCC <strong>does</strong> know how to optimize this. It just chooses not to when using <code>-fPIC</code>. But why? I can see only one explanation: make it possible to override the symbol during dynamic linking, and see the effects consistently. The technique is known as <a href=\"http://www.drdobbs.com/building-library-interposers-for-fun-and/184404926\" rel=\"noreferrer\">symbol interposition</a>.</p>\n\n<p>In a shared library, if <code>index</code> calls <code>next</code>, as <code>next</code> is globally visible, gcc has to consider the possibility that <code>next</code> could be interposed. So it uses the PLT. When using <code>-fPIE</code> however, you are not allowed to interpose symbols, so gcc enables the optimization.</p>\n\n<p>So is clang wrong? No. But gcc seems to provide better support for symbol interposition, which is handy for instrumenting the code. It does so at the cost of some overhead if one uses <code>-fPIC</code> instead of <code>-fPIE</code> for building his executable though.</p>\n\n<hr>\n\n<p>Additional notes:</p>\n\n<p>In <a href=\"http://hubicka.blogspot.fr/2015/04/GCC5-IPA-LTO-news.html\" rel=\"noreferrer\">this blog entry</a> from one of gcc developers, he mentions, around the end of the post:</p>\n\n<blockquote>\n  <p>While comparing some benchmarks to clang, I noticed that clang actually ignore ELF interposition rules. While it is bug, I decided to add <code>-fno-semantic-interposition</code> flag to GCC to get similar behaviour. If interposition is not desirable, ELF's official answer is to use hidden visibility and if the symbol needs to be exported define an alias. This is not always practical thing to do by hand.</p>\n</blockquote>\n\n<p>Following that lead landed me on the <a href=\"https://refspecs.linuxfoundation.org/elf/x86_64-abi-0.99.pdf\" rel=\"noreferrer\">x86-64 ABI spec</a>. In section 3.5.5, it does mandate that all functions calling a globally visible symbols must go through the PLT (it goes as far as defining the exact instruction sequence to use depending on memory model).</p>\n\n<p>So, though it does not violate C++ standard, ignoring semantic interposition seems to violate the ABI.</p>\n\n<hr>\n\n<p>Last word: didn't know where to put this, but it might be of interest to you. I'll spare you the dumps, but my tests with objdump and compiler options showed that:</p>\n\n<p>On the gcc side of things:</p>\n\n<ul>\n<li><strong><code>gcc -fPIC</code>:</strong> accesses to <code>last</code> goes through GOT, calls to <code>next()</code> goes through PLT.</li>\n<li><strong><code>gcc -fPIC -fno-semantic-interposition</code></strong>: <code>last</code> goes through GOT, <code>next()</code> is inlined.</li>\n<li><strong><code>gcc -fPIE</code>:</strong> <code>last</code> is IP-relative, <code>next()</code> is inlined.</li>\n<li><code>-fPIE</code> implies <code>-fno-semantic-interposition</code></li>\n</ul>\n\n<p>On the clang side of things:</p>\n\n<ul>\n<li><strong><code>clang -fPIC</code>:</strong> <code>last</code> goes through GOT, <code>next()</code> is inlined.</li>\n<li><strong><code>clang -fPIE</code>:</strong> <code>last</code> goes through GOT, <code>next()</code> is inlined.</li>\n</ul>\n\n<p>And a modified version that compiles to IP-relative, inlined on both compilers:</p>\n\n<pre><code>// foo.cxx\nint last_ __attribute__((visibility(\"hidden\")));\nextern int last __attribute__((alias(\"last_\")));\n\nint __attribute__((visibility(\"hidden\"))) next_()\n{\n  return ++last_;\n}\n// This one is ugly, because alias needs the mangled name. Could extern \"C\" next_ instead.\nextern int next() __attribute__((alias(\"_Z5next_v\")));\n\nint index(int scale) {\n  return next_() &lt;&lt; scale;\n}\n</code></pre>\n\n<p>Basically, this explicitly marks that despite making them available globally, we use hidden version of those symbols that will ignore any kind of interposition. Both compilers then fully optimize the accesses, regardless of passed options.</p>\n"}], "owner": {"reputation": 245138, "user_id": 2069064, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/e4V2X.jpg?s=128&g=1", "display_name": "Barry", "link": "https://stackoverflow.com/users/2069064/barry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1758, "favorite_count": 3, "accepted_answer_id": 45972300, "answer_count": 1, "score": 9, "last_activity_date": 1504320471, "creation_date": 1504135455, "question_id": 45971091, "link": "https://stackoverflow.com/questions/45971091/gcc-vs-clang-inlining-a-function-with-fpic", "title": "gcc vs clang: inlining a function with -fPIC", "body": "<p>Consider this code:</p>\n\n<pre><code>// foo.cxx\nint last;\n\nint next() {\n  return ++last;\n}\n\nint index(int scale) {\n  return next() &lt;&lt; scale;\n}\n</code></pre>\n\n<p>When compiling with gcc 7.2:</p>\n\n<pre><code>$ g++ -std=c++11 -O3 -fPIC\n</code></pre>\n\n<p>This emits:</p>\n\n<pre><code>next():\n    movq    last@GOTPCREL(%rip), %rdx\n    movl    (%rdx), %eax\n    addl    $1, %eax\n    movl    %eax, (%rdx)\n    ret\nindex(int):\n    pushq   %rbx\n    movl    %edi, %ebx\n    call    next()@PLT    ## next() not inlined, call through PLT\n    movl    %ebx, %ecx\n    sall    %cl, %eax\n    popq    %rbx\n    ret\n</code></pre>\n\n<p>However, when compiling the same code with the same flags using clang 3.9 instead:</p>\n\n<pre><code>next():                               # @next()\n    movq    last@GOTPCREL(%rip), %rcx\n    movl    (%rcx), %eax\n    incl    %eax\n    movl    %eax, (%rcx)\n    retq\n\nindex(int):                              # @index(int)\n    movq    last@GOTPCREL(%rip), %rcx\n    movl    (%rcx), %eax\n    incl    %eax              ## next() was inlined!\n    movl    %eax, (%rcx)\n    movl    %edi, %ecx\n    shll    %cl, %eax\n    retq\n</code></pre>\n\n<p>gcc calls <code>next()</code> via the PLT, clang inlines it. Both still lookup <code>last</code> from the GOT. For compiling on linux, is clang right to make that optimization and gcc is missing out on easy inlining, or is clang wrong to make that optimization, or is this purely a QoI issue?</p>\n"}, {"tags": ["c++", "text-files", "fstream"], "comments": [{"owner": {"reputation": 52656, "user_id": 225074, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/dea26ac1ef8259140d28aa8b5ba4f1b3?s=128&d=identicon&r=PG", "display_name": "Thomas Matthews", "link": "https://stackoverflow.com/users/225074/thomas-matthews"}, "edited": false, "score": 0, "creation_date": 1504133205, "post_id": 45970788, "comment_id": 78900729, "body": "Do you <i>need</i> a vector of vector of string?  Or will a vector of strings be sufficient?"}, {"owner": {"reputation": 52656, "user_id": 225074, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/dea26ac1ef8259140d28aa8b5ba4f1b3?s=128&d=identicon&r=PG", "display_name": "Thomas Matthews", "link": "https://stackoverflow.com/users/225074/thomas-matthews"}, "edited": false, "score": 0, "creation_date": 1504133262, "post_id": 45970788, "comment_id": 78900740, "body": "Search StackOverflow for &quot;c++ read file CSV&quot;.  There are already a plethora of similar questions."}, {"owner": {"reputation": 52656, "user_id": 225074, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/dea26ac1ef8259140d28aa8b5ba4f1b3?s=128&d=identicon&r=PG", "display_name": "Thomas Matthews", "link": "https://stackoverflow.com/users/225074/thomas-matthews"}, "edited": false, "score": 0, "creation_date": 1504133304, "post_id": 45970788, "comment_id": 78900755, "body": "You may want to search the internet for &quot;c++ read file matrix coordinates&quot;.  Always a good idea to search the internet before posting."}, {"owner": {"reputation": 701, "user_id": 3124438, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/ae8d252e1dfaa06bc5dd3ec9c902a4a2?s=128&d=identicon&r=PG&f=1", "display_name": "Spandyie", "link": "https://stackoverflow.com/users/3124438/spandyie"}, "reply_to_user": {"reputation": 52656, "user_id": 225074, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/dea26ac1ef8259140d28aa8b5ba4f1b3?s=128&d=identicon&r=PG", "display_name": "Thomas Matthews", "link": "https://stackoverflow.com/users/225074/thomas-matthews"}, "edited": false, "score": 0, "creation_date": 1504133306, "post_id": 45970788, "comment_id": 78900756, "body": "I want to load them as vector&lt;vector&lt;floats&gt;&gt;"}, {"owner": {"reputation": 17298, "user_id": 1540468, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2f7d0c7668a2f3b53cf22c01ae63f32b?s=128&d=identicon&r=PG", "display_name": "Paul Rooney", "link": "https://stackoverflow.com/users/1540468/paul-rooney"}, "edited": false, "score": 1, "creation_date": 1504133388, "post_id": 45970788, "comment_id": 78900772, "body": "@spandy, if you know the elements are always two in length it might be better to use <code>std::pair</code>, <code>std::array</code> or even your own class or struct, rather than a nested vector."}, {"owner": {"reputation": 52656, "user_id": 225074, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/dea26ac1ef8259140d28aa8b5ba4f1b3?s=128&d=identicon&r=PG", "display_name": "Thomas Matthews", "link": "https://stackoverflow.com/users/225074/thomas-matthews"}, "edited": false, "score": 2, "creation_date": 1504133399, "post_id": 45970788, "comment_id": 78900775, "body": "No, you don&#39;t want a vector&lt;vector&lt;float&gt;&gt;.  You want a <code>std::vector&lt;std::vector&lt;Point&gt; &gt;</code> or <code>std::vector&lt;std::vector&lt;std::pair&lt;float,float&gt;&gt;&gt;</code>."}, {"owner": {"reputation": 10345, "user_id": 4131059, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/uDaBr.jpg?s=128&g=1", "display_name": "Alexander Huszagh", "link": "https://stackoverflow.com/users/4131059/alexander-huszagh"}, "edited": false, "score": 1, "creation_date": 1504133541, "post_id": 45970788, "comment_id": 78900814, "body": "Use a custom struct, or a tuple, pair, or array. Do not use a vector. A vector is for dynamic content, or where the size is unknown at compile time. Use a more fixed data structure, your code will thank you later. All the suggestions above highlight how to do this."}], "answers": [{"comments": [{"owner": {"reputation": 701, "user_id": 3124438, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/ae8d252e1dfaa06bc5dd3ec9c902a4a2?s=128&d=identicon&r=PG&f=1", "display_name": "Spandyie", "link": "https://stackoverflow.com/users/3124438/spandyie"}, "edited": false, "score": 0, "creation_date": 1504204910, "post_id": 45970907, "comment_id": 78936337, "body": "how do I print the elements of <code>matrix</code> vector?"}, {"owner": {"reputation": 52656, "user_id": 225074, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/dea26ac1ef8259140d28aa8b5ba4f1b3?s=128&d=identicon&r=PG", "display_name": "Thomas Matthews", "link": "https://stackoverflow.com/users/225074/thomas-matthews"}, "reply_to_user": {"reputation": 701, "user_id": 3124438, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/ae8d252e1dfaa06bc5dd3ec9c902a4a2?s=128&d=identicon&r=PG&f=1", "display_name": "Spandyie", "link": "https://stackoverflow.com/users/3124438/spandyie"}, "edited": false, "score": 0, "creation_date": 1504207338, "post_id": 45970907, "comment_id": 78937578, "body": "You could use <code>matrix[row][column]</code>."}, {"owner": {"reputation": 701, "user_id": 3124438, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/ae8d252e1dfaa06bc5dd3ec9c902a4a2?s=128&d=identicon&r=PG&f=1", "display_name": "Spandyie", "link": "https://stackoverflow.com/users/3124438/spandyie"}, "edited": false, "score": 0, "creation_date": 1504207845, "post_id": 45970907, "comment_id": 78937824, "body": "I get following  ` error: no match for &#39;operator&lt;&lt;&#39; (operand types are &#39;std::ostream {aka std::basic_ostream&lt;char&gt;}&#39; and &#39;Point&#39;)`"}, {"owner": {"reputation": 52656, "user_id": 225074, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/dea26ac1ef8259140d28aa8b5ba4f1b3?s=128&d=identicon&r=PG", "display_name": "Thomas Matthews", "link": "https://stackoverflow.com/users/225074/thomas-matthews"}, "reply_to_user": {"reputation": 701, "user_id": 3124438, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/ae8d252e1dfaa06bc5dd3ec9c902a4a2?s=128&d=identicon&r=PG&f=1", "display_name": "Spandyie", "link": "https://stackoverflow.com/users/3124438/spandyie"}, "edited": false, "score": 0, "creation_date": 1504208171, "post_id": 45970907, "comment_id": 78937976, "body": "In the <code>Point</code> class overload <code>operator &lt;&lt;</code> to print to an <code>std::ostream</code>.  There a gazillion examples on the internet on how to overload <code>operator&lt;&lt;</code>."}, {"owner": {"reputation": 701, "user_id": 3124438, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/ae8d252e1dfaa06bc5dd3ec9c902a4a2?s=128&d=identicon&r=PG&f=1", "display_name": "Spandyie", "link": "https://stackoverflow.com/users/3124438/spandyie"}, "edited": false, "score": 0, "creation_date": 1504216349, "post_id": 45970907, "comment_id": 78941408, "body": "Thanks for you help,"}], "tags": [], "owner": {"reputation": 52656, "user_id": 225074, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/dea26ac1ef8259140d28aa8b5ba4f1b3?s=128&d=identicon&r=PG", "display_name": "Thomas Matthews", "link": "https://stackoverflow.com/users/225074/thomas-matthews"}, "is_accepted": true, "score": 4, "last_activity_date": 1504133849, "creation_date": 1504133849, "answer_id": 45970907, "question_id": 45970788, "link": "https://stackoverflow.com/questions/45970788/how-to-assign-each-row-of-a-text-file-to-a-new-vector/45970907#45970907", "title": "How to assign each row of a text file to a new vector?", "body": "<p>Here's something to get you started:  </p>\n\n<pre><code>class Point\n{\npublic:\n  double x;\n  double y;\n  friend std::istream&amp; operator&gt;&gt;(std::istream&amp; input, Point&amp; p);\n};\n\nstd::istream&amp; operator&gt;&gt;(std::istream&amp; input, Point&amp; p)\n{\n  char c;\n  input &gt;&gt; c; // Read open parenthesis\n  input &gt;&gt; p.x;\n  input &gt;&gt; c; // Read comma\n  input &gt;&gt; p.y;\n  input &gt;&gt; c; // Read closing parenthesis\n  return input;\n};\n\n//...\nstd::string row_text;\nstd::vector&lt;std::vector&lt;Point&gt;&gt; matrix;\nwhile (std::getline(my_file, row_text))\n{\n  std::vector&lt;Point&gt; row;\n  std::istringstream(row_text);\n  Point p;\n  while (row_text &gt;&gt; p)\n  {\n    row.push_back(p);\n  }\n  matrix.push_back(row);\n}\n</code></pre>\n\n<p>I've created a <code>Point</code> class to represent the pair of floating point numbers.</p>\n\n<p>I also overloaded <code>operator&gt;&gt;</code> to make reading a <code>Point</code> easier.</p>\n\n<p>The loop reads one <em>record</em> or text line, then creates a vector of <code>Point</code> from the text line.<br>\nThe record or row is then appended to the matrix.  </p>\n"}, {"tags": [], "owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "is_accepted": false, "score": 2, "last_activity_date": 1504135199, "last_edit_date": 1504135199, "creation_date": 1504134522, "answer_id": 45970992, "question_id": 45970788, "link": "https://stackoverflow.com/questions/45970788/how-to-assign-each-row-of-a-text-file-to-a-new-vector/45970992#45970992", "title": "How to assign each row of a text file to a new vector?", "body": "<p>You have half the answer already - use <code>std::getline()</code> to read each line, and then use <code>std::(i)stringstream</code> to process each line.</p>\n\n<p>Now, what you are missing is the other half - parsing each line.  And since you already know how to use <code>std::istream_iterator</code>, I would do something like this:</p>\n\n<pre><code>typedef std::pair&lt;float, float&gt; SensorValue;\ntypedef std::vector&lt;SensorValue&gt; SensorValues;\n\nstd::istream&amp; operator&gt;&gt;(std::istream &amp;in, SensorValue &amp;out)\n{\n    float f1, f2;\n    char ch1, ch2, ch3;\n\n    if (in &gt;&gt; ch1 &gt;&gt; f1 &gt;&gt; ch2 &gt;&gt; f2 &gt;&gt; ch3)\n    {\n        if ((ch1 == '(') &amp;&amp; (ch2 == ',') &amp;&amp; (ch3 == ')'))\n            out = std::make_pair(f1, f2);\n        else\n            in.setstate(std::ios_base::failbit);\n    }\n\n    return in;\n}\n\n...\n\nstd::vector&lt;SensorValues&gt; input;\n\nstd::ifstream fileFFT(Filename.c_str());\nstd::string line;\n\nwhile (std::getline(fileFFT, line))\n{\n    if (line.empty())\n        continue;\n\n    std::istringstream row(line);\n\n    SensorValues values;\n    std::copy(std::istream_iterator&lt;SensorValue&gt;(row), std::istream_iterator&lt;SensorValue&gt;(), std::back_inserter(values));\n\n    input.push_back(values);\n}\n</code></pre>\n"}], "owner": {"reputation": 701, "user_id": 3124438, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/ae8d252e1dfaa06bc5dd3ec9c902a4a2?s=128&d=identicon&r=PG&f=1", "display_name": "Spandyie", "link": "https://stackoverflow.com/users/3124438/spandyie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 2, "accepted_answer_id": 45970907, "answer_count": 2, "score": 0, "last_activity_date": 1504135199, "creation_date": 1504133052, "last_edit_date": 1504133413, "question_id": 45970788, "link": "https://stackoverflow.com/questions/45970788/how-to-assign-each-row-of-a-text-file-to-a-new-vector", "title": "How to assign each row of a text file to a new vector?", "body": "<p>I am C++ noob, I have a text file with 4 rows and 3 columns, where each row corresponds to a sensor signal. How do I load each row to a separate <code>vector&lt;float&gt;</code>?</p>\n\n<pre><code>(0.165334,0) (0.166524,-0.0136064) (-0.144899,0.0207161)\n(0.205171,0) (0.205084,-0.0139042) (-0.205263,0.0262445)\n(0.216684,0) (0.215388,-0.0131107) (-0.193696,0.0251303)\n(0.220137,0) (0.218849,-0.0135667) (-0.194153,0.025175) \n</code></pre>\n\n<p>This is what I have so far, but this code  loads data as string. I want to load my final data as <code>vector&lt;vector&lt;float&gt;&gt;</code>?</p>\n\n<pre><code>vector&lt;vector&lt;string&gt; &gt; input;    \nifstream fileFFT(Filename.c_str());\nstring line;\nwhile(getline(fileFFT, line)){\n    if(line.empty()){\n        continue;\n    }\n\n    stringstream row(line);\n    vector&lt;string&gt; values((istream_iterator&lt;string&gt;(row)),(istream_iterator&lt;string&gt;()));       //end\n\n    input.push_back(values);\n\n}\n</code></pre>\n"}, {"tags": ["c++", "visual-studio-code"], "comments": [{"owner": {"reputation": 2374, "user_id": 8491726, "user_type": "registered", "profile_image": "https://graph.facebook.com/1550562035006492/picture?type=large", "display_name": "Artemy Vysotsky", "link": "https://stackoverflow.com/users/8491726/artemy-vysotsky"}, "edited": false, "score": 0, "creation_date": 1504153475, "post_id": 45970668, "comment_id": 78905213, "body": "Error wording is similar to <a href=\"https://stackoverflow.com/questions/41854840/var-create-unable-to-create-variable-object\" title=\"var create unable to create variable object\">stackoverflow.com/questions/41854840/&hellip;</a> - try the proposed solution for gdb and see if it helps"}, {"owner": {"reputation": 11, "user_id": 8464336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c832da325778cc01291ca3715977184?s=128&d=identicon&r=PG&f=1", "display_name": "jen mueller", "link": "https://stackoverflow.com/users/8464336/jen-mueller"}, "reply_to_user": {"reputation": 2374, "user_id": 8491726, "user_type": "registered", "profile_image": "https://graph.facebook.com/1550562035006492/picture?type=large", "display_name": "Artemy Vysotsky", "link": "https://stackoverflow.com/users/8491726/artemy-vysotsky"}, "edited": false, "score": 0, "creation_date": 1504392249, "post_id": 45970668, "comment_id": 78997461, "body": "@ArtemyVysotsky I checked and tried to resolve with -D_GLIBCXX_USE_CXX11_ABI=0 but it didn&#39;t help"}], "owner": {"reputation": 11, "user_id": 8464336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c832da325778cc01291ca3715977184?s=128&d=identicon&r=PG&f=1", "display_name": "jen mueller", "link": "https://stackoverflow.com/users/8464336/jen-mueller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 217, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1535054473, "creation_date": 1504132366, "last_edit_date": 1535054473, "question_id": 45970668, "link": "https://stackoverflow.com/questions/45970668/c-file-seekg-or-file-peek-do-not-return-any-value-in-vs-code-debug-mode", "title": "C++ file.seekg() or file.peek() do not return any value in VS Code debug mode", "body": "<p>I can't have any  printed values in the watch and variables windows as I try to run the code in debug mode. I only get the message <strike><code>-var-create: unable to create variable object</code></strike> in the watch window for the seekg and peek functions. </p>\n\n<p>I have installed the C++, Intellisense C++, code runner and native debug extensions in VS Code.</p>\n\n<p>I typed file.peek() in the watch window under debug mode and I only get this message while stepping through my code: file.peek(): <code>Couldn't find method std::ifstream::peek</code>.</p>\n\n<p>I also get the error <code>Unable to step out. Operation failed with error code 0x80004004</code> while trying to step out (SHIFT+F11) in my code which is probably due to gdb according to this post: <a href=\"https://github.com/vector-of-bool/vscode-cmake-tools/issues/215\" rel=\"nofollow noreferrer\">#215</a></p>\n\n<p>OS : Ubuntu 16.04.2 LTS<br>\nVSCode : Version 1.14.2<br>\ngdb : GNU gdb (Ubuntu 7.11.1-0ubuntu1~16.04) 7.11.1</p>\n\n<p>Here is a sample code I am trying to debug in vscode.</p>\n\n<p>debugFct.cpp:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;fstream&gt;\n\nusing namespace std;\n\nint main(){\n    string fileName = \"matrix.txt\"; \n    ifstream file(fileName);\n    file.seekg(0, ios::beg);\n\n    int numberOfCharacters = 0;\n    char numb; \n    do {\n        ++numberOfCharacters;\n        if (file.peek() == '\\n')\n            break;\n    }\n    while(file.get(numb));\n    cout &lt;&lt; \"Number Of Characters:\" &lt;&lt; numberOfCharacters &lt;&lt; endl;\nreturn 0;\n}\n</code></pre>\n\n<p>Here are my .json files:</p>\n\n<pre><code>task.json\n{\n    \"version\": \"2.0.0\",\n    \"tasks\": [\n        {\n            \"taskName\": \"debugFct\",\n            \"command\": \"g++\",\n            \"type\": \"shell\",\n            \"presentation\": {\n                \"echo\": true,\n                \"reveal\": \"always\",\n                \"focus\": false,\n                \"panel\": \"shared\"\n            },\n            \"args\": [\"-std=c++11\",\"${workspaceRoot}/debugFct.cpp\"],\n            \"group\": {\n                \"kind\": \"build\",\n                \"isDefault\": true\n            }\n        }\n    ]\n}\n\nc_cpp_properties.json\n{\n    \"name\": \"Linux\",\n    \"includePath\": [\n        \"/usr/include/c++/5.4.1\",\n        \"/usr/include/linux/\",\n        \"/usr/include/x86_64-linux-gnu/c++/5.4.1\",\n        \"/usr/local/include\",\n        \"/usr/include/x86_64-linux-gnu\",\n        \"/usr/share/bash-completion/completions/g++\",\n        \"/usr/include/x86_64-linux-gnu/c++/5/bits\",\n        \"/usr/include/x86_64-linux-gnu/c++/5.4.1/bits\",\n        \"${workspaceRoot}\"\n    ],\n    \"defines\": [],\n    \"intelliSenseMode\": \"clang-x64\",\n    \"browse\": {\n    \"path\": [\n        \"~/Documents/ptrTest/\",\n        \"/usr/include/c++/5.4.1\",\n        \"/usr/include/x86_64-linux-gnu/c++/5.4.1\",\n        \"/usr/local/include\",\n        \"/usr/include\",\n        \"/usr/include/x86_64-linux-gnu\",\n        \"/usr/include/x86_64-linux-gnu/c++/5.4.1/bits\",\n        \"${workspaceRoot}\"\n    ],\n    \"limitSymbolsToIncludedHeaders\": true,\n    \"databaseFilename\": \"\"\n    }\n},\n\n\nlaunch.json\n{\n\"version\": \"0.2.0\",\n\"configurations\": [\n    {\n        \"name\": \"(gdb) Launch\",\n        \"type\": \"cppdbg\",\n        \"request\": \"launch\",\n        \"program\": \"${workspaceRoot}/debugFct\",\n        \"args\": [\"-D_GLIBCXX_DEBUG\"],\n        \"stopAtEntry\": false,\n        \"cwd\": \"${workspaceRoot}\",\n        \"environment\": [],\n        \"externalConsole\": true,\n        \"MIMode\": \"gdb\",\n        \"miDebuggerPath\": \"/usr/bin/gdb\",\n        \"setupCommands\": [\n            {\n                \"description\": \"Enable pretty-printing for gdb\",\n                \"text\": \"-enable-pretty-printing\",\n                \"ignoreFailures\": false\n            }\n        ]\n    }\n]\n}\n\nsettings.json \n{\n\"files.associations\": {\n    \"string\": \"cpp\",\n    \"iostream\": \"cpp\",\n    \"istream\": \"cpp\",\n    \"iosfwd\": \"cpp\"\n},\n\"C_Cpp.intelliSenseEngine\": \"Tag Parser\",\n\"code-runner.executorMap\":{\n    \"cpp\": \"cd $dir &amp;&amp; g++ -std=c++11 -D_GLIBCXX_USE_CXX11_ABI=0 $fileName -o $fileNameWithoutExt &amp;&amp; $dir$fileNameWithoutExt\"\n},\n\"editor.minimap.enabled\": false,\n\"vsicons.presets.tsOfficial\": true,\n\"workbench.iconTheme\": \"vscode-icons\"\n}\n</code></pre>\n"}, {"tags": ["c++", "inheritance", "vector", "overriding"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2100815"}, "edited": false, "score": 0, "creation_date": 1504131896, "post_id": 45970536, "comment_id": 78900382, "body": "How do virtual functions not work for you here?  also, why the underscore prefix? Please don&#39;t do that."}, {"owner": {"reputation": 209335, "user_id": 661519, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1735ab1c8ba4229daa855ec6aad03065?s=128&d=identicon&r=PG", "display_name": "juanchopanza", "link": "https://stackoverflow.com/users/661519/juanchopanza"}, "edited": false, "score": 0, "creation_date": 1504132358, "post_id": 45970536, "comment_id": 78900504, "body": "Aren&#39;t you already calling the parent&#39;s update &quot;method&quot;?"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2100815"}, "edited": false, "score": 0, "creation_date": 1504132238, "post_id": 45970589, "comment_id": 78900473, "body": "&quot;This is how the Standard Library does it.&quot; - where?"}, {"owner": {"reputation": 12222, "user_id": 128581, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7fad01453b6f78fd4401c935f0daedd3?s=128&d=identicon&r=PG", "display_name": "Josh", "link": "https://stackoverflow.com/users/128581/josh"}, "edited": false, "score": 1, "creation_date": 1504132385, "post_id": 45970589, "comment_id": 78900511, "body": "He&#39;s not doing it backwards at all. This is literally exactly what subclassing is for."}, {"owner": {"reputation": 209335, "user_id": 661519, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1735ab1c8ba4229daa855ec6aad03065?s=128&d=identicon&r=PG", "display_name": "juanchopanza", "link": "https://stackoverflow.com/users/661519/juanchopanza"}, "reply_to_user": {"reputation": 12222, "user_id": 128581, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7fad01453b6f78fd4401c935f0daedd3?s=128&d=identicon&r=PG", "display_name": "Josh", "link": "https://stackoverflow.com/users/128581/josh"}, "edited": false, "score": 0, "creation_date": 1504132581, "post_id": 45970589, "comment_id": 78900562, "body": "@Josh Given the lack of clarity in the question, it is as likely that this is the right approach as it is yours."}, {"owner": {"reputation": 12222, "user_id": 128581, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7fad01453b6f78fd4401c935f0daedd3?s=128&d=identicon&r=PG", "display_name": "Josh", "link": "https://stackoverflow.com/users/128581/josh"}, "edited": false, "score": 0, "creation_date": 1504132720, "post_id": 45970589, "comment_id": 78900605, "body": "He gives an explanation of the intended interface, and example code for his implementation AND how to use it with his main. How is it unclear?"}, {"owner": {"reputation": 209335, "user_id": 661519, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1735ab1c8ba4229daa855ec6aad03065?s=128&d=identicon&r=PG", "display_name": "juanchopanza", "link": "https://stackoverflow.com/users/661519/juanchopanza"}, "reply_to_user": {"reputation": 12222, "user_id": 128581, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7fad01453b6f78fd4401c935f0daedd3?s=128&d=identicon&r=PG", "display_name": "Josh", "link": "https://stackoverflow.com/users/128581/josh"}, "edited": false, "score": 0, "creation_date": 1504132799, "post_id": 45970589, "comment_id": 78900634, "body": "@Josh Like this: &quot;So the goal is to call the &quot;parents&quot; update method&quot;"}, {"owner": {"reputation": 12222, "user_id": 128581, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7fad01453b6f78fd4401c935f0daedd3?s=128&d=identicon&r=PG", "display_name": "Josh", "link": "https://stackoverflow.com/users/128581/josh"}, "edited": false, "score": 0, "creation_date": 1504132922, "post_id": 45970589, "comment_id": 78900661, "body": "If he <i>really</i> wants to call the parents update method, Component::update()."}, {"owner": {"reputation": 4313, "user_id": 2706707, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BoAxS.gif?s=128&g=1", "display_name": "D&#250;thomhas", "link": "https://stackoverflow.com/users/2706707/d%c3%bathomhas"}, "reply_to_user": {"reputation": 12222, "user_id": 128581, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7fad01453b6f78fd4401c935f0daedd3?s=128&d=identicon&r=PG", "display_name": "Josh", "link": "https://stackoverflow.com/users/128581/josh"}, "edited": false, "score": 0, "creation_date": 1504134094, "post_id": 45970589, "comment_id": 78900963, "body": "@Josh If you had bothered to look at the picture OP provided, you&#39;ll see what he really wants, which is a very common dispatch pattern."}, {"owner": {"reputation": 4313, "user_id": 2706707, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BoAxS.gif?s=128&g=1", "display_name": "D&#250;thomhas", "link": "https://stackoverflow.com/users/2706707/d%c3%bathomhas"}, "edited": false, "score": 0, "creation_date": 1504134127, "post_id": 45970589, "comment_id": 78900974, "body": "@NeilButterworth Look at any stream class in the Standard Library."}, {"owner": {"reputation": 21, "user_id": 8508577, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b50492fe341cf2c6ece76ce539fe285?s=128&d=identicon&r=PG&f=1", "display_name": "Reece Ward", "link": "https://stackoverflow.com/users/8508577/reece-ward"}, "edited": false, "score": 0, "creation_date": 1504134541, "post_id": 45970589, "comment_id": 78901106, "body": "I have managed to sort the call now, thanks for the input. Could anyone provide anything for the bottom bit however, it&#39;s the same problem just in a different context"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2100815"}, "edited": false, "score": 0, "creation_date": 1504134947, "post_id": 45970589, "comment_id": 78901209, "body": "@D&#250;thomhas  Those are big classes - where exact;ly should I look?"}, {"owner": {"reputation": 12222, "user_id": 128581, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7fad01453b6f78fd4401c935f0daedd3?s=128&d=identicon&r=PG", "display_name": "Josh", "link": "https://stackoverflow.com/users/128581/josh"}, "edited": false, "score": 0, "creation_date": 1504135942, "post_id": 45970589, "comment_id": 78901414, "body": "@D&#250;thomhas you mean the big picture where he has a blue line to the child update and a big red arrow to the parent update. Meaning literally classic polymorphism with virtual function? He added this bit with the Transofrm after the fact, which again something you can handle with classic polymorphism with a dynamic_cast and a nullptr check."}, {"owner": {"reputation": 4313, "user_id": 2706707, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BoAxS.gif?s=128&g=1", "display_name": "D&#250;thomhas", "link": "https://stackoverflow.com/users/2706707/d%c3%bathomhas"}, "reply_to_user": {"reputation": 12222, "user_id": 128581, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7fad01453b6f78fd4401c935f0daedd3?s=128&d=identicon&r=PG", "display_name": "Josh", "link": "https://stackoverflow.com/users/128581/josh"}, "edited": false, "score": 0, "creation_date": 1504137796, "post_id": 45970589, "comment_id": 78901758, "body": "@Josh It appears he keeps changing his image."}], "tags": [], "owner": {"reputation": 4313, "user_id": 2706707, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BoAxS.gif?s=128&g=1", "display_name": "D&#250;thomhas", "link": "https://stackoverflow.com/users/2706707/d%c3%bathomhas"}, "is_accepted": false, "score": 2, "last_activity_date": 1504131936, "creation_date": 1504131936, "answer_id": 45970589, "question_id": 45970536, "link": "https://stackoverflow.com/questions/45970536/c-finding-parent-and-calling-its-method/45970589#45970589", "title": "C++, finding parent and calling it&#39;s method?", "body": "<p>You're doing it backwards. Instead, create a virtual method called <code>do_update</code> that your derived classes override. The parent class's <code>update</code> method should call the virtual <code>do_update</code> method, which will dispatch properly.</p>\n\n<p>This is how the Standard Library does it...</p>\n"}, {"comments": [{"owner": {"reputation": 21, "user_id": 8508577, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b50492fe341cf2c6ece76ce539fe285?s=128&d=identicon&r=PG&f=1", "display_name": "Reece Ward", "link": "https://stackoverflow.com/users/8508577/reece-ward"}, "edited": false, "score": 0, "creation_date": 1504134028, "post_id": 45970653, "comment_id": 78900948, "body": "I have this now, it&#39;s working fine. But how do I get the type of that class like what it was created as. I have extended my post"}, {"owner": {"reputation": 12222, "user_id": 128581, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7fad01453b6f78fd4401c935f0daedd3?s=128&d=identicon&r=PG", "display_name": "Josh", "link": "https://stackoverflow.com/users/128581/josh"}, "reply_to_user": {"reputation": 21, "user_id": 8508577, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b50492fe341cf2c6ece76ce539fe285?s=128&d=identicon&r=PG&f=1", "display_name": "Reece Ward", "link": "https://stackoverflow.com/users/8508577/reece-ward"}, "edited": false, "score": 0, "creation_date": 1504136093, "post_id": 45970653, "comment_id": 78901452, "body": "Hi @ReeceWard, generally you should ask one question at a time. If you have another question, you should mark a correct answer and open another question."}], "tags": [], "owner": {"reputation": 12222, "user_id": 128581, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7fad01453b6f78fd4401c935f0daedd3?s=128&d=identicon&r=PG", "display_name": "Josh", "link": "https://stackoverflow.com/users/128581/josh"}, "is_accepted": false, "score": 2, "last_activity_date": 1504136043, "last_edit_date": 1504136043, "creation_date": 1504132288, "answer_id": 45970653, "question_id": 45970536, "link": "https://stackoverflow.com/questions/45970536/c-finding-parent-and-calling-its-method/45970653#45970653", "title": "C++, finding parent and calling it&#39;s method?", "body": "<p>Use a virtual method.</p>\n\n<p>Parent:</p>\n\n<pre><code>virtual void Update();\n</code></pre>\n\n<p>If you want the Component class to be \"pure virtual,\" meaning you have to subclass it and it just represents an abstraction/interface, you can do:</p>\n\n<pre><code>virtual void Update() = 0;\n</code></pre>\n\n<p>This will give you an error if you try to instantiate a Component object, you create subclass objects only which implement all the pure virtual methods.</p>\n\n<p>Edit:</p>\n\n<p>The below code checks if x is a Transform. However, doing this means that you probably have a design flaw. Why not make a semantically aware container that stops a user from adding two transforms instead?</p>\n\n<pre><code>dynamic_cast&lt;Transform*&gt;(x) == nullptr\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 8508577, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b50492fe341cf2c6ece76ce539fe285?s=128&d=identicon&r=PG&f=1", "display_name": "Reece Ward", "link": "https://stackoverflow.com/users/8508577/reece-ward"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1504156196, "creation_date": 1504131615, "last_edit_date": 1504156196, "question_id": 45970536, "link": "https://stackoverflow.com/questions/45970536/c-finding-parent-and-calling-its-method", "title": "C++, finding parent and calling it&#39;s method?", "body": "<p>I'd like to say that I have looked for a solution to this issue here but just could not find exactly what I was looking for. There may be a simple solution to my issue.</p>\n\n<p>So take this example:</p>\n\n<pre><code>class Component\n{\npublic:\n    virtual ~Component() {} // Make Polymorphic;\n\n    void Update() {};\n};\nclass UserMadeComponent : public Component\n{\npublic:\n\n    void Update() {};\n};\n\nint main()\n{\n    std::vector&lt;Component*&gt; _components;\n\n    UserMadeComponent* UsersComponent = new UserMadeComponent;\n\n    _components.push_back(UsersComponent);\n\n    while (true)\n    {\n        for (auto _comp = _components.begin(); _comp != _components.end(); _comp++)\n        {\n            (*_comp)-&gt;Update();\n        }\n    }\n}\n</code></pre>\n\n<p>Now the programmer, using this framework, can create any type of component they want. And they will add this to the component vector. I want to be able to get the type of component and call its Update method. Here is a little diagram of what I am trying to accomplish:</p>\n\n<p><img src=\"https://i.stack.imgur.com/rgUt3.png\" alt=\"Link to image\"></p>\n\n<p>So the goal is to call the \"parents\" update method. However, the user can create any type of component they'd like. I can't assume the type of any component inside this array. I hope this makes sense</p>\n\n<p>//EDIT//</p>\n\n<p>Thanks for people helping me to understand the virtual method calling. But how would I know what that class actually is. For example, the user has created a component called \"Transform\". I only want to allow one Transform instance in the component array. But obviously if I only know its a component pointer, I can't check for this occurrence.</p>\n\n<p>It's hard to explain so here is another image:</p>\n\n<p><a href=\"https://i.stack.imgur.com/g2F9v.png\" rel=\"nofollow noreferrer\">Link to image</a></p>\n"}, {"tags": ["c++", "templates", "initialization", "static-members"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6846474"}, "reply_to_user": {"reputation": 133051, "user_id": 501250, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c39ae7fe43cf30bc0f4d4051defcbd87?s=128&d=identicon&r=PG", "display_name": "cdhowie", "link": "https://stackoverflow.com/users/501250/cdhowie"}, "edited": false, "score": 0, "creation_date": 1504130244, "post_id": 45970190, "comment_id": 78899851, "body": "Oops, formating issue. Just a missing curly brace. I fixed it, so it should work now. It compiles at least in Visual Studio 2017."}, {"owner": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 0, "creation_date": 1504130361, "post_id": 45970190, "comment_id": 78899887, "body": "It looks like your real question is how to collect information on which template variants are being instantiated in your program. I don&#39;t know the exact solution, but it probably has to do with parsing object code and / or using some dedicated tools to introspect AST (maybe something clang-based?)."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6846474"}, "reply_to_user": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 0, "creation_date": 1504130686, "post_id": 45970190, "comment_id": 78900008, "body": "@VTT Well, I thought about various approaches including an external program (or a clang plugin) that would perform additional static analysis on the existing code, but I&#39;d rather incorporate the type extraction into the program itself. Here I&#39;m really curious about this piece of code. Any suggestions on how to do it differently are also welcome though."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6846474"}, "edited": false, "score": 0, "creation_date": 1504132004, "post_id": 45970466, "comment_id": 78900416, "body": "Well, it&#39;s much simpler than my take. Interesting... I thought I tried something like that before and got the impression it does not work. Obviously I must have missed something because your code is pretty much equivalent and without hacks. Thank you."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6846474"}, "edited": false, "score": 0, "creation_date": 1504132682, "post_id": 45970466, "comment_id": 78900593, "body": "Yes, I remember now. I had a dummy function foo in Initializer and called it inside Foo&#39;s constructor. In this simple example it does the same job as the pointer, although I am sure it didn&#39;t work in the real project I was working on. It didn&#39;t generate Initializer definition and I was getting linker errors. Could it be somehow caused by multiple translation units or something? I&#39;m running out of ideas..."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6846474"}, "edited": false, "score": 0, "creation_date": 1504164994, "post_id": 45970466, "comment_id": 78910151, "body": "Nevermind, I solved it. Your approach indeed works. I had a partial specialization of Foo on top of all that and I forgot to define Foo&lt;T&gt;::gint_incrementer for it. It has to be redefined like the whole class body itself."}, {"owner": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 0, "creation_date": 1504173917, "post_id": 45970466, "comment_id": 78916217, "body": "This makes counter work but how does this help to figure out which template variants were instantiated?"}, {"owner": {"reputation": 30558, "user_id": 1013719, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/U8X0A.jpg?s=128&g=1", "display_name": "Ryan Haining", "link": "https://stackoverflow.com/users/1013719/ryan-haining"}, "reply_to_user": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 0, "creation_date": 1504180952, "post_id": 45970466, "comment_id": 78921071, "body": "@VTT it doesn&#39;t, and although that&#39;s in the title there isn&#39;t anything in the code or question to make me think that&#39;s what OP actually wants, but if so then this isn&#39;t it"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6846474"}, "edited": false, "score": 0, "creation_date": 1504182007, "post_id": 45970466, "comment_id": 78921789, "body": "It does help considerably. In my original code, Initializer is also templated and that&#39;s really all you need. Any code inside Initializer class will be generated and its constructor ran (!) for every T which is used when declaring various Foo&#39;s. The point was to create Initializer&lt;T&gt; instance for each declaration of Foo&lt;T&gt;.  I already edited the original question and I mention boost typeindex which can be used to turn template parameter names into strings.   We can then put those strings in a shared data structure (synchronized across threads of course) and we&#39;re done."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6846474"}, "edited": false, "score": 0, "creation_date": 1504182816, "post_id": 45970466, "comment_id": 78922355, "body": "Sorry, It looks like I created a lot of confusion. When I have the time, I&#39;ll probably answer my own question with more code. I thought the idea was simple enough but I could have probably formulated it better. Thanks for your help anyway!"}], "tags": [], "owner": {"reputation": 30558, "user_id": 1013719, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/U8X0A.jpg?s=128&g=1", "display_name": "Ryan Haining", "link": "https://stackoverflow.com/users/1013719/ryan-haining"}, "is_accepted": false, "score": 3, "last_activity_date": 1504131194, "creation_date": 1504131194, "answer_id": 45970466, "question_id": 45970190, "link": "https://stackoverflow.com/questions/45970190/collecting-information-on-which-template-variants-are-being-instantiated-in-a-pr/45970466#45970466", "title": "Collecting information on which template variants are being instantiated in a program", "body": "<p>If you're willing to add the cost of an extra variable to your objects, this seems to do what you want, though this is all very complicated and I could be missing a case:</p>\n\n<pre><code>#include &lt;iostream&gt;\n\nstatic int&amp; gInt() { // Global counter\n    static int i;\n    return i;\n}\n\nstruct Initializer {\n    Initializer() { ++gInt(); }\n};\n\n\ntemplate &lt;class T&gt;\nstruct Foo {\n    Foo() { // This never gets called and we want that\n        std::cout &lt;&lt; \"Constructed Foo!\" &lt;&lt; std::endl; \n    }\n  private:\n    static Initializer gint_incrementer;\n    void* p_ = &amp;gint_incrementer; // force existence \n};\n\ntemplate &lt;typename T&gt;\nInitializer Foo&lt;T&gt;::gint_incrementer;\n\nvoid unused() {\n    Foo&lt;char&gt; c;\n    Foo&lt;char&gt; c2;\n    Foo&lt;double&gt; d;\n    Foo&lt;int&gt; i;\n    Foo&lt;float&gt; f;\n}\n\nint main() {\n    std::cout &lt;&lt; gInt() &lt;&lt; std::endl; // prints 4\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 64049, "user_id": 2015579, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/28571d6df35321850e78b1ebfd48e5b4?s=128&d=identicon&r=PG", "display_name": "Richard Hodges", "link": "https://stackoverflow.com/users/2015579/richard-hodges"}, "is_accepted": false, "score": 1, "last_activity_date": 1504132570, "creation_date": 1504132570, "answer_id": 45970707, "question_id": 45970190, "link": "https://stackoverflow.com/questions/45970190/collecting-information-on-which-template-variants-are-being-instantiated-in-a-pr/45970707#45970707", "title": "Collecting information on which template variants are being instantiated in a program", "body": "<p>It can be achieved with no hacks and no need for an <code>unused()</code> function if we use a variation of the <em>schwartz counter</em> idiom:</p>\n\n<h3>global_counter.hpp</h3>\n\n<pre><code>#pragma once\n\nstruct GlobalCounter {\n    int next();\n    int value() const;\n    int value_ = 0;\n    struct init {\n        init();\n        ~init();\n    };\n};\n\nextern GlobalCounter&amp; globalCounter;\nstatic GlobalCounter::init globalCounterInit;\n</code></pre>\n\n<h3>global_counter.cpp</h3>\n\n<pre><code>#include \"global_counter.hpp\"\n\n#include &lt;memory&gt;\n#include &lt;type_traits&gt;\n\nstatic int globalCounterCount;\nstatic std::aligned_storage_t &lt;sizeof(GlobalCounter), alignof(GlobalCounter)&gt; globalCounterStorage;\nGlobalCounter&amp; globalCounter = reinterpret_cast&lt;GlobalCounter&amp;&gt;(globalCounterStorage);\n\nGlobalCounter::init::init() {\n    if(globalCounterCount++ == 0) new (&amp;globalCounter) GlobalCounter ();\n}\n\nGlobalCounter::init::~init() {\n    if (--globalCounterCount == 0) globalCounter.~GlobalCounter();\n}\n\nint GlobalCounter::next() {\n    return value_++;\n}\n\nint GlobalCounter::value() const {\n    return value_;\n}\n</code></pre>\n\n<h3>foo.hpp</h3>\n\n<pre><code>#pragma once\n\n#include \"global_counter.hpp\"\n#include &lt;iostream&gt;\n\ntemplate &lt;class T&gt;\nstruct Foo {\n    Foo() { // This never gets called and we want that\n        std::cout &lt;&lt; \"Constructed Foo!\" &lt;&lt; std::endl;\n    }\n\n    static int ident;\n};\n\ntemplate&lt;class T&gt;\nint Foo&lt;T&gt;::ident;\n\ntemplate&lt;class T&gt;\nstruct EnableFoo\n{\n    EnableFoo()\n    {\n        if (counter++ == 0)\n            Foo&lt;T&gt;::ident = globalCounter.next();\n    }\n\n    static int counter;\n};\ntemplate&lt;class T&gt; int EnableFoo&lt;T&gt;::counter;\n\n\n\nstatic EnableFoo&lt;char&gt; enableFooChar;\nstatic EnableFoo&lt;int&gt; enableFooInt;\nstatic EnableFoo&lt;double&gt; enableFooDouble;\nstatic EnableFoo&lt;float&gt; enableFooFloat;\n</code></pre>\n\n<h3>main.cpp</h3>\n\n<pre><code>#include &lt;iostream&gt;\n#include \"foo.hpp\"\n\nint main() {\n\n    std::cout &lt;&lt; globalCounter.value() &lt;&lt; std::endl; // prints 4\n    return 0;\n}\n</code></pre>\n\n<p>See schwartz counter:</p>\n\n<p><a href=\"https://en.wikibooks.org/wiki/More_C%2B%2B_Idioms/Nifty_Counter\" rel=\"nofollow noreferrer\">https://en.wikibooks.org/wiki/More_C%2B%2B_Idioms/Nifty_Counter</a></p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6846474"}, "is_accepted": true, "score": 0, "last_activity_date": 1504187991, "last_edit_date": 1504187991, "creation_date": 1504186256, "answer_id": 45982717, "question_id": 45970190, "link": "https://stackoverflow.com/questions/45970190/collecting-information-on-which-template-variants-are-being-instantiated-in-a-pr/45982717#45982717", "title": "Collecting information on which template variants are being instantiated in a program", "body": "<p>OK, because the solution in my question was only partial, I'll share a working code snippet that actually shows what I was after, now that I figured it out.</p>\n\n<p>We don't need any compiler-specific hacks, the following should work universally:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;vector&gt;\n#include &lt;string&gt;\n#include &lt;mutex&gt;\n#include &lt;boost/type_index.hpp&gt;\n\nstatic std::vector&lt;std::string&gt;&amp; getInstantiations() {\n    static std::vector&lt;std::string&gt; instantiations;\n    return instantiations;\n}\n\nstatic std::mutex&amp; getMutex() {\n    static std::mutex mut;\n    return mut;\n}\n\ntemplate &lt;class T&gt;\nstruct Introspection {\n    Introspection() { \n        std::lock_guard&lt;std::mutex&gt; lock(getMutex());\n        getInstantiations().push_back(boost::typeindex::type_id&lt;T&gt;().pretty_name());\n    }\n    void forceExistence() {}\n};\n\n\ntemplate &lt;class... Ts&gt;\nstruct Foo {\n    Foo() { // This never gets called and we want that\n        std::cout &lt;&lt; \"Constructed Foo!\" &lt;&lt; std::endl;\n        introspection.forceExistence();\n    }\nprivate:\n    static Introspection&lt;Foo&lt;Ts...&gt;&gt; introspection;\n};\n\ntemplate &lt;class... Ts&gt;\nIntrospection&lt;Foo&lt;Ts...&gt;&gt; Foo&lt;Ts...&gt;::introspection;\n\nvoid unused() {\n    Foo&lt;char&gt; c;\n    Foo&lt;char&gt; c2;\n    Foo&lt;double&gt; d;\n    Foo&lt;int, const int&gt; i;\n    Foo&lt;float, bool, long&gt; f;\n}\n\nint main() {\n    for (auto&amp; i : getInstantiations()) {\n        std::cout &lt;&lt; i &lt;&lt; std::endl;\n    }\n\n    /*\n        output:\n\n        Foo&lt;char&gt;\n        Foo&lt;double&gt;\n        Foo&lt;int, int const&gt;\n        Foo&lt;float, bool, long&gt;\n    */\n}\n</code></pre>\n\n<p>It looks silly but consider a larger project with <code>Foo&lt;...&gt;</code> declarations all over the place. Yes, maybe I could just use a regex search but this way I can actually work with the gathered information while the inspected program is running. Echoing the type names is just the simplest example of what we could do with this.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6846474"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 45982717, "answer_count": 3, "score": 3, "last_activity_date": 1504187991, "creation_date": 1504129623, "last_edit_date": 1504182228, "question_id": 45970190, "link": "https://stackoverflow.com/questions/45970190/collecting-information-on-which-template-variants-are-being-instantiated-in-a-pr", "title": "Collecting information on which template variants are being instantiated in a program", "body": "<p>Today I learned that when we have a C++ class template with a static member variable, its constructor won't be called (in fact the member won't even be defined) unless we \"use it in a way that requires the definition of the static data member to exist\".</p>\n\n<p>This phenomenon is very nicely explained here:\n<a href=\"https://stackoverflow.com/questions/1819131/c-static-member-initalization-template-fun-inside/1825872#1825872\">C++ Static member initalization (template fun inside)</a></p>\n\n<p>In practice, it means we have to explicitly refer to each instantiation of that static member (from outside the class template) if we want initialization (and any possible side effects of it) to take place.</p>\n\n<p>I've been thinking about ways to overcome this issue.</p>\n\n<p>My motivation is that there's an existing code base which uses various instantiations of class template <code>Foo</code> (it has multiple template parameters but I simplified that for the sake of the example) and I would like to automatically collect information about all the different parameter combinations.</p>\n\n<p>I cannot practically wait for all these <code>Foo</code>s to be constructed during program execution (it's a long running background process) so I thought that I could put a static <code>Initializer&lt;T&gt;</code> inside <code>Foo&lt;T&gt;</code> and have it extract the desired type information for each distinct <code>Foo</code> type right after the program starts.</p>\n\n<p>In this case, having to enumerate all the instantiations of <code>Initializer&lt;T&gt; Foot&lt;T&gt;::init</code> in order to have the initializers run in the first place obviously defeats the purpose. I would have to go and see (all over the project) what the types are and that is precisely what I'm trying to automate.</p>\n\n<p>I noticed that if I replace static member variable with static method holding a local static <code>Initializer</code> instance, I can force generation of <code>Initializer&lt;T&gt;</code> definitions more easily. I just have to take a pointer to that method (e.g. inside <code>Foo</code>'s constructor).</p>\n\n<p>The last step is to call this static method after the program starts. In case of g++/clang, using <code>__attribute__((constructor))</code> works like a charm.</p>\n\n<p>I also have to deal with MSVC++ though and this is what I came up with:</p>\n\n<pre><code>#include &lt;iostream&gt;\n\n#if defined(_MSC_VER) &amp;&amp; !defined(__clang__)\n#define MSVC_CONSTRUCTOR_HACK\n#define ATTRIBUTE_CONSTRUCTOR\n#else\n#define ATTRIBUTE_CONSTRUCTOR __attribute__((constructor))\n#endif\n\nstatic int&amp; gInt() { // Global counter\n    static int i;\n    return i;\n}\n\ntemplate &lt;class T&gt;\nstruct Initializer {\n    // If it works, this gets called for each Foo&lt;T&gt; declaration\n    Initializer() {\n        gInt()++;\n    }\n};\n\n\n#ifdef MSVC_CONSTRUCTOR_HACK\n__pragma(section(\".CRT$XCU\", read))\ntemplate &lt;class T&gt;  // This will hold pointers to Foo&lt;T&gt;::getInit\nstatic void(*g_constructors__)(void);\n#endif\n\ntemplate &lt;class T&gt;\nstruct Foo {\n    ATTRIBUTE_CONSTRUCTOR // Empty in case of MSVC\n    static void getInit() {\n        static Initializer&lt;T&gt; init;\n    }\n\n#ifdef MSVC_CONSTRUCTOR_HACK\n    template &lt;&gt; // Why is this allowed?!\n    __declspec(allocate(\".CRT$XCU\")) static void(*g_constructors__&lt;T&gt;)(void) = getInit;\n#endif\n\n    Foo() { // This never gets called and we want that\n        std::cout &lt;&lt; \"Constructed Foo!\" &lt;&lt; std::endl; \n        (void)&amp;getInit; // This triggers instantiation and definition of Initializer&lt;T&gt;\n    }\n};\n\n\nvoid unused() {\n    Foo&lt;char&gt; c;\n    Foo&lt;double&gt; d;\n    Foo&lt;int&gt; i;\n    Foo&lt;float&gt; f;\n}\n\nint main() {\n    std::cout &lt;&lt; gInt() &lt;&lt; std::endl; // prints 4\n    return 0;\n}\n</code></pre>\n\n<p>It relies on putting function pointers into the .CRT section of the executable (<a href=\"https://stackoverflow.com/a/2390626/6846474\">https://stackoverflow.com/a/2390626/6846474</a>, <a href=\"https://github.com/djdeath/glib/blob/master/glib/gconstructor.h\" rel=\"nofollow noreferrer\">https://github.com/djdeath/glib/blob/master/glib/gconstructor.h</a>).</p>\n\n<p>In order to make it work in this context, though, I also had to resort to this really strange hack: There's a global variable template <code>g_constructors__</code> which is explicitly specialized inside (!) <code>Foo</code>.</p>\n\n<p>To be honest, I was really surprised this works. I know it is non-standard but can someone explain how is it that it even compiles? Is it just luck or is it somehow \"well-formed\" at least as far as Microsoft C++ goes?</p>\n\n<p>I am aware I could do this using some kind of external static analysis tool instead, but this is pretty close to what I want with the major advantage that it's all incorporated into the program being inspected.</p>\n\n<p>If I can invoke Initializer for each T (and it looks like I can), extracting the type info is easy. I can stringify the template parameters using boost typeindex or anything else I need. The global counter was used here only to see if <code>Initializer</code> instances are being created or not.</p>\n"}, {"tags": ["c++", "c++11", "templates", "template-meta-programming", "static-members"], "answers": [{"tags": [], "owner": {"reputation": 59936, "user_id": 6022656, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bf138f6c424001ac8491ca86b1976c0c?s=128&d=identicon&r=PG&f=1", "display_name": "max66", "link": "https://stackoverflow.com/users/6022656/max66"}, "is_accepted": false, "score": 1, "last_activity_date": 1504129844, "creation_date": 1504129844, "answer_id": 45970231, "question_id": 45970113, "link": "https://stackoverflow.com/questions/45970113/template-metaprogramming-static-member-function-cannot-get-const-static-value-of/45970231#45970231", "title": "template metaprogramming static member function cannot get const static value of class", "body": "<p>Try (in your first example) adding</p>\n\n<pre><code>template &lt;uint64_t n&gt;\nconstexpr uint64_t factorial&lt;n&gt;::value;\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 65, "user_id": 7840776, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TdgI8.jpg?s=128&g=1", "display_name": "xris", "link": "https://stackoverflow.com/users/7840776/xris"}, "edited": false, "score": 1, "creation_date": 1504131001, "post_id": 45970244, "comment_id": 78900104, "body": "Yes it works. And the problematic code also compiles with <code>-std=c++17</code>."}, {"owner": {"reputation": 65, "user_id": 7840776, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TdgI8.jpg?s=128&g=1", "display_name": "xris", "link": "https://stackoverflow.com/users/7840776/xris"}, "edited": false, "score": 0, "creation_date": 1504131256, "post_id": 45970244, "comment_id": 78900175, "body": "one more question: why <code>enum</code> works, it seems enum was never defined neither."}, {"owner": {"reputation": 64049, "user_id": 2015579, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/28571d6df35321850e78b1ebfd48e5b4?s=128&d=identicon&r=PG", "display_name": "Richard Hodges", "link": "https://stackoverflow.com/users/2015579/richard-hodges"}, "reply_to_user": {"reputation": 65, "user_id": 7840776, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TdgI8.jpg?s=128&g=1", "display_name": "xris", "link": "https://stackoverflow.com/users/7840776/xris"}, "edited": false, "score": 0, "creation_date": 1504132873, "post_id": 45970244, "comment_id": 78900645, "body": "@xris because the enum is not a <code>static const</code> value - it&#39;s an r-value expression. So an instance is manufactured at the point of use."}], "tags": [], "owner": {"reputation": 64049, "user_id": 2015579, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/28571d6df35321850e78b1ebfd48e5b4?s=128&d=identicon&r=PG", "display_name": "Richard Hodges", "link": "https://stackoverflow.com/users/2015579/richard-hodges"}, "is_accepted": true, "score": 4, "last_activity_date": 1518126330, "last_edit_date": 1518126330, "creation_date": 1504129887, "answer_id": 45970244, "question_id": 45970113, "link": "https://stackoverflow.com/questions/45970113/template-metaprogramming-static-member-function-cannot-get-const-static-value-of/45970244#45970244", "title": "template metaprogramming static member function cannot get const static value of class", "body": "<p>As far as I can tell it's because <code>std::vector&lt;T&gt;::push_back()</code> has the signature<br><code>void push_back(V const&amp;)</code>.</p>\n\n<p>Therefore a reference is being taken of value.</p>\n\n<p>Therefore it must have an address, which it does not because it is never defined (although this seems a little illogical to me) - perhaps this gets fixed in c++17?</p>\n\n<p>It can be made to compile by taking a copy and pushing that:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;vector&gt;\n\ntemplate &lt;uint64_t n&gt; struct factorial {\n    constexpr static uint64_t value = factorial&lt;n - 1&gt;::value * n;\n    static void put(std::vector&lt;uint64_t&gt; &amp;v) {\n        factorial&lt;n - 1&gt;::put(v);\n        auto vcpy = value;   // *** HERE ***\n        v.push_back(vcpy);\n    }\n};\n\ntemplate &lt;&gt; struct factorial&lt;0&gt; {\n    constexpr static uint64_t value = 1;\n    static void put(std::vector&lt;uint64_t&gt; &amp;v) {\n        v.push_back(1);\n    }\n};\n\nint main() {\n    using namespace std;\n    vector&lt;uint64_t&gt; v;\n    factorial&lt;10&gt;::put(v);\n    for (auto fact: v)\n        cout &lt;&lt; fact &lt;&lt; endl;\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 7840776, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TdgI8.jpg?s=128&g=1", "display_name": "xris", "link": "https://stackoverflow.com/users/7840776/xris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 200, "favorite_count": 0, "accepted_answer_id": 45970244, "answer_count": 2, "score": 2, "last_activity_date": 1518126330, "creation_date": 1504129285, "last_edit_date": 1504130171, "question_id": 45970113, "link": "https://stackoverflow.com/questions/45970113/template-metaprogramming-static-member-function-cannot-get-const-static-value-of", "title": "template metaprogramming static member function cannot get const static value of class", "body": "<p>I am trying to generate numbers in compile time and tried templates. But when I use <code>constexpr static</code> member variable instead of <code>enum</code>, and in a <code>static</code> member function where I try to push it into a <code>std::vector</code>, the compiler told me the linker was unable to link.</p>\n\n<p>For example, here is a simple program to calculate factorial of <code>n</code>.</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;vector&gt;\n\ntemplate &lt;uint64_t n&gt; struct factorial {\n    constexpr static uint64_t value = factorial&lt;n - 1&gt;::value * n;\n    static void put(std::vector&lt;uint64_t&gt; &amp;v) {\n        factorial&lt;n - 1&gt;::put(v);\n        v.push_back(value);\n    }\n};\n\ntemplate &lt;&gt; struct factorial&lt;0&gt; {\n    constexpr static uint64_t value = 1;\n    static void put(std::vector&lt;uint64_t&gt; &amp;v) {\n        v.push_back(1);\n    }\n};\n\nint main() {\n    using namespace std;\n    vector&lt;uint64_t&gt; v;\n    factorial&lt;10&gt;::put(v);\n    for (auto fact: v)\n        cout &lt;&lt; fact &lt;&lt; endl;\n    return 0;\n}\n</code></pre>\n\n<p>This will produce link fail information with both g++ 7.1 and clang 4.0, so I thought it was not a bug. And when I change <code>constexpr static</code> to <code>enum</code> like</p>\n\n<pre><code>template &lt;uint64_t n&gt; struct factorial {\n    enum { value = factorial&lt;n - 1&gt;::value * n };\n    static void put(std::vector&lt;uint64_t&gt; &amp;v) {\n        factorial&lt;n - 1&gt;::put(v);\n        v.push_back(value);\n    }\n};\n\ntemplate &lt;&gt; struct factorial&lt;0&gt; {\n    enum { value = 1 };\n    static void put(std::vector&lt;uint64_t&gt; &amp;v) {\n        v.push_back(1);\n    }\n};\n</code></pre>\n\n<p>It compiles and links and runs pretty well.</p>\n\n<p>I am wondering whether C++ standards mentioned about this.</p>\n"}, {"tags": ["c++", "vector", "operator-overloading"], "comments": [{"owner": {"reputation": 503, "user_id": 7458932, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/226f3917c60bd248fcd77f4448b19068?s=128&d=identicon&r=PG&f=1", "display_name": "devalone", "link": "https://stackoverflow.com/users/7458932/devalone"}, "edited": false, "score": 0, "creation_date": 1504128536, "post_id": 45969859, "comment_id": 78899228, "body": "at first you shoudn&#39;t use <code>template&lt;typename T&gt; </code> keyword in <code>operator=</code>"}], "answers": [{"comments": [{"owner": {"reputation": 516, "user_id": 2118290, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/bFB3H.gif?s=128&g=1", "display_name": "Steven Venham", "link": "https://stackoverflow.com/users/2118290/steven-venham"}, "edited": false, "score": 0, "creation_date": 1504141889, "post_id": 45969990, "comment_id": 78902505, "body": "Wonder why visual studios issent giving me these errors."}], "tags": [], "owner": {"reputation": 18687, "user_id": 3552770, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/b0404d5b5bd565aa720c6b3d190716b3?s=128&d=identicon&r=PG", "display_name": "LogicStuff", "link": "https://stackoverflow.com/users/3552770/logicstuff"}, "is_accepted": true, "score": 0, "last_activity_date": 1504128944, "last_edit_date": 1504128944, "creation_date": 1504128631, "answer_id": 45969990, "question_id": 45969859, "link": "https://stackoverflow.com/questions/45969859/c-subscript-operator-to-underling-class-vector/45969990#45969990", "title": "c++ subscript operator to underling class vector", "body": "<p>GCC told me exactly what's wrong:</p>\n\n<pre><code>error: declaration of template parameter \u2018T\u2019 shadows template parameter\n</code></pre>\n\n<p>(for your assignment operator)</p>\n\n<p>Then:</p>\n\n<pre><code>warning: pointer to a function used in arithmetic [-Wpointer-arith]\n         v2[i] = v1[i] + this-&gt;contents[i];\n</code></pre>\n\n<p>(you've declared <code>v2</code> as a function returning <code>vecn&lt;T&gt;</code>, remove the parentheses)</p>\n\n<p>Lastly, fix your <code>operator+</code>, because it will try to access elements of an empty <code>v2</code> vector and access out of range of the smaller of <code>v1</code> and <code>this-&gt;contents</code> if their sizes are not equal.</p>\n\n<hr>\n\n<p>It seems to me that you have wrote a lot of unnecessary code for such a simple thing. You don't need <code>addtovector</code>, just expand the parameter pack like:</p>\n\n<pre><code>contents{std::forward&lt;Args&gt;(args)...}\n</code></pre>\n\n<p>in the member initializer list. You don't need to define <code>operator=</code> at all, leave it up to the compiler. And try to <a href=\"https://stackoverflow.com/questions/4421706/what-are-the-basic-rules-and-idioms-for-operator-overloading/4421719#4421719\">implement <code>operator+</code> in terms of <code>operator+=</code></a>.</p>\n"}, {"tags": [], "owner": {"reputation": 1160, "user_id": 8490870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c084fe165955c1d26cbc964c9291f566?s=128&d=identicon&r=PG", "display_name": "DrSvanHay", "link": "https://stackoverflow.com/users/8490870/drsvanhay"}, "is_accepted": false, "score": 0, "last_activity_date": 1504130680, "creation_date": 1504130680, "answer_id": 45970374, "question_id": 45969859, "link": "https://stackoverflow.com/questions/45969859/c-subscript-operator-to-underling-class-vector/45970374#45970374", "title": "c++ subscript operator to underling class vector", "body": "<p>Despite all other things you have one rather creepy thing in your code</p>\n\n<pre><code>if (Index &gt; contents.size() -1)\n</code></pre>\n\n<p>You should never ever replace the correct choice of the boolean operator by arithmetic operations! std::vector&lt;>.size() returns size_t (unsigned long on most systems), only your selfmade size() returns int, which it shouldn\u00b4t since there is no meaning in negative sizes.</p>\n\n<p>Now 0 - 1 doesn\u00b4t yield a negative with 0 being size_t but something huuuge: 18446744073709551615 (0xffffffffffffffff).</p>\n\n<p>So with size()=0</p>\n\n<pre><code>if (Index &gt; contents.size() -1)\n</code></pre>\n\n<p>Will never ever be true and your vec will not grow, as you wanted, on access to vec[0]. Simply use</p>\n\n<pre><code>if (Index &gt;= contents.size())\n</code></pre>\n\n<p>Which is exactly what you mean.</p>\n"}, {"tags": [], "owner": {"reputation": 503, "user_id": 7458932, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/226f3917c60bd248fcd77f4448b19068?s=128&d=identicon&r=PG&f=1", "display_name": "devalone", "link": "https://stackoverflow.com/users/7458932/devalone"}, "is_accepted": false, "score": 0, "last_activity_date": 1504130923, "creation_date": 1504130923, "answer_id": 45970413, "question_id": 45969859, "link": "https://stackoverflow.com/questions/45969859/c-subscript-operator-to-underling-class-vector/45970413#45970413", "title": "c++ subscript operator to underling class vector", "body": "<p>Likely your problem was that you used <code>vecn&lt;T&gt; v2();</code> instead of <code>vecn&lt;T&gt; v2;</code>, but there are another bad things in your solution. Here is some refactor:</p>\n\n<pre><code>template &lt;typename T&gt;\nclass vecn {\npublic:\n    vecn() {}\n    template &lt;typename... Args&gt;\n    vecn(Args&amp;&amp;... args)\n    {\n        addToVector(args...);\n    }\n\n    friend std::ostream&amp; operator&lt;&lt;(std::ostream&amp; os, const vecn&lt;T&gt;&amp; obj)\n    {\n        os &lt;&lt; \"{\";\n        for (auto it = obj.contents.begin(); it &lt; obj.contents.end(); it++) {\n            os &lt;&lt; *it;\n            if (it != obj.contents.end() - 1)\n                os &lt;&lt; \",\";\n        }\n        os &lt;&lt; \"}\";\n        return os;\n    }\n\n    // you don't need this\n    // template&lt;typename T&gt;\n\n    // also whole method is unnecessary\n    //    vecn&lt;T&gt;&amp; operator=(const vecn&lt;T&gt;&amp; v)\n    //    {\n    //        contents = v.contents;\n    //        return *this;\n    //    }\n\n    // use size_t\n    /*unsigned int*/ size_t size() const\n    {\n        return contents.size();\n    }\n\n    vecn&lt;T&gt; operator+(const vecn&lt;T&gt;&amp; other) const\n    {\n        vecn&lt;T&gt; result;\n        size_t resultSize = std::max(other.size(), size());\n        result.contents.reserve(resultSize);\n\n        for (size_t i = 0; i &lt; resultSize; ++i) {\n            T value = {};\n            if (i &lt; other.size())\n                value += other.contents[i];\n            if (i &lt; size())\n                value += contents[i];\n\n            result.contents.push_back(value);\n        }\n\n        return result;\n    }\n\n    T&amp; operator[](size_t index)\n    {\n        return contents.at(index);\n    }\n\n    const T&amp; operator[](size_t index) const\n    {\n        return contents.at(index);\n    }\n\nprivate:\n    template &lt;typename... Args&gt;\n    void addToVector(T&amp; first, Args&amp;&amp;... args)\n    {\n        addToVector(first);\n        addToVector(args...);\n    }\n\n    void addToVector(T&amp; item)\n    {\n        contents.push_back(item);\n    }\n    std::vector&lt;T&gt; contents;\n};\n</code></pre>\n"}], "owner": {"reputation": 516, "user_id": 2118290, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/bFB3H.gif?s=128&g=1", "display_name": "Steven Venham", "link": "https://stackoverflow.com/users/2118290/steven-venham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 306, "favorite_count": 0, "accepted_answer_id": 45969990, "answer_count": 3, "score": 0, "last_activity_date": 1504130923, "creation_date": 1504127961, "question_id": 45969859, "link": "https://stackoverflow.com/questions/45969859/c-subscript-operator-to-underling-class-vector", "title": "c++ subscript operator to underling class vector", "body": "<p>So i'm trying to create a vec class that I can do vec math on at a later point.</p>\n\n<p>Was working great until I began Implementing actual procedures on it.</p>\n\n<p>Class vecn:</p>\n\n<pre><code>#include &lt;vector&gt;\n\ntemplate &lt;typename T&gt;\nclass vecn\n{\npublic:\n    vecn() {    }\n    template &lt;typename... Args&gt;\n    vecn(Args&amp;&amp;... args)\n    {\n        addtovector(args...);\n    }\n\n    friend std::ostream&amp; operator&lt;&lt;(std::ostream&amp; os, const vecn&lt;T&gt;&amp; obj)\n    {\n        os &lt;&lt; \"{\";\n        for (auto it = obj.contents.begin(); it &lt; obj.contents.end(); it++) {\n            os &lt;&lt; *it;\n            if (it != obj.contents.end() -1)\n            {\n                os &lt;&lt; \",\";\n            }\n        }\n        os &lt;&lt; \"}\";\n        return os;\n    }\n\n    template&lt;typename T&gt;\n    vecn&lt;T&gt;&amp; operator=(const vecn&lt;T&gt;&amp; v) {\n        contents = v.contents;\n        return *this;\n    }\n\n    unsigned int size() const\n    {\n        return contents.size();\n    }\n\n    vecn&lt;T&gt; operator+(const vecn&lt;T&gt;&amp; v1) {\n        vecn&lt;T&gt; v2();\n        for (unsigned int i = 0; i &lt; size();i++)\n        {\n            v2[i] = v1[i] + this-&gt;contents[i];\n        }\n        return v2;\n    }\n\n    T&amp; operator[](size_t Index)\n    { \n        if (Index &gt; contents.size() -1)\n        {\n            contents.resize(Index + 1);\n        }\n        return contents.at(Index);\n    }\n\n    const T&amp; operator[](size_t Index) const\n    {\n        return contents.at(Index);\n    }\n\nprivate:\n    template &lt;typename... Args&gt;\n    void addtovector(T&amp; first, Args&amp;&amp;... args)\n    {\n        addtovector(first);\n        addtovector(args...);\n    }\n\n    void addtovector(T&amp; item)\n    {\n        contents.push_back(item);\n    }\n    std::vector&lt;T&gt; contents;\n};\n</code></pre>\n\n<p>Now i'm having a problem with acceing the underling vector using the subscript operator, no matter how I design it, it never quite works. Usually resulting in a </p>\n\n<pre><code>Error   C2109   subscript requires array or pointer type\n</code></pre>\n\n<p>From Googling the error, I'm supposed to return a pointer to the array with the subscript. which I do.</p>\n\n<p>Is there something i'm missing?</p>\n\n<p>main:</p>\n\n<pre><code>vecn&lt;int&gt; v(1,2);\nvecn&lt;int&gt; b(3, 4, 5);\nstd::cout &lt;&lt; v + b;\n</code></pre>\n\n<p>Expected output: </p>\n\n<pre><code>{4,6,5}\n</code></pre>\n"}, {"tags": ["c++", "opencv", "makefile", "cygwin"], "comments": [{"owner": {"reputation": 6281, "user_id": 5105383, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2YCB5.jpg?s=128&g=1", "display_name": "matzeri", "link": "https://stackoverflow.com/users/5105383/matzeri"}, "edited": false, "score": 0, "creation_date": 1504128312, "post_id": 45969751, "comment_id": 78899157, "body": "Opencv 3.2.0 is available on cygwin, see <a href=\"https://cygwin.com/packages/x86_64/opencv/\" rel=\"nofollow noreferrer\">cygwin.com/packages/x86_64/opencv</a> . If you really need the last 3.4.5 you could at least see the cygwin source package for hints on building it."}, {"owner": {"reputation": 7, "user_id": 8077586, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42867c77cc2caf88c3390ae9406cab9c?s=128&d=identicon&r=PG&f=1", "display_name": "A.Aminidad", "link": "https://stackoverflow.com/users/8077586/a-aminidad"}, "reply_to_user": {"reputation": 6281, "user_id": 5105383, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2YCB5.jpg?s=128&g=1", "display_name": "matzeri", "link": "https://stackoverflow.com/users/5105383/matzeri"}, "edited": false, "score": 0, "creation_date": 1504144617, "post_id": 45969751, "comment_id": 78903092, "body": "I&#39;m aware of that, but I actually need OpenCV 2.4.5"}, {"owner": {"reputation": 6281, "user_id": 5105383, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2YCB5.jpg?s=128&g=1", "display_name": "matzeri", "link": "https://stackoverflow.com/users/5105383/matzeri"}, "edited": false, "score": 0, "creation_date": 1504204451, "post_id": 45969751, "comment_id": 78936105, "body": "but have you looked at 3.2.0 cygwin source packages for hint on configuration and compiling ? May be there is some setting useful in your case"}], "owner": {"reputation": 7, "user_id": 8077586, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42867c77cc2caf88c3390ae9406cab9c?s=128&d=identicon&r=PG&f=1", "display_name": "A.Aminidad", "link": "https://stackoverflow.com/users/8077586/a-aminidad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 624, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1504144567, "creation_date": 1504127431, "last_edit_date": 1504144567, "question_id": 45969751, "link": "https://stackoverflow.com/questions/45969751/opencv-in-cygwin-make-makefile128-all-error-2", "title": "OpenCV in Cygwin - make: *** [Makefile:128: all] Error 2", "body": "<p>I'm trying to install OpenCV on my Windows, using cygwin, using these commands :</p>\n\n<pre><code>cd ~\ngit clone https://github.com/opencv/opencv.git\ncd opencv\ngit checkout 2.4.5\nmkdir build\ncd build\ncmake -G \"Unix Makefiles\" ..\nmake -j8\nsudo make install\n</code></pre>\n\n<p>The Problem is after i try to use command: \"make -j8\" , i get this error at around 67% :</p>\n\n<pre><code>[ 67%] Building CXX object modules/legacy/CMakeFiles/opencv_legacy.dir/src/calibfilter.cpp.o\n/cygdrive/d/newbuild/opencv/modules/legacy/src/calibfilter.cpp: In member function \u2018virtual bool CvCalibFilter::SaveCameraParams(const char*)\u2019:\n/cygdrive/d/newbuild/opencv/modules/legacy/src/calibfilter.cpp:689:47: error: \u2018CvStereoCamera {aka struct CvStereoCamera}\u2019 has no member named \u2018quad\u2019\n                 fprintf(f, \"%15.10f \", stereo.quad[i][j].x );\n                                               ^\n/cygdrive/d/newbuild/opencv/modules/legacy/src/calibfilter.cpp:690:47: error: \u2018CvStereoCamera {aka struct CvStereoCamera}\u2019 has no member named \u2018quad\u2019\n                 fprintf(f, \"%15.10f \", stereo.quad[i][j].y );\n                                               ^\n/cygdrive/d/newbuild/opencv/modules/legacy/src/calibfilter.cpp: In member function \u2018virtual bool CvCalibFilter::LoadCameraParams(const char*)\u2019:\n/cygdrive/d/newbuild/opencv/modules/legacy/src/calibfilter.cpp:746:57: error: \u2018CvStereoCamera {aka struct CvStereoCamera}\u2019 has no member named \u2018quad\u2019\n             int values_read = fscanf(f, \"%f \", &amp;(stereo.quad[i][j].x) );\n                                                         ^\n/cygdrive/d/newbuild/opencv/modules/legacy/src/calibfilter.cpp:748:53: error: \u2018CvStereoCamera {aka struct CvStereoCamera}\u2019 has no member named \u2018quad\u2019\n             values_read = fscanf(f, \"%f \", &amp;(stereo.quad[i][j].y) );\n                                                     ^\nmake[2]: *** [modules/legacy/CMakeFiles/opencv_legacy.dir/build.make:639: modules/legacy/CMakeFiles/opencv_legacy.dir/src/calibfilter.cpp.o] Error 1\nmake[1]: *** [CMakeFiles/Makefile2:4703: modules/legacy/CMakeFiles/opencv_legacy.dir/all] Error 2\nmake: *** [Makefile:128: all] Error 2\n</code></pre>\n\n<p>How do I solve this problem? I already tried using \"make\" instead of \"make -j\"\nthere is no difference</p>\n\n<p>EDIT: I want to use the specific 2.4.5 version of OpenCV</p>\n"}, {"tags": ["c++", "gcc", "linker"], "comments": [{"owner": {"reputation": 55516, "user_id": 892256, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/15FJW.png?s=128&g=1", "display_name": "Ed Heal", "link": "https://stackoverflow.com/users/892256/ed-heal"}, "edited": false, "score": 0, "creation_date": 1504127555, "post_id": 45969748, "comment_id": 78898798, "body": "Please read up about <code>const</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2672107"}, "edited": false, "score": 0, "creation_date": 1504127695, "post_id": 45969748, "comment_id": 78898874, "body": "You have two classes named Person."}, {"owner": {"reputation": 18687, "user_id": 3552770, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/b0404d5b5bd565aa720c6b3d190716b3?s=128&d=identicon&r=PG", "display_name": "LogicStuff", "link": "https://stackoverflow.com/users/3552770/logicstuff"}, "edited": false, "score": 0, "creation_date": 1504127735, "post_id": 45969748, "comment_id": 78898885, "body": "And you&#39;ll get a redefinition error in that case."}, {"owner": {"reputation": 157, "user_id": 3105338, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RgW3i.png?s=128&g=1", "display_name": "yippy_yay", "link": "https://stackoverflow.com/users/3105338/yippy-yay"}, "reply_to_user": {"reputation": 18687, "user_id": 3552770, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/b0404d5b5bd565aa720c6b3d190716b3?s=128&d=identicon&r=PG", "display_name": "LogicStuff", "link": "https://stackoverflow.com/users/3552770/logicstuff"}, "edited": false, "score": 0, "creation_date": 1504127910, "post_id": 45969748, "comment_id": 78898972, "body": "@LogicStuff But I&#39;m just redeclaring - not redefining- Person in PersonMain. Repeat declarations are okay, I thought. The definition is in Person, that&#39;s where the linker should look for it. Normally, all the Re-Declarations would be in a header file, but I put them in explicitly."}, {"owner": {"reputation": 157, "user_id": 3105338, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RgW3i.png?s=128&g=1", "display_name": "yippy_yay", "link": "https://stackoverflow.com/users/3105338/yippy-yay"}, "edited": false, "score": 0, "creation_date": 1504128614, "post_id": 45969748, "comment_id": 78899249, "body": "Okay, I see I&#39;m getting a lot of downvotes - I know I&#39;m doing something wrong, but I still don&#39;t understand exactly what. I thought a header file usually contained only declarations - not definitions. The definitions of functions are then contained in .cpp files, that are compiled and can be linked to source files that contain the .h files. If the .h files contained the definitions and the declarations, then the preprocessor would do the linking on the source level. (I&#39;m a beginner, coming from Java)."}, {"owner": {"reputation": 364, "user_id": 3443104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddb13b9d011bee845ad58aef07990e4e?s=128&d=identicon&r=PG&f=1", "display_name": "rfx", "link": "https://stackoverflow.com/users/3443104/rfx"}, "edited": false, "score": 1, "creation_date": 1504129341, "post_id": 45969748, "comment_id": 78899522, "body": "Erm, please format this mess properly at least."}], "answers": [{"comments": [{"owner": {"reputation": 157, "user_id": 3105338, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RgW3i.png?s=128&g=1", "display_name": "yippy_yay", "link": "https://stackoverflow.com/users/3105338/yippy-yay"}, "edited": false, "score": 0, "creation_date": 1504129886, "post_id": 45969888, "comment_id": 78899718, "body": "That&#39;s interesting! Okay, I get that the compiler tosses out code in a compilation unit that is not used in that same compilation unit. How do I tell the compiler that this code will be used in a different compilation unit? (That&#39;s what I am trying to do here)"}, {"owner": {"reputation": 3834, "user_id": 517580, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d04aa91a34f0171bcf5898f0b6d81101?s=128&d=identicon&r=PG", "display_name": "engf-010", "link": "https://stackoverflow.com/users/517580/engf-010"}, "reply_to_user": {"reputation": 157, "user_id": 3105338, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RgW3i.png?s=128&g=1", "display_name": "yippy_yay", "link": "https://stackoverflow.com/users/3105338/yippy-yay"}, "edited": false, "score": 0, "creation_date": 1504131153, "post_id": 45969888, "comment_id": 78900145, "body": "@yippy_yay: you can&#39;t tell those thing to the compiler. What one normally does is : Put your class definition in a header file and include that header file in the source files that need it. Remember that a class may be defined multiple times (even in the same source) without causing redefinition errors during link. Just as long as those definitions are identical."}], "tags": [], "owner": {"reputation": 3834, "user_id": 517580, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d04aa91a34f0171bcf5898f0b6d81101?s=128&d=identicon&r=PG", "display_name": "engf-010", "link": "https://stackoverflow.com/users/517580/engf-010"}, "is_accepted": false, "score": 1, "last_activity_date": 1504131264, "last_edit_date": 1504131264, "creation_date": 1504128137, "answer_id": 45969888, "question_id": 45969748, "link": "https://stackoverflow.com/questions/45969748/why-does-the-c-compiler-not-find-the-function-definitions/45969888#45969888", "title": "Why does the C++ Compiler not find the function definitions?", "body": "<p>what you've got is a definition in one source file and a declaration in the other source file.\nWhen the source file containing the definition is compiled ,the compiler comes to the conclusion that there isn't any 'real' code to generate ,because you didn't use the class.\nSo you end up with an empty object file.</p>\n\n<p>You can define a class in a source file but if you don't use that class in that file it is tossed away as not being used.\nIf you use that class in other source files (through it's declaration) the compiler generates code for member accesses ,but those are not found during linking.</p>\n"}, {"comments": [{"owner": {"reputation": 157, "user_id": 3105338, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RgW3i.png?s=128&g=1", "display_name": "yippy_yay", "link": "https://stackoverflow.com/users/3105338/yippy-yay"}, "edited": false, "score": 0, "creation_date": 1504134059, "post_id": 45970696, "comment_id": 78900957, "body": "I think I might be confused about the use of &quot;Declaration&quot;, &quot;Definition&quot; and &quot;Implementation&quot;. What you are doing in person.h looks like a Declaration to me, not a definition. And isn&#39;t Defintion = Implementation?"}, {"owner": {"reputation": 364, "user_id": 3443104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddb13b9d011bee845ad58aef07990e4e?s=128&d=identicon&r=PG&f=1", "display_name": "rfx", "link": "https://stackoverflow.com/users/3443104/rfx"}, "reply_to_user": {"reputation": 157, "user_id": 3105338, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RgW3i.png?s=128&g=1", "display_name": "yippy_yay", "link": "https://stackoverflow.com/users/3105338/yippy-yay"}, "edited": false, "score": 0, "creation_date": 1504134455, "post_id": 45970696, "comment_id": 78901084, "body": "Sorry about this confusion. You&#39;re right. In this context definition = implemenation and declaration = interface. It&#39;s my fault (kind of sleepy now :) Going to correct this."}, {"owner": {"reputation": 157, "user_id": 3105338, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RgW3i.png?s=128&g=1", "display_name": "yippy_yay", "link": "https://stackoverflow.com/users/3105338/yippy-yay"}, "edited": false, "score": 0, "creation_date": 1504135373, "post_id": 45970696, "comment_id": 78901300, "body": "I now know what I kept doing wrong: I thought the &quot;class Person{}&quot; stuff in Person.cpp was there to show what namespace it is in. But using that class keyword signals the compiler to make a new class. I thought this wouldn&#39;t happen, as no definitions were given here. You pointed me in the right direciton by striking the class Person{} and using Person:: instead."}, {"owner": {"reputation": 364, "user_id": 3443104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddb13b9d011bee845ad58aef07990e4e?s=128&d=identicon&r=PG&f=1", "display_name": "rfx", "link": "https://stackoverflow.com/users/3443104/rfx"}, "reply_to_user": {"reputation": 157, "user_id": 3105338, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RgW3i.png?s=128&g=1", "display_name": "yippy_yay", "link": "https://stackoverflow.com/users/3105338/yippy-yay"}, "edited": false, "score": 0, "creation_date": 1504135838, "post_id": 45970696, "comment_id": 78901391, "body": "<i>&quot;class Person{}&quot; stuff in Person.cpp was there to show what namespace it is in</i> - no way. You can&#39;t tell compiler to use class&#39; namespace like this. You have to use <code>::</code> - scope resolution operator here. But anyways, you wouldn&#39;t succeed in arranging things this way, because compiler doesn&#39;t know what you implement in <code>person.cpp</code>. So you&#39;re bound to all-in-a-single file or you have to split interface/implementation into <code>.h</code> and <code>.cpp</code> files."}], "tags": [], "owner": {"reputation": 364, "user_id": 3443104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddb13b9d011bee845ad58aef07990e4e?s=128&d=identicon&r=PG&f=1", "display_name": "rfx", "link": "https://stackoverflow.com/users/3443104/rfx"}, "is_accepted": true, "score": 2, "last_activity_date": 1504134874, "last_edit_date": 1504134874, "creation_date": 1504132529, "answer_id": 45970696, "question_id": 45969748, "link": "https://stackoverflow.com/questions/45969748/why-does-the-c-compiler-not-find-the-function-definitions/45970696#45970696", "title": "Why does the C++ Compiler not find the function definitions?", "body": "<p>Usually one splits declarations and definitions into <code>.h</code> and <code>.cpp</code> files respectively.</p>\n\n<p>Your code would look something like this:</p>\n\n<p><code>person.h</code> - declarations:</p>\n\n<pre><code>#include &lt;string&gt;\n\nclass Person {\npublic:\n        Person(std::string n);\n        std::string getName() const;\n\n        std::string name;\n};\n</code></pre>\n\n<p><code>person.cpp</code> - implementation:</p>\n\n<pre><code>#include &lt;string&gt;\n#include \"person.h\"\n\nPerson::Person(const char* n) : name(n) { }\nstd::string Person::getName () const { return name; }\n</code></pre>\n\n<p>and <code>personmain.cpp</code> - where you use your class <code>Person</code>:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include \"person.h\"\n\nint main()\n{\n        Person* charlie = new Person(\"Charlie\");\n        std::cout &lt;&lt; \"Hi, my name is \" &lt;&lt; charlie-&gt;getName ();\n}\n</code></pre>\n\n<p>Like @engf mentioned, essentially, what you got in your code is double definition of <code>Person</code> and no implementation. You can't easily define <code>Person</code> in main file and implement <code>Person::Person()</code> somewhere else (and you should not), in another translation unit (i.e., in <code>person.cpp</code>), without letting the compiler know what you implement. You can't forward-declare <code>Person</code> and use it in <code>personmain.cpp</code> like this:</p>\n\n<pre><code>class Person;\n...\nPerson* charlie = new Person(\"whatever\");\n</code></pre>\n\n<p>because compiler should know complete type to emit code constructing the <code>Person</code>-object. You can't have two definitions of <code>Person</code>. You can't implement members of <code>Person</code> without definitions, accessible to all users of your code. So, what you left with is the scheme like this above.</p>\n\n<p>To elaborate a bit more on compilation and linking, very roughly, when compiler sees a reference to symbol not defined locally in the same translation unit, it puts appropriate record into object file. When this object file is passed to the linker (possibly, along with a bunch of other object files and libraries), linker should resolve such records to symbols (functions, variables etc.) found somewhere in input object files or libraries. If it succeeds in that, it combines all the referenced code into single image. In your case the linker failed to resolve referenced symbol <code>Person::Person</code> for constructor. Probably <a href=\"https://stackoverflow.com/questions/14536491/c-compiling-and-linking\">this</a> is not bad Q&amp;A to start.</p>\n"}], "owner": {"reputation": 157, "user_id": 3105338, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RgW3i.png?s=128&g=1", "display_name": "yippy_yay", "link": "https://stackoverflow.com/users/3105338/yippy-yay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 221, "favorite_count": 0, "closed_date": 1504211814, "accepted_answer_id": 45970696, "answer_count": 2, "score": -4, "last_activity_date": 1504134874, "creation_date": 1504127420, "last_edit_date": 1504132518, "question_id": 45969748, "link": "https://stackoverflow.com/questions/45969748/why-does-the-c-compiler-not-find-the-function-definitions", "closed_reason": "Needs details or clarity", "title": "Why does the C++ Compiler not find the function definitions?", "body": "<p>I wrote some code trying to understand the relationship between compiling and linking - and also to see where and if function declarations have to be repeated in source files.</p>\n\n<p>The two files I wrote are:</p>\n\n<p>Person.cpp:</p>\n\n<pre><code>#include &lt;string&gt;  \nclass Person {\n  public:\n   Person(std::string name) {\n   (*this).name = name;\n   };\n   std::string getName() {\n   return name;\n   };\n   std::string name;\n};\n</code></pre>\n\n<p>and the file</p>\n\n<p>PersonMain.cpp:</p>\n\n<pre><code>#include &lt;iostream&gt;\nclass Person {\n  public:\n    Person(std::string);\n    std::string getName();\n    std::string name;\n };\nint main(){\n          Person* charlie = new Person(\"Charlie\");\n          std::cout &lt;&lt; \"Hi, my name is \" &lt;&lt; charlie-&gt;getName();\n          }\n</code></pre>\n\n<p>I repeat the Class Person and Class Person function declarations (not the definitions) in the PersonMain.cpp.</p>\n\n<p>I now compile and link the two files using the gcc C++ Compiler:</p>\n\n<p>g++ *.cpp -o runthis.exe</p>\n\n<p>I then get the following error message:</p>\n\n<blockquote>\n  <p>PersonMain.cpp:(.text+0xfe): undefined reference to\n  <code>Person::Person(std::basic_string&lt;char,\n  std::char_traits&lt;char&gt;,std::allocator&lt;char&gt; &gt;)'\n  PersonMain.cpp:(.text+0x13c): undefined reference to\n  </code>Person::getName()' collect2.exe: error: ld returned 1 exit status</p>\n</blockquote>\n\n<p>It seems the Person Class methods are not found when linking. Why is that? How can I heal this?</p>\n\n<p>ADDENDUM:</p>\n\n<p>I repeated the declaration of Person in PersonMain.cpp explicitly, and didn't but the redeclaration into a header file as would be done normally. So I've done the preprocessor step here already.  <a href=\"https://stackoverflow.com/questions/6264249/how-does-the-compilation-linking-process-work\">This</a> faq suggests that:</p>\n\n<blockquote>\n  <p>[The Preprocessor] works on one C++ source file at a time by replacing\n  include directives with the content of the respective files (which is usually just declarations)[...]</p>\n</blockquote>\n\n<p>and later on:</p>\n\n<blockquote>\n  <p>[The Linker] links all the object files by replacing the references to\n  undefined symbols with the correct addresses. Each of these symbols\n  can be defined in other object files or in libraries.</p>\n</blockquote>\n\n<p>I add this remark becaue @engf-010 said that a Compilation Unit that has code that isn't actually used in that compilation unit is not compiled, even if it is needed in other compilation units. enf-010 suggests that I put the definition and declaration into the header file, but the faq article says that only the declarations should go there, the definitions can be elsewhere.</p>\n"}, {"tags": ["c++", "multithreading", "camera", "convolution"], "comments": [{"owner": {"reputation": 5782, "user_id": 2832398, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/356c99a077310a35816f852423859f4c?s=128&d=identicon&r=PG&f=1", "display_name": "lilezek", "link": "https://stackoverflow.com/users/2832398/lilezek"}, "edited": false, "score": 1, "creation_date": 1504126720, "post_id": 45969538, "comment_id": 78898462, "body": "Do you need help tagging frames? That sounds way easier than the title suggested to, which is making a convolution multithreaded."}, {"owner": {"reputation": 8756, "user_id": 416274, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/fa38a4e372afb202e6ab7eb1619372a8?s=128&d=identicon&r=PG", "display_name": "Robinson", "link": "https://stackoverflow.com/users/416274/robinson"}, "edited": false, "score": 1, "creation_date": 1504126888, "post_id": 45969538, "comment_id": 78898523, "body": "You need to define what you mean by &quot;corresponding&quot;.  What is the constraint?"}, {"owner": {"reputation": 111, "user_id": 8532096, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e404327d302f3f294008a39bac4f710b?s=128&d=identicon&r=PG&f=1", "display_name": "Ilya", "link": "https://stackoverflow.com/users/8532096/ilya"}, "edited": false, "score": 0, "creation_date": 1504127927, "post_id": 45969538, "comment_id": 78898988, "body": "By corresponding I mean taken at the same moment of time (the cameras will be synchronized with an external trigger). However due to asynchronous character of the data transfer, they do not arrive at the same time into the program."}, {"owner": {"reputation": 2956, "user_id": 5909388, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-uNuNWo_bCHA/AAAAAAAAAAI/AAAAAAAAABg/rciVxcULLHc/photo.jpg?sz=128", "display_name": "Kaveh Vahedipour", "link": "https://stackoverflow.com/users/5909388/kaveh-vahedipour"}, "edited": false, "score": 1, "creation_date": 1504179961, "post_id": 45969538, "comment_id": 78920403, "body": "There is a lot of information missing here really. How big is your convolution kernel? What processor type are u using (SSE/SSE2/MKL/MKL512)? Double/float precision (why)? How do you implement your complex multiplication? Why do you tag your frames. Why is your buffer not just #points times n frames. So the beginning of every frame and its according frame # corresponds to just a position in the buffer. There is a lot of things to be considered depending on those details. Do you use FFTW/MKL own FFT? Etc. etc. etc."}], "owner": {"reputation": 111, "user_id": 8532096, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e404327d302f3f294008a39bac4f710b?s=128&d=identicon&r=PG&f=1", "display_name": "Ilya", "link": "https://stackoverflow.com/users/8532096/ilya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 297, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1512892116, "creation_date": 1504126472, "last_edit_date": 1512892116, "question_id": 45969538, "link": "https://stackoverflow.com/questions/45969538/multithreading-for-convolution-calculation", "title": "Multithreading for convolution calculation", "body": "<p>I am trying to calculate the convolution product the two pictures from two cameras as fast as possible. The cameras output ~ 17 fps, each frame is ~3MB. The camera manufacturer provides some c/c++ libraries to capture the images, all I need to do is to fourier transform each image, multiply the corresponding fourier transforms and make an inverse transform. What I currently do is I create a buffer and fill it with the frames in one thread, and there are three more threads, two for fourier transforming images from each camera and one for multiplication and calculation of the inverse fourier transforms. </p>\n\n<p>At certain moment it becomes hard to pair the corresponding frames. I assign unique IDs to each frame when it is created. And when a new frame arrives I check if there are any frames with the same ID from the other camera. At certain moment it becomes hard to tell if it is a new frame in sequence and I need to put it to buffer and wait for the pair, or I've lost too many frames from the other camera and I need to discard this to catch it up.</p>\n\n<p>What data types is it better to use and how to organize the data flow? </p>\n"}, {"tags": ["c++", "multithreading", "qt"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2672107"}, "edited": false, "score": 1, "creation_date": 1504126342, "post_id": 45969457, "comment_id": 78898274, "body": "Why do you allocate a QList on the heap? Create it on the stack!"}, {"owner": {"reputation": 143, "user_id": 7847375, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3bc82bbefa3a5c9faa4f95d8b565eb2b?s=128&d=identicon&r=PG&f=1", "display_name": "ntmt", "link": "https://stackoverflow.com/users/7847375/ntmt"}, "edited": false, "score": 0, "creation_date": 1504126705, "post_id": 45969457, "comment_id": 78898452, "body": "Thank you for your suggestion, I will definitely change it once I figure out the threading process."}], "answers": [{"comments": [{"owner": {"reputation": 143, "user_id": 7847375, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3bc82bbefa3a5c9faa4f95d8b565eb2b?s=128&d=identicon&r=PG&f=1", "display_name": "ntmt", "link": "https://stackoverflow.com/users/7847375/ntmt"}, "edited": false, "score": 0, "creation_date": 1504130330, "post_id": 45970071, "comment_id": 78899876, "body": "Thank you, setting the ChunkProcessor autoDelete to be &quot;false&quot; done the trick. I did registered the shared_ptr already, since the single run works, but not the threading run. Anyway, thank you for the autoDelete() suggestion."}], "tags": [], "owner": {"reputation": 22818, "user_id": 1387438, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/ad806758c356c915ea08a4bfd79131e3?s=128&d=identicon&r=PG", "display_name": "Marek R", "link": "https://stackoverflow.com/users/1387438/marek-r"}, "is_accepted": true, "score": 1, "last_activity_date": 1504129862, "last_edit_date": 1504129862, "creation_date": 1504129055, "answer_id": 45970071, "question_id": 45969457, "link": "https://stackoverflow.com/questions/45969457/qt-shared-ptr-signal-with-qthreadpool/45970071#45970071", "title": "Qt shared_ptr signal with QThreadPool", "body": "<pre><code>ASSERT: \"!d-&gt;ref.isShared()\" in file tools\\qlist.cpp, line 162\n</code></pre>\n\n<p>this means that assertion has failed in <code>QListData</code> (private part of QList). This is not related with <code>shared_ptr</code>.\n<a href=\"https://github.com/Satius/qt5/blob/master/qtbase/src/corelib/tools/qlist.cpp\" rel=\"nofollow noreferrer\">Qt source</a> doesn't clarify what this assertion checks, but I'm guesing that you are doing something illegal on <code>QList</code> or you have some kind race condition on it.\nIt is hard to tell since you haven't show relevant part of code.</p>\n\n<pre><code>QObject::~QObject: Timers cannot be stopped from another thread\n</code></pre>\n\n<p>This means that your <code>QObject</code> (most probably <code>ChunkProcessor</code>) is destroyed from another thread and this object has active timer running.</p>\n\n<p>Assuming that this is problem with <code>ChunkProcessor</code> you can fix it in couple ways:</p>\n\n<ol>\n<li>do not use timer inside <code>ChunkProcessor</code></li>\n<li>do not transfer ownership of <code>ChunkProcessor</code> to the tread pool (<code>autoDelete()</code> should return <code>false</code>)</li>\n</ol>\n\n<p>Note crash is not related with <code>shared_ptr</code>!</p>\n\n<p>Also question is did you registered <code>std::shared_ptr&lt;customClass::ProcessedData&gt;</code> as a type?<br>\nIf you didn't that it will not go through signal slot mechanism (since you have used automatic connection type)!</p>\n"}], "owner": {"reputation": 143, "user_id": 7847375, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3bc82bbefa3a5c9faa4f95d8b565eb2b?s=128&d=identicon&r=PG&f=1", "display_name": "ntmt", "link": "https://stackoverflow.com/users/7847375/ntmt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 284, "favorite_count": 0, "accepted_answer_id": 45970071, "answer_count": 1, "score": 0, "last_activity_date": 1504166896, "creation_date": 1504126112, "last_edit_date": 1504166896, "question_id": 45969457, "link": "https://stackoverflow.com/questions/45969457/qt-shared-ptr-signal-with-qthreadpool", "title": "Qt shared_ptr signal with QThreadPool", "body": "<p>I'm trying to process large csv data as it comes in chunk. If I run chunkprocess without threading, the application doesn't crash. However, as soon as I add in the threadpool, the application crashes and throws in the following errors. ChunkProcess run only emits (nothing else yet) signal shared_ptr which is a private member of ChunkProcess. After reading articles online, I found that shared_ptr is not thread safe unless you make a copy of it... so is there a way i can make a copy of it while using it as a signal?</p>\n\n<pre><code>ASSERT: \"!d-&gt;ref.isShared()\" in file tools\\qlist.cpp, line 162\nInvalid parameter passed to C runtime function.\nInvalid parameter passed to C runtime function.\nQObject::~QObject: Timers cannot be stopped from another thread\n</code></pre>\n\n<hr>\n\n<pre><code>void MainWindow::parseCSV(QString file_name)\n{\n    QFile file(file_name);\n    if (!file.open(QIODevice::ReadOnly))\n        return;\n    QThreadPool *threadPool = QThreadPool::globalInstance();\n    QList&lt;QList&lt;QByteArray&gt;&gt;* data = new QList&lt;QList&lt;QByteArray&gt;&gt;;\n    int count = 0;\n    while (!file.atEnd()) {\n        ++count;\n        QByteArray line = file.readLine();\n        data-&gt;append(line.split(','));\n        if ( count &gt; 10000 ) {\n            ChunkProcessor* chunkprocess = new ChunkProcessor(data);\n\n            connect(chunkprocess, \n                    SIGNAL(finished(std::shared_ptr&lt;customClass::ProcessedData&gt;)), \n                    this, \n                    SLOT(readingFinished(std::shared_ptr&lt;customClass::ProcessedData&gt;)));\n//            threadPool-&gt;start(chunkprocess);\n//            threadPool-&gt;waitForDone();\n            chunkprocess-&gt;run();\n            delete data;\n            data = new QList&lt;QList&lt;QByteArray&gt;&gt;;\n            count = 0;\n         }\n    }\n    delete data;\n}\n\nvoid MainWindow::readingFinished(std::shared_ptr&lt;customClass::ProcessedData&gt; data)\n{\n    emittedData.append(data);\n    qInfo()&lt;&lt;\"got to finish reading\";\n}\n</code></pre>\n"}, {"tags": ["c++", "windows", "com", "mingw-w64"], "comments": [{"owner": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 0, "creation_date": 1504126070, "post_id": 45969375, "comment_id": 78898144, "body": "You can redeclare all the necessary com interfaces. You should be able to do this even in plain C. Though it seems like doing this would be just a waste of time and you should use Visual Studio instead."}, {"owner": {"reputation": 5362, "user_id": 2430669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2656586be6c90ef0666a391f1114628b?s=128&d=identicon&r=PG", "display_name": "Micha&#235;l Roy", "link": "https://stackoverflow.com/users/2430669/micha%c3%abl-roy"}, "edited": false, "score": 0, "creation_date": 1504126788, "post_id": 45969375, "comment_id": 78898493, "body": "This is rather common for COM interfaces.  There is no reason why a MinGW  application cannot do the same. The advantage of using MSVC is that it provides code generation tools and the MIDL language which do help quite a bit.  A google search of &quot;msdn register com interface&quot; will provide you with details on how you can provide the functionality by hand."}, {"owner": {"reputation": 135186, "user_id": 464581, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/v2PxU.jpg?s=128&g=1", "display_name": "Cheers and hth. - Alf", "link": "https://stackoverflow.com/users/464581/cheers-and-hth-alf"}, "edited": false, "score": 0, "creation_date": 1504127618, "post_id": 45969375, "comment_id": 78898838, "body": "<a href=\"https://msdn.microsoft.com/en-us/library/8etzzkb6.aspx\" rel=\"nofollow noreferrer\"><code>#import</code></a> implies that the file is a COM type library. You can inspect that via the old <a href=\"https://msdn.microsoft.com/en-us/library/d0kh9f4c.aspx\" rel=\"nofollow noreferrer\">COM/OLE viewer</a>, and copy the interface code. As I remember of old working with COM/OLE via the g++ compiler is not very practical, though."}, {"owner": {"reputation": 159118, "user_id": 15416, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/a2b11b9662b5155aada74191fbe7cb9e?s=128&d=identicon&r=PG", "display_name": "MSalters", "link": "https://stackoverflow.com/users/15416/msalters"}, "edited": false, "score": 1, "creation_date": 1504262208, "post_id": 45969375, "comment_id": 78956727, "body": "It&#39;s probably easier to write a simple DLL wrapping the interface. Compile the DLL with Visual Studio, use the DLL in your MinGW executable."}], "answers": [{"tags": [], "owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "is_accepted": false, "score": 1, "last_activity_date": 1504129689, "creation_date": 1504129689, "answer_id": 45970203, "question_id": 45969375, "link": "https://stackoverflow.com/questions/45969375/com-exe-c-and-mingw/45970203#45970203", "title": "COM exe, C++, and MinGW", "body": "<p>The COM subsystem is part of the Windows API, and you can access it using C calls to that API.</p>\n\n<p>However there is a huge amount of boilerplate involved in this.  The compilers which support COM \"out of the box\" have written all this boilerplate, and packaged it up in some combination of compiled libraries,  template headers, and so on.</p>\n\n<p>Another part of the usual suite of tools offered by these compilers is one that can read COM interface definitions out of an existing compiled object. COM objects usually contain a binary representation of their interface, for this reason.</p>\n\n<p>There are a few ways you could proceed here in order to use g++; one option is following this broad outline:</p>\n\n<ul>\n<li>Use your MSVC installation to read the COM object and produce a C header file describing the interface.</li>\n<li>Pick out the enumerations and GUIDs from that header file.</li>\n<li>In g++, use the Windows API to invoke the object, using those enumerations and GUIDs.</li>\n</ul>\n\n<p>If you want to author objects in g++ then there is a lot more work to do as you need to implement a bunch of things, but it is possible.</p>\n\n<p>I have done this successfully in the past with g++ (as part of testing COM objects I'd developed).  Probably somebody <em>could</em> develop a nice open-source suite for using COM objects, or even for authoring, that does not depend on MSVC but I'm not aware of such a thing.</p>\n\n<p>I would recommend reading the books by Don Box, they fill in a lot of gaps in understanding that you will have if you've only learned about COM by working with it and reading the internet.</p>\n"}, {"tags": [], "owner": {"reputation": 116623, "user_id": 403671, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/454HU.jpg?s=128&g=1", "display_name": "Simon Mourier", "link": "https://stackoverflow.com/users/403671/simon-mourier"}, "is_accepted": false, "score": 1, "last_activity_date": 1504157790, "last_edit_date": 1504157790, "creation_date": 1504157417, "answer_id": 45973850, "question_id": 45969375, "link": "https://stackoverflow.com/questions/45969375/com-exe-c-and-mingw/45973850#45973850", "title": "COM exe, C++, and MinGW", "body": "<p>The answer to \"is there a way to do the same with MinGW\" is no. #import is an <em>optional tool</em> that reads a COM <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms221355.aspx\" rel=\"nofollow noreferrer\">type library</a> (embedded in a binary or not, the TLB corresponds in general to an .idl file, but that also is optional), and generates C/C++ code that's heavily dependent on .c and .h files that only Visual Studio provides.</p>\n\n<p>The answer to \"can I do COM with MinGW\" is of course yes. I don't know much about MinGW and tools, but you can do COM with any compiler since COM is (just) a <a href=\"https://stackoverflow.com/questions/23325785/what-is-a-binary-standard\">binary standard</a>.</p>\n\n<p>If you get rid of #import, you'll have to change the code that uses what was generated (in the .TLH file resulting of the #import directive), COM helper, wrappers, etc. It can be a lot of work, but it's technically possible.</p>\n\n<p>Now, in your context, I suppose it really depends how big the .exe's type library (the description of your COM classes, interfaces, etc.) is. Visual Studio's #import adds value, so you'll have to assess how much value it added for you.</p>\n\n<p>If it's just one class, one interface for example, then it can be interesting to get rid of the #import. If the .exe already has .h files that correspond to the tlb, then you can use them, otherwise you'll have to redeclare some by yourself (and again, change the code that was using generated wrappers).</p>\n\n<p>The sole fact that you ask the question makes me wonder if you have enough knowledge of COM (no offense :-) to get rid of Visual Studio.</p>\n"}], "owner": {"reputation": 685, "user_id": 1403204, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f30cbad42fc123b2477f9dc2c09eef55?s=128&d=identicon&r=PG", "display_name": "Doug", "link": "https://stackoverflow.com/users/1403204/doug"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 902, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1504157790, "creation_date": 1504125769, "question_id": 45969375, "link": "https://stackoverflow.com/questions/45969375/com-exe-c-and-mingw", "title": "COM exe, C++, and MinGW", "body": "<p>Have abit of an odd question; I'm using a tool supplied by a large company that, for reasons I find somewhat baffling, uses a COM interface defined inside the exe itself. In the example code they provide, it looks alittle like this.</p>\n\n<p><code>#import \"C:\\\\Path_To_Exe\\\\the.exe\" rename_namespace (\"exe_namespace\");</code></p>\n\n<p>From what I understand, this is the way Microsoft Visual C++ compiler understands the COM and works with it, and I have had the example code working before (currently, it doesn't compile due to fiddling with my build environment).</p>\n\n<p>My question is, is there a way to do the same with MinGW? The project I'm working on is mainly using that; we can use MSVC if required, but I'd ideally like to avoid using multiple compilers if possible. I'm currently using cmake to build with, but I'm willing to use a script to build the items that need the COM interface if needed.</p>\n\n<p>Thanks for your time.</p>\n"}, {"tags": ["c++", "c++builder"], "comments": [{"owner": {"reputation": 2374, "user_id": 8491726, "user_type": "registered", "profile_image": "https://graph.facebook.com/1550562035006492/picture?type=large", "display_name": "Artemy Vysotsky", "link": "https://stackoverflow.com/users/8491726/artemy-vysotsky"}, "edited": false, "score": 2, "creation_date": 1504125292, "post_id": 45969208, "comment_id": 78897777, "body": "What the missing &quot;an&quot; word has to do with &#39;\\n&#39; character? &#39;\\n&#39; is end-of-line so how it can be in the middle of the line I do not understand."}, {"owner": {"reputation": 25, "user_id": 8205149, "user_type": "registered", "profile_image": "https://graph.facebook.com/1824778984505716/picture?type=large", "display_name": "Jacek", "link": "https://stackoverflow.com/users/8205149/jacek"}, "reply_to_user": {"reputation": 2374, "user_id": 8491726, "user_type": "registered", "profile_image": "https://graph.facebook.com/1550562035006492/picture?type=large", "display_name": "Artemy Vysotsky", "link": "https://stackoverflow.com/users/8491726/artemy-vysotsky"}, "edited": false, "score": 0, "creation_date": 1504126588, "post_id": 45969208, "comment_id": 78898396, "body": "Yes, I used function Pos() to find position of the sign \\n but result is 0. So I don&#39;t know if there is this new line"}, {"owner": {"reputation": 54044, "user_id": 3723423, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a2c916310a1261b53773de75fc83e5ad?s=128&d=identicon&r=PG&f=1", "display_name": "Christophe", "link": "https://stackoverflow.com/users/3723423/christophe"}, "edited": false, "score": 0, "creation_date": 1504127144, "post_id": 45969208, "comment_id": 78898633, "body": "It is not clear if the file contains an escape sequence composed of 2 consecutive &#39;\\&#39; and &#39;n&#39; or if it contains a newline char &#39;\\n&#39; (i.e. 0x0A).  It&#39;s also not clear if you want to remove the newline from the input, or only for the display.  COuld you clarify please ?"}, {"owner": {"reputation": 25, "user_id": 8205149, "user_type": "registered", "profile_image": "https://graph.facebook.com/1824778984505716/picture?type=large", "display_name": "Jacek", "link": "https://stackoverflow.com/users/8205149/jacek"}, "edited": false, "score": 0, "creation_date": 1504129124, "post_id": 45969208, "comment_id": 78899439, "body": "I want to remove this newline from the input"}], "answers": [{"tags": [], "owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "is_accepted": false, "score": 0, "last_activity_date": 1504137387, "last_edit_date": 1504137387, "creation_date": 1504136725, "answer_id": 45971246, "question_id": 45969208, "link": "https://stackoverflow.com/questions/45969208/loading-a-file-with-the-loadfromfile-function-with-a-newline/45971246#45971246", "title": "Loading a file with the LoadFromFile () function with a newline", "body": "<p>I answered this same question on the <a href=\"https://forums.embarcadero.com/thread.jspa?threadID=255416\" rel=\"nofollow noreferrer\">Embarcadero forums</a> earlier today, but I will answer it here, too.</p>\n\n<p><code>plik</code> is a <code>TStringList</code> (according to the other discussion), so its <code>LoadFrom...()</code> method treats bare-CR, bare-LF, and CRLF line breaks equally when the <code>TStrings::LineBreak</code> property matches the RTL's global <code>sLineBreak</code> constant. If the <code>LineBreak</code> property does not match <code>sLineBreak</code>, then <code>TStrings</code> only splits on line breaks that match its <code>LineBreak</code> property.</p>\n\n<p>Since the RTL's <code>sLineBreak</code> constant is CRLF on Windows, and you don't\nwant to split on bare-LF line breaks, you are going to have to parse\nthe file data manually, not use <code>TStrings::LoadFromFile()</code> at all.</p>\n\n<p>For instance, you could read the whole file into a <code>System::String</code> using the <a href=\"http://docwiki.embarcadero.com/Libraries/Tokyo/en/System.Classes.TStreamReader.ReadToEnd\" rel=\"nofollow noreferrer\"><code>System::Classes::TStreamReader::ReadToEnd()</code></a> or <a href=\"http://docwiki.embarcadero.com/Libraries/en/System.IOUtils.TFile.ReadAllText\" rel=\"nofollow noreferrer\"><code>System::Ioutils::TFile::ReadAllText()</code></a> method (<code>TStreamReader</code> and <code>TFile</code> both have methods for reading lines, but they both treat all three forms of line break equally), and then parse that <code>String</code> to extract CRLF-delimited substrings while ignoring any bare-LF characters.</p>\n\n<p>Ideally, you would load a file into a <code>TMemo</code> by using its own <code>LoadFromFile()</code> method.  But, in this situation, that will not work, either, because <code>TMemo</code> normalizes all three forms of line breaks to CRLF before passing the data to the Win32 API, so that is not useful to you.</p>\n"}], "owner": {"reputation": 25, "user_id": 8205149, "user_type": "registered", "profile_image": "https://graph.facebook.com/1824778984505716/picture?type=large", "display_name": "Jacek", "link": "https://stackoverflow.com/users/8205149/jacek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 668, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1504137387, "creation_date": 1504125002, "last_edit_date": 1504126536, "question_id": 45969208, "link": "https://stackoverflow.com/questions/45969208/loading-a-file-with-the-loadfromfile-function-with-a-newline", "title": "Loading a file with the LoadFromFile () function with a newline", "body": "<p>I load the text file <code>.txt</code> using the <code>LoadFromFile()</code> function, and the text in the middle of the line is marked with a newline <code>'\\n'</code>.\nThe <code>LoadFromFile()</code> function treats this character as a new line and divides the line in that place by creating a new line.\nIn the Windows system Note the text looks like this: <code>**Ala has ace**</code>\nThe program that loads this file looks different:</p>\n\n<pre><code>plik-&gt;LoadFromFile( path,  TEncoding::ASCII);\n\nfor( short int i = 0; i &lt; plik-&gt;Count; ++i )\n   Memo1-&gt;Lines-&gt;Add( plik-&gt;Strings[i] );\n</code></pre>\n\n<p>In Memo1 the text looks like this:</p>\n\n<pre><code>**Ala**\n\n**has ace**\n</code></pre>\n\n<p>Can I remove the <code>'\\n'</code> character to make the entire line and how?</p>\n"}, {"tags": ["c++", "arrays", "object", "dynamic", "operator-overloading"], "comments": [{"owner": {"reputation": 2374, "user_id": 8491726, "user_type": "registered", "profile_image": "https://graph.facebook.com/1550562035006492/picture?type=large", "display_name": "Artemy Vysotsky", "link": "https://stackoverflow.com/users/8491726/artemy-vysotsky"}, "edited": false, "score": 3, "creation_date": 1504125012, "post_id": 45969090, "comment_id": 78897649, "body": "use vector instead of raw pointer and you&#39;ll get rid of your problem. Currently you have 2 objects with same pointer."}, {"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 3, "creation_date": 1504125274, "post_id": 45969090, "comment_id": 78897770, "body": "Stop the madness and use <code>std::vector&lt;std::string&gt;</code>."}, {"owner": {"reputation": 135186, "user_id": 464581, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/v2PxU.jpg?s=128&g=1", "display_name": "Cheers and hth. - Alf", "link": "https://stackoverflow.com/users/464581/cheers-and-hth-alf"}, "edited": false, "score": 1, "creation_date": 1504125340, "post_id": 45969090, "comment_id": 78897801, "body": "In case 2 comments already saying so isn&#39;t sufficient, you should use a <code>vector&lt;string&gt;</code>. Not raw arrays and raw pointers and stuff."}, {"owner": {"reputation": 1639, "user_id": 2073349, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0266d3aafa1813f794a5b71058d5cd27?s=128&d=identicon&r=PG", "display_name": "Ritesh", "link": "https://stackoverflow.com/users/2073349/ritesh"}, "edited": false, "score": 0, "creation_date": 1504125380, "post_id": 45969090, "comment_id": 78897822, "body": "this-&gt;classList = student.classList; is wrong. Please create a deep copy of classlist. The problem with current solution is that when you  reset the class, it will free the memory, but the same pointer is being used by another class. That is why you need deep copy. Also the other mistake not related to crash is  that operator= should return ref, i.e student&amp; and not student. But as others mentioned, use vectors"}, {"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 0, "creation_date": 1504125843, "post_id": 45969090, "comment_id": 78898033, "body": "To correct all of the issues with your code, there are major parts missing from your code (such as pointed out by @SamVarshavchik).  IMO it is better to <a href=\"http://coliru.stacked-crooked.com/a/0b1eaa1bfd7c6c52\" rel=\"nofollow noreferrer\">see a small example</a> of these operations and what you are missing.."}], "answers": [{"comments": [{"owner": {"reputation": 9602, "user_id": 7151494, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-a_FzvY-b2O0/AAAAAAAAAAI/AAAAAAAAAEw/kNwilSAvQTI/photo.jpg?sz=128", "display_name": "Fureeish", "link": "https://stackoverflow.com/users/7151494/fureeish"}, "edited": false, "score": 1, "creation_date": 1504125237, "post_id": 45969222, "comment_id": 78897761, "body": "Or simply use what was already implemented - <code>std::vector&lt;std::string&gt;</code> like @ArtemyVysotsky suggested."}, {"owner": {"reputation": 736, "user_id": 5441932, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4acbacc09001d66b0fd772f7d3426617?s=128&d=identicon&r=PG", "display_name": "konsolas", "link": "https://stackoverflow.com/users/5441932/konsolas"}, "reply_to_user": {"reputation": 9602, "user_id": 7151494, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-a_FzvY-b2O0/AAAAAAAAAAI/AAAAAAAAAEw/kNwilSAvQTI/photo.jpg?sz=128", "display_name": "Fureeish", "link": "https://stackoverflow.com/users/7151494/fureeish"}, "edited": false, "score": 1, "creation_date": 1504125437, "post_id": 45969222, "comment_id": 78897840, "body": "That would definitely be the better solution, but I&#39;ll leave this answer here because it explains the problem the OP was having initially."}, {"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 0, "creation_date": 1504126025, "post_id": 45969222, "comment_id": 78898126, "body": "Don&#39;t use <code>memcpy</code> -- it won&#39;t work with <code>std::string</code> as the type."}], "tags": [], "owner": {"reputation": 736, "user_id": 5441932, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4acbacc09001d66b0fd772f7d3426617?s=128&d=identicon&r=PG", "display_name": "konsolas", "link": "https://stackoverflow.com/users/5441932/konsolas"}, "is_accepted": false, "score": 0, "last_activity_date": 1504126100, "last_edit_date": 1504126100, "creation_date": 1504125051, "answer_id": 45969222, "question_id": 45969090, "link": "https://stackoverflow.com/questions/45969090/copying-a-dynamic-array-and-deleting-the-original-using-an-overloaded-operator/45969222#45969222", "title": "Copying a dynamic array and deleting the original using an overloaded operator", "body": "<p>You need to create a copy of the class list, or both student objects will have a field that points to the same location in memory.</p>\n\n<p>Freeing one of these fields will cause the other one to also be freed. </p>\n\n<p>In your copy constructor and assignment operator, <strong>create a new array of the same size for the new object</strong>, and then copy each of the elements to the new object.</p>\n"}, {"tags": [], "owner": {"reputation": 83151, "user_id": 3943312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc00b38b94ca7b6f820622b0a8af8ded?s=128&d=identicon&r=PG", "display_name": "Sam Varshavchik", "link": "https://stackoverflow.com/users/3943312/sam-varshavchik"}, "is_accepted": false, "score": 0, "last_activity_date": 1504125338, "creation_date": 1504125338, "answer_id": 45969291, "question_id": 45969090, "link": "https://stackoverflow.com/questions/45969090/copying-a-dynamic-array-and-deleting-the-original-using-an-overloaded-operator/45969291#45969291", "title": "Copying a dynamic array and deleting the original using an overloaded operator", "body": "<pre><code>Student operator =(Student&amp; student)\n</code></pre>\n\n<p>The assignment operator should take a <code>const</code> reference parameter. The assignment operator should also return a reference, and not a value.</p>\n\n<p>This class is also missing a copy constructor.</p>\n\n<p>In the assignment operator:</p>\n\n<pre><code>this-&gt;classList = student.classList;\n</code></pre>\n\n<p>This is a plain pointer. For starters, this is a memory leak. The previous pointer (if there is one) gets lost, and its allocated memory gets leaked.</p>\n\n<p>Now you have two instances of your class with the same <code>classList</code> pointer. Consequently, when the <code>resetClasses()</code> method gets called on one of those classes, it'll be deleted, and since the other instance of the class has the same pointer, it's now pointing to deleted memory.</p>\n\n<p>Your assignment operator must properly delete the existing array, if there is one, and clone the array held in the instance being assigned from, if there is one. Most of this would also apply to the copy constructor that you must implement.</p>\n\n<p>This class is also missing a destructor, which will cause another memory leak.</p>\n\n<p>You have all of these multiple fundamental problems with your class. You must fix all of them in order for your class to work correctly. You must implement a proper copy constructor, assignment operator, and destructor, that correctly clone, copy, and destroy instances of the data held by your class.</p>\n\n<p>It appears that you haven't yet learned how to use containers and smart pointers, and the point of your excersize if for you to learn how to properly keep track of allocated memory, avoid memory corruption and memory leaks. That is obviously an important skill to learn; but once you've figured all of this out, and your class works correctly, you'll simply replace your pointers by a <code>std::vector</code>, and not worry about it any more.</p>\n"}], "owner": {"reputation": 43, "user_id": 8197013, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/00c69d3de1c435779dad705e46e1c483?s=128&d=identicon&r=PG&f=1", "display_name": "small502", "link": "https://stackoverflow.com/users/8197013/small502"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 218, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1504126100, "creation_date": 1504124581, "question_id": 45969090, "link": "https://stackoverflow.com/questions/45969090/copying-a-dynamic-array-and-deleting-the-original-using-an-overloaded-operator", "title": "Copying a dynamic array and deleting the original using an overloaded operator", "body": "<p>I am creating a class that will keep track of students. In this class, I use an overloaded = to copy these student objects. To track their classes, I use a dynamic array. The array copies just fine; however, when clearing the variables of a student object, any object that had copied from it before also has their array wiped. Here is the code:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;string&gt;\nusing namespace std;\n\nclass Student\n{\n    string name;                //Name\n    string* classList = NULL;   //Empty array to store class names in\n    int numClasses = 0;         //Number of classes\n\npublic:\n    void InputData()\n    {\n        cout &lt;&lt; \"Enter student name: \" &lt;&lt; endl;                         //Input Name\n        cin &gt;&gt; name;\n        cout &lt;&lt; \"Enter number of classes: \" &lt;&lt; endl;                    //Input classes\n        cin &gt;&gt; numClasses;\n\n        classList = new string[numClasses];                             //Define array size\n        for (int i = 0; i &lt; numClasses; i++)                            //For every spot in array, name class\n        {\n            cout &lt;&lt; \"Enter name of class \" &lt;&lt; (i + 1) &lt;&lt; \":\" &lt;&lt; endl;   //Name class\n            cin &gt;&gt; classList[i];\n        }\n\n    };\n\n    void OutputData()\n    {\n        cout &lt;&lt; \"Name: \" &lt;&lt; name &lt;&lt; endl;                               //Output data\n        cout &lt;&lt; \"Number of Classes: \" &lt;&lt; numClasses &lt;&lt; endl;\n        for (int i = 0; i &lt; numClasses; i++)                            //Cycle through and output classes\n        {\n            cout &lt;&lt; \"Class \" &lt;&lt; i &lt;&lt; \": \" &lt;&lt; classList[i] &lt;&lt; endl;\n        }\n    };\n\n    void ResetClasses()\n    {\n        name = \"\";\n        delete[] classList;         //Free Memory\n        classList = NULL;           //Clear array\n        numClasses = 0;\n    };\n\n    Student operator =(Student&amp; student)                //Overload =\n    {\n        this-&gt;name = student.name;\n        this-&gt;classList = student.classList;\n        this-&gt;numClasses = student.numClasses;\n        return *this;\n    };\n};\n\nint main()\n{\n    Student s1, s2;\n\n    s1.InputData();               // Input data for student 1\n    cout &lt;&lt; \"Student 1's data:\" &lt;&lt; endl;\n    s1.OutputData();              // Output data for student 1\n\n    s2 = s1;\n    cout &lt;&lt; \"Student 2's data after assignment from student 1:\" &lt;&lt; endl;\n    s2.OutputData();              // Should output same data as for student 1\n\n    s1.ResetClasses();\n    cout &lt;&lt; \"Student 1's data after reset:\" &lt;&lt; endl;\n    s1.OutputData();              // Should have no classes\n\n    cout &lt;&lt; \"Student 2's data, should still have original classes:\" &lt;&lt; endl;\n    s2.OutputData();              // Should still have original classes\n}\n</code></pre>\n\n<p>The main offenders almost certainly being either of these two</p>\n\n<pre><code>        void ResetClasses()\n        {\n            name = \"\";\n            delete[] classList;         //Free Memory\n            classList = NULL;           //Clear array\n            numClasses = 0;\n        };\n\n        Student operator =(Student&amp; student)                //Overload =\n        {\n            this-&gt;name = student.name;\n            this-&gt;classList = student.classList;\n            this-&gt;numClasses = student.numClasses;\n            return *this;\n        };\n</code></pre>\n\n<p>The output for a program is:</p>\n\n<pre><code>Enter student name:\nERIC\nEnter number of classes:\n2\nEnter name of class 1:\nC++\nEnter name of class 2:\nC\nStudent 1's data:\nName: ERIC\nNumber of Classes: 2\nClass 0: C++\nClass 1: C\nStudent 2's data after assignment from student 1:\nName: ERIC\nNumber of Classes: 2\nClass 0: C++\nClass 1: C\nStudent 1's data after reset:\nName:\nNumber of Classes: 0\nStudent 2's data, should still have original classes:\nName: ERIC\nNumber of Classes: 2\nClass 0:\nClass 1:\n</code></pre>\n\n<p>What could I be doing wrong to cause this?</p>\n"}, {"tags": ["c++", "new-operator", "delete-operator"], "comments": [{"owner": {"reputation": 8856, "user_id": 4442671, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh4.googleusercontent.com/-nSzcZygTwLs/AAAAAAAAAAI/AAAAAAAAADA/virGKG3deIo/photo.jpg?sz=128", "display_name": "Frank", "link": "https://stackoverflow.com/users/4442671/frank"}, "edited": false, "score": 0, "creation_date": 1504125451, "post_id": 45969075, "comment_id": 78897852, "body": "Maybe there are calls to placement-new being performed on your class? Or instances of the class being created on the stack?"}, {"owner": {"reputation": 135186, "user_id": 464581, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/v2PxU.jpg?s=128&g=1", "display_name": "Cheers and hth. - Alf", "link": "https://stackoverflow.com/users/464581/cheers-and-hth-alf"}, "edited": false, "score": 0, "creation_date": 1504125564, "post_id": 45969075, "comment_id": 78897903, "body": "The code that you show for creating an object, is not instantiated with the <code>MemoryPoolObject</code> class. So this <b>is not the real code</b> (or at least it&#39;s not sufficiently complete code). Downvoted."}, {"owner": {"reputation": 135186, "user_id": 464581, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/v2PxU.jpg?s=128&g=1", "display_name": "Cheers and hth. - Alf", "link": "https://stackoverflow.com/users/464581/cheers-and-hth-alf"}, "edited": false, "score": 0, "creation_date": 1504125653, "post_id": 45969075, "comment_id": 78897946, "body": "By the way, a separate <code>initialize</code> member function, two-phase initialization, is an anti-pattern. Use a constructor for initialization."}, {"owner": {"reputation": 187, "user_id": 2566111, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vVh2m.jpg?s=128&g=1", "display_name": "Kevin Dill", "link": "https://stackoverflow.com/users/2566111/kevin-dill"}, "edited": false, "score": 0, "creation_date": 1504125886, "post_id": 45969075, "comment_id": 78898052, "body": "There are no placement news (I wrote all of the code in the library so far - though that will change once we start using it for real).  There are instances of classes being created on the stack, but that doesn&#39;t account for all of them (if it did, you&#39;d see a lot more objects being destructed, since every stack option is guaranteed to destructed).    By setting a flag inside of allocate() and then checking it in objectConstructed, I was able to catch the place where the problem was happening - and I see both my overloaded new both called and not called from the templated instantiate."}, {"owner": {"reputation": 187, "user_id": 2566111, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vVh2m.jpg?s=128&g=1", "display_name": "Kevin Dill", "link": "https://stackoverflow.com/users/2566111/kevin-dill"}, "edited": false, "score": 0, "creation_date": 1504127922, "post_id": 45969075, "comment_id": 78898980, "body": "By the way, that is in fact the real code - though certainly not all of it (I don&#39;t think you want me to dump many thousands of lines of code here... nor would my employer appreciate that :) ).  I&#39;ve tried it two ways.  In one, LoadableObject inherits from MemoryPoolObject.  In the other, ComponentBase inherits from both LoadableObject and MemoryPoolObject."}, {"owner": {"reputation": 15544, "user_id": 1908347, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/e1305fee562b70958e65b557ce049e31?s=128&d=identicon&r=PG", "display_name": "Nir Friedman", "link": "https://stackoverflow.com/users/1908347/nir-friedman"}, "edited": false, "score": 0, "creation_date": 1504129971, "post_id": 45969075, "comment_id": 78899756, "body": "I can&#39;t immediately see what&#39;s wrong with this, but have you considered just avoiding the approach of overloading new? In most cases you&#39;re better off writing a class that meets the c++ allocator concept, and then you can simply use it with any stl container (they&#39;re allocator aware) ,  or with standard smart pointers. And you can write new containers/pointers that are allocator aware."}], "owner": {"reputation": 187, "user_id": 2566111, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vVh2m.jpg?s=128&g=1", "display_name": "Kevin Dill", "link": "https://stackoverflow.com/users/2566111/kevin-dill"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 76, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1504127644, "creation_date": 1504124519, "last_edit_date": 1504127644, "question_id": 45969075, "link": "https://stackoverflow.com/questions/45969075/class-specific-new-and-delete-called-inconsistently", "title": "Class-specific new and delete called inconsistently", "body": "<p>I'm working on implementing memory pools for my project.  The idea is to have any class which inherits from MemoryPoolObject automatically use the memory pools when allocated using new/delete.  The problem is that my overridden new and delete operators are only being called about half the time.  I suspected this early on, so I confirmed this by counting the number of times that the MemoryPoolObject constructor and destructor get called, and comparing that to the number of times that the overloaded new/delete are called.</p>\n\n<p>Here's what the class looks like:</p>\n\n<pre><code>class MemoryPoolObject\n{\npublic:\n    MemoryPoolObject()\n    {\n        // Count the number of times objects are constructed\n        MemoryManager::get().objectConstructed();\n    }\n\n    virtual ~MemoryPoolObject()\n    {\n        // Count the number of times objects are destructed\n        MemoryManager::get().objectDestructed();\n    }\n\n    static void* operator new (size_t s)\n    {\n        // Get memory from the pool, count the number of times called\n        return MemoryManager::get().allocate(s);\n    }\n\n    static void operator delete (void* ptr, size_t s)\n    {\n        // Return memory to the pool, track a bunch of stats\n        MemoryManager::get().deallocate(ptr, s);\n    }\n};\n</code></pre>\n\n<p>Here are the usage stats for the project's unit tests when I make the base class for most of my classes inherit from MemoryPoolObject:</p>\n\n<pre><code>Memory Pool Usage:\n   Object Size | Allocated   | Deallocated | Leaked      | Max Stored  | Storage Capacity\n  -------------+-------------+-------------+-------------+-------------+------------------\n            44 | 1           | 0           | 1           | 0           | 0\n            52 | 15          | 8           | 7           | 1           | 1\n            56 | 9           | 9           | 0           | 2           | 2\n            68 | 6           | 0           | 6           | 0           | 0\n            72 | 24          | 9           | 15          | 1           | 1\n            92 | 25          | 17          | 8           | 1           | 1\n           100 | 1           | 1           | 0           | 1           | 1\n           152 | 88          | 1           | 87          | 1           | 1\n           180 | 29          | 24          | 5           | 1           | 1\n  -------------+-------------+-------------+-------------+-------------+------------------\n       totals: | 198         | 69          | 129         | 8           | 8\n  Total constructed: 422\n  Total destructed: 133\n</code></pre>\n\n<p>As you can see, I'm getting about twice as many calls to the constructor/destructor as I am to the overloaded new/delete operators.</p>\n\n<p>It's also worth mentioning that very nearly all of the allocation is done from the same place:</p>\n\n<pre><code>template &lt;class T&gt;\nT* LoadableObject::instantiate(const CreationData&amp; cd)\n{\n    T* obj = new(T);\n\n    if (!obj-&gt;initialize(cd))\n    {\n        delete(obj);\n        obj = NULL;\n    }\n\n    return obj;\n}\n</code></pre>\n\n<p>By setting a flag inside of allocate() and then checking it in objectConstructed() I was able to catch the place where the problem was happening - and I confirm that calls from here sometimes call the class's new operator and sometimes do not.</p>\n\n<p>To address some of the comments... </p>\n\n<p>There is no placement new in the library at this time.  There are a few cases where objects are created on the stack, but as I said in the previous paragraph, I've been able to confirm it happening from a plain old new.  Also, everything created on the stack is going to have its destructor called - there aren't nearly enough destructor calls.  Also, I've been able to set breakpoints and catch my delete operator not being used from a regular delete call.</p>\n\n<p>This is being used for a large modular AI library (here's an article on modular AI: <a href=\"https://www.msco.mil/DocumentLibrary/Journals/MSJournalFall2013.pdf\" rel=\"nofollow noreferrer\">https://www.msco.mil/DocumentLibrary/Journals/MSJournalFall2013.pdf</a>).  It's hard to show all the detail because there's a lot going on.  However, the basic idea is that you have a bunch of interfaces defining broad types of objects - nodes, considerations, utility values, etc.  Each of these interfaces may have many children, which are constructed using factories.  The factories are templated, and call into the instantiate function that I show above.  </p>\n\n<p>A typical class structures goes something like this.  The root class is MemoryPoolObject.  LoadableObject (which includes the instantiate function) inherits from that.  ComponentBase inherits from LoadableObject.  The interface class (NodeBase, ComponentBase, etc.) inherits from ComponentBase.  The concrete classes inherit from the interface classes.  There are some exceptions that inherit directly from LoadableObject... but this problem persists whether I make MemoryPoolObject a base class for LoadableObject or a multiply-inherited base class for ComponentBase.</p>\n\n<p>Interestingly, there is some indication (possibly false - I'm still debugging) that this might be a cross-project problem.  The unit tests exist in one project, and they load the AI project as a static library.  I'm wondering it the problem is that objects that belong to the unit test project don't call the class-specific new and delete in the AI project, even though they inherit from MemoryPoolObject.  Those objects are also in a different namespace - but I don't see why either of those things should be relevant (at least, in theory).</p>\n\n<p>I may try using a different compiler, and see if that changes the outcome.</p>\n"}, {"tags": ["c++", "bit-manipulation"], "comments": [{"owner": {"reputation": 52685, "user_id": 980550, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/8emhY.jpg?s=128&g=1", "display_name": "lurker", "link": "https://stackoverflow.com/users/980550/lurker"}, "edited": false, "score": 1, "creation_date": 1504124027, "post_id": 45968923, "comment_id": 78897093, "body": "If <code>n &gt; 31</code> why would you set it to 31? I would at least consider &gt; 31 as out of range and not swap anything in that case. Also, you can easily compute <code>mask = (1 &lt;&lt; n) - 1;</code>. You don&#39;t want/need <code>pow</code>."}, {"owner": {"reputation": 6533, "user_id": 1918193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b70a14318e0f417ecac47809f38fafc?s=128&d=identicon&r=PG", "display_name": "Marc Glisse", "link": "https://stackoverflow.com/users/1918193/marc-glisse"}, "edited": false, "score": 5, "creation_date": 1504124047, "post_id": 45968923, "comment_id": 78897103, "body": "pow for integers --&gt; interview fail, next."}, {"owner": {"reputation": 2374, "user_id": 8491726, "user_type": "registered", "profile_image": "https://graph.facebook.com/1550562035006492/picture?type=large", "display_name": "Artemy Vysotsky", "link": "https://stackoverflow.com/users/8491726/artemy-vysotsky"}, "edited": false, "score": 4, "creation_date": 1504124135, "post_id": 45968923, "comment_id": 78897156, "body": "instead of pow(2,n) use 1 &lt;&lt; n, perform bit operations on unsigned int values"}, {"owner": {"reputation": 4376, "user_id": 2850543, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/2bb15c1da6de8180d9adc99954f167f7?s=128&d=identicon&r=PG&f=1", "display_name": "Millie Smith", "link": "https://stackoverflow.com/users/2850543/millie-smith"}, "edited": false, "score": 1, "creation_date": 1504124213, "post_id": 45968923, "comment_id": 78897204, "body": "That&#39;s not an interview fail. Who really cares. One could argue that you should say what you mean. Shifting is not important here."}, {"owner": {"reputation": 6533, "user_id": 1918193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b70a14318e0f417ecac47809f38fafc?s=128&d=identicon&r=PG", "display_name": "Marc Glisse", "link": "https://stackoverflow.com/users/1918193/marc-glisse"}, "edited": false, "score": 0, "creation_date": 1504124381, "post_id": 45968923, "comment_id": 78897301, "body": "Depends who is interviewing for what job, but it can be taken as a pretty bad sign. Anyway, there are too many bit operations in what the OP is proposing."}, {"owner": {"reputation": 8856, "user_id": 4442671, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh4.googleusercontent.com/-nSzcZygTwLs/AAAAAAAAAAI/AAAAAAAAADA/virGKG3deIo/photo.jpg?sz=128", "display_name": "Frank", "link": "https://stackoverflow.com/users/4442671/frank"}, "edited": false, "score": 0, "creation_date": 1504125087, "post_id": 45968923, "comment_id": 78897691, "body": "You assume <code>sizeof(int) == 4</code> and <code>CHAR_BIT == 8</code>. Neither are guaranteed."}, {"owner": {"reputation": 159118, "user_id": 15416, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/a2b11b9662b5155aada74191fbe7cb9e?s=128&d=identicon&r=PG", "display_name": "MSalters", "link": "https://stackoverflow.com/users/15416/msalters"}, "reply_to_user": {"reputation": 8856, "user_id": 4442671, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh4.googleusercontent.com/-nSzcZygTwLs/AAAAAAAAAAI/AAAAAAAAADA/virGKG3deIo/photo.jpg?sz=128", "display_name": "Frank", "link": "https://stackoverflow.com/users/4442671/frank"}, "edited": false, "score": 0, "creation_date": 1504125247, "post_id": 45968923, "comment_id": 78897765, "body": "@Frank: Merely that <code>sizeof(int)*CHAR*BIT==32</code>. There are two other ways in which that can be achieved."}, {"owner": {"reputation": 159118, "user_id": 15416, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/a2b11b9662b5155aada74191fbe7cb9e?s=128&d=identicon&r=PG", "display_name": "MSalters", "link": "https://stackoverflow.com/users/15416/msalters"}, "edited": false, "score": 2, "creation_date": 1504125486, "post_id": 45968923, "comment_id": 78897870, "body": "@Ron: I tend to start with one such question. If you made it to the interview, this should be easy. And even if you&#39;re a bit junior, it should help with the nerves. I don&#39;t <i>really</i> care about the answer; it&#39;s more a way for me to judge what to ask next."}, {"owner": {"reputation": 8856, "user_id": 4442671, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh4.googleusercontent.com/-nSzcZygTwLs/AAAAAAAAAAI/AAAAAAAAADA/virGKG3deIo/photo.jpg?sz=128", "display_name": "Frank", "link": "https://stackoverflow.com/users/4442671/frank"}, "edited": false, "score": 1, "creation_date": 1504126064, "post_id": 45968923, "comment_id": 78898140, "body": "Also, I personally would never pull out a cutesy XOR trick in an interview context. Iit reeks of memorization, instead of problem solving, and is something I use so rarely I would be worried of getting it wrong. I would have just done a regular swap with a <code>temp</code> variable, and mentioned a XOR trick as an alternative."}], "answers": [{"comments": [{"owner": {"reputation": 8856, "user_id": 4442671, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh4.googleusercontent.com/-nSzcZygTwLs/AAAAAAAAAAI/AAAAAAAAADA/virGKG3deIo/photo.jpg?sz=128", "display_name": "Frank", "link": "https://stackoverflow.com/users/4442671/frank"}, "edited": false, "score": 0, "creation_date": 1504126369, "post_id": 45969456, "comment_id": 78898292, "body": "by &quot;false dependency chains&quot;, you mean Load-Hit-Store, right?"}, {"owner": {"reputation": 617, "user_id": 8334739, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da68d0fab50ac2fe0a3ed321d3161a03?s=128&d=identicon&r=PG&f=1", "display_name": "claytonjwong", "link": "https://stackoverflow.com/users/8334739/claytonjwong"}, "edited": false, "score": 0, "creation_date": 1504126777, "post_id": 45969456, "comment_id": 78898489, "body": "Thanks MSalters, this looks like a better solution!"}, {"owner": {"reputation": 159118, "user_id": 15416, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/a2b11b9662b5155aada74191fbe7cb9e?s=128&d=identicon&r=PG", "display_name": "MSalters", "link": "https://stackoverflow.com/users/15416/msalters"}, "reply_to_user": {"reputation": 8856, "user_id": 4442671, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh4.googleusercontent.com/-nSzcZygTwLs/AAAAAAAAAAI/AAAAAAAAADA/virGKG3deIo/photo.jpg?sz=128", "display_name": "Frank", "link": "https://stackoverflow.com/users/4442671/frank"}, "edited": false, "score": 1, "creation_date": 1504127085, "post_id": 45969456, "comment_id": 78898610, "body": "@Frank: No, that&#39;s when a single value gets moved back and forth from memory. Modern CPU&#39;s try to execute N instructions in parallel, and that&#39;s only possible if the N&#39;th instruction doesn&#39;t depend on the previous N-1 instructions. That&#39;s why a CPU dynamically figures out dependency relations, and these can be chained. The &quot;classical XOR swap&quot; suffers from the problem that the final A value depends on both A and B because they are XOR&#39;ed together, and so does B, which means that the first XOR has to finish before the next operation starts."}, {"owner": {"reputation": 8856, "user_id": 4442671, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh4.googleusercontent.com/-nSzcZygTwLs/AAAAAAAAAAI/AAAAAAAAADA/virGKG3deIo/photo.jpg?sz=128", "display_name": "Frank", "link": "https://stackoverflow.com/users/4442671/frank"}, "edited": false, "score": 0, "creation_date": 1504128881, "post_id": 45969456, "comment_id": 78899353, "body": "@MSalters That was my concern. The removal of OP&#39;s LHS makes a much larger impact than freeing up OOO execution (probably around 10 times more depending on the CPU pipeline)."}, {"owner": {"reputation": 159118, "user_id": 15416, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/a2b11b9662b5155aada74191fbe7cb9e?s=128&d=identicon&r=PG", "display_name": "MSalters", "link": "https://stackoverflow.com/users/15416/msalters"}, "reply_to_user": {"reputation": 8856, "user_id": 4442671, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh4.googleusercontent.com/-nSzcZygTwLs/AAAAAAAAAAI/AAAAAAAAADA/virGKG3deIo/photo.jpg?sz=128", "display_name": "Frank", "link": "https://stackoverflow.com/users/4442671/frank"}, "edited": false, "score": 0, "creation_date": 1504129122, "post_id": 45969456, "comment_id": 78899438, "body": "@Frank: Well, they tie together. OOOE also allows you to start a new instruction while waiting for a load instruction. In my example, <code>a^b</code> can start immediately. It may take a while before <code>a^b</code> finishes, but when it does the mask is available."}], "tags": [], "owner": {"reputation": 159118, "user_id": 15416, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/a2b11b9662b5155aada74191fbe7cb9e?s=128&d=identicon&r=PG", "display_name": "MSalters", "link": "https://stackoverflow.com/users/15416/msalters"}, "is_accepted": false, "score": 6, "last_activity_date": 1504126105, "creation_date": 1504126105, "answer_id": 45969456, "question_id": 45968923, "link": "https://stackoverflow.com/questions/45968923/swap-right-most-n-bits-between-two-integers/45969456#45969456", "title": "Swap right-most N bits between two integers", "body": "<p>I think the intended trick here is </p>\n\n<pre><code>void SwapRightMostNBits(unsigned int&amp; a, unsigned int&amp; b, unsigned int n){\n\n    unsigned int mask=(1U&lt;&lt;n) -1;\n    unsigned int diff = (a^b) &amp; mask;\n\n    a ^= diff;\n    b ^= diff;\n}\n</code></pre>\n\n<p>Note that this uses 3 XOR's, like your solution, but only one masking operation.  Plus, this is way friendlier on the CPU registers. There are no false dependency chains. And finally, it works if <code>&amp;a==&amp;b</code>.</p>\n"}], "owner": {"reputation": 617, "user_id": 8334739, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da68d0fab50ac2fe0a3ed321d3161a03?s=128&d=identicon&r=PG&f=1", "display_name": "claytonjwong", "link": "https://stackoverflow.com/users/8334739/claytonjwong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1504126105, "creation_date": 1504123874, "last_edit_date": 1504125695, "question_id": 45968923, "link": "https://stackoverflow.com/questions/45968923/swap-right-most-n-bits-between-two-integers", "title": "Swap right-most N bits between two integers", "body": "<p>This question was asked during an onsite C++ coding interview.  I did NOT provide a good answer during that interview.  So I was hoping to get feedback and suggestions from folks here at stack overflow.  Now that I've had some more time to come up with a solution, I believe that I wrote a decent solution. I think this works OK as along as <code>a</code> and <code>b</code> refer to different integers.  If <code>a</code> and <code>b</code> refer to the same integer, then that integer would be be clobbered to 0. </p>\n\n<pre><code>void SwapRightMostNBits(int&amp; a, int&amp; b, unsigned int n){\n\n    if (n&gt;31) { n=31; }\n    int mask=static_cast&lt;int&gt;(pow(2,n)-1);\n\n    a ^= (b &amp; mask);\n    b ^= (a &amp; mask);\n    a ^= (b &amp; mask);\n}\n</code></pre>\n"}, {"tags": ["c++", "windows", "qt", "desktop"], "comments": [{"owner": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 0, "creation_date": 1504123918, "post_id": 45968724, "comment_id": 78897040, "body": "If you want to disable keys globally then qt will be hardly of any help. You&#39;ll need to dig into keyboard hooks and related low-level stuff."}, {"owner": {"reputation": 50126, "user_id": 1717300, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/81b91f602ce8acea8cbeb29f62725627?s=128&d=identicon&r=PG", "display_name": "hyde", "link": "https://stackoverflow.com/users/1717300/hyde"}, "edited": false, "score": 0, "creation_date": 1504125188, "post_id": 45968724, "comment_id": 78897737, "body": "Also, latest Windows is pretty restrictive about what applications can do. You&#39;d probably have to request admin privileges from the user, if you wanted to mess with something like print screen key. Not sure, it <i>could</i> also be that an application can disable it, but my guess is, no."}, {"owner": {"reputation": 135186, "user_id": 464581, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/v2PxU.jpg?s=128&g=1", "display_name": "Cheers and hth. - Alf", "link": "https://stackoverflow.com/users/464581/cheers-and-hth-alf"}, "edited": false, "score": 0, "creation_date": 1504126052, "post_id": 45968724, "comment_id": 78898135, "body": "Why do you want to do that?"}, {"owner": {"reputation": 5548, "user_id": 5068056, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/m53CE.jpg?s=128&g=1", "display_name": "Farhad", "link": "https://stackoverflow.com/users/5068056/farhad"}, "edited": false, "score": 0, "creation_date": 1504127865, "post_id": 45968724, "comment_id": 78898946, "body": "I think you can do it but it need to restart OS. i will put it as answer if it&#39;s  good enough for you?"}, {"owner": {"reputation": 7956, "user_id": 1518921, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/BOzy5.png?s=128&g=1", "display_name": "Guilherme Nascimento", "link": "https://stackoverflow.com/users/1518921/guilherme-nascimento"}, "edited": false, "score": 0, "creation_date": 1504128130, "post_id": 45968724, "comment_id": 78899081, "body": "@Alf To make it difficult to get print out of the application screen, I know I can not completely stop it, but I would like to make it difficult.  I can intercept the &quot;print&quot; key when the application window is in focus, but if I click on the &quot;taskbar&quot; and hit the &quot;print&quot; event does not occur, so I wanted to block globally while the application is open."}], "answers": [{"comments": [{"owner": {"reputation": 7956, "user_id": 1518921, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/BOzy5.png?s=128&g=1", "display_name": "Guilherme Nascimento", "link": "https://stackoverflow.com/users/1518921/guilherme-nascimento"}, "edited": false, "score": 0, "creation_date": 1504299333, "post_id": 45970104, "comment_id": 78976671, "body": "Mike, your example work fine in MSVC and Mingw, THANKS!! I will send a bounty for you. :D (after 23 hours)"}, {"owner": {"reputation": 7644, "user_id": 3648361, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Y1aeF.jpg?s=128&g=1", "display_name": "Vasily Ryabov", "link": "https://stackoverflow.com/users/3648361/vasily-ryabov"}, "edited": false, "score": 0, "creation_date": 1504551895, "post_id": 45970104, "comment_id": 79045837, "body": "One more thing can workaround this defense. If someone sets another keyboard hook getting the screenshot, it may have called before your hook. Even more simple way is to use any screen capture tool without printscreen key usage. I think you can&#39;t prohibit screen capturing at all."}, {"owner": {"reputation": 7180, "user_id": 2666212, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/874561e399041a45c82c2ca6652400b6?s=128&d=identicon&r=PG", "display_name": "Mike", "link": "https://stackoverflow.com/users/2666212/mike"}, "reply_to_user": {"reputation": 7644, "user_id": 3648361, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Y1aeF.jpg?s=128&g=1", "display_name": "Vasily Ryabov", "link": "https://stackoverflow.com/users/3648361/vasily-ryabov"}, "edited": false, "score": 0, "creation_date": 1504555020, "post_id": 45970104, "comment_id": 79046896, "body": "@VasilyRyabov , you&#39;re right with that. I don&#39;t think that there is a way to prohibit that completely. After all, there is nothing that can stop the user from directing  the screen output to any other device where they can capture a photo of it, and that would render any time you invest implementing a video driver that disables screen capturing at the system level utterly useless. Any approach you follow to implement such a feature should just aim to make it somehow hard for the user to capture the screen, installing a hook to disable the snapshot button is such an approach. . ."}, {"owner": {"reputation": 7180, "user_id": 2666212, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/874561e399041a45c82c2ca6652400b6?s=128&d=identicon&r=PG", "display_name": "Mike", "link": "https://stackoverflow.com/users/2666212/mike"}, "edited": false, "score": 1, "creation_date": 1504555176, "post_id": 45970104, "comment_id": 79046950, "body": "Although, I completely admit that one can use the <i>Snipping Tool</i> to bypass this approach completely (as mentioned in my answer). But I wanted to focus on the question scope, that is, <i>disable keys in windows globally</i>"}, {"owner": {"reputation": 7644, "user_id": 3648361, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Y1aeF.jpg?s=128&g=1", "display_name": "Vasily Ryabov", "link": "https://stackoverflow.com/users/3648361/vasily-ryabov"}, "edited": false, "score": 1, "creation_date": 1504599468, "post_id": 45970104, "comment_id": 79059674, "body": "No problem. The answer is good (+my upvote). Low-level global hooks are extremely useful for other purposes also. For example, it can help to record all user actions for generating GUI automation scripts though there are many more pitfalls except hooks."}], "tags": [], "owner": {"reputation": 7180, "user_id": 2666212, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/874561e399041a45c82c2ca6652400b6?s=128&d=identicon&r=PG", "display_name": "Mike", "link": "https://stackoverflow.com/users/2666212/mike"}, "is_accepted": true, "score": 4, "last_activity_date": 1504156671, "last_edit_date": 1504156671, "creation_date": 1504129217, "answer_id": 45970104, "question_id": 45968724, "link": "https://stackoverflow.com/questions/45968724/how-to-disable-keys-in-windows-globally-using-qt/45970104#45970104", "title": "How to disable keys in windows (globally) using Qt?", "body": "<p>You can install a <a href=\"https://msdn.microsoft.com/en-us/library/ms644985(v=vs.85).aspx\" rel=\"nofollow noreferrer\">low-level keyboard hook</a> to intercept and block all <kbd>Print Screen</kbd> presses. The following is tested on my windows 7 machine.</p>\n\n<p>Here is a minimal example that shows how to do this:</p>\n\n<p><a href=\"https://i.stack.imgur.com/P6aUc.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/P6aUc.png\" alt=\"ScreenShot\"></a></p>\n\n<pre><code>#include &lt;QtWidgets&gt;\n#include &lt;windows.h&gt;\n//link against user32.lib when compiling in MSVC\n#ifdef _MSC_VER\n#pragma comment(lib, \"User32.lib\")\n#endif\n\nclass GlobalPrintScreenBlocker {\npublic:\n    GlobalPrintScreenBlocker():mHKeyboardHook(NULL) {}\n    //to avoid leaking the hook procedure handle\n    ~GlobalPrintScreenBlocker(){ unblock(); }\n    //hook callback function (called on every system-wide key press)\n    static LRESULT CALLBACK LowLevelKeyboardProc(int nCode,\n                                                 WPARAM wParam, LPARAM lParam) {\n        if(nCode == HC_ACTION) {\n            PKBDLLHOOKSTRUCT p = reinterpret_cast&lt;PKBDLLHOOKSTRUCT&gt;(lParam);\n            if(p-&gt;vkCode == VK_SNAPSHOT) return 1; //block print-screen key\n        }\n        //this is not a message we are interested in\n        return CallNextHookEx(NULL, //ignored paramater\n                              nCode,\n                              wParam,\n                              lParam);\n    }\n    void block(){\n        mHKeyboardHook = SetWindowsHookEx(WH_KEYBOARD_LL, //low-level keyboard hool\n                                          &amp;LowLevelKeyboardProc, //callback\n                                          GetModuleHandle(NULL), \n                                          0);\n    }\n    void unblock(){\n        if(mHKeyboardHook) UnhookWindowsHookEx(mHKeyboardHook);\n        mHKeyboardHook = NULL;\n    }\n\nprivate:\n    HHOOK mHKeyboardHook;\n};\n\nint main(int argc, char* argv[]) {\n    QApplication a(argc, argv);\n\n    GlobalPrintScreenBlocker blocker;\n    QPushButton button(\"Disable ScreenShot\");\n    button.setCheckable(true);\n    QObject::connect(&amp;button, &amp;QPushButton::toggled, [&amp;](bool isChecked){\n        if(isChecked)\n            blocker.block();\n        else\n            blocker.unblock();\n    });\n    button.show();\n\n    return a.exec();\n}\n</code></pre>\n\n<p>The hook gets called in the thread that installed it. This has the advantages of not having to worry about thread-safety issues in your callback function, and that there would be no difference between 32-bit processes and 64-bit processes (all processes will end up calling the hook function indirectly by posting a message to the event loop of the thread that installed the hook). However, this also has the disadvantage that if your thread was busy (executing anything else) the callback hook might not get called:</p>\n\n<blockquote>\n  <p>The hook procedure should process a message in less time than the data entry specified in the LowLevelHooksTimeout value ... The value is in milliseconds. If the hook procedure times out, the system passes the message to the next hook. However, on Windows 7 and later, the hook is silently removed without being called. There is no way for the application to know whether the hook is removed.</p>\n</blockquote>\n\n<p>You can get around this limitation by allocating a separate thread for installing/executing the hook. Also, note that your hook's callback function should be as minimum as possible in order for it to be able to finish within the time constraints.</p>\n\n<p>P.S.: I had to use the snipping tool to create the screen shot above. . .</p>\n"}], "owner": {"reputation": 7956, "user_id": 1518921, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/BOzy5.png?s=128&g=1", "display_name": "Guilherme Nascimento", "link": "https://stackoverflow.com/users/1518921/guilherme-nascimento"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 915, "favorite_count": 0, "accepted_answer_id": 45970104, "answer_count": 1, "score": 3, "last_activity_date": 1504299457, "creation_date": 1504122969, "question_id": 45968724, "link": "https://stackoverflow.com/questions/45968724/how-to-disable-keys-in-windows-globally-using-qt", "title": "How to disable keys in windows (globally) using Qt?", "body": "<p>Is it possible to disable or block a key such as the <kbd>Print Screen</kbd> key?</p>\n\n<p>my event filter:</p>\n\n<pre><code>bool EventFilter::eventFilter(QObject *object, QEvent *event)\n{\n    qDebug() &lt;&lt; \"object:\" &lt;&lt; object &lt;&lt; \"type:\" &lt;&lt; event-&gt;type();\n    return false;\n}\n</code></pre>\n\n<p>I tried use in <code>qApp</code>:</p>\n\n<pre><code>ui-&gt;setupUi(this);\n\nEventFilter *evt = new EventFilter;\n\nqApp-&gt;installEventFilter(evt);\n</code></pre>\n\n<p>But return only events from application widgets:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>object: QWidgetWindow(0x175bae50, name = \"QWidgetClassWindow\") type: QEvent::Type(PlatformSurface)\nobject: QWidget(0x175b02c0) type: QEvent::Type(PlatformSurface)\nobject: QWidget(0x175b02c0) type: QEvent::Type(WinIdChange)\nobject: QWidget(0x175b02c0) type: QEvent::Type(Create)\n...\n</code></pre>\n\n<p>And:</p>\n\n<pre><code>ui-&gt;setupUi(this);\n\nEventFilter *evt = new EventFilter;\n\nQDesktopWidget *c = new QDesktopWidget;\nc-&gt;installEventFilter(evt);\n</code></pre>\n\n<p>But return only 2 events:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>object: QDesktopWidget(0x174e0260, name = \"desktop\") type: QEvent::Type(PolishRequest)\nobject: QDesktopWidget(0x174e0260, name = \"desktop\") type: QEvent::Type(Polish)\n</code></pre>\n\n<p>Can not intercept and / or block events? Thanks</p>\n"}, {"tags": ["c++", "c-strings", "fortify", "strlen", "dword"], "comments": [{"owner": {"reputation": 44802, "user_id": 2752075, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5oQlf.png?s=128&g=1", "display_name": "HolyBlackCat", "link": "https://stackoverflow.com/users/2752075/holyblackcat"}, "edited": false, "score": 0, "creation_date": 1504123498, "post_id": 45968559, "comment_id": 78896843, "body": "You should add C++ tag. I doubt the question will get any attention otherwise."}, {"owner": {"reputation": 82430, "user_id": 17833, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ExIEf.png?s=128&g=1", "display_name": "Petesh", "link": "https://stackoverflow.com/users/17833/petesh"}, "edited": false, "score": 0, "creation_date": 1504126351, "post_id": 45968559, "comment_id": 78898284, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/45750207/warning-c4267-argument-conversion-from-size-t-to-dword-possible-loss-of\">Warning C4267 &#39;argument&#39;: conversion from &#39;size_t&#39; to &#39;DWORD&#39;, possible loss of data</a>"}, {"owner": {"reputation": 82430, "user_id": 17833, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ExIEf.png?s=128&g=1", "display_name": "Petesh", "link": "https://stackoverflow.com/users/17833/petesh"}, "edited": false, "score": 1, "creation_date": 1504126431, "post_id": 45968559, "comment_id": 78898315, "body": "The issue is that DWORD is 32bits in size, while size_t is probably 64bits."}, {"owner": {"reputation": 6440, "user_id": 27302, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0ee0b2f006682f28d5a6ba5634ade513?s=128&d=identicon&r=PG", "display_name": "Daniel H", "link": "https://stackoverflow.com/users/27302/daniel-h"}, "edited": false, "score": 0, "creation_date": 1504127916, "post_id": 45968559, "comment_id": 78898974, "body": "You said elsewhere that if you used <code>inputString.GetLength()</code> you got an error in HP-Fortify, and that some later points required a <code>DWORD</code> instead of a <code>size_t</code>. You should add those details to the question."}, {"owner": {"reputation": 11, "user_id": 2769790, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/47767c8c80dcbe6499d13945edf69f47?s=128&d=identicon&r=PG&f=1", "display_name": "user2769790", "link": "https://stackoverflow.com/users/2769790/user2769790"}, "edited": false, "score": 0, "creation_date": 1504132081, "post_id": 45968559, "comment_id": 78900430, "body": "&quot;required a DWORD instead of a size_t&quot; This was for blockLength which is passed as a parameter to someMethod() mentioned above."}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1504132264, "post_id": 45968559, "comment_id": 78900477, "body": "I would recommend against code like <code>(LPCSTR)sourceVar</code>.  If <code>sourceVar</code> happens to have a user-defined conversion operator to <code>LPCSTR</code> then the code will work; but if it doesn&#39;t then you get no compilation error and undefined behaviour at runtime.  You could use <code>static_cast&lt;LPCSTR&gt;(sourceVar)</code>, or preferably, directly invoke a method on <code>sourceVar</code> that returns the desired pointer."}, {"owner": {"reputation": 6440, "user_id": 27302, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0ee0b2f006682f28d5a6ba5634ade513?s=128&d=identicon&r=PG", "display_name": "Daniel H", "link": "https://stackoverflow.com/users/27302/daniel-h"}, "reply_to_user": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1504133133, "post_id": 45968559, "comment_id": 78900713, "body": "@M.M I\u2019m not a Windows C++ programmer so I\u2019m not sure, but I <i>think</i> that <code>(LPCSTR)sourceVar</code> is the way Microsoft recommends. In any case, yes, <code>CString</code> does have that conversion operator."}, {"owner": {"reputation": 11, "user_id": 2769790, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/47767c8c80dcbe6499d13945edf69f47?s=128&d=identicon&r=PG&f=1", "display_name": "user2769790", "link": "https://stackoverflow.com/users/2769790/user2769790"}, "reply_to_user": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1504141769, "post_id": 45968559, "comment_id": 78902478, "body": "@M.M: When I tried &quot;sprintf_s(reinterpret_cast&lt;char*&gt;(defaultBuffer), (blockLength + 1), &quot;%s&quot;, static_cast&lt;LPCSTR&gt;(sourceVar)); &quot;, I&#39;m still seeing the Fortify error. No build errors though."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 2769790, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/47767c8c80dcbe6499d13945edf69f47?s=128&d=identicon&r=PG&f=1", "display_name": "user2769790", "link": "https://stackoverflow.com/users/2769790/user2769790"}, "edited": false, "score": 0, "creation_date": 1504127568, "post_id": 45969521, "comment_id": 78898805, "body": "&quot;Why you only get it in release mode - no idea&quot; - Didn&#39;t get your point. will using       blockLength = int((LPCSTR)sourceVar);   be a better idea?"}], "tags": [], "owner": {"reputation": 891, "user_id": 1257487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e5XCW.jpg?s=128&g=1", "display_name": "Anonymouse", "link": "https://stackoverflow.com/users/1257487/anonymouse"}, "is_accepted": false, "score": 1, "last_activity_date": 1504126385, "creation_date": 1504126385, "answer_id": 45969521, "question_id": 45968559, "link": "https://stackoverflow.com/questions/45968559/warning-conversion-from-size-t-to-dword-possible-loss-of-data/45969521#45969521", "title": "Warning - Conversion from size_t to DWORD, possible loss of data", "body": "<p>In 64-bit mode a size_t will be 64-bits, but a DWORD will always be 32-bit... \nSo assigning a 64-bits value to 32 bits value looses the top 32-bits of the size_t, hence the warning.</p>\n\n<p>Why you only get it in release mode - no idea.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 2769790, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/47767c8c80dcbe6499d13945edf69f47?s=128&d=identicon&r=PG&f=1", "display_name": "user2769790", "link": "https://stackoverflow.com/users/2769790/user2769790"}, "is_accepted": false, "score": 0, "last_activity_date": 1504207122, "creation_date": 1504207122, "answer_id": 45988642, "question_id": 45968559, "link": "https://stackoverflow.com/questions/45968559/warning-conversion-from-size-t-to-dword-possible-loss-of-data/45988642#45988642", "title": "Warning - Conversion from size_t to DWORD, possible loss of data", "body": "<pre><code>blockLength = static_cast&lt;int&gt;(strlen((LPCSTR)sourceVar));\n</code></pre>\n\n<p>Using static_cast fixed the issue. There are no errors in HP Fortify and no warnings while building. </p>\n"}], "owner": {"reputation": 11, "user_id": 2769790, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/47767c8c80dcbe6499d13945edf69f47?s=128&d=identicon&r=PG&f=1", "display_name": "user2769790", "link": "https://stackoverflow.com/users/2769790/user2769790"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 993, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1504207122, "creation_date": 1504122290, "last_edit_date": 1504131846, "question_id": 45968559, "link": "https://stackoverflow.com/questions/45968559/warning-conversion-from-size-t-to-dword-possible-loss-of-data", "title": "Warning - Conversion from size_t to DWORD, possible loss of data", "body": "<p>I'm building a 64bit C++ code on VS 2015.</p>\n\n<pre><code>DWORD blockLength;\nblockLength = strlen((LPCSTR)sourceVar);    // sourceVar is of type Cstring, build warning here. \n\n// Allocate memory.\ndefaultBuffer = new unsigned char[blockLength + 1];\n\nsprintf_s(reinterpret_cast&lt;char*&gt;(defaultBuffer), (blockLength + 1), \"%s\", (LPCSTR)sourceVar); \n\n// Decrypt data\nif (!someMethod(someParameter, 0, 1, 0, defaultBuffer, &amp;blockLength))\n{\n// Do something\n}\n</code></pre>\n\n<p>When I run the code from HP-fortify, I don't see any build warnings or any fortify issues. </p>\n\n<p>However, when I build the code separately, I see this <strong>warning</strong> on 2nd line -</p>\n\n<pre><code>warning C4267: '=': conversion from 'size_t' to 'DWORD', possible loss of data\n</code></pre>\n\n<p>Now, <strong>when I make these code changes</strong> - </p>\n\n<pre><code>blockLength = sourceVar.GetLength();\n</code></pre>\n\n<p>The build warning is gone. However, when I run this new code against <strong>HP-Fortify</strong>, I now see following error at sprintf_s line - </p>\n\n<p>Buffer Overflow\n(Input Validation and Representation, Data Flow)  - \nThe function writes outside the bounds of allocated memory, which could corrupt data, cause the program to crash, or lead to the execution of malicious code.</p>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 1, "creation_date": 1504121875, "post_id": 45968246, "comment_id": 78896051, "body": "Do note that your first example only works if the function is not overloaded"}], "answers": [{"tags": [], "owner": {"reputation": 85822, "user_id": 597607, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jCzJi.png?s=128&g=1", "display_name": "Bo Persson", "link": "https://stackoverflow.com/users/597607/bo-persson"}, "is_accepted": false, "score": 3, "last_activity_date": 1504121588, "creation_date": 1504121588, "answer_id": 45968396, "question_id": 45968246, "link": "https://stackoverflow.com/questions/45968246/c-assign-function-in-order-to-re-export-it-as-extern-c/45968396#45968396", "title": "C++ assign function in order to re-export it as extern &quot;C&quot;", "body": "<p>The first version doesn't really copy a function (you can't do that), but rather creates a <em>pointer</em> to the function. </p>\n\n<p>That might perhaps work if the compiler uses the same calling conventions for C and C++ functions. It might fail to compile otherwise, I don't know.</p>\n\n<p>Anyway, I would use the second version as that is the intended way to create wrapper functions, and will be more portable. By \"repacking\" the parameters in the <code>extern \"C\"</code> function we know that they are passed correctly.</p>\n"}, {"tags": [], "owner": {"reputation": 68702, "user_id": 1593860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1361e47a8bf06d20ffda9a686ceb7e68?s=128&d=identicon&r=PG", "display_name": "Pete Becker", "link": "https://stackoverflow.com/users/1593860/pete-becker"}, "is_accepted": true, "score": 5, "last_activity_date": 1504121904, "creation_date": 1504121904, "answer_id": 45968482, "question_id": 45968246, "link": "https://stackoverflow.com/questions/45968246/c-assign-function-in-order-to-re-export-it-as-extern-c/45968482#45968482", "title": "C++ assign function in order to re-export it as extern &quot;C&quot;", "body": "<p>No, this won't, in general, work. Functions with C linkage and functions with C++ linkage have different types, even if they take the same argument types and return the same type. So that function-pointer assignment is not legal. Most compilers don't enforce this, however, so you might get away with it. Of course, as soon as you upgrade to a compiler that enforces the correct semantics here your code will break.</p>\n\n<p>Many people misunderstand the difference between C and C++ linkage, and think that it's just a matter of name mangling. But it's more than that. For example, the compiler can use different calling conventions for the two different linkages, and in that case, there's no way you could use a pointer to a C++ function in C code. <code>extern \"C\"</code> tells the compiler to <strong>compile</strong> the function so that it can be called from C.</p>\n"}], "owner": {"reputation": 5900, "user_id": 931154, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/bTrZd.jpg?s=128&g=1", "display_name": "Gregory Nisbet", "link": "https://stackoverflow.com/users/931154/gregory-nisbet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 197, "favorite_count": 0, "accepted_answer_id": 45968482, "answer_count": 2, "score": 3, "last_activity_date": 1504121904, "creation_date": 1504120894, "question_id": 45968246, "link": "https://stackoverflow.com/questions/45968246/c-assign-function-in-order-to-re-export-it-as-extern-c", "title": "C++ assign function in order to re-export it as extern &quot;C&quot;", "body": "<p>Is it possible to export a C++ function with a C-compatible type (in this case <code>(int, int) -&gt; int</code>) as a C symbol just by assigning it? Are there any hidden gotchas you have to watch out for?</p>\n\n<hr>\n\n<p>The following code compiles without warnings and the resulting file has two symbols exposed.</p>\n\n<p>I was surprised that it compiles at all, since I'm not sure what it means to copy a function.</p>\n\n<pre><code>namespace simplemath {\n  int add(int x, int y) {\n    return x + y;\n  }\n}\n\nextern \"C\" auto add = simplemath::add;\n</code></pre>\n\n<hr>\n\n<pre><code>$ clang++ -Wall -Werror -pedantic --std=c++11 -c example.cc\n$ nm example.o\n0000000000000000 T __ZN10simplemath3addEii\n0000000000000018 D _add\n</code></pre>\n\n<hr>\n\n<p>Is the code above equivalent to the following (up to whether or not <code>simplemath::add</code> is inlined)?</p>\n\n<pre><code>extern \"C\" int add(int x, int y) {\n  return simplemath::add(x, y);\n}\n\nnamespace simplemath {\n  int add(int x, int y) {\n    return x + y;\n  }\n}\n</code></pre>\n\n<p>You get</p>\n\n<pre><code>$ clang++ -Wall -Werror -pedantic -c example.cc\n$ nm example.o\n0000000000000020 T __ZN10simplemath3addEii\n0000000000000000 T _add\n</code></pre>\n"}, {"tags": ["c++", "visual-c++", "visual-studio-2015", "multiple-inheritance"], "comments": [{"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 3, "creation_date": 1504120515, "post_id": 45968132, "comment_id": 78895350, "body": "You don&#39;t say what it should be doing when its working."}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1504120558, "post_id": 45968132, "comment_id": 78895366, "body": "what do you want to achieve? The snippet is broken so there is no way &quot;to make it work&quot; when you dont say what it is supposed to do"}, {"owner": {"reputation": 4326, "user_id": 242348, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/cc86e1f443171a35a1c7dcf2c688f24c?s=128&d=identicon&r=PG", "display_name": "monoceres", "link": "https://stackoverflow.com/users/242348/monoceres"}, "edited": false, "score": 0, "creation_date": 1504120675, "post_id": 45968132, "comment_id": 78895421, "body": "Sorry, I added an edit to clarify. The error is that &#39;Pig&#39; is abstract when I would assume that the abstract method would be implemented by the DefaultSqueel base class. I wonder why that is and how I can fix it."}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1504120803, "post_id": 45968132, "comment_id": 78895487, "body": "is it on purpose that <code>squeale()</code> is private in <code>DefaultSqueel</code> ?"}, {"owner": {"reputation": 4326, "user_id": 242348, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/cc86e1f443171a35a1c7dcf2c688f24c?s=128&d=identicon&r=PG", "display_name": "monoceres", "link": "https://stackoverflow.com/users/242348/monoceres"}, "reply_to_user": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1504120895, "post_id": 45968132, "comment_id": 78895543, "body": "@tobi303 no, that&#39;s an error. Doesn&#39;t seem to make a difference though."}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1504120952, "post_id": 45968132, "comment_id": 78895577, "body": "of course it makes a difference, if it is private you cannot get acces without modifiying <code>DefaultSqueel</code>"}, {"owner": {"reputation": 4326, "user_id": 242348, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/cc86e1f443171a35a1c7dcf2c688f24c?s=128&d=identicon&r=PG", "display_name": "monoceres", "link": "https://stackoverflow.com/users/242348/monoceres"}, "reply_to_user": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1504121003, "post_id": 45968132, "comment_id": 78895608, "body": "@tobi303 sure, but it doesn&#39;t make the compiler happier in this case. I edited the sample. :)"}], "answers": [{"comments": [{"owner": {"reputation": 4326, "user_id": 242348, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/cc86e1f443171a35a1c7dcf2c688f24c?s=128&d=identicon&r=PG", "display_name": "monoceres", "link": "https://stackoverflow.com/users/242348/monoceres"}, "edited": false, "score": 0, "creation_date": 1504120827, "post_id": 45968206, "comment_id": 78895503, "body": "hmm, yes, but then I would have a ISqueale implementation in Pig, which is what I&#39;m trying to avoid."}, {"owner": {"reputation": 2374, "user_id": 8491726, "user_type": "registered", "profile_image": "https://graph.facebook.com/1550562035006492/picture?type=large", "display_name": "Artemy Vysotsky", "link": "https://stackoverflow.com/users/8491726/artemy-vysotsky"}, "edited": false, "score": 1, "creation_date": 1504121334, "post_id": 45968206, "comment_id": 78895763, "body": "Remove inheritance of IAnimal from ISqueale - it is different interface with different set of functions... or call DefaultSqueel::squeale() from Pig::squeale()"}], "tags": [], "owner": {"reputation": 9737, "user_id": 1460794, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/7lOXx.png?s=128&g=1", "display_name": "wally", "link": "https://stackoverflow.com/users/1460794/wally"}, "is_accepted": false, "score": 2, "last_activity_date": 1504122014, "last_edit_date": 1504122014, "creation_date": 1504120684, "answer_id": 45968206, "question_id": 45968132, "link": "https://stackoverflow.com/questions/45968132/can-a-base-class-implement-an-explicit-interface/45968206#45968206", "title": "Can a base class implement an explicit interface?", "body": "<p><code>IAnimal</code> doesn't override the virtual <code>squeale</code> function.</p>\n\n<p>So even though <code>Pig</code> inherits from <code>DefaultSqueel</code>, the compiler is not satisfied that the <code>IAnimal</code> part of it that is inherited is not still virtual.</p>\n\n<p>If, rather, <code>Pig</code> had overrided the <code>squeale</code> function then it would have compiled:</p>\n\n<pre><code>class Pig : public IAnimal, public DefaultSqueel\n{\n    virtual std::string getName() { return \"Piggy\"; }\n    virtual void squeale() override\n    {\n        DefaultSqueel::squeale() ; //to avoid reimplementing\n    }\n};\n</code></pre>\n\n<p>If you look at the inheritance diagram then it seems clear that there is no benefit to inheriting from <code>ISquealer</code> twice:</p>\n\n<p><a href=\"https://i.stack.imgur.com/XLVwf.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/XLVwf.png\" alt=\"enter image description here\"></a></p>\n\n<p>If there is only a single inheritance from <code>ISquealer</code> then the code also compiles:</p>\n\n<p><a href=\"https://i.stack.imgur.com/uSQF9.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/uSQF9.png\" alt=\"enter image description here\"></a></p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;string&gt;\n\nclass ISquealer\n{\npublic:\n    virtual void squeale() = 0;\n};\n\nclass DefaultSqueel : public ISquealer // May be others\n{\n    virtual void squeale() override\n    {\n        std::cout &lt;&lt; \"Squeeaale!!\";\n    }\n};\n\nclass IAnimal \n{\n    virtual std::string getName() = 0;\n};\n\nclass Pig : public IAnimal, public DefaultSqueel\n{\n    virtual std::string getName() { return \"Piggy\"; }\n};\n\n\nint main()\n{\n    Pig pig; // object of abstract type 'Pig' is not allowed\n}\n</code></pre>\n"}], "owner": {"reputation": 4326, "user_id": 242348, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/cc86e1f443171a35a1c7dcf2c688f24c?s=128&d=identicon&r=PG", "display_name": "monoceres", "link": "https://stackoverflow.com/users/242348/monoceres"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1504122014, "creation_date": 1504120394, "last_edit_date": 1504121080, "question_id": 45968132, "link": "https://stackoverflow.com/questions/45968132/can-a-base-class-implement-an-explicit-interface", "title": "Can a base class implement an explicit interface?", "body": "<p>A snippet can speak more than a thousand words. Is there a way to make the following work, if not, why?</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;string&gt;\n\nclass ISquealer\n{\npublic:\n    virtual void squeale() = 0;\n};\n\nclass DefaultSqueel : public ISquealer // May be others\n{\npublic:\n    virtual void squeale() override\n    {\n        std::cout &lt;&lt; \"Squeeaale!!\";\n    }\n};\n\nclass IAnimal : public ISquealer\n{\npublic:\n    virtual std::string getName() = 0;\n};\n\nclass Pig : public IAnimal, public DefaultSqueel\n{\npublic:\n    virtual std::string getName() { return \"Piggy\"; }\n};\n\n\nint main()\n{\n    Pig pig; // object of abstract type 'Pig' is not allowed\n}\n</code></pre>\n\n<p>Edit:</p>\n\n<p>Just to clarify what's wrong: This does not compile as the compiler thinks that Pig is abstract and thus cannot be instantiated even though the squeale method is actually implemented inside of the Pig inheritence hierarchy.</p>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 820, "user_id": 4266707, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh4.googleusercontent.com/-fLyyGXepW68/AAAAAAAAAAI/AAAAAAAAABI/RjSsIhv1dvs/photo.jpg?sz=128", "display_name": "Javia1492", "link": "https://stackoverflow.com/users/4266707/javia1492"}, "edited": false, "score": 1, "creation_date": 1504119879, "post_id": 45967962, "comment_id": 78895033, "body": "You might be able to use <a href=\"http://www.cplusplus.com/reference/cmath/modf/\" rel=\"nofollow noreferrer\">modf</a>."}, {"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 1, "creation_date": 1504119954, "post_id": 45967962, "comment_id": 78895072, "body": "Sounds like an <a href=\"http://xyproblem.info/\" rel=\"nofollow noreferrer\">XY Problem</a>.  What high-level problem are you actually trying to solve?"}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 1, "creation_date": 1504119978, "post_id": 45967962, "comment_id": 78895081, "body": "be careful not to confuse the number of digits you see on the screen when you do <code>std::cout &lt;&lt; a;</code> with the number of significant digits of <code>a</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2100815"}, "edited": false, "score": 0, "creation_date": 1504119979, "post_id": 45967962, "comment_id": 78895082, "body": "What does &quot;numbers after decimal point&quot; even mean?"}, {"owner": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 0, "creation_date": 1504120023, "post_id": 45967962, "comment_id": 78895102, "body": "Note that the amount of numbers after decimal point may be not the same as amount of numbers after decimal point of literal used to initialize this value."}, {"owner": {"reputation": 478, "user_id": 1725816, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0e46d33a24749378a59c25348e8bc435?s=128&d=identicon&r=PG", "display_name": "Kevin", "link": "https://stackoverflow.com/users/1725816/kevin"}, "edited": false, "score": 0, "creation_date": 1504120134, "post_id": 45967962, "comment_id": 78895150, "body": "Be careful -  setting double a=3.14259 doesn&#39;t guarantee the number is going to look like that when it&#39;s printed. That&#39;s just not how floating point works."}, {"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 3, "creation_date": 1504120148, "post_id": 45967962, "comment_id": 78895159, "body": "Floating point is inexact, thus your question needs clarification."}, {"owner": {"reputation": 9737, "user_id": 1460794, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/7lOXx.png?s=128&g=1", "display_name": "wally", "link": "https://stackoverflow.com/users/1460794/wally"}, "edited": false, "score": 0, "creation_date": 1504120249, "post_id": 45967962, "comment_id": 78895200, "body": "<a href=\"https://stackoverflow.com/a/33494853/1460794\">Here</a> is an example of how, even with a multiprecision library, things go wrong as soon as the compiler interprets the floating point literal. By wrong, I mean that the value might be as close as it can be in memory, but the decimal digits are no longer the same. So counting them, rounding them etc. will not provide the true answer."}, {"owner": {"reputation": 55, "user_id": 8428581, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/44a1956888482b071b90fd4141b836fe?s=128&d=identicon&r=PG&f=1", "display_name": "Malcom98.", "link": "https://stackoverflow.com/users/8428581/malcom98"}, "edited": false, "score": 0, "creation_date": 1504120338, "post_id": 45967962, "comment_id": 78895259, "body": "The problem is: Enter number f(double), and enter number n(int). N determines how many decimal places f will have. input f=3.457 | n=2 output 3.46 input f=3.454 i n=2 output 3.45"}, {"owner": {"reputation": 820, "user_id": 4266707, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh4.googleusercontent.com/-fLyyGXepW68/AAAAAAAAAAI/AAAAAAAAABI/RjSsIhv1dvs/photo.jpg?sz=128", "display_name": "Javia1492", "link": "https://stackoverflow.com/users/4266707/javia1492"}, "edited": false, "score": 0, "creation_date": 1504120397, "post_id": 45967962, "comment_id": 78895289, "body": "@Malcom98. What?"}, {"owner": {"reputation": 736, "user_id": 5441932, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4acbacc09001d66b0fd772f7d3426617?s=128&d=identicon&r=PG", "display_name": "konsolas", "link": "https://stackoverflow.com/users/5441932/konsolas"}, "edited": false, "score": 0, "creation_date": 1504120661, "post_id": 45967962, "comment_id": 78895413, "body": "Are you trying to format a floating point type?"}, {"owner": {"reputation": 231, "user_id": 7404875, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b80971b1d5ed24a338b33e8761cf394e?s=128&d=identicon&r=PG&f=1", "display_name": "pmaxim98", "link": "https://stackoverflow.com/users/7404875/pmaxim98"}, "edited": false, "score": 0, "creation_date": 1504121225, "post_id": 45967962, "comment_id": 78895721, "body": "@Malcom98. have you tried <code>std::setprecision</code> ?"}, {"owner": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "edited": false, "score": 0, "creation_date": 1504121249, "post_id": 45967962, "comment_id": 78895730, "body": "Do you realize that your question is completely different than what you need?"}, {"owner": {"reputation": 55, "user_id": 8428581, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/44a1956888482b071b90fd4141b836fe?s=128&d=identicon&r=PG&f=1", "display_name": "Malcom98.", "link": "https://stackoverflow.com/users/8428581/malcom98"}, "reply_to_user": {"reputation": 231, "user_id": 7404875, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b80971b1d5ed24a338b33e8761cf394e?s=128&d=identicon&r=PG&f=1", "display_name": "pmaxim98", "link": "https://stackoverflow.com/users/7404875/pmaxim98"}, "edited": false, "score": 0, "creation_date": 1504121639, "post_id": 45967962, "comment_id": 78895943, "body": "@pmaxim98 yes, but I haven&#39;t found a way  to use it except with the line where&#39;s &quot;cout&quot;."}, {"owner": {"reputation": 55, "user_id": 8428581, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/44a1956888482b071b90fd4141b836fe?s=128&d=identicon&r=PG&f=1", "display_name": "Malcom98.", "link": "https://stackoverflow.com/users/8428581/malcom98"}, "reply_to_user": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "edited": false, "score": 0, "creation_date": 1504121641, "post_id": 45967962, "comment_id": 78895945, "body": "@Slava yes, but I&#39;m gonna try to apply any possible response on my post to my program."}, {"owner": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "edited": false, "score": 0, "creation_date": 1504122697, "post_id": 45967962, "comment_id": 78896420, "body": "if you need reponse to your question then formulate it properly, what you asked does not have solution, as stated in @stefanbachert answer, what you actually need has trivial solution though."}], "answers": [{"tags": [], "owner": {"reputation": 9936, "user_id": 6525260, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-DdsW6uGdpjg/AAAAAAAAAAI/AAAAAAAAAAw/srXxxqCzyW0/photo.jpg?sz=128", "display_name": "Arnav Borborah", "link": "https://stackoverflow.com/users/6525260/arnav-borborah"}, "is_accepted": false, "score": 0, "last_activity_date": 1504120524, "creation_date": 1504120524, "answer_id": 45968161, "question_id": 45967962, "link": "https://stackoverflow.com/questions/45967962/how-can-i-specify-how-many-numbers-are-there-after-decimal-point/45968161#45968161", "title": "How can I specify how many numbers are there after decimal point?", "body": "<p>Here is one way to do it: Convert the decimal to a string, and find the size of the substring after the decimal point, as follows:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;string&gt;\n\nint main()\n{\n    double a = 3.14259;\n    std::string a_string = std::to_string(a);\n    a_string.erase ( a_string.find_last_not_of('0') + 1, std::string::npos ); //Get rid\n                                                                      //of extra zeroes\n    std::cout &lt;&lt; a_string.substr(a_string.find('.') + 1).size() &lt;&lt; \"\\n\";\n    //Print the size of the substring of the original string from the decimal point (here 5)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3671, "user_id": 4227175, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/ce475809b37f81b6c7838ae53e451425?s=128&d=identicon&r=PG&f=1", "display_name": "ghchoi", "link": "https://stackoverflow.com/users/4227175/ghchoi"}, "edited": false, "score": 0, "creation_date": 1504150726, "post_id": 45968185, "comment_id": 78904475, "body": "Why down votes only for my answer...? Basically the same approach...?"}], "tags": [], "owner": {"reputation": 3671, "user_id": 4227175, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/ce475809b37f81b6c7838ae53e451425?s=128&d=identicon&r=PG&f=1", "display_name": "ghchoi", "link": "https://stackoverflow.com/users/4227175/ghchoi"}, "is_accepted": false, "score": -2, "last_activity_date": 1504120594, "creation_date": 1504120594, "answer_id": 45968185, "question_id": 45967962, "link": "https://stackoverflow.com/questions/45967962/how-can-i-specify-how-many-numbers-are-there-after-decimal-point/45968185#45968185", "title": "How can I specify how many numbers are there after decimal point?", "body": "<p>Floating point number does not provide the number of digits after the point. (It is not even the 'exact' value. It is an approximate value.)</p>\n\n<p>But if you just want to make another integer to have the same number of digits after the point just on the screen, why don't you just count?</p>\n\n<p>Here is Python code:</p>\n\n<pre><code>a = 4.0 / 7\n# a is 0.5714285714285714 \nb = str(a)\n# b (str(a)) is 0.571428571429, different with a.\nnod = len(b[b.index('.'):])\n_c = 9.0 / 7\nc = float(int(_c * 10 ** nod)) / 10 ** nod\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8593, "user_id": 732454, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/ddb83f70a52b1a6689a7a44b270908e5?s=128&d=identicon&r=PG", "display_name": "stefan bachert", "link": "https://stackoverflow.com/users/732454/stefan-bachert"}, "is_accepted": false, "score": 2, "last_activity_date": 1504121612, "creation_date": 1504121612, "answer_id": 45968401, "question_id": 45967962, "link": "https://stackoverflow.com/questions/45967962/how-can-i-specify-how-many-numbers-are-there-after-decimal-point/45968401#45968401", "title": "How can I specify how many numbers are there after decimal point?", "body": "<p>The short answer is, you can't.</p>\n\n<p>first of all, a type like <code>double</code> has always the same number of binary digits after a (binary) period. That is called mantissa. in case of double that are 53 bits, meaning 52 bit after binary period, in decimal that are about 15 digits. For details you may have a look a <a href=\"https://en.wikipedia.org/wiki/IEEE_754\" rel=\"nofollow noreferrer\">IEEE_754 (double precision)</a></p>\n\n<p>When you convert a double to a decimal string, you will in general never match exact decimal. For example the value <code>0.1</code> could not exactly represented by a double value. a printf may show \"0.1\" after applying rounding.</p>\n\n<p>However, when you are dealing with some double calculations you will experience small deriviation like <code>0.10000000000012</code> or <code>0.09999999999987</code>. What will you do in such cases?</p>\n\n<p>And there is a mathematican problem which has nothing to do with c++ doubles: </p>\n\n<pre><code>                     _\n  0.1 is equal to 0.09\n</code></pre>\n\n<p>so your answer would either 1 or infinity </p>\n"}, {"comments": [{"owner": {"reputation": 44802, "user_id": 2752075, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5oQlf.png?s=128&g=1", "display_name": "HolyBlackCat", "link": "https://stackoverflow.com/users/2752075/holyblackcat"}, "edited": false, "score": 0, "creation_date": 1504123848, "post_id": 45968706, "comment_id": 78897001, "body": "You can use <code>std::modf()</code> to extract the fractional part."}], "tags": [], "owner": {"reputation": 13016, "user_id": 8751754, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7k6Li.png?s=128&g=1", "display_name": "Ron", "link": "https://stackoverflow.com/users/8751754/ron"}, "is_accepted": false, "score": 0, "last_activity_date": 1504124063, "last_edit_date": 1504124063, "creation_date": 1504122882, "answer_id": 45968706, "question_id": 45967962, "link": "https://stackoverflow.com/questions/45967962/how-can-i-specify-how-many-numbers-are-there-after-decimal-point/45968706#45968706", "title": "How can I specify how many numbers are there after decimal point?", "body": "<p>You could treat the fractional part as a string literal. Utilize the <a href=\"http://en.cppreference.com/w/cpp/io/basic_stringstream\" rel=\"nofollow noreferrer\">std::stringstream</a> and <a href=\"http://en.cppreference.com/w/cpp/string/basic_string\" rel=\"nofollow noreferrer\">std::string</a>:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;string&gt;\n#include &lt;sstream&gt;\nint main(){\n    double whole = 3.14259;\n    auto fractionalno = whole - static_cast&lt;long&gt;(whole); // or use std::modf()\n    std::stringstream ss;\n    ss &lt;&lt; fractionalno;\n    std::string s = ss.str();\n    s.erase(0,2);\n    std::cout &lt;&lt; \"The number of digits is: \" &lt;&lt; s.size();\n}\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 8428581, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/44a1956888482b071b90fd4141b836fe?s=128&d=identicon&r=PG&f=1", "display_name": "Malcom98.", "link": "https://stackoverflow.com/users/8428581/malcom98"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "answer_count": 4, "score": 1, "last_activity_date": 1504124063, "creation_date": 1504119716, "last_edit_date": 1504119895, "question_id": 45967962, "link": "https://stackoverflow.com/questions/45967962/how-can-i-specify-how-many-numbers-are-there-after-decimal-point", "title": "How can I specify how many numbers are there after decimal point?", "body": "<p>Is there any way to determine how many numbers are there in my double after decimal point.  for example <code>double a=3.14259</code></p>\n\n<p>If I make a new <code>int b</code> now, how can I make value of <code>b</code>equal to numbers after decimal point from <code>a</code>?</p>\n"}, {"tags": ["c++", "qt"], "comments": [{"owner": {"reputation": 185819, "user_id": 6622587, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gAYS0.jpg?s=128&g=1", "display_name": "eyllanesc", "link": "https://stackoverflow.com/users/6622587/eyllanesc"}, "edited": false, "score": 2, "creation_date": 1504118753, "post_id": 45967608, "comment_id": 78894439, "body": "That is not possible with Qt, I recommend creating a file that contains that information and read from there."}], "answers": [{"comments": [{"owner": {"reputation": 8601, "user_id": 1485885, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/tdPE1.jpg?s=128&g=1", "display_name": "cbuchart", "link": "https://stackoverflow.com/users/1485885/cbuchart"}, "reply_to_user": {"reputation": 326, "user_id": 4281664, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f3409df4f4de5586957d836ad6a7820f?s=128&d=identicon&r=PG&f=1", "display_name": "Alberto Jim&#233;nez", "link": "https://stackoverflow.com/users/4281664/alberto-jim%c3%a9nez"}, "edited": false, "score": 0, "creation_date": 1504245866, "post_id": 45974931, "comment_id": 78948061, "body": "Glad to help you!"}], "tags": [], "owner": {"reputation": 8601, "user_id": 1485885, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/tdPE1.jpg?s=128&g=1", "display_name": "cbuchart", "link": "https://stackoverflow.com/users/1485885/cbuchart"}, "is_accepted": true, "score": 2, "last_activity_date": 1504245833, "last_edit_date": 1504245833, "creation_date": 1504162010, "answer_id": 45974931, "question_id": 45967608, "link": "https://stackoverflow.com/questions/45967608/how-to-get-the-language-country-name-in-my-system-locale-language/45974931#45974931", "title": "How to get the language/country name in my system locale language", "body": "<p>You can use Qt's translation system to do it and, in addition, it's already prepared for multi-language applications, not only Spanish. The drawback is that you have to create the list and translate it (you may google for some pre-built table on several languages).</p>\n\n<pre><code>QString languageNameInCurrentLocale(const QLocale&amp; loc) {\n  return qApp-&gt;translate(\"locale_name\", loc.name().toStdString().c_str());\n}\n</code></pre>\n\n<p>As you don't have the string literals in your code you have to add them to the translation system manually. You can use <a href=\"https://doc.qt.io/qt-5/i18n-source-translation.html#using-qt-tr-noop-and-qt-translate-noop-in-c\" rel=\"nofollow noreferrer\"><code>QT_TRANSLATE_NOOP</code></a> to do it.</p>\n\n<p>The initial list can be generated in pre-compilation step that iterates through all locales (as shown in <a href=\"https://stackoverflow.com/questions/26307729/get-list-of-languages-in-qt5\">this answer</a> for example) and prints with such information (in this example redirect the output to a C++ file). Add the file to your project and update your translation files.</p>\n\n<pre><code>void printLocaleList() {\n  const auto allLocales = QLocale::matchingLocales(QLocale::AnyLanguage,\n    QLocale::AnyScript, QLocale::AnyCountry);\n\n  for (auto loc : allLocales) {\n    std::cout &lt;&lt; \"QT_TRANSLATE_NOOP(\\\"locale_name\\\", \\\"\" &lt;&lt;\n                 loc.name().toStdString() &lt;&lt; \"\\\");\\n\";\n  }\n}\n</code></pre>\n"}], "owner": {"reputation": 326, "user_id": 4281664, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f3409df4f4de5586957d836ad6a7820f?s=128&d=identicon&r=PG&f=1", "display_name": "Alberto Jim&#233;nez", "link": "https://stackoverflow.com/users/4281664/alberto-jim%c3%a9nez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1115, "favorite_count": 0, "accepted_answer_id": 45974931, "answer_count": 1, "score": 2, "last_activity_date": 1504245833, "creation_date": 1504118266, "last_edit_date": 1504132271, "question_id": 45967608, "link": "https://stackoverflow.com/questions/45967608/how-to-get-the-language-country-name-in-my-system-locale-language", "title": "How to get the language/country name in my system locale language", "body": "<p>I'm programming  with Qt an application that must show the name of some languages as text. I have set my system locale as es_ES. That way, I would like to get several languages and country names in spanish. But, I can only get in the native language, or in english:</p>\n\n<pre><code>QLocale lsystem = QLocale::system();\nQLocale lswiss(\"de_CH\");\nqDebug()&lt;&lt;\"system \"&lt;&lt;lsystem.name() &lt;&lt; lsystem.languageToString(lsystem.language()) &lt;&lt; lsystem.nativeLanguageName();\nqDebug()&lt;&lt;\"swiss \"&lt;&lt;lswiss.name() &lt;&lt; lsystem.languageToString(lswiss.language()) &lt;&lt; lswiss.nativeLanguageName();\n</code></pre>\n\n<p>This source code prints the following text:</p>\n\n<pre><code>20:17:09.229 [DEBUG]: system  \"es_ES\" \"Spanish\" \"espa\u00f1ol de Espa\u00f1a\"\n20:17:09.229 [DEBUG]: swiss  \"de_CH\" \"German\" \"Schweizer Hochdeutsch\"\n</code></pre>\n\n<p>What I would expect is that <code>QLocale::languageToString()</code> method could return the name in my system locale language, but it's not the case. I want to get names in spanish (espa\u00f1ol, alem\u00e1n), but I don't know how to do it.</p>\n\n<p>Can I get what I want without translating each language name with Qt's translate utilities? Thank you in advance.</p>\n"}, {"tags": ["c++", "bit-manipulation", "vectorization", "x86-64", "avx2"], "comments": [{"owner": {"reputation": 8289, "user_id": 391806, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/88a2ea78dadbdaf73e1033fe7cbdeb73?s=128&d=identicon&r=PG", "display_name": "Dale Wilson", "link": "https://stackoverflow.com/users/391806/dale-wilson"}, "edited": false, "score": 0, "creation_date": 1504118259, "post_id": 45967507, "comment_id": 78894159, "body": "since 63, 127, 191, and 255 are not powers of 2 they can&#39;t be masks to indicate bit position.  If they are indexes into a bit vector, then you have at least 255 bits to deal with. A &#39;unit8_t&#39; contains 8 bits (hence the &#39;8&#39;) so you are asking if you can represent 255 bits in 8 bits?  That doesn&#39;t seem likely.  You need to correct the question before you can get a meaningful answer."}, {"owner": {"reputation": 8289, "user_id": 391806, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/88a2ea78dadbdaf73e1033fe7cbdeb73?s=128&d=identicon&r=PG", "display_name": "Dale Wilson", "link": "https://stackoverflow.com/users/391806/dale-wilson"}, "edited": false, "score": 0, "creation_date": 1504118393, "post_id": 45967507, "comment_id": 78894238, "body": "If you are off-by-one, 64, 128 and 256 ARE powers of 2 so they might be bit masks, but 192 doesn&#39;t fit the pattern (fwiw it&#39;s 64 + 128, but that&#39;s two bits) so...."}, {"owner": {"reputation": 10955, "user_id": 1915854, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/gIC27.jpg?s=128&g=1", "display_name": "Serge Rogatch", "link": "https://stackoverflow.com/users/1915854/serge-rogatch"}, "reply_to_user": {"reputation": 8289, "user_id": 391806, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/88a2ea78dadbdaf73e1033fe7cbdeb73?s=128&d=identicon&r=PG", "display_name": "Dale Wilson", "link": "https://stackoverflow.com/users/391806/dale-wilson"}, "edited": false, "score": 1, "creation_date": 1504118635, "post_id": 45967507, "comment_id": 78894358, "body": "@DaleWilson, it&#39;s a question about AVX(2) technology, which operates 256-bit vectors. Initially there are 4 bits in <code>uint8_t</code>. I want to move them to the specified positions (you didn&#39;t understand: 63, 127, 191 and 255 are 0-based bit positions, not masks) to a 256-bit AVX register."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1504128630, "post_id": 45967507, "comment_id": 78899262, "body": "Close enough to a duplicate; just leave out the broadcast-to-all-bits part.  (And note that <code>pdep</code> is slow on Ryzen).  Being only 4 bits does make a LUT attractive.  You can compress the LUT and load it with <code>vpmovsxbq</code>."}], "answers": [{"comments": [{"owner": {"reputation": 10955, "user_id": 1915854, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/gIC27.jpg?s=128&g=1", "display_name": "Serge Rogatch", "link": "https://stackoverflow.com/users/1915854/serge-rogatch"}, "edited": false, "score": 0, "creation_date": 1504119339, "post_id": 45967766, "comment_id": 78894737, "body": "That&#39;s a good solution, but it takes 16 * 32 = 512 bytes of cache."}, {"owner": {"reputation": 8289, "user_id": 391806, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/88a2ea78dadbdaf73e1033fe7cbdeb73?s=128&d=identicon&r=PG", "display_name": "Dale Wilson", "link": "https://stackoverflow.com/users/391806/dale-wilson"}, "reply_to_user": {"reputation": 10955, "user_id": 1915854, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/gIC27.jpg?s=128&g=1", "display_name": "Serge Rogatch", "link": "https://stackoverflow.com/users/1915854/serge-rogatch"}, "edited": false, "score": 1, "creation_date": 1504119757, "post_id": 45967766, "comment_id": 78894959, "body": "I.e. two cache lines on many processors -- and those cache lines are going to be read-only which helps a lot., I&#39;m betting that by the time you compile the shifts, masks and ors necessary to distribute the bits into a 256 bit vector the table-lookup will run faster even if it does take an occasional cache load.  But of course as always with this type of question the only real answer to &quot;which is faster&quot; is profiling.    The approach I describe, however is a clear winner on code clarity and maintainability."}, {"owner": {"reputation": 10955, "user_id": 1915854, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/gIC27.jpg?s=128&g=1", "display_name": "Serge Rogatch", "link": "https://stackoverflow.com/users/1915854/serge-rogatch"}, "edited": false, "score": 0, "creation_date": 1504120239, "post_id": 45967766, "comment_id": 78895197, "body": "The cache line is usually 64 bytes on x86_64, so 512 bytes is 8 cache lines."}, {"owner": {"reputation": 8289, "user_id": 391806, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/88a2ea78dadbdaf73e1033fe7cbdeb73?s=128&d=identicon&r=PG", "display_name": "Dale Wilson", "link": "https://stackoverflow.com/users/391806/dale-wilson"}, "reply_to_user": {"reputation": 10955, "user_id": 1915854, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/gIC27.jpg?s=128&g=1", "display_name": "Serge Rogatch", "link": "https://stackoverflow.com/users/1915854/serge-rogatch"}, "edited": false, "score": 0, "creation_date": 1504120614, "post_id": 45967766, "comment_id": 78895396, "body": "Yeah, I just checked my facts and the Ryzen uses 64 byte cache lines, so &quot;four&quot; cache lines.  I&#39;ll still stand by the table-lookup approach, though for this specific problem."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1504127892, "post_id": 45967766, "comment_id": 78898963, "body": "All current x86 CPUs use 64B cache lines.  The last CPU with 32B lines was Pentium III.  I&#39;ve never heard of any CPU using 256 <i>byte</i> lines."}], "tags": [], "owner": {"reputation": 8289, "user_id": 391806, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/88a2ea78dadbdaf73e1033fe7cbdeb73?s=128&d=identicon&r=PG", "display_name": "Dale Wilson", "link": "https://stackoverflow.com/users/391806/dale-wilson"}, "is_accepted": false, "score": 2, "last_activity_date": 1504118922, "creation_date": 1504118922, "answer_id": 45967766, "question_id": 45967507, "link": "https://stackoverflow.com/questions/45967507/having-4-bits-how-to-produce-a-mask-for-avx-register/45967766#45967766", "title": "Having 4 bits, how to produce a mask for AVX register?", "body": "<p>The most efficient approach would be to use a lookup vector containing 16 256-bit entries, indexed by the uint-8.</p>\n"}, {"tags": [], "owner": {"reputation": 52741, "user_id": 555045, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/182d0ce855c8324a596648c04643e8f9?s=128&d=identicon&r=PG", "display_name": "nicomp", "link": "https://stackoverflow.com/users/555045/nicomp"}, "is_accepted": false, "score": 2, "last_activity_date": 1504120300, "creation_date": 1504120300, "answer_id": 45968108, "question_id": 45967507, "link": "https://stackoverflow.com/questions/45967507/having-4-bits-how-to-produce-a-mask-for-avx-register/45968108#45968108", "title": "Having 4 bits, how to produce a mask for AVX register?", "body": "<p>The obvious solution: use those 4 bits as index into a lookup table. You already knew that, so let's try something else.</p>\n\n<p>The variable shift based approach: broadcast that byte into every qword, then shift it left by { 63, 62, 61, 60 }, lining up the right bit in the msb. Not tested, something like this:</p>\n\n<pre><code>_mm256_sllv_epi64(_mm256_set1_epi64x(mask), _mm256_set_epi64x(63, 62, 61, 60))\n</code></pre>\n\n<p>As a bonus, since the load does not depend on the mask, it can be lifted out of loops.</p>\n\n<p>This is not necessarily a great idea on Ryzen, 256-bit loads from memory have a higher throughput than even just the <code>vpsllvq</code> by itself (which is 2 \u00b5ops like most 256b operations on Ryzen), but here we also have a <code>vmovq</code> (if that byte does not come from a vector register) and a wide <code>vpbroadcastq</code> (2 \u00b5ops again).</p>\n\n<p>Depending on the context, it may be worth doing or not. It depends.</p>\n"}, {"comments": [{"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1504128674, "post_id": 45969866, "comment_id": 78899275, "body": "@zx485: pdep is 6 uops on Ryzen.  So those uop counts only apply for Intel CPUs."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1504128797, "post_id": 45969866, "comment_id": 78899319, "body": "Try using <code>vpmovsxbq</code> to copy the sign bit of each byte to the upper 56 bits of each qword."}, {"owner": {"reputation": 23944, "user_id": 1305969, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wlo8z.png?s=128&g=1", "display_name": "zx485", "link": "https://stackoverflow.com/users/1305969/zx485"}, "reply_to_user": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1504130186, "post_id": 45969866, "comment_id": 78899827, "body": "@PeterCordes: Thanks a lot. Really great suggestion. It&#39;s a shame that PDEP performs so bad on Ryzen."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1504130691, "post_id": 45969866, "comment_id": 78900014, "body": "You might as well remove the <code>vpshufb</code> version; it has no advantage over <code>vpmovsxbq</code>, and doesn&#39;t work without an additional shuffle because <code>vpshufb</code> is not lane-crossing.  (Also, my answer on the duplicate of this question (<a href=\"https://stackoverflow.com/questions/36488675/is-there-an-inverse-instruction-to-the-movemask-instruction-in-intel-avx2\" title=\"is there an inverse instruction to the movemask instruction in intel avx2\">stackoverflow.com/questions/36488675/&hellip;</a>) already had the <code>pdep</code> / <code>vpmovsxbq</code> version.  Note that it doesn&#39;t set <i>all</i> bits; the low 7 are still 0.  Sorry to be the bearer of bad news, that your cool idea had already been invented.  It is a cool idea, though, nice job thinking it up yourself.)"}, {"owner": {"reputation": 23944, "user_id": 1305969, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wlo8z.png?s=128&g=1", "display_name": "zx485", "link": "https://stackoverflow.com/users/1305969/zx485"}, "reply_to_user": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1504131254, "post_id": 45969866, "comment_id": 78900174, "body": "@PeterCordes: Yes. This is a really matching duplicate. Bad for me :-/ but thanks... However, I&#39;ll let both solutions here, because it does no harm and maybe it&#39;s of use for something else in the future..."}], "tags": [], "owner": {"reputation": 23944, "user_id": 1305969, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wlo8z.png?s=128&g=1", "display_name": "zx485", "link": "https://stackoverflow.com/users/1305969/zx485"}, "is_accepted": false, "score": 2, "last_activity_date": 1504130081, "last_edit_date": 1504130081, "creation_date": 1504127997, "answer_id": 45969866, "question_id": 45967507, "link": "https://stackoverflow.com/questions/45967507/having-4-bits-how-to-produce-a-mask-for-avx-register/45969866#45969866", "title": "Having 4 bits, how to produce a mask for AVX register?", "body": "<p>Assuming that the <code>uint8_t</code> exists in a general purpose register; the approach is:</p>\n\n<ol>\n<li>Use <a href=\"http://felixcloutier.com/x86/PDEP.html\" rel=\"nofollow noreferrer\"><code>PDEP</code></a> to transform four bits to four byte (highest bits)</li>\n<li>transfer four bytes from 32-bit GPR to the low part of YMM register</li>\n<li>Put the values in place (Bits 63, 127, 191, 255)</li>\n</ol>\n\n<p>So I came up with two versions - one with memory and the other one without:</p>\n\n<p><strong>Approach with memory:</strong></p>\n\n<pre><code>.data\n  ; Always use the highest bytes of a QWORD as target / 128 means 'set ZERO' \n  ddqValuesDistribution:    .byte  3,128,128,128,128,128,128,128, 2,128,128,128,128,128,128,128, 1,128,128,128,128,128,128,128, 0,128,128,128,128,128,128,128\n.code\n  ; Input value in lower 4 bits of EAX\n  mov     edx, 0b10000000100000001000000010000000\n  pdep    eax, eax, edx\n  vmovd   xmm0, eax\n  vpshufb ymm0, ymm0, ymmword ptr [ddqValuesDistribution]\n</code></pre>\n\n<p>This one comes out at 5 uOps on Haswell and Skylake.</p>\n\n<hr>\n\n<p><strong>Approach without memory variable (improved thanks to @Peter Cordes):</strong></p>\n\n<pre><code>  mov  edx, 0b10000000100000001000000010000000\n  pdep eax, eax, edx\n  vmovd xmm0, eax \n  vpmovsxbq ymm0, xmm0\n</code></pre>\n\n<p>This one comes out at 4 uOps on Haswell and Skylake(!) and can be further improved by moving the mask in EDX to a variable.<br>\nThe output is different from the first version (all ones vs. only highest bit set). </p>\n"}], "owner": {"reputation": 10955, "user_id": 1915854, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/gIC27.jpg?s=128&g=1", "display_name": "Serge Rogatch", "link": "https://stackoverflow.com/users/1915854/serge-rogatch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1074, "favorite_count": 2, "closed_date": 1504128412, "answer_count": 3, "score": 4, "last_activity_date": 1504130081, "creation_date": 1504117923, "last_edit_date": 1504118477, "question_id": 45967507, "link": "https://stackoverflow.com/questions/45967507/having-4-bits-how-to-produce-a-mask-for-avx-register", "closed_reason": "Duplicate", "title": "Having 4 bits, how to produce a mask for AVX register?", "body": "<p><code>_mm256_blendv_pd()</code> looks at bits in positions 63, 127, 191 and 255. Is there an efficient way to scatter 4 lower bits of a <code>uint8_t</code> into these positions of an AVX register?</p>\n\n<p>Alternatively, is there an efficient way to broadcast these bits, so that like a result of <code>_mm256_cmp_pd()</code> each bit is repeated in the corresponding 64-bit component of an AVX register?</p>\n\n<p>The instruction set is AVX2 (Ryzen CPU if other features are needed).</p>\n"}, {"tags": ["c++", "initialization", "c++14", "static-order-fiasco"], "answers": [{"comments": [{"owner": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "edited": false, "score": 0, "creation_date": 1504118371, "post_id": 45967584, "comment_id": 78894223, "body": "This is what I do.  I also sometimes make it a <code>boost::</code> or <code>std::optional&lt;blah&gt;&amp;</code> that by default is constructed with a <code>blah</code>, because that permits me to destroy such singletons in the order I choose, instead of in compiler-determined per-runtime reverse order of construction."}, {"owner": {"reputation": 3338, "user_id": 85868, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/a3883ced75dbc92d6622b016ea6a6ef8?s=128&d=identicon&r=PG", "display_name": "Nuoji", "link": "https://stackoverflow.com/users/85868/nuoji"}, "edited": false, "score": 0, "creation_date": 1504118919, "post_id": 45967584, "comment_id": 78894531, "body": "I note the solution of VTT above uses a dynamically allocated object instead. Is there any advantage to that?"}, {"owner": {"reputation": 122530, "user_id": 2756719, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b06a9c91425630fdb69e861abe483d7e?s=128&d=identicon&r=PG&f=1", "display_name": "T.C.", "link": "https://stackoverflow.com/users/2756719/t-c"}, "edited": false, "score": 1, "creation_date": 1504119734, "post_id": 45967584, "comment_id": 78894950, "body": "The typical justification for using dynamic allocation or similar hackery is to make the object available during destruction of global objects as well. May or may not be an actual problem, depending on the use case."}], "tags": [], "owner": {"reputation": 245138, "user_id": 2069064, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/e4V2X.jpg?s=128&g=1", "display_name": "Barry", "link": "https://stackoverflow.com/users/2069064/barry"}, "is_accepted": true, "score": 10, "last_activity_date": 1504118179, "creation_date": 1504118179, "answer_id": 45967584, "question_id": 45967503, "link": "https://stackoverflow.com/questions/45967503/in-c-can-i-safely-initialize-an-unordered-map-with-values-from-different-file/45967584#45967584", "title": "In C++, can I safely initialize an unordered_map with values from different files?", "body": "<p>You could stick the factory itself inside of a function:</p>\n\n<pre><code>std::unordered_map&lt;std::string, std::function&lt;Foo *()&gt;&gt;&amp; getFactory() {\n    static std::unordered_map&lt;std::string, std::function&lt;Foo *()&gt;&gt; FooFactory;\n    return FooFactory;\n}\n</code></pre>\n\n<p>Which your registration function can go through:</p>\n\n<pre><code>void registerFoo(std::string name, std::function&lt;Foo *()&gt; factory)\n{\n    getFactory().emplace(name, factory);\n}\n</code></pre>\n\n<p>This should guarantee ordering. </p>\n"}, {"comments": [{"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 1, "creation_date": 1504118952, "post_id": 45967656, "comment_id": 78894550, "body": "I like the idea but I dislike the implementation.  You have a <code>new</code> without a <code>delete</code> and while it shouldn&#39;t be a problem it is still unsightly.  If your always going to have to call <code>getFooFactory()</code> you might as well make the map a static variable inside the function and that gets rid of the pointer, <code>new</code>, and having to do your own initialization check."}, {"owner": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "reply_to_user": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1504119346, "post_id": 45967656, "comment_id": 78894746, "body": "@NathanOliver I agree that this is rather sketchy solution that just makes autoregistration work regardless of initialization order. However the important part is that autoregistration still won&#39;t work when used inside of static library without compiler-specific magic."}, {"owner": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "edited": false, "score": 0, "creation_date": 1504127018, "post_id": 45967656, "comment_id": 78898577, "body": "This isn&#39;t thread safe.  Use a magic static for thread safety here, even if you use a pointer and dynamic allocation."}], "tags": [], "owner": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "is_accepted": false, "score": 0, "last_activity_date": 1504127956, "last_edit_date": 1504127956, "creation_date": 1504118473, "answer_id": 45967656, "question_id": 45967503, "link": "https://stackoverflow.com/questions/45967503/in-c-can-i-safely-initialize-an-unordered-map-with-values-from-different-file/45967656#45967656", "title": "In C++, can I safely initialize an unordered_map with values from different files?", "body": "<p>To avoid static initialization order fiasco you can wrap up factory access into function call constructing it during first call:</p>\n\n<pre><code>using\nt_NameToFactoryMap = std::unordered_map&lt;std::string, std::function&lt;Foo *()&gt;&gt;\n\nt_NameToFactoryMap * p_foo_factory{}; // initialized with nullptr before dynamic initialization starts\n\nt_NameToFactoryMap &amp;\ngetFooFactory(void)\n{\n    if(!p_foo_factory)\n    {\n        p_foo_factory = new t_NameToFactoryMap{};\n    }\n    return(*p_foo_factory);\n}\n\nvoid registerFoo(std::string name, std::function&lt;Foo *()&gt; factory)\n{\n    getFooFactory().emplace(name, factory);\n}\n</code></pre>\n\n<p>The drawback of such autoregistration methods is that they will create problems if you decide to utilize them in some static library project. Projects using this static library won't reference <code>Baz</code> or <code>Bar</code> unless they link this static library using some compiler-dependent flag, such as <code>--whole-archive</code> for gcc.</p>\n\n<p>So a better solution would be to explicitly create factory below <code>main</code> and register all the required items without dealing with dynamic initialization at all.</p>\n"}, {"tags": [], "owner": {"reputation": 77, "user_id": 8495993, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0b33147ac2af6b1635121c3686d0be2f?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Rodeen", "link": "https://stackoverflow.com/users/8495993/steve-rodeen"}, "is_accepted": false, "score": 1, "last_activity_date": 1504123795, "last_edit_date": 1504123795, "creation_date": 1504120546, "answer_id": 45968169, "question_id": 45967503, "link": "https://stackoverflow.com/questions/45967503/in-c-can-i-safely-initialize-an-unordered-map-with-values-from-different-file/45968169#45968169", "title": "In C++, can I safely initialize an unordered_map with values from different files?", "body": "<p>Although using a global context like this is not encouraged, here are some more items you should consider in addition to @Barry's answer:</p>\n\n<ol>\n<li>You should guard the <code>emplace</code> with a <code>mutex</code> (in case multiple threads try to add to the <code>unordered_map</code>) </li>\n<li>Optionally return the success argument of emplace (accessed by <code>second</code>). </li>\n<li>Forward your arguments to ensure perfect forwarding:</li>\n</ol>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>bool registerFoo(std::string &amp;&amp;name, std::function&lt;Foo *()&gt; &amp;&amp;factory)\n{\n    static std::mutex register_mutex;\n    std::lock_guard&lt;std::mutex&gt; lock(register_mutex);\n\n    return getFactory().emplace(\n            std::forward&lt;std::string&gt;(name),\n            std::forward&lt;std::std::function&lt;Foo *()&gt;&gt;(factory)\n        ).second;\n}\n</code></pre>\n\n<p>and then:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>static bool Baz = [](){ return registerFoo(\"baz\", []() { return new BazFoo(); })}();\n</code></pre>\n\n<p>Don't forget to make a facility to delete all these free function pointers when you don't need them anymore.</p>\n"}, {"comments": [{"owner": {"reputation": 22312, "user_id": 463758, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/105689a9cb392f18c1d0b27ed0cf657f?s=128&d=identicon&r=PG&f=1", "display_name": "balki", "link": "https://stackoverflow.com/users/463758/balki"}, "edited": false, "score": 1, "creation_date": 1504134115, "post_id": 45969843, "comment_id": 78900971, "body": "If the registerFunctions are called only during static initialization, it is thread safe and guaranteed by standard."}], "tags": [], "owner": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "is_accepted": false, "score": 1, "last_activity_date": 1504127918, "creation_date": 1504127918, "answer_id": 45969843, "question_id": 45967503, "link": "https://stackoverflow.com/questions/45967503/in-c-can-i-safely-initialize-an-unordered-map-with-values-from-different-file/45969843#45969843", "title": "In C++, can I safely initialize an unordered_map with values from different files?", "body": "<p>First, you want some thread safety:</p>\n\n<pre><code>template&lt;class T, class M=std::shared_timed_mutex&gt; // shared_mutex in C++17\nstruct mutex_guarded {\n  template&lt;class F&gt;\n  auto write( F&amp;&amp; f )\n  -&gt;std::decay_t&lt;std::result_of_t&lt;F(T&amp;)&gt;&gt; {\n    auto l = lock();\n    return std::forward&lt;F&gt;(f)(t);\n  }\n  template&lt;class F&gt;\n  auto read( F&amp;&amp; f ) const\n  -&gt;std::decay_t&lt;std::result_of_t&lt;F(T const&amp;)&gt;&gt; {\n    auto l = lock();\n    return std::forward&lt;F&gt;(f)(t);\n  }\n  mutex_guarded() {}\n  template&lt;class T0, class...Ts,\n    std::enable_if_t&lt;!std::is_same&lt;std::decay_t&lt;T0&gt;, mutex_guarded&gt;{},int&gt; =0\n  &gt;\n  mutex_guarded(T0&amp;&amp; t0, Ts&amp;&amp;...ts):\n    t(std::forward&lt;T0&gt;(t0), std::forward&lt;Ts&gt;(ts)...)\n  {}\n  mutex_guarded( mutex_guarded const&amp; o ):\n    t(o.copy_from())\n  {}\n  mutex_guarded( mutex_guarded &amp;&amp; o ):\n    t(o.move_from())\n  {}\n  mutex_guarded&amp; operator=(mutex_guarded const&amp;)=delete;\n  mutex_guarded&amp; operator=(mutex_guarded &amp;&amp;)=delete;\n  mutex_guarded&amp; operator=(T const&amp; t) {\n    write([&amp;t](T&amp; dest){dest=t;});\n    return *this;\n  }\n  mutex_guarded&amp; operator=(T&amp;&amp; t) {\n    write([&amp;t](T&amp; dest){dest=std::move(t);});\n    return *this;\n  }\nprivate:\n  T copy_from() const&amp; { return read( [](T const&amp; t){ return t; } ); }\n  T copy_from() &amp;&amp; { return move_from(); }\n  T move_from() { return write( [](T&amp; t){ return std::move(t); } ); }\n\n  std::unique_lock&lt;M&gt; lock() const {\n    return std::unique_lock&lt;M&gt;(m);\n  }\n  std::shared_lock&lt;M&gt; lock() {\n    return std::shared_lock&lt;M&gt;(m);\n  }\n   M m; // mutex\n   T t;\n};\n</code></pre>\n\n<p>which lets us have a:</p>\n\n<pre><code>using foo_factory = std::function&lt;std::unique_ptr&lt;Foo&gt;()&gt;;\nusing foo_factories = std::unordered_map&lt;std::string, foo_factory&gt;;\nmutex_guarded&lt;foo_factories&gt;&amp; get_foo_factories() {\n  static mutex_guarded&lt;foo_factories&gt; map;\n  return map;\n}\n</code></pre>\n\n<p>which has thread-safe initialization, then</p>\n\n<pre><code>void registerFoo(std::string name, std::function&lt;Foo *()&gt; factory)\n{\n  get_foo_factories().write([](auto&amp; f){f.emplace(name, factory);});\n}\n</code></pre>\n\n<p>is thread safe and guarantees initialization of the factories early enough.</p>\n\n<p>At shutdown, the timing of the destruction of the factories is both beyond your control (reverse order of construction) and may be too early.</p>\n\n<pre><code>mutex_guarded&lt;foo_factories&gt;*&amp; get_foo_factories() {\n  static auto* map = new mutex_guarded&lt;foo_factories&gt;;\n  return map;\n}\nvoid registerFoo(std::string name, std::function&lt;Foo *()&gt; factory)\n{\n  get_foo_factories()-&gt;write([](auto&amp; f){f.emplace(name, factory);});\n}\nvoid end_foo_factories() {\n  auto*&amp; ptr = get_foo_factories();\n  delete ptr; ptr = nullptr;\n}\n</code></pre>\n\n<p>this will place it on the heap where it is going to live a bit longer.  Note this also leaks both the factories and the map; manual destruction \"late enough\" can be added.  Note that this destruction is not thread safe, nor can it cheaply be made thread safe; it should occur after all threads have been cleaned up.</p>\n"}], "owner": {"reputation": 3338, "user_id": 85868, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/a3883ced75dbc92d6622b016ea6a6ef8?s=128&d=identicon&r=PG", "display_name": "Nuoji", "link": "https://stackoverflow.com/users/85868/nuoji"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 364, "favorite_count": 0, "accepted_answer_id": 45967584, "answer_count": 4, "score": 3, "last_activity_date": 1504134317, "creation_date": 1504117917, "last_edit_date": 1504118311, "question_id": 45967503, "link": "https://stackoverflow.com/questions/45967503/in-c-can-i-safely-initialize-an-unordered-map-with-values-from-different-file", "title": "In C++, can I safely initialize an unordered_map with values from different files?", "body": "<p>Imagine code like this:</p>\n\n<pre><code>std::unordered_map&lt;std::string, std::function&lt;Foo *()&gt;&gt; FooFactory;\nvoid registerFoo(std::string name, std::function&lt;Foo *()&gt; factory)\n{\n    FooFactory.emplace(name, factory);\n}\n</code></pre>\n\n<p>If I now would write code like this in another file:</p>\n\n<pre><code>static bool Baz = [](){ registerFoo(\"baz\", []() { return new BazFoo(); })}();\n</code></pre>\n\n<p>And yet another:</p>\n\n<pre><code>static bool Bar = [](){ registerFoo(\"bar\", []() { return new BarFoo(); })}();\n</code></pre>\n\n<p>In this case registerFoo is called as the program initializes, but FooFactory is then zeroed out, so the registered functions disappear.</p>\n\n<p>Is there a way to make this work in a safe, compiler-independent way (for c++14)?</p>\n"}, {"tags": ["c++", "redistributable", "vcredist", "visual-c++-2015", "visual-c++-2017"], "comments": [{"owner": {"reputation": 27952, "user_id": 3747990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/qE6kU.png?s=128&g=1", "display_name": "Niall", "link": "https://stackoverflow.com/users/3747990/niall"}, "edited": false, "score": 2, "creation_date": 1504130484, "post_id": 45967479, "comment_id": 78899931, "body": "Yes, they claim it is binary compatible. <a href=\"https://blogs.msdn.microsoft.com/vcblog/2017/03/07/binary-compatibility-and-pain-free-upgrade-why-moving-to-visual-studio-2017-is-almost-too-easy/\" rel=\"nofollow noreferrer\">blogs.msdn.microsoft.com/vcblog/2017/03/07/&hellip;</a>"}, {"owner": {"reputation": 323, "user_id": 3147529, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/Mksa4.jpg?s=128&g=1", "display_name": "Manjunath", "link": "https://stackoverflow.com/users/3147529/manjunath"}, "reply_to_user": {"reputation": 27952, "user_id": 3747990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/qE6kU.png?s=128&g=1", "display_name": "Niall", "link": "https://stackoverflow.com/users/3747990/niall"}, "edited": false, "score": 0, "creation_date": 1504211108, "post_id": 45967479, "comment_id": 78939228, "body": "@Niall : Where in the article is it specifically mentioned about Redistributable package? The article talks about toolset"}, {"owner": {"reputation": 27952, "user_id": 3747990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/qE6kU.png?s=128&g=1", "display_name": "Niall", "link": "https://stackoverflow.com/users/3747990/niall"}, "edited": false, "score": 0, "creation_date": 1504213698, "post_id": 45967479, "comment_id": 78940362, "body": "The 3 odd paragraphs under the heading <i>VC Runtime in MSVC 2017 is binary compatible with 2015</i>."}], "answers": [{"comments": [{"owner": {"reputation": 323, "user_id": 3147529, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/Mksa4.jpg?s=128&g=1", "display_name": "Manjunath", "link": "https://stackoverflow.com/users/3147529/manjunath"}, "edited": false, "score": 0, "creation_date": 1504119270, "post_id": 45967744, "comment_id": 78894700, "body": "So, how do i install <b>VC++2015Redist</b> on a machine that has <b>VC++2017Redist</b>?  When i try to do that, it <b>FAILS</b>"}, {"owner": {"reputation": 1739, "user_id": 1219052, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/2LXbb.png?s=128&g=1", "display_name": "Jimson Kannanthara James", "link": "https://stackoverflow.com/users/1219052/jimson-kannanthara-james"}, "reply_to_user": {"reputation": 323, "user_id": 3147529, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/Mksa4.jpg?s=128&g=1", "display_name": "Manjunath", "link": "https://stackoverflow.com/users/3147529/manjunath"}, "edited": false, "score": 0, "creation_date": 1504129313, "post_id": 45967744, "comment_id": 78899514, "body": "@ManjunathBabu What is the error you are getting? There shouldn&#39;t be any issue installing an earlier redistributable."}, {"owner": {"reputation": 4590, "user_id": 2879325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2503121b7e7487cd870c8afe40f0cf21?s=128&d=identicon&r=PG", "display_name": "Ext3h", "link": "https://stackoverflow.com/users/2879325/ext3h"}, "edited": false, "score": 1, "creation_date": 1504156361, "post_id": 45967744, "comment_id": 78906070, "body": "They are binary compatible actually... 2015 and 2017. You need at least the version of the runtime you compiled against (e.g. VC++2015Redist Update 3 if you are still working with VS2015), but a newer runtime with a compatible interface will also work perfectly fine. 2013 runtime was obviously not compatible, there have been interface changes."}, {"owner": {"reputation": 323, "user_id": 3147529, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/Mksa4.jpg?s=128&g=1", "display_name": "Manjunath", "link": "https://stackoverflow.com/users/3147529/manjunath"}, "reply_to_user": {"reputation": 1739, "user_id": 1219052, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/2LXbb.png?s=128&g=1", "display_name": "Jimson Kannanthara James", "link": "https://stackoverflow.com/users/1219052/jimson-kannanthara-james"}, "edited": false, "score": 0, "creation_date": 1504186963, "post_id": 45967744, "comment_id": 78925461, "body": "@Aczire : on a machine that has <b>VC++2017Redist</b>, if i install <b>VC++2015Redist</b>, the error log says &quot;Error 0x80070666: Cannot install a product when a newer version is installed&quot;"}, {"owner": {"reputation": 1739, "user_id": 1219052, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/2LXbb.png?s=128&g=1", "display_name": "Jimson Kannanthara James", "link": "https://stackoverflow.com/users/1219052/jimson-kannanthara-james"}, "reply_to_user": {"reputation": 323, "user_id": 3147529, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/Mksa4.jpg?s=128&g=1", "display_name": "Manjunath", "link": "https://stackoverflow.com/users/3147529/manjunath"}, "edited": false, "score": 0, "creation_date": 1504209871, "post_id": 45967744, "comment_id": 78938667, "body": "@ManjunathBabu That is because &quot;VC++2017Redist&quot; is an in-place upgrade of &quot;VC++2015Redist&quot;, on a binary level. In fact you need only &quot;VC++2017Redist&quot;, not &quot;VC++2015Redist&quot;."}, {"owner": {"reputation": 323, "user_id": 3147529, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/Mksa4.jpg?s=128&g=1", "display_name": "Manjunath", "link": "https://stackoverflow.com/users/3147529/manjunath"}, "reply_to_user": {"reputation": 1739, "user_id": 1219052, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/2LXbb.png?s=128&g=1", "display_name": "Jimson Kannanthara James", "link": "https://stackoverflow.com/users/1219052/jimson-kannanthara-james"}, "edited": false, "score": 0, "creation_date": 1504211306, "post_id": 45967744, "comment_id": 78939291, "body": "@Aczire: Where is it mentioned officially? Can applications built using <b>VC++2015Redist</b> run on a clean machine with only <b>VC++2017Redist</b> installed?"}, {"owner": {"reputation": 11532, "user_id": 5129715, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/320498457784a3110f3e256745a9a927?s=128&d=identicon&r=PG&f=1", "display_name": "mksteve", "link": "https://stackoverflow.com/users/5129715/mksteve"}, "edited": false, "score": 1, "creation_date": 1504211486, "post_id": 45967744, "comment_id": 78939377, "body": "The 2 redistributable packages install files with the same name (e.g. msvcr140.dll),  given that they have previously renamed the files for each release, I would assume they are meant to be compatible.  However, there is no strong statement from MS to use the VS2017 package as it is bug-fixed that I could find"}], "tags": [], "owner": {"reputation": 11532, "user_id": 5129715, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/320498457784a3110f3e256745a9a927?s=128&d=identicon&r=PG&f=1", "display_name": "mksteve", "link": "https://stackoverflow.com/users/5129715/mksteve"}, "is_accepted": false, "score": 2, "last_activity_date": 1504129851, "last_edit_date": 1504129851, "creation_date": 1504118828, "answer_id": 45967744, "question_id": 45967479, "link": "https://stackoverflow.com/questions/45967479/can-visual-c-2017-redistributable-package-support-the-applications-that-use-vc/45967744#45967744", "title": "Can Visual C++ 2017 Redistributable package support the applications that use VC2015?", "body": "<p>No they won't work</p>\n\n<p>The redistributable package is a .exe, which installs  the required DLLs</p>\n\n<pre><code>msvcrtXXXX.dll\n</code></pre>\n\n<p>Where XXXX changes per build (VS2017, VS2015,...)</p>\n\n<p>It is also not reference counted, which means no matter how many people install it, one uninstall rips out the files.</p>\n\n<h2>UPDATE</h2>\n\n<p>The Visual Studio 2017 does not change the version number</p>\n\n<pre><code>VS2017  msvcr140.dll\nVS2015  msvcr140.dll\n\nVS2013  msvcr120.dll\nVS2012  msvcr110.dll\nVS2010  msvcr100.dll\nVS2008  msvcr90.dll\n</code></pre>\n\n<p>Thus Microsoft believe that the VS 2015 and VS 2017 redistributable packages are compatible. </p>\n\n<p>Unfortunately, looking for downloads of VS2015 and VS2017, they are both available, so there may be subtle differences.</p>\n\n<p>If the 2015 does not install, it will be because it thinks it is less good than the already installed 2017.  However I have failed to find strong documentation that this is what Microsoft expects.</p>\n"}], "owner": {"reputation": 323, "user_id": 3147529, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/Mksa4.jpg?s=128&g=1", "display_name": "Manjunath", "link": "https://stackoverflow.com/users/3147529/manjunath"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3248, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1504129851, "creation_date": 1504117845, "question_id": 45967479, "link": "https://stackoverflow.com/questions/45967479/can-visual-c-2017-redistributable-package-support-the-applications-that-use-vc", "title": "Can Visual C++ 2017 Redistributable package support the applications that use VC2015?", "body": "<p>If i install just <strong>Visual C++ 2017 Redistributable</strong> on my machine, can it support applications that was written for <strong>2015</strong></p>\n\n<p>in other words, if I uninstall <strong>Visual C++ 2015 Redistributable</strong> and install <strong>Visual C++ 2017 Redistributable</strong>, will all the applications work without any errors?</p>\n"}, {"tags": ["c++"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2100815"}, "edited": false, "score": 0, "creation_date": 1504117617, "post_id": 45967321, "comment_id": 78893807, "body": "Read up on <code>private</code> and  <code>friend</code>."}], "answers": [{"comments": [{"owner": {"reputation": 7413, "user_id": 304974, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/c0bad048f40991e627962d8341092b1d?s=128&d=identicon&r=PG", "display_name": "Programmer", "link": "https://stackoverflow.com/users/304974/programmer"}, "edited": false, "score": 0, "creation_date": 1504118324, "post_id": 45967426, "comment_id": 78894199, "body": "Would the destructor of B will also call destructor of A - which is what currently I do not wish to happen?"}, {"owner": {"reputation": 2374, "user_id": 8491726, "user_type": "registered", "profile_image": "https://graph.facebook.com/1550562035006492/picture?type=large", "display_name": "Artemy Vysotsky", "link": "https://stackoverflow.com/users/8491726/artemy-vysotsky"}, "reply_to_user": {"reputation": 7413, "user_id": 304974, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/c0bad048f40991e627962d8341092b1d?s=128&d=identicon&r=PG", "display_name": "Programmer", "link": "https://stackoverflow.com/users/304974/programmer"}, "edited": false, "score": 0, "creation_date": 1504118457, "post_id": 45967426, "comment_id": 78894275, "body": "There is no instance of A constructed - so no destructor will be called anywhere"}, {"owner": {"reputation": 7413, "user_id": 304974, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/c0bad048f40991e627962d8341092b1d?s=128&d=identicon&r=PG", "display_name": "Programmer", "link": "https://stackoverflow.com/users/304974/programmer"}, "edited": false, "score": 0, "creation_date": 1504118896, "post_id": 45967426, "comment_id": 78894512, "body": "Thanks - one clarification - so when B destructor is called - class A static variable will still exists in memory and not be destroyed - in other words they would be destroyed only when program terminates?"}, {"owner": {"reputation": 2374, "user_id": 8491726, "user_type": "registered", "profile_image": "https://graph.facebook.com/1550562035006492/picture?type=large", "display_name": "Artemy Vysotsky", "link": "https://stackoverflow.com/users/8491726/artemy-vysotsky"}, "reply_to_user": {"reputation": 7413, "user_id": 304974, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/c0bad048f40991e627962d8341092b1d?s=128&d=identicon&r=PG", "display_name": "Programmer", "link": "https://stackoverflow.com/users/304974/programmer"}, "edited": false, "score": 0, "creation_date": 1504119023, "post_id": 45967426, "comment_id": 78894587, "body": "Yes static variables are initialized before main starts and destructed after main finished"}], "tags": [], "owner": {"reputation": 2374, "user_id": 8491726, "user_type": "registered", "profile_image": "https://graph.facebook.com/1550562035006492/picture?type=large", "display_name": "Artemy Vysotsky", "link": "https://stackoverflow.com/users/8491726/artemy-vysotsky"}, "is_accepted": true, "score": 4, "last_activity_date": 1504118293, "last_edit_date": 1504118293, "creation_date": 1504117689, "answer_id": 45967426, "question_id": 45967321, "link": "https://stackoverflow.com/questions/45967321/a-class-to-be-accessed-by-another-class-only/45967426#45967426", "title": "A Class to be accessed by another class only", "body": "<p>Define <code>A</code> inside <code>B</code> as private class.</p>\n\n<pre><code>#include &lt;iostream&gt;\n\nclass B\n{\n    class A\n    {\n    private:\n        static int x;\n    public:\n        static int y;\n        static int getX() {\n            return A::x;\n        }\n        static void setX(int z) {\n            A::x = z;\n        }\n    };\n\npublic:\n    void showX() {\n        A::setX(9) ;\n        std::cout &lt;&lt; A::getX() &lt;&lt; std::endl;\n    }\n    void showY() {\n        A::y = 8;\n        std::cout &lt;&lt; A::y &lt;&lt; std::endl;\n    }\n};\n\nint B::A::x = 0;\nint B::A::y = 0;\n\nint main()\n{\n    B b1;\n    b1.showX();\n    b1.showY();\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 7413, "user_id": 304974, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/c0bad048f40991e627962d8341092b1d?s=128&d=identicon&r=PG", "display_name": "Programmer", "link": "https://stackoverflow.com/users/304974/programmer"}, "edited": false, "score": 0, "creation_date": 1504118338, "post_id": 45967427, "comment_id": 78894207, "body": "Would the destructor of B will also call destructor of A - which is what currently I do not wish to happen?"}, {"owner": {"reputation": 96896, "user_id": 2296458, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/wbG2s.png?s=128&g=1", "display_name": "Cory Kramer", "link": "https://stackoverflow.com/users/2296458/cory-kramer"}, "reply_to_user": {"reputation": 7413, "user_id": 304974, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/c0bad048f40991e627962d8341092b1d?s=128&d=identicon&r=PG", "display_name": "Programmer", "link": "https://stackoverflow.com/users/304974/programmer"}, "edited": false, "score": 0, "creation_date": 1504118518, "post_id": 45967427, "comment_id": 78894295, "body": "No it would not, because <code>B</code> does not have an <code>A</code> member, it is merely the scope that the definition lies in."}, {"owner": {"reputation": 7413, "user_id": 304974, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/c0bad048f40991e627962d8341092b1d?s=128&d=identicon&r=PG", "display_name": "Programmer", "link": "https://stackoverflow.com/users/304974/programmer"}, "edited": false, "score": 0, "creation_date": 1504118935, "post_id": 45967427, "comment_id": 78894542, "body": "Thanks - one clarification - so when B destructor is called - class A static variable will still exists in memory and not be destroyed - in other words they would be destroyed only when program terminates?"}], "tags": [], "owner": {"reputation": 96896, "user_id": 2296458, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/wbG2s.png?s=128&g=1", "display_name": "Cory Kramer", "link": "https://stackoverflow.com/users/2296458/cory-kramer"}, "is_accepted": false, "score": 3, "last_activity_date": 1504117693, "creation_date": 1504117693, "answer_id": 45967427, "question_id": 45967321, "link": "https://stackoverflow.com/questions/45967321/a-class-to-be-accessed-by-another-class-only/45967427#45967427", "title": "A Class to be accessed by another class only", "body": "<p>If the class should <em>only</em> be known in one other class, then I would say it should be a private implementation detail of that class</p>\n\n<pre><code>class B\n{\nprivate:\n    class A\n    {\n    private:\n        static int x;\n    public:\n        static int y;\n        static int getX(){ return A::x;}\n        static void setX(int z){ A::x = z;}\n    };\n\npublic:\n    void showX(){A::setX(9) ; std::cout &lt;&lt; A::getX() &lt;&lt; std::endl;}\n    void showY(){A::y = 8; std::cout &lt;&lt; A::y &lt;&lt; std::endl;}\n};\n\nint B::A::x = 0;\nint B::A::y = 0;\n\nint main()\n{\n    B b1;\n    b1.showX();\n    b1.showY();\n}\n</code></pre>\n\n<p>Now the existence of <code>A</code> isn't known by anyone except <code>B</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "is_accepted": false, "score": 2, "last_activity_date": 1504118220, "last_edit_date": 1504118220, "creation_date": 1504117840, "answer_id": 45967477, "question_id": 45967321, "link": "https://stackoverflow.com/questions/45967321/a-class-to-be-accessed-by-another-class-only/45967477#45967477", "title": "A Class to be accessed by another class only", "body": "<p>CRTP lets you do this without touching B:</p>\n\n<pre><code>class B;\n\ntemplate&lt;class A&gt;\nclass A_shared_with_B {\nprivate:\n  static int y;\n  static int getX(){ return A::x;}\n  static void setX(int z){ A::x = z;}\n  friend class B;\n};\n\nclass A:public A_shared_with_B&lt;A&gt; {\n  friend class A_shared_with_B&lt;A&gt;;\nprivate:\n  static int x;\n};\n</code></pre>\n\n<p>now <code>B</code> has access to the <code>private</code> contents of <code>A_shared_with_B</code>, <code>A_shared_with_B</code> has access to the <code>private</code> contents of <code>A</code>, and <code>B</code> does not have direct access to the <code>private</code> contents of <code>A</code>.</p>\n\n<p>If you are willing to modify <code>B</code> and rename <code>A</code>, naming <code>A</code> within the <code>private</code> section of <code>B</code> makes the name difficult to reach from outside <code>B</code>, which is similar to the above access control.  A nice advantage to this technique is that you can grant proxy access to <code>A</code> by passing an otherwise useless instance of <code>A</code> to an external <code>template</code> function:</p>\n\n<pre><code>template&lt;class A&gt;\nvoid has_proxy_A_access( A ) {\n  std::cout &lt;&lt; A::getX();\n}\n</code></pre>\n\n<p>where instances of <code>B</code> can call <code>has_proxy_A_access( A{} )</code> and grant rights to use <code>A</code> to a given (template) function.</p>\n"}, {"tags": [], "owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "is_accepted": false, "score": 0, "last_activity_date": 1504117890, "creation_date": 1504117890, "answer_id": 45967494, "question_id": 45967321, "link": "https://stackoverflow.com/questions/45967321/a-class-to-be-accessed-by-another-class-only/45967494#45967494", "title": "A Class to be accessed by another class only", "body": "<p>There are already answer showing how to make <code>A</code> an inner class. For the sake of completeness here is the <code>private</code>+<code>friend</code> solution (already proposed in a comment by Neil Butterworth):</p>\n\n<pre><code>#include &lt;iostream&gt;\nclass A {\nprivate:\n    friend class B;\n    static int x;  \n    static int y;\n    static getX(){ return A::x;}\n    static setX(int z){ A::x = z;}\n};\n</code></pre>\n\n<p>A <code>friend</code> has access to all members of a class, so you can make all members of <code>A</code> private and grant only <code>B</code> access to them by making it a friend. </p>\n"}], "owner": {"reputation": 7413, "user_id": 304974, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/c0bad048f40991e627962d8341092b1d?s=128&d=identicon&r=PG", "display_name": "Programmer", "link": "https://stackoverflow.com/users/304974/programmer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 45967426, "answer_count": 4, "score": 2, "last_activity_date": 1504118293, "creation_date": 1504117332, "question_id": 45967321, "link": "https://stackoverflow.com/questions/45967321/a-class-to-be-accessed-by-another-class-only", "title": "A Class to be accessed by another class only", "body": "<p>I have a class which declares some static variables:</p>\n\n<pre><code>#include &lt;iostream&gt;\nclass A\n{\nprivate:\nstatic int x;\npublic:\nstatic int y;\nstatic getX(){ return A::x;}\nstatic setX(int z){ A::x = z;}\n};\n\nint A::x = 0;\nint A::y = 0;\n</code></pre>\n\n<p>Now class A can be accessed by anyone/anywhere and its member variables can be manipulate. How can I allow only one another class that will have access to class A static variables / methods?</p>\n\n<pre><code>class B\n{\npublic:\nvoid showX(){A::setX(9) ; std::cout &lt;&lt; A::getX() &lt;&lt; std::endl;}\nvoid showY(){A::y = 8; std::cout &lt;&lt; A::y &lt;&lt; std::endl;}\n};\n\nint main()\n{\nB b1;\nb1.showX();\nb1.showY();\n}\n</code></pre>\n"}, {"tags": ["c++", "actionscript-3", "adobe", "alchemy", "flascc"], "comments": [{"owner": {"reputation": 6528, "user_id": 4687633, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Oc0kJ.jpg?s=128&g=1", "display_name": "Organis", "link": "https://stackoverflow.com/users/4687633/organis"}, "edited": false, "score": 0, "creation_date": 1504121583, "post_id": 45967158, "comment_id": 78895909, "body": "Not clear what you want with <i>CrossBridge without FlasCC</i> because CrossBridge <b>is</b> FlashCC: <a href=\"http://adobe-flash.github.io/crossbridge/\" rel=\"nofollow noreferrer\">adobe-flash.github.io/crossbridge</a> There&#39;s a link to GitHub repository on that page, and there are <b>./samples</b> folder with about 20 presumably compilible sample  projects."}, {"owner": {"reputation": 13, "user_id": 8099418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb40490a6031f6c10dba4fa432cc8d92?s=128&d=identicon&r=PG&f=1", "display_name": "Gaspar Vardanyan", "link": "https://stackoverflow.com/users/8099418/gaspar-vardanyan"}, "reply_to_user": {"reputation": 6528, "user_id": 4687633, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Oc0kJ.jpg?s=128&g=1", "display_name": "Organis", "link": "https://stackoverflow.com/users/4687633/organis"}, "edited": false, "score": 0, "creation_date": 1504125469, "post_id": 45967158, "comment_id": 78897862, "body": "&quot;C:\\CrossBridge_15.0.0.3\\sdk\\usr\\bin\\gcc.exe&quot; hello.c -o hello.exe"}, {"owner": {"reputation": 13, "user_id": 8099418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb40490a6031f6c10dba4fa432cc8d92?s=128&d=identicon&r=PG&f=1", "display_name": "Gaspar Vardanyan", "link": "https://stackoverflow.com/users/8099418/gaspar-vardanyan"}, "reply_to_user": {"reputation": 6528, "user_id": 4687633, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Oc0kJ.jpg?s=128&g=1", "display_name": "Organis", "link": "https://stackoverflow.com/users/4687633/organis"}, "edited": false, "score": 0, "creation_date": 1504125483, "post_id": 45967158, "comment_id": 78897869, "body": "Does not working!"}, {"owner": {"reputation": 13, "user_id": 8099418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb40490a6031f6c10dba4fa432cc8d92?s=128&d=identicon&r=PG&f=1", "display_name": "Gaspar Vardanyan", "link": "https://stackoverflow.com/users/8099418/gaspar-vardanyan"}, "reply_to_user": {"reputation": 6528, "user_id": 4687633, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Oc0kJ.jpg?s=128&g=1", "display_name": "Organis", "link": "https://stackoverflow.com/users/4687633/organis"}, "edited": false, "score": 0, "creation_date": 1504125550, "post_id": 45967158, "comment_id": 78897893, "body": "Error: <a href=\"http://imgur.com/a/CtKdW\" rel=\"nofollow noreferrer\">imgur.com/a/CtKdW</a>"}, {"owner": {"reputation": 12172, "user_id": 2057709, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0R41X.png?s=128&g=1", "display_name": "VC.One", "link": "https://stackoverflow.com/users/2057709/vc-one"}, "edited": false, "score": 0, "creation_date": 1504130563, "post_id": 45967158, "comment_id": 78899960, "body": "@GasparVardanyan try to copy/paste the CMD error text into your question (via <a href=\"https://stackoverflow.com/posts/45967158/edit\"><b>editing</b></a>). Are you saying GCC does not compile <code>hello.c</code>? Is that your real question, how to compile a C program with Crossbridge? Also instead of <b>gcc.exe</b> running in <code>cmd.exe</code> window, shouldn&#39;t it be running via terminal tool like <code>bash.exe</code> or <code>mintty.exe</code>? I haven&#39;t done this for around 3 years after a couple of small projects (mine was about using AS3 code inside a C program, yours is other way around)."}, {"owner": {"reputation": 13, "user_id": 8099418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb40490a6031f6c10dba4fa432cc8d92?s=128&d=identicon&r=PG&f=1", "display_name": "Gaspar Vardanyan", "link": "https://stackoverflow.com/users/8099418/gaspar-vardanyan"}, "edited": false, "score": 0, "creation_date": 1504130978, "post_id": 45967158, "comment_id": 78900091, "body": "Please check my makefile syntax:"}, {"owner": {"reputation": 13, "user_id": 8099418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb40490a6031f6c10dba4fa432cc8d92?s=128&d=identicon&r=PG&f=1", "display_name": "Gaspar Vardanyan", "link": "https://stackoverflow.com/users/8099418/gaspar-vardanyan"}, "edited": false, "score": 0, "creation_date": 1504130987, "post_id": 45967158, "comment_id": 78900098, "body": "$make FLEX=/cygdrive/c/flexairsdk/4.6.0+25.0.0 FLASCC=/cygdrive/c/CrossBridge_15.0.0.3/sdk  &quot;/cygdrive/c/flascc/sdk/usr/bin/gcc&quot; -Werror -Wno-write-strings -Wno-trigraphs hello.c -o hello.exe  &quot;/cygdrive/c/flascc/sdk/usr/bin/gcc&quot; -Werror -Wno-write-strings -Wno-trigraphs hello.c -emit-swf -swf-size=200x200 -o hello.swf"}, {"owner": {"reputation": 13, "user_id": 8099418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb40490a6031f6c10dba4fa432cc8d92?s=128&d=identicon&r=PG&f=1", "display_name": "Gaspar Vardanyan", "link": "https://stackoverflow.com/users/8099418/gaspar-vardanyan"}, "edited": false, "score": 0, "creation_date": 1504131032, "post_id": 45967158, "comment_id": 78900115, "body": "how to compile hello.cpp using crossbridge? please give me full cmd code."}, {"owner": {"reputation": 12172, "user_id": 2057709, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0R41X.png?s=128&g=1", "display_name": "VC.One", "link": "https://stackoverflow.com/users/2057709/vc-one"}, "edited": false, "score": 0, "creation_date": 1504198524, "post_id": 45967158, "comment_id": 78933158, "body": "(1) To copy text from command line, right-click inside windows and choose <code>mark</code> to select the text (selected has white highlight) and press <code>[enter]</code> to copy. Paste the error message text into your question. The picture cuts off some information (maybe important?)..."}, {"owner": {"reputation": 12172, "user_id": 2057709, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0R41X.png?s=128&g=1", "display_name": "VC.One", "link": "https://stackoverflow.com/users/2057709/vc-one"}, "edited": false, "score": 0, "creation_date": 1504199116, "post_id": 45967158, "comment_id": 78933458, "body": "(2) To compile, don&#39;t use <code>cmd.exe</code> as terminal. Crossbridge works in a Linux/Unix environment so you must install CygWin as a sort of emulator (if you cancelled before, you&#39;ll have to do it again). Once installed, there should be some icon on your desktop called <code>Cygwin Terminal</code>. Use that terminal app (<code>mintty.exe</code>) to compile. Test if ready to compile by typing <code>gcc</code> and press [enter] it should say <i>&quot;No input files&quot;</i> or you can type <code>ls</code> then if it does <b>not</b> say <i>&quot;bash: ls: command not found&quot;</i> but instead shows you some filenames then you know it works okay."}, {"owner": {"reputation": 12172, "user_id": 2057709, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0R41X.png?s=128&g=1", "display_name": "VC.One", "link": "https://stackoverflow.com/users/2057709/vc-one"}, "edited": false, "score": 0, "creation_date": 1504199895, "post_id": 45967158, "comment_id": 78933866, "body": "(3) Compile <code>.c</code> files by using the C compiler <b>gcc</b> ... and compile <code>.cpp</code> files by using the C++ compiler <b>g++</b>. For <code>hello.cpp</code> open the Cygwin terminal and type <code>g++ hello.cpp -o hello.exe</code> (I don&#39;t remember ever needing to use a makefile when compiling. For some code like their included bitmap demo, I had to increase Java memory by options but that was on 32-bit XP years ago)."}], "owner": {"reputation": 13, "user_id": 8099418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb40490a6031f6c10dba4fa432cc8d92?s=128&d=identicon&r=PG&f=1", "display_name": "Gaspar Vardanyan", "link": "https://stackoverflow.com/users/8099418/gaspar-vardanyan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 128, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1504131427, "creation_date": 1504116722, "last_edit_date": 1504131427, "question_id": 45967158, "link": "https://stackoverflow.com/questions/45967158/flascc-alchemy-crossbridge-how-to-use-c-class-in-actionscript3-code", "title": "FlasCC, Alchemy, CrossBridge - How to use C++ class in ActionScript3 code?", "body": "<p>How can I use c++ class in ActionScript3?\nI want to use the BulletPhysics physics library (C++) in my ActionScript3 game.\nHow can I do it and compile my game (AS3) main class as document class (create main.cpp and addChild as3 main class? how?) in CrossBridge (without FlasCC, only CMD, Makefile and Notepad++)?</p>\n"}, {"tags": ["c++", "struct"], "comments": [{"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 6, "creation_date": 1504116780, "post_id": 45967156, "comment_id": 78893329, "body": "They are the same thing.  A <code>class</code> is a <code>struct</code> where the default access modifier is <code>private</code> instead of <code>public</code>.  That means they make objects"}, {"owner": {"reputation": 42093, "user_id": 263681, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/88a2ac240cf91002e13cbef1927e2302?s=128&d=identicon&r=PG", "display_name": "Grant Thomas", "link": "https://stackoverflow.com/users/263681/grant-thomas"}, "edited": false, "score": 2, "creation_date": 1504116801, "post_id": 45967156, "comment_id": 78893339, "body": "Instances of structs are still objects"}, {"owner": {"reputation": 4326, "user_id": 8370633, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/gxmCt.png?s=128&g=1", "display_name": "ImaginaryHuman072889", "link": "https://stackoverflow.com/users/8370633/imaginaryhuman072889"}, "edited": false, "score": 0, "creation_date": 1504116896, "post_id": 45967156, "comment_id": 78893414, "body": "Thanks. I knew the difference between class and struct, but didn&#39;t realize that an instance of either are both called objects."}, {"owner": {"reputation": 3671, "user_id": 4227175, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/ce475809b37f81b6c7838ae53e451425?s=128&d=identicon&r=PG&f=1", "display_name": "ghchoi", "link": "https://stackoverflow.com/users/4227175/ghchoi"}, "edited": false, "score": 0, "creation_date": 1504116896, "post_id": 45967156, "comment_id": 78893415, "body": "I usually call &#39;class instance&#39; and &#39;struct instance.&#39; haha..."}], "answers": [{"comments": [{"owner": {"reputation": 6440, "user_id": 27302, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0ee0b2f006682f28d5a6ba5634ade513?s=128&d=identicon&r=PG", "display_name": "Daniel H", "link": "https://stackoverflow.com/users/27302/daniel-h"}, "edited": false, "score": 0, "creation_date": 1504116980, "post_id": 45967184, "comment_id": 78893468, "body": "More information is at <a href=\"http://en.cppreference.com/w/cpp/language/object\" rel=\"nofollow noreferrer\">en.cppreference.com/w/cpp/language/object</a>. The standard, when it needs to be more precise, says \u201cobject of class type\u201d or similar. Structs, classes, and even unions and lambdas are class types; functions, ints, arrays, pointers, etc. aren\u2019t."}, {"owner": {"reputation": 30540, "user_id": 719263, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7feab598abfc27783641fe2b796a0155?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Yun&#232;s", "link": "https://stackoverflow.com/users/719263/jean-baptiste-yun%c3%a8s"}, "reply_to_user": {"reputation": 6440, "user_id": 27302, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0ee0b2f006682f28d5a6ba5634ade513?s=128&d=identicon&r=PG", "display_name": "Daniel H", "link": "https://stackoverflow.com/users/27302/daniel-h"}, "edited": false, "score": 0, "creation_date": 1504117874, "post_id": 45967184, "comment_id": 78893936, "body": "@DanielH , functions are  very specials because they are not objects, while ints are (objects of fundamental type not of class type)."}, {"owner": {"reputation": 6440, "user_id": 27302, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0ee0b2f006682f28d5a6ba5634ade513?s=128&d=identicon&r=PG", "display_name": "Daniel H", "link": "https://stackoverflow.com/users/27302/daniel-h"}, "reply_to_user": {"reputation": 30540, "user_id": 719263, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7feab598abfc27783641fe2b796a0155?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Yun&#232;s", "link": "https://stackoverflow.com/users/719263/jean-baptiste-yun%c3%a8s"}, "edited": false, "score": 0, "creation_date": 1504118570, "post_id": 45967184, "comment_id": 78894320, "body": "@Jean-BaptisteYun&#232;s I think references are technically not objects either. However, references and functions still both have types. The full type hierarchy seems to be <a href=\"http://en.cppreference.com/w/cpp/language/type#Type_classification\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 30540, "user_id": 719263, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7feab598abfc27783641fe2b796a0155?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Yun&#232;s", "link": "https://stackoverflow.com/users/719263/jean-baptiste-yun%c3%a8s"}, "edited": false, "score": 1, "creation_date": 1504119702, "post_id": 45967184, "comment_id": 78894935, "body": "cppreference is not the reference about the language. Standard says that except references and functions every thing else is an object."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user2100815"}, "is_accepted": true, "score": 7, "last_activity_date": 1504116800, "creation_date": 1504116800, "answer_id": 45967184, "question_id": 45967156, "link": "https://stackoverflow.com/questions/45967156/is-there-a-proper-name-for-instance-of-struct/45967184#45967184", "title": "Is there a proper name for instance of struct?", "body": "<p>Instances of structs, classes, ints, unions, floats etc. are all objects.</p>\n"}, {"tags": [], "owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "is_accepted": false, "score": 1, "last_activity_date": 1504119748, "last_edit_date": 1504119748, "creation_date": 1504118723, "answer_id": 45967721, "question_id": 45967156, "link": "https://stackoverflow.com/questions/45967156/is-there-a-proper-name-for-instance-of-struct/45967721#45967721", "title": "Is there a proper name for instance of struct?", "body": "<p>The only difference between <code>struct</code> and <code>class</code> is the default access when you declare a class (whether you use <code>struct</code> or <code>class</code>, what you declare is a class!). This two:</p>\n\n<pre><code>struct Foo : private Bar { private: int x; };\nclass Foo : Bar { int x; };\n</code></pre>\n\n<p>as well as this two:</p>\n\n<pre><code>struct Foo : Bar { int x; };\nclass Foo : public Bar { public: int x; };\n</code></pre>\n\n<p>are equivalent. Having an object there is no way to tell from that object, whether the class was declared using the keyword <code>struct</code> or <code>class</code>.</p>\n\n<p>From <a href=\"http://en.cppreference.com/w/cpp/types/is_class\" rel=\"nofollow noreferrer\">cppreference</a> on the type trait <code>is_class</code>:</p>\n\n<blockquote>\n  <p>Note that types declared with the struct keyword are classes, so this\n  trait is true for \"structs\".</p>\n</blockquote>\n\n<p>And <a href=\"http://en.cppreference.com/w/cpp/language/type#Type_classification\" rel=\"nofollow noreferrer\">the docs on type classification</a> have this enumeration:</p>\n\n<blockquote>\n  <p>Types are grouped in various categories based on their properties:</p>\n  \n  <ul>\n  <li>object type is a (possibly cv-qualified) type that is not a function type, not a reference type, and not void type (see also\n  std::is_object);</li>\n  <li>scalar types are [...]</li>\n  <li>trivial types [...]</li>\n  </ul>\n</blockquote>\n\n<p><strong>TL;DR</strong></p>\n\n<p>C++ does not have structs and classes, but only classes. </p>\n\n<p>Or... if you are fine with a little bit of misleading terminology: Instances of structs and classes are both objects.</p>\n"}], "owner": {"reputation": 4326, "user_id": 8370633, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/gxmCt.png?s=128&g=1", "display_name": "ImaginaryHuman072889", "link": "https://stackoverflow.com/users/8370633/imaginaryhuman072889"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 210, "favorite_count": 0, "accepted_answer_id": 45967184, "answer_count": 2, "score": 2, "last_activity_date": 1504119748, "creation_date": 1504116721, "question_id": 45967156, "link": "https://stackoverflow.com/questions/45967156/is-there-a-proper-name-for-instance-of-struct", "title": "Is there a proper name for instance of struct?", "body": "<p>Instances of classes are called objects, but is there a certain name for instances of structs?</p>\n\n<p>Having the separate terms \"class\" and \"object\" is useful to distinguish between the class and the instance of the class, but I've only ever heard of the single term \"struct\" to refer to either the struct or the instance of the struct (depending on context).</p>\n"}, {"tags": ["c++", "constructor"], "comments": [{"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 2, "creation_date": 1504116452, "post_id": 45967028, "comment_id": 78893168, "body": "Try with <code>std::map::emplace</code>. <code>make_pair</code> copies the temporary <code>Person</code>. <code>insert</code> copies the pair which copies it&#39;s member <code>Person</code>."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 1, "creation_date": 1504117033, "post_id": 45967028, "comment_id": 78893500, "body": "In c++17 you do not even need to make a temporary <code>Person</code>.  In older standards you can use piecewise construction. See <a href=\"https://stackoverflow.com/questions/27960325/stdmap-emplace-without-copying-value\" title=\"stdmap emplace without copying value\">stackoverflow.com/questions/27960325/&hellip;</a>"}, {"owner": {"reputation": 585, "user_id": 724111, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/X2gsI.jpg?s=128&g=1", "display_name": "WriteBackCMO", "link": "https://stackoverflow.com/users/724111/writebackcmo"}, "reply_to_user": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1504117300, "post_id": 45967028, "comment_id": 78893633, "body": "tried with ppl.emplace(1, Person(&quot;jo&quot;, 10)), one explicit constructor and one copy constructor. I think the explciit is for Person(&quot;jo&quot;, 10). The copy constructor is to copy temporary Person(&quot;jo&quot;, 10) to some internal pair?"}], "owner": {"reputation": 585, "user_id": 724111, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/X2gsI.jpg?s=128&g=1", "display_name": "WriteBackCMO", "link": "https://stackoverflow.com/users/724111/writebackcmo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 38, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1504116289, "creation_date": 1504116289, "question_id": 45967028, "link": "https://stackoverflow.com/questions/45967028/default-constructor-copy-constructor-explicit-constructor", "title": "default_constructor/copy_constructor/explicit constructor", "body": "<p>I have the following class and some constructors: </p>\n\n<p><strong>default constructor</strong> assigns empty string and 0</p>\n\n<p><strong>copy constructor</strong> copies reference's field to the instance's filed</p>\n\n<p><strong>explicit constructor</strong> takes in one string and one integer and assigns them to the field</p>\n\n<ol>\n<li><strong>Without</strong> the lines between the \"//////\", the output is like </li>\n</ol>\n\n<blockquote>\n  <p>explicit constructor</p>\n  \n  <p>default constructor</p>\n</blockquote>\n\n<p>My understanding is: the right hand side is evaluated first. That is using an explicit constructor. It then creates one entry with default constructor and assigns the fields from the instance constructed with explicit constructor to the instance constructed by the default constructor.</p>\n\n<p>ppl[0] = Person(\"Mike\", 20);</p>\n\n<ol start=\"2\">\n<li>With the lines bwtween \"////\", the output looks like</li>\n</ol>\n\n<blockquote>\n  <p>explicit constructor </p>\n  \n  <p>default constructor </p>\n  \n  <p>explicit constructor </p>\n  \n  <p>copy constructor </p>\n  \n  <p>copy constructor</p>\n</blockquote>\n\n<p>The first two are just like above.\nHow about explcit + copy + copy?\nI think the explicit is for Person(\"jo\", 10).\n<strong>How to explain the two copy constructor?</strong></p>\n\n<pre><code>    class Person{\n    private:\n    string name;\n    int age;\n    public:\n    Person(){\n      cout&lt;&lt;\"default constructor\"&lt;&lt;endl;\n      name=\"\";\n      age = 0;\n    }\n    Person(const Person &amp;other){\n      cout&lt;&lt;\"copy constructor\"&lt;&lt;endl;\n      name = other.name;\n      age = other.age;\n    }\n    Person(string name, int age){\n      cout&lt;&lt;\"explicit constructor\"&lt;&lt;endl;\n      this-&gt;name = name;\n      this-&gt;age = age;\n    }\n    };\n\n    int main(){\n\n    map&lt;int, Person&gt; ppl;\n\n    ppl[0] = Person(\"Mike\", 20);\n    ////////////////////////////////////////////\n    ppl.insert(make_pair(1, Person(\"jo\", 10)));\n    ////////////////////////////////////////////\n    return 0;\n    }\n</code></pre>\n"}, {"tags": ["c++", "multidimensional-array", "vector"], "comments": [{"owner": {"reputation": 147720, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 3, "creation_date": 1504116051, "post_id": 45966933, "comment_id": 78892944, "body": "Nested vectors won&#39;t give you terribly good performance. Consider using a flat vector of doubles with varying index calculation."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 1, "creation_date": 1504116195, "post_id": 45966933, "comment_id": 78893021, "body": "Your solution is not very useful. You won&#39;t be able to use <code>data</code> outside of those branches. You would need to reproduce your entire application logic for each branch (templates recommended). Consider defining a single vector with a size equal to the product of all of the dimensions` size."}, {"owner": {"reputation": 4313, "user_id": 2706707, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BoAxS.gif?s=128&g=1", "display_name": "D&#250;thomhas", "link": "https://stackoverflow.com/users/2706707/d%c3%bathomhas"}, "edited": false, "score": 0, "creation_date": 1504116374, "post_id": 45966933, "comment_id": 78893130, "body": "This seems to be a very unwieldy solution to a separate problem. Perhaps if you told us more about what you are trying to accomplish we can help with a better solution?"}, {"owner": {"reputation": 1289, "user_id": 1798097, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hb4ho.png?s=128&g=1", "display_name": "Anthony Lethuillier", "link": "https://stackoverflow.com/users/1798097/anthony-lethuillier"}, "edited": false, "score": 0, "creation_date": 1504116812, "post_id": 45966933, "comment_id": 78893348, "body": "Thanks for the recommendations, here is a more complete description of my probelm: my program take in input a configuration file in which the user defines a set of parameters (name, start value, end value and number of values for the parameter). I take those parameters and iterate over all the values the user wants. For each set of parameters I have a vector of results I want to save to a file. To avoid having one file per parameter set I&#39;m trying to put all the results in a multidimensional vector and then save that vector."}, {"owner": {"reputation": 2191, "user_id": 7070965, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/qEhQf.png?s=128&g=1", "display_name": "dtell", "link": "https://stackoverflow.com/users/7070965/dtell"}, "edited": false, "score": 0, "creation_date": 1504120839, "post_id": 45966933, "comment_id": 78895509, "body": "Could you add an example of how your config file looks and what exactly you want to achieve."}, {"owner": {"reputation": 4313, "user_id": 2706707, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BoAxS.gif?s=128&g=1", "display_name": "D&#250;thomhas", "link": "https://stackoverflow.com/users/2706707/d%c3%bathomhas"}, "edited": false, "score": 0, "creation_date": 1504134277, "post_id": 45966933, "comment_id": 78901022, "body": "I would typically flatten that into a map with parameter names separated by something like periods (or any list of words) and a value."}], "answers": [{"comments": [{"owner": {"reputation": 4827, "user_id": 8051589, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8VNG6.png?s=128&g=1", "display_name": "Andre Kampling", "link": "https://stackoverflow.com/users/8051589/andre-kampling"}, "edited": false, "score": 0, "creation_date": 1504163835, "post_id": 45970923, "comment_id": 78909410, "body": "Would help to see <code>calculateResult(...)</code> to understand the result vector <code>data</code>. Also think of <a href=\"https://meta.stackexchange.com/q/5234/179419\">accepting this answer</a> to show a wider community that the problem is solved."}, {"owner": {"reputation": 1289, "user_id": 1798097, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hb4ho.png?s=128&g=1", "display_name": "Anthony Lethuillier", "link": "https://stackoverflow.com/users/1798097/anthony-lethuillier"}, "reply_to_user": {"reputation": 4827, "user_id": 8051589, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8VNG6.png?s=128&g=1", "display_name": "Andre Kampling", "link": "https://stackoverflow.com/users/8051589/andre-kampling"}, "edited": false, "score": 0, "creation_date": 1504196819, "post_id": 45970923, "comment_id": 78932264, "body": "Unfortunately it is part of a more complex bit of code which would be too long to show. This solution works for me (I might look into maps also), I&#39;ll accept as soon as I can."}], "tags": [], "owner": {"reputation": 1289, "user_id": 1798097, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hb4ho.png?s=128&g=1", "display_name": "Anthony Lethuillier", "link": "https://stackoverflow.com/users/1798097/anthony-lethuillier"}, "is_accepted": true, "score": 1, "last_activity_date": 1504133918, "creation_date": 1504133918, "answer_id": 45970923, "question_id": 45966933, "link": "https://stackoverflow.com/questions/45966933/declaring-multidimensional-vector-with-variable-number-of-dimensions-in-c/45970923#45970923", "title": "Declaring multidimensional vector with variable number of dimensions in C++", "body": "<p>As suggested in the comments here is the solution I followed:</p>\n\n<pre><code>#include &lt;vector&gt;\n#include &lt;algorithm&gt;\n#include &lt;iostream&gt;\nusing namespace std;\n\nvector&lt; double &gt; data;\n\nint main() {\n\n    std::vector&lt;int&gt; parameter1 {34,23,58};\n    std::vector&lt;int&gt; parameter2 {1,2,3};\n\n    data = vector&lt; double &gt; (parameter1.size()*parameter2.size());\n    calculateResult(data);\n\n   // If I want to access the result for Parameter1 = 58 and Parameter = 2 I do:\n    int index1 = 2\n    int index2 = 1\n    double selectedResult = data[index1*parameter1.size()+index2];\n\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 1289, "user_id": 1798097, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hb4ho.png?s=128&g=1", "display_name": "Anthony Lethuillier", "link": "https://stackoverflow.com/users/1798097/anthony-lethuillier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 254, "favorite_count": 1, "accepted_answer_id": 45970923, "answer_count": 1, "score": 0, "last_activity_date": 1504133918, "creation_date": 1504115925, "last_edit_date": 1504116449, "question_id": 45966933, "link": "https://stackoverflow.com/questions/45966933/declaring-multidimensional-vector-with-variable-number-of-dimensions-in-c", "title": "Declaring multidimensional vector with variable number of dimensions in C++", "body": "<p>I am trying to declare a multidimensional vector with variable number of dimensions (user input).</p>\n\n<p>here is what I have:</p>\n\n<pre><code>#include &lt;vector&gt;\n#include &lt;algorithm&gt;\n#include &lt;iostream&gt;\nusing namespace std;\n\nvector&lt; double &gt; data;\n\nint main() {\n    int numberDimensions = 4;\n    for (int it = 0; it &lt; numberDimensions; it++){\n      // Nor sure what to put here\n    }\n    return 0;\n}\n</code></pre>\n\n<p>Another solution is by using an if statement at the begining but I was wondering if another solution exists ?</p>\n\n<pre><code>#include &lt;vector&gt;\n#include &lt;algorithm&gt;\n#include &lt;iostream&gt;\nusing namespace std;\n\nint main() {\n    int numberDimensions = 4; \n    if (numberDimensions==0)\n        cout &lt;&lt; 'error' &lt;&lt; endl;\n    else if (numberDimensions==1)\n         vector&lt; double&gt; data;\n    else if (numberDimensions==2)\n         vector&lt; vector&lt; double&gt; &gt; data;\n    else if (numberDimensions==3)\n         vector&lt; vector&lt; vector&lt; double&gt; &gt; &gt; data;\n    else if (numberDimensions==4)\n         vector&lt; vector&lt; vector&lt; vector&lt; double&gt; &gt; &gt; &gt; data;\n    return 0;\n}\n</code></pre>\n\n<p>Thanks for any suggestions,</p>\n"}, {"tags": ["c++", "boost", "a-star", "boost-graph"], "comments": [{"owner": {"reputation": 199, "user_id": 3535616, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/20ad9d8fe2c4f95af377d649437d9e6d?s=128&d=identicon&r=PG", "display_name": "Jim", "link": "https://stackoverflow.com/users/3535616/jim"}, "edited": false, "score": 0, "creation_date": 1504116300, "post_id": 45966930, "comment_id": 78893091, "body": "Tagging <a href=\"https://stackoverflow.com/users/85371/sehe\">stackoverflow.com/users/85371/sehe</a> since they appear to answer most boost-graph related questions I&#39;ve seen here"}, {"owner": {"reputation": 326119, "user_id": 85371, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/6d52c235ec6dd15f30bab444103e7af2?s=128&d=identicon&r=PG", "display_name": "sehe", "link": "https://stackoverflow.com/users/85371/sehe"}, "edited": false, "score": 0, "creation_date": 1504127028, "post_id": 45966930, "comment_id": 78898580, "body": "Lol. No need. I&#39;m here anyways. Tagging <a href=\"https://stackoverflow.com/questions/tagged/boost-graph\">boost-graph</a> tends to work."}], "answers": [{"comments": [{"owner": {"reputation": 199, "user_id": 3535616, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/20ad9d8fe2c4f95af377d649437d9e6d?s=128&d=identicon&r=PG", "display_name": "Jim", "link": "https://stackoverflow.com/users/3535616/jim"}, "edited": false, "score": 0, "creation_date": 1504130795, "post_id": 45969805, "comment_id": 78900047, "body": "Thank you so much! The fact that it can update weights with an external function with one line of code makes it pretty powerful."}, {"owner": {"reputation": 326119, "user_id": 85371, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/6d52c235ec6dd15f30bab444103e7af2?s=128&d=identicon&r=PG", "display_name": "sehe", "link": "https://stackoverflow.com/users/85371/sehe"}, "reply_to_user": {"reputation": 199, "user_id": 3535616, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/20ad9d8fe2c4f95af377d649437d9e6d?s=128&d=identicon&r=PG", "display_name": "Jim", "link": "https://stackoverflow.com/users/3535616/jim"}, "edited": false, "score": 0, "creation_date": 1504130980, "post_id": 45969805, "comment_id": 78900093, "body": "Beware of potential issues. Astar should be fine, as it&#39;s driven heuristically, but some algorithms might not ever complete with wrong kind of dynamic feedback in the weight function. (E.g. randomly inverting weights on a shortest path search). Algorithms can make assumptions about the repeatability. And depending on how they&#39;re implemented not choose to keep track of previously evaluated cost functions. BGL documentation seems to do a decent job documenting these kind of assumptions (requirements)."}, {"owner": {"reputation": 326119, "user_id": 85371, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/6d52c235ec6dd15f30bab444103e7af2?s=128&d=identicon&r=PG", "display_name": "sehe", "link": "https://stackoverflow.com/users/85371/sehe"}, "reply_to_user": {"reputation": 199, "user_id": 3535616, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/20ad9d8fe2c4f95af377d649437d9e6d?s=128&d=identicon&r=PG", "display_name": "Jim", "link": "https://stackoverflow.com/users/3535616/jim"}, "edited": false, "score": 0, "creation_date": 1504131161, "post_id": 45969805, "comment_id": 78900150, "body": "And yes, property maps are a very powerful concept, see e.g. <a href=\"https://stackoverflow.com/questions/27863061/map-set-get-requests-into-c-class-structure-changes/27863767#27863767\" title=\"map set get requests into c class structure changes\">stackoverflow.com/questions/27863061/&hellip;</a> (or just search my answers for the many usage examples)"}], "tags": [], "owner": {"reputation": 326119, "user_id": 85371, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/6d52c235ec6dd15f30bab444103e7af2?s=128&d=identicon&r=PG", "display_name": "sehe", "link": "https://stackoverflow.com/users/85371/sehe"}, "is_accepted": true, "score": 2, "last_activity_date": 1504127694, "creation_date": 1504127694, "answer_id": 45969805, "question_id": 45966930, "link": "https://stackoverflow.com/questions/45966930/augment-custom-weights-to-edge-descriptors-in-boostgrid-graph/45969805#45969805", "title": "Augment custom weights to edge descriptors in boost::grid_graph", "body": "<blockquote>\n  <p>but how do I update the weights according to the output of:</p>\n\n<pre><code> double stepTime(const vertex_descriptor&amp; source, const vertex_descriptor&amp; target, const std::vector&lt;uint8_t&gt;&amp; elevation)\n</code></pre>\n</blockquote>\n\n<p>I have no clue where you get the elevation vector from, but I guess that's your problem.</p>\n\n<p>The source and target vertices are easily gotten from the graph itself, so here goes:</p>\n\n<pre><code>auto custom = boost::make_function_property_map&lt;Graph::edge_descriptor&gt;(\n        [&amp;g,&amp;elevation](Graph::edge_descriptor e) {\n            return stepTime(boost::source(e, g), boost::target(e, g), elevation);\n        });\n</code></pre>\n\n<h2>Demo</h2>\n\n<p><strong><kbd><a href=\"http://coliru.stacked-crooked.com/a/63df278544ddbe75\" rel=\"nofollow noreferrer\">Live On Coliru</a></kbd></strong></p>\n\n<pre><code>#include &lt;boost/graph/adjacency_list.hpp&gt;\n#include &lt;boost/graph/astar_search.hpp&gt;\n#include &lt;boost/property_map/function_property_map.hpp&gt;\n#include &lt;iostream&gt;\n\nusing Graph = boost::adjacency_list&lt;&gt;;\n\ndouble stepTime(const Graph::vertex_descriptor&amp; source, const Graph::vertex_descriptor&amp; target, const std::vector&lt;uint8_t&gt;&amp; elevation) {\n    std::cout &lt;&lt; __FUNCTION__ &lt;&lt; \"(\" &lt;&lt; source &lt;&lt; \", \" &lt;&lt; target &lt;&lt; \", {\" &lt;&lt; elevation.size() &lt;&lt; \" elements})\\n\";\n    return 42;\n}\n\nint main() {\n    Graph g(10);\n    add_edge(4, 5, g);\n    add_edge(2, 8, g);\n    add_edge(5, 1, g);\n    add_edge(1, 3, g);\n\n    std::vector&lt;uint8_t&gt; const elevation { 1,2,3,4,5,6 }; // or whatevs\n\n    // custom weight map\n    auto custom = boost::make_function_property_map&lt;Graph::edge_descriptor&gt;(\n            [&amp;g,&amp;elevation](Graph::edge_descriptor e) {\n                return stepTime(boost::source(e, g), boost::target(e, g), elevation);\n            });\n\n    // pass it to an algorithm directly, or wrap it in a named-parameter object:\n    auto param = boost::weight_map(custom);\n    param.weight_map2(custom); // or as the alternative weight map\n}\n</code></pre>\n"}], "owner": {"reputation": 199, "user_id": 3535616, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/20ad9d8fe2c4f95af377d649437d9e6d?s=128&d=identicon&r=PG", "display_name": "Jim", "link": "https://stackoverflow.com/users/3535616/jim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 197, "favorite_count": 0, "accepted_answer_id": 45969805, "answer_count": 1, "score": 2, "last_activity_date": 1504130876, "creation_date": 1504115910, "last_edit_date": 1504130876, "question_id": 45966930, "link": "https://stackoverflow.com/questions/45966930/augment-custom-weights-to-edge-descriptors-in-boostgrid-graph", "title": "Augment custom weights to edge descriptors in boost::grid_graph", "body": "<p>I am using BGL for a custom AStar search. Basically, the nodes of the graph correspond to the cells of a map, and each cell has an elevation. </p>\n\n<p>I've created an cell traversal score function <em>stepTime</em> which takes in the elevation of two cells, and outputs a cost function. I wanna add this cost function to the edge weights in my boost graph. </p>\n\n<p>How do I go about this? I've seen functions using </p>\n\n<p><code>auto weightmap = make_transform_value_property_map</code></p>\n\n<p>to create a weight map, but how do I update the weights according to the output of:</p>\n\n<p><code>double stepTime(const vertex_descriptor&amp; source, const vertex_descriptor&amp; target, const std::vector&lt;uint8_t&gt;&amp; elevation)\n</code></p>\n"}, {"tags": ["c++", "c++11", "stl"], "comments": [{"owner": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 1, "creation_date": 1504115579, "post_id": 45966807, "comment_id": 78892640, "body": "<code>|| p1.mMoney &lt;= p2.mMoney</code> should be <code>|| ((p1.mTime == p2.mTime) &amp;&amp; (p1.mMoney &lt; p2.mMoney))</code> Otherwise comparison will be wrong for case when <code>p1.mTime</code> is greater than <code>p2.mTime</code> while <code>p1.mMoney</code> is less than <code>p2.Money</code>."}, {"owner": {"reputation": 33821, "user_id": 45685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/y4RJr.jpg?s=128&g=1", "display_name": "AndersK", "link": "https://stackoverflow.com/users/45685/andersk"}, "edited": false, "score": 1, "creation_date": 1504115723, "post_id": 45966807, "comment_id": 78892725, "body": "Comparing two floats is not a good idea, floats are not represented exactly, they are approximations. You need to compare that the difference is less than some delta. by the same reasoning putting money in a float is not a good idea."}, {"owner": {"reputation": 2224, "user_id": 540639, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/96190aafa4d6328887c6a48d4ba21923?s=128&d=identicon&r=PG", "display_name": "deko", "link": "https://stackoverflow.com/users/540639/deko"}, "reply_to_user": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 0, "creation_date": 1504115895, "post_id": 45966807, "comment_id": 78892835, "body": "@VTT: You are right, this is the solution. Make it an answer, I&#39;ll accept."}, {"owner": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "edited": false, "score": 0, "creation_date": 1504116034, "post_id": 45966807, "comment_id": 78892930, "body": "In general you cannot use <code>&lt;=</code> for strict weak ordering, as it requires false for equal elements."}, {"owner": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "reply_to_user": {"reputation": 33821, "user_id": 45685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/y4RJr.jpg?s=128&g=1", "display_name": "AndersK", "link": "https://stackoverflow.com/users/45685/andersk"}, "edited": false, "score": 0, "creation_date": 1504116238, "post_id": 45966807, "comment_id": 78893046, "body": "@AndersK. in this case delta is not required, unless OP uses that criteria to find element. For actual sorting it can make it slower."}, {"owner": {"reputation": 122530, "user_id": 2756719, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b06a9c91425630fdb69e861abe483d7e?s=128&d=identicon&r=PG&f=1", "display_name": "T.C.", "link": "https://stackoverflow.com/users/2756719/t-c"}, "reply_to_user": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "edited": false, "score": 0, "creation_date": 1504120292, "post_id": 45966807, "comment_id": 78895227, "body": "@Slava It&#39;s not just speed. Comparison with delta is not a valid strict weak ordering."}, {"owner": {"reputation": 33821, "user_id": 45685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/y4RJr.jpg?s=128&g=1", "display_name": "AndersK", "link": "https://stackoverflow.com/users/45685/andersk"}, "reply_to_user": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "edited": false, "score": 0, "creation_date": 1504120428, "post_id": 45966807, "comment_id": 78895304, "body": "@Slava  mMoney == p.mMoney will not work"}, {"owner": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "reply_to_user": {"reputation": 33821, "user_id": 45685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/y4RJr.jpg?s=128&g=1", "display_name": "AndersK", "link": "https://stackoverflow.com/users/45685/andersk"}, "edited": false, "score": 0, "creation_date": 1504121399, "post_id": 45966807, "comment_id": 78895799, "body": "@AndersK. first of all it will work, maybe not the way somebody would expect it, second strict weak ordering, which is used by <code>std::sort()</code> does not use <code>==</code>"}, {"owner": {"reputation": 33821, "user_id": 45685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/y4RJr.jpg?s=128&g=1", "display_name": "AndersK", "link": "https://stackoverflow.com/users/45685/andersk"}, "edited": false, "score": 0, "creation_date": 1504121898, "post_id": 45966807, "comment_id": 78896066, "body": "@Stava it is an error to compare floats with each other since floats are not exactly represented, my comment is directed to his comparison function, not whether it fits in this particular fringe case."}], "answers": [{"comments": [{"owner": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "edited": false, "score": 3, "creation_date": 1504116095, "post_id": 45966970, "comment_id": 78892979, "body": "Using <code>std::tie</code> is simpler"}, {"owner": {"reputation": 196207, "user_id": 434551, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/8Wzl8.png?s=128&g=1", "display_name": "R Sahu", "link": "https://stackoverflow.com/users/434551/r-sahu"}, "reply_to_user": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "edited": false, "score": 0, "creation_date": 1504116278, "post_id": 45966970, "comment_id": 78893073, "body": "@Slava, of course. Thanks for the hint."}], "tags": [], "owner": {"reputation": 196207, "user_id": 434551, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/8Wzl8.png?s=128&g=1", "display_name": "R Sahu", "link": "https://stackoverflow.com/users/434551/r-sahu"}, "is_accepted": false, "score": 5, "last_activity_date": 1504116554, "last_edit_date": 1504116554, "creation_date": 1504116066, "answer_id": 45966970, "question_id": 45966807, "link": "https://stackoverflow.com/questions/45966807/c-invalid-comparator-assert/45966970#45966970", "title": "C++: \u201cinvalid comparator\u201d assert", "body": "<p>The problem is with the implementation of <code>sortP</code>. It does not satisfy the strictly weak ordering criteria. Read the details at <a href=\"http://www.sgi.com/tech/stl/StrictWeakOrdering.html\" rel=\"nofollow noreferrer\">http://www.sgi.com/tech/stl/StrictWeakOrdering.html</a>.</p>\n\n<p>I suggest the following change:</p>\n\n<pre><code>auto sortP = [](const Payment&amp; p1, const Payment&amp; p2)\n{\n   // Order by mTime if they are not equal.\n   if ( p1.mTime != p2.mTime)\n   {\n     return p1.mTime &lt; p2.mTime;\n   }\n\n   // Otherwise, order by pMoney\n   return ( p1.mMoney &lt; p2.mMoney); // Use &lt; not &lt;=\n};\n</code></pre>\n\n<p>You can use <a href=\"http://en.cppreference.com/w/cpp/utility/tuple/tie\" rel=\"nofollow noreferrer\"><code>std::tie</code></a> to make the implementation simpler.</p>\n\n<pre><code>auto sortP = [](const Payment&amp; p1, const Payment&amp; p2)\n{\n   return std::tie(p1.mTime, p1.mMoney) &lt; std::tie(p2.mTime, p2.mMoney);\n};\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "edited": false, "score": 5, "creation_date": 1504116275, "post_id": 45967005, "comment_id": 78893070, "body": "Good practice is to use <code>std::tie</code>"}], "tags": [], "owner": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "is_accepted": true, "score": 1, "last_activity_date": 1589733671, "last_edit_date": 1589733671, "creation_date": 1504116185, "answer_id": 45967005, "question_id": 45966807, "link": "https://stackoverflow.com/questions/45966807/c-invalid-comparator-assert/45967005#45967005", "title": "C++: \u201cinvalid comparator\u201d assert", "body": "<p><code>|| p1.mMoney &lt;= p2.mMoney</code> should be <code>|| ((p1.mTime == p2.mTime) &amp;&amp; (p1.mMoney &lt; p2.mMoney))</code> Otherwise comparison will be wrong for case when <code>p1.mTime</code> is greater than <code>p2.mTime</code> while <code>p1.mMoney</code> is less than <code>p2.Money</code>. A good practice to ensure that such multi-field comparator satisfy strict weak ordering requirement is to write tests for all possible lt/gt combinations of fields.</p>\n"}, {"tags": [], "owner": {"reputation": 952, "user_id": 5449818, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eYyPG.jpg?s=128&g=1", "display_name": "ikleschenkov", "link": "https://stackoverflow.com/users/5449818/ikleschenkov"}, "is_accepted": false, "score": 1, "last_activity_date": 1504116302, "creation_date": 1504116302, "answer_id": 45967032, "question_id": 45966807, "link": "https://stackoverflow.com/questions/45966807/c-invalid-comparator-assert/45967032#45967032", "title": "C++: \u201cinvalid comparator\u201d assert", "body": "<p>Using <code>c++11</code> your comparator lambda should look like:</p>\n\n<pre><code>#include &lt;tuple&gt;\n...\nauto sortP = [](const Payment&amp; p1, const Payment&amp; p2) \n{ \n     return std::tie(p1.mTime, p1.mMoney) &lt; std::tie(p2.mTime, p2.mMoney);\n};\n</code></pre>\n"}], "owner": {"reputation": 2224, "user_id": 540639, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/96190aafa4d6328887c6a48d4ba21923?s=128&d=identicon&r=PG", "display_name": "deko", "link": "https://stackoverflow.com/users/540639/deko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3278, "favorite_count": 0, "closed_date": 1504211977, "accepted_answer_id": 45967005, "answer_count": 3, "score": 1, "last_activity_date": 1589733671, "creation_date": 1504115326, "last_edit_date": 1543722820, "question_id": 45966807, "link": "https://stackoverflow.com/questions/45966807/c-invalid-comparator-assert", "closed_reason": "Duplicate", "title": "C++: \u201cinvalid comparator\u201d assert", "body": "<p>Here is the code:</p>\n\n<pre><code>struct Payment\n{\n    Payment(time_t time, float money) : mTime(time), mMoney(money) {}\n    bool operator==(const Payment&amp; p) const // exact comparison\n    {\n        return mTime == p.mTime &amp;&amp; mMoney == p.mMoney;\n    }\n    time_t  mTime;\n    float   mMoney;\n};\n\nstd::vector&lt;Payment&gt;    payments;\n\nauto sortP = [](const Payment&amp; p1, const Payment&amp; p2) { return p1.mTime &lt; p2.mTime || p1.mMoney &lt;= p2.mMoney; };\nstd::sort(payments.begin(), payments.end(), sortP);\n</code></pre>\n\n<p><code>std::sort</code> (not always, but sometimes, when <code>mTime</code> of two elements close to each other) raises invalid comparator assert in Visual Studio 2015. What's wrong with the code?<br>\n <a href=\"https://i.stack.imgur.com/nmaCA.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/nmaCA.jpg\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["c++", "algorithm", "binary-search-tree"], "comments": [{"owner": {"reputation": 28550, "user_id": 3796113, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/960488e3bdc769466c183faaf102f2f1?s=128&d=identicon&r=PG&f=1", "display_name": "user2736738", "link": "https://stackoverflow.com/users/3796113/user2736738"}, "edited": false, "score": 0, "creation_date": 1504117594, "post_id": 45966611, "comment_id": 78893796, "body": "Do you understand or I can try a different way or clarify things?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8305079"}, "reply_to_user": {"reputation": 28550, "user_id": 3796113, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/960488e3bdc769466c183faaf102f2f1?s=128&d=identicon&r=PG&f=1", "display_name": "user2736738", "link": "https://stackoverflow.com/users/3796113/user2736738"}, "edited": false, "score": 0, "creation_date": 1504117873, "post_id": 45966611, "comment_id": 78893935, "body": "@coderredoc, thank you.  I got your point.  I appreciate your help."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8305079"}, "edited": false, "score": 1, "creation_date": 1504117944, "post_id": 45967098, "comment_id": 78893978, "body": "Thank you for you answer."}], "tags": [], "owner": {"reputation": 28550, "user_id": 3796113, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/960488e3bdc769466c183faaf102f2f1?s=128&d=identicon&r=PG&f=1", "display_name": "user2736738", "link": "https://stackoverflow.com/users/3796113/user2736738"}, "is_accepted": true, "score": 1, "last_activity_date": 1504116996, "last_edit_date": 1504116996, "creation_date": 1504116567, "answer_id": 45967098, "question_id": 45966611, "link": "https://stackoverflow.com/questions/45966611/intuition-behind-using-the-cartesian-product-for-finding-number-of-unique-bsts/45967098#45967098", "title": "Intuition behind using the Cartesian product for finding number of unique BSTs", "body": "<p>You can go by mathematical induction and then apply it to the sub-problems to get the result. Or simply just check for small values and then go for higher values.</p>\n\n<p>For example:-</p>\n\n<pre><code>No of nodes      BST representation\n\n1   --&gt;    [1]\n\n2   --&gt;  [2]  [1]\n         /     \\\n        [1]    [2]\n\n3   --&gt;  [1]\n           \\\n           [2]\n             \\\n             [3]\n\n         [2]\n         / \\\n        [1] [3]\n\n          [3]\n          /\n       [2]\n       /\n      [1]\n4  --&gt; \n        [1]\n      /     \\\n     NUM{}  NUM of keys with 3 val NUM{2,3,4}\n\n      [2]\n      /  \\\n    NUM{1} NUM{3,4}\n\n      [3]\n      /  \\\n    NUM{1,2} NUM{4}\n\n          [4]\n         /     \\\n    NUM{1,2,3}  NUM{}\n</code></pre>\n\n<p>From the 4th case you can clearly understand that we have to simply multiply the number of possible ways to group the left and right subtree in each of the trees. And for a given number of values we have to add them. That's why cartesian product is being used.</p>\n\n<p>The product basically gives us all possible order the whole true can have. \nFor example:</p>\n\n<blockquote>\n  <p><code>G[i] += G[j-1] * G[i-j];</code> Here <code>j-1</code> nodes are to the left( we can assume\n  without loss of generality) and <code>i-j</code> nodes to the right sub-tree. And\n  now you can arrange the left sub-tree in <code>G[j-1]</code> ways and similarly for\n  right sub-tree in <code>G[i-j]</code> ways. Now think how many ways can you arrange\n  the original tree which has this left and rigth subtree? It would\n  multiply. Because each combination of left and right subtree will give\n  rise to a unique tree representation.</p>\n</blockquote>\n\n<p>This also explains why we define <code>G[0]=1</code> because it conforms to the way we do things here. And also the number of arrangements with no value is also an arrangement. So it is considered 1. </p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8305079"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 45967098, "answer_count": 1, "score": 0, "last_activity_date": 1504116996, "creation_date": 1504114719, "question_id": 45966611, "link": "https://stackoverflow.com/questions/45966611/intuition-behind-using-the-cartesian-product-for-finding-number-of-unique-bsts", "title": "Intuition behind using the Cartesian product for finding number of unique BSTs", "body": "<p>I am solving a LeetCode question.  The question is:</p>\n\n<blockquote>\n  <p>Given <code>n</code>, how many structurally unique BSTs can be generated, that store the values from <code>1...n</code>?  For e.g., for <code>n=3</code>, a total of <code>5</code> unique BSTs can be generated as follows:</p>\n</blockquote>\n\n<pre><code>   1         3     3      2      1\n    \\       /     /      / \\      \\\n     3     2     1      1   3      2\n    /     /       \\                 \\\n   2     1         2                 3\n</code></pre>\n\n<p>The maximum upvoted solution makes use of DP and the following recursive formula:</p>\n\n<pre><code>G(n) = G(0) * G(n-1) + G(1) * G(n-2) + \u2026 + G(n-1) * G(0) \n</code></pre>\n\n<p>where <code>G(n)</code> represents the number of unique BSTs that can be generated for <code>n</code>.  The code is as follows:</p>\n\n<pre><code>class Solution {\npublic:\n    int numTrees(int n) {\n        vector&lt;int&gt; G(n+1);\n        G[0]=G[1]=1;\n\n        for(int i=2; i&lt;=n; i++)\n            for(int j=1; j&lt;=i; j++)\n                G[i]+=G[j-1]*G[i-j];\n\n        return G[n];\n    }\n};\n</code></pre>\n\n<p>While I more-or-less do understand what is going on, I didn't understand why we take a <em>Cartesian product</em> (instead of simple addition, which is more intuitive).  As per my understanding:</p>\n\n<pre><code>G[i] += G[j-1] * G[i-j];\n</code></pre>\n\n<p>should instead be:</p>\n\n<pre><code>G[i] += G[j-1] + G[i-j];  //replaced '*' with a '+'\n</code></pre>\n\n<p>This is so because, I think the number of unique BSTs possible with <code>i</code> as the current root should be the <em>sum</em>(?) of the number of BSTs for its left and right subtrees.  I did try a few examples but somehow the numbers get multiplied magically in the original solution (with a <code>*</code>) and the final answer appears in <code>G[n]</code>.  </p>\n\n<p>Could someone please provide an intuitive explanation for using Cartesian product instead of sum?</p>\n\n<p><strong>Note:</strong>  The original question is <a href=\"https://leetcode.com/problems/unique-binary-search-trees/description/\" rel=\"nofollow noreferrer\">here</a> and the solution is <a href=\"https://discuss.leetcode.com/topic/8398/dp-solution-in-6-lines-with-explanation-f-i-n-g-i-1-g-n-i\" rel=\"nofollow noreferrer\">here</a>.  Also, the original code is in Java while I have posted the C++ variation that I wrote above.</p>\n"}, {"tags": ["c++", "multithreading", "c++11"], "answers": [{"comments": [{"owner": {"reputation": 68702, "user_id": 1593860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1361e47a8bf06d20ffda9a686ceb7e68?s=128&d=identicon&r=PG", "display_name": "Pete Becker", "link": "https://stackoverflow.com/users/1593860/pete-becker"}, "edited": false, "score": 1, "creation_date": 1504114896, "post_id": 45966643, "comment_id": 78892280, "body": "Unintuitive as it sounds, this is the correct technique for getting a pointer to one of a set of overloaded functions."}], "tags": [], "owner": {"reputation": 35327, "user_id": 27678, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/7496124d499d578df1e3a6ff85e7ae03?s=128&d=identicon&r=PG", "display_name": "AndyG", "link": "https://stackoverflow.com/users/27678/andyg"}, "is_accepted": true, "score": 13, "last_activity_date": 1504114983, "last_edit_date": 1504114983, "creation_date": 1504114801, "answer_id": 45966643, "question_id": 45966603, "link": "https://stackoverflow.com/questions/45966603/is-it-possible-to-pass-overloaded-method-to-stdthread/45966643#45966643", "title": "Is it possible to pass overloaded method to std::thread", "body": "<p>You will need to cast the functions to resolve overloading:</p>\n\n<pre><code>std::thread t1(static_cast&lt;int(*)(int)&gt;(do_calculation),20);    \nstd::thread t2(static_cast&lt;float(*)(float)&gt;(do_calculation),200.0f);  \n</code></pre>\n\n<p>Additionally, you need to either <a href=\"http://en.cppreference.com/w/cpp/thread/thread/join\" rel=\"noreferrer\"><code>join</code></a> or <a href=\"http://en.cppreference.com/w/cpp/thread/thread/detach\" rel=\"noreferrer\"><code>detach</code></a> your threads lest you risk a fun trip to <code>std::terminate</code>:</p>\n\n<pre><code>t1.join();\nt2.join();\n</code></pre>\n\n<h3><a href=\"https://wandbox.org/permlink/1lCfETuL5LdIlsP6\" rel=\"noreferrer\">Demo</a></h3>\n"}, {"tags": [], "owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "is_accepted": false, "score": 7, "last_activity_date": 1564575643, "last_edit_date": 1564575643, "creation_date": 1504114968, "answer_id": 45966687, "question_id": 45966603, "link": "https://stackoverflow.com/questions/45966603/is-it-possible-to-pass-overloaded-method-to-stdthread/45966687#45966687", "title": "Is it possible to pass overloaded method to std::thread", "body": "<p>If you can use C++14 then as an alternative to casting you can wrap the function call in a lambda and use auto parameter type deduction.  This will allow overload resolution and type deduction to work for you</p>\n\n<pre><code>std::thread t1([](auto var){ do_calculation(var); },20);    \nstd::thread t2([](auto var){ do_calculation(var); },200.0f);  \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "is_accepted": false, "score": 11, "last_activity_date": 1504115037, "creation_date": 1504115037, "answer_id": 45966714, "question_id": 45966603, "link": "https://stackoverflow.com/questions/45966603/is-it-possible-to-pass-overloaded-method-to-stdthread/45966714#45966714", "title": "Is it possible to pass overloaded method to std::thread", "body": "<p>Alternatively, you may wrap the call in lambda</p>\n\n<pre><code>std::thread t1([](int e) {do_calculation(e);}, 20);\nstd::thread t2([]() { do_calculation(200.0f); });\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "is_accepted": false, "score": 2, "last_activity_date": 1504119992, "creation_date": 1504119992, "answer_id": 45968037, "question_id": 45966603, "link": "https://stackoverflow.com/questions/45966603/is-it-possible-to-pass-overloaded-method-to-stdthread/45968037#45968037", "title": "Is it possible to pass overloaded method to std::thread", "body": "<pre><code>#define RETURNS( ... ) \\\n  noexcept(noexcept( __VA_ARGS__ )) \\\n  -&gt; decltype( __VA_ARGS__ ) \\\n  { return __VA_ARGS__; }\n\n#define OVERLOAD_SET( ... ) \\\n  struct { \\\n    template&lt;class...Ts&gt; \\\n    auto operator()(Ts&amp;&amp;...ts)const\\\n    RETURNS( __VA_ARGS__( std::forward&lt;Ts&gt;(ts)... ) )\\\n  }\n</code></pre>\n\n<p>now we can do:</p>\n\n<pre><code>static OVERLOAD_SET( do_calculation ) do_calculation_v;\n</code></pre>\n\n<p>and <code>do_calculation_v</code> is an object that represents the overload set of <code>do_calculation</code>.</p>\n\n<pre><code>int main() {    \n  std::thread t1(do_calculation_v,20);    \n  std::thread t2(do_calculation_v,200.0f);    \n  return 0;    \n}\n</code></pre>\n\n<p>In <a href=\"/questions/tagged/c%2b%2b14\" class=\"post-tag\" title=\"show questions tagged &#39;c++14&#39;\" rel=\"tag\">c++14</a> we can do this with lambdas and not require a named object:</p>\n\n<pre><code>#define OVERLOAD_SET( ... ) \\\n  [](auto&amp;&amp;...args) RETURNS( __VA_ARGS__( decltype(args)(args)... ) )\n\nint main() {    \n  std::thread t1(OVERLOAD_SET(do_calculation),20);    \n  std::thread t2(OVERLOAD_SET(do_calculation),200.0f);    \n}\n</code></pre>\n\n<p>There is a <a href=\"/questions/tagged/c%2b%2b20\" class=\"post-tag\" title=\"show questions tagged &#39;c++20&#39;\" rel=\"tag\">c++20</a> proposal to let you do this a bit simpler without the macro:</p>\n\n<pre><code>int main() {    \n  std::thread t1([](auto...args)=&gt;do_calculation(decltype(args)(args)...),20);    \n  std::thread t2([](auto...args)=&gt;do_calculation(decltype(args)(args)...),200.0f);    \n}\n</code></pre>\n\n<p>backing up to <a href=\"/questions/tagged/c%2b%2b11\" class=\"post-tag\" title=\"show questions tagged &#39;c++11&#39;\" rel=\"tag\">c++11</a>, if we don't care about <code>noexcept</code> or return values or the like, we can just do this:</p>\n\n<pre><code>int main() {    \n  std::thread t1([]{do_calculation(20);});    \n  std::thread t1([]{do_calculation(200.f);});    \n}\n</code></pre>\n\n<p>which deals with 90% of the cases involved.  If your values are not hard-coded and are cheap to copy, just capture them in the <code>[]</code> lambda capture list.</p>\n"}], "owner": {"reputation": 259, "user_id": 2013766, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/72ae3340c1c2617f6e0bb062b54ff95a?s=128&d=identicon&r=PG", "display_name": "Swapnil", "link": "https://stackoverflow.com/users/2013766/swapnil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 695, "favorite_count": 0, "accepted_answer_id": 45966643, "answer_count": 4, "score": 6, "last_activity_date": 1564575643, "creation_date": 1504114675, "question_id": 45966603, "link": "https://stackoverflow.com/questions/45966603/is-it-possible-to-pass-overloaded-method-to-stdthread", "title": "Is it possible to pass overloaded method to std::thread", "body": "<p>i am new to threading, i am trying to pass overloaded methods to std::thread like below example</p>\n\n<pre><code>#include &lt;iostream&gt;    \n#include &lt;thread&gt;    \n\nint do_calculation(int x)    \n{    \n   std::cout&lt;&lt;x;    \n}    \n\nfloat do_calculation(float x)    \n{    \n   std::cout&lt;&lt;x;    \n}    \n\nint main()    \n{    \n   std::thread t1(do_calculation,20);    \n   std::thread t2(do_calculation,200.0f);    \n   return 0;    \n}\n</code></pre>\n\n<p>but the program is not compiling and throwing error that \n<code>no matching function for call to 'std::thread::thread(&lt;unresolved overloaded function type&gt;, int)'\n    std::thread t1(do_calculation,20);</code></p>\n\n<p>Is there a way to call overloaded methods in thread?</p>\n"}, {"tags": ["c++", "templates", "malloc", "memmove", "object-construction"], "comments": [{"owner": {"reputation": 7681, "user_id": 8242698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/BjJXu.jpg?s=128&g=1", "display_name": "user0042", "link": "https://stackoverflow.com/users/8242698/user0042"}, "edited": false, "score": 0, "creation_date": 1504114694, "post_id": 45966597, "comment_id": 78892176, "body": "Don&#39;t use <code>malloc()</code> with c++."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 3, "creation_date": 1504114703, "post_id": 45966597, "comment_id": 78892185, "body": "You cannot create an object with <code>malloc</code> or move it with <code>memcpy</code> (or similar functions) unless that object is a <a href=\"http://en.cppreference.com/w/cpp/concept/PODType\" rel=\"nofollow noreferrer\">POD type</a>. Further reading : <a href=\"https://stackoverflow.com/questions/146452/what-are-pod-types-in-c\" title=\"what are pod types in c\">stackoverflow.com/questions/146452/what-are-pod-types-in-c</a> <code>std::string</code> is most definitively not a POD type."}, {"owner": {"reputation": 147720, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 0, "creation_date": 1504114776, "post_id": 45966597, "comment_id": 78892227, "body": "Just because you hacked a custom allocator, doesn&#39;t mean it&#39;s okay to skip the desturctor call."}, {"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1504114793, "post_id": 45966597, "comment_id": 78892233, "body": "What is wrong with a simple <code>return new Object(Object_Params...);</code>? And why use pointers to begin with? If you <i>must</i> use pointers (as an external requirement, it&#39;s not needed otherwise) then I recommend you use <a href=\"http://en.cppreference.com/w/cpp/memory/unique_ptr\" rel=\"nofollow noreferrer\"><code>std::unique_ptr</code></a>."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1504114829, "post_id": 45966597, "comment_id": 78892250, "body": "<i>&quot;Does anyone know what causes this undefined behaviour?&quot;</i> Beware that <a href=\"http://en.cppreference.com/w/cpp/language/ub\" rel=\"nofollow noreferrer\">undefined behavior</a> has a very precise meaning in c++. Undesirable behavior or unexpected behavior are usually used, unless you are specifically referring to the well defined concept of undefined behavior."}, {"owner": {"reputation": 59, "user_id": 7965754, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/656f5eb5ffc08179ea8458bb6924e3f0?s=128&d=identicon&r=PG&f=1", "display_name": "R34", "link": "https://stackoverflow.com/users/7965754/r34"}, "edited": false, "score": 0, "creation_date": 1504115010, "post_id": 45966597, "comment_id": 78892332, "body": "Thanks for the answers. I am aware that this is not the standard for object creation in c++. I&#39;ll read more into POD types in a bit."}, {"owner": {"reputation": 59, "user_id": 7965754, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/656f5eb5ffc08179ea8458bb6924e3f0?s=128&d=identicon&r=PG&f=1", "display_name": "R34", "link": "https://stackoverflow.com/users/7965754/r34"}, "edited": false, "score": 0, "creation_date": 1504115782, "post_id": 45966597, "comment_id": 78892762, "body": "After reading around POD types. I still don&#39;t get why the first call to print would works fine while the second inside main() does not. Anyone care to explain? Thanks."}, {"owner": {"reputation": 85822, "user_id": 597607, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jCzJi.png?s=128&g=1", "display_name": "Bo Persson", "link": "https://stackoverflow.com/users/597607/bo-persson"}, "edited": false, "score": 0, "creation_date": 1504120671, "post_id": 45966597, "comment_id": 78895419, "body": "There is no real explanation. Undefined behavior ranges all the way from &quot;sometimes print what is expected&quot; to blow up. Or worse."}, {"owner": {"reputation": 59, "user_id": 7965754, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/656f5eb5ffc08179ea8458bb6924e3f0?s=128&d=identicon&r=PG&f=1", "display_name": "R34", "link": "https://stackoverflow.com/users/7965754/r34"}, "edited": false, "score": 0, "creation_date": 1504127192, "post_id": 45966597, "comment_id": 78898655, "body": "Ah I see. Thank you for clarifying."}], "answers": [{"tags": [], "owner": {"reputation": 11532, "user_id": 5129715, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/320498457784a3110f3e256745a9a927?s=128&d=identicon&r=PG&f=1", "display_name": "mksteve", "link": "https://stackoverflow.com/users/5129715/mksteve"}, "is_accepted": false, "score": 1, "last_activity_date": 1504349590, "creation_date": 1504349590, "answer_id": 46013021, "question_id": 45966597, "link": "https://stackoverflow.com/questions/45966597/c-copying-objects-using-memmove-and-malloc/46013021#46013021", "title": "C++: Copying Objects Using Memmove and Malloc", "body": "<p>C++ sits in an uncomfortable place between raw access to the underlying hardware, and a high level language which is capable of rapid development.</p>\n\n<p>The general principle is that you can't use memcpy to move an object, which you have broken in this case.</p>\n\n<p>When you create a class.</p>\n\n<pre><code> class Example {\n     protected:\n        char * ptr;\n        size_t len;\n     public:\n        Example( const char * str ) {\n            len = strlen( str );\n            ptr = new char[ len  + 1];\n        }\n        virtual ~Example() {\n             delete [] ptr;\n        }\n        Example &amp; operator=( const Example &amp; rhs ) {\n            if( &amp;rhs != this ) {\n                delete [] ptr;\n                len = rhs.len();\n                ptr = new char[ len + 1 ];\n                strcpy( ptr, rhs.ptr );\n            }\n        }\n        Example( const Example &amp; src ) {\n            len = src.len;\n            ptr = new char[ len + 1];\n            strcpy( ptr, src.ptr );\n        }\n        Example() {\n            ptr = new char[1];\n            ptr[0] = '\\0';\n            len = 0;\n        }\n };\n</code></pre>\n\n<p>The idea of accessing the internal state stops the designer of the class from being able to make guarantees of correctness.</p>\n\n<p>If the class Example had been memcpy'ed, then there would be two instances of the class, with both having the value ptr set.  If one of them is destroyed, then it free the memory addressed by ptr in the other, breaking the other classes internal state.</p>\n\n<p>When a class has been well implemented, copying using the operator= allows the designer to understand what can be shared, and what needs to be copied, and can ensure correct behavior.</p>\n\n<p>By modifying or copying a class using raw memory operators is heads towards undefined behavior for this reason.</p>\n"}], "owner": {"reputation": 59, "user_id": 7965754, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/656f5eb5ffc08179ea8458bb6924e3f0?s=128&d=identicon&r=PG&f=1", "display_name": "R34", "link": "https://stackoverflow.com/users/7965754/r34"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 211, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1504349590, "creation_date": 1504114630, "last_edit_date": 1504115355, "question_id": 45966597, "link": "https://stackoverflow.com/questions/45966597/c-copying-objects-using-memmove-and-malloc", "title": "C++: Copying Objects Using Memmove and Malloc", "body": "<p>I was playing around templates when I was surprised that the code below doesn't work as expected:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;string&gt;\n#include &lt;cstring&gt;\n\ntemplate &lt;class Object&gt;\nclass CreatorTWO {\npublic:\n  CreatorTWO (void) {}\n  ~CreatorTWO (void) throw () {}\n  template &lt;typename... Object_Params&gt;\n  Object* create (const Object_Params&amp;... params_) {\n    Object _temp_obj = Object(params_...);\n    size_t _obj_bytes = sizeof (_temp_obj);\n    void * _mem_block = std::malloc (_obj_bytes);\n    std::memmove(_mem_block,&amp;_temp_obj,_obj_bytes);\n    //The line below prints the dereferenced object before it is returned:\n    std::cout &lt;&lt; *(static_cast &lt;Object*&gt; (_mem_block)) &lt;&lt; '\\n';\n    return static_cast &lt;Object*&gt; (_mem_block);\n  }\n};\n\nint main (int argc, char* argv[]) {\n  CreatorTWO &lt;std::string&gt; _c2;\n  std::string* _strp = _c2.create(\"Hello\");\n  std::cout &lt;&lt; *_strp &lt;&lt; '\\n';\n  std::free (_strp);\n  return 0;\n}\n</code></pre>\n\n<p>The code above is supposed to create an object with varying number of parameters passed to it. However, when I created an instance templated with std::string to it, passing an argument of \"Hello\" should give me a pointer to string that contains \"Hello\". However, this is not the case. If you run the code above, the pre and post values are different with the pre being the correct one. Does anyone know what causes this undesired behaviour? Thanks.</p>\n"}, {"tags": ["c++", "cuda"], "comments": [{"owner": {"reputation": 119299, "user_id": 1695960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f557c03db19232aa410540af2f966?s=128&d=identicon&r=PG", "display_name": "Robert Crovella", "link": "https://stackoverflow.com/users/1695960/robert-crovella"}, "edited": false, "score": 1, "creation_date": 1504130422, "post_id": 45966515, "comment_id": 78899903, "body": "The problem is discussed <a href=\"https://devblogs.nvidia.com/parallelforall/even-easier-introduction-cuda/#comment-3457108927\" rel=\"nofollow noreferrer\">here</a> in the blog article you linked."}], "answers": [{"tags": [], "owner": {"reputation": 75, "user_id": 8539383, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/31d772e57df8d9bad06ae30276a09d8c?s=128&d=identicon&r=PG&f=1", "display_name": "Eldar Azulay", "link": "https://stackoverflow.com/users/8539383/eldar-azulay"}, "is_accepted": false, "score": 1, "last_activity_date": 1504119295, "creation_date": 1504119295, "answer_id": 45967866, "question_id": 45966515, "link": "https://stackoverflow.com/questions/45966515/i-get-access-violation-writing-location-error-when-trying-to-allocate-memory-usi/45967866#45967866", "title": "I get access violation writing location error when trying to allocate memory using CUDA", "body": "<p>The problem was that I was compiling it with x86, but when I compiled it on x64 it worked great. It didn't work with x86 because unified memory requires x64 bit OS. In addition, don't forget to call <code>cudaDeviceSynchronize()</code> after any kernel if you want to use its results once it's done.</p>\n"}], "owner": {"reputation": 75, "user_id": 8539383, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/31d772e57df8d9bad06ae30276a09d8c?s=128&d=identicon&r=PG&f=1", "display_name": "Eldar Azulay", "link": "https://stackoverflow.com/users/8539383/eldar-azulay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 473, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1504119295, "creation_date": 1504114319, "question_id": 45966515, "link": "https://stackoverflow.com/questions/45966515/i-get-access-violation-writing-location-error-when-trying-to-allocate-memory-usi", "title": "I get access violation writing location error when trying to allocate memory using CUDA", "body": "<p>I just started learning how to use CUDA api and I started with this introduction guide: <a href=\"https://devblogs.nvidia.com/parallelforall/even-easier-introduction-cuda/\" rel=\"nofollow noreferrer\">https://devblogs.nvidia.com/parallelforall/even-easier-introduction-cuda/</a></p>\n\n<p>I am following the tutorial but after I am trying to allocate memory with <code>cudaMallocManaged()</code> I want to initialize the array, but when trying to initialize the array, an exception is thrown, which says:</p>\n\n<blockquote>\n  <p>Exception thrown at 0x003983D7 in VectorAdd.exe: 0xC0000005: Access violation writing location 0x00000000.</p>\n</blockquote>\n\n<p>The program can identify my GPU, I know that because I made a function that writes all of my CUDA devices and my GPU is there.</p>\n\n<p>this is my code, just as shown on the tutorial:</p>\n\n<pre><code>int main(void)\n{\nPrintCudaDevices();\n\nint N = 1 &lt;&lt; 20; //1M elements\n\nfloat *x, *y;\n\ncudaMallocManaged(&amp;x, N * sizeof(float));\ncudaMallocManaged(&amp;y, N * sizeof(float));\n\nfor (int i = 0; i &lt; N; i++)\n{\n    x[i] = 1.0f;\n    y[i] = 2.0f;\n}\n}\n</code></pre>\n\n<p>I googled that problem but I didn't find any working solution.</p>\n"}, {"tags": ["c++", "unit-testing", "boost"], "answers": [{"tags": [], "owner": {"reputation": 326119, "user_id": 85371, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/6d52c235ec6dd15f30bab444103e7af2?s=128&d=identicon&r=PG", "display_name": "sehe", "link": "https://stackoverflow.com/users/85371/sehe"}, "is_accepted": true, "score": 1, "last_activity_date": 1504133097, "creation_date": 1504133097, "answer_id": 45970800, "question_id": 45966426, "link": "https://stackoverflow.com/questions/45966426/testing-non-fatal-error-messages-with-boost-c-unit-test-suite/45970800#45970800", "title": "Testing non-fatal error messages with boost c++ unit test suite", "body": "<blockquote>\n  <p>The unit test for this function is picking up the \"ERROR\" keyword,</p>\n</blockquote>\n\n<p>It is not.</p>\n\n<blockquote>\n  <p>and while all the assertions pass, the boost unit test suite considers it an error in execution and displays it</p>\n</blockquote>\n\n<p>Not at all. The unit test is unaware of the fact that your test prints to the console.</p>\n\n<p>Your test, though, contains a line of code:</p>\n\n<pre><code>printf(\"ERROR: Condition fail!\");\n</code></pre>\n\n<p>That line has the immediate effect of printing the following text to the standard output device:</p>\n\n<pre><code>ERROR: Condition fail!\n</code></pre>\n\n<p>This is the only reason you're seeing the text. If you inspect the report or log you'll find that (unless asserts failed) the test passed.</p>\n"}], "owner": {"reputation": 198, "user_id": 2168072, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vgOw2.png?s=128&g=1", "display_name": "Arnulfo Arroyo", "link": "https://stackoverflow.com/users/2168072/arnulfo-arroyo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 45970800, "answer_count": 1, "score": 1, "last_activity_date": 1504133097, "creation_date": 1504114006, "question_id": 45966426, "link": "https://stackoverflow.com/questions/45966426/testing-non-fatal-error-messages-with-boost-c-unit-test-suite", "title": "Testing non-fatal error messages with boost c++ unit test suite", "body": "<p>I have a function that prints an error message to stdout when it encounters a certain condition.</p>\n\n<pre><code>if(!condition)\n    printf(\"ERROR: Condition fail!\");\n</code></pre>\n\n<p>The unit test for this function is picking up the \"ERROR\" keyword, and while all the assertions pass, the boost unit test suite considers it an error in execution and displays it. Is there a way to specify an expected error message, or expected error string for a given unit test?</p>\n"}, {"tags": ["python", "c++", "opencv", "ocr", "tesseract"], "owner": {"reputation": 679, "user_id": 6837132, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/5b5807337df1982576c7f03e0121e6fe?s=128&d=identicon&r=PG&f=1", "display_name": "SarahData", "link": "https://stackoverflow.com/users/6837132/sarahdata"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1297, "favorite_count": 2, "answer_count": 0, "score": 5, "last_activity_date": 1504115826, "creation_date": 1504113999, "last_edit_date": 1504115826, "question_id": 45966425, "link": "https://stackoverflow.com/questions/45966425/improving-ocr-text-detection-segmentation-in-natural-images-using-opencv", "title": "improving OCR text detection/segmentation in natural images using OpenCV", "body": "<p>I'm working on an OCR text detection and recognition problem where after trying out <a href=\"http://docs.opencv.org/3.0-beta/modules/text/doc/erfilter.html\" rel=\"nofollow noreferrer\">Text Scene Detection and Recognition with OpenCV 3</a> using Opencv and Tesseract libraries on some images, I made some remarks (manually after checking detection image output, segmentation output and recognition output images) and I'm looking for how to improve the result by making changes in the code.</p>\n\n<p>First the images are black-white (mostly gray and the text is whether black or white) in origin and the text can be a combination of numerical and alphabetical characters.</p>\n\n<p>1 - When the text color intensity is not too different from the background one, no text is detected.</p>\n\n<p>2- When the image contain for example \"63H\" it's correctly detected, but if there is more space between (e.g: \"63 H\") it's not detected at all.</p>\n\n<p>3-When different text regions are not perfectly aligned (different picture angle than another correct text detection of the same form) one part of the text is detected, the other is not (e.g text = 12548   58A. 12548 is part one. 58A is part2).</p>\n\n<p>I tried to analyze results and thought that probably the reason behind these remarks is in ERGrouping phase ('m using the <a href=\"http://cmp.felk.cvut.cz/~neumalu1/icdar2011_article.pdf\" rel=\"nofollow noreferrer\">Exhaustive Search algorithm grouping algorithm</a>. grouping arbitrary oriented text gives me worse results). If so how to improve it?</p>\n\n<p>Can anyone help me better understand the remarks causes? (Unfortunately, I cannot share images because they are confidential) </p>\n\n<p>What modification on classifier parameters  can I do in order to improve the result (I'm using default classifiers files provided by opencv)? </p>\n\n<pre><code>createERFilterNM1(const Ptr&lt;ERFilter::Callback&gt;&amp; cb, int thresholdDelta=1, float minArea=0.00025, float maxArea=0.13, float minProbability=0.4, bool nonMaxSuppression=true, float minProbabilityDiff=0.1 )\n</code></pre>\n\n<p>What other methods can I try? (Options are open about libraries and language(Python/C++). \n    // TextRecognition.cpp\u00a0: d\u00e9finit le point d'entr\u00e9e pour l'application console.\n    //\n    /*\n     * textdetection.cpp\n     *</p>\n\n<pre><code> */\n\n#include \"opencv2/text.hpp\"\n#include \"opencv2/core/utility.hpp\"\n#include \"opencv2/core/core.hpp\"\n#include \"opencv2/highgui/highgui.hpp\"\n#include \"opencv2/imgproc/imgproc.hpp\"\n#include &lt;fstream&gt;\n\n#include &lt;iostream&gt;\n\nusing namespace std;\nusing namespace cv;\nusing namespace cv::text;\n\n//Calculate edit distance between two words\nsize_t edit_distance(const string&amp; A, const string&amp; B);\nsize_t min(size_t x, size_t y, size_t z);\nbool   isRepetitive(const string&amp; s);\nbool   sort_by_lenght(const string &amp;a, const string &amp;b);\n//Draw ER's in an image via floodFill\nvoid   er_draw(vector&lt;Mat&gt; &amp;channels, vector&lt;vector&lt;ERStat&gt; &gt; &amp;regions, vector&lt;Vec2i&gt; group, Mat&amp; segmentation);\n\n//Perform text detection and recognition and evaluate results using edit distance\nint main(int argc, char* argv[])\n{\n    cout &lt;&lt; endl &lt;&lt; argv[0] &lt;&lt; endl &lt;&lt; endl;\n    cout &lt;&lt; \"Text Detection and Recognition: \" &lt;&lt; endl;\n    cout &lt;&lt; \"algorithm described in:\" &lt;&lt; endl;\n    cout &lt;&lt; \"Real-Time Scene Text Localization and Recognition\" &lt;&lt; endl &lt;&lt; endl;\n\n    Mat image;\n    // image  = imread(\"C:\\\\scene-text-recognition\\\\scenetext01.jpg\");\n\n     if(argc&gt;1)\n        image  = imread(argv[1]);\n    else\n    {\n        cout &lt;&lt; \"    Usage: \" &lt;&lt; argv[0] &lt;&lt; \" &lt;input_image&gt; [&lt;gt_word1&gt; ... &lt;gt_wordN&gt;]\" &lt;&lt; endl;\n        return(0);\n    }\n\n\n    cout &lt;&lt; \"IMG_W=\" &lt;&lt; image.cols &lt;&lt; endl;\n    cout &lt;&lt; \"IMG_H=\" &lt;&lt; image.rows &lt;&lt; endl;\n\n\n    /*Text Detection*/\n\n    // Extract channels to be processed individually\n    vector&lt;Mat&gt; channels;\n\n    Mat grey;\n    cvtColor(image,grey,COLOR_RGB2GRAY);\n\n    // Notice here we are only using grey channel, see textdetection.cpp for example with more channels\n    channels.push_back(grey);\n    channels.push_back(255-grey);\n\n    double t_d = (double)getTickCount();\n    // Create ERFilter objects with the 1st and 2nd stage default classifiers\n    //createERFilterNM1(const Ptr&lt;ERFilter::Callback&gt;&amp; cb, int thresholdDelta=1, float minArea=0.00025, float maxArea=0.13, float minProbability=0.4, bool nonMaxSuppression=true, float minProbabilityDiff=0.1 )\n    Ptr&lt;ERFilter&gt; er_filter1 = createERFilterNM1(loadClassifierNM1(\"trained_classifierNM1.xml\"),8,0.00015f,0.13f,0.2f,true,0.2f);\n    Ptr&lt;ERFilter&gt; er_filter2 = createERFilterNM2(loadClassifierNM2(\"trained_classifierNM2.xml\"),0.5);\n\n    vector&lt;vector&lt;ERStat&gt; &gt; regions(channels.size());\n    // Apply the default cascade classifier to each independent channel (could be done in parallel)\n    for (int c=0; c&lt;(int)channels.size(); c++)\n    {\n        er_filter1-&gt;run(channels[c], regions[c]);\n        er_filter2-&gt;run(channels[c], regions[c]);\n    }\n    cout &lt;&lt; \"TIME_REGION_DETECTION = \" &lt;&lt; ((double)getTickCount() - t_d)*1000/getTickFrequency() &lt;&lt; endl;\n\n    Mat out_img_decomposition= Mat::zeros(image.rows+2, image.cols+2, CV_8UC1);\n    vector&lt;Vec2i&gt; tmp_group;\n    for (int i=0; i&lt;(int)regions.size(); i++)\n    {\n        for (int j=0; j&lt;(int)regions[i].size();j++)\n        {\n            tmp_group.push_back(Vec2i(i,j));\n        }\n        Mat tmp= Mat::zeros(image.rows+2, image.cols+2, CV_8UC1);\n        er_draw(channels, regions, tmp_group, tmp);\n        if (i &gt; 0)\n            tmp = tmp / 2;\n        out_img_decomposition = out_img_decomposition | tmp;\n        tmp_group.clear();\n    }\n\n    double t_g = (double)getTickCount();\n    // Detect character groups\n    vector&lt; vector&lt;Vec2i&gt; &gt; nm_region_groups;\n    vector&lt;Rect&gt; nm_boxes;\n     erGrouping(image, channels, regions, nm_region_groups, nm_boxes,ERGROUPING_ORIENTATION_HORIZ);\n    //erGrouping(image, channels, regions, nm_region_groups, nm_boxes,ERGROUPING_ORIENTATION_ANY,\"trained_classifier_erGrouping.xml\",0.5);\n    cout &lt;&lt; \"TIME_GROUPING = \" &lt;&lt; ((double)getTickCount() - t_g)*1000/getTickFrequency() &lt;&lt; endl;\n</code></pre>\n"}, {"tags": ["c++", "compiler-errors", "g++"], "comments": [{"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 2, "creation_date": 1504114831, "post_id": 45966247, "comment_id": 78892252, "body": "<i>&quot;internal compiler error&quot;</i> is always a bug of compiler."}], "answers": [{"comments": [{"owner": {"reputation": 1370, "user_id": 1258071, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e45d8993a6f7dd3f407a06ae8cbb3138?s=128&d=identicon&r=PG", "display_name": "tom", "link": "https://stackoverflow.com/users/1258071/tom"}, "edited": false, "score": 0, "creation_date": 1504115819, "post_id": 45966674, "comment_id": 78892793, "body": "Thank you. Unfortunately with clang I encounter this problem <a href=\"https://stackoverflow.com/questions/44262236/clang-4-build-error-on-functional-with-c1z\" title=\"clang 4 build error on functional with c1z\">stackoverflow.com/questions/44262236/&hellip;</a> in my code I&#39;m working on."}, {"owner": {"reputation": 6633, "user_id": 2378300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/852aed09b52c7514ed23f75f2921f6cc?s=128&d=identicon&r=PG", "display_name": "Jonas", "link": "https://stackoverflow.com/users/2378300/jonas"}, "reply_to_user": {"reputation": 1370, "user_id": 1258071, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e45d8993a6f7dd3f407a06ae8cbb3138?s=128&d=identicon&r=PG", "display_name": "tom", "link": "https://stackoverflow.com/users/1258071/tom"}, "edited": false, "score": 0, "creation_date": 1504116299, "post_id": 45966674, "comment_id": 78893090, "body": "That is unfortunate. I&#39;m a bit amazed how much code the two compilers output, compared to this (non template nor constexpr) version: <a href=\"https://godbolt.org/g/6KTW16\" rel=\"nofollow noreferrer\">godbolt.org/g/6KTW16</a>"}, {"owner": {"reputation": 1370, "user_id": 1258071, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e45d8993a6f7dd3f407a06ae8cbb3138?s=128&d=identicon&r=PG", "display_name": "tom", "link": "https://stackoverflow.com/users/1258071/tom"}, "edited": false, "score": 0, "creation_date": 1504120785, "post_id": 45966674, "comment_id": 78895477, "body": "Isn&#39;t it expected? If you look at the template version then you can see that two blocks of code are repeated exactly nine times."}, {"owner": {"reputation": 6633, "user_id": 2378300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/852aed09b52c7514ed23f75f2921f6cc?s=128&d=identicon&r=PG", "display_name": "Jonas", "link": "https://stackoverflow.com/users/2378300/jonas"}, "reply_to_user": {"reputation": 1370, "user_id": 1258071, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e45d8993a6f7dd3f407a06ae8cbb3138?s=128&d=identicon&r=PG", "display_name": "tom", "link": "https://stackoverflow.com/users/1258071/tom"}, "edited": false, "score": 0, "creation_date": 1504120869, "post_id": 45966674, "comment_id": 78895534, "body": "@tom I would expect the compiler to remove code &quot;duplication&quot; when optimizing"}, {"owner": {"reputation": 6633, "user_id": 2378300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/852aed09b52c7514ed23f75f2921f6cc?s=128&d=identicon&r=PG", "display_name": "Jonas", "link": "https://stackoverflow.com/users/2378300/jonas"}, "reply_to_user": {"reputation": 61409, "user_id": 485343, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e18b024a122df74275dd2c4486e8a2b4?s=128&d=identicon&r=PG", "display_name": "rustyx", "link": "https://stackoverflow.com/users/485343/rustyx"}, "edited": false, "score": 0, "creation_date": 1504121176, "post_id": 45966674, "comment_id": 78895700, "body": "@RustyX well, not in this case, the run-time will be dominated by the prints. But normally code size can be proxy for speed, though sometimes it can be miss leading."}, {"owner": {"reputation": 61409, "user_id": 485343, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e18b024a122df74275dd2c4486e8a2b4?s=128&d=identicon&r=PG", "display_name": "rustyx", "link": "https://stackoverflow.com/users/485343/rustyx"}, "edited": false, "score": 0, "creation_date": 1504121883, "post_id": 45966674, "comment_id": 78896058, "body": "It&#39;s a balance between I-Cache pollution and mispredicted branches."}], "tags": [], "owner": {"reputation": 6633, "user_id": 2378300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/852aed09b52c7514ed23f75f2921f6cc?s=128&d=identicon&r=PG", "display_name": "Jonas", "link": "https://stackoverflow.com/users/2378300/jonas"}, "is_accepted": true, "score": 3, "last_activity_date": 1504115435, "last_edit_date": 1504115435, "creation_date": 1504114910, "answer_id": 45966674, "question_id": 45966247, "link": "https://stackoverflow.com/questions/45966247/nested-static-for-causes-compiler-error/45966674#45966674", "title": "Nested `static_for` causes compiler error", "body": "<p>This is a bug that has been fixed in GCC 8 (experimental), <a href=\"https://godbolt.org/g/eVAvnn\" rel=\"nofollow noreferrer\">here</a> is an example of the generated assembly, just for fun. Please note that since this not a final release it is not stable, hence it is denoted as <em>experimental</em>. When it is released, a complete list of changes can be found <a href=\"https://gcc.gnu.org/gcc-8/changes.html\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>So, sit back and wait, or use another compiler such as clang 4.0.0 for now, <a href=\"https://godbolt.org/g/9G6jn8\" rel=\"nofollow noreferrer\">online</a>.</p>\n"}], "owner": {"reputation": 1370, "user_id": 1258071, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e45d8993a6f7dd3f407a06ae8cbb3138?s=128&d=identicon&r=PG", "display_name": "tom", "link": "https://stackoverflow.com/users/1258071/tom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 45966674, "answer_count": 1, "score": 3, "last_activity_date": 1504115435, "creation_date": 1504113319, "question_id": 45966247, "link": "https://stackoverflow.com/questions/45966247/nested-static-for-causes-compiler-error", "title": "Nested `static_for` causes compiler error", "body": "<p>I use <code>static_for</code> based on <a href=\"https://stackoverflow.com/questions/13816850/is-it-possible-to-develop-static-for-loop-in-c/45819050?noredirect=1#comment78677035_45819050\">this question</a>. I nest two <code>static_for</code> loops, compile with <code>g++-7 -std=c++1z main.cpp</code> and everything works fine</p>\n\n<pre><code>#include &lt;iostream&gt;\n\ntemplate &lt;int First, int Last&gt;\nstruct static_for\n{\n  template &lt;typename Lambda&gt;\n  static inline constexpr void apply(Lambda const&amp; f)\n  {\n    if constexpr (First &lt; Last)\n      {\n    f(std::integral_constant&lt;int, First&gt;{});\n    static_for&lt;First + 1, Last&gt;::apply(f);\n      }\n  }\n};\n\ntemplate&lt;int i, int j&gt;\nvoid bar(){\n  std::cout &lt;&lt; i &lt;&lt; \" \" &lt;&lt; j &lt;&lt; std::endl;\n}\n\nint main(){\n\n  static_for&lt;0,3&gt;\n    ::apply([&amp;](auto ii){\n          static_for&lt;0,3&gt;\n        ::apply([&amp;](auto jj){\n              bar&lt;ii.value,jj.value&gt;();\n            });\n        });\n\n  return 0;\n}\n</code></pre>\n\n<p>But when I change the <code>main</code> function to</p>\n\n<pre><code>int main(){\n\n  static_for&lt;0,3&gt;\n    ::apply([&amp;](auto ii){\n          constexpr int i = ii.value;\n          static_for&lt;0,3&gt;\n        ::apply([&amp;](auto jj){\n              constexpr int j = jj.value;\n              bar&lt;i,j&gt;();\n            });\n        });\n\n  return 0;\n}\n</code></pre>\n\n<p>I get a compiler error</p>\n\n<pre><code>compiler_error.cpp: In instantiation of \u2018main()::&lt;lambda(auto:1)&gt;::&lt;lambda(auto:2)&gt; [with auto:2 = std::integral_constant&lt;int, 0&gt;; auto:1 = std::integral_constant&lt;int, 0&gt;]\u2019:\ncompiler_error.cpp:11:3:   required from \u2018static constexpr void static_for&lt;First, Last&gt;::apply(const Lambda&amp;) [with Lambda = main()::&lt;lambda(auto:1)&gt; [with auto:1 = std::integral_constant&lt;int, 0&gt;]::&lt;lambda(auto:2)&gt;; int First = 0; int Last = 3]\u2019\ncompiler_error.cpp:28:10:   required from \u2018main()::&lt;lambda(auto:1)&gt; [with auto:1 = std::integral_constant&lt;int, 0&gt;]\u2019\ncompiler_error.cpp:11:3:   required from \u2018static constexpr void static_for&lt;First, Last&gt;::apply(const Lambda&amp;) [with Lambda = main()::&lt;lambda(auto:1)&gt;; int First = 0; int Last = 3]\u2019\ncompiler_error.cpp:32:7:   required from here\ncompiler_error.cpp:26:29: internal compiler error: in tsubst_copy, at cp/pt.c:14539\n        constexpr int i = ii.value;\n                          ~~~^~~~~\n0x5eb5c2 tsubst_copy\n    ../../src/gcc/cp/pt.c:14539\n0x5ef666 tsubst_copy\n    ../../src/gcc/cp/pt.c:14515\n0x5ef666 tsubst_copy_and_build(tree_node*, tree_node*, int, tree_node*, bool, bool)\n    ../../src/gcc/cp/pt.c:17831\n0x5ef549 tsubst_copy_and_build(tree_node*, tree_node*, int, tree_node*, bool, bool)\n    ../../src/gcc/cp/pt.c:17611\n0x5e83c7 tsubst_expr(tree_node*, tree_node*, int, tree_node*, bool)\n    ../../src/gcc/cp/pt.c:16550\n0x5e95f1 tsubst_expr(tree_node*, tree_node*, int, tree_node*, bool)\n    ../../src/gcc/cp/pt.c:14477\n0x5e95f1 tsubst_init\n    ../../src/gcc/cp/pt.c:14483\n0x5eb558 tsubst_copy\n    ../../src/gcc/cp/pt.c:14681\n0x5ef666 tsubst_copy\n    ../../src/gcc/cp/pt.c:14515\n0x5ef666 tsubst_copy_and_build(tree_node*, tree_node*, int, tree_node*, bool, bool)\n    ../../src/gcc/cp/pt.c:17831\n0x5e83c7 tsubst_expr(tree_node*, tree_node*, int, tree_node*, bool)\n    ../../src/gcc/cp/pt.c:16550\n0x5edd52 tsubst_template_args\n    ../../src/gcc/cp/pt.c:11779\n0x5eea61 tsubst_copy_and_build(tree_node*, tree_node*, int, tree_node*, bool, bool)\n    ../../src/gcc/cp/pt.c:16736\n0x5ef086 tsubst_copy_and_build(tree_node*, tree_node*, int, tree_node*, bool, bool)\n    ../../src/gcc/cp/pt.c:17232\n0x5e83c7 tsubst_expr(tree_node*, tree_node*, int, tree_node*, bool)\n    ../../src/gcc/cp/pt.c:16550\n0x5e8225 tsubst_expr(tree_node*, tree_node*, int, tree_node*, bool)\n    ../../src/gcc/cp/pt.c:15815\n0x5e8275 tsubst_expr(tree_node*, tree_node*, int, tree_node*, bool)\n    ../../src/gcc/cp/pt.c:15801\n0x5e810b tsubst_expr(tree_node*, tree_node*, int, tree_node*, bool)\n    ../../src/gcc/cp/pt.c:16027\n0x5e810b tsubst_expr(tree_node*, tree_node*, int, tree_node*, bool)\n    ../../src/gcc/cp/pt.c:16027\n0x5e68a2 instantiate_decl(tree_node*, bool, bool)\n    ../../src/gcc/cp/pt.c:22986\nPlease submit a full bug report,\nwith preprocessed source if appropriate.\nPlease include the complete backtrace with any bug report.\nSee &lt;file:///usr/share/doc/gcc-7/README.Bugs&gt; for instructions.\n</code></pre>\n\n<p>My g++ version</p>\n\n<pre><code>$ g++-7 -v\nUsing built-in specs.\nCOLLECT_GCC=/usr/bin/g++-7\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/7/lto-wrapper\nOFFLOAD_TARGET_NAMES=nvptx-none\nOFFLOAD_TARGET_DEFAULT=1\nTarget: x86_64-linux-gnu\nConfigured with: ../src/configure -v --with-pkgversion='Ubuntu 7.2.0-1ubuntu1~16.04' --with-bugurl=file:///usr/share/doc/gcc-7/README.Bugs --enable-languages=c,ada,c++,go,brig,d,fortran,objc,obj-c++ --prefix=/usr --with-gcc-major-version-only --program-suffix=-7 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --with-sysroot=/ --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-libmpx --enable-plugin --with-system-zlib --with-target-system-zlib --enable-objc-gc=auto --enable-multiarch --disable-werror --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-offload-targets=nvptx-none --without-cuda-driver --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\nThread model: posix\ngcc version 7.2.0 (Ubuntu 7.2.0-1ubuntu1~16.04) \n</code></pre>\n\n<p>If it is really a compiler error I should probably report this bug, but I have no idea how to find out if the bug has been reported or not. What should I do?</p>\n"}, {"tags": ["c++", "constructor"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2100815"}, "edited": false, "score": 1, "creation_date": 1504112862, "post_id": 45966107, "comment_id": 78891127, "body": "What does your C++ textbook have to say on the subject?"}, {"owner": {"reputation": 7681, "user_id": 8242698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/BjJXu.jpg?s=128&g=1", "display_name": "user0042", "link": "https://stackoverflow.com/users/8242698/user0042"}, "edited": false, "score": 0, "creation_date": 1504113955, "post_id": 45966107, "comment_id": 78891748, "body": "Initialization is different from assignment."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2100815"}, "edited": false, "score": 0, "creation_date": 1504113545, "post_id": 45966156, "comment_id": 78891513, "body": "That doesn&#39;t disable copy initialisation. It disables conversion from an <code>int</code> to a <code>Foo</code>."}, {"owner": {"reputation": 42370, "user_id": 3980929, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/xyKrD.png?s=128&g=1", "display_name": "Rakete1111", "link": "https://stackoverflow.com/users/3980929/rakete1111"}, "edited": false, "score": 0, "creation_date": 1504113698, "post_id": 45966156, "comment_id": 78891608, "body": "It doesn&#39;t directly disable copy initialization. It&#39;s just that explicit constructors are not considered for copy initialization."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2100815"}, "edited": false, "score": 0, "creation_date": 1504113808, "post_id": 45966156, "comment_id": 78891665, "body": "Disabling copy initialisation would not allow <code>Foo f; Foo g = f;</code>, which your code does not."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2100815"}, "edited": false, "score": 0, "creation_date": 1504114004, "post_id": 45966156, "comment_id": 78891774, "body": "Well, you have now completely re-written your answer, so these comments are moot."}, {"owner": {"reputation": 6172, "user_id": 8254699, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b91384172702e29895e620c2b0924ef3?s=128&d=identicon&r=PG&f=1", "display_name": "kocica", "link": "https://stackoverflow.com/users/8254699/kocica"}, "edited": false, "score": 0, "creation_date": 1504114118, "post_id": 45966156, "comment_id": 78891833, "body": "Yes iam not good english speaker so you were right. We may remove these comments now. Anyway thank you."}, {"owner": {"reputation": 43, "user_id": 7874112, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45e598d98d77a0f0399c716b2f513bc7?s=128&d=identicon&r=PG", "display_name": "Larry Liang", "link": "https://stackoverflow.com/users/7874112/larry-liang"}, "edited": false, "score": 1, "creation_date": 1504145691, "post_id": 45966156, "comment_id": 78903354, "body": "I have apparently mixed up the concept of assignment and initialization. After using the right key word, I can find a lot more resources. Thank you very much."}], "tags": [], "owner": {"reputation": 6172, "user_id": 8254699, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b91384172702e29895e620c2b0924ef3?s=128&d=identicon&r=PG&f=1", "display_name": "kocica", "link": "https://stackoverflow.com/users/8254699/kocica"}, "is_accepted": true, "score": 2, "last_activity_date": 1504114023, "last_edit_date": 1504114023, "creation_date": 1504112956, "answer_id": 45966156, "question_id": 45966107, "link": "https://stackoverflow.com/questions/45966107/constructor-with-assignment-operator/45966156#45966156", "title": "constructor with assignment operator", "body": "<p>The <code>Foo</code> object is constructed from value assigned to object (<a href=\"http://en.cppreference.com/w/cpp/language/implicit_conversion\" rel=\"nofollow noreferrer\">implicit conversation</a>)</p>\n\n<blockquote>\n  <p>Implicit conversions are performed whenever an expression of some type\n  T1 is used in context that does not accept that type, but accepts some\n  other type T2</p>\n</blockquote>\n\n<p>where it is used in this context. Then <a href=\"http://en.cppreference.com/w/cpp/language/copy_initialization\" rel=\"nofollow noreferrer\">copy-initializtion</a> initializes an object from another object (constructed via implicit conversation as mentioned before)</p>\n\n<p>You can disable it (<strong>only for this constructor</strong>) by using <code>explicit</code> keyword.</p>\n\n<pre><code>explicit Foo(int a)\n</code></pre>\n\n<p>Which makes this operation</p>\n\n<pre><code>Foo f1 = 100;\n</code></pre>\n\n<p>illegal.</p>\n"}], "owner": {"reputation": 43, "user_id": 7874112, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45e598d98d77a0f0399c716b2f513bc7?s=128&d=identicon&r=PG", "display_name": "Larry Liang", "link": "https://stackoverflow.com/users/7874112/larry-liang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "accepted_answer_id": 45966156, "answer_count": 1, "score": -1, "last_activity_date": 1504114023, "creation_date": 1504112763, "question_id": 45966107, "link": "https://stackoverflow.com/questions/45966107/constructor-with-assignment-operator", "title": "constructor with assignment operator", "body": "<p>I am learning C++ and come across this question when learning the use of constructors. Consider the snippet below: </p>\n\n<pre><code>#include &lt;string&gt;\n#include &lt;iostream&gt;\n\nusing namespace std;\n\nclass Foo\n{\npublic:\n    Foo() { m_ = 0; cout &lt;&lt; \"default ctor called.\" &lt;&lt; endl; }\n    Foo(int a) { m_ = 1; cout &lt;&lt; \"int ctor called.\" &lt;&lt; endl; }\n    Foo(string str) { m_ = 2; cout &lt;&lt; \"str ctor called.\" &lt;&lt; endl; }\n    Foo(Foo&amp; f)\n    {\n        cout &lt;&lt; \"copy ctor called.\" &lt;&lt; endl;\n        m_ = f.m_;\n    }\n\n    Foo&amp; operator=(string str)\n    {\n        cout &lt;&lt; \"= operator called.\" &lt;&lt; endl;\n        m_ = 3;\n        return *this;\n    }\n\n    int m_;\n};\n\n\nint main()\n{\n    Foo f1 = 100;\n    cout &lt;&lt; f1.m_ &lt;&lt; endl;\n\n    Foo f2 = \"ya\";\n    cout &lt;&lt; f2.m_ &lt;&lt; endl;\n\n    Foo f3(\"ha\");\n    cout &lt;&lt; f3.m_ &lt;&lt; endl;\n\n    f1 = \"hee\";\n    cout &lt;&lt; f1.m_ &lt;&lt; endl;\n\n    Foo f4 = Foo();\n    cout &lt;&lt; f4.m_ &lt;&lt; endl;\n\n    return 0;\n}\n</code></pre>\n\n<p>I realize that </p>\n\n<pre><code>Foo f1 = 100;\n\nFoo f2 = \"ya\";\n</code></pre>\n\n<p>actually calls the constructors as if I am doing</p>\n\n<pre><code>Foo f1(100);\n\nFoo f2(\"ya\");\n</code></pre>\n\n<p>I fail to find any relevant explanation on this. Can anyone please explain what is going on here? \nThe following thread is close to mine but doesn't answer exactly my question.\n<a href=\"https://stackoverflow.com/questions/11853700/c-object-instantiation-vs-assignment\">C++ Object Instantiation vs Assignment</a></p>\n"}, {"tags": ["c++", "c++11", "templates", "sfinae"], "answers": [{"comments": [{"owner": {"reputation": 41558, "user_id": 3204551, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/91bb06155f79d40ffecdf124deecb001?s=128&d=identicon&r=PG&f=1", "display_name": "Deduplicator", "link": "https://stackoverflow.com/users/3204551/deduplicator"}, "edited": false, "score": 0, "creation_date": 1504113058, "post_id": 45965995, "comment_id": 78891238, "body": "Also a nice one."}], "tags": [], "owner": {"reputation": 44802, "user_id": 2752075, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5oQlf.png?s=128&g=1", "display_name": "HolyBlackCat", "link": "https://stackoverflow.com/users/2752075/holyblackcat"}, "is_accepted": true, "score": 3, "last_activity_date": 1504113373, "last_edit_date": 1504113373, "creation_date": 1504112379, "answer_id": 45965995, "question_id": 45965824, "link": "https://stackoverflow.com/questions/45965824/create-typedef-only-when-typedef-exists-in-template-parameter/45965995#45965995", "title": "Create typedef only when typedef exists in template parameter", "body": "<p>You could create a base class for each such type, and specialize that base with SFINAE:</p>\n\n<pre><code>template &lt;typename...&gt; struct void_type\n{\n    using type = void;\n};\n\ntemplate &lt;typename T, typename = void&gt; struct ContainerWrapper_Base_const_reverse_iterator{};\ntemplate &lt;typename T&gt; struct ContainerWrapper_Base_const_reverse_iterator\n    &lt;T, typename void_type&lt;typename T::const_reverse_iterator&gt;::type&gt;\n{\n    using const_reverse_iterator = typename T::const_reverse_iterator;\n};\n\n// ... Similar bases for each conditional alias.\n\ntemplate &lt;typename type&gt; class ContainerWrapper\n: public ContainerWrapper_Base_const_reverse_iterator&lt;type&gt;\n    // ... Inherit from all those bases\n{\n    // ...\n};\n</code></pre>\n\n<p>You could possibly put similar types into a single base, if you're sure that they're always defined together or not defined at all.</p>\n\n<p>Also, you might want to generate those bases with preprocessor, possibly with x-macros.</p>\n\n<p>Also note that the above code could be simplified with C++17 <code>std::void_t</code> or a handwritten <code>template &lt;typename...&gt; using void_t = void;</code>, but neither work properly in GCC 4.7.</p>\n"}, {"tags": [], "owner": {"reputation": 41558, "user_id": 3204551, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/91bb06155f79d40ffecdf124deecb001?s=128&d=identicon&r=PG&f=1", "display_name": "Deduplicator", "link": "https://stackoverflow.com/users/3204551/deduplicator"}, "is_accepted": false, "score": 3, "last_activity_date": 1504112875, "creation_date": 1504112875, "answer_id": 45966134, "question_id": 45965824, "link": "https://stackoverflow.com/questions/45965824/create-typedef-only-when-typedef-exists-in-template-parameter/45966134#45966134", "title": "Create typedef only when typedef exists in template parameter", "body": "<p>Is a raw array container-y enough for you?<br>\nAnyway:</p>\n\n<p>Use SFINAE, overload-resolution and inheritance.</p>\n\n<pre><code>namespace detail {\n    using std::rbegin;\n    template &lt;class T&gt;\n    auto reverse_iter_typedefs(long) {\n        struct {} r;\n        return r;\n    }\n    template &lt;class T, class X = decltype(rbegin(std::declval&lt;T&amp;&gt;()))&gt;\n    auto reverse_iter_typedefs(int) {\n        struct {\n            using reverse_iterator = decltype(rbegin(std::declval&lt;T&amp;&gt;()));\n        } r;\n        return r;\n    }\n}\n\ntemplate &lt;class T&gt;\nContainerWrapper : decltype(detail::reverse_iter_typedefs&lt;T&gt;(1)), ...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 17136, "user_id": 1169435, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/wsvfb.jpg?s=128&g=1", "display_name": "ISanych", "link": "https://stackoverflow.com/users/1169435/isanych"}, "edited": false, "score": 0, "creation_date": 1504123315, "post_id": 45968447, "comment_id": 78896761, "body": "I use auto, but there is old code which not always easy to change, so wrapper should be as close to original containers as possible."}, {"owner": {"reputation": 17136, "user_id": 1169435, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/wsvfb.jpg?s=128&g=1", "display_name": "ISanych", "link": "https://stackoverflow.com/users/1169435/isanych"}, "edited": false, "score": 0, "creation_date": 1504123814, "post_id": 45968447, "comment_id": 78896982, "body": "And auto as function type is c++14 or 17, but not 11"}, {"owner": {"reputation": 433, "user_id": 8411980, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/43f65b4972600a0d9610a0ddcd587fe1?s=128&d=identicon&r=PG&f=1", "display_name": "AOK", "link": "https://stackoverflow.com/users/8411980/aok"}, "reply_to_user": {"reputation": 17136, "user_id": 1169435, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/wsvfb.jpg?s=128&g=1", "display_name": "ISanych", "link": "https://stackoverflow.com/users/1169435/isanych"}, "edited": false, "score": 0, "creation_date": 1504167417, "post_id": 45968447, "comment_id": 78911672, "body": "ISanych, I added c++11 compatibility using auto. Tested on an online gcc compiler (v4.6.3)"}], "tags": [], "owner": {"reputation": 433, "user_id": 8411980, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/43f65b4972600a0d9610a0ddcd587fe1?s=128&d=identicon&r=PG&f=1", "display_name": "AOK", "link": "https://stackoverflow.com/users/8411980/aok"}, "is_accepted": false, "score": 1, "last_activity_date": 1504167349, "last_edit_date": 1504167349, "creation_date": 1504121778, "answer_id": 45968447, "question_id": 45965824, "link": "https://stackoverflow.com/questions/45965824/create-typedef-only-when-typedef-exists-in-template-parameter/45968447#45968447", "title": "Create typedef only when typedef exists in template parameter", "body": "<p>\nIs there a reason why your aren't using <code>auto</code> for you functions?\n<p>\nUsing HolyBlackCat's code, you should consider grouping types and functions that will clearly (or should) come together, and using auto to avoid ambiguous function calls:</p>\n\n<pre><code>template &lt;typename...&gt; struct void_type { using type = void; };\ntemplate&lt;typename type, typename = void&gt;\nstruct conditional_derive_iterator {\nprotected:\n    conditional_derive_iterator(type*const container) {}\n};\ntemplate&lt;typename type&gt;\nstruct conditional_derive_iterator\n    &lt;type, typename void_type&lt;typename type::iterator&gt;::type&gt;\n{\n    // grouping types\n    using iterator = typename type::iterator;\n    using const_iterator = typename type::const_iterator;\n    // this should work with gcc. avoids ambiguity. cleaner code\n    inline constexpr auto begin() const noexcept { return c-&gt;begin(); }\n    inline constexpr auto end() const noexcept { return c-&gt;end(); }\nprotected:\n    // this will let you get access to the container\n    conditional_derive_iterator(type*const container) : c(container) {}\nprivate:\n    type*const c;\n};\n\ntemplate&lt;typename type&gt;\nclass ContainerWrapper :\n    public conditional_derive_iterator&lt;type&gt;\n{\npublic:\n    // for demo purpose. however, make sure to pass &amp;container to your bases\n    ContainerWrapper(const type&amp; c) :\n        container(c),\n        conditional_derive_iterator(&amp;container) {}\n    // continue code...\n};\n\nclass UselessType{};\n\nvoid main()\n{\n    ContainerWrapper&lt;UselessType&gt; a(UselessType{});\n    ContainerWrapper&lt;std::vector&lt;int&gt;&gt; b({1,2,3});\n    auto itera = a.begin(); // this will not compile\n    auto iterb = b.begin(); // this will compile\n}\n</code></pre>\n\n<p>While <code>auto func()...</code> is c++14 and up, I believe that <code>auto func() -&gt; return_type</code> is c++11, so begin/end would look like this:</p>\n\n<pre><code>inline constexpr auto begin() const noexcept -&gt; decltype(iterator{}, const_iterator{}) { return c-&gt;begin(); }\n</code></pre>\n\n<p>Here is an example: <a href=\"https://repl.it/K9g5/0\" rel=\"nofollow noreferrer\">https://repl.it/K9g5/0</a></p>\n\n<p>You should also take a look at this Member Detector: <a href=\"https://en.wikibooks.org/wiki/More_C%2B%2B_Idioms/Member_Detector\" rel=\"nofollow noreferrer\">https://en.wikibooks.org/wiki/More_C%2B%2B_Idioms/Member_Detector</a>\n<p>\nIt could come in handy.</p>\n"}], "owner": {"reputation": 17136, "user_id": 1169435, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/wsvfb.jpg?s=128&g=1", "display_name": "ISanych", "link": "https://stackoverflow.com/users/1169435/isanych"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 45965995, "answer_count": 3, "score": 1, "last_activity_date": 1504167349, "creation_date": 1504111688, "question_id": 45965824, "link": "https://stackoverflow.com/questions/45965824/create-typedef-only-when-typedef-exists-in-template-parameter", "title": "Create typedef only when typedef exists in template parameter", "body": "<p>I'm trying to create universal container wrapper.</p>\n\n<pre><code>template&lt;typename type&gt;\nclass ContainerWrapper\n{\npublic:\n  using allocator_type = typename type::allocator_type;\n  using size_type = typename type::size_type;\n  using difference_type = typename type::difference_type;\n  using pointer = typename type::pointer;\n  using const_pointer = typename type::const_pointer;\n  using reference = typename type::reference;\n  using const_reference = typename type::const_reference;\n  using iterator = typename type::iterator;\n  using const_iterator = typename type::const_iterator;\n  using reverse_iterator = typename type::reverse_iterator;\n  using const_reverse_iterator = typename type::const_reverse_iterator;\n  using value_type = typename type::value_type;\n\n  iterator begin() noexcept { return container.begin(); }\n  const_iterator begin() const noexcept { return container.begin(); }\n  iterator end() noexcept { return container.end(); }\n  const_iterator end() const noexcept { return container.end(); }\n  reverse_iterator rbegin() noexcept { return container.rbegin(); }\n  const_reverse_iterator rbegin() const noexcept { return container.rbegin(); }\n  reverse_iterator rend() noexcept { return container.rend(); }\n  const_reverse_iterator rend() const noexcept { return container.rend(); }\n  const_iterator cbegin() const noexcept { return container.cbegin(); }\n  const_iterator cend() const noexcept { return container.cend(); }\n  const_reverse_iterator crbegin() const noexcept { return container.crbegin(); }\n  const_reverse_iterator crend() const noexcept { return container.crend(); }\nprotected:\n  ContainerWrapper() {}\n  type&amp; getContainer() { return container; }\n  const type&amp; getContainer() const { return container; }\nprivate:\n  type container;\n};\n</code></pre>\n\n<p>But not all containers have all kinds of iterators. Is it possible to expose container types only when they exists? Something like</p>\n\n<pre><code>using const_reverse_iterator = typename std::enable_if_t&lt;std::is_class&lt;typename type::const_reverse_iterator&gt;::value, typename type::const_reverse_iterator&gt;::type;\n</code></pre>\n\n<p>I could use C++11 only (gcc 4.7). Of course I could create different wrappers for different containers, but I prefer to have one universal wrapper.</p>\n"}, {"tags": ["c++", "avro"], "answers": [{"tags": [], "owner": {"reputation": 61, "user_id": 4218502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eadad0180d22c194340d509527be30?s=128&d=identicon&r=PG&f=1", "display_name": "brunobignose", "link": "https://stackoverflow.com/users/4218502/brunobignose"}, "is_accepted": false, "score": 0, "last_activity_date": 1504113589, "creation_date": 1504113589, "answer_id": 45966313, "question_id": 45965783, "link": "https://stackoverflow.com/questions/45965783/avro-unions-containing-multiple-arrays/45966313#45966313", "title": "Avro unions containing multiple arrays", "body": "<p>Found my answer in the standard. You can't have more than one array or map inside a union. </p>\n\n<p>Sounds somewhat lame to me, so I'll have to find a dirty work around.</p>\n"}, {"comments": [{"owner": {"reputation": 61, "user_id": 4218502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eadad0180d22c194340d509527be30?s=128&d=identicon&r=PG&f=1", "display_name": "brunobignose", "link": "https://stackoverflow.com/users/4218502/brunobignose"}, "edited": false, "score": 0, "creation_date": 1507281810, "post_id": 46555751, "comment_id": 80156705, "body": "That can&#39;t work with our internal type system, I got around it by wrapping each array type in a dummy record."}], "tags": [], "owner": {"reputation": 304, "user_id": 987696, "user_type": "registered", "profile_image": "https://graph.facebook.com/3624556/picture?type=large", "display_name": "Johan Gyllenspetz", "link": "https://stackoverflow.com/users/987696/johan-gyllenspetz"}, "is_accepted": false, "score": 2, "last_activity_date": 1507080991, "creation_date": 1507080991, "answer_id": 46555751, "question_id": 45965783, "link": "https://stackoverflow.com/questions/45965783/avro-unions-containing-multiple-arrays/46555751#46555751", "title": "Avro unions containing multiple arrays", "body": "<p>I actually don't think this is what you want todo. What you want todo is create an array that have different types. Like this.</p>\n\n<pre><code>{\n  \"namespace\": \"example.avro\",\n  \"type\": \"record\",\n  \"name\": \"Example\",\n  \"fields\": [\n    {\n      \"name\": \"values\",\n      \"type\":\n      {\n        \"type\": \"array\",\n        \"items\": [\"int\", \"string\"]\n      }\n    }\n  ]\n}\n</code></pre>\n\n<p>This will create an array that can have two simple types. Either \"int\" or \"string\". You can pop any complex type in there.</p>\n"}], "owner": {"reputation": 61, "user_id": 4218502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eadad0180d22c194340d509527be30?s=128&d=identicon&r=PG&f=1", "display_name": "brunobignose", "link": "https://stackoverflow.com/users/4218502/brunobignose"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1888, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1533383861, "creation_date": 1504111554, "question_id": 45965783, "link": "https://stackoverflow.com/questions/45965783/avro-unions-containing-multiple-arrays", "title": "Avro unions containing multiple arrays", "body": "<p>I'm attempting to use the C++ avro library in our software and I've hit a significant snag. I have a \"Value\" class that wraps a range of types, and I want to use avro to read/write it. This includes not only simple types, but std::vectors of types, arbitrary classes and more.</p>\n\n<p>I'm trying to specify an avro schema for my \"Value\" class. In my example I've limited it to it to empty, int, long, arrays of ints and arrays of long.</p>\n\n<p>My schema is a record with two fields, one that identifies the contained type, and a union to hold the contained object. The schema I have for it is the following...</p>\n\n<pre><code>{\n    \"type\": \"record\",\n    \"name\": \"Value\",\n    \"fields\": [\n        {\n            \"name\": \"ilk\",\n            \"type\": \"string\"\n        },\n        {\n            \"name\": \"contents\",\n            \"type\": [\n                \"null\",\n                \"boolean\",\n                \"int\",\n                {\n                    \"type\": \"array\",\n                    \"items\": \"int\"\n                },\n                \"long\",\n                {\n                    \"type\": \"array\",\n                    \"items\": \"long\"\n                }\n            ]\n        }\n    ]\n}\n</code></pre>\n\n<p>I don't specify the JSON, but construct an avro C++ schema hierarchy which printed out the above. Validating that schema hierarchy fails though. Sniffing through the C++ code it stops you having more than one array or map in the union, even if the types in the array or map are different.</p>\n\n<p>Is this actually a part of the avro standard or is it a bug in the C++ implementation? I get that specifying the same type twice is a silly thing to do, but I would not have thought that arrays and maps with different contained types would be allowed. </p>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 7681, "user_id": 8242698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/BjJXu.jpg?s=128&g=1", "display_name": "user0042", "link": "https://stackoverflow.com/users/8242698/user0042"}, "edited": false, "score": 2, "creation_date": 1504111309, "post_id": 45965709, "comment_id": 78890335, "body": "Use <code>std::string</code> instead of a char array."}, {"owner": {"reputation": 2374, "user_id": 8491726, "user_type": "registered", "profile_image": "https://graph.facebook.com/1550562035006492/picture?type=large", "display_name": "Artemy Vysotsky", "link": "https://stackoverflow.com/users/8491726/artemy-vysotsky"}, "edited": false, "score": 0, "creation_date": 1504111684, "post_id": 45965709, "comment_id": 78890512, "body": "better construct the bitset from unsigned char instead of string"}], "answers": [{"tags": [], "owner": {"reputation": 64049, "user_id": 2015579, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/28571d6df35321850e78b1ebfd48e5b4?s=128&d=identicon&r=PG", "display_name": "Richard Hodges", "link": "https://stackoverflow.com/users/2015579/richard-hodges"}, "is_accepted": false, "score": 1, "last_activity_date": 1504114664, "creation_date": 1504114664, "answer_id": 45966602, "question_id": 45965709, "link": "https://stackoverflow.com/questions/45965709/character-string-to-bitset-in-c/45966602#45966602", "title": "character string to bitset in C++", "body": "<p>We can write a stl-like container wrapper such that we can write:</p>\n\n<pre><code>int main() {\n    std::bitset&lt;8&gt; x(0x01);\n\n    auto container = make_bit_range(x);\n    std::reverse(container.begin(), container.end());\n\n    std::cout &lt;&lt; x &lt;&lt; std::endl;\n}\n</code></pre>\n\n<p>and expect the output:</p>\n\n<pre><code>10000000\n</code></pre>\n\n<p>full code:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;bitset&gt;\n#include &lt;algorithm&gt;\n\ntemplate&lt;std::size_t N&gt;\nstruct bit_reference  {\n    bit_reference(std::bitset&lt;N&gt;&amp; data, int i) : data_(data), i_(i) {}\n\n    operator bool() const { return data_[i_]; }\n    bit_reference&amp; operator=(bool x) {\n        data_[i_] = x;\n        return *this;\n    }\n\n    std::bitset&lt;N&gt;&amp; data_;\n    int i_;\n};\n\ntemplate&lt;std::size_t N&gt;\nvoid swap(bit_reference&lt;N&gt; l, bit_reference&lt;N&gt; r) {\n    auto lv = bool(l);\n    auto rv = bool(r);\n    std::swap(lv, rv);\n    l = lv;\n    r = rv;\n}\n\n\ntemplate&lt;std::size_t N&gt;\nstruct bit_range {\n    using bitset_type = std::bitset&lt;N&gt;;\n\n    bit_range(bitset_type &amp;data) : data_(data) {}\n\n    struct iterator {\n        using iterator_category = std::bidirectional_iterator_tag;\n        using value_type = bit_reference&lt;N&gt;;\n        using difference_type = int;\n        using pointer = value_type *;\n        using reference = value_type &amp;;\n\n        iterator(bitset_type &amp;data, int i) : data_(data), i_(i) {}\n\n        bool operator==(iterator const &amp;r) const { return i_ == r.i_; }\n\n        bool operator!=(iterator const &amp;r) const { return i_ != r.i_; }\n\n        iterator &amp;operator--() {\n            return update(i_ - 1);\n        }\n\n        iterator &amp;operator++() {\n            return update(i_ + 1);\n        }\n\n        value_type operator*() const {\n            return bit_reference&lt;N&gt;(data_, i_);\n        }\n\n    private:\n        auto update(int pos) -&gt; iterator &amp; {\n            i_ = pos;\n            return *this;\n        }\n\n    private:\n        bitset_type &amp;data_;\n        int i_;\n    };\n\n    auto begin() const { return iterator(data_, 0); }\n\n    auto end() const { return iterator(data_, int(data_.size())); }\n\nprivate:\n    bitset_type &amp;data_;\n};\n\ntemplate&lt;std::size_t N&gt;\nauto make_bit_range(std::bitset&lt;N&gt; &amp;data) {\n    return bit_range&lt;N&gt;(data);\n}\n\n\nint main() {\n    std::bitset&lt;8&gt; x(0x01);\n\n    auto container = make_bit_range(x);\n    std::reverse(container.begin(), container.end());\n\n    std::cout &lt;&lt; x &lt;&lt; std::endl;\n}\n</code></pre>\n\n<p>also plenty of fun algorithms here: <a href=\"https://stackoverflow.com/questions/746171/best-algorithm-for-bit-reversal-from-msb-lsb-to-lsb-msb-in-c\">Best Algorithm for Bit Reversal ( from MSB-&gt;LSB to LSB-&gt;MSB) in C</a></p>\n"}], "owner": {"reputation": 17, "user_id": 8194844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c3f53d2097a3a9e94ba78603c16283e?s=128&d=identicon&r=PG&f=1", "display_name": "Nate", "link": "https://stackoverflow.com/users/8194844/nate"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 665, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1504114664, "creation_date": 1504111230, "question_id": 45965709, "link": "https://stackoverflow.com/questions/45965709/character-string-to-bitset-in-c", "title": "character string to bitset in C++", "body": "<p>I am still kind of new to C++ and am trying to figure out what I am not able to pass a value correctly to a bitset, at least I suspect that is what the problem is. \nI wrote a small function to assist in flipping the bits of a hex value to reverse the endian. So example would be input 0x01 and it would return 0x80. </p>\n\n<p>This is the code I wrote.</p>\n\n<pre><code>int flipBits(char msd, char lsd) {\n\nchar ch[5];\nsprintf_s(ch, \"0x%d%d\", msd, lsd);\nchar buffer[5];\nstrncpy_s(buffer, ch, 4);\ncout &lt;&lt; ch &lt;&lt; endl;\ncout &lt;&lt; buffer &lt;&lt; endl;\nbitset&lt;8&gt; x(buffer);\nbitset&lt;8&gt; y;\n\nfor (int i = 0; i &lt; 8; i++) {\n    y[i] = x[7 - i];\n}\n\ncout &lt;&lt; y &lt;&lt; endl;              // print the reversed bit order\nint b = y.to_ulong();           // convert the binary to int\n\ncout &lt;&lt; b &lt;&lt; endl;              // print the int\ncout &lt;&lt; hex &lt;&lt; b &lt;&lt; endl;       // print the hex\n\n\nreturn b;\n}\n</code></pre>\n\n<p>I tried adding the strncpy because I thought maybe the null terminator from sprintf was not working properly with the bitset. If in the line </p>\n\n<pre><code>bitset&lt;8&gt; x(buffer);\n</code></pre>\n\n<p>I replace buffer with a hex value, say for example 0x01, then it works and prints out 0x80 as I would expect, but if I try to pass in the value with the buffer it doesn't work. </p>\n"}, {"tags": ["c++", "windows", "qt"], "comments": [{"owner": {"reputation": 8313, "user_id": 7621674, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/323bed98b2e655d5fa9ac6d23a72b995?s=128&d=identicon&r=PG", "display_name": "m7913d", "link": "https://stackoverflow.com/users/7621674/m7913d"}, "edited": false, "score": 0, "creation_date": 1504116921, "post_id": 45965664, "comment_id": 78893431, "body": "Can you include a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>?"}], "owner": {"reputation": 640, "user_id": 3347633, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f3d5a8085c9da3f4c3bfc9e7d939e84f?s=128&d=identicon&r=PG&f=1", "display_name": "Eejin", "link": "https://stackoverflow.com/users/3347633/eejin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 55, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1504198030, "creation_date": 1504111072, "last_edit_date": 1504198030, "question_id": 45965664, "link": "https://stackoverflow.com/questions/45965664/qt-tableview-model-not-native-windows-system-font", "title": "Qt tableview model not native Windows system font", "body": "<p>I created a tableview with model, but the font is not the native system font. It currently looks like this (a combobox inside the tableview):</p>\n\n<p><a href=\"https://i.stack.imgur.com/PGbX1.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/PGbX1.png\" alt=\"Incorrect font\"></a></p>\n\n<p>But in another textinput in the same application it looks correctly like this:</p>\n\n<p><a href=\"https://i.stack.imgur.com/Ooidm.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Ooidm.png\" alt=\"Correct font\"></a></p>\n\n<p>I use no custom fonts and have not overridden the Qt::FontRole (return invalid QVariant()). Why doesn't it use the system font? This is on Windows 10.</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>There doesn't seem to be any issue when running the executable on my laptop. I'm suspecting a mismatch in .dll files. It should be using the exact same ones but perhaps its using .dll files it finds on my system PATH.</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>After checking with <a href=\"https://docs.microsoft.com/en-gb/sysinternals/downloads/process-explorer\" rel=\"nofollow noreferrer\">ProcessExplorer</a> it seems that it loads the correct dlls which are exactly the same my other system loads. The Visual C++ Redistributables versions are also exactly the same.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Tried with Visual Studio 2017 (from 2015) with fresh Qt installation, but that doesn't solve the problem either.</p>\n"}, {"tags": ["c++", "template-meta-programming", "c++17", "decltype"], "comments": [{"owner": {"reputation": 7381, "user_id": 4095830, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nLf56.png?s=128&g=1", "display_name": "whoan", "link": "https://stackoverflow.com/users/4095830/whoan"}, "edited": false, "score": 0, "creation_date": 1504152492, "post_id": 45965452, "comment_id": 78904921, "body": "Doesn&#39;t <code>auto mockbind = ::bind</code> do what you want?"}, {"owner": {"reputation": 233613, "user_id": 14065, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e1475012bb1630271c9165899bccd548?s=128&d=identicon&r=PG", "display_name": "Martin York", "link": "https://stackoverflow.com/users/14065/martin-york"}, "reply_to_user": {"reputation": 7381, "user_id": 4095830, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nLf56.png?s=128&g=1", "display_name": "whoan", "link": "https://stackoverflow.com/users/4095830/whoan"}, "edited": false, "score": 0, "creation_date": 1504155983, "post_id": 45965452, "comment_id": 78905957, "body": "@whoan: No because it does not create a <code>std::function&lt;&gt;</code> type object. Without which it would be hard to bind funcotors to <code>mockbind</code>."}], "answers": [{"comments": [{"owner": {"reputation": 10212, "user_id": 1277769, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/wEHKk.jpg?s=128&g=1", "display_name": "SirGuy", "link": "https://stackoverflow.com/users/1277769/sirguy"}, "edited": false, "score": 1, "creation_date": 1504110693, "post_id": 45965524, "comment_id": 78889984, "body": "I assume this also works adding specialisations for member functions as well"}, {"owner": {"reputation": 44802, "user_id": 2752075, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5oQlf.png?s=128&g=1", "display_name": "HolyBlackCat", "link": "https://stackoverflow.com/users/2752075/holyblackcat"}, "reply_to_user": {"reputation": 10212, "user_id": 1277769, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/wEHKk.jpg?s=128&g=1", "display_name": "SirGuy", "link": "https://stackoverflow.com/users/1277769/sirguy"}, "edited": false, "score": 0, "creation_date": 1504110936, "post_id": 45965524, "comment_id": 78890140, "body": "@SirGuy Yes, it should. I decided to not bother for the sake of simplicity."}, {"owner": {"reputation": 233613, "user_id": 14065, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e1475012bb1630271c9165899bccd548?s=128&d=identicon&r=PG", "display_name": "Martin York", "link": "https://stackoverflow.com/users/14065/martin-york"}, "edited": false, "score": 0, "creation_date": 1504111077, "post_id": 45965524, "comment_id": 78890214, "body": "Looks. Good. I&#39;ll test it tonight when I get home"}, {"owner": {"reputation": 44802, "user_id": 2752075, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5oQlf.png?s=128&g=1", "display_name": "HolyBlackCat", "link": "https://stackoverflow.com/users/2752075/holyblackcat"}, "reply_to_user": {"reputation": 233613, "user_id": 14065, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e1475012bb1630271c9165899bccd548?s=128&d=identicon&r=PG", "display_name": "Martin York", "link": "https://stackoverflow.com/users/14065/martin-york"}, "edited": false, "score": 0, "creation_date": 1504197182, "post_id": 45965524, "comment_id": 78932452, "body": "@LokiAstari You&#39;re welcome, and you just gave me silver <a href=\"https://stackoverflow.com/questions/tagged/c%2b%2b\">c++</a> badge. :P"}], "tags": [], "owner": {"reputation": 44802, "user_id": 2752075, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5oQlf.png?s=128&g=1", "display_name": "HolyBlackCat", "link": "https://stackoverflow.com/users/2752075/holyblackcat"}, "is_accepted": true, "score": 14, "last_activity_date": 1504124832, "last_edit_date": 1504124832, "creation_date": 1504110564, "answer_id": 45965524, "question_id": 45965452, "link": "https://stackoverflow.com/questions/45965452/c-remove-noexcept-from-decltype-returned-type/45965524#45965524", "title": "c++ remove noexcept from decltype returned type", "body": "<p>A simple class specialization trick should work:</p>\n\n<pre><code>template &lt;typename T&gt; struct remove_noexcept\n{\n    using type = T;\n};\ntemplate &lt;typename R, typename ...P&gt; struct remove_noexcept&lt;R(P...) noexcept&gt;\n{\n    using type = R(P...);\n};\ntemplate &lt;typename T&gt; using remove_noexcept_t = typename remove_noexcept&lt;T&gt;::type;\n\n// ...\n\nstd::function&lt;remove_noexcept_t&lt;decltype(::bind)&gt;&gt; mockbind = ::bind;\n</code></pre>\n\n<p>You could somewhat easily extend it to remove <code>noexcept</code> from [member] function pointers, that's left as an excercise to the reader.</p>\n\n<p>Also you could comment out <code>using type = T;</code> if you wish to get a compile-time error if there is no <code>noexcept</code> instead of leaving the type unchanged.</p>\n"}, {"comments": [{"owner": {"reputation": 2216, "user_id": 1136311, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/6e78c5dc795d256f958c458d151c581e?s=128&d=identicon&r=PG", "display_name": "monkey0506", "link": "https://stackoverflow.com/users/1136311/monkey0506"}, "edited": false, "score": 0, "creation_date": 1555394138, "post_id": 55701361, "comment_id": 98084133, "body": "Additionally, this could be used as a basis for an <code>is_noexcept</code> trait by checking <code>is_same_v&lt;T, make_no_except_t&lt;T&gt;&gt;</code>."}, {"owner": {"reputation": 2216, "user_id": 1136311, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/6e78c5dc795d256f958c458d151c581e?s=128&d=identicon&r=PG", "display_name": "monkey0506", "link": "https://stackoverflow.com/users/1136311/monkey0506"}, "edited": false, "score": 0, "creation_date": 1555395857, "post_id": 55701361, "comment_id": 98084821, "body": "I tested compilation of this with MSVC++ 2019 (v142), but all of the type check tests were done on Wandbox (GCC and Clang). MSVC++ completely discards <code>noexcept(noexcept_state)</code> in every case."}, {"owner": {"reputation": 7230, "user_id": 444796, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/7f0c33445ef45506e339d70a36d57dc1?s=128&d=identicon&r=PG", "display_name": "Ichthyo", "link": "https://stackoverflow.com/users/444796/ichthyo"}, "edited": false, "score": 0, "creation_date": 1582312347, "post_id": 55701361, "comment_id": 106747510, "body": "Thanks for undertaking that tedious task ... <i>saved me a lot of work</i>"}], "tags": [], "owner": {"reputation": 2216, "user_id": 1136311, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/6e78c5dc795d256f958c458d151c581e?s=128&d=identicon&r=PG", "display_name": "monkey0506", "link": "https://stackoverflow.com/users/1136311/monkey0506"}, "is_accepted": false, "score": 1, "last_activity_date": 1555397197, "last_edit_date": 1555397197, "creation_date": 1555393877, "answer_id": 55701361, "question_id": 45965452, "link": "https://stackoverflow.com/questions/45965452/c-remove-noexcept-from-decltype-returned-type/55701361#55701361", "title": "c++ remove noexcept from decltype returned type", "body": "<p>While HolyBlackCat's answer covers the majority of actual use cases, it would fail to cover many possible cases, including a <a href=\"https://stackoverflow.com/a/17446559/1136311\">qualified function type</a> (e.g., <code>int(int) const noexcept</code>), a variadic templated variadic function (e.g., <code>template&lt;typename... Ts&gt; void foo(Ts..., ...) noexcept</code>), and pointer to member functions (which don't operate under normal <em>pointer</em> rules at all, e.g., <code>int(foo::*)(int) noexcept</code>).</p>\n\n<p>Implementing a <code>remove_noexcept</code> trait that covers all of these edge cases is no small undertaking, but here's my take on it. I implemented <code>remove_noexcept_t</code> in terms of <code>make_noexcept_t&lt;T, bool&gt;</code>, whose second parameter allows you to toggle the resultant <code>noexcept</code> state (<code>noexcept(true)</code> or <code>noexcept(false)</code>, as you'd expect).</p>\n\n<p>Notably, this <em>does</em> work with pointer to member functions, but does <strong>not</strong> work with function pointers. This is by design (primarily following the logic of <code>std::is_pointer</code>), though you could fairly easily set up a <code>using</code> declaration like <code>add_pointer_t&lt;make_noexcept_t&lt;remove_pointer_t&lt;decay_t&lt;T&gt;&gt;&gt;&gt;</code>.</p>\n\n<p><a href=\"https://wandbox.org/permlink/bXRiKZBzhjKPaRel\" rel=\"nofollow noreferrer\">Live Demo</a> (<em>UPDATED</em>)</p>\n\n<p><strong>EDIT:</strong> The below implementation was not tested for accuracy with MSVC++ 2019 (v142) before I posted this. While it does work with GCC and Clang, this implementation does <strong>NOT</strong> work with MSVC++ 2019 (v142). The live demo link has been updated to a <em>much longer</em> implementation (twice as many specializations), which is too long to post to StackOverflow. That implementation has been tested with GCC, Clang, and MSVC++ 2019 (v142).</p>\n\n<pre><code>template&lt;typename T, bool noexcept_state = true&gt;\nstruct make_noexcept { using type = T; };\n\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args...) noexcept, noexcept_state&gt; { using type = R(Args...) noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args...) const noexcept, noexcept_state&gt; { using type = R(Args...) const noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args...) volatile noexcept, noexcept_state&gt; { using type = R(Args...) volatile noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args...) const volatile noexcept, noexcept_state&gt; { using type = R(Args...) const volatile noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args..., ...) noexcept, noexcept_state&gt; { using type = R(Args..., ...) noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args..., ...) const noexcept, noexcept_state&gt; { using type = R(Args..., ...) const noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args..., ...) volatile noexcept, noexcept_state&gt; { using type = R(Args..., ...) volatile noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args..., ...) const volatile noexcept, noexcept_state&gt; { using type = R(Args..., ...) const volatile noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args...) &amp; noexcept, noexcept_state&gt; { using type = R(Args...) &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args...) const &amp; noexcept, noexcept_state&gt; { using type = R(Args...) const &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args...) volatile &amp; noexcept, noexcept_state&gt; { using type = R(Args...) volatile &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args...) const volatile &amp; noexcept, noexcept_state&gt; { using type = R(Args...) const volatile &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args..., ...) &amp; noexcept, noexcept_state&gt; { using type = R(Args..., ...) &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args..., ...) const &amp; noexcept, noexcept_state&gt; { using type = R(Args..., ...) const &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args..., ...) volatile &amp; noexcept, noexcept_state&gt; { using type = R(Args..., ...) volatile &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args..., ...) const volatile &amp; noexcept, noexcept_state&gt; { using type = R(Args..., ...) const volatile &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args...) &amp;&amp; noexcept, noexcept_state&gt; { using type = R(Args...) &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args...) const &amp;&amp; noexcept, noexcept_state&gt; { using type = R(Args...) const &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args...) volatile &amp;&amp; noexcept, noexcept_state&gt; { using type = R(Args...) volatile &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args...) const volatile &amp;&amp; noexcept, noexcept_state&gt; { using type = R(Args...) const volatile &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args..., ...) &amp;&amp; noexcept, noexcept_state&gt; { using type = R(Args..., ...) &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args..., ...) const &amp;&amp; noexcept, noexcept_state&gt; { using type = R(Args..., ...) const &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args..., ...) volatile &amp;&amp; noexcept, noexcept_state&gt; { using type = R(Args..., ...) volatile &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args..., ...) const volatile &amp;&amp; noexcept, noexcept_state&gt; { using type = R(Args..., ...) const volatile &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args...) noexcept, noexcept_state&gt; { using type = R(C::*)(Args...) noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args...) const noexcept, noexcept_state&gt; { using type = R(C::*)(Args...) const noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args...) volatile noexcept, noexcept_state&gt; { using type = R(C::*)(Args...) volatile noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args...) const volatile noexcept, noexcept_state&gt; { using type = R(C::*)(Args...) const volatile noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args..., ...) noexcept, noexcept_state&gt; { using type = R(C::*)(Args..., ...) noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args..., ...) const noexcept, noexcept_state&gt; { using type = R(C::*)(Args...) const noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args..., ...) volatile noexcept, noexcept_state&gt; { using type = R(C::*)(Args...) volatile noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args..., ...) const volatile noexcept, noexcept_state&gt; { using type = R(C::*)(Args...) const volatile noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args...) &amp; noexcept, noexcept_state&gt; { using type = R(C::*)(Args...) &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args...) const &amp; noexcept, noexcept_state&gt; { using type = R(C::*)(Args...) const &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args...) volatile &amp; noexcept, noexcept_state&gt; { using type = R(C::*)(Args...) volatile &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args...) const volatile &amp; noexcept, noexcept_state&gt; { using type = R(C::*)(Args...) const volatile &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args..., ...) &amp; noexcept, noexcept_state&gt; { using type = R(C::*)(Args..., ...) &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args..., ...) const &amp; noexcept, noexcept_state&gt; { using type = R(C::*)(Args..., ...) const &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args..., ...) volatile &amp; noexcept, noexcept_state&gt; { using type = R(C::*)(Args..., ...) volatile &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args..., ...) const volatile &amp; noexcept, noexcept_state&gt; { using type = R(C::*)(Args..., ...) const volatile &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args...) &amp;&amp; noexcept, noexcept_state&gt; { using type = R(C::*)(Args...) &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args...) const &amp;&amp; noexcept, noexcept_state&gt; { using type = R(C::*)(Args...) const &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args...) volatile &amp;&amp; noexcept, noexcept_state&gt; { using type = R(C::*)(Args...) volatile &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args...) const volatile &amp;&amp; noexcept, noexcept_state&gt; { using type = R(C::*)(Args...) const volatile &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args..., ...) &amp;&amp; noexcept, noexcept_state&gt; { using type = R(C::*)(Args..., ...) &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args..., ...) const &amp;&amp; noexcept, noexcept_state&gt; { using type = R(C::*)(Args..., ...) const &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args..., ...) volatile &amp;&amp; noexcept, noexcept_state&gt; { using type = R(C::*)(Args..., ...) volatile &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args..., ...) const volatile &amp;&amp; noexcept, noexcept_state&gt; { using type = R(C::*)(Args..., ...) const volatile &amp;&amp; noexcept(noexcept_state); };\n\n// MSVC++ 2019 (v142) doesn't allow `noexcept(x)` with a template parameter `x` in the template specialization list.\n// (e.g., `struct make_noexcept&lt;R(Args...) noexcept(noexcept_state)&gt;` gives - C2057: expected constant expression)\n// GCC 7.1.0 and Clang 5.0.0 (and later versions) were tested and do allow this, so MSVC++ is probably wrong.\n// $ g++ prog.cc -Wall -Wextra -std=c++17 -pedantic\n// $ clang++ prog.cc -Wall -Wextra -std=c++17 -pedantic\n\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args...), noexcept_state&gt; { using type = R(Args...) noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args...) const, noexcept_state&gt; { using type = R(Args...) const noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args...) volatile, noexcept_state&gt; { using type = R(Args...) volatile noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args...) const volatile, noexcept_state&gt; { using type = R(Args...) const volatile noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args..., ...), noexcept_state&gt; { using type = R(Args..., ...) noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args..., ...) const, noexcept_state&gt; { using type = R(Args..., ...) const noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args..., ...) volatile, noexcept_state&gt; { using type = R(Args..., ...) volatile noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args..., ...) const volatile, noexcept_state&gt; { using type = R(Args..., ...) const volatile noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args...)&amp;, noexcept_state&gt; { using type = R(Args...) &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args...) const &amp;, noexcept_state&gt; { using type = R(Args...) const &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args...) volatile &amp;, noexcept_state&gt; { using type = R(Args...) volatile &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args...) const volatile &amp;, noexcept_state&gt; { using type = R(Args...) const volatile &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args..., ...)&amp;, noexcept_state&gt; { using type = R(Args..., ...) &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args..., ...) const &amp;, noexcept_state&gt; { using type = R(Args..., ...) const &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args..., ...) volatile &amp;, noexcept_state&gt; { using type = R(Args..., ...) volatile &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args..., ...) const volatile &amp;, noexcept_state&gt; { using type = R(Args..., ...) const volatile &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args...) &amp;&amp;, noexcept_state&gt; { using type = R(Args...) &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args...) const &amp;&amp;, noexcept_state&gt; { using type = R(Args...) const &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args...) volatile &amp;&amp;, noexcept_state&gt; { using type = R(Args...) volatile &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args...) const volatile &amp;&amp;, noexcept_state&gt; { using type = R(Args...) const volatile &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args..., ...) &amp;&amp;, noexcept_state&gt; { using type = R(Args..., ...) &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args..., ...) const &amp;&amp;, noexcept_state&gt; { using type = R(Args..., ...) const &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args..., ...) volatile &amp;&amp;, noexcept_state&gt; { using type = R(Args..., ...) volatile &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename... Args&gt;\nstruct make_noexcept&lt;R(Args..., ...) const volatile &amp;&amp;, noexcept_state&gt; { using type = R(Args..., ...) const volatile &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args...), noexcept_state&gt; { using type = R(C::*)(Args...) noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args...) const, noexcept_state&gt; { using type = R(C::*)(Args...) const noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args...) volatile, noexcept_state&gt; { using type = R(C::*)(Args...) volatile noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args...) const volatile, noexcept_state&gt; { using type = R(C::*)(Args...) const volatile noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args..., ...), noexcept_state&gt; { using type = R(C::*)(Args..., ...) noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args..., ...) const, noexcept_state&gt; { using type = R(C::*)(Args...) const noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args..., ...) volatile, noexcept_state&gt; { using type = R(C::*)(Args...) volatile noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args..., ...) const volatile, noexcept_state&gt; { using type = R(C::*)(Args...) const volatile noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args...)&amp;, noexcept_state&gt; { using type = R(C::*)(Args...) &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args...) const &amp;, noexcept_state&gt; { using type = R(C::*)(Args...) const &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args...) volatile &amp;, noexcept_state&gt; { using type = R(C::*)(Args...) volatile &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args...) const volatile &amp;, noexcept_state&gt; { using type = R(C::*)(Args...) const volatile &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args..., ...)&amp;, noexcept_state&gt; { using type = R(C::*)(Args..., ...) &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args..., ...) const &amp;, noexcept_state&gt; { using type = R(C::*)(Args..., ...) const &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args..., ...) volatile &amp;, noexcept_state&gt; { using type = R(C::*)(Args..., ...) volatile &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args..., ...) const volatile &amp;, noexcept_state&gt; { using type = R(C::*)(Args..., ...) const volatile &amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args...) &amp;&amp;, noexcept_state&gt; { using type = R(C::*)(Args...) &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args...) const &amp;&amp;, noexcept_state&gt; { using type = R(C::*)(Args...) const &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args...) volatile &amp;&amp;, noexcept_state&gt; { using type = R(C::*)(Args...) volatile &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args...) const volatile &amp;&amp;, noexcept_state&gt; { using type = R(C::*)(Args...) const volatile &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args..., ...) &amp;&amp;, noexcept_state&gt; { using type = R(C::*)(Args..., ...) &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args..., ...) const &amp;&amp;, noexcept_state&gt; { using type = R(C::*)(Args..., ...) const &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args..., ...) volatile &amp;&amp;, noexcept_state&gt; { using type = R(C::*)(Args..., ...) volatile &amp;&amp; noexcept(noexcept_state); };\ntemplate&lt;bool noexcept_state, typename R, typename C, typename... Args&gt;\nstruct make_noexcept&lt;R(C::*)(Args..., ...) const volatile &amp;&amp;, noexcept_state&gt; { using type = R(C::*)(Args..., ...) const volatile &amp;&amp; noexcept(noexcept_state); };\n\ntemplate&lt;typename T, bool noexcept_state = true&gt;\nusing make_noexcept_t = typename make_noexcept&lt;T, noexcept_state&gt;::type;\n\ntemplate&lt;typename T&gt;\nusing remove_noexcept_t = make_noexcept_t&lt;T, false&gt;;\n</code></pre>\n"}], "owner": {"reputation": 233613, "user_id": 14065, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e1475012bb1630271c9165899bccd548?s=128&d=identicon&r=PG", "display_name": "Martin York", "link": "https://stackoverflow.com/users/14065/martin-york"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 720, "favorite_count": 2, "accepted_answer_id": 45965524, "answer_count": 2, "score": 12, "last_activity_date": 1555397197, "creation_date": 1504110277, "last_edit_date": 1504110931, "question_id": 45965452, "link": "https://stackoverflow.com/questions/45965452/c-remove-noexcept-from-decltype-returned-type", "title": "c++ remove noexcept from decltype returned type", "body": "<pre><code>#include &lt;functional&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;sys/socket.h&gt;\n\n\nstd::function&lt;decltype(::bind)&gt; mockbind = ::bind;\n\nint main()\n{\n}\n</code></pre>\n\n<p>The code above works on most of the platforms I compile on. But on ubuntu 14.04 using g++-7 I get an error:</p>\n\n<pre><code>X.cpp:7:65: error: variable \u2018std::function&lt;int(int, const sockaddr*, unsigned int) noexcept&gt; mockbind\u2019 has initializer but incomplete type\n std::function&lt;int(int, const sockaddr*, unsigned int) noexcept&gt; mockbind = ::bind;\n                                                                 ^~~~~~~~\n</code></pre>\n\n<p>Now if I manually go and change the type of <code>mockbind</code></p>\n\n<pre><code>std::function&lt;int(int, const sockaddr*, unsigned int) noexcept&gt; mockbind = ::bind;\n</code></pre>\n\n<p>As expected I get the same error:<br>\nNow if I remove the <code>noexcept</code></p>\n\n<pre><code>std::function&lt;int(int, const sockaddr*, unsigned int)&gt; mockbind = ::bind;\n</code></pre>\n\n<p>It compiles as expected.</p>\n\n<p>So the question is can I apply some template code to remove the <code>noexcept</code> from the type returned by <code>decltype</code> and make it work as expected.</p>\n"}, {"tags": ["c++", "pointers", "memory-management", "dynamic-allocation", "dangling-pointer"], "comments": [{"owner": {"reputation": 13337, "user_id": 4324224, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/YF2EX.png?s=128&g=1", "display_name": "W.F.", "link": "https://stackoverflow.com/users/4324224/w-f"}, "edited": false, "score": 7, "creation_date": 1504109820, "post_id": 45965245, "comment_id": 78889407, "body": "have you considered <code>std::shared_ptr</code>/<code>std::unique_ptr</code>?"}, {"owner": {"reputation": 52656, "user_id": 225074, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/dea26ac1ef8259140d28aa8b5ba4f1b3?s=128&d=identicon&r=PG", "display_name": "Thomas Matthews", "link": "https://stackoverflow.com/users/225074/thomas-matthews"}, "edited": false, "score": 6, "creation_date": 1504109834, "post_id": 45965245, "comment_id": 78889420, "body": "Use <code>std::list</code>.  The <code>std::list</code> automagically manages memory for you."}, {"owner": {"reputation": 44802, "user_id": 2752075, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5oQlf.png?s=128&g=1", "display_name": "HolyBlackCat", "link": "https://stackoverflow.com/users/2752075/holyblackcat"}, "edited": false, "score": 0, "creation_date": 1504109878, "post_id": 45965245, "comment_id": 78889454, "body": "Uhh, why would anyone insist on that function signature..."}, {"owner": {"reputation": 521, "user_id": 8310836, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TCvSX.jpg?s=128&g=1", "display_name": "Eduardo macedo", "link": "https://stackoverflow.com/users/8310836/eduardo-macedo"}, "edited": false, "score": 0, "creation_date": 1504110108, "post_id": 45965245, "comment_id": 78889608, "body": "I don&#39;t know how to use smart pointers yet. I&#39;ll look into it. I already use std::list in my implementations and i&#39;m aware that the recommendations are not to handle pointers when you don&#39;t need to. I just wanted to understand the lifecycle of variables inside objects and don&#39;t pretend to reimplement std::list. Thanks for the answers."}], "answers": [{"tags": [], "owner": {"reputation": 66610, "user_id": 2411320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5kF5N.jpg?s=128&g=1", "display_name": "gsamaras", "link": "https://stackoverflow.com/users/2411320/gsamaras"}, "is_accepted": false, "score": 2, "last_activity_date": 1504111078, "creation_date": 1504111078, "answer_id": 45965668, "question_id": 45965245, "link": "https://stackoverflow.com/questions/45965245/how-to-deal-with-dynamic-allocation-when-implementing-list-of-objects/45965668#45965668", "title": "How to deal with dynamic allocation when implementing list of objects?", "body": "<pre><code>Node-&gt;content = &amp;result; // will this object be erased when the function ends?\n</code></pre>\n\n<p>Yes, since it's a local variable. As soon as its function terminates, so does <code>result</code>'s lifetime.</p>\n\n<hr>\n\n<pre><code>MyList &amp; sum (MyList * l1, MyList * l2) {\n    //Create variable without allocating memory and return it's reference \n}\n</code></pre>\n\n<p>This will fail too, for similar reasons as the above.</p>\n\n<hr>\n\n<p>I suggest you use <a href=\"http://www.cplusplus.com/reference/memory/shared_ptr/\" rel=\"nofollow noreferrer\"><code>std::shared_ptr</code></a> or <a href=\"http://www.cplusplus.com/reference/memory/unique_ptr/\" rel=\"nofollow noreferrer\"><code>std::unique_ptr</code></a>. If you wish, read <a href=\"https://stackoverflow.com/questions/6876751/differences-between-unique-ptr-and-shared-ptr\">Differences between unique_ptr and shared_ptr</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 37828, "user_id": 1629821, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/861cfc0de6bf99a544b500eac16229eb?s=128&d=identicon&r=PG", "display_name": "Mr.C64", "link": "https://stackoverflow.com/users/1629821/mr-c64"}, "is_accepted": true, "score": 0, "last_activity_date": 1504117709, "creation_date": 1504117709, "answer_id": 45967431, "question_id": 45965245, "link": "https://stackoverflow.com/questions/45965245/how-to-deal-with-dynamic-allocation-when-implementing-list-of-objects/45967431#45967431", "title": "How to deal with dynamic allocation when implementing list of objects?", "body": "<blockquote>\n<pre><code>Object result(node1-&gt;content + node2-&gt;content);\nNode-&gt;content = &amp;result; // will this object be erased when the function ends?\n</code></pre>\n</blockquote>\n\n<p>Yes, if <code>result</code> is created inside the function body with the syntax shown above, it will be destroyed when the function ends.</p>\n\n<p>This is the reason why you should use <code>new</code> and dynamic allocation: in this way, your objects are created on the <strong>heap</strong> (instead of the local function stack), and they \"survive\" the end of the function in which they are created. And you can pass the returned pointer back to the caller. Of course, the caller has to properly <code>delete</code> the returned pointer, else you end up having memory (or other resource) leaks.</p>\n\n<p>In modern C++, you should use already-defined <strong>smart pointer</strong> classes, like <code>std::shared_ptr</code> or <code>std::unique_ptr</code>, and your code should almost never use <em>explicit</em> <code>new</code> and <code>delete</code> (unless you are developing some custom highly-optimized data structure, and you need low-level finer-grained control on memory allocations - and, even in this case, the explicit code invoking <code>new</code> and <code>delete</code> should be safely wrapped inside RAII class boundaries).</p>\n\n<p>However, it seems to me that your code is more like a programming exercise, and probably the purpose of this exercise is to learn dynamic memory allocations with explicit <code>new</code> and <code>delete</code>. In fact, in production-quality code, instead of rolling your own list class, you can use an already available standard linked-list class template, like <code>std::list</code>.</p>\n"}], "owner": {"reputation": 521, "user_id": 8310836, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TCvSX.jpg?s=128&g=1", "display_name": "Eduardo macedo", "link": "https://stackoverflow.com/users/8310836/eduardo-macedo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 183, "favorite_count": 1, "accepted_answer_id": 45967431, "answer_count": 2, "score": 6, "last_activity_date": 1504117709, "creation_date": 1504109634, "last_edit_date": 1504113743, "question_id": 45965245, "link": "https://stackoverflow.com/questions/45965245/how-to-deal-with-dynamic-allocation-when-implementing-list-of-objects", "title": "How to deal with dynamic allocation when implementing list of objects?", "body": "<p>I had to implement a function that looked like this:</p>\n\n<pre><code>MyList * sum (MyList * l1, MyList * l2) {\n    MyList * newlist = new MyList();\n    //Adds two objects and place the result in a third new list\n    return newlist;\n}\n</code></pre>\n\n<p>The function took two lists and placed the sum of each object into a new list. The <code>MyList</code> class had nodes with pointers to the <code>next</code> variable and the objects inside the list were user defined.</p>\n\n<p>And that got me thinking - how should I deal with the dynamic allocation of memory from the objects and the list itself?  Since I had to create memory for each of the objects of the new list.</p>\n\n<p>Is there any way to place the values of the sum of objects in the new list without having to rely on dynamic allocation? Maybe by doing something like this:</p>\n\n<pre><code>Object result(node1-&gt;content + node2-&gt;content);\nNode-&gt;content = &amp;result; // will this object be erased when the function ends?\n</code></pre>\n\n<p>instead of this:</p>\n\n<pre><code>Node-&gt;content = new Object(node1-&gt;content + node2-&gt;content);\n</code></pre>\n\n<p>How should I deal with the lifetime of the new list created inside of the function in relation to the variable that will hold the memory after the function ends? Can I do something like this when returning the new list?</p>\n\n<pre><code>MyList &amp; sum (MyList * l1, MyList * l2) {\n    //Create variable without allocating memory and return it's reference \n}\n</code></pre>\n\n<p><strong>In short</strong>, my main doubt is how to deal with the lifetime of an object that is created inside a function and will be held by other object.</p>\n"}, {"tags": ["c#", "c++", "unity3d", "dll", "point-cloud-library"], "comments": [{"owner": {"reputation": 98775, "user_id": 421195, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9a9793fdeb3b94e185c8c99c0238372f?s=128&d=identicon&r=PG", "display_name": "paulsm4", "link": "https://stackoverflow.com/users/421195/paulsm4"}, "edited": false, "score": 1, "creation_date": 1504109304, "post_id": 45965064, "comment_id": 78889076, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/4610091/not-a-valid-win32-application\">Not a valid Win32 application</a>"}, {"owner": {"reputation": 30170, "user_id": 5231607, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QzGsq.jpg?s=128&g=1", "display_name": "1201ProgramAlarm", "link": "https://stackoverflow.com/users/5231607/1201programalarm"}, "edited": false, "score": 1, "creation_date": 1504110202, "post_id": 45965064, "comment_id": 78889668, "body": "The C# script is running as a 32 bit application."}, {"owner": {"reputation": 118, "user_id": 7342703, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/64a35c815f041ba8933b27696fcb530a?s=128&d=identicon&r=PG&f=1", "display_name": "Mai Kar", "link": "https://stackoverflow.com/users/7342703/mai-kar"}, "reply_to_user": {"reputation": 98775, "user_id": 421195, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9a9793fdeb3b94e185c8c99c0238372f?s=128&d=identicon&r=PG", "display_name": "paulsm4", "link": "https://stackoverflow.com/users/421195/paulsm4"}, "edited": false, "score": 0, "creation_date": 1504110405, "post_id": 45965064, "comment_id": 78889805, "body": "@paulsm4 If I understand well the post, the cause of the error was that the XP machine was 32 bits, which is not my case since I am working on a x64 machine with Unity x64."}, {"owner": {"reputation": 118, "user_id": 7342703, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/64a35c815f041ba8933b27696fcb530a?s=128&d=identicon&r=PG&f=1", "display_name": "Mai Kar", "link": "https://stackoverflow.com/users/7342703/mai-kar"}, "reply_to_user": {"reputation": 30170, "user_id": 5231607, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QzGsq.jpg?s=128&g=1", "display_name": "1201ProgramAlarm", "link": "https://stackoverflow.com/users/5231607/1201programalarm"}, "edited": false, "score": 0, "creation_date": 1504110667, "post_id": 45965064, "comment_id": 78889971, "body": "@1201ProgramAlarm If it is so, how can I change that? I assumed that since Unity is a 64 bits application it would run scipts as 32 bits application."}, {"owner": {"reputation": 2844, "user_id": 23569, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/371e4b037974623acab3a397d0e0bf2a?s=128&d=identicon&r=PG", "display_name": "Marc Bernier", "link": "https://stackoverflow.com/users/23569/marc-bernier"}, "edited": false, "score": 2, "creation_date": 1504116890, "post_id": 45965064, "comment_id": 78893406, "body": "In C# project, uncheck Properties | Build | Prefer 32-bit. For reasons, C# debug builds have this switch set, release builds do not."}, {"owner": {"reputation": 98775, "user_id": 421195, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9a9793fdeb3b94e185c8c99c0238372f?s=128&d=identicon&r=PG", "display_name": "paulsm4", "link": "https://stackoverflow.com/users/421195/paulsm4"}, "edited": false, "score": 1, "creation_date": 1504118176, "post_id": 45965064, "comment_id": 78894105, "body": "@Mai Kar - no, the post said that the MSVS project &quot;build&quot; was set incorrectly.  Double-check your build: make sure it&#39;s &quot;Any CPU&quot;; make sure <i>NOTHING</i> is set to &quot;Prefer 32 bit&quot;!"}, {"owner": {"reputation": 118, "user_id": 7342703, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/64a35c815f041ba8933b27696fcb530a?s=128&d=identicon&r=PG&f=1", "display_name": "Mai Kar", "link": "https://stackoverflow.com/users/7342703/mai-kar"}, "reply_to_user": {"reputation": 98775, "user_id": 421195, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9a9793fdeb3b94e185c8c99c0238372f?s=128&d=identicon&r=PG", "display_name": "paulsm4", "link": "https://stackoverflow.com/users/421195/paulsm4"}, "edited": false, "score": 0, "creation_date": 1504183294, "post_id": 45965064, "comment_id": 78922671, "body": "@paulsm4 Thank you for the explanation but unfortunately I can not change the parameters of the C# project because I is all handled by Unity, the property pannel doesn&#39;t even open up in Visual Studio. However this is already set as  &quot;Any CPU&quot; in the project.  I even compiled the application for Windows x86_64 and launched the .exe (instead of runing my script in the Unity editor) but it still logged the same error. I edited my post with more details I just found out."}], "answers": [{"tags": [], "owner": {"reputation": 118, "user_id": 7342703, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/64a35c815f041ba8933b27696fcb530a?s=128&d=identicon&r=PG&f=1", "display_name": "Mai Kar", "link": "https://stackoverflow.com/users/7342703/mai-kar"}, "is_accepted": true, "score": 1, "last_activity_date": 1504191215, "creation_date": 1504191215, "answer_id": 45984438, "question_id": 45965064, "link": "https://stackoverflow.com/questions/45965064/using-x64-c-dll-in-unity-gives-is-not-a-valid-win32-application-error/45984438#45984438", "title": "Using x64 c++ dll in Unity gives &quot;Is not a valid Win32 application error&quot;", "body": "<p>I finally found the cause for this thanks to <a href=\"http://www.dependencywalker.com/\" rel=\"nofollow noreferrer\">Dependancy Walker</a>.</p>\n\n<p>It was actually an issue of bad linking. PCL uses the OpenNi library and my variable path linked to the 32 bit version of this library instead of the 64 bits. </p>\n"}, {"tags": [], "owner": {"reputation": 26, "user_id": 11187355, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52a9a46d73f0f6fe8467c5fc3ec11449?s=128&d=identicon&r=PG", "display_name": "zalo", "link": "https://stackoverflow.com/users/11187355/zalo"}, "is_accepted": false, "score": 0, "last_activity_date": 1585352890, "creation_date": 1585352890, "answer_id": 60895624, "question_id": 45965064, "link": "https://stackoverflow.com/questions/45965064/using-x64-c-dll-in-unity-gives-is-not-a-valid-win32-application-error/60895624#60895624", "title": "Using x64 c++ dll in Unity gives &quot;Is not a valid Win32 application error&quot;", "body": "<p>For future users who see this issue, you can also spot which .dll's are x86 vs x64 with:\n<a href=\"https://github.com/lucasg/Dependencies\" rel=\"nofollow noreferrer\">https://github.com/lucasg/Dependencies</a></p>\n\n<p>This tool is still being maintained.</p>\n\n<p>In my case, this error came from my .dll grabbing a 32-bit Freetype dependency from elsewhere in the operating system.  Simply dragging the appropriate Freetype.dll in with my custom .dll solved that issue.</p>\n"}], "owner": {"reputation": 118, "user_id": 7342703, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/64a35c815f041ba8933b27696fcb530a?s=128&d=identicon&r=PG&f=1", "display_name": "Mai Kar", "link": "https://stackoverflow.com/users/7342703/mai-kar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1599, "favorite_count": 0, "accepted_answer_id": 45984438, "answer_count": 2, "score": 0, "last_activity_date": 1585352890, "creation_date": 1504109032, "last_edit_date": 1504182847, "question_id": 45965064, "link": "https://stackoverflow.com/questions/45965064/using-x64-c-dll-in-unity-gives-is-not-a-valid-win32-application-error", "title": "Using x64 c++ dll in Unity gives &quot;Is not a valid Win32 application error&quot;", "body": "<h2>What I want to do</h2>\n\n<p>I am trying to use some of the <a href=\"http://pointclouds.org/\" rel=\"nofollow noreferrer\">Point Cloud Library (PCL)</a> functionalities in Unity 64bits. To do so, I proceed like explained in <a href=\"https://forum.unity3d.com/threads/tutorial-using-c-opencv-within-unity.459434/\" rel=\"nofollow noreferrer\">this tutorial</a> which is about using the OpenCV library in Unity.</p>\n\n<h2>What I did and the issue I got</h2>\n\n<p>So I installed the <a href=\"http://unanancyowen.com/en/pcl18/\" rel=\"nofollow noreferrer\">PCL library (v1.8, x64)</a>, I linked it to a Visual Studio C++ project and got a simple function using it (<a href=\"http://pointclouds.org/documentation/tutorials/writing_pcd.php#writing-pcd\" rel=\"nofollow noreferrer\">the getting started example of the library</a>). </p>\n\n<p>Then I compiled this project as a x64 release dll that I included in Unity in the Asset/Plugins folder, as well as the PCL release dlls. </p>\n\n<p>Finally I use the following lines to load the dll in unity and make MySimpleFunction available to my C# script.</p>\n\n<pre><code>[DllImport(\"PCLToolsForUnity\")] \ninternal static extern int MySimpleFunction();\n</code></pre>\n\n<p>The issue is that when I run the C# script calling MySimpleFunction(), Unity shows the following error:</p>\n\n<pre><code>Failed to load 'Assets/Plugins/PCLToolsForUnity.dll' with error '%1 is not a valid Win32 application.\n</code></pre>\n\n<h2>What I already checked and tried</h2>\n\n<p>I read that it could be caused by mixing 32 bits and 64 bits dll and application, however my Unity installation is 64 bits as well as the dll I included (I even checked with <code>dumpbin /headers</code> command). So I don't even know why Unity is expecting my dll to be a Win32 application..</p>\n\n<p>I also checked that there is no space in the path to the dlls since I read it could be another cause for this error.</p>\n\n<p>Beforehand I tried all this with a c++ project using no library and this worked fine. So it could be caused by the linked library</p>\n\n<p>Any idea on what could cause this error and how to solve it?</p>\n\n<hr>\n\n<h2>Edit</h2>\n\n<p>I am working on a x64 machine.</p>\n\n<p>After more tests, it seems that the issue is my DLL itself. When I run any function with the following command: <code>C:\\Windows\\SysWOW64\\rundll32.exe PCLToolsForUnity.dll, testFunction</code>, I get the same error as in Unity: <code>PCLToolsForUnity.dll is not a valid Win32 application</code>.</p>\n\n<p>I also found the line that \"breaks\" my  dll. One of the functions I export is the following:</p>\n\n<pre><code>PCLTOOLSFORUNITY_API int pcdWrite(void)\n{\npcl::PointCloud&lt;pcl::PointXYZ&gt; cloud;\n\n// Fill in the cloud data\ncloud.width = 5;\ncloud.height = 1;\ncloud.is_dense = false;\ncloud.points.resize(cloud.width * cloud.height);\n\nfor (size_t i = 0; i &lt; cloud.points.size(); ++i)\n{\n    cloud.points[i].x = 1024 * rand() / (RAND_MAX + 1.0f);\n    cloud.points[i].y = 1024 * rand() / (RAND_MAX + 1.0f);\n    cloud.points[i].z = 1024 * rand() / (RAND_MAX + 1.0f);\n}\n\npcl::io::savePCDFileASCII(\"test_pcd.pcd\", cloud);\nstd::cerr &lt;&lt; \"Saved \" &lt;&lt; cloud.points.size() &lt;&lt; \" data points to test_pcd.pcd.\" &lt;&lt; std::endl;\n\nfor (size_t i = 0; i &lt; cloud.points.size(); ++i)\n    std::cerr &lt;&lt; \"    \" &lt;&lt; cloud.points[i].x &lt;&lt; \" \" &lt;&lt; cloud.points[i].y &lt;&lt; \" \" &lt;&lt; cloud.points[i].z &lt;&lt; std::endl;\n\nreturn (0);\n</code></pre>\n\n<p>}</p>\n\n<p>I noticed that if I comment the line <code>pcl::io::savePCDFileASCII(\"test_pcd.pcd\", cloud);</code> and recompile my dll, then it works, I can run the dll's functions. When compiling the dll without this line, I can call the functions from it and it's working.</p>\n\n<p>I checked the libraries I linked to the project and it seems fine to me, so still no idea where my problem is comming from. I hope those new information will help.</p>\n"}, {"tags": ["c++", "c++11", "stdvector", "stdarray"], "comments": [{"owner": {"reputation": 44802, "user_id": 2752075, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5oQlf.png?s=128&g=1", "display_name": "HolyBlackCat", "link": "https://stackoverflow.com/users/2752075/holyblackcat"}, "edited": false, "score": 0, "creation_date": 1504109129, "post_id": 45965025, "comment_id": 78888956, "body": "Do you really need it to be standard-compliant? <code>fn((double(*)[4]) my_vec.data())</code> is technically UB, but is good enough in practice."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1504109852, "post_id": 45965025, "comment_id": 78889437, "body": "That would be a rather unfortunate signature. What is the size of the array that the function expects?"}], "answers": [{"comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 3, "creation_date": 1504110160, "post_id": 45965100, "comment_id": 78889637, "body": "This is very unlikely to be the <i>correct</i> way to call that function. There is no reason for a function to accept a pointer to an array unless the pointer is meant to point to the first element of a higher-dimensional array. <code>double[4][4]</code> is much more likely to be the intended argument type."}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1504214091, "post_id": 45965100, "comment_id": 78940534, "body": "@n.m. Or if they want bounds checked at compile-time"}], "tags": [], "owner": {"reputation": 196207, "user_id": 434551, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/8Wzl8.png?s=128&g=1", "display_name": "R Sahu", "link": "https://stackoverflow.com/users/434551/r-sahu"}, "is_accepted": false, "score": 1, "last_activity_date": 1504214655, "last_edit_date": 1504214655, "creation_date": 1504109162, "answer_id": 45965100, "question_id": 45965025, "link": "https://stackoverflow.com/questions/45965025/c11-object-that-can-be-passed-as-double-4/45965100#45965100", "title": "c++11 object that can be passed as &quot;double (*)[4]&quot;", "body": "<blockquote>\n  <p>How would I call this function?</p>\n</blockquote>\n\n<p>The most clean way to call the function is:</p>\n\n<ol>\n<li>Create an array of four doubles.</li>\n<li>Fill up the data in the array from an appropriate source.</li>\n<li>Pass the address of the array to the function</li>\n</ol>\n\n<hr>\n\n<pre><code>double array[4];\n\n// Fill up the array with data\nfor (size_t i = 0; i &lt; 4; ++i )\n{\n   array[i] = ...;\n}\n\nfn(&amp;array);\n</code></pre>\n\n<hr>\n\n<p>In order to be able to call the function when you have a <code>std::vector&lt;std::array&lt;double, 4&gt;&gt;</code>, you can create couple of wrapper functions.</p>\n\n<pre><code>void fn_wrapper(std::array&lt;double, 4&gt;&gt;&amp; in)\n{\n  double array[4];\n\n  // Fill up the array with data\n  for (size_t i = 0; i &lt; 4; ++i )\n  {\n     array[i] = in[i];\n  }\n\n  fn(&amp;array);\n\n  // If you fn modified array, and you want to move those modifications\n  // back to the std::array ...\n  for (size_t i = 0; i &lt; 4; ++i )\n  {\n     in[i] = array[i];\n  }\n}\n\nvoid fn_wrapper(std::vector&lt;std::array&lt;double, 4&gt;&gt;&amp; in)\n{\n   for ( auto&amp; item : in )\n   {\n      fn_wrapper(item);\n   }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 55, "user_id": 3402595, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eesQR.jpg?s=128&g=1", "display_name": "Peter", "link": "https://stackoverflow.com/users/3402595/peter"}, "edited": false, "score": 0, "creation_date": 1504111544, "post_id": 45965122, "comment_id": 78890439, "body": "Am I correct in thinking that this would be a <code>reinterpret_cast&lt;double(*)[4]&gt;(&amp;my_array[0][0])</code>"}, {"owner": {"reputation": 808, "user_id": 5199318, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e310ab88ed654014bbd8ff0e9c8e75d1?s=128&d=identicon&r=PG&f=1", "display_name": "Jas", "link": "https://stackoverflow.com/users/5199318/jas"}, "reply_to_user": {"reputation": 55, "user_id": 3402595, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eesQR.jpg?s=128&g=1", "display_name": "Peter", "link": "https://stackoverflow.com/users/3402595/peter"}, "edited": false, "score": 0, "creation_date": 1504111783, "post_id": 45965122, "comment_id": 78890569, "body": "Sorry not sure @Peter, I&#39;ve never used C++&#39;s casts, I&#39;ve always used C casts in my code."}, {"owner": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "edited": false, "score": 0, "creation_date": 1504210009, "post_id": 45965122, "comment_id": 78938730, "body": "One note: due to flaws in the C++ standard, the above is undefined behavior if the function wants to access more than just the first 4 doubles."}], "tags": [], "owner": {"reputation": 808, "user_id": 5199318, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e310ab88ed654014bbd8ff0e9c8e75d1?s=128&d=identicon&r=PG&f=1", "display_name": "Jas", "link": "https://stackoverflow.com/users/5199318/jas"}, "is_accepted": true, "score": 1, "last_activity_date": 1504109663, "last_edit_date": 1504109663, "creation_date": 1504109235, "answer_id": 45965122, "question_id": 45965025, "link": "https://stackoverflow.com/questions/45965025/c11-object-that-can-be-passed-as-double-4/45965122#45965122", "title": "c++11 object that can be passed as &quot;double (*)[4]&quot;", "body": "<p>With this:</p>\n\n<pre><code>std::vector&lt;std::array&lt;double, 4&gt;&gt; my_array;\n...\n// Function call:\nfn((double(*)[4]) &amp;my_array[array_index][0]);\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 3402595, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eesQR.jpg?s=128&g=1", "display_name": "Peter", "link": "https://stackoverflow.com/users/3402595/peter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 45965122, "answer_count": 2, "score": 1, "last_activity_date": 1504214655, "creation_date": 1504108915, "last_edit_date": 1504209907, "question_id": 45965025, "link": "https://stackoverflow.com/questions/45965025/c11-object-that-can-be-passed-as-double-4", "title": "c++11 object that can be passed as &quot;double (*)[4]&quot;", "body": "<p>I need to call an function in an external library that has a signature:</p>\n\n<pre><code>void fn(double (*values)[4]);\n</code></pre>\n\n<p>but I would like to pass an object like <code>std::vector&lt;std::array&lt;double, 4&gt;&gt;</code> and it must be c++11 compliant. How would I call this function?</p>\n"}, {"tags": ["c++", "qt", "qstringlistmodel"], "comments": [{"owner": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 3, "creation_date": 1504108852, "post_id": 45964949, "comment_id": 78888769, "body": "change <code>void MainWindow::addNewLanguage(QString&amp; item)</code> to <code>void MainWindow::addNewLanguage(const QString&amp; item)</code>"}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 2, "creation_date": 1504109004, "post_id": 45964949, "comment_id": 78888872, "body": "it does not work because Pascal is not a new language :P Joking aside, here you can find an explanation: <a href=\"https://stackoverflow.com/questions/13826897/why-not-non-const-reference-to-temporary-objects\" title=\"why not non const reference to temporary objects\">stackoverflow.com/questions/13826897/&hellip;</a>"}, {"owner": {"reputation": 8313, "user_id": 7621674, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/323bed98b2e655d5fa9ac6d23a72b995?s=128&d=identicon&r=PG", "display_name": "m7913d", "link": "https://stackoverflow.com/users/7621674/m7913d"}, "edited": false, "score": 0, "creation_date": 1504109493, "post_id": 45964949, "comment_id": 78889201, "body": "@Firewall-Alien Try to construct a minimal question avoiding all irrelevant information (<code>QStringList</code>, ...), see <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> and <a href=\"https://stackoverflow.com/questions/how-to-ask\">How to Ask</a>."}], "answers": [{"tags": [], "owner": {"reputation": 8313, "user_id": 7621674, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/323bed98b2e655d5fa9ac6d23a72b995?s=128&d=identicon&r=PG", "display_name": "m7913d", "link": "https://stackoverflow.com/users/7621674/m7913d"}, "is_accepted": false, "score": 1, "last_activity_date": 1504109378, "last_edit_date": 1504109378, "creation_date": 1504108978, "answer_id": 45965042, "question_id": 45964949, "link": "https://stackoverflow.com/questions/45964949/how-to-give-a-string-as-parameter-to-be-inserted-in-a-qstringlistmodel/45965042#45965042", "title": "how to give a string as parameter to be inserted in a QStringListModel", "body": "<p>The error message already gives you a great hint: </p>\n\n<blockquote>\n  <p>invalid initialization of <strong>non-const reference</strong> of type 'QString&amp;' from an rvalue of type 'QString'</p>\n</blockquote>\n\n<p>Therefore, you should define <code>addNewLanguage</code> as:</p>\n\n<pre><code>void MainWindow::addNewLanguage(const QString&amp; item)\n</code></pre>\n\n<p>or alternatively:</p>\n\n<pre><code>void MainWindow::addNewLanguage(QString item)\n</code></pre>\n\n<p>Have a look at <a href=\"https://stackoverflow.com/questions/13826897/why-not-non-const-reference-to-temporary-objects\">this post</a> for an explanation why a non-const reference is not allowed to a temporary object.</p>\n\n<p>Note that the second approach is not (much) slower than the first one as <a href=\"http://doc.qt.io/qt-5/qstring.html#QString-5\" rel=\"nofollow noreferrer\"><code>QString</code> is implicitly shared</a>.</p>\n"}], "owner": {"reputation": 113, "user_id": 7679404, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/Ro3u3.png?s=128&g=1", "display_name": "Firewall-Alien", "link": "https://stackoverflow.com/users/7679404/firewall-alien"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "closed_date": 1504110096, "answer_count": 1, "score": 0, "last_activity_date": 1504109378, "creation_date": 1504108667, "question_id": 45964949, "link": "https://stackoverflow.com/questions/45964949/how-to-give-a-string-as-parameter-to-be-inserted-in-a-qstringlistmodel", "closed_reason": "Duplicate", "title": "how to give a string as parameter to be inserted in a QStringListModel", "body": "<p>am learning QT and am trying to populate a <code>QStringList</code> with a couple of elements that later populate a <code>QListView</code></p>\n\n<p>my first try from the docu was:</p>\n\n<pre><code>// Create model\nmodel = new QStringListModel(this);\n\n// Make data\nList &lt;&lt; \"Java\" &lt;&lt; \"C++\" &lt;&lt; \"C\";\n// Populate our model\nmodel-&gt;setStringList(List);\n// Glue model and view together\nui-&gt;listView-&gt;setModel(model);\n</code></pre>\n\n<p>so far so good... I can see my List with all the elements I populate...</p>\n\n<p>now in the same class where am doing that am trying to now defined a function that let me add new elements to the list...</p>\n\n<p>so my 1st idea was defining something like</p>\n\n<pre><code>void MainWindow::addNewLanguage(QString&amp; item)\n{\n    List &lt;&lt; item;\n    model-&gt;setStringList(List);\n}\n</code></pre>\n\n<p>but(and here comes my question...)   I am only able to call my function by doing</p>\n\n<pre><code>QString x( \"Php\" );\nw1.addNewLanguage( x );\n</code></pre>\n\n<p>I would like to instead dom something more nice like:</p>\n\n<pre><code>w1.addNewLanguage( \"Pascal\" );\n</code></pre>\n\n<p>no need to define a new object of the QString... </p>\n\n<p>but doing that breaks the compilation with the msg</p>\n\n<blockquote>\n  <p>C:\\Users\\xxx\\WorspaceQT\\untitled4\\main.cpp:25: error: invalid\n  initialization of non-const reference of type 'QString&amp;' from an\n  rvalue of type 'QString'\n       w1.addNewLanguage( \"x2\" );\n                          ^</p>\n</blockquote>\n\n<p>anything I can do to address this??</p>\n\n<p>thanks! :)</p>\n"}, {"tags": ["c++", "chromium-embedded"], "answers": [{"tags": [], "owner": {"reputation": 385, "user_id": 2331649, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5275b8dfbee2460de4c977cdaeda52fd?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/2331649/john"}, "is_accepted": false, "score": 0, "last_activity_date": 1504122834, "last_edit_date": 1504122834, "creation_date": 1504116467, "answer_id": 45967064, "question_id": 45964864, "link": "https://stackoverflow.com/questions/45964864/cef-class-simplehandler-has-no-member/45967064#45967064", "title": "cef class SimpleHandler has no member", "body": "<p>Reinstalled everything to the newest version and it worked, for reference if anyone comes across the same problem.</p>\n\n<p>simple_handler.h</p>\n\n<pre><code>class SimpleHandler :  /* ... */ public CefRequestHandler {\n  /* ... */\n  virtual CefRefPtr&lt;CefRequestHandler&gt; GetRequestHandler() OVERRIDE { return this; }\n  // CefRequestHandler methods:\n  bool OnBeforeBrowse(CefRefPtr&lt;CefBrowser&gt; browser,\n                      CefRefPtr&lt;CefFrame&gt; frame,\n                      CefRefPtr&lt;CefRequest&gt; request,\n                      bool is_redirect) OVERRIDE;\n}\n</code></pre>\n\n<p>simple_handler.cc</p>\n\n<pre><code>bool SimpleHandler::OnBeforeBrowse(CefRefPtr&lt;CefBrowser&gt; browser,\n                                   CefRefPtr&lt;CefFrame&gt; frame,\n                                   CefRefPtr&lt;CefRequest&gt; request,\n                                   bool is_redirect) {\n                                   CEF_REQUIRE_UI_THREAD();\n\nreturn true; // disable links\n}\n</code></pre>\n"}], "owner": {"reputation": 385, "user_id": 2331649, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5275b8dfbee2460de4c977cdaeda52fd?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/2331649/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 254, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1504122834, "creation_date": 1504108397, "question_id": 45964864, "link": "https://stackoverflow.com/questions/45964864/cef-class-simplehandler-has-no-member", "title": "cef class SimpleHandler has no member", "body": "<p>what am I doing wrong extending the <strong>cefsimple</strong> app, getting the same error with either of functions:</p>\n\n<p><strong>#1</strong> <em>class \"SimpleHandler\" has no member \"OnContextCreated\"</em></p>\n\n<p>simple_handler.h</p>\n\n<pre><code>#include \"include/cef_render_process_handler.h\"\nclass SimpleHandler : /*...*/ public CefRenderProcessHandler\n// ...\nvirtual CefRefPtr&lt;CefRenderProcessHandler&gt; GetRenderProcessHandler() {\nreturn this; }\nvirtual void OnContextCreated(CefRefPtr&lt;CefBrowser&gt; browser, \nCefRefPtr&lt;CefFrame&gt; frame, CefRefPtr&lt;CefV8Context&gt; context) OVERRIDE;\n</code></pre>\n\n<p>simple_handler.cc</p>\n\n<pre><code>void SimpleHandler::OnContextCreated(CefRefPtr&lt;CefBrowser&gt; browser, \nCefRefPtr&lt;CefFrame&gt; frame, CefRefPtr&lt;CefV8Context&gt; context) { /*do stuff*/ }\n</code></pre>\n\n<p><strong>#2</strong> <em>class \"SimpleHandler\" has no member \"OnBeforeBrowse\"</em></p>\n\n<p>simple_handler.h</p>\n\n<pre><code>class SimpleHandler : /*...*/ public CefRequestHandler\n// ...\nvirtual CefRefPtr&lt;CefRequestHandler&gt; GetRequestHandler() OVERRIDE { return \nthis; }\nvirtual bool OnBeforeBrowse(CefRefPtr&lt;CefBrowser&gt; browser, \nCefRefPtr&lt;CefFrame&gt; frame, CefRefPtr&lt;CefRequest&gt; request, bool is_redirect) OVERRIDE\n</code></pre>\n\n<p>simple_handler.cc</p>\n\n<pre><code>bool SimpleHandler::OnBeforeBrowse(CefRefPtr&lt;CefBrowser&gt; browser, CefRefPtr&lt;CefFrame&gt; frame, CefRefPtr&lt;CefRequest&gt; request, bool is_redirect) { /*do stuff*/ }\n</code></pre>\n"}, {"tags": ["c++", "cmake", "mingw32"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1504108945, "post_id": 45964743, "comment_id": 78888833, "body": "Does this happen when you link to an empty library?  Does this happen when you link to your normal library but don&#39;t call any functions from it?   Does this happen when you link to a simple library with one C function? Does this happen when your main program only has an empty main() function? So many things you can check yourself..."}, {"owner": {"reputation": 3460, "user_id": 526477, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/eb2015e67fa3c1d484771ea44d93a639?s=128&d=identicon&r=PG", "display_name": "AlastairG", "link": "https://stackoverflow.com/users/526477/alastairg"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1504169822, "post_id": 45964743, "comment_id": 78913234, "body": "If I dynamically link but do not call any functions or instantiate any objects from my library then it doesn&#39;t crash. If my main() is empty then I am not calling any functions so obviously it doesn&#39;t crash as per the previous answer. I haven&#39;t tried with a library with a single C function, but yes I am sure it would crash. I am pretty certain that the problem is the disparity in the symbols which I think would be solved by generating a .lib for my library."}, {"owner": {"reputation": 3460, "user_id": 526477, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/eb2015e67fa3c1d484771ea44d93a639?s=128&d=identicon&r=PG", "display_name": "AlastairG", "link": "https://stackoverflow.com/users/526477/alastairg"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1504171913, "post_id": 45964743, "comment_id": 78914741, "body": "I have tried using WINDOWS_EXPORT_ALL_SYMBOLS in my CMakeLists.txt. It didn&#39;t work."}, {"owner": {"reputation": 3460, "user_id": 526477, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/eb2015e67fa3c1d484771ea44d93a639?s=128&d=identicon&r=PG", "display_name": "AlastairG", "link": "https://stackoverflow.com/users/526477/alastairg"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1504172035, "post_id": 45964743, "comment_id": 78914824, "body": "I have tried using __declspec(dllexport)/__declspec(dllimport) as per <a href=\"https://cmake.org/Wiki/BuildingWinDLL\" rel=\"nofollow noreferrer\">cmake.org/Wiki/BuildingWinDLL</a>. It didn&#39;t work."}, {"owner": {"reputation": 3460, "user_id": 526477, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/eb2015e67fa3c1d484771ea44d93a639?s=128&d=identicon&r=PG", "display_name": "AlastairG", "link": "https://stackoverflow.com/users/526477/alastairg"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1504179001, "post_id": 45964743, "comment_id": 78919714, "body": "I now have a similar issue trying to link to a 3rd party library. They have provided a DLL with all symbols stripped out. They have provided a .lib for which &quot;nm&quot; reports: <code>I __imp__FT_GetDeviceInfoList@8</code> and <code>T _FT_GetDeviceInfoList@8</code>. My static library has an undefined reference to __imp__FT_GetDeviceInfoList@8."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1504182854, "post_id": 45964743, "comment_id": 78922381, "body": "It is common practice to use dllexport when building a dll, and to use dllimport when building a component that uses a dll. Appropriate declspecs have to be in your source code. I have no idea how you can do this without."}, {"owner": {"reputation": 3460, "user_id": 526477, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/eb2015e67fa3c1d484771ea44d93a639?s=128&d=identicon&r=PG", "display_name": "AlastairG", "link": "https://stackoverflow.com/users/526477/alastairg"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1504250922, "post_id": 45964743, "comment_id": 78950290, "body": "@n.m. I tried that but it didn&#39;t work (see above). Reading up some more I found that MinGW, being Posix based, exports all symbols automatically, the same way that shared libraries work on Linux and Unix systems. I also found that normally if you don&#39;t do the dllexport it won&#39;t even link. In my case it does link (presumably because the symbols are present in the MyLibrary.dll.a file)."}, {"owner": {"reputation": 3460, "user_id": 526477, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/eb2015e67fa3c1d484771ea44d93a639?s=128&d=identicon&r=PG", "display_name": "AlastairG", "link": "https://stackoverflow.com/users/526477/alastairg"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1504251101, "post_id": 45964743, "comment_id": 78950388, "body": "My current best guess is that I could get this to work if I specified static linking by the executable while building the library as shared. This way the executable would link to the MyLibrary.dll.a file which has the code to correctly load the DLL at runtime in the same way as a .lib file usually works. However the CMake file specifies the library as SHARED. To work around this would be very messy."}, {"owner": {"reputation": 3460, "user_id": 526477, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/eb2015e67fa3c1d484771ea44d93a639?s=128&d=identicon&r=PG", "display_name": "AlastairG", "link": "https://stackoverflow.com/users/526477/alastairg"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1505918240, "post_id": 45964743, "comment_id": 79610580, "body": "I have been looking into this more after a third party DLL completely failed to link. Apparently linking to third party DLLs is fraught with danger with all sorts of problems such as varying ABIs to deal with. However this is a library built from scratch with not only the same environment but the same build command as the executable to which I want to link!"}], "owner": {"reputation": 3460, "user_id": 526477, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/eb2015e67fa3c1d484771ea44d93a639?s=128&d=identicon&r=PG", "display_name": "AlastairG", "link": "https://stackoverflow.com/users/526477/alastairg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 131, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1504108003, "creation_date": 1504108003, "question_id": 45964743, "link": "https://stackoverflow.com/questions/45964743/mingw-program-crashes-when-dynamically-linking-but-not-when-statically-linking", "title": "MinGW program crashes when dynamically linking but not when statically linking", "body": "<p>I am using MSYS2 provided MinGW32 and QTCreator together with CMake. I have written a very basic class (to be completed later) as a shared library. My main program has an instance of this class as a member of one of its classes.</p>\n\n<p>Essentially my shared library looks like:</p>\n\n<pre><code>// MyClass.h\nclass MyClass { public: MyClass(); };\n\n// MyClass.cpp\n#include \"MyClass.h\"\nMyClass::MyClass() { }\n</code></pre>\n\n<p>And my program looks like:</p>\n\n<pre><code>// B.h\n\n#include \"MyClass.h\"\n\nclass B\n{\n    public:\n    // Some stuff here.\n\n    private:\n    MyClass  m_other;\n};\n</code></pre>\n\n<p>When I statically link, all is fine. When I dynamically link, the program crashes, and GDB cannot get a stack trace. It looks like the program doesn't even really start.</p>\n\n<p>Using nm on the shared DLL I see something like:</p>\n\n<pre><code>61c41604 T __ZN9MyClassC1Ev\n61c41604 T __ZN9MyClassC2Ev\n</code></pre>\n\n<p>I guess these are the constructors.</p>\n\n<p>Using nm on the program I see:</p>\n\n<pre><code>00414388 I __imp___ZN9MyClassC1Ev\n</code></pre>\n\n<p>There is no .lib generated by the build process.</p>\n\n<p>My CMakeLists.txt looks like:</p>\n\n<pre><code>add_library(MyLib SHARED\n    MyClass.cpp\n)\n</code></pre>\n\n<p>I would much prefer to link dynamically so if anyone can help me with this I would be very grateful.</p>\n"}, {"tags": ["c++", "xml", "curlpp"], "comments": [{"owner": {"reputation": 80882, "user_id": 18157, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4d3de78b198076dd5a5006abd17cb0f8?s=128&d=identicon&r=PG&f=1", "display_name": "Jim Garrison", "link": "https://stackoverflow.com/users/18157/jim-garrison"}, "edited": false, "score": 0, "creation_date": 1504108663, "post_id": 45964703, "comment_id": 78888649, "body": "Did you examine the network traffic with Wireshark and see the difference between what a browser sends and what you are sending?  The problem is likely a missing <code>user-agent</code> header or one that the server disallows."}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 0, "creation_date": 1504110777, "post_id": 45964703, "comment_id": 78890036, "body": "cURLpp is just a C++ wrapper for the C libcurl library, which is the same library that the <code>curl</code> command line tool uses internally.  So simply translate the command-line parameters you are using into cURLcc equivalent parameters, per the libcurl and cURLpp documentations. If you can&#39;t figure it out, show the actual command line you are using and someone will be able to translate it for you."}, {"owner": {"reputation": 139, "user_id": 3957032, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/0f49caee097776dadf0153284ed70ab8?s=128&d=identicon&r=PG&f=1", "display_name": "Da Li", "link": "https://stackoverflow.com/users/3957032/da-li"}, "edited": false, "score": 0, "creation_date": 1504132415, "post_id": 45964703, "comment_id": 78900521, "body": "the commandline is curl <a href=\"https://www.westlotto.com/wlinfo/WL_InfoService?gruppe=SpielplanToto\" rel=\"nofollow noreferrer\">westlotto.com/wlinfo/WL_InfoService?gruppe=SpielplanToto</a> No flags at all - Any hints?"}], "owner": {"reputation": 139, "user_id": 3957032, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/0f49caee097776dadf0153284ed70ab8?s=128&d=identicon&r=PG&f=1", "display_name": "Da Li", "link": "https://stackoverflow.com/users/3957032/da-li"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 124, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1504110632, "creation_date": 1504107873, "last_edit_date": 1504110632, "question_id": 45964703, "link": "https://stackoverflow.com/questions/45964703/curlpp-trying-to-read-an-xml-document-from-the-web", "title": "cURLpp: Trying to read an XML document from the web", "body": "<p>I just started to play a bit around with cURLpp, and try to read a XML document from the web. Here is the site:</p>\n\n<p><a href=\"https://www.westlotto.com/wlinfo/WL_InfoService?gruppe=SpielplanToto\" rel=\"nofollow noreferrer\">https://www.westlotto.com/wlinfo/WL_InfoService?gruppe=SpielplanToto</a></p>\n\n<p>When I do a simple cURLpp operation:</p>\n\n<pre><code>try {\n    curlpp::Cleanup myCleanup;\n    curlpp::Easy myRequest;\n    myRequest.setOpt&lt;Url&gt;(\"http://www.westlotto.com/wlinfo/WL_InfoService?gruppe=SpielplanToto\");\n    myRequest.perform();\n}\ncatch(curlpp::RuntimeError &amp; e) {\n    ...\n}\n</code></pre>\n\n<p>I get this document:</p>\n\n<pre><code>&lt;html&gt;\n&lt;title&gt;Request Denied!&lt;/title&gt;\n&lt;body&gt;&lt;center&gt;&lt;h1&gt;Request Denied!&lt;/h1&gt;\n&lt;p&gt;www.westlotto.de&lt;/p&gt;\n&lt;p&gt;If you have any questions contact the admin.&lt;/p&gt;\n&lt;/center&gt;&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>With the curl command line tool, it works fine. I have no idea what is going on and how to solve this. </p>\n\n<p>Thanks!</p>\n"}, {"tags": ["c++", "qt", "opencv"], "comments": [{"owner": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 1, "creation_date": 1504107839, "post_id": 45964652, "comment_id": 78888130, "body": "Were Qt and opencv built using Visual Studio 2015?"}, {"owner": {"reputation": 1719, "user_id": 2619479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/127aeef4e048febca4fd6560b465359d?s=128&d=identicon&r=PG", "display_name": "Marco", "link": "https://stackoverflow.com/users/2619479/marco"}, "edited": false, "score": 1, "creation_date": 1504108648, "post_id": 45964652, "comment_id": 78888638, "body": "Did you try simply cv::QtFont font8 = cv::fontQt(&quot;Times&quot;)  this would use all standard parameters so at least you can exclude a wrong parameter."}], "owner": {"reputation": 1, "user_id": 6468536, "user_type": "registered", "profile_image": "https://graph.facebook.com/620272704802960/picture?type=large", "display_name": "Alex Stoica Sebastian", "link": "https://stackoverflow.com/users/6468536/alex-stoica-sebastian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 155, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1504109054, "creation_date": 1504107728, "last_edit_date": 1504109054, "question_id": 45964652, "link": "https://stackoverflow.com/questions/45964652/memory-exception-when-initializing-qtfont", "title": "Memory exception when initializing QtFont", "body": "<p>I am trying to use the new fonts from OpenCV 3.3 that are required by <code>cv::addText()</code>. I am trying two different examples:</p>\n\n<pre><code>cv::QtFont font8 = cv::fontQt(\"Times\", 1, cv::Scalar(255,255,255), \ncv::QT_FONT_NORMAL, cv::QT_STYLE_NORMAL, 0);\n</code></pre>\n\n<p>It fails with a <code>cv::Exception</code> at at memory location. It is unable to perform the memcpy.</p>\n\n<p>The second variant is something similar to:<code>CvFont fontB = cv::fontQt (\"Times\", 30, cv::Scalar (255, 255, 255), CV_FONT_BOLD);</code></p>\n\n<p>This one can be found in different tutorials but it doesn't work because there it can't convert a qt font to a cv font. Even the most basic example from the official documentation fails. I freshly installed OpenCV from its respective website and I am using Visual Studio 2015.</p>\n\n<p>Is there any other method of initializing a QtFont? Does OpenCV need to be compiled in a special manner? </p>\n"}, {"tags": ["c++", "largenumber"], "comments": [{"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 2, "creation_date": 1504107798, "post_id": 45964619, "comment_id": 78888107, "body": "The constant <code>134430487042201894894174208</code> is not representable on most platforms."}, {"owner": {"reputation": 8847, "user_id": 3484570, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/r5BRZ.png?s=128&g=1", "display_name": "nwp", "link": "https://stackoverflow.com/users/3484570/nwp"}, "edited": false, "score": 1, "creation_date": 1504107810, "post_id": 45964619, "comment_id": 78888112, "body": "Those numbers look very large. Check the <a href=\"http://en.cppreference.com/w/cpp/types/numeric_limits\" rel=\"nofollow noreferrer\">limits</a> of the data types you are using. You might need a bignum library to get reasonably accurate results."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 4, "creation_date": 1504107849, "post_id": 45964619, "comment_id": 78888141, "body": "Your example does not compile. <code>m</code> and <code>d</code> are not defined. Please provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1504108080, "post_id": 45964619, "comment_id": 78888298, "body": "Try if <code>-134430487042201894894174208</code> -&gt; <code>-134430487042201894894174208.0</code> helps"}, {"owner": {"reputation": 602, "user_id": 6738494, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HDxVP.jpg?s=128&g=1", "display_name": "RazaUsman_k", "link": "https://stackoverflow.com/users/6738494/razausman-k"}, "edited": false, "score": 0, "creation_date": 1504109032, "post_id": 45964619, "comment_id": 78888890, "body": "I don&#39;t think u can store a number this big <code>-134430487042201894894174208</code>"}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 8286342, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3209b10e87ee0a9682da32d1a2453d90?s=128&d=identicon&r=PG&f=1", "display_name": "S. Elison", "link": "https://stackoverflow.com/users/8286342/s-elison"}, "edited": false, "score": 0, "creation_date": 1504109861, "post_id": 45965118, "comment_id": 78889442, "body": "You ruled it! Thanks."}], "tags": [], "owner": {"reputation": 730, "user_id": 8270416, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/876b251bdfdc25fbda57c01009c054be?s=128&d=identicon&r=PG&f=1", "display_name": "ttemple", "link": "https://stackoverflow.com/users/8270416/ttemple"}, "is_accepted": true, "score": 2, "last_activity_date": 1504109221, "creation_date": 1504109221, "answer_id": 45965118, "question_id": 45964619, "link": "https://stackoverflow.com/questions/45964619/large-numbers-division-returns-1-c/45965118#45965118", "title": "Large Numbers Division returns 1 [c++]", "body": "<p>The function det is returning an int.  You are never going to get floating point values from it.</p>\n"}], "owner": {"reputation": 3, "user_id": 8286342, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3209b10e87ee0a9682da32d1a2453d90?s=128&d=identicon&r=PG&f=1", "display_name": "S. Elison", "link": "https://stackoverflow.com/users/8286342/s-elison"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 45965118, "answer_count": 1, "score": 0, "last_activity_date": 1504109221, "creation_date": 1504107617, "question_id": 45964619, "link": "https://stackoverflow.com/questions/45964619/large-numbers-division-returns-1-c", "title": "Large Numbers Division returns 1 [c++]", "body": "<p>I am new here so i am sorry if my question is a kind stupid, but, i was calculating the divisions of two large numbers and storing them in an array, like this: </p>\n\n<pre><code>int det(double M[25][25], int m)\n{\n    /*returns large numbers*/\n}\n\nint main()\n{\n    float y[27];\n    double A[25][25] = {0}, N = 26, D = -134430487042201894894174208;\n\n    y[0] = 0;\n    y[26] = 1;\n\n    for (int i = 0; i &lt; N-1; i++)\n    {\n        //Reset A[][] to the original\n        for (int k = 0; k &lt; N-1; k++)\n        {\n            for (int J = 0; J &lt; N-1; J++)\n                {\n                    A[k][J] = m[k][J];\n                }\n        }\n        //Change values of A[j][i]\n        for (int j = 0; j &lt; N-1; j++)\n          {\n              A[j][i] = d[j+1];\n          }\n        y[i+1] = det(A,N-1)/D; //Here y returns only 0, 1, 1, 1, 1, ...\n    }\n}D\n</code></pre>\n\n<p>So, what am i doing wrong? y array returns 0, 1, 1, 1, 1, ... , and it was supposed to not be 1</p>\n\n<p>det(A,N-1) = 7958284334509567005163520\nD = -134430487042201894894174208</p>\n\n<p>det(A,N-1)/D = -0.05919999629259109195883585509348322869497780932400145347...</p>\n\n<p>It's not 1.</p>\n\n<p>Thanks! </p>\n"}, {"tags": ["c++", "c", "file-handling"], "comments": [{"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 4, "creation_date": 1504110161, "post_id": 45964466, "comment_id": 78889639, "body": "I am sorry for your spacebar. Hope you get a new keyboard soon, so that you can reindent your code."}, {"owner": {"reputation": 23582, "user_id": 758133, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/W8X5E.jpg?s=128&g=1", "display_name": "Martin James", "link": "https://stackoverflow.com/users/758133/martin-james"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 2, "creation_date": 1504110601, "post_id": 45964466, "comment_id": 78889925, "body": "^^^what @AnttiHaapala says.  Good formatting and indentation is not just a trivial matter of making code look pretty.  Poor indentation leads to flow-of-control and scoping bugs and, if you are posting your code to a Q&amp;A site for help, tends to result in downvotes and closing as &#39;unclear&#39;:("}], "answers": [{"tags": [], "owner": {"reputation": 6172, "user_id": 8254699, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b91384172702e29895e620c2b0924ef3?s=128&d=identicon&r=PG&f=1", "display_name": "kocica", "link": "https://stackoverflow.com/users/8254699/kocica"}, "is_accepted": false, "score": 0, "last_activity_date": 1504107737, "last_edit_date": 1504107737, "creation_date": 1504107419, "answer_id": 45964556, "question_id": 45964466, "link": "https://stackoverflow.com/questions/45964466/file-handling-the-code-stops-running/45964556#45964556", "title": "file handling: the code stops running", "body": "<p><code>%s</code> specifier expexts the <code>char*</code> but what you are passing is <code>char (*)[30]</code>. Even if they point to same memory they are different types.</p>\n\n<p>Remove reference operator</p>\n\n<pre><code>fscanf(fp,\"%s\",treeArr[i]);\n               ^^^^^^^^^^\n</code></pre>\n\n<hr>\n\n<p>Also you should rewind/reset file pointer of <code>fp</code> file descriptor which,after loop, point to the end of file what causes that <code>fscanf</code> returns EOF.</p>\n\n<pre><code>fseek(fp, 0L, SEEK_SET);\n// Or\nrewind(fp);\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 106438, "user_id": 1275169, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4c6dbda4e65af6d2ceaabdfad538b319?s=128&d=identicon&r=PG&f=1", "display_name": "P.P", "link": "https://stackoverflow.com/users/1275169/p-p"}, "is_accepted": false, "score": 3, "last_activity_date": 1504107472, "creation_date": 1504107472, "answer_id": 45964575, "question_id": 45964466, "link": "https://stackoverflow.com/questions/45964466/file-handling-the-code-stops-running/45964575#45964575", "title": "file handling: the code stops running", "body": "<p>Problem is your file pointer <code>fp</code> is pointing to the end of file after the <code>while</code> loop (where you write into the file). So the subsequent read operations (<code>fscanf</code>) going to return <code>EOF</code> immediately.</p>\n\n<p>You can reset the file pointer to the beginning before reading the file:</p>\n\n<pre><code>fseek(fp, 0L, SEEK_SET);\n</code></pre>\n\n<p>You would have noticed this if error check your library calls (<code>fopen</code>, <code>scanf</code>, <code>fscanf</code>, etc).</p>\n"}], "owner": {"reputation": 9, "user_id": 7880241, "user_type": "registered", "profile_image": "https://graph.facebook.com/1333792900001773/picture?type=large", "display_name": "Ramyanee Kashyap", "link": "https://stackoverflow.com/users/7880241/ramyanee-kashyap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1504112424, "creation_date": 1504107164, "last_edit_date": 1504112424, "question_id": 45964466, "link": "https://stackoverflow.com/questions/45964466/file-handling-the-code-stops-running", "title": "file handling: the code stops running", "body": "<pre><code>#include &lt;stdio.h&gt;\nmain()\n{\n    FILE* fp;\n\n    fp = fopen(\"a.text\", \"w+\");\n\n    int yes = 1, count = 0;\n\n    char tree[30];\n\n    while (yes) {\n        printf(\"enter the name of the tree\\n\");\n        scanf(\"%s\", tree);\n        fprintf(fp, \"%s\\n\", tree);\n        printf(\"do you want to enter more  trees?enter 0 if no and 1 if yes\\n\");\n        scanf(\"%d\", &amp;yes);\n        count++;\n    }\n\n    char treeArr[count][30];\n    int i = 0;\n    for (i = 0; i &lt; count; i++) {\n        fscanf(fp, \"%s\", &amp;treeArr[i]);\n        printf(\"%s\", treeArr[i]);\n    }\n\n    fclose(fp);\n}\n</code></pre>\n\n<p>this part of the code is not working.</p>\n\n<pre><code>char treeArr[count][30];\nint i = 0;\nfor (i = 0; i &lt; count; i++) {\n    fscanf(fp, \"%s\", &amp;treeArr[i]);\n    printf(\"%s\", treeArr[i]);\n}\n</code></pre>\n\n<p>I need to write the names of the trees in the file and and then put it into a string array, so that i can calculate the percentage of each tree.</p>\n\n<p>this is the question. kindly provide a suitable solution.</p>\n\n<p>1.As you walk along TU campus, you see lots of trees of different species on your way.</p>\n\n<p>Horticulture Centre has prepared a list of every tree standing on the way from CSE Department to the Main Gate.</p>\n\n<p>You have to report the percentage of each tree species.</p>\n\n<p><strong>Input</strong></p>\n\n<blockquote>\n  <p>Input to your program consists of a list of the species of every tree observed by the Horticulture Department; one tree per line in .txt file. No species name exceeds 30 characters. </p>\n</blockquote>\n\n<p><strong>Output</strong></p>\n\n<blockquote>\n  <p>Print the name of each tree species available in TU (sorted in order of their percentage), followed by the percentage of the population it represents.</p>\n</blockquote>\n"}, {"tags": ["c++", "qt", "visual-studio-2017", "qtcore", "qobject"], "comments": [{"owner": {"reputation": 383, "user_id": 1185047, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e821d8cbc7384947c8371742fedc4f7c?s=128&d=identicon&r=PG", "display_name": "rbelli", "link": "https://stackoverflow.com/users/1185047/rbelli"}, "edited": false, "score": 1, "creation_date": 1504107073, "post_id": 45964335, "comment_id": 78887665, "body": "Try to add a path not to QtCore, but to the folder that has QtCore."}, {"owner": {"reputation": 1, "user_id": 8362241, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b670f8317211b33f0e9ca05ee941af74?s=128&d=identicon&r=PG&f=1", "display_name": "lorenzinetor", "link": "https://stackoverflow.com/users/8362241/lorenzinetor"}, "reply_to_user": {"reputation": 383, "user_id": 1185047, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e821d8cbc7384947c8371742fedc4f7c?s=128&d=identicon&r=PG", "display_name": "rbelli", "link": "https://stackoverflow.com/users/1185047/rbelli"}, "edited": false, "score": 0, "creation_date": 1504266887, "post_id": 45964335, "comment_id": 78959517, "body": "Thanks, I randomly tried this way right before your answer and it worked. Are there any issues that can show up with this method (increase of the project dimensions, compatibility problems...)?"}, {"owner": {"reputation": 383, "user_id": 1185047, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e821d8cbc7384947c8371742fedc4f7c?s=128&d=identicon&r=PG", "display_name": "rbelli", "link": "https://stackoverflow.com/users/1185047/rbelli"}, "edited": false, "score": 0, "creation_date": 1504283233, "post_id": 45964335, "comment_id": 78969783, "body": "In my understand this is the correct folder to add. And it will not cause any increase in your project nor compatibility problems."}], "owner": {"reputation": 1, "user_id": 8362241, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b670f8317211b33f0e9ca05ee941af74?s=128&d=identicon&r=PG&f=1", "display_name": "lorenzinetor", "link": "https://stackoverflow.com/users/8362241/lorenzinetor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1334, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1504254441, "creation_date": 1504106801, "question_id": 45964335, "link": "https://stackoverflow.com/questions/45964335/qobject-cannot-open-include-file-qtcore-qobjectdefs-h", "title": "QObject: cannot open include file &#39;QtCore/qobjectdefs.h&#39;", "body": "<p>I have a WPF project for which I would like to use some functions taken from Qt. I have added the path to QtCore to the Additional Include Directories and the path to the lib directory of Qt to the Additional Library Directories. In a class I include QObject.h, and when I build I get an error at row 46 of QObject</p>\n\n<blockquote>\n  <p>fatal error C1083: Cannot open include file 'QtCore/qobjectdefs.h': No such file or directory (compiling source file MyClass.cpp)</p>\n</blockquote>\n\n<p>In QObject.cpp I can see that at row 46 it tries to include QtCore/qobjectdefs.h, but they are in the same directory, so I'm not surprised that if I delete \"QtCore/\" in the include the project doesn't show that error (but fails to include the next .h because of the same problem). I tried to create a sample Qt project in Visual Studio and to inclue QObject.h in a class, and it builds without any issue.\nIs there any way to make the includes work also outside a Qt project without manually deleting \"QtCore/\" in every include of QObject and the other classes that I will need?</p>\n"}, {"tags": ["c++", "multithreading", "c++11"], "comments": [{"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 0, "creation_date": 1504115173, "post_id": 45964077, "comment_id": 78892401, "body": "<code>while(1){}</code> is UB, see for example <a href=\"https://stackoverflow.com/questions/5905155/is-this-infinite-recursion-ub\">is-this-infinite-recursion-ub</a>."}], "answers": [{"comments": [{"owner": {"reputation": 880, "user_id": 3661738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acddd9c3372908d0903c4611aea1a9b7?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler", "link": "https://stackoverflow.com/users/3661738/tyler"}, "edited": false, "score": 0, "creation_date": 1504106465, "post_id": 45964171, "comment_id": 78887244, "body": "His errors are because the run() and user() methods the threads call do not accept parameters, would your code not still have these errors?"}, {"owner": {"reputation": 22670, "user_id": 955273, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/79903a88026b021e89735578bb71fd22?s=128&d=identicon&r=PG", "display_name": "Steve Lorimer", "link": "https://stackoverflow.com/users/955273/steve-lorimer"}, "reply_to_user": {"reputation": 880, "user_id": 3661738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acddd9c3372908d0903c4611aea1a9b7?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler", "link": "https://stackoverflow.com/users/3661738/tyler"}, "edited": false, "score": 1, "creation_date": 1504106546, "post_id": 45964171, "comment_id": 78887304, "body": "No, you&#39;re mistaken - the call he&#39;s trying to make is to execute the <code>run</code> <b>member function</b> of <code>Boo</code>, using the object <code>boo</code>. That is, you need both a member function pointer and an object instance"}, {"owner": {"reputation": 880, "user_id": 3661738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acddd9c3372908d0903c4611aea1a9b7?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler", "link": "https://stackoverflow.com/users/3661738/tyler"}, "edited": false, "score": 0, "creation_date": 1504106653, "post_id": 45964171, "comment_id": 78887369, "body": "Ok thanks, I misremembered the second parameter of the thread constructor. Deleted my incorrect answer"}], "tags": [], "owner": {"reputation": 22670, "user_id": 955273, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/79903a88026b021e89735578bb71fd22?s=128&d=identicon&r=PG", "display_name": "Steve Lorimer", "link": "https://stackoverflow.com/users/955273/steve-lorimer"}, "is_accepted": true, "score": 4, "last_activity_date": 1504106683, "last_edit_date": 1504106683, "creation_date": 1504106328, "answer_id": 45964171, "question_id": 45964077, "link": "https://stackoverflow.com/questions/45964077/thread-inside-a-class-with-member-function-from-another-class/45964171#45964171", "title": "Thread inside a class with member function from another class", "body": "<p>You need to use <code>operator=</code> to <strong>assign</strong> the threads after construction</p>\n\n<p>Working example below (<a href=\"http://coliru.stacked-crooked.com/a/eddaad508114c72d\" rel=\"nofollow noreferrer\">see it in action</a>):</p>\n\n<pre><code>#include &lt;thread&gt;\n#include &lt;iostream&gt;\n\nclass Boo\n{\npublic:\n    void run()\n    {\n        int i = 10;\n        while(i--)\n        {\n            std::cout &lt;&lt; \"boo\\n\";;\n        }\n    }\n};\n\nclass Foo\n{\npublic:\n    void run()\n    {\n        t1 = std::thread(&amp;Boo::run,boo);   // threads already default constructed\n        t2 = std::thread(&amp;Foo::user,this); // so need to *assign* them \n    }\n\n    void user()\n    {\n        int i = 10;\n        while(i--)\n        {\n            std::cout &lt;&lt; \"foo\\n\";;\n        }\n    }\n\n    ~Foo()\n    {\n        t1.join();\n        t2.join();\n    }\n\nprivate:\n    std::thread t1;\n    std::thread t2;\n    Boo boo;\n};\n\nint main()\n{\n    Foo foo;\n    foo.run();\n}\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 8538797, "user_type": "registered", "profile_image": "https://graph.facebook.com/911327432338925/picture?type=large", "display_name": "maciekkov", "link": "https://stackoverflow.com/users/8538797/maciekkov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1924, "favorite_count": 3, "accepted_answer_id": 45964171, "answer_count": 1, "score": 2, "last_activity_date": 1504106732, "creation_date": 1504106010, "last_edit_date": 1504106116, "question_id": 45964077, "link": "https://stackoverflow.com/questions/45964077/thread-inside-a-class-with-member-function-from-another-class", "title": "Thread inside a class with member function from another class", "body": "<p>Can someone tell me how can I run a new thread with member function from a object of diffrent class as a member function of this class ? What ever im trying to do Im still getting errors.</p>\n\n<blockquote>\n  <p><code>no match for call to '(std::thread) (void (Boo::*)(), Boo&amp;)'|</code><br>\n  <code>no match for call to '(std::thread) (void (Foo::*)(), Foo*)'|</code></p>\n</blockquote>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;thread&gt;\nusing namespace std;\nclass Boo\n{\npublic:\n    void run()\n    {\n        while(1){}\n    }\n};\n\nclass Foo\n{\npublic:\n    void run()\n    {\n        t1(&amp;Boo::run,boo);\n        t2(&amp;Foo::user,this);\n    }\n    void user();\n    ~Foo(){\n        t1.join();\n        t2.join();\n    }\nprivate:\n    std::thread t1;\n    std::thread t2;\n    Boo boo;\n};\nint main()\n{\n    Foo foo;\n    foo.run();\n}\n</code></pre>\n"}, {"tags": ["c++", "templates", "struct"], "comments": [{"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1504105319, "post_id": 45963786, "comment_id": 78886379, "body": "It seems you are trying to make a function who&#39;s return type depends on the run-time value of it&#39;s arguments. This is not possible in c++. Function return types must be known at compile-time."}, {"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 1, "creation_date": 1504105323, "post_id": 45963786, "comment_id": 78886381, "body": "You can have 4 overload... But dedicated constructor seems even better."}, {"owner": {"reputation": 8847, "user_id": 3484570, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/r5BRZ.png?s=128&g=1", "display_name": "nwp", "link": "https://stackoverflow.com/users/3484570/nwp"}, "edited": false, "score": 1, "creation_date": 1504105376, "post_id": 45963786, "comment_id": 78886430, "body": "You can use <code>ReturnFour funcReturn(bool par1, bool par2, ...)</code> and add constructors for <code>ReturnFour</code> that take <code>ReturnTwo</code> and <code>ReturnThree</code>."}, {"owner": {"reputation": 77, "user_id": 8537590, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/490c9ac324f6474af492ec917598a2bb?s=128&d=identicon&r=PG&f=1", "display_name": "codeNoob", "link": "https://stackoverflow.com/users/8537590/codenoob"}, "edited": false, "score": 0, "creation_date": 1504106654, "post_id": 45963786, "comment_id": 78887370, "body": "Thanks for the coments! Special constructors for ReturnFour is the only way."}], "answers": [{"tags": [], "owner": {"reputation": 3923, "user_id": 8309701, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S44bo.png?s=128&g=1", "display_name": "Chris Uzdavinis", "link": "https://stackoverflow.com/users/8309701/chris-uzdavinis"}, "is_accepted": true, "score": 1, "last_activity_date": 1504105749, "creation_date": 1504105749, "answer_id": 45963986, "question_id": 45963786, "link": "https://stackoverflow.com/questions/45963786/return-struct-object-from-fuction-dependent-on-numbers-of-parameters-and-assign/45963986#45963986", "title": "Return struct object from fuction dependent on numbers of parameters and assign it to object of general struct", "body": "<p>Would overloaded functions work for you?</p>\n\n<pre><code>ReturnOne funcReturn(bool par1) { ... }\n\nReturnTwo funcReturn(bool par1, bool par2) { ... }\n</code></pre>\n\n<p>Etc?  Another possibility is to return a struct of optionals, or a bunch of ints and flags to represent which are present.</p>\n\n<p>If you intend for the runtime <em>value</em> of the parameters (rather than the number of them) to determine what type your function returns, then that's not possible.  In that case the best you can do is one of the dynamic suggestions I gave above, since it must return just one type and you presumably want that type to indicate which values it contains.</p>\n\n<p>A final idea is if your boolean values are known at compile time, you could use template parameters instead of function arguments, and then have different specializations so the combination of true/false values could select a proper specialization.</p>\n"}, {"tags": [], "owner": {"reputation": 55059, "user_id": 212858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1166c87b6f3fc2e6746da96b60fefb46?s=128&d=identicon&r=PG", "display_name": "Useless", "link": "https://stackoverflow.com/users/212858/useless"}, "is_accepted": false, "score": 1, "last_activity_date": 1504106645, "creation_date": 1504106645, "answer_id": 45964286, "question_id": 45963786, "link": "https://stackoverflow.com/questions/45963786/return-struct-object-from-fuction-dependent-on-numbers-of-parameters-and-assign/45964286#45964286", "title": "Return struct object from fuction dependent on numbers of parameters and assign it to object of general struct", "body": "<p>Just return a <code>ReturnFour</code> always. Returning different types - even if they're subsets of <code>ReturnFour</code>, means you have to write conversion operators or converting constructors, and that's extra work with no benefit visible in this context.</p>\n\n<p>That leaves your overloads looking like</p>\n\n<pre><code>ReturnFour funcReturn(bool p1) { return {42}; }\nReturnFour funcReturn(bool p1, bool p2) { return {42, 53}; }\n</code></pre>\n\n<p>and the un-used members of the return struct will be value-initialized to zero.</p>\n"}, {"tags": [], "owner": {"reputation": 9737, "user_id": 1460794, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/7lOXx.png?s=128&g=1", "display_name": "wally", "link": "https://stackoverflow.com/users/1460794/wally"}, "is_accepted": false, "score": 1, "last_activity_date": 1504118667, "last_edit_date": 1504118667, "creation_date": 1504118248, "answer_id": 45967607, "question_id": 45963786, "link": "https://stackoverflow.com/questions/45963786/return-struct-object-from-fuction-dependent-on-numbers-of-parameters-and-assign/45967607#45967607", "title": "Return struct object from fuction dependent on numbers of parameters and assign it to object of general struct", "body": "<p>The following solution uses templates, C++17 structured bindings and a <code>std::tuple</code> return type to allow for any number of arguments. As an example all the <code>bool</code> values that were converted to <code>int</code> values are added together.</p>\n\n<pre><code>#include &lt;tuple&gt;\n\nint translate(bool par) // logic to translate a bool to an int\n{\n    if (par) {\n        return 5;\n    }\n    else {\n        return -3;\n    }\n}\n\ntemplate &lt;typename T&gt;\nstruct ToInt {\n    using Type = int;\n};\n\ntemplate &lt;typename... Targs&gt;\nstd::tuple&lt;typename ToInt&lt;Targs&gt;::Type...&gt; funcReturn(Targs... Fargs)\n{\n    return { translate(Fargs)... };\n}\n\nint main() {\n    auto [par1, par2, par3, par4] = funcReturn(true, false, true, true);\n    int total = par1 + par2 + par3 + par4; // total == 12\n}\n</code></pre>\n\n<p><a href=\"http://coliru.stacked-crooked.com/a/f87ebca91c9a4239\" rel=\"nofollow noreferrer\">demo</a></p>\n"}], "owner": {"reputation": 77, "user_id": 8537590, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/490c9ac324f6474af492ec917598a2bb?s=128&d=identicon&r=PG&f=1", "display_name": "codeNoob", "link": "https://stackoverflow.com/users/8537590/codenoob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 45963986, "answer_count": 3, "score": 1, "last_activity_date": 1504118667, "creation_date": 1504105202, "last_edit_date": 1504108021, "question_id": 45963786, "link": "https://stackoverflow.com/questions/45963786/return-struct-object-from-fuction-dependent-on-numbers-of-parameters-and-assign", "title": "Return struct object from fuction dependent on numbers of parameters and assign it to object of general struct", "body": "<p>I try to explain that. \nI need a function which gets different numbers of parameters (2,3 or even more) and based on it returns corresponding object of struct:</p>\n\n<pre><code>someStruct funcReturn(bool par1, bool par2, ...)\n{\n    someStruct temp;\n    if (par1)\n    {\n        //...\n    }\n    if (par2)\n    {\n        //...\n    }\n    ...\n    return temp;\n}\n</code></pre>\n\n<p>Structs is very simple:</p>\n\n<pre><code>struct ReturnTwo\n{\n   int one;\n   int two;\n};\n\nstruct ReturnThree\n{\n   int one;\n   int two;\n   int three;\n};\n</code></pre>\n\n<p>And in the end I need to assign the result of this function to a general structure consisting of four objects (missing elements are initialized 0):</p>\n\n<pre><code>struct ReturnFour\n{\n   int one;\n   int two;\n   int three;\n   int four;\n};\n...\nReturnFour returnFour = funcReturn(true, false, ...)\n</code></pre>\n\n<p>My question can be divided into two parts:</p>\n\n<ol>\n<li><p>Is there a way to work with different numbers of parameters in function and specify a logic of it into the function? Using templates provides that? </p></li>\n<li><p>How can I assign one struct to another without changing the organization of struct? Something like a <em>auto</em> for struct? Of course I can solve that through \u0421-style:</p>\n\n<pre><code>ReturnFour returnFour = {funcReturn(true, false).one,funcReturn(true, false).two,0 ,0}\n</code></pre></li>\n</ol>\n\n<p>But I think there is a more convenient way. Thank you!</p>\n"}, {"tags": ["c++", "class", "inheritance"], "comments": [{"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 1, "creation_date": 1504104995, "post_id": 45963659, "comment_id": 78886093, "body": "If <code>Daughter</code> should do the parsing why does <code>Mother</code> have <code>parse_textfile</code> and not <code>Daughter</code>?  Also, do you even need inheritance here?  Looks like something a single class can handle."}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1504105043, "post_id": 45963659, "comment_id": 78886144, "body": "what is wrong about sharing sources? Btw you just did it :P"}, {"owner": {"reputation": 3125, "user_id": 2878796, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8bxWv.png?s=128&g=1", "display_name": "UnholySheep", "link": "https://stackoverflow.com/users/2878796/unholysheep"}, "edited": false, "score": 1, "creation_date": 1504105183, "post_id": 45963659, "comment_id": 78886268, "body": "By the way, just because you send someone a binary executable does not mean they cannot find out what your program is doing. (Reverse engineering code is not magic)"}, {"owner": {"reputation": 63, "user_id": 7432462, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9b3d9149601a512823ae7d3aa67f12ad?s=128&d=identicon&r=PG&f=1", "display_name": "Reniel Calzada", "link": "https://stackoverflow.com/users/7432462/reniel-calzada"}, "edited": false, "score": 0, "creation_date": 1504105212, "post_id": 45963659, "comment_id": 78886295, "body": "I haven&#39;t, because the parser is not the meat of the product. We have all the parsers we need in Python."}, {"owner": {"reputation": 63, "user_id": 7432462, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9b3d9149601a512823ae7d3aa67f12ad?s=128&d=identicon&r=PG&f=1", "display_name": "Reniel Calzada", "link": "https://stackoverflow.com/users/7432462/reniel-calzada"}, "reply_to_user": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1504105337, "post_id": 45963659, "comment_id": 78886394, "body": "@NathanOliver The idea is that there are more files to parse, and they all come together trough the same mother class, so I want te be able to parse them all, and operate though Mother, which BTW Mother is intended to be yet a daughter of someone else."}, {"owner": {"reputation": 63, "user_id": 7432462, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9b3d9149601a512823ae7d3aa67f12ad?s=128&d=identicon&r=PG&f=1", "display_name": "Reniel Calzada", "link": "https://stackoverflow.com/users/7432462/reniel-calzada"}, "reply_to_user": {"reputation": 3125, "user_id": 2878796, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8bxWv.png?s=128&g=1", "display_name": "UnholySheep", "link": "https://stackoverflow.com/users/2878796/unholysheep"}, "edited": false, "score": 0, "creation_date": 1504105455, "post_id": 45963659, "comment_id": 78886502, "body": "@UnholySheep I don&#39;t mind if they make their own open source version. I not getting paid to do this, so I&#39;m doing it for my own benefit, but not to give it away entirely without regards for my own well being."}, {"owner": {"reputation": 30540, "user_id": 719263, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7feab598abfc27783641fe2b796a0155?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Yun&#232;s", "link": "https://stackoverflow.com/users/719263/jean-baptiste-yun%c3%a8s"}, "edited": false, "score": 0, "creation_date": 1504105637, "post_id": 45963659, "comment_id": 78886640, "body": "What do you want? Mother or Daughter each initialized with an explicit dedicated file? Or parse a file and get a Mother or Daughter depending on what&#39;s inside the file?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1504105693, "post_id": 45963659, "comment_id": 78886680, "body": "Please take a look at <a href=\"https://stackoverflow.com/questions/388242/the-definitive-c-book-guide-and-list\">this list</a> and use one or more items."}, {"owner": {"reputation": 63, "user_id": 7432462, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9b3d9149601a512823ae7d3aa67f12ad?s=128&d=identicon&r=PG&f=1", "display_name": "Reniel Calzada", "link": "https://stackoverflow.com/users/7432462/reniel-calzada"}, "reply_to_user": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1504105717, "post_id": 45963659, "comment_id": 78886697, "body": "@NathanOliver I was just thinking of initialization, where one could initialize a Mother and then use a string to find the text file and return the correct Daughter object  (there are 3 different Daughters), or if each parser should just be only in their corresponding Daughters, which I guess makes much more sense. But that was the point of asking. I&#39;m a total newbie in C++ so I have no idea what I&#39;m doing. I&#39;m just trying to learn."}, {"owner": {"reputation": 63, "user_id": 7432462, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9b3d9149601a512823ae7d3aa67f12ad?s=128&d=identicon&r=PG&f=1", "display_name": "Reniel Calzada", "link": "https://stackoverflow.com/users/7432462/reniel-calzada"}, "reply_to_user": {"reputation": 30540, "user_id": 719263, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7feab598abfc27783641fe2b796a0155?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Yun&#232;s", "link": "https://stackoverflow.com/users/719263/jean-baptiste-yun%c3%a8s"}, "edited": false, "score": 0, "creation_date": 1504105865, "post_id": 45963659, "comment_id": 78886825, "body": "@Jean-BaptisteYun&#232;s I want to be able to initialize using either object, but return the Daighter that corresponds to the file I&#39;m parsing. But be able to initialize an empty Mother too. Now that you guys are posting so many comments, it is starting to make itself a little bit more evident to me that proabably the parser should belong to the daughter. I don&#39;t know. I&#39;m a bit lost. One Mother class, 3 different text files that relate to the Mother. They all have different meanings. Thoughts?"}, {"owner": {"reputation": 30540, "user_id": 719263, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7feab598abfc27783641fe2b796a0155?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Yun&#232;s", "link": "https://stackoverflow.com/users/719263/jean-baptiste-yun%c3%a8s"}, "edited": false, "score": 0, "creation_date": 1504106024, "post_id": 45963659, "comment_id": 78886930, "body": "I think the problem is that your spec is not clear and we can&#39;t catch what you want. &quot;return the Daughter that corresponds to the file I&#39;m parsing. But be able to initialize an empty Mother too&quot; what does this means ?"}, {"owner": {"reputation": 63, "user_id": 7432462, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9b3d9149601a512823ae7d3aa67f12ad?s=128&d=identicon&r=PG&f=1", "display_name": "Reniel Calzada", "link": "https://stackoverflow.com/users/7432462/reniel-calzada"}, "reply_to_user": {"reputation": 30540, "user_id": 719263, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7feab598abfc27783641fe2b796a0155?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Yun&#232;s", "link": "https://stackoverflow.com/users/719263/jean-baptiste-yun%c3%a8s"}, "edited": false, "score": 1, "creation_date": 1504106123, "post_id": 45963659, "comment_id": 78886996, "body": "@Jean-BaptisteYun&#232;s It means that I don&#39;t know yet what I&#39;m doing. I will edit with a more specific question, but your comments are helping me see this more clearly."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1504106162, "post_id": 45963659, "comment_id": 78887031, "body": "&quot;this would be trivial for me in Python&quot; Show your Python implementation. It would be a lot more clear what you are actually trying to do."}], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 7432462, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9b3d9149601a512823ae7d3aa67f12ad?s=128&d=identicon&r=PG&f=1", "display_name": "Reniel Calzada", "link": "https://stackoverflow.com/users/7432462/reniel-calzada"}, "edited": false, "score": 0, "creation_date": 1504106134, "post_id": 45963971, "comment_id": 78887006, "body": "Yes, I think I am getting now closer to the actual problem. I will read this material."}, {"owner": {"reputation": 63, "user_id": 7432462, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9b3d9149601a512823ae7d3aa67f12ad?s=128&d=identicon&r=PG&f=1", "display_name": "Reniel Calzada", "link": "https://stackoverflow.com/users/7432462/reniel-calzada"}, "edited": false, "score": 0, "creation_date": 1504107470, "post_id": 45963971, "comment_id": 78887903, "body": "Accepted this answer because you were able to identify the main problem, and provide specific text book references that addresses directly the gaps in my knowledge. Definitely not an overkill, but a must read in my case. Thanks!!"}], "tags": [], "owner": {"reputation": 4625, "user_id": 1964969, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0879c1954a7ee8660f80eafdf9f66776?s=128&d=identicon&r=PG", "display_name": "Yury Schkatula", "link": "https://stackoverflow.com/users/1964969/yury-schkatula"}, "is_accepted": true, "score": 0, "last_activity_date": 1504105716, "creation_date": 1504105716, "answer_id": 45963971, "question_id": 45963659, "link": "https://stackoverflow.com/questions/45963659/newbie-to-c-trouble-setting-up-a-class-constructor-from-a-class-that-inherits/45963971#45963971", "title": "Newbie to C++: Trouble setting up a class constructor from a class that inherits from anothe class", "body": "<p>Your issue is not about C++ itself, it's about software architecture &amp; design. Could you try to extract \"parser\" functionality into separate class (let name it \"factory\"). Given that, you have someone who decides which instance could be created - Mother, Daughter, whatever. And you have a class hierarchy Mother-Daughter-etc which can share necessary common code and override some specific behaviors if needed.</p>\n\n<p>I understand this can be named \"overkill\" but I'd recommend you so called \"Gang of four\" book named Design patterns. Here it seems to be public version of the PDF:\n<a href=\"https://github.com/dieforfree/edsebooks/blob/master/ebooks/Design%20Patterns%2C%20Elements%20of%20Reusable%20Object-Oriented%20Software.pdf\" rel=\"nofollow noreferrer\">https://github.com/dieforfree/edsebooks/blob/master/ebooks/Design%20Patterns%2C%20Elements%20of%20Reusable%20Object-Oriented%20Software.pdf</a></p>\n"}], "owner": {"reputation": 63, "user_id": 7432462, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9b3d9149601a512823ae7d3aa67f12ad?s=128&d=identicon&r=PG&f=1", "display_name": "Reniel Calzada", "link": "https://stackoverflow.com/users/7432462/reniel-calzada"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 45963971, "answer_count": 1, "score": 0, "last_activity_date": 1504106386, "creation_date": 1504104848, "last_edit_date": 1504106386, "question_id": 45963659, "link": "https://stackoverflow.com/questions/45963659/newbie-to-c-trouble-setting-up-a-class-constructor-from-a-class-that-inherits", "title": "Newbie to C++: Trouble setting up a class constructor from a class that inherits from anothe class", "body": "<p>I'm trying to build a class that inherits from another class and initializes itself by parsing a text file. So I have:</p>\n\n<p>On my header file (both in same file):</p>\n\n<pre><code>class Mother{\n    public:\n        Mother();\n        Mother(std::string path);\n        int parse_textfile(std::string path);\n   protected:\n        std::string path;};\n\nclass Daughter : public Mother {\n    public:\n       Daughter();\n       Daughter(path);\n       Daughter(std::string TITLE);\n    protected:\n        std::string path\n        std::string TITLE\n</code></pre>\n\n<p>Now, on my cpp file:</p>\n\n<pre><code>Mother::Mother(){};\nMother::Mother(string path)\n:path(path)\n{\n    parse_textfile(path);\n};\n\nMother::parse_textfile(string path)\n{\n    cout &lt;&lt; \"Processing file: \" &lt;&lt; path &lt;&lt; endl;\n    ifstream file(path.c_str());\n    if (! file){\n        cerr &lt;&lt; \"unable to open input file: \" &lt;&lt; grid_path &lt;&lt; \" --bailing out! \\n\";\n    return -1;\n}else{\n    string TITLE;\n    getline(file, TITLE);\n    return Daughter(TITLE)\n</code></pre>\n\n<p>Now, I understand that this code is not correct (obviously, as it won't compile without errors), but I am still so raw with C++ that some expert advice would really come a long way at this point. </p>\n\n<p>The objective is to create a Daughter class that inherits the parsers, because the Daughter class itself should parse the textfile and hold all the variables in it. I will do line by line parsing because there is a lot of information in the text file. I just want this information to be held on the Daughter object so I can operate over this information later on. </p>\n\n<p>Also, I'm using C++ mainly because I don't want to share the source code. If there is a more appropriate language, I would also like to hear it from you. This would be trivial for me in Python, but again, I don't want to share what's happening.</p>\n\n<p><strong>EDIT 1:</strong></p>\n\n<p>Based on what I got from the comments, I can start seeing more clearly what the specific question should be.</p>\n\n<p>I have 3 text files that belong to the same problem, but each of this text files contain different information.</p>\n\n<p>What I want is to get recommendations on how to initialize each of this text files as individual objects that are derived from the same \"Mother class\". Maybe it makes more sense that the parser actually belongs to each of the Daughters instead of the Mother. Either way, for those whose comments have been geared towards actually answering the question and not asking me \"why I want to do this\", I appreciate your help and recommendations.</p>\n"}, {"tags": ["c++", "visual-studio-2012", "std"], "comments": [{"owner": {"reputation": 2374, "user_id": 8491726, "user_type": "registered", "profile_image": "https://graph.facebook.com/1550562035006492/picture?type=large", "display_name": "Artemy Vysotsky", "link": "https://stackoverflow.com/users/8491726/artemy-vysotsky"}, "edited": false, "score": 0, "creation_date": 1504105480, "post_id": 45963411, "comment_id": 78886523, "body": "So you print the internal representation of the date. What is your problem here?"}, {"owner": {"reputation": 65, "user_id": 2072837, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cebca911d9b1ba3268c1a62838562d8?s=128&d=identicon&r=PG", "display_name": "GreenEye", "link": "https://stackoverflow.com/users/2072837/greeneye"}, "reply_to_user": {"reputation": 2374, "user_id": 8491726, "user_type": "registered", "profile_image": "https://graph.facebook.com/1550562035006492/picture?type=large", "display_name": "Artemy Vysotsky", "link": "https://stackoverflow.com/users/8491726/artemy-vysotsky"}, "edited": false, "score": 0, "creation_date": 1504106755, "post_id": 45963411, "comment_id": 78887447, "body": "How do I get the actual date (actual month, day and year) using std::get_time?"}], "answers": [{"tags": [], "owner": {"reputation": 85822, "user_id": 597607, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jCzJi.png?s=128&g=1", "display_name": "Bo Persson", "link": "https://stackoverflow.com/users/597607/bo-persson"}, "is_accepted": true, "score": 1, "last_activity_date": 1504107652, "creation_date": 1504107652, "answer_id": 45964631, "question_id": 45963411, "link": "https://stackoverflow.com/questions/45963411/stdget-time-not-working-for-date-in-visual-studio-2012/45964631#45964631", "title": "std::get_time not working for date in visual studio 2012", "body": "<p>That's the way it works!</p>\n\n<p><code>struct tm</code> stores months as 0-11 but days as 1-31. And year is number of years since 1900.</p>\n\n<p><a href=\"http://en.cppreference.com/w/c/chrono/tm\" rel=\"nofollow noreferrer\">http://en.cppreference.com/w/c/chrono/tm</a></p>\n"}], "owner": {"reputation": 65, "user_id": 2072837, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cebca911d9b1ba3268c1a62838562d8?s=128&d=identicon&r=PG", "display_name": "GreenEye", "link": "https://stackoverflow.com/users/2072837/greeneye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 396, "favorite_count": 0, "accepted_answer_id": 45964631, "answer_count": 1, "score": 0, "last_activity_date": 1504107652, "creation_date": 1504104182, "question_id": 45963411, "link": "https://stackoverflow.com/questions/45963411/stdget-time-not-working-for-date-in-visual-studio-2012", "title": "std::get_time not working for date in visual studio 2012", "body": "<p>I am trying to parse a date and time string using std::get_time in visual studio 2012. The time string seems to parse correctly but not the date string. I want to eventually convert the date string to an integer for comparison. I am aware that I can manually parse it, but I was wondering whether I am missing something regarding the use of std::get_time. Here is a sample code with output.</p>\n\n<pre><code>struct std::tm time, date;\nstd::istringstream ss( \"09/02/2017 23:19:12\" );\nstd::string ss1, ss2;\nss &gt;&gt; ss1 &gt;&gt; ss2;\nstd::stringstream iss1( ss1 ), iss2( ss2 );\niss1 &gt;&gt; std::get_time( &amp;date, \"%m/%d/%Y\" );\niss2 &gt;&gt; std::get_time( &amp;time, \"%H:%M:%S\" );\nstd::cout &lt;&lt; date.tm_mon &lt;&lt; \"/\" &lt;&lt; date.tm_mday &lt;&lt; \"/\" &lt;&lt; date.tm_year &lt;&lt; \", \" &lt;&lt; time.tm_hour &lt;&lt; \":\" &lt;&lt; time.tm_min &lt;&lt; \":\" &lt;&lt; time.tm_sec &lt;&lt; \"\\n\";\n</code></pre>\n\n<p>The output I get is</p>\n\n<pre><code>8/2/117, 23:19:12\n</code></pre>\n"}, {"tags": ["c#", "c++", "interop", "screen-size", "setupapi"], "comments": [{"owner": {"reputation": 13016, "user_id": 8751754, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7k6Li.png?s=128&g=1", "display_name": "Ron", "link": "https://stackoverflow.com/users/8751754/ron"}, "edited": false, "score": 0, "creation_date": 1504104982, "post_id": 45963303, "comment_id": 78886083, "body": "You might want to take a look at <a href=\"https://stackoverflow.com/questions/577736/how-to-obtain-the-correct-physical-size-of-the-monitor\">this SO question</a>."}, {"owner": {"reputation": 870071, "user_id": 17034, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cii6b.png?s=128&g=1", "display_name": "Hans Passant", "link": "https://stackoverflow.com/users/17034/hans-passant"}, "edited": false, "score": 3, "creation_date": 1504105063, "post_id": 45963303, "comment_id": 78886164, "body": "You are wasting your time trying to make it work, the VESA industry group standard that governs the plug &amp; play protocol is universally implemented imperfectly.  Cut-throat competition in the market segment is the underlying reason.  It never actually matters, perceived DPI depends on how far the user sits away from the screen.  And the user modifies the setting only to keep the text in the windows comfortably readable.  Simply use a tweak config setting to allow the user to get it right."}, {"owner": {"reputation": 1896, "user_id": 3286975, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N9TO9.png?s=128&g=1", "display_name": "z3nth10n", "link": "https://stackoverflow.com/users/3286975/z3nth10n"}, "reply_to_user": {"reputation": 13016, "user_id": 8751754, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7k6Li.png?s=128&g=1", "display_name": "Ron", "link": "https://stackoverflow.com/users/8751754/ron"}, "edited": false, "score": 0, "creation_date": 1504105126, "post_id": 45963303, "comment_id": 78886219, "body": "There is where I get the last code I posted, but there isn&#39;t any code in C#... I don&#39;t know excactly how can I use it in WinForms. Thanks anyway @Ron"}, {"owner": {"reputation": 1896, "user_id": 3286975, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N9TO9.png?s=128&g=1", "display_name": "z3nth10n", "link": "https://stackoverflow.com/users/3286975/z3nth10n"}, "reply_to_user": {"reputation": 870071, "user_id": 17034, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cii6b.png?s=128&g=1", "display_name": "Hans Passant", "link": "https://stackoverflow.com/users/17034/hans-passant"}, "edited": false, "score": 0, "creation_date": 1504105212, "post_id": 45963303, "comment_id": 78886293, "body": "Thanks @HansPassant, so there isn&#39;t a way to meause it?? Although, this is not exactly?"}], "owner": {"reputation": 1896, "user_id": 3286975, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N9TO9.png?s=128&g=1", "display_name": "z3nth10n", "link": "https://stackoverflow.com/users/3286975/z3nth10n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 282, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1504105941, "creation_date": 1504103910, "last_edit_date": 1504105941, "question_id": 45963303, "link": "https://stackoverflow.com/questions/45963303/implementing-setupapi-in-c-winforms-to-read-physical-screen-size", "title": "Implementing SetupAPI in C# (WinForms) to read physical screen size", "body": "<p>I'm trying to read the physical size of my two monitor, for learning purpouses...</p>\n\n<p>I'm doing this because I need to know exactly the distance that the mouse travels along the screen (in centimeters).</p>\n\n<p>I have tried the option of the DPI, but scren always returns 96 DPI (if the scale is 100%, <a href=\"https://stackoverflow.com/a/5977638/3286975\">I had read the following</a>)</p>\n\n<p>But this is not real, because of this:</p>\n\n<p>My first monitor has:</p>\n\n<p><a href=\"https://i.stack.imgur.com/jt37y.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/jt37y.jpg\" alt=\"93 DPI\"></a></p>\n\n<p>By dividing, 600 px / 6,417323 inches we get = 93,4 ... dpi</p>\n\n<p>Aprox, 93,4 DPI.</p>\n\n<p>And my second monitor:</p>\n\n<p><a href=\"https://i.stack.imgur.com/LfJEj.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/LfJEj.jpg\" alt=\"84,6 DPI\"></a> </p>\n\n<p>84,6 DPI, 12 less units than the average monitor, I suppose.</p>\n\n<p>So, we can't take this, because this is very unnacurate. And I want to be precise.</p>\n\n<hr>\n\n<p>I tried by getting the real centimeters (<a href=\"https://stackoverflow.com/a/3022820/3286975\">reading this</a>) and using <a href=\"http://www.pinvoke.net/default.aspx/gdi32.getdevicecaps\" rel=\"nofollow noreferrer\">PInvoke for Interop calls</a>.</p>\n\n<p>But as @Andreas Rejbrand has said, this returns a big value (1600 x 900 mm, a screen of 1,6 meters by 90 centimeters, that's not logic, my biggest screen has 52 centimeters by 29 centimeters, dividing 1600/900 returns almost the same as 52 by 30, that is 1,7777 but is this useful for me???)</p>\n\n<p><strong>PD:</strong> Asking to the user is not an option because they can lie to me, I don't was such things.</p>\n\n<hr>\n\n<p>Another option was searching in the WinAPI for solutions, and I had found the following: (I think I will be downvoted for this xD, but I want to explain eveything I done)</p>\n\n<p>Under the last answer I shared I found the following:</p>\n\n<p><a href=\"https://stackoverflow.com/a/3858175/3286975\">https://stackoverflow.com/a/3858175/3286975</a></p>\n\n<p>This is edited by someone, I click the revisions and the user shared the following:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/577736/how-to-obtain-the-correct-physical-size-of-the-monitor\">How to obtain the correct physical size of the monitor?</a></p>\n\n<p>In a comment we can see the following link:</p>\n\n<p><a href=\"https://ofekshilon.com/2014/06/19/reading-specific-monitor-dimensions/\" rel=\"nofollow noreferrer\">https://ofekshilon.com/2014/06/19/reading-specific-monitor-dimensions/</a></p>\n\n<p>Well, we can find the following code:</p>\n\n<pre><code>#include &lt;atlstr.h&gt;\n#include &lt;SetupApi.h&gt;\n#pragma comment(lib, \"setupapi.lib\")\n\n#define NAME_SIZE 128\n\nconst GUID GUID_CLASS_MONITOR = {0x4d36e96e, 0xe325, 0x11ce, 0xbf, 0xc1, 0x08, 0x00, 0x2b, 0xe1, 0x03, 0x18};\n\n// Assumes hDevRegKey is valid\nbool GetMonitorSizeFromEDID(const HKEY hDevRegKey, short&amp; WidthMm, short&amp; HeightMm)\n{\n    DWORD dwType, AcutalValueNameLength = NAME_SIZE;\n    TCHAR valueName[NAME_SIZE];\n\n    BYTE EDIDdata[1024];\n    DWORD edidsize=sizeof(EDIDdata);\n\n    for (LONG i = 0, retValue = ERROR_SUCCESS; retValue != ERROR_NO_MORE_ITEMS; ++i)\n    {\n        retValue = RegEnumValue ( hDevRegKey, i, &amp;valueName[0],\n            &amp;AcutalValueNameLength, NULL, &amp;dwType,\n            EDIDdata, // buffer\n            &amp;edidsize); // buffer size\n\n        if (retValue != ERROR_SUCCESS || 0 != _tcscmp(valueName,_T(\"EDID\")))\n            continue;\n\n        WidthMm  = ((EDIDdata[68] &amp; 0xF0) &lt;&lt; 4) + EDIDdata[66];\n        HeightMm = ((EDIDdata[68] &amp; 0x0F) &lt;&lt; 8) + EDIDdata[67];       return true; // valid EDID found    }   return false; // EDID not found } bool GetSizeForDevID(const CString&amp; TargetDevID, short&amp; WidthMm, short&amp; HeightMm) {   HDEVINFO devInfo = SetupDiGetClassDevsEx(       &amp;GUID_CLASS_MONITOR, //class GUID       NULL, //enumerator      NULL, //HWND        DIGCF_PRESENT, // Flags //DIGCF_ALLCLASSES|         NULL, // device info, create a new one.         NULL, // machine name, local machine        NULL);// reserved   if (NULL == devInfo)        return false;   bool bRes = false;  for (ULONG i=0; ERROR_NO_MORE_ITEMS != GetLastError(); ++i)     {       SP_DEVINFO_DATA devInfoData;        memset(&amp;devInfoData,0,sizeof(devInfoData));         devInfoData.cbSize = sizeof(devInfoData);       if (SetupDiEnumDeviceInfo(devInfo,i,&amp;devInfoData))      {           HKEY hDevRegKey = SetupDiOpenDevRegKey(devInfo,&amp;devInfoData,                DICS_FLAG_GLOBAL, 0, DIREG_DEV, KEY_READ);          if(!hDevRegKey || (hDevRegKey == INVALID_HANDLE_VALUE))                 continue;           bRes = GetMonitorSizeFromEDID(hDevRegKey, WidthMm, HeightMm);           RegCloseKey(hDevRegKey);        }   }   SetupDiDestroyDeviceInfoList(devInfo);  return bRes; } int _tmain(int argc, _TCHAR* argv[]) {   short WidthMm, HeightMm;    DISPLAY_DEVICE dd;  dd.cb = sizeof(dd);     DWORD dev = 0; // device index  int id = 1; // monitor number, as used by Display Properties &gt; Settings\n\n    CString DeviceID;\n    bool bFoundDevice = false;\n    while (EnumDisplayDevices(0, dev, &amp;dd, 0) &amp;&amp; !bFoundDevice)\n    {\n        DISPLAY_DEVICE ddMon;\n        ZeroMemory(&amp;ddMon, sizeof(ddMon));\n        ddMon.cb = sizeof(ddMon);\n        DWORD devMon = 0;\n\n        while (EnumDisplayDevices(dd.DeviceName, devMon, &amp;ddMon, 0) &amp;&amp; !bFoundDevice)\n        {\n            if (ddMon.StateFlags &amp; DISPLAY_DEVICE_ACTIVE &amp;&amp;\n                !(ddMon.StateFlags &amp; DISPLAY_DEVICE_MIRRORING_DRIVER))\n            {\n                DeviceID.Format (L\"%s\", ddMon.DeviceID);\n                DeviceID = DeviceID.Mid (8, DeviceID.Find (L\"\\\\\", 9) - 8);\n\n                bFoundDevice = GetSizeForDevID(DeviceID, WidthMm, HeightMm);\n            }\n            devMon++;\n\n            ZeroMemory(&amp;ddMon, sizeof(ddMon));\n            ddMon.cb = sizeof(ddMon);\n        }\n\n        ZeroMemory(&amp;dd, sizeof(dd));\n        dd.cb = sizeof(dd);\n        dev++;\n    }\n\n    return 0;\n}\n</code></pre>\n\n<p>I have been searching in PInvoke <a href=\"http://www.pinvoke.net/default.aspx/setupapi.CM_Get_Device_ID\" rel=\"nofollow noreferrer\">this</a>, and examples, but I'm very lost, because I don't know if we can translate it all to C#, or is only a C++ example that can't be translated. I suppose that it can be translated, but I don't know how, I'm very newbie at interoperability calls.</p>\n\n<p><strong>PD:</strong> I have found this: <a href=\"http://www.programering.com/a/MDO2YjMwATc.html\" rel=\"nofollow noreferrer\">http://www.programering.com/a/MDO2YjMwATc.html</a> but I don't know yet which methods I have to use for translating the code into C# and the parameters I have to pass.</p>\n\n<p>So, if any one can teach me how to figure this out, If you want to give some codes for me, that's good, but I think that good explanation is enough. i don't know.</p>\n\n<p>And if there are better options to do this, please, tell me.</p>\n\n<p>Because, my final solution will be applying this (centimeters of screen) to this: <a href=\"https://stackoverflow.com/a/422333/3286975\">https://stackoverflow.com/a/422333/3286975</a></p>\n\n<p>Also, I'm seeing that DPI are different from PPI, I'm maybe I'm searching for PPI.</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["c++", "user-interface", "opencv", "directx"], "comments": [{"owner": {"reputation": 5482, "user_id": 2286337, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/A8dkr.jpg?s=128&g=1", "display_name": "zindarod", "link": "https://stackoverflow.com/users/2286337/zindarod"}, "edited": false, "score": 0, "creation_date": 1504104162, "post_id": 45963295, "comment_id": 78885451, "body": "I did something similar with opengl and opencl."}, {"owner": {"reputation": 2565, "user_id": 4781312, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/lDEcJ.jpg?s=128&g=1", "display_name": "Asesh", "link": "https://stackoverflow.com/users/4781312/asesh"}, "edited": false, "score": 0, "creation_date": 1504104514, "post_id": 45963295, "comment_id": 78885716, "body": "Is it a 2D or 3D path tracer?"}], "answers": [{"tags": [], "owner": {"reputation": 675, "user_id": 2117206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f3b482bcd51d998a2f3953df280de9fd?s=128&d=identicon&r=PG", "display_name": "wiped", "link": "https://stackoverflow.com/users/2117206/wiped"}, "is_accepted": false, "score": 1, "last_activity_date": 1504169692, "creation_date": 1504169692, "answer_id": 45977314, "question_id": 45963295, "link": "https://stackoverflow.com/questions/45963295/c-display-continuously-updating-image/45977314#45977314", "title": "C++ - Display continuously updating image", "body": "<p>If I understand correctly your path tracer probably outputs a color per emitted ray? If that is the case, and you are thinking about displaying the rendered image in a separate window I'd suggest using <a href=\"https://www.libsdl.org/\" rel=\"nofollow noreferrer\">SDL2</a>. There's a great set of tutorials concerning real-time graphics using C++ and SDL by <a href=\"http://lazyfoo.net/tutorials/SDL/index.php#Hello%20SDL\" rel=\"nofollow noreferrer\">Lazy Foo' Productions</a>.</p>\n\n<p>Excerpt taken from official SDL <a href=\"http://wiki.libsdl.org/\" rel=\"nofollow noreferrer\">documentation</a> (without cruft needed to initialize windows) regarding SDL_Surface, which you will probably be using:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>/* This is meant to show how to edit a surface's pixels on the CPU, but\n   normally you should use SDL_FillRect() to wipe a surface's contents. */\nvoid WipeSurface(SDL_Surface *surface)\n{\n    /* This is fast for surfaces that don't require locking. */\n    /* Once locked, surface-&gt;pixels is safe to access. */\n    SDL_LockSurface(surface);\n\n    /* This assumes that color value zero is black. Use\n       SDL_MapRGBA() for more robust surface color mapping! */\n    /* height times pitch is the size of the surface's whole buffer. */\n    SDL_memset(surface-&gt;pixels, 0, surface-&gt;h * surface-&gt;pitch);\n\n    SDL_UnlockSurface(surface);\n}\n</code></pre>\n"}], "owner": {"reputation": 3971, "user_id": 2921343, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/e5a6a90bd1c391e3f7aa638134a14481?s=128&d=identicon&r=PG&f=1", "display_name": "Eutherpy", "link": "https://stackoverflow.com/users/2921343/eutherpy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1504169692, "creation_date": 1504103882, "question_id": 45963295, "link": "https://stackoverflow.com/questions/45963295/c-display-continuously-updating-image", "title": "C++ - Display continuously updating image", "body": "<p>I have written a pathtracer in C++, and now I want to display the rendering process in real time, so I'm wondering what the simplest/best way to do this is.</p>\n\n<p>Basically, the rendered image updates after every iteration, so I just need to retrieve it, display it in a separate window, and update it.</p>\n\n<p>I was thinking about using DirectX, and it seems that I could probably also do it with OpenCV, but I'm just looking for a simple way which doesn't require adding a lot of new code. </p>\n\n<p>I am using C++ on Windows. </p>\n"}, {"tags": ["c++", "pointers", "member", "ode", "odeint"], "comments": [{"owner": {"reputation": 383, "user_id": 1185047, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e821d8cbc7384947c8371742fedc4f7c?s=128&d=identicon&r=PG", "display_name": "rbelli", "link": "https://stackoverflow.com/users/1185047/rbelli"}, "edited": false, "score": 0, "creation_date": 1504106041, "post_id": 45963278, "comment_id": 78886939, "body": "Instead of this-&gt;*solve (as explained bellow by tobi303) you can use boost::bind(this, &amp;calc::solveO, _1, _2, _3), or you can use a lambda function like [this](const vector_type &amp;y , vector_type &amp;ODE , const double t){this-&gt;solveO(y, ODE, t);} as the  integrate_const accept functors."}], "answers": [{"comments": [{"owner": {"reputation": 587, "user_id": 5489190, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tjkTd.png?s=128&g=1", "display_name": "Karls", "link": "https://stackoverflow.com/users/5489190/karls"}, "edited": false, "score": 0, "creation_date": 1504109427, "post_id": 45963358, "comment_id": 78889161, "body": "It explains a bit, but still doesn&#39;t point the correct call. I&#39;m not very experienced in c++. I tried solutions suggested by @rbelli:  1.boost::bind fails: <code>&quot;&#39;bind&#39; is not a member of &#39;boost&#39;&quot;</code>  2. Seems to interferes with integrate_const: <code>&quot;must use &#39;.*&#39; or &#39;-&gt;*&#39; to call pointer-to-member function&quot;</code>"}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "reply_to_user": {"reputation": 587, "user_id": 5489190, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tjkTd.png?s=128&g=1", "display_name": "Karls", "link": "https://stackoverflow.com/users/5489190/karls"}, "edited": false, "score": 0, "creation_date": 1504109784, "post_id": 45963358, "comment_id": 78889388, "body": "@Karls hope this wont sound rude: experienced or not, you need to rtfm. I tried to look up what parameters <code>integreate_const</code> takes, but it is heavily templated, so I would also have to read their manual to know what can be passed. If you are lucky you can pass a functor or lambda. In any case I would stay away from <code>bind</code>, but thats just my personal preference"}, {"owner": {"reputation": 587, "user_id": 5489190, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tjkTd.png?s=128&g=1", "display_name": "Karls", "link": "https://stackoverflow.com/users/5489190/karls"}, "edited": false, "score": 0, "creation_date": 1504110487, "post_id": 45963358, "comment_id": 78889848, "body": "it&#39;s not about wrong parameters, so you hurried a little wit rtfm. I know how to execute integreate_const. Look here (last answer): <a href=\"https://stackoverflow.com/questions/26747492/comparison-of-odeints-runge-kutta4-with-matlabs-ode45\" title=\"comparison of odeints runge kutta4 with matlabs ode45\">stackoverflow.com/questions/26747492/&hellip;</a> If I code all one file like in this example, it works. The problems start when I use a class as I presented in OP. And  for some reasons I need it in this form, as it will be part of bigger program. Do you understand now where is the real problem?"}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "reply_to_user": {"reputation": 587, "user_id": 5489190, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tjkTd.png?s=128&g=1", "display_name": "Karls", "link": "https://stackoverflow.com/users/5489190/karls"}, "edited": false, "score": 0, "creation_date": 1504110739, "post_id": 45963358, "comment_id": 78890013, "body": "@Karls if it is not about parameters then what is it about? You definitely cannot pass a member function pointer without also passing an instance. I dont know what parameters you can pass to <code>integrate_const</code>, otherwise I could tell you how to solve it. Btw dont try to be javaish. Not everything has to be in a class, just because classes are cool...."}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "reply_to_user": {"reputation": 587, "user_id": 5489190, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tjkTd.png?s=128&g=1", "display_name": "Karls", "link": "https://stackoverflow.com/users/5489190/karls"}, "edited": false, "score": 0, "creation_date": 1504110782, "post_id": 45963358, "comment_id": 78890039, "body": "@Karls  ...Anyhow there is no good reason why the function you pass must be a member function. You dont even use any members of the class."}, {"owner": {"reputation": 587, "user_id": 5489190, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tjkTd.png?s=128&g=1", "display_name": "Karls", "link": "https://stackoverflow.com/users/5489190/karls"}, "edited": false, "score": 0, "creation_date": 1504112700, "post_id": 45963358, "comment_id": 78891040, "body": "I tried to use it as free function (basing on your edited answer). And it still fails somwhere: call: <code>integrate_const(make_dense_output&lt;stepper_type&gt;( 1E-12, 1E-6 ), solveO, y, 0.0, 1.0, dt , printR)</code> ends again with <code>must use &#39;.*&#39; or &#39;-&gt;*&#39; to call pointer-to-member function</code>"}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "reply_to_user": {"reputation": 587, "user_id": 5489190, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tjkTd.png?s=128&g=1", "display_name": "Karls", "link": "https://stackoverflow.com/users/5489190/karls"}, "edited": false, "score": 0, "creation_date": 1504113290, "post_id": 45963358, "comment_id": 78891357, "body": "@Karls <code>printR</code> is a member function, and the same is true for that aswell: No reason to make it member of a class, it uses parameters passed to it and nothing else"}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "reply_to_user": {"reputation": 587, "user_id": 5489190, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tjkTd.png?s=128&g=1", "display_name": "Karls", "link": "https://stackoverflow.com/users/5489190/karls"}, "edited": false, "score": 0, "creation_date": 1504113476, "post_id": 45963358, "comment_id": 78891464, "body": "@Karls there is no advantage of a function being a member function as opposed to being a free function. In fact the lesser member function a class has the better it is. You can be happy for every function that does not need to be member of a class, because it makes your code simpler"}], "tags": [], "owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "is_accepted": true, "score": 1, "last_activity_date": 1504110881, "last_edit_date": 1504110881, "creation_date": 1504104034, "answer_id": 45963358, "question_id": 45963278, "link": "https://stackoverflow.com/questions/45963278/calling-ode-solver-odeint-within-c-class/45963358#45963358", "title": "Calling ODE solver (odeint) within c++ class", "body": "<p>If <code>integrate_const</code> takes a function pointer you cannot pass a member function pointer. Member function pointers are different from function pointers, because they implicitly need <code>this</code> as argument.</p>\n\n<p>As you dont use any members of the class inside <code>solveO</code> you can simply make it a free function:</p>\n\n<pre><code>void solveO( const vector_type &amp;y , vector_type &amp;ODE , const double t )\n{\n    dy[0] =  y[1];\n    dy[1] = -y[0] - g*y[1];\n}\n</code></pre>\n"}], "owner": {"reputation": 587, "user_id": 5489190, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tjkTd.png?s=128&g=1", "display_name": "Karls", "link": "https://stackoverflow.com/users/5489190/karls"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 482, "favorite_count": 0, "accepted_answer_id": 45963358, "answer_count": 1, "score": 1, "last_activity_date": 1504113800, "creation_date": 1504103806, "last_edit_date": 1504113800, "question_id": 45963278, "link": "https://stackoverflow.com/questions/45963278/calling-ode-solver-odeint-within-c-class", "title": "Calling ODE solver (odeint) within c++ class", "body": "<p>I need to solve ODE equations set with odeint library. \"main.cpp\" file is only to call calculation (it will be extended later, here simple version to keep code clean)</p>\n\n<p><code>main.cpp</code></p>\n\n<pre><code>#include \"calc.h\"\n\nint main()\n{\n    calc c;\n    c.startC();\n    return 0;\n}\n</code></pre>\n\n<p>Here is the calc header, starC(); is set public.\n<code>calc.h</code></p>\n\n<pre><code>#ifndef MAIN_H\n#define MAIN_H\n\n#include &lt;iostream&gt;\n#include &lt;boost/numeric/odeint.hpp&gt;\n#include &lt;math.h&gt;\n\nusing namespace std;\nusing namespace boost::numeric::odeint;\n\ntypedef std::vector&lt; double &gt; vector_type;\n\nclass calc\n{\npublic:\n    int main();\n    void startC();\nprivate:\n    void solveODE(const vector_type &amp;y , vector_type &amp;ODE , const double t );\n    void printR();\n\n};\n\n#endif // MAIN_H\n</code></pre>\n\n<p>Here is the main calculation part. Also here the error occurs:\n<code>calc.cpp</code></p>\n\n<pre><code>include &lt;iostream&gt;\n\n#include &lt;boost/numeric/odeint.hpp&gt;\n#include &lt;math.h&gt;\n\n#include \"calc.h\"\n\nusing namespace std;\nusing namespace boost::numeric::odeint;\n\nconst double g = 0.15;\n\n\nvoid calc::solveO( const vector_type &amp;y , vector_type &amp;ODE , const double t )\n{\n    dy[0] =  y[1];\n    dy[1] = -y[0] - g*y[1];\n}\n\nvoid calc::printR(const vector_type &amp;y, const double t)\n{\n    cout &lt;&lt; t &lt;&lt; endl;\n    cout &lt;&lt; y[0] &lt;&lt; endl;\n}\n\nvoid calc::startC()\n{\n    const double dt = 0.1;\n    typedef runge_kutta_dopri5&lt;vector_type&gt; stepper_type;\n    vector_type y(2);\n    //Initial conditins\n    y[0]=   1.0;\n    y[1]=   0.0;\n\n\n    //Initializing of ODE solver\n    integrate_const(make_dense_output&lt;stepper_type&gt;( 1E-12, 1E-6 ), \n                    this-&gt;*solveO, y, 0.0, 1.0, dt , printResults); //ERROR HERE\n}\n\nint calc::main()\n{\n    return 0;\n}\n</code></pre>\n\n<p>This operation ends with error on the level of \"Initializing of ODE solver\" with:</p>\n\n<pre><code>'((calc*)this)-&gt;calc::solveO' cannot be used as a member pointer,\nsince it is of type '&lt;unresolved overloaded function type&gt;'\n</code></pre>\n\n<p>What's wrong with this call:</p>\n\n<pre><code>this-&gt;*solveO\n</code></pre>\n\n<p>And what's the correct way to call solveO inside \"integrate_const\"?</p>\n\n<p><strong>Edit:</strong>\nThanks to the help of @tobi303 and @rbelli it now works. Here I post sum-up, TL:DR explanation:</p>\n\n<p>The easiest solution is to make solveO and printR free function and call:</p>\n\n<pre><code>integrate_const(make_dense_output&lt;stepper_type&gt;( 1E-12, 1E-6 ), solveO, y, 0.0, 1.0, dt , printR);\n</code></pre>\n"}, {"tags": ["c++", "recursion", "random"], "comments": [{"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 5, "creation_date": 1504103489, "post_id": 45963141, "comment_id": 78884937, "body": "Do you have to write a recursive function?  If not there is <a href=\"http://en.cppreference.com/w/cpp/algorithm/random_shuffle\" rel=\"nofollow noreferrer\"><code>std::shuffle</code></a>"}, {"owner": {"reputation": 820, "user_id": 4266707, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh4.googleusercontent.com/-fLyyGXepW68/AAAAAAAAAAI/AAAAAAAAABI/RjSsIhv1dvs/photo.jpg?sz=128", "display_name": "Javia1492", "link": "https://stackoverflow.com/users/4266707/javia1492"}, "edited": false, "score": 0, "creation_date": 1504103585, "post_id": 45963141, "comment_id": 78885023, "body": "Why not make <code>prev</code> an <code>std::array</code> and pass that in? Then you just check the array and ignore duplicates?"}, {"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 0, "creation_date": 1504103733, "post_id": 45963141, "comment_id": 78885135, "body": "Seed only once."}, {"owner": {"reputation": 15, "user_id": 6512125, "user_type": "registered", "profile_image": "https://graph.facebook.com/637173876441236/picture?type=large", "display_name": "Umair Zia", "link": "https://stackoverflow.com/users/6512125/umair-zia"}, "edited": false, "score": 0, "creation_date": 1504104090, "post_id": 45963141, "comment_id": 78885410, "body": "I am not allowed to use anything beyond loops and if statements. No arrays allowed. Nested loops are allowed."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2672107"}, "edited": false, "score": 0, "creation_date": 1504104235, "post_id": 45963141, "comment_id": 78885503, "body": "srand should only be called once in a program. rand (and srand) are deprecated."}, {"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 0, "creation_date": 1504105010, "post_id": 45963141, "comment_id": 78886107, "body": "If your limit is number 6, you may still transform the array into 7 variables :-/"}, {"owner": {"reputation": 30540, "user_id": 719263, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7feab598abfc27783641fe2b796a0155?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Yun&#232;s", "link": "https://stackoverflow.com/users/719263/jean-baptiste-yun%c3%a8s"}, "edited": false, "score": 0, "creation_date": 1504105829, "post_id": 45963141, "comment_id": 78886794, "body": "I think you have problems with recursion (prev is not shared among recursive calls). Whatever have a look at the simple Fisher-Yates algorithm: <a href=\"https://en.wikipedia.org/wiki/Fisher-Yates_shuffle\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Fisher-Yates_shuffle</a>"}, {"owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "edited": false, "score": 0, "creation_date": 1504119595, "post_id": 45963141, "comment_id": 78894883, "body": "just research any shuffling algorithms and read about their pros/cons - almost all published works include code examples in various languages"}], "answers": [{"tags": [], "owner": {"reputation": 736, "user_id": 5441932, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4acbacc09001d66b0fd772f7d3426617?s=128&d=identicon&r=PG", "display_name": "konsolas", "link": "https://stackoverflow.com/users/5441932/konsolas"}, "is_accepted": false, "score": 1, "last_activity_date": 1504125219, "last_edit_date": 1504125219, "creation_date": 1504124668, "answer_id": 45969112, "question_id": 45963141, "link": "https://stackoverflow.com/questions/45963141/how-to-write-a-recursive-function-that-jumbles-up-numbers-from-0-to-6-in-a-rando/45969112#45969112", "title": "How to write a recursive function that jumbles up numbers from 0 to 6 in a random manner?", "body": "<p>From the comments, this sounds more like a homework problem than a practical problem because you said \"No arrays allowed\". But I suppose it is an interesting problem.</p>\n\n<p>Here's some code, in Java with only loops, if statements, and with no arrays, as required.</p>\n\n<p>It outputs a random permutation of the set 0, 1, ..., N, shuffled with the <a href=\"https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle\" rel=\"nofollow noreferrer\">Fisher-Yates algorithm</a>.</p>\n\n<pre><code>    void printRandom(int N) {\n        long used = 0;\n\n        for (int i = 0; i &lt; N; i++) {\n            int randomIndex = ThreadLocalRandom.current().nextInt(N - Long.bitCount(used));\n            for (int j = 0; j &lt; N; j++) {\n                if ((used &amp; (1L &lt;&lt; j)) == 0) {\n                    if (randomIndex-- == 0) {\n                        System.out.print(j + \" \");\n                        used = used | (1L &lt;&lt; j);\n                        break;\n                    }\n                }\n            }\n        }\n    }\n</code></pre>\n\n<p>It is unfortunately limited to the size of a long on your system :)</p>\n"}, {"tags": [], "owner": {"reputation": 27, "user_id": 8433957, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5245f28831d017e91eec8f4dc575f820?s=128&d=identicon&r=PG&f=1", "display_name": "Alejandro Trigo Ros&#243;n", "link": "https://stackoverflow.com/users/8433957/alejandro-trigo-ros%c3%b3n"}, "is_accepted": false, "score": 0, "last_activity_date": 1504162683, "creation_date": 1504162683, "answer_id": 45975136, "question_id": 45963141, "link": "https://stackoverflow.com/questions/45963141/how-to-write-a-recursive-function-that-jumbles-up-numbers-from-0-to-6-in-a-rando/45975136#45975136", "title": "How to write a recursive function that jumbles up numbers from 0 to 6 in a random manner?", "body": "<p>I think the best way to solve this problem is by using an aux funtion that stores in a variable all the numbers printed until the moment, check if the new number is in the used numbers variable, if not add it to the variable (you can use strings? I know that they are arrays of char's but maybe you can)\nSomething like this:</p>\n\n<pre><code>function aux(int b, char *variables_printed, int iterations_left)\n  if (b = 0) then print variables_printed\n  else\n   int n = generate_random_number() %b\n   while (n in variables_printed)\n     n= (n+random_number) % b\n   variables_printed += n\n   aux(b, variables_printed, iterations_left-1)\n</code></pre>\n\n<p>And your other function:</p>\n\n<pre><code>function s(b)\n  if b &lt; 0 return 0\n  else \n    char *variables_to_print\n    aux(b, variables_to_print, b)\n</code></pre>\n\n<p>If you can not use strings, you can do it with long as konsolas said.</p>\n"}], "owner": {"reputation": 15, "user_id": 6512125, "user_type": "registered", "profile_image": "https://graph.facebook.com/637173876441236/picture?type=large", "display_name": "Umair Zia", "link": "https://stackoverflow.com/users/6512125/umair-zia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 204, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1504162683, "creation_date": 1504103402, "question_id": 45963141, "link": "https://stackoverflow.com/questions/45963141/how-to-write-a-recursive-function-that-jumbles-up-numbers-from-0-to-6-in-a-rando", "title": "How to write a recursive function that jumbles up numbers from 0 to 6 in a random manner?", "body": "<p>Basically i want to write a function that takes values from 0 to 6 and gives back a random assortment such as 2,3,4,5,0,1,6. Here is the code that i came up with. However the problem is that the integer prev (meaning previous) does not store all the old values of r (random number) and thus some values end up being repeated. How might i fix this?</p>\n\n<pre><code>int s(int b)\n    {\n        // b is 7\n        int h = b-1;\n        int prev = -1;// to store the previous r value\n        srand(time(0));\n        for (int i = 0; i &lt; b; i++)\n        {\n            int r = rand()%(h - 0 + 1) + 0;\n            if (r != prev)\n            {\n             cout &lt;&lt; r &lt;&lt; endl;\n             prev = r;\n            }\n            else if (r == prev)\n            {\n                s(b);\n            }\n        }\n\n        return 0;\n    }\n</code></pre>\n"}, {"tags": ["java", "android", "c++", "protocol-buffers"], "comments": [{"owner": {"reputation": 478, "user_id": 1725816, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0e46d33a24749378a59c25348e8bc435?s=128&d=identicon&r=PG", "display_name": "Kevin", "link": "https://stackoverflow.com/users/1725816/kevin"}, "edited": false, "score": 0, "creation_date": 1504104086, "post_id": 45963005, "comment_id": 78885406, "body": "Sorry if I&#39;m missing something, but why would you think GPB might be able to parse video streams? It&#39;s a serialization mechanism - I assume you could wrap the raw bytes in a GPB message but that seems inefficient."}, {"owner": {"reputation": 1, "user_id": 8538388, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d36ee74b3641f297ebf4fb4e3aea82a?s=128&d=identicon&r=PG&f=1", "display_name": "alless", "link": "https://stackoverflow.com/users/8538388/alless"}, "reply_to_user": {"reputation": 478, "user_id": 1725816, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0e46d33a24749378a59c25348e8bc435?s=128&d=identicon&r=PG", "display_name": "Kevin", "link": "https://stackoverflow.com/users/1725816/kevin"}, "edited": false, "score": 0, "creation_date": 1504192505, "post_id": 45963005, "comment_id": 78929507, "body": "Thank you for your answer, but I have little experience and I am not sure. Now use netty+GBP communications server, if you want to transport video stream, how should I do?"}], "owner": {"reputation": 1, "user_id": 8538388, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d36ee74b3641f297ebf4fb4e3aea82a?s=128&d=identicon&r=PG&f=1", "display_name": "alless", "link": "https://stackoverflow.com/users/8538388/alless"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 491, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1504104210, "creation_date": 1504103022, "last_edit_date": 1504104210, "question_id": 45963005, "link": "https://stackoverflow.com/questions/45963005/can-google-protobuf-parse-video-streams", "title": "Can Google protobuf parse video streams?", "body": "<p>Excuse me, can Google protobuf be used to parse video streams?\nThe client is Android, and the server is C++, using netty+protobuf communications, server connection monitors, and now want to get video streams from the server.I'm not sure it will work\u3002</p>\n"}, {"tags": ["c++", "memory-leaks"], "comments": [{"owner": {"reputation": 8847, "user_id": 3484570, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/r5BRZ.png?s=128&g=1", "display_name": "nwp", "link": "https://stackoverflow.com/users/3484570/nwp"}, "edited": false, "score": 2, "creation_date": 1504103105, "post_id": 45962989, "comment_id": 78884633, "body": "The OS/runtime you are running on is smart enough to notice that you never actually use the memory you allocate. It will just mark the memory as &quot;reserved&quot; for you but not actually give it to you until you use it. Try writing some data into the allocated memory and see it change."}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 4, "creation_date": 1504103140, "post_id": 45962989, "comment_id": 78884681, "body": "having a <code>new</code> without a matching <code>delete</code> is a memory leak, full stop."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 3, "creation_date": 1504103270, "post_id": 45962989, "comment_id": 78884782, "body": "This is an infinite loop with no observable side effect. This is undefined behavior."}, {"owner": {"reputation": 34185, "user_id": 5470596, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BITFt.jpg?s=128&g=1", "display_name": "YSC", "link": "https://stackoverflow.com/users/5470596/ysc"}, "edited": false, "score": 1, "creation_date": 1504103940, "post_id": 45962989, "comment_id": 78885299, "body": "Use some code analysis tool like valgrind&#39;s memcheck."}, {"owner": {"reputation": 55, "user_id": 3668305, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/e818a887e7ac1981c0745f9a7ff4f4de?s=128&d=identicon&r=PG&f=1", "display_name": "wang", "link": "https://stackoverflow.com/users/3668305/wang"}, "reply_to_user": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1504108176, "post_id": 45962989, "comment_id": 78888355, "body": "@NathanOliver what do you mean &#39;full stop&#39;"}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1504114021, "post_id": 45962989, "comment_id": 78891786, "body": "@wang No need to go any further.  As soon as you don&#39;t have a match you have a leak."}], "answers": [{"tags": [], "owner": {"reputation": 3760, "user_id": 6594576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/448660dad9fcb2bf8b5f7a3ab8813037?s=128&d=identicon&r=PG", "display_name": "Paul Floyd", "link": "https://stackoverflow.com/users/6594576/paul-floyd"}, "is_accepted": false, "score": 2, "last_activity_date": 1504104374, "creation_date": 1504104374, "answer_id": 45963477, "question_id": 45962989, "link": "https://stackoverflow.com/questions/45962989/c-is-there-a-memory-leak-when-resident-memory-is-increasing-slowly/45963477#45963477", "title": "c++: is there a memory leak when resident memory is increasing slowly?", "body": "<p>You don't mention your platform. On systems like Linux, there is a lazy memory allocator. This means that if you call <code>new</code> to allocate memory that is not initialized (as with your int array), then virtual memory will be allocated but not physical memory. Later, if you do assign a value to the memory, it does get allocated.</p>\n\n<p>As nwp says, try assigning values to your allocated memory (either by using something like <code>memset</code> or using a class with a constructor that initializes the class members).</p>\n"}], "owner": {"reputation": 55, "user_id": 3668305, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/e818a887e7ac1981c0745f9a7ff4f4de?s=128&d=identicon&r=PG&f=1", "display_name": "wang", "link": "https://stackoverflow.com/users/3668305/wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 839, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1504109753, "creation_date": 1504102975, "last_edit_date": 1504109753, "question_id": 45962989, "link": "https://stackoverflow.com/questions/45962989/c-is-there-a-memory-leak-when-resident-memory-is-increasing-slowly", "title": "c++: is there a memory leak when resident memory is increasing slowly?", "body": "<p>I have a c++ program, its resident memory increase slowly, whilst its virtual memory remains unchanged basically. So is this a memory leak?</p>\n\n<p>After reading some articles, and running some tests, I find that if the free memory is 2G (use <code>free</code> command), and run this code:</p>\n\n<pre><code>int main() {\n    while (1) {\n        int* a = new int[100000];\n    }\n}\n</code></pre>\n\n<p>use <code>top</code> command to see that the resident memory is less than 2G, and remains unchanged, but virtual memory is increasing so fast.</p>\n\n<p>so whether I can say that </p>\n\n<ul>\n<li><p>when there is a memory leak, the virtual memory must increase. </p></li>\n<li><p>but if resident memory is going up and down, virtual memory remain unchanged, it is not the memory leak</p></li>\n</ul>\n\n<p>Edit: I do this on linux</p>\n\n<p>I rewrite my code:</p>\n\n<pre><code>#include &lt;iostream&gt;\nint main() {\n    while (1) {\n        int* a = new int[100000];\n        std::memset(a, 0, sizeof(a));\n        a[0] += 1;\n    }\n}\n</code></pre>\n\n<p>and free command:\n<code>\n               total       used       free     shared    buffers     cached\nMem:             3          0          3          0          0          0\n-/+ buffers/cache:          0          3\nSwap:            3          0          3\n</code></p>\n\n<p>when run code above:</p>\n\n<p><code>\n  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND<br>\n  8518 wq       20   0  358g 2.9g  704 R 53.9 73.8   0:09.13 a.out\n</code></p>\n\n<p>the <code>RES</code> increase to ~3g, then stop,also code below:</p>\n\n<pre><code>    #include &lt;iostream&gt;\nint main() {\n    while (1) {\n        int* a = new int[100000];\n    }\n}\n</code></pre>\n\n<p>so the final question, in which way the resident memory increase, but not the virtual, can I say that maybe free memory increase, os can allocate more physical memory to the progress</p>\n"}, {"tags": ["c++", "arrays", "algorithm", "pointers"], "comments": [{"owner": {"reputation": 2462, "user_id": 2705907, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/e2UTS.jpg?s=128&g=1", "display_name": "Vagish", "link": "https://stackoverflow.com/users/2705907/vagish"}, "edited": false, "score": 1, "creation_date": 1504102955, "post_id": 45962964, "comment_id": 78884505, "body": "Array is not pointer!"}, {"owner": {"reputation": 50953, "user_id": 1983495, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/aMDiK.jpg?s=128&g=1", "display_name": "Iharob Al Asimi", "link": "https://stackoverflow.com/users/1983495/iharob-al-asimi"}, "edited": false, "score": 0, "creation_date": 1504102975, "post_id": 45962964, "comment_id": 78884526, "body": "Ithinkyoucanimproveyourcodingstylesoyourcodeismorereadable. Other than that, I think you should read about arrays and their relation to pointers. An array name is automatically converted to a pointer to it&#39;s first element when it&#39;s possible, it is said that arrays decay to pointers. So when you print the address of the array like that, it&#39;s converted to a pointer to the first element. Also <code>&amp;arr</code> will point to the same place (<i>have the same address</i>), however the arithmetic on <code>&amp;arr</code> and <code>arr</code> is not going to give the same result."}, {"owner": {"reputation": 13016, "user_id": 8751754, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7k6Li.png?s=128&g=1", "display_name": "Ron", "link": "https://stackoverflow.com/users/8751754/ron"}, "reply_to_user": {"reputation": 2462, "user_id": 2705907, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/e2UTS.jpg?s=128&g=1", "display_name": "Vagish", "link": "https://stackoverflow.com/users/2705907/vagish"}, "edited": false, "score": 0, "creation_date": 1504103039, "post_id": 45962964, "comment_id": 78884568, "body": "@Vagish But can certainly <a href=\"https://stackoverflow.com/questions/1461432/what-is-array-decaying\">decay</a> into one."}, {"owner": {"reputation": 2462, "user_id": 2705907, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/e2UTS.jpg?s=128&g=1", "display_name": "Vagish", "link": "https://stackoverflow.com/users/2705907/vagish"}, "reply_to_user": {"reputation": 13016, "user_id": 8751754, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7k6Li.png?s=128&g=1", "display_name": "Ron", "link": "https://stackoverflow.com/users/8751754/ron"}, "edited": false, "score": 0, "creation_date": 1504103347, "post_id": 45962964, "comment_id": 78884846, "body": "@Ron It is &quot;said&quot;. The context in which question asked <code>&amp;arr should give the address of arr pointer itself</code>c , when pointer is declared , memory is allocated to store that variable itself, when array declared array symbol itself represents start of memory. So they are not same in this context."}, {"owner": {"reputation": 364, "user_id": 3443104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddb13b9d011bee845ad58aef07990e4e?s=128&d=identicon&r=PG&f=1", "display_name": "rfx", "link": "https://stackoverflow.com/users/3443104/rfx"}, "edited": false, "score": 1, "creation_date": 1504103477, "post_id": 45962964, "comment_id": 78884923, "body": "<i>What I know is that arr is a pointer to the first element of the array</i> - well, this is plainly wrong. For more elaborate answer read on <a href=\"https://stackoverflow.com/questions/1461432/what-is-array-decaying\">what is array decaying</a>"}, {"owner": {"reputation": 13016, "user_id": 8751754, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7k6Li.png?s=128&g=1", "display_name": "Ron", "link": "https://stackoverflow.com/users/8751754/ron"}, "reply_to_user": {"reputation": 2462, "user_id": 2705907, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/e2UTS.jpg?s=128&g=1", "display_name": "Vagish", "link": "https://stackoverflow.com/users/2705907/vagish"}, "edited": false, "score": 0, "creation_date": 1504103525, "post_id": 45962964, "comment_id": 78884972, "body": "@Vagish Agreed."}], "owner": {"reputation": 187, "user_id": 7105441, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vXOKh40bCF0/AAAAAAAAAAI/AAAAAAAAAAA/ISRQp5Ex3NE/photo.jpg?sz=128", "display_name": "Chaitanya Vaishampayan", "link": "https://stackoverflow.com/users/7105441/chaitanya-vaishampayan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 0, "closed_date": 1504103049, "answer_count": 0, "score": 0, "last_activity_date": 1504103629, "creation_date": 1504102892, "last_edit_date": 1504103629, "question_id": 45962964, "link": "https://stackoverflow.com/questions/45962964/why-is-the-value-of-array-name-and-its-address-same", "closed_reason": "Duplicate", "title": "Why is the value of array name and its address same?", "body": "<p>For the following code</p>\n\n<pre><code>#include&lt;iostream&gt;\nusing namespace std;\nint main(){\n    int arr[10];\n    arr[0]=28;\n    cout&lt;&lt;arr&lt;&lt;endl&lt;&lt;&amp;arr&lt;&lt;endl&lt;&lt;*arr&lt;&lt;endl;\nreturn 0;\n}\n</code></pre>\n\n<p>The output is:</p>\n\n<pre><code>0x22fe88\n0x22fe88\n28\n</code></pre>\n\n<p>My doubt is that why is the value of arr and &amp;arr same? What I know is that arr is a pointer to the first element of the array i.e. arr is same as &amp;arr[0] and since arr is a pointer, it means that it should also have its own memory address where it is stored in memory. So why &amp;arr and arr gives the same output? arr is supposed to give the address of first element whereas &amp;arr should give the address of arr pointer itself. Please explain in detail.</p>\n"}, {"tags": ["c++", "c++11"], "answers": [{"tags": [], "owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "is_accepted": true, "score": 9, "last_activity_date": 1504102892, "creation_date": 1504102892, "answer_id": 45962963, "question_id": 45962878, "link": "https://stackoverflow.com/questions/45962878/destructor-in-derived-class-marked-as-noexceptfalse/45962963#45962963", "title": "Destructor in derived class marked as noexcept(false)", "body": "<p><code>B</code>'s destructor will destroy <code>m</code>, which is not a <code>noexcept</code> operations. You can't be sure that <code>~B</code> won't throw, so it is also <code>noexcept(false)</code>.</p>\n\n<p>See <a href=\"http://en.cppreference.com/w/cpp/language/destructor#Implicitly-declared_destructor\" rel=\"noreferrer\">http://en.cppreference.com/w/cpp/language/destructor#Implicitly-declared_destructor</a> :</p>\n\n<blockquote>\n  <p>[...] In practice, implicit destructors are noexcept unless the class is \"poisoned\" by a base or member whose destructor is noexcept(false).</p>\n</blockquote>\n"}], "owner": {"reputation": 344, "user_id": 8098775, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0373f987d8a91baaf892ac3b3755dd4b?s=128&d=identicon&r=PG&f=1", "display_name": "wulujey", "link": "https://stackoverflow.com/users/8098775/wulujey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "accepted_answer_id": 45962963, "answer_count": 1, "score": 5, "last_activity_date": 1504102892, "creation_date": 1504102633, "question_id": 45962878, "link": "https://stackoverflow.com/questions/45962878/destructor-in-derived-class-marked-as-noexceptfalse", "title": "Destructor in derived class marked as noexcept(false)", "body": "<p>There is following code:</p>\n\n<pre><code>class Member\n{\npublic:\n  ~Member() noexcept(false) {}\n};\n\nclass A\n{\npublic:\n  virtual ~A() {}\n};\n\nclass B : public A\n{\npublic:\n  Member m;\n};\n</code></pre>\n\n<p>The error is:</p>\n\n<pre><code>main.cpp:13:7: error: looser throw specifier for \u2018virtual B::~B() noexcept (false)\u2019\n class B : public A\n       ^\nmain.cpp:10:11: error:   overriding \u2018virtual A::~A() noexcept\u2019\n   virtual ~A() {}\n           ^\n</code></pre>\n\n<p>Why does the destructor in class B is marked as noexcept(false)? It seems that it somehow gets it from Member class. It was compiled by g++ 6.3.</p>\n"}, {"tags": ["c++", "singleton", "visual-studio-2017"], "comments": [{"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1504102699, "post_id": 45962859, "comment_id": 78884311, "body": "what is the error message?"}, {"owner": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 1, "creation_date": 1504102782, "post_id": 45962859, "comment_id": 78884365, "body": "By what kind of logic you want to allow singleton to access itself from its own constructor?"}, {"owner": {"reputation": 2374, "user_id": 8491726, "user_type": "registered", "profile_image": "https://graph.facebook.com/1550562035006492/picture?type=large", "display_name": "Artemy Vysotsky", "link": "https://stackoverflow.com/users/8491726/artemy-vysotsky"}, "edited": false, "score": 0, "creation_date": 1504102930, "post_id": 45962859, "comment_id": 78884482, "body": "move the access to getTwo() from constructor of Stuff::Stuff to some function init. Call this function using call_once in the getInstance after the instance is constructed and pass the value of getTwo to it."}, {"owner": {"reputation": 1334, "user_id": 637987, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/47e98f619e6b1fd3c1162253865b6c3b?s=128&d=identicon&r=PG", "display_name": "Vaillancourt", "link": "https://stackoverflow.com/users/637987/vaillancourt"}, "reply_to_user": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 0, "creation_date": 1504103282, "post_id": 45962859, "comment_id": 78884787, "body": "@VTT As mentioned in the post, I don&#39;t have access to the code, it is from a third party library (OpenAL, in this case). I&#39;m aware that it is a very bad idea."}, {"owner": {"reputation": 1334, "user_id": 637987, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/47e98f619e6b1fd3c1162253865b6c3b?s=128&d=identicon&r=PG", "display_name": "Vaillancourt", "link": "https://stackoverflow.com/users/637987/vaillancourt"}, "reply_to_user": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1504103302, "post_id": 45962859, "comment_id": 78884809, "body": "@tobi303 There is no error message; it&#39;s really just a behaviour."}, {"owner": {"reputation": 1334, "user_id": 637987, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/47e98f619e6b1fd3c1162253865b6c3b?s=128&d=identicon&r=PG", "display_name": "Vaillancourt", "link": "https://stackoverflow.com/users/637987/vaillancourt"}, "reply_to_user": {"reputation": 2374, "user_id": 8491726, "user_type": "registered", "profile_image": "https://graph.facebook.com/1550562035006492/picture?type=large", "display_name": "Artemy Vysotsky", "link": "https://stackoverflow.com/users/8491726/artemy-vysotsky"}, "edited": false, "score": 0, "creation_date": 1504103387, "post_id": 45962859, "comment_id": 78884875, "body": "@ArtemyVysotsky There would be many ways to fix it if I had access to the faulty singleton code, but I don&#39;t, unfortunately. This is why I&#39;m asking if there is a way to do this with the compiler."}, {"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 0, "creation_date": 1504103408, "post_id": 45962859, "comment_id": 78884889, "body": "Constructor of Singleton requires that its own constructor has finished..."}, {"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 1, "creation_date": 1504103457, "post_id": 45962859, "comment_id": 78884915, "body": "Which part do you have access ?"}, {"owner": {"reputation": 2374, "user_id": 8491726, "user_type": "registered", "profile_image": "https://graph.facebook.com/1550562035006492/picture?type=large", "display_name": "Artemy Vysotsky", "link": "https://stackoverflow.com/users/8491726/artemy-vysotsky"}, "edited": false, "score": 0, "creation_date": 1504103509, "post_id": 45962859, "comment_id": 78884950, "body": "You can compile it in VS2017 using original toolchain of VS2013 - without upgrading the project"}, {"owner": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 0, "creation_date": 1504103709, "post_id": 45962859, "comment_id": 78885112, "body": "And which part of OpenAl performs this? Maybe you should turn this into OpenAl-specific problem question?"}, {"owner": {"reputation": 1334, "user_id": 637987, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/47e98f619e6b1fd3c1162253865b6c3b?s=128&d=identicon&r=PG", "display_name": "Vaillancourt", "link": "https://stackoverflow.com/users/637987/vaillancourt"}, "reply_to_user": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 0, "creation_date": 1504104452, "post_id": 45962859, "comment_id": 78885656, "body": "@Jarod42 I guess I have access to the code that uses the library."}, {"owner": {"reputation": 1334, "user_id": 637987, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/47e98f619e6b1fd3c1162253865b6c3b?s=128&d=identicon&r=PG", "display_name": "Vaillancourt", "link": "https://stackoverflow.com/users/637987/vaillancourt"}, "reply_to_user": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 0, "creation_date": 1504104505, "post_id": 45962859, "comment_id": 78885703, "body": "@VTT I thought about it, but after fixing that, there might be the same issue with another library. (Another singleton not yet initialized.)"}], "answers": [{"tags": [], "owner": {"reputation": 11532, "user_id": 5129715, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/320498457784a3110f3e256745a9a927?s=128&d=identicon&r=PG&f=1", "display_name": "mksteve", "link": "https://stackoverflow.com/users/5129715/mksteve"}, "is_accepted": true, "score": 2, "last_activity_date": 1504104779, "last_edit_date": 1504104779, "creation_date": 1504103930, "answer_id": 45963315, "question_id": 45962859, "link": "https://stackoverflow.com/questions/45962859/how-can-i-allow-singleton-constructor-re-entry-pass-over-in-vs2017/45963315#45963315", "title": "How can I allow singleton constructor re-entry/pass-over in VS2017?", "body": "<pre><code>/Zc:threadSafeInit-\n</code></pre>\n\n<p>The general \"Conformance\" page is <a href=\"https://docs.microsoft.com/en-us/cpp/build/reference/zc-conformance\" rel=\"nofollow noreferrer\">MSDN: Conformance</a>, which details which new features you can disable.</p>\n\n<p>I needed the code for sizedDealloc, where my new compiler was creating a sized new operator for a library which broke older compiled expectations.</p>\n\n<p>As this is a compile flag, at least some of the code would be in your control, and you should be able to unravel the beast.</p>\n\n<p>The constructor <code>Stuff::Stuff</code> is calling a function on an incompletely constructed object.</p>\n\n<p>That would create \"Undefined behavior\".  If the value \"2\" is not set till the end of the constructor (for example).</p>\n\n<p>Probably the Singleton needs to be split into 2, one which delivers the early static data (e.g. 2). </p>\n\n<p>The second which delivers the held object Stuff.  Stuff would only rely on the first, which would break the deadlock.</p>\n\n<p>Alternatively, a second constructor to <code>Stuff</code> which told it which object to use, and was called from the <code>Singleton::Singleton</code></p>\n\n<p>The MSDN article to disable \"Magic Statics\" <a href=\"https://docs.microsoft.com/en-us/cpp/build/reference/zc-threadsafeinit-thread-safe-local-static-initialization\" rel=\"nofollow noreferrer\">MSDN : disable threadsafe static initialization</a></p>\n"}], "owner": {"reputation": 1334, "user_id": 637987, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/47e98f619e6b1fd3c1162253865b6c3b?s=128&d=identicon&r=PG", "display_name": "Vaillancourt", "link": "https://stackoverflow.com/users/637987/vaillancourt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 381, "favorite_count": 0, "accepted_answer_id": 45963315, "answer_count": 1, "score": 3, "last_activity_date": 1504653688, "creation_date": 1504102586, "last_edit_date": 1504653688, "question_id": 45962859, "link": "https://stackoverflow.com/questions/45962859/how-can-i-allow-singleton-constructor-re-entry-pass-over-in-vs2017", "title": "How can I allow singleton constructor re-entry/pass-over in VS2017?", "body": "<p>I've been porting some c++ app from Visual Studio 2013 to Visual Studio 2017. Aside from the plethora of new warnings that I had to fix, the compilation and linking went okay. </p>\n\n<p>However, when <em>running</em> the app, it 'stalled' when trying to re-enter the constructor of a singleton (when successive function calls form a loop back to the constructor). It seems that this behaviour was okay in VS2013, but is no longer valid in VS2017. There is no error message.</p>\n\n<p><em>I'm aware of all the bad things related to singletons, and that there should at least not be loops. The question is not there.</em></p>\n\n<p><strong>Is there a way to tell the VS2017 compiler that I'd like to shoot myself in the foot, and allow the same behaviour that was there in VS2013?</strong></p>\n\n<p>I don't have access to the code that causes this behaviour because it comes from a third-party library, this is why I can't 'just fix it', unfortunately.</p>\n\n<p>Here is an example which works in VS2013, but doesn't work in VS2017:</p>\n\n<h1>main.cpp</h1>\n\n<pre><code>#include \"Singleton.h\";\n\nint \nmain( void )\n{\n\n  std::cout &lt;&lt; \"let's do this!\" &lt;&lt; std::endl;\n  int two = Singleton::GetReference().getTwo();\n  std::cout &lt;&lt; \"ok\" &lt;&lt; std::endl;\n  return 0;\n}\n</code></pre>\n\n<h1>Singleton.h</h1>\n\n<pre><code>#pragma once\n\nclass Stuff;\n\nclass Singleton\n{\npublic:\n  static Singleton&amp; GetReference();\n\n  int getTwo() { return 2; }\n\nprivate:\n  Singleton();\n\n  Stuff* stuff;\n};\n</code></pre>\n\n<h1>Singleton.cpp</h1>\n\n<pre><code>#include \"Singleton.h\"\n#include \"Stuff.h\"\n\nSingleton&amp; \nSingleton::GetReference() { \n  static Singleton theInstance; \n  return theInstance; \n}\n\nSingleton::Singleton()\n{\n  stuff = new Stuff();\n}\n</code></pre>\n\n<h1>Stuff.h</h1>\n\n<pre><code>#pragma once\n\nclass Stuff\n{\npublic:\n  Stuff();\nprivate:\n  int two;\n};\n</code></pre>\n\n<h1>Stuff.cpp</h1>\n\n<pre><code>#include \"Stuff.h\"\n#include \"Singleton.h\"\n\nStuff::Stuff()\n{ \n  two = Singleton::GetReference().getTwo();\n}\n</code></pre>\n\n<p>In the code above, when step-by-step debugging, the first time we get on the line <code>static Singleton theInstance;</code> will work as expected, but the second time, a <kbd>F11</kbd> will go to the file <code>thread_safe_statics.cpp</code>, into the method <code>extern \"C\" void __cdecl _Init_thread_header(int* const pOnce)</code>. A <kbd>Shift+F11</kbd> will exit the method and the program will wait indefinitely at the line specified (observed when pausing the program from the debugger).</p>\n\n<hr>\n\n<p>PS</p>\n\n<p>This issue probably occurs in Visual Studio 2015 too, as the documentation linked from the accepted answer mentions VS2015. </p>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 42880, "user_id": 982161, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/kutcC.png?s=128&g=1", "display_name": "\u03a6Xoc\u0119 \uc6c3 \u041fepe&#250;pa \u30c4", "link": "https://stackoverflow.com/users/982161/%ce%a6xoc%c4%99-%ec%9b%83-%d0%9fepe%c3%bapa-%e3%83%84"}, "edited": false, "score": 0, "creation_date": 1504102286, "post_id": 45962733, "comment_id": 78883991, "body": "this looks like C.... why did you tag that as c++???"}], "answers": [{"comments": [{"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 1, "creation_date": 1504102385, "post_id": 45962783, "comment_id": 78884074, "body": "Please don&#39;t answer duplicates.  That should be flagged/voted to be closed."}, {"owner": {"reputation": 311, "user_id": 8216027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b24eccff57c98239f998682e54c82af?s=128&d=identicon&r=PG&f=1", "display_name": "Matthew Wherry", "link": "https://stackoverflow.com/users/8216027/matthew-wherry"}, "reply_to_user": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1504102546, "post_id": 45962783, "comment_id": 78884202, "body": "Because I knew this was a duplicate? I opened SO and it was the first thing I saw so i posted a possible answer. @NathanOliver"}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 1, "creation_date": 1504102610, "post_id": 45962783, "comment_id": 78884247, "body": "Before you post an answer you should be checking to see if it is a duplicate."}], "tags": [], "owner": {"reputation": 311, "user_id": 8216027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b24eccff57c98239f998682e54c82af?s=128&d=identicon&r=PG&f=1", "display_name": "Matthew Wherry", "link": "https://stackoverflow.com/users/8216027/matthew-wherry"}, "is_accepted": false, "score": -1, "last_activity_date": 1504102343, "creation_date": 1504102343, "answer_id": 45962783, "question_id": 45962733, "link": "https://stackoverflow.com/questions/45962733/division-operation-always-yields-0/45962783#45962783", "title": "Division operation always yields 0", "body": "<p>In your equations and definitions, use a double format ie. 1.0, 1565.0, and so on</p>\n"}], "owner": {"reputation": 171, "user_id": 7222485, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/944605c07876d59c28116f0df6e6cb7e?s=128&d=identicon&r=PG&f=1", "display_name": "kelvinmac", "link": "https://stackoverflow.com/users/7222485/kelvinmac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 49, "favorite_count": 0, "closed_date": 1504102365, "answer_count": 1, "score": 0, "last_activity_date": 1504102343, "creation_date": 1504102213, "question_id": 45962733, "link": "https://stackoverflow.com/questions/45962733/division-operation-always-yields-0", "closed_reason": "Duplicate", "title": "Division operation always yields 0", "body": "<p>I'm calculating angles using an IMU which as you may know involves a lot of maths. In-order to get angles at any moment, a time stamp of each reading is applied which is used to determine the refresh rate/update rate which i used in the equation. </p>\n\n<p>The idea is to get a value which i can use as the rate relative to a whole second(1000 ms),i do-: 1 / (1000 / TimeStamp difference) / gyro Scale value which results in a very small decimal when done by hand, doing this with C++ yields 0 every time which is confusing because its in the exact order i should do it in.</p>\n\n<p>Thanks in advance; </p>\n\n<p>Kelvin</p>\n\n<pre><code>#include \"stdafx.h\"\n\ntypedef struct {\n    double Accel_X;                      /*!&lt; Accelarometer value X axis */\n    double Accel_Y;                      /*!&lt; Accelarometer value Y axis */\n    double Accel_Z;                      /*!&lt; Accelarometer value Z axis */\n\n    double Gyroscope_X;              /*!&lt; Gyroscope value X axis */\n    double Gyroscope_Y;              /*!&lt; Gyroscope value Y axis */\n    double Gyroscope_Z;              /*!&lt; Gyroscope value Z axis */\n\n    __int16 Temperature;         /*!&lt; Temperature in degrees */\n    __int32 TimeStamp;               /*!&lt; Time in Ms when measurement was taken */\n\n    bool isPopulated;    /*!&lt; Indicates if the current instance has been populated */\n} MPU6050_Raw_Result_Calib;\n\nMPU6050_Raw_Result_Calib LatestResultRaw_Calib[2];\n\nfloat xAngle;\ndouble gyroScale = 65.5;\n\ndouble calc()\n{\n    double actualRate;\n\n    if (!LatestResultRaw_Calib[0].isPopulated &amp;&amp; !LatestResultRaw_Calib[1].isPopulated)\n        return 0;\n\n    __int16 refreshRate = LatestResultRaw_Calib[0].TimeStamp - LatestResultRaw_Calib[1].TimeStamp;\n\n    actualRate = 1 / (1000 / refreshRate) / gyroScale;\n\n    xAngle += LatestResultRaw_Calib[0].Gyroscope_X * actualRate;\n\n    return xAngle;\n}\n\nint main()\n{\n    LatestResultRaw_Calib[0].Gyroscope_X = 1;\n    LatestResultRaw_Calib[0].isPopulated = true;\n    LatestResultRaw_Calib[0].TimeStamp = 1565;\n\n    LatestResultRaw_Calib[1].Gyroscope_X = 15;\n    LatestResultRaw_Calib[1].isPopulated = true;\n    LatestResultRaw_Calib[1].TimeStamp = 1500;\n\n    while (1)\n    {\n        printf(\"%f \", calc());\n    }\n}\n</code></pre>\n"}, {"tags": ["c++", "wxwidgets"], "comments": [{"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1504102095, "post_id": 45962613, "comment_id": 78883841, "body": "make references (not pointers) your default when you dont want a copy, it will make your life easier"}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1504102189, "post_id": 45962613, "comment_id": 78883911, "body": "btw your streams live in the scope of the <code>GetData</code> functions and pointers to them will be invalid outside of <code>GetData</code>. You need to keep them alive as long as you want to use them"}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1504102287, "post_id": 45962613, "comment_id": 78883992, "body": "this is completely unrelated, but same problem: <a href=\"https://stackoverflow.com/questions/45959875/method-of-super-class-called-when-super-has-a-str-attr-instance-of-sub-is-crea/45959986?noredirect=1#comment78880266_45959986\" title=\"method of super class called when super has a str attr instance of sub is crea\">stackoverflow.com/questions/45959875/&hellip;</a>"}, {"owner": {"reputation": 1401, "user_id": 2737046, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/5gIpP.jpg?s=128&g=1", "display_name": "perencia", "link": "https://stackoverflow.com/users/2737046/perencia"}, "edited": false, "score": 0, "creation_date": 1504104033, "post_id": 45962613, "comment_id": 78885374, "body": "That is what c++ class members are designed for."}, {"owner": {"reputation": 1, "user_id": 8537345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92cdb654889c4a941987a053825bbfbc?s=128&d=identicon&r=PG&f=1", "display_name": "g_scanon_b", "link": "https://stackoverflow.com/users/8537345/g-scanon-b"}, "edited": false, "score": 0, "creation_date": 1504111996, "post_id": 45962613, "comment_id": 78890678, "body": "Thanks guys. That sufficed. Just wanted to know what the &quot;right&quot; way was. I was already trying to use a reference but was running into problems using &quot;new Whatever()&quot;. Now it works the way I want. however it gives me some memory leaks when I close it(guess it comes from new). I checked this post: <a href=\"https://stackoverflow.com/questions/8544090/detected-memory-leaks\" title=\"detected memory leaks\">stackoverflow.com/questions/8544090/detected-memory-leaks</a>, went to the line causing the problem and there&#39;s a comment telling that you should live with this leak as it is unlikely to happen. Are these leaks &quot;normal&quot;? Btw, I tried to explicitly destroy the objects but it still throws the same."}], "owner": {"reputation": 1, "user_id": 8537345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92cdb654889c4a941987a053825bbfbc?s=128&d=identicon&r=PG&f=1", "display_name": "g_scanon_b", "link": "https://stackoverflow.com/users/8537345/g-scanon-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 111, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1504101869, "creation_date": 1504101869, "question_id": 45962613, "link": "https://stackoverflow.com/questions/45962613/passing-modifying-a-fileoutputstream", "title": "passing/modifying a FileOutputStream", "body": "<p>I'm writing a C++ program which should continuously write to a text file inside an OnIdle event loop (BTW, I'm using wxWidgets -3.0.3 and Visual Studio 17). For this purpose, I'm creating a TextOutputStream as described in the code below inside GetData().</p>\n\n<p>Here gui_magsens->GetFilePath() simply gets a file path from a wxFilePickerCtrl and ActivateDataLoop(true) triggers the OnIdle loop. Now, what I would like to have is a global reference to my <em>tos</em> so that I can use it inside the OnIdle loop without having to create it (and close it) every iteration(not efficient and leads me to unhandled exceptions). <strong>What is the best (or cleanest) way to achieve this?</strong> What I have found so far is that you could use a pointer to the stream (as shown below), which compiles fine, but throws me a \"read access violation\" exception(apparently expected as the pointer points to an already \"dead\" stream). Also, <strong>is there a neat workaround without using pointers?</strong></p>\n\n<pre><code>//----main.h----//\n\n//...bunch of variables and functions\nwxFileOutputStream* pFos;\nwxTextOutputStream* pTos;\n</code></pre>\n\n<hr>\n\n<pre><code>//---main.cpp----//\n\nvoid wxMagSens::GetData()\n{       \n//create stream\nwxString f_path = gui_magsens-&gt;GetFilePath();\nwxFileOutputStream fos(f_path);\nwxTextOutputStream tos(fos, wxEOL_NATIVE, wxConvUTF8); \n//ptrs\npFos = &amp;fos;\npTos = &amp;tos;\nActivateDataLoop(true); \n} \n\nvoid wxMagSens::OnIdleDataLoop(wxIdleEvent &amp; evt)\n{           \n  //write to file\n  pTos-&gt;WriteDouble(some_double);//Here's the exception\n  //etc...\n}\n\nint wxMagSens::OnExit()\n{\n//USBInterface.USBClose();\nif(pFos-&gt;IsOk()){ pFos-&gt;Close();}   \nreturn 0;\n}\n</code></pre>\n"}, {"tags": ["c++", "recursion", "fibonacci"], "comments": [{"owner": {"reputation": 147720, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 3, "creation_date": 1504101891, "post_id": 45962555, "comment_id": 78883672, "body": "You don&#39;t modify <code>start</code> when calling <code>fib(start)</code>, how is it supposed to reach 1 or 0?"}, {"owner": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 1, "creation_date": 1504101918, "post_id": 45962555, "comment_id": 78883701, "body": "<b><i>get an error about memory allocation.</i></b> Please post the error message."}, {"owner": {"reputation": 5857, "user_id": 1981873, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62002f003983350e011bf1c74cd236c5?s=128&d=identicon&r=PG", "display_name": "jlahd", "link": "https://stackoverflow.com/users/1981873/jlahd"}, "edited": false, "score": 0, "creation_date": 1504101935, "post_id": 45962555, "comment_id": 78883716, "body": "What happens if you call <code>fib(2)</code>? It recursively calls <code>fib(2)</code>, which recursively calls <code>fib(2)</code>, which recursively calls <code>fib(2)</code>, which ... is not good for your program&#39;s health."}, {"owner": {"reputation": 13493, "user_id": 1460628, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/5NREb.jpg?s=128&g=1", "display_name": "Miljen Mikic", "link": "https://stackoverflow.com/users/1460628/miljen-mikic"}, "edited": false, "score": 1, "creation_date": 1504101980, "post_id": 45962555, "comment_id": 78883756, "body": "Recursion for Fibonacci is not <code>fib(start)*fib(start-1)</code>, but <code>fib(start-1) + fib(start-2)</code>."}, {"owner": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 1, "creation_date": 1504102004, "post_id": 45962555, "comment_id": 78883781, "body": "Oh I see. Because of infinite recursion you have a very fitting error for this site.."}], "answers": [{"tags": [], "owner": {"reputation": 42880, "user_id": 982161, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/kutcC.png?s=128&g=1", "display_name": "\u03a6Xoc\u0119 \uc6c3 \u041fepe&#250;pa \u30c4", "link": "https://stackoverflow.com/users/982161/%ce%a6xoc%c4%99-%ec%9b%83-%d0%9fepe%c3%bapa-%e3%83%84"}, "is_accepted": false, "score": 2, "last_activity_date": 1504102928, "last_edit_date": 1504102928, "creation_date": 1504102001, "answer_id": 45962666, "question_id": 45962555, "link": "https://stackoverflow.com/questions/45962555/im-trying-to-code-the-recursive-fibonacci-sequence-in-c-but-when-i-compile-i-g/45962666#45962666", "title": "Im trying to code the recursive fibonacci sequence in c++ but when I compile I get an error", "body": "<p>The problem is that the fibonacci function is not right...</p>\n\n<p>if your variable <code>start</code> happens to be different from 0 or 1 then you can the function fib(start) over and over again</p>\n\n<pre><code>return fib(start)*fib(start-1);\n</code></pre>\n\n<p>that will produce an stackoverflow since the function is calling itself infinitely.</p>\n\n<p>on the other hand you should not multiply those values but add it instead</p>\n\n<pre><code> return fib(n - 1) + fib(n - 2);\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 712, "user_id": 5570606, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/NEUuj.jpg?s=128&g=1", "display_name": "Stubborn", "link": "https://stackoverflow.com/users/5570606/stubborn"}, "is_accepted": false, "score": 1, "last_activity_date": 1504102232, "creation_date": 1504102232, "answer_id": 45962742, "question_id": 45962555, "link": "https://stackoverflow.com/questions/45962555/im-trying-to-code-the-recursive-fibonacci-sequence-in-c-but-when-i-compile-i-g/45962742#45962742", "title": "Im trying to code the recursive fibonacci sequence in c++ but when I compile I get an error", "body": "<p>The <code>fib()</code> will not work properly, \nplease try this:</p>\n\n<pre><code>if(n == 0 || n == 1)\n{\nreturn n;\n}\nelse\n return ( fib(n-1) + fib(n-2) );\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 143, "user_id": 4400677, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/lbAdF.jpg?s=128&g=1", "display_name": "Jamie Nicholl-Shelley", "link": "https://stackoverflow.com/users/4400677/jamie-nicholl-shelley"}, "is_accepted": false, "score": 0, "last_activity_date": 1545829453, "creation_date": 1545829453, "answer_id": 53932495, "question_id": 45962555, "link": "https://stackoverflow.com/questions/45962555/im-trying-to-code-the-recursive-fibonacci-sequence-in-c-but-when-i-compile-i-g/53932495#53932495", "title": "Im trying to code the recursive fibonacci sequence in c++ but when I compile I get an error", "body": "<p>To see what's going on I recommend adding the following to the above answer:\nAllowing you to also find the Big O notation\n    #include </p>\n\n<pre><code>using namespace std;\n\nint fib(int n, int &amp;count) {\n    if (n == 0 || n == 1)\n    {\n        return n;\n    }\n    else\n    {\n        cout &lt;&lt; \"n: \" &lt;&lt; n &lt;&lt; endl;\n        count += 1;\n        return (fib(n - 1, count) + fib(n - 2, count));\n    }\n}\n\nint main()\n{\n    int count = 0;\n    cout &lt;&lt; fib(9, count) &lt;&lt; endl;\n    cout &lt;&lt; \"Parses Count : \" &lt;&lt; count &lt;&lt; endl;\n    cin.get();\n   cin.ignore();\n}\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 8456761, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba523982be5d949151643ae79f1e8653?s=128&d=identicon&r=PG&f=1", "display_name": "Edward Cunningham", "link": "https://stackoverflow.com/users/8456761/edward-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 430, "favorite_count": 1, "answer_count": 3, "score": 0, "last_activity_date": 1545829453, "creation_date": 1504101757, "question_id": 45962555, "link": "https://stackoverflow.com/questions/45962555/im-trying-to-code-the-recursive-fibonacci-sequence-in-c-but-when-i-compile-i-g", "title": "Im trying to code the recursive fibonacci sequence in c++ but when I compile I get an error", "body": "<p>When i try to compute the fibonacci sequence using a recursive algorithm in c++, I get an error about memory allocation. I can run a recursive algorithm that has a void return, but when and int is the return, there is an issue with memory. Is there a way around this?</p>\n\n<pre><code>#include &lt;iostream&gt;\nusing namespace std;\n\nint fib(int start);\n\nint main()\n{\n  int x,y;\n  cout &lt;&lt; \"Enter a value for x: \";\n  cin &gt;&gt; x;\n\n\n  y = fib(x);\n  cout &lt;&lt; \"Your product is: \";\n  cout &lt;&lt; y &lt;&lt; endl;\n  return 0;\n\n}\n\nint fib(int start){\n  if(start == 0 || start == 1){\n    return start;\n  }\n  return fib(start)*fib(start-1);\n}\n</code></pre>\n"}, {"tags": ["c++", "git", "github", "boost"], "comments": [{"owner": {"reputation": 161, "user_id": 2928707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbe600ab7899b53195555605bd962ab0?s=128&d=identicon&r=PG&f=1", "display_name": "bartoli", "link": "https://stackoverflow.com/users/2928707/bartoli"}, "edited": false, "score": 0, "creation_date": 1504102312, "post_id": 45962254, "comment_id": 78884010, "body": "The link pragma should be generated in config/auto_link.hpp. You can start from there"}, {"owner": {"reputation": 3700, "user_id": 2573127, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/J2n1Z.png?s=128&g=1", "display_name": "IceFire", "link": "https://stackoverflow.com/users/2573127/icefire"}, "reply_to_user": {"reputation": 161, "user_id": 2928707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbe600ab7899b53195555605bd962ab0?s=128&d=identicon&r=PG&f=1", "display_name": "bartoli", "link": "https://stackoverflow.com/users/2928707/bartoli"}, "edited": false, "score": 0, "creation_date": 1504104726, "post_id": 45962254, "comment_id": 78885872, "body": "It is generated there, when I include something, but also at <code>b2</code>? I do not think so because <code>b2</code> generates different lib names... I have explained exactly what is generated and how it differs"}, {"owner": {"reputation": 14358, "user_id": 3962537, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AI0Bc.png?s=128&g=1", "display_name": "Dan Ma\u0161ek", "link": "https://stackoverflow.com/users/3962537/dan-ma%c5%a1ek"}, "edited": false, "score": 0, "creation_date": 1504110175, "post_id": 45962254, "comment_id": 78889647, "body": "You probably checked out an in-development version. Looks like the super-project and config module are somewhat out of sync: <a href=\"https://github.com/boostorg/config/commit/b8fe4fe5e0ac0b0ef3d37022749193a634f86ece\" rel=\"nofollow noreferrer\">&#91;1&#93;</a>  <a href=\"https://github.com/boostorg/boost/commit/13cc3507fbcc12a95654b23a1a1b521837deeb48#diff-5cecbe9cda25620173d84b5f6efa6690\" rel=\"nofollow noreferrer\">&#91;2&#93;</a>. You&#39;ve got the source, fix it."}, {"owner": {"reputation": 3700, "user_id": 2573127, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/J2n1Z.png?s=128&g=1", "display_name": "IceFire", "link": "https://stackoverflow.com/users/2573127/icefire"}, "reply_to_user": {"reputation": 14358, "user_id": 3962537, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AI0Bc.png?s=128&g=1", "display_name": "Dan Ma\u0161ek", "link": "https://stackoverflow.com/users/3962537/dan-ma%c5%a1ek"}, "edited": false, "score": 1, "creation_date": 1504111158, "post_id": 45962254, "comment_id": 78890258, "body": "@DanMa\u0161ek Ah, thank you! So, precisely <code>jamroot</code> (used for building b2) and <code>config&#47;version.h</code> are out of sync; that I understand"}], "owner": {"reputation": 3700, "user_id": 2573127, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/J2n1Z.png?s=128&g=1", "display_name": "IceFire", "link": "https://stackoverflow.com/users/2573127/icefire"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 31, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1504101278, "creation_date": 1504100917, "last_edit_date": 1504101278, "question_id": 45962254, "link": "https://stackoverflow.com/questions/45962254/how-does-boost-b2-determine-which-filename-for-libs-to-use", "title": "How does boost b2 determine which filename for libs to use?", "body": "<p>The question is in the topic.</p>\n\n<p>My practical issue is that I have checked out the github boost project. When building, it creates, e.g., <code>libboost_date_time_vc140-mt-1_65_1.lib</code> because it is boost 1.65.1. This one is correct but <code>config/version.php</code> sets versions 1.65.0. </p>\n\n<p>Obviously, there is a mismatch because when including the boost headers, it will try to link against <code>libboost_date_time_vc140-mt-1_65.lib</code> which does not exist.</p>\n\n<p>So, my question would be where <code>b2</code> gets its filename information from or what I might have done wrong?!</p>\n"}, {"tags": ["c++", "winapi", "directshow", "samplegrabber"], "answers": [{"comments": [{"owner": {"reputation": 787, "user_id": 3419885, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/100001500229007/picture?type=large", "display_name": "mbaros", "link": "https://stackoverflow.com/users/3419885/mbaros"}, "edited": false, "score": 0, "creation_date": 1504171061, "post_id": 45966291, "comment_id": 78914108, "body": "Thanks for the comment, Roman. The idea you suggested seems to be prietty good and working, but seems design-wise I can&#39;t do that way. The problem is that my function ReadNextFrame() should be completed at a single function call and return a value.If I wait for the event in the SampleCB code that means it will be an active thread and my function would not be completed."}, {"owner": {"reputation": 64286, "user_id": 868014, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PoaTp.png?s=128&g=1", "display_name": "Roman R.", "link": "https://stackoverflow.com/users/868014/roman-r"}, "reply_to_user": {"reputation": 787, "user_id": 3419885, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/100001500229007/picture?type=large", "display_name": "mbaros", "link": "https://stackoverflow.com/users/3419885/mbaros"}, "edited": false, "score": 0, "creation_date": 1504173004, "post_id": 45966291, "comment_id": 78915536, "body": "Your top level <code>ReadNextFrame</code> might wait for an event set by <code>SampleCB</code>. Once synchronized, <code>ReadNextFrame</code> would copy the data prepared by the callback and set another event to release callback wait and continue to get next frame. <code>ReadNextFrame</code>, in turn, already has a copy of data to return back to its caller."}, {"owner": {"reputation": 787, "user_id": 3419885, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/100001500229007/picture?type=large", "display_name": "mbaros", "link": "https://stackoverflow.com/users/3419885/mbaros"}, "edited": false, "score": 0, "creation_date": 1504184551, "post_id": 45966291, "comment_id": 78923674, "body": "Can you please explain how to do #4 a bit detailed? Thank you very much."}, {"owner": {"reputation": 787, "user_id": 3419885, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/100001500229007/picture?type=large", "display_name": "mbaros", "link": "https://stackoverflow.com/users/3419885/mbaros"}, "edited": false, "score": 0, "creation_date": 1504716321, "post_id": 45966291, "comment_id": 79122459, "body": "I implemented the above pseudo code with 2 shared boolean variables <code>is_dataAvailable</code> and <code>is_nextFrameRequested</code>. I just pass that variables (by reference) to callback function. So my main thread waits until the callback functions sets the <code>is_dataAvailable</code> and my callback waits until main thread sets the <code>is_nextFrameRequested</code>. I built a DLL. The release version hangs in an infinite loop. Debug version works if I don&#39;t call ReadNextFrame() to fast (one after each other), otherwise, it also hangs. What is the clever way to handle such a situation?"}, {"owner": {"reputation": 787, "user_id": 3419885, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/100001500229007/picture?type=large", "display_name": "mbaros", "link": "https://stackoverflow.com/users/3419885/mbaros"}, "edited": false, "score": 0, "creation_date": 1504716357, "post_id": 45966291, "comment_id": 79122484, "body": "I noticed you mentioned  <code>event</code> in your pseudo code.  I also tried to do it with DirectShow event handling, but I couldn&#39;t make it work too. Any help will be appreciated"}, {"owner": {"reputation": 64286, "user_id": 868014, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PoaTp.png?s=128&g=1", "display_name": "Roman R.", "link": "https://stackoverflow.com/users/868014/roman-r"}, "reply_to_user": {"reputation": 787, "user_id": 3419885, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/100001500229007/picture?type=large", "display_name": "mbaros", "link": "https://stackoverflow.com/users/3419885/mbaros"}, "edited": false, "score": 1, "creation_date": 1504719590, "post_id": 45966291, "comment_id": 79124270, "body": "By event I mean regular synchronization object, such as created with <code>CreateEvent</code> Win32 API, or I more often use <code>CEvent</code> ATL class."}], "tags": [], "owner": {"reputation": 64286, "user_id": 868014, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PoaTp.png?s=128&g=1", "display_name": "Roman R.", "link": "https://stackoverflow.com/users/868014/roman-r"}, "is_accepted": true, "score": 2, "last_activity_date": 1504202170, "last_edit_date": 1504202170, "creation_date": 1504113517, "answer_id": 45966291, "question_id": 45962088, "link": "https://stackoverflow.com/questions/45962088/isamplegrabberfilter-one-frame-step-at-a-time/45966291#45966291", "title": "ISampleGrabberFilter one frame step at a time", "body": "<p>You discovered that <code>IVideoFrameStep</code> has certain requirements to work and the idea behind it is that entire filter graph does state transitions, runs and pauses playing exactly one frame. </p>\n\n<p>To get all frames once by one using Sample Grabber you can implement an easier approach, which does not have any special requirements.</p>\n\n<ol>\n<li>Have your filter graph running; it would make sense to remove clock from the graph - see <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/dd406921\" rel=\"nofollow noreferrer\"><code>IMediaFilter::SetSyncSource(NULL)</code></a></li>\n<li>Have a Sample Grabber at position of interest with a <code>SampleCB</code> callback</li>\n<li>Once you have your <code>SampleCB</code> executed, do your thing with the data and indicate frame availability to higher level code that runs the graph</li>\n<li>While inside <code>SampleCB</code> and #3 above is done, do not return from the method and instead fall into wait on a event, which is to indicate that you are ready to continue</li>\n<li>High level application code would process a frame and set the event from #4 above allowing <code>SampleCB</code> to exit and to work further on getting a new frame; with the new frame you are repeating from #3 above.</li>\n</ol>\n\n<p>That is, your <code>SampleCB</code> wait is locking the entire pipeline preserving its state for the required time letting you process frame by frame at the convenient pace.</p>\n\n<p>Pseudo code for the <code>SampleCB</code> would be (with manual set/reset events):</p>\n\n<pre><code>data m_Data;\nevent m_DataAvailability;\nevent m_NextFrameRequest;\n\nvoid SampleCB(Frame)\n{\n  m_Data = Frame.GetData();\n  m_DataAvailability.Set();\n  m_NextFrameRequest.WaitFor(); // Sleeping here until signaled to continue\n  m_NextFrameRequest.Reset();\n}\n\ndata ReadNextFrame()\n{\n  m_DataAvailability.WaitFor();\n  data Data = m_Data;\n  m_DataAvailability.Reset(); // Current data processed, we need next portion\n  m_NextFrameRequest.Set(); // Indicate that we allow next callback call\n  return Data; // Make captured frame available\n}\n</code></pre>\n"}], "owner": {"reputation": 787, "user_id": 3419885, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/100001500229007/picture?type=large", "display_name": "mbaros", "link": "https://stackoverflow.com/users/3419885/mbaros"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 0, "accepted_answer_id": 45966291, "answer_count": 1, "score": 3, "last_activity_date": 1504202170, "creation_date": 1504100495, "question_id": 45962088, "link": "https://stackoverflow.com/questions/45962088/isamplegrabberfilter-one-frame-step-at-a-time", "title": "ISampleGrabberFilter one frame step at a time", "body": "<p>I have a graph end point of which is a <strong>SampleGrabber</strong> where I get uncompressed data of all frames using callback function.</p>\n\n<p>In my top level interface code I want to have a function <strong>ReadNextFrame()</strong> which gets the data of the next frame in the graph (until it reaches the end of file).</p>\n\n<p>A performance-wise bad implementation would be to pass a <strong>nextFrameIndex</strong> to grabberCB class specifying which frame I want at this moment. So my callback function would skip all other frames and would pick only the one I want. This is costly since the graph has to travel through the whole file for picking a single frame data.</p>\n\n<p>I noticed there is a <strong>IVideoFrameStep</strong> interface which is ideally what I want. But it seems that this interface is not compatible with Sample Grabber and it's documentation says:</p>\n\n<blockquote>\n  <p>Decoders that implement frame-accurate seeking under Microsoft\n  DirectShow must implement the AM_KSPROPSETID_FrameStep property set,\n  which is used in conjunction with the IVideoFrameStep interface.</p>\n</blockquote>\n\n<p>I tried to connect it to my graph but <strong>IVideoFrameStep::CanStep()</strong> function returned false for me meaning that I can't use it with Sample Grabber.</p>\n\n<p>So my question is: Is there an easy and performance-wise good solution so I can have my graph to keep the current state and then make a single frame forward and get the data using Sample Grabber?</p>\n"}, {"tags": ["c++", "glsl", "shader", "cocos2d-x"], "answers": [{"tags": [], "owner": {"reputation": 138010, "user_id": 5577765, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LoGpC.jpg?s=128&g=1", "display_name": "Rabbid76", "link": "https://stackoverflow.com/users/5577765/rabbid76"}, "is_accepted": true, "score": 8, "last_activity_date": 1537909114, "last_edit_date": 1537909114, "creation_date": 1504108542, "answer_id": 45964904, "question_id": 45962006, "link": "https://stackoverflow.com/questions/45962006/colorize-sprites-from-grayscale-to-color/45964904#45964904", "title": "Colorize sprites from grayscale to color", "body": "<p>To tone a grayscale sprite, can be done by a simple fragment shader, which multiplies the color of the texel of the texture, with a tint color.\nThis causes that a constant color is varayed in the brightness by the grayscale texture.<br/>\nAll the following shaders consider <a href=\"http://apoorvaj.io/alpha-compositing-opengl-blending-and-premultiplied-alpha.html\" rel=\"nofollow noreferrer\">Premultiplied Alpha</a>.</p>\n\n<p>Vertex shader <em>shader/tone.vert</em></p>\n\n<pre><code>attribute vec4 a_position;\nattribute vec2 a_texCoord;\n\nvarying vec2 cc_FragTexCoord1;\n\nvoid main()\n{\n    gl_Position      = CC_PMatrix * a_position;\n    cc_FragTexCoord1 = a_texCoord;\n}\n</code></pre>\n\n<p>Fragment shader <em>shader/tone.frag</em></p>\n\n<pre><code>#ifdef GL_ES\nprecision mediump float;\n#endif\n\nvarying vec2 cc_FragTexCoord1;\n\nuniform vec3 u_tintColor;\n\nvoid main()\n{\n    float normTint = 0.30 * u_tintColor.r + 0.59 * u_tintColor.g + 0.11 * u_tintColor.b;\n    vec4  texColor = texture2D( CC_Texture0, cc_FragTexCoord1 );\n    vec3  mixColor = u_tintColor * texColor / normTint;\n    gl_FragColor   = vec4( mixColor.rgb, texColor.a );\n}\n</code></pre>\n\n<p>Add a class member for the shader program object:</p>\n\n<pre><code>cocos2d::GLProgram* mProgram;\n</code></pre>\n\n<p>Create a shader program, add it to the sprite and set up the uniforms during initialization:</p>\n\n<pre><code>auto sprite = cocos2d::Sprite::create( ..... );\nsprite-&gt;setPosition( ..... );\n\nmProgram = new cocos2d::GLProgram();\nmProgram-&gt;initWithFilenames(\"shader/tone.vert\", \"shader/tone.frag\");\nmProgram-&gt;bindAttribLocation(GLProgram::ATTRIBUTE_NAME_POSITION, GLProgram::VERTEX_ATTRIB_POSITION);\nmProgram-&gt;bindAttribLocation(GLProgram::ATTRIBUTE_NAME_TEX_COORD, GLProgram::VERTEX_ATTRIB_TEX_COORDS);\nmProgram-&gt;link();\nmProgram-&gt;updateUniforms(); \nmProgram-&gt;use();\n\nGLProgramState* state = GLProgramState::getOrCreateWithGLProgram(mProgram);\nsprite-&gt;setGLProgram(mProgram);\nsprite-&gt;setGLProgramState(state);\n\ncocos2d::Color3B tintColor( 255, 255, 0 ); // e.g yellow\ncocos2d::Vec3 tintVal( tintColor.r/255.0f, tintColor.g/255.0f, tintColor.b/255.0f );\nstate-&gt;setUniformVec3(\"u_tintColor\", tintVal);\n</code></pre>\n\n<h3>Create grayscale from sprite and tint the grayscale</h3>\n\n<p>If you first have to create a grayscale from an RGB sprite and second you want to tint the sprite, then you have to adapt the fragment shader slightly.</p>\n\n<p>A grayscale color is usually created with the formula <code>gray = 0.2126 * red + 0.7152 * green + 0.0722 * blue</code> (On the web there are different luminance formulas and explanations: <a href=\"https://en.wikipedia.org/wiki/Luma_(video)\" rel=\"nofollow noreferrer\">Luma (video)</a>, <a href=\"http://www.tannerhelland.com/3643/grayscale-image-algorithm-vb6/\" rel=\"nofollow noreferrer\">Seven grayscale conversion algorithms</a>.)\nDepending on the distance, you interpolate between the original color and the black and white color.</p>\n\n<pre><code>#ifdef GL_ES\nprecision mediump float;\n#endif\n\nvarying vec2 cc_FragTexCoord1;\n\nuniform vec3 u_tintColor;\n\nvoid main()\n{\n    float normTint = 0.30 * u_tintColor.r + 0.59 * u_tintColor.g + 0.11 * u_tintColor.b;\n    vec4  texColor = texture2D( CC_Texture0, cc_FragTexCoord1 );\n    float gray     = 0.30 * texColor.r + 0.59 * texColor.g + 0.11 * texColor.b;\n    vec3  mixColor = u_tintColor * gray / normTint;\n    gl_FragColor   = vec4( mixColor.rgb, texColor.a );\n}\n</code></pre>\n\n<p><br/></p>\n\n<h3>Gradient texture mapping</h3>\n\n<p>To do the mapping from the grayscale to the color, a gradient texture can be used too. See the following fragment shader:</p>\n\n<pre><code>#ifdef GL_ES\nprecision mediump float;\n#endif\n\nvarying vec2 cc_FragTexCoord1;\n\nuniform sampler2D u_texGrad;\n\nvoid main()\n{\n    vec4  texColor  = texture2D( CC_Texture0, cc_FragTexCoord1 );\n    vec4  lookUpCol = texture2D( u_texGrad, vec2( texColor.r / max(texColor.a, 0.01), 0.0 ) );\n    float alpha     = texColor.a * lookUpCol.a;\n    gl_FragColor    = vec4( lookUpCol.rgb * alpha, alpha );\n}\n</code></pre>\n\n<p>To use this shader, a 2D texture mebmer has to be add:</p>\n\n<pre><code>cocos2d::Texture2D* mGradinetTexture;\n</code></pre>\n\n<p>The texture and the uniform has to be set up like this:</p>\n\n<pre><code>std::string     gradPath = FileUtils::getInstance()-&gt;fullPathForFilename(\"grad.png\");\ncocos2d::Image *gradImg  = new Image();\ngradImg-&gt;initWithImageFile( gradPath );\nmGradinetTexture = new Texture2D();\nmGradinetTexture-&gt;setAliasTexParameters();\nmGradinetTexture-&gt;initWithImage( gradImg );\n\nstate-&gt;setUniformTexture(\"u_texGrad\", mGradinetTexture);\n</code></pre>\n\n<p>A further improvement would be to automatically adjust the gradient of the color</p>\n\n<pre><code>#ifdef GL_ES\nprecision mediump float;\n#endif\n\nvarying vec2 cc_FragTexCoord1;\n\nuniform sampler2D u_texGrad;\n\nvoid main()\n{\n    vec4  texColor   = texture2D( CC_Texture0, cc_FragTexCoord1 );\n    vec4  lookUpCol  = texture2D( u_texGrad, vec2( texColor.r / max(texColor.a, 0.01), 0.5 ) );\n    float lookUpGray = 0.30 * lookUpCol.r + 0.59 * lookUpCol.g + 0.11 * lookUpCol.b;\n    lookUpCol       *= texColor.r / lookUpGray;\n    float alpha     = texColor.a * lookUpCol.a;\n    gl_FragColor    = vec4( lookUpCol.rgb * alpha, alpha );\n}\n</code></pre>\n\n<p>If there should be a hard transition between the opaque part of the texture and the transparent part of the texture, then the part of the shaders, which sets the fragment color has to be adapted like this:</p>\n\n<pre><code>float alpha  = step( 0.5, texColor.a ) * lookUpCol.a;\ngl_FragColor = vec4( lookUpCol.rgb * alpha, alpha );\n</code></pre>\n\n<p><br/></p>\n\n<h3>Generating a gradient texture</h3>\n\n<p>To create a gradient texture by a set of colors, I suggest <a href=\"https://en.wikipedia.org/wiki/Newton_polynomial\" rel=\"nofollow noreferrer\">Newton polynomial</a>. The following algorithm deals with any number of colors, which have to be distributed over the gradient.\nEach color has to be mapped to an gray value, and the gray values have to be setup in ascending order. The algorithm has to be setup with at least 2 colors.</p>\n\n<p>This means for example, if there are the colors <code>c0</code>, <code>c1</code> and <code>c2</code>, which corresponds to the gray scale values <code>g0</code>, <code>g1</code> and <code>g2</code>, the the algorithm has to be initialized like this:</p>\n\n<p><a href=\"https://i.stack.imgur.com/jc0KQ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/jc0KQ.png\" alt=\"enter image description here\"></a></p>\n\n<pre><code>g0 = 131\ng1 = 176\ng2 = 244\n\nstd::vector&lt; cocos2d::Color3B &gt; gradBase{ cg0,          cg1,          cg2 };\nstd::vector&lt; float &gt;            x_val{    131 / 255.0f, 176 / 255.0f, 244 / 255.0f };\n\nstd::vector&lt; cocos2d::Color3B &gt; gradBase{ cr0,          cr1,          cr2 };\nstd::vector&lt; float &gt;            x_val{    131 / 255.0f, 176 / 255.0f, 244 / 255.0f };\n</code></pre>\n\n<p>C++ code:</p>\n\n<pre><code>unsigned char ClampColor( float colF )\n{\n    int c = (int)(colF * 255.0f + 0.5f);\n    return (unsigned char)(c &lt; 0 ? 0 : ( c &gt; 255 ? 255 : c ));\n}\n</code></pre>\n\n<p><br/></p>\n\n<pre><code>std::vector&lt; cocos2d::Color3B &gt; gradBase{ c0, c1, ..., cN };\nstd::vector&lt; float &gt;            x_val{    g0, g1, ..., gn };\n\nfor ( int g = 0; g &lt; x_val.size(); ++ g ) {\n    x_val[g] = x_val[g] / 255.0f;\n}\nx_val.push_back( 1.0f );\ngradBase.push_back( Color3B( 255, 255, 255 ) );\nstd::vector&lt; std::array&lt; float, 3 &gt; &gt; alpha;\nfor ( int c = 0; c &lt; (int)gradBase.size(); ++c )\n{\n  std::array&lt; float, 3 &gt;alphaN{ gradBase[c].r / 255.0f, gradBase[c].g / 255.0f, gradBase[c].b / 255.0f };\n  for ( int i = 0; i &lt; c; ++ i )\n  {\n    alphaN[0] = ( alphaN[0] - alpha[i][0] ) / (x_val[c]-x_val[i]);\n    alphaN[1] = ( alphaN[1] - alpha[i][1] ) / (x_val[c]-x_val[i]);\n    alphaN[2] = ( alphaN[2] - alpha[i][2] ) / (x_val[c]-x_val[i]);\n  }\n  alpha.push_back( alphaN );\n}\nstd::array&lt; unsigned char, 256 * 4 &gt; gradPlane;\nfor ( int g = 0; g &lt; 256; ++ g )\n{\n    float x = g / 255.0;\n    std::array&lt; float, 3 &gt;col = alpha[0];\n    if ( x &lt; x_val[0] )\n    {\n      col = { col[0]*x/x_val[0] , col[1]*x/x_val[0], col[2]*x/x_val[0] };\n    }\n    else\n    {\n        for ( int c = 1; c &lt; (int)gradBase.size(); ++c )\n        {\n            float w = 1.0f;\n            for ( int i = 0; i &lt; c; ++ i )\n                w *= x - x_val[i];\n            col = { col[0] + alpha[c][0] * w, col[1] + alpha[c][1] * w, col[2] + alpha[c][2] * w };\n        }\n    }\n    size_t i = g * 4;\n    gradPlane[i+0] = ClampColor(col[0]);\n    gradPlane[i+1] = ClampColor(col[1]);\n    gradPlane[i+2] = ClampColor(col[2]);\n    gradPlane[i+3] = 255;\n}\n</code></pre>\n\n<p><br></p>\n\n<pre><code>mGradinetTexture = new Texture2D();\ncocos2d::Size contentSize;\nmGradinetTexture-&gt;setAliasTexParameters();\nmGradinetTexture-&gt;initWithData( gradPlane.data(), gradPlane.size() / 4, Texture2D::PixelFormat::RGBA8888, 256, 1, contentSize );\n</code></pre>\n\n<p>Note, in this case of course the <strong>shader without the automatically adjustment</strong> has to be used, because the adjustment would linearize the nonlinear gradient.<br/>\nThis is a simple mapping from a grayscale color to a RGB color. The left side of the mapping table (the gray scale values) is constant, while the right side of the table (the RGB values) have to be adjusted to the texture, which has to be recreate from the grayscale texture. The advantage is that all grayscale values can be mapped, because a gradient mapping texture is generated.<br/>\nWhile the colors of the mapping table exactly match to the source texture, the colors in between are interpolated.</p>\n\n<p>Note, that the texture filter parameters have to be set to <code>GL_NEAREST</code>, for the gradient texture, to get a accurate result. In <code>cocos2d-x</code> this can be done by <code>Texture2D::setAliasTexParameters</code>.</p>\n\n<h3>Simplified interpolation algorithm</h3>\n\n<p>Since a color channel is encoded into one byte (<code>unsigned byte</code>) the interpolation algorithm can be simplified, without a noticeable loss of quality, especially if there are some colors more than only 3.<br/>\nThe following algorithm does a linear interpolation of the colors between the base points. From the beginning to the first point there is a linear interpolation from the RGB color (0, 0, 0) to the first color. At the end the (beyond the last base point) the last RGB color is kept, to avoid bright white glitches.</p>\n\n<pre><code>unsigned char ClampColor( float colF )\n{\n    int c = (int)(colF * 255.0f + 0.5f);\n    return (unsigned char)(c &lt; 0 ? 0 : ( c &gt; 255 ? 255 : c ));\n}\n</code></pre>\n\n<p><br/></p>\n\n<pre><code>std::vector&lt; cocos2d::Color4B &gt;gradBase {\n    Color4B( 129, 67, 73, 255 ),\n    Color4B( 144, 82, 84, 255 ),\n    Color4B( 161, 97, 95, 255 ),\n    Color4B( 178, 112, 105, 255 ),\n    Color4B( 195, 126, 116, 255 ),\n    Color4B( 211, 139, 127, 255 ),\n    Color4B( 219, 162, 133, 255 ),\n    Color4B( 228, 185, 141, 255 ),\n    Color4B( 235, 207, 149, 255 ),\n    Color4B( 245, 230, 158, 255 ),\n    Color4B( 251, 255, 166, 255 )\n};\n\nstd::vector&lt; float &gt; x_val { 86, 101, 116, 131, 146, 159, 176, 193, 209, 227, 244 };\nfor ( int g = 0; g &lt; x_val.size(); ++ g ) {\n    x_val[g] = x_val[g] / 255.0f;\n}\n</code></pre>\n\n<p><br/></p>\n\n<pre><code>std::array&lt; unsigned char, 256 * 4 &gt; gradPlane;\nsize_t x_i = 0;\nfor ( int g = 0; g &lt; 256; ++ g )\n{\n    float x = g / 255.0;\n    if ( x_i &lt; x_val.size()-1 &amp;&amp; x &gt;= x_val[x_i] )\n      ++ x_i;\n\n    std::array&lt; float, 4 &gt; col;\n    if ( x_i == 0 )\n    {   \n        std::array&lt; float, 4 &gt; col0{ gradBase[0].r / 255.0f, gradBase[0].g / 255.0f, gradBase[0].b / 255.0f, gradBase[0].a / 255.0f };\n        col = { col0[0]*x/x_val[0] , col0[1]*x/x_val[0], col0[2]*x/x_val[0], col0[3]*x/x_val[0] };\n    }\n    else if ( x_i == x_val.size() )\n    {\n        col = { gradBase.back().r / 255.0f, gradBase.back().g / 255.0f, gradBase.back().b / 255.0f, gradBase.back().a / 255.0f };             \n    }\n    else\n    {\n        std::array&lt; float, 4 &gt; col0{ gradBase[x_i-1].r / 255.0f, gradBase[x_i-1].g / 255.0f, gradBase[x_i-1].b / 255.0f, gradBase[x_i-1].a / 255.0f };\n        std::array&lt; float, 4 &gt; col1{ gradBase[x_i].r / 255.0f, gradBase[x_i].g / 255.0f, gradBase[x_i].b / 255.0f, gradBase[x_i].a / 255.0f };\n        float a = (x - x_val[x_i-1]) / (x_val[x_i] - x_val[x_i-1]);\n        col = { col0[0] + (col1[0]-col0[0])*a, col0[1] + (col1[1]-col0[1])*a, col0[2] + (col1[2]-col0[2])*a, col0[3] + (col1[3]-col0[3])*a };\n    }\n\n    size_t i = g * 4;\n    gradPlane[i+0] = ClampColor(col[0]);\n    gradPlane[i+1] = ClampColor(col[1]);\n    gradPlane[i+2] = ClampColor(col[2]);\n    gradPlane[i+3] = ClampColor(col[3]);\n}\n</code></pre>\n"}], "owner": {"reputation": 373, "user_id": 1823922, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Jh3ov.png?s=128&g=1", "display_name": "KAMIKAZE", "link": "https://stackoverflow.com/users/1823922/kamikaze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1658, "favorite_count": 6, "accepted_answer_id": 45964904, "answer_count": 1, "score": 9, "last_activity_date": 1580211129, "creation_date": 1504100289, "last_edit_date": 1580211129, "question_id": 45962006, "link": "https://stackoverflow.com/questions/45962006/colorize-sprites-from-grayscale-to-color", "title": "Colorize sprites from grayscale to color", "body": "<p>I have a lot of same graphics but different colors. I want to optimize it by colorizing from grayscale image. Also, I would like to change it color on a fly, during gameplay for a live sprite object. Also gradually change color values from one color type to another.</p>\n\n<p><a href=\"https://www.codeproject.com/Articles/31120/Image-Transformation-Grayscale-to-Color\" rel=\"nofollow noreferrer\">Don't know it it useful - Image-Transformation-Grayscale-to-Color.</a> </p>\n"}, {"tags": ["c++", "windows", "acl", "impersonation", "ntfs"], "comments": [{"owner": {"reputation": 1190, "user_id": 1198416, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/d63672e3dd37442e70707cb6b51bffdd?s=128&d=identicon&r=PG", "display_name": "WebDrive", "link": "https://stackoverflow.com/users/1198416/webdrive"}, "edited": false, "score": 0, "creation_date": 1504100205, "post_id": 45961952, "comment_id": 78882269, "body": "Oh, and I have verified that the service has access to the \\\\server\\share\\ and also to the folder. And the folder does exist. The call works great most of the time, then will simply fail until I restart the Service."}, {"owner": {"reputation": 25518, "user_id": 6401656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jtwou.jpg?s=128&g=1", "display_name": "RbMm", "link": "https://stackoverflow.com/users/6401656/rbmm"}, "edited": false, "score": 0, "creation_date": 1504101010, "post_id": 45961952, "comment_id": 78882954, "body": "the <code>\\\\server\\share</code> associated with which logon session luid ? and which luid you have in token when call  <i>GetNamedSecurityInfo</i> ?"}, {"owner": {"reputation": 1190, "user_id": 1198416, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/d63672e3dd37442e70707cb6b51bffdd?s=128&d=identicon&r=PG", "display_name": "WebDrive", "link": "https://stackoverflow.com/users/1198416/webdrive"}, "reply_to_user": {"reputation": 25518, "user_id": 6401656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jtwou.jpg?s=128&g=1", "display_name": "RbMm", "link": "https://stackoverflow.com/users/6401656/rbmm"}, "edited": false, "score": 0, "creation_date": 1504101602, "post_id": 45961952, "comment_id": 78883468, "body": "the service is logged in under &quot;NT Authority\\System&quot;. the NTFS ACL on the &#39;share&#39; has Everyone with Full Rights; and the underlying directory on the C:\\ being referenced by the share has an NTFS ACL with Everyone/Full Rights too."}, {"owner": {"reputation": 25518, "user_id": 6401656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jtwou.jpg?s=128&g=1", "display_name": "RbMm", "link": "https://stackoverflow.com/users/6401656/rbmm"}, "edited": false, "score": 0, "creation_date": 1504102442, "post_id": 45961952, "comment_id": 78884117, "body": "no, you don&#39;t understand. i ask about logon session luid. <code>\\\\server\\share</code> is visible only for some logon session. result depend from luid in your token. so i and ask - for which luid this share is created ? and which luid in your token ?"}, {"owner": {"reputation": 33265, "user_id": 886887, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/1616c7e4fab23f6e014ee11d75408bba?s=128&d=identicon&r=PG", "display_name": "Harry Johnston", "link": "https://stackoverflow.com/users/886887/harry-johnston"}, "reply_to_user": {"reputation": 25518, "user_id": 6401656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jtwou.jpg?s=128&g=1", "display_name": "RbMm", "link": "https://stackoverflow.com/users/6401656/rbmm"}, "edited": false, "score": 0, "creation_date": 1504153251, "post_id": 45961952, "comment_id": 78905141, "body": "@RbMm, a UNC path should work from any logon session, shouldn&#39;t it?  I thought that if there wasn&#39;t an existing connection for the logon session, one would be created, provided the user represented by the token has access to the share."}, {"owner": {"reputation": 33265, "user_id": 886887, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/1616c7e4fab23f6e014ee11d75408bba?s=128&d=identicon&r=PG", "display_name": "Harry Johnston", "link": "https://stackoverflow.com/users/886887/harry-johnston"}, "edited": false, "score": 0, "creation_date": 1504153293, "post_id": 45961952, "comment_id": 78905157, "body": "Not sure if this is really related to your problem, but I think you should be checking for unexpected impersonation and explicitly raising an error condition, not just calling RevertToSelf() at random."}, {"owner": {"reputation": 25518, "user_id": 6401656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jtwou.jpg?s=128&g=1", "display_name": "RbMm", "link": "https://stackoverflow.com/users/6401656/rbmm"}, "reply_to_user": {"reputation": 33265, "user_id": 886887, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/1616c7e4fab23f6e014ee11d75408bba?s=128&d=identicon&r=PG", "display_name": "Harry Johnston", "link": "https://stackoverflow.com/users/886887/harry-johnston"}, "edited": false, "score": 0, "creation_date": 1504166229, "post_id": 45961952, "comment_id": 78910916, "body": "@HarryJohnston - yes, my mistake. this not exactly depend from logon session. however not worked from <i>LocalSystem</i> ( <code>S-1-5-18</code>). when i impersonate with this token i got error <code>ERROR_NO_SUCH_LOGON_SESSION</code>. after <code>RevertToSelf()</code> all ok. so exactly under &quot;NT Authority\\System&quot; must and not work, but with another error."}, {"owner": {"reputation": 33265, "user_id": 886887, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/1616c7e4fab23f6e014ee11d75408bba?s=128&d=identicon&r=PG", "display_name": "Harry Johnston", "link": "https://stackoverflow.com/users/886887/harry-johnston"}, "reply_to_user": {"reputation": 25518, "user_id": 6401656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jtwou.jpg?s=128&g=1", "display_name": "RbMm", "link": "https://stackoverflow.com/users/6401656/rbmm"}, "edited": false, "score": 0, "creation_date": 1504169391, "post_id": 45961952, "comment_id": 78912923, "body": "@RbMm, that should still work as far as I can see?  Provided you&#39;re in a domain of course.  Impersonation doesn&#39;t necessarily give you access to network files but once you&#39;ve reverted it ought to work just the same as if you&#39;d never impersonated ... is this another Windows bug?"}, {"owner": {"reputation": 25518, "user_id": 6401656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jtwou.jpg?s=128&g=1", "display_name": "RbMm", "link": "https://stackoverflow.com/users/6401656/rbmm"}, "reply_to_user": {"reputation": 33265, "user_id": 886887, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/1616c7e4fab23f6e014ee11d75408bba?s=128&d=identicon&r=PG", "display_name": "Harry Johnston", "link": "https://stackoverflow.com/users/886887/harry-johnston"}, "edited": false, "score": 0, "creation_date": 1504169899, "post_id": 45961952, "comment_id": 78913282, "body": "@HarryJohnston - i simply try say that under local system token <code>GetNamedSecurityInfo</code> or <code>CreateFile</code> return <code>ERROR_NO_SUCH_LOGON_SESSION</code> while under another account i can open file, or another errors ( <code>ERROR_[NETWORK_]ACCESS_DENIED</code>). but not view <code>ERROR_FILE_NOT_FOUND</code> if file actually exist - this error really not depend from token."}, {"owner": {"reputation": 25518, "user_id": 6401656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jtwou.jpg?s=128&g=1", "display_name": "RbMm", "link": "https://stackoverflow.com/users/6401656/rbmm"}, "edited": false, "score": 0, "creation_date": 1504170579, "post_id": 45961952, "comment_id": 78913747, "body": "<a href=\"https://technet.microsoft.com/en-us/library/aa385418.aspx\" rel=\"nofollow noreferrer\"><i>It is not possible to connect to other PC/network resource under LocalSystem account</i></a> or <a href=\"https://stackoverflow.com/questions/2968426/wnetaddconnection2-from-a-windows-service\" title=\"wnetaddconnection2 from a windows service\">stackoverflow.com/questions/2968426/&hellip;</a>"}, {"owner": {"reputation": 1190, "user_id": 1198416, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/d63672e3dd37442e70707cb6b51bffdd?s=128&d=identicon&r=PG", "display_name": "WebDrive", "link": "https://stackoverflow.com/users/1198416/webdrive"}, "edited": false, "score": 0, "creation_date": 1504463468, "post_id": 45961952, "comment_id": 79012667, "body": "So it turned out that some how the impersonation token became corrupt or was closed inadvertantly. RevertToSelf forced back to Local System which doesn&#39;t know about the UNC share so it accurately returned 2.  Thanks for the help, I&#39;ll close this out."}, {"owner": {"reputation": 33265, "user_id": 886887, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/1616c7e4fab23f6e014ee11d75408bba?s=128&d=identicon&r=PG", "display_name": "Harry Johnston", "link": "https://stackoverflow.com/users/886887/harry-johnston"}, "reply_to_user": {"reputation": 25518, "user_id": 6401656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jtwou.jpg?s=128&g=1", "display_name": "RbMm", "link": "https://stackoverflow.com/users/6401656/rbmm"}, "edited": false, "score": 0, "creation_date": 1504474243, "post_id": 45961952, "comment_id": 79015936, "body": "It should be noted that the comment @RbMm links to above is wrong; you <i>can</i> connect to a network resource as local system, provided the computer is joined to an Active Directory domain.  (And of course the server has to be joined to the same domain, or one with a trust relationship.)"}, {"owner": {"reputation": 25518, "user_id": 6401656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jtwou.jpg?s=128&g=1", "display_name": "RbMm", "link": "https://stackoverflow.com/users/6401656/rbmm"}, "edited": false, "score": 0, "creation_date": 1504476172, "post_id": 45961952, "comment_id": 79016388, "body": "yes, under some conditions connections from Local System work. say when share really point to the localhost. and probably with Active Directory domain - i have no knowledge here. but i be paid more attention to the error - <code>ERROR_FILE_NOT_FOUND</code>. i sure that if we have problem with impersonation/account - will be another error. for example <code>ERROR_NO_SUCH_LOGON_SESSION</code>, may be so another. let be even <code>ERROR_PATH_NOT_FOUND</code> but not <code>ERROR_FILE_NOT_FOUND</code>. here something else. i be do more research here. and at first try direct open files instead call <code>GetNamedSecurityInfo</code>"}], "answers": [{"tags": [], "owner": {"reputation": 1190, "user_id": 1198416, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/d63672e3dd37442e70707cb6b51bffdd?s=128&d=identicon&r=PG", "display_name": "WebDrive", "link": "https://stackoverflow.com/users/1198416/webdrive"}, "is_accepted": false, "score": 0, "last_activity_date": 1504463505, "creation_date": 1504463505, "answer_id": 46026627, "question_id": 45961952, "link": "https://stackoverflow.com/questions/45961952/getnamedsecurityinfo-intermittent-failure-with-error-2/46026627#46026627", "title": "GetNamedSecurityInfo Intermittent failure with error=2", "body": "<p>So it turned out that some how the impersonation token became corrupt or was closed inadvertantly. RevertToSelf forced back to Local System which doesn't know about the UNC share so it accurately returned 2. Thanks for the help, I'll close this out.</p>\n"}], "owner": {"reputation": 1190, "user_id": 1198416, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/d63672e3dd37442e70707cb6b51bffdd?s=128&d=identicon&r=PG", "display_name": "WebDrive", "link": "https://stackoverflow.com/users/1198416/webdrive"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 384, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1504463505, "creation_date": 1504100124, "question_id": 45961952, "link": "https://stackoverflow.com/questions/45961952/getnamedsecurityinfo-intermittent-failure-with-error-2", "title": "GetNamedSecurityInfo Intermittent failure with error=2", "body": "<p>I have a C++ program running as a system service under \"NT Authority\\System\".</p>\n\n<p>The program has multiple threads, and each thread will occasionally wake up and try to load the ACL for a specified path. The problem I am running in to is that I sporadically see the GetNamedSecurityInfo() call fail with Error=2, File Not Found. The strange thing is that this call will succeed with the same path for a while, then something happens, and the call will then fail.</p>\n\n<p>My Code looks like this:</p>\n\n<pre><code>        SE_OBJECT_TYPE dwObjectType = SE_FILE_OBJECT;\n        LPTSTR szFile = _T(\"\\\\\\\\server\\\\share\\\\folder\");\n        DWORD dwError = ::GetNamedSecurityInfo(szFile, dwObjectType, DACL_SECURITY_INFORMATION | OWNER_SECURITY_INFORMATION | GROUP_SECURITY_INFORMATION, 0, 0, &amp;pDacl, 0, (void**)&amp;pSD);\n        if (dwError || !pDacl)\n        {\n            TRACE(_T(\"Error=%d\\n\"),dwError);\n            // try it again, maybe I was impersonating a different AD user by mistake.\n            ::RevertToSelf();\n            dwError = ::GetNamedSecurityInfo(szFile, dwObjectType, DACL_SECURITY_INFORMATION | OWNER_SECURITY_INFORMATION | GROUP_SECURITY_INFORMATION, 0, 0, &amp;pDacl, 0, (void**)&amp;pSD);\n            TRACE(_T(\"Error=%d\\n\"),dwError);\n        }\n</code></pre>\n\n<p>I've been beating my head against a wall for days on this one and any help would be greatly appreciated.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["android", "c++", "android-ndk", "ndk-build"], "comments": [{"owner": {"reputation": 52300, "user_id": 192373, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/83a45711c4c32eeeb3826d279e50f8ab?s=128&d=identicon&r=PG", "display_name": "Alex Cohn", "link": "https://stackoverflow.com/users/192373/alex-cohn"}, "edited": false, "score": 0, "creation_date": 1504116872, "post_id": 45961780, "comment_id": 78893392, "body": "Your observation is correct. The recent released of Android NDK define <code>__ANDROID_API__</code> to point to the platform level (normally, it is derived from <code>APP_PLATFORM</code> parameter for <b>ndk-build</b>). Why do you add this flag in your <b>Android.mk</b>?"}, {"owner": {"reputation": 71, "user_id": 4568938, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-zy0EjwC0yJg/AAAAAAAAAAI/AAAAAAAAACg/Ny1pHS5cRC8/photo.jpg?sz=128", "display_name": "waqas akram", "link": "https://stackoverflow.com/users/4568938/waqas-akram"}, "reply_to_user": {"reputation": 52300, "user_id": 192373, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/83a45711c4c32eeeb3826d279e50f8ab?s=128&d=identicon&r=PG", "display_name": "Alex Cohn", "link": "https://stackoverflow.com/users/192373/alex-cohn"}, "edited": false, "score": 0, "creation_date": 1504593635, "post_id": 45961780, "comment_id": 79056272, "body": "Actually This is my very old project and i shifted to Android studio so i stuck here and can&#39;t find any solution."}, {"owner": {"reputation": 52300, "user_id": 192373, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/83a45711c4c32eeeb3826d279e50f8ab?s=128&d=identicon&r=PG", "display_name": "Alex Cohn", "link": "https://stackoverflow.com/users/192373/alex-cohn"}, "edited": false, "score": 0, "creation_date": 1504610240, "post_id": 45961780, "comment_id": 79066522, "body": "Your script expects 3 prebuilt libraries: Prebuild_usb1.0 Prebuild_ftrScanAPI Prebuild_ftrAnsiSDK, but you only define one"}, {"owner": {"reputation": 71, "user_id": 4568938, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-zy0EjwC0yJg/AAAAAAAAAAI/AAAAAAAAACg/Ny1pHS5cRC8/photo.jpg?sz=128", "display_name": "waqas akram", "link": "https://stackoverflow.com/users/4568938/waqas-akram"}, "reply_to_user": {"reputation": 52300, "user_id": 192373, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/83a45711c4c32eeeb3826d279e50f8ab?s=128&d=identicon&r=PG", "display_name": "Alex Cohn", "link": "https://stackoverflow.com/users/192373/alex-cohn"}, "edited": false, "score": 0, "creation_date": 1504610809, "post_id": 45961780, "comment_id": 79066887, "body": "I update my question please review it."}, {"owner": {"reputation": 52300, "user_id": 192373, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/83a45711c4c32eeeb3826d279e50f8ab?s=128&d=identicon&r=PG", "display_name": "Alex Cohn", "link": "https://stackoverflow.com/users/192373/alex-cohn"}, "edited": false, "score": 0, "creation_date": 1504613746, "post_id": 45961780, "comment_id": 79068816, "body": "First, remove the line <code>LOCAL_CFLAGS := -D__ANDROID_API__</code> from your Android,mk; second, if you use integrated ndk-build in Android Studio, add <a href=\"https://stackoverflow.com/a/45604243/192373\">abiFilters</a> to <b>build.gradle</b> because APP_ABI is ignored."}], "owner": {"reputation": 71, "user_id": 4568938, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-zy0EjwC0yJg/AAAAAAAAAAI/AAAAAAAAACg/Ny1pHS5cRC8/photo.jpg?sz=128", "display_name": "waqas akram", "link": "https://stackoverflow.com/users/4568938/waqas-akram"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1265, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1504611172, "creation_date": 1504099683, "last_edit_date": 1504611172, "question_id": 45961780, "link": "https://stackoverflow.com/questions/45961780/getting-error-linker-command-failed-with-exit-code-in-ndk", "title": "Getting error linker command failed with exit code in NDK", "body": "<p>Here is my Android.mk file </p>\n\n<pre><code>LOCAL_PATH := $(call my-dir)\n\ninclude $(CLEAR_VARS)\nLOCAL_MODULE    := Prebuild_usb1.0\nLOCAL_SRC_FILES :=$(TARGET_ARCH_ABI)/libusb-1.0.so\ninclude $(PREBUILT_SHARED_LIBRARY) \n\ninclude $(CLEAR_VARS)\nLOCAL_MODULE    := Prebuild_ftrScanAPI\nLOCAL_SRC_FILES := $(TARGET_ARCH_ABI)/libftrScanAPI.so\ninclude $(PREBUILT_SHARED_LIBRARY) \n\ninclude $(CLEAR_VARS)\nLOCAL_MODULE    := Prebuild_ftrAnsiSDK\nLOCAL_SRC_FILES := $(TARGET_ARCH_ABI)/libftrAnsiSDK.so\ninclude $(PREBUILT_SHARED_LIBRARY) \n\ninclude $(CLEAR_VARS)\nLOCAL_MODULE    := ftrAnsiSDKAndroidJni\nLOCAL_CFLAGS := -D__ANDROID_API__\n\nLOCAL_SRC_FILES := ftrAnsiSDKAndroidJni.cpp\nLOCAL_SHARED_LIBRARIES := Prebuild_usb1.0 Prebuild_ftrScanAPI \nPrebuild_ftrAnsiSDK\ninclude $(BUILD_SHARED_LIBRARY)\n</code></pre>\n\n<p><strong>And my Application.mk looks like</strong></p>\n\n<pre><code>APP_ABI=armeabi armeabi-v7a\n</code></pre>\n\n<p>I am getting error when i build apk</p>\n\n<blockquote>\n  <p>Error:error: linker command failed with exit code 1 (use -v to see invocation)</p>\n</blockquote>\n\n<p>And sometime studio throws <strong>warning: '__ANDROID_API__' macro redefined</strong></p>\n\n<p>Here is exception</p>\n\n<blockquote>\n  <p>Execution failed for task ':androidHelper:externalNativeBuildDebug'.\n  Build command failed.\n  Error while executing process C:\\Users\\waqas\\AppData\\Local\\Android\\Sdk\\ndk-bundle\\ndk-build.cmd with arguments {NDK_PROJECT_PATH=null APP_BUILD_SCRIPT=D:\\Androidprojects\\androidstudiolatestzongsourceready\\POSApp_AV06_STC_BVS\\androidHelper\\src\\main\\jni\\Android.mk NDK_APPLICATION_MK=D:\\Androidprojects\\androidstudiolatestzongsourceready\\POSApp_AV06_STC_BVS\\androidHelper\\src\\main\\jni\\Application.mk APP_ABI=mips NDK_ALL_ABIS=mips NDK_DEBUG=1 APP_PLATFORM=android-17 NDK_OUT=D:/Androidprojects/androidstudiolatestzongsourceready/POSApp_AV06_STC_BVS/androidHelper/build/intermediates/ndkBuild/debug/obj NDK_LIBS_OUT=D:\\Androidprojects\\androidstudiolatestzongsourceready\\POSApp_AV06_STC_BVS\\androidHelper\\build\\intermediates\\ndkBuild\\debug\\lib D:/Androidprojects/androidstudiolatestzongsourceready/POSApp_AV06_STC_BVS/androidHelper/build/intermediates/ndkBuild/debug/obj/local/mips/libftrAnsiSDKAndroidJni.so}\n  [mips] Compile++      : ftrAnsiSDKAndroidJni &lt;= ftrAnsiSDKAndroidJni.cpp\n  In file included from :333:\n  :4:9: warning: '<strong>ANDROID_API</strong>' macro redefined [-Wmacro-redefined]</p>\n  \n  <h1>define <strong>ANDROID_API</strong> 17</h1>\n\n<pre><code>    ^\n</code></pre>\n  \n  <p>:3:9: note: previous definition is here</p>\n  \n  <h1>define <strong>ANDROID_API</strong> 1</h1>\n</blockquote>\n\n<pre><code>    ^\n</code></pre>\n\n<blockquote>\n  <p>1 warning generated.\n  [mips] SharedLibrary  : libftrAnsiSDKAndroidJni.so\n  D:/Androidprojects/androidstudiolatestzongsourceready/POSApp_AV06_STC_BVS/androidHelper/build/intermediates/ndkBuild/debug/obj/local/mips/libusb-1.0.so: error adding symbols: File in wrong format\n  clang++.exe: error: linker command failed with exit code 1 (use -v to see invocation)\n  make:[D:/Androidprojects/androidstudiolatestzongsourceready/POSApp_AV06_STC_BVS/androidHelper/build/intermediates/ndkBuild/debug/obj/local/mips/libftrAnsiSDKAndroidJni.so] Error 1</p>\n</blockquote>\n"}, {"tags": ["c++", "for-loop", "conditional-statements"], "comments": [{"owner": {"reputation": 33, "user_id": 8538246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eefd336a0f3f6e8a02252992369e0e0d?s=128&d=identicon&r=PG&f=1", "display_name": "Mohamed Safeuq J", "link": "https://stackoverflow.com/users/8538246/mohamed-safeuq-j"}, "reply_to_user": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1504099392, "post_id": 45961620, "comment_id": 78881621, "body": "No no. Not range based for loops. Just a simpler condition."}, {"owner": {"reputation": 2683, "user_id": 5226835, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/8ae0a35e74a44eb63b7cb68b63547d03?s=128&d=identicon&r=PG", "display_name": "rakwaht", "link": "https://stackoverflow.com/users/5226835/rakwaht"}, "edited": false, "score": 0, "creation_date": 1504099463, "post_id": 45961620, "comment_id": 78881680, "body": "what do you mean by simpler?"}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 3, "creation_date": 1504099499, "post_id": 45961620, "comment_id": 78881704, "body": "Perhaps you are thinking of <code>for(int i = 0; arr[i]; ++i)</code> where you iterate until you find a <code>false</code>, <code>nullptr</code> or zero element?"}, {"owner": {"reputation": 33, "user_id": 8538246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eefd336a0f3f6e8a02252992369e0e0d?s=128&d=identicon&r=PG&f=1", "display_name": "Mohamed Safeuq J", "link": "https://stackoverflow.com/users/8538246/mohamed-safeuq-j"}, "reply_to_user": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1504099594, "post_id": 45961620, "comment_id": 78881784, "body": "@Fran&#231;oisAndrieux  Yes. Will that work?? Does it belong to C or C++??"}, {"owner": {"reputation": 2575, "user_id": 4711812, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/87100b6114369140256e64e7ebab7ec9?s=128&d=identicon&r=PG&f=1", "display_name": "muXXmit2X", "link": "https://stackoverflow.com/users/4711812/muxxmit2x"}, "edited": false, "score": 2, "creation_date": 1504099647, "post_id": 45961620, "comment_id": 78881821, "body": "C or C++, these are two very different languages? Also you&#39;re talking about an error, so I ask: Wich error do you get? Please provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. This is possibly a <a href=\"https://meta.stackexchange.com/q/66377/299866\">XY-Problem</a>"}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 1, "creation_date": 1504099916, "post_id": 45961620, "comment_id": 78882042, "body": "Show the code that gives an error."}, {"owner": {"reputation": 9737, "user_id": 1460794, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/7lOXx.png?s=128&g=1", "display_name": "wally", "link": "https://stackoverflow.com/users/1460794/wally"}, "edited": false, "score": 0, "creation_date": 1504099981, "post_id": 45961620, "comment_id": 78882094, "body": "There are some functions that will take the pointer to the first element and keep producing output from the string of characters until it reaches the terminating zero. Is that perhaps what you were thinking of? Something like <code>std::cout &lt;&lt; arr;</code>?"}, {"owner": {"reputation": 12896, "user_id": 104774, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/gQmt5.jpg?s=128&g=1", "display_name": "stefaanv", "link": "https://stackoverflow.com/users/104774/stefaanv"}, "reply_to_user": {"reputation": 15451, "user_id": 6879826, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/WzqBC.png?s=128&g=1", "display_name": "ad absurdum", "link": "https://stackoverflow.com/users/6879826/ad-absurdum"}, "edited": false, "score": 0, "creation_date": 1504100910, "post_id": 45961620, "comment_id": 78882869, "body": "@DavidBowling: this should be an answer like there are already several, except that it is wrong.  It works for litteral strings but not for strings that were filled in during runtime and can be smaller than the used array.."}, {"owner": {"reputation": 15451, "user_id": 6879826, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/WzqBC.png?s=128&g=1", "display_name": "ad absurdum", "link": "https://stackoverflow.com/users/6879826/ad-absurdum"}, "edited": false, "score": 0, "creation_date": 1504101377, "post_id": 45961620, "comment_id": 78883287, "body": "@stefaanv-- well, it would only work for string literals like <code>i &lt; sizeof &quot;some string&quot; - 1</code>. Comment removed."}, {"owner": {"reputation": 15451, "user_id": 6879826, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/WzqBC.png?s=128&g=1", "display_name": "ad absurdum", "link": "https://stackoverflow.com/users/6879826/ad-absurdum"}, "edited": false, "score": 1, "creation_date": 1504101633, "post_id": 45961620, "comment_id": 78883495, "body": "@MohamedSafeuqJ-- from the answers below, you may notice that the choice of language can affect availability and choice of solutions. C and C++ are not the same language, and you should choose only the relevant language tag, unless the goal is explicitly to compare C and C++."}, {"owner": {"reputation": 33, "user_id": 8538246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eefd336a0f3f6e8a02252992369e0e0d?s=128&d=identicon&r=PG&f=1", "display_name": "Mohamed Safeuq J", "link": "https://stackoverflow.com/users/8538246/mohamed-safeuq-j"}, "edited": false, "score": 0, "creation_date": 1504101773, "post_id": 45961620, "comment_id": 78883596, "body": "Ok. Changed it now."}], "answers": [{"comments": [{"owner": {"reputation": 2575, "user_id": 4711812, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/87100b6114369140256e64e7ebab7ec9?s=128&d=identicon&r=PG&f=1", "display_name": "muXXmit2X", "link": "https://stackoverflow.com/users/4711812/muxxmit2x"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1504101914, "post_id": 45961749, "comment_id": 78883689, "body": "@JonathanLeffler see Rons answer, you can in C++. And since the OP has finally decided to use C++, this answer is totally valid ;-)"}, {"owner": {"reputation": 15451, "user_id": 6879826, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/WzqBC.png?s=128&g=1", "display_name": "ad absurdum", "link": "https://stackoverflow.com/users/6879826/ad-absurdum"}, "edited": false, "score": 0, "creation_date": 1504102115, "post_id": 45961749, "comment_id": 78883856, "body": "@muXXmit2X-- do note, though, that both this answer and Jonathan Leffler&#39;s  comment were posted before OP removed the C tag"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 2575, "user_id": 4711812, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/87100b6114369140256e64e7ebab7ec9?s=128&d=identicon&r=PG&f=1", "display_name": "muXXmit2X", "link": "https://stackoverflow.com/users/4711812/muxxmit2x"}, "edited": false, "score": 0, "creation_date": 1504102606, "post_id": 45961749, "comment_id": 78884244, "body": "@muXXmit2X: Since the C tag was removed, I&#39;ll remove my comment.  That it is valid C++ is intriguing; it&#39;s a sufficiently recent change that I&#39;d not noticed it fully.  Thanks."}], "tags": [], "owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "is_accepted": false, "score": 0, "last_activity_date": 1504099588, "creation_date": 1504099588, "answer_id": 45961749, "question_id": 45961620, "link": "https://stackoverflow.com/questions/45961620/is-there-a-simpler-way-to-define-a-condition-in-a-for-loop-in-c/45961749#45961749", "title": "Is there a simpler way to define a condition in a for loop in C++?", "body": "<p>You probably want something likes this:</p>\n\n<pre><code>int main() {\n  char arr[] = \"Hello\";\n\n  for (int i = 0; char c = arr[i]; i++)\n  {\n    putc(c, stdout);\n  }\n}\n</code></pre>\n\n<p>The output will be</p>\n\n<pre><code>Hello\n</code></pre>\n\n<p><code>c = arr[i]</code> will be 0 when yolu come to the end of the string, ans thus the loop will be terminated.</p>\n\n<p>BTW: <code>for(int i = 0; strlen(arr) &gt; i; i++)</code> is correct but inefficient. I let you find out why as an exercise.</p>\n"}, {"comments": [{"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1504099647, "post_id": 45961753, "comment_id": 78881818, "body": "This can work for arrays if you know it contains a value that evaluates to <code>false</code>. It&#39;s just that null terminated strings are guaranteed to always have that property."}, {"owner": {"reputation": 11458, "user_id": 3435400, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/61726fe80facc93d76754f0226b49eb9?s=128&d=identicon&r=PG&f=1", "display_name": "alain", "link": "https://stackoverflow.com/users/3435400/alain"}, "reply_to_user": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1504099755, "post_id": 45961753, "comment_id": 78881910, "body": "Yes, but in my opinion <code>nullptr</code> terminated arrays of pointers are quite rare. Ok, there is <code>argv</code> for example, but else it is quite rare."}, {"owner": {"reputation": 33, "user_id": 8538246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eefd336a0f3f6e8a02252992369e0e0d?s=128&d=identicon&r=PG&f=1", "display_name": "Mohamed Safeuq J", "link": "https://stackoverflow.com/users/8538246/mohamed-safeuq-j"}, "edited": false, "score": 0, "creation_date": 1504100082, "post_id": 45961753, "comment_id": 78882160, "body": "Thanks for the answer"}], "tags": [], "owner": {"reputation": 11458, "user_id": 3435400, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/61726fe80facc93d76754f0226b49eb9?s=128&d=identicon&r=PG&f=1", "display_name": "alain", "link": "https://stackoverflow.com/users/3435400/alain"}, "is_accepted": true, "score": 2, "last_activity_date": 1504099854, "last_edit_date": 1504099854, "creation_date": 1504099592, "answer_id": 45961753, "question_id": 45961620, "link": "https://stackoverflow.com/questions/45961620/is-there-a-simpler-way-to-define-a-condition-in-a-for-loop-in-c/45961753#45961753", "title": "Is there a simpler way to define a condition in a for loop in C++?", "body": "<p>Yes, for a zero-terminated c-string you can use the following</p>\n\n<pre><code>for(int i=0; arr[i]; i++)\n</code></pre>\n\n<p>because the loop will stop when it encounters the nul-terminator.</p>\n\n<p>This does not work for arrays, only for zero-terminated strings. (It would also work for arrays terminated by something that converts to false, but this is quite rare IMO. Thanks @Fran\u00e7ois Andrieux)</p>\n"}, {"tags": [], "owner": {"reputation": 8002, "user_id": 1143850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2927fac544c9960cd5433688fe4cae1d?s=128&d=identicon&r=PG", "display_name": "Serge", "link": "https://stackoverflow.com/users/1143850/serge"}, "is_accepted": false, "score": 0, "last_activity_date": 1504099792, "creation_date": 1504099792, "answer_id": 45961820, "question_id": 45961620, "link": "https://stackoverflow.com/questions/45961620/is-there-a-simpler-way-to-define-a-condition-in-a-for-loop-in-c/45961820#45961820", "title": "Is there a simpler way to define a condition in a for loop in C++?", "body": "<p>I am not sure if this is <code>simplier</code> but it is a bit different and works well for strings, not for other generic types;</p>\n\n<p>You can use array[] to check for the string terminator</p>\n\n<pre><code>char array[10] = \"hello\";\nfor (int i = 0; array[i] != 0; i++) \n     myFunction(array[i]);\n</code></pre>\n\n<p>for string you can use pointer arithmetic instead</p>\n\n<pre><code>for (char *aPtr = array; *aPtr != 0; aPtr++)\n    myFynction(*aPtr);\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 3, "creation_date": 1504099966, "post_id": 45961858, "comment_id": 78882085, "body": "calling the <code>strlen</code> is the most <b>ineffective</b> one"}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "reply_to_user": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1504100074, "post_id": 45961858, "comment_id": 78882154, "body": "@Michael Walz |of course. good point.  My tablet dictionary has right opposite opinion :D"}, {"owner": {"reputation": 12896, "user_id": 104774, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/gQmt5.jpg?s=128&g=1", "display_name": "stefaanv", "link": "https://stackoverflow.com/users/104774/stefaanv"}, "edited": false, "score": 0, "creation_date": 1504100525, "post_id": 45961858, "comment_id": 78882549, "body": "I know it&#39;s inefficient, but why would it be ineffective? It does what is says on the tin, just not in the fastest possible way."}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 3, "creation_date": 1504100545, "post_id": 45961858, "comment_id": 78882570, "body": "If <code>arr</code> is an array then you cannot increment it like you are doing"}, {"owner": {"reputation": 52656, "user_id": 225074, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/dea26ac1ef8259140d28aa8b5ba4f1b3?s=128&d=identicon&r=PG", "display_name": "Thomas Matthews", "link": "https://stackoverflow.com/users/225074/thomas-matthews"}, "reply_to_user": {"reputation": 12896, "user_id": 104774, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/gQmt5.jpg?s=128&g=1", "display_name": "stefaanv", "link": "https://stackoverflow.com/users/104774/stefaanv"}, "edited": false, "score": 0, "creation_date": 1504108985, "post_id": 45961858, "comment_id": 78888859, "body": "@stefaanv:  The <code>strlen</code> counts every character (each iteration) to determine the length of a character array.  If the length doesn&#39;t change, the size only needs to be calculated once (preferable before the loop).  Thus the efficiency issue:  calculating a constant length each time in the loop.  <i>Note: smarter compiles with optimization set high may apply optimization and store the length in a temporary variable or register.</i>"}, {"owner": {"reputation": 12896, "user_id": 104774, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/gQmt5.jpg?s=128&g=1", "display_name": "stefaanv", "link": "https://stackoverflow.com/users/104774/stefaanv"}, "reply_to_user": {"reputation": 52656, "user_id": 225074, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/dea26ac1ef8259140d28aa8b5ba4f1b3?s=128&d=identicon&r=PG", "display_name": "Thomas Matthews", "link": "https://stackoverflow.com/users/225074/thomas-matthews"}, "edited": false, "score": 0, "creation_date": 1504109925, "post_id": 45961858, "comment_id": 78889481, "body": "@ThomasMatthews: kindly look up the difference between effective and efficient to understand my comment."}], "tags": [], "owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "is_accepted": false, "score": -1, "last_activity_date": 1504101033, "last_edit_date": 1504101033, "creation_date": 1504099888, "answer_id": 45961858, "question_id": 45961620, "link": "https://stackoverflow.com/questions/45961620/is-there-a-simpler-way-to-define-a-condition-in-a-for-loop-in-c/45961858#45961858", "title": "Is there a simpler way to define a condition in a for loop in C++?", "body": "<p>you have many options but calling the <code>strlen</code> is the most ineffective one (especially if you do it the way shown). arr has to be the pointer to be incremented</p>\n\n<pre><code>while(*arr)\n{\n   /* do something */\n   arr++;\n}\n\nwhile(arr[i])\n{\n   /* do something */\n   i++;\n}\n\ndo\n{\n   /* do something */\n}while(*++arr);\n\ndo\n{\n   /* do something */\n}while(arr[++i]);\n\n\n\nfor(;*arr;arr++) \n{\n   /* do something */\n}\n\ndo  // is you need to do somethingh with the trailing zero\n{\n   /* do something */\n}while(*arr++);\n\ndo // is you need to do somethingh with the trailing zero\n{\n   /* do something */\n}while(arr[i++]);\n</code></pre>\n\n<p>etc etc.</p>\n"}, {"comments": [{"owner": {"reputation": 58398, "user_id": 3233393, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c4c576e0ebcdf0efd653269a5b020347?s=128&d=identicon&r=PG", "display_name": "Quentin", "link": "https://stackoverflow.com/users/3233393/quentin"}, "edited": false, "score": 4, "creation_date": 1504100126, "post_id": 45961908, "comment_id": 78882197, "body": "How the hell did I never know that ._."}, {"owner": {"reputation": 4940, "user_id": 1673574, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/ubyAU.png?s=128&g=1", "display_name": "Chiel", "link": "https://stackoverflow.com/users/1673574/chiel"}, "edited": false, "score": 0, "creation_date": 1504100219, "post_id": 45961908, "comment_id": 78882286, "body": "Nice example to show the condition, but I hope for your boss that you are not doing this in your work :)"}, {"owner": {"reputation": 2575, "user_id": 4711812, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/87100b6114369140256e64e7ebab7ec9?s=128&d=identicon&r=PG&f=1", "display_name": "muXXmit2X", "link": "https://stackoverflow.com/users/4711812/muxxmit2x"}, "reply_to_user": {"reputation": 4940, "user_id": 1673574, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/ubyAU.png?s=128&g=1", "display_name": "Chiel", "link": "https://stackoverflow.com/users/1673574/chiel"}, "edited": false, "score": 1, "creation_date": 1504100568, "post_id": 45961908, "comment_id": 78882582, "body": "<i>The above code should (probably) be of only intellectual interest.</i> Why? Just because it is a rather uncommon feature doesn&#39;t mean it is bad. Same question goes out to @Chiel."}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "edited": false, "score": 1, "creation_date": 1504100639, "post_id": 45961908, "comment_id": 78882641, "body": "Matter of opinion of course, but even simpler would be <code>int i = 0; int x = arr[i++];</code>"}, {"owner": {"reputation": 15451, "user_id": 6879826, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/WzqBC.png?s=128&g=1", "display_name": "ad absurdum", "link": "https://stackoverflow.com/users/6879826/ad-absurdum"}, "edited": false, "score": 0, "creation_date": 1504101067, "post_id": 45961908, "comment_id": 78883008, "body": "Does this work in C++? You can&#39;t declare a variable in the controlling expression like that in C."}, {"owner": {"reputation": 2575, "user_id": 4711812, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/87100b6114369140256e64e7ebab7ec9?s=128&d=identicon&r=PG&f=1", "display_name": "muXXmit2X", "link": "https://stackoverflow.com/users/4711812/muxxmit2x"}, "reply_to_user": {"reputation": 15451, "user_id": 6879826, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/WzqBC.png?s=128&g=1", "display_name": "ad absurdum", "link": "https://stackoverflow.com/users/6879826/ad-absurdum"}, "edited": false, "score": 0, "creation_date": 1504101421, "post_id": 45961908, "comment_id": 78883329, "body": "@DavidBowling It  <a href=\"https://wandbox.org/permlink/9mvUx0vCN3YTtEUP\" rel=\"nofollow noreferrer\">works</a> in C++ but <a href=\"https://wandbox.org/permlink/LHkd7gDSOtLbgUy5\" rel=\"nofollow noreferrer\">won&#39;t</a> in C, as expected."}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "reply_to_user": {"reputation": 15451, "user_id": 6879826, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/WzqBC.png?s=128&g=1", "display_name": "ad absurdum", "link": "https://stackoverflow.com/users/6879826/ad-absurdum"}, "edited": false, "score": 0, "creation_date": 1504101706, "post_id": 45961908, "comment_id": 78883548, "body": "@DavidBowling C++ allowed declaring a variable in a <i>condition statement</i>.  Since the middle part of a for loop is a <i>condition statement</i> it is allowed and the variable will be scoped to the loop body."}, {"owner": {"reputation": 15451, "user_id": 6879826, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/WzqBC.png?s=128&g=1", "display_name": "ad absurdum", "link": "https://stackoverflow.com/users/6879826/ad-absurdum"}, "edited": false, "score": 0, "creation_date": 1504101845, "post_id": 45961908, "comment_id": 78883644, "body": "@NathanOliver-- thanks for the clarification; this is why I asked if it was OK in C++, instead of asserting that it is wrong (which it is in C) ;) And another example of why askers should choose the correct language tag...."}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "reply_to_user": {"reputation": 15451, "user_id": 6879826, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/WzqBC.png?s=128&g=1", "display_name": "ad absurdum", "link": "https://stackoverflow.com/users/6879826/ad-absurdum"}, "edited": false, "score": 0, "creation_date": 1504102218, "post_id": 45961908, "comment_id": 78883940, "body": "@DavidBowling For sure.  They really should pick on or the other."}, {"owner": {"reputation": 4940, "user_id": 1673574, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/ubyAU.png?s=128&g=1", "display_name": "Chiel", "link": "https://stackoverflow.com/users/1673574/chiel"}, "reply_to_user": {"reputation": 2575, "user_id": 4711812, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/87100b6114369140256e64e7ebab7ec9?s=128&d=identicon&r=PG&f=1", "display_name": "muXXmit2X", "link": "https://stackoverflow.com/users/4711812/muxxmit2x"}, "edited": false, "score": 0, "creation_date": 1504104571, "post_id": 45961908, "comment_id": 78885767, "body": "@muXXmit2X. I like it, but I had the same reaction as Quentin!"}], "tags": [], "owner": {"reputation": 13016, "user_id": 8751754, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7k6Li.png?s=128&g=1", "display_name": "Ron", "link": "https://stackoverflow.com/users/8751754/ron"}, "is_accepted": false, "score": 7, "last_activity_date": 1504786468, "last_edit_date": 1504786468, "creation_date": 1504100012, "answer_id": 45961908, "question_id": 45961620, "link": "https://stackoverflow.com/questions/45961620/is-there-a-simpler-way-to-define-a-condition-in-a-for-loop-in-c/45961908#45961908", "title": "Is there a simpler way to define a condition in a for loop in C++?", "body": "<p>As stated in the <a href=\"http://en.cppreference.com/w/cpp/language/for\" rel=\"nofollow noreferrer\">for statement</a> documentation:</p>\n\n<blockquote>\n  <p>condition may be a declaration  </p>\n</blockquote>\n\n<p>With the following code to demonstrate:</p>\n\n<pre><code>int main(){\n    int arr[] = { 1, 2, 3, 4, 5, 6, 7, 8, 9, 0 };\n    for (int i = 0; int x = arr[i]; ++i){\n        std::cout &lt;&lt; x &lt;&lt; std::endl;\n    }\n}\n</code></pre>\n\n<p>The loop will exit once <code>arr[i]</code> becomes <code>0</code> and gets assigned to <code>x</code> causing the whole condition to evaluate to <code>false</code>. Why that is in more details:</p>\n\n<blockquote>\n  <p>a declaration of a single variable with a brace-or-equals initializer.\n  the initializer is evaluated before each iteration, and if the value\n  of the declared variable converts to false, the loop is exited.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 33, "user_id": 8538246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eefd336a0f3f6e8a02252992369e0e0d?s=128&d=identicon&r=PG&f=1", "display_name": "Mohamed Safeuq J", "link": "https://stackoverflow.com/users/8538246/mohamed-safeuq-j"}, "edited": false, "score": 0, "creation_date": 1504100704, "post_id": 45961942, "comment_id": 78882690, "body": "I presume that&#39;s a range based loop."}, {"owner": {"reputation": 5012, "user_id": 2416647, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f471b80868ae9c93d0903127ed27e2f9?s=128&d=identicon&r=PG", "display_name": "schorsch312", "link": "https://stackoverflow.com/users/2416647/schorsch312"}, "reply_to_user": {"reputation": 33, "user_id": 8538246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eefd336a0f3f6e8a02252992369e0e0d?s=128&d=identicon&r=PG&f=1", "display_name": "Mohamed Safeuq J", "link": "https://stackoverflow.com/users/8538246/mohamed-safeuq-j"}, "edited": false, "score": 2, "creation_date": 1504100826, "post_id": 45961942, "comment_id": 78882789, "body": "Yes, that is a  range based loop. And?"}, {"owner": {"reputation": 33, "user_id": 8538246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eefd336a0f3f6e8a02252992369e0e0d?s=128&d=identicon&r=PG&f=1", "display_name": "Mohamed Safeuq J", "link": "https://stackoverflow.com/users/8538246/mohamed-safeuq-j"}, "edited": false, "score": 0, "creation_date": 1504101055, "post_id": 45961942, "comment_id": 78882993, "body": "I wasn&#39;t looking for that one. Thanks for the answer, though."}, {"owner": {"reputation": 3196, "user_id": 4245174, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Qhbam.jpg?s=128&g=1", "display_name": "ifma", "link": "https://stackoverflow.com/users/4245174/ifma"}, "edited": false, "score": 0, "creation_date": 1504692541, "post_id": 45961942, "comment_id": 79105435, "body": "@schorsch312 it&#39;s available on only the later compilers, I presume that was his issue with it"}, {"owner": {"reputation": 5012, "user_id": 2416647, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f471b80868ae9c93d0903127ed27e2f9?s=128&d=identicon&r=PG", "display_name": "schorsch312", "link": "https://stackoverflow.com/users/2416647/schorsch312"}, "reply_to_user": {"reputation": 3196, "user_id": 4245174, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Qhbam.jpg?s=128&g=1", "display_name": "ifma", "link": "https://stackoverflow.com/users/4245174/ifma"}, "edited": false, "score": 0, "creation_date": 1504692671, "post_id": 45961942, "comment_id": 79105527, "body": "@ifma This can be a possible explanation. Nevertheless, all mayor compliers are c++11 conform."}], "tags": [], "owner": {"reputation": 5012, "user_id": 2416647, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f471b80868ae9c93d0903127ed27e2f9?s=128&d=identicon&r=PG", "display_name": "schorsch312", "link": "https://stackoverflow.com/users/2416647/schorsch312"}, "is_accepted": false, "score": 7, "last_activity_date": 1504100095, "creation_date": 1504100095, "answer_id": 45961942, "question_id": 45961620, "link": "https://stackoverflow.com/questions/45961620/is-there-a-simpler-way-to-define-a-condition-in-a-for-loop-in-c/45961942#45961942", "title": "Is there a simpler way to define a condition in a for loop in C++?", "body": "<p>Since you said simple and c++, use std::string.</p>\n\n<pre><code>std::string str = ???;\nfor(char&amp; c : str) {\n    do_things_with(c);\n}\n</code></pre>\n\n<p>Taken from <a href=\"https://stackoverflow.com/questions/9438209/for-every-character-in-string\">this</a> post.</p>\n"}, {"comments": [{"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 1, "creation_date": 1504100347, "post_id": 45961996, "comment_id": 78882405, "body": "<code>arr[i]</code> is only a valid condition if you are dealing with a null terminated sequence.  If you&#39;re not you&#39;ll run of the back of the data."}], "tags": [], "owner": {"reputation": 3725, "user_id": 8471208, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-zX6iRd9pmRI/AAAAAAAAAAI/AAAAAAAAAgE/F3-J9H4ZCno/photo.jpg?sz=128", "display_name": "Kevin Boone", "link": "https://stackoverflow.com/users/8471208/kevin-boone"}, "is_accepted": false, "score": 0, "last_activity_date": 1504100262, "creation_date": 1504100262, "answer_id": 45961996, "question_id": 45961620, "link": "https://stackoverflow.com/questions/45961620/is-there-a-simpler-way-to-define-a-condition-in-a-for-loop-in-c/45961996#45961996", "title": "Is there a simpler way to define a condition in a for loop in C++?", "body": "<p>I'm aware that writing this:</p>\n\n<pre><code>for(int i=0; arr[i]; i++)\n</code></pre>\n\n<p>will save a few microseconds over writing this:</p>\n\n<pre><code>int array_length = strlen (arr);\nfor(int i=0; i &lt; array_length; i++)\n</code></pre>\n\n<p>I'm also aware that constructions like the first are pretty idiomatic in C, and experienced C programmers are used to seeing them.</p>\n\n<p>However, in my view, the circumstances have to be very particular for saving a few cycles to be more important than writing code that other folks will understand easily. As a person who spends a significant part of his working day looking for defects in other people's code, I really appreciate expressive coding practices.</p>\n"}], "owner": {"reputation": 33, "user_id": 8538246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eefd336a0f3f6e8a02252992369e0e0d?s=128&d=identicon&r=PG&f=1", "display_name": "Mohamed Safeuq J", "link": "https://stackoverflow.com/users/8538246/mohamed-safeuq-j"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 471, "favorite_count": 0, "accepted_answer_id": 45961753, "answer_count": 7, "score": -3, "last_activity_date": 1504786468, "creation_date": 1504099240, "last_edit_date": 1504102176, "question_id": 45961620, "link": "https://stackoverflow.com/questions/45961620/is-there-a-simpler-way-to-define-a-condition-in-a-for-loop-in-c", "title": "Is there a simpler way to define a condition in a for loop in C++?", "body": "<p>Consider an array <code>arr[10]</code> of size 10. While getting/displaying data, we use a for loop of the following common syntax</p>\n\n<pre><code>for(int i=0;i&lt;10;i++)\n</code></pre>\n\n<p>In case of a string, it is like</p>\n\n<pre><code>for(int i=0;strlen(arr)&gt;i;i++)\n</code></pre>\n\n<p>But I've read somewhere that a simpler expression like <code>arr[i]</code> could just be used in the place of condition. I've tried running a code with that condition. But I get an error. So is there a similar, simple condition expression that can be used with arrays/string?</p>\n"}, {"tags": ["c++", "visual-studio-code"], "comments": [{"owner": {"reputation": 401, "user_id": 5619416, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7f2daed67de67d68e9820ec5e75a8f1?s=128&d=identicon&r=PG", "display_name": "Alex Florin", "link": "https://stackoverflow.com/users/5619416/alex-florin"}, "edited": false, "score": 0, "creation_date": 1504099041, "post_id": 45961497, "comment_id": 78881302, "body": "One workaround is to try and read a new line at the end of the application so that it will wait for user input. Then, it will exit when you press enter (because of the <code>\\n</code> character)."}, {"owner": {"reputation": 859, "user_id": 6452525, "user_type": "registered", "accept_rate": 20, "profile_image": "https://graph.facebook.com/1137294009661181/picture?type=large", "display_name": "Rahat Zaman", "link": "https://stackoverflow.com/users/6452525/rahat-zaman"}, "reply_to_user": {"reputation": 401, "user_id": 5619416, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7f2daed67de67d68e9820ec5e75a8f1?s=128&d=identicon&r=PG", "display_name": "Alex Florin", "link": "https://stackoverflow.com/users/5619416/alex-florin"}, "edited": false, "score": 0, "creation_date": 1504099338, "post_id": 45961497, "comment_id": 78881574, "body": "Thank you for your quick response but, I don&#39;t want to change the source code. &quot;Hello world&quot; in the description was just an example. I sometimes participate in competitive programming and there, I can&#39;t add a new line reader at the end of my code(As that would result TLE in all OJ). There are also more reasons not to change the source code."}, {"owner": {"reputation": 401, "user_id": 5619416, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7f2daed67de67d68e9820ec5e75a8f1?s=128&d=identicon&r=PG", "display_name": "Alex Florin", "link": "https://stackoverflow.com/users/5619416/alex-florin"}, "edited": false, "score": 0, "creation_date": 1504099755, "post_id": 45961497, "comment_id": 78881908, "body": "I see. Then that&#39;s indeed problematic. Another way you could try this would be to intercept the SIGTERM signal and somehow prevent the terminal from closing, but that also means modifying the source code (quite a lot actually). If this still doesn&#39;t meet your needs, then I think the only thing left to do is to search the IDE or the <code>tasks.json</code> file for some kind of setting."}, {"owner": {"reputation": 859, "user_id": 6452525, "user_type": "registered", "accept_rate": 20, "profile_image": "https://graph.facebook.com/1137294009661181/picture?type=large", "display_name": "Rahat Zaman", "link": "https://stackoverflow.com/users/6452525/rahat-zaman"}, "reply_to_user": {"reputation": 401, "user_id": 5619416, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7f2daed67de67d68e9820ec5e75a8f1?s=128&d=identicon&r=PG", "display_name": "Alex Florin", "link": "https://stackoverflow.com/users/5619416/alex-florin"}, "edited": false, "score": 0, "creation_date": 1504100233, "post_id": 45961497, "comment_id": 78882294, "body": "Yes, actually I AM searching for it. But can&#39;t find one. That&#39;s why I posted here :). Also for now, I am just manually making a makefile and running it in the terminal of VSC. But it is painful to do like this instead of running the program with just a short-cut key."}], "answers": [{"comments": [{"owner": {"reputation": 859, "user_id": 6452525, "user_type": "registered", "accept_rate": 20, "profile_image": "https://graph.facebook.com/1137294009661181/picture?type=large", "display_name": "Rahat Zaman", "link": "https://stackoverflow.com/users/6452525/rahat-zaman"}, "edited": false, "score": 0, "creation_date": 1504153868, "post_id": 45969720, "comment_id": 78905347, "body": "Doesn&#39;t work. It gives the following error: &quot;Value is not accepted. Valid values: [&quot;2.0.0&quot;]&quot;. Also When I run a task. Nothing happens. I think it is version specific. That means it may work on your VSC, but not mine."}, {"owner": {"reputation": 106, "user_id": 5195136, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-iPP3Cpf11_M/AAAAAAAAAAI/AAAAAAAAACA/2z6UxxL7Dm0/photo.jpg?sz=128", "display_name": "AMVaddictionist", "link": "https://stackoverflow.com/users/5195136/amvaddictionist"}, "reply_to_user": {"reputation": 859, "user_id": 6452525, "user_type": "registered", "accept_rate": 20, "profile_image": "https://graph.facebook.com/1137294009661181/picture?type=large", "display_name": "Rahat Zaman", "link": "https://stackoverflow.com/users/6452525/rahat-zaman"}, "edited": false, "score": 0, "creation_date": 1504171806, "post_id": 45969720, "comment_id": 78914667, "body": "@RahatZaman I&#39;m using VSC Version 1.15.1. I also get the the error &quot;Value is not accepted&quot; but I can ignore it and run the task without issues."}, {"owner": {"reputation": 859, "user_id": 6452525, "user_type": "registered", "accept_rate": 20, "profile_image": "https://graph.facebook.com/1137294009661181/picture?type=large", "display_name": "Rahat Zaman", "link": "https://stackoverflow.com/users/6452525/rahat-zaman"}, "edited": false, "score": 0, "creation_date": 1504237705, "post_id": 45969720, "comment_id": 78945884, "body": "We are using same version then. But as said before, nothing happens when I run a task."}], "tags": [], "owner": {"reputation": 106, "user_id": 5195136, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-iPP3Cpf11_M/AAAAAAAAAAI/AAAAAAAAACA/2z6UxxL7Dm0/photo.jpg?sz=128", "display_name": "AMVaddictionist", "link": "https://stackoverflow.com/users/5195136/amvaddictionist"}, "is_accepted": false, "score": 0, "last_activity_date": 1504127286, "creation_date": 1504127286, "answer_id": 45969720, "question_id": 45961497, "link": "https://stackoverflow.com/questions/45961497/how-to-stop-task-running-terminal-to-exit-automatically-after-the-program-ends-i/45969720#45969720", "title": "How to stop Task running terminal to exit automatically after the program ends in visual studio code?", "body": "<p>More of a hack than a fix but I have the same issue and I noticed that changing the version from \"2.0.0\" to \"0.1.0\" would keep my output window open with all the errors present.</p>\n\n<p>Though I'm quite sure that this is not a long term solution.</p>\n"}], "owner": {"reputation": 859, "user_id": 6452525, "user_type": "registered", "accept_rate": 20, "profile_image": "https://graph.facebook.com/1137294009661181/picture?type=large", "display_name": "Rahat Zaman", "link": "https://stackoverflow.com/users/6452525/rahat-zaman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1049, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1504127286, "creation_date": 1504098910, "question_id": 45961497, "link": "https://stackoverflow.com/questions/45961497/how-to-stop-task-running-terminal-to-exit-automatically-after-the-program-ends-i", "title": "How to stop Task running terminal to exit automatically after the program ends in visual studio code?", "body": "<p>I am a new c++ learner and using visual studio code as my IDE. As an example, a cpp file has the hello world program written in it. In VSC, I compile the cpp file with a task named <code>Build</code>( >Tasks: Run Build task), and run it using the task named <code>Run</code>( >Tasks: Run task). (tasks.json is given below)</p>\n\n<p>But when I <code>Run</code>, a new terminal named \"Task - Run\" starts, shows the output and immediately exits.(Its very hard to see what was the output.)</p>\n\n<p>Is there any command that I can put into the tasks.json file so that the program doesn't disappear after it ends? Or is there any other workaround?</p>\n\n<pre><code>//my tasks.json file\n\n{\n\"version\": \"2.0.0\",\n\"tasks\": [\n    {\n        \"taskName\": \"Build\",\n        \"type\": \"shell\",\n        \"command\": \"g++\",\n        \"args\": [\n            \"main.cpp\"\n        ],\n        \"group\": {\n            \"kind\": \"build\",\n            \"isDefault\": true\n        },\n        \"problemMatcher\": []\n    },\n    {\n        \"taskName\": \"Run\",\n        \"type\": \"shell\",\n        \"command\": \"./a.out\",\n        \"problemMatcher\": []\n    }\n]\n}\n</code></pre>\n"}, {"tags": ["c++", "assignment-operator"], "comments": [{"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 5, "creation_date": 1504098892, "post_id": 45961458, "comment_id": 78881168, "body": "What is the purpose of having a reference to a member variable?"}, {"owner": {"reputation": 49, "user_id": 5241709, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/fe8a21e451c4573855013cacda1e5fb6?s=128&d=identicon&r=PG&f=1", "display_name": "Sanjay Singh", "link": "https://stackoverflow.com/users/5241709/sanjay-singh"}, "edited": false, "score": 0, "creation_date": 1504098983, "post_id": 45961458, "comment_id": 78881249, "body": "its not reference to member variable , its simply reference i put a example in the constructor only"}, {"owner": {"reputation": 49, "user_id": 5241709, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/fe8a21e451c4573855013cacda1e5fb6?s=128&d=identicon&r=PG&f=1", "display_name": "Sanjay Singh", "link": "https://stackoverflow.com/users/5241709/sanjay-singh"}, "edited": false, "score": 0, "creation_date": 1504099106, "post_id": 45961458, "comment_id": 78881359, "body": "1.what if i have a class having only a const member variable"}, {"owner": {"reputation": 147720, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 2, "creation_date": 1504099120, "post_id": 45961458, "comment_id": 78881371, "body": "@SanjaySingh - What the reference refers to has a great implication on whether copy assignment can exist and how it would look. So it&#39;s not a small detail you can omit."}, {"owner": {"reputation": 32126, "user_id": 2666289, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/746dd23bbe20769fbd758421e67f455c?s=128&d=identicon&r=PG", "display_name": "Holt", "link": "https://stackoverflow.com/users/2666289/holt"}, "reply_to_user": {"reputation": 147720, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 1, "creation_date": 1504099121, "post_id": 45961458, "comment_id": 78881372, "body": "@StoryTeller You&#39;re right, there is no need modifying <code>j</code> when assigning here"}, {"owner": {"reputation": 49, "user_id": 5241709, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/fe8a21e451c4573855013cacda1e5fb6?s=128&d=identicon&r=PG&f=1", "display_name": "Sanjay Singh", "link": "https://stackoverflow.com/users/5241709/sanjay-singh"}, "edited": false, "score": 0, "creation_date": 1504099145, "post_id": 45961458, "comment_id": 78881394, "body": "2. and a class having only a reference member variable"}, {"owner": {"reputation": 95188, "user_id": 440119, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5ec9ca2a92a94a5470396073129d79e7?s=128&d=identicon&r=PG", "display_name": "Benjamin Lindley", "link": "https://stackoverflow.com/users/440119/benjamin-lindley"}, "edited": false, "score": 0, "creation_date": 1504099166, "post_id": 45961458, "comment_id": 78881417, "body": "What do you want the assignment operator to do?"}, {"owner": {"reputation": 147720, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 1, "creation_date": 1504099191, "post_id": 45961458, "comment_id": 78881441, "body": "@SanjaySingh - The answer is &quot;depends&quot;. There is no 1 always true solution. This seems too broad to me now"}, {"owner": {"reputation": 35327, "user_id": 27678, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/7496124d499d578df1e3a6ff85e7ae03?s=128&d=identicon&r=PG", "display_name": "AndyG", "link": "https://stackoverflow.com/users/27678/andyg"}, "edited": false, "score": 3, "creation_date": 1504099208, "post_id": 45961458, "comment_id": 78881456, "body": "@SanjaySingh: Please place your questions in the question."}, {"owner": {"reputation": 49, "user_id": 5241709, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/fe8a21e451c4573855013cacda1e5fb6?s=128&d=identicon&r=PG&f=1", "display_name": "Sanjay Singh", "link": "https://stackoverflow.com/users/5241709/sanjay-singh"}, "edited": false, "score": 0, "creation_date": 1504099236, "post_id": 45961458, "comment_id": 78881484, "body": "simply the basic function ( copying an object with the existing one)."}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1504099428, "post_id": 45961458, "comment_id": 78881651, "body": "&quot;simply the basic function&quot; the most simple way to copy an object is to default construct a new one and not care about the original. Whether you would call this a &quot;copy&quot; is up to you, but it is definitely the most simple way. In any case it is always completely up to you to define what it means to copy an object"}, {"owner": {"reputation": 49, "user_id": 5241709, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/fe8a21e451c4573855013cacda1e5fb6?s=128&d=identicon&r=PG&f=1", "display_name": "Sanjay Singh", "link": "https://stackoverflow.com/users/5241709/sanjay-singh"}, "edited": false, "score": 0, "creation_date": 1504100206, "post_id": 45961458, "comment_id": 78882270, "body": "what if their is code like this : int main() { ABC a1,a2; a1=a2;}"}, {"owner": {"reputation": 46978, "user_id": 856199, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/CPtki.png?s=128&g=1", "display_name": "Nikos C.", "link": "https://stackoverflow.com/users/856199/nikos-c"}, "edited": false, "score": 0, "creation_date": 1518056771, "post_id": 45961458, "comment_id": 84351332, "body": "If all instances have the same value for the <code>const</code> member, then make it <code>static constexpr</code> instead: <code>static constexpr int = 10;</code> For the reference, use a pointer instead."}], "answers": [{"comments": [{"owner": {"reputation": 49, "user_id": 5241709, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/fe8a21e451c4573855013cacda1e5fb6?s=128&d=identicon&r=PG&f=1", "display_name": "Sanjay Singh", "link": "https://stackoverflow.com/users/5241709/sanjay-singh"}, "edited": false, "score": 0, "creation_date": 1504102462, "post_id": 45962657, "comment_id": 78884135, "body": "for const we can do it with the help of const_cast  , but for reference i don&#39;t know the code"}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "reply_to_user": {"reputation": 49, "user_id": 5241709, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/fe8a21e451c4573855013cacda1e5fb6?s=128&d=identicon&r=PG&f=1", "display_name": "Sanjay Singh", "link": "https://stackoverflow.com/users/5241709/sanjay-singh"}, "edited": false, "score": 0, "creation_date": 1504102502, "post_id": 45962657, "comment_id": 78884167, "body": "@SanjaySingh no, you cannot do that with the help of const_cast. It&#39;s good that you don&#39;t <i>know the code</i>, since the code does not exist. It is something prohibited by the language."}], "tags": [], "owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "is_accepted": false, "score": 1, "last_activity_date": 1504102485, "last_edit_date": 1504102485, "creation_date": 1504101985, "answer_id": 45962657, "question_id": 45961458, "link": "https://stackoverflow.com/questions/45961458/copy-assignment-operator-definition/45962657#45962657", "title": "copy assignment operator definition", "body": "<p>Const objects and references are non-assignable. Therefore a class that has such members will not have implicit assignment operators. It is possible to define a custom assignment operator, but not in a way that modifies those members.</p>\n\n<p>If you want your class to have a copy assignment that makes the reference to refer to the same object as was referred by the argument object, then you simply cannot use a reference for that purpose.</p>\n\n<p>If you want your class to have a copy assignment that makes a const member to have the same value as the argument object, then you simply cannot use a const member.</p>\n\n<blockquote>\n  <p>for const we can do it with the help of const_cast </p>\n</blockquote>\n\n<p>Modifying a const object (with help of <code>const_cast</code>) has undefined behaviour.</p>\n"}], "owner": {"reputation": 49, "user_id": 5241709, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/fe8a21e451c4573855013cacda1e5fb6?s=128&d=identicon&r=PG&f=1", "display_name": "Sanjay Singh", "link": "https://stackoverflow.com/users/5241709/sanjay-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1518054836, "creation_date": 1504098820, "last_edit_date": 1518054836, "question_id": 45961458, "link": "https://stackoverflow.com/questions/45961458/copy-assignment-operator-definition", "title": "copy assignment operator definition", "body": "<p>what would be the definition of copy assignment operator of a class if a class having const member variable and a reference member variable \neg:</p>\n\n<pre><code>class ABC\n{\n  int const i;\n  int &amp; j;\n  int k;\n  public :\n  ABC() :k(40), i(10),j(k)\n  {}\n};\n</code></pre>\n"}, {"tags": ["c++", "video", "media", "video-capture", "ms-media-foundation"], "answers": [{"comments": [{"owner": {"reputation": 89, "user_id": 8055587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42535fa28243bcd922e6ecbbea86027b?s=128&d=identicon&r=PG&f=1", "display_name": "Yevhen Krupin", "link": "https://stackoverflow.com/users/8055587/yevhen-krupin"}, "edited": false, "score": 0, "creation_date": 1504190042, "post_id": 45966473, "comment_id": 78927759, "body": "Thanks for your answer. In my case properties PKEY_Audio_EncodingBitrate  and PKEY_Video_EncodingBitrate  are both 0. Sometime this value for video can be 24. I&#39;ve tried to set encoding bitrate attributes on presentation descriptor but it does not help. Set those properties on file sink is impossible due to they are read only."}], "tags": [], "owner": {"reputation": 64286, "user_id": 868014, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PoaTp.png?s=128&g=1", "display_name": "Roman R.", "link": "https://stackoverflow.com/users/868014/roman-r"}, "is_accepted": false, "score": 0, "last_activity_date": 1504114159, "creation_date": 1504114159, "answer_id": 45966473, "question_id": 45961386, "link": "https://stackoverflow.com/questions/45961386/media-foundation-audio-video-capturing-to-mpeg4filesink-produces-incorrect-durat/45966473#45966473", "title": "Media Foundation Audio/Video capturing to MPEG4FileSink produces incorrect duration", "body": "<p>MP4 metadata might under some conditions be initialized incorrectly (e.g. <a href=\"http://alax.info/blog/1505\" rel=\"nofollow noreferrer\">like this</a>), however in the scenario you described the problem is like to be the payload data and not the way you set up the pipeline in first place.</p>\n\n<p>The decoders and converters are typically passing time stamps of samples through copying them from input to output, so they are not indicating a failure if something is wrong - you still have output that makes sense written into file. The sink might be having issues processing your data if you have sample time issues, very long recordings, overflow bug esp. in case of rates expressed with large numerators/denominators. Important is what sample times the sources produce. </p>\n\n<p>You might want to try to record shorter recordings, also video only and audio only recording that might possibly help in identification of the stream which supplies the data leading to the problem.</p>\n\n<p>Additionally, you might want to inspect the resulting MP4 file atoms/boxes to identify whether the header boxes have incorrect data or data itself is stamped incorrectly, on which track and how exactly (esp. starts okay and then does a weird gaps in the middle).</p>\n"}, {"comments": [{"owner": {"reputation": 89, "user_id": 8055587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42535fa28243bcd922e6ecbbea86027b?s=128&d=identicon&r=PG&f=1", "display_name": "Yevhen Krupin", "link": "https://stackoverflow.com/users/8055587/yevhen-krupin"}, "edited": false, "score": 0, "creation_date": 1504190225, "post_id": 45971731, "comment_id": 78927885, "body": "Thanks for your answer, but unfortunately transform to adjusting timestamps does not help. When i use it after encoder before sink to single stream (when i record only video or only audio) it does not change anything, but if i use it in case of usage of both streams audio stream is disappeared. If i use it after source before encoder the file become empty."}, {"owner": {"reputation": 533, "user_id": 2121847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b77206409da82ad92a148413dfeb9d39?s=128&d=identicon&r=PG&f=1", "display_name": "Evgeny Pereguda", "link": "https://stackoverflow.com/users/2121847/evgeny-pereguda"}, "reply_to_user": {"reputation": 89, "user_id": 8055587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42535fa28243bcd922e6ecbbea86027b?s=128&d=identicon&r=PG&f=1", "display_name": "Yevhen Krupin", "link": "https://stackoverflow.com/users/8055587/yevhen-krupin"}, "edited": false, "score": 0, "creation_date": 1504221292, "post_id": 45971731, "comment_id": 78942793, "body": "So, I wrote that Media Session from <code>MFCreateMediaSession</code> is developed by Microsoft for playing media files - it is not compatible with recording tasks. So, I can recommend two ways: 1. try use <code>IMFSinkWriter</code> from <code>MFCreateSinkWriterFromURL</code> - it allows direct write sample and modify its time stamp - it is not flexible, bit it is workable. 2. take <code>IMFMediaSession</code> interface and write code on its base - it is very difficult task, but it allows get more flexible solution - my <code>CaptureManager</code> project implements such way. By the way, where in code you call <code>IMFFinalizableMediaSink</code>?"}, {"owner": {"reputation": 89, "user_id": 8055587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42535fa28243bcd922e6ecbbea86027b?s=128&d=identicon&r=PG&f=1", "display_name": "Yevhen Krupin", "link": "https://stackoverflow.com/users/8055587/yevhen-krupin"}, "edited": false, "score": 0, "creation_date": 1504260570, "post_id": 45971731, "comment_id": 78955761, "body": "Hm, I dont call IMFFinalizableMediaSink, but in docs there is written:   Remarks   If a media sink exposes this interface, the Media Session will call BeginFinalize on the sink before the session closes.    About sink writer it is unsuitable for me, because i have to render video during recording."}, {"owner": {"reputation": 89, "user_id": 8055587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42535fa28243bcd922e6ecbbea86027b?s=128&d=identicon&r=PG&f=1", "display_name": "Yevhen Krupin", "link": "https://stackoverflow.com/users/8055587/yevhen-krupin"}, "edited": false, "score": 0, "creation_date": 1504264800, "post_id": 45971731, "comment_id": 78958266, "body": "I&#39;ve tried IMFFinalizableMediaSink, shutdown it after session close and before session shutdown. The result stays the same"}, {"owner": {"reputation": 533, "user_id": 2121847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b77206409da82ad92a148413dfeb9d39?s=128&d=identicon&r=PG&f=1", "display_name": "Evgeny Pereguda", "link": "https://stackoverflow.com/users/2121847/evgeny-pereguda"}, "reply_to_user": {"reputation": 89, "user_id": 8055587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42535fa28243bcd922e6ecbbea86027b?s=128&d=identicon&r=PG&f=1", "display_name": "Yevhen Krupin", "link": "https://stackoverflow.com/users/8055587/yevhen-krupin"}, "edited": false, "score": 0, "creation_date": 1504266643, "post_id": 45971731, "comment_id": 78959375, "body": "<code>IMFFinalizableMediaSink</code> is interface of media writing sinks - it commands sink stop writing data, calculate metrics of streams, define duration of media, write bit rate metrics into the meta data of file. This interface is async - it needs call <code>BeginFinalize</code> and wait responding on <code>EndFinalize</code>."}, {"owner": {"reputation": 533, "user_id": 2121847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b77206409da82ad92a148413dfeb9d39?s=128&d=identicon&r=PG&f=1", "display_name": "Evgeny Pereguda", "link": "https://stackoverflow.com/users/2121847/evgeny-pereguda"}, "reply_to_user": {"reputation": 89, "user_id": 8055587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42535fa28243bcd922e6ecbbea86027b?s=128&d=identicon&r=PG&f=1", "display_name": "Yevhen Krupin", "link": "https://stackoverflow.com/users/8055587/yevhen-krupin"}, "edited": false, "score": 0, "creation_date": 1504267066, "post_id": 45971731, "comment_id": 78959631, "body": "Also, I would like point your attention on one important moment: media source of video and audio are different - they hide different type of drivers and they initialized by different way - it leads to delay between first sample from audio source and first sample from video source - audio source can start produce first sample after a couple milliseconds after starting, but video source needs more time on initialize of drive, initialize of video device, writing selected media type configuration into the controller - it can take 0.5 - 1,0 second."}, {"owner": {"reputation": 533, "user_id": 2121847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b77206409da82ad92a148413dfeb9d39?s=128&d=identicon&r=PG&f=1", "display_name": "Evgeny Pereguda", "link": "https://stackoverflow.com/users/2121847/evgeny-pereguda"}, "reply_to_user": {"reputation": 89, "user_id": 8055587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42535fa28243bcd922e6ecbbea86027b?s=128&d=identicon&r=PG&f=1", "display_name": "Yevhen Krupin", "link": "https://stackoverflow.com/users/8055587/yevhen-krupin"}, "edited": false, "score": 0, "creation_date": 1504267613, "post_id": 45971731, "comment_id": 78959960, "body": "However, mp4 media sink can needs receiving all media samples with minimum delay between them. I faced with similar problem while tried implement multi web cam writer - I resolved it by adding <code>Barrier</code> - in &quot;Proxy&quot; transform I added static variable with init value of number of recorded streams - so, while stream sends first sample it decrement variable and check value if it is 0 - it returns ready output samples, if not - returns need more sample to source stream. As a result, only while all sources send first samples &quot;Proxy&quot; transform sends sample to encoders and sink."}, {"owner": {"reputation": 533, "user_id": 2121847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b77206409da82ad92a148413dfeb9d39?s=128&d=identicon&r=PG&f=1", "display_name": "Evgeny Pereguda", "link": "https://stackoverflow.com/users/2121847/evgeny-pereguda"}, "reply_to_user": {"reputation": 89, "user_id": 8055587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42535fa28243bcd922e6ecbbea86027b?s=128&d=identicon&r=PG&f=1", "display_name": "Yevhen Krupin", "link": "https://stackoverflow.com/users/8055587/yevhen-krupin"}, "edited": false, "score": 0, "creation_date": 1504267715, "post_id": 45971731, "comment_id": 78960030, "body": "So, you see that your task is difficult and there is not any magical line of code for resolving of it."}, {"owner": {"reputation": 89, "user_id": 8055587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42535fa28243bcd922e6ecbbea86027b?s=128&d=identicon&r=PG&f=1", "display_name": "Yevhen Krupin", "link": "https://stackoverflow.com/users/8055587/yevhen-krupin"}, "edited": false, "score": 0, "creation_date": 1504345643, "post_id": 45971731, "comment_id": 78985102, "body": "Yes there is no silver bullet in media foundation i&#39;ve understood it:) But barrier looks like idea to try. But yesterday i&#39;ve found some kind of solution - i&#39;ve wrapped sinkwriter into sample grabber and it looks workable at least mp4 is finalized successfully and has correct duration and bitrate. But on Win7 there was some problem with audio encoder so I&#39;ll investigate it monday. However it&#39;s a bit tricky, because sink writer probably has its own encapsulated  topology and probably it can make recording process slowly."}], "tags": [], "owner": {"reputation": 533, "user_id": 2121847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b77206409da82ad92a148413dfeb9d39?s=128&d=identicon&r=PG&f=1", "display_name": "Evgeny Pereguda", "link": "https://stackoverflow.com/users/2121847/evgeny-pereguda"}, "is_accepted": false, "score": 2, "last_activity_date": 1504141344, "creation_date": 1504141344, "answer_id": 45971731, "question_id": 45961386, "link": "https://stackoverflow.com/questions/45961386/media-foundation-audio-video-capturing-to-mpeg4filesink-produces-incorrect-durat/45971731#45971731", "title": "Media Foundation Audio/Video capturing to MPEG4FileSink produces incorrect duration", "body": "<p>In my project <a href=\"https://www.codeproject.com/Articles/1017223/CaptureManager-SDK\" rel=\"nofollow noreferrer\">CaptureManager</a> I faced with similar problem - while I have wrote code for recording live video from many web cams into the one file. After long time research of Media Foundation I found two important facts:\n1. live sources - web cams and microphones do not start from 0 - according of specification samples from them should start from 0 time stamp - <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms700134(v=vs.85).aspx#live_sources\" rel=\"nofollow noreferrer\">Live Sources</a> - \"The first sample should have a time stamp of zero.\" - but live sources set current system time. \n2. I see from you code that you use <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms703988(v=vs.85).aspx\" rel=\"nofollow noreferrer\">Media Session</a> - it is an object with <code>IMFMediaSession</code> interface. I think you create it from <code>MFCreateMediaSession</code> function. This function creates default version of session which is optimized for playing of media from file, which samples starts from 0 by default. \nIn my view,the main problem is that default Media Session does not check time stamp of media samples from source, because from media file they start from zero or from StartPosition. However, live sources do not start from 0 - they should, or must, but do not. \nSo, my advise - write class with <code>IMFTransform</code> which will be \"Proxy\" transform between source and encoder - this \"Proxy\" transform must fix time stamp of media samples from live source: 1. while it receive first media sample from live source, it save actual time stamp of the first media sample like reference time, and set time stamp of the first media sample to zero, all time stamps the next media samples from this live source must be subtracted by this reference time and set to time stamps of media samples.\nAlso, check code for calling of <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms704715(v=vs.85).aspx\" rel=\"nofollow noreferrer\">IMFFinalizableMediaSink</a>.   </p>\n\n<p>Regards.  </p>\n"}], "owner": {"reputation": 89, "user_id": 8055587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42535fa28243bcd922e6ecbbea86027b?s=128&d=identicon&r=PG&f=1", "display_name": "Yevhen Krupin", "link": "https://stackoverflow.com/users/8055587/yevhen-krupin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 927, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1504141344, "creation_date": 1504098617, "question_id": 45961386, "link": "https://stackoverflow.com/questions/45961386/media-foundation-audio-video-capturing-to-mpeg4filesink-produces-incorrect-durat", "title": "Media Foundation Audio/Video capturing to MPEG4FileSink produces incorrect duration", "body": "<p>I am working on media streaming application using Media Foundation framework. I've used some samples from internet and from Anton Polinger book. Unfortunately after saving streams into mp4 file metadata of file is corrupted. It has incorrect duration (according to time of work of my PC, 30 hours for instance), wrong bitrate. After long struggling I've fixed it for single stream (video or audio) but when i try to record both audio and video this problem returns again. Something is wrong with my topology but i can't understand what and probably there are some experts here?</p>\n\n<p>I get audio and video source, wrap it into IMFCollection, create aggregate source by MFCreateAggregateSource.\nI create source nodes for each source in aggregate source:</p>\n\n<pre><code>Com::IMFTopologyNodePtr \nTopologyBuilder::CreateSourceNode(Com::IMFStreamDescriptorPtr \nstreamDescriptor)\n{\n    HRESULT hr = S_OK;\n    Com::IMFTopologyNodePtr pNode;\n    // Create the topology node, indicating that it must be a source node.\n    hr = MFCreateTopologyNode(MF_TOPOLOGY_SOURCESTREAM_NODE, &amp;pNode);\n    THROW_ON_FAIL(hr, \"Unable to create topology node for source\");\n\n    // Associate the node with the source by passing in a pointer to the media source,\n    // and indicating that it is the source\n    hr = pNode-&gt;SetUnknown(MF_TOPONODE_SOURCE, _sourceDefinition-&gt;GetMediaSource());\n    THROW_ON_FAIL(hr, \"Unable to set source as object for topology node\");\n\n    // Set the node presentation descriptor attribute of the node by passing\n    // in a pointer to the presentation descriptor\n    hr = pNode-&gt;SetUnknown(MF_TOPONODE_PRESENTATION_DESCRIPTOR, _sourceDefinition-&gt;GetPresentationDescriptor());\n    THROW_ON_FAIL(hr, \"Unable to set MF_TOPONODE_PRESENTATION_DESCRIPTOR to node\");\n\n    // Set the node stream descriptor attribute by passing in a pointer to the stream\n    // descriptor\n    hr = pNode-&gt;SetUnknown(MF_TOPONODE_STREAM_DESCRIPTOR, streamDescriptor);\n    THROW_ON_FAIL(hr, \"Unable to set MF_TOPONODE_STREAM_DESCRIPTOR to node\");\n\n    return pNode;\n}\n</code></pre>\n\n<p>After that i connect each source to transform(H264 encoder and AAC encoder) and to MPEG4FileSink:</p>\n\n<pre><code>void TopologyBuilder::CreateFileSinkOutputNode(PCWSTR filePath)\n{\n    HRESULT hr = S_OK;\n    DWORD sink_count;\n\n    Com::IMFByteStreamPtr byte_stream;\n    Com::IMFTransformPtr transform;\n\n    LPCWSTR lpcwstrFilePath = filePath;\n    hr = MFCreateFile(\n    MF_ACCESSMODE_WRITE, MF_OPENMODE_FAIL_IF_NOT_EXIST, MF_FILEFLAGS_NONE,\n    lpcwstrFilePath, &amp;byte_stream);\n    THROW_ON_FAIL(hr, L\"Unable to create and open file\");\n\n// Video stream\n    Com::IMFMediaTypePtr in_mf_video_media_type = _sourceDefinition-&gt;GetCurrentVideoMediaType();\n\n    Com::IMFMediaTypePtr out_mf_media_type = CreateMediaType(MFMediaType_Video, MFVideoFormat_H264);\n    hr = CopyType(in_mf_video_media_type, out_mf_media_type);\n    THROW_ON_FAIL(hr, L\"Unable to copy type parameters\");\n\n    if (GetSubtype(in_mf_video_media_type) != MEDIASUBTYPE_H264)\n    {\n        transform.Attach(CreateAndInitCoderMft(MFT_CATEGORY_VIDEO_ENCODER, out_mf_media_type));\n        THROW_ON_NULL(transform);\n    }\n\n    if (transform)\n    {\n        Com::IMFMediaTypePtr transformMediaType;\n        hr = transform-&gt;GetOutputCurrentType(0, &amp;transformMediaType);\n        THROW_ON_FAIL(hr, L\"Unable to get current output type\");\n\n        UINT32 pcbBlobSize = 0;\n        hr = transformMediaType-&gt;GetBlobSize(MF_MT_MPEG_SEQUENCE_HEADER, &amp;pcbBlobSize);\n        THROW_ON_FAIL(hr, L\"Unable to get blob size of MF_MT_MPEG_SEQUENCE_HEADER\");\n\n        std::vector&lt;UINT8&gt; blob(pcbBlobSize);\n        hr = transformMediaType-&gt;GetBlob(MF_MT_MPEG_SEQUENCE_HEADER, &amp;blob.front(), blob.size(), NULL);\n        THROW_ON_FAIL(hr, L\"Unable to get blob MF_MT_MPEG_SEQUENCE_HEADER\");\n\n        hr = out_mf_media_type-&gt;SetBlob(MF_MT_MPEG_SEQUENCE_HEADER, &amp;blob.front(), blob.size());\n        THROW_ON_FAIL(hr, L\"Unable to set blob of MF_MT_MPEG_SEQUENCE_HEADER\");\n    }\n\n    // Audio stream\n    Com::IMFMediaTypePtr out_mf_audio_media_type;\n    Com::IMFTransformPtr transformAudio;\n    Com::IMFMediaTypePtr mediaTypeTmp = _sourceDefinition-&gt;GetCurrentAudioMediaType();\n    Com::IMFMediaTypePtr in_mf_audio_media_type;\n    if (mediaTypeTmp != NULL)\n    {\n        std::unique_ptr&lt;MediaTypesFactory&gt; factory(new MediaTypesFactory());\n        if (!IsMediaTypeSupportedByAacEncoder(mediaTypeTmp))\n        {\n            UINT32 channels;\n            hr = mediaTypeTmp-&gt;GetUINT32(MF_MT_AUDIO_NUM_CHANNELS, &amp;channels);\n            THROW_ON_FAIL(hr, L\"Unable to get MF_MT_AUDIO_NUM_CHANNELS fron source media type\");\n            in_mf_audio_media_type = factory-&gt;CreatePCM(factory-&gt;DEFAULT_SAMPLE_RATE, channels);\n        }\n        else\n        {\n            in_mf_audio_media_type.Attach(mediaTypeTmp.Detach());\n        }\n\n        out_mf_audio_media_type = factory-&gt;CreateAAC(in_mf_audio_media_type, factory-&gt;HIGH_ENCODED_BITRATE);\n        GUID subType = GetSubtype(in_mf_audio_media_type);\n        if (GetSubtype(in_mf_audio_media_type) != MFAudioFormat_AAC)\n        {\n            // add encoder to Aac\n        transformAudio.Attach(CreateAndInitCoderMft(MFT_CATEGORY_AUDIO_ENCODER, out_mf_audio_media_type));\n        }\n    }\n\n    Com::IMFMediaSinkPtr pFileSink;\n    hr = MFCreateMPEG4MediaSink(byte_stream, out_mf_media_type,     out_mf_audio_media_type, &amp;pFileSink);\n    THROW_ON_FAIL(hr, L\"Unable to create mpeg4 media sink\");\n\n    Com::IMFTopologyNodePtr pOutputNodeVideo;\n    hr = MFCreateTopologyNode(MF_TOPOLOGY_OUTPUT_NODE, &amp;pOutputNodeVideo);\n    THROW_ON_FAIL(hr, L\"Unable to create output node\");\n\n    hr = pFileSink-&gt;GetStreamSinkCount(&amp;sink_count);\n    THROW_ON_FAIL(hr, L\"Unable to get stream sink count from mediasink\");\n\n    if (sink_count == 0)\n    {\n        THROW_ON_FAIL(E_UNEXPECTED, L\"Sink count should be greater than 0\");\n    }\n\n    Com::IMFStreamSinkPtr stream_sink_video;\n    hr = pFileSink-&gt;GetStreamSinkByIndex(0, &amp;stream_sink_video);\n    THROW_ON_FAIL(hr, L\"Unable to get stream sink by index\");\n\n    hr = pOutputNodeVideo-&gt;SetObject(stream_sink_video);\n    THROW_ON_FAIL(hr, L\"Unable to set stream sink as output node object\");\n\n    hr = _pTopology-&gt;AddNode(pOutputNodeVideo);\n    THROW_ON_FAIL(hr, L\"Unable to add file sink output node\");\n\n    pOutputNodeVideo = AddEncoderIfNeed(_pTopology, transform, in_mf_video_media_type, pOutputNodeVideo);\n\n    _outVideoNodes.push_back(pOutputNodeVideo);\n\n    Com::IMFTopologyNodePtr pOutputNodeAudio;\n\n    if (in_mf_audio_media_type != NULL)\n    {\n        hr = MFCreateTopologyNode(MF_TOPOLOGY_OUTPUT_NODE, &amp;pOutputNodeAudio);\n        THROW_ON_FAIL(hr, L\"Unable to create output node\");\n\n        Com::IMFStreamSinkPtr stream_sink_audio;\n        hr = pFileSink-&gt;GetStreamSinkByIndex(1, &amp;stream_sink_audio);\n        THROW_ON_FAIL(hr, L\"Unable to get stream sink by index\");\n\n        hr = pOutputNodeAudio-&gt;SetObject(stream_sink_audio);\n        THROW_ON_FAIL(hr, L\"Unable to set stream sink as output node object\");\n\n        hr = _pTopology-&gt;AddNode(pOutputNodeAudio);\n        THROW_ON_FAIL(hr, L\"Unable to add file sink output node\");\n\n        if (transformAudio)\n        {\n            Com::IMFTopologyNodePtr outputTransformNodeAudio;\n            AddTransformNode(_pTopology, transformAudio, pOutputNodeAudio, &amp;outputTransformNodeAudio);\n\n            _outAudioNode = outputTransformNodeAudio;\n        }\n        else\n    {\n            _outAudioNode = pOutputNodeAudio;\n        }\n    }\n}\n</code></pre>\n\n<p>When output type is applied on to audio transform, it has 15 attributes instead of 8, including MF_MT_AVG_BITRATE which should be applied to video as i understand. In my case it is 192000 and it is different of MF_MT_AVG_BITRATE on video stream.\nMy AAC media type is creating by this method:</p>\n\n<pre><code>HRESULT MediaTypesFactory::CopyAudioTypeBasicAttributes(IMFMediaType * in_media_type, IMFMediaType * out_mf_media_type) {\n    HRESULT hr = S_OK;\n    static const GUID AUDIO_MAJORTYPE = MFMediaType_Audio;\n    static const GUID AUDIO_SUBTYPE = MFAudioFormat_PCM;\n\n    out_mf_media_type-&gt;SetUINT32(MF_MT_AUDIO_BITS_PER_SAMPLE, AUDIO_BITS_PER_SAMPLE);\n\n    WAVEFORMATEX *in_wfx;\n    UINT32 wfx_size;\n\n    MFCreateWaveFormatExFromMFMediaType(in_media_type, &amp;in_wfx, &amp;wfx_size);\n\n    hr = out_mf_media_type-&gt;SetUINT32(MF_MT_AUDIO_SAMPLES_PER_SECOND, in_wfx-&gt;nSamplesPerSec);\n    DEBUG_ON_FAIL(hr);\n\n    hr = out_mf_media_type-&gt;SetUINT32(MF_MT_AUDIO_NUM_CHANNELS, in_wfx-&gt;nChannels);\n    DEBUG_ON_FAIL(hr);\n\n    hr = out_mf_media_type-&gt;SetUINT32(MF_MT_AUDIO_AVG_BYTES_PER_SECOND, in_wfx-&gt;nAvgBytesPerSec);\n    DEBUG_ON_FAIL(hr);\n\n    hr = out_mf_media_type-&gt;SetUINT32(MF_MT_AUDIO_BLOCK_ALIGNMENT, in_wfx-&gt;nBlockAlign);\n    DEBUG_ON_FAIL(hr);\n\n    return hr;\n}\n</code></pre>\n\n<p>It would be awesome if somebody can help me or explain where i am wrong.\nThanks.</p>\n"}, {"tags": ["c++", "matrix", "armadillo"], "comments": [{"owner": {"reputation": 20880, "user_id": 1317944, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/OcBMY.png?s=128&g=1", "display_name": "The Quantum Physicist", "link": "https://stackoverflow.com/users/1317944/the-quantum-physicist"}, "edited": false, "score": 0, "creation_date": 1504097708, "post_id": 45960934, "comment_id": 78880131, "body": "It seems you&#39;re adding Armadillo as a header with source code and not as a precompiled source. Compile Armadillo THEN use it. There&#39;s no way to get rid of these warnings assuming you don&#39;t want to modify Armadillo. Btw, next time copy the error messages here and don&#39;t take a screenshot. You&#39;re using Qt Creator apparently, so find these warnings in the &quot;Compiler Output&quot; tab at the bottom."}, {"owner": {"reputation": 9, "user_id": 8538069, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd0805381d8686bda425d13a962e167e?s=128&d=identicon&r=PG&f=1", "display_name": "lereviroda", "link": "https://stackoverflow.com/users/8538069/lereviroda"}, "reply_to_user": {"reputation": 20880, "user_id": 1317944, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/OcBMY.png?s=128&g=1", "display_name": "The Quantum Physicist", "link": "https://stackoverflow.com/users/1317944/the-quantum-physicist"}, "edited": false, "score": 0, "creation_date": 1504098026, "post_id": 45960934, "comment_id": 78880403, "body": "What I should change to eliminate that errors?"}, {"owner": {"reputation": 20880, "user_id": 1317944, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/OcBMY.png?s=128&g=1", "display_name": "The Quantum Physicist", "link": "https://stackoverflow.com/users/1317944/the-quantum-physicist"}, "edited": false, "score": 0, "creation_date": 1504098064, "post_id": 45960934, "comment_id": 78880436, "body": "Compile armadillo, then use it. That&#39;s my only guess from the limited information I have from your question."}, {"owner": {"reputation": 9, "user_id": 8538069, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd0805381d8686bda425d13a962e167e?s=128&d=identicon&r=PG&f=1", "display_name": "lereviroda", "link": "https://stackoverflow.com/users/8538069/lereviroda"}, "reply_to_user": {"reputation": 20880, "user_id": 1317944, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/OcBMY.png?s=128&g=1", "display_name": "The Quantum Physicist", "link": "https://stackoverflow.com/users/1317944/the-quantum-physicist"}, "edited": false, "score": 0, "creation_date": 1504098247, "post_id": 45960934, "comment_id": 78880603, "body": "How can I compile armadillo? :D I don&#39;t get any warnings without using normalise() function."}, {"owner": {"reputation": 20880, "user_id": 1317944, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/OcBMY.png?s=128&g=1", "display_name": "The Quantum Physicist", "link": "https://stackoverflow.com/users/1317944/the-quantum-physicist"}, "edited": false, "score": 0, "creation_date": 1504098356, "post_id": 45960934, "comment_id": 78880711, "body": "Needs some work. See <a href=\"http://arma.sourceforge.net/faq.html\" rel=\"nofollow noreferrer\">here</a> first, then google it."}, {"owner": {"reputation": 9, "user_id": 8538069, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd0805381d8686bda425d13a962e167e?s=128&d=identicon&r=PG&f=1", "display_name": "lereviroda", "link": "https://stackoverflow.com/users/8538069/lereviroda"}, "reply_to_user": {"reputation": 20880, "user_id": 1317944, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/OcBMY.png?s=128&g=1", "display_name": "The Quantum Physicist", "link": "https://stackoverflow.com/users/1317944/the-quantum-physicist"}, "edited": false, "score": 0, "creation_date": 1504098514, "post_id": 45960934, "comment_id": 78880844, "body": "Ok thanks, it is working :)"}, {"owner": {"reputation": 26945, "user_id": 771073, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/412bf39694cbe9d1fc0374deda225b18?s=128&d=identicon&r=PG", "display_name": "Martin Bonner supports Monica", "link": "https://stackoverflow.com/users/771073/martin-bonner-supports-monica"}, "edited": false, "score": 0, "creation_date": 1504098664, "post_id": 45960934, "comment_id": 78880979, "body": "@lereviroda : Please <a href=\"https://stackoverflow.com/posts/45960934/edit\">edit</a> those error messages directly into your question.  Questions should be standalone, not require external websites like pastebin."}, {"owner": {"reputation": 26945, "user_id": 771073, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/412bf39694cbe9d1fc0374deda225b18?s=128&d=identicon&r=PG", "display_name": "Martin Bonner supports Monica", "link": "https://stackoverflow.com/users/771073/martin-bonner-supports-monica"}, "edited": false, "score": 0, "creation_date": 1504098724, "post_id": 45960934, "comment_id": 78881029, "body": "@lereviroda : If you have got it working, please add an answer here so that future visitors can find it."}], "owner": {"reputation": 9, "user_id": 8538069, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd0805381d8686bda425d13a962e167e?s=128&d=identicon&r=PG&f=1", "display_name": "lereviroda", "link": "https://stackoverflow.com/users/8538069/lereviroda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 217, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1504103426, "creation_date": 1504097401, "last_edit_date": 1504103426, "question_id": 45960934, "link": "https://stackoverflow.com/questions/45960934/armadillo-function-normalise-getting-warnings", "title": "Armadillo function normalise() - getting warnings", "body": "<p>I wrote that code and when I compile it I get so many warning: </p>\n\n<p>CHECK HERE</p>\n\n<p><img src=\"https://i.stack.imgur.com/MyoQ1.png\" alt=\"\"></p>\n\n<pre><code>arma::vec vv0={xx[0], yy[0], zz[0]};\narma::vec vv1={xx[1], yy[1], zz[1]};\narma::vec vv4={xx[4], yy[4], zz[4]};\n\narma::vec normal1 = normalise(cross(vv1-vv4, vv0-vv4));\n</code></pre>\n"}, {"tags": ["c++", "windows", "gcc", "mingw"], "comments": [{"owner": {"reputation": 841, "user_id": 275780, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e9fda69904fe03f3c3937634042e4ef6?s=128&d=identicon&r=PG", "display_name": "xyious", "link": "https://stackoverflow.com/users/275780/xyious"}, "edited": false, "score": 1, "creation_date": 1504097543, "post_id": 45960791, "comment_id": 78879982, "body": "You can actually install linux stuff in windows these days. Might also help the OP since it should work well with GCC: <a href=\"https://www.howtogeek.com/249966/how-to-install-and-use-the-linux-bash-shell-on-windows-10/\" rel=\"nofollow noreferrer\">howtogeek.com/249966/&hellip;</a>"}, {"owner": {"reputation": 5258, "user_id": 1274747, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7a2942e1483b9befa80a61cb98bce39d?s=128&d=identicon&r=PG", "display_name": "axalis", "link": "https://stackoverflow.com/users/1274747/axalis"}, "edited": false, "score": 1, "creation_date": 1504097687, "post_id": 45960791, "comment_id": 78880110, "body": "Check your PATH if the location has been added there via the installer. If not, you&#39;ll need to add it. In some cases you might need to restart Windows, or at least open a new cmd terminal (the environment is not auto-updated in cmd terminals which were  already open)."}, {"owner": {"reputation": 7681, "user_id": 8242698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/BjJXu.jpg?s=128&g=1", "display_name": "user0042", "link": "https://stackoverflow.com/users/8242698/user0042"}, "edited": false, "score": 0, "creation_date": 1504097780, "post_id": 45960791, "comment_id": 78880195, "body": "Start the MinGW bash shell as command line."}, {"owner": {"reputation": 34185, "user_id": 5470596, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BITFt.jpg?s=128&g=1", "display_name": "YSC", "link": "https://stackoverflow.com/users/5470596/ysc"}, "edited": false, "score": 0, "creation_date": 1504097965, "post_id": 45960791, "comment_id": 78880351, "body": "<code>MinGW</code> and <code>g++</code> being <i>&quot;software tools commonly used by programmer&quot;</i> I&#39;d say this question is actually on-topic (source: <a href=\"https://stackoverflow.com/help/on-topic\">What topics can I ask about here?</a>). It could be improved though."}, {"owner": {"reputation": 34185, "user_id": 5470596, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BITFt.jpg?s=128&g=1", "display_name": "YSC", "link": "https://stackoverflow.com/users/5470596/ysc"}, "edited": false, "score": 0, "creation_date": 1504098770, "post_id": 45960791, "comment_id": 78881062, "body": "Altering the <code>PATH</code> environment variable require to logoff/logon before having effect. As always with Windows: reboot your computer and try again."}, {"owner": {"reputation": 26945, "user_id": 771073, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/412bf39694cbe9d1fc0374deda225b18?s=128&d=identicon&r=PG", "display_name": "Martin Bonner supports Monica", "link": "https://stackoverflow.com/users/771073/martin-bonner-supports-monica"}, "edited": false, "score": 1, "creation_date": 1504098806, "post_id": 45960791, "comment_id": 78881086, "body": "What does the PATH command say your path is?"}, {"owner": {"reputation": 963, "user_id": 805796, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/351bc6b115265f0a9fbcb328c4532ced?s=128&d=identicon&r=PG", "display_name": "MCG", "link": "https://stackoverflow.com/users/805796/mcg"}, "edited": false, "score": 1, "creation_date": 1504098940, "post_id": 45960791, "comment_id": 78881217, "body": "@Lumi Wang can you show PATH setting? Looks like the path is not set correctly."}, {"owner": {"reputation": 1817, "user_id": 7556604, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hgWR8.jpg?s=128&g=1", "display_name": "Clonk", "link": "https://stackoverflow.com/users/7556604/clonk"}, "edited": false, "score": 0, "creation_date": 1504102729, "post_id": 45960791, "comment_id": 78884331, "body": "Have you considered using a Linux VM or Docker ?"}, {"owner": {"reputation": 63, "user_id": 7752774, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9caecbe74b69db4de0c423fea2b24b58?s=128&d=identicon&r=PG&f=1", "display_name": "Lumi Wang", "link": "https://stackoverflow.com/users/7752774/lumi-wang"}, "reply_to_user": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1504103163, "post_id": 45960791, "comment_id": 78884703, "body": "@BasileStarynkevitch thanks. I have the complete path set, appropriately I believe, cuz I had some experience with it earlier. That&#39;s why I am asking the question. You are absolutely right that Linux is more developer friendly. The same setting up on Linux took only 30s... I just wonder why it doesn&#39;t work on my Windows."}, {"owner": {"reputation": 63, "user_id": 7752774, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9caecbe74b69db4de0c423fea2b24b58?s=128&d=identicon&r=PG&f=1", "display_name": "Lumi Wang", "link": "https://stackoverflow.com/users/7752774/lumi-wang"}, "reply_to_user": {"reputation": 5258, "user_id": 1274747, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7a2942e1483b9befa80a61cb98bce39d?s=128&d=identicon&r=PG", "display_name": "axalis", "link": "https://stackoverflow.com/users/1274747/axalis"}, "edited": false, "score": 0, "creation_date": 1504103311, "post_id": 45960791, "comment_id": 78884814, "body": "@axalis thanks for the reply. I kill the command window and reopen everytime I update the PATH. I have also tried reboot Windows, but nothing helped. If you could elaborate on what do you mean by &quot;Location added via the installer&quot;?"}, {"owner": {"reputation": 383, "user_id": 1185047, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e821d8cbc7384947c8371742fedc4f7c?s=128&d=identicon&r=PG", "display_name": "rbelli", "link": "https://stackoverflow.com/users/1185047/rbelli"}, "edited": false, "score": 0, "creation_date": 1504107489, "post_id": 45960791, "comment_id": 78887912, "body": "Stupid question, did you put the .exe after the g++?"}, {"owner": {"reputation": 63, "user_id": 7752774, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9caecbe74b69db4de0c423fea2b24b58?s=128&d=identicon&r=PG&f=1", "display_name": "Lumi Wang", "link": "https://stackoverflow.com/users/7752774/lumi-wang"}, "reply_to_user": {"reputation": 26945, "user_id": 771073, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/412bf39694cbe9d1fc0374deda225b18?s=128&d=identicon&r=PG", "display_name": "Martin Bonner supports Monica", "link": "https://stackoverflow.com/users/771073/martin-bonner-supports-monica"}, "edited": false, "score": 0, "creation_date": 1504189452, "post_id": 45960791, "comment_id": 78927319, "body": "Many thanks to everybody. I fixed the problem, inspired by @MartinBonner &#39;s answer, and checked the path command.. Then it occurred to me that I set the cpp compiler as a &quot;system environment&quot; instead of &quot;Path in system environment&quot;.  This is indeed a very stupid question, and BasileStarynkevitch did point out the source of this problem at first. Many thanks again."}], "owner": {"reputation": 63, "user_id": 7752774, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9caecbe74b69db4de0c423fea2b24b58?s=128&d=identicon&r=PG&f=1", "display_name": "Lumi Wang", "link": "https://stackoverflow.com/users/7752774/lumi-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2722, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1504098222, "creation_date": 1504097068, "last_edit_date": 1504098222, "question_id": 45960791, "link": "https://stackoverflow.com/questions/45960791/how-to-set-up-gcc-and-g-on-a-windows-environment-properly", "title": "How to set up gcc and g++ on a Windows environment properly?", "body": "<p>I am new to C++. I want to have a compiler for C++ on my Windows10 system. Since I plan to write my sources directly with notepad++, I'd like to be able to compile it in command line.</p>\n\n<p>As people suggested, I installed <code>MinGW-get</code>, and from there installed <code>gcc</code> packages.</p>\n\n<p>My <code>MinGW</code> is installed directly in <code>C:\\</code>, as suggested, and under <code>C:\\MinGW\\bin</code>. There I can find <code>c++.exe</code>, <code>g++.exe</code>, <code>gcc.exe</code>...</p>\n\n<p>I have already added <code>C:\\MinGW\\bin</code> to the <code>PATH</code> system environment.</p>\n\n<p>However, when I try to compile codes from command line, it reminds me that</p>\n\n<blockquote>\n  <p>'g++' is not recognized as an internal or external command,operable program or batch file.\"</p>\n</blockquote>\n\n<p>How do I fix my environment to compile things?</p>\n"}, {"tags": ["c++", "qt"], "owner": {"reputation": 21, "user_id": 8537823, "user_type": "registered", "profile_image": "https://graph.facebook.com/1414904398594894/picture?type=large", "display_name": "SamurayH", "link": "https://stackoverflow.com/users/8537823/samurayh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 207, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1504097309, "creation_date": 1504096322, "last_edit_date": 1504097309, "question_id": 45960523, "link": "https://stackoverflow.com/questions/45960523/how-to-find-replace-text-in-a-textbox-word-using-qaxobject-automation-with-qt", "title": "How to Find/Replace text in a textbox Word using QAxObject (Automation with Qt)", "body": "<p>I wonder if anyone could help me with this...Finding text and replacing (in MS Word) was just simple until I have tried it in a textbox. The text out of the textbox is replaced, but the text IN the textbox couldn't be replaced.I have found many answers about this subject, but they are all unuseful when you're working with Qt (QAxObject, QAxBase...), it's really too complicated, and needs a professional. This is the code that I'm using to find/replace text (that not work for textboxes):</p>\n\n<pre><code>int main(int argc,char *argv[]){\n    QApplication app(argc,argv);\n\n    QAxObject *wApp = new QAxObject(\"{000209FF-0000-0000-C000-000000000046}\");\n    QAxObject *wDoc = wApp-&gt;querySubObject(\"Documents\");\n    wDoc-&gt;querySubObject(\"Open(QString)\",\"aURL to the .docx file\");\n    QAxObject *wActive = wApp-&gt;querySubObject(\"ActiveDocument()\");\n    QAxObject *wContent = wActive-&gt;querySubObject(\"Content\");\n    QAxObject *wFind = wContent-&gt;querySubObject(\"Find\");\n\n            bool bMatchCase      = true;\n            bool bMatchWholeWord = true;\n            bool bMatchWildCards = false;\n            bool bReplaceAll     = true;\n\n            QString old = \"Text\";\n            QString New = \"NewText\";\n\n            QVariantList vA;\n\n    vA = { old, bMatchCase, bMatchWholeWord, bMatchWildCards, false, false, true, 1, false,New, bReplaceAll ? \"2\" : \"1\" };\n\n    wFind-&gt;dynamicCall(\"Execute(QString,bool,bool,bool,bool,bool,bool,int,bool,QString,int)\",vA);\n    wApp-&gt;setProperty(\"Visible\",true);\n    wDoc-&gt;dynamicCall(\"Close(bool)\",true);\n    return app.exec();\n}\n</code></pre>\n\n<p>Source : <a href=\"https://forum.qt.io/topic/82574/how-to-find-replace-text-in-a-docx-file-using-qaxobject/3\" rel=\"nofollow noreferrer\">https://forum.qt.io/topic/82574/how-to-find-replace-text-in-a-docx-file-using-qaxobject/3</a></p>\n\n<p>And thanks for your help.</p>\n"}, {"tags": ["c++", "c++11", "build", "compilation", "gcc4.9"], "answers": [{"tags": [], "owner": {"reputation": 1355, "user_id": 4983082, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/3QQ10.gif?s=128&g=1", "display_name": "GAVD", "link": "https://stackoverflow.com/users/4983082/gavd"}, "is_accepted": false, "score": 0, "last_activity_date": 1504146206, "creation_date": 1504146206, "answer_id": 45972282, "question_id": 45960505, "link": "https://stackoverflow.com/questions/45960505/libmylib-so-undefined-reference-to-submarinexlibkcount/45972282#45972282", "title": "./libmylib.so: undefined reference to `submarinex::LIB::kCount&#39;", "body": "<p><code>std::min</code> use two params <code>const int&amp;</code> (not <code>int</code>) and you pass a reference to <code>submarinex::LIB::kCount</code> without definition (you just declared in <code>.h</code> file).</p>\n\n<p>In this case, you can add this line in <code>ll.cc</code></p>\n\n<pre><code>namespace submarinex {\n    static const int LIB::kCount = 100; //define it here\n    void LIB::Print() {\n        std::min(101, kCount);\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2175, "user_id": 1894600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rENQi.png?s=128&g=1", "display_name": "tommybee", "link": "https://stackoverflow.com/users/1894600/tommybee"}, "is_accepted": true, "score": 0, "last_activity_date": 1504175712, "last_edit_date": 1504175712, "creation_date": 1504163214, "answer_id": 45975296, "question_id": 45960505, "link": "https://stackoverflow.com/questions/45960505/libmylib-so-undefined-reference-to-submarinexlibkcount/45975296#45975296", "title": "./libmylib.so: undefined reference to `submarinex::LIB::kCount&#39;", "body": "<p>I think there is no definition of the kCount variable in your source code.</p>\n\n<p>So, your variable must be defined somewhere in your source code, ll.cc.</p>\n\n<p>In the ll.h</p>\n\n<pre><code>namespace submarinex {\n    class LIB {\n        private:\n            const static int kCount =100;\n        public:\n            void Print();\n    };\n}  // namespace submarinex\n</code></pre>\n\n<p>Then, you can define a kCount variable in the ll.cc</p>\n\n<pre><code>#include \"ll.h\"\n\n#include &lt;algorithm&gt;\n#include &lt;iostream&gt;\n\nnamespace submarinex \n{\n    const int LIB::kCount; //&lt;== here\n\n    void LIB::Print() {\n\n        int min = std::min(101, kCount);\n        std::cout &lt;&lt; min &lt;&lt; std::endl;\n\n        // std::cout &lt;&lt; kCount &lt;&lt; std::endl;\n    }   \n\n}  // namespace submarinex\n</code></pre>\n\n<p>This is my gcc version information</p>\n\n<pre><code>$ gcc -v\nUsing built-in specs.\nCOLLECT_GCC=C:\\DEV\\COMP\\msys32\\mingw32\\bin\\gcc.exe\nCOLLECT_LTO_WRAPPER=C:/DEV/COMP/msys32/mingw32/bin/../lib/gcc/i686-w64-mingw32/6.3.0/lto-wrapper.exe\nTarget: i686-w64-mingw32\nConfigured with: ../gcc-6.3.0/configure --prefix=/mingw32 --with-local-prefix=/mingw32/local --build=i686-w64-mingw32 --host=i686-w64-mingw32 --target=i686-w64-mingw32 --with-native-system-header-dir=/mingw32/i686-w64-mingw32/include --libexecdir=/mingw32/lib --enable-bootstrap --with-arch=i686 --with-tune=generic --enable-languages=c,lto,c++,objc,obj-c++,fortran,ada --enable-shared --enable-static --enable-libatomic --enable-threads=posix --enable-graphite --enable-fully-dynamic-string --enable-libstdcxx-time=yes --disable-libstdcxx-pch --disable-libstdcxx-debug --disable-isl-version-check --enable-lto --enable-libgomp --disable-multilib --enable-checking=release --disable-rpath --disable-win32-registry --disable-nls --disable-werror --disable-symvers --with-libiconv --with-system-zlib --with-gmp=/mingw32 --with-mpfr=/mingw32 --with-mpc=/mingw32 --with-isl=/mingw32 --with-pkgversion='Rev1, Built by MSYS2 project' --with-bugurl=https://sourceforge.net/projects/msys2 --with-gnu-as --with-gnu-ld --disable-sjlj-exceptions --with-dwarf2\nThread model: posix\ngcc version 6.3.0 (Rev1, Built by MSYS2 project)\n</code></pre>\n\n<p>Compiled with MinGW32 shell.</p>\n\n<pre><code>g++ -Wall -g -fPIC -std=c++11 -I. ll.cc -shared -o libmylib.a\ng++ -Wall -g -std=c++11 -I. -L. -lmylib main.cc -o myexe\n</code></pre>\n\n<p>I hope this helps you.</p>\n\n<p>Regards,</p>\n"}], "owner": {"reputation": 810, "user_id": 1544748, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/M7cG5.png?s=128&g=1", "display_name": "SubmarineX", "link": "https://stackoverflow.com/users/1544748/submarinex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 45975296, "answer_count": 2, "score": 3, "last_activity_date": 1504175712, "creation_date": 1504096287, "last_edit_date": 1504148779, "question_id": 45960505, "link": "https://stackoverflow.com/questions/45960505/libmylib-so-undefined-reference-to-submarinexlibkcount", "title": "./libmylib.so: undefined reference to `submarinex::LIB::kCount&#39;", "body": "<p>I have 3 files in a directory. I will build <code>ll.cc</code> to <code>libmylib.so</code>, and build <code>main.cc</code> to <code>myexe</code>.</p>\n\n<p>Use these command to build</p>\n\n<pre><code>g++ -Wall -g -fPIC -std=c++11 ll.cc -shared -o libmylib.so\ng++ -Wall -g -std=c++11 main.cc -L. -lmylib -o myexe\n</code></pre>\n\n<p>But, g++ report a error when build <code>myexe</code> :</p>\n\n<pre><code>./libmylib.so: undefined reference to `submarinex::LIB::kCount'\ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>Files:</p>\n\n<p>ll.h</p>\n\n<pre><code>namespace submarinex {\n\nclass LIB {\n public:\n  void Print();\n\n private:\n  static const int kCount = 100;\n};\n\n}  // namespace submarinex\n</code></pre>\n\n<p>ll.cc</p>\n\n<pre><code>#include \"ll.h\"\n\n#include &lt;algorithm&gt;\n#include &lt;iostream&gt;\n\nnamespace submarinex {\n\nvoid LIB::Print() {\n  int min = std::min(101, kCount);\n  std::cout &lt;&lt; min &lt;&lt; std::endl;\n\n  // std::cout &lt;&lt; kCount &lt;&lt; std::endl;\n}\n\n}  // namespace submarinex\n</code></pre>\n\n<p>main.cc</p>\n\n<pre><code>#include \"ll.h\"\n\nint main(int argc, char **argv) {\n  submarinex::LIB lib;\n  lib.Print();\n\n  return 0;\n}\n</code></pre>\n\n<p><code>Case 1</code>:\nIf use these 2 lines in <code>Print</code>, will report an error when link object of main.cc</p>\n\n<pre><code>  int min = std::min(101, kCount);\n  std::cout &lt;&lt; min &lt;&lt; std::endl;\n</code></pre>\n\n<p><code>Case 2</code>:\nIf use this line in <code>Print</code>, will success</p>\n\n<pre><code>  std::cout &lt;&lt; kCount &lt;&lt; std::endl;\n</code></pre>\n\n<p>If change </p>\n\n<pre><code> static const int kCount = 100;\n</code></pre>\n\n<p>to</p>\n\n<pre><code> const int kCount = 100;\n</code></pre>\n\n<p>it also be OK regardless of using <code>Case1</code> or <code>Case2</code>.</p>\n\n<p>I don't know how to solve this problem.</p>\n"}, {"tags": ["c++", "multithreading", "c++11", "compiler-optimization", "stdatomic"], "comments": [{"owner": {"reputation": 8847, "user_id": 3484570, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/r5BRZ.png?s=128&g=1", "display_name": "nwp", "link": "https://stackoverflow.com/users/3484570/nwp"}, "edited": false, "score": 0, "creation_date": 1504096197, "post_id": 45960387, "comment_id": 78878986, "body": "This optimization step probably doesn&#39;t lead to a great speed-up in real application compared to the cost of running the optimization step, especially when the code is not trivial. <a href=\"https://youtu.be/IB57wIf9W1k\" rel=\"nofollow noreferrer\">This talk</a> is somewhat related."}, {"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 21, "creation_date": 1504096216, "post_id": 45960387, "comment_id": 78879005, "body": "And what if <code>f</code> is only one thread of many writing to <code>y</code>, while there are others reading from <code>y</code>? If the compiler coalesces the writes into a single write, then the behavior of the program might change unexpectedly."}, {"owner": {"reputation": 8847, "user_id": 3484570, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/r5BRZ.png?s=128&g=1", "display_name": "nwp", "link": "https://stackoverflow.com/users/3484570/nwp"}, "reply_to_user": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 19, "creation_date": 1504096282, "post_id": 45960387, "comment_id": 78879050, "body": "@Someprogrammerdude That behavior wasn&#39;t guaranteed before, so it wouldn&#39;t make the optimization invalid."}, {"owner": {"reputation": 917, "user_id": 2504674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4df1119bfdf1e97bac7fb18996160ba?s=128&d=identicon&r=PG", "display_name": "PeteC", "link": "https://stackoverflow.com/users/2504674/petec"}, "reply_to_user": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 4, "creation_date": 1504096421, "post_id": 45960387, "comment_id": 78879155, "body": "@Someprogrammerdude I&#39;m assuming that situation, and still don&#39;t understand. &#39;f() runs really fast&#39; is always a scheduling possibility, so no valid program could assume it could see each of those distinct writes."}, {"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1504096600, "post_id": 45960387, "comment_id": 78879295, "body": "But you <i>don&#39;t know</i>, and that&#39;s one of the problems. If we don&#39;t know all possible use-cases, how would the compiler be able to?"}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 8, "creation_date": 1504096842, "post_id": 45960387, "comment_id": 78879474, "body": "a very practical argument is: for a compiler it would be hard to reason about the redundancy of the stores in the general case, while for the one writing the code it should be trivial to avoid such redundant writes, so why should compiler writers bother to add such optimization?"}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 1, "creation_date": 1504096855, "post_id": 45960387, "comment_id": 78879489, "body": "Looks like the answer <a href=\"https://stackoverflow.com/questions/45885048/is-this-compiler-transformation-allowed\">here</a> might cover it."}, {"owner": {"reputation": 8847, "user_id": 3484570, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/r5BRZ.png?s=128&g=1", "display_name": "nwp", "link": "https://stackoverflow.com/users/3484570/nwp"}, "reply_to_user": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 3, "creation_date": 1504097031, "post_id": 45960387, "comment_id": 78879611, "body": "@NathanOliver How is that related? A compiler optimization that adds a write which potentially introduces a data race is not at all the same as an optimization that removes redundant thread-safe writes."}, {"owner": {"reputation": 917, "user_id": 2504674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4df1119bfdf1e97bac7fb18996160ba?s=128&d=identicon&r=PG", "display_name": "PeteC", "link": "https://stackoverflow.com/users/2504674/petec"}, "reply_to_user": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 3, "creation_date": 1504097071, "post_id": 45960387, "comment_id": 78879638, "body": "@NathanOliver Thanks, but removing the two redundant stores would not &quot;introduce assignments to a potentially shared memory location that would not be modified by the abstract machine&quot;, so I don&#39;t think that part of the standard helps."}, {"owner": {"reputation": 1636, "user_id": 3370124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73352b4adb282c092738f34883488dd?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Critten", "link": "https://stackoverflow.com/users/3370124/richard-critten"}, "edited": false, "score": 3, "creation_date": 1504097404, "post_id": 45960387, "comment_id": 78879884, "body": "The issue here is that it is impossible to prove that the stores are redundant.  Assume another thread is running that sets <code>y</code> to <code>42</code> between the 2nd and 3rd stores, <code>y</code> would still be <code>1</code> at the end of <code>f</code>.  If the &quot;redundant&quot; stores were removed <code>y</code> would be <code>2</code> at the end of <code>f</code>."}, {"owner": {"reputation": 8847, "user_id": 3484570, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/r5BRZ.png?s=128&g=1", "display_name": "nwp", "link": "https://stackoverflow.com/users/3484570/nwp"}, "reply_to_user": {"reputation": 1636, "user_id": 3370124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73352b4adb282c092738f34883488dd?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Critten", "link": "https://stackoverflow.com/users/3370124/richard-critten"}, "edited": false, "score": 17, "creation_date": 1504097557, "post_id": 45960387, "comment_id": 78879991, "body": "@RichardCritten There is no way to write a C++ program that sets <code>y</code> to <code>42</code> between the 2nd and 3rd stores. You can write a program that just does the store and maybe you get lucky, but there is no way to guarantee it. It is impossible to tell if it never happened because redundant writes were removed or because you just got unlucky timing, hence the optimization is valid. Even if it <i>does</i> happen you have no way to know because it could have been before the first, second or third."}, {"owner": {"reputation": 5362, "user_id": 2430669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2656586be6c90ef0666a391f1114628b?s=128&d=identicon&r=PG", "display_name": "Micha&#235;l Roy", "link": "https://stackoverflow.com/users/2430669/micha%c3%abl-roy"}, "edited": false, "score": 4, "creation_date": 1504097666, "post_id": 45960387, "comment_id": 78880093, "body": "I&#39;m actually relieved to hear no compiler optimizes that."}, {"owner": {"reputation": 19052, "user_id": 1364752, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/mxlR2.jpg?s=128&g=1", "display_name": "Morwenn", "link": "https://stackoverflow.com/users/1364752/morwenn"}, "edited": false, "score": 6, "creation_date": 1504098653, "post_id": 45960387, "comment_id": 78880970, "body": "The standard committee isn&#39;t sure whether they&#39;re always ok with aggressive atomic optimizations, so compilers probably just avoid them. See <a href=\"http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0062r1.html\" rel=\"nofollow noreferrer\">P0062</a> for some discussion about atomics and aggressive optimizations. The papers does explain that the kind of optimization you&#39;re expecting is indeed perfectly allowed, but not always what the user expects."}, {"owner": {"reputation": 2149, "user_id": 2096401, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uVjii.jpg?s=128&g=1", "display_name": "TripeHound", "link": "https://stackoverflow.com/users/2096401/tripehound"}, "edited": false, "score": 21, "creation_date": 1504099301, "post_id": 45960387, "comment_id": 78881545, "body": "Prosaic answer is that there&#39;s probably never been enough code seen that looks like that to make any optimiser-writer decide to be bothered writing an optimisation for it."}, {"owner": {"reputation": 917, "user_id": 2504674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4df1119bfdf1e97bac7fb18996160ba?s=128&d=identicon&r=PG", "display_name": "PeteC", "link": "https://stackoverflow.com/users/2504674/petec"}, "reply_to_user": {"reputation": 19052, "user_id": 1364752, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/mxlR2.jpg?s=128&g=1", "display_name": "Morwenn", "link": "https://stackoverflow.com/users/1364752/morwenn"}, "edited": false, "score": 0, "creation_date": 1504099702, "post_id": 45960387, "comment_id": 78881859, "body": "@Morwenn interesting read, thank you. (Good candidate for an answer!)"}, {"owner": {"reputation": 4035, "user_id": 478891, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df15c8847129ee12937d3e62b84a3a4f?s=128&d=identicon&r=PG", "display_name": "Eric Towers", "link": "https://stackoverflow.com/users/478891/eric-towers"}, "reply_to_user": {"reputation": 2149, "user_id": 2096401, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uVjii.jpg?s=128&g=1", "display_name": "TripeHound", "link": "https://stackoverflow.com/users/2096401/tripehound"}, "edited": false, "score": 0, "creation_date": 1504194650, "post_id": 45960387, "comment_id": 78931026, "body": "@TripeHound : Yes.  <a href=\"https://en.wikipedia.org/wiki/Duff%27s_device\" rel=\"nofollow noreferrer\">Duff&#39;s device</a> is so obscure no one&#39;s ever seen it."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "reply_to_user": {"reputation": 2149, "user_id": 2096401, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uVjii.jpg?s=128&g=1", "display_name": "TripeHound", "link": "https://stackoverflow.com/users/2096401/tripehound"}, "edited": false, "score": 0, "creation_date": 1544747653, "post_id": 45960387, "comment_id": 94395851, "body": "@TripeHound There isn&#39;t a lot of code that creates redundant <code>shared_ptr</code> instances in inline functions?"}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "reply_to_user": {"reputation": 19052, "user_id": 1364752, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/mxlR2.jpg?s=128&g=1", "display_name": "Morwenn", "link": "https://stackoverflow.com/users/1364752/morwenn"}, "edited": false, "score": 0, "creation_date": 1560041554, "post_id": 45960387, "comment_id": 99609186, "body": "@Morwenn The std committee isn&#39;t sure that it&#39;s OK to move atomic operations over very long loops. They don&#39;t seem to have given the issue any serious thinking as the same could be said of volatile operations or even regular I/O. (Or even to move code around timing operations.)"}], "answers": [{"comments": [{"owner": {"reputation": 899, "user_id": 7561577, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d4a245cd8b14a5fba97b5c1336a7161?s=128&d=identicon&r=PG&f=1", "display_name": "login_not_failed", "link": "https://stackoverflow.com/users/7561577/login-not-failed"}, "edited": false, "score": 10, "creation_date": 1504099126, "post_id": 45961233, "comment_id": 78881378, "body": "<code>volatile</code> has nothing to do with atomics"}, {"owner": {"reputation": 33597, "user_id": 2445184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/0b51ece74c2314ba345a862c4b00d804?s=128&d=identicon&r=PG", "display_name": "cmaster - reinstate monica", "link": "https://stackoverflow.com/users/2445184/cmaster-reinstate-monica"}, "reply_to_user": {"reputation": 899, "user_id": 7561577, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d4a245cd8b14a5fba97b5c1336a7161?s=128&d=identicon&r=PG&f=1", "display_name": "login_not_failed", "link": "https://stackoverflow.com/users/7561577/login-not-failed"}, "edited": false, "score": 2, "creation_date": 1504099796, "post_id": 45961233, "comment_id": 78881958, "body": "@login_not_failed But <code>volatile</code> has a lot to do with not optimizing away memory accesses, which is one effect of using atomics. Atomics add some really important guarantees on top of that (atomicity, and ordering), but the &quot;don&#39;t optimize this away!&quot; semantics apply to both."}, {"owner": {"reputation": 5362, "user_id": 2430669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2656586be6c90ef0666a391f1114628b?s=128&d=identicon&r=PG", "display_name": "Micha&#235;l Roy", "link": "https://stackoverflow.com/users/2430669/micha%c3%abl-roy"}, "edited": false, "score": 1, "creation_date": 1504100241, "post_id": 45961233, "comment_id": 78882307, "body": "I didn&#39;t say they were declared with volatile - I suspect some implementation actually do.  But that atomics should at the very least behave similarly."}, {"owner": {"reputation": 18565, "user_id": 10593, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3eeb7653c4df9b0f1332b9b0ec201ec?s=128&d=identicon&r=PG", "display_name": "Max Lybbert", "link": "https://stackoverflow.com/users/10593/max-lybbert"}, "reply_to_user": {"reputation": 899, "user_id": 7561577, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d4a245cd8b14a5fba97b5c1336a7161?s=128&d=identicon&r=PG&f=1", "display_name": "login_not_failed", "link": "https://stackoverflow.com/users/7561577/login-not-failed"}, "edited": false, "score": 0, "creation_date": 1504100737, "post_id": 45961233, "comment_id": 78882721, "body": "@login_not_failed: I had the same initial reaction, but I believe mentioning <code>volatile</code> is correct here.  It&#39;s no surprise that compilers handle <code>std::atomic</code> variables differently from regular variables, <b>much like</b> they handle <code>volatile</code> variables differently, and for similar reasons:  in both cases, something unusual makes it possible for the variable&#39;s value to change unexpectedly, so the compiler must actually read from and write to the variable instead of caching previous reads/writes."}, {"owner": {"reputation": 8847, "user_id": 3484570, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/r5BRZ.png?s=128&g=1", "display_name": "nwp", "link": "https://stackoverflow.com/users/3484570/nwp"}, "edited": false, "score": 3, "creation_date": 1504101400, "post_id": 45961233, "comment_id": 78883305, "body": "It is wrong though. <code>volatile</code> does things that <code>atomic</code>s don&#39;t, specifically <code>volatile</code> assumes you do not talk to memory, but to devices, where writing 1, 2, 3 might be a startup sequence that must arrive exactly like that and reading that location might give you the current temperature. <code>atomic</code> assumes you are using regular memory where you read what you last wrote."}, {"owner": {"reputation": 5362, "user_id": 2430669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2656586be6c90ef0666a391f1114628b?s=128&d=identicon&r=PG", "display_name": "Micha&#235;l Roy", "link": "https://stackoverflow.com/users/2430669/micha%c3%abl-roy"}, "edited": false, "score": 0, "creation_date": 1504101665, "post_id": 45961233, "comment_id": 78883518, "body": "volatile doesn&#39;t do anything, apart from disabling some optimizations.  And the volatile modifier is attached to a variable it does indeed apply to reads and writes to memory.  As a language, C++ doesn&#39;t know about devices, and there are no mentions of devices in the standard.  The volatile modifier can also be attached to a piece of assembly code, which is how at least some implementations of atomic&lt;&gt; are defined."}, {"owner": {"reputation": 917, "user_id": 2504674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4df1119bfdf1e97bac7fb18996160ba?s=128&d=identicon&r=PG", "display_name": "PeteC", "link": "https://stackoverflow.com/users/2504674/petec"}, "edited": false, "score": 0, "creation_date": 1504102740, "post_id": 45961233, "comment_id": 78884335, "body": "@Micha&#235;lRoy you have misunderstood the use of the volatile method qualifier. See <a href=\"https://stackoverflow.com/questions/16746070/\">stackoverflow.com/questions/16746070</a>"}, {"owner": {"reputation": 5362, "user_id": 2430669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2656586be6c90ef0666a391f1114628b?s=128&d=identicon&r=PG", "display_name": "Micha&#235;l Roy", "link": "https://stackoverflow.com/users/2430669/micha%c3%abl-roy"}, "reply_to_user": {"reputation": 917, "user_id": 2504674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4df1119bfdf1e97bac7fb18996160ba?s=128&d=identicon&r=PG", "display_name": "PeteC", "link": "https://stackoverflow.com/users/2504674/petec"}, "edited": false, "score": 0, "creation_date": 1504103484, "post_id": 45961233, "comment_id": 78884931, "body": "@PeteC.  Of course I didn&#39;t.  And neither did teh MS stl team.  Here is how atomic operations are typically specialized:  <code>inline int _Atomic_compare_exchange_strong_8(volatile _Uint8_t *_Tgt, _Uint8_t *_Exp, _Uint8_t _Value, memory_order _Order1, memory_order _Order2)</code>    You will notice that this function requires a pointer to a volatile.  All specializations are like this."}, {"owner": {"reputation": 917, "user_id": 2504674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4df1119bfdf1e97bac7fb18996160ba?s=128&d=identicon&r=PG", "display_name": "PeteC", "link": "https://stackoverflow.com/users/2504674/petec"}, "edited": false, "score": 1, "creation_date": 1504103787, "post_id": 45961233, "comment_id": 78885177, "body": "@Micha&#235;lRoy that quote wasn&#39;t part of the STL snippet in your answer. Sure, you can atomically operate on a volatile object. That doesn&#39;t mean that atomics are volatile or that volatiles are atomic. Your assertion that &quot;one should expect that [atomics] behave, at a minimum, as if they were declared with the volatile keyword&quot; is flat-out wrong."}, {"owner": {"reputation": 5362, "user_id": 2430669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2656586be6c90ef0666a391f1114628b?s=128&d=identicon&r=PG", "display_name": "Micha&#235;l Roy", "link": "https://stackoverflow.com/users/2430669/micha%c3%abl-roy"}, "edited": false, "score": 0, "creation_date": 1504104268, "post_id": 45961233, "comment_id": 78885534, "body": "That quote is straight from the MS VS2017 stl. version 14.10.25017.  file &#39;xatomic.h&#39; , line 2028.   I sure am not going to paste the entire stl atomic implementation.  Look at the code in the stl you use and you will see that the atomic variable will get volatile status at some point."}, {"owner": {"reputation": 5362, "user_id": 2430669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2656586be6c90ef0666a391f1114628b?s=128&d=identicon&r=PG", "display_name": "Micha&#235;l Roy", "link": "https://stackoverflow.com/users/2430669/micha%c3%abl-roy"}, "reply_to_user": {"reputation": 917, "user_id": 2504674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4df1119bfdf1e97bac7fb18996160ba?s=128&d=identicon&r=PG", "display_name": "PeteC", "link": "https://stackoverflow.com/users/2504674/petec"}, "edited": false, "score": 0, "creation_date": 1504104965, "post_id": 45961233, "comment_id": 78886063, "body": "@PeteC  The volatile keyword was introduced in C to designate variables that could be modified from within an ISR, and read from the main program thread. That behaviour is very similar to a variable that could be  modified from a different thread.  This is the very same trait expected from atomic&lt;&gt;.  They have no other practical use. Atomics <i>are</i> the volatile variables of the multi-core age."}, {"owner": {"reputation": 917, "user_id": 2504674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4df1119bfdf1e97bac7fb18996160ba?s=128&d=identicon&r=PG", "display_name": "PeteC", "link": "https://stackoverflow.com/users/2504674/petec"}, "edited": false, "score": 0, "creation_date": 1504105774, "post_id": 45961233, "comment_id": 78886750, "body": "@Micha&#235;lRoy please read <a href=\"https://stackoverflow.com/questions/8819095/\">stackoverflow.com/questions/8819095</a> , I can&#39;t improve on the answers by Anthony Williams and James Kanze."}, {"owner": {"reputation": 5362, "user_id": 2430669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2656586be6c90ef0666a391f1114628b?s=128&d=identicon&r=PG", "display_name": "Micha&#235;l Roy", "link": "https://stackoverflow.com/users/2430669/micha%c3%abl-roy"}, "edited": false, "score": 0, "creation_date": 1504105977, "post_id": 45961233, "comment_id": 78886901, "body": "I cannot improve mine.  std::atomic&lt;&gt; <i>are</i> volatile variables.  And the only reason to exist is to provide the functionality of <code>volatile</code> on multi-core CPUs."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 8847, "user_id": 3484570, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/r5BRZ.png?s=128&g=1", "display_name": "nwp", "link": "https://stackoverflow.com/users/3484570/nwp"}, "edited": false, "score": 1, "creation_date": 1504135104, "post_id": 45961233, "comment_id": 78901245, "body": "<code>volatile std::atomic&lt;&gt;</code> is different from regular <code>std::atomic&lt;&gt;</code>.  However, they both imply possible asynchronous modification, @nwp.  <a href=\"https://stackoverflow.com/a/2479474/224132\">stackoverflow.com/a/2479474/224132</a>"}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1504135252, "post_id": 45961233, "comment_id": 78901280, "body": "@Micha&#235;lRoy: In MSVC, <code>volatile</code> implies some ordering, so it goes beyond what <code>volatile</code> means in C++11.  Quoting examples from MSVC is totally pointless.  So is talking about the meaning of something like <code>asm volatile()</code> in GNU C.  Those are both language extensions, and don&#39;t tell us anything about what <code>volatile</code> means in ISO C++11.  See also <b><a href=\"http://en.cppreference.com/w/cpp/atomic/memory_order#Relationship_with_volatile\" rel=\"nofollow noreferrer\">std::memory_order&#39;s relationship with volatile</a> on cppreference</b>."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 2, "creation_date": 1504139777, "post_id": 45961233, "comment_id": 78902110, "body": "<code>volatile atomic&lt;int&gt; y</code> would actually disallow this optimization, because it implies the store could have a side-effect.  (The standard doesn&#39;t mention &quot;IO devices&quot;, but IIRC it does describe <code>volatile</code> accesses as ones that may have side-effects.)"}, {"owner": {"reputation": 5362, "user_id": 2430669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2656586be6c90ef0666a391f1114628b?s=128&d=identicon&r=PG", "display_name": "Micha&#235;l Roy", "link": "https://stackoverflow.com/users/2430669/micha%c3%abl-roy"}, "reply_to_user": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1504149799, "post_id": 45961233, "comment_id": 78904265, "body": "@Peter The very same applies to gcc and any other compilers.  The guarantees offered by volatile are actually a subset of the guarantees offered by std::atomic.  And that&#39;s the reason why you will find that all implementations, of std::atomic, not just msvc&#39;s, but boost&#39;s, gcc&#39;s, and clang as well do use the keyword.  std::atomic would simply not work without the variable held being promoted to a volatile variable at some point.  The keyword is there to tell the compiler to maintain the ordering. Otherwise, we&#39;d have chaos."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1504152117, "post_id": 45961233, "comment_id": 78904814, "body": "There is overlap, but <code>volatile</code> is not a strict subset of <code>atomic</code>.  The compiler headers have <code>volatile atomic</code> all over the place for the same reason other headers have <code>const</code> all over the place: so you <i>can</i> use them on <code>volatile atomic</code> types, as well as on regular <code>atomic</code> types.  <a href=\"https://stackoverflow.com/questions/2479067/why-is-the-volatile-qualifier-used-through-out-stdatomic\" title=\"why is the volatile qualifier used through out stdatomic\">stackoverflow.com/questions/2479067/&hellip;</a>."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1504152336, "post_id": 45961233, "comment_id": 78904868, "body": "<code>volatile</code> provides no ordering guarantees for the order other threads will see your stores.  On compilers other than MSVC, it has no more ordering than <code>mo_relaxed</code>.  Atomic ordering stuff is exposed directly by compilers.  For gcc, see <a href=\"https://gcc.gnu.org/onlinedocs/gcc/_005f_005fatomic-Builtins.html\" rel=\"nofollow noreferrer\">gcc.gnu.org/onlinedocs/gcc/_005f_005fatomic-Builtins.html</a>.  <code>__atomic_load_n(ptr, __ATOMIC_ACQUIRE);</code> works without including any headers (<a href=\"https://godbolt.org/g/nrW8ak\" rel=\"nofollow noreferrer\">godbolt.org/g/nrW8ak</a> for x86 and powerpc asm output), it&#39;s pure compiler built-in stuff because gcc has those different orderings built-in.  <code>volatile</code> isn&#39;t a necessary part of <code>&lt;atomic&gt;</code>."}, {"owner": {"reputation": 5362, "user_id": 2430669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2656586be6c90ef0666a391f1114628b?s=128&d=identicon&r=PG", "display_name": "Micha&#235;l Roy", "link": "https://stackoverflow.com/users/2430669/micha%c3%abl-roy"}, "edited": false, "score": 0, "creation_date": 1504153195, "post_id": 45961233, "comment_id": 78905124, "body": "Who said <code>volatile atomic</code> ??  Certainly not me.  You obviously haven&#39;t read the stl, nor boost&#39;s code."}, {"owner": {"reputation": 5362, "user_id": 2430669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2656586be6c90ef0666a391f1114628b?s=128&d=identicon&r=PG", "display_name": "Micha&#235;l Roy", "link": "https://stackoverflow.com/users/2430669/micha%c3%abl-roy"}, "edited": false, "score": 0, "creation_date": 1504153782, "post_id": 45961233, "comment_id": 78905314, "body": "And <code>__atomic_load_n</code> is compiler specific, it is also not a library function, but an intrinsic built in the compiler."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 2, "creation_date": 1504193695, "post_id": 45961233, "comment_id": 78930337, "body": "And you think VS2017&#39;s headers <i>aren&#39;t</i> compiler-specific?  /facepalm.  Also, the functions that you quote in your answer use <code>volatile</code> or <code>const volatile</code> on the functions in exactly the way I was talking about: to allow those member functions to be used on <code>volatile atomic&lt;T&gt;</code> objects.  e.g. <code>bool _Is_lock_free() const volatile</code>.  If they didn&#39;t care about <code>volatile atomic</code>, they wouldn&#39;t use the <code>volatile</code> keyword at all."}, {"owner": {"reputation": 5362, "user_id": 2430669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2656586be6c90ef0666a391f1114628b?s=128&d=identicon&r=PG", "display_name": "Micha&#235;l Roy", "link": "https://stackoverflow.com/users/2430669/micha%c3%abl-roy"}, "edited": false, "score": 0, "creation_date": 1504213753, "post_id": 45961233, "comment_id": 78940389, "body": "After 25 years, I sure can tell the difference between ansi-compliant c++ and a compiler intrinsic.  <a href=\"https://gcc.gnu.org/onlinedocs/gcc-4.1.0/gcc/Atomic-Builtins.html\" rel=\"nofollow noreferrer\">gcc.gnu.org/onlinedocs/gcc-4.1.0/gcc/Atomic-Builtins.html</a> ...  I&#39;m speechless."}, {"owner": {"reputation": 16949, "user_id": 7256, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zZFSI.jpg?s=128&g=1", "display_name": "janm", "link": "https://stackoverflow.com/users/7256/janm"}, "edited": false, "score": 0, "creation_date": 1505403190, "post_id": 45961233, "comment_id": 79409169, "body": "@Micha&#235;lRoy The link you provided is for GCC extensions to C in gcc 4.1.0 from over 11 years ago. Things have changed in modern C++."}, {"owner": {"reputation": 5362, "user_id": 2430669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2656586be6c90ef0666a391f1114628b?s=128&d=identicon&r=PG", "display_name": "Micha&#235;l Roy", "link": "https://stackoverflow.com/users/2430669/micha%c3%abl-roy"}, "edited": false, "score": 0, "creation_date": 1505403610, "post_id": 45961233, "comment_id": 79409422, "body": "gcc still supports this <b>intrinsic</b>."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1544238952, "post_id": 45961233, "comment_id": 94216207, "body": "After 25 years you have no understanding of volatile in C/C++. volatile cannot possibly help implementing atomics."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "reply_to_user": {"reputation": 8847, "user_id": 3484570, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/r5BRZ.png?s=128&g=1", "display_name": "nwp", "link": "https://stackoverflow.com/users/3484570/nwp"}, "edited": false, "score": 0, "creation_date": 1544239222, "post_id": 45961233, "comment_id": 94216241, "body": "@nwp &quot;<i>specifically volatile assumes you do not talk to memory, but to devices,</i>&quot; volatile doesn&#39;t assume anything about the semantics of object access; the only assumption is that there is no assumption. Object access matters when dealing with a volatile object: any volatile read must look at the stored value and a volatile write must write a new value. This is useful if you intend to use a debugger and change the value in that object while the program is paused on a breakpoint on a volatile access: changing the value in the debugger will be equivalent with a C/C++ assignment."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1544239386, "post_id": 45961233, "comment_id": 94216259, "body": "So volatile really guarantees something about stepping through the program. (That implies the program is paused.) Most uses of volatile probably don&#39;t deal with external devices. volatile can also be used to implement consume memory ordering in an intelligible and implementable way, unlike the pathetic mess that is the current consume C++ specification."}, {"owner": {"reputation": 5362, "user_id": 2430669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2656586be6c90ef0666a391f1114628b?s=128&d=identicon&r=PG", "display_name": "Micha&#235;l Roy", "link": "https://stackoverflow.com/users/2430669/micha%c3%abl-roy"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1546063975, "post_id": 45961233, "comment_id": 94772029, "body": "@curiousguy:  No. atomic is a software-only feature.  It basically prevents the compiler from optimizing the variable away in a register.  That&#39;s the only effect of the volatile keyword. No effect on the processor itself."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1571967741, "post_id": 45961233, "comment_id": 103422930, "body": "@Micha&#235;lRoy &quot;<i>atomic is a software-only feature</i>&quot; Did you mean: <b>volatile</b> is a software-only feature?"}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "reply_to_user": {"reputation": 18565, "user_id": 10593, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3eeb7653c4df9b0f1332b9b0ec201ec?s=128&d=identicon&r=PG", "display_name": "Max Lybbert", "link": "https://stackoverflow.com/users/10593/max-lybbert"}, "edited": false, "score": 0, "creation_date": 1571968330, "post_id": 45961233, "comment_id": 103423025, "body": "@MaxLybbert &quot;<i>so the compiler must actually read from and write to the variable instead of caching previous reads/writes</i>&quot; What in the std text prevents caching for atomic objects?"}, {"owner": {"reputation": 5362, "user_id": 2430669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2656586be6c90ef0666a391f1114628b?s=128&d=identicon&r=PG", "display_name": "Micha&#235;l Roy", "link": "https://stackoverflow.com/users/2430669/micha%c3%abl-roy"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 1, "creation_date": 1572023610, "post_id": 45961233, "comment_id": 103444651, "body": "@curiousguy  That&#39;s what I meant.  <code>volatile</code> is a software feature, while <code>atomic</code> is a hardware feature.  Sorry for the confusion."}], "tags": [], "owner": {"reputation": 5362, "user_id": 2430669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2656586be6c90ef0666a391f1114628b?s=128&d=identicon&r=PG", "display_name": "Micha&#235;l Roy", "link": "https://stackoverflow.com/users/2430669/micha%c3%abl-roy"}, "is_accepted": false, "score": -3, "last_activity_date": 1504107870, "last_edit_date": 1504107870, "creation_date": 1504098172, "answer_id": 45961233, "question_id": 45960387, "link": "https://stackoverflow.com/questions/45960387/why-dont-compilers-merge-redundant-stdatomic-writes/45961233#45961233", "title": "Why don&#39;t compilers merge redundant std::atomic writes?", "body": "<p>Since variables contained within an std::atomic object are expected to be accessed from multiple threads, one should expect that they behave, at a minimum, as if they were declared with the volatile keyword.  </p>\n\n<p>That was the standard and recommended practice before CPU architectures introduced cache lines, etc.</p>\n\n<p>[EDIT2] One could argue that std::atomic&lt;> are the <code>volatile</code> variables of the multicore age.  As defined in C/C++, <code>volatile</code> is only good enough to synchronize atomic reads from <strong>a single thread</strong>, with an ISR modifying the variable (which in this case is effectively an atomic write as seen from the main thread).</p>\n\n<p>I personally am relieved that no compiler would optimize away writes to an atomic variable.  If the write is optimized away, how can you guarantee that each of these writes could potentially be seen by readers in other threads?  Don't forget that that is also part of the std::atomic&lt;> contract.</p>\n\n<p>Consider this piece of code, where the result would be greatly affected by wild optimization by the compiler.</p>\n\n<pre><code>#include &lt;atomic&gt;\n#include &lt;thread&gt;\n\nstatic const int N{ 1000000 };\nstd::atomic&lt;int&gt; flag{1};\nstd::atomic&lt;bool&gt; do_run { true };\n\nvoid write_1()\n{\n    while (do_run.load())\n    {\n        flag = 1; flag = 1; flag = 1; flag = 1;\n        flag = 1; flag = 1; flag = 1; flag = 1;\n        flag = 1; flag = 1; flag = 1; flag = 1;\n        flag = 1; flag = 1; flag = 1; flag = 1;\n    }\n}\n\nvoid write_0()\n{\n    while (do_run.load())\n    {\n        flag = -1; flag = -1; flag = -1; flag = -1;\n    }\n}\n\n\nint main(int argc, char** argv) \n{\n    int counter{};\n    std::thread t0(&amp;write_0);\n    std::thread t1(&amp;write_1);\n\n    for (int i = 0; i &lt; N; ++i)\n    {\n        counter += flag;\n        std::this_thread::yield();\n    }\n\n    do_run = false;\n\n    t0.join();\n    t1.join();\n\n    return counter;\n}\n</code></pre>\n\n<p>[EDIT] At first, I was not advancing that the <code>volatile</code> was central to the implementation of atomics, but...</p>\n\n<p>Since there seemed to be doubts as to whether <code>volatile</code> had anything to do with atomics, I investigated the matter. Here's the atomic implementation from the VS2017 stl.  As I surmised, the volatile keyword is everywhere.</p>\n\n<pre><code>// from file atomic, line 264...\n\n        // TEMPLATE CLASS _Atomic_impl\ntemplate&lt;unsigned _Bytes&gt;\n    struct _Atomic_impl\n    {   // struct for managing locks around operations on atomic types\n    typedef _Uint1_t _My_int;   // \"1 byte\" means \"no alignment required\"\n\n    constexpr _Atomic_impl() _NOEXCEPT\n        : _My_flag(0)\n        {   // default constructor\n        }\n\n    bool _Is_lock_free() const volatile\n        {   // operations that use locks are not lock-free\n        return (false);\n        }\n\n    void _Store(void *_Tgt, const void *_Src, memory_order _Order) volatile\n        {   // lock and store\n        _Atomic_copy(&amp;_My_flag, _Bytes, _Tgt, _Src, _Order);\n        }\n\n    void _Load(void *_Tgt, const void *_Src,\n        memory_order _Order) const volatile\n        {   // lock and load\n        _Atomic_copy(&amp;_My_flag, _Bytes, _Tgt, _Src, _Order);\n        }\n\n    void _Exchange(void *_Left, void *_Right, memory_order _Order) volatile\n        {   // lock and exchange\n        _Atomic_exchange(&amp;_My_flag, _Bytes, _Left, _Right, _Order);\n        }\n\n    bool _Compare_exchange_weak(\n        void *_Tgt, void *_Exp, const void *_Value,\n        memory_order _Order1, memory_order _Order2) volatile\n        {   // lock and compare/exchange\n        return (_Atomic_compare_exchange_weak(\n            &amp;_My_flag, _Bytes, _Tgt, _Exp, _Value, _Order1, _Order2));\n        }\n\n    bool _Compare_exchange_strong(\n        void *_Tgt, void *_Exp, const void *_Value,\n        memory_order _Order1, memory_order _Order2) volatile\n        {   // lock and compare/exchange\n        return (_Atomic_compare_exchange_strong(\n            &amp;_My_flag, _Bytes, _Tgt, _Exp, _Value, _Order1, _Order2));\n        }\n\nprivate:\n    mutable _Atomic_flag_t _My_flag;\n    };\n</code></pre>\n\n<p>All of the specializations in the MS stl use volatile on the key functions.  </p>\n\n<p>Here's the declaration of one of such key function:</p>\n\n<pre><code> inline int _Atomic_compare_exchange_strong_8(volatile _Uint8_t *_Tgt, _Uint8_t *_Exp, _Uint8_t _Value, memory_order _Order1, memory_order _Order2)\n</code></pre>\n\n<p>You will notice the required <code>volatile uint8_t*</code> holding the value contained in the std::atomic.  This pattern can be observed throughout the MS std::atomic&lt;> implementation, Here is no reason for the gcc team, nor any other stl provider to have done it differently.</p>\n"}, {"comments": [{"owner": {"reputation": 8847, "user_id": 3484570, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/r5BRZ.png?s=128&g=1", "display_name": "nwp", "link": "https://stackoverflow.com/users/3484570/nwp"}, "edited": false, "score": 3, "creation_date": 1504099766, "post_id": 45961718, "comment_id": 78881929, "body": "An example of this would be a progress bar that gets the current state from an <code>atomic</code> while the worker thread does some work and updates the <code>atomic</code> without other synchronization. The optimization would allow a compiler to just write 100% once and not do redundant writes which makes the progress bar not show progress. It is debatable whether such an optimization should be allowed."}, {"owner": {"reputation": 41558, "user_id": 3204551, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/91bb06155f79d40ffecdf124deecb001?s=128&d=identicon&r=PG&f=1", "display_name": "Deduplicator", "link": "https://stackoverflow.com/users/3204551/deduplicator"}, "edited": false, "score": 0, "creation_date": 1504110654, "post_id": 45961718, "comment_id": 78889961, "body": "Maybe the example did not occur verbatim, but only after loads of optimizations like inlining and constant-propagation. Anyway, you are saying can be coalesced, but not worth the bother?"}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 8847, "user_id": 3484570, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/r5BRZ.png?s=128&g=1", "display_name": "nwp", "link": "https://stackoverflow.com/users/3484570/nwp"}, "edited": false, "score": 4, "creation_date": 1504132992, "post_id": 45961718, "comment_id": 78900682, "body": "@nwp: The standard as written <i>does</i> allow it.  Any reordering that&#39;s possible on the C++ abstract machine can be chosen at compile time as what <i>always</i> happens.  This violates programmer expectations for things like progress bars (sinking a atomic stores out of a loop that doesn&#39;t touch any other atomic variables, because concurrent access to non-atomic vars is UB).  For now, compilers choose not to optimize, even though they could.  Hopefully there will be new syntax to control when this is allowed. <a href=\"http://wg21.link/p0062\" rel=\"nofollow noreferrer\">wg21.link/p0062</a> and <a href=\"http://wg21.link/n4455\" rel=\"nofollow noreferrer\">wg21.link/n4455</a>."}], "tags": [], "owner": {"reputation": 10955, "user_id": 1915854, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/gIC27.jpg?s=128&g=1", "display_name": "Serge Rogatch", "link": "https://stackoverflow.com/users/1915854/serge-rogatch"}, "is_accepted": false, "score": 8, "last_activity_date": 1504099501, "creation_date": 1504099501, "answer_id": 45961718, "question_id": 45960387, "link": "https://stackoverflow.com/questions/45960387/why-dont-compilers-merge-redundant-stdatomic-writes/45961718#45961718", "title": "Why don&#39;t compilers merge redundant std::atomic writes?", "body": "<p>While you are changing the value of an atomic in one thread, some other thread may be checking it and performing an operation based on the value of the atomic. The example you gave is so specific that compiler developers don't see it worth optimizing. However, if one thread is setting e.g. consecutive values for an atomic: <code>0</code>, <code>1</code>, <code>2</code>, etc., the other thread may be putting something in the slots indicated by the value of the atomic.</p>\n"}, {"comments": [{"owner": {"reputation": 8847, "user_id": 3484570, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/r5BRZ.png?s=128&g=1", "display_name": "nwp", "link": "https://stackoverflow.com/users/3484570/nwp"}, "edited": false, "score": 9, "creation_date": 1504100277, "post_id": 45961836, "comment_id": 78882344, "body": "The happens-before guarantees are not violated by the optimization. In a different example they might be, but not in this one. It is clearly possible to provide guarantees for the OP&#39;s example. Nothing is being reordered so that part is not relevant to the question."}, {"owner": {"reputation": 4681, "user_id": 6651824, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/LWsU0.jpg?s=128&g=1", "display_name": "LWimsey", "link": "https://stackoverflow.com/users/6651824/lwimsey"}, "edited": false, "score": 4, "creation_date": 1504101986, "post_id": 45961836, "comment_id": 78883760, "body": "@Damon Can you be more specific about what parts in the text disallow this optimization ?"}, {"owner": {"reputation": 29876, "user_id": 476716, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4e325890903afc8269eb2c1aa57587b3?s=128&d=identicon&r=PG", "display_name": "OrangeDog", "link": "https://stackoverflow.com/users/476716/orangedog"}, "reply_to_user": {"reputation": 8847, "user_id": 3484570, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/r5BRZ.png?s=128&g=1", "display_name": "nwp", "link": "https://stackoverflow.com/users/3484570/nwp"}, "edited": false, "score": 0, "creation_date": 1504104417, "post_id": 45961836, "comment_id": 78885631, "body": "@nwp in general it is not possible to work that out. This example is stupidly trivial. If the programmer knows that writing it three times is exactly the same as writing it once, then they should have just written it once."}, {"owner": {"reputation": 41558, "user_id": 3204551, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/91bb06155f79d40ffecdf124deecb001?s=128&d=identicon&r=PG&f=1", "display_name": "Deduplicator", "link": "https://stackoverflow.com/users/3204551/deduplicator"}, "reply_to_user": {"reputation": 29876, "user_id": 476716, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4e325890903afc8269eb2c1aa57587b3?s=128&d=identicon&r=PG", "display_name": "OrangeDog", "link": "https://stackoverflow.com/users/476716/orangedog"}, "edited": false, "score": 2, "creation_date": 1504109842, "post_id": 45961836, "comment_id": 78889431, "body": "@OrangeDog So it is unlikely to appear verbatim. Though it could result from constant-propagation, inlining, and any number of other optimizations."}, {"owner": {"reputation": 41558, "user_id": 3204551, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/91bb06155f79d40ffecdf124deecb001?s=128&d=identicon&r=PG&f=1", "display_name": "Deduplicator", "link": "https://stackoverflow.com/users/3204551/deduplicator"}, "edited": false, "score": 6, "creation_date": 1504110423, "post_id": 45961836, "comment_id": 78889814, "body": "You are saying there is something disallowing coalescing the write in &#91;intro.multithread]. <b>Please quote it</b>. I cannot find it."}, {"owner": {"reputation": 122530, "user_id": 2756719, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b06a9c91425630fdb69e861abe483d7e?s=128&d=identicon&r=PG&f=1", "display_name": "T.C.", "link": "https://stackoverflow.com/users/2756719/t-c"}, "edited": false, "score": 1, "creation_date": 1504127771, "post_id": 45961836, "comment_id": 78898903, "body": "This is simply making stuff up."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 41558, "user_id": 3204551, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/91bb06155f79d40ffecdf124deecb001?s=128&d=identicon&r=PG&f=1", "display_name": "Deduplicator", "link": "https://stackoverflow.com/users/3204551/deduplicator"}, "edited": false, "score": 3, "creation_date": 1504139375, "post_id": 45961836, "comment_id": 78902043, "body": "@Deduplicator: There is no such language that guarantees that other threads must sometimes see intermediate values from a sequence of writes in another thread.  The fact that compilers avoid such optimizations is a quality-of-implementation issue, until the C++ standards committee adds a way to allow it selectively, because it can be a problem.  See <a href=\"https://stackoverflow.com/questions/45960387/why-dont-compilers-merge-redundant-stdatomic-writes/45971285#45971285\">my answer</a> for some links to standards working-group proposals that back up this interpretation that it&#39;s allowed."}, {"owner": {"reputation": 61429, "user_id": 572743, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/9941673f566f229bc536c1c2b558884e?s=128&d=identicon&r=PG&f=1", "display_name": "Damon", "link": "https://stackoverflow.com/users/572743/damon"}, "reply_to_user": {"reputation": 41558, "user_id": 3204551, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/91bb06155f79d40ffecdf124deecb001?s=128&d=identicon&r=PG&f=1", "display_name": "Deduplicator", "link": "https://stackoverflow.com/users/3204551/deduplicator"}, "edited": false, "score": 0, "creation_date": 1504170351, "post_id": 45961836, "comment_id": 78913588, "body": "@Deduplicator: The paragraphs that I quoted do that in their entity. Reordering is <i>explicitly</i> disallowed (19) as stated, whereas coalescing is not addressed explicitly. It is however <i>factually</i> disallowed because e.g. 15 and 17 cannot be satisfied except in the most contrieved trivial examples which do not contain write-write or read-write, or write-read at all (or, well, no concurrency). There is for example no way of A being earlier in the modification order (in respect to e.g. B) if you optimize out A."}, {"owner": {"reputation": 29876, "user_id": 476716, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4e325890903afc8269eb2c1aa57587b3?s=128&d=identicon&r=PG", "display_name": "OrangeDog", "link": "https://stackoverflow.com/users/476716/orangedog"}, "reply_to_user": {"reputation": 41558, "user_id": 3204551, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/91bb06155f79d40ffecdf124deecb001?s=128&d=identicon&r=PG&f=1", "display_name": "Deduplicator", "link": "https://stackoverflow.com/users/3204551/deduplicator"}, "edited": false, "score": 0, "creation_date": 1504172769, "post_id": 45961836, "comment_id": 78915370, "body": "@Deduplicator All of which would result from equally trivial and pointless code."}, {"owner": {"reputation": 29876, "user_id": 476716, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4e325890903afc8269eb2c1aa57587b3?s=128&d=identicon&r=PG", "display_name": "OrangeDog", "link": "https://stackoverflow.com/users/476716/orangedog"}, "reply_to_user": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1504176085, "post_id": 45961836, "comment_id": 78917718, "body": "@PeterCordes &quot;There is no such language that guarantees that other threads must sometimes see intermediate values from a sequence of writes in another thread.&quot; Huh? Loads of languages have that, usually via <code>volatile</code> or explicit memory synchronisation points."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 29876, "user_id": 476716, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4e325890903afc8269eb2c1aa57587b3?s=128&d=identicon&r=PG", "display_name": "OrangeDog", "link": "https://stackoverflow.com/users/476716/orangedog"}, "edited": false, "score": 2, "creation_date": 1504194646, "post_id": 45961836, "comment_id": 78931023, "body": "@OrangeDog: I meant for non-<code>volatile</code> <code>atomic</code>.  I think you&#39;re right that <code>volatile atomic</code> would portably disable such optimizations, which would make it sometimes possible on typical current SMP hardware.  (So would a compiler memory barrier like GNU C <code>asm(&quot;&quot;::: &quot;memory&quot;)</code>.)  But the C++ standard still doesn&#39;t guarantee that a thread spinning on <code>y</code> ever sees <code>y==2</code>.  e.g. on a uniprocessor machine it&#39;s <i>very</i> unlikely, and deterministic context switches or something could make it impossible."}, {"owner": {"reputation": 29876, "user_id": 476716, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4e325890903afc8269eb2c1aa57587b3?s=128&d=identicon&r=PG", "display_name": "OrangeDog", "link": "https://stackoverflow.com/users/476716/orangedog"}, "reply_to_user": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1504194840, "post_id": 45961836, "comment_id": 78931146, "body": "@PeterCordes I&#39;ve not looked, but I imagine that various of these standard library items (such as <code>std::atomic</code>) mandate memory barriers (or equivalent semantics) if supported by the target system. They certainly do in other languages."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 29876, "user_id": 476716, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4e325890903afc8269eb2c1aa57587b3?s=128&d=identicon&r=PG", "display_name": "OrangeDog", "link": "https://stackoverflow.com/users/476716/orangedog"}, "edited": false, "score": 1, "creation_date": 1504196927, "post_id": 45961836, "comment_id": 78932324, "body": "@OrangeDog: normally atomics are only ordered with respect to other atomics, because concurrent access to non-<code>atomic</code> variables is still UB (data race).  <code>atomic_signal_fence</code> orders even vanilla variables on gcc, but IDK if that&#39;s an implementation-detail or required by the standard.  See <a href=\"https://stackoverflow.com/questions/40579342/is-there-any-compiler-barrier-which-is-equal-to-asm-memory-in-c11\" title=\"is there any compiler barrier which is equal to asm memory in c11\">stackoverflow.com/questions/40579342/&hellip;</a> for  <code>atomic_thread_fence</code> vs. <code>atomic_signal_fence</code> on gcc."}, {"owner": {"reputation": 29876, "user_id": 476716, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4e325890903afc8269eb2c1aa57587b3?s=128&d=identicon&r=PG", "display_name": "OrangeDog", "link": "https://stackoverflow.com/users/476716/orangedog"}, "reply_to_user": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1504197012, "post_id": 45961836, "comment_id": 78932372, "body": "@PeterCordes that doesn&#39;t change anything. The only way to read a write to an atomic is via the atomic."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 29876, "user_id": 476716, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4e325890903afc8269eb2c1aa57587b3?s=128&d=identicon&r=PG", "display_name": "OrangeDog", "link": "https://stackoverflow.com/users/476716/orangedog"}, "edited": false, "score": 0, "creation_date": 1504197185, "post_id": 45961836, "comment_id": 78932454, "body": "@OrangeDog: It explains why <code>atomic_thread_fence</code> or a release-store is <i>not</i> equivalent to <code>asm(&quot;&quot; ::: &quot;memory&quot;)</code>: because a compiler-barrier for non-atomics would block optimizations (of non-atomic operations in the same loop or whatever) that the standard doesn&#39;t require it to block."}, {"owner": {"reputation": 29876, "user_id": 476716, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4e325890903afc8269eb2c1aa57587b3?s=128&d=identicon&r=PG", "display_name": "OrangeDog", "link": "https://stackoverflow.com/users/476716/orangedog"}, "reply_to_user": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1504197256, "post_id": 45961836, "comment_id": 78932496, "body": "@PeterCordes &quot;There is no such language that guarantees that other threads must sometimes see intermediate values from a sequence of writes in another thread.&quot; is what I&#39;m refuting. Everything else is irrelevant detail."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 29876, "user_id": 476716, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4e325890903afc8269eb2c1aa57587b3?s=128&d=identicon&r=PG", "display_name": "OrangeDog", "link": "https://stackoverflow.com/users/476716/orangedog"}, "edited": false, "score": 0, "creation_date": 1504197725, "post_id": 45961836, "comment_id": 78932759, "body": "@OrangeDog: Ah, I see what you&#39;re saying now.  All I was trying to claim is that <code>y.store(1, mo_relaxed)</code> doesn&#39;t imply any kind of barrier, not that you <i>can&#39;t</i> get a barrier (especially with language extensions like GNU C++).  Just to be clear, did you mean a reordering barrier like x86 <code>mfence</code>? <code>std::atomic</code> lets you get that kind of barrier.  But <code>std::atomic</code> doesn&#39;t have &quot;memory contents must be consistent&quot; optimization barriers; that&#39;s an implementation detail that C++11 doesn&#39;t specify, because it only matters for stuff like inline asm that goes beyond pure ISO C++."}, {"owner": {"reputation": 29876, "user_id": 476716, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4e325890903afc8269eb2c1aa57587b3?s=128&d=identicon&r=PG", "display_name": "OrangeDog", "link": "https://stackoverflow.com/users/476716/orangedog"}, "edited": false, "score": 0, "creation_date": 1504197838, "post_id": 45961836, "comment_id": 78932813, "body": "If <code>std::atomic</code> does not, then it&#39;s as broken as <code>volatile</code> was in Java 1.3."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "reply_to_user": {"reputation": 29876, "user_id": 476716, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4e325890903afc8269eb2c1aa57587b3?s=128&d=identicon&r=PG", "display_name": "OrangeDog", "link": "https://stackoverflow.com/users/476716/orangedog"}, "edited": false, "score": 0, "creation_date": 1544302414, "post_id": 45961836, "comment_id": 94230153, "body": "@OrangeDog How is atomic broken? For which use?"}], "tags": [], "owner": {"reputation": 61429, "user_id": 572743, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/9941673f566f229bc536c1c2b558884e?s=128&d=identicon&r=PG&f=1", "display_name": "Damon", "link": "https://stackoverflow.com/users/572743/damon"}, "is_accepted": false, "score": 3, "last_activity_date": 1504099837, "creation_date": 1504099837, "answer_id": 45961836, "question_id": 45960387, "link": "https://stackoverflow.com/questions/45960387/why-dont-compilers-merge-redundant-stdatomic-writes/45961836#45961836", "title": "Why don&#39;t compilers merge redundant std::atomic writes?", "body": "<p>In short, because the standard (for example the paragaraphs around and below 20 in <code>[intro.multithread]</code>) disallows for it.</p>\n\n<p>There are happens-before guarantees which must be fulfilled, and which among other things rule out reordering or coalescing writes (paragraph 19 even says so explicitly about reordering).</p>\n\n<p>If your thread writes three values to memory (let's say 1, 2, and 3) one after another, a different thread may read the value. If, for example, your thread is interrupted (or even if it runs concurrently) and another thread <em>also</em> writes to that location, then the observing thread must see the operations in exactly the same order as they happen (either by scheduling or coincidence, or whatever reason). That's a guarantee.  </p>\n\n<p>How is this possible if you only do half of the writes (or even only a single one)? It isn't.</p>\n\n<p>What if your thread instead writes out 1 -1 -1 but another one sporadically writes out 2 or 3? What if a third thread observes the location and waits for a particular value that just never appears because it's optimized out?</p>\n\n<p>It is impossible to provide the guarantees that are given if stores (and loads, too) aren't performed as requested. All of them, and in the same order.</p>\n"}, {"comments": [{"owner": {"reputation": 4681, "user_id": 6651824, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/LWsU0.jpg?s=128&g=1", "display_name": "LWimsey", "link": "https://stackoverflow.com/users/6651824/lwimsey"}, "edited": false, "score": 4, "creation_date": 1504102151, "post_id": 45962130, "comment_id": 78883886, "body": "Nobody said it was a data race"}, {"owner": {"reputation": 6673, "user_id": 4213662, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/693430827/picture?type=large", "display_name": "Persixty", "link": "https://stackoverflow.com/users/4213662/persixty"}, "reply_to_user": {"reputation": 4681, "user_id": 6651824, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/LWsU0.jpg?s=128&g=1", "display_name": "LWimsey", "link": "https://stackoverflow.com/users/6651824/lwimsey"}, "edited": false, "score": 1, "creation_date": 1504102612, "post_id": 45962130, "comment_id": 78884249, "body": "@LWimsey Indeed and it isn&#39;t a data race. That&#39;s the point. It&#39;s data races that the C++ standard concerns itself with. So the reasoning about race-free observers in the OP are irrelevant. C++ has no problem with race-exposed observers and indeed things like <code>try_lock_for</code> invite racing!  The answer as to why compilers don&#39;t optimize that is because it has defined semantics (raceful or otherwise) and the standard wants those to happen (whatever so they may be)."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1504134696, "post_id": 45962130, "comment_id": 78901148, "body": "Spinning on an atomic load of <code>y</code> looking for <code>y==2</code> is a race condition (and is probably what the OP had in mind when talking about a race-free observer).  It&#39;s only the garden-variety bug kind of race, not the C++ Undefined Behaviour kind, though."}], "tags": [], "owner": {"reputation": 6673, "user_id": 4213662, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/693430827/picture?type=large", "display_name": "Persixty", "link": "https://stackoverflow.com/users/4213662/persixty"}, "is_accepted": false, "score": 5, "last_activity_date": 1504101588, "last_edit_date": 1504101588, "creation_date": 1504100612, "answer_id": 45962130, "question_id": 45960387, "link": "https://stackoverflow.com/questions/45960387/why-dont-compilers-merge-redundant-stdatomic-writes/45962130#45962130", "title": "Why don&#39;t compilers merge redundant std::atomic writes?", "body": "<p>NB: I was going to comment this but it's a bit too wordy.</p>\n\n<p>One interesting fact is that this behavior isn't in the terms of C++ a data race.</p>\n\n<p>Note 21 on p.14 is interesting: <a href=\"http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3690.pdf\" rel=\"nofollow noreferrer\">http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3690.pdf</a> (my emphasis):</p>\n\n<blockquote>\n  <p>The execution of a program contains a data race if it contains two\n  conflicting actions in different threads, at least <strong>one of which is\n  not atomic</strong></p>\n</blockquote>\n\n<p>Also on p.11 note 5 :</p>\n\n<blockquote>\n  <p>\u201cRelaxed\u201d atomic operations are not synchronization operations even\n  though, like synchronization operations, they cannot contribute to\n  data races.</p>\n</blockquote>\n\n<p>So a conflicting action on an atomic is never a data race - in terms of the C++ standard.</p>\n\n<p>These operations are all atomic (and specifically relaxed) but no data race here folks!</p>\n\n<p>I agree there's no reliable/predictable difference between these two on any (reasonable) platform:</p>\n\n<pre><code>include &lt;atomic&gt;\nstd::atomic&lt;int&gt; y(0);\nvoid f() {\n  auto order = std::memory_order_relaxed;\n  y.store(1, order);\n  y.store(1, order);\n  y.store(1, order);\n}\n</code></pre>\n\n<p>and </p>\n\n<pre><code>include &lt;atomic&gt;\nstd::atomic&lt;int&gt; y(0);\nvoid f() {\n  auto order = std::memory_order_relaxed;\n  y.store(1, order);\n}\n</code></pre>\n\n<p>But within the definition provided C++ memory model it isn't a data race.</p>\n\n<p>I can't easily understand why that definition is provided but it does hand the developer a few cards to engage in haphazard communication between threads that they may know (on their platform) will statistically work.</p>\n\n<p>For example, setting a value 3 times then reading it back will show some degree of contention for that location. Such approaches aren't deterministic but many effective concurrent algorithms aren't deterministic. \nFor example, a timed-out <code>try_lock_until()</code> is always a race condition but remains a useful technique.</p>\n\n<p>What it appears the C++ Standard is providing you with certainty around 'data races' but permitting certain fun-and-games with race conditions which are on final analysis different things.</p>\n\n<p>In short the standard appears to specify that where other threads may see the 'hammering' effect of a value being set 3 times, other threads must be able to see that effect (even if they sometimes may not!). \nIt's the case where pretty much all modern platforms that other thread may under some circumstances see the hammering.</p>\n"}, {"comments": [{"owner": {"reputation": 8847, "user_id": 3484570, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/r5BRZ.png?s=128&g=1", "display_name": "nwp", "link": "https://stackoverflow.com/users/3484570/nwp"}, "edited": false, "score": 2, "creation_date": 1504101641, "post_id": 45962462, "comment_id": 78883503, "body": "Is the changed behavior guaranteed? Optimizations change behavior all the time, they tend to make execution faster, which can have a huge impact on timing-sensitive code, yet that is considered valid."}, {"owner": {"reputation": 762, "user_id": 1987633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7cc5084e895540051a920e541ab9b8c?s=128&d=identicon&r=PG", "display_name": "Andre Kostur", "link": "https://stackoverflow.com/users/1987633/andre-kostur"}, "reply_to_user": {"reputation": 8847, "user_id": 3484570, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/r5BRZ.png?s=128&g=1", "display_name": "nwp", "link": "https://stackoverflow.com/users/3484570/nwp"}, "edited": false, "score": 0, "creation_date": 1504102240, "post_id": 45962462, "comment_id": 78883953, "body": "The atomic part changes things.  That forces the store to be visible to other threads.  There&#39;s three stores to <code>y</code> that must be visible to other threads.  If <code>y</code> were not atomic, then sure, the optimizer can drop the first two assignments since nothing in this thread could see that they&#39;d been dropped, and nothing guaranteed that the assignments would be visible to other threads.   But since it&#39;s atomic, and does guarantee the change is visible to other threads, the optimizer cannot drop that code. (Not without somehow validating that <i>everywhere</i> else doesn&#39;t use it either.)"}, {"owner": {"reputation": 8847, "user_id": 3484570, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/r5BRZ.png?s=128&g=1", "display_name": "nwp", "link": "https://stackoverflow.com/users/3484570/nwp"}, "edited": false, "score": 0, "creation_date": 1504102372, "post_id": 45962462, "comment_id": 78884061, "body": "But 1 write already makes it visible to other threads. How would the other threads figure out the difference between 1 and 3 writes?"}, {"owner": {"reputation": 762, "user_id": 1987633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7cc5084e895540051a920e541ab9b8c?s=128&d=identicon&r=PG", "display_name": "Andre Kostur", "link": "https://stackoverflow.com/users/1987633/andre-kostur"}, "reply_to_user": {"reputation": 8847, "user_id": 3484570, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/r5BRZ.png?s=128&g=1", "display_name": "nwp", "link": "https://stackoverflow.com/users/3484570/nwp"}, "edited": false, "score": 0, "creation_date": 1504102808, "post_id": 45962462, "comment_id": 78884386, "body": "See my full answer.  Step away from the pathological case where the three stores are literally next to each other.  Put some non-trivial code in there to make it more likely that other threads get some time slices between those stores.   Have a second thread that all it does is read <code>y</code>, if <code>y</code> == 1, do something (which is much faster than the extra work we added to the first thread) and set it to 2.   This second thread should be triggered 3 times, not just once at the end."}, {"owner": {"reputation": 917, "user_id": 2504674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4df1119bfdf1e97bac7fb18996160ba?s=128&d=identicon&r=PG", "display_name": "PeteC", "link": "https://stackoverflow.com/users/2504674/petec"}, "edited": false, "score": 3, "creation_date": 1504104026, "post_id": 45962462, "comment_id": 78885370, "body": "@AndreKostur &#39;should be&#39;? If you&#39;re relying on that, your program logic is broken. An optimizer&#39;s job is to produce a valid output for less effort. &#39;thread 2 gets no time slices between the stores&#39; is a perfectly valid outcome."}, {"owner": {"reputation": 762, "user_id": 1987633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7cc5084e895540051a920e541ab9b8c?s=128&d=identicon&r=PG", "display_name": "Andre Kostur", "link": "https://stackoverflow.com/users/1987633/andre-kostur"}, "reply_to_user": {"reputation": 917, "user_id": 2504674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4df1119bfdf1e97bac7fb18996160ba?s=128&d=identicon&r=PG", "display_name": "PeteC", "link": "https://stackoverflow.com/users/2504674/petec"}, "edited": false, "score": 0, "creation_date": 1504107001, "post_id": 45962462, "comment_id": 78887621, "body": "@PeteC So is &quot;thread 2 (and 3, and 4...) gets lots of time slices between the stores&quot;, and because it&#39;s an atomic store, that must be visible to the other threads.  The optimizer is not allowed to optimize away that visible side-effect as it has to assume that something can get between those two stores and may go and do its own store."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 2, "creation_date": 1504138983, "post_id": 45962462, "comment_id": 78901988, "body": "The standard as written <i>does</i> allow compilers to optimize away the window for another thread to do something.  Your reasoning for that (and stuff like a progress bar), are why real compilers choose not to do such optimizations.  See <a href=\"https://stackoverflow.com/questions/45960387/why-dont-compilers-merge-redundant-stdatomic-writes/45971285#45971285\">my answer</a> for some links to C++ standards discussions about allowing giving programmers control so optimizations can be done where helpful and avoided where harmful."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1544293261, "post_id": 45962462, "comment_id": 94227657, "body": "@AndreKostur &quot;<i>Put some non-trivial code in there</i>&quot; what code? Code doing number crunching? doing thread synchronisation? doing I/O?"}], "tags": [], "owner": {"reputation": 762, "user_id": 1987633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7cc5084e895540051a920e541ab9b8c?s=128&d=identicon&r=PG", "display_name": "Andre Kostur", "link": "https://stackoverflow.com/users/1987633/andre-kostur"}, "is_accepted": false, "score": -1, "last_activity_date": 1504101478, "creation_date": 1504101478, "answer_id": 45962462, "question_id": 45960387, "link": "https://stackoverflow.com/questions/45960387/why-dont-compilers-merge-redundant-stdatomic-writes/45962462#45962462", "title": "Why don&#39;t compilers merge redundant std::atomic writes?", "body": "<p>Let's walk a little further away from the pathological case of the three stores being immediately next to each other.   Let's assume there's some non-trivial work being done between the stores, and that such work does not involve <code>y</code> at all (so that data path analysis can determine that the three stores are in fact redundant, at least within this thread), and does not itself introduce any memory barriers (so that something else doesn't force the stores to be visible to other threads).  Now it is quite possible that other threads have an opportunity to get work done between the stores, and perhaps those other threads manipulate <code>y</code> and that this thread has some reason to need to reset it to 1 (the 2nd store).  If the first two stores were dropped, that would change the behaviour.</p>\n"}, {"comments": [{"owner": {"reputation": 159118, "user_id": 15416, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/a2b11b9662b5155aada74191fbe7cb9e?s=128&d=identicon&r=PG", "display_name": "MSalters", "link": "https://stackoverflow.com/users/15416/msalters"}, "edited": false, "score": 2, "creation_date": 1504126511, "post_id": 45965154, "comment_id": 78898362, "body": "You refer to N4455, but seem to have an entirely different interpretation of N4455 than I do. Even the first example in N4455 is more complex that  your example (adds instead of outright stores), and that example is described as &quot;non-contentious&quot; (that optimizations are possible). And given that N4455 also states LLVM implements some of optimizations mentioned, it&#39;s safe to assume that easiest one is certainly implemented."}, {"owner": {"reputation": 33092, "user_id": 5801661, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D8ENZ.jpg?s=128&g=1", "display_name": "Margaret Bloom", "link": "https://stackoverflow.com/users/5801661/margaret-bloom"}, "reply_to_user": {"reputation": 159118, "user_id": 15416, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/a2b11b9662b5155aada74191fbe7cb9e?s=128&d=identicon&r=PG", "display_name": "MSalters", "link": "https://stackoverflow.com/users/15416/msalters"}, "edited": false, "score": 0, "creation_date": 1504131267, "post_id": 45965154, "comment_id": 78900178, "body": "@MSalters I though the N4455 was a draft honestly, only one optimisation is listed as implemented (<a href=\"https://godbolt.org/g/qJ6F3V\" rel=\"nofollow noreferrer\">I wasn&#39;t able to reproduce it</a>). I believe the first example is not really different from mine: both should be optimizable, but are not. However, while I have an understanding of how this work under the hood, I&#39;m not well-founded in C++ standardese. Surely your understanding is better than mine! I&#39;d never want to spread misinformation, if you see a unfixable flaw in this answer please let me know!"}, {"owner": {"reputation": 159118, "user_id": 15416, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/a2b11b9662b5155aada74191fbe7cb9e?s=128&d=identicon&r=PG", "display_name": "MSalters", "link": "https://stackoverflow.com/users/15416/msalters"}, "edited": false, "score": 0, "creation_date": 1504134031, "post_id": 45965154, "comment_id": 78900949, "body": "Hmm, might need a bit of reading up what&#39;s happening there.  As for N4455 being a draft: that&#39;s not really the point; it gives us an inside view from the perspective of compiler developers. That also means they&#39;re playing with a code base we don&#39;t have yet ;)"}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1504134210, "post_id": 45965154, "comment_id": 78901002, "body": "Having a thread looping on a CAS or atomic load waiting to see <code>y=2</code> is a race condition, but just the ordinary bug kind, not the Undefined Behaviour kind (because it&#39;s on an <code>atomic</code> type)."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 159118, "user_id": 15416, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/a2b11b9662b5155aada74191fbe7cb9e?s=128&d=identicon&r=PG", "display_name": "MSalters", "link": "https://stackoverflow.com/users/15416/msalters"}, "edited": false, "score": 3, "creation_date": 1504134273, "post_id": 45965154, "comment_id": 78901020, "body": "@MSalters: As I understand it, compilers could optimize but for now are choosing not to, because that would violate programmer expectations for things like a progress bar.  New syntax is needed to allow programmers to choose.  The standard as written allows any possible reordering that could happen on the C++ abstract machine to be picked (at compile time) as the ordering that <i>always</i> happens, but this is undesireable.  See also <a href=\"http://wg21.link/p0062\" rel=\"nofollow noreferrer\">wg21.link/p0062</a>."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 159118, "user_id": 15416, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/a2b11b9662b5155aada74191fbe7cb9e?s=128&d=identicon&r=PG", "display_name": "MSalters", "link": "https://stackoverflow.com/users/15416/msalters"}, "edited": false, "score": 0, "creation_date": 1504138126, "post_id": 45965154, "comment_id": 78901813, "body": "@MSalters: posted <a href=\"https://stackoverflow.com/questions/45960387/why-dont-compilers-merge-redundant-stdatomic-writes/45971285#45971285\">my own answer</a>, since there are so many wrong answers to this question.  (Unless <i>I&#39;m</i> wrong.)  This answer is correct about the central question, but the reason for not optimizing is that compilers on purpose don&#39;t as a quality-of-implementation issue, even in cases where they could easily spot the optimization."}, {"owner": {"reputation": 5668, "user_id": 4083309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6b4ef5a2e912153069b82607789a717?s=128&d=identicon&r=PG&f=1", "display_name": "Arne Vogel", "link": "https://stackoverflow.com/users/4083309/arne-vogel"}, "edited": false, "score": 3, "creation_date": 1504176220, "post_id": 45965154, "comment_id": 78917794, "body": "@MargaretBloom: 1) sequentially consistent vs. relaxed doesn&#39;t matter here (the difference is only relevant when <i>other</i> memory locations come into play). 2) In your <code>y==2</code> check example, there is what I call a logical race, but no data race. This is a very important distinction. Think &quot;unspecified&quot; vs. &quot;undefined&quot; behavior: might ever see <code>y==2</code>, or might not, but no nasal demons. 3) There is <i>always</i> a total order on the operations on a single atomic (even with <code>relaxed</code>). The order may just not be predictable. 4) I agree that atomics can be very confusing. ;-)"}, {"owner": {"reputation": 5362, "user_id": 2430669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2656586be6c90ef0666a391f1114628b?s=128&d=identicon&r=PG", "display_name": "Micha&#235;l Roy", "link": "https://stackoverflow.com/users/2430669/micha%c3%abl-roy"}, "edited": false, "score": 0, "creation_date": 1504614921, "post_id": 45965154, "comment_id": 79069608, "body": "That&#39;s a lot of words and no mention of the fact that the standard guarantees that every single write will be seen on other threads.  Since the hardware cannot guess what is going on in other threads, that precludes any write optimization."}, {"owner": {"reputation": 33092, "user_id": 5801661, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D8ENZ.jpg?s=128&g=1", "display_name": "Margaret Bloom", "link": "https://stackoverflow.com/users/5801661/margaret-bloom"}, "reply_to_user": {"reputation": 5362, "user_id": 2430669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2656586be6c90ef0666a391f1114628b?s=128&d=identicon&r=PG", "display_name": "Micha&#235;l Roy", "link": "https://stackoverflow.com/users/2430669/micha%c3%abl-roy"}, "edited": false, "score": 0, "creation_date": 1504615845, "post_id": 45965154, "comment_id": 79070296, "body": "@Micha&#235;lRoy I believe the program has to behave <i>as if</i> every single write is visible to another thread if the standard says so. This makes room for optimisations."}, {"owner": {"reputation": 5362, "user_id": 2430669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2656586be6c90ef0666a391f1114628b?s=128&d=identicon&r=PG", "display_name": "Micha&#235;l Roy", "link": "https://stackoverflow.com/users/2430669/micha%c3%abl-roy"}, "edited": false, "score": 0, "creation_date": 1504617877, "post_id": 45965154, "comment_id": 79071875, "body": "&#39;As if&#39; is not the same as a guarantee.  The write has to be done every single time, as ultimately, the guarantee lies with the hardware.  Threads and cores do not do ESP."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "reply_to_user": {"reputation": 5362, "user_id": 2430669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2656586be6c90ef0666a391f1114628b?s=128&d=identicon&r=PG", "display_name": "Micha&#235;l Roy", "link": "https://stackoverflow.com/users/2430669/micha%c3%abl-roy"}, "edited": false, "score": 0, "creation_date": 1544238472, "post_id": 45965154, "comment_id": 94216149, "body": "@Micha&#235;lRoy &quot;<i>the standard guarantees that every single write will be seen on other threads</i>&quot; That &quot;guarantee&quot; makes no sense whatsoever."}, {"owner": {"reputation": 5362, "user_id": 2430669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2656586be6c90ef0666a391f1114628b?s=128&d=identicon&r=PG", "display_name": "Micha&#235;l Roy", "link": "https://stackoverflow.com/users/2430669/micha%c3%abl-roy"}, "edited": false, "score": 0, "creation_date": 1546064378, "post_id": 45965154, "comment_id": 94772091, "body": "atomic variables are declared volatile, so the compiler cannot do the optimization discussed in the question, as defined in the C++ standard. That&#39;s one part of the guarantee, the other part of the guarantee is provided by the cpu through its atomic instructions."}], "tags": [], "owner": {"reputation": 33092, "user_id": 5801661, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D8ENZ.jpg?s=128&g=1", "display_name": "Margaret Bloom", "link": "https://stackoverflow.com/users/5801661/margaret-bloom"}, "is_accepted": false, "score": 43, "last_activity_date": 1504109356, "creation_date": 1504109356, "answer_id": 45965154, "question_id": 45960387, "link": "https://stackoverflow.com/questions/45960387/why-dont-compilers-merge-redundant-stdatomic-writes/45965154#45965154", "title": "Why don&#39;t compilers merge redundant std::atomic writes?", "body": "<p>You are referring to dead-stores elimination.  </p>\n\n<p>It is not forbidden to eliminate an atomic dead store but it is harder to prove that an atomic store qualifies as such.</p>\n\n<blockquote>\n  <p>Traditional compiler optimizations, such as dead store elimination, can be performed on atomic operations, even sequentially consistent ones.<br>\n  Optimizers have to be careful to avoid doing so across <em>synchronization</em> points because another thread of execution can observe or modify memory, which means that the traditional optimizations have to consider more intervening instructions than they usually would when considering optimizations to atomic operations.<br>\n  <strong>In the case of dead store elimination it isn\u2019t sufficient to prove that an atomic store post-dominates and aliases another to eliminate the other store.</strong></p>\n  \n  <p><sup>from <a href=\"http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2015/n4455.html\" rel=\"noreferrer\">N4455 No Sane Compiler Would Optimize Atomics</a></sup></p>\n</blockquote>\n\n<p>The problem of atomic DSE, in the general case, is that it involves looking for synchronization points, in my understanding this term means points in the code where there is <em>happen-before</em> relationship between an instruction on a thread A and instruction on <em>another</em> thread B.  </p>\n\n<p>Consider this code executed by a thread A:</p>\n\n<pre><code>y.store(1, std::memory_order_seq_cst);\ny.store(2, std::memory_order_seq_cst);\ny.store(3, std::memory_order_seq_cst);\n</code></pre>\n\n<p>Can it be optimised as <code>y.store(3, std::memory_order_seq_cst)</code>?</p>\n\n<p>If a thread B is waiting to see <code>y = 2</code> (e.g. with a CAS) it would never observe that if the code gets optimised.  </p>\n\n<p>However, in my understanding, having B looping and CASsing on <code>y = 2</code> is a data race as there is not a total order between the two threads' instructions.<br>\nAn execution where the A's instructions are executed before the B's loop is observable (i.e. allowed) and thus the compiler can optimise to <code>y.store(3, std::memory_order_seq_cst)</code>.</p>\n\n<p>If threads A and B are synchronized, somehow, between the stores in thread A then the optimisation would not be allowed (a partial order would be induced, possibly leading to B potentially observing <code>y = 2</code>).  </p>\n\n<p>Proving that there is not such a synchronization is hard as it involves considering a broader scope and taking into account all the quirks of an architecture.</p>\n\n<p>As for my understanding, due to the relatively small age of the atomic operations and the difficulty in reasoning about memory ordering, visibility and synchronization, compilers don't perform all the possible optimisations on atomics until a more robust framework for detecting and understanding the necessary conditions is built.</p>\n\n<p>I believe your example is a simplification of the counting thread given above, as it doesn't have any other thread or any synchronization point, for what I can see, I suppose the compiler could have optimised the three stores.</p>\n"}, {"comments": [{"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 2, "creation_date": 1504138744, "post_id": 45969796, "comment_id": 78901943, "body": "Yes the standard allows this, but real compilers don&#39;t do these optimization, because there&#39;s no syntax for <i>stopping</i> them in cases like a progress-bar update, so it&#39;s a quality-of-implementation issue.  See <a href=\"https://stackoverflow.com/questions/45960387/why-dont-compilers-merge-redundant-stdatomic-writes/45971285#45971285\">my answer</a>"}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "reply_to_user": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1504140703, "post_id": 45969796, "comment_id": 78902253, "body": "@PeterCordes Nice answer, especially the links to the actual WG discussions."}], "tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": false, "score": 2, "last_activity_date": 1504127638, "creation_date": 1504127638, "answer_id": 45969796, "question_id": 45960387, "link": "https://stackoverflow.com/questions/45960387/why-dont-compilers-merge-redundant-stdatomic-writes/45969796#45969796", "title": "Why don&#39;t compilers merge redundant std::atomic writes?", "body": "<p>A practical use case for the pattern, if the thread does something important between updates that does not depend on or modify <code>y</code>, might be: *Thread 2 reads the value of <code>y</code> to check how much progress Thread 1 has made.`</p>\n\n<p>So, maybe Thread 1 is supposed to load the configuration file as step 1, put its parsed contents into a data structure as step 2, and display the main window as step 3, while Thread 2 is waiting on step 2 to complete so it can perform another task in parallel that depends on the data structure.  (Granted, this example calls for acquire/release semantics, not relaxed ordering.)</p>\n\n<p>I\u2019m pretty sure a conforming implementation allows Thread 1 not to update <code>y</code> at any intermediate step\u2014while I haven\u2019t pored over the language standard, I would be shocked if it does not support hardware on which another thread polling <code>y</code> might never see the value 2.</p>\n\n<p>However, that is a hypothetical instance where it might be pessimal to optimize away the status updates.  Maybe a compiler dev will come here and say why that compiler chose not to, but one possible reason is letting you shoot yourself in the foot, or at least stub yourself in the toe.</p>\n"}, {"tags": [], "owner": {"reputation": 47569, "user_id": 3255455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5993e7ece129141878cd6419d39cc26e?s=128&d=identicon&r=PG&f=1", "display_name": "gnasher729", "link": "https://stackoverflow.com/users/3255455/gnasher729"}, "is_accepted": false, "score": -1, "last_activity_date": 1504133115, "creation_date": 1504133115, "answer_id": 45970805, "question_id": 45960387, "link": "https://stackoverflow.com/questions/45960387/why-dont-compilers-merge-redundant-stdatomic-writes/45970805#45970805", "title": "Why don&#39;t compilers merge redundant std::atomic writes?", "body": "<p>The compiler writer cannot just perform the optimisation. They must also convince themselves that the optimisation is valid in the situations where the compiler writer intends to apply it, that it will not be applied in situations where it is not valid, that it doesn't break code that is in fact broken but \"works\" on other implementations. This is probably more work than the optimisation itself. </p>\n\n<p>On the other hand, I could imagine that in practice (that is in programs that are supposed to do a job, and not benchmarks), this optimisation will save very little in execution time. </p>\n\n<p>So a compiler writer will look at the cost, then look at the benefit and the risks, and probably will decide against it. </p>\n"}, {"comments": [{"owner": {"reputation": 917, "user_id": 2504674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4df1119bfdf1e97bac7fb18996160ba?s=128&d=identicon&r=PG", "display_name": "PeteC", "link": "https://stackoverflow.com/users/2504674/petec"}, "edited": false, "score": 0, "creation_date": 1504193816, "post_id": 45971285, "comment_id": 78930419, "body": "So the optimization is (a) valid, (b) hard and (c) surprising. WG21/P0062R1 is particularly interesting. I personally don&#39;t feel that the &quot;principle of least surprise&quot; is a golden rule here; at this level of the language you need to know the rules before you play the game. Thanks for helping me understand."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 917, "user_id": 2504674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4df1119bfdf1e97bac7fb18996160ba?s=128&d=identicon&r=PG", "display_name": "PeteC", "link": "https://stackoverflow.com/users/2504674/petec"}, "edited": false, "score": 2, "creation_date": 1504193916, "post_id": 45971285, "comment_id": 78930498, "body": "@PeteC: Yeah, I think it&#39;s important to realize that the optimization is allowed, and not doing it is a QOI issue, not a standards-compliance issue, and that something may change in a future standard."}, {"owner": {"reputation": 4035, "user_id": 478891, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df15c8847129ee12937d3e62b84a3a4f?s=128&d=identicon&r=PG", "display_name": "Eric Towers", "link": "https://stackoverflow.com/users/478891/eric-towers"}, "edited": false, "score": 0, "creation_date": 1504194707, "post_id": 45971285, "comment_id": 78931060, "body": "So, C++11/14 are permitted to interact incorrectly with programmed I/O written in the style of <a href=\"https://en.wikipedia.org/wiki/Duff%27s_device\" rel=\"nofollow noreferrer\">Duff&#39;s Device</a>.  Great."}, {"owner": {"reputation": 917, "user_id": 2504674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4df1119bfdf1e97bac7fb18996160ba?s=128&d=identicon&r=PG", "display_name": "PeteC", "link": "https://stackoverflow.com/users/2504674/petec"}, "reply_to_user": {"reputation": 4035, "user_id": 478891, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df15c8847129ee12937d3e62b84a3a4f?s=128&d=identicon&r=PG", "display_name": "Eric Towers", "link": "https://stackoverflow.com/users/478891/eric-towers"}, "edited": false, "score": 3, "creation_date": 1504196221, "post_id": 45971285, "comment_id": 78931941, "body": "@EricTowers no, in Duff&#39;s Device the output register would certainly be declared volatile (this is a textbook case for volatile) and the output would be as expected."}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "reply_to_user": {"reputation": 917, "user_id": 2504674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4df1119bfdf1e97bac7fb18996160ba?s=128&d=identicon&r=PG", "display_name": "PeteC", "link": "https://stackoverflow.com/users/2504674/petec"}, "edited": false, "score": 1, "creation_date": 1531866804, "post_id": 45971285, "comment_id": 89754211, "body": "@PeteC: Given the range of purposes for which languages like C and C++ are used, programsf for some targets and application fields will often need semantics that aren&#39;t supportable everywhere; the language itself punts the question of when they should be supported as a QoI issue, but if programmers in a particular field would find a behavior surprising, that&#39;s a pretty good sign that quality implementations in that field should not behave in such fashion unless explicitly requested.  The language rules itself aren&#39;t complete enough to make the language useful for all purposes without POLA."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1544239454, "post_id": 45971285, "comment_id": 94216268, "body": "&quot;<i>and abuses the meaning of volatile</i>&quot; so does <code>volatile int w; w=0; delay_loop(1000); w=0;</code> so lol"}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1544250394, "post_id": 45971285, "comment_id": 94217743, "body": "@curiousguy: I decided to reword that, but you&#39;d probably only use a <code>delay_loop</code> in non-portable code targeting a specific embedded system.  In a lot of cases, <code>volatile</code> in embedded programming is used where relaxed or acq/rel atomic would be arguably more appropriate.  (At least if you also include static_assert that it&#39;s lock-free.)"}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1544251090, "post_id": 45971285, "comment_id": 94217850, "body": "Either way it doesn&#39;t <i>feel</i> like any compiler should try to aggressively optimize code by pushing computations across volatile accesses even if it&#39;s strictly conforming to the letter of the specification: volatile should be vaguely ordered WRT the pure code around it. And least people who claim optimizing Java volatile/C++ atomic accesses is bad taste should find that optimizing across C/C++ volatile accesses is at least as bad."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 1, "creation_date": 1544251401, "post_id": 45971285, "comment_id": 94217896, "body": "@curiousguy: agreed, quality implementations probably won&#39;t reorder <code>volatile</code> with an expensive computation, even if they&#39;re tempted to do so by a common tail in both branches.  But the standard allows behaviour we don&#39;t want, hence it&#39;s an issue for at least the standards committee to try to improve.  You could just leave it at that and say it&#39;s already possible to make a strictly conforming C++ implementation that&#39;s near-useless for low-level systems programming, bu a lot of that is by violating assumptions that most code makes, like that integer types don&#39;t have padding.  Not optimization."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 1, "creation_date": 1554671148, "post_id": 45971285, "comment_id": 97827032, "body": "&quot;<i>allow the compiler to do these optimizations safely (without ever getting it wrong)</i>&quot; Detecting bounded cost computation is trivial (any code w/o loop or goto and no outline fun call is trivial); coalescence redundant atomic op occurring with only trivial cost code in between seem trivial. That would handle some <code>shared_ptr</code> style relaxed incr followed by release decr I believe."}], "tags": [], "owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "is_accepted": true, "score": 43, "last_activity_date": 1544250141, "last_edit_date": 1544250141, "creation_date": 1504137038, "answer_id": 45971285, "question_id": 45960387, "link": "https://stackoverflow.com/questions/45960387/why-dont-compilers-merge-redundant-stdatomic-writes/45971285#45971285", "title": "Why don&#39;t compilers merge redundant std::atomic writes?", "body": "<p>The C++11 / C++14 standards <em>as written</em> do allow the three stores to be folded/coalesced into one store of the final value.  Even in a case like this:</p>\n\n<pre><code>  y.store(1, order);\n  y.store(2, order);\n  y.store(3, order); // inlining + constant-folding could produce this in real code\n</code></pre>\n\n<p>The standard does <em>not</em> guarantee that an observer spinning on <code>y</code> (with an atomic load or CAS) will ever see <code>y == 2</code>.  A program that depended on this would have a data race bug, but only the garden-variety bug kind of race, not the C++ Undefined Behaviour kind of data race.  (It's UB only with non-atomic variables).  A program that expects to <em>sometimes</em> see it is not necessarily even buggy. (See below re: progress bars.)</p>\n\n<p><strong>Any ordering that's possible on the C++ abstract machine can be picked (at compile time) as the ordering that will <em>always</em> happen</strong>.  This is the as-if rule in action.  In this case, it's <em>as if</em>  all three stores happened back-to-back in the global order, with no loads or stores from other threads happening between the <code>y=1</code> and <code>y=3</code>.</p>\n\n<p>It doesn't depend on the target architecture or hardware; just like <a href=\"http://preshing.com/20120625/memory-ordering-at-compile-time/\" rel=\"noreferrer\">compile-time reordering</a> of relaxed atomic operations are allowed even when targeting strongly-ordered x86.  The compiler doesn't have to preserve anything you might expect from thinking about the hardware you're compiling for, so you need barriers.  The barriers may compile into zero asm instructions.</p>\n\n<hr>\n\n<h3>So why don't compilers do this optimization?</h3>\n\n<p>It's a quality-of-implementation issue, and can change observed performance / behaviour on real hardware.</p>\n\n<p><strong>The most obvious case where it's a problem is a progress bar</strong>.  Sinking the stores out of a loop (that contains no other atomic operations) and folding them all into one would result in a progress bar staying at 0 and then going to 100% right at the end.</p>\n\n<p>There's no C++11 <code>std::atomic</code> way to <em>stop</em> them from doing it in cases where you don't want it, so for now compilers simply choose never to coalesce multiple atomic operations into one.  (Coalescing them all into one operation doesn't change their order relative to each other.)</p>\n\n<p>Compiler-writers have correctly noticed that programmers expect that an atomic store will actually happen to memory every time the source does <code>y.store()</code>.  (See most of the other answers to this question, which claim the stores are required to happen separately because of possible readers waiting to see an intermediate value.)  i.e. It violates the <a href=\"https://en.wikipedia.org/wiki/Principle_of_least_astonishment\" rel=\"noreferrer\">principle of least surprise</a>.</p>\n\n<p>However, there are cases where it would be very helpful, for example avoiding useless <code>shared_ptr</code> ref count inc/dec in a loop.</p>\n\n<p>Obviously any reordering or coalescing can't violate any other ordering rules.  For example, <code>num++; num--;</code> would still have to be full barrier to runtime and compile-time reordering, even if it no longer touched the memory at <code>num</code>.</p>\n\n<hr>\n\n<p><strong>Discussion is under way to extend the <code>std::atomic</code> API</strong> to give programmers control of such optimizations, at which point compilers will be able to optimize when useful, which can happen even in carefully-written code that isn't intentionally inefficient.  Some examples of useful cases for optimization are mentioned in the following working-group discussion / proposal links:</p>\n\n<ul>\n<li><a href=\"http://wg21.link/n4455\" rel=\"noreferrer\">http://wg21.link/n4455</a>: N4455 No Sane Compiler Would Optimize Atomics</li>\n<li><a href=\"http://wg21.link/p0062\" rel=\"noreferrer\">http://wg21.link/p0062</a>: WG21/P0062R1: When should compilers optimize atomics?</li>\n</ul>\n\n<p>See also discussion about this same topic on Richard Hodges' answer to <a href=\"https://stackoverflow.com/a/39394173/224132\">Can num++ be atomic for 'int num'?</a> (see the comments).  See also the last section of <a href=\"https://stackoverflow.com/a/39396999/224132\">my answer</a> to the same question, where I argue in more detail that this optimization is allowed.  (Leaving it short here, because those C++ working-group links already acknowledge that the current standard as written does allow it, and that current compilers just don't optimize on purpose.)</p>\n\n<hr>\n\n<p>Within the current standard, <strong><code>volatile atomic&lt;int&gt; y</code></strong> would be one way to ensure that stores to it are not allowed to be optimized away.  (As <a href=\"https://stackoverflow.com/a/2479474/224132\">Herb Sutter points out in an SO answer</a>, <code>volatile</code> and <code>atomic</code> already share some requirements, but they are different).  See also <a href=\"http://en.cppreference.com/w/cpp/atomic/memory_order#Relationship_with_volatile\" rel=\"noreferrer\"><code>std::memory_order</code>'s relationship with <code>volatile</code></a> on cppreference.</p>\n\n<p>Accesses to <code>volatile</code> objects are not allowed to be optimized away (because they could be memory-mapped IO registers, for example).</p>\n\n<p>Using <code>volatile atomic&lt;T&gt;</code> mostly fixes the progress-bar problem, but it's kind of ugly and might look silly in a few years if/when C++ decides on different syntax for controlling optimization so compilers can start doing it in practice.</p>\n\n<p>I think we can be confident that compilers won't start doing this optimization until there's a way to control it.  Hopefully it will be some kind of opt-in (like a <code>memory_order_release_coalesce</code>) that doesn't change the behaviour of existing code C++11/14 code when compiled as C++whatever.  But it could be like the proposal in wg21/p0062: tag don't-optimize cases with <code>[[brittle_atomic]]</code>.</p>\n\n<p><strong>wg21/p0062 warns that even <code>volatile atomic</code> doesn't solve everything, and discourages its use for this purpose</strong>.  It gives this example:</p>\n\n<pre><code>if(x) {\n    foo();\n    y.store(0);\n} else {\n    bar();\n    y.store(0);  // release a lock before a long-running loop\n    for() {...} // loop contains no atomics or volatiles\n}\n// A compiler can merge the stores into a y.store(0) here.\n</code></pre>\n\n<p>Even with <code>volatile atomic&lt;int&gt; y</code>, a compiler is allowed to sink the <code>y.store()</code> out of the <code>if/else</code> and just do it once, because it's still doing exactly 1 store with the same value.  (Which would be after the long loop in the else branch).  Especially if the store is only <code>relaxed</code> or <code>release</code> instead of <code>seq_cst</code>.</p>\n\n<p><code>volatile</code> does stop the coalescing discussed in the question, but this points out that other optimizations on <code>atomic&lt;&gt;</code> can also be problematic for real performance.</p>\n\n<hr>\n\n<p>Other reasons for not optimizing include: nobody's written the complicated code that would allow the compiler to do these optimizations safely (without ever getting it wrong).  This is not sufficient, because N4455 says LLVM already implements or could easily implement several of the optimizations it mentioned.</p>\n\n<p>The confusing-for-programmers reason is certainly plausible, though.  Lock-free code is hard enough to write correctly in the first place.</p>\n\n<p>Don't be casual in your use of atomic weapons: they aren't cheap and don't optimize much (currently not at all). It's not always easy easy to avoid redundant atomic operations with <code>std::shared_ptr&lt;T&gt;</code>, though, since there's no non-atomic version of it (although <a href=\"https://stackoverflow.com/questions/15129263/is-there-a-non-atomic-equivalent-of-stdshared-ptr-and-why-isnt-there-one-in\">one of the answers here</a> gives an easy way to define a <code>shared_ptr_unsynchronized&lt;T&gt;</code> for gcc).</p>\n"}], "owner": {"reputation": 917, "user_id": 2504674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4df1119bfdf1e97bac7fb18996160ba?s=128&d=identicon&r=PG", "display_name": "PeteC", "link": "https://stackoverflow.com/users/2504674/petec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5051, "favorite_count": 13, "accepted_answer_id": 45971285, "answer_count": 9, "score": 53, "last_activity_date": 1554610373, "creation_date": 1504095949, "last_edit_date": 1554610373, "question_id": 45960387, "link": "https://stackoverflow.com/questions/45960387/why-dont-compilers-merge-redundant-stdatomic-writes", "title": "Why don&#39;t compilers merge redundant std::atomic writes?", "body": "<p>I'm wondering why no compilers are prepared to merge consecutive writes of the same value to a single atomic variable, e.g.:</p>\n\n<pre><code>#include &lt;atomic&gt;\nstd::atomic&lt;int&gt; y(0);\nvoid f() {\n  auto order = std::memory_order_relaxed;\n  y.store(1, order);\n  y.store(1, order);\n  y.store(1, order);\n}\n</code></pre>\n\n<p>Every compiler I've tried will issue the above write three times. What legitimate, race-free observer could see a difference between the above code and an optimized version with a single write (i.e. doesn't the 'as-if' rule apply)?</p>\n\n<p>If the variable had been volatile, then obviously no optimization is applicable. What's preventing it in my case?</p>\n\n<p>Here's the code in <a href=\"https://godbolt.org/g/BLoH1x\" rel=\"noreferrer\" title=\"compiler explorer\">compiler explorer</a>.</p>\n"}, {"tags": ["c++", "algorithm", "graph"], "comments": [{"owner": {"reputation": 345, "user_id": 8136480, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/yzFpm.jpg?s=128&g=1", "display_name": "Sohit Gore", "link": "https://stackoverflow.com/users/8136480/sohit-gore"}, "reply_to_user": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 0, "creation_date": 1504096235, "post_id": 45960253, "comment_id": 78879023, "body": "@VTT they arent direct edges.two nodes are connected by only one edge"}, {"owner": {"reputation": 10955, "user_id": 1915854, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/gIC27.jpg?s=128&g=1", "display_name": "Serge Rogatch", "link": "https://stackoverflow.com/users/1915854/serge-rogatch"}, "reply_to_user": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 0, "creation_date": 1504097423, "post_id": 45960253, "comment_id": 78879898, "body": "@VTT, no, it would be <code>O(N*N)</code> - quadratic, not exponential."}], "answers": [{"tags": [], "owner": {"reputation": 10955, "user_id": 1915854, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/gIC27.jpg?s=128&g=1", "display_name": "Serge Rogatch", "link": "https://stackoverflow.com/users/1915854/serge-rogatch"}, "is_accepted": true, "score": 3, "last_activity_date": 1504097730, "last_edit_date": 1504097730, "creation_date": 1504096841, "answer_id": 45960715, "question_id": 45960253, "link": "https://stackoverflow.com/questions/45960253/create-pairs-of-vertices-using-adjacency-list-in-linear-time/45960715#45960715", "title": "create pairs of vertices using adjacency list in linear time", "body": "<p>If there are <code>O(N*N)</code> edges, then you can't list them all in linear time.</p>\n\n<p>However, if indeed all you need is to compute the sum, here's a solution in <code>O(N*log(N))</code>. You can kind of improve the solution by using instead <code>O(N)</code> sorting algorithm, such as <a href=\"http://www.geeksforgeeks.org/radix-sort/\" rel=\"nofollow noreferrer\">radix sort</a>.</p>\n\n<pre><code>#include &lt;algorithm&gt;\n#include &lt;cstdint&gt;\n\n// ...\n\nstd::sort(strength, strength+n);\nuint64_t sum = 0;\nint64_t runSum = strength[0];\nfor(int i=1; i&lt;n; i++) {\n  sum += int64_t(i)*strength[i] - runSum;\n  runSum += strength[i];\n}\n// Now \"sum\" contains the sum of weigths over all edges\n</code></pre>\n\n<p>To explain the algorithm:</p>\n\n<p>The idea is to avoid summing over all edges explicitly (requiring <code>O(N*N)</code>), but rather to add sums of several weights at once. Consider the last vertex <code>n-1</code> and the average <code>A[n-1] = (strength[0] + strength[1] + ... + strength[n-2])/(n-1)</code>: obviously we could add <code>(strength[n-1] - A[n-1]) * (n-1)</code>, i.e. <code>n-1</code> weights at once, if the weights were all larger than <code>strength[n-1]</code>, or all smaller than it. However, due to <code>abs</code> operation, we would have to add different amounts depending on whether the strength of the other vertex is larger or smaller than the strength of the current vertex. So one solution is to sort the strengths first, so to ensure that each next strength is greater or equal to the previous.</p>\n"}], "owner": {"reputation": 345, "user_id": 8136480, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/yzFpm.jpg?s=128&g=1", "display_name": "Sohit Gore", "link": "https://stackoverflow.com/users/8136480/sohit-gore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "accepted_answer_id": 45960715, "answer_count": 1, "score": 3, "last_activity_date": 1504097730, "creation_date": 1504095556, "last_edit_date": 1504096165, "question_id": 45960253, "link": "https://stackoverflow.com/questions/45960253/create-pairs-of-vertices-using-adjacency-list-in-linear-time", "title": "create pairs of vertices using adjacency list in linear time", "body": "<p>I have n number of vertices numbered 1...n and want to pair every vertex with all other vertices. That would result in n*(n-1)/2 number of edges. Each vertex has some strength.The difference between the strength of two vertices is the weight of the edge.I need to get the total weight. Using two loops I can do this in O(n^2) time. But I want to reduce the time.I can use adjacency list and using that create a graph of n*(n-1)/2 edges but how will I create the adjacency list without using two loops. The input takes only the number of vertices and the strength of each vertex.</p>\n\n<pre><code>for(int i=0;i&lt;n;i++)\n    for(int j=i+1;j&lt;n;j++)\n    {\n        int w=abs((strength[i]-strength[j]));\n            sum+=w;\n    }\n</code></pre>\n\n<p>this is what i did earlier.I need a better way to do this.</p>\n"}, {"tags": ["python", "c++", "mysql", "django", "python-3.x"], "comments": [{"owner": {"reputation": 2859, "user_id": 7261317, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/25b9a5e32bcdc158628da35b3d57a95c?s=128&d=identicon&r=PG&f=1", "display_name": "Robert", "link": "https://stackoverflow.com/users/7261317/robert"}, "edited": false, "score": 0, "creation_date": 1504095283, "post_id": 45960134, "comment_id": 78878237, "body": "can you try this <a href=\"https://stackoverflow.com/a/25569814/7261317\">stackoverflow.com/a/25569814/7261317</a>"}, {"owner": {"reputation": 2859, "user_id": 7261317, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/25b9a5e32bcdc158628da35b3d57a95c?s=128&d=identicon&r=PG&f=1", "display_name": "Robert", "link": "https://stackoverflow.com/users/7261317/robert"}, "edited": false, "score": 0, "creation_date": 1504095319, "post_id": 45960134, "comment_id": 78878259, "body": "<a href=\"http://www.marinamele.com/taskbuster-django-tutorial/install-and-configure-mysql-for-django\" rel=\"nofollow noreferrer\">marinamele.com/taskbuster-django-tutorial/&hellip;</a>"}, {"owner": {"reputation": 2321, "user_id": 300977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b62777f1a3b7d5d72f38f0cafcba932a?s=128&d=identicon&r=PG", "display_name": "bouteillebleu", "link": "https://stackoverflow.com/users/300977/bouteillebleu"}, "edited": false, "score": 0, "creation_date": 1504095495, "post_id": 45960134, "comment_id": 78878392, "body": "If you&#39;re trying to install on Windows, then Robert&#39;s advice above might not help - however, there are binary packages available for MySQL-python and mysqlclient at <a href=\"http://www.lfd.uci.edu/~gohlke/pythonlibs/#mysql-python\" rel=\"nofollow noreferrer\">lfd.uci.edu/~gohlke/pythonlibs/#mysql-python</a> ."}, {"owner": {"reputation": 38630, "user_id": 1324033, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/PaonW.png?s=128&g=1", "display_name": "Sayse", "link": "https://stackoverflow.com/users/1324033/sayse"}, "edited": false, "score": 0, "creation_date": 1504095566, "post_id": 45960134, "comment_id": 78878455, "body": "What is unclear about the bottom error messages instructions?"}, {"owner": {"reputation": 126, "user_id": 6638932, "user_type": "registered", "profile_image": "https://graph.facebook.com/1058946954166987/picture?type=large", "display_name": "Andre Barbosa", "link": "https://stackoverflow.com/users/6638932/andre-barbosa"}, "edited": false, "score": 0, "creation_date": 1504095735, "post_id": 45960134, "comment_id": 78878588, "body": "Are you using a virtual environment? If so, did you activate it before running the &quot;pip&quot; command and before running &quot;python manage.py syncdb&quot; ?"}, {"owner": {"reputation": 2859, "user_id": 7261317, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/25b9a5e32bcdc158628da35b3d57a95c?s=128&d=identicon&r=PG&f=1", "display_name": "Robert", "link": "https://stackoverflow.com/users/7261317/robert"}, "edited": false, "score": 0, "creation_date": 1504096095, "post_id": 45960134, "comment_id": 78878902, "body": "<a href=\"http://www.swegler.com/becky/blog/2011/09/14/python-django-mysql-on-windows-7-part-5-installing-mysql/\" rel=\"nofollow noreferrer\">swegler.com/becky/blog/2011/09/14/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 5454937, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-1Fsit3b32-k/AAAAAAAAAAI/AAAAAAAAALo/DT4HB3KfuYA/photo.jpg?sz=128", "display_name": "DJ RAXITH", "link": "https://stackoverflow.com/users/5454937/dj-raxith"}, "edited": false, "score": 0, "creation_date": 1504107921, "post_id": 45960374, "comment_id": 78888170, "body": "thanks @nullsnot0  i am facing a new error.  &quot;_mysql.c(29) : fatal error C1083: Cannot open include file: &#39;my_config.h&#39;: No such file or directory  error: command &#39;&quot;c:\\Program Files (x86)\\Microsoft Visual Studio 10.0\\VC\\BIN\\amd64\\cl.exe&quot;&#39; failed with exit status 2&quot;"}, {"owner": {"reputation": 371, "user_id": 8433375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66e447c5d23d8d2e53a5c8df506ac688?s=128&d=identicon&r=PG&f=1", "display_name": "NullIsNot0", "link": "https://stackoverflow.com/users/8433375/nullisnot0"}, "reply_to_user": {"reputation": 13, "user_id": 5454937, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-1Fsit3b32-k/AAAAAAAAAAI/AAAAAAAAALo/DT4HB3KfuYA/photo.jpg?sz=128", "display_name": "DJ RAXITH", "link": "https://stackoverflow.com/users/5454937/dj-raxith"}, "edited": false, "score": 0, "creation_date": 1504114186, "post_id": 45960374, "comment_id": 78891865, "body": "Sorry, I have no Windows computer to test mysqlclient installation, but you could try checking this answer: <a href=\"https://stackoverflow.com/a/31077052/8433375\">https://stackoverflow.com/a/31077052/8433375</a>, but before check your python version with <code>pyphon --version</code> to be shore which version of mysqlclient to choose. Also check <code>pip --version</code> to be shore pip is using right python (if you have multiple versions installed on system)"}], "tags": [], "owner": {"reputation": 371, "user_id": 8433375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66e447c5d23d8d2e53a5c8df506ac688?s=128&d=identicon&r=PG&f=1", "display_name": "NullIsNot0", "link": "https://stackoverflow.com/users/8433375/nullisnot0"}, "is_accepted": true, "score": 2, "last_activity_date": 1504095904, "creation_date": 1504095904, "answer_id": 45960374, "question_id": 45960134, "link": "https://stackoverflow.com/questions/45960134/python-django-error/45960374#45960374", "title": "Python django error", "body": "<p>By default Django is configured to use Sqlite database. See <code>settings.py</code> file:</p>\n\n<pre><code>DATABASES = {\n    'default': {\n        'ENGINE': 'django.db.backends.sqlite3',\n        'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),\n    }\n}\n</code></pre>\n\n<p>You have it configured to use MySQL database:</p>\n\n<pre><code>DATABASES = {\n    'default': {\n        'ENGINE': 'django.db.backends.mysql',\n        'NAME': 'DATABASE_NAME',\n        'USER': 'DB_USERNAME',\n        'PASSWORD': 'DB_PASSWORD',\n        'HOST': '127.0.0.1',\n        'PORT': '3306'\n    }\n}\n</code></pre>\n\n<p>If it's a small test project, I would recommend you to switch back to Sqlite, but if you intend to run your project later in production using MySQL, then better use MySQL in development process.</p>\n\n<p>Install:</p>\n\n<ul>\n<li>MySQL or MariaDB locally on your computer</li>\n<li>Windows SDK from <a href=\"http://www.microsoft.com/download/details.aspx?id=8279\" rel=\"nofollow noreferrer\">www.microsoft.com/download/details.aspx?id=8279</a></li>\n<li>run <code>pip install mysqlclient</code> - now it should succeed</li>\n</ul>\n"}], "owner": {"reputation": 13, "user_id": 5454937, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-1Fsit3b32-k/AAAAAAAAAAI/AAAAAAAAALo/DT4HB3KfuYA/photo.jpg?sz=128", "display_name": "DJ RAXITH", "link": "https://stackoverflow.com/users/5454937/dj-raxith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 604, "favorite_count": 0, "accepted_answer_id": 45960374, "answer_count": 1, "score": 0, "last_activity_date": 1613678914, "creation_date": 1504095197, "question_id": 45960134, "link": "https://stackoverflow.com/questions/45960134/python-django-error", "title": "Python django error", "body": "<p>am new to python and django</p>\n\n<p>I am trying to build a small python django application on my local windows laptop.</p>\n\n<p>i am not able to underlying tables required for my Django project as when i run \"python manage.py syncdb\" i get the below error</p>\n\n<p>` <strong>Error :django.core.exceptions.ImproperlyConfigured: Error loading MySQLdb module: No module named 'MySQLdb'. Did you install mysqlclient or MySQL-python? '</strong></p>\n\n<p>And when i try running \"pip install mysqlclient\" i get the below error</p>\n\n<p><strong>'error: Microsoft Visual C++ 10.0 is required. Get it with \"Microsoft Windows SDK 7.1\": www.microsoft.com/download/details.aspx?id=8279'</strong></p>\n\n<p>I am stuck in this step and not able to find any leads. can someone suggest any workaround</p>\n"}, {"tags": ["c++", "itk", "pad"], "comments": [{"owner": {"reputation": 4082, "user_id": 7893951, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5eWm1.jpg?s=128&g=1", "display_name": "Akira", "link": "https://stackoverflow.com/users/7893951/akira"}, "edited": false, "score": 1, "creation_date": 1504095352, "post_id": 45960133, "comment_id": 78878282, "body": "Please take the <a href=\"https://stackoverflow.com/tour\">tour</a>, learn <a href=\"https://stackoverflow.com/help/how-to-ask\">asking</a> good questions, make a <a href=\"https://stackoverflow.com/help/mcve\">Minimal, Complete, and Verifiable example</a>. An MCVE should include a variety of sample input (illustrating all aspects) and desired output. Please show the coding attempts you already made."}, {"owner": {"reputation": 370, "user_id": 8294110, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Q3g1c.jpg?s=128&g=1", "display_name": "avazula", "link": "https://stackoverflow.com/users/8294110/avazula"}, "reply_to_user": {"reputation": 4082, "user_id": 7893951, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5eWm1.jpg?s=128&g=1", "display_name": "Akira", "link": "https://stackoverflow.com/users/7893951/akira"}, "edited": false, "score": 0, "creation_date": 1504096697, "post_id": 45960133, "comment_id": 78879372, "body": "I&#39;ve edited my question by further describing the problem and including the problematic block of code."}], "answers": [{"comments": [{"owner": {"reputation": 370, "user_id": 8294110, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Q3g1c.jpg?s=128&g=1", "display_name": "avazula", "link": "https://stackoverflow.com/users/8294110/avazula"}, "edited": false, "score": 1, "creation_date": 1504097577, "post_id": 45960753, "comment_id": 78880012, "body": "I thought about this too but didn&#39;t know how to call this method since I have very little understanding of itk::ImageBase class and how to instantiate it. Could you please give me an example of calling?"}, {"owner": {"reputation": 2597, "user_id": 276168, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4c3737e23c60ee88122120ea1eff8017?s=128&d=identicon&r=PG", "display_name": "D\u017eenan", "link": "https://stackoverflow.com/users/276168/d%c5%beenan"}, "reply_to_user": {"reputation": 370, "user_id": 8294110, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Q3g1c.jpg?s=128&g=1", "display_name": "avazula", "link": "https://stackoverflow.com/users/8294110/avazula"}, "edited": false, "score": 0, "creation_date": 1504119145, "post_id": 45960753, "comment_id": 78894654, "body": "Example: <a href=\"https://itk.org/Doxygen/html/Examples_2DataRepresentation_2Image_2Image4_8cxx-example.html\" rel=\"nofollow noreferrer\">itk.org/Doxygen/html/&hellip;</a>"}, {"owner": {"reputation": 2597, "user_id": 276168, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4c3737e23c60ee88122120ea1eff8017?s=128&d=identicon&r=PG", "display_name": "D\u017eenan", "link": "https://stackoverflow.com/users/276168/d%c5%beenan"}, "reply_to_user": {"reputation": 370, "user_id": 8294110, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Q3g1c.jpg?s=128&g=1", "display_name": "avazula", "link": "https://stackoverflow.com/users/8294110/avazula"}, "edited": false, "score": 1, "creation_date": 1504119265, "post_id": 45960753, "comment_id": 78894697, "body": "ImageBase is an abstract class, and you don&#39;t instantiate it (you can&#39;t). But since Image derives from ImageBase, it has all of ImageBase&#39;s methods. e.g. <code>imageToBeMasked-&gt;TransformPhysicalPointToIndex(...)</code>"}], "tags": [], "owner": {"reputation": 2597, "user_id": 276168, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4c3737e23c60ee88122120ea1eff8017?s=128&d=identicon&r=PG", "display_name": "D\u017eenan", "link": "https://stackoverflow.com/users/276168/d%c5%beenan"}, "is_accepted": true, "score": 2, "last_activity_date": 1504096963, "creation_date": 1504096963, "answer_id": 45960753, "question_id": 45960133, "link": "https://stackoverflow.com/questions/45960133/how-can-i-pad-an-image-when-i-only-know-its-physical-bounds/45960753#45960753", "title": "How can I pad an image when I only know its physical bounds?", "body": "<p>What you need are <a href=\"https://itk.org/Doxygen/html/classitk_1_1ImageBase.html#af4a7c9c3787e9fdafbaaade2e02efa25\" rel=\"nofollow noreferrer\">TransformPhysicalPointToIndex</a> and friends. Those methods are part of <code>ImageBase</code> class.</p>\n"}], "owner": {"reputation": 370, "user_id": 8294110, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Q3g1c.jpg?s=128&g=1", "display_name": "avazula", "link": "https://stackoverflow.com/users/8294110/avazula"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "accepted_answer_id": 45960753, "answer_count": 1, "score": 3, "last_activity_date": 1504097320, "creation_date": 1504095192, "last_edit_date": 1504097320, "question_id": 45960133, "link": "https://stackoverflow.com/questions/45960133/how-can-i-pad-an-image-when-i-only-know-its-physical-bounds", "title": "How can I pad an image when I only know its physical bounds?", "body": "<p>I am trying to apply a mask on an image but the masking image has different dimensions that the one to be masked. To apply the mask I must ensure that the images have the same dimensions, so I'm using the ITK PadImageFilter class, but to do so <strong>the padding values must be given in indexes instead of physical coordinates</strong>. My program enables me to get the boundaries of both images in physical coordinates but not their indexes.</p>\n\n<p>Is there a way in ITK to get the corresponding index of a given point? I understand the relation between pixels and the image dimensions, I just want to know if there is a method which automatically does it in ITK. </p>\n\n<p><strong>Edit:</strong> Below is my code. I know that the problem is due to the fact that the padding margins (x_min, x_max, ...) are given in physical coordinates instead of indexes. How could I solve this?</p>\n\n<pre><code>typedef unsigned char UcharPixelType;\ntypedef short ShortPixelType;\nconst int Dimension = 3; \n\n//Declare readers for both images (which are of different types)\ntypedef itk::ImageFileReader&lt; ShortImageType &gt; ShortReaderType;\ntypedef itk::ImageFileReader&lt; UcharImageType &gt; UcharReaderType;\n\nShortImageType::Pointer imageToBeMasked = ShortImageType::New();\n// Setting imageToBeMasked to read the corresponding image\n\nUcharImageType::Pointer maskingImage = UcharImageType::New();\n// Do the same for reading the image that will mask the former one.\n\n// Compute the bounds of both images (i.e. physical coordinates)\ndouble* img_bounds = imageToBeMasked-&gt;GetBounds();\ndouble* mask_bounds = maskingImage-&gt;GetBounds();\n\n// Compute margins needed to pad the masking image\ndouble x_min = abs(img_bounds[0] - mask_bounds[0]);\ndouble x_max = abs(img_bounds[1] - mask_bounds[1]);\ndouble y_min = abs(img_bounds[2] - mask_bounds[2]);\ndouble y_max = abs(img_bounds[3] - mask_bounds[3]);\ndouble z_min = abs(img_bounds[4] - mask_bounds[4]);\ndouble z_max = abs(img_bounds[5] - mask_bounds[5]);\n\n// Declare the padding filter\ntypedef itk::PadImageFilter&lt; UcharImageType, UcharImageType &gt; PadFilterType;\nPadFilterType::Pointer l_enlarge_mask = PadFilterType::New();\nl_enlarge_mask-&gt;SetInput(maskingImage-&gt;GetOutput());\n\n// Create indexes for giving padding margins to the filter,\n// But these are physical coordinates! How to convert them? \nUcharImageType::IndexType indexMin;\nindexMin[0] = x_min;\nindexMin[1] = y_min;\nindexMin[2] = z_min;\n\nUcharImageType::IndexType indexMax;\nindexMax[0] = x_max;\nindexMax[1] = y_max;\nindexMax[2] = z_max;\n\nl_enlarge_mask-&gt;SetPadLowerBound(indexMin);\nl_enlarge_mask-&gt;SetPadUpperBound(indexMax);\n\ntypedef itk::ImageFileWriter&lt; UcharImageType &gt; UcharWriterType;\nUcharWriterType l_writer = UcharWriterType::New();\n\nl_writer-&gt;SetInput(l_enlarge_mask-&gt;GetOutput());\nl_writer-&gt;SetFileName(\"padded_mask.mhd\");\n\ntry{ \n    l_writer-&gt;Update();\ncatch(itk::ExceptionObject&amp; err) {\n    std::cerr &lt;&lt; \"Exception caught!\" &lt;&lt; err.what() &lt;&lt; std::endl;\n} // Error: boundary condition is ITK_NULLPTR\n</code></pre>\n\n<p>I also tried to do the opposite, i.e. computing a view of interest (VOI) on the image to be masked (hence \"cropping\" the biggest image instead of padding the smallest). I therefore have given the masking image's dimensions as the VOI boundaries, but the resulting image is always a few voxels bigger (1 or 2 voxels) that the given boundaries and I have no idea why. Thought it could be because of the difference of types between the two images but computing the masking image's boundaries on its casted version does not solve the problem either.</p>\n"}, {"tags": ["c++", "makefile", "g++", "mosquitto"], "comments": [{"owner": {"reputation": 1170, "user_id": 5682416, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/eca9557bc24253c2921579ad1644f234?s=128&d=identicon&r=PG&f=1", "display_name": "Hugal31", "link": "https://stackoverflow.com/users/5682416/hugal31"}, "edited": false, "score": 0, "creation_date": 1504095095, "post_id": 45960020, "comment_id": 78878094, "body": "On which system are you ? Windows or Linux ?"}, {"owner": {"reputation": 83, "user_id": 5408870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dd9563c0dc179e90ed5ab8617548b9bd?s=128&d=identicon&r=PG&f=1", "display_name": "Weffel", "link": "https://stackoverflow.com/users/5408870/weffel"}, "reply_to_user": {"reputation": 1170, "user_id": 5682416, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/eca9557bc24253c2921579ad1644f234?s=128&d=identicon&r=PG&f=1", "display_name": "Hugal31", "link": "https://stackoverflow.com/users/5682416/hugal31"}, "edited": false, "score": 0, "creation_date": 1504095199, "post_id": 45960020, "comment_id": 78878183, "body": "linux -&gt; lubuntu 14.04"}, {"owner": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 0, "creation_date": 1504095217, "post_id": 45960020, "comment_id": 78878190, "body": "You&#39;ll need to build mosquitto and all its dependencies into static library (it may or may not support this, also you may or may not violate licensing terms of this library and/or its dependencies) and link it, probably along with linking static C++ standard library. Also resulting executable will be portable only to some degree anyway."}, {"owner": {"reputation": 3577, "user_id": 2176813, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/Nv7lK.jpg?s=128&g=1", "display_name": "tambre", "link": "https://stackoverflow.com/users/2176813/tambre"}, "edited": false, "score": 0, "creation_date": 1504097546, "post_id": 45960020, "comment_id": 78879985, "body": "C != C++. Tag with only one, unless both are used."}, {"owner": {"reputation": 7829, "user_id": 4950584, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-xTMYK-wVa7U/AAAAAAAAAAI/AAAAAAAAAGA/x2vE5BBF-hM/photo.jpg?sz=128", "display_name": "Chris Turner", "link": "https://stackoverflow.com/users/4950584/chris-turner"}, "edited": false, "score": 0, "creation_date": 1504098337, "post_id": 45960020, "comment_id": 78880691, "body": "Why do you link the libraries like that and not link them with the <code>-l</code> option? ie <code>-lmosquitto</code>"}, {"owner": {"reputation": 83, "user_id": 5408870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dd9563c0dc179e90ed5ab8617548b9bd?s=128&d=identicon&r=PG&f=1", "display_name": "Weffel", "link": "https://stackoverflow.com/users/5408870/weffel"}, "reply_to_user": {"reputation": 7829, "user_id": 4950584, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-xTMYK-wVa7U/AAAAAAAAAAI/AAAAAAAAAGA/x2vE5BBF-hM/photo.jpg?sz=128", "display_name": "Chris Turner", "link": "https://stackoverflow.com/users/4950584/chris-turner"}, "edited": false, "score": 0, "creation_date": 1504101149, "post_id": 45960020, "comment_id": 78883084, "body": "@ChrisTurner This is the makefile delivered with the example, I am trying to get the example running like I described, using my limited experience with makefiles."}], "answers": [{"comments": [{"owner": {"reputation": 3725, "user_id": 8471208, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-zX6iRd9pmRI/AAAAAAAAAAI/AAAAAAAAAgE/F3-J9H4ZCno/photo.jpg?sz=128", "display_name": "Kevin Boone", "link": "https://stackoverflow.com/users/8471208/kevin-boone"}, "edited": false, "score": 1, "creation_date": 1504100690, "post_id": 45960215, "comment_id": 78882677, "body": "Building with the static libmosquitto may relieve the need to install Mosquitto on another machine, but it won&#39;t help with other dependencies that your application may have. If you&#39;re running the same Linux distribution and version on all machines, you&#39;ll probably get away with it. However, Linux users are generally more comfortable with installing dependencies than are users of most other popular platforms. It probably isn&#39;t fatal to the success of your application if users have to do &quot;apt-get install mosquitto&quot; or whatever."}], "tags": [], "owner": {"reputation": 1170, "user_id": 5682416, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/eca9557bc24253c2921579ad1644f234?s=128&d=identicon&r=PG&f=1", "display_name": "Hugal31", "link": "https://stackoverflow.com/users/5682416/hugal31"}, "is_accepted": false, "score": 0, "last_activity_date": 1504095457, "creation_date": 1504095457, "answer_id": 45960215, "question_id": 45960020, "link": "https://stackoverflow.com/questions/45960020/how-do-i-convert-a-normal-makefile-to-create-a-static-executable-that-can-be-use/45960215#45960215", "title": "How do I convert a normal Makefile to create a static executable that can be used on another computer", "body": "<p>You have to get the static versions of your dependencies, here libmosquittopp. Find or install the static library, for example \"libmosquittopp.a\" (.a mean static library).\nAfter that, link with your executable by replacing <code>libmosquittopp.so.1</code> and <code>libmosquitto.so.1</code> with the static version.</p>\n"}, {"tags": [], "owner": {"reputation": 7829, "user_id": 4950584, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-xTMYK-wVa7U/AAAAAAAAAAI/AAAAAAAAAGA/x2vE5BBF-hM/photo.jpg?sz=128", "display_name": "Chris Turner", "link": "https://stackoverflow.com/users/4950584/chris-turner"}, "is_accepted": false, "score": 1, "last_activity_date": 1504103344, "creation_date": 1504103344, "answer_id": 45963118, "question_id": 45960020, "link": "https://stackoverflow.com/questions/45960020/how-do-i-convert-a-normal-makefile-to-create-a-static-executable-that-can-be-use/45963118#45963118", "title": "How do I convert a normal Makefile to create a static executable that can be used on another computer", "body": "<p>1) Yes you can compile on one computer and run it on another if they're running the same OS version. If you don't have the 3rd party libraries installed on the other computer, you will need to compile a static version of the program.</p>\n\n<p>2) To compile a static version of a program you have to add the <code>-static</code> option to the final build command. This instructs the linker to use static versions of libraries if they exist, including the standard C++ library.</p>\n\n<p>This won't work with what you have currently as it requires you to be adding libraries using the <code>-l</code> option. The <code>-l</code> option tells the linker to find a library in the library search path (specified by <code>-L</code>). Your Makefile is adding the libraries by filename, so it'll always use that specific version regardless of any other options you specify.</p>\n\n<p>So to fix that you want something like this</p>\n\n<pre><code>LDFLAGS=-L../../lib -L../../lib/cpp -lmosquittopp -lmosquitto\n</code></pre>\n\n<p>...which adds the two directories where the libraries live to the search path and then says to link with both libraries. Then if you have static versions of those libraries, it'll use them when you add the <code>-static</code> flag.</p>\n"}], "owner": {"reputation": 83, "user_id": 5408870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dd9563c0dc179e90ed5ab8617548b9bd?s=128&d=identicon&r=PG&f=1", "display_name": "Weffel", "link": "https://stackoverflow.com/users/5408870/weffel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1392, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1504103344, "creation_date": 1504094838, "last_edit_date": 1504100757, "question_id": 45960020, "link": "https://stackoverflow.com/questions/45960020/how-do-i-convert-a-normal-makefile-to-create-a-static-executable-that-can-be-use", "title": "How do I convert a normal Makefile to create a static executable that can be used on another computer", "body": "<p>I got the <code>temp_conversion</code> example program from mosquitto C++, from <a href=\"https://github.com/eclipse/mosquitto\" rel=\"nofollow noreferrer\">here</a>. I have looked at <a href=\"https://stackoverflow.com/questions/31421616/c-creating-static-library-and-linking-using-makefile\">this thread</a> but I don't quite get it, I have minimal experience with makefiles. I'm not sure if static libraries even work this way, but I have 2 questions:</p>\n\n<ol>\n<li><p>Is it possible to be able to move the executable to another pc and have it still run? (without installing mosquitto libraries there, maybe copying a static library created by the makefile with it)</p></li>\n<li><p>How do I convert this makefile to make a static \"moveable\" executable?</p></li>\n</ol>\n\n<p>The makefile:</p>\n\n<pre><code>CFLAGS=-Wall -ggdb -I../../lib -I../../lib/cpp\nLDFLAGS=-L../../lib ../../lib/cpp/libmosquittopp.so.1 ../../lib/libmosquitto.so.1\n\n.PHONY: all clean\n\nall : mqtt_temperature_conversion\n\nmqtt_temperature_conversion : main.o temperature_conversion.o\n${CXX} $^ -o $@ ${LDFLAGS}\n\nmain.o : main.cpp\n    ${CXX} -c $^ -o $@ ${CFLAGS}\n\ntemperature_conversion.o : temperature_conversion.cpp\n    ${CXX} -c $^ -o $@ ${CFLAGS}\n\nclean : \n    -rm -f *.o mqtt_temperature_conversion\n</code></pre>\n"}, {"tags": ["c++", "inheritance", "virtual"], "comments": [{"owner": {"reputation": 12072, "user_id": 1630963, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97c2d181ef6bbb9eee0c4033561c3891?s=128&d=identicon&r=PG", "display_name": "enhzflep", "link": "https://stackoverflow.com/users/1630963/enhzflep"}, "edited": false, "score": 0, "creation_date": 1504095012, "post_id": 45959875, "comment_id": 78878039, "body": "As said in an answer, the object <i>c</i> of type <i>Child</i> is already destructed by the time you try to access a pointer to it in your vector. How to fix? Easy. <code>Child *c = new Child(); children.push_back(c);</code> done and done. ;)"}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "reply_to_user": {"reputation": 12072, "user_id": 1630963, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97c2d181ef6bbb9eee0c4033561c3891?s=128&d=identicon&r=PG", "display_name": "enhzflep", "link": "https://stackoverflow.com/users/1630963/enhzflep"}, "edited": false, "score": 0, "creation_date": 1504095087, "post_id": 45959875, "comment_id": 78878088, "body": "@enhzflep and who will clean up that mess ? why not smart pointers? Btw the section for answers is below :P"}, {"owner": {"reputation": 231, "user_id": 7404875, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b80971b1d5ed24a338b33e8761cf394e?s=128&d=identicon&r=PG&f=1", "display_name": "pmaxim98", "link": "https://stackoverflow.com/users/7404875/pmaxim98"}, "edited": false, "score": 0, "creation_date": 1504095362, "post_id": 45959875, "comment_id": 78878290, "body": "@Morgan I hope you don&#39;t have a virtual destructor for the sake of being an example."}, {"owner": {"reputation": 12072, "user_id": 1630963, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97c2d181ef6bbb9eee0c4033561c3891?s=128&d=identicon&r=PG", "display_name": "enhzflep", "link": "https://stackoverflow.com/users/1630963/enhzflep"}, "reply_to_user": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1504095677, "post_id": 45959875, "comment_id": 78878547, "body": "@tobi303 - depends on who uses the code and why. Some prefer c++ with all the bells and whistles, while others amongst us are perfectly satiated with using the language as &quot;c with classes&quot;. I&#39;m typically writing things that need to be tiny and experience has shown my gcc/g++ cross-compiler for Atmel mcus doesn&#39;t serve me well when I make use of the language&#39;s more complex features.. I&#39;d rather drink more coffee than spend more money on 10,000 chips. ;) Yeah, the answer section has always been there during my 5 year stay, thanks. :)"}, {"owner": {"reputation": 427, "user_id": 4801066, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2dee928f350ba0aba89534184e5f14e9?s=128&d=identicon&r=PG&f=1", "display_name": "Morgan", "link": "https://stackoverflow.com/users/4801066/morgan"}, "reply_to_user": {"reputation": 12072, "user_id": 1630963, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97c2d181ef6bbb9eee0c4033561c3891?s=128&d=identicon&r=PG", "display_name": "enhzflep", "link": "https://stackoverflow.com/users/1630963/enhzflep"}, "edited": false, "score": 0, "creation_date": 1504097782, "post_id": 45959875, "comment_id": 78880198, "body": "@enhzflep Thank&#39;s for the solution, I will try with this. I wil also look at smart pointers that I haven&#39;t explored yet (I&#39;m using c++ since only 3 days)"}], "answers": [{"comments": [{"owner": {"reputation": 427, "user_id": 4801066, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2dee928f350ba0aba89534184e5f14e9?s=128&d=identicon&r=PG&f=1", "display_name": "Morgan", "link": "https://stackoverflow.com/users/4801066/morgan"}, "edited": false, "score": 0, "creation_date": 1504097878, "post_id": 45959986, "comment_id": 78880266, "body": "I was supposing that the problem was only linked to the loop but the fact that things works without the attribute was confusing me. Thank you for the help !"}], "tags": [], "owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "is_accepted": true, "score": 4, "last_activity_date": 1504094729, "creation_date": 1504094729, "answer_id": 45959986, "question_id": 45959875, "link": "https://stackoverflow.com/questions/45959875/method-of-super-class-called-when-super-has-a-str-attr-instance-of-sub-is-crea/45959986#45959986", "title": "method of super-class called WHEN super has a str attr + instance of sub is created in a loop + instance is stored in a vector as a pointers of super", "body": "<p>There is only one \"condition\" that matters here: the pointers you push in the vector point to garbage when <code>Child c;</code> goes out of scope:</p>\n\n<pre><code>{\n  Child c;                   // this object lives only in this scope !!\n\n  children.push_back(&amp;c);    // &lt;-- &amp;c is fine here\n}                            // &lt;-- already here it is not !\n\n(*children[0]).myMethod();   // ***BOOM***\n</code></pre>\n\n<p>Maybe you got the impression that it is a specific combination of conditions to get the error, but thats just because dereferencing an invalid pointer is undefined behaviour, so sometimes it may look like it worked when actually it is never correct.</p>\n"}], "owner": {"reputation": 427, "user_id": 4801066, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2dee928f350ba0aba89534184e5f14e9?s=128&d=identicon&r=PG&f=1", "display_name": "Morgan", "link": "https://stackoverflow.com/users/4801066/morgan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "accepted_answer_id": 45959986, "answer_count": 1, "score": -1, "last_activity_date": 1504094729, "creation_date": 1504094407, "question_id": 45959875, "link": "https://stackoverflow.com/questions/45959875/method-of-super-class-called-when-super-has-a-str-attr-instance-of-sub-is-crea", "title": "method of super-class called WHEN super has a str attr + instance of sub is created in a loop + instance is stored in a vector as a pointers of super", "body": "<p>I can't reach a method of a sub-class' instance when several conditions are merged :</p>\n\n<ul>\n<li>There is in the super-class an attribute of type string.</li>\n<li>The instance have been created in a loop</li>\n<li>The instance is stored in a vector that takes super-class pointers</li>\n</ul>\n\n<p>It's so look like this :</p>\n\n<pre><code>class Parent\n{\n  public :\n    string name;\n    virtual void myMethod() = 0;\n};\n\nclass Child : public Parent\n{\n  public :\n    void myMethod();\n};\n\nvoid Child::myMethod()\n{\n  cout &lt;&lt; \"I'm a child\";\n}\n\nint main(void)\n{\n  vector&lt;Parent*&gt; children;\n\n  for(unsigned int i = 0 ; i &lt; 1; i++ )\n  {\n    Child c;\n\n    children.push_back(&amp;c);\n  }\n\n  (*children[0]).myMethod();\n}\n</code></pre>\n\n<p>In that case the code over with an error : \"pure virtual method called\nterminate called without an active exception\". I guess that it's trying to access to 'Parent::myMethod' that is virtual and so fail. To avoid that issue I can :\n- Remove the attribute 'name' of the super-class\n- Change the type of that attribute (to int for exemple)\n- Append the elements to the vector from outside of the for loop.</p>\n\n<p>I just can't figure what is going on in that specific case...</p>\n"}, {"tags": ["c++", "c++14"], "answers": [{"comments": [{"owner": {"reputation": 2341, "user_id": 5198101, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/e368f319f68500b32b5fdbe73e27f640?s=128&d=identicon&r=PG&f=1", "display_name": "RaGa__M", "link": "https://stackoverflow.com/users/5198101/raga-m"}, "edited": false, "score": 0, "creation_date": 1504095775, "post_id": 45959939, "comment_id": 78878625, "body": "Thanks I really didn&#39;t think about decaying the tuple type,To me the error was somewhat misleading may be because I&#39;ve never dealt with&#39;em :)"}, {"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "reply_to_user": {"reputation": 2341, "user_id": 5198101, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/e368f319f68500b32b5fdbe73e27f640?s=128&d=identicon&r=PG&f=1", "display_name": "RaGa__M", "link": "https://stackoverflow.com/users/5198101/raga-m"}, "edited": false, "score": 1, "creation_date": 1504096001, "post_id": 45959939, "comment_id": 78878829, "body": "@Explorer_N: If you read carefully the error (that you skip in question :/) <i>&quot;error: implicit instantiation of undefined template &#39;std::tuple_size&lt;std::tuple&lt;...&gt; &amp;&gt;&#39;&quot;</i>, you can see the problematic reference near the end."}], "tags": [], "owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "is_accepted": true, "score": 4, "last_activity_date": 1504094612, "creation_date": 1504094612, "answer_id": 45959939, "question_id": 45959862, "link": "https://stackoverflow.com/questions/45959862/resulting-in-an-error-incomplete-type-while-using-stdtuple-size/45959939#45959939", "title": "Resulting in an `error: incomplete type` while using std::tuple_size", "body": "<p>You need to decay the type to remove reference:</p>\n\n<pre><code>size_t s = std::tuple_size&lt;std::decay_t&lt;tup&gt;&gt;::value;\n</code></pre>\n"}], "owner": {"reputation": 2341, "user_id": 5198101, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/e368f319f68500b32b5fdbe73e27f640?s=128&d=identicon&r=PG&f=1", "display_name": "RaGa__M", "link": "https://stackoverflow.com/users/5198101/raga-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 663, "favorite_count": 0, "accepted_answer_id": 45959939, "answer_count": 1, "score": 3, "last_activity_date": 1504095466, "creation_date": 1504094382, "last_edit_date": 1504095466, "question_id": 45959862, "link": "https://stackoverflow.com/questions/45959862/resulting-in-an-error-incomplete-type-while-using-stdtuple-size", "title": "Resulting in an `error: incomplete type` while using std::tuple_size", "body": "<p>I have a class template in a namespace<br>\nAnd I have a non member function inside that namespace which returns a <code>std::tuple</code> of <code>std::shared_ptr(s)&lt;myown::myclass&lt;Type&gt;&gt;</code><br>\nI invoked the function <code>F()</code> and passed its result(<code>std::tuple</code>) to an another non-member function(inside <code>myown</code> namespace)</p>\n\n<pre><code>namespace myown {\n\n    template&lt;typename T&gt; class myclass{ /*...*/};\n\n    template&lt;&gt;           class myclass&lt;void&gt;{ /*...*/};\n\n    auto F()\n    {\n        return std::make_tuple(std::shared_ptr&lt;myclass&lt;int&gt;&gt;(),\n                               std::shared_ptr&lt;myclass&lt;const char *&gt;&gt;(),\n                               std::shared_ptr&lt;myclass&lt;int&gt;&gt;());\n    }\n\n    template &lt;typename tup&gt;\n    auto anotherF(tup&amp;&amp; result){\n        size_t s = std::tuple_size&lt;tup&gt;::value;//\n        /*...*/\n    }\n}\n\n int main()\n {\n     auto tr = myown::F();\n     myown::anotherF(tr);\n }\n</code></pre>\n\n<p>Use of <code>std::tuple_size&lt;tup&gt;</code> results in <code>error: incomplete type...used in nested name specifier</code></p>\n"}, {"tags": ["c++", "exception", "error-handling", "exception-handling"], "comments": [{"owner": {"reputation": 96896, "user_id": 2296458, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/wbG2s.png?s=128&g=1", "display_name": "Cory Kramer", "link": "https://stackoverflow.com/users/2296458/cory-kramer"}, "edited": false, "score": 2, "creation_date": 1504094258, "post_id": 45959751, "comment_id": 78877467, "body": "Actually I think <code>std::out_of_range</code> would indeed be the exception I would use. If the container is empty, then any index is out of range, that&#39;s the same way that <code>std::vector</code> already behaves. Remember an empty set is still a set (in the math sense)"}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1504094278, "post_id": 45959751, "comment_id": 78877479, "body": "IMHO I think everyone would understand your usage of <code>std::out_of_range</code>.  Even the reference site you link to has <i>Defines a type of object to be thrown as exception. It reports errors that are consequence of attempt to access elements out of defined range.</i> which pretty well fits this situation."}, {"owner": {"reputation": 36166, "user_id": 393701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250889c646cd2a916920d9252f7c6f42?s=128&d=identicon&r=PG", "display_name": "SirDarius", "link": "https://stackoverflow.com/users/393701/sirdarius"}, "edited": false, "score": 2, "creation_date": 1504094289, "post_id": 45959751, "comment_id": 78877490, "body": "<code>vector::at</code> will throw <code>std::out_of_range</code> when the vector is empty, so I believe it is indeed the correct exception to use."}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 1, "creation_date": 1504094441, "post_id": 45959751, "comment_id": 78877576, "body": "an empty range is still a range, it is just special in that any index is out of it"}], "answers": [{"comments": [{"owner": {"reputation": 8116, "user_id": 404421, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c0055698b6d967477739f6c9868ebb14?s=128&d=identicon&r=PG", "display_name": "Bojan Komazec", "link": "https://stackoverflow.com/users/404421/bojan-komazec"}, "edited": false, "score": 1, "creation_date": 1504098095, "post_id": 45959850, "comment_id": 78880465, "body": "Thanks @taskinoor. I&#39;ve been implementing this custom collection just as an exercise...so this was more a hypothetical question. I would definitely avoid doing that in case of commercial/production software unless there was a very good reason to do that."}, {"owner": {"reputation": 43502, "user_id": 377953, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hm9UN.jpg?s=128&g=1", "display_name": "taskinoor", "link": "https://stackoverflow.com/users/377953/taskinoor"}, "reply_to_user": {"reputation": 8116, "user_id": 404421, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c0055698b6d967477739f6c9868ebb14?s=128&d=identicon&r=PG", "display_name": "Bojan Komazec", "link": "https://stackoverflow.com/users/404421/bojan-komazec"}, "edited": false, "score": 1, "creation_date": 1504098565, "post_id": 45959850, "comment_id": 78880894, "body": "@BojanKomazec for learning purpose it is perfectly okay, IMHO. Off topic comment: please have a look at <code>std::allocator</code> which you may need to avoid unnecessary calling of default constructors and move semantics which you may need for effective growing operation."}], "tags": [], "owner": {"reputation": 43502, "user_id": 377953, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hm9UN.jpg?s=128&g=1", "display_name": "taskinoor", "link": "https://stackoverflow.com/users/377953/taskinoor"}, "is_accepted": true, "score": 4, "last_activity_date": 1504094901, "last_edit_date": 1504094901, "creation_date": 1504094331, "answer_id": 45959850, "question_id": 45959751, "link": "https://stackoverflow.com/questions/45959751/which-exception-to-throw-when-current-state-of-the-object-does-not-allow-attempt/45959850#45959850", "title": "Which exception to throw when current state of the object does not allow attempted operation on it?", "body": "<p><a href=\"http://en.cppreference.com/w/cpp/container/vector/at\" rel=\"nofollow noreferrer\">std::vector::at</a> already does this. So you can use <code>at</code> method instead of <code>operator []</code>. It throws <code>std::out_of_range</code> for invalid index.</p>\n\n<p>Please note that you will have to do significant work to achieve the performance of <code>std::vector</code>. But still if you want to stick to your own container and want to throw from <code>[]</code> then like <code>at</code> method <code>std::out_of_range</code> is the best choice among standard exception classes. Otherwise you need to define your own custom exception class.</p>\n"}], "owner": {"reputation": 8116, "user_id": 404421, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c0055698b6d967477739f6c9868ebb14?s=128&d=identicon&r=PG", "display_name": "Bojan Komazec", "link": "https://stackoverflow.com/users/404421/bojan-komazec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "closed_date": 1504098388, "accepted_answer_id": 45959850, "answer_count": 1, "score": 5, "last_activity_date": 1504094901, "creation_date": 1504094076, "last_edit_date": 1504094298, "question_id": 45959751, "link": "https://stackoverflow.com/questions/45959751/which-exception-to-throw-when-current-state-of-the-object-does-not-allow-attempt", "closed_reason": "Opinion-based", "title": "Which exception to throw when current state of the object does not allow attempted operation on it?", "body": "<p>Let's assume we're implementing a custom collection which behaves like a vector and we want to make <code>operator[]</code> throw some exception if collection is empty. <code>std::vector</code> has undefined behavior in this case but we want to throw exception. If this was C# we would be probably throwing <a href=\"https://msdn.microsoft.com/en-us/library/system.invalidoperationexception(v=vs.110).aspx\" rel=\"nofollow noreferrer\"><code>InvalidOperationException</code></a>. But which <a href=\"http://en.cppreference.com/w/cpp/error/exception\" rel=\"nofollow noreferrer\">C++ exception</a> would be the most appropriate/intuitive in this case? I feel <a href=\"http://en.cppreference.com/w/cpp/error/out_of_range\" rel=\"nofollow noreferrer\"><code>std::out_of_range</code></a> would not be the best choice as collection is empty so there is no 'range' for which indexing would return a valid (<em>any</em>) element.</p>\n"}, {"tags": ["c++", "armadillo"], "comments": [{"owner": {"reputation": 1382, "user_id": 3928744, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b904e3280e386d51bd888433c8ab0fa4?s=128&d=identicon&r=PG&f=1", "display_name": "hbrerkere", "link": "https://stackoverflow.com/users/3928744/hbrerkere"}, "edited": false, "score": 1, "creation_date": 1504103625, "post_id": 45959582, "comment_id": 78885048, "body": "Armadillo queues up all the operations until the result is assigned to a matrix or a submatrix. This is why the assignment to submat seems to take longer. It&#39;s actually doing the multiplication and addition at assignment time, not before. Also, don&#39;t use the <i>auto</i> keyword with Armadillo matrices and expressions, as that can lead to problems."}, {"owner": {"reputation": 317, "user_id": 3610381, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/yjIyF.jpg?s=128&g=1", "display_name": "Aristotle0", "link": "https://stackoverflow.com/users/3610381/aristotle0"}, "reply_to_user": {"reputation": 1382, "user_id": 3928744, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b904e3280e386d51bd888433c8ab0fa4?s=128&d=identicon&r=PG&f=1", "display_name": "hbrerkere", "link": "https://stackoverflow.com/users/3928744/hbrerkere"}, "edited": false, "score": 0, "creation_date": 1504105702, "post_id": 45959582, "comment_id": 78886689, "body": "@hbrerkere Your answer is very helpful to me. If I use <code>arma::mat</code> instead of <code>auto</code>, the cost time is changed as you said."}], "answers": [{"tags": [], "owner": {"reputation": 20880, "user_id": 1317944, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/OcBMY.png?s=128&g=1", "display_name": "The Quantum Physicist", "link": "https://stackoverflow.com/users/1317944/the-quantum-physicist"}, "is_accepted": false, "score": 0, "last_activity_date": 1504096384, "creation_date": 1504096384, "answer_id": 45960551, "question_id": 45959582, "link": "https://stackoverflow.com/questions/45959582/armadillo-c-how-to-make-effcient-assignment-to-submat/45960551#45960551", "title": "Armadillo C++: How to make effcient assignment to submat", "body": "<p>There doesn't seem to be specific points in your code that should make it slow. What you're doing looks fine. The only thing I would suggest is that you should try to minimize the number of <code>submat</code> calls, as it's considered relatively expensive because it could be creating a temporary matrix. Consider doing the math you want to do without <code>submat</code>. Just calculate the indices and assign them yourself.</p>\n\n<p>Given that, I have two other suggestions:</p>\n\n<ol>\n<li><p>If you insist there might be something wrong with your code or something to improve, study alternative ways to writing it (if possible) and use a <a href=\"https://en.wikipedia.org/wiki/Profiling_(computer_programming)\" rel=\"nofollow noreferrer\">function profiler</a>, such as Valgrind, to see what functions cost the most, and whether that can be optimized.</p></li>\n<li><p>If you give up on that, consider learning how to do multithreading with C++. Nowadays, it's very easy. Either use <a href=\"https://en.wikipedia.org/wiki/OpenMP\" rel=\"nofollow noreferrer\">OpenMP</a>, which is super-easy... but you have to do it right as it's easy to do mistakes there (like <a href=\"https://stackoverflow.com/questions/1970345/what-is-thread-contention\">high contention</a>); or use <a href=\"http://en.cppreference.com/w/cpp/thread/thread\" rel=\"nofollow noreferrer\"><code>std::thread</code></a>, which is a relatively new C++ construct that will simply run a function in a thread. For your case, since your application is repetivive, you can make use of any of them. You can use <a href=\"https://git.afach.de/samerafach/StdThreadPool\" rel=\"nofollow noreferrer\">my simple thread pool</a> implementation, which will schedule calls of a new instance as soon as one is finished.</p></li>\n</ol>\n\n<p>Good luck.</p>\n"}], "owner": {"reputation": 317, "user_id": 3610381, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/yjIyF.jpg?s=128&g=1", "display_name": "Aristotle0", "link": "https://stackoverflow.com/users/3610381/aristotle0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 853, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1504107110, "creation_date": 1504093613, "last_edit_date": 1504107110, "question_id": 45959582, "link": "https://stackoverflow.com/questions/45959582/armadillo-c-how-to-make-effcient-assignment-to-submat", "title": "Armadillo C++: How to make effcient assignment to submat", "body": "<p>I want to assign the value of a matrix to the submat of another matrix as <code>A.submat(ni1, ni2, nk1, nk2) = B;</code> It seems very slow. I'm wondering why it's so slow, and is there some way to improve it?</p>\n\n<p>Here is my testing codes(Because the function \"XForwarDifference\" need to be called millions time in my project, I need to profile it better)</p>\n\n<pre><code>#include &lt;armadillo&gt;\n#include &lt;chrono&gt;\n#include &lt;iostream&gt;\nusing ms = std::chrono::milliseconds;\nusing ns = std::chrono::nanoseconds;\nusing get_time = std::chrono::steady_clock;\n\nnamespace {\n  const arma::ivec::fixed&lt;5&gt; iforward = {-1, 0, 1, 2, 3};\n  const double MCA_1 = -0.30874;\n  const double MCA0 = -0.6326;\n  const double MCA1 = 1.2330;\n  const double MCA2 = -0.3334;\n  const double MCA3 = 0.04168;\n}\n\narma::mat XForwardDifference(arma::mat&amp; mat,\n                             const int&amp; ni1,\n                             const int&amp; ni2,\n                             const int&amp; nk1,\n                             const int&amp; nk2,\n                             const double&amp; dx)\n{\n  arma::mat ret(size(mat));\n  double sign_dx = 1./dx;\n  double mca_1= sign_dx * MCA_1;\n  double mca0 = sign_dx * MCA0;\n  double mca1 = sign_dx * MCA1;\n  double mca2 = sign_dx * MCA2;\n  double mca3 = sign_dx * MCA3;\n  auto t1 = get_time::now();\n  auto m1 = mat.submat(ni1+iforward(0), nk1, ni2+iforward(0), nk2);\n  auto t2 = get_time::now();\n  auto m2 = mca_1 * m1;\n  auto t3 = get_time::now();\n  auto m3 = m2 + m2;\n  auto t4 = get_time::now();\n  mat.submat(ni1, nk1, ni2, nk2) = m3;\n  auto t5 = get_time::now();\n  std::cout &lt;&lt; std::chrono::duration_cast&lt;ns&gt;(t2-t1).count() &lt;&lt; std::endl;\n  std::cout &lt;&lt; std::chrono::duration_cast&lt;ns&gt;(t3-t2).count() &lt;&lt; std::endl;\n  std::cout &lt;&lt; std::chrono::duration_cast&lt;ns&gt;(t4-t3).count() &lt;&lt; std::endl;\n  std::cout &lt;&lt; std::chrono::duration_cast&lt;ns&gt;(t5-t4).count() &lt;&lt; std::endl;\n\n\n  // ret.submat(ni1, nk1, ni2, nk2) =\n  //   mca_1* mat.submat(ni1+iforward(0), nk1, ni2+iforward(0), nk2) +\n  //   mca0 * mat.submat(ni1+iforward(1), nk1, ni2+iforward(1), nk2) +\n  //   mca1 * mat.submat(ni1+iforward(2), nk1, ni2+iforward(2), nk2) +\n  //   mca2 * mat.submat(ni1+iforward(3), nk1, ni2+iforward(3), nk2) +\n  //   mca3 * mat.submat(ni1+iforward(4), nk1, ni2+iforward(4), nk2);\n  return ret;\n}\n\n\nint main(int argc, char *argv[])\n{\n  const int len = 3;\n  int ni1, ni2, nk1, nk2, ni, nk;\n  ni = 200;\n  nk = 200;\n  ni1 = len;\n  ni2 = ni1 + ni - 1;\n  nk1 = len;\n  nk2 = nk1 + nk - 1;\n  const double dx = 1.;\n  auto start_time = get_time::now();\n  arma::mat mat(ni + 2*len, nk + 2*len);\n  mat = XForwardDifference(mat, ni1, ni2, nk1, nk2, dx);\n  auto end_time = get_time::now();\n  auto diff = end_time - start_time;\n  std::cout &lt;&lt; \"Elapsed time is : \"\n            &lt;&lt; std::chrono::duration_cast&lt;ns&gt;(diff).count()\n            &lt;&lt; \" ns \"\n            &lt;&lt; std::endl;\n  return 0;\n}\n</code></pre>\n\n<p>The output is:</p>\n\n<pre><code>180\n116\n110\n851123\nElapsed time is : 961975 ns \n</code></pre>\n\n<p>You can see <code>mat.submat(ni1, nk1, ni2, nk2) = m3;</code> covers the most of elapsed time.</p>\n\n<p>hbrerkere gives the reason:</p>\n\n<blockquote>\n  <p>Armadillo queues up all the operations until the result is assigned to a matrix or a submatrix. This is why the assignment to submat seems to take longer. It's actually doing the multiplication and addition at assignment time, not before. Also, don't use the auto keyword with Armadillo matrices and expressions, as that can lead to problems. \u2013 hbrerkere</p>\n</blockquote>\n\n<pre><code>  auto t1 = get_time::now();\n  arma::mat m1 = mat.submat(ni1+iforward(0), nk1, ni2+iforward(0), nk2);\n  auto t2 = get_time::now();\n  arma::mat m2 = mca_1 * m1;\n  auto t3 = get_time::now();\n  arma::mat m3 = m2 + m2;\n  auto t4 = get_time::now();\n  ret = m3;\n  auto t5 = get_time::now();\n</code></pre>\n\n<p>If I modify the codes as he said, then the output now is below:</p>\n\n<pre><code>391880\n356480\n373072\n113051\nElapsed time is : 1352013 ns \n</code></pre>\n\n<p>I also encounter the situation that <code>auto</code> will bring problems in armadillo.</p>\n\n<pre><code>auto m1 = mat.submat(ni1, nk1, ni2, nk2) * 2;\ncout &lt;&lt; size(m1) &lt;&lt; endl;\n</code></pre>\n\n<p>It will print very large size that is not correct.</p>\n"}, {"tags": ["c++", "qt", "qtmultimedia"], "answers": [{"tags": [], "owner": {"reputation": 1778, "user_id": 2440728, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1fWyQ.jpg?s=128&g=1", "display_name": "VuVirt", "link": "https://stackoverflow.com/users/2440728/vuvirt"}, "is_accepted": true, "score": 2, "last_activity_date": 1504265861, "last_edit_date": 1504265861, "creation_date": 1504113497, "answer_id": 45966285, "question_id": 45959554, "link": "https://stackoverflow.com/questions/45959554/qmediaplayer-modify-audio-on-the-fly/45966285#45966285", "title": "QMediaPlayer - modify audio on the fly", "body": "<p>QMediaPlayer doesn't allow low-level access to the audio data. \nI'd suggest to you to use the <a href=\"http://doc.qt.io/qt-5/qaudiooutput.html#details\" rel=\"nofollow noreferrer\">QAudioOutput</a> and <a href=\"http://doc.qt.io/qt-5/qaudiodecoder.html#details\" rel=\"nofollow noreferrer\">QAudioDecoder</a> classes for your purpose. \nThe QAudioDecoder produces <a href=\"http://doc.qt.io/qt-5/qaudiobuffer.html#details\" rel=\"nofollow noreferrer\">QAudioBuffer</a> objects. You can access the data() of these objects, process it (modify it) and feed it to the QIODevice that is returned by the start() method of the QAudioOutput object. \nThis will be the audio playback path of your player. \nFor the video you'll still use a muted QMediaPlayer to decode the video frames from the same file and output them to a <a href=\"http://doc.qt.io/qt-5/qabstractvideosurface.html#details\" rel=\"nofollow noreferrer\">QAbstractVideoSurface</a>. You'll then need an algorithm to sync the video and audio frames produced by the above two methods.  </p>\n"}], "owner": {"reputation": 329, "user_id": 4620235, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/1a75a15c9b2e10fc619d14ce765416c6?s=128&d=identicon&r=PG&f=1", "display_name": "eko", "link": "https://stackoverflow.com/users/4620235/eko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 625, "favorite_count": 0, "accepted_answer_id": 45966285, "answer_count": 1, "score": 0, "last_activity_date": 1504265861, "creation_date": 1504093545, "question_id": 45959554, "link": "https://stackoverflow.com/questions/45959554/qmediaplayer-modify-audio-on-the-fly", "title": "QMediaPlayer - modify audio on the fly", "body": "<p>I'm researching options for creating a simple video player. What I'd like to do, is to apply some audio processing (e.g. low pass filter for simplicity) while playing back the video. I've looked at Qt multimedia API, so here's my main question:</p>\n\n<ul>\n<li>How could I edit the audio output of a QMediaPlayer? Do I need some lower level APIs?</li>\n</ul>\n\n<p>Additionally, if some other technologies would suit this purpose better or provide better open source libraries, feel free to suggest. I have experience with C# as well.</p>\n"}, {"tags": ["c++", "c", "linux", "gcc", "ld"], "comments": [{"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 4, "creation_date": 1504093460, "post_id": 45959487, "comment_id": 78876887, "body": "How do you build your program? How do you link with the library? Please edit your question to include the actual commands used."}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 3, "creation_date": 1504093893, "post_id": 45959487, "comment_id": 78877173, "body": "The &quot;corrupt header&quot; looks like a normal shared library while the &quot;good header&quot; is an executable. How did you link that?"}, {"owner": {"reputation": 3634, "user_id": 783000, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/4f8aa4cb9e75d158cb423b4134c46087?s=128&d=identicon&r=PG", "display_name": "Alexander Thei&#223;en", "link": "https://stackoverflow.com/users/783000/alexander-thei%c3%9fen"}, "edited": false, "score": 0, "creation_date": 1504094815, "post_id": 45959487, "comment_id": 78877868, "body": "You are so right. I accidentally linked the executable with &quot;-shared&quot; to counter another error I had. My bad :("}], "owner": {"reputation": 3634, "user_id": 783000, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/4f8aa4cb9e75d158cb423b4134c46087?s=128&d=identicon&r=PG", "display_name": "Alexander Thei&#223;en", "link": "https://stackoverflow.com/users/783000/alexander-thei%c3%9fen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 207, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1504093358, "creation_date": 1504093358, "question_id": 45959487, "link": "https://stackoverflow.com/questions/45959487/linking-against-library-corrupts-elf-program-headers", "title": "Linking against library corrupts ELF program headers", "body": "<p>I am trying to link my C++ executable against a shared C library (also written by me / my colleagues). </p>\n\n<p>The C++ executable just contains a main that prints \"Hello World\" to stdout and returns 0.</p>\n\n<p>It runs fine. But as soon as I dynamic link against my C library (I am not even calling into this lib) my C++ executable fails at startup:</p>\n\n<pre><code>/opt/av-server # strace ./program \nexecve(\"./program\", [\"./program\"], [/* 10 vars */]) = 0\n--- SIGSEGV {si_signo=SIGSEGV, si_code=SEGV_MAPERR, si_addr=NULL} ---\n+++ killed by SIGSEGV +++\nSegmentation fault\n</code></pre>\n\n<p>I did some research and found out that as soon as I link against the C library my ELF header starts looking very strange. The entry point address is suspiciously low and the addresses of the first LOAD are all zero:</p>\n\n<h2>Corrupt Header</h2>\n\n<pre><code>Elf file type is DYN (Shared object file)\nEntry point 0x6d8\nThere are 6 program headers, starting at offset 52\n\nProgram Headers:\n  Type           Offset   VirtAddr   PhysAddr   FileSiz MemSiz  Flg Align\n  EXIDX          0x000960 0x00000960 0x00000960 0x00010 0x00010 R   0x4\n  LOAD           0x000000 0x00000000 0x00000000 0x00974 0x00974 R E 0x10000\n  LOAD           0x000ee0 0x00010ee0 0x00010ee0 0x0015c 0x00164 RW  0x10000\n  DYNAMIC        0x000ef0 0x00010ef0 0x00010ef0 0x00110 0x00110 RW  0x4\n  GNU_STACK      0x000000 0x00000000 0x00000000 0x00000 0x00000 RW  0x10\n  GNU_RELRO      0x000ee0 0x00010ee0 0x00010ee0 0x00120 0x00120 R   0x1\n\n Section to Segment mapping:\n  Segment Sections...\n   00     .ARM.exidx \n   01     .hash .dynsym .dynstr .gnu.version .gnu.version_r .rel.dyn .rel.plt .init .plt .text .fini .rodata .ARM.extab .ARM.exidx .eh_frame \n   02     .init_array .fini_array .jcr .dynamic .got .data .bss \n   03     .dynamic \n   04     \n   05     .init_array .fini_array .jcr .dynamic \n</code></pre>\n\n<p>I guess this explains why the program is segfaulting: It jumps to 0 :/ As comparison this is the header that is generated when I don't link against the lib:</p>\n\n<h2>Good Header</h2>\n\n<pre><code>Elf file type is EXEC (Executable file)\nEntry point 0x10588\nThere are 9 program headers, starting at offset 52\n\nProgram Headers:\n  Type           Offset   VirtAddr   PhysAddr   FileSiz MemSiz  Flg Align\n  EXIDX          0x0007fc 0x000107fc 0x000107fc 0x00018 0x00018 R   0x4\n  PHDR           0x000034 0x00010034 0x00010034 0x00120 0x00120 R E 0x4\n  INTERP         0x000154 0x00010154 0x00010154 0x00013 0x00013 R   0x1\n      [Requesting program interpreter: /lib/ld-linux.so.3]\n  LOAD           0x000000 0x00010000 0x00010000 0x00818 0x00818 R E 0x10000\n  LOAD           0x000ef0 0x00020ef0 0x00020ef0 0x00148 0x001dc RW  0x10000\n  DYNAMIC        0x000f00 0x00020f00 0x00020f00 0x00100 0x00100 RW  0x4\n  NOTE           0x000168 0x00010168 0x00010168 0x00020 0x00020 R   0x4\n  GNU_STACK      0x000000 0x00000000 0x00000000 0x00000 0x00000 RW  0x10\n  GNU_RELRO      0x000ef0 0x00020ef0 0x00020ef0 0x00110 0x00110 R   0x1\n\n Section to Segment mapping:\n  Segment Sections...\n   00     .ARM.exidx \n   01     \n   02     .interp \n   03     .interp .note.ABI-tag .hash .dynsym .dynstr .gnu.version .gnu.version_r .rel.dyn .rel.plt .init .plt .text .fini .rodata .ARM.extab .ARM.exidx .eh_frame \n   04     .init_array .fini_array .jcr .dynamic .got .data .bss \n   05     .dynamic \n   06     .note.ABI-tag \n   07     \n   08     .init_array .fini_array .jcr .dynamic \n</code></pre>\n\n<p>I understand why it must segfault. But the real question is: <strong>What inside the C library could possibly be responsible for corrupting the ELF header in that way?</strong> </p>\n\n<p>I want to know that to look for. My suspicion is that somewhere in the lib some compiler intrinsics are used that go wrong. Just a wild guess.</p>\n\n<p>I cross compile for <code>Linux bha-1CCAE370CE47 3.4.35 #1 Thu Mar 9 11:20:13 HKT 2017 armv5tejl GNU/Linux</code> with a GCC6.3. The toolchain was build with crosstool-ng. Build system is macOS.</p>\n"}, {"tags": ["c++", "opencv", "memory-leaks", "video-capture"], "comments": [{"owner": {"reputation": 14358, "user_id": 3962537, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AI0Bc.png?s=128&g=1", "display_name": "Dan Ma\u0161ek", "link": "https://stackoverflow.com/users/3962537/dan-ma%c5%a1ek"}, "edited": false, "score": 1, "creation_date": 1504098572, "post_id": 45959482, "comment_id": 78880903, "body": "If this is C++, why use the old C API? Right now you have to manage pointers yourself, which often leads to problems. | However, other than not releasing the <code>capture</code> instance, I don&#39;t see any obvious leaks (the frame pointer returned by <code>cvQueryFrame</code> ought to be owned by OpenCV.)"}, {"owner": {"reputation": 14358, "user_id": 3962537, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AI0Bc.png?s=128&g=1", "display_name": "Dan Ma\u0161ek", "link": "https://stackoverflow.com/users/3962537/dan-ma%c5%a1ek"}, "edited": false, "score": 0, "creation_date": 1504099280, "post_id": 45959482, "comment_id": 78881527, "body": "BTW, which VideoCapture backend is it using? Can you reproduce it reading a video file? Which compiler are you using?"}, {"owner": {"reputation": 8645, "user_id": 5235574, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wEodm.jpg?s=128&g=1", "display_name": "Fruchtzwerg", "link": "https://stackoverflow.com/users/5235574/fruchtzwerg"}, "reply_to_user": {"reputation": 14358, "user_id": 3962537, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AI0Bc.png?s=128&g=1", "display_name": "Dan Ma\u0161ek", "link": "https://stackoverflow.com/users/3962537/dan-ma%c5%a1ek"}, "edited": false, "score": 0, "creation_date": 1504100218, "post_id": 45959482, "comment_id": 78882285, "body": "Thanks for your help @DanMa\u0161ek . I am using Visual Studio 2017 with the opencv_ffmpeg320_64.dll. I am not able to reproduce the problem using a video file (the memory consumption remains constant)."}, {"owner": {"reputation": 14358, "user_id": 3962537, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AI0Bc.png?s=128&g=1", "display_name": "Dan Ma\u0161ek", "link": "https://stackoverflow.com/users/3962537/dan-ma%c5%a1ek"}, "edited": false, "score": 3, "creation_date": 1504100879, "post_id": 45959482, "comment_id": 78882838, "body": "Well, looks like <a href=\"https://github.com/opencv/opencv/issues?utf8=%E2%9C%93&amp;q=is%3Aissue%20is%3Aopen%20leak\" rel=\"nofollow noreferrer\">you&#39;re not alone</a> with this problem."}, {"owner": {"reputation": 8645, "user_id": 5235574, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wEodm.jpg?s=128&g=1", "display_name": "Fruchtzwerg", "link": "https://stackoverflow.com/users/5235574/fruchtzwerg"}, "edited": false, "score": 0, "creation_date": 1504101908, "post_id": 45959482, "comment_id": 78883685, "body": "Oh dear .. looks like this problem is still unsolved since many months ... it&#39;s frustrating."}], "owner": {"reputation": 8645, "user_id": 5235574, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wEodm.jpg?s=128&g=1", "display_name": "Fruchtzwerg", "link": "https://stackoverflow.com/users/5235574/fruchtzwerg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 120, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1504100082, "creation_date": 1504093351, "last_edit_date": 1592644375, "question_id": 45959482, "link": "https://stackoverflow.com/questions/45959482/opencv-memory-leak-using-cvcreatefilecapture-and-cvqueryframe", "title": "OpenCV memory leak using cvCreateFileCapture and cvQueryFrame", "body": "<p>I am new to OpenCV (OpenCV 3.2 / opencv_ffmpeg320_64.dll / Windows 10 / Visual Studio 2017) and wrote a program dealing with a video stream of a webcam. Unfortunately the program has a memory leak. After hours of searching and googling I managed to break down the problem to the following minimal example:</p>\n<pre><code>#include &lt;iostream&gt;\n#include &lt;opencv2/opencv.hpp&gt;\n#include &lt;thread&gt;\n\nCvCapture *capture;\nIplImage *frame;\n\nint main(int argc, char **argv)\n{\n    capture = cvCreateFileCapture(&quot;http://192.168.1.123:8080/CamStream&quot;);\n\n    while (true)\n    {\n        cvWaitKey(1);\n\n        frame = cvQueryFrame(capture);\n        if (frame)\n        {\n            std::cout &lt;&lt; &quot;New image&quot; &lt;&lt; std::endl;\n        }\n    }\n\n    return 0;\n}\n</code></pre>\n<p>As you can see I am capturing of a simple HTTP stream. After the capture is created new frames are received. Unfortunately the task manager shows a never stopping increase of memory:</p>\n<p><a href=\"https://i.stack.imgur.com/Y3pc5.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Y3pc5.gif\" alt=\"Process\" /></a></p>\n<p>What could cause this problem and what are possible approaches to solve it?</p>\n"}, {"tags": ["c++", "memory-management"], "comments": [{"owner": {"reputation": 2575, "user_id": 4711812, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/87100b6114369140256e64e7ebab7ec9?s=128&d=identicon&r=PG&f=1", "display_name": "muXXmit2X", "link": "https://stackoverflow.com/users/4711812/muxxmit2x"}, "edited": false, "score": 2, "creation_date": 1504093190, "post_id": 45959403, "comment_id": 78876713, "body": "Don&#39;t post code as images. Copy and past the code into the question itself."}, {"owner": {"reputation": 155, "user_id": 7071748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a95be4501f968b04686044e2c93ac43?s=128&d=identicon&r=PG&f=1", "display_name": "Zik332", "link": "https://stackoverflow.com/users/7071748/zik332"}, "reply_to_user": {"reputation": 2575, "user_id": 4711812, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/87100b6114369140256e64e7ebab7ec9?s=128&d=identicon&r=PG&f=1", "display_name": "muXXmit2X", "link": "https://stackoverflow.com/users/4711812/muxxmit2x"}, "edited": false, "score": 0, "creation_date": 1504093242, "post_id": 45959403, "comment_id": 78876742, "body": "Its the code of &#39;xhash&#39; and &#39;list&#39; files not my code.."}, {"owner": {"reputation": 7681, "user_id": 8242698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/BjJXu.jpg?s=128&g=1", "display_name": "user0042", "link": "https://stackoverflow.com/users/8242698/user0042"}, "edited": false, "score": 1, "creation_date": 1504093276, "post_id": 45959403, "comment_id": 78876767, "body": "@Zik332 Use placement <code>new</code> to overcome these problems. Constructors and destructors must be called properly and there&#39;s no way to overcome this."}, {"owner": {"reputation": 155, "user_id": 7071748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a95be4501f968b04686044e2c93ac43?s=128&d=identicon&r=PG&f=1", "display_name": "Zik332", "link": "https://stackoverflow.com/users/7071748/zik332"}, "reply_to_user": {"reputation": 7681, "user_id": 8242698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/BjJXu.jpg?s=128&g=1", "display_name": "user0042", "link": "https://stackoverflow.com/users/8242698/user0042"}, "edited": false, "score": 0, "creation_date": 1504093336, "post_id": 45959403, "comment_id": 78876810, "body": "@user0042 Forgot to mention, that is what I am trying to avoid, using new. that is why I allocated a big chunk of memory. Are you sure there isn&#39;t a way to overcome this?"}, {"owner": {"reputation": 7681, "user_id": 8242698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/BjJXu.jpg?s=128&g=1", "display_name": "user0042", "link": "https://stackoverflow.com/users/8242698/user0042"}, "edited": false, "score": 0, "creation_date": 1504093423, "post_id": 45959403, "comment_id": 78876862, "body": "@Zik332 Placement <code>new</code> will operate on the memory you allocated in your  custom way. That&#39;s the whole point of it. Check <a href=\"http://en.cppreference.com/w/cpp/language/new\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 155, "user_id": 7071748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a95be4501f968b04686044e2c93ac43?s=128&d=identicon&r=PG&f=1", "display_name": "Zik332", "link": "https://stackoverflow.com/users/7071748/zik332"}, "edited": false, "score": 0, "creation_date": 1504093512, "post_id": 45959403, "comment_id": 78876923, "body": "Oh, I didn&#39;t knew about that, I&#39;ll check that out"}, {"owner": {"reputation": 7681, "user_id": 8242698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/BjJXu.jpg?s=128&g=1", "display_name": "user0042", "link": "https://stackoverflow.com/users/8242698/user0042"}, "edited": false, "score": 0, "creation_date": 1504093551, "post_id": 45959403, "comment_id": 78876946, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/222557/what-uses-are-there-for-placement-new\">What uses are there for &quot;placement new&quot;?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "is_accepted": true, "score": 1, "last_activity_date": 1504095769, "creation_date": 1504095769, "answer_id": 45960321, "question_id": 45959403, "link": "https://stackoverflow.com/questions/45959403/initializing-allocated-memory-without-calling-destructor-copy-or-move/45960321#45960321", "title": "Initializing (allocated) memory without calling destructor, copy, or move", "body": "<p>The way to do it would be to use placement new:</p>\n\n<pre><code>auto* MemoryBlock = VirtualAlloc(0, SizeInBytes, MEM_RESERVE|MEM_COMMIT, PAGE_READWRITE);\nSomeStruct* NewPointer = new (MemoryBlock) SomeStruct();\n\n// ...\n\nNewPointer-&gt;~SomeStruct();\nVirtualFree(MemoryBlock /*..*/)\n</code></pre>\n"}], "owner": {"reputation": 155, "user_id": 7071748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a95be4501f968b04686044e2c93ac43?s=128&d=identicon&r=PG&f=1", "display_name": "Zik332", "link": "https://stackoverflow.com/users/7071748/zik332"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 45960321, "answer_count": 1, "score": -1, "last_activity_date": 1504095769, "creation_date": 1504093117, "last_edit_date": 1592644375, "question_id": 45959403, "link": "https://stackoverflow.com/questions/45959403/initializing-allocated-memory-without-calling-destructor-copy-or-move", "title": "Initializing (allocated) memory without calling destructor, copy, or move", "body": "<p>I have a memory I allocated with <code>VirtualAlloc</code> and I have cast the type to some struct I created:</p>\n<pre><code>struct SomeStruct\n{\n    uint32 SomeInt;\n    Class SomeClass;\n};\n</code></pre>\n<p>like this:</p>\n<pre><code>MemoryBlock = VirtualAlloc(0, SizeInBytes, MEM_RESERVE|MEM_COMMIT, PAGE_READWRITE);\nSomeStruct* NewPointer = (SomeStruct*)MemoryBlock ;\n</code></pre>\n<p>All the memory is initalized to zero BUT I have a problem with that, in the <code>Class</code> class I created, there is member of type <code>std::unordered_map&lt;std::string, int32&gt;</code>.</p>\n<p>The problem is, when I try to use <code>NewPointer-&gt;SomeClass</code> it wont work and throw <code>read access violation</code> exception, which is right, but when I try to do this:</p>\n<pre><code>*NewPointer = {};\n</code></pre>\n<p>To initialize the struct (Including <code>NewPointer-&gt;SomeClass</code>) I get another exception about moving the <code>std::unordered_map&lt;std::string, int32&gt;</code> (again, <code>read access violation</code> exception).</p>\n<p>The error is thrown here:\n<a href=\"https://i.stack.imgur.com/pk54g.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/pk54g.png\" alt=\"enter image description here\" /></a></p>\n<p>(On the line where I initialize)</p>\n<p>which I traced back to here:\n<a href=\"https://i.stack.imgur.com/CNgQg.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/CNgQg.png\" alt=\"enter image description here\" /></a></p>\n<p>I don't really get what happens but I think it has something to do with moving the data or destructing it.</p>\n<p>What can I do to make the above code work and for me to use <code>SomeClass</code> without causing exceptions?</p>\n<p>By the way, I have to use the the allocated memory so I can't remove it.\n(I am sending the allocated memory to another .dll so I don't know the struct type when allocating the memory)</p>\n"}]