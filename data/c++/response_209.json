[{"tags": ["c++", "language-lawyer", "list-initialization"], "answers": [{"tags": [], "owner": {"reputation": 91345, "user_id": 481267, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/DMvoo.png?s=128&g=1", "display_name": "Brian Bi", "link": "https://stackoverflow.com/users/481267/brian-bi"}, "is_accepted": true, "score": 10, "last_activity_date": 1547077833, "creation_date": 1547077833, "answer_id": 54120116, "question_id": 54119925, "link": "https://stackoverflow.com/questions/54119925/list-initialization-of-a-reference-is-gcc-or-clang-correct/54120116#54120116", "title": "List initialization of a reference: is GCC or Clang correct?", "body": "<p>Let's read the standard in the correct order, so that we know which sections apply to the situation at hand.</p>\n\n<p>[dcl.init]/17 says:</p>\n\n<blockquote>\n  <p>The semantics of initializers are as follows... If the initializer is a (non-parenthesized) <em>braced-init-list</em> or is <code>=</code> <em>braced-init-list</em>, the object or reference is list-initialized (11.6.4) ...</p>\n</blockquote>\n\n<p>So we go to [dcl.init.list] (11.6.4). Paragraph 3 says:</p>\n\n<blockquote>\n  <p>List-initialization of an object or reference of type <code>T</code> is defined as follows: (... cases that don't apply are elided from this quotation...) Otherwise, if the initializer list has a single element of type <code>E</code> and either <code>T</code> is not a reference type or its referenced type is reference-related to <code>E</code> ... otherwise, if <code>T</code> is a reference type, a prvalue of the type referenced by <code>T</code> is generated. The prvalue\n  initializes its result object by copy-list-initialization or direct-list-initialization, depending on the kind of initialization for the reference. The prvalue is then used to direct-initialize the reference. [ <em>Note:</em> As\n  usual, the binding will fail and the program is ill-formed if the reference type is an lvalue reference to a\n  non-const type. <em>\u2014end note</em> ]</p>\n</blockquote>\n\n<p>According to [dcl.init.ref]/4:</p>\n\n<blockquote>\n  <p>Given types \u201c<em>cv1</em> <code>T1</code>\u201d and \u201c<em>cv2</em> <code>T2</code>\u201d, \u201c<em>cv1</em> <code>T1</code>\u201d is <em>reference-related</em> to \u201c<em>cv2</em> <code>T2</code>\u201d if <code>T1</code> is the same type as <code>T2</code>, or <code>T1</code> is a base class of <code>T2</code>.</p>\n</blockquote>\n\n<p>Therefore, in your code, the referenced type <code>int</code> is not reference-related to the type in the initializer list, namely <code>S</code>. Thus, by [dcl.init.list]/3, a prvalue of type <code>int</code> is generated, and it takes the form <code>int{s}</code>. And as the note says, in the case of <code>iref2</code>, the program is ill-formed because it tries to bind a non-const lvalue reference to a prvalue. In the case of <code>iref3</code>, the program should compile since <code>iref3</code> is being bound to the prvalue result <code>int{s}</code>.</p>\n"}], "owner": {"reputation": 1176, "user_id": 1371191, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh4.googleusercontent.com/-7bV-CLvBrNE/AAAAAAAAAAI/AAAAAAAAAE8/i44ypczz624/photo.jpg?sz=128", "display_name": "Mike Lui", "link": "https://stackoverflow.com/users/1371191/mike-lui"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 1, "accepted_answer_id": 54120116, "answer_count": 1, "score": 11, "last_activity_date": 1547077833, "creation_date": 1547076348, "last_edit_date": 1547077266, "question_id": 54119925, "link": "https://stackoverflow.com/questions/54119925/list-initialization-of-a-reference-is-gcc-or-clang-correct", "title": "List initialization of a reference: is GCC or Clang correct?", "body": "<p>Given this example:</p>\n\n<pre><code>int g_i = 10;\nstruct S {\n    operator int&amp;(){ return g_i; }\n};\n\nint main() {\n    S s;\n    int&amp; iref1 = s; // implicit conversion\n\n    int&amp; iref2 = {s}; // clang++ error, g++ compiles fine:\n                      // `s` is converted\n                      // to a temporary int and binds with\n                      // lvalue reference\n\n    int&amp;&amp; iref3 = {s}; // clang++ compiles, g++ error:\n                       // cannot bind rvalue reference\n                       // to lvalue\n}\n</code></pre>\n\n<p>The errors are as described in the comments.<br>\n<strong>gcc 8.2.1</strong> and <strong>clang 7.0.1</strong> were used and disagree about what is happening in this example. Could someone clarify this?</p>\n\n<p><a href=\"https://timsong-cpp.github.io/cppwp/dcl.init#list\" rel=\"noreferrer\">In list initialization </a>:</p>\n\n<blockquote>\n  <p>Otherwise, <strong>if the initializer list has a single element</strong> of type E and either T is not a reference type or <strong>its referenced type is reference-related to E</strong>, the object or <strong>reference is initialized from that element</strong> (by copy-initialization for copy-list-initialization, or by direct-initialization for direct-list-initialization); if a narrowing conversion (see below) is required to convert the element to T, the program is ill-formed.</p>\n  \n  <p><strong>Otherwise, if T is a reference type, a prvalue of the type referenced by T is generated.</strong> The prvalue initializes its result object by copy-list-initialization or direct-list-initialization, depending on the kind of initialization for the reference. The prvalue is then used to direct-initialize the reference. [\u2009Note: As usual, the binding will fail and the program is ill-formed if the reference type is an lvalue reference to a non-const type. \u2014\u2009end note\u2009] </p>\n</blockquote>\n\n<p><a href=\"https://timsong-cpp.github.io/cppwp/dcl.init#ref\" rel=\"noreferrer\">In reference initialization</a>:</p>\n\n<blockquote>\n  <p>Given types \u201ccv1 T1\u201d and \u201ccv2 T2\u201d, <strong>\u201ccv1 T1\u201d is reference-related to \u201ccv2 T2\u201d if T1 is the same type as T2, or T1 is a base class of T2</strong>. \u201ccv1 T1\u201d is reference-compatible with \u201ccv2 T2\u201d if<br>\n  - T1 is reference-related to T2, or<br>\n  - T2 is \u201cnoexcept function\u201d and T1 is \u201cfunction\u201d, where the function types are otherwise the same,</p>\n</blockquote>\n\n<p>...<a href=\"https://timsong-cpp.github.io/cppwp/dcl.init#ref-5\" rel=\"noreferrer\">and later on there's some (personally ambiguous) language on user-defined conversions</a>:</p>\n\n<p>For example:</p>\n\n<blockquote>\n  <p>If the reference is an lvalue reference and the initializer expression<br>\n  ...<br>\n  <strong>has a class type (i.e., T2 is a class type), where T1 is not reference-related to T2, and can be converted to an lvalue of type \u201ccv3 T3\u201d, where \u201ccv1 T1\u201d is reference-compatible with \u201ccv3 T3\u201d (this conversion is selected</strong> by enumerating the applicable conversion functions ([over.match.ref]) and choosing the best one through overload resolution),<br>\n  ...<br>\n  then the reference is bound to the ... value result of the conversion </p>\n</blockquote>\n\n<p>...</p>\n\n<blockquote>\n  <p>Otherwise, if the initializer expression<br>\n  ...<br>\n  has a class type (i.e., T2 is a class type), where T1 is not reference-related to T2, and can be converted to an rvalue or function lvalue of type \u201ccv3 T3\u201d, where \u201ccv1 T1\u201d is reference-compatible with \u201ccv3 T3\u201d<br>\n  ...\n  then the value of the ... result of the conversion in the second case is called the converted initializer. If the converted initializer is a prvalue, its type T4 is adjusted to type \u201ccv1 T4\u201d</p>\n</blockquote>\n\n<p>...</p>\n\n<blockquote>\n  <p>Otherwise:<br>\n  - If T1 or T2 is a class type and T1 is not reference-related to T2, <strong>user-defined conversions are considered using the rules for copy-initialization of an object of type \u201ccv1 T1\u201d by user-defined conversion</strong> ... The result of the call to the conversion function, as described for the non-reference copy-initialization, is then used to direct-initialize the reference. <strong>For this direct-initialization, user-defined conversions are not considered</strong>.</p>\n</blockquote>\n\n<p>...</p>\n\n<blockquote>\n  <p>Otherwise, <strong>the initializer expression is implicitly converted to a prvalue of type \u201ccv1 T1\u201d</strong>. The temporary materialization conversion is applied and the reference is bound to the result.</p>\n</blockquote>\n\n<p>These rules are quite nuanced and I cannot fully grasp each situation.\nTo me, it seems like a prvalue should be getting generated (I agree with clang), but the language on reference initialization, and interaction with list initialization is very fuzzy. </p>\n"}, {"tags": ["c++", "unit-testing"], "comments": [{"owner": {"reputation": 56117, "user_id": 845092, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/50ccdbac5f0f9ff683e4b30a248189bf?s=128&d=identicon&r=PG", "display_name": "Mooing Duck", "link": "https://stackoverflow.com/users/845092/mooing-duck"}, "edited": false, "score": 0, "creation_date": 1547075473, "post_id": 54119739, "comment_id": 95071952, "body": "I&#39;ve only done Java, but do you know how Dependency Injection works?"}, {"owner": {"reputation": 3108, "user_id": 4641116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gc52U.png?s=128&g=1", "display_name": "Eljay", "link": "https://stackoverflow.com/users/4641116/eljay"}, "edited": false, "score": 1, "creation_date": 1547075663, "post_id": 54119739, "comment_id": 95072004, "body": "With an old, large existing legacy code base, refactoring the code to use Dependency Injection is itself a lot of effort."}, {"owner": {"reputation": 83151, "user_id": 3943312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc00b38b94ca7b6f820622b0a8af8ded?s=128&d=identicon&r=PG", "display_name": "Sam Varshavchik", "link": "https://stackoverflow.com/users/3943312/sam-varshavchik"}, "edited": false, "score": 1, "creation_date": 1547079241, "post_id": 54119739, "comment_id": 95072824, "body": "The only &quot;proper&quot; way is the one that works correctly, that&#39;s the bottom line. Whether it&#39;s virtual functions; or, redefining some related classes so that the test class thinks it&#39;s using the real classes, but is instead using ones that return simulated data; or intentional and controlled violation of the One Definition Rule, for testing purposes; or preprocessor tricks -- everything is fair game. Whatever gets the job done. I&#39;ve used all of these approaches, and then some, at various times."}, {"owner": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "edited": false, "score": 1, "creation_date": 1547080530, "post_id": 54119739, "comment_id": 95073148, "body": "You could use <code>#define MOCK_VIRTUAL final</code>.  Then when mocking it is non-final; when not mocking it is final hence devirtualized.  RTTI remains, to reduce chance of different behaviour."}], "answers": [{"comments": [{"owner": {"reputation": 126499, "user_id": 1531124, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/zw18i.png?s=128&g=1", "display_name": "GhostCat", "link": "https://stackoverflow.com/users/1531124/ghostcat"}, "edited": false, "score": 0, "creation_date": 1547106478, "post_id": 54120682, "comment_id": 95079425, "body": "But that is like the absolute last choice. You want your production code to be your production code, nothing else."}], "tags": [], "owner": {"reputation": 36, "user_id": 4368125, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DYdb_bbl-y8/AAAAAAAAAAI/AAAAAAAAAR0/jdqNdOU5yWY/photo.jpg?sz=128", "display_name": "Kirill Voroshilov", "link": "https://stackoverflow.com/users/4368125/kirill-voroshilov"}, "is_accepted": false, "score": 0, "last_activity_date": 1547082550, "creation_date": 1547082550, "answer_id": 54120682, "question_id": 54119739, "link": "https://stackoverflow.com/questions/54119739/proper-approach-to-change-a-class-functionality-for-unit-testing/54120682#54120682", "title": "Proper approach to change a class functionality for unit testing?", "body": "<p>If you want to do it without any performance impact, you might want to try compile-time mocking like this:</p>\n\n<pre><code>class Production {\nprotected:\n    int Servers = 0;\npublic:\n\n    bool IsValInRegistry(const std::string&amp; regVal);\n};\n\nbool Production::IsValInRegistry(const std::string&amp; regVal)\n{\n#ifdef USE_MOCK_PRODUCTION\n    return true;\n#else\n    HRESULT hr = GOOD;\n    hr = WinSysCallToRegistry(regVal);\n\n    if (HR)\n        return true;\n    else\n        return false;\n#endif\n}\n</code></pre>\n\n<p>This would require recompilation with needed flags for the tests you need, but the production build will stay the same as it was. So it's just the matter of time that you can spend on running those unit-tests.</p>\n"}], "owner": {"reputation": 429, "user_id": 8728860, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-niyd4JYDULk/AAAAAAAAAAI/AAAAAAAAGys/e4dqNo_F3yQ/photo.jpg?sz=128", "display_name": "Joe", "link": "https://stackoverflow.com/users/8728860/joe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1547082550, "creation_date": 1547075329, "question_id": 54119739, "link": "https://stackoverflow.com/questions/54119739/proper-approach-to-change-a-class-functionality-for-unit-testing", "title": "Proper approach to change a class functionality for unit testing?", "body": "<p>I'm working on an old and large C++ codebase and I've been in the process of creating unit tests for components that have been missing them.</p>\n\n<p>What's the proper way to mocking the functionality of these classes for testing purposes?  Currently I'm using virtual functions, and in my test module, I'm deriving a mock class from the base \"production\" class, and overriding functionality as needed.</p>\n\n<p>Here's an example:</p>\n\n<p>Production.cpp</p>\n\n<pre><code>class Production {\nprotected:\n    int Servers = 0;\npublic:\n\n    virtual bool IsValInRegistry(const std::string&amp; regVal);\n};\n\nbool Production::IsValInRegistry(const std::string&amp; regVal)\n{\n    HRESULT hr = GOOD;\n    hr = WinSysCallToRegistry(regVal);\n\n    if (HR)\n        return true;\n    else\n        return false;\n}\n</code></pre>\n\n<p>Mock.cpp</p>\n\n<pre><code>class Mock : public Production {\npublic:\n    bool IsValInRegistry(const std::string&amp; regVal) override final;\n};\n\nMock::IsValInRegistry(const std::string&amp; regVal)\n{\n    return true;\n}\n</code></pre>\n\n<p>Is this a proper way forward?  I'm concerned if I introduce too many <code>virtual</code> functions, I may see a performance hit which I would like to avoid.  If this <code>virutal</code> model is not ideal, what's a good method?</p>\n"}, {"tags": ["c++", "ffmpeg", "h.264", "libavformat", "fmp4"], "answers": [{"comments": [{"owner": {"reputation": 600, "user_id": 2406949, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/k7bdN.png?s=128&g=1", "display_name": "PookyFan", "link": "https://stackoverflow.com/users/2406949/pookyfan"}, "edited": false, "score": 0, "creation_date": 1547108085, "post_id": 54121774, "comment_id": 95080108, "body": "&quot;The code supplied suggests otherwise to me&quot; - what part of my code suggests that, exactly? And how? Could you please give some more details?   &quot;mp4 will not work with annex b&quot; - But it works in case of MP4 file generated by ffmpeg tool..."}, {"owner": {"reputation": 27067, "user_id": 210785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a561cd4d29738e18d9e565a6265d86ac?s=128&d=identicon&r=PG", "display_name": "szatmary", "link": "https://stackoverflow.com/users/210785/szatmary"}, "reply_to_user": {"reputation": 600, "user_id": 2406949, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/k7bdN.png?s=128&g=1", "display_name": "PookyFan", "link": "https://stackoverflow.com/users/2406949/pookyfan"}, "edited": false, "score": 0, "creation_date": 1547108913, "post_id": 54121774, "comment_id": 95080500, "body": "Extradata is more than just sps/pps. It has a header, nalsizelength, etc. I don\u2019t see that in your code. Also ffmpeg will not write annex b to the mp4. That\u2019s why it works. You can look at the mdat ffmpeg produces, you will find no start codes."}, {"owner": {"reputation": 600, "user_id": 2406949, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/k7bdN.png?s=128&g=1", "display_name": "PookyFan", "link": "https://stackoverflow.com/users/2406949/pookyfan"}, "edited": false, "score": 0, "creation_date": 1547109330, "post_id": 54121774, "comment_id": 95080702, "body": "Ok, I&#39;ll double check with MP4 analysis tool when I get back home, but I&#39;m pretty sure that both MP4 files have identical avcc section and their mdat atoms contain NALs in AVCC format. But just to be extra sure I&#39;ll confirm it once more. For the time being, do you have any ideas how to improve my C++ code? Do I need to set extradata like for AVCC format? For now it&#39;s set to SPS and PPS content because that&#39;s how it should be done in case of Annex-B. I know there are more thing to set when it&#39;s AVCC format, but then again - my input format is Annex-B, not AVCC..."}], "tags": [], "owner": {"reputation": 27067, "user_id": 210785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a561cd4d29738e18d9e565a6265d86ac?s=128&d=identicon&r=PG", "display_name": "szatmary", "link": "https://stackoverflow.com/users/210785/szatmary"}, "is_accepted": false, "score": 0, "last_activity_date": 1547092719, "creation_date": 1547092719, "answer_id": 54121774, "question_id": 54119705, "link": "https://stackoverflow.com/questions/54119705/fragmented-mp4-problem-playing-in-browser/54121774#54121774", "title": "Fragmented MP4 - problem playing in browser", "body": "<blockquote>\n  <p>MP4 atoms for both files look very similiar (they have identical avcc\n  section for sure)</p>\n</blockquote>\n\n<p>Double check that, The code supplied suggests otherwise to me.</p>\n\n<blockquote>\n  <p>What's interesting (but not sure if it's of any importance), both\n  files have different NALs format than input file (RPI camera produces\n  video stream in Annex-B format, while output MP4 files contain NALs in\n  AVCC format... or at least it looks like it's the case when I compare\n  mdat atoms with input H264 data).</p>\n</blockquote>\n\n<p>It is very important, mp4 will not work with annex b.</p>\n"}, {"comments": [{"owner": {"reputation": 600, "user_id": 2406949, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/k7bdN.png?s=128&g=1", "display_name": "PookyFan", "link": "https://stackoverflow.com/users/2406949/pookyfan"}, "edited": false, "score": 0, "creation_date": 1547116272, "post_id": 54126519, "comment_id": 95084631, "body": "Are you sure I need to set it like this even though my input NAL format is Annex-B? According to my research, extradata format you suggest applies to AVCC NAL format (explained here for example: <a href=\"http://aviadr1.blogspot.com/2010/05/h264-extradata-partially-explained-for.html\" rel=\"nofollow noreferrer\">aviadr1.blogspot.com/2010/05/&hellip;</a> ). I know the output format is AVCC in my case, but if avcodec changed my NAL format during muxing, wouldn&#39;t it automatically convert extdata to correct format as well?"}, {"owner": {"reputation": 1, "user_id": 10894634, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e527c8dc7fc193e2ce459bd8404d2882?s=128&d=identicon&r=PG&f=1", "display_name": "Sokolio", "link": "https://stackoverflow.com/users/10894634/sokolio"}, "reply_to_user": {"reputation": 600, "user_id": 2406949, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/k7bdN.png?s=128&g=1", "display_name": "PookyFan", "link": "https://stackoverflow.com/users/2406949/pookyfan"}, "edited": false, "score": 0, "creation_date": 1547116616, "post_id": 54126519, "comment_id": 95084829, "body": "I&#39;m not sure. But perhaps you could take a look at the hex dump of your mp4 fragments and look for avcc atom. If its contents start with 0x01 then it means that ffmpeg managed to convert your SPS/PPS pair to AVCC."}], "tags": [], "owner": {"reputation": 1, "user_id": 10894634, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e527c8dc7fc193e2ce459bd8404d2882?s=128&d=identicon&r=PG&f=1", "display_name": "Sokolio", "link": "https://stackoverflow.com/users/10894634/sokolio"}, "is_accepted": false, "score": 0, "last_activity_date": 1547115719, "creation_date": 1547115719, "answer_id": 54126519, "question_id": 54119705, "link": "https://stackoverflow.com/questions/54119705/fragmented-mp4-problem-playing-in-browser/54126519#54126519", "title": "Fragmented MP4 - problem playing in browser", "body": "<p>You need to fill in extradata with AVC Decoder Configuration Record, not just SPS/PPS</p>\n\n<p>Here's how the record should look like:\n<a href=\"https://2.bp.blogspot.com/_wms31j0gPQQ/TNqkh6E2Y3I/AAAAAAAAASs/VWkiivpWBxg/s1600/avcdecoder.JPG\" rel=\"nofollow noreferrer\">AVCDCR</a></p>\n"}, {"tags": [], "owner": {"reputation": 600, "user_id": 2406949, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/k7bdN.png?s=128&g=1", "display_name": "PookyFan", "link": "https://stackoverflow.com/users/2406949/pookyfan"}, "is_accepted": true, "score": 3, "last_activity_date": 1547494910, "creation_date": 1547494910, "answer_id": 54188108, "question_id": 54119705, "link": "https://stackoverflow.com/questions/54119705/fragmented-mp4-problem-playing-in-browser/54188108#54188108", "title": "Fragmented MP4 - problem playing in browser", "body": "<p>I finally found the solution. My MP4 now plays in Chrome (while still playing in other tested browsers).</p>\n\n<p>In Chrome <a href=\"http://chrome://media-internals/\" rel=\"nofollow noreferrer\">chrome://media-internals/</a> shows MSE logs (of a sort). When I looked there, I found a few of following warnings for my test player:</p>\n\n<pre><code>ISO-BMFF container metadata for video frame indicates that the frame is not a keyframe, but the video frame contents indicate the opposite.\n</code></pre>\n\n<p>That made me think and encouraged to set <code>AV_PKT_FLAG_KEY</code> for packets with keyframes. I added following code to section with filling <code>AVPacket</code> structure:</p>\n\n<pre><code>    //Check if keyframe field needs to be set\n    int allowedNalsCount = 3; //In one packet there would be at most three NALs: SPS, PPS and video frame\n    packet.flags = 0;\n    for(int i = 0; i &lt; frameSize &amp;&amp; allowedNalsCount &gt; 0; ++i)\n    {\n        uint32_t *curr =  (uint32_t*)(frameBuffer + i);\n        if(*curr == synchMarker)\n        {\n            uint8_t nalType = frameBuffer[i + sizeof(uint32_t)] &amp; 0x1F;\n            if(nalType == KEYFRAME)\n            {\n                std::cout &lt;&lt; \"Keyframe detected at frame nr \" &lt;&lt; framesTotal &lt;&lt; std::endl;\n                packet.flags = AV_PKT_FLAG_KEY;\n                break;\n            }\n            else\n                i += sizeof(uint32_t) + 1; //We parsed this already, no point in doing it again\n\n            --allowedNalsCount;\n        }\n    }\n</code></pre>\n\n<p>A <code>KEYFRAME</code> constant turns out to be <code>0x5</code> in my case (Slice IDR).</p>\n"}, {"comments": [{"owner": {"reputation": 23880, "user_id": 1287812, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vw1Wj.jpg?s=128&g=1", "display_name": "brasofilo", "link": "https://stackoverflow.com/users/1287812/brasofilo"}, "edited": false, "score": 0, "creation_date": 1560307480, "post_id": 56553710, "comment_id": 99689118, "body": "Gemstone, it&#39;s better to post here what the link is about and what solution it gives. That link may be dead tomorrow and your answer loses all of its value. I took the liberty to copy the whole code block here (adding their top copyright notice). And if you can explain why this info is relevant, it&#39;d be super."}, {"owner": {"reputation": 23880, "user_id": 1287812, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vw1Wj.jpg?s=128&g=1", "display_name": "brasofilo", "link": "https://stackoverflow.com/users/1287812/brasofilo"}, "edited": false, "score": 0, "creation_date": 1560315770, "post_id": 56553710, "comment_id": 99690714, "body": "You can <a href=\"https://stackoverflow.com/posts/56553710/edit\">edit</a> your answer and incorporate this info, then we can clean our comments and all is fine and dandy (y)"}, {"owner": {"reputation": 600, "user_id": 2406949, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/k7bdN.png?s=128&g=1", "display_name": "PookyFan", "link": "https://stackoverflow.com/users/2406949/pookyfan"}, "edited": false, "score": 0, "creation_date": 1560690377, "post_id": 56553710, "comment_id": 99811505, "body": "That&#39;s cool gemstone, but shouldn&#39;t video play just fine even if there is a mismatch between keyframe-ness in MP4 metadata and AVC keyframe indicator? I see that is_keyframe variable is set to whatever AVC has to say about keyframe-ness, yet my video wouldn&#39;t play unless I set it manually so there would be no mismatch."}], "tags": [], "owner": {"reputation": 1, "user_id": 4365070, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hcKDCIC3_JQ/AAAAAAAAAAI/AAAAAAAAABE/d31ySOUKKe0/photo.jpg?sz=128", "display_name": "gemstone", "link": "https://stackoverflow.com/users/4365070/gemstone"}, "is_accepted": false, "score": 0, "last_activity_date": 1560339704, "last_edit_date": 1560339704, "creation_date": 1560304787, "answer_id": 56553710, "question_id": 54119705, "link": "https://stackoverflow.com/questions/54119705/fragmented-mp4-problem-playing-in-browser/56553710#56553710", "title": "Fragmented MP4 - problem playing in browser", "body": "<p>We can find this explanation in [Chrome Source] \n(<a href=\"https://chromium.googlesource.com/chromium/src/+/refs/heads/master/media/formats/mp4/mp4_stream_parser.cc#799\" rel=\"nofollow noreferrer\">https://chromium.googlesource.com/chromium/src/+/refs/heads/master/media/formats/mp4/mp4_stream_parser.cc#799</a>) \"chrome media source code\":</p>\n\n<pre><code>// Copyright 2014 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n\n  // Use |analysis.is_keyframe|, if it was actually determined, for logging\n  // if the analysis mismatches the container's keyframe metadata for\n  // |frame_buf|.\n  if (analysis.is_keyframe.has_value() &amp;&amp;\n      is_keyframe != analysis.is_keyframe.value()) {\n    LIMITED_MEDIA_LOG(DEBUG, media_log_, num_video_keyframe_mismatches_,\n                      kMaxVideoKeyframeMismatchLogs)\n        &lt;&lt; \"ISO-BMFF container metadata for video frame indicates that the \"\n           \"frame is \"\n        &lt;&lt; (is_keyframe ? \"\" : \"not \")\n        &lt;&lt; \"a keyframe, but the video frame contents indicate the \"\n           \"opposite.\";\n    // As of September 2018, it appears that all of Edge, Firefox, Safari\n    // work with content that marks non-avc-keyframes as a keyframe in the\n    // container. Encoders/muxers/old streams still exist that produce\n    // all-keyframe mp4 video tracks, though many of the coded frames are\n    // not keyframes (likely workaround due to the impact on low-latency\n    // live streams until https://crbug.com/229412 was fixed).  We'll trust\n    // the AVC frame's keyframe-ness over the mp4 container's metadata if\n    // they mismatch. If other out-of-order codecs in mp4 (e.g. HEVC, DV)\n    // implement keyframe analysis in their frame_bitstream_converter, we'll\n    // similarly trust that analysis instead of the mp4.\n    is_keyframe = analysis.is_keyframe.value();\n  }\n</code></pre>\n\n<p>As the code comment show, chrome trust the AVC frame's keyframe-ness over the mp4 container's metadata. So nalu type in H264/HEVC should be more important than mp4 container box sdtp &amp; trun description.</p>\n"}], "owner": {"reputation": 600, "user_id": 2406949, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/k7bdN.png?s=128&g=1", "display_name": "PookyFan", "link": "https://stackoverflow.com/users/2406949/pookyfan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3669, "favorite_count": 4, "accepted_answer_id": 54188108, "answer_count": 4, "score": 7, "last_activity_date": 1560339704, "creation_date": 1547075080, "last_edit_date": 1560307570, "question_id": 54119705, "link": "https://stackoverflow.com/questions/54119705/fragmented-mp4-problem-playing-in-browser", "title": "Fragmented MP4 - problem playing in browser", "body": "<p>I try to create fragmented MP4 from raw H264 video data so I could play it in internet browser's player. My goal is to create live streaming system, where media server would send fragmented MP4 pieces to browser. The server would buffer input data from RaspberryPi camera, which sends video as H264 frames. It would then mux that video data and make it available for client. The browser would play media data (that were muxed by server and sent i.e. through websocket) by using Media Source Extensions.</p>\n\n<p>For test purpose I wrote the following pieces of code (using many examples I found in the intenet):</p>\n\n<p><strong>C++ application using avcodec which muxes raw H264 video to fragmented MP4 and saves it to a file:</strong></p>\n\n<pre><code>#define READBUFSIZE 4096\n#define IOBUFSIZE 4096\n#define ERRMSGSIZE 128\n\n#include &lt;cstdint&gt;\n#include &lt;iostream&gt;\n#include &lt;fstream&gt;\n#include &lt;string&gt;\n#include &lt;vector&gt;\n\nextern \"C\"\n{\n    #include &lt;libavformat/avformat.h&gt;\n    #include &lt;libavutil/error.h&gt;\n    #include &lt;libavutil/opt.h&gt;\n}\n\nenum NalType : uint8_t\n{\n    //NALs containing stream metadata\n    SEQ_PARAM_SET = 0x7,\n    PIC_PARAM_SET = 0x8\n};\n\nstd::vector&lt;uint8_t&gt; outputData;\n\nint mediaMuxCallback(void *opaque, uint8_t *buf, int bufSize)\n{\n    outputData.insert(outputData.end(), buf, buf + bufSize);\n    return bufSize;\n}\n\nstd::string getAvErrorString(int errNr)\n{\n    char errMsg[ERRMSGSIZE];\n    av_strerror(errNr, errMsg, ERRMSGSIZE);\n    return std::string(errMsg);\n}\n\nint main(int argc, char **argv)\n{\n    if(argc &lt; 2)\n    {\n        std::cout &lt;&lt; \"Missing file name\" &lt;&lt; std::endl;\n        return 1;\n    }\n\n    std::fstream file(argv[1], std::ios::in | std::ios::binary);\n    if(!file.is_open())\n    {\n        std::cout &lt;&lt; \"Couldn't open file \" &lt;&lt; argv[1] &lt;&lt; std::endl;\n        return 2;\n    }\n\n    std::vector&lt;uint8_t&gt; inputMediaData;\n    do\n    {\n        char buf[READBUFSIZE];\n        file.read(buf, READBUFSIZE);\n\n        int size = file.gcount();\n        if(size &gt; 0)\n            inputMediaData.insert(inputMediaData.end(), buf, buf + size);\n    } while(!file.eof());\n    file.close();\n\n    //Initialize avcodec\n    av_register_all();\n    uint8_t *ioBuffer;\n    AVCodec *codec = avcodec_find_decoder(AV_CODEC_ID_H264);\n    AVCodecContext *codecCtxt = avcodec_alloc_context3(codec);\n    AVCodecParserContext *parserCtxt = av_parser_init(AV_CODEC_ID_H264);\n    AVOutputFormat *outputFormat = av_guess_format(\"mp4\", nullptr, nullptr);\n    AVFormatContext *formatCtxt;\n    AVIOContext *ioCtxt;\n    AVStream *videoStream;\n\n    int res = avformat_alloc_output_context2(&amp;formatCtxt, outputFormat, nullptr, nullptr);\n    if(res &lt; 0)\n    {\n        std::cout &lt;&lt; \"Couldn't initialize format context; the error was: \" &lt;&lt; getAvErrorString(res) &lt;&lt; std::endl;\n        return 3;\n    }\n\n    if((videoStream = avformat_new_stream( formatCtxt, avcodec_find_encoder(formatCtxt-&gt;oformat-&gt;video_codec) )) == nullptr)\n    {\n        std::cout &lt;&lt; \"Couldn't initialize video stream\" &lt;&lt; std::endl;\n        return 4;\n    }\n    else if(!codec)\n    {\n        std::cout &lt;&lt; \"Couldn't initialize codec\" &lt;&lt; std::endl;\n        return 5;\n    }\n    else if(codecCtxt == nullptr)\n    {\n        std::cout &lt;&lt; \"Couldn't initialize codec context\" &lt;&lt; std::endl;\n        return 6;\n    }\n    else if(parserCtxt == nullptr)\n    {\n        std::cout &lt;&lt; \"Couldn't initialize parser context\" &lt;&lt; std::endl;\n        return 7;\n    }\n    else if((ioBuffer = (uint8_t*)av_malloc(IOBUFSIZE)) == nullptr)\n    {\n        std::cout &lt;&lt; \"Couldn't allocate I/O buffer\" &lt;&lt; std::endl;\n        return 8;\n    }\n    else if((ioCtxt = avio_alloc_context(ioBuffer, IOBUFSIZE, 1, nullptr, nullptr, mediaMuxCallback, nullptr)) == nullptr)\n    {\n        std::cout &lt;&lt; \"Couldn't initialize I/O context\" &lt;&lt; std::endl;\n        return 9;\n    }\n\n    //Set video stream data\n    videoStream-&gt;id = formatCtxt-&gt;nb_streams - 1;\n    videoStream-&gt;codec-&gt;width = 1280;\n    videoStream-&gt;codec-&gt;height = 720;\n    videoStream-&gt;time_base.den = 60; //FPS\n    videoStream-&gt;time_base.num = 1;\n    videoStream-&gt;codec-&gt;flags |= CODEC_FLAG_GLOBAL_HEADER;\n    formatCtxt-&gt;pb = ioCtxt;\n\n    //Retrieve SPS and PPS for codec extdata\n    const uint32_t synchMarker = 0x01000000;\n    unsigned int i = 0;\n    int spsStart = -1, ppsStart = -1;\n    uint16_t spsSize = 0, ppsSize = 0;\n    while(spsSize == 0 || ppsSize == 0)\n    {\n        uint32_t *curr =  (uint32_t*)(inputMediaData.data() + i);\n        if(*curr == synchMarker)\n        {\n            unsigned int currentNalStart = i;\n            i += sizeof(uint32_t);\n            uint8_t nalType = inputMediaData.data()[i] &amp; 0x1F;\n            if(nalType == SEQ_PARAM_SET)\n                spsStart = currentNalStart;\n            else if(nalType == PIC_PARAM_SET)\n                ppsStart = currentNalStart;\n\n            if(spsStart &gt;= 0 &amp;&amp; spsSize == 0 &amp;&amp; spsStart != i)\n                spsSize = currentNalStart - spsStart;\n            else if(ppsStart &gt;= 0 &amp;&amp; ppsSize == 0 &amp;&amp; ppsStart != i)\n                ppsSize = currentNalStart - ppsStart;\n        }\n        ++i;\n    }\n\n    videoStream-&gt;codec-&gt;extradata = inputMediaData.data() + spsStart;\n    videoStream-&gt;codec-&gt;extradata_size = ppsStart + ppsSize;\n\n    //Write main header\n    AVDictionary *options = nullptr;\n    av_dict_set(&amp;options, \"movflags\", \"frag_custom+empty_moov\", 0);\n    res = avformat_write_header(formatCtxt, &amp;options);\n    if(res &lt; 0)\n    {\n        std::cout &lt;&lt; \"Couldn't write container main header; the error was: \" &lt;&lt; getAvErrorString(res) &lt;&lt; std::endl;\n        return 10;\n    }\n\n    //Retrieve frames from input video and wrap them in container\n    int currentInputIndex = 0;\n    int framesInSecond = 0;\n    while(currentInputIndex &lt; inputMediaData.size())\n    {\n        uint8_t *frameBuffer;\n        int frameSize;\n        res = av_parser_parse2(parserCtxt, codecCtxt, &amp;frameBuffer, &amp;frameSize, inputMediaData.data() + currentInputIndex,\n            inputMediaData.size() - currentInputIndex, AV_NOPTS_VALUE, AV_NOPTS_VALUE, 0);\n        if(frameSize == 0) //No more frames while some data still remains (is that even possible?)\n        {\n            std::cout &lt;&lt; \"Some data left unparsed: \" &lt;&lt; std::to_string(inputMediaData.size() - currentInputIndex) &lt;&lt; std::endl;\n            break;\n        }\n\n        //Prepare packet with video frame to be dumped into container\n        AVPacket packet;\n        av_init_packet(&amp;packet);\n        packet.data = frameBuffer;\n        packet.size = frameSize;\n        packet.stream_index = videoStream-&gt;index;\n        currentInputIndex += frameSize;\n\n        //Write packet to the video stream\n        res = av_write_frame(formatCtxt, &amp;packet);\n        if(res &lt; 0)\n        {\n            std::cout &lt;&lt; \"Couldn't write packet with video frame; the error was: \" &lt;&lt; getAvErrorString(res) &lt;&lt; std::endl;\n            return 11;\n        }\n\n        if(++framesInSecond == 60) //We want 1 segment per second\n        {\n            framesInSecond = 0;\n            res = av_write_frame(formatCtxt, nullptr); //Flush segment\n        }\n    }\n    res = av_write_frame(formatCtxt, nullptr); //Flush if something has been left\n\n    //Write media data in container to file\n    file.open(\"my_mp4.mp4\", std::ios::out | std::ios::binary);\n    if(!file.is_open())\n    {\n        std::cout &lt;&lt; \"Couldn't open output file \" &lt;&lt; std::endl;\n        return 12;\n    }\n\n    file.write((char*)outputData.data(), outputData.size());\n    if(file.fail())\n    {\n        std::cout &lt;&lt; \"Couldn't write to file\" &lt;&lt; std::endl;\n        return 13;\n    }\n\n    std::cout &lt;&lt; \"Media file muxed successfully\" &lt;&lt; std::endl;\n    return 0;\n}\n</code></pre>\n\n<p>(I hardcoded a few values, such as video dimensions or framerate, but as I said this is just a test code.)</p>\n\n<hr>\n\n<p><strong>Simple HTML webpage using MSE to play my fragmented MP4</strong></p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Test strumienia&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;video width=\"1280\" height=\"720\" controls&gt;\n    &lt;/video&gt;\n&lt;/body&gt;\n&lt;script&gt;\nvar vidElement = document.querySelector('video');\n\nif (window.MediaSource) {\n  var mediaSource = new MediaSource();\n  vidElement.src = URL.createObjectURL(mediaSource);\n  mediaSource.addEventListener('sourceopen', sourceOpen);\n} else {\n  console.log(\"The Media Source Extensions API is not supported.\")\n}\n\nfunction sourceOpen(e) {\n  URL.revokeObjectURL(vidElement.src);\n  var mime = 'video/mp4; codecs=\"avc1.640028\"';\n  var mediaSource = e.target;\n  var sourceBuffer = mediaSource.addSourceBuffer(mime);\n  var videoUrl = 'my_mp4.mp4';\n  fetch(videoUrl)\n    .then(function(response) {\n      return response.arrayBuffer();\n    })\n    .then(function(arrayBuffer) {\n      sourceBuffer.addEventListener('updateend', function(e) {\n        if (!sourceBuffer.updating &amp;&amp; mediaSource.readyState === 'open') {\n          mediaSource.endOfStream();\n        }\n      });\n      sourceBuffer.appendBuffer(arrayBuffer);\n    });\n}\n&lt;/script&gt;\n&lt;/html&gt;\n</code></pre>\n\n<hr>\n\n<p>Output MP4 file generated by my C++ application can be played i.e. in MPC, but it doesn't play in any web browser I tested it with. It also doesn't have any duration (MPC keeps showing 00:00).</p>\n\n<p>To compare output MP4 file I got from my C++ application described above, I also used FFMPEG to create fragmented MP4 file from the same source file with raw H264 stream. I used the following command:</p>\n\n<pre><code>ffmpeg -r 60 -i input.h264 -c:v copy -f mp4 -movflags empty_moov+default_base_moof+frag_keyframe test.mp4\n</code></pre>\n\n<p>This file generated by FFMPEG is played correctly by every web browser I used for tests. It also has correct duration (but also it has trailing atom, which wouldn't be present in my live stream anyway, and as I need a live stream, it won't have any fixed duration in the first place).</p>\n\n<p>MP4 atoms for both files look very similiar (they have identical avcc section for sure). What's interesting (but not sure if it's of any importance), both files have different NALs format than input file (RPI camera produces video stream in Annex-B format, while output MP4 files contain NALs in AVCC format... or at least it looks like it's the case when I compare mdat atoms with input H264 data).</p>\n\n<p>I assume there is some field (or a few fields) I need to set for avcodec to make it produce video stream that would be properly decoded and played by browsers players. But what field(s) do I need to set? Or maybe problem lies somewhere else? I ran out of ideas.</p>\n\n<hr>\n\n<p><strong>EDIT 1:</strong>\nAs suggested, I investigated binary content of both MP4 files (generated by my app and FFMPEG tool) with hex editor. What I can confirm:</p>\n\n<ul>\n<li>both files have identical avcc section (they match perfectly and are in AVCC format, I analyzed it byte after byte and there's no mistake about it)</li>\n<li>both files have NALs in AVCC format (I looked closely at mdat atoms and they don't differ between both MP4 files)</li>\n</ul>\n\n<p>So I guess there's nothing wrong with the extradata creation in my code - avcodec takes care of it properly, even if I just feed it with SPS and PPS NALs. It converts them by itself, so no need for me to do it by hand. Still, my original problem remains.</p>\n\n<p><strong>EDIT 2:</strong> I achieved partial success - MP4 generated by my app now plays in Firefox. I added this line to the code (along with rest of stream initialization):</p>\n\n<pre><code>videoStream-&gt;codec-&gt;time_base = videoStream-&gt;time_base;\n</code></pre>\n\n<p>So now this section of my code looks like this:</p>\n\n<pre><code>//Set video stream data\nvideoStream-&gt;id = formatCtxt-&gt;nb_streams - 1;\nvideoStream-&gt;codec-&gt;width = 1280;\nvideoStream-&gt;codec-&gt;height = 720;\nvideoStream-&gt;time_base.den = 60; //FPS\nvideoStream-&gt;time_base.num = 1;\nvideoStream-&gt;codec-&gt;time_base = videoStream-&gt;time_base;\nvideoStream-&gt;codec-&gt;flags |= CODEC_FLAG_GLOBAL_HEADER;\nformatCtxt-&gt;pb = ioCtxt;\n</code></pre>\n"}, {"tags": ["c++", "string", "count", "int"], "comments": [{"owner": {"reputation": 1983, "user_id": 10824655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tzkaE.jpg?s=128&g=1", "display_name": "chronoxor", "link": "https://stackoverflow.com/users/10824655/chronoxor"}, "edited": false, "score": 3, "creation_date": 1547074339, "post_id": 54119546, "comment_id": 95071646, "body": "try size_t dlus1 = dlus.size();"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 2, "creation_date": 1547074520, "post_id": 54119546, "comment_id": 95071699, "body": "If this compiles you probably need to turn on <code>-Wall</code> because assigning a number to a string is not a valid operation."}, {"owner": {"reputation": 52656, "user_id": 225074, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/dea26ac1ef8259140d28aa8b5ba4f1b3?s=128&d=identicon&r=PG", "display_name": "Thomas Matthews", "link": "https://stackoverflow.com/users/225074/thomas-matthews"}, "edited": false, "score": 0, "creation_date": 1547074527, "post_id": 54119546, "comment_id": 95071700, "body": "Since <code>string::size()</code> returns a number, not a string, you could try something like: <code>string dlus1 = to_string(dlus.size());</code>"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "reply_to_user": {"reputation": 123967, "user_id": 251153, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/4b25144c09555e7d5b5e288469e011ef?s=128&d=identicon&r=PG", "display_name": "zneak", "link": "https://stackoverflow.com/users/251153/zneak"}, "edited": false, "score": 0, "creation_date": 1547074641, "post_id": 54119546, "comment_id": 95071732, "body": "@zneak clang gives me &quot;error: no viable conversion&quot; for that assignment of <code>size()</code> to <code>std::string</code>."}, {"owner": {"reputation": 1983, "user_id": 10824655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tzkaE.jpg?s=128&g=1", "display_name": "chronoxor", "link": "https://stackoverflow.com/users/10824655/chronoxor"}, "edited": false, "score": 1, "creation_date": 1547074670, "post_id": 54119546, "comment_id": 95071740, "body": "<a href=\"https://stackoverflow.com/questions/22648978/c-how-to-find-the-length-of-an-integer\" title=\"c how to find the length of an integer\">stackoverflow.com/questions/22648978/&hellip;</a>"}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 0, "creation_date": 1547075902, "post_id": 54119546, "comment_id": 95072069, "body": "And <a href=\"https://clang.llvm.org/extra/clang-tidy/checks/bugprone-string-integer-assignment.html\" rel=\"nofollow noreferrer\">clang.llvm.org/extra/clang-tidy/checks/&hellip;</a>"}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 0, "creation_date": 1547076455, "post_id": 54119546, "comment_id": 95072204, "body": "What compiler gave this result? I can&#39;t reproduce this on gcc, clang and VS. I did see some conversions from int to char, but with +=."}], "answers": [{"tags": [], "owner": {"reputation": 1983, "user_id": 10824655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tzkaE.jpg?s=128&g=1", "display_name": "chronoxor", "link": "https://stackoverflow.com/users/10824655/chronoxor"}, "is_accepted": true, "score": 2, "last_activity_date": 1547075058, "last_edit_date": 1547075058, "creation_date": 1547074863, "answer_id": 54119673, "question_id": 54119546, "link": "https://stackoverflow.com/questions/54119546/string-length-or-string-size-returns-number-with-x-x5/54119673#54119673", "title": "String.length() or String.size() returns number with &quot;\\x&quot; (\\x5)", "body": "<p>I believe you want something like this:</p>\n\n<pre><code>int main()\n{\n    int number = 703;\n    size_t count = std::to_string(number).length();\n    std::cout &lt;&lt; count;\n}\n</code></pre>\n\n<p>But this is duplicate question. More info you can find here: <a href=\"https://stackoverflow.com/questions/22648978/c-how-to-find-the-length-of-an-integer\">C++ - how to find the length of an integer</a></p>\n"}, {"tags": [], "owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "is_accepted": false, "score": 1, "last_activity_date": 1547076776, "creation_date": 1547076776, "answer_id": 54119996, "question_id": 54119546, "link": "https://stackoverflow.com/questions/54119546/string-length-or-string-size-returns-number-with-x-x5/54119996#54119996", "title": "String.length() or String.size() returns number with &quot;\\x&quot; (\\x5)", "body": "<p>To add to the explanation here, as what is happening. First, I could not reproduce your issue, but I have a variation that doesn't warn on clang and gcc but is still not what you want:</p>\n\n<pre><code>std::string dlus = std::to_string(roz);\ndlus += dlus.size();\n</code></pre>\n\n<p>Here, it uses an available overload:</p>\n\n<pre><code>basic_string&amp; operator+=( CharT ch );\n</code></pre>\n\n<p>and it converts the integer silently to a char. Even with <code>-Wall</code>, it is not tagged as bad.</p>\n\n<p>Now, that's where <a href=\"https://clang.llvm.org/extra/clang-tidy/checks/bugprone-string-integer-assignment.html\" rel=\"nofollow noreferrer\">clang-tidy comes in</a>. With this rule, this code is flagged as possibly wrong, and it indicates that you should use <code>std::to_string</code> to properly convert the number to a string before appending it.</p>\n\n<p>If we know which compiler you were using, then we can also figure out which constructor was used in this instance.</p>\n"}], "owner": {"reputation": 21, "user_id": 10892382, "user_type": "registered", "profile_image": "https://graph.facebook.com/2166689036686863/picture?type=large", "display_name": "Mateusz Paszko", "link": "https://stackoverflow.com/users/10892382/mateusz-paszko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "accepted_answer_id": 54119673, "answer_count": 2, "score": -1, "last_activity_date": 1547076776, "creation_date": 1547074244, "last_edit_date": 1547075990, "question_id": 54119546, "link": "https://stackoverflow.com/questions/54119546/string-length-or-string-size-returns-number-with-x-x5", "title": "String.length() or String.size() returns number with &quot;\\x&quot; (\\x5)", "body": "<p>I was trying to get number of characters in my <code>int</code> value. In order to due so I have converted <code>int</code> to <code>string</code> and took <code>.length()</code>. Conversion from <code>int</code> to <code>string</code> looks good, but when I check value of <code>.length()</code> seems like there is additional char (console shows that there is value \"\\x5\"). Do you know where there could be an issue? </p>\n\n<p>I tried to <code>.size()</code> as well, same results. I used this function before (<code>.length()</code>) and actually I have received correct results.</p>\n\n<pre><code>int main() {\n\nint roz = 703;\n\nstring dlus = to_string(roz);\n\nstring dlus1 = dlus.size();\n\nint dlu = atoi(dlus1.c_str());\n\n}\n</code></pre>\n\n<p>Results:</p>\n\n<pre><code>dlus1 = \"3\" \n\ndlu = \"3\"\n</code></pre>\n"}, {"tags": ["c++", "lambda"], "comments": [{"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1547074393, "post_id": 54119543, "comment_id": 95071669, "body": "It&#39;s not being computed, its being passed to <code>var_in_box</code>.  You need to look at that code to see how it is used."}, {"owner": {"reputation": 5676, "user_id": 5023438, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uvlov.jpg?s=128&g=1", "display_name": "alter igel", "link": "https://stackoverflow.com/users/5023438/alter-igel"}, "edited": false, "score": 0, "creation_date": 1547074455, "post_id": 54119543, "comment_id": 95071681, "body": "<code>x_is_valid</code> is a <i>functor</i>, that is, it&#39;s an object that overloads the function call operator <code>operator()</code>. It can be passed around like any other object. Here&#39;s a good read about what lambdas are and how they work: <a href=\"https://stackoverflow.com/questions/7627098/what-is-a-lambda-expression-in-c11\" title=\"what is a lambda expression in c11\">stackoverflow.com/questions/7627098/&hellip;</a>"}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1547074465, "post_id": 54119543, "comment_id": 95071685, "body": "Also see: <a href=\"https://stackoverflow.com/questions/356950/what-are-c-functors-and-their-uses\" title=\"what are c functors and their uses\">stackoverflow.com/questions/356950/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 196207, "user_id": 434551, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/8Wzl8.png?s=128&g=1", "display_name": "R Sahu", "link": "https://stackoverflow.com/users/434551/r-sahu"}, "is_accepted": false, "score": 0, "last_activity_date": 1547074578, "creation_date": 1547074578, "answer_id": 54119624, "question_id": 54119543, "link": "https://stackoverflow.com/questions/54119543/c-input-of-a-lambda-expression/54119624#54119624", "title": "c++: input of a lambda expression", "body": "<p>If <code>var_.var_in_box</code>, expects a <code>bool</code> as the last argument, then the call</p>\n\n<pre><code>auto objects = var_.var_in_box(*a, b, c, x_is_valid);\n</code></pre>\n\n<p>should result in a compile error.</p>\n\n<p>If the above line compiles without any error, then the last argument type of the above is a callable object, not a <code>bool</code>. Presumably, the function uses the passed in callable object to make a function call. It's not possible to determine from the posted code how the callable is called in the implementation of <code>var_in_box</code> member function of the class.</p>\n"}, {"tags": [], "owner": {"reputation": 22818, "user_id": 509868, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/83450238b4ee0eddbf54d7ce5a3a64e4?s=128&d=identicon&r=PG", "display_name": "anatolyg", "link": "https://stackoverflow.com/users/509868/anatolyg"}, "is_accepted": false, "score": 2, "last_activity_date": 1547074641, "creation_date": 1547074641, "answer_id": 54119636, "question_id": 54119543, "link": "https://stackoverflow.com/questions/54119543/c-input-of-a-lambda-expression/54119636#54119636", "title": "c++: input of a lambda expression", "body": "<p>A mathematical analogy might help. Imagine a function <code>f(x) = x^2</code>.</p>\n\n<blockquote>\n  <p>How is <code>f</code> computed?</p>\n</blockquote>\n\n<p>It's right there: for any <code>x</code>, the formula for computing is <code>f(x) = x^2</code>.</p>\n\n<blockquote>\n  <p>Where does it take its input parameter?</p>\n</blockquote>\n\n<p>From the caller.</p>\n\n<p>The \"answers\" above are pretty pointless, but if you understand them in a context of a function in a mathematical sense, they might be helpful.</p>\n"}], "owner": {"reputation": 17078, "user_id": 3993270, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/1bee661ad7451ff3107ca6954560a06c?s=128&d=identicon&r=PG&f=1", "display_name": "Edamame", "link": "https://stackoverflow.com/users/3993270/edamame"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1547074641, "creation_date": 1547074236, "last_edit_date": 1547074390, "question_id": 54119543, "link": "https://stackoverflow.com/questions/54119543/c-input-of-a-lambda-expression", "title": "c++: input of a lambda expression", "body": "<p>I have the following code:</p>\n\n<pre><code>auto x_is_valid = [](const MyX &amp;x) -&gt; bool {\n    return x.source != MyXValue::ABC;\n};\n\nauto objects = var_.var_in_box(*a, b, c, x_is_valid);\n</code></pre>\n\n<p>I am wondering:</p>\n\n<ul>\n<li>How is <code>x_is_valid</code> computed?</li>\n<li>Where does it take its input parameter?</li>\n</ul>\n\n<p>How do I read this properly?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["c++", "overloading", "crtp"], "answers": [{"comments": [{"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 0, "creation_date": 1547075131, "post_id": 54119571, "comment_id": 95071867, "body": "Note that free function as <code>PrintTo</code> can also lead to subtle bugs, with ADL and ODR. See <a href=\"https://stackoverflow.com/questions/24673515/googletest-printto-not-getting-called-for-a-class\">googletest-printto-not-getting-called-for-a-class</a>. Each way has its pros and cons."}, {"owner": {"reputation": 4411, "user_id": 751579, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/iux9g.png?s=128&g=1", "display_name": "davidbak", "link": "https://stackoverflow.com/users/751579/davidbak"}, "reply_to_user": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 0, "creation_date": 1547075399, "post_id": 54119571, "comment_id": 95071939, "body": "@Jarod42 - well it turns out, after I refreshed myself on the documentation - that for GoogleTest <code>PrintTo</code> isn&#39;t a free function, it&#39;s a member function.  But yes, there could be problems as a free function.  I myself would make it a free function <i>in a specific namespace</i> since there&#39;s no problem extending any namespace (except <code>std</code>) whenever you want.  Would you see a problem with that?"}, {"owner": {"reputation": 4411, "user_id": 751579, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/iux9g.png?s=128&g=1", "display_name": "davidbak", "link": "https://stackoverflow.com/users/751579/davidbak"}, "reply_to_user": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 0, "creation_date": 1547075602, "post_id": 54119571, "comment_id": 95071988, "body": "@Jarod42 - also in your linked answer (nice one BTW) I think that code he was having difficulty with wasn&#39;t due to PrintTo being free - it was with violating ODR - which could happen regardless.  As we&#39;re on the subject, BTW, does any IDE diagnose that?  (As the IDE typically has a full-program view or at least wide-program-view even if the compiler does not.)"}, {"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 0, "creation_date": 1547075970, "post_id": 54119571, "comment_id": 95072089, "body": "My point is that ODR violation is easy to have with free functions for multiple overload as we have to guaranty that the same overloads are seen in different point of instantiation. Detecting that is hard: linker might compare the &quot;same&quot; function in different obj to see if they are really identical, but with inlined code, it seems it is too late..."}, {"owner": {"reputation": 4411, "user_id": 751579, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/iux9g.png?s=128&g=1", "display_name": "davidbak", "link": "https://stackoverflow.com/users/751579/davidbak"}, "reply_to_user": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 0, "creation_date": 1547076113, "post_id": 54119571, "comment_id": 95072108, "body": "@Jarod42 - and I guess my point would be the OP asked for alternatives in addition to getting his approach to work, and I think this alternative has advantages - such as, being lighter weight (IMO).  Also, I rarely find ODR problems in practice (only once or twice in someone else&#39;s code, ever, though it certainly was confusing) but YMMV!"}], "tags": [], "owner": {"reputation": 4411, "user_id": 751579, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/iux9g.png?s=128&g=1", "display_name": "davidbak", "link": "https://stackoverflow.com/users/751579/davidbak"}, "is_accepted": false, "score": 2, "last_activity_date": 1547075691, "last_edit_date": 1547075691, "creation_date": 1547074334, "answer_id": 54119571, "question_id": 54119501, "link": "https://stackoverflow.com/questions/54119501/is-the-curiously-recurring-template-pattern-crtp-the-right-solution-here/54119571#54119571", "title": "Is the Curiously Recurring Template Pattern (CRTP) the right solution here?", "body": "<p>Why not use free functions, e.g., <code>operator&lt;&lt;</code>, defined on your type and the logger's stream output type, or just functions that are called if visible?  For an example of how to do this: googletest is written so that it all of the assertions can be customized this way by you providing serialization methods. See <a href=\"https://github.com/google/googletest/blob/master/googletest/docs/advanced.md#teaching-googletest-how-to-print-your-values\" rel=\"nofollow noreferrer\">Teaching Googletest How To Print Your Values</a> and then you can look in the implementation to see how they do it.</p>\n\n<p>(Notice that googletest has too methods: you can provide a <code>PrintTo()</code> method in your class or you can overload <code>operator&lt;&lt;</code>, with <code>PrintTo()</code> preferred if both are available.  This has the advantage that you can serialize to logging <em>differently</em> than serializing to typical output streams (e.g., you already have an <code>operator&lt;&lt;</code> for your class that doesn't do what you want for logs).</p>\n\n<p>(The magic is all contained in <a href=\"https://github.com/google/googletest/blob/50f1a77955bde27cf49173c4133688d61f201e85/googletest/include/gtest/gtest-printers.h\" rel=\"nofollow noreferrer\">gtest-printer.h</a> - see <code>class UniversalPrinter</code> at <a href=\"https://github.com/google/googletest/blob/50f1a77955bde27cf49173c4133688d61f201e85/googletest/include/gtest/gtest-printers.h#L685\" rel=\"nofollow noreferrer\">line 685</a> for the trigger.)</p>\n\n<p>This also sas the advantage that it is very easy to add any class/struct/object to be logged properly without even going to the bother of extending the logging class.  Furthermore ... what happens if someone extends the logger class (i.e., derives from it) to serialize class <code>AAA</code>, and in a different piece of code there is a different derivation to serialize class <code>BBB</code> and then finally you write some code where you'd like to log both <code>AAA</code>s and <code>BBB</code>s?  The derived class approach doesn't work so well there ...</p>\n"}, {"comments": [{"owner": {"reputation": 420, "user_id": 3738870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/190425893cffeaa9db58f472ef15b111?s=128&d=identicon&r=PG&f=1", "display_name": "user3738870", "link": "https://stackoverflow.com/users/3738870/user3738870"}, "edited": false, "score": 1, "creation_date": 1547074815, "post_id": 54119582, "comment_id": 95071782, "body": "Does this pattern have a name by the way?"}], "tags": [], "owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "is_accepted": true, "score": 5, "last_activity_date": 1547075255, "last_edit_date": 1547075255, "creation_date": 1547074387, "answer_id": 54119582, "question_id": 54119501, "link": "https://stackoverflow.com/questions/54119501/is-the-curiously-recurring-template-pattern-crtp-the-right-solution-here/54119582#54119582", "title": "Is the Curiously Recurring Template Pattern (CRTP) the right solution here?", "body": "<p>How about the other way:</p>\n\n<pre><code>template &lt;typename ...Ts&gt;\nclass Logger : private Ts...\n{\npublic:\n    using Ts::write...;\n\n    void write(int x) { /*...*/ }\n    void write(double x) { /*...*/ }\n    // ...\n\n    template &lt;typename T&gt;\n    void writeLine(T x) { write(x); /*...*/ }\n    // ...\n};\n\nclass FooWriter\n{\npublic:\n    void write(FooType1 x) { /*...*/ }\n    void write(FooType2 x) { /*...*/ }\n};\nusing FooLogger = Logger&lt;FooWriter&gt;;\n</code></pre>\n\n<p>And then use any of (or their aliases):</p>\n\n<p><code>Logger&lt;&gt;</code> or <code>Logger&lt;FooWriter&gt;</code> or <code>Logger&lt;FooWriter, BarWriter&gt;</code>...</p>\n"}], "owner": {"reputation": 5448, "user_id": 1160124, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/83ece50530e2901f15da5d0e755deb46?s=128&d=identicon&r=PG", "display_name": "smls", "link": "https://stackoverflow.com/users/1160124/smls"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 1, "accepted_answer_id": 54119582, "answer_count": 2, "score": 4, "last_activity_date": 1547075691, "creation_date": 1547073963, "question_id": 54119501, "link": "https://stackoverflow.com/questions/54119501/is-the-curiously-recurring-template-pattern-crtp-the-right-solution-here", "title": "Is the Curiously Recurring Template Pattern (CRTP) the right solution here?", "body": "\n\n<h2>Scenario</h2>\n\n<p>Consider a class <code>Logger</code> which has a member function <code>write()</code> overloaded for standard C++ types, and also has some convenience function-templates like <code>writeLine()</code> which internally call <code>write()</code>:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>class Logger {\n  public:\n    void write(int x) { ... }\n    void write(double x) { ... }\n    ...\n\n    template &lt;typename T&gt;\n    void writeLine(T x) { write(x); ... }\n    ...\n};\n</code></pre>\n\n<p>Consider further a subclass <code>FooLogger</code> which adds additional <code>write()</code> overloads for domain-specifc types (let's call two of them <code>FooType1</code> and <code>FooType2</code>):</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>class FooLogger : public Logger {\n  public:\n    using Logger::write;\n\n    void write(FooType1 x) { ... }\n    void write(FooType2 x) { ... }\n    ...\n};\n</code></pre>\n\n<p>(<a href=\"https://ideone.com/pmj0fb\" rel=\"nofollow noreferrer\">self-contained example program at Ideone</a>)</p>\n\n<h2>Problem</h2>\n\n<p><code>FooLogger::write()</code>, when called directly, now supports any argument for which <em>either</em> of the two classes provides an overload.</p>\n\n<p>However, <code>FooLogger::writeLine()</code> only supports the argument types for which class <code>Logger</code> has a <code>write()</code> overload... it does not see the additional <code>write()</code> overloads declared in class <code>FooLogger</code>.</p>\n\n<p>I <em>want</em> it to see them though, so that it can be called with those argument types as well!</p>\n\n<h2>Current solution</h2>\n\n<p>I got it to work using the Curiously Recurring Template Pattern (CRTP):</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>template &lt;typename TDerivedClass&gt;\nclass AbstractLogger {\n    ...\n\n    template &lt;typename T&gt;\n    void writeLine(T x) { static_cast&lt;TDerivedClass*&gt;(this)-&gt;write(x); ... }\n};\n\nclass Logger : AbstractLogger {}\n\n\nclass FooLogger : public AbstractLogger&lt;FooLogger&gt; {\n    ...\n};\n</code></pre>\n\n<p>(<a href=\"https://ideone.com/nyTliy\" rel=\"nofollow noreferrer\">self-contained example program at Ideone</a>)</p>\n\n<p>While it does the job, it came at the cost of increased code complexity and vebosity:</p>\n\n<ol>\n<li>It made the implementation of the base class significantly harder to read (see the Ideone link), and harder to maintain (mustn't forget to do the <code>static_cast</code> dance wherever appropriate when adding more code to the class in the future!)</li>\n<li>It required separating <code>AbstractLogger</code> and <code>Logger</code> into two classes.</li>\n<li>Because the base-class is now a class template, the implementations of all its member functions must now be included in the header (rather than the <code>.cpp</code> file) - even the ones that do not need to do the <code>static_cast</code> thing.</li>\n</ol>\n\n<h2>Question</h2>\n\n<p>Considering the above, I'm seeking insight from people with C++ experience:</p>\n\n<ul>\n<li>Is CRTP the right tool for this job?</li>\n<li>Is there another way to solve this?</li>\n</ul>\n"}, {"tags": ["c++", "visual-studio"], "answers": [{"tags": [], "owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "is_accepted": false, "score": 3, "last_activity_date": 1547074527, "creation_date": 1547074527, "answer_id": 54119614, "question_id": 54119493, "link": "https://stackoverflow.com/questions/54119493/including-images-with-project/54119614#54119614", "title": "Including images with project", "body": "<p>You can embed an arbitrary file into the resources of your EXE by adding a <a href=\"https://docs.microsoft.com/en-us/cpp/windows/resource-files-visual-studio?view=vs-2017\" rel=\"nofollow noreferrer\">Resource file</a> to your project. Then you can access the resource data at runtime using <code>FindResource()</code>/<code>LoadResource()</code>/<code>LockResource()</code> and write the data to a file of your choosing on the PC using whatever API you want (<code>CreateFile()</code>/<code>WriteFile()</code>, <code>std::ofstream</code>, etc)</p>\n"}, {"tags": [], "owner": {"reputation": 1629, "user_id": 5530486, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/2232f4e1883ede4d6723ba40dd3bf8e2?s=128&d=identicon&r=PG&f=1", "display_name": "daedsidog", "link": "https://stackoverflow.com/users/5530486/daedsidog"}, "is_accepted": false, "score": 2, "last_activity_date": 1547075154, "last_edit_date": 1547075154, "creation_date": 1547074616, "answer_id": 54119630, "question_id": 54119493, "link": "https://stackoverflow.com/questions/54119493/including-images-with-project/54119630#54119630", "title": "Including images with project", "body": "<p>Since you're using Visual Studio, you can drag your image directly into your project:</p>\n\n<p><a href=\"https://i.stack.imgur.com/Y37UE.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Y37UE.png\" alt=\"enter image description here\"></a></p>\n\n<p>You then need to create the resource header file which references your image so that it may be compiled into binary code along with your project. Here's a pretty straightforward guide to run you through the steps: \n<a href=\"http://www.winprog.org/tutorial/resources.html\" rel=\"nofollow noreferrer\">http://www.winprog.org/tutorial/resources.html</a></p>\n"}], "owner": {"reputation": 29, "user_id": 10892383, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-y3i2BH8gOtM/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcasXsiD_jJmXaSSVI6Lr4CHDflFxw/mo/photo.jpg?sz=128", "display_name": "Kevin Gorman", "link": "https://stackoverflow.com/users/10892383/kevin-gorman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 35, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1547076507, "creation_date": 1547073925, "last_edit_date": 1547076507, "question_id": 54119493, "link": "https://stackoverflow.com/questions/54119493/including-images-with-project", "title": "Including images with project", "body": "<p>I am currently working on a program atm which connects to a client to a server that I run on my PC, I need to have the ability when you open the program file it does what it does but also it needs to the put a image file to a certain location. </p>\n\n<p>I am able to move the files etc but the problem is I need to have the photo embeded into the file so when the \"file.exe\" is ran it puts the file in \"C:\\Users\\%username%\\AppData\\Roaming\\MagicalSoftware\\cat.jpg\" automatically. </p>\n\n<p>If someone could explain to me how to embed said imagine in the file.exe and have it export that would be amazing. I'm completely new to c++ and Visual Studio so if you could explain like you're talking to an idiot that would be appricated. </p>\n"}, {"tags": ["c++", "c++11"], "comments": [{"owner": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 7, "creation_date": 1547073174, "post_id": 54119362, "comment_id": 95071311, "body": "My advice is not to initialize all your variables on the same line. Other programmers will not like reading that.."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 1, "creation_date": 1547073228, "post_id": 54119362, "comment_id": 95071323, "body": "That ternary needs to be tackled to the ground and wrangled into submission. That&#39;s completely out of control and totally unreadable. As drescherjm says, initialize <i>one variable per line</i>. This makes it very clear what you&#39;re doing as readability is extremely important for code."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1547073345, "post_id": 54119362, "comment_id": 95071353, "body": "What is this code supposed to do and how can it be used correctly? These are just functions. No example is given of usage. One thing you&#39;ll want to remember is <b>avoid global variables</b> and instead pass through things like <code>grid</code> as an argument to any functions that need it."}, {"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 0, "creation_date": 1547073515, "post_id": 54119362, "comment_id": 95071403, "body": "<i>is this a compiler problem?</i> -- The compiler you&#39;re using is being used by thousands of programmers, hundreds (if not thousands) of companies, and is maintained by some of the best programmers in the world.  So all bets are that it isn&#39;t a compiler problem."}, {"owner": {"reputation": 52656, "user_id": 225074, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/dea26ac1ef8259140d28aa8b5ba4f1b3?s=128&d=identicon&r=PG", "display_name": "Thomas Matthews", "link": "https://stackoverflow.com/users/225074/thomas-matthews"}, "edited": false, "score": 1, "creation_date": 1547073550, "post_id": 54119362, "comment_id": 95071416, "body": "FYI:  Common industry coding guidelines recommend declaring or defining one variable per line.  It has negligible effect on the build but makes reading the code a lot easier."}, {"owner": {"reputation": 52656, "user_id": 225074, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/dea26ac1ef8259140d28aa8b5ba4f1b3?s=128&d=identicon&r=PG", "display_name": "Thomas Matthews", "link": "https://stackoverflow.com/users/225074/thomas-matthews"}, "edited": false, "score": 1, "creation_date": 1547073770, "post_id": 54119362, "comment_id": 95071469, "body": "FWI, you may have more efficient code by checking all 8 conditions rather than using a loop.  Usually, having a slightly longer function that is working correctly is better than have a compressed function that has defects."}, {"owner": {"reputation": 106, "user_id": 9239851, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-jLvjXjVcaqA/AAAAAAAAAAI/AAAAAAAAAr0/_JCocFK7zSw/photo.jpg?sz=128", "display_name": "Souyama Debnath", "link": "https://stackoverflow.com/users/9239851/souyama-debnath"}, "reply_to_user": {"reputation": 52656, "user_id": 225074, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/dea26ac1ef8259140d28aa8b5ba4f1b3?s=128&d=identicon&r=PG", "display_name": "Thomas Matthews", "link": "https://stackoverflow.com/users/225074/thomas-matthews"}, "edited": false, "score": 0, "creation_date": 1547074929, "post_id": 54119362, "comment_id": 95071809, "body": "@ThomasMatthews I get what you are trying to say. The first function works as expected (in GDB). But <code>int q = genNeibrs(i, j, m, n);</code> q gets 0 even when it shouldn&#39;t have."}, {"owner": {"reputation": 3108, "user_id": 4641116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gc52U.png?s=128&g=1", "display_name": "Eljay", "link": "https://stackoverflow.com/users/4641116/eljay"}, "edited": false, "score": 0, "creation_date": 1547075196, "post_id": 54119362, "comment_id": 95071887, "body": "Is the biggest call <code>getGrs(100, 100)</code>, or <code>getGrs(99, 99)</code>?  Because xe and ye are being capped at that value, inclusively (as used in the loop)."}, {"owner": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 0, "creation_date": 1547075295, "post_id": 54119362, "comment_id": 95071912, "body": "I think you have an off by 1 error with xe and ye with your usage of &lt;="}], "answers": [{"comments": [{"owner": {"reputation": 106, "user_id": 9239851, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-jLvjXjVcaqA/AAAAAAAAAAI/AAAAAAAAAr0/_JCocFK7zSw/photo.jpg?sz=128", "display_name": "Souyama Debnath", "link": "https://stackoverflow.com/users/9239851/souyama-debnath"}, "edited": false, "score": 0, "creation_date": 1547075713, "post_id": 54119738, "comment_id": 95072019, "body": "Yup turns out it was the cause of all."}, {"owner": {"reputation": 41558, "user_id": 3204551, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/91bb06155f79d40ffecdf124deecb001?s=128&d=identicon&r=PG&f=1", "display_name": "Deduplicator", "link": "https://stackoverflow.com/users/3204551/deduplicator"}, "edited": false, "score": 0, "creation_date": 1547075818, "post_id": 54119738, "comment_id": 95072046, "body": "\u2026 and then <code>n</code> and <code>m</code> are ordered distinctly unconventionally. I stumble each time I read that function-declaration."}], "tags": [], "owner": {"reputation": 9551, "user_id": 9837301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9414V.png?s=128&g=1", "display_name": "JaMiT", "link": "https://stackoverflow.com/users/9837301/jamit"}, "is_accepted": true, "score": 3, "last_activity_date": 1547075325, "creation_date": 1547075325, "answer_id": 54119738, "question_id": 54119362, "link": "https://stackoverflow.com/questions/54119362/why-does-my-variable-get-forced-initialized-to-0-even-when-it-shouldnt/54119738#54119738", "title": "Why does my variable get forced initialized to 0 even when it shouldn&#39;t?", "body": "<p>First off, when you debug, you should step into the problematic function to see what is going wrong in there. However, since I spotted suspicious code when looking for typical typos for those using your cryptic coding style: compare the following lines.</p>\n\n<pre><code>int genNeibrs(int x, int y, int n, int m)\nint q = genNeibrs(i, j, m, n);\n</code></pre>\n\n<p>Tell me, what should happen if instead of \"m and n being 9 and 2 respectively\", you had \"m and n being 2 and 9 respectively\"?</p>\n\n<p><strong>Lesson:</strong> <em>Use meaningful variable names!</em> The letters \"m\" and \"n\" are visually similar. It is much easier to spot \"rows\" and \"columns\" being reversed than \"m\" and \"n\".</p>\n"}], "owner": {"reputation": 106, "user_id": 9239851, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-jLvjXjVcaqA/AAAAAAAAAAI/AAAAAAAAAr0/_JCocFK7zSw/photo.jpg?sz=128", "display_name": "Souyama Debnath", "link": "https://stackoverflow.com/users/9239851/souyama-debnath"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 54119738, "answer_count": 1, "score": -2, "last_activity_date": 1547075673, "creation_date": 1547073074, "last_edit_date": 1547075673, "question_id": 54119362, "link": "https://stackoverflow.com/questions/54119362/why-does-my-variable-get-forced-initialized-to-0-even-when-it-shouldnt", "title": "Why does my variable get forced initialized to 0 even when it shouldn&#39;t?", "body": "<p>I am trying to count and update the immediate neighbors of a cell with non zero values. So left, right, upper, lower, upper-left ... \nAnyway all the eight directions and the cell itself.</p>\n\n<pre><code>int grid[100][100];\n\nint genNeibrs(int x, int y, int n, int m)\n{\n    m--;\n    n--;\n    int c = 0, xs = ((x - 1) &lt; 0) ? 0 : (x - 1),\n        xe = ((x + 1) &gt; n) ? n : (x + 1),\n        ys = ((y - 1) &lt; 0) ? 0 : (y - 1),\n        ye = ((y + 1) &gt; m) ? m : (y + 1);\n\n    for (auto i = xs; i &lt;= xe; i++)\n    {\n        for (auto j = ys; j &lt;= ye; j++)\n        {\n            if (grid[i][j])\n                ++c;\n        }\n    }\n    return c;\n}\n\nvoid getGrs(int n, int m)\n{\n    for (auto i = 0; i &lt; n; i++)\n    {\n        for (auto j = 0; j &lt; m; j++)\n            if (grid[i][j])\n            {\n                int q = genNeibrs(i, j, m, n);\n                if (q)\n                    grid[i][j] = q;\n            }\n    }\n}\n</code></pre>\n\n<p>Here the value of q becomes 0 for successive iterations other than 0,0 for\n<code>grid =  {{1, 0, 1, 1, 0, 1, 1, 1, 1, 0 &lt;repeats 91 times&gt;}, {0, 0, 0, 1, 0, 1, 0, 0, 1, 0 &lt;repeats 91 times&gt;}, {0 &lt;repeats 100 times&gt;} &lt;repeats 98 times&gt;}</code>, m and n being 9 and 2 respectively.\nWhile debugging with gdb the function <code>genNeibrs</code> returns as expected but over execution I managed to pin it down to the line where q is being initialized. It somehow gets initialized to zero even when it shouldn't.\nSo what am I doing wrong?\nExpected value of <code>grid = {{1, 0 ,3 ,3 ,0, 3, 4, 5, 3, 0 &lt;repeats 91 times&gt;},{0, 0, 0, 3, 0, 3, 0, 0, 3, 0 &lt;repeats 91 times&gt;}, {0 &lt;repeats 100 times&gt;} &lt;repeats 98 times&gt;}</code>\nAnyway the grid's values doesn't change.</p>\n"}, {"tags": ["c++", "c++11", "c++14", "smart-pointers"], "comments": [{"owner": {"reputation": 6559, "user_id": 4143855, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Gh4vC.jpg?s=128&g=1", "display_name": "Tas", "link": "https://stackoverflow.com/users/4143855/tas"}, "edited": false, "score": 0, "creation_date": 1547073101, "post_id": 54119331, "comment_id": 95071286, "body": "It sounds like what you&#39;ve described could just be made into a smaller <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>: you already have <code>Manager</code> with the <code>const char*</code>, and you&#39;ve described <code>DataReader</code> as taking two <code>std::string&amp; const</code> parameters, are you sure you can&#39;t just reproduce this with an extra few lines of code?"}, {"owner": {"reputation": 3504, "user_id": 224982, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e7b4b96492f8648f4e9372a9f3db752f?s=128&d=identicon&r=PG", "display_name": "ilya1725", "link": "https://stackoverflow.com/users/224982/ilya1725"}, "reply_to_user": {"reputation": 6559, "user_id": 4143855, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Gh4vC.jpg?s=128&g=1", "display_name": "Tas", "link": "https://stackoverflow.com/users/4143855/tas"}, "edited": false, "score": 0, "creation_date": 1547073282, "post_id": 54119331, "comment_id": 95071338, "body": "I tried. I didn&#39;t succeed yet. Something else is missing in my smaller example that is causing the large one to fail. The irony is - once I find it I will be able to fix the main problem."}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 1, "creation_date": 1547073324, "post_id": 54119331, "comment_id": 95071344, "body": "I forget if <code>constexpr</code> changes things in this case so not dupe closing.  related/dupe: <a href=\"https://stackoverflow.com/questions/16284629/undefined-reference-to-static-variable-c\" title=\"undefined reference to static variable c\">stackoverflow.com/questions/16284629/&hellip;</a>"}, {"owner": {"reputation": 45460, "user_id": 1670129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/32370783314a7efabe09b6cfadb11b12?s=128&d=identicon&r=PG&f=1", "display_name": "Igor Tandetnik", "link": "https://stackoverflow.com/users/1670129/igor-tandetnik"}, "edited": false, "score": 1, "creation_date": 1547077121, "post_id": 54119331, "comment_id": 95072345, "body": "The difference is <code>make_unique</code> takes its parameters by reference, which makes them odr-used; whereas <code>std::string</code> takes them by value. I suspect that either of these would work: <code>std::make_unique&lt;DataReader&gt;(kActuatorsCommand + 0, kActuatorsProxy + 0)</code> , <code>std::make_unique&lt;DataReader&gt;(std::string(kActuatorsCommand), std::string(kActuatorsProxy))</code> . The latter is essentially what happens when <code>DataReader</code> constructor is called directly."}, {"owner": {"reputation": 3504, "user_id": 224982, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e7b4b96492f8648f4e9372a9f3db752f?s=128&d=identicon&r=PG", "display_name": "ilya1725", "link": "https://stackoverflow.com/users/224982/ilya1725"}, "reply_to_user": {"reputation": 45460, "user_id": 1670129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/32370783314a7efabe09b6cfadb11b12?s=128&d=identicon&r=PG&f=1", "display_name": "Igor Tandetnik", "link": "https://stackoverflow.com/users/1670129/igor-tandetnik"}, "edited": false, "score": 1, "creation_date": 1547077695, "post_id": 54119331, "comment_id": 95072452, "body": "@IgorTandetnik: indeed <code>std::string(kActuatorsCommand)</code> worked. I guess it creates the local copy of the static string and passes a reference to that to the constructor. Making the names just <code>static const char*</code> also worked. I just wonder why removing variable of class #2 from <code>DataReader</code> didn&#39;t fail linking."}, {"owner": {"reputation": 205, "user_id": 8527007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fb4570b7dd309f6f409f45aec2509c8?s=128&d=identicon&r=PG&f=1", "display_name": "MaLarsson", "link": "https://stackoverflow.com/users/8527007/malarsson"}, "edited": false, "score": 0, "creation_date": 1547134742, "post_id": 54119331, "comment_id": 95095479, "body": "I think it has something to do with inlining  <code>A constexpr specifier used in a function or static member variable (since C++17) declaration implies inline</code>  When you compile the code with <code>-O3</code> or <code>-O0 -std=c++17</code> the static variable might be inlines which avoids the undefined reference. As to why you get an undefined reference in the first place I have no idea."}, {"owner": {"reputation": 3504, "user_id": 224982, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e7b4b96492f8648f4e9372a9f3db752f?s=128&d=identicon&r=PG", "display_name": "ilya1725", "link": "https://stackoverflow.com/users/224982/ilya1725"}, "reply_to_user": {"reputation": 205, "user_id": 8527007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fb4570b7dd309f6f409f45aec2509c8?s=128&d=identicon&r=PG&f=1", "display_name": "MaLarsson", "link": "https://stackoverflow.com/users/8527007/malarsson"}, "edited": false, "score": 0, "creation_date": 1547134892, "post_id": 54119331, "comment_id": 95095564, "body": "@MaLarsson: it links fine in C++17."}], "answers": [{"comments": [{"owner": {"reputation": 3504, "user_id": 224982, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e7b4b96492f8648f4e9372a9f3db752f?s=128&d=identicon&r=PG", "display_name": "ilya1725", "link": "https://stackoverflow.com/users/224982/ilya1725"}, "edited": false, "score": 0, "creation_date": 1547144724, "post_id": 54132291, "comment_id": 95101046, "body": "Well worded, @MaLarson"}], "tags": [], "owner": {"reputation": 205, "user_id": 8527007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fb4570b7dd309f6f409f45aec2509c8?s=128&d=identicon&r=PG&f=1", "display_name": "MaLarsson", "link": "https://stackoverflow.com/users/8527007/malarsson"}, "is_accepted": true, "score": 0, "last_activity_date": 1547135354, "creation_date": 1547135354, "answer_id": 54132291, "question_id": 54119331, "link": "https://stackoverflow.com/questions/54119331/link-error-when-using-stdmake-unique-when-creating-object-with-const-char/54132291#54132291", "title": "Link error when using std::make_unique when creating object with const char *", "body": "<p>I think it has something to do with inlining</p>\n\n<blockquote>\n  <p>A constexpr specifier used in a function or static member variable\n  (since C++17) declaration implies inline</p>\n</blockquote>\n\n<p>When you compile the code with <code>-O3</code> or <code>-O0 -std=c++17</code> the static variable might be inlines which avoids the undefined reference.</p>\n\n<p>I did some digging and found:</p>\n\n<blockquote>\n  <p>You can take the address of a static member if (and only if) it has an\n  out-of-class definition</p>\n</blockquote>\n\n<p>From <a href=\"http://www.stroustrup.com/bs_faq2.html#in-class\" rel=\"nofollow noreferrer\">Bjarne Stroustrup's C++ faq</a>.\nAdding the following code to your example outside of the class body made it compile using <code>-std=c++14</code>:</p>\n\n<pre><code>constexpr const char* Manager::kActuatorsCommand;\nconstexpr const char* Manager::kActuatorsProxy;\n</code></pre>\n"}], "owner": {"reputation": 3504, "user_id": 224982, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e7b4b96492f8648f4e9372a9f3db752f?s=128&d=identicon&r=PG", "display_name": "ilya1725", "link": "https://stackoverflow.com/users/224982/ilya1725"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 311, "favorite_count": 0, "accepted_answer_id": 54132291, "answer_count": 1, "score": 1, "last_activity_date": 1547135354, "creation_date": 1547072896, "last_edit_date": 1547133713, "question_id": 54119331, "link": "https://stackoverflow.com/questions/54119331/link-error-when-using-stdmake-unique-when-creating-object-with-const-char", "title": "Link error when using std::make_unique when creating object with const char *", "body": "<p>Apologies for not providing simple runnable failure code. The error is part of the larger codebase that would require a lot of refactoring.</p>\n\n<p>I'm running into a very weird linking problem with my code that so far I can't solve.\nI have a class with <code>static constexpr const char *</code> for some strings and local <code>std::sunique_ptr</code>. The pointer is to a different templated class which contains another templated class (#2).</p>\n\n<p>The main class is like this (abridged):</p>\n\n<pre><code>class Manager {\n public:\n  Manager();\n\n  virtual ~Manager();\n\n private:\n  // Topic Constants\n  static constexpr const char* kActuatorsCommand = \"ActuatorsCommand\";\n  static constexpr const char* kActuatorsProxy = \"ActuatorsProxy\";\n\n  std::unique_ptr&lt;DataReader&gt; faults_;\n};\n</code></pre>\n\n<p>So the <code>DataReader</code> constractor takes two <code>const string &amp;</code> parameters.</p>\n\n<p>If I declare <code>faults_</code> as a regular old pointer and create it with <code>new</code> the code runs and links just fine: <code>DataReader *faults_ = new DataReader&lt;uint32_t&gt;(kActuatorsCommand, kActuatorsProxy)</code>.</p>\n\n<p>However, if I use <code>std::make_unique</code> the linker complains that there is an undefined reference to those <code>static const char*</code> strings, even though they are in the header of the class.</p>\n\n<p>Also, If I remove the #2 class everything links fine.</p>\n\n<p>Using <code>gcc (Ubuntu 7.3.0-27ubuntu1~18.04) 7.3.0</code></p>\n\n<hr>\n\n<p>I understand it may be rather vague question, but some direction where to look would be appreciated.</p>\n\n<p>Also, this question may be similar to <a href=\"https://stackoverflow.com/questions/48428550/undefined-reference-error-when-initializing-unique-ptr-with-a-static-const\">this one</a>. However, in my case everything is on one binary.</p>\n\n<hr>\n\n<p>Update: finally found how to reproduce it.</p>\n\n<pre><code>class DataReader {\n public:\n\n  explicit DataReader(const std::string&amp; topic, const std::string&amp; library_name)\n      : topic_(topic),\n        library_name_(library_name) {\n  }\n\n private:\n  const std::string name_;\n  const std::string topic_;\n  const std::string library_name_;\n};\n\n\n#include &lt;memory&gt;\n#include \"DataReader.h\"\n\nclass Manager {\n public:\n  Manager();\n  virtual ~Manager();\n\n private:\n  // Topic Constants\n  static constexpr const char* kActuatorsCommand = \"ActuatorsCommand\";\n  static constexpr const char* kActuatorsProxy = \"ActuatorsProxy\";\n\n  std::unique_ptr&lt;DataReader&gt; faults_;\n};\n\n\nManager::Manager() {\n    faults_ = std::make_unique&lt;DataReader&gt;(kActuatorsCommand, kActuatorsProxy);\n}\n\nManager::~Manager() {}\n</code></pre>\n\n<p>The code fails to link when compiled with <code>-o0</code>. With <code>-03</code> it links fine.</p>\n\n<pre><code>g++ -O0 -Wall -Wconversion -lstdc++ -pthread -std=c++14 -o ex3 src/ex3.cpp\n/tmp/ccJebZ18.o: In function `Manager::Manager()':\nex3.cpp:(.text+0x41): undefined reference to `Manager::kActuatorsProxy'\nex3.cpp:(.text+0x48): undefined reference to `Manager::kActuatorsCommand'\ncollect2: error: ld returned 1 exit status\nMakefile:8: recipe for target 'ex3' failed\n</code></pre>\n"}, {"tags": ["c++", "c", "sockets", "winsock"], "comments": [{"owner": {"reputation": 5195, "user_id": 4005175, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/3N6Ze.jpg?s=128&g=1", "display_name": "Martin Heraleck&#253;", "link": "https://stackoverflow.com/users/4005175/martin-heraleck%c3%bd"}, "edited": false, "score": 4, "creation_date": 1547072745, "post_id": 54119198, "comment_id": 95071166, "body": "Call <code>WSAGetLastError</code> to find out what the error is. <a href=\"https://docs.microsoft.com/cs-cz/windows/desktop/api/winsock/nf-winsock-wsagetlasterror\" rel=\"nofollow noreferrer\">docs.microsoft.com/cs-cz/windows/desktop/api/winsock/&hellip;</a>"}, {"owner": {"reputation": 101, "user_id": 10279509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a253a20d69697ef6e07324f7532a290?s=128&d=identicon&r=PG&f=1", "display_name": "M. Sol", "link": "https://stackoverflow.com/users/10279509/m-sol"}, "edited": false, "score": 2, "creation_date": 1547073049, "post_id": 54119198, "comment_id": 95071273, "body": "Did you include <code>WSAStartup</code> before opening the socket?"}, {"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "edited": false, "score": 1, "creation_date": 1547073169, "post_id": 54119198, "comment_id": 95071309, "body": "<code>sockaddr.sin_port = htons(69);</code>"}, {"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "edited": false, "score": 0, "creation_date": 1547073632, "post_id": 54119198, "comment_id": 95071446, "body": "EDIT 2 is an unrelated issue as originally posted."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 10892301, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GXVxbhXS9MQ/AAAAAAAAAAI/AAAAAAAAABA/jGRBhP1Afy4/photo.jpg?sz=128", "display_name": "augboi666", "link": "https://stackoverflow.com/users/10892301/augboi666"}, "edited": false, "score": 0, "creation_date": 1547074065, "post_id": 54119481, "comment_id": 95071555, "body": "I did that, and it says it completed successfully, so currently I&#39;m trying to figure out if it&#39;s a server side problem."}, {"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "reply_to_user": {"reputation": 1, "user_id": 10892301, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GXVxbhXS9MQ/AAAAAAAAAAI/AAAAAAAAABA/jGRBhP1Afy4/photo.jpg?sz=128", "display_name": "augboi666", "link": "https://stackoverflow.com/users/10892301/augboi666"}, "edited": false, "score": 0, "creation_date": 1547074199, "post_id": 54119481, "comment_id": 95071597, "body": "@augboi666: Yes, but it would be a different question."}, {"owner": {"reputation": 101, "user_id": 10279509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a253a20d69697ef6e07324f7532a290?s=128&d=identicon&r=PG&f=1", "display_name": "M. Sol", "link": "https://stackoverflow.com/users/10279509/m-sol"}, "reply_to_user": {"reputation": 1, "user_id": 10892301, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GXVxbhXS9MQ/AAAAAAAAAAI/AAAAAAAAABA/jGRBhP1Afy4/photo.jpg?sz=128", "display_name": "augboi666", "link": "https://stackoverflow.com/users/10892301/augboi666"}, "edited": false, "score": 0, "creation_date": 1547074231, "post_id": 54119481, "comment_id": 95071609, "body": "@augboi666 a bit confused, you saying there is a problem on creating a socket so how is that possible that the port is opened, are you trying to open a port on already existed socket?"}, {"owner": {"reputation": 1, "user_id": 10892301, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GXVxbhXS9MQ/AAAAAAAAAAI/AAAAAAAAABA/jGRBhP1Afy4/photo.jpg?sz=128", "display_name": "augboi666", "link": "https://stackoverflow.com/users/10892301/augboi666"}, "reply_to_user": {"reputation": 101, "user_id": 10279509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a253a20d69697ef6e07324f7532a290?s=128&d=identicon&r=PG&f=1", "display_name": "M. Sol", "link": "https://stackoverflow.com/users/10279509/m-sol"}, "edited": false, "score": 0, "creation_date": 1547074335, "post_id": 54119481, "comment_id": 95071645, "body": "@M.Sol I had a problem connecting the socket to the server. It always return -1 until I did WSAStartup and then htons on the port. Now I am believing that the problem is server side."}, {"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "reply_to_user": {"reputation": 1, "user_id": 10892301, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GXVxbhXS9MQ/AAAAAAAAAAI/AAAAAAAAABA/jGRBhP1Afy4/photo.jpg?sz=128", "display_name": "augboi666", "link": "https://stackoverflow.com/users/10892301/augboi666"}, "edited": false, "score": 0, "creation_date": 1547074346, "post_id": 54119481, "comment_id": 95071649, "body": "@augboi666: You may also want to <code>memset()</code> the <code>sockaddr</code> to zeros."}, {"owner": {"reputation": 101, "user_id": 10279509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a253a20d69697ef6e07324f7532a290?s=128&d=identicon&r=PG&f=1", "display_name": "M. Sol", "link": "https://stackoverflow.com/users/10279509/m-sol"}, "reply_to_user": {"reputation": 1, "user_id": 10892301, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GXVxbhXS9MQ/AAAAAAAAAAI/AAAAAAAAABA/jGRBhP1Afy4/photo.jpg?sz=128", "display_name": "augboi666", "link": "https://stackoverflow.com/users/10892301/augboi666"}, "edited": false, "score": 0, "creation_date": 1547074450, "post_id": 54119481, "comment_id": 95071680, "body": "@augboi666 Ok got it, then please share with us part of server side otherwise can&#39;t help any further, everything seems good here."}, {"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "reply_to_user": {"reputation": 101, "user_id": 10279509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a253a20d69697ef6e07324f7532a290?s=128&d=identicon&r=PG&f=1", "display_name": "M. Sol", "link": "https://stackoverflow.com/users/10279509/m-sol"}, "edited": false, "score": 0, "creation_date": 1547074586, "post_id": 54119481, "comment_id": 95071712, "body": "@M.Sol: If the issue is now debugging the server, it is better to ask a new question."}], "tags": [], "owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "is_accepted": false, "score": 0, "last_activity_date": 1547073860, "creation_date": 1547073860, "answer_id": 54119481, "question_id": 54119198, "link": "https://stackoverflow.com/questions/54119198/winsock-always-returning-1-on-socket/54119481#54119481", "title": "winsock always returning -1 on socket", "body": "<p>Berkeley sockets require the address and port information to be presented in network byte order. Winsock follows this API:</p>\n\n<blockquote>\n  <p>All of the data in the SOCKADDR_IN structure, except for the address family, must be specified in network-byte-order (big-endian).<br>\n  <sub><a href=\"https://docs.microsoft.com/en-us/windows/desktop/api/ws2def/ns-ws2def-sockaddr_in\" rel=\"nofollow noreferrer\">Windows Dev Center</a></sub></p>\n</blockquote>\n\n<p>Use <code>htons()</code> to convert the port value from host to network byte order.</p>\n\n<pre><code>sockaddr.sin_port = htons(69);\n</code></pre>\n\n<p><code>inet_addr()</code> already returns a value in network byte order.</p>\n"}, {"tags": [], "owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "is_accepted": false, "score": 1, "last_activity_date": 1547075887, "creation_date": 1547075887, "answer_id": 54119842, "question_id": 54119198, "link": "https://stackoverflow.com/questions/54119198/winsock-always-returning-1-on-socket/54119842#54119842", "title": "winsock always returning -1 on socket", "body": "<p>Your error handling is a bit lacking.</p>\n\n<p>First off, when an error does occur, STOP what you are doing. Right now, you are not stopping, you just move on to the next API call as if no error occured.</p>\n\n<p>Second, your error handling on <code>connect()</code> is wrong. <code>connect()</code> returns 0 on success and -1 on failure, but you are checking its return value for <code>!= 1</code> so you are going to treat successes and failures the same way.</p>\n\n<p>Try this instead:</p>\n\n<pre><code>static SOCKET establishconn(const char *addr, u_short port)\n{\n    SOCKET commsock = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);\n    if (commsock == INVALID_SOCKET)\n        return INVALID_SOCKET;\n\n    //OutputDebugStringA(addr);\n\n    SOCKADDR_IN sockaddr = {};\n    sockaddr.sin_family = AF_INET;\n    sockaddr.sin_port = htons(port);\n    sockaddr.sin_addr.s_addr = inet_addr(addr);\n\n    if (sockaddr.sin_addr.s_addr == INADDR_NONE)\n    {\n        struct hostent *host = gethostbyname(addr);\n        if (!host)\n        {\n            closesocket(commsock);\n            return INVALID_SOCKET;\n        }\n        sockaddr.sin_addr.s_addr = *((u_long*) host-&gt;h_addr);\n    }\n\n    if (connect(commsock, (SOCKADDR &amp;sockaddr, sizeof(sockaddr)) == SOCKET_ERROR)\n    {\n        closesocket(commsock);\n        return INVALID_SOCKET;\n    }\n\n    return commsock;\n}\n</code></pre>\n\n<p>Then you can do this:</p>\n\n<pre><code>WSAStartup(...);\n...\nSOCKET maincommsock = establishconn(\"127.0.0.1\", 69);\nif (maincommsock != INVALID_SOCKET)\n{\n    ...\n    closesocket(maincommsock);\n}\n...\nWSACleanup();\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 10892301, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GXVxbhXS9MQ/AAAAAAAAAAI/AAAAAAAAABA/jGRBhP1Afy4/photo.jpg?sz=128", "display_name": "augboi666", "link": "https://stackoverflow.com/users/10892301/augboi666"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1547130268, "creation_date": 1547072251, "last_edit_date": 1547130268, "question_id": 54119198, "link": "https://stackoverflow.com/questions/54119198/winsock-always-returning-1-on-socket", "title": "winsock always returning -1 on socket", "body": "<p>I'm trying to connect to my server on port 69 using winsock2.h. Everything appears to be compiling correctly but in a debugger maincommsock is always equal to -1. I can't seem to figure out why it isn't working, and need help. Not very experienced with socket programming, and not sure what to do now!. Any help will be greatly appreciated.</p>\n\n<p>I'm not 100% sure what else to try. This is basically a function that establishes a connection on a socket, and sets connection to true, so that it can loop until it connects.</p>\n\n<pre><code>    int maincommsock;\n    bool connection = false;\n\nstatic void establishconn() {\n    maincommsock = socket(AF_INET, SOCK_STREAM, 0);\n    if (maincommsock == -1) {\n        connection = false;\n    }\n\n    //OutputDebugString((LPCSTR)commservers[1]);\n\n    /*\n    struct hostent *host;\n    if ((host = gethostbyname(SERV_ADDR)) == NULL) {\n        connection = FALSE;\n    }\n    */\n    SOCKADDR_IN sockaddr;\n    sockaddr.sin_port = 69;\n    sockaddr.sin_family = AF_INET;\n    sockaddr.sin_addr.s_addr = inet_addr(\"127.0.0.1\");\n    //sockaddr.sin_addr.s_addr = *((unsigned long*)host-&gt;h_addr);\n    if (connect(maincommsock, (SOCKADDR *)(&amp;sockaddr), sizeof(sockaddr)) != 1) {\n        connection = true;\n    }\n}\n</code></pre>\n\n<p>EDIT</p>\n\n<p>I used WSAStartup, and the error I'm currently getting is No connection could be made because the target machine actively refused it.\"</p>\n\n<p>EDIT 2</p>\n\n<p>used htons on the port. It says the operation completed successfully but no connections show up on the server</p>\n\n<p>EDIT 3</p>\n\n<p>I'm going to test it on linux, to make sure that it is actually a server side error and not a problem with my code. I'll keep you guys updated.</p>\n"}, {"tags": ["c++", "c++11", "floating-point", "type-conversion", "integer-overflow"], "comments": [{"owner": {"reputation": 32386, "user_id": 4706785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdee2789e9bac57bfdd97abc4e533a4d?s=128&d=identicon&r=PG&f=1", "display_name": "Peter", "link": "https://stackoverflow.com/users/4706785/peter"}, "edited": false, "score": 3, "creation_date": 1547072234, "post_id": 54119126, "comment_id": 95070984, "body": "Operator precedence means that the multiplications occur, in this case, before the addition.    The expression <code>val2*val3*val4</code> is calculated as a <code>int32_t</code> - with any effects of overflow as well.   The result of that is then converted to <code>double</code> before addition to <code>val1</code>.      All versions of C++ before C++11 have the same.  Fixed-width types, like <code>int32_t</code>, were not standard before C++11."}, {"owner": {"reputation": 5195, "user_id": 4005175, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/3N6Ze.jpg?s=128&g=1", "display_name": "Martin Heraleck&#253;", "link": "https://stackoverflow.com/users/4005175/martin-heraleck%c3%bd"}, "edited": false, "score": 0, "creation_date": 1547072312, "post_id": 54119126, "comment_id": 95071015, "body": "<a href=\"https://stackoverflow.com/questions/30314291/operator-precedence-and-automatic-promotion-to-avoid-overflow\" title=\"operator precedence and automatic promotion to avoid overflow\">stackoverflow.com/questions/30314291/&hellip;</a>"}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1547072503, "post_id": 54119126, "comment_id": 95071091, "body": "fwiw <a href=\"https://wandbox.org/permlink/djiwK9nfSXP7PuVc\" rel=\"nofollow noreferrer\">the overflow in action</a>"}, {"owner": {"reputation": 361, "user_id": 9344674, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MdjL5.gif?s=128&g=1", "display_name": "Nazari", "link": "https://stackoverflow.com/users/9344674/nazari"}, "edited": false, "score": 0, "creation_date": 1547072876, "post_id": 54119126, "comment_id": 95071211, "body": "You are using the double value in first place, so all of the desired result will become the double when they impact the double value and conversions will happen. From left to right <code>val1+((val2*val3)*val4)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 76876, "user_id": 287586, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/tB5AG.png?s=128&g=1", "display_name": "dan04", "link": "https://stackoverflow.com/users/287586/dan04"}, "edited": false, "score": 1, "creation_date": 1547081717, "post_id": 54119231, "comment_id": 95073372, "body": "A terser way of accomplishing the same thing is <code>val1 + (1.0 * val2 * val3 * val4)</code>."}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "reply_to_user": {"reputation": 76876, "user_id": 287586, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/tB5AG.png?s=128&g=1", "display_name": "dan04", "link": "https://stackoverflow.com/users/287586/dan04"}, "edited": false, "score": 0, "creation_date": 1547200149, "post_id": 54119231, "comment_id": 95119066, "body": "@dan04 terse but not explicit. The next one reading the code might be too clever and remove the <code>1.0 *</code> because it seems like not effecting the result, while someone removing a <code>static_cast</code> will just get what they deserve ;)"}], "tags": [], "owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "is_accepted": true, "score": 4, "last_activity_date": 1547080398, "last_edit_date": 1547080398, "creation_date": 1547072366, "answer_id": 54119231, "question_id": 54119126, "link": "https://stackoverflow.com/questions/54119126/when-does-c11-do-arithmetic-type-conversions-relative-to-operator-precedence/54119231#54119231", "title": "When does C++11 do arithmetic type conversions relative to operator precedence?", "body": "<p>The expression</p>\n\n<pre><code>val1 + val2 * val3 * val4\n</code></pre>\n\n<p>has the type of <code>double</code>, but the multiplication part is of type <code>int32_t</code>.  If we apply the rules on how it is evaluated we have</p>\n\n<pre><code>val1 + (val2 * val3 * val4)\n</code></pre>\n\n<p>because multiplication has a higher precedence, it will be evaluated without considering the type of <code>val1</code> and since all of the operands have the same type the result type will be the same as the operands.  That result is then converted to a <code>double</code> and added to <code>val1</code>.  This behavior has not changed in any of the versions of C++.</p>\n\n<p>To get the multiplication to happen as <code>double</code> you need to cast either <code>val2</code> or <code>val3</code> to a double, which will make the entire multiplication part evaluated as a <code>double</code>.  That would look like</p>\n\n<pre><code>val1 + (static_cast&lt;double&gt;(val2) * val3 * val4)\n</code></pre>\n\n<p><sup>the parentheses are not needed but I like using them to show the grouping</sup></p>\n"}], "owner": {"reputation": 36033, "user_id": 115751, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/FkIiK.png?s=128&g=1", "display_name": "WilliamKF", "link": "https://stackoverflow.com/users/115751/williamkf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 54119231, "answer_count": 1, "score": 2, "last_activity_date": 1547080398, "creation_date": 1547071851, "last_edit_date": 1547072928, "question_id": 54119126, "link": "https://stackoverflow.com/questions/54119126/when-does-c11-do-arithmetic-type-conversions-relative-to-operator-precedence", "title": "When does C++11 do arithmetic type conversions relative to operator precedence?", "body": "<p>If I have the following code:</p>\n\n<pre><code>double compute(double val1,\n               int32_t val2,\n               int32_t val3,\n               int32_t val4) {\n  return val1 + val2 * val3 * val4;\n}\n</code></pre>\n\n<p>How does the C++11 language specify that the multiplication be performed?  E.g., are <code>val1</code>, <code>val2</code>, and <code>val3</code> multiplied as 32 bit integers, according to operator precedence, possibly overflowing, and then converted to a double, or are they multiplied as doubles?</p>\n\n<p>In general, what exactly does the standard say on this subject?  Has it changed in subsequent versions of C++ (e.g., C++17)?</p>\n"}, {"tags": ["c++", "qt"], "comments": [{"owner": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 1, "creation_date": 1547071594, "post_id": 54119057, "comment_id": 95070739, "body": "You probably want to use signals and slots."}, {"owner": {"reputation": 10248, "user_id": 268396, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4220afde4dd928ef33648797c7415ada?s=128&d=identicon&r=PG", "display_name": "user268396", "link": "https://stackoverflow.com/users/268396/user268396"}, "edited": false, "score": 0, "creation_date": 1547071618, "post_id": 54119057, "comment_id": 95070749, "body": "This problem can be made to go away once you start using instances. You may get other problems, but such is life when learning C++."}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1547071648, "post_id": 54119057, "comment_id": 95070756, "body": "&quot;The Problem with that is that I can&#39;t call a non-static function in the Qt class to change the Ui from a static function from a different class&quot; why not? You just need a reference to the instance. Please read about <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> and show some code"}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 1, "creation_date": 1547071705, "post_id": 54119057, "comment_id": 95070772, "body": "btw classes with only static members are not really considered good design in c++. You would rather have free functions declared inside a namespace"}, {"owner": {"reputation": 45, "user_id": 9910916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5996b0ff79f9d55c2ccfc3dfd7be7e4?s=128&d=identicon&r=PG&f=1", "display_name": "itssimsch", "link": "https://stackoverflow.com/users/9910916/itssimsch"}, "edited": false, "score": 0, "creation_date": 1547133230, "post_id": 54119057, "comment_id": 95094537, "body": "Thanks for all the answers! I&#39;ll definitely consider using instances instead of static classes with only static members, but for now I&#39;ll try to get into Signals and Slots! Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 9910916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5996b0ff79f9d55c2ccfc3dfd7be7e4?s=128&d=identicon&r=PG&f=1", "display_name": "itssimsch", "link": "https://stackoverflow.com/users/9910916/itssimsch"}, "edited": false, "score": 0, "creation_date": 1547152926, "post_id": 54119413, "comment_id": 95104687, "body": "Okay, so right now I am trying to do it with Signals and Slots. I&#39;ve created a Q_SIGNAL void testSignal();  in my GameUi class, and a &#39;Q_SLOT void testSlot(); &#39; in the Qt Gui class. According to the Qt-Documentation you can connect a signal of an object to a slot of an object. But since I don&#39;t have an object of GameUi, how am I supposed to connect the signal to the slot. When I try &#39;connect(GameUi, GameUi::testSignal, this, Gui::testSlot); &#39; it gives me the error &#39;class GameUi  Typename not allowed&#39;"}], "tags": [], "owner": {"reputation": 38, "user_id": 10863657, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26cd577f5cea09148459c730a2ae958e?s=128&d=identicon&r=PG&f=1", "display_name": "rob2n", "link": "https://stackoverflow.com/users/10863657/rob2n"}, "is_accepted": false, "score": 0, "last_activity_date": 1547073377, "creation_date": 1547073377, "answer_id": 54119413, "question_id": 54119057, "link": "https://stackoverflow.com/questions/54119057/how-to-access-non-static-qt-ui-function-from-a-static-member-function-of-a-diffe/54119413#54119413", "title": "How to access non-static Qt Ui function from a static member function of a different class?", "body": "<p>Assuming GUI is a singleton, you might code a static GUI::instance() method that returns a pointer to itself.  Call it from anywhere and you have your pointer.  Better yet, [inherit from QObject and] use signals and slots.</p>\n"}], "owner": {"reputation": 45, "user_id": 9910916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5996b0ff79f9d55c2ccfc3dfd7be7e4?s=128&d=identicon&r=PG&f=1", "display_name": "itssimsch", "link": "https://stackoverflow.com/users/9910916/itssimsch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 223, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547073377, "creation_date": 1547071419, "question_id": 54119057, "link": "https://stackoverflow.com/questions/54119057/how-to-access-non-static-qt-ui-function-from-a-static-member-function-of-a-diffe", "title": "How to access non-static Qt Ui function from a static member function of a different class?", "body": "<p>So me and my friends are developing Connect4 in C++. At first we elaborated the logic behind the game in a Visual Studio Console Application. We came up with 3 classes, \"Logic\", \"GameUi\" (That name is probably not suitable) and \"Gui\". (I should mention that all members off these classes are static members - so no instances)\nOnce the logic worked it was my job to tranfer it to Qt. And here's the problem:</p>\n\n<p>So basically once the player has done an input (aka. The Player has chosen a column in which he wants to throw the slice (?) in) the Logic class processes this input and updates the vector in which we store the field. After this Logic calls the GamUi class, which should then call a function in the Gui class (Note that the Gui class is now the Qt class). The Problem with that is that I can't call a non-static function in the Qt class to change the Ui from a static function from a different class.\nAt first I thought about making the Ui public, which is according to the internet not a good programming exercise.</p>\n\n<p>Thank you very much in advance</p>\n\n<p>Ps: Please don't judge me for my non-native-speaker-english and my not very good c++ skills.</p>\n"}, {"tags": ["c++", "objective-c", "cocoa", "sdl-2"], "answers": [{"tags": [], "owner": {"reputation": 14821, "user_id": 5743288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ea16526477fd6f1d4cc57f976af38d0?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Sanders", "link": "https://stackoverflow.com/users/5743288/paul-sanders"}, "is_accepted": false, "score": 0, "last_activity_date": 1547072560, "creation_date": 1547072560, "answer_id": 54119274, "question_id": 54118844, "link": "https://stackoverflow.com/questions/54118844/clang-compiler-linker-cannot-find-symbol-nsmenuitem-for-x86-64-architechture/54119274#54119274", "title": "Clang compiler/Linker cannot find symbol NSMenuItem for x86_64 Architechture", "body": "<p>This is a linker error, not a compiler error.  Make sure you link against the Cocoa framework - in Xcode you can just add it to your project.</p>\n"}], "owner": {"reputation": 51, "user_id": 9916634, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/efUC6.jpg?s=128&g=1", "display_name": "Derek Boucher", "link": "https://stackoverflow.com/users/9916634/derek-boucher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 37, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547072560, "creation_date": 1547070415, "last_edit_date": 1547072059, "question_id": 54118844, "link": "https://stackoverflow.com/questions/54118844/clang-compiler-linker-cannot-find-symbol-nsmenuitem-for-x86-64-architechture", "title": "Clang compiler/Linker cannot find symbol NSMenuItem for x86_64 Architechture", "body": "<p>I'm currently porting a C++/SDL2 application to Mac OS X and I want to add items to and edit the native Menu Bar that accompanies Mac OS X applications (at the top of the screen).</p>\n\n<p>However, my compiler is complaining about not recognizing the NSMenuItem class anywhere within the Cocoa API...</p>\n\n<p>I've managed to convert my main.cpp to main.mm and #import Cocoa/Cocoa.h headers, however when I declare an NSMenuItem variable (Such as the LoadROMItem varialbe in my snippet below) I get a linker error :</p>\n\n<p>Undefined symbols for architecture x86_64:\n  \"_OBJC_CLASS_$_NSMenuItem\", referenced from:\n      objc-class-ref in main.o\nld: symbol(s) not found for architecture x86_64\nclang: error: linker command failed with exit code 1 (use -v to see invocation)</p>\n\n<p>Here's the code snippet:</p>\n\n<pre><code>    bool RUNNING = true;\n    SDL_Init(SDL_INIT_EVERYTHING);\n    SDL_Window* _SDLwindow = SDL_CreateWindow(\"GBemu\", SDL_WINDOWPOS_CENTERED, SDL_WINDOWPOS_CENTERED, 500, 500, SDL_WINDOW_RESIZABLE);\n    SDL_Surface* _screen = SDL_GetWindowSurface(_SDLwindow);\n    SDL_SysWMinfo *NativeWindowInfo = new SDL_SysWMinfo;\n    SDL_GetWindowWMInfo(_SDLwindow, NativeWindowInfo);\n\n    SDL_Event _event;\n\n#ifdef __APPLE__\n    NSMenuItem* LoadRomItem = [[NSMenuItem alloc]initWithTitle:@\"Load ROM\" action:NULL keyEquivalent:@\"s\"];\n    [NativeWindowInfo-&gt;info.cocoa.window.menu addItem:LoadRomItem];\n#endif\n</code></pre>\n\n<p>Could this be due to something im forgeting to import? Or is it perhaps a compiler and/or linker setting I am forgetting to set?</p>\n\n<p>I'm using XCode as my IDE of choice.</p>\n"}, {"tags": ["c++", "switch-statement", "output"], "comments": [{"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 3, "creation_date": 1547070579, "post_id": 54118819, "comment_id": 95070306, "body": "Your <code>choice</code> is an <code>int</code> and you compare with character literals whose value is not the same as the digit they represent. <code>case &#39;1&#39;:</code> is <code>case 49:</code> with ascii encoding."}, {"owner": {"reputation": 571, "user_id": 4096272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345c800d1d42a321a26ce5033e75f437?s=128&d=identicon&r=PG&f=1", "display_name": "Tony J", "link": "https://stackoverflow.com/users/4096272/tony-j"}, "edited": false, "score": 0, "creation_date": 1547070689, "post_id": 54118819, "comment_id": 95070349, "body": "<code>case &#39;1&#39;</code> should b just <code>case 1</code>: and same for the rest, &#39;1&#39; is type char, 1 is int. It compiles because &#39;1&#39; has a integer value, but it&#39;s not 1."}, {"owner": {"reputation": 52656, "user_id": 225074, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/dea26ac1ef8259140d28aa8b5ba4f1b3?s=128&d=identicon&r=PG", "display_name": "Thomas Matthews", "link": "https://stackoverflow.com/users/225074/thomas-matthews"}, "edited": false, "score": 1, "creation_date": 1547071780, "post_id": 54118819, "comment_id": 95070802, "body": "You could eliminate the <code>switch</code> statement and use an array of <code>std::string</code>:  <code>const std::string choices[] = {&quot;Unknown&quot;, &quot;Coke&quot;, &quot;Pepsi&quot;, &quot;Mtn. Dew&quot;, &quot;Water&quot;, &quot;Cancel&quot;};</code>  You could then say:  <code>std::cout &lt;&lt; choices[choice] &lt;&lt; &quot;\\n&quot;;</code>."}, {"owner": {"reputation": 17, "user_id": 6694274, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4AqAW.jpg?s=128&g=1", "display_name": "RoscoeSteele93", "link": "https://stackoverflow.com/users/6694274/roscoesteele93"}, "reply_to_user": {"reputation": 52656, "user_id": 225074, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/dea26ac1ef8259140d28aa8b5ba4f1b3?s=128&d=identicon&r=PG", "display_name": "Thomas Matthews", "link": "https://stackoverflow.com/users/225074/thomas-matthews"}, "edited": false, "score": 0, "creation_date": 1547072062, "post_id": 54118819, "comment_id": 95070913, "body": "@ThomasMatthews I thought about doing that tbh, but I am practicing strings and I just checked the prompt while writing this, it says:  &quot;Write a program that presents the user w/ a choice of your 5 favorite beverages (Coke, Water, Sprite, ... , Whatever). Then allow the user to choose a beverage by entering a number 1-5. Output which beverage they chose.  \u2605 If you program uses if statements instead of a switch statement, modify it to use a switch statement. If instead your program uses a switch statement, modify it to use if/else-if statements.&quot;"}], "answers": [{"tags": [], "owner": {"reputation": 153, "user_id": 10729404, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e553ca911e011904a91a7b19d7dbc9f6?s=128&d=identicon&r=PG&f=1", "display_name": "BLAKE", "link": "https://stackoverflow.com/users/10729404/blake"}, "is_accepted": false, "score": 1, "last_activity_date": 1547842176, "creation_date": 1547842176, "answer_id": 54260795, "question_id": 54118819, "link": "https://stackoverflow.com/questions/54118819/cpp-switch-statement-wont-output-conditions-set/54260795#54260795", "title": "Cpp switch statement won&#39;t output conditions set", "body": "<p>This is what you are looking for.</p>\n\n<pre><code>#include &lt;iostream&gt;\n\n//cola machine\n\nint main()\n{\n    //intro and options\n    std::cout &lt;&lt; \"Welcome. What will you have?\";\n    std::cout &lt;&lt; std::endl;\n    std::cout &lt;&lt; \"1 - Coke\";\n    std::cout &lt;&lt; std::endl;\n    std::cout &lt;&lt; \"2 - Pepsi\";\n    std::cout &lt;&lt; std::endl;\n    std::cout &lt;&lt; \"3 - Mtn. Dew\";\n    std::cout &lt;&lt; std::endl;\n    std::cout &lt;&lt; \"4 - Water\";\n    std::cout &lt;&lt; std::endl;\n    std::cout &lt;&lt; \"5 - Cancel\";\n    std::cout &lt;&lt; std::endl;\n    //choice\n    int choice;\n\n    std::cin &gt;&gt; choice;\n\n    std::cout &lt;&lt; \"Enjoy your \";\n\n    switch (choice)\n    {\n    case 1:\n        std::cout &lt;&lt; \"Coke\";\n        break;\n    case 2:\n        std::cout &lt;&lt; \"Pepsi\";\n        break;\n    case 3:\n        std::cout &lt;&lt; \"Mt. Dew\";\n        break;\n    case 4:\n        std::cout &lt;&lt; \"Water\";\n        break;\n    case 5:\n        std::cout &lt;&lt; \"void\";\n        break;\n\n    default:\n        std::cout &lt;&lt; \"NONE SELECTED\";\n    }\n\n    std::cout &lt;&lt; \"!\\n\";\n\n    system(\"PAUSE\");\n}\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 6694274, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4AqAW.jpg?s=128&g=1", "display_name": "RoscoeSteele93", "link": "https://stackoverflow.com/users/6694274/roscoesteele93"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1547842176, "creation_date": 1547070281, "last_edit_date": 1547073253, "question_id": 54118819, "link": "https://stackoverflow.com/questions/54118819/cpp-switch-statement-wont-output-conditions-set", "title": "Cpp switch statement won&#39;t output conditions set", "body": "<p>I'm running into a bit of an issue on a practice program from the cpp site.\nThe prompt is: </p>\n\n<blockquote>\n  <p>Write a program that presents the user w/ a choice of your 5 favorite\n  beverages (Coke, Water, Sprite, ... , Whatever). Then allow the user\n  to choose a beverage by entering a number 1-5. Output which beverage\n  they chose.</p>\n  \n  <p>\u2605 If you program uses if statements instead of a switch statement,\n  modify it to use a switch statement. If instead your program uses a\n  switch statement, modify it to use if/else-if statements.</p>\n</blockquote>\n\n<p>When I compile and run, there's no output after user input. </p>\n\n<pre><code> #include &lt;iostream&gt;\n\n//cola machine\n\nmain ()\n{\n    //intro and options\n    std::cout &lt;&lt; \"Welcome. What will you have?\";\n    std::cout &lt;&lt; std::endl;\n    std::cout &lt;&lt; \"1 - Coke\";\n    std::cout &lt;&lt; std::endl;\n    std::cout &lt;&lt; \"2 - Pepsi\";\n    std::cout &lt;&lt; std::endl;\n    std::cout &lt;&lt; \"3 - Mtn. Dew\";\n    std::cout &lt;&lt; std::endl;\n    std::cout &lt;&lt; \"4 - Water\";\n    std::cout &lt;&lt; std::endl;\n    std::cout &lt;&lt; \"5 - Cancel\";\n    std::cout &lt;&lt; std::endl;\n    //choice\n    int choice;\n\n        std::cin &gt;&gt; choice;\n\n    switch (choice)\n        {\n            case '1':\n                std::cout &lt;&lt; \"Coke\";\n                break;\n            case '2':\n                std::cout &lt;&lt; \"Pepsi\";\n                break;\n            case '3':\n                std::cout &lt;&lt; \"Mt. Dew\";\n                break;\n            case '4':\n                std::cout &lt;&lt; \"Water\";\n                break;\n            case '5':\n                std::cout &lt;&lt; \"void\";\n                break;\n\n            default:\n    std::cout &lt;&lt; \"enjoy your \";\n    std::cout &lt;&lt; choice;\n    std::cout &lt;&lt; \"!\";\n        }\n</code></pre>\n\n<p>Any guidance would be amazing and thanks for your time.</p>\n"}, {"tags": ["c++", "class", "memory", "vector", "struct"], "comments": [{"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 0, "creation_date": 1547070483, "post_id": 54118805, "comment_id": 95070269, "body": "<code>vector</code> does a lot of copying and destroying of copies as it resizes and shuffles entries around. This results in the Rule of Three violation coming into play."}, {"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 0, "creation_date": 1547070615, "post_id": 54118805, "comment_id": 95070318, "body": "<i>C++ weird behavior...</i> -- No, not weird."}, {"owner": {"reputation": 33645, "user_id": 2630032, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hQF09.jpg?s=128&g=1", "display_name": "Stephan Lechner", "link": "https://stackoverflow.com/users/2630032/stephan-lechner"}, "edited": false, "score": 0, "creation_date": 1547070663, "post_id": 54118805, "comment_id": 95070335, "body": "Hint: add <code>A_s(A_s &amp;&amp;)  {\u00a0cout &lt;&lt; &quot;Move!!&quot; &lt;&lt; endl; }</code> and see what happens."}, {"owner": {"reputation": 123967, "user_id": 251153, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/4b25144c09555e7d5b5e288469e011ef?s=128&d=identicon&r=PG", "display_name": "zneak", "link": "https://stackoverflow.com/users/251153/zneak"}, "edited": false, "score": 0, "creation_date": 1547070719, "post_id": 54118805, "comment_id": 95070363, "body": "<code>emplace_back</code> may well involve copies. If <code>emplace_back</code> has to enlarge the vector, <i>existing</i> entries are copied if the type is not movable."}, {"owner": {"reputation": 365, "user_id": 5206420, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/LTn4O.jpg?s=128&g=1", "display_name": "Roy Varon", "link": "https://stackoverflow.com/users/5206420/roy-varon"}, "edited": false, "score": 0, "creation_date": 1547070723, "post_id": 54118805, "comment_id": 95070365, "body": "<code>vec 0                                                     0x1e1710                                  vec 1                                                     0x1e1a90                                  Move!!                                            vec 2                                                     0x1e1ab0                                  Move!!                                            Move!!                                            mingw32-make: *** [Makefile:6: run] Error -1073740940</code> So I guess it does move objects..."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547070802, "post_id": 54118805, "comment_id": 95070399, "body": "@RoyVaron Regarding your edit, it <i>is</i> a duplicate. Vector also moves elements around when it grows, which is where the rule of 3 comes into play. Another fix would be to <code>reserve</code> so it never grows, but you&#39;re better off to obey the rule of 3/5/0."}, {"owner": {"reputation": 365, "user_id": 5206420, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/LTn4O.jpg?s=128&g=1", "display_name": "Roy Varon", "link": "https://stackoverflow.com/users/5206420/roy-varon"}, "edited": false, "score": 1, "creation_date": 1547070919, "post_id": 54118805, "comment_id": 95070466, "body": "I understand. Since it does move objects I have changed the vector to <code>vecotr&lt;A_s *&gt;</code>. I will remove the EDIT. Thank you everyone for the help!"}, {"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 2, "creation_date": 1547070986, "post_id": 54118805, "comment_id": 95070489, "body": "@RoyVaron Regardless of whether you&#39;re using vector now and emplace_back, you should at least make your classes have correct copy semantics."}, {"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 0, "creation_date": 1547075001, "post_id": 54118805, "comment_id": 95071830, "body": "<code>vector&lt;A_s *&gt;</code> is one of the worst things you can do because 1) you now pick up a buttload of memory management that <code>vector</code> could be doing for you and 2) You may accidentally copy elsewhere and find yourself back in this hole. The right solution is to support the <a href=\"https://en.cppreference.com/w/cpp/language/rule_of_three\" rel=\"nofollow noreferrer\">Rule of Five</a>. In this case it looks like you do not want to ever copy, so you <code>delete</code> the copy constructor and assignment operator to block any copying. <a href=\"https://ideone.com/hxe8PV\" rel=\"nofollow noreferrer\">Example</a>"}, {"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 1, "creation_date": 1547123198, "post_id": 54118805, "comment_id": 95088524, "body": "Either make <code>A_s</code> have correct copy semantics, or <code>delete</code> those functions that allow copying so that the compiler can flag any copy usage.  Having a broken class floating around in your app, and hoping it isn&#39;t being used in a copying situation is not the way to address the problem."}], "owner": {"reputation": 365, "user_id": 5206420, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/LTn4O.jpg?s=128&g=1", "display_name": "Roy Varon", "link": "https://stackoverflow.com/users/5206420/roy-varon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 43, "favorite_count": 0, "closed_date": 1547070260, "answer_count": 0, "score": 0, "last_activity_date": 1547070956, "creation_date": 1547070208, "last_edit_date": 1547070956, "question_id": 54118805, "link": "https://stackoverflow.com/questions/54118805/c-weird-behavior-with-structs-and-vectors", "closed_reason": "Duplicate", "title": "C++ weird behavior with structs and vectors", "body": "<p>When I run the code:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;vector&gt;\n\nusing namespace std;\n\nstruct A_s {\n    int *arr;\n    unsigned int l;\n\n    A_s(unsigned int size) : l(size) {\n        arr = new int[size];\n        cout&lt;&lt;'\\t'&lt;&lt;arr&lt;&lt;endl;\n    }\n\n    ~A_s() {\n        delete[] arr;               // works if line is removed\n    }\n};\n\nvector&lt;A_s&gt; vec;\n\nint main() {\n    cout&lt;&lt;\"vec 0\"&lt;&lt;endl;\n    vec.emplace_back(1);\n\n    cout&lt;&lt;\"vec 1\"&lt;&lt;endl;\n    vec.emplace_back(1);\n\n    cout&lt;&lt;\"vec 2\"&lt;&lt;endl;\n    vec.emplace_back(1);\n\n    for(unsigned int i = 0; i &lt; vec.size(); i++) cout&lt;&lt;&amp;vec[i]&lt;&lt;endl;\n\n    cout&lt;&lt;\"end\"&lt;&lt;endl;\n    return 0;\n}\n</code></pre>\n\n<p>The output is:</p>\n\n<pre><code>vec 0\n        0x761710\nvec 1\n        0x761a90\nvec 2\n        0x761ab0\nmingw32-make: *** [Makefile:6: run] Error -1073740940\n</code></pre>\n\n<p>The program runs without errors if I delete the line <code>delete[] arr</code>. Is the destructor being called before the end of the program? And even if it does, why is it causing an error?</p>\n"}, {"tags": ["c++", "data-structures", "doubly-linked-list"], "comments": [{"owner": {"reputation": 1253, "user_id": 704515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f563d99bc6daa3bc4223274c7578f70?s=128&d=identicon&r=PG", "display_name": "Viktor Nonov", "link": "https://stackoverflow.com/users/704515/viktor-nonov"}, "edited": false, "score": 1, "creation_date": 1547070079, "post_id": 54118765, "comment_id": 95070084, "body": "Would you show where you define <code>head</code>?"}, {"owner": {"reputation": 59, "user_id": 8257206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98ddd860115218913e90767637a789e5?s=128&d=identicon&r=PG&f=1", "display_name": "Ayush Mishra", "link": "https://stackoverflow.com/users/8257206/ayush-mishra"}, "reply_to_user": {"reputation": 1253, "user_id": 704515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f563d99bc6daa3bc4223274c7578f70?s=128&d=identicon&r=PG", "display_name": "Viktor Nonov", "link": "https://stackoverflow.com/users/704515/viktor-nonov"}, "edited": false, "score": 0, "creation_date": 1547070120, "post_id": 54118765, "comment_id": 95070104, "body": "@ViktorNonov i defined it globally."}, {"owner": {"reputation": 1981, "user_id": 113374, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/7WZv6.jpg?s=128&g=1", "display_name": "NextInLine", "link": "https://stackoverflow.com/users/113374/nextinline"}, "edited": false, "score": 0, "creation_date": 1547070177, "post_id": 54118765, "comment_id": 95070127, "body": "Have you confirmed <code>ptr-&gt;left != NULL</code>? If it is, it won&#39;t have a <code>-&gt;right</code>"}, {"owner": {"reputation": 1253, "user_id": 704515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f563d99bc6daa3bc4223274c7578f70?s=128&d=identicon&r=PG", "display_name": "Viktor Nonov", "link": "https://stackoverflow.com/users/704515/viktor-nonov"}, "edited": false, "score": 0, "creation_date": 1547070177, "post_id": 54118765, "comment_id": 95070128, "body": "Okay. Can you post the whole file? Probably it&#39;s NULL or points to some inaccessible place in memory."}, {"owner": {"reputation": 59, "user_id": 8257206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98ddd860115218913e90767637a789e5?s=128&d=identicon&r=PG&f=1", "display_name": "Ayush Mishra", "link": "https://stackoverflow.com/users/8257206/ayush-mishra"}, "reply_to_user": {"reputation": 1981, "user_id": 113374, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/7WZv6.jpg?s=128&g=1", "display_name": "NextInLine", "link": "https://stackoverflow.com/users/113374/nextinline"}, "edited": false, "score": 0, "creation_date": 1547070255, "post_id": 54118765, "comment_id": 95070169, "body": "@NextInLine i confirmed,ptr-&gt;left !=NULL"}, {"owner": {"reputation": 814, "user_id": 8229192, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/obcNu.jpg?s=128&g=1", "display_name": "FullStackDeveloper", "link": "https://stackoverflow.com/users/8229192/fullstackdeveloper"}, "edited": false, "score": 0, "creation_date": 1547070348, "post_id": 54118765, "comment_id": 95070211, "body": "You had better tag which programming language you are using"}, {"owner": {"reputation": 1981, "user_id": 113374, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/7WZv6.jpg?s=128&g=1", "display_name": "NextInLine", "link": "https://stackoverflow.com/users/113374/nextinline"}, "edited": false, "score": 0, "creation_date": 1547070417, "post_id": 54118765, "comment_id": 95070240, "body": "Did you create <code>head</code> using <code>new Node</code>? Otherwise <code>delete</code> isn&#39;t what you want."}, {"owner": {"reputation": 1214, "user_id": 4309985, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/d9a46a23b2bc57d11cf9c3adda670dea?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Fan", "link": "https://stackoverflow.com/users/4309985/andrew-fan"}, "edited": false, "score": 1, "creation_date": 1547070574, "post_id": 54118765, "comment_id": 95070301, "body": "Please provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. More context may be required to adequately locate the source of your segfault."}, {"owner": {"reputation": 59, "user_id": 8257206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98ddd860115218913e90767637a789e5?s=128&d=identicon&r=PG&f=1", "display_name": "Ayush Mishra", "link": "https://stackoverflow.com/users/8257206/ayush-mishra"}, "reply_to_user": {"reputation": 1214, "user_id": 4309985, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/d9a46a23b2bc57d11cf9c3adda670dea?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Fan", "link": "https://stackoverflow.com/users/4309985/andrew-fan"}, "edited": false, "score": 0, "creation_date": 1547070688, "post_id": 54118765, "comment_id": 95070348, "body": "@AndrewFan,sure i edited the question"}, {"owner": {"reputation": 1981, "user_id": 113374, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/7WZv6.jpg?s=128&g=1", "display_name": "NextInLine", "link": "https://stackoverflow.com/users/113374/nextinline"}, "edited": false, "score": 0, "creation_date": 1547070807, "post_id": 54118765, "comment_id": 95070403, "body": "It does look like you are missing code to handle the last couple of items in <code>deleation_At_End</code> - that is, when the list only has 2 or 1 nodes and you call it, then you have to do something different"}, {"owner": {"reputation": 1214, "user_id": 4309985, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/d9a46a23b2bc57d11cf9c3adda670dea?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Fan", "link": "https://stackoverflow.com/users/4309985/andrew-fan"}, "edited": false, "score": 0, "creation_date": 1547070811, "post_id": 54118765, "comment_id": 95070407, "body": "What is the intended usage of this code (IE how is it being called)?"}, {"owner": {"reputation": 59, "user_id": 8257206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98ddd860115218913e90767637a789e5?s=128&d=identicon&r=PG&f=1", "display_name": "Ayush Mishra", "link": "https://stackoverflow.com/users/8257206/ayush-mishra"}, "reply_to_user": {"reputation": 1214, "user_id": 4309985, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/d9a46a23b2bc57d11cf9c3adda670dea?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Fan", "link": "https://stackoverflow.com/users/4309985/andrew-fan"}, "edited": false, "score": 0, "creation_date": 1547070900, "post_id": 54118765, "comment_id": 95070455, "body": "@AndrewFan, head is initialized globally ,see after structure declaration."}, {"owner": {"reputation": 59, "user_id": 8257206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98ddd860115218913e90767637a789e5?s=128&d=identicon&r=PG&f=1", "display_name": "Ayush Mishra", "link": "https://stackoverflow.com/users/8257206/ayush-mishra"}, "reply_to_user": {"reputation": 1981, "user_id": 113374, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/7WZv6.jpg?s=128&g=1", "display_name": "NextInLine", "link": "https://stackoverflow.com/users/113374/nextinline"}, "edited": false, "score": 0, "creation_date": 1547070978, "post_id": 54118765, "comment_id": 95070483, "body": "@NextInLine,i added 6 items in list and called deletion_At_End(), only one time from main method,so i am trying to delete <b>just</b> the last node of list,by calling it one time."}, {"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 0, "creation_date": 1547071382, "post_id": 54118765, "comment_id": 95070657, "body": "Please provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. <a href=\"https://ideone.com/t7WB0d\" rel=\"nofollow noreferrer\">In my MCVE</a>, <code>deletion_At_End</code> the crash is obvious: You can&#39;&#39;t test <code>ptr-&gt;right!=NULL</code> before you&#39;ve tested <code>ptr!=NULL</code>."}, {"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 0, "creation_date": 1547071387, "post_id": 54118765, "comment_id": 95070661, "body": "You never check if <code>head</code> is null.  Calling <code>delete_at_End</code> on an empty list will certainly cause issues.  Same thing with a couple of your other functions -- you failed to check for an empty list."}, {"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 0, "creation_date": 1547071526, "post_id": 54118765, "comment_id": 95070718, "body": "The best way to navigate Linked list (and any pointer-driven data structure) bugs is with hand-drawn pictures of what the list should look like at every step and a debugger."}, {"owner": {"reputation": 10359, "user_id": 1216776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504692de390dabd9ca22fd716e178993?s=128&d=identicon&r=PG", "display_name": "stark", "link": "https://stackoverflow.com/users/1216776/stark"}, "edited": false, "score": 0, "creation_date": 1547071597, "post_id": 54118765, "comment_id": 95070742, "body": "Your insert_At_End is wrong.  <code>temp-&gt;left = ptr-&gt;right</code> should be <code>temp-&gt;left = ptr</code>"}], "answers": [{"comments": [{"owner": {"reputation": 1981, "user_id": 113374, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/7WZv6.jpg?s=128&g=1", "display_name": "NextInLine", "link": "https://stackoverflow.com/users/113374/nextinline"}, "edited": false, "score": 0, "creation_date": 1547130476, "post_id": 54119475, "comment_id": 95092718, "body": "you need to make sure <code>head != NULL</code> before your <code>while</code> loop otherwise <code>ptr-&gt;right</code> won&#39;t work."}], "tags": [], "owner": {"reputation": 435, "user_id": 6112830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2486a0011d4a9d302cd700cf138b8dfe?s=128&d=identicon&r=PG&f=1", "display_name": "Nima Aghli", "link": "https://stackoverflow.com/users/6112830/nima-aghli"}, "is_accepted": false, "score": 0, "last_activity_date": 1547073828, "creation_date": 1547073828, "answer_id": 54119475, "question_id": 54118765, "link": "https://stackoverflow.com/questions/54118765/segmentation-fault-during-deleting-a-node-from-the-end-of-doubly-linked-list/54119475#54119475", "title": "Segmentation fault during deleting a node from the end of doubly linked list", "body": "<p>I get the error if i have only one element in the list. When you have only one element in the list you can not set what it is in its left's right pointing to NULL because it does not exist! This works for me:</p>\n\n<pre><code>void deletion_At_End() {\n  Node *ptr = head;\n\n  while(ptr-&gt;right!=NULL) {\n      ptr = ptr-&gt;right;\n  }\n  if(ptr-&gt;left == NULL){\n      delete ptr;\n  }\n  else{\n      ptr-&gt;left-&gt;right=NULL;\n      delete ptr;\n  }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 59, "user_id": 8257206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98ddd860115218913e90767637a789e5?s=128&d=identicon&r=PG&f=1", "display_name": "Ayush Mishra", "link": "https://stackoverflow.com/users/8257206/ayush-mishra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 150, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547073828, "creation_date": 1547070005, "last_edit_date": 1547070587, "question_id": 54118765, "link": "https://stackoverflow.com/questions/54118765/segmentation-fault-during-deleting-a-node-from-the-end-of-doubly-linked-list", "title": "Segmentation fault during deleting a node from the end of doubly linked list", "body": "<p>I am trying to delete  a node from the end of the doubly linked list,but i am getting: </p>\n\n<blockquote>\n  <p>segmentation fault</p>\n</blockquote>\n\n<p>i have added different functions to add the node, from beginning , from end , and at any position.I checked the insertion of nodes,its working fine,the DLL is displayed correctly,but when it comes to deleting function,it gives segmentation fault.  </p>\n\n<pre><code>struct Node {\n    Node* left;\n    Node* right;\n    int data;\n};\nNode* head = NULL;\nvoid insertion_At_End(int element) {\n    Node* ptr = head;\n    Node* temp = new Node;\n    temp-&gt;left = temp-&gt;right = NULL;\n    temp-&gt;data = element;\n    if(head==NULL) {\n        head = temp;\n    } else {\n        while(ptr-&gt;right!=NULL) {\n            ptr = ptr-&gt;right;\n        }\n        temp-&gt;left = ptr-&gt;right;\n        ptr-&gt;right = temp;\n    }\n}\nvoid insertion_At_Beg(int element) {\n    Node* ptr = head;\n    Node* temp = new Node;\n    temp-&gt;left = temp-&gt;right = NULL;\n    temp-&gt;data = element;\n    if(head==NULL) {\n        head = temp;\n    } else {\n        temp-&gt;right = ptr;\n        ptr-&gt;left = temp;\n        head = temp;\n    }\n}\nvoid insertion_At_Pos(int element , int position , int length) {\n    Node* ptr;\n    Node* temp = new Node;\n    temp-&gt;left = temp-&gt;right = NULL;\n    temp-&gt;data = element;\n    int counter = 1;\n    if(position==1) {\n        insertion_At_Beg(element);\n    }\n    else if(position==length) {\n        insertion_At_End(element);\n    }\n    else {\n        ptr = head;\n        while(counter!=(position-1)) {\n            ptr = ptr-&gt;right;\n            counter++;\n        }\n        temp-&gt;right = ptr-&gt;right;\n        ptr-&gt;right-&gt;left = temp;\n        temp-&gt;left = ptr;\n        ptr-&gt;right = temp;\n    }\n}\nvoid deletion_At_End() {\n    Node *ptr = head;\n    while(ptr-&gt;right!=NULL) {\n        ptr = ptr-&gt;right;\n    }\n    ptr-&gt;left-&gt;right=NULL;\n    delete ptr;\n}\n</code></pre>\n"}, {"tags": ["c++", "recursion", "data-structures", "tree", "binary-tree"], "comments": [{"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 0, "creation_date": 1547074234, "post_id": 54118423, "comment_id": 95071610, "body": "<a href=\"https://ericlippert.com/2014/03/05/how-to-debug-small-programs/\" rel=\"nofollow noreferrer\">How to debug small programs</a>"}], "answers": [{"comments": [{"owner": {"reputation": 9, "user_id": 10892048, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-fSUGqzm4Kl0/AAAAAAAAAAI/AAAAAAAAABM/8liP2XrQm7E/photo.jpg?sz=128", "display_name": "Sirius Black", "link": "https://stackoverflow.com/users/10892048/sirius-black"}, "edited": false, "score": 0, "creation_date": 1547131489, "post_id": 54118571, "comment_id": 95093414, "body": "Thank you for the very detailed answer sir. I didn&#39;t get the part about wild left and right pointers. Are you talking about the last level of nodes?"}, {"owner": {"reputation": 13849, "user_id": 2602718, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CQ4Gj.jpg?s=128&g=1", "display_name": "scohe001", "link": "https://stackoverflow.com/users/2602718/scohe001"}, "reply_to_user": {"reputation": 9, "user_id": 10892048, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-fSUGqzm4Kl0/AAAAAAAAAAI/AAAAAAAAABM/8liP2XrQm7E/photo.jpg?sz=128", "display_name": "Sirius Black", "link": "https://stackoverflow.com/users/10892048/sirius-black"}, "edited": false, "score": 0, "creation_date": 1547131860, "post_id": 54118571, "comment_id": 95093671, "body": "@SiriusBlack See <a href=\"https://en.wikipedia.org/wiki/Dangling_pointer\" rel=\"nofollow noreferrer\">the Wikipedia article on Wild Pointers</a> for more. Essentially, uninitialized pointers cause UB which is baaaaaad. I&#39;d also suggest looking at some implementations of a BST print to see how they do it without passing in depth."}], "tags": [], "owner": {"reputation": 13849, "user_id": 2602718, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CQ4Gj.jpg?s=128&g=1", "display_name": "scohe001", "link": "https://stackoverflow.com/users/2602718/scohe001"}, "is_accepted": false, "score": 1, "last_activity_date": 1547068953, "creation_date": 1547068953, "answer_id": 54118571, "question_id": 54118423, "link": "https://stackoverflow.com/questions/54118423/1-node-appearing-less-in-recursive-implementation-of-tree-in-c/54118571#54118571", "title": "1 node appearing less in recursive implementation of Tree in C++", "body": "<p>Take a look at your display function:</p>\n\n<pre><code>void display(node *x,int z) {\n        if (z==1)\n            return;\n        else\n        {\n            cout&lt;&lt;it-&gt;left-&gt;data;\n            cout&lt;&lt;it-&gt;right-&gt;data;\n            display(it-&gt;left,z-1);\n            display(it-&gt;right,z-1);\n            return;\n        }\n    }\n};\n</code></pre>\n\n<p>Let's Rubber Ducky this function:</p>\n\n<blockquote>\n  <p>If we're on the lowest row of the tree, just return instead of displaying it.</p>\n  \n  <p>Else, display out two children on the row below us, and then have them display their children.</p>\n</blockquote>\n\n<p>This is an...interesting way of writing a display for a tree. I'd strongly suggest just printing the node you're currently on and then letting its children print themselves. This convoluted way of printing children yourself is causing your problem. After all, who is the root node a child of? Nobody! <strong>So who prints the root node?</strong> Nobody!!</p>\n\n<p>In addition to this, you really really <strong>really</strong> need to set the <code>left</code> and <code>right</code> pointers in your nodes. As of now you have a bunch of wild pointers. I'd suggest adding a constructor to your node class to do this for you.</p>\n\n<p>And lastly: why are you testing with a depth of 6? If I had to count that many 1's every time I ran the program to test I'm pretty sure I'd be pulling my hair out in the space of an hour. Start with a tree of depth 1 (which should fail with your current code!). If that works, go to a depth of 2. At most I'd test with a depth of 3. After all, the case of depth 6 vs. 3 is probably not at all different!</p>\n"}], "owner": {"reputation": 9, "user_id": 10892048, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-fSUGqzm4Kl0/AAAAAAAAAAI/AAAAAAAAABM/8liP2XrQm7E/photo.jpg?sz=128", "display_name": "Sirius Black", "link": "https://stackoverflow.com/users/10892048/sirius-black"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547068953, "creation_date": 1547068259, "question_id": 54118423, "link": "https://stackoverflow.com/questions/54118423/1-node-appearing-less-in-recursive-implementation-of-tree-in-c", "title": "1 node appearing less in recursive implementation of Tree in C++", "body": "<p>I have created an implementation of a complete binary-tree in C++ using class and recursion. At depth = 6 it is supposed to have 63 nodes. But in the output I can see only 62 nodes. Can someone please point out the problem?</p>\n\n<pre><code>class node{\npublic:\n    node *left, *right, *root, *it;\n    int data,m;\n\nvoid create(){\n        root = new node;\n        it = root;\n        root-&gt;data = 1;\n        const int n = 6;          // Depth to be passed                     \n        addchildren(root,n); }\n\nvoid addchildren(node *x,int z)   // Recursion (z = No. of levels)\n    {\n\n        if (z==1)\n            return;\n        else\n        {\n            it-&gt;left = new node;\n            it-&gt;left-&gt;data = 1;\n            it-&gt;right = new node;\n            it-&gt;right-&gt;data = 1;\n            addchildren(it-&gt;left,z-1);\n            addchildren(it-&gt;right,z-1);\n            return;\n        }\n    }\n\nvoid display(node *x,int z) \n    {\n\n        if (z==1)\n            return;\n        else\n        {\n            cout&lt;&lt;it-&gt;left-&gt;data;\n            cout&lt;&lt;it-&gt;right-&gt;data;\n            display(it-&gt;left,z-1);\n            display(it-&gt;right,z-1);\n            return;\n        }\n    }\n};\nint main()\n{\n    node A;\n    A.create();\n    A.display(A.root,6);\n}\n</code></pre>\n\n<p>Output : 11111111111111111111111111111111111111111111111111111111111111 (62 1s)</p>\n"}, {"tags": ["c++", "linker", "position-independent-code"], "comments": [{"owner": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "edited": false, "score": 0, "creation_date": 1547068827, "post_id": 54118414, "comment_id": 95069586, "body": "Is there a global offset table for non position independent code? I can&#39;t find documentation for this symbol in info ld. Do you know where this is documented?"}, {"owner": {"reputation": 10359, "user_id": 1216776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504692de390dabd9ca22fd716e178993?s=128&d=identicon&r=PG", "display_name": "stark", "link": "https://stackoverflow.com/users/1216776/stark"}, "edited": false, "score": 0, "creation_date": 1547068846, "post_id": 54118414, "comment_id": 95069593, "body": "You aren&#39;t taking the value of <i>GLOBAL_OFFSET_TABLE</i>, you are taking the address of a location which contains the value.  Clang is declaring 3 different locations and GCC is declaring 1."}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1547069015, "post_id": 54118414, "comment_id": 95069647, "body": "I do not think it is specified anywhere that address of GOT, as resolved by the linker, would be consistent across program execution."}], "owner": {"reputation": 10644, "user_id": 722294, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/93c0ad362f097b52bf81c30d116e7319?s=128&d=identicon&r=PG", "display_name": "Jared Hoberock", "link": "https://stackoverflow.com/users/722294/jared-hoberock"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 172, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1547068838, "creation_date": 1547068217, "last_edit_date": 1547068838, "question_id": 54118414, "link": "https://stackoverflow.com/questions/54118414/why-does-the-address-of-global-offset-table-depend-on-which-function-takes-it", "title": "Why does the address of _GLOBAL_OFFSET_TABLE_ depend on which function takes it?", "body": "<p>I would like to take and use the address of <code>_GLOBAL_OFFSET_TABLE_</code>. My expectation is that the address of this symbol does not change over the course of a program.</p>\n\n<p>However, the value of its address seems to depend on which function takes it:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;cassert&gt;\n\nextern void* _GLOBAL_OFFSET_TABLE_;\n\nvoid* foo()\n{\n  return (void*)&amp;_GLOBAL_OFFSET_TABLE_;\n}\n\nvoid* bar()\n{\n  return (void*)&amp;_GLOBAL_OFFSET_TABLE_;\n}\n\nvoid* baz()\n{\n  return (void*)&amp;_GLOBAL_OFFSET_TABLE_;\n}\n\nint main()\n{\n  std::cout &lt;&lt; \"foo(): \" &lt;&lt; foo() &lt;&lt; std::endl;\n  std::cout &lt;&lt; \"bar(): \" &lt;&lt; bar() &lt;&lt; std::endl;\n  std::cout &lt;&lt; \"baz(): \" &lt;&lt; baz() &lt;&lt; std::endl;\n\n  assert(foo() == bar());\n  assert(foo() == baz());\n  assert(bar() == baz());\n\n  return 0;\n}\n</code></pre>\n\n<p>Program output:</p>\n\n<pre><code>$ clang global_offset_table_repro.cpp -lstdc++\n$ ./a.out \nfoo(): 0x20076c\nbar(): 0x20075c\nbaz(): 0x20074c\na.out: global_offset_table_repro.cpp:27: int main(): Assertion `foo() == bar()' failed.\nAborted (core dumped)\n</code></pre>\n\n<p>Compiling with <code>-fPIC</code> produces a consistent result:</p>\n\n<pre><code>$ clang global_offset_table_repro.cpp -lstdc++ -fPIC\njhoberock@jhoberock-dt:~/dev/git/oz$ ./a.out \nfoo(): 0x601000\nbar(): 0x601000\nbaz(): 0x601000\n</code></pre>\n\n<p>As does compiling with <code>g++</code>:</p>\n\n<pre><code>$ g++ global_offset_table_repro.cpp -lstdc++\n$ ./a.out \nfoo(): 0x555eab725f80\nbar(): 0x555eab725f80\nbaz(): 0x555eab725f80\n</code></pre>\n\n<p>Compiler details:</p>\n\n<pre><code>$ clang --version ; echo ; g++ --version\nclang version 4.0.1-6 (tags/RELEASE_401/final)\nTarget: x86_64-pc-linux-gnu\nThread model: posix\nInstalledDir: /usr/bin\n\ng++ (Ubuntu 7.2.0-8ubuntu3.2) 7.2.0\nCopyright (C) 2017 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n</code></pre>\n\n<p>Is the <code>clang</code> behavior expected?</p>\n"}, {"tags": ["c++", "debugging", "c++17", "variadic-templates", "template-meta-programming"], "comments": [{"owner": {"reputation": 68702, "user_id": 1593860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1361e47a8bf06d20ffda9a686ceb7e68?s=128&d=identicon&r=PG", "display_name": "Pete Becker", "link": "https://stackoverflow.com/users/1593860/pete-becker"}, "edited": false, "score": 1, "creation_date": 1547069728, "post_id": 54118388, "comment_id": 95069943, "body": "I haven&#39;t read this carefully, so it&#39;s not an answer, but <a href=\"http://stoppels.blog/posts/compile-time-primes\" rel=\"nofollow noreferrer\">this page</a> discusses Erwin Unruh&#39;s technique for generating error messages with prime numbers at compile time. The page also discusses what purports to be a C++17 update to the technique."}], "answers": [{"comments": [{"owner": {"reputation": 4815, "user_id": 704028, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/64accf9ad1449326ae9f62e0f9e387c5?s=128&d=identicon&r=PG&f=1", "display_name": "tmaric", "link": "https://stackoverflow.com/users/704028/tmaric"}, "edited": false, "score": 0, "creation_date": 1547112516, "post_id": 54118953, "comment_id": 95082423, "body": "Cool, but this gives a compile error, that stops there. I am wondering is there something like compile-time print, that I can use for debugging."}, {"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "reply_to_user": {"reputation": 4815, "user_id": 704028, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/64accf9ad1449326ae9f62e0f9e387c5?s=128&d=identicon&r=PG&f=1", "display_name": "tmaric", "link": "https://stackoverflow.com/users/704028/tmaric"}, "edited": false, "score": 1, "creation_date": 1547112600, "post_id": 54118953, "comment_id": 95082473, "body": "@tmaric: not from standard, 0x5453 provides link to patch for gcc to do that."}], "tags": [], "owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "is_accepted": false, "score": 1, "last_activity_date": 1547072504, "last_edit_date": 1547072504, "creation_date": 1547070968, "answer_id": 54118953, "question_id": 54118388, "link": "https://stackoverflow.com/questions/54118388/is-it-possible-to-output-constexpr-variables-at-compile-time-to-debug-template-m/54118953#54118953", "title": "Is it possible to output constexpr variables at compile time to debug template metaprograms?", "body": "<p>As for displaying type at compile type for debugging, you might instantiate a non complete type using the value:</p>\n\n<pre><code>template &lt;int&gt; struct debug_int;\n</code></pre>\n\n<p>and then:</p>\n\n<pre><code>constexpr int magic = 42;\ndebug_int&lt;magic&gt;{}; // Compile error: invalid use of incomplete type 'struct debug_int&lt;42&gt;'\n</code></pre>\n\n<p><a href=\"http://coliru.stacked-crooked.com/a/10baca51df892530\" rel=\"nofollow noreferrer\">Simple Demo</a><br>\n<a href=\"http://coliru.stacked-crooked.com/a/aaf54589ae009d07\" rel=\"nofollow noreferrer\">Demo on your case</a></p>\n\n<p>BTW, your <code>taggedTypes</code> method can be simplified to:</p>\n\n<pre><code>template &lt;typename Tuple, std::size_t ... Is&gt; \nconstexpr bool taggedTypes(std::index_sequence&lt;Is...&gt;)\n{\n    return (std::is_same&lt;typename tag&lt;std::tuple_element_t&lt;2 * Is, Tuple&gt;&gt;::type,\n                         std::tuple_element_t&lt;2 * Is + 1, Tuple&gt;&gt;::value &amp;&amp; ...);   \n}\n\ntemplate &lt;typename ... Ts&gt; \nconstexpr bool taggedTypes()\n{\n    constexpr std::size_t size = sizeof ...(Ts);\n    //[[maybe_unused]]debug_odd&lt;size&gt; debug{};\n    static_assert(size % 2 == 0, \"Odd number of (Type, Tag) pairs.\");\n\n    return taggedTypes&lt;std::tuple&lt;Ts...&gt;&gt;(std::make_index_sequence&lt;size / 2&gt;{});\n}\n</code></pre>\n\n<p><a href=\"http://coliru.stacked-crooked.com/a/48b091d8be511c43\" rel=\"nofollow noreferrer\">Demo</a></p>\n"}, {"comments": [{"owner": {"reputation": 4815, "user_id": 704028, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/64accf9ad1449326ae9f62e0f9e387c5?s=128&d=identicon&r=PG&f=1", "display_name": "tmaric", "link": "https://stackoverflow.com/users/704028/tmaric"}, "edited": false, "score": 0, "creation_date": 1547114066, "post_id": 54119158, "comment_id": 95083309, "body": "Effort could pay off if it speeds up debugging, but should I be worried in any way about patching GCC?"}, {"owner": {"reputation": 34388, "user_id": 2610810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8c6433073e71478e8da278a188e1d15?s=128&d=identicon&r=PG", "display_name": "Caleth", "link": "https://stackoverflow.com/users/2610810/caleth"}, "reply_to_user": {"reputation": 4815, "user_id": 704028, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/64accf9ad1449326ae9f62e0f9e387c5?s=128&d=identicon&r=PG&f=1", "display_name": "tmaric", "link": "https://stackoverflow.com/users/704028/tmaric"}, "edited": false, "score": 1, "creation_date": 1547121238, "post_id": 54119158, "comment_id": 95087481, "body": "@tmaric you&#39;d use an unpatched gcc for non-debugging builds. Apply regular &quot;untrusted software&quot; safeguards as you see fit (e.g. run in disposable VM)"}], "tags": [], "owner": {"reputation": 8027, "user_id": 3282436, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e17caa3e07899b69539433130de1d420?s=128&d=identicon&r=PG&f=1", "display_name": "0x5453", "link": "https://stackoverflow.com/users/3282436/0x5453"}, "is_accepted": false, "score": 1, "last_activity_date": 1547072011, "creation_date": 1547072011, "answer_id": 54119158, "question_id": 54118388, "link": "https://stackoverflow.com/questions/54118388/is-it-possible-to-output-constexpr-variables-at-compile-time-to-debug-template-m/54119158#54119158", "title": "Is it possible to output constexpr variables at compile time to debug template metaprograms?", "body": "<p>This is probably more effort than you were hoping for, but there is also a <a href=\"https://github.com/saarraz/static-print\" rel=\"nofollow noreferrer\">patch</a> that you can apply to GCC to enable a <code>static_print</code> statement that does what you are looking for.</p>\n\n<pre><code>template&lt;typename T, int s&gt;\nstruct test\n{\n    static_print(\"The template \", ::test, \" has been instantiated as \", test, \". By the way, s + 1 is \", s + 1);\n};\n\nint main() {\n    test&lt;int, 3&gt; y;\n    return 0;\n}\n</code></pre>\n\n<blockquote>\n  <p>Compiling the above program prints out (at compile time): <code>The template test has been instantiated as test&lt;int, 3&gt;. By the way, s + 1 is 4</code></p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 4815, "user_id": 704028, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/64accf9ad1449326ae9f62e0f9e387c5?s=128&d=identicon&r=PG&f=1", "display_name": "tmaric", "link": "https://stackoverflow.com/users/704028/tmaric"}, "is_accepted": false, "score": 0, "last_activity_date": 1547119977, "last_edit_date": 1547119977, "creation_date": 1547119205, "answer_id": 54127575, "question_id": 54118388, "link": "https://stackoverflow.com/questions/54118388/is-it-possible-to-output-constexpr-variables-at-compile-time-to-debug-template-m/54127575#54127575", "title": "Is it possible to output constexpr variables at compile time to debug template metaprograms?", "body": "<p>I dug around a bit and found a probably ugly solution that doesn't stop the compilation and doesn't require a patch. I am using a metafunction that causes a compiler warning to flag. For example, with gcc, <code>-Wbool-compare</code> can be used like this, to output results of compile-time calculations:</p>\n\n<pre><code>template&lt;int N&gt; \nconstexpr bool warning_print()\n{\n    return (0 &lt; N &lt; 100); \n}\n\ntemplate&lt;int N, int M&gt; \nconstexpr void iterate()\n{\n    warning_print&lt;N&gt;(); \n\n    if constexpr (N + 1 &lt; M)\n        iterate&lt;N+1, M&gt;(); \n\n    return; \n}\n\nusing namespace std; \n\nint main()\n{\n    iterate&lt;5, 10&gt;(); \n}\n</code></pre>\n\n<p>This gives (with grep on Linux): </p>\n\n<pre><code>$ mainmake 2&gt;&amp;1 | grep -Ev 'recursive|required|comparisons like|(0 &lt; N &lt; 100)' \nmain.cpp: In function \u2018constexpr bool warning_print()\u2019:\nmain.cpp:4:19: warning: comparison of constant \u2018100\u2019 with boolean expression is always true [-Wbool-compare]\n             ~~~~~~^~~~~\nmain.cpp: In instantiation of \u2018constexpr bool warning_print() [with int N = 5]\u2019:\n             ~~^~~\nmain.cpp: In instantiation of \u2018constexpr bool warning_print() [with int N = 6]\u2019:\nmain.cpp: In instantiation of \u2018constexpr bool warning_print() [with int N = 7]\u2019:\nmain.cpp: In instantiation of \u2018constexpr bool warning_print() [with int N = 8]\u2019:\nmain.cpp: In instantiation of \u2018constexpr bool warning_print() [with int N = 9]\u2019:\n</code></pre>\n"}], "owner": {"reputation": 4815, "user_id": 704028, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/64accf9ad1449326ae9f62e0f9e387c5?s=128&d=identicon&r=PG&f=1", "display_name": "tmaric", "link": "https://stackoverflow.com/users/704028/tmaric"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 502, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1547119977, "creation_date": 1547068141, "last_edit_date": 1547072570, "question_id": 54118388, "link": "https://stackoverflow.com/questions/54118388/is-it-possible-to-output-constexpr-variables-at-compile-time-to-debug-template-m", "title": "Is it possible to output constexpr variables at compile time to debug template metaprograms?", "body": "<p>I am debugging a metafunction that iterates over a variadic template parameter and checks pairs (<code>Type</code>, <code>Tag</code>) to see if each <code>Type</code> is tagged with the corresponding <code>Tag</code>: </p>\n\n<pre><code>template&lt;typename Type, typename Tag, typename ... Rest&gt; \nconstexpr bool taggedTypes()\n{\n    constexpr std::size_t restN = sizeof ...(Rest);  \n    static_assert(restN % 2 == 0, \"Odd number of (Type, Tag) pairs.\");\n\n    constexpr bool pairDoesntMatch = ! taggedType&lt;Type, Tag&gt;(); \n    if constexpr (pairDoesntMatch)\n        return false; \n\n    // Single pair, empty Rest, pair matches. \n    if (restN == 0)\n        return true; \n\n    // More than two pairs, test further.\n    if (restN &gt; 2)\n        taggedTypes&lt;Rest...&gt;(); \n\n    return true;\n}\n</code></pre>\n\n<p>Something is wrong with my code, and I want to debug it. </p>\n\n<p>If I use <a href=\"https://en.cppreference.com/w/cpp/language/static_assert\" rel=\"nofollow noreferrer\"><code>static_assert</code></a> to output <code>restN</code> or any other <code>constexpr</code> variable, my program will break at compile time at the point of assertion with an output I prescribe. Also, it is not clear to me yet how to write down anything apart from a string literal with <code>static_assert()</code>. </p>\n\n<p>How can I make the metaprogram iterate over the variadic template parameter and output stuff that I need for debugging?</p>\n\n<p>The complete example: </p>\n\n<pre><code>#include &lt;cassert&gt; \n#include &lt;type_traits&gt;\n#include &lt;cstddef&gt;\n\nstruct fruit_tag {}; \nstruct veggie_tag {}; \n\n\ntemplate&lt;typename T&gt;\nstruct tag;\n\ntemplate&lt;typename T, typename Tag&gt;  \nconstexpr \nbool \ntaggedType()\n{\n    constexpr bool sameTypes \n        = std::is_same&lt;typename tag&lt;T&gt;::type, Tag&gt;(); \n\n    static_assert(sameTypes); \n\n    return sameTypes; \n}\n\ntemplate&lt;typename Type, typename Tag, typename ... Rest&gt; \nconstexpr bool taggedTypes()\n{\n    constexpr std::size_t restN = sizeof ...(Rest);  \n    static_assert(restN % 2 == 0, \"Odd number of (Type, Tag) pairs.\");\n\n    constexpr bool pairDoesntMatch = ! taggedType&lt;Type, Tag&gt;(); \n    if constexpr (pairDoesntMatch)\n        return false; \n\n    // Single pair, empty Rest, pair matches. \n    if (restN == 0)\n        return true; \n\n    // Many pairs, test further.\n    if (restN &gt; 2)\n        taggedTypes&lt;Rest...&gt;(); \n\n    return true;\n}\n\nclass Orange {}; \n\ntemplate&lt;&gt;\nstruct tag&lt;Orange&gt;\n{\n    using type = fruit_tag;  \n};\n\nclass Apple {}; \n\ntemplate&lt;&gt;\nstruct tag&lt;Apple&gt;\n{\n    using type = fruit_tag;  \n};\n\nclass Turnip{}; \n\ntemplate&lt;&gt;\nstruct tag&lt;Turnip&gt;\n{\n    using type = veggie_tag; \n};\n\nint main()\n{\n    static_assert(taggedTypes&lt;Turnip, veggie_tag, Orange, fruit_tag&gt;()); \n};\n</code></pre>\n"}, {"tags": ["c++", "oop", "c++11"], "comments": [{"owner": {"reputation": 3125, "user_id": 2878796, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8bxWv.png?s=128&g=1", "display_name": "UnholySheep", "link": "https://stackoverflow.com/users/2878796/unholysheep"}, "edited": false, "score": 0, "creation_date": 1547068073, "post_id": 54118365, "comment_id": 95069236, "body": "You can&#39;t - you need to downcast"}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 2, "creation_date": 1547068101, "post_id": 54118365, "comment_id": 95069249, "body": "If you need <code>Obj</code> to use <code>b</code>&#39;s interface, then <code>Obj</code> needs to be a <code>b*</code>."}, {"owner": {"reputation": 4599, "user_id": 2055064, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/815c89ab1784fd780fe7faf44ebfc79f?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2055064/thomas"}, "reply_to_user": {"reputation": 3125, "user_id": 2878796, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8bxWv.png?s=128&g=1", "display_name": "UnholySheep", "link": "https://stackoverflow.com/users/2878796/unholysheep"}, "edited": false, "score": 1, "creation_date": 1547068748, "post_id": 54118365, "comment_id": 95069556, "body": "@UnholySheep afaik that would be upcasting"}, {"owner": {"reputation": 11, "user_id": 9509143, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Adham Mamdouh", "link": "https://stackoverflow.com/users/9509143/adham-mamdouh"}, "reply_to_user": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547068761, "post_id": 54118365, "comment_id": 95069563, "body": "Okay but if i have base class called shape and derived classes everyone inherits from it and has additional function and i made array[4] of type Shape and i want every index to be any of the derived classes how can i do that @Fran&#231;oisAndrieux"}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "reply_to_user": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547069566, "post_id": 54118365, "comment_id": 95069865, "body": "@Fran&#231;oisAndrieux use <code>dynamic_cast</code> to check if a given <code>shape*</code> is pointing at the desired derived class that you want to call into."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1547094683, "post_id": 54118365, "comment_id": 95075876, "body": "You need to have a (pure) virtual function in <code>a</code> and implement it in <code>b</code>. A piece of program that handles <code>a</code>s should never know that <code>b</code> or any other derived class ever exists. This is the whole purpose of having derived classes. I recommend getting a book on object oriented software design."}], "answers": [{"comments": [{"owner": {"reputation": 7407, "user_id": 1757805, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/AMueI.jpg?s=128&g=1", "display_name": "Francis Cugler", "link": "https://stackoverflow.com/users/1757805/francis-cugler"}, "edited": false, "score": 0, "creation_date": 1547069118, "post_id": 54118424, "comment_id": 95069686, "body": "You beat me to it!"}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "edited": false, "score": 0, "creation_date": 1547069185, "post_id": 54118424, "comment_id": 95069713, "body": "Or static cast. But only when you know the type at compile time."}], "tags": [], "owner": {"reputation": 32321, "user_id": 173397, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pqKT8.jpg?s=128&g=1", "display_name": "pm100", "link": "https://stackoverflow.com/users/173397/pm100"}, "is_accepted": false, "score": 5, "last_activity_date": 1547069718, "last_edit_date": 1547069718, "creation_date": 1547068261, "answer_id": 54118424, "question_id": 54118365, "link": "https://stackoverflow.com/questions/54118365/calling-child-class-function/54118424#54118424", "title": "calling child class function", "body": "<p>Use <code>dynamic_cast</code>:</p>\n\n<pre><code>class a{\npublic:\n    virtual ~a(){}\n    virtual void print(){ cout &lt;&lt; \"From a\" &lt;&lt; endl; }\n};\n\nclass b: public a{\npublic:\n    void print(){ cout &lt;&lt; \"Form b\" &lt;&lt; endl; }\n    void printFunction(){ cout &lt;&lt; \"Exist in b\" &lt;&lt; endl; }\n};\n\nint main() {\n\n    a* Obj = new b;\n\n    Obj-&gt;print();\n\n    b* bObj = dynamic_cast&lt;b*&gt;(a);\n    if (bObj)\n        bObj-&gt;printFunction();\n\n    delete a;\n\n    return 0;\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 11, "user_id": 9509143, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Adham Mamdouh", "link": "https://stackoverflow.com/users/9509143/adham-mamdouh"}, "edited": false, "score": 1, "creation_date": 1547071321, "post_id": 54118919, "comment_id": 95070632, "body": "Can you just tell me what is the different between these two lines <code>dynamic_cast&lt;derrived*&gt;(ptr_derrived)-&gt;printFunction();</code> and <code>((derrived*)ptr_derrived)-&gt;printFunction();</code>"}, {"owner": {"reputation": 259, "user_id": 2898736, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/pmVNS.jpg?s=128&g=1", "display_name": "andres", "link": "https://stackoverflow.com/users/2898736/andres"}, "reply_to_user": {"reputation": 11, "user_id": 9509143, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Adham Mamdouh", "link": "https://stackoverflow.com/users/9509143/adham-mamdouh"}, "edited": false, "score": 0, "creation_date": 1547073465, "post_id": 54118919, "comment_id": 95071391, "body": "<code>dynamic_cast</code> is almost exclusively used for handling polymorphism. Which is your intention.   The <code>C-style cast </code> can be used as a replacement for the <code>dynamic_cast</code> in some instances, but can be extremely dangerous because of the ability to devolve into a <code>reinterpret_cast</code>"}, {"owner": {"reputation": 259, "user_id": 2898736, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/pmVNS.jpg?s=128&g=1", "display_name": "andres", "link": "https://stackoverflow.com/users/2898736/andres"}, "reply_to_user": {"reputation": 11, "user_id": 9509143, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Adham Mamdouh", "link": "https://stackoverflow.com/users/9509143/adham-mamdouh"}, "edited": false, "score": 0, "creation_date": 1547073566, "post_id": 54118919, "comment_id": 95071422, "body": "The &quot;new-style casts&quot; in this case <code>dynamic_cast</code> were introduced to give programmers a chance to state their intentions more clearly and for the compiler to catch more errors."}, {"owner": {"reputation": 259, "user_id": 2898736, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/pmVNS.jpg?s=128&g=1", "display_name": "andres", "link": "https://stackoverflow.com/users/2898736/andres"}, "reply_to_user": {"reputation": 11, "user_id": 9509143, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Adham Mamdouh", "link": "https://stackoverflow.com/users/9509143/adham-mamdouh"}, "edited": false, "score": 0, "creation_date": 1547073572, "post_id": 54118919, "comment_id": 95071423, "body": "A secondary reason for introducing the new-style cast was that C-style casts are very hard to spot in a program"}, {"owner": {"reputation": 4955, "user_id": 5699329, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/86758f7ce8c15546da5968c504360e55?s=128&d=identicon&r=PG", "display_name": "rsjaffe", "link": "https://stackoverflow.com/users/5699329/rsjaffe"}, "edited": false, "score": 1, "creation_date": 1547091741, "post_id": 54118919, "comment_id": 95075284, "body": "You should test a <code>dynamic_cast</code> for failure by seeing if the ptf returned is <code>= nullptr</code>."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1547094363, "post_id": 54118919, "comment_id": 95075830, "body": "Dynamic cast is almost exclusively used to patch up a broken design. It is not a proper way to handle polymorphism. One should use a virtual function instead."}, {"owner": {"reputation": 8430, "user_id": 2742717, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d1dec1aa6accf3589489ebd42634f7a0?s=128&d=identicon&r=PG", "display_name": "Swift - Friday Pie", "link": "https://stackoverflow.com/users/2742717/swift-friday-pie"}, "edited": false, "score": 0, "creation_date": 1547095418, "post_id": 54118919, "comment_id": 95075998, "body": "this kind sounds like a step toward need of observer or ECS patterns."}], "tags": [], "owner": {"reputation": 259, "user_id": 2898736, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/pmVNS.jpg?s=128&g=1", "display_name": "andres", "link": "https://stackoverflow.com/users/2898736/andres"}, "is_accepted": false, "score": 0, "last_activity_date": 1547092549, "last_edit_date": 1547092549, "creation_date": 1547070739, "answer_id": 54118919, "question_id": 54118365, "link": "https://stackoverflow.com/questions/54118365/calling-child-class-function/54118919#54118919", "title": "calling child class function", "body": "<p>You could downcast using <a href=\"https://en.cppreference.com/w/cpp/language/dynamic_cast\" rel=\"nofollow noreferrer\">dynamic_cast</a> conversion</p>\n\n<pre><code>class base {\n  public:\n    void print() {std::cout &lt;&lt; \"base class print\";}\n};\n\nclass derived : public base {\n  public: \n    void printFunction() {std::cout &lt;&lt; \"derived class print\";}\n};\n\nint main() {\n\n  base* ptr_derrived  = new derived();\n\n  if(Derived* d = dynamic_cast&lt;derived*&gt;(ptr_derived) {\n    std::cout &lt;&lt; \"downcast successful\\n\";\n    d-&gt;printFunction(); // safe to call\n  }\n\n  delete ptr_derrived;\n\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 9509143, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Adham Mamdouh", "link": "https://stackoverflow.com/users/9509143/adham-mamdouh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1547092549, "creation_date": 1547067988, "last_edit_date": 1547069024, "question_id": 54118365, "link": "https://stackoverflow.com/questions/54118365/calling-child-class-function", "title": "calling child class function", "body": "<p>How can I call a child function from a pointer of type parent that points to the child? </p>\n\n<pre><code>class a{\npublic:\n    virtual void print(){cout &lt;&lt; \"From a\" &lt;&lt; endl;}\n};\n\nclass b: public a{\npublic:\n    void print(){cout &lt;&lt; \"Form b\" &lt;&lt; endl;}\n    void printFunction(){cout &lt;&lt; \"Exist in b\" &lt;&lt; endl;}\n};\n\nint main() {\n\n    a* Obj = new b;\n\n    Obj-&gt;print();\n    Obj-&gt;printFunction();\n    return 0;\n}\n</code></pre>\n\n<p>Here I have a pointer of type \"a\" that points to \"b\".\nI want to call \"printFunction\" that's defined only in class b. </p>\n\n<p>I got this error: </p>\n\n<blockquote>\n  <p>'class a' has no member named 'printFunction'</p>\n</blockquote>\n\n<p>The question is how can I call \"printFunction\" using this pointer?\nor how To apply casting here?</p>\n"}, {"tags": ["c++", "pcap", "libpcap", "packet-injection"], "comments": [{"owner": {"reputation": 751, "user_id": 5552166, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8941926688c6212b73aa67cbb2c70428?s=128&d=identicon&r=PG&f=1", "display_name": "hessam hedieh", "link": "https://stackoverflow.com/users/5552166/hessam-hedieh"}, "edited": false, "score": 0, "creation_date": 1547067794, "post_id": 54118250, "comment_id": 95069117, "body": "Have a look at <a href=\"http://www.microhowto.info/howto/send_an_arbitrary_ethernet_frame_using_libpcap.html\" rel=\"nofollow noreferrer\">this</a>"}, {"owner": {"reputation": 617, "user_id": 7280140, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/fHhkQ.jpg?s=128&g=1", "display_name": "Ahmed Hussein", "link": "https://stackoverflow.com/users/7280140/ahmed-hussein"}, "reply_to_user": {"reputation": 751, "user_id": 5552166, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8941926688c6212b73aa67cbb2c70428?s=128&d=identicon&r=PG&f=1", "display_name": "hessam hedieh", "link": "https://stackoverflow.com/users/5552166/hessam-hedieh"}, "edited": false, "score": 0, "creation_date": 1547104424, "post_id": 54118250, "comment_id": 95078559, "body": "But this injects a packet on a local device by device name, not the ip address"}, {"owner": {"reputation": 751, "user_id": 5552166, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8941926688c6212b73aa67cbb2c70428?s=128&d=identicon&r=PG&f=1", "display_name": "hessam hedieh", "link": "https://stackoverflow.com/users/5552166/hessam-hedieh"}, "edited": false, "score": 0, "creation_date": 1547104769, "post_id": 54118250, "comment_id": 95078684, "body": "Isnt the ARP sending example code in link above redirecting to a specific IP?"}, {"owner": {"reputation": 617, "user_id": 7280140, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/fHhkQ.jpg?s=128&g=1", "display_name": "Ahmed Hussein", "link": "https://stackoverflow.com/users/7280140/ahmed-hussein"}, "reply_to_user": {"reputation": 751, "user_id": 5552166, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8941926688c6212b73aa67cbb2c70428?s=128&d=identicon&r=PG&f=1", "display_name": "hessam hedieh", "link": "https://stackoverflow.com/users/5552166/hessam-hedieh"}, "edited": false, "score": 0, "creation_date": 1547111320, "post_id": 54118250, "comment_id": 95081741, "body": "I see but the main function code is missing. All what I see is that the IP parameter is passed to the main function, but it didn&#39;t clarify how it was used for the actual redirection"}, {"owner": {"reputation": 353, "user_id": 12241369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94ed30a28de8aa940f5c8ebccd6bc775?s=128&d=identicon&r=PG&f=1", "display_name": "Janith", "link": "https://stackoverflow.com/users/12241369/janith"}, "edited": false, "score": 0, "creation_date": 1597027533, "post_id": 54118250, "comment_id": 111990792, "body": "first,you want to find mac address of interface and default gateway.After,you can generate an data frame.(ethernet headers+ip headers+tcp or udp headers+application layer protocol headers + data)"}], "owner": {"reputation": 617, "user_id": 7280140, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/fHhkQ.jpg?s=128&g=1", "display_name": "Ahmed Hussein", "link": "https://stackoverflow.com/users/7280140/ahmed-hussein"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 265, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1547067479, "creation_date": 1547067479, "question_id": 54118250, "link": "https://stackoverflow.com/questions/54118250/send-packet-to-an-ip-using-pcap-inject", "title": "send packet to an ip using pcap_inject", "body": "<p>I am able to send a packet to a specific IP address using scapy like <a href=\"https://stackoverflow.com/questions/13797624/generate-dummy-packets-of-fixed-size/13798935#13798935\">this</a>.\nNow, I am new to <code>libcap</code> and I would like to do the same with <code>pcap_inject()</code>.  I am unable to find any code snippet online that uses <code>pcap_inject()</code> to send to specific <strong>ip address</strong>. Could anyone help me ?</p>\n"}, {"tags": ["c++", "performance", "math"], "comments": [{"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547067420, "post_id": 54118163, "comment_id": 95068951, "body": "Know that if you are using <code>inline</code> to inline those functions for a performance gain that the <code>inline</code> keyword doesn&#39;t carry much weight (if any) in determining when functions are inlined anymore."}, {"owner": {"reputation": 44000, "user_id": 535275, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/Ft2Mw.jpg?s=128&g=1", "display_name": "Scott Hunter", "link": "https://stackoverflow.com/users/535275/scott-hunter"}, "edited": false, "score": 0, "creation_date": 1547067435, "post_id": 54118163, "comment_id": 95068956, "body": "Your tests are VERY lopsided; result is almost always false."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547067594, "post_id": 54118163, "comment_id": 95069020, "body": "It seems likely that since <code>a</code> is essentially a <code>constexpr</code> and you never use the result of your functions your function calls can both be precalculated at compile time and completely optimized out. I wouldn&#39;t count on the accuracy of this benchmark."}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1547067624, "post_id": 54118163, "comment_id": 95069036, "body": "How are you compiling?  I get <code>inRangeComp</code> as the fastest.  Also, you can make the min max version with a single branch like <a href=\"http://coliru.stacked-crooked.com/a/d31d2c98cf3798ac\" rel=\"nofollow noreferrer\">this</a>"}, {"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 0, "creation_date": 1547070413, "post_id": 54118163, "comment_id": 95070235, "body": "<a href=\"http://quick-bench.com/0I7p8PIv-uqZ2bXq2sQwCh6FoNA\" rel=\"nofollow noreferrer\">quick-bench results</a>"}, {"owner": {"reputation": 53, "user_id": 10257651, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wteuV.jpg?s=128&g=1", "display_name": "Graham Palmer", "link": "https://stackoverflow.com/users/10257651/graham-palmer"}, "reply_to_user": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547071370, "post_id": 54118163, "comment_id": 95070652, "body": "@Fran&#231;oisAndrieux Indeed I believe that is what was happening. I&#39;ve updated the code to be a little more robust in terms of preventing optimization. Thanks for the tip as well about inline - I&#39;m vaguely aware of the fact but decided to beat the dead fish in this case.  The comp version appears marginally faster now, with the results being 351, 239, 236 respectively.   I&#39;m using Visual C++ 2017 64bit in release mode."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547071494, "post_id": 54118163, "comment_id": 95070707, "body": "@GrahamPalmer That takes care of the result being ignored, but you still have an issue where since <code>a</code> is a compile time constant, the compiler could precalculate the results. That can be fixed by taking <code>a</code> as a user input."}, {"owner": {"reputation": 53, "user_id": 10257651, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wteuV.jpg?s=128&g=1", "display_name": "Graham Palmer", "link": "https://stackoverflow.com/users/10257651/graham-palmer"}, "reply_to_user": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547071701, "post_id": 54118163, "comment_id": 95070771, "body": "@Fran&#231;oisAndrieux I&#39;m not following. How would that influence the difference in runtime between the three implementations?"}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547071757, "post_id": 54118163, "comment_id": 95070790, "body": "@GrahamPalmer If the results are precalculated your functions don&#39;t have to be called at runtime. Edit : For example I&#39;m pretty sure a conforming compiler could remove all of your benchmark, print 0 durations and just print the correct <code>res</code> result."}, {"owner": {"reputation": 9311, "user_id": 4944425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05592a58619d128e2eee1c3c17801e76?s=128&d=identicon&r=PG&f=1", "display_name": "Bob__", "link": "https://stackoverflow.com/users/4944425/bob"}, "edited": false, "score": 0, "creation_date": 1547074404, "post_id": 54118163, "comment_id": 95071671, "body": "Why are you using <code>p &lt; v1 != p &lt; v2</code> instead of <code>p &gt;= v1 &amp;&amp; p &lt;= v2</code>? The performance is similar <a href=\"http://quick-bench.com/EPzOEo167ettFg-zZFqMn-lAHQw\" rel=\"nofollow noreferrer\">quick-bench.com/EPzOEo167ettFg-zZFqMn-lAHQw</a> and for p == v1  or p == v2 it gives a different result from the other tests."}, {"owner": {"reputation": 53, "user_id": 10257651, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wteuV.jpg?s=128&g=1", "display_name": "Graham Palmer", "link": "https://stackoverflow.com/users/10257651/graham-palmer"}, "reply_to_user": {"reputation": 9311, "user_id": 4944425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05592a58619d128e2eee1c3c17801e76?s=128&d=identicon&r=PG&f=1", "display_name": "Bob__", "link": "https://stackoverflow.com/users/4944425/bob"}, "edited": false, "score": 0, "creation_date": 1547076182, "post_id": 54118163, "comment_id": 95072126, "body": "@Bob__ If p=3, v1 = 4, and v2 = 2, this would return false, even though 3 is clearly between 2 and 4. This distinction between my problem and the one I linked at the beginning is I don&#39;t know ahead of time which of v1 or v2 is larger - hence having to deal with std::max/min."}, {"owner": {"reputation": 15641, "user_id": 126995, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bdd0d42e87a7c2636f0570ce12d069e5?s=128&d=identicon&r=PG", "display_name": "Soonts", "link": "https://stackoverflow.com/users/126995/soonts"}, "edited": false, "score": 0, "creation_date": 1547086959, "post_id": 54118163, "comment_id": 95074414, "body": "There&#39;s no reason to avoid min/max. Modern compilers compile them into a single very fast instruction, <code>minsd</code> / <code>maxsd</code>."}], "answers": [{"comments": [{"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1547083670, "post_id": 54120703, "comment_id": 95073725, "body": "Nit, may be more readable as <code>? v1 &lt;= p &amp;&amp; p &lt; = v2 : v2 &lt;= p &amp;&amp; p &lt;= v1;</code> (up to you, some prefer Yoda conditionals)"}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1547084060, "post_id": 54120703, "comment_id": 95073813, "body": "It all does the same thing, but when you get old, it&#39;s just easier to read <code>p</code> in the middle of the other two values that way. Good eye on potential overflow issues."}], "tags": [], "owner": {"reputation": 9311, "user_id": 4944425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05592a58619d128e2eee1c3c17801e76?s=128&d=identicon&r=PG&f=1", "display_name": "Bob__", "link": "https://stackoverflow.com/users/4944425/bob"}, "is_accepted": true, "score": 2, "last_activity_date": 1547083893, "last_edit_date": 1547083893, "creation_date": 1547082702, "answer_id": 54120703, "question_id": 54118163, "link": "https://stackoverflow.com/questions/54118163/most-efficient-way-to-determine-if-value-between-two-other-values-inclusive/54120703#54120703", "title": "Most efficient way to determine if value between two other values, inclusive", "body": "<p>The first test:</p>\n\n<pre><code>(p - v1) * (p - v2) &lt;= 0\n</code></pre>\n\n<p>May result in overflow or underflow, due to the arithmetic operations.</p>\n\n<p>The last one:</p>\n\n<pre><code>p &lt; v1 != p &lt; v2\n</code></pre>\n\n<p>Doesn't provide the same results as the others, which are inclusive in respect of the boundaries <code>v1</code> and <code>v2</code>. It's an admittedly small difference, considering the range and precision of the type <code>double</code>, but it may be significant.</p>\n\n<p>Another option is to explicitly expand the logic of the second function:</p>\n\n<pre><code>p &lt;= std::max(v1, v2) &amp;&amp; p &gt;= std::min(v1, v2)     // v1 and v2 are compared twice\n</code></pre>\n\n<p>Into something like this:</p>\n\n<pre><code>bool inRangeComp(double p, double v1, double v2) {\n    return v1 &lt;= v2                                // &lt;- v1 and v2 are compared only once\n        ? v1 &lt;= p &amp;&amp; p &lt;= v2 \n        : v2 &lt;= p &amp;&amp; p &lt;= v1;\n}\n</code></pre>\n\n<p>At least one compiler (gcc 8.2), <a href=\"http://quick-bench.com/-CzJMuHKUAvicWFT1CjKzFuFXdo\" rel=\"nofollow noreferrer\">HERE</a> (thanks to <a href=\"https://stackoverflow.com/users/2684539/jarod42\">jarod42</a> for the linked snippet), seems to prefer this version over the alternatives.</p>\n"}], "owner": {"reputation": 53, "user_id": 10257651, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wteuV.jpg?s=128&g=1", "display_name": "Graham Palmer", "link": "https://stackoverflow.com/users/10257651/graham-palmer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 0, "accepted_answer_id": 54120703, "answer_count": 1, "score": 0, "last_activity_date": 1547126007, "creation_date": 1547067044, "last_edit_date": 1547126007, "question_id": 54118163, "link": "https://stackoverflow.com/questions/54118163/most-efficient-way-to-determine-if-value-between-two-other-values-inclusive", "title": "Most efficient way to determine if value between two other values, inclusive", "body": "<p>Similar to <a href=\"https://stackoverflow.com/questions/17095324/fastest-way-to-determine-if-an-integer-is-between-two-integers-inclusive-with\">Fastest way to determine if an integer is between two integers (inclusive) with known sets of values</a>, I wish to figure out if some value (most likely a double-precision floating point number) is between two other values (of the same type). The caveat is that I don't know already which value is larger than the other and I'm trying to determine if I should/how I should avoid using std::max/min. Here is some code I've tried to test this with already:</p>\n\n<pre><code>inline bool inRangeMult(double p, double v1, double v2) {\n    return (p - v1) * (p - v2) &lt;= 0;\n}\n\ninline bool inRangeMinMax(double p, double v1, double v2) {\n    return p &lt;= std::max(v1, v2) &amp;&amp; p &gt;= std::min(v1, v2);\n}\n\ninline bool inRangeComp(double p, double v1, double v2) {\n    return p &lt; v1 != p &lt; v2;\n}\n\nint main()\n{\n    double a = 1e4;\n\n    std::clock_t start;\n    double duration;\n    bool res = false;\n\n    start = std::clock();\n    for (size_t i = 0; i &lt; 2e4; ++i) {\n        for (size_t j = 0; j &lt; 2e4; ++j) {\n            res = inRangeMult(a, i, j) ? res : !res;\n        }\n    }\n    duration = std::clock() - start;\n    std::cout &lt;&lt; \"InRangeMult: \" &lt;&lt; duration &lt;&lt; std::endl;\n\n    start = std::clock();\n    for (size_t i = 0; i &lt; 2e4; ++i) {\n        for (size_t j = 0; j &lt; 2e4; ++j) {\n            res = inRangeMinMax(a, i, j) ? res : !res;\n        }\n    }\n    duration = std::clock() - start;\n    std::cout &lt;&lt; \"InRangeMinMax: \" &lt;&lt; duration &lt;&lt; std::endl;\n\n    start = std::clock();\n    for (size_t i = 0; i &lt; 2e4; ++i) {\n        for (size_t j = 0; j &lt; 2e4; ++j) {\n            res = inRangeComp(a, i, j) ? res : !res;\n        }\n    }\n    duration = std::clock() - start;\n    std::cout &lt;&lt; \"InRangeComp: \" &lt;&lt; duration &lt;&lt; std::endl;\n\n    std::cout &lt;&lt; \"Tricking the compiler by printing inane res: \" &lt;&lt; res &lt;&lt; std::endl;\n}\n</code></pre>\n\n<p>On most runs I'm finding that using std::min/max is still fastest, (latest run prints 346, 310, and 324 respectively), but I'm not 100% confident this is the best test setup, or that I've exhausted all of the reasonable implementations.</p>\n\n<p>I'd appreciate anyone's input with a better profiling setup and/or better implementation.</p>\n\n<p>EDIT: Updated code to make it less prone to compiler optimization. </p>\n\n<p>2nd EDIT: Tweaked value of a and number of iterations. Results for one run are:</p>\n\n<ul>\n<li>inRangeMult: 1337</li>\n<li>inRangeMinMaz: 1127</li>\n<li>inRangeComp: 729</li>\n</ul>\n"}, {"tags": ["c++", "qt"], "comments": [{"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 3, "creation_date": 1547067070, "post_id": 54118145, "comment_id": 95068814, "body": "Did you compile with optimizations turned on?"}, {"owner": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "edited": false, "score": 0, "creation_date": 1547068405, "post_id": 54118145, "comment_id": 95069398, "body": "To be able to say what can be improved we need to see your program, not just a part of it."}, {"owner": {"reputation": 29, "user_id": 10537788, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/axVAs.png?s=128&g=1", "display_name": "nkforce", "link": "https://stackoverflow.com/users/10537788/nkforce"}, "reply_to_user": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1547068740, "post_id": 54118145, "comment_id": 95069552, "body": "@NathanOliver How do I do it? I am new to qt and c++. I always run the test by pressing &quot;ctrl + r&quot; in qt creator"}, {"owner": {"reputation": 29, "user_id": 10537788, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/axVAs.png?s=128&g=1", "display_name": "nkforce", "link": "https://stackoverflow.com/users/10537788/nkforce"}, "reply_to_user": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "edited": false, "score": 0, "creation_date": 1547069124, "post_id": 54118145, "comment_id": 95069690, "body": "@Slava sorry about that! updated!"}, {"owner": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "edited": false, "score": 0, "creation_date": 1547069463, "post_id": 54118145, "comment_id": 95069826, "body": "You should start optimization by replacing <code>n*m</code> by something better. And you probably can do that in python as well."}, {"owner": {"reputation": 29, "user_id": 10537788, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/axVAs.png?s=128&g=1", "display_name": "nkforce", "link": "https://stackoverflow.com/users/10537788/nkforce"}, "reply_to_user": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "edited": false, "score": 0, "creation_date": 1547071075, "post_id": 54118145, "comment_id": 95070528, "body": "@Slava I updated some examples of the source data files. would you give me some recommendation for better data structure or algorithms?"}, {"owner": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "edited": false, "score": 0, "creation_date": 1547085438, "post_id": 54118145, "comment_id": 95074101, "body": "Sure, but you need to describe what you are trying to achieve first. I am not going to reverse engineer your solution for various reasons."}], "answers": [{"comments": [{"owner": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "edited": false, "score": 0, "creation_date": 1547068604, "post_id": 54118474, "comment_id": 95069490, "body": "First and foremost optimization is to look into data structure and algorithms. What you mention are mostly microoptimizations."}, {"owner": {"reputation": 6147, "user_id": 3767076, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/64707b213de57fb785081ba23aaea2cd?s=128&d=identicon&r=PG&f=1", "display_name": "Felix", "link": "https://stackoverflow.com/users/3767076/felix"}, "reply_to_user": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "edited": false, "score": 0, "creation_date": 1547069489, "post_id": 54118474, "comment_id": 95069833, "body": "You are right - optimizing the actual structures would propably have a greater effect, but one should not neglect those, as many small things can have a big effect, especially when they happen often"}, {"owner": {"reputation": 29, "user_id": 10537788, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/axVAs.png?s=128&g=1", "display_name": "nkforce", "link": "https://stackoverflow.com/users/10537788/nkforce"}, "edited": false, "score": 0, "creation_date": 1547069623, "post_id": 54118474, "comment_id": 95069897, "body": "omg. I tried &quot;3&quot; and now it only takes 15 seconds!! Thanks a lot! I will google and see why this causes the problem."}, {"owner": {"reputation": 29, "user_id": 10537788, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/axVAs.png?s=128&g=1", "display_name": "nkforce", "link": "https://stackoverflow.com/users/10537788/nkforce"}, "edited": false, "score": 0, "creation_date": 1547069755, "post_id": 54118474, "comment_id": 95069955, "body": "can you explain more about 1 &amp; 2 ? I just googled and found this post: <a href=\"https://stackoverflow.com/questions/12785364/configuration-for-optimizing-qtcreator-compiler/12867971#12867971\">link</a> does this post relate to 1&amp;2?"}, {"owner": {"reputation": 6147, "user_id": 3767076, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/64707b213de57fb785081ba23aaea2cd?s=128&d=identicon&r=PG&f=1", "display_name": "Felix", "link": "https://stackoverflow.com/users/3767076/felix"}, "edited": false, "score": 0, "creation_date": 1547071044, "post_id": 54118474, "comment_id": 95070517, "body": "It depends on what compiler you are using. For gcc those are indeed the flags you need. And the problem solved by 3 is that using values means that every value is copied from the vector. Using references instead does not copy anthing."}, {"owner": {"reputation": 6147, "user_id": 3767076, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/64707b213de57fb785081ba23aaea2cd?s=128&d=identicon&r=PG&f=1", "display_name": "Felix", "link": "https://stackoverflow.com/users/3767076/felix"}, "edited": false, "score": 0, "creation_date": 1547071099, "post_id": 54118474, "comment_id": 95070541, "body": "Try to read some books/post about &quot;references&quot; in c++, that should give you an idea what you are dealing with."}, {"owner": {"reputation": 29, "user_id": 10537788, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/axVAs.png?s=128&g=1", "display_name": "nkforce", "link": "https://stackoverflow.com/users/10537788/nkforce"}, "edited": false, "score": 0, "creation_date": 1547072945, "post_id": 54118474, "comment_id": 95071233, "body": "@Felix I updated my post with some examples of the source data files. Could you give me some recommendation for better data structure or algorithms?"}], "tags": [], "owner": {"reputation": 6147, "user_id": 3767076, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/64707b213de57fb785081ba23aaea2cd?s=128&d=identicon&r=PG&f=1", "display_name": "Felix", "link": "https://stackoverflow.com/users/3767076/felix"}, "is_accepted": true, "score": 2, "last_activity_date": 1547068701, "last_edit_date": 1547068701, "creation_date": 1547068532, "answer_id": 54118474, "question_id": 54118145, "link": "https://stackoverflow.com/questions/54118145/qt-with-creading-a-file25mb-and-comparing-strings-turn-out-to-be-slower-t/54118474#54118474", "title": "(Qt with C++)Reading a file(~25Mb) and comparing strings turn out to be slower than python", "body": "<p>There are actually a bunch of things you can do to optimize this code.</p>\n\n<ol>\n<li>Make shure the Qt you are using was compiled optimized for speed, not for size</li>\n<li>Build you application in release mode. Make shure you set the correct compiler and linker flags to optimize for speed, not for size</li>\n<li>Try to use references more. This avoids unneccessary copy operations. For example, use <code>for(const auto &amp;i : tar_gene)</code>. There are many more instances. Basically, try to avoid anything that is not a reference as much as possible. This also means to use <code>std::move</code> and rvalue references wherever possible.</li>\n<li>Enable the QStringBuilder. It will optimize concatenation of strings. To do so, add <code>DEFINES += QT_USE_QSTRINGBUILDER</code> to your pro file.</li>\n<li>Use either <code>QString</code> or <code>QByteArray</code> for your whole code. Mixing them means that Qt has to convert them everytime you compare them.</li>\n</ol>\n\n<p>These are just the most basic and simplest things you can do. Try them and see how much speed you can gain. If it's still not enough, you can either try to further optimize the mathematical algorithm you are implementing here or look deeper into C/C++ to learn all the small tricks you can do for more speed.</p>\n\n<p>EDIT: You can also try to gain speed by splitting the code up on multiple threads. Doing this by hand is not a good idea - have a look at <a href=\"https://doc.qt.io/qt-5/qtconcurrent-index.html\" rel=\"nofollow noreferrer\"><code>QtConcurrent</code></a> if you are interested in that.</p>\n"}], "owner": {"reputation": 29, "user_id": 10537788, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/axVAs.png?s=128&g=1", "display_name": "nkforce", "link": "https://stackoverflow.com/users/10537788/nkforce"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "accepted_answer_id": 54118474, "answer_count": 1, "score": 0, "last_activity_date": 1547070794, "creation_date": 1547066973, "last_edit_date": 1547070794, "question_id": 54118145, "link": "https://stackoverflow.com/questions/54118145/qt-with-creading-a-file25mb-and-comparing-strings-turn-out-to-be-slower-t", "title": "(Qt with C++)Reading a file(~25Mb) and comparing strings turn out to be slower than python", "body": "<p>I have two files, \"test\" &amp; \"sample\". each file contains \"rs-numbers\" followed by \"genotypes\".</p>\n\n<p>The test file is smaller than the sample file. only have around 150 rs-numbers+their genotypes.</p>\n\n<p>However, the sample file contains more than 900k rs-numbers+their genotypes.</p>\n\n<p>readTest() opens \"test.tsv\", read through the file by line, and returns a vector of tuples. the tuple holds (rs-number, geno type).</p>\n\n<p>analyze() takes the result from readTest(), opens the sample file, read the file by line, and then do the comparison.</p>\n\n<p>example from the sample file:</p>\n\n<p>rs12124811\\t1\\t776546\\tAA\\r\\n</p>\n\n<p>rs11240777\\t1\\t798959\\tGG\\r\\n</p>\n\n<p>rs12124811 and rs11240777 are the rs-numbers. AA and GG are their genotypes.</p>\n\n<p>the running time would be n*m. In my c++ version of this program, it takes 30 seconds while python version only takes 15 seconds and 5 seconds with multiprocessing.</p>\n\n<pre><code>vector&lt;tuple&lt;QString, QString&gt;&gt; readTest(string test){\n// readTest can be done instantly\nreturn tar_gene;\n}\n\n// tar_gene is the result from readTest()\n// now call analyze. it reads through the sample.txt by line and does \n// comparison.\nQString analyze(string sample_name,\n         vector&lt;tuple&lt;QString, QString&gt;&gt; tar_gene\n         ){\n\nQString data_matches;\n\nQFile file(QString::fromStdString(sample_name));\nfile.open(QIODevice::ReadOnly);\n//skip first 20 lines\nfor(int i= 0; i &lt; 20; i++){\n    file.readLine();\n}\n\nwhile(!file.atEnd()){ // O(m)\n    const QByteArray line = file.readLine();\n    const QList&lt;QByteArray&gt; tokens = line.split('\\t');\n    // tar_gene is the result from readTest()\n    for (auto i: tar_gene){ // O(n*m)\n        // check if two rs-numbers are matched\n        if (get&lt;0&gt;(i) == tokens[0]){\n            QString i_rs = get&lt;0&gt;(i);\n            QString i_geno = get&lt;1&gt;(i);\n            QByteArray cur_geno = tokens[3].split('\\r')[0];\n            // check if their genotypes are matched\n            if(cur_geno.length() == 2){\n                if (i_geno == cur_geno.at(0) || i_geno == cur_geno.at(1)){\n                    data_matches += i_rs + '-' + i_geno + '\\n';\n                    break; // rs-numbers are unique. we can safely break \n                           // the for loop\n                }\n            }\n            // check if their genotypes are matched\n            else if (cur_geno.length() == 1) {\n                if (i_geno == cur_geno.at(0)){\n                    data_matches += i_rs + '-' + i_geno + '\\n';\n                    break; // rs-numbers are unique. we can safely break \n                           // the for loop\n                }\n            }\n        }\n    }\n}\nreturn data_matches; // QString data_matches will be used in main() and \n                     // printed out in text browser\n}\n</code></pre>\n\n<p>Here is the full source code</p>\n\n<pre><code>#include \"mainwindow.h\"\n#include \"ui_mainwindow.h\"\n\nMainWindow::MainWindow(QWidget *parent) :\n    QMainWindow(parent),\n    ui(new Ui::MainWindow)\n{\n    ui-&gt;setupUi(this);\n}\n\nMainWindow::~MainWindow()\n{\n    delete ui;\n}\n\nQString analyze(string sample_name,\n             vector&lt;tuple&lt;QString, QString&gt;&gt; tar_gene,\n             int start, int end){\n\n    QString rs_matches, data_matches;\n\n    QFile file(QString::fromStdString(sample_name));\n    file.open(QIODevice::ReadOnly);\n    //skip first 20 lines\n    for(int i= 0; i &lt; 20; i++){\n        file.readLine();\n    }\n\n    while(!file.atEnd()){\n        const QByteArray line = file.readLine();\n        const QList&lt;QByteArray&gt; tokens = line.split('\\t');\n        for (auto i: tar_gene){\n            if (get&lt;0&gt;(i) == tokens[0]){\n                QString i_rs = get&lt;0&gt;(i);\n                QString i_geno = get&lt;1&gt;(i);\n                QByteArray cur_geno = tokens[3].split('\\r')[0];\n                if(cur_geno.length() == 2){\n                    if (i_geno == cur_geno.at(0) || i_geno == cur_geno.at(1)){\n                        data_matches += i_rs + '-' + i_geno + '\\n';\n                        break;\n                    }\n                }\n                else if (cur_geno.length() == 1) {\n                    if (i_geno == cur_geno.at(0)){\n                        data_matches += i_rs + '-' + i_geno + '\\n';\n                        break;\n                    }\n                }\n            }\n        }\n    }\n    return data_matches;\n}\n\nvector&lt;tuple&lt;QString, QString&gt;&gt; readTest(string test){\n    vector&lt;tuple&lt;QString, QString&gt;&gt; tar_gene;\n    QFile file(QString::fromStdString(test));\n    file.open(QIODevice::ReadOnly);\n    file.readLine(); // skip first line\n    while(!file.atEnd()){\n        QString line = file.readLine();\n        QStringList templist;\n        templist.append(line.split('\\t')[20].split('-'));\n        tar_gene.push_back(make_tuple(templist.at(0),\n                                      templist.at(1)));\n    }\n    return tar_gene;\n}\n\nvoid MainWindow::on_pushButton_analyze_clicked()\n{\n    if(ui-&gt;comboBox_sample-&gt;currentIndex() == 0){\n        ui-&gt;textBrowser_rs-&gt;setText(\"Select a sample.\");\n        return;\n    }\n    if(ui-&gt;comboBox_test-&gt;currentIndex() == 0){\n        ui-&gt;textBrowser_rs-&gt;setText(\"Select a test.\");\n        return;\n    }\n    string sample = (ui-&gt;comboBox_sample-&gt;currentText().toStdString()) + \".txt\";\n    string test = ui-&gt;comboBox_test-&gt;currentText().toStdString() + \".tsv\";\n\n    vector&lt;tuple&lt;QString, QString&gt;&gt; tar_gene;\n\n    QFile file_test(QString::fromStdString(test));\n    if (!file_test.exists()) {\n        ui-&gt;textBrowser_rs-&gt;setText(\"The test file doesn't exist.\");\n        return;\n    }\n\n    tar_gene = readTest(test);\n\n    QFile file_sample(QString::fromStdString(sample));\n    if (!file_sample.exists()) {\n        ui-&gt;textBrowser_rs-&gt;setText(\"The sample file doesn't exist.\");\n        return;\n    }\n    clock_t t1,t2;\n\n    t1=clock();\n    QString result = analyze(sample, tar_gene, 0, 0);\n    t2=clock();\n    float diff ((float)t2-(float)t1);\n\n    float seconds = diff / CLOCKS_PER_SEC;\n    qDebug() &lt;&lt; seconds;\n    ui-&gt;textBrowser_rsgeno-&gt;setText(result);\n}\n</code></pre>\n\n<p>How do I make it run faster? I remade my program in c++ because I expected to see a better performance than python version!</p>\n\n<hr>\n\n<p>with @Felix helps, my program takes 15 seconds now. I will try multithreading later.</p>\n\n<p>here are the examples of the source data files:</p>\n\n<p>(test.tsv)\nrs17760268-C\nrs10439884-A\nrs4911642-C\nrs157640-G\n... and more. They are not sorted.</p>\n\n<p>(sample.txt)\nrs12124811\\t1\\t776546\\tAA\\r\\n\nrs11240777\\t1\\t798959\\tGG\\r\\n\n... and more. They are not sorted.</p>\n\n<p>any recommendation for better data structure or algorithms?</p>\n"}, {"tags": ["c++", "c++11", "iterator"], "comments": [{"owner": {"reputation": 44802, "user_id": 2752075, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5oQlf.png?s=128&g=1", "display_name": "HolyBlackCat", "link": "https://stackoverflow.com/users/2752075/holyblackcat"}, "edited": false, "score": 1, "creation_date": 1547066732, "post_id": 54117993, "comment_id": 95068678, "body": "You make a copy of <code>data.end()</code>. When you <code>.erase()</code> from (or <code>.insert()</code> to) <code>data</code>, the copy gets invalidated. The loop condition should be changed to <code>iter != data.end()</code>."}, {"owner": {"reputation": 590, "user_id": 9154738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36980213b38a6581d264e31ad3ee585a?s=128&d=identicon&r=PG&f=1", "display_name": "Alex24", "link": "https://stackoverflow.com/users/9154738/alex24"}, "reply_to_user": {"reputation": 44802, "user_id": 2752075, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5oQlf.png?s=128&g=1", "display_name": "HolyBlackCat", "link": "https://stackoverflow.com/users/2752075/holyblackcat"}, "edited": false, "score": 0, "creation_date": 1547066947, "post_id": 54117993, "comment_id": 95068758, "body": "@HolyBlackCat: I changed the loop condition but the problem is still the same."}, {"owner": {"reputation": 44802, "user_id": 2752075, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5oQlf.png?s=128&g=1", "display_name": "HolyBlackCat", "link": "https://stackoverflow.com/users/2752075/holyblackcat"}, "edited": false, "score": 0, "creation_date": 1547066964, "post_id": 54117993, "comment_id": 95068768, "body": "<i>&quot;What is the point in: iter = data.erase(iter);?&quot;</i> Formally, <code>.erase()</code> invalidates the iterator passed to it, so it can&#39;t be used anymore. You have to rely on its&#39; return value to get an iterator to the next valid element. Practically, <code>.erase()</code> almost always returns the parameter unchanged. Unless your compiler specifically checks this case, this UB tends to have no effect."}, {"owner": {"reputation": 44802, "user_id": 2752075, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5oQlf.png?s=128&g=1", "display_name": "HolyBlackCat", "link": "https://stackoverflow.com/users/2752075/holyblackcat"}, "edited": false, "score": 0, "creation_date": 1547067293, "post_id": 54117993, "comment_id": 95068902, "body": "Which line triggers the assetion?"}, {"owner": {"reputation": 590, "user_id": 9154738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36980213b38a6581d264e31ad3ee585a?s=128&d=identicon&r=PG&f=1", "display_name": "Alex24", "link": "https://stackoverflow.com/users/9154738/alex24"}, "reply_to_user": {"reputation": 44802, "user_id": 2752075, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5oQlf.png?s=128&g=1", "display_name": "HolyBlackCat", "link": "https://stackoverflow.com/users/2752075/holyblackcat"}, "edited": false, "score": 0, "creation_date": 1547067611, "post_id": 54117993, "comment_id": 95069030, "body": "@HolyBlackCat: <code>int value{ *iter };</code>"}, {"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 0, "creation_date": 1547067744, "post_id": 54117993, "comment_id": 95069094, "body": "What sorting algorithm erases items?  Maybe swap them, but erase them?"}, {"owner": {"reputation": 44802, "user_id": 2752075, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5oQlf.png?s=128&g=1", "display_name": "HolyBlackCat", "link": "https://stackoverflow.com/users/2752075/holyblackcat"}, "edited": false, "score": 0, "creation_date": 1547067968, "post_id": 54117993, "comment_id": 95069193, "body": "Apparently that&#39;s because <code>.insert</code> invalidates <code>iter</code>. Instead of erasing/inserting, I suggest using <code>std::rotate</code> instead. It should be more simple and more efficient."}, {"owner": {"reputation": 590, "user_id": 9154738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36980213b38a6581d264e31ad3ee585a?s=128&d=identicon&r=PG&f=1", "display_name": "Alex24", "link": "https://stackoverflow.com/users/9154738/alex24"}, "reply_to_user": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 0, "creation_date": 1547068069, "post_id": 54117993, "comment_id": 95069232, "body": "@PaulMcKenzie: The sorting algorithm is as you can see above: <code>std::lower_bound()</code> which returns an iterator to the first value greater than or equal to a passed value in the range: <code>begin()... iterator</code>."}, {"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 0, "creation_date": 1547068296, "post_id": 54117993, "comment_id": 95069347, "body": "@Alex24 <code>lower_bound</code> works on sorted ranges.  It uses a binary search, not a linear search.  So giving <code>lower_bound</code> an unsorted vector is gumming up the works."}, {"owner": {"reputation": 590, "user_id": 9154738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36980213b38a6581d264e31ad3ee585a?s=128&d=identicon&r=PG&f=1", "display_name": "Alex24", "link": "https://stackoverflow.com/users/9154738/alex24"}, "reply_to_user": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 0, "creation_date": 1547068525, "post_id": 54117993, "comment_id": 95069451, "body": "@PaulMcKenzie: Would I give up reading this book? What would you recommend to read on <code>C++11</code>? Also Why on GCC the code works fine??? I am really stuck?!."}, {"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 1, "creation_date": 1547068635, "post_id": 54117993, "comment_id": 95069502, "body": "Never read the book, so won&#39;t comment.  But if you want a page on sorting and C++, then <a href=\"https://stackoverflow.com/questions/24650626/how-to-implement-classic-sorting-algorithms-in-modern-c\">here is a link</a>."}, {"owner": {"reputation": 3108, "user_id": 4641116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gc52U.png?s=128&g=1", "display_name": "Eljay", "link": "https://stackoverflow.com/users/4641116/eljay"}, "edited": false, "score": 1, "creation_date": 1547068660, "post_id": 54117993, "comment_id": 95069517, "body": "Here is a curated list of good C++ books:  <a href=\"https://stackoverflow.com/questions/388242/the-definitive-c-book-guide-and-list\" title=\"the definitive c book guide and list\">stackoverflow.com/questions/388242/&hellip;</a>"}], "owner": {"reputation": 590, "user_id": 9154738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36980213b38a6581d264e31ad3ee585a?s=128&d=identicon&r=PG&f=1", "display_name": "Alex24", "link": "https://stackoverflow.com/users/9154738/alex24"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 31, "favorite_count": 0, "closed_date": 1547066667, "answer_count": 0, "score": 0, "last_activity_date": 1547066570, "creation_date": 1547066356, "last_edit_date": 1547066570, "question_id": 54117993, "link": "https://stackoverflow.com/questions/54117993/why-i-get-the-assertion-dialog-iterator-is-not-dereferenceable", "closed_reason": "Duplicate", "title": "Why I get the assertion dialog: iterator is not dereferenceable?", "body": "<p>I'm currently reading a book on C++11: \"Exploring C++ 11 by Ray Lischner\". I like it because I found it really useful and simple in explaining.\nThe problem. Here \"Listing 13-2. Local Variable Definitions\" Where I get the issue:</p>\n\n<pre><code>int main() {\n\n    std::vector&lt;int&gt; data{ 10, 57, 23, 81, 7, 5, 24 }; // I removed the line below in order not everytime I enter code.\n//  data.insert(data.begin(), std::istream_iterator&lt;int&gt;(std::cin),\n    //  std::istream_iterator&lt;int&gt;());\n    for (std::vector&lt;int&gt;::iterator iter{ data.begin() }, end{ data.end() }; iter != end; ) {\n        int value{ *iter };\n        std::vector&lt;int&gt;::iterator here{ std::lower_bound(data.begin(), iter, value) };\n        if (iter == here)\n            ++iter; // already in sorted position\n        else {\n            // erase the out-of-position item, advancing iter at the same time.\n            iter = data.erase(iter);\n            data.insert(here, value);\n        }\n    }\n\n    for (std::vector&lt;int&gt;::iterator iter{ data.begin() }, prev{ data.end() }, end{ data.end() };\n    iter != end; ++iter) {\n        if (prev != data.end())\n            assert(not (*iter &lt; *prev));\n        prev = iter;\n    }\n    std::cout &lt;&lt; '{';\n    std::string separator{ \" \" };\n\n    for (int element : data)\n    {\n        std::cout &lt;&lt; separator &lt;&lt; element;\n        separator = \", \";\n    }\n    std::cout &lt;&lt; \" }\\n\";\n\n\n    std::cout &lt;&lt; std::endl;\n    std::system(\"pause\");\n}\n</code></pre>\n\n<ul>\n<li><p>So as you can see above the code is to sort a vector of integers. But When I run the program on MSVC14.0 I get the assertion dialog: \"Vector iterator not dereferenceable\". <code>int value{*iter}</code>.</p></li>\n<li><p>What is the point in: <code>iter = data.erase(iter);</code>? I mean the return value (What is the point in the return value here? I tried writting: <code>data.erase(iter);</code> and works on GCC like charm.).</p></li>\n</ul>\n\n<p>I tried the very code on GCC on ideone and it works fine!?</p>\n\n<p>Please help me. Thank you in advance.</p>\n"}, {"tags": ["c++", "c++11", "stl"], "comments": [{"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "edited": false, "score": 1, "creation_date": 1547065342, "post_id": 54117670, "comment_id": 95068091, "body": "Do the <i>destructors</i> depend on the linked elements? If not, then the order of destruction would not matter."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 2, "creation_date": 1547065371, "post_id": 54117670, "comment_id": 95068106, "body": "The <a href=\"https://timsong-cpp.github.io/cppwp/sequence.reqmts#tab:containers.sequence.requirements\" rel=\"nofollow noreferrer\">requirements for a sequence container</a> just say <code>clear()</code> destroys all elements, the container&#39;s <code>empty()</code> returns <code>true</code> and the complexity is linear. The section on <code>std::vector</code> doesn&#39;t add anything to that so it seems the order is unspecified."}, {"owner": {"reputation": 5213, "user_id": 457488, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3265ae55bf80e40f9fe031c6378306e6?s=128&d=identicon&r=PG", "display_name": "Brad", "link": "https://stackoverflow.com/users/457488/brad"}, "edited": false, "score": 0, "creation_date": 1547065505, "post_id": 54117670, "comment_id": 95068159, "body": "@errorika, sorry I should have been more clear - yes the destructors (in some cases) depend on other elements in the container."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2100815"}, "edited": false, "score": 0, "creation_date": 1547065524, "post_id": 54117670, "comment_id": 95068164, "body": "Vectors are not LIFO/FIFO containers, they don&#39;t  have a record of insertion order."}, {"owner": {"reputation": 8580, "user_id": 2293156, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/800e791e8e13500e516c9ae77299160a?s=128&d=identicon&r=PG", "display_name": "Amadeus", "link": "https://stackoverflow.com/users/2293156/amadeus"}, "edited": false, "score": 0, "creation_date": 1547065558, "post_id": 54117670, "comment_id": 95068182, "body": "Use a container that preserve the insertion order, like std::stack"}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "edited": false, "score": 0, "creation_date": 1547065601, "post_id": 54117670, "comment_id": 95068206, "body": "@Brad How are the elements linked to each other? A bare pointer? Something else?"}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "reply_to_user": {"reputation": 8580, "user_id": 2293156, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/800e791e8e13500e516c9ae77299160a?s=128&d=identicon&r=PG", "display_name": "Amadeus", "link": "https://stackoverflow.com/users/2293156/amadeus"}, "edited": false, "score": 0, "creation_date": 1547065917, "post_id": 54117670, "comment_id": 95068345, "body": "@Amadeus <code>std::stack</code> doesn&#39;t even have a <code>clear</code> operation. And doesn&#39;t give any further guarantees about destruction order of elements upon destruction of the stack."}, {"owner": {"reputation": 68702, "user_id": 1593860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1361e47a8bf06d20ffda9a686ceb7e68?s=128&d=identicon&r=PG", "display_name": "Pete Becker", "link": "https://stackoverflow.com/users/1593860/pete-becker"}, "reply_to_user": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "edited": false, "score": 0, "creation_date": 1547066048, "post_id": 54117670, "comment_id": 95068398, "body": "@eerorika -- but <code>std::stack</code> <b>does</b> keep track of insertion order; <code>while (!empty) pop()</code> will clear the stack with destruction in LIFO order."}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "reply_to_user": {"reputation": 68702, "user_id": 1593860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1361e47a8bf06d20ffda9a686ceb7e68?s=128&d=identicon&r=PG", "display_name": "Pete Becker", "link": "https://stackoverflow.com/users/1593860/pete-becker"}, "edited": false, "score": 0, "creation_date": 1547066237, "post_id": 54117670, "comment_id": 95068486, "body": "@PeteBecker You can achieve the same without the <code>stack</code> wrapper too using <code>pop_back</code>. Brad doesn&#39;t describe what other operations they need, but I suppose if no other operations are needed <code>stack</code> could be a good choice."}, {"owner": {"reputation": 42006, "user_id": 3807729, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UEUbF.jpg?s=128&g=1", "display_name": "Galik", "link": "https://stackoverflow.com/users/3807729/galik"}, "edited": false, "score": 0, "creation_date": 1547066989, "post_id": 54117670, "comment_id": 95068782, "body": "Do your dependent objects continue to function if they are <i>copied</i>, <i>moved</i> or <i>swapped</i>?"}], "answers": [{"tags": [], "owner": {"reputation": 32882, "user_id": 1870760, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/NAAkp.png?s=128&g=1", "display_name": "Hatted Rooster", "link": "https://stackoverflow.com/users/1870760/hatted-rooster"}, "is_accepted": true, "score": 4, "last_activity_date": 1547065409, "creation_date": 1547065409, "answer_id": 54117777, "question_id": 54117670, "link": "https://stackoverflow.com/questions/54117670/c-vectorclear-order-of-destruction/54117777#54117777", "title": "C++ vector::clear() - order of destruction?", "body": "<p>According to the <a href=\"http://eel.is/c++draft/sequence.reqmts\" rel=\"nofollow noreferrer\">sequence container requirements</a>(<code>std::vector</code> is one of those) the standard only says this about <code>clear()</code>:</p>\n\n<blockquote>\n  <p>Destroys all elements in <code>a</code>. Invalidates all references, pointers, and\n  iterators referring to the elements of a and may invalidate the\n  past-the-end iterator.</p>\n  \n  <p>Ensures: <code>a.empty()</code> returns <code>true</code>.</p>\n  \n  <p>Complexity: Linear.</p>\n</blockquote>\n\n<p>So no, you get no guarantees on the order of destruction.</p>\n"}], "owner": {"reputation": 5213, "user_id": 457488, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3265ae55bf80e40f9fe031c6378306e6?s=128&d=identicon&r=PG", "display_name": "Brad", "link": "https://stackoverflow.com/users/457488/brad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 198, "favorite_count": 2, "closed_date": 1547065386, "accepted_answer_id": 54117777, "answer_count": 1, "score": 4, "last_activity_date": 1547065409, "creation_date": 1547065046, "question_id": 54117670, "link": "https://stackoverflow.com/questions/54117670/c-vectorclear-order-of-destruction", "closed_reason": "Duplicate", "title": "C++ vector::clear() - order of destruction?", "body": "<p>I've searched around and not found anything - does C++ give any guarantee on the order that items in a std::vector will be deleted when calling vector::clear()?</p>\n\n<p>I have a vector with some items which depend on other items in the vector, so need to ensure it is cleared LIFO.  FIFO would be fine - I can reverse the vector before calling clear().</p>\n"}, {"tags": ["c++", "bazel"], "comments": [{"owner": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 0, "creation_date": 1547064557, "post_id": 54117488, "comment_id": 95067764, "body": "Are these third-party libraries?"}, {"owner": {"reputation": 81, "user_id": 10624586, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76e9f68f3fea1b2304546567e89bae67?s=128&d=identicon&r=PG&f=1", "display_name": "Kanad Kanhere", "link": "https://stackoverflow.com/users/10624586/kanad-kanhere"}, "reply_to_user": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 1, "creation_date": 1547065102, "post_id": 54117488, "comment_id": 95067992, "body": "Not really. The header files are part of the project.  BTW I tried introducing cc_import but it doesn&#39;t like it as these are header only libraries. Maybe I was doing something wrong?"}, {"owner": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 1, "creation_date": 1547065306, "post_id": 54117488, "comment_id": 95068066, "body": "Then it would probably be a better idea to spend time fixing warnings (and potential bugs) rather than migrating to bazel."}, {"owner": {"reputation": 81, "user_id": 10624586, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76e9f68f3fea1b2304546567e89bae67?s=128&d=identicon&r=PG&f=1", "display_name": "Kanad Kanhere", "link": "https://stackoverflow.com/users/10624586/kanad-kanhere"}, "reply_to_user": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 1, "creation_date": 1547065591, "post_id": 54117488, "comment_id": 95068201, "body": "In an ideal world we would have loved to do that. Unfortunately right now that is not really an option. And the approach I mentioned seems to work. So would like to understand if it is a no go, and if there is a better way of doing this."}, {"owner": {"reputation": 3923, "user_id": 8309701, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S44bo.png?s=128&g=1", "display_name": "Chris Uzdavinis", "link": "https://stackoverflow.com/users/8309701/chris-uzdavinis"}, "edited": false, "score": 3, "creation_date": 1547069734, "post_id": 54117488, "comment_id": 95069948, "body": "This is a legitimate question.  Rather than &quot;just fix the code&quot;, -isystem exists for a reason and I would hope to see an answer that can actually be put to action.  My situation is very similar: large quantities of in-house <i>generated code</i> that produces some warnings, but need to be silenced.  &quot;Just fix the code&quot; is not useful or remotely helpful.  Is there a technical answer?"}, {"owner": {"reputation": 15990, "user_id": 417197, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cb4633eee192020baee9447a8c0976c1?s=128&d=identicon&r=PG", "display_name": "Andr&#233;", "link": "https://stackoverflow.com/users/417197/andr%c3%a9"}, "edited": false, "score": 1, "creation_date": 1547070550, "post_id": 54117488, "comment_id": 95070291, "body": "The second <i>ugly</i> alternative is to wrap your headers and silence the warnings with compiler specific pragmas. But I agree with VTT; if you control the code you can fix the warnings."}, {"owner": {"reputation": 7205, "user_id": 9288200, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f1c4dc5d3f7433e18f4aa04319ebaec?s=128&d=identicon&r=PG&f=1", "display_name": "Ondrej K.", "link": "https://stackoverflow.com/users/9288200/ondrej-k"}, "edited": false, "score": 1, "creation_date": 1547072383, "post_id": 54117488, "comment_id": 95071042, "body": "I don&#39;t want to be reiterating the &quot;fix your code&quot; but there is a bit of a conflict in the question already, because that likely is the answer to &quot;what would be the correct way of doing it?&quot; If for whatever reason that is not considered practical, desire for correctness must usually give way to some more or less dirty workaround to patch over it. There is a whole continuum between &quot;The Right Thing&quot; and &quot;Well, it appears to work at least most of the time&quot; and each needs to decide where they can and are willing to sit on that (and those lines should be clear in the question)."}, {"owner": {"reputation": 81, "user_id": 10624586, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76e9f68f3fea1b2304546567e89bae67?s=128&d=identicon&r=PG&f=1", "display_name": "Kanad Kanhere", "link": "https://stackoverflow.com/users/10624586/kanad-kanhere"}, "edited": false, "score": 0, "creation_date": 1547074150, "post_id": 54117488, "comment_id": 95071580, "body": "Andr&#233;, OndrejK. Thanks for your responses.  I understand the sentiment behind &quot;fix your code&quot; and I am not denying it would be the ideal approach. I had anticipated that and hence the original question&#39;s PS section mentioned it not really being an option. The code residing in the project just gives the migration team nominal &quot;control&quot; over it. The developers don&#39;t want to fix the warnings right now, especially because CMake has option to handle it. May be I should re-phrase the question to say &quot;what is better way&quot; rather than correct way? (although that sounds weird to my ears)"}, {"owner": {"reputation": 81, "user_id": 10624586, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76e9f68f3fea1b2304546567e89bae67?s=128&d=identicon&r=PG&f=1", "display_name": "Kanad Kanhere", "link": "https://stackoverflow.com/users/10624586/kanad-kanhere"}, "reply_to_user": {"reputation": 15990, "user_id": 417197, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cb4633eee192020baee9447a8c0976c1?s=128&d=identicon&r=PG", "display_name": "Andr&#233;", "link": "https://stackoverflow.com/users/417197/andr%c3%a9"}, "edited": false, "score": 0, "creation_date": 1547074332, "post_id": 54117488, "comment_id": 95071644, "body": "@Andr&#233; the pragma way seems more doable than fixing warnings as of now, although even that would probably need us to touch a lot of files. It would be nice to have a bazel way of doing this, i.e. via some bazel options.  What would be really nice to know is whether the approach that I have given has any red flags. Because it seems to work. I even checked incrementality and caching behavior, albeit on a toy example, and that seems to match the bazel recommended way"}], "answers": [{"tags": [], "owner": {"reputation": 81, "user_id": 10624586, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76e9f68f3fea1b2304546567e89bae67?s=128&d=identicon&r=PG&f=1", "display_name": "Kanad Kanhere", "link": "https://stackoverflow.com/users/10624586/kanad-kanhere"}, "is_accepted": false, "score": 2, "last_activity_date": 1547491690, "creation_date": 1547491690, "answer_id": 54187427, "question_id": 54117488, "link": "https://stackoverflow.com/questions/54117488/what-is-the-correct-way-to-create-a-system-header-only-library-in-bazel/54187427#54187427", "title": "What is the correct way to create a system header only library in bazel?", "body": "<p>It turns out adding it to <code>hdrs</code> <strong>does</strong> work if you make sure that strip_include_prefix is None (or not passed). We had a macro that was wrapping up the cc_library instance and it was defaulting strip_include_prefix to empty string. Interestingly this doesn't affect <code>textual_hdrs</code> or <code>srcs</code>, but does affect <code>hdrs</code></p>\n\n<p>In summary the below seems to work fine</p>\n\n<pre><code>cc_library(\n    name = \"lib\",\n    hdrs = [\"include/header1.h\", ...],\n    includes = [\"include\"],\n)\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 10624586, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76e9f68f3fea1b2304546567e89bae67?s=128&d=identicon&r=PG&f=1", "display_name": "Kanad Kanhere", "link": "https://stackoverflow.com/users/10624586/kanad-kanhere"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1814, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1547491690, "creation_date": 1547064177, "last_edit_date": 1547225949, "question_id": 54117488, "link": "https://stackoverflow.com/questions/54117488/what-is-the-correct-way-to-create-a-system-header-only-library-in-bazel", "title": "What is the correct way to create a system header only library in bazel?", "body": "<p>We are migrating a CMake project to Bazel. We have several header only libraries that are tagged SYSTEM in CMake project to suppress some warnings. When migrating these to Bazel, the way we are able to make this work is by using the below</p>\n\n<pre><code>cc_library(\n    name = \"lib\",\n    srcs = [\"include/header1.h\", ...],\n    includes = [\"include\"],\n)\n</code></pre>\n\n<p>This works but as per <a href=\"https://docs.bazel.build/versions/master/be/c-cpp.html#hdrs\" rel=\"nofollow noreferrer\">Bazel C++ documentation</a>, it is not recommended to have interface/public headers in <code>srcs</code>. Those should be part of <code>hdrs</code>. Adding these to headers doesn't work because it uses the regular <code>-I</code> based inclusion instead of <code>-isystem</code>.</p>\n\n<p>Is our way of doing this fine, although not recommended by bazel? If not, what would be the correct way of doing it?</p>\n\n<p>EDIT:\nAfter some digging, found the <code>textual_hdrs</code> attribute on <code>cc_library</code> and using that it seems to work too. And this seems to be a cleaner approach than adding the public headers to <code>srcs</code>. Now the rule looks like this</p>\n\n<pre><code>cc_library(\n    name = \"lib\",\n    textual_hdrs = [\"include/header1.h\", ...],\n    includes = [\"include\"],\n)\n</code></pre>\n\n<p>This looks like a good solution for us, except that the documentation on textual_hdrs isn't clear enough to indicate that this is what it is meant for.</p>\n\n<p>PS: It is really not possible for us to refactor the code to fix the warnings as there are numerous libraries like this and just completely outside the scope of this migration effort.</p>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 67968, "user_id": 584192, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YBSIc.png?s=128&g=1", "display_name": "Samuel Liew", "link": "https://stackoverflow.com/users/584192/samuel-liew"}, "edited": false, "score": 0, "creation_date": 1547118152, "post_id": 54117474, "comment_id": 95085756, "body": "Comments are not for extended discussion; this conversation has been <a href=\"https://chat.stackoverflow.com/rooms/186469/discussion-on-question-by-truedmik-virtual-functions-class-templates-overriding\">moved to chat</a>."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 3579458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d8c48d3915769700473defc9e8f937?s=128&d=identicon&r=PG&f=1", "display_name": "truedmik", "link": "https://stackoverflow.com/users/3579458/truedmik"}, "edited": false, "score": 0, "creation_date": 1547131785, "post_id": 54121438, "comment_id": 95093626, "body": "Thanks for a detailed answer! Makes sense, but I see a few weak spots in your logic. 1) your referring to pure virtual doesn&#39;t actually matter because if I make <code>Base::foo()</code> non-pure, the result is completely the same. So there must be something else. 2) <code>Derived.cpp</code> knows <code>Data</code> so it can legally instantiate everything. I can agree to your bottom line though. In the sense that [1] performs a lookup in <code>BaseImpl&lt;Data&gt;</code> w/o involving vtable since the compiler knows <code>d</code> is a <code>BaseImpl&lt;Data&gt;</code> instance. Sort of an optimization as I see it. I&#39;d like to disable it in this particular case..."}], "tags": [], "owner": {"reputation": 65594, "user_id": 459640, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/bc790307b3c4cdbd25f582d9067651f1?s=128&d=identicon&r=PG", "display_name": "aschepler", "link": "https://stackoverflow.com/users/459640/aschepler"}, "is_accepted": false, "score": 0, "last_activity_date": 1547089715, "last_edit_date": 1592644375, "creation_date": 1547089715, "answer_id": 54121438, "question_id": 54117474, "link": "https://stackoverflow.com/questions/54117474/virtual-functions-class-templates-overriding-them-and-incomplete-types/54121438#54121438", "title": "Virtual functions, class templates overriding them and incomplete types", "body": "<p>The example program is ill-formed.</p>\n<p>To start with, the definition of any template is checked for valid syntax like all other code, but a C++ implementation is not required to check the semantics of any parts that depend on a template parameter unless/until that template is instantiated. (An implementation may report a semantic error even without any instantiations if there are no possible template arguments that would make a specialization valid.)</p>\n<p>So the program is fine if the translation unit resulting from main.cpp does not instantiate the function template specialization <code>BaseImpl&lt;Data&gt;::foo()</code>. But when exactly is this template specialization instantiated? <a href=\"https://timsong-cpp.github.io/cppwp/temp#inst-3\" rel=\"nofollow noreferrer\">[temp.inst]/3</a> says:</p>\n<blockquote>\n<p>Unless a member of a class template or a member template has been explicitly instantiated or explicitly specialized, the specialization of the member is implicitly instantiated when the specialization is referenced in a context that requires the member definition to exist or if the existence of the definition of the member affects the semantics of the program.</p>\n</blockquote>\n<p>The main requirement that a definition exists comes from the ODR rule, <a href=\"https://timsong-cpp.github.io/cppwp/basic.def.odr#10\" rel=\"nofollow noreferrer\">[basic.def.odr]/10</a>:</p>\n<blockquote>\n<p>Every program shall contain exactly one definition of every non-inline function or variable that is odr-used in that program outside of a discarded statement; no diagnostic required.... An inline function or variable shall be defined in every translation unit in which it is odr-used outside of a discarded statement.</p>\n</blockquote>\n<p>Here it doesn't matter whether we say the specialization <code>BaseImpl&lt;Data&gt;::foo()</code> is &quot;inline&quot; or not. Both flavors of the ODR rule end up saying that if the specialization is odr-used, then it must be defined (in some way or another), which means the specialization is implicitly instantiated.</p>\n<p>There are different definitions of the technical term &quot;odr-use&quot; for different sorts of entities (and sometimes those definitions overlap).  Quoting a bit more than necessary from [basic.def.odr]/5-8 to make a point:</p>\n<blockquote>\n<p>A variable <code>x</code> whose name appears as a potentially-evaluated expression <code>ex</code> is <em>odr-used</em> by <code>ex</code> unless....</p>\n<p>A structured binding is odr-used if it appears as a potentially-evaluated expression.</p>\n<p><code>*this</code> is odr-used if <code>this</code> appears as a potentially-evaluated expression (including as the result of the implicit transformation in the body of a non-static member function).</p>\n<p>A virtual member function is odr-used if it is not pure. A function is odr-used if it is named by a potentially-evaluated expression. A non-placement allocation or deallocation function for a class is odr-used by the definition of a constructor of that class. A non-placement deallocation function for a class is odr-used by the definition of the destructor of that class, or by being selected by the lookup at the point of definition of a virtual destructor.</p>\n<p>An assignment operator function in a class is odr-used by an implicitly-defined copy-assignment or move-assignment function for another class as specified in [class.copy.assign]. A constructor for a class is odr-used as specified in [dcl.init]. A destructor for a class is odr-used if it is potentially invoked.</p>\n</blockquote>\n<p>Note all of these definitions for &quot;odr-used&quot; associate the property to some specific expression or definition, <em>except</em> the one saying a virtual function that is not pure is odr-used just by existing.  So in most cases, implicit instantiation happens because of these specific other expressions and definitions which require the template specialization.  What this means in terms of instantiating a virtual function is somewhat clarified in <a href=\"https://timsong-cpp.github.io/cppwp/temp.inst#10\" rel=\"nofollow noreferrer\">[temp.inst]/10</a> and <a href=\"https://timsong-cpp.github.io/cppwp/temp.point#5\" rel=\"nofollow noreferrer\">[temp.point]/5</a>:</p>\n<blockquote>\n<p>It is unspecified whether or not an implementation implicitly instantiates a virtual member function of a class template if the virtual member function would not otherwise be instantiated.</p>\n<p>If a virtual function is implicitly instantiated, its point of instantiation is immediately following the point of instantiation of its enclosing class template specialization.</p>\n</blockquote>\n<p>So if your main.cpp never mentioned <code>foo</code> at all, but it still required the instantiation of class <code>BaseImpl&lt;Data&gt;</code> while <code>Data</code> is still an incomplete type, it would be unspecified whether or not the program is valid!  So even that's probably not a good idea.</p>\n<p>Incidentally though, this is why the translation unit from Derived.cpp is allowed to instantiate <code>BaseImpl&lt;Data&gt;::foo()</code>.  And g++, along with most compilers that use the common &quot;vtable&quot; strategy for virtual functions, will instantiate any needed class template members which are the final overrides for a class whenever any constructor for that class is (explicitly or implicitly) defined, since it needs to build a vtable which includes those functions so the constructor can set the class object's internal vptr to point at the vtable.</p>\n<p>But I said at the start it's ill-formed, because of the other piece implied by &quot;would not otherwise be instantiated&quot;.  The other sentence which could imply <code>BaseImpl&lt;Data&gt;::foo()</code> is odr-used was &quot;A function is odr-used if it is named by a potentially-evaluated expression&quot;.  Backing up shortly before that quote, we find that &quot;function named by an expression&quot; is also a technical definition, in <a href=\"https://timsong-cpp.github.io/cppwp/basic.def.odr#3\" rel=\"nofollow noreferrer\">[basic.def.odr]/3</a>:</p>\n<blockquote>\n<p>A function is <em>named by an expression</em> as follows:</p>\n<ul>\n<li><p>A function whose name appears in an expression is named by that expression if it is the unique lookup result or the selected member of a set of overloaded functions ([basic.lookup], [over.match], [over.over]), unless it is a pure virtual function and either its name is not explicitly qualified or the expression forms a pointer to member ([expr.unary.op]).</p>\n</li>\n<li><p>...</p>\n</li>\n</ul>\n</blockquote>\n<p>Now the expression <code>d.foo()</code> does a lookup for a member <code>foo</code> in <code>Derived</code>, and the unique result is <code>BaseImpl&lt;Data&gt;::foo()</code>.  Since it's not pure virtual, <code>d.foo()</code> <em>names</em> <code>BaseImpl&lt;Data&gt;::foo()</code>.  The expression <code>((Base *) &amp; d)-&gt;foo()</code> does a lookup for a member <code>foo</code> in <code>Base</code>, and the unique result is <code>Base::foo()</code>.  Since <code>Base::foo()</code> is pure virtual and the name <code>foo</code> is unqualified in the expression, <code>((Base *) &amp; d)-&gt;foo()</code> does not name any function.</p>\n<p>I'm sure you know those two expressions (if the program were changed to be valid) would actually call the same function.  But the way polymorphism is described in the C++ Standard is that the function which is <em>named</em> is not always the same as the function which is <em>called</em>.  This distinction is also important for other reasons - like the member access checks apply to the named function, not the called function, and the default arguments associated with declarations of the named function, not the called function, are available for use.  It just happens that here's another tricky difference that comes up depending on the actual function named.</p>\n<p>Anyway, to tie it up, the expression <code>d.foo()</code> in main.cpp odr-uses <code>BaseImpl&lt;Data&gt;::foo()</code>, which means an implicit instantation of <code>BaseImpl&lt;Data&gt;::foo()</code>.  Since <code>d</code> points at an object of incomplete class type <code>Data</code>, the expression <code>d-&gt;value</code> in the definition of this instantiated specialization is ill-formed.</p>\n"}], "owner": {"reputation": 21, "user_id": 3579458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d8c48d3915769700473defc9e8f937?s=128&d=identicon&r=PG&f=1", "display_name": "truedmik", "link": "https://stackoverflow.com/users/3579458/truedmik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 100, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1547089715, "creation_date": 1547064118, "last_edit_date": 1547080447, "question_id": 54117474, "link": "https://stackoverflow.com/questions/54117474/virtual-functions-class-templates-overriding-them-and-incomplete-types", "title": "Virtual functions, class templates overriding them and incomplete types", "body": "<p>Let's consider the following code snippet (spread across several files):</p>\n\n<p>Base.h:</p>\n\n<pre><code>#include &lt;iostream&gt;\n\nclass Base\n{\npublic:\n  virtual void foo () = 0;\n};\n\ntemplate &lt;class D&gt;\nclass BaseImpl : public Base\n{\npublic:\n  BaseImpl () : d (new D ()) {}\n  virtual ~BaseImpl () { delete d; }\n  void foo () override;\nprivate:\n  D * d;\n};\n\ntemplate &lt;class D&gt;\nvoid BaseImpl &lt;D&gt;::foo ()\n{\n  std::cout &lt;&lt; d-&gt;value &lt;&lt; std::endl;\n}\n</code></pre>\n\n<p>Derived.h:</p>\n\n<pre><code>#include \"Base.h\"\n\nstruct Data;\n\nclass Derived : public BaseImpl &lt;Data&gt;\n{\npublic:\n  Derived ();\n  ~Derived ();\n};\n</code></pre>\n\n<p>Derived.cpp:</p>\n\n<pre><code>#include \"Derived.h\"\n\nstruct Data\n{\n  int value = 123;\n};\n\nDerived::Derived () {}\nDerived::~Derived () {}\n</code></pre>\n\n<p>main.cpp:</p>\n\n<pre><code>#include \"Derived.h\"\n\nint main ()\n{\n    Derived d;\n\n    d.foo (); // [1] error\n    ((Base *) &amp; d)-&gt;foo (); // [2] fine\n}\n</code></pre>\n\n<p>This example produces a compiler error on CLang (Apple LLVM version 10.0.0 (clang-1000.11.45.5) at line [1] as following:</p>\n\n<blockquote>\n<pre><code>g++ -c -std=c++11 main.cpp -o main.o\nIn file included from main.cpp:1:\nIn file included from ./Derived.h:1:\n./Base.h:22:17: error: member access into incomplete type 'Data'\n  std::cout &lt;&lt; d-&gt;value &lt;&lt; std::endl;\n                ^\nmain.cpp:7:5: note: in instantiation of member function 'BaseImpl&lt;Data&gt;::foo' requested here\n  d.foo (); // [1]\n    ^\n./Derived.h:3:8: note: forward declaration of 'Data'\nstruct Data;\n       ^\n1 error generated.\n</code></pre>\n</blockquote>\n\n<p>A similar error is generated by gcc 4.9.2:</p>\n\n<blockquote>\n<pre><code>g++ -c -std=c++11 main.cpp -o main.o\nIn file included from Derived.h:1:0,\n                 from main.cpp:1:\nBase.h: In instantiation of 'void BaseImpl&lt;D&gt;::foo() [with D = Data]':\nmain.cpp:7:10:   required from here\nBase.h:22:13: error: invalid use of incomplete type 'struct Data'\n   std::cout &lt;&lt; d-&gt;value &lt;&lt; std::endl;\n             ^\nIn file included from main.cpp:1:0:\nDerived.h:3:8: error: forward declaration of 'struct Data'\n struct Data;\n        ^\n</code></pre>\n</blockquote>\n\n<p>Interesting enough, if line [1] is commented out, everything builds (and works) fine and line [2] doesn't produce any compiler errors. What is the reason for this discrepancy?</p>\n\n<p>The error at [1] expectedly goes away if the forward declaration of <code>Data</code> in <code>Derived.h</code> is replaced with its full definition from <code>Derived.cpp</code> but the intention is to make it hidden from users of <code>Derived</code> because it is implementation detail (see also below).</p>\n\n<p>For those curious (and familiar with Qt), in real life <code>Base</code> is <code>QAbstractItemModel</code>, <code>BaseImpl</code> is a class template whose purpose is to provide real storage for model items and implement <code>QAbstractItemModel</code> (pure) virtual functions. <code>Derived</code> is merely an alias for <code>BaseImpl</code> implementing a particular data model and <code>Data</code> is what is used internally by this model to store each item's data so it should be separate from <code>Derived</code> and hidden from code using the final model class.</p>\n"}, {"tags": ["c++", "gcc", "clang", "language-lawyer"], "comments": [{"owner": {"reputation": 86516, "user_id": 701092, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xYrM0.jpg?s=128&g=1", "display_name": "0x499602D2", "link": "https://stackoverflow.com/users/701092/0x499602d2"}, "edited": false, "score": 0, "creation_date": 1547064282, "post_id": 54117466, "comment_id": 95067653, "body": "If you remove the code in <code>main()</code> and the <code>bool a</code> data member then the code fails in clang (which it shouldn&#39;t if it&#39;s being consistent). So I think it&#39;s a bug in clang."}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 3, "creation_date": 1547064367, "post_id": 54117466, "comment_id": 95067683, "body": "related: <a href=\"https://stackoverflow.com/questions/4643074/why-do-i-have-to-access-template-base-class-members-through-the-this-pointer\" title=\"why do i have to access template base class members through the this pointer\">stackoverflow.com/questions/4643074/&hellip;</a>"}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 2, "creation_date": 1547064559, "post_id": 54117466, "comment_id": 95067768, "body": "maybe replace one of the tags with the <code>language-lawyer</code> tag"}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 2, "creation_date": 1547064575, "post_id": 54117466, "comment_id": 95067780, "body": "Should be bug on CLang. I can&#39;t understand how it can be not a compilation error."}, {"owner": {"reputation": 4326, "user_id": 242348, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/cc86e1f443171a35a1c7dcf2c688f24c?s=128&d=identicon&r=PG", "display_name": "monoceres", "link": "https://stackoverflow.com/users/242348/monoceres"}, "reply_to_user": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 1, "creation_date": 1547065340, "post_id": 54117466, "comment_id": 95068088, "body": "@NathanOliver ah, not the first time I have caught myself on this. Seems like gcc is right then, the question then is why clang permits it. The example in your link doesn&#39;t."}, {"owner": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "edited": false, "score": 0, "creation_date": 1547066446, "post_id": 54117466, "comment_id": 95068566, "body": "So I get what clang is doing, it is doing this: <a href=\"https://rextester.com/FRQ46060\" rel=\"nofollow noreferrer\">rextester.com/FRQ46060</a> -- it is looking up <code>a</code>, finding <code>Outer::a</code>.  If you replace <code>a=7</code> with <code>Outer::a = 7;</code> then gcc also compiles it.  I&#39;m wondering (a) if <code>Outer::a = 7;</code> is also illegal, and if not what makes it different than <code>a = 7</code>."}, {"owner": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "edited": false, "score": 0, "creation_date": 1547069629, "post_id": 54117466, "comment_id": 95069904, "body": "<a href=\"http://coliru.stacked-crooked.com/a/dbfba5ff533fa000\" rel=\"nofollow noreferrer\">here</a> is an interesting case; while <code>a=true</code> is a non-dependant expression, here I <code>if constexpr</code> prevent it from making the program ill-formed in any hypothetical instantiation.  I think gcc gets the OP&#39;s problem right, but gets this one wrong."}], "answers": [{"comments": [{"owner": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "edited": false, "score": 0, "creation_date": 1547066328, "post_id": 54117883, "comment_id": 95068521, "body": "Are you implying <a href=\"https://rextester.com/FRQ46060\" rel=\"nofollow noreferrer\">this is also ill formed</a>, as <code>Outer::a</code> also doesn&#39;t depend on its template parameter?  The validity of <code>Outer::a = 7</code> <i>does</i> depend on the tempate parameter, but the expression doesn&#39;t use <code>T</code>.  So your answer being correct depends on what <b>exactly</b> the standard means by &quot;construct that does not depend on a template parameter&quot;."}, {"owner": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "reply_to_user": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "edited": false, "score": 0, "creation_date": 1547066481, "post_id": 54117883, "comment_id": 95068577, "body": "@Yakk-AdamNevraumont The linked code I see is the exact same code as the one in the question."}, {"owner": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "edited": false, "score": 0, "creation_date": 1547066600, "post_id": 54117883, "comment_id": 95068624, "body": "fixed the link, sorry"}, {"owner": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "reply_to_user": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "edited": false, "score": 0, "creation_date": 1547066943, "post_id": 54117883, "comment_id": 95068756, "body": "@Yakk-AdamNevraumont I know the rule is that the implied object parameter is assumed only if the id-expression names a member of a the current class or a non dependent base. I can look for it in the standard. So <code>Outer::a</code> and <code>a</code> are equivalent according to this rule."}, {"owner": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "reply_to_user": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "edited": false, "score": 0, "creation_date": 1547067297, "post_id": 54117883, "comment_id": 95068903, "body": "@Yakk-AdamNevraumont I found the rule: <a href=\"http://eel.is/c++draft/temp.dep#type-5.1\" rel=\"nofollow noreferrer\">temp.dep.type/5</a>."}, {"owner": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "edited": false, "score": 0, "creation_date": 1547067445, "post_id": 54117883, "comment_id": 95068961, "body": "<code>Outer::a</code> is then <a href=\"http://eel.is/c++draft/temp.dep#def:member_of_an_unknown_specialization\" rel=\"nofollow noreferrer\">temp.dep.type/6</a> no?  And then <code>a</code> should be treated the same?"}, {"owner": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "edited": false, "score": 0, "creation_date": 1547067681, "post_id": 54117883, "comment_id": 95069063, "body": "No, <code>a</code> is not a qualfiied id!"}, {"owner": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "reply_to_user": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "edited": false, "score": 0, "creation_date": 1547067774, "post_id": 54117883, "comment_id": 95069111, "body": "@Yakk-AdamNevraumont <code>Outer</code> neither is a dependent type nor refers to the current instantiation."}, {"owner": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "reply_to_user": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "edited": false, "score": 0, "creation_date": 1547067874, "post_id": 54117883, "comment_id": 95069153, "body": "@Yakk-AdamNevraumont The rule (5.1): An <i>unqualified</i> name that, <a href=\"http://eel.is/c++draft/temp.dep#type-5.1\" rel=\"nofollow noreferrer\">eel.is/c++draft/temp.dep#type-5.1</a>"}], "tags": [], "owner": {"reputation": 16482, "user_id": 5632316, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/9I9Vm.jpg?s=128&g=1", "display_name": "Oliv", "link": "https://stackoverflow.com/users/5632316/oliv"}, "is_accepted": true, "score": 4, "last_activity_date": 1547068076, "last_edit_date": 1547068076, "creation_date": 1547065882, "answer_id": 54117883, "question_id": 54117466, "link": "https://stackoverflow.com/questions/54117466/is-clang-or-gcc-correct-about-this-inner-class-member-access/54117883#54117883", "title": "Is clang or gcc correct about this inner class member access?", "body": "<p>This code is ill-formed <em>no diagnostic required</em>. So Gcc is right and friendly. And the absence of diagnostic for Clang and MSVC is just a compiler quality issue. </p>\n\n<p>The rule of the standard involved is <a href=\"http://eel.is/c++draft/temp.res#8.5\" rel=\"nofollow noreferrer\">[temp.res]/8</a>:</p>\n\n<blockquote>\n  <p>The validity of a template may be checked prior to any instantiation.\n  [\u2009Note: Knowing which names are type names allows the syntax of every template to be checked in this way.\n  \u2014\u2009end note\n  \u2009]\n  The program is ill-formed, no diagnostic required, if:</p>\n  \n  <ul>\n  <li><p>[..]</p></li>\n  <li><p>a hypothetical instantiation of a template immediately following its definition would be ill-formed due to a construct that does not depend on a template parameter, or [...]</p></li>\n  </ul>\n</blockquote>\n\n<p>In <code>f</code> body, the unqualified id-expression <code>a</code> does not depend on any template parameter, so this id-expression should be resolved at the point of definition of the template without the knowledge of any template argument. And at this point, this expression is ill-formed.</p>\n\n<hr>\n\n<p>Note: a non qualified id-expression, (out of a class member access) expression is supposed to be a member only if it names a member of that class or of a non-dependent base <a href=\"http://eel.is/c++draft/temp.dep#type-5.1\" rel=\"nofollow noreferrer\">[temp.dep.type]/5</a>:</p>\n\n<blockquote>\n  <p>A name is a member of the current instantiation if it is:</p>\n  \n  <ul>\n  <li>An unqualified name that, when looked up, refers to at least one member of a class that is the current instantiation or a non-dependent base class thereof.</li>\n  </ul>\n</blockquote>\n"}], "owner": {"reputation": 4326, "user_id": 242348, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/cc86e1f443171a35a1c7dcf2c688f24c?s=128&d=identicon&r=PG", "display_name": "monoceres", "link": "https://stackoverflow.com/users/242348/monoceres"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 0, "accepted_answer_id": 54117883, "answer_count": 1, "score": 5, "last_activity_date": 1547068076, "creation_date": 1547064093, "last_edit_date": 1547065570, "question_id": 54117466, "link": "https://stackoverflow.com/questions/54117466/is-clang-or-gcc-correct-about-this-inner-class-member-access", "title": "Is clang or gcc correct about this inner class member access?", "body": "<p>The following code compiles and works on clang, but fails with \"error: invalid use of non-static data member \u2018Outer::a\u2019\" on gcc:</p>\n\n<pre><code>#include &lt;functional&gt;\n#include &lt;vector&gt;\n#include &lt;assert.h&gt;\n#include &lt;iostream&gt;\n#include &lt;memory&gt;\n\nclass Outer\n{\npublic:\n    bool a = false;\n\n    virtual void f() = 0;\n\n    template &lt;typename T&gt;\n    class Inner : public T\n    {\n    public:\n        virtual void f() override\n        {\n            a = true; // Note: accessed through inheritance, not through outer scope\n        }\n    };\n};\n\nstruct Foo : Outer { };\n\nint main()\n{\n    Outer::Inner&lt;Foo&gt; f;\n    f.f();\n}\n</code></pre>\n\n<p>Adding \"this->a\" to the inner class makes it work on both compilers, but I'm wondering what's the correct behavior and what the standards says about this.</p>\n\n<p>Interestingly the above code works with as part of a larger code base in VS2017 at work, but when I try it at home with VS2017 in isolation, it fails with the same error as GCC.</p>\n\n<p>You can try compiling it here:</p>\n\n<ul>\n<li>clang: <a href=\"https://rextester.com/SKAUEY50097\" rel=\"nofollow noreferrer\">https://rextester.com/SKAUEY50097</a></li>\n<li>gcc: <a href=\"https://rextester.com/FLGL37556\" rel=\"nofollow noreferrer\">https://rextester.com/FLGL37556</a></li>\n</ul>\n"}, {"tags": ["c++", "string", "csv"], "comments": [{"owner": {"reputation": 196207, "user_id": 434551, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/8Wzl8.png?s=128&g=1", "display_name": "R Sahu", "link": "https://stackoverflow.com/users/434551/r-sahu"}, "edited": false, "score": 2, "creation_date": 1547062874, "post_id": 54117156, "comment_id": 95067100, "body": "What do you hope to accomplish by the lines of the form <code>cstr[line.size()+1];</code>?"}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 1, "creation_date": 1547062905, "post_id": 54117156, "comment_id": 95067110, "body": "related/a really good read: <a href=\"https://stackoverflow.com/questions/1120140/how-can-i-read-and-parse-csv-files-in-c\" title=\"how can i read and parse csv files in c\">stackoverflow.com/questions/1120140/&hellip;</a>"}, {"owner": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 0, "creation_date": 1547062960, "post_id": 54117156, "comment_id": 95067143, "body": "I would start by getting rid of the char arrays and strcpy"}, {"owner": {"reputation": 808, "user_id": 2615836, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/Oryma.jpg?s=128&g=1", "display_name": "Codes with Hammer", "link": "https://stackoverflow.com/users/2615836/codes-with-hammer"}, "edited": false, "score": 0, "creation_date": 1547063178, "post_id": 54117156, "comment_id": 95067214, "body": "What do you seek to accomplish by having calls to <code>getline()</code> inside the loop <code>while ( getline() )</code>?"}, {"owner": {"reputation": 11, "user_id": 6111922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/376b1268b39253f1a77031df136813b8?s=128&d=identicon&r=PG&f=1", "display_name": "TomEcho", "link": "https://stackoverflow.com/users/6111922/tomecho"}, "edited": false, "score": 0, "creation_date": 1547063218, "post_id": 54117156, "comment_id": 95067228, "body": "the cstr[] part changes the length of the char, from my understanding. The char array and strcpy are there because it would not convert the string to a float."}, {"owner": {"reputation": 11, "user_id": 6111922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/376b1268b39253f1a77031df136813b8?s=128&d=identicon&r=PG&f=1", "display_name": "TomEcho", "link": "https://stackoverflow.com/users/6111922/tomecho"}, "edited": false, "score": 0, "creation_date": 1547063293, "post_id": 54117156, "comment_id": 95067259, "body": "the getline() inside the while is what checks to see if the loop continues or not. I got it from the link I attached in my description"}, {"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "reply_to_user": {"reputation": 808, "user_id": 2615836, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/Oryma.jpg?s=128&g=1", "display_name": "Codes with Hammer", "link": "https://stackoverflow.com/users/2615836/codes-with-hammer"}, "edited": false, "score": 0, "creation_date": 1547063311, "post_id": 54117156, "comment_id": 95067265, "body": "@CodeswithHammer That is one of the things the asker has right in this post. <a href=\"https://stackoverflow.com/questions/5605125/why-is-iostreameof-inside-a-loop-condition-considered-wrong\">Good explanation of what it&#39;s dong and how here</a>."}, {"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 0, "creation_date": 1547063488, "post_id": 54117156, "comment_id": 95067331, "body": "Tom, once an array is created its size cannot be changed. <code>cstr[line.size()+1];</code> accesses an element of the array (and probably doesn&#39;t exist--Kaboom!) and does nothing with it. Odds are good that the compiler will optimize the line out. I recommend using <code>std::string</code> throughout. It is smart enough to change size when used correctly."}, {"owner": {"reputation": 808, "user_id": 2615836, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/Oryma.jpg?s=128&g=1", "display_name": "Codes with Hammer", "link": "https://stackoverflow.com/users/2615836/codes-with-hammer"}, "reply_to_user": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 0, "creation_date": 1547063575, "post_id": 54117156, "comment_id": 95067361, "body": "@user4581301: Ah, it&#39;s been a while since I&#39;ve worked with getline() and raw handling of CSV files."}, {"owner": {"reputation": 11, "user_id": 6111922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/376b1268b39253f1a77031df136813b8?s=128&d=identicon&r=PG&f=1", "display_name": "TomEcho", "link": "https://stackoverflow.com/users/6111922/tomecho"}, "reply_to_user": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 0, "creation_date": 1547064608, "post_id": 54117156, "comment_id": 95067791, "body": "@user4581301 Can you explain more how I would go about using std::string throughout? If I remove the cstr, strcpy and atof lines and only leave the 3 getline()s the cout out prints correctly however once I attempt to convert the strings to floats the program crashes with no errors"}], "answers": [{"comments": [{"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 0, "creation_date": 1547065799, "post_id": 54117753, "comment_id": 95068292, "body": "Recommendations: <code>while (getline(trackBarFile, line,&#39;,&#39;) &amp;&amp; getline(trackBarFile, line2,&#39;,&#39;) &amp;&amp; getline(trackBarFile, line3))</code> You need to have successfully read all three entries to be able to process all three readings. <code>atof</code> does&#39;t tell you if it failed to convert the string, it just returns 0.0, so consult documentation for the <code>std::stof</code> function which throws an exception on failure. In addition <code>std::stof</code> directly accepts <code>std::string</code> and directly returns a <code>float</code>, so <code>lineFloat = std::stof(line);</code>"}, {"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 0, "creation_date": 1547066289, "post_id": 54117753, "comment_id": 95068504, "body": "Also try to avoid stumbling. It&#39;s a really slow way to learn. C++ is a very complex language, probably one of the hardest to learn of all languages in general use today. Trying to learn it by surfing the web for examples or asking questions on Stack Overflow is bordering on futile. You&#39;re better served by getting and working through a <a href=\"https://stackoverflow.com/questions/388242/the-definitive-c-book-guide-and-list\">set of good reference books</a>."}, {"owner": {"reputation": 11, "user_id": 6111922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/376b1268b39253f1a77031df136813b8?s=128&d=identicon&r=PG&f=1", "display_name": "TomEcho", "link": "https://stackoverflow.com/users/6111922/tomecho"}, "reply_to_user": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 0, "creation_date": 1547067477, "post_id": 54117753, "comment_id": 95068977, "body": "I edited the above answer to reflect your recommendation after testing it. I first tried to use stof() but it throws the exception. I&#39;ve gone through and compared the line and lineFloat data and can not see any points that it has converted incorrectly. I found that if I use the stof function just below the cout, the cout for what should be &quot;0&quot; would print out &quot;0@@0&quot;, but if I now commented out the convert line the print out now read &quot;0&quot;"}], "tags": [], "owner": {"reputation": 11, "user_id": 6111922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/376b1268b39253f1a77031df136813b8?s=128&d=identicon&r=PG&f=1", "display_name": "TomEcho", "link": "https://stackoverflow.com/users/6111922/tomecho"}, "is_accepted": false, "score": 1, "last_activity_date": 1547067195, "last_edit_date": 1547067195, "creation_date": 1547065341, "answer_id": 54117753, "question_id": 54117156, "link": "https://stackoverflow.com/questions/54117156/c-read-in-a-csv-file-as-floats/54117753#54117753", "title": "C++ read in a CSV file as floats", "body": "<p>It seems I have stumbled upon the answer to my own question. Thanks to the above questions I started looking for different ways to convert the string to a float. The +2 in the print out can be ignored, was my \"pinch\" to make sure I wasn't dreaming</p>\n\n<pre><code>trackBarFile.open(\"TrackBarSignal.csv\");\n\nstd::ofstream fout;\nfout.open(\"Output_ReadInCSV.txt\");\n\nstd::string line, line2, line3;\nint count;\nfloat tokenNum,lineFloat,line2Float,line3Float;\n\nwhile (getline(trackBarFile, line,',')&amp;&amp;getline(trackBarFile, line2,',')&amp;&amp;getline(trackBarFile, line3)) \n{\n\n    lineFloat = (float)atof(line.c_str());\n    line2Float = (float)atof(line2.c_str());\n    line3Float = (float)atof(line3.c_str());\n\n    std::cout&lt;&lt;line&lt;&lt;\",\"&lt;&lt;lineFloat+2&lt;&lt;\"   ,   \"&lt;&lt;line2&lt;&lt;\",\"&lt;&lt;line2Float+2&lt;&lt;\"  ,  \"&lt;&lt;line3&lt;&lt;\",\"&lt;&lt;line3Float+2&lt;&lt;std::endl;\n\n}\n\ntrackBarFile.close();\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 6111922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/376b1268b39253f1a77031df136813b8?s=128&d=identicon&r=PG&f=1", "display_name": "TomEcho", "link": "https://stackoverflow.com/users/6111922/tomecho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1350, "favorite_count": 1, "answer_count": 1, "score": -1, "last_activity_date": 1547067195, "creation_date": 1547062667, "question_id": 54117156, "link": "https://stackoverflow.com/questions/54117156/c-read-in-a-csv-file-as-floats", "title": "C++ read in a CSV file as floats", "body": "<p>I'm trying to read in a .csv file filled with floats. I used  <a href=\"https://stackoverflow.com/questions/16446665/c-read-from-csv-file\">this</a> to build my code. However, the data reads in correctly but is read in as a string but I want to use the data as floats. If I try to use stof(string) I get an error that it is trying to convert a non number to a number. So I went the really long way and converted the string to a char and that to a float, which works but is VERY ugly. However, once all the data is read in and is printed out with a cout the program my crashes</p>\n\n<pre><code>trackBarFile.open(\"test2.csv\");\n\n\nstd::string line, line2, line3;\nint count;\nstd::string token;\nfloat tokenNum,lineFloat,line2Float,line3Float;\nchar cstr[5],cstr2[5];\n\nwhile (getline(trackBarFile, line,',')) \n{\n\n    cstr[line.size()+1];\n    strcpy(cstr, line.c_str());\n    lineFloat = atof(cstr);\n\n    getline(trackBarFile, line2,',');\n    cstr[line2.size()+1];\n    strcpy(cstr, line2.c_str());\n    line2Float = atof(cstr);\n\n    getline(trackBarFile, line3);       \n    cstr2[line3.size()+1];\n    strcpy(cstr2, line3.c_str());\n    line3Float = atof(cstr2);\n\n\n    std::cout&lt;&lt;line&lt;&lt;\",\"&lt;&lt;lineFloat&lt;&lt;\"   , \"&lt;&lt;line2&lt;&lt;\",\"&lt;&lt;line2Float&lt;&lt;\"  ,  \"&lt;&lt;line3&lt;&lt;\",\"&lt;&lt;line3Float&lt;&lt;std::endl;\n\n\n}\n\ntrackBarFile.close();\n</code></pre>\n"}, {"tags": ["c++", "arrays", "pointers", "reference", "lvalue"], "comments": [{"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547062553, "post_id": 54117115, "comment_id": 95066941, "body": "<i>&quot;Parameter <code>int* &amp;p</code> in <code>hoo</code> will pass the argument by reference. It means we can change the passed argument to point to another value from within the <code>hoo</code>.&quot;</i> What if you tried to do <code>p=nullptr</code> in <code>hoo</code>? What would the intended result be for <code>array</code>?"}, {"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 2, "creation_date": 1547062555, "post_id": 54117115, "comment_id": 95066943, "body": "An array is <b>not</b> a pointer to its first element. Your title asks a entirely different question than your question-text. You <i>can</i> pass a <code>int[]</code> to a <code>int*</code>, but not to a <code>int*&amp;</code>."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1547062665, "post_id": 54117115, "comment_id": 95066994, "body": "@tkausl I edited the question title and it invalidates part of your comment."}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 2, "creation_date": 1547062810, "post_id": 54117115, "comment_id": 95067072, "body": "An array is <b>not</b> a pointer, full stop.  It will save you many headaches if you treat an array as what it really is.  Yes, it can decay to a pointer in most cases but don&#39;t think of it as a pointer.  Additionally, you can just stop using raw arrays and use <code>std:array</code> in their place.  They&#39;ll make issues like this go away."}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1547062887, "post_id": 54117115, "comment_id": 95067102, "body": "is there some real problem you are trying to solve or is this just for learning purpose? In either case, use an <code>std::array</code> or <code>std::vector</code>"}, {"owner": {"reputation": 4935, "user_id": 5482465, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/QHF0G.png?s=128&g=1", "display_name": "Money Sets You Free", "link": "https://stackoverflow.com/users/5482465/money-sets-you-free"}, "reply_to_user": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1547063060, "post_id": 54117115, "comment_id": 95067167, "body": "@user463035818: learning c++ and opencv."}], "answers": [{"tags": [], "owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "is_accepted": true, "score": 7, "last_activity_date": 1547063263, "last_edit_date": 1547063263, "creation_date": 1547062883, "answer_id": 54117199, "question_id": 54117115, "link": "https://stackoverflow.com/questions/54117115/why-cant-we-pass-int-array-to-hooint-p/54117199#54117199", "title": "Why can&#39;t we pass int array[] to hoo(int* &amp;p)?", "body": "<blockquote>\n  <p>In my understanding array in int array[]={1,2,3,4,5} is just a pointer to the first element of array.</p>\n</blockquote>\n\n<p>This is not correct. Arrays are arrays and pointers are pointers. They are distinct types with distinct properties. They are often confused because an array has the property that it will eagerly decay to a pointer to its first element.</p>\n\n<p><code>hoo(array, 5);</code> tries to convert <code>array</code> to an <code>int*</code> but the result of that conversion is an rvalue and can't be bound to a non-<code>const</code> reference. If, for example, you changed <code>hoo</code> to take a <code>const</code> reference it will compile fine : </p>\n\n<pre><code>void hoo(int* const &amp;p, int n) { }\n\nint main()\n{\n    int array[] = { 1,2,3,4,5 };\n    hoo(array, 5);\n}\n</code></pre>\n\n<p>In that case, you cannot change <em>what</em> <code>p</code> points to, making the use of a reference pointless.</p>\n"}, {"tags": [], "owner": {"reputation": 85518, "user_id": 1593077, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/10c44e0d9568e48d05708ae196ad936f?s=128&d=identicon&r=PG", "display_name": "einpoklum", "link": "https://stackoverflow.com/users/1593077/einpoklum"}, "is_accepted": false, "score": 3, "last_activity_date": 1547062953, "creation_date": 1547062953, "answer_id": 54117220, "question_id": 54117115, "link": "https://stackoverflow.com/questions/54117115/why-cant-we-pass-int-array-to-hooint-p/54117220#54117220", "title": "Why can&#39;t we pass int array[] to hoo(int* &amp;p)?", "body": "<p>When a function takes an <code>int* &amp;</code> parameter, that is, a (non-move) reference to a pointer-to-an-<code>int</code> - then there needs to be a bona fide pointer variable to which that reference is referring. It can't be a temporary pointer value. Thus you can't do:</p>\n\n<pre><code>int x;\nhoo(&amp;x, 123);\n</code></pre>\n\n<p>because there's no pointer variable to refer to - just the temporary. It's essentially the same thing with your <code>int[5]</code>. There isn't actually an <code>int*</code> variable anywhere - there are just 5 <code>int</code>s. When you pass <code>array</code> to <code>hoo()</code>, what C++ does with that identifier is an <a href=\"https://stackoverflow.com/questions/1461432/what-is-array-decaying\">array-to-pointer decay</a>: It actually passes <code>&amp;(array[0])</code>. So just like in the previous case, that won't compile.</p>\n"}, {"comments": [{"owner": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "edited": false, "score": 0, "creation_date": 1547063577, "post_id": 54117330, "comment_id": 95067364, "body": "That will not accept dynamically allocated array so pretty much it has very limited use."}, {"owner": {"reputation": 196207, "user_id": 434551, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/8Wzl8.png?s=128&g=1", "display_name": "R Sahu", "link": "https://stackoverflow.com/users/434551/r-sahu"}, "reply_to_user": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "edited": false, "score": 0, "creation_date": 1547063885, "post_id": 54117330, "comment_id": 95067492, "body": "@Slava, true. Updated the answer."}], "tags": [], "owner": {"reputation": 196207, "user_id": 434551, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/8Wzl8.png?s=128&g=1", "display_name": "R Sahu", "link": "https://stackoverflow.com/users/434551/r-sahu"}, "is_accepted": false, "score": 3, "last_activity_date": 1547067791, "last_edit_date": 1547067791, "creation_date": 1547063461, "answer_id": 54117330, "question_id": 54117115, "link": "https://stackoverflow.com/questions/54117115/why-cant-we-pass-int-array-to-hooint-p/54117330#54117330", "title": "Why can&#39;t we pass int array[] to hoo(int* &amp;p)?", "body": "<p>The other answers already explain the problem. I want to suggest a change of coding practice.</p>\n\n<p>Use of <code>void hoo(int* &amp;p, int n)</code> as function declaration is very very old style. Using templates, you can let the compiler deduce the size and get a reference to the array, which obviates the need for using a pointer.</p>\n\n<pre><code>template &lt;size_t N&gt;\nvoid hoo( int (&amp;p)[N]) // The argument is a reference to an array of N elements.\n{\n    for (int i = 0; i &lt; N; i++)\n        cout &lt;&lt; p[i] &lt;&lt; endl;\n}\n</code></pre>\n\n<p>The call to the function becomes natural.</p>\n\n<pre><code>int array[] = { 1,2,3,4,5 };\nhoo(array);\n</code></pre>\n\n<p>If your function needs to be able to support dynamically allocated arrays as well, you can overload the function as follows.</p>\n\n<pre><code>void hoo(int* p, size_t N)\n{\n    for (int i = 0; i &lt; N; i++)\n        cout &lt;&lt; p[i] &lt;&lt; endl;\n}\n\ntemplate &lt;size_t N&gt;\nvoid hoo( int (&amp;p)[N]) // The argument is a reference to an array of N elements.\n{\n    hoo(p, N);\n}\n</code></pre>\n"}], "owner": {"reputation": 4935, "user_id": 5482465, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/QHF0G.png?s=128&g=1", "display_name": "Money Sets You Free", "link": "https://stackoverflow.com/users/5482465/money-sets-you-free"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 54117199, "answer_count": 3, "score": -2, "last_activity_date": 1547067791, "creation_date": 1547062471, "last_edit_date": 1547063077, "question_id": 54117115, "link": "https://stackoverflow.com/questions/54117115/why-cant-we-pass-int-array-to-hooint-p", "title": "Why can&#39;t we pass int array[] to hoo(int* &amp;p)?", "body": "<p>In my understanding <code>array</code> in <code>int array[]={1,2,3,4,5}</code> is just a pointer to the first element of <code>array</code>. It means that <code>array</code> can be assigned to a pointer <code>ptr</code> of type <code>int*</code>.</p>\n\n<p>Parameter <code>int* &amp;p</code> in <code>hoo</code> will pass the argument by reference. It means we can change the passed argument to point to another value from within the <code>hoo</code>. </p>\n\n<pre><code>void hoo(int* &amp;p, int n)\n{\n    for (int i = 0; i &lt; n; i++)\n        cout &lt;&lt; p[i] &lt;&lt; endl;\n}\n\nint main()\n{\n    int array[] = { 1,2,3,4,5 };\n\n    // I can do this\n    int* ptr = array;\n    hoo(ptr, 5);\n\n    // but not this.\n    //hoo(array, 5);\n}\n</code></pre>\n\n<h1>Question</h1>\n\n<p>Why can't we pass int <code>array</code> to <code>hoo</code> without <code>ptr</code> ?</p>\n"}, {"tags": ["c++", "qt", "qprinter"], "comments": [{"owner": {"reputation": 17562, "user_id": 568635, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/25f0758867b3f251cfdf101b9611b9b5?s=128&d=identicon&r=PG", "display_name": "Eelke", "link": "https://stackoverflow.com/users/568635/eelke"}, "edited": false, "score": 0, "creation_date": 1547063840, "post_id": 54116867, "comment_id": 95067472, "body": "How did you figure out the correct letterspacing? If you did this by trial and error printing to a PDF it might be your pdf reader that is in error. Use Adobe Reader most other readers are not perfect (including those in chrome and firefox)."}, {"owner": {"reputation": 578, "user_id": 4986475, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d618a99046cf31323a7058d327f8aed3?s=128&d=identicon&r=PG&f=1", "display_name": "Macias", "link": "https://stackoverflow.com/users/4986475/macias"}, "reply_to_user": {"reputation": 17562, "user_id": 568635, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/25f0758867b3f251cfdf101b9611b9b5?s=128&d=identicon&r=PG", "display_name": "Eelke", "link": "https://stackoverflow.com/users/568635/eelke"}, "edited": false, "score": 0, "creation_date": 1547064282, "post_id": 54116867, "comment_id": 95067652, "body": "@Eelke Adobe Reader gives the same result as chrome which I used previously."}], "owner": {"reputation": 578, "user_id": 4986475, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d618a99046cf31323a7058d327f8aed3?s=128&d=identicon&r=PG&f=1", "display_name": "Macias", "link": "https://stackoverflow.com/users/4986475/macias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 419, "favorite_count": 2, "answer_count": 0, "score": 4, "last_activity_date": 1561648736, "creation_date": 1547061450, "last_edit_date": 1561648736, "question_id": 54116867, "link": "https://stackoverflow.com/questions/54116867/qprinter-gives-different-font-spacing-for-pdf-and-physical-printer", "title": "QPrinter gives different font spacing for PDF and physical printer", "body": "<p>I'm using QPrinter to fill forms with text and print them on the printer.</p>\n\n<p>For tests I generate pdf files to avoid paper and ink waste.\nI figured out that font spacings are different for PDF's and factical prints</p>\n\n<p><strong>Minimal example:</strong></p>\n\n<pre><code>#include &lt;QApplication&gt;\n#include &lt;QPrinter&gt;\n#include &lt;QPrinterInfo&gt;\n#include &lt;QPainter&gt;\n#include &lt;QFontDatabase&gt;\n\nvoid printForm(bool pdf);\n\nQString g_fontFamily = \"\";\n\nint main(int argc, char *argv[])\n{\n    QApplication a(argc, argv);\n\n    int id = QFontDatabase::addApplicationFont(\":/IBMPlexMono-Medium.ttf\");\n    g_fontFamily = QFontDatabase::applicationFontFamilies(id).at(0);\n\n    printForm(true); //pdf\n    printForm(false); //physical printer\n\n    return a.exec();\n}\n\n\nvoid printForm(bool pdf)\n{\n    //setup printer\n    QPrinter *printer;\n    if(pdf)\n    {\n        printer = new QPrinter(QPrinter::ScreenResolution);\n        printer-&gt;setOutputFormat(QPrinter::PdfFormat);\n        printer-&gt;setOutputFileName(\"./regular.pdf\");\n    }\n    else\n    {\n        printer = new QPrinter(QPrinterInfo::defaultPrinter(), QPrinter::ScreenResolution);\n        printer-&gt;setOutputFormat(QPrinter::NativeFormat);\n    }\n    printer-&gt;setOrientation(QPrinter::Orientation::Landscape);\n    QPageSize customSize(QSizeF(105.0, 157.76), QPageSize::Millimeter, \"\", QPageSize::ExactMatch);\n    printer-&gt;setPageSize(customSize);\n\n    //draw background\n    QImage img(\":/regular_transfer_form\");\n    QPainter painter(printer);\n    painter.drawImage(QRect(0,0, printer-&gt;width(), printer-&gt;height()), img, QRect(0,0, img.width(), img.height()));\n\n    //draw text\n    painter.setPen(Qt::black);\n    QFont font(g_fontFamily, 11);\n    font.setStyleHint(QFont::TypeWriter);\n    font.setLetterSpacing(QFont::PercentageSpacing, 212);\n\n    painter.setFont(font);\n\n    QTextOption textOption(Qt::AlignVCenter | Qt::AlignLeft);\n    textOption.setWrapMode(QTextOption::NoWrap);\n\n    QString text = \"Lorem ipsum dolor sit amet, consectetur adipiscing elit\";\n\n    QRectF relativeArea(0.05838, 0.0783, 0.8971, 0.04583); //coords relative to background\n\n    QRectF areaOnPaper(relativeArea.x() * printer-&gt;width(),\n                                relativeArea.y() * printer-&gt;height(),\n                                relativeArea.width() * printer-&gt;width(),\n                                relativeArea.height() * printer-&gt;height()\n                                );\n\n    painter.drawText(areaOnPaper, text, textOption); //draw 1-st line wit percentage Spacing\n\n    //set spacing to absolute\n    font.setLetterSpacing(QFont::AbsoluteSpacing, 10);\n    painter.setFont(font);\n\n    areaOnPaper.setRect(areaOnPaper.x(), areaOnPaper.y() + 28, areaOnPaper.width(), areaOnPaper.height());\n    painter.drawText(areaOnPaper, text, textOption); //draw 2-nd line wit absolute Spacing\n\n}\n</code></pre>\n\n<p><strong>And the results:</strong></p>\n\n<p>PDF: Its fine\n<a href=\"https://i.stack.imgur.com/J5uUe.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/J5uUe.png\" alt=\"enter image description here\"></a></p>\n\n<p>Print from the printer:\n<a href=\"https://i.stack.imgur.com/zEYP0.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/zEYP0.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>As you can see - on paper the letters are not in boxes, but the code is identical for both.</p>\n\n<p>I tried with <code>QFont::PercentageSpacing</code> (1-st line) and <code>QFont::AbsoluteSpacing</code> (2nd line) due to Note in <a href=\"http://doc.qt.io/qt-5/qprinter.html#PrinterMode-enum\" rel=\"nofollow noreferrer\">QPrinter documentation</a>. No success.</p>\n\n<p>Am I doing something wrong or there is a bug in Qt?</p>\n\n<p>Is there any way to achieve the same result for both cases?</p>\n\n<p>Full example on <a href=\"https://github.com/macias0/QPrinterSpacingIssue\" rel=\"nofollow noreferrer\">github</a> with background image and font</p>\n\n<p><strong>EDIT</strong>:\n<a href=\"https://bugreports.qt.io/browse/QTBUG-72939\" rel=\"nofollow noreferrer\">https://bugreports.qt.io/browse/QTBUG-72939</a></p>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 2, "creation_date": 1547061419, "post_id": 54116813, "comment_id": 95066452, "body": "&quot;#include&lt;bits/stdc++.h&gt;&quot; - Don&#39;t do that. That header is for the implementation to use, <i>not</i> you."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 1, "creation_date": 1547062067, "post_id": 54116813, "comment_id": 95066734, "body": "At what size input does it start to fail? Seems like <code>(n*n+n)</code> would be the best candidate for an overflow."}, {"owner": {"reputation": 3531, "user_id": 10553341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba6a76c909bfdb760607076ee5aad83c?s=128&d=identicon&r=PG&f=1", "display_name": "Damien", "link": "https://stackoverflow.com/users/10553341/damien"}, "edited": false, "score": 0, "creation_date": 1547062271, "post_id": 54116813, "comment_id": 95066822, "body": "A good hint is provided in the link you gave: first divide by 2 ..."}, {"owner": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 1, "creation_date": 1547062312, "post_id": 54116813, "comment_id": 95066841, "body": "This <code>sum1=((n*(n-1))&#47;2)%1000007</code> looks dangerous when using unsigned types, if the value for <code>n</code> that is entered can be less than, or equal to, zero."}, {"owner": {"reputation": 191, "user_id": 10458439, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/471084ace261d6c1240035d53fac5cf8?s=128&d=identicon&r=PG&f=1", "display_name": "newby", "link": "https://stackoverflow.com/users/10458439/newby"}, "reply_to_user": {"reputation": 3531, "user_id": 10553341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba6a76c909bfdb760607076ee5aad83c?s=128&d=identicon&r=PG&f=1", "display_name": "Damien", "link": "https://stackoverflow.com/users/10553341/damien"}, "edited": false, "score": 0, "creation_date": 1547062402, "post_id": 54116813, "comment_id": 95066878, "body": "why we should divide by 2 first? @Damien"}, {"owner": {"reputation": 61, "user_id": 10891599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4fd6ec95eab49f6b5f33abc53ef36b32?s=128&d=identicon&r=PG&f=1", "display_name": "user10891599", "link": "https://stackoverflow.com/users/10891599/user10891599"}, "reply_to_user": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 0, "creation_date": 1547062481, "post_id": 54116813, "comment_id": 95066908, "body": "But in the question it is given that n&gt;1 ? Then why answer is wrong @JesperJuhl"}, {"owner": {"reputation": 3531, "user_id": 10553341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba6a76c909bfdb760607076ee5aad83c?s=128&d=identicon&r=PG&f=1", "display_name": "Damien", "link": "https://stackoverflow.com/users/10553341/damien"}, "edited": false, "score": 0, "creation_date": 1547062509, "post_id": 54116813, "comment_id": 95066921, "body": "To limit the size of intermediate values. Try on a simple example"}, {"owner": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 0, "creation_date": 1547062593, "post_id": 54116813, "comment_id": 95066965, "body": "@user10891599 The question was behind an external link, so I did not read it."}, {"owner": {"reputation": 8580, "user_id": 2293156, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/800e791e8e13500e516c9ae77299160a?s=128&d=identicon&r=PG", "display_name": "Amadeus", "link": "https://stackoverflow.com/users/2293156/amadeus"}, "edited": false, "score": 0, "creation_date": 1547064653, "post_id": 54116813, "comment_id": 95067811, "body": "Show a case in which your program get wrong results and what should be the correct one"}, {"owner": {"reputation": 61, "user_id": 10891599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4fd6ec95eab49f6b5f33abc53ef36b32?s=128&d=identicon&r=PG&f=1", "display_name": "user10891599", "link": "https://stackoverflow.com/users/10891599/user10891599"}, "edited": false, "score": 0, "creation_date": 1547065222, "post_id": 54116813, "comment_id": 95068030, "body": "Answer get accepted when i use unsigned long long n but max value was of n was 1000 000? so it should also get accepted on int n also"}, {"owner": {"reputation": 9311, "user_id": 4944425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05592a58619d128e2eee1c3c17801e76?s=128&d=identicon&r=PG&f=1", "display_name": "Bob__", "link": "https://stackoverflow.com/users/4944425/bob"}, "reply_to_user": {"reputation": 3531, "user_id": 10553341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba6a76c909bfdb760607076ee5aad83c?s=128&d=identicon&r=PG&f=1", "display_name": "Damien", "link": "https://stackoverflow.com/users/10553341/damien"}, "edited": false, "score": 0, "creation_date": 1547065300, "post_id": 54116813, "comment_id": 95068064, "body": "@Damien Please note that in the linked solution the division is performed <i>after</i> the multiplication, <code>n * (n - 1)</code>, which, while a possible cause of overflow for an 32-bit <code>int</code>, has the nice property of beeing always even."}, {"owner": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 0, "creation_date": 1547065742, "post_id": 54116813, "comment_id": 95068267, "body": "<b><i>Answer get accepted when i use unsigned long long n but max value was of n was 1000 000? so it should also get accepted on int n also</i></b> 1000 000 * 1000 000 is greater than 2^32. Even though sum1 is unsigned long long the inner calculation is done as int."}, {"owner": {"reputation": 9311, "user_id": 4944425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05592a58619d128e2eee1c3c17801e76?s=128&d=identicon&r=PG&f=1", "display_name": "Bob__", "link": "https://stackoverflow.com/users/4944425/bob"}, "edited": false, "score": 0, "creation_date": 1547065760, "post_id": 54116813, "comment_id": 95068277, "body": "<code>n</code> may be in the range of an <code>int</code>, but (10^6)^2 is greater than the value of INT_MAX in most implementations. Note that the result of <code>((n*(n-1))&#47;2)%1000007</code> is converted to the type of <code>sum1</code> only <i>after</i> having been evaluated as an <code>int</code>."}, {"owner": {"reputation": 3531, "user_id": 10553341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba6a76c909bfdb760607076ee5aad83c?s=128&d=identicon&r=PG&f=1", "display_name": "Damien", "link": "https://stackoverflow.com/users/10553341/damien"}, "reply_to_user": {"reputation": 9311, "user_id": 4944425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05592a58619d128e2eee1c3c17801e76?s=128&d=identicon&r=PG&f=1", "display_name": "Bob__", "link": "https://stackoverflow.com/users/4944425/bob"}, "edited": false, "score": 0, "creation_date": 1547065990, "post_id": 54116813, "comment_id": 95068372, "body": "@Bob__ Right. I just read the analysis before the programme: &quot;Be certain that you do the division first because ...&quot;. Note also that if <code>n</code> is odd, you can divide <code>(n-1)</code> by 2 instead of dividing <code>n</code>."}, {"owner": {"reputation": 5746, "user_id": 1563833, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f3d7ae271e46eb178e7dd4f2ef760e6f?s=128&d=identicon&r=PG", "display_name": "Wyck", "link": "https://stackoverflow.com/users/1563833/wyck"}, "edited": false, "score": 0, "creation_date": 1547067182, "post_id": 54116813, "comment_id": 95068866, "body": "You made <code>sum1</code> unsigned long long but the suggestion was to make <code>n</code> unsigned long long."}], "answers": [{"comments": [{"owner": {"reputation": 61, "user_id": 10891599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4fd6ec95eab49f6b5f33abc53ef36b32?s=128&d=identicon&r=PG&f=1", "display_name": "user10891599", "link": "https://stackoverflow.com/users/10891599/user10891599"}, "edited": false, "score": 0, "creation_date": 1547064627, "post_id": 54117356, "comment_id": 95067799, "body": "sorry the solution is accepted but why this happened  range was 1 000 000 only? which is under int range"}, {"owner": {"reputation": 5867, "user_id": 9125195, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75fc90d1f6de6ff28c739b85bdb82f4c?s=128&d=identicon&r=PG&f=1", "display_name": "Sid S", "link": "https://stackoverflow.com/users/9125195/sid-s"}, "reply_to_user": {"reputation": 61, "user_id": 10891599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4fd6ec95eab49f6b5f33abc53ef36b32?s=128&d=identicon&r=PG&f=1", "display_name": "user10891599", "link": "https://stackoverflow.com/users/10891599/user10891599"}, "edited": false, "score": 0, "creation_date": 1547068557, "post_id": 54117356, "comment_id": 95069466, "body": "@user10891599, It happens because there are interim results that exceed the range of <code>int</code>."}], "tags": [], "owner": {"reputation": 5867, "user_id": 9125195, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75fc90d1f6de6ff28c739b85bdb82f4c?s=128&d=identicon&r=PG&f=1", "display_name": "Sid S", "link": "https://stackoverflow.com/users/9125195/sid-s"}, "is_accepted": false, "score": 2, "last_activity_date": 1547068237, "last_edit_date": 1547068237, "creation_date": 1547063516, "answer_id": 54117356, "question_id": 54116813, "link": "https://stackoverflow.com/questions/54116813/integer-overflow-in-below-program-for-max-int-1000-000which-is-under-range-of-i/54117356#54117356", "title": "integer overflow in below program for max int 1000 000(which is under range of int)", "body": "<p>Your code overflows the range of <code>int</code> in the <code>n * (n - 1)</code> and <code>n * n</code> multiplications when <code>n</code> is large.</p>\n\n<p>It has to do with the order of operations.  For instance, <code>(n * n + n) % 1000007;</code>  Here, first <code>n *  n</code> is calculated.  The result is bigger than you can fit in an <code>int</code>,  so you get integer overflow.  The resulting <code>int</code> value is smaller than it should be because of the overflow.  To that too small value, <code>n</code> is added.  This results in another <code>int</code> that is too small.  That too small value is divided by <code>2</code>.  Finally, the <code>%</code> is carried out.</p>\n\n<p>A simple workaround is to declare <code>n</code> like this:</p>\n\n<pre><code>unsigned long long n;\n</code></pre>\n\n<p>By changing the type of <code>n</code> to <code>unsigned long long</code>, each step in the calculation will be of type <code>unsigned long long</code> since the first step of the calculation is carried out on <code>n</code>.</p>\n"}], "owner": {"reputation": 61, "user_id": 10891599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4fd6ec95eab49f6b5f33abc53ef36b32?s=128&d=identicon&r=PG&f=1", "display_name": "user10891599", "link": "https://stackoverflow.com/users/10891599/user10891599"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1547068237, "creation_date": 1547061221, "last_edit_date": 1547065489, "question_id": 54116813, "link": "https://stackoverflow.com/questions/54116813/integer-overflow-in-below-program-for-max-int-1000-000which-is-under-range-of-i", "title": "integer overflow in below program for max int 1000 000(which is under range of int)", "body": "<p>I was solving a problem on spoj,<a href=\"https://www.spoj.com/problems/CRDS/\" rel=\"nofollow noreferrer\">SPOJ CARDS</a>\nThe problem is easy and i am getting correct output for small numbers,But it seems to spoj is not accepting due to integer overflow ,\nThen what integer type should i use?</p>\n\n<p>OR is there any other problem that they are not accepting it ?I also don't know the test cases in which it might be failing </p>\n\n<p>some of the accepted solution of other guys that seem to use the same logic and there solution is accepted <a href=\"http://xoptutorials.com/index.php/2017/01/01/spojcrds/\" rel=\"nofollow noreferrer\">accepted sol</a></p>\n\n<p>Test case:</p>\n\n<pre><code>      2\n      3\n      7\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>      15\n      77\n</code></pre>\n\n<p>.</p>\n\n<pre><code>    #include&lt;bits/stdc++.h&gt;\n    using namespace std;\n    int main(){\n        int t;\n        cin&gt;&gt;t;\n        while(t--){\n            int n;\n            cin&gt;&gt;n;\n            unsigned long long int sum1=0;\n            unsigned long long int sum2=0;\n            sum1=((n*(n-1))/2)%1000007;\n          //  cout&lt;&lt;\"sum1 is\"&lt;&lt;sum1;\n            sum2=(n*n+n)%1000007;\n            cout&lt;&lt;(sum1+sum2)%1000007&lt;&lt;endl;\n\n        }\n\n    }\n</code></pre>\n\n<p>EDIT</p>\n\n<p>The answer get accepted when i use unsigned long  long n but max value of n was\n1000 000 then it should also get accepted in int n because nmax is under  range of int  </p>\n"}, {"tags": ["c++", "language-lawyer", "c++17"], "comments": [{"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 1, "creation_date": 1547061692, "post_id": 54116810, "comment_id": 95066572, "body": "The same thing happens with the insert function.  related: <a href=\"https://stackoverflow.com/questions/48923835/rvalue-ref-qualifiers-for-stl-containers\" title=\"rvalue ref qualifiers for stl containers\">stackoverflow.com/questions/48923835/&hellip;</a>"}, {"owner": {"reputation": 2289, "user_id": 2356414, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dff4a2241e2dcfc50615e4b7c709bd17?s=128&d=identicon&r=PG", "display_name": "KABoissonneault", "link": "https://stackoverflow.com/users/2356414/kaboissonneault"}, "edited": false, "score": 1, "creation_date": 1547061704, "post_id": 54116810, "comment_id": 95066575, "body": "Value categories are not good indicators of lifetime. There are cases where a temporary can be valid as long as the return references (ie: a valid case), and there are cases where the reference outlives its associated variable (ie: invalid case)."}, {"owner": {"reputation": 2289, "user_id": 2356414, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dff4a2241e2dcfc50615e4b7c709bd17?s=128&d=identicon&r=PG", "display_name": "KABoissonneault", "link": "https://stackoverflow.com/users/2356414/kaboissonneault"}, "edited": false, "score": 4, "creation_date": 1547061802, "post_id": 54116810, "comment_id": 95066619, "body": "If you stop assuming lifetime extension is a feature (it&#39;s never really necessary), you will get less such surprises"}, {"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 0, "creation_date": 1547065031, "post_id": 54116810, "comment_id": 95067969, "body": "<a href=\"https://stackoverflow.com/questions/tagged/rust\">rust</a> has life time in its types."}], "answers": [{"comments": [{"owner": {"reputation": 5668, "user_id": 4083309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6b4ef5a2e912153069b82607789a717?s=128&d=identicon&r=PG&f=1", "display_name": "Arne Vogel", "link": "https://stackoverflow.com/users/4083309/arne-vogel"}, "edited": false, "score": 0, "creation_date": 1547133646, "post_id": 54117425, "comment_id": 95094809, "body": "I like the range-v3 approach to this problem of returning a <code>dangling&lt;Iterator&gt;</code> in similar cases. The only thing you can do with this type is calling <code>get_unsafe()</code> on it to get the actual iterator. E.g. in <code>const auto my2 = find(ints(1,3), 2);</code>, <code>my2</code> is dangling because the iterator it wraps refers to a temporary range which is deleted at the end of the complete statement. This is overly restrictive for <code>std::optional&lt;T&gt;::value()</code>, but I&#39;m sure it could be adapted to work with intended uses while still preventing things like range-based for loops."}], "tags": [], "owner": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "is_accepted": true, "score": 1, "last_activity_date": 1547063905, "creation_date": 1547063905, "answer_id": 54117425, "question_id": 54116810, "link": "https://stackoverflow.com/questions/54116810/why-arent-c17s-emplace-functions-ref-qualified/54117425#54117425", "title": "Why aren&#39;t c++17&#39;s emplace() functions ref-qualified?", "body": "<p>Next to nothing in the std library is ref-qualified.</p>\n\n<p>As for <code>value</code>, it returns a rvalue reference.  When you have an rvalue qualified method returning a reference to internal state, you have two choices.</p>\n\n<p>You can return a value, or you can return an rvalue reference.</p>\n\n<p>If you return a value, this means <code>.value()</code> on an rvalue optional does a move, while <code>.value()</code> on an lvalue optional does not.  This could be surprising.</p>\n\n<p>The cost of <code>.value()</code> returning an rvalue is that reference lifetime extension does not apply.  The cost of <code>.value()</code> returning a copy on an rvalue is the cost of the move, plus the surprise that it behaves differently.</p>\n\n<p>Both have downsides.  I have a memory of it being a discussion point in the design of optional.  If my memory is correct, that means the decision was made with open eyes.</p>\n\n<p>Barring an extreme improvement to reference lifetime extension, functions on rvalues returning rvalues to internal state are always going to bind to <code>const&amp;</code> and not extend the lifetime of the external object.</p>\n\n<p>The real pain point in my experience is <code>for(:)</code> loops;</p>\n\n<pre><code>std::optional&lt;std::vector&lt;int&gt;&gt; try_get_vec();\n\nfor (int x : try_get_vec().value()) // I know the optional won't be empty\n</code></pre>\n\n<p>the above has a dangling reference in it.</p>\n"}, {"tags": [], "owner": {"reputation": 245138, "user_id": 2069064, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/e4V2X.jpg?s=128&g=1", "display_name": "Barry", "link": "https://stackoverflow.com/users/2069064/barry"}, "is_accepted": false, "score": -1, "last_activity_date": 1547067420, "creation_date": 1547067420, "answer_id": 54118233, "question_id": 54116810, "link": "https://stackoverflow.com/questions/54116810/why-arent-c17s-emplace-functions-ref-qualified/54118233#54118233", "title": "Why aren&#39;t c++17&#39;s emplace() functions ref-qualified?", "body": "<blockquote>\n  <p>Is there any reason why these functions are not ref-qualified, and [...]</p>\n</blockquote>\n\n<p>There's a lot of functions in the standard library that <em>could</em> be <code>&amp;</code>-qualified but aren't. Calling <code>emplace()</code>-like methods on an rvalue is probably a good example of code that probably doesn't make a whole lot of sense.</p>\n\n<p>On the flip side, there's probably not a lot of people trying to call <code>emplace()</code>-like methods on rvalues, so maybe the payoff for <code>&amp;</code>-qualifying all these functions isn't worth the time. </p>\n\n<blockquote>\n  <p>[...] and why <code>std::optional&lt;&gt;::value()</code> doesn't properly extend the lifetime of the contained object when used on an rvalue?</p>\n</blockquote>\n\n<p>It can't extend the lifetime. There's no such language facility. The choice is either to return a value (which would force a move you may not need, but would be safe) or return a reference (which avoids unnecessary moves, but relies on the programmer to use it safely). The library chose the latter.</p>\n"}], "owner": {"reputation": 1149, "user_id": 4683659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d113f636969daae858e1510b438541c?s=128&d=identicon&r=PG", "display_name": "John Drouhard", "link": "https://stackoverflow.com/users/4683659/john-drouhard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 320, "favorite_count": 1, "accepted_answer_id": 54117425, "answer_count": 2, "score": 5, "last_activity_date": 1547067420, "creation_date": 1547061208, "question_id": 54116810, "link": "https://stackoverflow.com/questions/54116810/why-arent-c17s-emplace-functions-ref-qualified", "title": "Why aren&#39;t c++17&#39;s emplace() functions ref-qualified?", "body": "<p>C++17 introduced a new function signature for a few <code>emplace_back()</code> type functions (<code>std::optional&lt;&gt;</code> has one too), but they are not ref-qualified. This allows <code>emplace_back()</code> to be called on a temporary and bound to lvalue references, even though the lifetime of the object is not extended. Consider the following:</p>\n\n<pre><code>#include &lt;vector&gt;\n#include &lt;optional&gt;\n#include &lt;iostream&gt;\n\nstruct A {\n   A(int i) : i(i) { std::cout &lt;&lt; \"constructor called: \" &lt;&lt; i &lt;&lt; '\\n'; }\n   ~A() { std::cout &lt;&lt; \"destructor called\\n\"; }\n\n   int i;\n};\n\nint main() {\n    auto &amp; a = std::optional&lt;A&gt;().emplace(5);\n    std::cout &lt;&lt; \"a: \" &lt;&lt; a.i &lt;&lt; '\\n';\n    auto &amp; v = std::vector&lt;A&gt;().emplace_back(5);\n    std::cout &lt;&lt; \"v: \" &lt;&lt; v.i &lt;&lt; '\\n';\n\n    // This fails to compile, because value() *is*\n    // ref-qualified so it cannot bind to an lvalue reference\n    //auto &amp; a2 = std::optional&lt;A&gt;(std::in_place, 5).value();\n\n    auto const &amp; a2 = std::optional&lt;A&gt;(std::in_place, 5).value();\n    std::cout &lt;&lt; \"a2: \" &lt;&lt; a2.i &lt;&lt; '\\n';\n}\n</code></pre>\n\n<p>The output:</p>\n\n<pre><code>constructor called: 5\ndestructor called\na: 5\nconstructor called: 5\ndestructor called\nv: 0\nconstructor called: 5\ndestructor called\na2: 5\n</code></pre>\n\n<p>I couldn't find any existing bugs or questions related to this, but maybe I'm just missing something. In the case of <code>std::optional&lt;&gt;::value()</code>, it <em>mostly</em> works, but still allows binding to const lvalue references whilst not properly extending the contained type's lifetime.</p>\n\n<p>Is there any reason why these functions are not ref-qualified, and why <code>std::optional&lt;&gt;::value()</code> doesn't properly extend the lifetime of the contained object when used on an rvalue?</p>\n"}, {"tags": ["c++", "pointers", "vector"], "comments": [{"owner": {"reputation": 21009, "user_id": 1896169, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/jap8U.png?s=128&g=1", "display_name": "Justin", "link": "https://stackoverflow.com/users/1896169/justin"}, "edited": false, "score": 8, "creation_date": 1547059835, "post_id": 54116524, "comment_id": 95065803, "body": "Just use <code>vector&lt;string&gt;</code> directly"}, {"owner": {"reputation": 19, "user_id": 9431986, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3250c5bd8863e5e1591fe7cc282ae31d?s=128&d=identicon&r=PG", "display_name": "user9431986", "link": "https://stackoverflow.com/users/9431986/user9431986"}, "reply_to_user": {"reputation": 21009, "user_id": 1896169, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/jap8U.png?s=128&g=1", "display_name": "Justin", "link": "https://stackoverflow.com/users/1896169/justin"}, "edited": false, "score": 0, "creation_date": 1547059898, "post_id": 54116524, "comment_id": 95065829, "body": "@Justin I do not understand how"}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 5, "creation_date": 1547059964, "post_id": 54116524, "comment_id": 95065850, "body": "You can push back pointers to strings. <code>tmp-&gt;push_back(&amp;str);</code> But if you don&#39;t understand pointers, dynamic allocation and mechanisms behind it and the need to use shared pointeres here, nothing will save you."}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 6, "creation_date": 1547060084, "post_id": 54116524, "comment_id": 95065894, "body": "You do not need both pointers there. <code>std::vector&lt;std::string&gt;</code> will do nicely to you, as it did to millions and millions happy customers before you."}, {"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 1, "creation_date": 1547060396, "post_id": 54116524, "comment_id": 95066022, "body": "@user9431986 <i>I do not understand how</i> -- What seems strange to me is why you would think <code>std::vector&lt;std::string*&gt;*</code> would be easier to use than simply have <code>std::vector&lt;std::string&gt;</code>."}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1547061465, "post_id": 54116524, "comment_id": 95066473, "body": "just repeating others, but the fact that you want to push a <code>std::string srt = &quot;abc&quot;;</code> into the vector is a clear indication that you dont need a single <code>*</code> in your code"}, {"owner": {"reputation": 40055, "user_id": 545127, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/RJgJM.png?s=128&g=1", "display_name": "Raedwald", "link": "https://stackoverflow.com/users/545127/raedwald"}, "edited": false, "score": 0, "creation_date": 1547104777, "post_id": 54116524, "comment_id": 95078687, "body": "You need a tutorial on pointers and collections."}], "answers": [{"comments": [{"owner": {"reputation": 7407, "user_id": 1757805, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/AMueI.jpg?s=128&g=1", "display_name": "Francis Cugler", "link": "https://stackoverflow.com/users/1757805/francis-cugler"}, "edited": false, "score": 0, "creation_date": 1547067366, "post_id": 54116562, "comment_id": 95068932, "body": "<code>tmp-&gt;push_back(&amp;srt)</code> will compile, but it will throw a runtime error: Access Violation Error at least within Visual Studio."}, {"owner": {"reputation": 9737, "user_id": 1460794, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/7lOXx.png?s=128&g=1", "display_name": "wally", "link": "https://stackoverflow.com/users/1460794/wally"}, "reply_to_user": {"reputation": 7407, "user_id": 1757805, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/AMueI.jpg?s=128&g=1", "display_name": "Francis Cugler", "link": "https://stackoverflow.com/users/1757805/francis-cugler"}, "edited": false, "score": 1, "creation_date": 1547132370, "post_id": 54116562, "comment_id": 95094035, "body": "@FrancisCugler It works without error for me on Visual Studio. How did you read the value? You can use <code>*((*tmp)[0])</code>."}, {"owner": {"reputation": 7407, "user_id": 1757805, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/AMueI.jpg?s=128&g=1", "display_name": "Francis Cugler", "link": "https://stackoverflow.com/users/1757805/francis-cugler"}, "edited": false, "score": 0, "creation_date": 1547153706, "post_id": 54116562, "comment_id": 95105040, "body": "@ Wally ah okay, I had forgotten about the <code>double indirection</code> on the actual pointer to <code>vector</code>..."}], "tags": [], "owner": {"reputation": 9737, "user_id": 1460794, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/7lOXx.png?s=128&g=1", "display_name": "wally", "link": "https://stackoverflow.com/users/1460794/wally"}, "is_accepted": false, "score": 2, "last_activity_date": 1547060130, "last_edit_date": 1547060130, "creation_date": 1547059971, "answer_id": 54116562, "question_id": 54116524, "link": "https://stackoverflow.com/questions/54116524/c-how-to-work-with-pointers-to-vector-pointers/54116562#54116562", "title": "C++ how to work with pointers to vector pointers", "body": "<p>The syntax would be  <code>tmp-&gt;push_back(&amp;srt);</code></p>\n\n<p>But it would be better to use <code>vector&lt;string&gt;</code> because the vector will take care of the pointers for you.</p>\n\n<p>Prefer:</p>\n\n<pre><code>std::vector&lt;std::string&gt; tmp;\nstd::string srt{\"abc\"};\ntmp.push_back(srt);\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 32321, "user_id": 173397, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pqKT8.jpg?s=128&g=1", "display_name": "pm100", "link": "https://stackoverflow.com/users/173397/pm100"}, "is_accepted": false, "score": 3, "last_activity_date": 1547061090, "creation_date": 1547061090, "answer_id": 54116786, "question_id": 54116524, "link": "https://stackoverflow.com/questions/54116524/c-how-to-work-with-pointers-to-vector-pointers/54116786#54116786", "title": "C++ how to work with pointers to vector pointers", "body": "<p>just dont get too pointer-ish (assuming this is a relatively simple program)</p>\n\n<pre><code>vector&lt;string&gt; tmp;\nstd::string srt = \"abc\";\ntmp.push_back(srt);\n</code></pre>\n\n<p>certainly a vector of pointers to string is a a disaster waiting to happen . And probably you dont need a pointer to a vector either</p>\n"}, {"comments": [{"owner": {"reputation": 1680, "user_id": 5282154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a468ae12f72b587ad0c4e89ffde11839?s=128&d=identicon&r=PG", "display_name": "doug", "link": "https://stackoverflow.com/users/5282154/doug"}, "edited": false, "score": 3, "creation_date": 1547104692, "post_id": 54118173, "comment_id": 95078649, "body": "pvWords is initialized to nullptr. You can&#39;t access it. The second code block doesn&#39;t compile. Leave off the <code>= nullptr</code>"}, {"owner": {"reputation": 7407, "user_id": 1757805, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/AMueI.jpg?s=128&g=1", "display_name": "Francis Cugler", "link": "https://stackoverflow.com/users/1757805/francis-cugler"}, "reply_to_user": {"reputation": 1680, "user_id": 5282154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a468ae12f72b587ad0c4e89ffde11839?s=128&d=identicon&r=PG", "display_name": "doug", "link": "https://stackoverflow.com/users/5282154/doug"}, "edited": false, "score": 0, "creation_date": 1547153835, "post_id": 54118173, "comment_id": 95105100, "body": "@doug I had thought so, but for some reason or another if I don&#39;t initialize it, I&#39;m getting compiler errors..."}, {"owner": {"reputation": 1680, "user_id": 5282154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a468ae12f72b587ad0c4e89ffde11839?s=128&d=identicon&r=PG", "display_name": "doug", "link": "https://stackoverflow.com/users/5282154/doug"}, "edited": false, "score": 0, "creation_date": 1547154721, "post_id": 54118173, "comment_id": 95105480, "body": "You have two programs. The first one doesn&#39;t compile if you leave off <code>= nullptr</code> but you left off semi-colons at the end of the &quot;Hello&quot; and &quot;World&quot; strings. And the second one doesn&#39;t compile as is, but if you remove <code>= nullptr</code> from the second one it will compile and run correctly.  The reason the first one compiles (aside from the semi&#39;s) but doesn&#39;t run is that it needs to be initialized with <code>new vewctor&lt;string&gt;();</code>, not a nullptr. If you do that it will also compile and run."}, {"owner": {"reputation": 7407, "user_id": 1757805, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/AMueI.jpg?s=128&g=1", "display_name": "Francis Cugler", "link": "https://stackoverflow.com/users/1757805/francis-cugler"}, "reply_to_user": {"reputation": 1680, "user_id": 5282154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a468ae12f72b587ad0c4e89ffde11839?s=128&d=identicon&r=PG", "display_name": "doug", "link": "https://stackoverflow.com/users/5282154/doug"}, "edited": false, "score": 0, "creation_date": 1547156588, "post_id": 54118173, "comment_id": 95106200, "body": "@doug, The missing semi-colons is a typo. Thank you for pointing that out."}, {"owner": {"reputation": 1680, "user_id": 5282154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a468ae12f72b587ad0c4e89ffde11839?s=128&d=identicon&r=PG", "display_name": "doug", "link": "https://stackoverflow.com/users/5282154/doug"}, "edited": false, "score": 0, "creation_date": 1547158740, "post_id": 54118173, "comment_id": 95106975, "body": "I assumed it was just a typo. It&#39;s a good idea to copy code back from stackoverflow and compile it to check for typos. I&#39;ve found some on posts I&#39;ve made and it helps others trying to duplicate problems. Especially for those new to C++. The language can be intimidating at times."}, {"owner": {"reputation": 1680, "user_id": 5282154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a468ae12f72b587ad0c4e89ffde11839?s=128&d=identicon&r=PG", "display_name": "doug", "link": "https://stackoverflow.com/users/5282154/doug"}, "edited": false, "score": 0, "creation_date": 1547158999, "post_id": 54118173, "comment_id": 95107082, "body": "Looking cleaner&gt; Now you just need to clean up this line in the third program snippet: <code>std::vector&lt;std::string&gt; vWords = nullptr;</code>  Change it to <code>std::vector&lt;std::string&gt; vWords</code>;"}, {"owner": {"reputation": 7407, "user_id": 1757805, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/AMueI.jpg?s=128&g=1", "display_name": "Francis Cugler", "link": "https://stackoverflow.com/users/1757805/francis-cugler"}, "reply_to_user": {"reputation": 1680, "user_id": 5282154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a468ae12f72b587ad0c4e89ffde11839?s=128&d=identicon&r=PG", "display_name": "doug", "link": "https://stackoverflow.com/users/5282154/doug"}, "edited": false, "score": 0, "creation_date": 1547160698, "post_id": 54118173, "comment_id": 95107631, "body": "@doug Fixed, another copy and paste error... Yeah, when I originally posted the answer it was late at night and I missed a few of those copy and paste errors (typos)..."}], "tags": [], "owner": {"reputation": 7407, "user_id": 1757805, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/AMueI.jpg?s=128&g=1", "display_name": "Francis Cugler", "link": "https://stackoverflow.com/users/1757805/francis-cugler"}, "is_accepted": false, "score": 2, "last_activity_date": 1547160654, "last_edit_date": 1592644375, "creation_date": 1547067109, "answer_id": 54118173, "question_id": 54116524, "link": "https://stackoverflow.com/questions/54116524/c-how-to-work-with-pointers-to-vector-pointers/54118173#54118173", "title": "C++ how to work with pointers to vector pointers", "body": "<p>To answer your question:</p>\n<blockquote>\n<p>How to work with pointers to vector pointers?</p>\n</blockquote>\n<p>Let's look at a basic example...</p>\n<pre><code>#include &lt;iostream&gt;\n#include &lt;string&gt;\n#include &lt;vector&gt;\n\nint main() {\n    // has to be initialized since it is a pointer.\n    // However, this will compile but will fail at runtime.\n    std::vector&lt;std::string*&gt;* pvWords = nullptr;\n\n    std::string word1 = &quot;Hello&quot;;\n    std::string word2 = &quot;World&quot;;\n\n    // Here you need the `operator-&gt;()` from the vector\n    // and since it will store pointers to strings,\n    // you can just pass in the address of...\n    pvWords-&gt;push_back( &amp;word1 ); \n    pvWords-&gt;push_back( &amp;word2 );\n\n    for ( auto&amp; s : *pvWords )    // here we need to dereference pvWords\n        std::cout &lt;&lt; *s &lt;&lt; ' ';   // and here we need to dereference s\n    std::cout &lt;&lt; '\\n';\n\n    return 0;\n}\n</code></pre>\n<p><em>-Expected Output-</em></p>\n<pre><code>Hello World\n</code></pre>\n<p>However, this will compile but fails at runtime and causes an access violation error within Visual Studio. This fails because once the <code>strings</code> pointers go out of scope they are destroyed and the memory that the <code>vector</code> or <code>vector*</code> is trying to reference is now invalid. You might be able to get past this by using dynamic memory, but even then it just makes the code more complicated and harder to manage and can lead to even more unseen errors.</p>\n<p>If we fix the above to the following snippet, the code will then work:</p>\n<pre><code>#include &lt;iostream&gt;\n#include &lt;string&gt;\n#include &lt;vector&gt;\n\nint main() {\n    std::vector&lt;std::string*&gt;* pvWords = new std::vector&lt;std::string*&gt;;\n   \n    std::string word1 = &quot;Hello&quot;;\n    std::string word2 = &quot;World&quot;;\n\n    pvWords-&gt;push_back( &amp;word1 ); \n    pvWords-&gt;push_back( &amp;word2 );\n\n    for ( auto&amp; s : (*pvWords) )\n        std::cout &lt;&lt; (*s) &lt;&lt; ' ';\n    std::cout &lt;&lt; '\\n';\n\n    delete pvWords; // don't forget to cleanup dynamic memory.\n\n    return 0;\n}\n</code></pre>\n<p>This will work with dynamic memory and will provide the following output:</p>\n<pre><code>Hello World\n</code></pre>\n<p>However, to avoid all of these errors and complexity of the code simply just don't use any pointers, especially when working with <code>std::string</code>.</p>\n<hr>\n<hr>\n<p>The first solution will work but can lead to problems if any of the pointers become invalid before they are used and is tricky to avoid the runtime errors.</p>\n<p>There is no need to use pointers in this situation. You are not storing derived classes of a base class where you need inheritance nor polymorphism.</p>\n<p>Due to the behavior of <code>std::vector</code> and <code>std::string</code> simply doing this:</p>\n<pre><code>#include &lt;iostream&gt;\n#include &lt;string&gt;\n#include &lt;vector&gt;\n\nint main() {\n    std::vector&lt;std::string&gt; vWords;\n\n    vWords.push_back( &quot;Hello&quot; );\n    vWords.push_back( &quot;World&quot; );\n\n    for ( auto&amp; s : vWords )\n        std::cout &lt;&lt; s &lt;&lt; ' ';\n    std::cout &lt;&lt; '\\n';\n\n    return 0;\n}\n</code></pre>\n<p>Will produce the same expected results without any dynamic memory allocation and memory cleanup, without any errors, and without any code complications since <code>std::vector</code> and <code>std::string</code> manages their own memory.</p>\n<p><em>-Output-</em></p>\n<pre><code>Hello World\n</code></pre>\n<p>This version of the code is much easier to read, cleaner to work with and debug, easier for others to use and will do exactly what you would expect it to do. This solution is very simple, fast and efficient without all of the hassle.</p>\n"}, {"tags": [], "owner": {"reputation": 1680, "user_id": 5282154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a468ae12f72b587ad0c4e89ffde11839?s=128&d=identicon&r=PG", "display_name": "doug", "link": "https://stackoverflow.com/users/5282154/doug"}, "is_accepted": false, "score": 0, "last_activity_date": 1547155221, "last_edit_date": 1547155221, "creation_date": 1547104405, "answer_id": 54123554, "question_id": 54116524, "link": "https://stackoverflow.com/questions/54116524/c-how-to-work-with-pointers-to-vector-pointers/54123554#54123554", "title": "C++ how to work with pointers to vector pointers", "body": "<p>Using a vector your way can, but shouldn't, be done absent a compelling reason and I'm unable to think of one.</p>\n\n<p><code>vector&lt;string*&gt;* tmp = new vector&lt;string*&gt;;</code></p>\n\n<p>This is how you have to do it:</p>\n\n<pre><code>using std::vector; using std::string; using std::cout;\n\nint main()\n{\n    vector&lt;string*&gt;* tmp = new vector&lt;string*&gt;;\n    string srt = \"abc\";\n    (*tmp).push_back(&amp;srt);\n    cout &lt;&lt; *(*tmp)[0] &lt;&lt; endl;\n    delete tmp;\n}\n</code></pre>\n\n<p>Alternately, one could use the indirection operator <code>-&gt;</code> instead of <code>*</code>. They do the same thing but both look ugly in different places.</p>\n\n<pre><code>    tmp-&gt;push_back(&amp;srt);\n    cout &lt;&lt; *tmp-&gt;operator[](0) &lt;&lt; endl;\n</code></pre>\n\n<p>Let's examine what is happening with <code>*(*tmp)[0]</code>. <code>(*tmp)</code> is the vector pointed to by <code>tmp</code>. <code>(*tmp)[0]</code> is the contents of the first element in the vector which is a pointer to a string. <code>*(*tmp)[0]</code> is that string pointed to by the first element in the vector.</p>\n\n<p>Aside from the somewhat obscure syntax, beware of strings pointed to by elements in the vector going out of scope which will create dangling pointers.</p>\n\n<p>This is the canonical way to use containers to store strings.</p>\n\n<pre><code>int main()\n{\n    vector&lt;string&gt; tmp;\n    string srt = \"abc\";\n    tmp.push_back(srt);\n    cout &lt;&lt; tmp[0] &lt;&lt; endl;\n}\n</code></pre>\n"}], "owner": {"reputation": 19, "user_id": 9431986, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3250c5bd8863e5e1591fe7cc282ae31d?s=128&d=identicon&r=PG", "display_name": "user9431986", "link": "https://stackoverflow.com/users/9431986/user9431986"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "answer_count": 4, "score": 0, "last_activity_date": 1547160654, "creation_date": 1547059799, "last_edit_date": 1547064912, "question_id": 54116524, "link": "https://stackoverflow.com/questions/54116524/c-how-to-work-with-pointers-to-vector-pointers", "title": "C++ how to work with pointers to vector pointers", "body": "<p>I have this design:</p>\n\n<pre><code>vector&lt;string*&gt;* tmp = new vector&lt;string*&gt;;\n</code></pre>\n\n<p>how do i put elements into it?\nI can not understand how I put in this vector a few strings.\nI tried it</p>\n\n<pre><code>std::string srt = \"abc\";\ntmp-&gt;push_back(srt);\n</code></pre>\n\n<p>but the compiler curses and the syntax is incorrect, I don't know how to do</p>\n"}, {"tags": ["c++", "lambda", "std-function"], "comments": [{"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 2, "creation_date": 1547059967, "post_id": 54116511, "comment_id": 95065853, "body": "Are you stuck with VS2013?  It&#39;s C++11 wasn&#39;t great.  2015 update 3 or 2017 have much better support"}], "answers": [{"comments": [{"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 2, "creation_date": 1547061679, "post_id": 54116586, "comment_id": 95066567, "body": "maybe I completely misunderstand the qeustion, but you could pass <code>func_without_params</code> directly without using the lambda, no?"}, {"owner": {"reputation": 1, "user_id": 3975177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ODKj.jpg?s=128&g=1", "display_name": "Swordfish", "link": "https://stackoverflow.com/users/3975177/swordfish"}, "reply_to_user": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1547067192, "post_id": 54116586, "comment_id": 95068871, "body": "@user463035818 I guess the point of using a lambda is to be able to capture variables to use as parameters for the encapsulated function."}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1547068180, "post_id": 54116586, "comment_id": 95069290, "body": "yes <code>func_without_params</code> is just an example for <code>func_with_any_number_of_params</code> where the lambda is necessary"}], "tags": [], "owner": {"reputation": 1, "user_id": 3975177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ODKj.jpg?s=128&g=1", "display_name": "Swordfish", "link": "https://stackoverflow.com/users/3975177/swordfish"}, "is_accepted": true, "score": 3, "last_activity_date": 1547060234, "last_edit_date": 1547060234, "creation_date": 1547060124, "answer_id": 54116586, "question_id": 54116511, "link": "https://stackoverflow.com/questions/54116511/class-method-accepting-lambdas-representing-functions-of-various-number-of-argum/54116586#54116586", "title": "Class method accepting lambdas representing functions of various number of argument", "body": "<p>Except for evil compiler extensions you cannot initialize a non-const reference (parameter <code>func</code>) with something that is not an l-value. Make the parameter const:</p>\n\n<pre><code>#include &lt;functional&gt;\n#include &lt;iostream&gt;\n\nvoid run_callback(std::function&lt;void()&gt; const &amp;func)\n{\n    func();\n}\n\nvoid func_without_params()\n{\n    std::cout &lt;&lt; \"x\" &lt;&lt; std::endl;\n}\n\nint main()\n{\n    run_callback([] { func_without_params(); });\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 17331, "user_id": 8950365, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c6ba3b19f86f1bea8cf76e691db4349?s=128&d=identicon&r=PG&f=1", "display_name": "rafix07", "link": "https://stackoverflow.com/users/8950365/rafix07"}, "is_accepted": false, "score": 1, "last_activity_date": 1547063655, "creation_date": 1547063655, "answer_id": 54117380, "question_id": 54116511, "link": "https://stackoverflow.com/questions/54116511/class-method-accepting-lambdas-representing-functions-of-various-number-of-argum/54117380#54117380", "title": "Class method accepting lambdas representing functions of various number of argument", "body": "<blockquote>\n  <p>What is a <code>main::&lt;lambda_de925f4d5cd926a8bb664f9c057a7a19&gt;</code> type?</p>\n</blockquote>\n\n<p>What references says about lambda expression:</p>\n\n<blockquote>\n  <p>The lambda expression is a prvalue expression of unique <strong>unnamed</strong>\n  non-union non-aggregate class type, known as closure type, which is\n  declared <strong>in the smallest block scope</strong>, class scope, or namespace scope\n  that contains the lambda expression.</p>\n</blockquote>\n\n<p>unnamed only for programmers, compiler knows this name and in your case <code>lambda_de925f4d5cd926a8bb664f9c057a7a19</code> is the name of closure type. <code>main</code> refers to the function inside which closure type was defined.</p>\n\n<p>You can use <a href=\"https://cppinsights.io/\" rel=\"nofollow noreferrer\">cppinsights</a> to look behind the scenes. <em>cppinsights</em> uses Clang which doesn't accept binding Rvalue to Lvalue reference, so change your code into:</p>\n\n<pre><code>void run_callback(std::function&lt;void()&gt; func) // take by value\n</code></pre>\n\n<p>and the output from <em>cppinsights</em> is:</p>\n\n<pre><code>int main() { // scope of closure type\n\n  class __lambda_14_16 { // closure type\n    public: inline /*constexpr */ void operator()() const\n    {\n      func_without_params();\n    }\n\n  };\n\n  run_callback(std::function&lt;void ()&gt;(__lambda_14_16{}));\n}\n</code></pre>\n"}], "owner": {"reputation": 24928, "user_id": 997112, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/7c52a3944cdd2eac9725e54fc548f368?s=128&d=identicon&r=PG", "display_name": "user997112", "link": "https://stackoverflow.com/users/997112/user997112"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 54116586, "answer_count": 2, "score": 2, "last_activity_date": 1547063655, "creation_date": 1547059740, "last_edit_date": 1547059999, "question_id": 54116511, "link": "https://stackoverflow.com/questions/54116511/class-method-accepting-lambdas-representing-functions-of-various-number-of-argum", "title": "Class method accepting lambdas representing functions of various number of argument", "body": "<p>I would like to pass functions in to a generic class method, so the generic class can invoke functions requiring no args, one arg, two args etc. </p>\n\n<p>I have seen variadic templates but I do not like the syntax. A previous SO question recommended passing lambdas, wrapping the function:</p>\n\n<p><a href=\"https://stackoverflow.com/a/48976528/997112\">https://stackoverflow.com/a/48976528/997112</a></p>\n\n<p>where the answer is:</p>\n\n<pre><code>void run_callback(std::function&lt;void()&gt;&amp; func) \n{\n    func();\n}\n\nrun_callback([]{ func_without_params(); });\n</code></pre>\n\n<p>and I therefore added a method which requires no argument:</p>\n\n<pre><code>void func_without_params()\n{\n    std::cout &lt;&lt; \"x\" &lt;&lt; std::endl;\n}\n</code></pre>\n\n<p>but when I call:</p>\n\n<pre><code>run_callback([]{ func_without_params(); });\n</code></pre>\n\n<p>in VS2013 the intellisense detects an error and i get the compiler error:</p>\n\n<pre><code>error C2664: 'void run_callback(std::function&lt;void (void)&gt; &amp;)' :\ncannot convert argument 1 from\n'main::&lt;lambda_de925f4d5cd926a8bb664f9c057a7a19&gt;' to\n'std::function&lt;void (void)&gt; &amp;'\n</code></pre>\n\n<p>What is a <code>main::&lt;lambda_de925f4d5cd926a8bb664f9c057a7a19&gt;</code> type? I don't fully-understand the error.</p>\n"}, {"tags": ["c++", "c++11", "constructor", "inner-classes", "template-argument-deduction"], "comments": [{"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1547059712, "post_id": 54116309, "comment_id": 95065751, "body": "FWIW, a copy constructor is never a template function.  The compiler is going to generate a <code>baked(const baked&amp;)</code> for you since you didn&#39;t."}, {"owner": {"reputation": 1962, "user_id": 2789815, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XkN7a.png?s=128&g=1", "display_name": "scx", "link": "https://stackoverflow.com/users/2789815/scx"}, "reply_to_user": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1547059879, "post_id": 54116309, "comment_id": 95065819, "body": "@NathanOliver Yes that is the desired behavior. Use the &quot;traditional&quot; copy ctor for objects with the same parent class, use the templated one for promotion."}], "answers": [{"comments": [{"owner": {"reputation": 1962, "user_id": 2789815, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XkN7a.png?s=128&g=1", "display_name": "scx", "link": "https://stackoverflow.com/users/2789815/scx"}, "edited": false, "score": 0, "creation_date": 1547066503, "post_id": 54116945, "comment_id": 95068587, "body": "Yes that would work, but just as you say I was hoping to be as type-safe as possible, and also more readable (in my mind). As a last resort, that should certainly do. I&#39;ll leave the question open for a little just in case."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "reply_to_user": {"reputation": 1962, "user_id": 2789815, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XkN7a.png?s=128&g=1", "display_name": "scx", "link": "https://stackoverflow.com/users/2789815/scx"}, "edited": false, "score": 0, "creation_date": 1547066682, "post_id": 54116945, "comment_id": 95068657, "body": "Well, this solution is just as type safe in practice. The problem is that the code is far harder to read than the original code intended to be and that the error message is not very clear. But since this is templated code readable error messages are a luxury. Maybe the fact that it first explicitly says &quot;Not a baked potato!&quot; could be an argument for this solution having a <i>more</i> readable error message (or less unreadable). I would be very interested in an answer that actually deduces the template argument. Though if someone does come up with one, it will likely be hard to read as well."}], "tags": [], "owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "is_accepted": true, "score": 2, "last_activity_date": 1547061763, "creation_date": 1547061763, "answer_id": 54116945, "question_id": 54116309, "link": "https://stackoverflow.com/questions/54116309/parent-template-argument-deduction-in-nested-class-constructor/54116945#54116945", "title": "Parent template argument deduction in nested class constructor", "body": "<p>I don't know of any way to deduce the template argument <code>T</code> for a <code>baked</code>'s parent <code>potato&lt;T&gt;</code>. You can know <code>T</code> using <code>decltype(p.something)</code> but that doesn't seem to help solve the problem with calling the constructor. One workaround is to change <code>baked</code>'s constructor to take any <code>O</code> and assume it has a <code>something</code> :</p>\n\n<pre><code>struct baked {\n    template &lt;class O&gt;\n    baked(const O &amp; p) : something(static_cast&lt;T&gt;(p.something))\n    { }\n\n    baked() = default;\n\n    T something;\n};\n</code></pre>\n\n<p>This will work but it is less type-safe than your original code seems to intend. One workaround for <em>that</em> problem could be to introduce a <code>static_assert</code> that checks that <code>O</code> is actually a <code>potato&lt;U&gt;::baked</code> :</p>\n\n<pre><code>#include &lt;type_traits&gt;\n\ntemplate &lt;class T&gt;\nstruct potato {\n    struct baked {\n        template &lt;class O&gt;\n        baked(const O &amp; p) : something(static_cast&lt;T&gt;(p.something))\n        {\n            using t_parent = potato&lt;decltype(p.something)&gt;;\n            static_assert(std::is_same&lt;O, typename t_parent::baked&gt;::value, \"Not a baked potato!\");\n        }\n\n        baked() = default;\n\n        T something;\n    };\n\n    template &lt;class O&gt;\n    potato(const potato&lt;O&gt;&amp; p)\n        : mybaked(p.mybaked) {\n    }\n    potato() = default;\n\n    baked mybaked;\n};\n</code></pre>\n\n<p>This should compile fine for the intended usage but fail with \"Not a baked potato!\" if you try to pass anything else with a <code>something</code>. This would fail :</p>\n\n<pre><code>struct foo {\n    int something = 0;\n};\n\n\nint main(int, char**) {\n    foo bar;\n    potato&lt;int&gt;::baked baz(bar); // Error: Not a baked potato!\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "is_accepted": false, "score": 1, "last_activity_date": 1547073731, "creation_date": 1547073731, "answer_id": 54119456, "question_id": 54116309, "link": "https://stackoverflow.com/questions/54116309/parent-template-argument-deduction-in-nested-class-constructor/54119456#54119456", "title": "Parent template argument deduction in nested class constructor", "body": "<p>As state by the compiler <code>O</code> is not deducible from <code>const typename potato&lt;O&gt;::baked&amp;</code> (on left side of <code>::</code>).</p>\n\n<p>You have several workarounds:</p>\n\n<ul>\n<li><p>Move <code>baked</code> outside parent and make it template:</p>\n\n<pre><code>// Possibly in namespace details\ntemplate &lt;typename T&gt;\nstruct baked_impl {\n    template &lt;class O&gt;\n    baked_impl(const typename baked_impl&lt;O&gt;&amp; p)\n            : something(static_cast&lt;T&gt;(p.something)) {\n    }\n    baked_impl() = default;\n\n    T something;\n};\n\ntemplate &lt;class T&gt;\nstruct potato {\n    using baked = baked_impl&lt;T&gt;;\n\n    // ...\n};\n</code></pre></li>\n<li><p>Add parent info in <code>baked</code> and use SFINAE:</p>\n\n<pre><code>template &lt;class T&gt; struct potato;\n\n// traits for SFINAE\ntemplate &lt;class T&gt; struct is_potato : std::false_type {};\ntemplate &lt;class T&gt; struct is_potato&lt;potato&lt;T&gt;&gt; : std::true_type {};\n\ntemplate &lt;class T&gt;\nstruct potato {\n    using value_type = T;\n    struct baked {\n        using parent = potato;\n\n        template &lt;class O, std::enable_if_t&lt;is_potato&lt;typename O::parent&gt;::value, int&gt; = 0&gt;\n        baked(const O&amp; p)\n                : something(static_cast&lt;typename O::parent::value_type&gt;(p.something)) {\n        }\n        baked() = default;\n\n        T something;\n    };\n    // ...\n};\n</code></pre></li>\n</ul>\n"}], "owner": {"reputation": 1962, "user_id": 2789815, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XkN7a.png?s=128&g=1", "display_name": "scx", "link": "https://stackoverflow.com/users/2789815/scx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 258, "favorite_count": 1, "accepted_answer_id": 54116945, "answer_count": 2, "score": 3, "last_activity_date": 1547073802, "creation_date": 1547058850, "last_edit_date": 1547073802, "question_id": 54116309, "link": "https://stackoverflow.com/questions/54116309/parent-template-argument-deduction-in-nested-class-constructor", "title": "Parent template argument deduction in nested class constructor", "body": "<p>I am trying to write the \"promotion\" constructor of a nested class that can deduce the parent class template. It works fine for the parent class, but not in the nested class. Here is a code example.</p>\n\n<pre><code>template &lt;class T&gt;\nstruct potato {\n    struct baked {\n        template &lt;class O&gt;\n        baked(const typename potato&lt;O&gt;::baked&amp; p)\n                : something(static_cast&lt;T&gt;(p.something)) {\n        }\n        baked() = default;\n\n        T something;\n    };\n\n    template &lt;class O&gt;\n    potato(const potato&lt;O&gt;&amp; p)\n            : mybaked(p.mybaked) {\n    }\n    potato() = default;\n\n    baked mybaked;\n};\n\nint main(int, char**) {\n    potato&lt;int&gt; potato1;\n    potato&lt;short&gt; potato2(potato1);\n}\n</code></pre>\n\n<p>Is this legal?</p>\n\n<p>Various compilers output various errors. Clang has the most readable in my mind. It states :</p>\n\n<blockquote>\n  <p>candidate template ignored: couldn't infer template argument 'O'</p>\n</blockquote>\n\n<p><a href=\"https://godbolt.org/z/y_IZiE\" rel=\"nofollow noreferrer\">https://godbolt.org/z/y_IZiE</a></p>\n\n<p>So I'm guessing either I've messed up the signature, or this isn't a c++ supported feature.</p>\n"}, {"tags": ["c++", "templates", "c++17", "variadic-templates", "template-meta-programming"], "answers": [{"comments": [{"owner": {"reputation": 59936, "user_id": 6022656, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bf138f6c424001ac8491ca86b1976c0c?s=128&d=identicon&r=PG&f=1", "display_name": "max66", "link": "https://stackoverflow.com/users/6022656/max66"}, "edited": false, "score": 0, "creation_date": 1547068121, "post_id": 54117761, "comment_id": 95069260, "body": "@BenVoigt - D&#39;Oh! Yes: <code>std::variant</code>; corrected; thanks!"}, {"owner": {"reputation": 165, "user_id": 3442617, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003323594515/picture?type=large", "display_name": "Bretzelus", "link": "https://stackoverflow.com/users/3442617/bretzelus"}, "edited": false, "score": 0, "creation_date": 1547069170, "post_id": 54117761, "comment_id": 95069704, "body": "OMG! Sir max66, you&#39;re my hero! I could never ever get to think about that construct. Do you realize that thanks to you, you just made possible to do full duplex? :)   Infinitely thankful, Sir."}, {"owner": {"reputation": 165, "user_id": 3442617, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003323594515/picture?type=large", "display_name": "Bretzelus", "link": "https://stackoverflow.com/users/3442617/bretzelus"}, "edited": false, "score": 0, "creation_date": 1547069309, "post_id": 54117761, "comment_id": 95069764, "body": "Btw, about std::variant, I could but I must exactly handle integers from int8_t to uint_64_t, then double; + strings, void*, xio_t*... :)"}], "tags": [], "owner": {"reputation": 59936, "user_id": 6022656, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bf138f6c424001ac8491ca86b1976c0c?s=128&d=identicon&r=PG&f=1", "display_name": "max66", "link": "https://stackoverflow.com/users/6022656/max66"}, "is_accepted": true, "score": 1, "last_activity_date": 1547068062, "last_edit_date": 1547068062, "creation_date": 1547065368, "answer_id": 54117761, "question_id": 54116101, "link": "https://stackoverflow.com/questions/54116101/call-in-and-out-methods-given-variadic-args-from-a-variadic-template-container-c/54117761#54117761", "title": "Call in and out methods given variadic args from a variadic template container class", "body": "<p>Not sure to understand what do you want and how your <code>alu</code> works but... I suppose you're looking something as follows (caution: code not verified; sorry)</p>\n\n<pre><code>template &lt;std::size_t ... Is&gt;\nalu op_helper (alu::list_t const &amp; params, std::index_sequence&lt;Is...&gt; const &amp;)\n { return (rt_obj-&gt;*rt_fn)(params[Is].value&lt;A&gt;()...); }\n\nauto operator() (alu::list_t const &amp; params)\n { return op_helper(params, std::index_sequence_for&lt;A...&gt;{}); }\n</code></pre>\n\n<p>Off Topic: given that your <code>alu</code> class holds a limited and known set of possible types, isn't better <code>std::variant</code> instead of <code>std::any</code>?</p>\n"}], "owner": {"reputation": 165, "user_id": 3442617, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003323594515/picture?type=large", "display_name": "Bretzelus", "link": "https://stackoverflow.com/users/3442617/bretzelus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 54117761, "answer_count": 1, "score": 0, "last_activity_date": 1547068062, "creation_date": 1547057798, "last_edit_date": 1547065513, "question_id": 54116101, "link": "https://stackoverflow.com/questions/54116101/call-in-and-out-methods-given-variadic-args-from-a-variadic-template-container-c", "title": "Call in and out methods given variadic args from a variadic template container class", "body": "<p>I need to get rid of old c++98 variadic syntax and use modern c++-17 variadic templates and args for supporting in and out calls of (runtime) functions and interpreter functions.</p>\n\n<p>I am actually trying to ...test the mechanics of it:</p>\n\n<pre><code>template&lt;typename C, typename R, typename ...A&gt;\nclass methodology{\n\n    std::string _name;\n\n    C* rt_obj = nullptr;\n\n    using rt_fn_t = R(C::*)(A...);\n    rt_fn_t rt_fn = nullptr;\n    //using out_fn_t  = alu(const alu::list_t&amp; params);\n\npublic:\n    // `alu` is a custom std::any wrapper container class:\n    // Kind of Arithmetic Logical Unit. \n\n    // teasing js dangerous style\n    std::string&amp; name() { return _name; }\n\n    // Runtime calling a given \"named\" function into the interpreter:\n    R operator()(const A&amp; ...args){ \n        // pack into our alu list:        \n        auto param = [](auto a){\n            return alu(a);\n        };\n\n        alu::list_t params = { param(args)...};\n        alu a = interpreter::enter(_name, params);\n\n        return a.value&lt;R&gt;();\n    }\n\n    /*\n       Called from inside the interpreter:\n    */\n    alu operator()(const alu::list_t&amp; params){\n        // Here is my lack of c++ 17 functional knowledges:\n        //how to : params =&gt; A..args, using this class's typename ...A ???\n        return (rt_obj-&gt;*rt_fn)(args...);\n        return alu(false); // default. Unimplemented.\n    }\n};\n</code></pre>\n\n<p>My problems:\n(Please, consult my \"alu\" class header file if more details are needed: \n<a href=\"https://github.com/bretzel/xio/blob/master/xio%2B%2B/interpreter/kernel/alu.hpp\" rel=\"nofollow noreferrer\">https://github.com/bretzel/xio/blob/master/xio%2B%2B/interpreter/kernel/alu.hpp</a>, and then to view the actual old ugly syntax:\n<a href=\"https://github.com/bretzel/xio/blob/master/xio%2B%2B/interpreter/kernel/function_t.hpp\" rel=\"nofollow noreferrer\">https://github.com/bretzel/xio/blob/master/xio%2B%2B/interpreter/kernel/function_t.hpp</a>)</p>\n\n<p><code>std::apply(...,std::tuple&lt;&gt;)</code> seems the way to go but:\nHow do I build an <code>std::tuple&lt;(methodology&lt;typename...A&gt;)&gt;</code> from the list of \"<code>alu</code>\", which each \"<code>alu</code>\" deeply holds the argument type into its inner \"<code>std::any</code>\" object?</p>\n"}, {"tags": ["c++", "hex", "binaryfiles", "bitset"], "comments": [{"owner": {"reputation": 12749, "user_id": 7976805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92a559df8b4b287aad23724b4c66d67c?s=128&d=identicon&r=PG&f=1", "display_name": "Yksisarvinen", "link": "https://stackoverflow.com/users/7976805/yksisarvinen"}, "edited": false, "score": 0, "creation_date": 1547057164, "post_id": 54115899, "comment_id": 95064649, "body": "What is <code>temp</code>? What is <code>hex</code>? Please provide <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>"}, {"owner": {"reputation": 4533, "user_id": 2504757, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ef5b308d33027fab8440d223828fe4c?s=128&d=identicon&r=PG", "display_name": "Robert Andrzejuk", "link": "https://stackoverflow.com/users/2504757/robert-andrzejuk"}, "edited": false, "score": 0, "creation_date": 1547057202, "post_id": 54115899, "comment_id": 95064665, "body": "Look at &lt;iomanip&gt; <a href=\"https://en.cppreference.com/w/cpp/header/iomanip\" rel=\"nofollow noreferrer\">en.cppreference.com/w/cpp/header/iomanip</a>  (setfill)"}, {"owner": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 2, "creation_date": 1547057203, "post_id": 54115899, "comment_id": 95064667, "body": "How on earth does <code>00 01 02 03</code> lead you to &quot;wanting&quot; to get the binary equivalent of <code>10 00 01 02</code> ?? And is that first line hex octets from a dump of you &quot;bin&quot; file, or are the actual ascii <i>characters</i> ? Not going ot sugarcoat it; your post isn&#39;t clear."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1547057228, "post_id": 54115899, "comment_id": 95064679, "body": "in memory 01 and 1 are the same number, your problem is not at read time but when you print it wanting 2 digits in hexa no ?"}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1547057604, "post_id": 54115899, "comment_id": 95064837, "body": "<code>they are read as 0, 1, 2 ,3</code> Is <code>1</code> not equal to <code>01</code> ?"}, {"owner": {"reputation": 23, "user_id": 10891282, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_HPfpISDYx4/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZp55XrjDoVKjLcXxFxx9ZLRwG9qw/mo/photo.jpg?sz=128", "display_name": "sesh", "link": "https://stackoverflow.com/users/10891282/sesh"}, "edited": false, "score": 0, "creation_date": 1547057729, "post_id": 54115899, "comment_id": 95064890, "body": "Edit 1: i have edited the post.( temp then) now str is the string read from file. and hex is std::hex which is used to convert string to hexadecimal . Edit 2:  what i meant is the bytes 00 01 02 03 in the file should be read as such instead of being read as 0 1 2 and 3. and as an example i said i want the binary equivalent of 10 00 01 02. but i get the binary equivalent of 10 0 1 2"}, {"owner": {"reputation": 42006, "user_id": 3807729, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UEUbF.jpg?s=128&g=1", "display_name": "Galik", "link": "https://stackoverflow.com/users/3807729/galik"}, "edited": false, "score": 0, "creation_date": 1547057750, "post_id": 54115899, "comment_id": 95064902, "body": "There is no difference between <code>01</code> and <code>1</code>. Only how you choose to print it (with or without leading zero)"}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1547057870, "post_id": 54115899, "comment_id": 95064952, "body": "Just bit shift it."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 10891282, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_HPfpISDYx4/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZp55XrjDoVKjLcXxFxx9ZLRwG9qw/mo/photo.jpg?sz=128", "display_name": "sesh", "link": "https://stackoverflow.com/users/10891282/sesh"}, "edited": false, "score": 0, "creation_date": 1547061640, "post_id": 54116238, "comment_id": 95066548, "body": "Thank you so much. It worked. +1 for the neat and clear explanation. Unable to give +1 in the post. Thanks"}], "tags": [], "owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "is_accepted": true, "score": 2, "last_activity_date": 1547061728, "last_edit_date": 1547061728, "creation_date": 1547058491, "answer_id": 54116238, "question_id": 54115899, "link": "https://stackoverflow.com/questions/54115899/reading-hex-numbers-as-2-digits-per-char-from-bin-file-c/54116238#54116238", "title": "Reading hex numbers as 2 digits per char from bin file -c++", "body": "<p>Converting from single bytes to biger types of integers is typically done using bitshifts.</p>\n\n<pre><code>unsigned char * buffer = new unsigned char[4];\nfp.read(buffer, 4);\nuint32_t result =  buffer[0] &lt;&lt; 24 | buffer[1] &lt;&lt; 16 | buffer[2] &lt;&lt; 8 | buffer[3];\n</code></pre>\n\n<p>If you want to have a <em>string</em> object (<em>not</em> a number) with the hexadecimal <em>representation</em> of the number with leading zeros filled up to 8 characters of hexadecimal representation, you can indeed use <code>&lt;&lt;</code> overloaded operator with some <code>iomanip</code> to print it. You have to use hex and print it with leading zeros. You have to also cast to an integer, because characters are printed like characters, not like numbers.</p>\n\n<pre><code>std::stringstream ss;\nfor (size_t i = 0; i &lt; 4; ++i) {\n   ss &lt;&lt; std::hex &lt;&lt; std::setw(2) &lt;&lt; std::setfill('0') &lt;&lt; static_cast&lt;int&gt;(buffer[i]);\n}\nstd::string str(ss.str);\n</code></pre>\n\n<p>or</p>\n\n<pre><code>std::stringstream ss;\nss  &lt;&lt; std::hex &lt;&lt; std::setw(8) &lt;&lt; std::setfill('0') &lt;&lt; result;\nstd::string str(ss.str);\n</code></pre>\n\n<p>If you want to have a string object with the representation of the number in base 2 including with leading zeros you can indeed use <code>bitset</code> <code>to_string()</code>:</p>\n\n<pre><code>for (size_t i = 0; i &lt; 4; ++i) {\n   std::cout &lt;&lt; bitset&lt;8&gt;(buffer[i]).to_string();\n}\n</code></pre>\n\n<p>or again use the <code>result</code> from above:</p>\n\n<pre><code>std::cout &lt;&lt; bitset&lt;32&gt;(result).to_string();\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 10891282, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_HPfpISDYx4/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZp55XrjDoVKjLcXxFxx9ZLRwG9qw/mo/photo.jpg?sz=128", "display_name": "sesh", "link": "https://stackoverflow.com/users/10891282/sesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 619, "favorite_count": 0, "accepted_answer_id": 54116238, "answer_count": 1, "score": 0, "last_activity_date": 1547061728, "creation_date": 1547056810, "last_edit_date": 1547057505, "question_id": 54115899, "link": "https://stackoverflow.com/questions/54115899/reading-hex-numbers-as-2-digits-per-char-from-bin-file-c", "title": "Reading hex numbers as 2 digits per char from bin file -c++", "body": "<p>I am writing a c++ program to read a bin file.The binary file has the following sample contents.</p>\n\n<pre><code>10 00 01 02 20 03 04 40 50 .....\n</code></pre>\n\n<p>The problem here is by using normal read from bin file the byte 10 ,40, 50 are read correctly. But in case of 00, 01, 02 03.... they are read as 0, 1, 2 ,3 respectively. </p>\n\n<p>But i want the individual bytes 00 01 02 03 etc also to be read as <strong>00 01 02 03 etc **. The reason being, i am trying to convert the values to binary. so i want to get the binary equivalent of **\"10 00 01 02\"</strong> which is <strong>10000000000000000000100000010</strong>. But because the the contents are being interpreted as <strong><em>10012</em></strong>, i get <strong><em>10000000000010010</em></strong> as the result. Please do help me in solving this. Sorry if the content is too lengthy. Thanks in advance.</p>\n\n<p>I used the following code. // cut shorted for simplicity</p>\n\n<pre><code>fstream fp;\nfp.open(binFile, ios::binary | ios::in);\nchar * buffer = new char[4];\n// read data as a block:\nfp.read(buffer, 4);\n// copied the contents of buffer[] to a string str\nstringstream ss;\nfor (std::string::iterator it = str.begin(); it != str.end(); ++it)\n{\n    ss &lt;&lt; std::hex &lt;&lt; unsigned(*it);\n}\nss &gt;&gt; intvalue; // stores the converted hex value \nstring binstring = bitset&lt;32&gt;(intvalue).to_string();\ncout&lt;&lt;binstring // produces wrong value. \n</code></pre>\n"}, {"tags": ["c++", "visual-studio"], "comments": [{"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 1, "creation_date": 1547056937, "post_id": 54115879, "comment_id": 95064544, "body": "conio.h, where does this come from? <code>_getch</code> is not a standard function as well."}, {"owner": {"reputation": 5867, "user_id": 9125195, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75fc90d1f6de6ff28c739b85bdb82f4c?s=128&d=identicon&r=PG&f=1", "display_name": "Sid S", "link": "https://stackoverflow.com/users/9125195/sid-s"}, "edited": false, "score": 1, "creation_date": 1547056973, "post_id": 54115879, "comment_id": 95064564, "body": "What&#39;s in <code>&quot;pch.h&quot;</code> ?"}, {"owner": {"reputation": 4533, "user_id": 2504757, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ef5b308d33027fab8440d223828fe4c?s=128&d=identicon&r=PG", "display_name": "Robert Andrzejuk", "link": "https://stackoverflow.com/users/2504757/robert-andrzejuk"}, "reply_to_user": {"reputation": 5867, "user_id": 9125195, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75fc90d1f6de6ff28c739b85bdb82f4c?s=128&d=identicon&r=PG&f=1", "display_name": "Sid S", "link": "https://stackoverflow.com/users/9125195/sid-s"}, "edited": false, "score": 1, "creation_date": 1547057402, "post_id": 54115879, "comment_id": 95064746, "body": "@SidS precompiled header."}, {"owner": {"reputation": 5867, "user_id": 9125195, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75fc90d1f6de6ff28c739b85bdb82f4c?s=128&d=identicon&r=PG&f=1", "display_name": "Sid S", "link": "https://stackoverflow.com/users/9125195/sid-s"}, "reply_to_user": {"reputation": 4533, "user_id": 2504757, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ef5b308d33027fab8440d223828fe4c?s=128&d=identicon&r=PG", "display_name": "Robert Andrzejuk", "link": "https://stackoverflow.com/users/2504757/robert-andrzejuk"}, "edited": false, "score": 0, "creation_date": 1547057715, "post_id": 54115879, "comment_id": 95064887, "body": "@RobertAndrzejuk, D&#39;Oh!"}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 3, "creation_date": 1547058179, "post_id": 54115879, "comment_id": 95065095, "body": "I believe if you hit a special key like an arrow key, <code>_getch()</code> can return 0 and then the next call will return which special key was hit. Maybe you hit an arrow key by mistake?"}, {"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 0, "creation_date": 1547058433, "post_id": 54115879, "comment_id": 95065210, "body": "<i>Does somebody can tell me what should I do to repair this?</i> -- The code is doing exactly as you wrote.  What is there to repair?  The loop exits if <a href=\"https://docs.microsoft.com/en-us/cpp/c-runtime-library/reference/getch-getwch?view=vs-2017\" rel=\"nofollow noreferrer\">getch()</a> returns a 0."}], "answers": [{"tags": [], "owner": {"reputation": 320, "user_id": 10133297, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-9MB4NXZkZUg/AAAAAAAAAAI/AAAAAAAAAPU/GeL9jwCKUvg/photo.jpg?sz=128", "display_name": "Chief A", "link": "https://stackoverflow.com/users/10133297/chief-a"}, "is_accepted": false, "score": 1, "last_activity_date": 1547062254, "last_edit_date": 1592644375, "creation_date": 1547062254, "answer_id": 54117068, "question_id": 54115879, "link": "https://stackoverflow.com/questions/54115879/why-program-leaves-loop-on-one-computer-and-not-on-the-other/54117068#54117068", "title": "Why program leaves loop on one computer and not on the other?", "body": "<p>From the <a href=\"https://docs.microsoft.com/en-us/cpp/c-runtime-library/reference/getch-getwch?view=vs-2017\" rel=\"nofollow noreferrer\">MSDN page</a> of _getch()  :</p>\n<blockquote>\n<p>When reading a function key or an arrow key, each function must be called twice; the first call returns 0 or 0xE0, and the second call returns the actual key code.</p>\n</blockquote>\n<p>This explains why your code is exiting the loop after one iteration.</p>\n"}], "owner": {"reputation": 1, "user_id": 10890960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adaf25a9fef7688694e0869d86e2c63c?s=128&d=identicon&r=PG&f=1", "display_name": "Kicerk", "link": "https://stackoverflow.com/users/10890960/kicerk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1547067389, "creation_date": 1547056723, "last_edit_date": 1547067389, "question_id": 54115879, "link": "https://stackoverflow.com/questions/54115879/why-program-leaves-loop-on-one-computer-and-not-on-the-other", "title": "Why program leaves loop on one computer and not on the other?", "body": "<p>I made a simple loop on my computer and it works perfectly. I wrote the same program on my laptop (both Visual Studio 2017) but instead of repeating, after one execution of the loop it leaves.</p>\n\n<p>I also noticed that when I set release configuration (instead of debug) program works just fine.</p>\n\n<p>Can somebody tell me what should I do to repair this?</p>\n\n<p>Entire Program:</p>\n\n<pre><code>#include \"pch.h\"\n#include &lt;iostream&gt;\n#include &lt;conio.h&gt;\n\nint main()\n{\n    while(char x = _getch())\n    {\n        std::cout &lt;&lt; x;\n    }\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c++", "arrays", "auto", "type-deduction"], "comments": [{"owner": {"reputation": 10521, "user_id": 1316462, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2de3149d5f602449f41083ca17a5ceab?s=128&d=identicon&r=PG&f=1", "display_name": "Jans", "link": "https://stackoverflow.com/users/1316462/jans"}, "edited": false, "score": 3, "creation_date": 1547056148, "post_id": 54115707, "comment_id": 95064233, "body": "Related <a href=\"https://stackoverflow.com/questions/50840908/do-we-have-auto-array-in-c17\" title=\"do we have auto array in c17\">stackoverflow.com/questions/50840908/&hellip;</a>"}, {"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 0, "creation_date": 1547056260, "post_id": 54115707, "comment_id": 95064280, "body": "Notice already the &quot;mismatch&quot; <code>&amp;1</code> is a pointer, whereas <code>1</code> is not an array :) (would require <code>auto arr[]{{1}}</code>)."}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 1, "creation_date": 1547056314, "post_id": 54115707, "comment_id": 95064308, "body": "Who still writes C-style arrays with C++17 + std::array?"}, {"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "reply_to_user": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 0, "creation_date": 1547056383, "post_id": 54115707, "comment_id": 95064341, "body": "@MatthieuBrucher: if you want to specify only type <b>or</b> size :-)"}, {"owner": {"reputation": 12749, "user_id": 7976805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92a559df8b4b287aad23724b4c66d67c?s=128&d=identicon&r=PG&f=1", "display_name": "Yksisarvinen", "link": "https://stackoverflow.com/users/7976805/yksisarvinen"}, "edited": false, "score": 3, "creation_date": 1547056428, "post_id": 54115707, "comment_id": 95064360, "body": "Wow, in linked question there&#39;s an answer with 11 upvotes and not answering the question at all."}, {"owner": {"reputation": 12180, "user_id": 3150802, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/ulVTa.png?s=128&g=1", "display_name": "Peter - Reinstate Monica", "link": "https://stackoverflow.com/users/3150802/peter-reinstate-monica"}, "reply_to_user": {"reputation": 10521, "user_id": 1316462, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2de3149d5f602449f41083ca17a5ceab?s=128&d=identicon&r=PG&f=1", "display_name": "Jans", "link": "https://stackoverflow.com/users/1316462/jans"}, "edited": false, "score": 0, "creation_date": 1547056770, "post_id": 54115707, "comment_id": 95064479, "body": "@Jans Funny, I really searched (both here and globally) and did not see that question. Vote to close as dup, if you like to. Barry&#39;s answer there is probably true (i.e., there is no technical reason, it&#39;s simply that some declarators are not allowed (yet)). But I mean, we had 7+ years to do that."}, {"owner": {"reputation": 12180, "user_id": 3150802, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/ulVTa.png?s=128&g=1", "display_name": "Peter - Reinstate Monica", "link": "https://stackoverflow.com/users/3150802/peter-reinstate-monica"}, "reply_to_user": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 4, "creation_date": 1547056869, "post_id": 54115707, "comment_id": 95064516, "body": "@MatthieuBrucher People who are interested in the language proper."}, {"owner": {"reputation": 12180, "user_id": 3150802, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/ulVTa.png?s=128&g=1", "display_name": "Peter - Reinstate Monica", "link": "https://stackoverflow.com/users/3150802/peter-reinstate-monica"}, "reply_to_user": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 0, "creation_date": 1547057234, "post_id": 54115707, "comment_id": 95064683, "body": "@Jarod42 Proper point, but that&#39;s a flaw in the language. If you can say <code>int i = 3;</code> you should also be able to say <code>int *p = i;</code>. <code>i</code> is a constant address very much like <code>3</code> is a constant int. The two initializations can be transformed into each other by adding resp. removing one level of indirection on both sides; there is no inherent reason why one works and the other does not (apart from the original equivalency between ints and pointers which made <code>int *p = i</code> mean something different in K&amp;R)."}], "owner": {"reputation": 12180, "user_id": 3150802, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/ulVTa.png?s=128&g=1", "display_name": "Peter - Reinstate Monica", "link": "https://stackoverflow.com/users/3150802/peter-reinstate-monica"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 81, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1547055973, "creation_date": 1547055973, "question_id": 54115707, "link": "https://stackoverflow.com/questions/54115707/why-can-i-auto-declare-pointers-but-not-arrays", "title": "Why can I auto-declare pointers but not arrays?", "body": "<p>I know that \"Why\" questions are deprecated; I'm wondering specifically whether there is a technical reason that <code>auto</code> cannot deduce array element types. A simple example is </p>\n\n<pre><code>auto arr[] {1}; // does not compile\n</code></pre>\n\n<p>The type deduction <em>does</em> work for a similar indirection, pointers:</p>\n\n<pre><code>int i;\nauto *p { &amp;i };  // compiles\n</code></pre>\n\n<p>Both deductions seem equally doable for simple cases (and should run into similar problems, if any, for complicated types). What am I missing?</p>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 1, "creation_date": 1547055739, "post_id": 54115603, "comment_id": 95064051, "body": "Only one user conversion is allowed."}], "answers": [{"tags": [], "owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "is_accepted": true, "score": 1, "last_activity_date": 1547057290, "creation_date": 1547057290, "answer_id": 54116011, "question_id": 54115603, "link": "https://stackoverflow.com/questions/54115603/interactions-with-implicit-conversion-between-three-types/54116011#54116011", "title": "Interactions with implicit conversion between three types?", "body": "<blockquote>\n  <p>I'm concerned that there are now two paths between std::string and std::string_view. That being the direct path, and the two step conversion via std::cstring.</p>\n</blockquote>\n\n<p>Only one of those paths is valid, because implicit conversion sequences with more than one user-defined conversion are not valid candidates.</p>\n\n<p>To clarify, \"user defined\" in context of implicit conversions doesn't refer to the distinction from the standard document, but refers to all conversion operators and converting constructors of classes (i.e. user defined data types).</p>\n\n<blockquote>\n  <p>Or does an example [of a currently working program that uses <code>std::string</code> and/or <code>std::string_view</code>, that would, given the described changes to <code>&lt;string_view&gt;</code> and <code>&lt;string&gt;</code>, stop working] not exist?</p>\n</blockquote>\n\n<p>Such example does not exist.</p>\n"}], "owner": {"reputation": 58653, "user_id": 1131467, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6115f0a575cf85c444663504d5f1b3c3?s=128&d=identicon&r=PG", "display_name": "Andrew Tomazos", "link": "https://stackoverflow.com/users/1131467/andrew-tomazos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 54116011, "answer_count": 1, "score": -1, "last_activity_date": 1547057290, "creation_date": 1547055497, "last_edit_date": 1547056938, "question_id": 54115603, "link": "https://stackoverflow.com/questions/54115603/interactions-with-implicit-conversion-between-three-types", "title": "Interactions with implicit conversion between three types?", "body": "<p>Suppose we added a new class template to the <code>&lt;string_view&gt;</code> header of the C++20 standard library:</p>\n\n<pre><code>template&lt;class charT, class traits = char_traits&lt;charT&gt;&gt;\nclass basic_string_view;  // existing\n\ntemplate&lt;class charT, class traits = char_traits&lt;charT&gt;&gt;\nclass basic_cstring_view;  // new\n</code></pre>\n\n<p>We want to make it so that:</p>\n\n<ul>\n<li><code>std::cstring_view</code> is implicitly convertible to <code>std::string_view</code></li>\n<li><code>std::string</code> is implicitly convertible to <code>std::cstring_view</code></li>\n<li><code>std::string</code> (to remain) implicitly convertible to <code>std::string_view</code></li>\n</ul>\n\n<p>If we add to the definition of <code>std::basic_cstring_view</code>:</p>\n\n<pre><code>operator basic_string_view&lt;charT, traits&gt;() const noexcept; // new\n</code></pre>\n\n<p>and we add to the definition of <code>std::basic_string</code>:</p>\n\n<pre><code>operator basic_string_view&lt;charT, traits&gt;() const noexcept; // existing\noperator basic_cstring_view&lt;charT, traits&gt;() const noexcept; // new\n</code></pre>\n\n<p>Is this going to create problems, ambiguities?  Could it break any  existing code that uses <code>std::string_view</code> or <code>std::string</code>?</p>\n\n<p>I'm concerned that there are now two paths between <code>std::string</code> and <code>std::string_view</code>.  That being the direct path, and the two step conversion via <code>std::cstring</code>.</p>\n\n<p>To clarify the specific question for the \"closer\":</p>\n\n<p>What is an example of a currently working program that uses <code>std::string</code> and/or <code>std::string_view</code>, that would, given the described changes to <code>&lt;string_view&gt;</code> and <code>&lt;string&gt;</code>, stop working?  Or does such an example not exist?</p>\n"}, {"tags": ["c++", "c"], "comments": [{"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 11, "creation_date": 1547055429, "post_id": 54115562, "comment_id": 95063901, "body": "C and C++ are different languages.  Don&#39;t expect what works in one to work in the other"}], "answers": [{"tags": [], "owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "is_accepted": true, "score": 1, "last_activity_date": 1547056083, "last_edit_date": 1592644375, "creation_date": 1547055841, "answer_id": 54115681, "question_id": 54115562, "link": "https://stackoverflow.com/questions/54115562/gcc-g-different-attitudes-for-void-to-int/54115681#54115681", "title": "GCC/G++ different attitudes for: void* to int", "body": "<blockquote>\n<pre><code>int k = (int *)arg;\n</code></pre>\n<p>this statement  can not compaile  with G++,But GCC only Warning,why?</p>\n</blockquote>\n<p>It doesn't compile in C++ because <code>int*</code> is not implicitly convertible to <code>int</code> and therefore the statement is ill-formed.</p>\n<blockquote>\n<pre><code>// int k=*(int *)arg;\n</code></pre>\n<p>why this statement not right?</p>\n</blockquote>\n<p>That statement is syntactically well-formed in C++. But <code>arg</code> doesn't point to an <code>int</code> object (or object of compatible type), so the behaviour of indirecting through the pointer is undefined.</p>\n"}], "owner": {"reputation": 25, "user_id": 7090534, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rUZsA.jpg?s=128&g=1", "display_name": "takethat", "link": "https://stackoverflow.com/users/7090534/takethat"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "closed_date": 1547056154, "accepted_answer_id": 54115681, "answer_count": 1, "score": -3, "last_activity_date": 1547056083, "creation_date": 1547055320, "last_edit_date": 1547055458, "question_id": 54115562, "link": "https://stackoverflow.com/questions/54115562/gcc-g-different-attitudes-for-void-to-int", "closed_reason": "Needs details or clarity", "title": "GCC/G++ different attitudes for: void* to int", "body": "<pre><code>#include&lt;stdio.h&gt;\nvoid test(void *arg)\n{\n    if (arg != NULL)\n    {\n        int temp = (int *)arg;\n        printf(\"[temp]%d\\n\", temp);\n    }\n}\n\nint main()\n{\n    int a = 3;\n    int *b = &amp;a;\n    int t = b;\n    test((void *)11);\n    void * arg = (void *)22;\n    int k = (int *)arg;//this statement  can not compaile  with G++,But GCC only Warning,why?\uff08evernt use cpp rewrite it again\uff09\n    // int k=*(int *)arg;// why this statement not right?\n    printf(\"[k]%d\\n\", k);\n\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c++", "opengl", "glsl", "shader", "shadow-mapping"], "answers": [{"tags": [], "owner": {"reputation": 138010, "user_id": 5577765, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LoGpC.jpg?s=128&g=1", "display_name": "Rabbid76", "link": "https://stackoverflow.com/users/5577765/rabbid76"}, "is_accepted": true, "score": 1, "last_activity_date": 1547067946, "last_edit_date": 1547067946, "creation_date": 1547057016, "answer_id": 54115943, "question_id": 54115317, "link": "https://stackoverflow.com/questions/54115317/c-comparing-shadow-map-matrix-with-draw-matrix-doesnt-create-shadows/54115943#54115943", "title": "C++ Comparing shadow map matrix with draw matrix doesn&#39;t create shadows", "body": "<p>The content of the shadow map is a depth value in depth range [0.0, 1.0] (except you would change the depth range by <a href=\"https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/glDepthRange.xhtml\" rel=\"nofollow noreferrer\"><code>glDepthRange</code></a>)</p>\n\n<p><code>ShadowCoord</code> is a clip space coordinate. A clip space coordinate can be transformed to a normalized device space coordinate by a <a href=\"https://www.khronos.org/opengl/wiki/Vertex_Post-Processing#Perspective_divide\" rel=\"nofollow noreferrer\">Perspective divide</a> (<code>ShadowCoord.xyz/ShadowCoord.w</code>). Since the shadow projection is orthographic, this can be skipped, because <code>ShadowCoord.w == 1.0</code>.\nNormalized device space coordinates are in range [-1.0, 1.0].</p>\n\n<p>So it has to be:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>vec2  mapUV     = ShadowCoord.xy * 0.5 + 0.5; // [-1.0, 1.0] -&gt; [0.0, 1.0]\nfloat depthFrag = ShadowCoord.z  * 0.5 + 0.5; // [-1.0, 1.0] -&gt; [0.0, 1.0]\n\nfloat depthMap  = texture(shadowMap, mapUV).r;\n\nif(depthMap &lt; depthFrag) {\n    visibility = 0.3;\n}\n</code></pre>\n"}], "owner": {"reputation": 143, "user_id": 8108331, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh3.googleusercontent.com/-8u7KR1PX9ic/AAAAAAAAAAI/AAAAAAAAABc/_IfLsO5eVH8/photo.jpg?sz=128", "display_name": "Elias", "link": "https://stackoverflow.com/users/8108331/elias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 1, "accepted_answer_id": 54115943, "answer_count": 1, "score": 1, "last_activity_date": 1547068288, "creation_date": 1547054358, "last_edit_date": 1547068288, "question_id": 54115317, "link": "https://stackoverflow.com/questions/54115317/c-comparing-shadow-map-matrix-with-draw-matrix-doesnt-create-shadows", "title": "C++ Comparing shadow map matrix with draw matrix doesn&#39;t create shadows", "body": "<p>I am trying to implement shadow mapping. I am able to render a depth map onto a framebuffer texture. and send it to the shader, as well as the lights orthographic matrix to test if a fragment is in the shadow. But the results are not correct. Instead of creating shadows all fragments are just painted solibly if they are \"inside\" the light matrix it seems like.</p>\n\n<p><img src=\"https://i.imgur.com/SjYsIPw.png\" alt=\"img\"></p>\n\n<p>As you can see on the bottom left the generated depth texture is correct. </p>\n\n<p>I've tried many tutorials but none mention any problems like this. It might because the light direction and orthographic projection is wrong, but I can't seem to find a working light direction that produces any shadows.</p>\n\n<p>This is how I generate the frame buffer and texture(frameBuffer and framebufferTexture are instantiated in the class header):</p>\n\n<pre><code>glGenFramebuffers(1, &amp;frameBuffer);\nglBindFramebuffer(GL_FRAMEBUFFER, frameBuffer);\n\n//texture buffer for frame buffer\nglGenTextures(1, &amp;framebufferTexture);\nglBindTexture(GL_TEXTURE_2D, framebufferTexture);\nglTexImage2D(GL_TEXTURE_2D, 0, GL_DEPTH_COMPONENT16, 896, 504, 0, GL_DEPTH_COMPONENT, GL_FLOAT, 0);\nglTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_NEAREST);\nglTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_NEAREST);\nglTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_BORDER);\nglTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_BORDER);\n\nglTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_COMPARE_FUNC, GL_LESS);\nglTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_COMPARE_MODE, GL_COMPARE_REF_TO_TEXTURE);\n\n\n//Set framebufferTexture as our color attachment #0\nglFramebufferTexture2D(GL_DRAW_FRAMEBUFFER, GL_DEPTH_ATTACHMENT,\n    GL_TEXTURE_2D, framebufferTexture, 0);\n\nglDrawBuffer(GL_NONE);\n</code></pre>\n\n<p>This is how I create the depth texture</p>\n\n<pre><code>glCullFace(GL_BACK);\nglBindFramebuffer(GL_DRAW_FRAMEBUFFER, frameBuffer);\n//Setup depth texture framebuffer rendering\nglEnable(GL_POLYGON_OFFSET_FILL);\nglPolygonOffset(2.0f, 2.0f);\nglViewport(0, 0, 896, 504);\nglClear(GL_DEPTH_BUFFER_BIT);\n\nglUniform1i(glGetUniformLocation(shaderProgram, \"fragmentTypeTarget\"), -1);\n\n\nglm::vec3 lightInvDir = glm::vec3(5, 17, 1);\n//Calculate the matrix for drawing the framebuffer\n//Make it an orthographic that takes the whole screen\nglm::mat4 depthProjectionMatrix = glm::ortho&lt;float&gt;(-17, 17, -17, 17, 0, 37);\nglm::mat4 depthViewMatrix = glm::lookAt(\n    lightInvDir,\n    glm::vec3(0, 0, 0),\n    glm::vec3(0, 1, 0));\nglm::mat4 lightSpaceMatrix = depthProjectionMatrix * depthViewMatrix;\n\n//Render the objects\nfor (int i = 0; i &lt; objectPool.size(); i++) {\n    objectPool[i]-&gt;draw(lightSpaceMatrix);\n}\n</code></pre>\n\n<p>This is how I send the shadow map matrix for drawing the shadows:</p>\n\n<pre><code>glm::mat4 Model = glm::translate(glm::mat4(1.0), glm::vec3(x, y, z));\nglm::vec3 lightInvDir = glm::vec3(5, 17, 1);\n    //Calculate the matrix for drawing the framebuffer\n    //Make it an orthographic that takes the whole screen\n    glm::mat4 depthProjectionMatrix = glm::ortho&lt;float&gt;(-17, 17, -17, 17, 0, 37);\n    glm::mat4 depthViewMatrix = glm::lookAt(\n        lightInvDir,\n        glm::vec3(0, 0, 0),\n        glm::vec3(0, 1, 0));\n    glm::mat4 lightSpaceMatrix = depthProjectionMatrix * depthViewMatrix * Model;\nglUniformMatrix4fv(glGetUniformLocation(shader, \"shadowMatrix\"), 1, GL_FALSE, &amp;lightSpaceMatrix[0][0]);\n</code></pre>\n\n<p>My fragment shader:</p>\n\n<pre><code>#version 330 core\nlayout(location = 0) out vec4 outColor;\nin vec2 UV;\nin vec4 ShadowCoord;\nuniform sampler2D textureSampler;\nuniform sampler2D shadowMap;\nuniform int fragmentTypeTarget;\n\n\n// 'colorImage' is a sampler2D with the depth image\n// read from the current depth buffer bound to it.\nfloat LinearizeDepth(in vec2 uv, sampler2D t)\n{\n    float zNear = 1.0;    \n    float zFar  = 5.0; \n    float depth = texture2D(t, uv).x;\n    return (2.0 * zNear) / (zFar + zNear - depth * (zFar - zNear));\n}\n\nvoid main(){\nif(fragmentTypeTarget == -1){//draw frame buffer\n\n}else if(fragmentTypeTarget == 0){//Draw everything normal\n    vec4 tex = texture2D(textureSampler, UV);\n    outColor = vec4(tex.rgb, tex.a);\n}else if(fragmentTypeTarget == 1){//Draw depth texture\n    //vec2 res = gl_FragCoord.xy / vec2(1024, 1024);\n    outColor = texture(textureSampler, UV);\n    float c = LinearizeDepth(UV, textureSampler);\n    outColor = vec4(c, c, c, 1.0);\n}else if(fragmentTypeTarget == 2){//Draw everything but apply the shadow\n    float visibility = 1.0;\n    float bias = 0.0039;\n\n    if(texture(shadowMap, ShadowCoord.xy).z &lt; ShadowCoord.z){\n        visibility = 0.3;\n    }\n    vec4 tex = texture2D(textureSampler, UV);\n    outColor = visibility * vec4(tex.rgb, tex.a);\n}\n}\n</code></pre>\n\n<p>My vertex shader:</p>\n\n<pre><code>#version 330 core\nin vec2 UVsIn;\nout vec2 UV;\nin vec3 position;\nin vec3 vertexColor;\nout vec3 fragmentColor;\nuniform mat4 mvp;\nuniform mat4 shadowMatrix;\nout vec4 ShadowCoord;\n\nvoid main(){\ngl_Position = mvp * vec4(position, 1.0);\nfragmentColor = vertexColor;\nUV = UVsIn;\n\nShadowCoord = shadowMatrix * vec4(position, 1.0);\n}\n</code></pre>\n\n<p>The result should look more like this:</p>\n\n<p><img src=\"https://i.imgur.com/Y3z2L4b.png\" alt=\"img\"></p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>I got it to work I think. \nWhen generating the framebuffer texture I used the wrong compare function. It should be: \"GL_COMPARE_R_TO_TEXTURE\" instead of \"GL_COMPARE_REF_TO_TEXTURE\".</p>\n\n<pre><code>glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_COMPARE_MODE, GL_COMPARE_R_TO_TEXTURE);\n</code></pre>\n\n<p>The openGl documentation says: GL_COMPARE_R_TO_TEXTURE: Specifies that the interpolated and clamped r texture coordinate should be compared to the value in the currently bound depth texture</p>\n\n<p>Which is exactly what I want.</p>\n\n<p>I also found out that texture coordinates are in (s, t, r) instead of (x, y, z).</p>\n\n<p>since I want to compare depths of the matrices and texture I need to use r instead of z.\nso the fragment shader should have been written like:</p>\n\n<pre><code>float visibility = 1.0;\n\nvec2 mapUV = ShadowCoord.xy * 0.5 + 0.5;\nfloat depthFrag = ShadowCoord.z * 0.5 + 0.5;\n\nfloat depthMap = texture(shadowMap, mapUV).r;//r instead of z since its (s, t, r)\n\nif(depthMap &lt; depthFrag){\n    visibility = 0.3;\n}\n\nvec4 tex = texture2D(textureSampler, UV);\noutColor = visibility * vec4(tex.rgb, tex.a);\n</code></pre>\n\n<p>\" * 0.5 + 0.5\" was also needed to be added from Rabbid76 response.</p>\n"}, {"tags": ["c++", "cuda"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 9258569, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5f742e89a2c5f03114072e977af6bbe?s=128&d=identicon&r=PG&f=1", "display_name": "Tudor", "link": "https://stackoverflow.com/users/9258569/tudor"}, "edited": false, "score": 0, "creation_date": 1547062768, "post_id": 54116288, "comment_id": 95067048, "body": "Thank you very much, this answers the question I had"}], "tags": [], "owner": {"reputation": 119299, "user_id": 1695960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f557c03db19232aa410540af2f966?s=128&d=identicon&r=PG", "display_name": "Robert Crovella", "link": "https://stackoverflow.com/users/1695960/robert-crovella"}, "is_accepted": true, "score": 1, "last_activity_date": 1547058754, "creation_date": 1547058754, "answer_id": 54116288, "question_id": 54115284, "link": "https://stackoverflow.com/questions/54115284/how-to-use-macros-or-c-templates-to-allow-reusable-code-in-both-host-and-devic/54116288#54116288", "title": "How to use macros or C++ templates to allow reusable code in both host and device code?", "body": "<p>What you're asking for should be possible.  We don't want to attempt to overload a function separately via <code>__host__</code> and <code>__device__</code> (not allowed) and we don't want to attempt to do this using inheritance and virtual functions (the virtual function table will not be usable in such an object passed from host to device).</p>\n\n<p>But if we avoid those issues, the basic idea is to use the <code>__CUDA_ARCH__</code> <a href=\"https://docs.nvidia.com/cuda/cuda-compiler-driver-nvcc/index.html#virtual-architecture-identification-macro\" rel=\"nofollow noreferrer\">nvcc macro</a> to differentiate the host and device path for the compiler, generally following what is suggested <a href=\"https://stackoverflow.com/a/16314084/1695960\">here</a>.</p>\n\n<p>Here's one possible method, roughly following your outline:</p>\n\n<pre><code>$ cat t34.cu\n#include &lt;cstdio&gt;\n#include &lt;cstdlib&gt;\n#include &lt;iostream&gt;\n#include &lt;curand_kernel.h&gt;\n\n\nstruct Sampler {\n  __host__ __device__ float operator()(curandState *s){\n#ifdef __CUDA_ARCH__\n    return curand_uniform(s);\n#else\n    return rand()/(float)RAND_MAX;\n#endif\n  }\n};\n\n__global__ void init_rng(curandState *state, size_t n){\n        size_t idx = threadIdx.x+blockDim.x*blockIdx.x;\n        if (idx &lt; n)\n          curand_init(1234, idx, 0, state+idx);\n}\n\n__global__ void gpu_sample(Sampler s, curandState *state, size_t n){\n        size_t idx = threadIdx.x+blockDim.x*blockIdx.x;\n        if (idx &lt; n)\n                printf(\"gpu id: %lu, val: %f\\n\", idx, s(state+idx));\n}\n\n__host__  void cpu_sample(Sampler s){\n        curandState dummy;\n    std::cout &lt;&lt; \"cpu: \" &lt;&lt; s(&amp;dummy) &lt;&lt; std::endl;\n}\n\nint main(){\n        int n = 1;\n        int nTPB = 256;\n        curandState *s;\n        Sampler my_op;\n        cudaMalloc(&amp;s, n*sizeof(curandState));\n        init_rng&lt;&lt;&lt;(n+nTPB-1)/nTPB, nTPB&gt;&gt;&gt;(s,n);\n        gpu_sample&lt;&lt;&lt;(n+nTPB-1)/nTPB, nTPB&gt;&gt;&gt;(my_op, s, n);\n        cudaDeviceSynchronize();\n        cpu_sample(my_op);\n}\n\n\n\n$ nvcc -o t34 t34.cu\n$ cuda-memcheck ./t34\n========= CUDA-MEMCHECK\ngpu id: 0, val: 0.145468\ncpu: 0.840188\n========= ERROR SUMMARY: 0 errors\n$\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 9258569, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5f742e89a2c5f03114072e977af6bbe?s=128&d=identicon&r=PG&f=1", "display_name": "Tudor", "link": "https://stackoverflow.com/users/9258569/tudor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 1, "accepted_answer_id": 54116288, "answer_count": 1, "score": -1, "last_activity_date": 1547058754, "creation_date": 1547054209, "question_id": 54115284, "link": "https://stackoverflow.com/questions/54115284/how-to-use-macros-or-c-templates-to-allow-reusable-code-in-both-host-and-devic", "title": "How to use macros or C++ templates to allow reusable code in both host and device code?", "body": "<p>I'm writing a hobby raytracer in CUDA and C++ and I'm running into an issue that I haven't been able to get an answer on. I have written CPU and GPU code such that it can execute on machines with or without CUDA-capable devices. However, this has lead to some code duplication in the following sense:\nA small set of functions require random number generation, which is achieved with <code>stdlib</code> on host and <code>curand</code> on device. I would love to have <code>__host__ __device__</code> functions that take a <code>Sampler</code> struct that either calls <code>rand()</code> on host or <code>curand_uniform()</code> on device. I've tried some things but can't get the program to compile - the compiler complains about not calling <code>__device__</code> functions from <code>__host__</code> code and vice versa.</p>\n\n<p>Ideally I'd like my rendering functions to take a <code>Sampler *</code> which looks something like the code below.</p>\n\n<p>Thanks!</p>\n\n<pre><code>struct Sampler {\n    __host__ virtual float getNextFloat() { return rand() / (RAND_MAX + 1.f); }\n};\n\nstruct CudaSampler : Sampler { \n    curandState* p_curandState;\n    __device__ float getNextFloat() { return curand_uniform(p_curandState); }\n};\n</code></pre>\n"}, {"tags": ["c++", "python-3.x"], "comments": [{"owner": {"reputation": 15619, "user_id": 1548468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0745dce203d52699e63a575b3103ad70?s=128&d=identicon&r=PG", "display_name": "Botje", "link": "https://stackoverflow.com/users/1548468/botje"}, "edited": false, "score": 1, "creation_date": 1547051334, "post_id": 54114345, "comment_id": 95061559, "body": "Did you check whether the <code>_Py_fopen</code> succeeded? It might have returned <code>NULL</code> if it could not find or open the script file."}, {"owner": {"reputation": 43, "user_id": 9100049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b46a4091c2a980706803f10299da68b?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Stettler", "link": "https://stackoverflow.com/users/9100049/michael-stettler"}, "reply_to_user": {"reputation": 15619, "user_id": 1548468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0745dce203d52699e63a575b3103ad70?s=128&d=identicon&r=PG", "display_name": "Botje", "link": "https://stackoverflow.com/users/1548468/botje"}, "edited": false, "score": 0, "creation_date": 1547072383, "post_id": 54114345, "comment_id": 95071043, "body": "So I just added assert(fp!=NULL) to control if it is NULL and indeed it is. Should I tell the CMakeList.txt to look specifically for the script ? I am not so familiar with C++"}, {"owner": {"reputation": 15619, "user_id": 1548468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0745dce203d52699e63a575b3103ad70?s=128&d=identicon&r=PG", "display_name": "Botje", "link": "https://stackoverflow.com/users/1548468/botje"}, "edited": false, "score": 0, "creation_date": 1547107449, "post_id": 54114345, "comment_id": 95079869, "body": "Depends on how you run it, but the easiest solution is to copy the script to your build directory and run your program from there."}, {"owner": {"reputation": 43, "user_id": 9100049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b46a4091c2a980706803f10299da68b?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Stettler", "link": "https://stackoverflow.com/users/9100049/michael-stettler"}, "reply_to_user": {"reputation": 15619, "user_id": 1548468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0745dce203d52699e63a575b3103ad70?s=128&d=identicon&r=PG", "display_name": "Botje", "link": "https://stackoverflow.com/users/1548468/botje"}, "edited": false, "score": 0, "creation_date": 1547110341, "post_id": 54114345, "comment_id": 95081191, "body": "May I ask you to be more specific on how I could run my program from there ? Currently main.cpp, test_script.py and CMakeLists.txt are already all within the same (build) directory. I am using CLion to build and run my code, I am on a Mac"}, {"owner": {"reputation": 15619, "user_id": 1548468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0745dce203d52699e63a575b3103ad70?s=128&d=identicon&r=PG", "display_name": "Botje", "link": "https://stackoverflow.com/users/1548468/botje"}, "edited": false, "score": 1, "creation_date": 1547114129, "post_id": 54114345, "comment_id": 95083341, "body": "CLion will create a <i>different</i> directory for building in. (and presumably running your program from that directory) Hunt around in your project settings, find out by printing the result of <code>getcwd</code>, or debug your program and see if you get the full path to it."}, {"owner": {"reputation": 43, "user_id": 9100049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b46a4091c2a980706803f10299da68b?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Stettler", "link": "https://stackoverflow.com/users/9100049/michael-stettler"}, "reply_to_user": {"reputation": 15619, "user_id": 1548468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0745dce203d52699e63a575b3103ad70?s=128&d=identicon&r=PG", "display_name": "Botje", "link": "https://stackoverflow.com/users/1548468/botje"}, "edited": false, "score": 0, "creation_date": 1547116925, "post_id": 54114345, "comment_id": 95085050, "body": "You were write! Thanks a lot. So CLion was creating this &quot;cmake-build-debug&quot; directory. Moving my python script within this folder solved my issue!"}], "answers": [{"tags": [], "owner": {"reputation": 43, "user_id": 9100049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b46a4091c2a980706803f10299da68b?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Stettler", "link": "https://stackoverflow.com/users/9100049/michael-stettler"}, "is_accepted": true, "score": 0, "last_activity_date": 1547117320, "creation_date": 1547117320, "answer_id": 54127023, "question_id": 54114345, "link": "https://stackoverflow.com/questions/54114345/embedding-python-without-use-of-arg-script-not-loading/54127023#54127023", "title": "Embedding python without use of arg, script not loading", "body": "<p>The issue was due to a wrong building directory access created by CLion as Botje pointed out. By moving my script to the folder: \"cmake-build-debug\" solved the problem. </p>\n"}], "owner": {"reputation": 43, "user_id": 9100049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b46a4091c2a980706803f10299da68b?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Stettler", "link": "https://stackoverflow.com/users/9100049/michael-stettler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "accepted_answer_id": 54127023, "answer_count": 1, "score": 0, "last_activity_date": 1547117320, "creation_date": 1547050872, "question_id": 54114345, "link": "https://stackoverflow.com/questions/54114345/embedding-python-without-use-of-arg-script-not-loading", "title": "Embedding python without use of arg, script not loading", "body": "<p>I am trying to embedded a python script within a C++ application. I am trying to do it without having the need to use the argv parameters and therefore I am trying to follow this tutorial: <a href=\"https://www.codeproject.com/Articles/820116/%2FArticles%2F820116%2FEmbedding-Python-program-in-a-C-Cplusplus-code\" rel=\"nofollow noreferrer\">https://www.codeproject.com/Articles/820116/%2FArticles%2F820116%2FEmbedding-Python-program-in-a-C-Cplusplus-code</a></p>\n\n<p>My first step was to run this tutorial (1.1 Very High Level embedding): <a href=\"https://docs.python.org/3/extending/embedding.html\" rel=\"nofollow noreferrer\">https://docs.python.org/3/extending/embedding.html</a> which is now working.</p>\n\n<p>While going to the second tutorial, my code compiled but the script doesn't seems to be loaded as nothing is displayed in the console</p>\n\n<p>main.cpp:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;string&gt;\n#include &lt;Python.h&gt;\n\nusing namespace std;\n\nint main() {\n    cout &lt;&lt; \"Hello, World!\" &lt;&lt; endl;\n\n    char filename[] = \"test_script.py\";\n    FILE* fp;\n\n    Py_Initialize();\n\n    fp = _Py_fopen(filename, \"r\");\n    PyRun_SimpleFile(fp, filename);\n\n    Py_Finalize();\n    return 0;\n}\n</code></pre>\n\n<p>test_script.py:</p>\n\n<pre><code>print(\"print test from python\")\n\ndef multiply(a,b):\n    print(\"Will compute\", a, \"times\", b)\n    c = 0\n    for i in range(0, a):\n        c = c + b\n    return c\n</code></pre>\n\n<p>CmakeList.txt</p>\n\n<pre><code>cmake_minimum_required(VERSION 3.13)\nproject(TestCharacter)\n\nset(CMAKE_CXX_STANDARD 14)\n\nfind_package(PythonLibs REQUIRED)\n\nadd_executable(TestCharacter main.cpp)\n\ntarget_include_directories(TestCharacter PRIVATE ${PYTHON_INCLUDE_DIRS})\ntarget_link_libraries(TestCharacter PRIVATE ${PYTHON_LIBRARIES})\n</code></pre>\n\n<p>As I don't get any building error I don't know where to look for. I have tried to modify the script's name within my C++ code as to force an error (I first thought that it may be a path or name error), but I didn't get any building error</p>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 5, "creation_date": 1547051029, "post_id": 54114288, "comment_id": 95061369, "body": "Tip: Get in the habit of declaring string arguments as <code>const std::string&amp;</code> and not <code>string</code>. Use <code>const</code>, use references, and <a href=\"https://stackoverflow.com/questions/1452721/why-is-using-namespace-std-considered-bad-practice\">don&#39;t put <code>using namespace std</code></a>."}, {"owner": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "edited": false, "score": 3, "creation_date": 1547051046, "post_id": 54114288, "comment_id": 95061379, "body": "I think just sorting them lexicographically in descending order should be enough"}, {"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 3, "creation_date": 1547051083, "post_id": 54114288, "comment_id": 95061406, "body": "<code>a</code> and <code>b</code> are potentially uninitialized when you use them for comparison.  Also, please get rid of the input statements and instead, hard-code the data into the program.  There is no need to burden us (and yourself) in repeatedly entering the data over and over again when testing."}, {"owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "edited": false, "score": 3, "creation_date": 1547051153, "post_id": 54114288, "comment_id": 95061458, "body": "If two strings are equal your comparison function returns true, if should return false in this case. <code>compare</code> should implement a &#39;less than&#39; operation and given equal arguments should always return false."}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1547051362, "post_id": 54114288, "comment_id": 95061576, "body": "Your compare is nothing but a greater operation, can can be shortened to <code>return a &gt; b</code>."}, {"owner": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 4, "creation_date": 1547051405, "post_id": 54114288, "comment_id": 95061602, "body": "@tadman OP does not have <code>using namespace std</code> in his code."}, {"owner": {"reputation": 355, "user_id": 7539010, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8mwrI.jpg?s=128&g=1", "display_name": "GG1991", "link": "https://stackoverflow.com/users/7539010/gg1991"}, "reply_to_user": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1547051585, "post_id": 54114288, "comment_id": 95061728, "body": "@SergeyA I don&#39;t want [10 9 1] I want [9 1 10] because 9110 is grater than 1091"}, {"owner": {"reputation": 19667, "user_id": 1312382, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FL8Fg.jpg?s=128&g=1", "display_name": "Aconcagua", "link": "https://stackoverflow.com/users/1312382/aconcagua"}, "edited": false, "score": 0, "creation_date": 1547051769, "post_id": 54114288, "comment_id": 95061838, "body": "Prefer to have <code>size_t min_len = std::min(x, y);</code>"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "reply_to_user": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "edited": false, "score": 0, "creation_date": 1547051946, "post_id": 54114288, "comment_id": 95061956, "body": "@Slava Sorry, <code>using std::string</code> but it&#39;s the same problem."}, {"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 0, "creation_date": 1547051975, "post_id": 54114288, "comment_id": 95061983, "body": "@GG1991 <a href=\"http://coliru.stacked-crooked.com/a/061b9d01e927a089\" rel=\"nofollow noreferrer\">For the sake of anyone testing your code, a non-input routine version</a>."}, {"owner": {"reputation": 19667, "user_id": 1312382, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FL8Fg.jpg?s=128&g=1", "display_name": "Aconcagua", "link": "https://stackoverflow.com/users/1312382/aconcagua"}, "edited": false, "score": 0, "creation_date": 1547051977, "post_id": 54114288, "comment_id": 95061986, "body": "You don&#39;t need to subtract &#39;0&#39; to get a and b - the result of comparison remains the same, no matter if you add some offset to both - as long as offset is the same in both cases, of course..."}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1547051986, "post_id": 54114288, "comment_id": 95061993, "body": "@GG1991 that would work as you expect, since arguments are string."}, {"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 0, "creation_date": 1547052157, "post_id": 54114288, "comment_id": 95062097, "body": "@GG1991 FYI, your code produces an <code>assert</code> error on Visual Studio due to an invalid comparison operator.  VS checks for mistakes such as the one you&#39;re making in <code>compare</code>."}, {"owner": {"reputation": 50917, "user_id": 947836, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a9addee65c2a92be93004ad689a7a415?s=128&d=identicon&r=PG&f=1", "display_name": "jrok", "link": "https://stackoverflow.com/users/947836/jrok"}, "reply_to_user": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1547052198, "post_id": 54114288, "comment_id": 95062125, "body": "@SergeyA Well it wouldn&#39;t, because &quot;1&quot; &lt; &quot;10&quot;, so you get 9101."}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "reply_to_user": {"reputation": 50917, "user_id": 947836, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a9addee65c2a92be93004ad689a7a415?s=128&d=identicon&r=PG&f=1", "display_name": "jrok", "link": "https://stackoverflow.com/users/947836/jrok"}, "edited": false, "score": 0, "creation_date": 1547052449, "post_id": 54114288, "comment_id": 95062270, "body": "@jrok yeah, you are right, I missed that."}, {"owner": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1547060448, "post_id": 54114288, "comment_id": 95066043, "body": "@tadman no it is not the same, bringing whole namespace is a disaster, bringing only some names from it should be fine if you know what you are doing."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "reply_to_user": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "edited": false, "score": 0, "creation_date": 1547060563, "post_id": 54114288, "comment_id": 95066097, "body": "@Slava I&#39;ve seen a ton of C++ questions here and this is the first time I&#39;ve seen someone literally <code>using std::string</code>. In this rare case my boilerplate advisory doesn&#39;t necessarily apply, you&#39;re right there."}], "answers": [{"comments": [{"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1547051578, "post_id": 54114527, "comment_id": 95061716, "body": "You need to be more specific than that. You should speak in terms of requirements to compare function."}, {"owner": {"reputation": 50917, "user_id": 947836, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a9addee65c2a92be93004ad689a7a415?s=128&d=identicon&r=PG&f=1", "display_name": "jrok", "link": "https://stackoverflow.com/users/947836/jrok"}, "edited": false, "score": 0, "creation_date": 1547051632, "post_id": 54114527, "comment_id": 95061749, "body": "Good catch with the comparator, and I wonder why someone downvoted you."}, {"owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "reply_to_user": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1547051674, "post_id": 54114527, "comment_id": 95061783, "body": "@SergeyA I mentioned the requirement that is crucial, that for equal arguments the return should be false. Strict weak ordering is not something I readily understand."}, {"owner": {"reputation": 355, "user_id": 7539010, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8mwrI.jpg?s=128&g=1", "display_name": "GG1991", "link": "https://stackoverflow.com/users/7539010/gg1991"}, "edited": false, "score": 0, "creation_date": 1547051851, "post_id": 54114527, "comment_id": 95061895, "body": "Thank you John you are right. This program is working properly now and I agree on your intuition that <code>sort</code> function changes the algorithm for <code>n&gt;=100</code>."}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1547051931, "post_id": 54114527, "comment_id": 95061945, "body": "@john it is called strict total ordering, and you can read about it here: <a href=\"https://en.cppreference.com/w/cpp/named_req/Compare\" rel=\"nofollow noreferrer\">en.cppreference.com/w/cpp/named_req/Compare</a>"}, {"owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "reply_to_user": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1547052326, "post_id": 54114527, "comment_id": 95062204, "body": "@SergeyA the link you posted calls it strict weak ordering. My confusion about it is in thinking of a realistic example where it is different from a total ordering"}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1547052519, "post_id": 54114527, "comment_id": 95062300, "body": "<code>Note: comp induces a strict total ordering on the equivalence classes determined by equiv</code>"}, {"owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "reply_to_user": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1547052818, "post_id": 54114527, "comment_id": 95062477, "body": "@SergeyA So a strict weak ordering is simply an ordering where some elements are allowed to be equal, but unequal elements have a strict total ordering? That&#39;s so easy, I feel a bit stupid for not having realised it before. I assumed it was something more complex than that. Never been explained to me in simple language I guess."}], "tags": [], "owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "is_accepted": true, "score": 6, "last_activity_date": 1547051458, "creation_date": 1547051458, "answer_id": 54114527, "question_id": 54114288, "link": "https://stackoverflow.com/questions/54114288/sorting-c-vectorstring/54114527#54114527", "title": "Sorting c++ vector&lt;string&gt;", "body": "<p>The comparison function for <code>std::sort</code> should always return false given equal arguments. But your function returns true. Try the following modification</p>\n\n<pre><code>bool compare(string i1, string i2) \n{ \n     ...\n\n     if (a &gt; b)\n        return true; \n     if (a &lt; b)\n        return false; \n\n     return i1.length() &lt; i2.length();\n} \n</code></pre>\n\n<p>I'm guessing that what is happening is that on your platform <code>std::sort</code> chosens a different algorithm when the size of the sequence to sort is >= 100. And for this different algorithm it is crucial that the requirements of the comparison function are met.</p>\n"}, {"comments": [{"owner": {"reputation": 355, "user_id": 7539010, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8mwrI.jpg?s=128&g=1", "display_name": "GG1991", "link": "https://stackoverflow.com/users/7539010/gg1991"}, "edited": false, "score": 0, "creation_date": 1547066790, "post_id": 54115330, "comment_id": 95068702, "body": "Hi, @Aconcagua this is the right solution for the problem. I would put this the right solution but the original question was about the error of the sort function. In fact the solution that I wrote was bad and this one that you put is right. Thank you !"}], "tags": [], "owner": {"reputation": 19667, "user_id": 1312382, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FL8Fg.jpg?s=128&g=1", "display_name": "Aconcagua", "link": "https://stackoverflow.com/users/1312382/aconcagua"}, "is_accepted": false, "score": 2, "last_activity_date": 1547054413, "creation_date": 1547054413, "answer_id": 54115330, "question_id": 54114288, "link": "https://stackoverflow.com/questions/54114288/sorting-c-vectorstring/54115330#54115330", "title": "Sorting c++ vector&lt;string&gt;", "body": "<p>While the answer to the actual question is already <a href=\"https://stackoverflow.com/a/54114527/1312382\">given</a>, your comparison algorithm is <em>not</em> suitable to get the desired result!</p>\n\n<p>Consider the following examples:</p>\n\n<p>Case 1: <code>[99, 991]</code> &ndash; you need to sort the <em>shorter</em> string first to get <code>99991</code> instead of <code>99199</code>.</p>\n\n<p>Case 2: <code>[91, 919]</code> &ndash; you need to sort the <em>longer</em> first to get <code>91991</code> instead of <code>91919</code>.</p>\n\n<p>While lexicographical comparison (which is what you implemented) is fine to sort strings on their common length, the criterion 'length', if strings compare equal on their common length, cannot be used to decide which string is to be sorted first!</p>\n\n<p>You could, though, do the following:</p>\n\n<pre><code>std::sort\n(\n    a.begin(), a.end(),\n    [](std::string x, std::string y)\n    {\n        std::string xy = x + y;\n        std::string yx = y + x;\n        return xy &gt; yx;\n    }\n);\n</code></pre>\n\n<p>i. e. sort the one string first that results, if concatenated with the other one, in the larger value.</p>\n"}], "owner": {"reputation": 355, "user_id": 7539010, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8mwrI.jpg?s=128&g=1", "display_name": "GG1991", "link": "https://stackoverflow.com/users/7539010/gg1991"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "accepted_answer_id": 54114527, "answer_count": 2, "score": -2, "last_activity_date": 1547054413, "creation_date": 1547050729, "last_edit_date": 1547052861, "question_id": 54114288, "link": "https://stackoverflow.com/questions/54114288/sorting-c-vectorstring", "title": "Sorting c++ vector&lt;string&gt;", "body": "<p>I want to sort a string vector for an exercise. These string has only digits from 0 to 9 like [ 10 2 1 9 91 ] and I want to sort as [ 9 91 2 1 10 ] to reach the largest number ( 9912110 ). I did the following code using the <code>sort</code> function</p>\n\n<pre><code>#include &lt;algorithm&gt;\n#include &lt;sstream&gt;\n#include &lt;iostream&gt;\n#include &lt;vector&gt;\n#include &lt;string&gt;\n\nusing std::vector;\nusing std::string;\n\nbool compare(string i1, string i2) \n{ \n     int a, b;\n     int i = 0;\n     int min_len = (i1.length() &gt; i2.length()) ? i2.length(): i1.length();\n     while(i &lt; min_len) {\n          a = (int) (i1.at(i) - '0');\n          b = (int) (i2.at(i) - '0');\n          if (a != b)\n             break;\n          i++;\n     }\n     if (a &gt; b)\n        return true; \n     if (a &lt; b)\n        return false; \n\n     if (i1.length() &gt; i2.length())\n        return false;\n\n     return true;\n} \n\nint main() {\n    int n;\n    std::cin &gt;&gt; n;\n    vector&lt;string&gt; a(n);\n    for (size_t i = 0; i &lt; a.size(); i++) {\n        std::cin &gt;&gt; a[i];\n    }\n    sort(a.begin(), a.end(), compare);\n }\n</code></pre>\n\n<p>The problem is that when I execute with arguments:</p>\n\n<pre><code>100\n2 8 2 3 6 4 1 1 10 6 3 3 6 1 3 8 4 6 1 10 8 4 10 4 1 3 2 3 2 6 1 5 2 9 8 5 10 8 7 9 6 4 2 6 3 8 8 9 8 2 9 10 3 10 7 5 7 1 7 5 1 4 7 6 1 10 5 4 8 4 2 7 8 1 1 7 4 1 1 9 8 6 5 9 9 3 7 6 3 10 8 10 7 2 5 1 1 9 9 5\n</code></pre>\n\n<p>gives me the following error:</p>\n\n<pre><code>terminate called after throwing an instance of 'std::logic_error'\nwhat():  basic_string::_M_construct null not valid\nAborted\n</code></pre>\n\n<p>But if I execute with 99 and I delete the last number it works fine. Also gives the same error if I try with more than 100 (like 101 or 102 ...). I suppose that the error is in the <code>compare</code> function.</p>\n\n<p><strong>Edited :</strong></p>\n\n<pre><code> bool compare(const std::string&amp; i1, const std::string&amp; i2) \n { \n      int i = 0;\n      int min_len = (i1.length() &gt; i2.length()) ? i2.length(): i1.length();\n      while (i &lt; min_len) {\n            int a = (int) (i1.at(i) - '0');\n            int b = (int) (i2.at(i) - '0');\n            if (a &gt; b)\n               return true; \n            if (a &lt; b)\n               return false; \n            i++;\n      }\n\n      return (i1.length() &lt; i2.length());\n }\n</code></pre>\n"}, {"tags": ["c++", "visual-c++", "cmake", "macros", "simd"], "comments": [{"owner": {"reputation": 28528, "user_id": 3780494, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vqia1.jpg?s=128&g=1", "display_name": "Chuck Walbourn", "link": "https://stackoverflow.com/users/3780494/chuck-walbourn"}, "edited": false, "score": 1, "creation_date": 1547055986, "post_id": 54114287, "comment_id": 95064163, "body": "Try adding a <code>#error test</code> statement to the <code>__AVX2__</code> clause and build to see if it really is set or not. Depending on exactly which version of Visual Studio you are running, the IntelliSense compiler is sometimes (too often) a bit behind the actual C++ compiler so you can get false colorization results. Also, support for <code>&#47;arch:AVX2</code> was added as of Visual Studio 2013 Update 2. Which version Visual Studio are you actually using?"}, {"owner": {"reputation": 39, "user_id": 8791655, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cfabfc02d1b715c6b4a127b0494152af?s=128&d=identicon&r=PG&f=1", "display_name": "Hanseul SHIN", "link": "https://stackoverflow.com/users/8791655/hanseul-shin"}, "reply_to_user": {"reputation": 28528, "user_id": 3780494, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vqia1.jpg?s=128&g=1", "display_name": "Chuck Walbourn", "link": "https://stackoverflow.com/users/3780494/chuck-walbourn"}, "edited": false, "score": 0, "creation_date": 1547057459, "post_id": 54114287, "comment_id": 95064776, "body": "Hello! sorry for late reply, I use VS 2017(2018 Dec 18 Update)."}, {"owner": {"reputation": 39, "user_id": 8791655, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cfabfc02d1b715c6b4a127b0494152af?s=128&d=identicon&r=PG&f=1", "display_name": "Hanseul SHIN", "link": "https://stackoverflow.com/users/8791655/hanseul-shin"}, "reply_to_user": {"reputation": 28528, "user_id": 3780494, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vqia1.jpg?s=128&g=1", "display_name": "Chuck Walbourn", "link": "https://stackoverflow.com/users/3780494/chuck-walbourn"}, "edited": false, "score": 0, "creation_date": 1547058043, "post_id": 54114287, "comment_id": 95065018, "body": "@ChuckWalbourn And Yes, E0035 for #error directive AVX is not set at all."}, {"owner": {"reputation": 28528, "user_id": 3780494, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vqia1.jpg?s=128&g=1", "display_name": "Chuck Walbourn", "link": "https://stackoverflow.com/users/3780494/chuck-walbourn"}, "edited": false, "score": 0, "creation_date": 1547062227, "post_id": 54114287, "comment_id": 95066799, "body": "I&#39;d check your command  line output then to see what&#39;s ending up there..."}, {"owner": {"reputation": 39, "user_id": 8791655, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cfabfc02d1b715c6b4a127b0494152af?s=128&d=identicon&r=PG&f=1", "display_name": "Hanseul SHIN", "link": "https://stackoverflow.com/users/8791655/hanseul-shin"}, "reply_to_user": {"reputation": 28528, "user_id": 3780494, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vqia1.jpg?s=128&g=1", "display_name": "Chuck Walbourn", "link": "https://stackoverflow.com/users/3780494/chuck-walbourn"}, "edited": false, "score": 0, "creation_date": 1547063389, "post_id": 54114287, "comment_id": 95067298, "body": "@ChuckWalbourn I just chose to do the tests(which one is supported from my system) from CMake and add my own compile definition. This way, I don&#39;t need to worry about Macros. Thank you!"}, {"owner": {"reputation": 28528, "user_id": 3780494, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vqia1.jpg?s=128&g=1", "display_name": "Chuck Walbourn", "link": "https://stackoverflow.com/users/3780494/chuck-walbourn"}, "edited": false, "score": 1, "creation_date": 1547063660, "post_id": 54114287, "comment_id": 95067404, "body": "If <code>__AVX2__</code> is not defined, then you aren&#39;t build with <code>&#47;arch:AVX2</code> with the Visual C++ or Intel compiler."}, {"owner": {"reputation": 3860, "user_id": 5251059, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93c9c608467b21bce1d709b56bf6d39d?s=128&d=identicon&r=PG&f=1", "display_name": "vre", "link": "https://stackoverflow.com/users/5251059/vre"}, "edited": false, "score": 0, "creation_date": 1547067125, "post_id": 54114287, "comment_id": 95068835, "body": "Can you try out the generator expression <code>$&lt;$&lt;CXX_COMPILER_ID:MSVC&gt;:&#47;arch:AVX2&gt;</code> and if that doesn&#39;t work adding the &quot;/arch:AVX2&quot; compile option without using a generator expression? I often use a <code>add_definition(&#47;arch:SSE2)</code> to enable a package wide setting."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1547099546, "post_id": 54114287, "comment_id": 95077020, "body": "Your header file looks exactly like <a href=\"https://agner.org/optimize/\" rel=\"nofollow noreferrer\">Agner Fog&#39;s</a> Vector Class <code>instrset.h</code> (<a href=\"https://github.com/darealshinji/vectorclass/blob/master/instrset.h\" rel=\"nofollow noreferrer\">github mirror</a>).   Be aware that it&#39;s GPLed.  If you copy code from it, your library also needs to be GPLed.  (Unless you and Agner both got that block of instruction-set macro checking from a common other source.)  Anyway, MSVC doesn&#39;t define macros for most levels of SSE, e.g. SSSE3, but it does define <code>__AVX__</code> and <code>__AVX2__</code> if enabled."}, {"owner": {"reputation": 39, "user_id": 8791655, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cfabfc02d1b715c6b4a127b0494152af?s=128&d=identicon&r=PG&f=1", "display_name": "Hanseul SHIN", "link": "https://stackoverflow.com/users/8791655/hanseul-shin"}, "reply_to_user": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1547130453, "post_id": 54114287, "comment_id": 95092708, "body": "@PeterCordes I used it to test Macros, my header is completely different now, with my own macros. Thanx for the tip!"}, {"owner": {"reputation": 39, "user_id": 8791655, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cfabfc02d1b715c6b4a127b0494152af?s=128&d=identicon&r=PG&f=1", "display_name": "Hanseul SHIN", "link": "https://stackoverflow.com/users/8791655/hanseul-shin"}, "reply_to_user": {"reputation": 3860, "user_id": 5251059, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93c9c608467b21bce1d709b56bf6d39d?s=128&d=identicon&r=PG&f=1", "display_name": "vre", "link": "https://stackoverflow.com/users/5251059/vre"}, "edited": false, "score": 0, "creation_date": 1547130514, "post_id": 54114287, "comment_id": 95092745, "body": "@vre Thanx for the tip! it&#39;s working now. Can you please rewrite your comment to the answer section? so that I can upvote it."}], "answers": [{"tags": [], "owner": {"reputation": 3860, "user_id": 5251059, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93c9c608467b21bce1d709b56bf6d39d?s=128&d=identicon&r=PG&f=1", "display_name": "vre", "link": "https://stackoverflow.com/users/5251059/vre"}, "is_accepted": true, "score": 1, "last_activity_date": 1547156685, "creation_date": 1547156685, "answer_id": 54137338, "question_id": 54114287, "link": "https://stackoverflow.com/questions/54114287/visual-studio-not-recognizing-avx2-or-avx/54137338#54137338", "title": "Visual Studio not recognizing __AVX2__ or __AVX__", "body": "<p>There are three ways to enable the compile option <code>/arch:AVX2</code> to your target (if it is supported by your compiler). </p>\n\n<p>Either by using a generator expression</p>\n\n<pre><code>target_compile_options(Maths PRIVATE $&lt;$&lt;CXX_COMPILER_ID:MSVC&gt;:/arch:AVX2&gt;)\n</code></pre>\n\n<p>or by setting the compile option in a <code>if</code> clause</p>\n\n<pre><code>if(MSVC)\n    target_compile_options(Maths PRIVATE /arch:AVX2)\nendif()\n</code></pre>\n\n<p>or by using an <code>add_definition</code> call to add the definitions to all targets that are created in the script after this command </p>\n\n<pre><code>if(MSVC)\n    add_definition(/arch:AVX2)\nendif()\n</code></pre>\n\n<p>I try to avoid using generator expressions if not absolutely necessary as they do not improve readability of the CMake script files and are sometimes hard to get right.</p>\n"}], "owner": {"reputation": 39, "user_id": 8791655, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cfabfc02d1b715c6b4a127b0494152af?s=128&d=identicon&r=PG&f=1", "display_name": "Hanseul SHIN", "link": "https://stackoverflow.com/users/8791655/hanseul-shin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1267, "favorite_count": 1, "accepted_answer_id": 54137338, "answer_count": 1, "score": 2, "last_activity_date": 1547156685, "creation_date": 1547050725, "last_edit_date": 1547099286, "question_id": 54114287, "link": "https://stackoverflow.com/questions/54114287/visual-studio-not-recognizing-avx2-or-avx", "title": "Visual Studio not recognizing __AVX2__ or __AVX__", "body": "<p>I'm implementing a simple SIMD wrapper in C++.\nTo make it cross-platform, I use CMake to set-up the project with Visual Studio</p>\n\n<p>I've added /Arch:AVX2, but Visual Studio does not recognize <code>__AVX2__</code> Macro.</p>\n\n<p>First, my CMake.</p>\n\n<pre><code>cmake_minimum_required(VERSION 3.12.2)\n\nset(INCLUDEDIR \"include/Maths\")\nset(SOURCEDIR \"src\")\n\nset(HEADER_FILES\n    ${INCLUDEDIR}/export.h \n    ${INCLUDEDIR}/SIMDWrapper/Config/SIMDConfig.h)\n\nset(SOURCE_FILES \n    ${SOURCEDIR}/Application.cpp)\n\n\nadd_library(Maths SHARED ${SOURCE_FILES}  ${HEADER_FILES})\ntarget_link_libraries(Maths PUBLIC Core)\ntarget_include_directories(Maths PUBLIC \"include\")\ntarget_compile_options(Maths PRIVATE $&lt;$&lt;BOOL:${MSVC}&gt;:/arch:AVX2&gt;)\ntarget_compile_definitions(Maths PRIVATE MATHS_EXPORT)\n</code></pre>\n\n<p>And my Header File (from Agner Fog's VectorClass <a href=\"https://github.com/darealshinji/vectorclass/blob/master/instrset.h\" rel=\"nofollow noreferrer\"><code>instrset.h</code></a>):</p>\n\n<pre><code>#pragma once\n#if (defined(_M_AMD64) || defined(_M_X64) || defined(__amd64)) &amp;&amp; ! \n    defined(__x86_64__)\n#define __x86_64__ 1\n#endif\n\n\n#ifndef SIMD_INSTR_SET\n#if defined (__AVX2__)\n    #define SIMD_INSTR_SET 8\n#elif defined ( __AVX__ )\n    #define SIMD_INSTR_SET 7\n#elif defined ( __SSE4_2__ )\n    #define SIMD_INSTR_SET 6\n#elif defined ( __SSE4_1__ )\n    #define SIMD_INSTR_SET 5\n#elif defined ( __SSSE3__ )\n    #define SIMD_INSTR_SET 4\n#elif defined ( __SSE3__ )\n    #define SIMD_INSTR_SET 3\n#elif defined ( __SSE2__ ) || defined ( __x86_64__ )\n    #define SIMD_INSTR_SET 2 //this is where the color has changed\n#elif defined ( __SSE__ )\n    #define SIMD_INSTR_SET 1\n#elif defined ( _M_IX86_FP )    \n   #define SIMD_INSTR_SET _M_IX86_FP\n#else\n   #define SIMD_INSTR_SET 0\n#endif // instruction set defines\n#endif // SIMD_INSTR_SET\n</code></pre>\n\n<p>This is what I did.\n<code>__x86_64__</code> is defined, my CPU is i5 Skylake so it should support AVX2.</p>\n\n<p>I've checked if Advanced Vector Extensions 2 option is enabled from Project Configuration Properties, and it is enabled.</p>\n\n<p>Is there something I need to change/add from CMake or Visual Studio to make the AVX2 Macro recognizable? </p>\n"}, {"tags": ["c++", "arrays", "multidimensional-array"], "comments": [{"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 4, "creation_date": 1547049673, "post_id": 54113882, "comment_id": 95060549, "body": "Please note that in c++ <code>main</code> is required to have the return type <code>int</code> even if you never <code>return</code> from it."}, {"owner": {"reputation": 4935, "user_id": 5482465, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/QHF0G.png?s=128&g=1", "display_name": "Money Sets You Free", "link": "https://stackoverflow.com/users/5482465/money-sets-you-free"}, "reply_to_user": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547049795, "post_id": 54113882, "comment_id": 95060623, "body": "@Fran&#231;oisAndrieux : my visual studio does not complain about it. I am using c++17."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 2, "creation_date": 1547049875, "post_id": 54113882, "comment_id": 95060672, "body": "Visual Studio won&#39;t complain about a lot of things. The same is true about all compilers and IDEs. First because the language does not require the compiler to diagnose every kind of error and also because many platforms provide default-on extensions that are not portable as best, and non-compliant at worst. It&#39;s a fact that the forms of <code>main</code> defined by the language all require the return type <code>int</code> in c++. One thing of note about <code>main</code> is that any platform can define any form of <code>main</code> they want, including ones that return <code>void</code> though they are by definition not portable."}], "answers": [{"tags": [], "owner": {"reputation": 7052, "user_id": 3854570, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d7bda3cab79b9bc5570667f8c0e24134?s=128&d=identicon&r=PG&f=1", "display_name": "Nelfeal", "link": "https://stackoverflow.com/users/3854570/nelfeal"}, "is_accepted": false, "score": 5, "last_activity_date": 1547050039, "creation_date": 1547050039, "answer_id": 54114092, "question_id": 54113882, "link": "https://stackoverflow.com/questions/54113882/how-can-i-initialize-2d-array-with-a-list-of-1d-arrays/54114092#54114092", "title": "How can I initialize 2d array with a list of 1d arrays?", "body": "<p>Use <code>std::array</code>.</p>\n\n<pre><code>auto a = std::array{ 1,2,3 };\nauto b = std::array{ 4,5,6 };\nauto array = std::array{ a,b };\n</code></pre>\n\n<p><a href=\"http://coliru.stacked-crooked.com/a/87e6fbd64dccc2c5\" rel=\"noreferrer\">Demo</a></p>\n"}, {"comments": [{"owner": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "edited": false, "score": 0, "creation_date": 1547050252, "post_id": 54114095, "comment_id": 95060909, "body": "It works in this case, but beware the uintuitive things that can (and occasionally have to) happen with this kind of initialization. If you didn&#39;t have <code>foo</code> and <code>bar</code> already, you&#39;d have to write <code>std::array&lt;std::array&lt;int, 3&gt;, 2&gt; array = { 0, 1, 2, 3, 4, 5 };</code>, not <code>... = { { 0, 1, 2 }, { 3, 4, 5 } };</code> (the latter does not compile)!"}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "reply_to_user": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "edited": false, "score": 2, "creation_date": 1547050485, "post_id": 54114095, "comment_id": 95061052, "body": "@MaxLanghof You could also use <code>std::array test = {std::array{1,2,3},std::array{3,4,5}}</code>"}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "reply_to_user": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "edited": false, "score": 1, "creation_date": 1547050687, "post_id": 54114095, "comment_id": 95061176, "body": "unfortunately CTAD doesn&#39;t work (yet hopefully) through a using directive to shorten the name :("}], "tags": [], "owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "is_accepted": true, "score": 14, "last_activity_date": 1564582821, "last_edit_date": 1564582821, "creation_date": 1547050061, "answer_id": 54114095, "question_id": 54113882, "link": "https://stackoverflow.com/questions/54113882/how-can-i-initialize-2d-array-with-a-list-of-1d-arrays/54114095#54114095", "title": "How can I initialize 2d array with a list of 1d arrays?", "body": "<p>raw arrays in C++ are kind of second class citizens. They can't be assigned and they can't be copied, which means you can't use them to initialize other arrays, and their name decays into a pointer in most circumstances.</p>\n\n<p>Lucky C++11 offers a solution.  <code>std::array</code> acts like a raw array, but it doesn't have the drawbacks.  You can use those instead to build a 2d array like</p>\n\n<pre><code>std::array&lt;int, 3&gt; foo = {1,2,3};\nstd::array&lt;int, 3&gt; bar = {3,4,5};\nstd::array&lt;std::array&lt;int, 3&gt;, 2&gt; baz = {foo, bar};\n</code></pre>\n\n<p>and if you have C++17 support you can leverage <a href=\"https://en.cppreference.com/w/cpp/language/class_template_argument_deduction\" rel=\"nofollow noreferrer\">class template argument deduction</a> to get rid of having to specify the template parameters and the code simplifies to</p>\n\n<pre><code>std::array foo = {1,2,3};\nstd::array bar = {3,4,5};\nstd::array baz = {foo, bar};\n</code></pre>\n\n<p>which you can see working in this <a href=\"http://coliru.stacked-crooked.com/a/6e33515a262dca20\" rel=\"nofollow noreferrer\">live example</a></p>\n"}, {"tags": [], "owner": {"reputation": 19667, "user_id": 1312382, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FL8Fg.jpg?s=128&g=1", "display_name": "Aconcagua", "link": "https://stackoverflow.com/users/1312382/aconcagua"}, "is_accepted": false, "score": 5, "last_activity_date": 1547050191, "creation_date": 1547050191, "answer_id": 54114138, "question_id": 54113882, "link": "https://stackoverflow.com/questions/54113882/how-can-i-initialize-2d-array-with-a-list-of-1d-arrays/54114138#54114138", "title": "How can I initialize 2d array with a list of 1d arrays?", "body": "<p>The way you presented - not at all... You can have:</p>\n\n<pre><code>int array[][3] = { { 1, 2, 3 }, { 4, 5, 6 } };\n</code></pre>\n\n<p>If you still need a and b, you could then have these as pointers:</p>\n\n<pre><code>int* a = array[0];\nint* b = array[1];\n</code></pre>\n\n<p>or a bit closer to your original try: References to array:</p>\n\n<pre><code>int(&amp;a)[3] = array[0];\nint(&amp;b)[3] = array[1];\n</code></pre>\n\n<p>This way, you could still e. g. apply <code>sizeof</code> to <code>a</code> and <code>b</code>...</p>\n\n<p>Or the other way round: create an array of pointers</p>\n\n<pre><code>int a[] = { 1,2,3 };\nint b[] = { 4,5,6 };\nint* array[] = { a, b };\n</code></pre>\n\n<p>All these solutions presented so far have in common that both a and array[0] access exactly the same data. If you actually want to have two <em>independent</em> copies instead, then there's no way around copying the data from one into the other, e. g. via <code>std::copy</code>.</p>\n\n<p>If you switch from raw array to <code>std::array</code>, though, you <em>can</em> have this kind of initialisation (with copies) directly:</p>\n\n<pre><code>std::array&lt;int, 3&gt; a;\nstd::array&lt;int, 3&gt; b;\nstd::array&lt;std::array&lt;int, 3&gt; 2&gt; array = { a, b };\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 12180, "user_id": 3150802, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/ulVTa.png?s=128&g=1", "display_name": "Peter - Reinstate Monica", "link": "https://stackoverflow.com/users/3150802/peter-reinstate-monica"}, "is_accepted": false, "score": 3, "last_activity_date": 1547193045, "last_edit_date": 1547193045, "creation_date": 1547052979, "answer_id": 54114972, "question_id": 54113882, "link": "https://stackoverflow.com/questions/54113882/how-can-i-initialize-2d-array-with-a-list-of-1d-arrays/54114972#54114972", "title": "How can I initialize 2d array with a list of 1d arrays?", "body": "<p><code>std::array</code> is the way to go here, but if you want to stick to the means of the language (and not the standard lib), and your combined array has the same life time as its constituents, and if the data can be shared, you can have an array of pointers to arrays and say</p>\n\n<pre><code>int a[] { 1,2,3 };\nint b[] { 4,5,6 };\n\ndecltype(a) *abArr[] {&amp;a, &amp;b};\n// equivalent to \n// int (*abArr[])[3] { &amp;a, &amp;b };\n</code></pre>\n\n<p>Note that this is not a 2-dimensional array, and its elements are not integers.\nBut you can still range-loop through both dimensions because the pointers are true pointers to a fixed-size array (as opposed to pointers to a mere int as a result of array decay, which couldn't be range-looped).</p>\n\n<p>Since the array elements are pointers it is necessary to dereference <code>row</code>:</p>\n\n<pre><code>for (auto const&amp; row : abArr)\n    for (auto const&amp; e : *row)\n        cout &lt;&lt; e &lt;&lt; \" \";\n</code></pre>\n\n<p>Live example: <a href=\"http://coliru.stacked-crooked.com/a/cff8ed0e69ffb436\" rel=\"nofollow noreferrer\">http://coliru.stacked-crooked.com/a/cff8ed0e69ffb436</a></p>\n"}], "owner": {"reputation": 4935, "user_id": 5482465, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/QHF0G.png?s=128&g=1", "display_name": "Money Sets You Free", "link": "https://stackoverflow.com/users/5482465/money-sets-you-free"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 433, "favorite_count": 0, "accepted_answer_id": 54114095, "answer_count": 4, "score": 7, "last_activity_date": 1564582821, "creation_date": 1547049389, "last_edit_date": 1547050933, "question_id": 54113882, "link": "https://stackoverflow.com/questions/54113882/how-can-i-initialize-2d-array-with-a-list-of-1d-arrays", "title": "How can I initialize 2d array with a list of 1d arrays?", "body": "<p>How can I initialize 2d array with a list of 1d arrays?</p>\n\n<pre><code>void main()\n{\n    int a[] = { 1,2,3 };\n    int b[] = { 4,5,6 };\n    int array[][3] = { a,b };\n}\n</code></pre>\n"}, {"tags": ["javascript", "c++", "algorithm", "search"], "answers": [{"comments": [{"owner": {"reputation": 897, "user_id": 894525, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/927cf5d1f6bb1a6ba75fcc548d5e5194?s=128&d=identicon&r=PG", "display_name": "Oleg", "link": "https://stackoverflow.com/users/894525/oleg"}, "edited": false, "score": 0, "creation_date": 1547049761, "post_id": 54113929, "comment_id": 95060606, "body": "I can&#39;t use regular expressions in my case due to performance reasons. The search will be on files up to 15 Mb. And it needs to memory similar search cases."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "reply_to_user": {"reputation": 897, "user_id": 894525, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/927cf5d1f6bb1a6ba75fcc548d5e5194?s=128&d=identicon&r=PG", "display_name": "Oleg", "link": "https://stackoverflow.com/users/894525/oleg"}, "edited": false, "score": 0, "creation_date": 1547049927, "post_id": 54113929, "comment_id": 95060706, "body": "Then write code that removes any redundant whitespace. But you need to distinguish unnecessary whitespace like around <code>=</code> and necessary whitespace after <code>function</code>."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "reply_to_user": {"reputation": 897, "user_id": 894525, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/927cf5d1f6bb1a6ba75fcc548d5e5194?s=128&d=identicon&r=PG", "display_name": "Oleg", "link": "https://stackoverflow.com/users/894525/oleg"}, "edited": false, "score": 0, "creation_date": 1547049993, "post_id": 54113929, "comment_id": 95060755, "body": "Regular expression performance is generally pretty good, have you actually tested it and found it too slow?"}], "tags": [], "owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "is_accepted": false, "score": 1, "last_activity_date": 1547049527, "creation_date": 1547049527, "answer_id": 54113929, "question_id": 54113846, "link": "https://stackoverflow.com/questions/54113846/choose-algorithm-that-will-search-javascript-source-code-and-ignore-whitespaces/54113929#54113929", "title": "Choose algorithm that will search javascript source code and ignore whitespaces", "body": "<p>Use regular expressions with <code>\\s*</code> or <code>\\s+</code> (depending on whether at least one space is needed to separate the token) between each token:</p>\n\n<ol>\n<li><code>\\btest\\s*\\s*3\\b</code></li>\n<li><code>\\bfunction\\s+test\\s*\\(\\s*\\)</code></li>\n</ol>\n"}], "owner": {"reputation": 897, "user_id": 894525, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/927cf5d1f6bb1a6ba75fcc548d5e5194?s=128&d=identicon&r=PG", "display_name": "Oleg", "link": "https://stackoverflow.com/users/894525/oleg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "answer_count": 1, "score": -5, "last_activity_date": 1547049908, "creation_date": 1547049283, "last_edit_date": 1547049908, "question_id": 54113846, "link": "https://stackoverflow.com/questions/54113846/choose-algorithm-that-will-search-javascript-source-code-and-ignore-whitespaces", "title": "Choose algorithm that will search javascript source code and ignore whitespaces", "body": "<p>The search itself will be working on the C++. The general idea is to find a string of code that will ignore whitespaces. For example we have such code:\n</p>\n\n<pre><code>function test(){\n    let test = 3;\n}\n</code></pre>\n\n<p>And all these search patterns will succeed during search in the code above:</p>\n\n<ol>\n<li>\"test       = 3\", \"test=3\", \"test= 3\"</li>\n<li>\"function      test()\", \"function test ( )\"</li>\n</ol>\n\n<p>The performance is the main that I need here.\nPlease advice algorithm that will do the trick.</p>\n"}, {"tags": ["c++", "gdi+"], "comments": [{"owner": {"reputation": 6072, "user_id": 2142950, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bZGrD.png?s=128&g=1", "display_name": "Klaus G&#252;tter", "link": "https://stackoverflow.com/users/2142950/klaus-g%c3%bctter"}, "edited": false, "score": 0, "creation_date": 1547049598, "post_id": 54113721, "comment_id": 95060504, "body": "Hmm, you are scaling a solid color pen - this will not produce any visible effect."}, {"owner": {"reputation": 1, "user_id": 10890676, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c0bba45db9282d673c103730e18ad71?s=128&d=identicon&r=PG&f=1", "display_name": "Alfig", "link": "https://stackoverflow.com/users/10890676/alfig"}, "reply_to_user": {"reputation": 6072, "user_id": 2142950, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bZGrD.png?s=128&g=1", "display_name": "Klaus G&#252;tter", "link": "https://stackoverflow.com/users/2142950/klaus-g%c3%bctter"}, "edited": false, "score": 0, "creation_date": 1547058375, "post_id": 54113721, "comment_id": 95065187, "body": "@KlausG&#252;tter Why is this method not working? How to solve my problem?"}], "owner": {"reputation": 1, "user_id": 10890676, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c0bba45db9282d673c103730e18ad71?s=128&d=identicon&r=PG&f=1", "display_name": "Alfig", "link": "https://stackoverflow.com/users/10890676/alfig"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 47, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1547048863, "creation_date": 1547048863, "question_id": 54113721, "link": "https://stackoverflow.com/questions/54113721/scaletransform-for-local-objects-gdi", "title": "ScaleTransform for Local Objects GDI+", "body": "<p>I want to change the direction of the Y axis only for one object. I create the Pen object and apply the method .ScaleTransform(1, -1). But the line is not inverted (the problem is in the red line).</p>\n\n<pre><code>void OnPaint(HDC hdc, const RECT &amp;rc)\n{\n    Graphics graphics(hdc);\n    graphics.SetPageUnit(UnitPixel);\n    graphics.TranslateTransform(25, 180);\n\n    Pen pen(Color(255, 0, 0, 0), 1.0f);\n    graphics.DrawLine(&amp;pen, -500, 0, 1000, 0);\n\n    pen.SetColor(Color(255, 255, 0, 0));\n    pen.ScaleTransform(1, -1);\n    graphics.DrawLine(&amp;pen, 10, -50, 500, -50);\n}\n</code></pre>\n\n<p>What's wrong?</p>\n"}, {"tags": ["c++", "multidimensional-array"], "comments": [{"owner": {"reputation": 17209, "user_id": 1055118, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/44Trt.jpg?s=128&g=1", "display_name": "doctorlove", "link": "https://stackoverflow.com/users/1055118/doctorlove"}, "edited": false, "score": 0, "creation_date": 1547049548, "post_id": 54113629, "comment_id": 95060466, "body": "I&#39;m not entirely clear what you are asking. Your expected results is just spaces. But you are explicitly stream the array you just put zeros into to out. Do you want numbers or spaces?"}, {"owner": {"reputation": 50917, "user_id": 947836, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a9addee65c2a92be93004ad689a7a415?s=128&d=identicon&r=PG&f=1", "display_name": "jrok", "link": "https://stackoverflow.com/users/947836/jrok"}, "edited": false, "score": 0, "creation_date": 1547049551, "post_id": 54113629, "comment_id": 95060468, "body": "You expect no zeroes in the output, so why do you print them, then?"}, {"owner": {"reputation": 93, "user_id": 10890552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fa2e3eca8dcc6d3de63913bbd53a46e?s=128&d=identicon&r=PG&f=1", "display_name": "alonelycoder", "link": "https://stackoverflow.com/users/10890552/alonelycoder"}, "edited": false, "score": 0, "creation_date": 1547050109, "post_id": 54113629, "comment_id": 95060826, "body": "Just spaces, guys. I just explicitly stream the zeroes because if I didn&#39;t, it would result in a stream of negative numbers in the output."}, {"owner": {"reputation": 50917, "user_id": 947836, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a9addee65c2a92be93004ad689a7a415?s=128&d=identicon&r=PG&f=1", "display_name": "jrok", "link": "https://stackoverflow.com/users/947836/jrok"}, "edited": false, "score": 0, "creation_date": 1547050348, "post_id": 54113629, "comment_id": 95060967, "body": "That&#39;s because you&#39;d be printing uninitialized contents of <code>cityMap</code>. Just print a space instead, for the time being, so you get the grid borders right. You also print one too many space around each <code>#</code>. Is this an exercise, btw?"}, {"owner": {"reputation": 5746, "user_id": 1563833, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f3d7ae271e46eb178e7dd4f2ef760e6f?s=128&d=identicon&r=PG", "display_name": "Wyck", "link": "https://stackoverflow.com/users/1563833/wyck"}, "edited": false, "score": 0, "creation_date": 1547050746, "post_id": 54113629, "comment_id": 95061205, "body": "Did you mean <code>int i = 9; i&gt;=0; i--</code>?  You wrote <code>i &lt;= 0</code> but you likely meant <code>i &gt;= 0</code>.  The loop should continue while <code>i</code> is positive."}, {"owner": {"reputation": 5746, "user_id": 1563833, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f3d7ae271e46eb178e7dd4f2ef760e6f?s=128&d=identicon&r=PG", "display_name": "Wyck", "link": "https://stackoverflow.com/users/1563833/wyck"}, "edited": false, "score": 0, "creation_date": 1547050908, "post_id": 54113629, "comment_id": 95061299, "body": "It&#39;s reasonable to control the loop with one counter <code>i</code> that goes from from 0 to 9, and then compute a second value within the body of the loop that is <code>9 - i</code>.  Which will be a counter that effectively simultaneously counts from 9 to 0."}, {"owner": {"reputation": 17209, "user_id": 1055118, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/44Trt.jpg?s=128&g=1", "display_name": "doctorlove", "link": "https://stackoverflow.com/users/1055118/doctorlove"}, "edited": false, "score": 0, "creation_date": 1547052084, "post_id": 54113629, "comment_id": 95062054, "body": "Now you&#39;ve changed the question my answer looks silly. For clarity, you do care about the stars being in the right place, and now understand how to make the numbers run down?"}, {"owner": {"reputation": 93, "user_id": 10890552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fa2e3eca8dcc6d3de63913bbd53a46e?s=128&d=identicon&r=PG&f=1", "display_name": "alonelycoder", "link": "https://stackoverflow.com/users/10890552/alonelycoder"}, "reply_to_user": {"reputation": 50917, "user_id": 947836, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a9addee65c2a92be93004ad689a7a415?s=128&d=identicon&r=PG&f=1", "display_name": "jrok", "link": "https://stackoverflow.com/users/947836/jrok"}, "edited": false, "score": 0, "creation_date": 1547052737, "post_id": 54113629, "comment_id": 95062436, "body": "@jrok right i got it! thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 17209, "user_id": 1055118, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/44Trt.jpg?s=128&g=1", "display_name": "doctorlove", "link": "https://stackoverflow.com/users/1055118/doctorlove"}, "is_accepted": false, "score": 0, "last_activity_date": 1547050321, "creation_date": 1547050321, "answer_id": 54114174, "question_id": 54113629, "link": "https://stackoverflow.com/questions/54113629/how-to-create-a-2d-array-grid-with-empty-values-and-a-decreasing-numbering-syste/54114174#54114174", "title": "How to create a 2D array grid with empty values and a decreasing numbering system and input values from .txt file?", "body": "<p>Aside from the question of whether you want numbers or spaces, the need for a decreasing number sequence using a number sequence that increases, you have this in the middle:</p>\n\n<pre><code>for (int i = 1; i &lt; 12; i++)\n{\n    cout &lt;&lt; i &lt;&lt; \" \"; //printing out the number at side\n    // other stuff in between using i\n    cout &lt;&lt; endl;\n}\n</code></pre>\n\n<p>giving the numbers 1, 2, 3, .... 11.</p>\n\n<p>Of note, <code>12 - i</code> for each of these gives 11, 10, 9, ... 1.\nThe minus i makes it decrease instead of increase.</p>\n\n<p>(This isn't precisely what you need in the end, because of the edges, which are hinting at by some loops going to 11 and some to 12 in your code).</p>\n\n<pre><code>for (int i = 1; i &lt; 12; i++)\n{\n    cout &lt;&lt; 12 - i &lt;&lt; \" \"; //printing out decreasing numbers at side\n    // other stuff in between using i, which is unchanged\n    cout &lt;&lt; endl;\n}\n</code></pre>\n\n<p>Having 12 twice might make it inflexible - a <code>const</code> number might be worth considering.</p>\n"}], "owner": {"reputation": 93, "user_id": 10890552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fa2e3eca8dcc6d3de63913bbd53a46e?s=128&d=identicon&r=PG&f=1", "display_name": "alonelycoder", "link": "https://stackoverflow.com/users/10890552/alonelycoder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 188, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1547133933, "creation_date": 1547048553, "last_edit_date": 1547089150, "question_id": 54113629, "link": "https://stackoverflow.com/questions/54113629/how-to-create-a-2d-array-grid-with-empty-values-and-a-decreasing-numbering-syste", "title": "How to create a 2D array grid with empty values and a decreasing numbering system and input values from .txt file?", "body": "<p>I have been given a task to code a grid with specifications and insert some data from a sample .txt file inside the multidimensional array.</p>\n\n<p>I am having trouble with creating the grid by itself before putting sample data into it.</p>\n\n<p>For the first row, I use a for loop to print out the first row of hexes.\nAnd the bottom most for loop to print out the last row of hexes. So technically the 2D array in between the first and the last row of hexes are 9 rows by 12 columns 2D array. I've noted that but I just want to see whether it works for now, I will change the values in the <code>for</code> loop later.</p>\n\n<p>And for the last row, i'm not sure how to print out the horizontal 0 - 8 which starts on what is supposed to be below the last row of hexes on the 3rd element to the 11th element.</p>\n\n<p>This grid is supposed to be used to display some information given from a .txt file. I am just testing to see whether I can store the values from the .txt file into the 2D array as shown, then output the values given.</p>\n\n<pre><code>Sample .txt file: \n  [1, 1]-3-Big_City[1, 2]-3-Big_City[1, 3]-3-Big_City[2, 1]-3-Big_City\n  [2, 2]-3-Big_City[2, 3]-3-Big_City[2, 7]-2-Mid_City[2, 8]-2-Mid_City\n  [3, 1]-3-Big_City[3, 2]-3-Big_City[3, 3]-3-Big_City[3, 7]-2-Mid_City\n  [3, 8]-2-Mid_City[7, 7]-1-Small_City\n</code></pre>\n\n<p>The coordinates in the text file represent the X and Y axis that reads from the horizontal axis, then the vertical axis.</p>\n\n<p>The information inside the text file are separated by a delimiter '-'. The [1,1] represents the coordinates of where the value of the '3' (cityID) in the second column while the third column is the city name. But for now, the expected output is just the single digit from each '-' spacing at the coordinates stated in the .txt file.</p>\n\n<p>I know my sample code DOES NOT print anything from the .txt file as of now. Because if I were to print out the string content, it would be everything from the .txt file. I am thinking of using vectors/stringstream and adding a delimiter to ignore the '-'.</p>\n\n<pre><code>ifstream fileName;\nfileName.open(\"citylocation.txt\");\nstring content;\ngetline(fileName, content); //this will read the file line by line\n\nconst int GridX = 12, GridY = 12;\nint cityMap[GridX][GridY];\n\ncout &lt;&lt; \" \";\nfor (int i = 0; i &lt; 12; i++) //printing out the hexes on first row\n    cout &lt;&lt; \" # \";\ncout &lt;&lt; endl;\n\nfor (int i = 1; i &lt;=8; i++)\n{\n    cout &lt;&lt; 8-i &lt;&lt; \" \"; //printing out the number at side\n    for (int j = 1; j &lt; 12; j++)\n    {\n\n        cout &lt;&lt; \"  \";\n    }\n    cout &lt;&lt; endl;\n}\n\ncout &lt;&lt; \" \";\nfor (int i = 0; i &lt; 11; i++) //printing out the hexes on last row\n    cout &lt;&lt; \" # \";\ncout &lt;&lt; endl;\n</code></pre>\n\n<p>Expected Results:</p>\n\n<pre><code>   # # # # # # # # # # #\n 8 #     2 2           #\n 7 #     2 2       1   #\n 6 #                   #\n 5 #                   #\n 4 #                   #\n 3 #   3 3 3           #\n 2 #   3 3 3           #\n 1 #   3 3 3           #\n 0 #                   #\n   # # # # # # # # # # #\n     0 1 2 3 4 5 6 7 8\n</code></pre>\n\n<p>Actual Output : </p>\n\n<pre><code>     #  #  #  #  #  #  #  #  #  #  #  #\n  8\n  7\n  6\n  5\n  4\n  3\n  2\n  1\n  0\n    #  #  #  #  #  #  #  #  #  #  #\n</code></pre>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 261, "user_id": 4470128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2c6b3f8a151398253ec74bc93b409ad?s=128&d=identicon&r=PG&f=1", "display_name": "Hirek", "link": "https://stackoverflow.com/users/4470128/hirek"}, "reply_to_user": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 0, "creation_date": 1547048619, "post_id": 54113602, "comment_id": 95059820, "body": "@MatthieuBrucher how do you mean? SHould I declare anything as static first? Sorry I don&#39;t really understand."}, {"owner": {"reputation": 261, "user_id": 4470128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2c6b3f8a151398253ec74bc93b409ad?s=128&d=identicon&r=PG&f=1", "display_name": "Hirek", "link": "https://stackoverflow.com/users/4470128/hirek"}, "reply_to_user": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 0, "creation_date": 1547048673, "post_id": 54113602, "comment_id": 95059863, "body": "yup fixed that,"}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 1, "creation_date": 1547048766, "post_id": 54113602, "comment_id": 95059924, "body": "While your compiler may not care about whitespace, it makes a big difference in readability. Please make sure code you share here is formated in a consistent way that makes it easy to read. This is not only a show of respect for your fellow users but will improve the odds that users will take the time to read your question making it more likely that you will get useful feedback and answers."}, {"owner": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "edited": false, "score": 0, "creation_date": 1547048884, "post_id": 54113602, "comment_id": 95059996, "body": "Looks like you are trying to simulate local static variable"}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "edited": false, "score": 3, "creation_date": 1547048909, "post_id": 54113602, "comment_id": 95060010, "body": "<code>main</code> can only be run once though."}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "reply_to_user": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "edited": false, "score": 2, "creation_date": 1547049270, "post_id": 54113602, "comment_id": 95060273, "body": "@eerorika agreed, I suppose this function is probably not called <code>main</code> in OP original code."}, {"owner": {"reputation": 261, "user_id": 4470128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2c6b3f8a151398253ec74bc93b409ad?s=128&d=identicon&r=PG&f=1", "display_name": "Hirek", "link": "https://stackoverflow.com/users/4470128/hirek"}, "reply_to_user": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 0, "creation_date": 1547050048, "post_id": 54113602, "comment_id": 95060791, "body": "@MatthieuBrucher so if I declared the instance static I any number of repetitions that the wrapping function is called, the instance remains as it was when first called? Here the &#39;instance&#39; is a random number generator that must be seeded once and then left alone."}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 0, "creation_date": 1547050829, "post_id": 54113602, "comment_id": 95061245, "body": "Yes, that&#39;s exactly what happens. You get the same variable with the previous state from the previous call."}, {"owner": {"reputation": 261, "user_id": 4470128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2c6b3f8a151398253ec74bc93b409ad?s=128&d=identicon&r=PG&f=1", "display_name": "Hirek", "link": "https://stackoverflow.com/users/4470128/hirek"}, "reply_to_user": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 0, "creation_date": 1547051396, "post_id": 54113602, "comment_id": 95061597, "body": "@MatthieuBrucher ah great, I was just reading up on the static keyword and worry about about &#39;all instances&#39; (IBM documentation). DO you think if all this happens inside an instance of yet another, encapsulating class, that the static variable would penetrate across threads? In other words, is static declaration thread-safe i.e. stays on its thread? Won&#39;t pester you anymore with this."}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 0, "creation_date": 1547051509, "post_id": 54113602, "comment_id": 95061676, "body": "static means that it is static accross threads. If you want thread local storage, then you need C++17 and the thread_local keyword on top of static (AFAIK)."}, {"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 1, "creation_date": 1547053484, "post_id": 54113602, "comment_id": 95062883, "body": "From your example, you might directly have <code>mvn my_instance(100);</code> outside of the loop, in <code>main</code> scope."}], "answers": [{"comments": [{"owner": {"reputation": 261, "user_id": 4470128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2c6b3f8a151398253ec74bc93b409ad?s=128&d=identicon&r=PG&f=1", "display_name": "Hirek", "link": "https://stackoverflow.com/users/4470128/hirek"}, "edited": false, "score": 0, "creation_date": 1547048869, "post_id": 54113652, "comment_id": 95059991, "body": "thanks for your answer! But hang on a sec, would that not mean that a method declares its own instance? I will look up singleton pattern for sure."}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "reply_to_user": {"reputation": 261, "user_id": 4470128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2c6b3f8a151398253ec74bc93b409ad?s=128&d=identicon&r=PG&f=1", "display_name": "Hirek", "link": "https://stackoverflow.com/users/4470128/hirek"}, "edited": false, "score": 1, "creation_date": 1547048935, "post_id": 54113652, "comment_id": 95060031, "body": "That just means that this function will reuse an object for all the calls to it. Here, it&#39;s not a method, it&#39;s just a simple function."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "reply_to_user": {"reputation": 261, "user_id": 4470128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2c6b3f8a151398253ec74bc93b409ad?s=128&d=identicon&r=PG&f=1", "display_name": "Hirek", "link": "https://stackoverflow.com/users/4470128/hirek"}, "edited": false, "score": 3, "creation_date": 1547049091, "post_id": 54113652, "comment_id": 95060148, "body": "@Hirek Beware that singleton is often regarded as an anti-pattern. It&#39;s often used in inappropriate ways as a quick fix that leads to trouble down the line. There exists legitimate uses for the pattern but it&#39;s a significantly overused pattern. I assume this is why Matthieu says <i>&quot;Still, not a great design (see &quot;singleton&quot; pattern online).&quot;</i>. This design is essentially an implementation of the singleton pattern and is likely a design decision that merits being reconsidered."}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 1, "creation_date": 1547049213, "post_id": 54113652, "comment_id": 95060236, "body": "Yes, exactly. It&#39;s a dangerous pattern."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 1, "creation_date": 1547052863, "post_id": 54113652, "comment_id": 95062506, "body": "Static variables, global variables and singletons are all equally bad."}, {"owner": {"reputation": 261, "user_id": 4470128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2c6b3f8a151398253ec74bc93b409ad?s=128&d=identicon&r=PG&f=1", "display_name": "Hirek", "link": "https://stackoverflow.com/users/4470128/hirek"}, "reply_to_user": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547076998, "post_id": 54113652, "comment_id": 95072323, "body": "@Fran&#231;oisAndrieux the issue here is that my hands are tied somewhat. The optimiser library I use forces me to inherit from it and I need to call in another header only library (class) that allows me to draw from a multivariate normal. I understand that the code as is looks very contrived. However, in the end thread_local static worked out really well and I think is merited since the calling of this class&#39;s method on each thread is at the heart of what main is trying to achieve."}], "tags": [], "owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "is_accepted": true, "score": 2, "last_activity_date": 1547048649, "creation_date": 1547048649, "answer_id": 54113652, "question_id": 54113602, "link": "https://stackoverflow.com/questions/54113602/how-to-pre-allocate-empty-class-object-which-is-then-created-within-curly-braces/54113652#54113652", "title": "How to pre-allocate empty class object which is then created within curly braces of if statement?", "body": "<p>What you have is a static variable: \"just so the compiler knows 'it's there'\":</p>\n\n<pre><code>int myMethod()\n{\n    static mvn my_instance(100);\n    return my_instance.MyMethod();\n}\n</code></pre>\n\n<p>The second time, the compiler will reuse the existing variable.</p>\n\n<p>Still, not a great design (see \"singleton\" pattern online).</p>\n"}, {"comments": [{"owner": {"reputation": 261, "user_id": 4470128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2c6b3f8a151398253ec74bc93b409ad?s=128&d=identicon&r=PG&f=1", "display_name": "Hirek", "link": "https://stackoverflow.com/users/4470128/hirek"}, "edited": false, "score": 0, "creation_date": 1547050816, "post_id": 54113702, "comment_id": 95061238, "body": "thanks so much @Jarod42 just wondering does it work with arguments as well? Will read up on std::optional!"}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 1, "creation_date": 1547050903, "post_id": 54113702, "comment_id": 95061297, "body": "The issue is persistence of the object across calls, not optionality."}, {"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "reply_to_user": {"reputation": 261, "user_id": 4470128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2c6b3f8a151398253ec74bc93b409ad?s=128&d=identicon&r=PG&f=1", "display_name": "Hirek", "link": "https://stackoverflow.com/users/4470128/hirek"}, "edited": false, "score": 0, "creation_date": 1547053126, "post_id": 54113702, "comment_id": 95062668, "body": "@Hirek: I use <code>100</code> as argument as you."}, {"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "reply_to_user": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 0, "creation_date": 1547053363, "post_id": 54113702, "comment_id": 95062809, "body": "@MatthieuBrucher: persistence needed for OP was unclear, but with his last Edit (usage in a loop), optional might be used (even if it is unclear why OP uses local scope for initialization :/)"}, {"owner": {"reputation": 261, "user_id": 4470128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2c6b3f8a151398253ec74bc93b409ad?s=128&d=identicon&r=PG&f=1", "display_name": "Hirek", "link": "https://stackoverflow.com/users/4470128/hirek"}, "edited": false, "score": 0, "creation_date": 1547055808, "post_id": 54113702, "comment_id": 95064087, "body": "@Jarod42 it&#39;s local because it should be private to the thread, so there is another class wrapping all of this that I use to shield data from commuting across multiple parallel threads. The only alternative I could see is handing my method an instance of this class but I don&#39;t yet know how to pass instances by reference."}, {"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "reply_to_user": {"reputation": 261, "user_id": 4470128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2c6b3f8a151398253ec74bc93b409ad?s=128&d=identicon&r=PG&f=1", "display_name": "Hirek", "link": "https://stackoverflow.com/users/4470128/hirek"}, "edited": false, "score": 0, "creation_date": 1547055922, "post_id": 54113702, "comment_id": 95064136, "body": "@Hirek: <code>std::ref</code> might help, or pass lambda with capture by reference."}], "tags": [], "owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "is_accepted": false, "score": 3, "last_activity_date": 1547048827, "creation_date": 1547048827, "answer_id": 54113702, "question_id": 54113602, "link": "https://stackoverflow.com/questions/54113602/how-to-pre-allocate-empty-class-object-which-is-then-created-within-curly-braces/54113702#54113702", "title": "How to pre-allocate empty class object which is then created within curly braces of if statement?", "body": "<p><code>std::optional</code> is a way to allow future initialization</p>\n\n<pre><code>std::optional&lt;mvn&gt; my_instance;\n\nif (some_condition) {\n   my_instance.emplace(100);\n}\n\n// do more things with the instance\n\nif (my_instance) {\n    my_instance-&gt;MyMethod();\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "edited": false, "score": 1, "creation_date": 1547049033, "post_id": 54113711, "comment_id": 95060101, "body": "What is the point of setting the local <code>firstrun</code> to false when it isn&#39;t read in the function after that?"}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 0, "creation_date": 1547049042, "post_id": 54113711, "comment_id": 95060110, "body": "What would be the point of returning a new instance each time? You are not reusing the object (see OP question)."}, {"owner": {"reputation": 6021, "user_id": 206404, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/497437666710e8b13ee168bd7b62fcba?s=128&d=identicon&r=PG", "display_name": "Stephen Newell", "link": "https://stackoverflow.com/users/206404/stephen-newell"}, "edited": false, "score": 0, "creation_date": 1547049999, "post_id": 54113711, "comment_id": 95060760, "body": "Since the issue is ensuring <code>my_instance</code> exists for later use, this provides a method of guaranteeing that.  If it needs to be reused, the author can preserve the returned instance using whichever means they feel best (including storing it in a <code>static</code>)."}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "edited": false, "score": 2, "creation_date": 1547050492, "post_id": 54113711, "comment_id": 95061059, "body": "This method doesn&#39;t ensure that <code>my_instance</code> exists for later use. It has automatic storage and stops existing at the end of the scope."}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 1, "creation_date": 1547050871, "post_id": 54113711, "comment_id": 95061276, "body": "Exactly, doesn&#39;t guarantee anything."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1547053642, "post_id": 54113711, "comment_id": 95062973, "body": "You have to <code>firstrun</code> variables there, and I&#39;m pretty sure that wasn&#39;t the intent. And then you create the <code>my_instance</code> and don&#39;t use it, returning <code>mvn(0)</code> every time. And even in the fixed form, it&#39;s still a bad idea."}], "tags": [], "owner": {"reputation": 6021, "user_id": 206404, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/497437666710e8b13ee168bd7b62fcba?s=128&d=identicon&r=PG", "display_name": "Stephen Newell", "link": "https://stackoverflow.com/users/206404/stephen-newell"}, "is_accepted": false, "score": -1, "last_activity_date": 1547048841, "creation_date": 1547048841, "answer_id": 54113711, "question_id": 54113602, "link": "https://stackoverflow.com/questions/54113602/how-to-pre-allocate-empty-class-object-which-is-then-created-within-curly-braces/54113711#54113711", "title": "How to pre-allocate empty class object which is then created within curly braces of if statement?", "body": "<p>Move the <code>if</code> into a function that <code>return</code>s a <code>mvn</code> instance.</p>\n\n<pre><code>mvn make_mvn(bool firstrun) {\n    if(firstrun == true)\n    {\n        mvn my_instance(100);\n        firstrun = false;\n    }\n    return mvn(0); // substitute as necessary\n}\n\nint main() {\n    bool firstrun = true;\n    mvn my_instance = make_mvn(firstrun);\n    // do more things with the instance\n    return my_instance.MyMethod();\n}\n</code></pre>\n\n<p>You can change <code>make_mvn</code> as necessary.</p>\n"}, {"comments": [{"owner": {"reputation": 261, "user_id": 4470128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2c6b3f8a151398253ec74bc93b409ad?s=128&d=identicon&r=PG&f=1", "display_name": "Hirek", "link": "https://stackoverflow.com/users/4470128/hirek"}, "edited": false, "score": 0, "creation_date": 1547050217, "post_id": 54114121, "comment_id": 95060890, "body": "THanks! @AndreasT but what if the constructor takes an argument as well? I have edited the question a bit to make the origin clear."}, {"owner": {"reputation": 8169, "user_id": 82673, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d6e08d8fde39d9bd6db46a55bd0e5bd0?s=128&d=identicon&r=PG", "display_name": "AndreasT", "link": "https://stackoverflow.com/users/82673/andreast"}, "reply_to_user": {"reputation": 261, "user_id": 4470128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2c6b3f8a151398253ec74bc93b409ad?s=128&d=identicon&r=PG&f=1", "display_name": "Hirek", "link": "https://stackoverflow.com/users/4470128/hirek"}, "edited": false, "score": 2, "creation_date": 1547052769, "post_id": 54114121, "comment_id": 95062447, "body": "Erm, it doesn&#39;t matter? See the example provided."}, {"owner": {"reputation": 261, "user_id": 4470128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2c6b3f8a151398253ec74bc93b409ad?s=128&d=identicon&r=PG&f=1", "display_name": "Hirek", "link": "https://stackoverflow.com/users/4470128/hirek"}, "edited": false, "score": 0, "creation_date": 1547076806, "post_id": 54114121, "comment_id": 95072273, "body": "thanks again for pointing me to this great utility and I believe this is the right way to solve the problem, as in using tools in their intended way. Unfortunately, i obtain segmentation faults with OpenMP when I parallelize. Should there be additional directives? (Error code is SIGSEGV 11)"}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "reply_to_user": {"reputation": 261, "user_id": 4470128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2c6b3f8a151398253ec74bc93b409ad?s=128&d=identicon&r=PG&f=1", "display_name": "Hirek", "link": "https://stackoverflow.com/users/4470128/hirek"}, "edited": false, "score": 0, "creation_date": 1547118440, "post_id": 54114121, "comment_id": 95085923, "body": "@Hirek How can you parallelise it if the object you&#39;re using is created in one particular iteration? Assuming you use the object in other iterations (this is not shown in your question)"}, {"owner": {"reputation": 8169, "user_id": 82673, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d6e08d8fde39d9bd6db46a55bd0e5bd0?s=128&d=identicon&r=PG", "display_name": "AndreasT", "link": "https://stackoverflow.com/users/82673/andreast"}, "edited": false, "score": 0, "creation_date": 1547166364, "post_id": 54114121, "comment_id": 95109104, "body": "In your question you mentioned nothing of OpenMP or potential race conditions, which is probably what you are running into. I guess you are using one of the #pragma_for constructs of OpenMP. Please put this in a new question. Stringing people along like you have done here is really not in the spirit of this site. Your question has been about variable scoping."}], "tags": [], "owner": {"reputation": 8169, "user_id": 82673, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d6e08d8fde39d9bd6db46a55bd0e5bd0?s=128&d=identicon&r=PG", "display_name": "AndreasT", "link": "https://stackoverflow.com/users/82673/andreast"}, "is_accepted": false, "score": 3, "last_activity_date": 1547051887, "last_edit_date": 1547051887, "creation_date": 1547050148, "answer_id": 54114121, "question_id": 54113602, "link": "https://stackoverflow.com/questions/54113602/how-to-pre-allocate-empty-class-object-which-is-then-created-within-curly-braces/54114121#54114121", "title": "How to pre-allocate empty class object which is then created within curly braces of if statement?", "body": "<p>It may sound a bit old school, but it looks like a classic case of dynamic allocation to me, so a pointer would do the trick. Use <code>std::unique_ptr&lt;mvn&gt;</code> or some of its brethren.</p>\n\n<p><strong>edit:</strong></p>\n\n<p>Ok, to clarify this a bit:</p>\n\n<pre><code>#include&lt;memory&gt;\n\nclass mvn {\npublic:\n    int hello;\n    mvn(int hello_) {\n        hello = hello_;\n    }\n    ~mvn() {};\n    int MyMethod() {\n        return hello;\n    }\n};\n\n\nint main() {\n    bool firstrun = true;\n    std::unique_ptr&lt;mvn&gt; mvn_ptr(nullptr);\n\n    for(int i = 0; i &lt; 100; i++)\n        {\n\n            if (firstrun == true)\n            {\n                mvn_ptr.reset(new mvn(100));\n                firstrun = false;\n            }\n\n        }\n\n    return mvn_ptr-&gt;MyMethod();\n}\n</code></pre>\n\n<p>This compiles and runs.</p>\n\n<pre><code>~/tmp $ g++ fun.cpp -std=c++11\n~/tmp $ ./a.out \n~/tmp $ echo \"$?\"\n100\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": false, "score": 1, "last_activity_date": 1547053782, "last_edit_date": 1547053782, "creation_date": 1547053266, "answer_id": 54115049, "question_id": 54113602, "link": "https://stackoverflow.com/questions/54113602/how-to-pre-allocate-empty-class-object-which-is-then-created-within-curly-braces/54115049#54115049", "title": "How to pre-allocate empty class object which is then created within curly braces of if statement?", "body": "<p>A much simpler approach is to simply make your calculation logic a member function of another class. Then you can make your object a member of that class, and it will be created there as a necessity for the first run.</p>\n\n<pre><code>struct mvn {\n    int hello;\n    mvn(int hello) : hello(hello) { }\n    int MyMethod() { return hello; }\n}\n\nstruct wrapper {\n    mvn m;\n    wrapper(int hello) : m(hello) { }\n    int go() {\n        for (int i = 0; i &lt; 100; ...\n        return m.MyMethod();\n    }\n}\n\nint main() {\n    wrapper w(42);\n    return w.go();\n}\n</code></pre>\n\n<p>That way you don't need to allocate anything dynamically, and you avoid the need for an <code>if</code> altogether.</p>\n\n<p>If you have multiple <code>go()</code> functions or simply want to parametrize, write it as such instead:</p>\n\n<pre><code>template&lt;typename F&gt;\nint wrapper::go(F&amp;&amp; f) {\n    std::forward&lt;F&gt;(f)(m);\n    return m.MyMethod();\n}\n</code></pre>\n\n<p>Where <code>F</code> is any callable taking <code>mvn&amp;</code>, e.g. <code>[](mnv&amp; m) { for (...) m.foo(); }</code>.</p>\n\n<p>And of course every call to <code>go()</code> will use the pre-existing <code>m</code> inside the <code>wrapper</code> object; you just need to share this object around. Calling it from different threads is another matter, and might require sufficient precautions to avoid breaking the state of <code>m</code>.</p>\n"}], "owner": {"reputation": 261, "user_id": 4470128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2c6b3f8a151398253ec74bc93b409ad?s=128&d=identicon&r=PG&f=1", "display_name": "Hirek", "link": "https://stackoverflow.com/users/4470128/hirek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 54113652, "answer_count": 5, "score": 0, "last_activity_date": 1547053782, "creation_date": 1547048475, "last_edit_date": 1547049599, "question_id": 54113602, "link": "https://stackoverflow.com/questions/54113602/how-to-pre-allocate-empty-class-object-which-is-then-created-within-curly-braces", "title": "How to pre-allocate empty class object which is then created within curly braces of if statement?", "body": "<p>How do I avoid the error of the object not being allocated in this scope when using it outside the if statement?</p>\n\n<p>I have tried to declare an empty class but struggled to see how exactly.</p>\n\n<pre><code>class mvn {\npublic:\n    int hello;\n    mvn(int hello_) {\n        hello = hello_;\n    }\n    ~mvn();\n    int MyMethod() {\n        return hello;\n    }\n}\n\n\nint main() {\n    bool firstrun = true;\n    for(int i = 0; i &lt; 100; i++)\n        {\n\n            if (firstrun == true)\n            {\n                mvn my_instance(100);\n                firstrun = false;\n            }\n\n\n            // do more things with the instance which in reality is a wrapper\n            // to random number generation and needs to be created on first run\n\n        }\n\n\n    return my_instance.MyMethod();\n}\n</code></pre>\n\n<p>This would not compile saying that <code>my_instance</code> is declared out of scope, because it is local to the curly braces. </p>\n\n<p>Is there a way to pre-allocate an empty instance so that it can be overwritten if <code>firstrun</code> is true but not thereafter, just so the compiler knows 'it's there'? My real implementation is much more complex than this of course, but this is a MWE.</p>\n\n<p>EDIT: I added another element that i probably should not have abstracted away from. It's the fact that I simply cannot (or should not) create the instance more than once as each recreation is the re-seeding of a random number generator, which should be seeded/created from within (because this happens on multiple threads).</p>\n\n<p>Now one thing I got was that everyone else here knows a lot more than I do. I am not sure which way is the best way to swing this and/or if the 'singleton pattern' is applicable here?</p>\n"}, {"tags": ["python", "c++", "django", "celery", "pybind11"], "comments": [{"owner": {"reputation": 2151, "user_id": 4089452, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/ff06d18979a4020538af1ebecbbea27b?s=128&d=identicon&r=PG&f=1", "display_name": "Alessandro Power", "link": "https://stackoverflow.com/users/4089452/alessandro-power"}, "edited": false, "score": 0, "creation_date": 1547055132, "post_id": 54113572, "comment_id": 95063756, "body": "Just to clarify: is the C++ module your own? Can you modify its source code? Can you compile it from source?"}, {"owner": {"reputation": 384, "user_id": 1723676, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/y8ILT.jpg?s=128&g=1", "display_name": "Ronny", "link": "https://stackoverflow.com/users/1723676/ronny"}, "reply_to_user": {"reputation": 2151, "user_id": 4089452, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/ff06d18979a4020538af1ebecbbea27b?s=128&d=identicon&r=PG&f=1", "display_name": "Alessandro Power", "link": "https://stackoverflow.com/users/4089452/alessandro-power"}, "edited": false, "score": 0, "creation_date": 1547145389, "post_id": 54113572, "comment_id": 95101308, "body": "yes, I can modify the c++ source, but I put the asserts there to catch unexpected errors."}, {"owner": {"reputation": 2151, "user_id": 4089452, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/ff06d18979a4020538af1ebecbbea27b?s=128&d=identicon&r=PG&f=1", "display_name": "Alessandro Power", "link": "https://stackoverflow.com/users/4089452/alessandro-power"}, "edited": false, "score": 0, "creation_date": 1547162520, "post_id": 54113572, "comment_id": 95108152, "body": "The use of assertions should be restricted to debugging. For your production build I would compile with assertions disabled. You may want to throw an <a href=\"https://pybind11.readthedocs.io/en/stable/advanced/exceptions.html\" rel=\"nofollow noreferrer\">exception</a> instead of using an assert, but in general you should save asserts for checking your program&#39;s internal logic and use exceptions to signal the violation of a contract."}, {"owner": {"reputation": 384, "user_id": 1723676, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/y8ILT.jpg?s=128&g=1", "display_name": "Ronny", "link": "https://stackoverflow.com/users/1723676/ronny"}, "reply_to_user": {"reputation": 2151, "user_id": 4089452, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/ff06d18979a4020538af1ebecbbea27b?s=128&d=identicon&r=PG&f=1", "display_name": "Alessandro Power", "link": "https://stackoverflow.com/users/4089452/alessandro-power"}, "edited": false, "score": 0, "creation_date": 1547402682, "post_id": 54113572, "comment_id": 95172266, "body": "Yes, that would make sense, but these assertions are indeed for the internal logic of the program, like writing out of bounds of arrays etc."}, {"owner": {"reputation": 2151, "user_id": 4089452, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/ff06d18979a4020538af1ebecbbea27b?s=128&d=identicon&r=PG&f=1", "display_name": "Alessandro Power", "link": "https://stackoverflow.com/users/4089452/alessandro-power"}, "edited": false, "score": 0, "creation_date": 1547405214, "post_id": 54113572, "comment_id": 95173045, "body": "They should still be enabled. By all means, keep the assertions for unit testing and development builds. But in production, they should be disabled."}, {"owner": {"reputation": 384, "user_id": 1723676, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/y8ILT.jpg?s=128&g=1", "display_name": "Ronny", "link": "https://stackoverflow.com/users/1723676/ronny"}, "reply_to_user": {"reputation": 2151, "user_id": 4089452, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/ff06d18979a4020538af1ebecbbea27b?s=128&d=identicon&r=PG&f=1", "display_name": "Alessandro Power", "link": "https://stackoverflow.com/users/4089452/alessandro-power"}, "edited": false, "score": 0, "creation_date": 1547493018, "post_id": 54113572, "comment_id": 95203500, "body": "Sure but that is beside the problem, I don&#39;t see how that would be different if the program crashes due to a segfault for instance, I still am not able to handle the error"}, {"owner": {"reputation": 2151, "user_id": 4089452, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/ff06d18979a4020538af1ebecbbea27b?s=128&d=identicon&r=PG&f=1", "display_name": "Alessandro Power", "link": "https://stackoverflow.com/users/4089452/alessandro-power"}, "edited": false, "score": 0, "creation_date": 1547500228, "post_id": 54113572, "comment_id": 95206587, "body": "If your code segfaults, you have no choice but to try catch the <code>WorkerLostError</code>. Ditto for failed assertions."}], "owner": {"reputation": 384, "user_id": 1723676, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/y8ILT.jpg?s=128&g=1", "display_name": "Ronny", "link": "https://stackoverflow.com/users/1723676/ronny"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 83, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1547048383, "creation_date": 1547048383, "question_id": 54113572, "link": "https://stackoverflow.com/questions/54113572/how-to-handle-celery-workerlosterror-due-to-c-assertion-in-python-imported-mod", "title": "How to handle Celery WorkerLostError due to c++ assertion in python imported module?", "body": "<p>I have a python module with c++ code using pybind11 that I have imported in my django + celery 3.1.25 app. The c++ code contains assertions that might trigger inside of a celery worker which then leads to the <code>WorkerLostError</code>.</p>\n\n<p>I have tried to put the calls to the python c++ module inside <code>try:</code> <code>except:</code> scopes, however this does not work and the celery worker still crashes.</p>\n\n<p>I have also tried to bind an error callback function using the <code>link_error=</code> argument in my <code>apply_async</code> call to my celery task, however the method never gets called.</p>\n\n<p>Ideally I would like to catch the error somehow so I can display an error message to the user. Any suggestions is appreciated!</p>\n"}, {"tags": ["c++", "dictionary", "struct"], "comments": [{"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1547048564, "post_id": 54113566, "comment_id": 95059777, "body": "It seems that what you&#39;re asking for is assignment, not initialisation."}, {"owner": {"reputation": 14339, "user_id": 1466970, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/V1J6z.jpg?s=128&g=1", "display_name": "Richard Chambers", "link": "https://stackoverflow.com/users/1466970/richard-chambers"}, "edited": false, "score": 4, "creation_date": 1547048655, "post_id": 54113566, "comment_id": 95059853, "body": "I&#39;d actually like to see more source code to better illustrate what you are asking about. This is a bit too terse and broad."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1547059798, "post_id": 54113566, "comment_id": 95065786, "body": "This does seem like a very specific use case - your title even references a specific variable name that&#39;s not likely to be useful in searches. John&#39;s showed the most obvious approach which is just a basic loop - is there something more you need here? I&#39;m not entirely sure whether you&#39;ve encountered a problem or summat."}], "answers": [{"comments": [{"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1547059673, "post_id": 54114491, "comment_id": 95065733, "body": "I&#39;d go further and make those refs <code>const</code>. <code>const auto&amp; key = block.params[i]; const auto&amp; value = block.params[i+1]; block.params.emplace({key, value});</code>"}, {"owner": {"reputation": 13, "user_id": 10572023, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-iBUce6NHWKc/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbB4GuTsjRDBDqILuT_KPsMtdpLbXw/mo/photo.jpg?sz=128", "display_name": "The Robcio", "link": "https://stackoverflow.com/users/10572023/the-robcio"}, "edited": false, "score": 0, "creation_date": 1547062068, "post_id": 54114491, "comment_id": 95066735, "body": "Well the problem there is a little bit more nested as tokens[0] is name, indeed but the rest of tokens are filled in this way: token[1] is a key token[2] = &quot; = &quot; and token [3] is a value, tokens[4] is another key tokens[5] is &quot; = &quot; and tokens[6] is another value and so on and so forth. So would it be a proper solution to implement something like this:  <code>for (std::size_t i = 1; i &lt; tokens.size(); i++){ \tif(tokens[i] == &quot; =&quot;){ \t\tstd::string&amp; key = block.params[i-1]; \t\tstd::string&amp; value = block.params[i+1]; \t\tblock.params.insert(std::pair&lt;std::string, std::string&gt;(key,value)); \t} }</code>"}], "tags": [], "owner": {"reputation": 13, "user_id": 6785129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640112e2fdc4b01b368cdd4a2912831a?s=128&d=identicon&r=PG&f=1", "display_name": "John Fisherman", "link": "https://stackoverflow.com/users/6785129/john-fisherman"}, "is_accepted": false, "score": 1, "last_activity_date": 1547062029, "last_edit_date": 1547062029, "creation_date": 1547051350, "answer_id": 54114491, "question_id": 54113566, "link": "https://stackoverflow.com/questions/54113566/how-to-initialize-a-structure-field-stdmapstdstring-stdstring-called-pa/54114491#54114491", "title": "How to initialize a structure field std::map&lt;std::string, std::string&gt; called params", "body": "<p>I guess your \"tokens\" vector contains the name at index 0 as a special value, and all successive values are the keys/values you want in the \"params\" map.</p>\n\n<p>Worded differently, odd indexes (1, 3, 5, etc.) being keys of the \"params\" map, and even indexes (2, 4, 6, etc.) - except 0 - being values of the \"params\" map.</p>\n\n<p>Assuming your \"tokens\" vector is correct, you can do something like this :</p>\n\n<pre><code>for (int i = 1; i &lt; (tokens.size() - 1); i += 2) {\n    std::string&amp; key = block.params[i];\n    std::string&amp; value = block.params[i + 1];\n    block.params.insert(std::pair&lt;std::string, std::string&gt;(key, value));\n}\n</code></pre>\n\n<p>Using (tokens.size() - 1), as the maximum \"i\" can go up to, ensures to not throw a std::out_of_range exception in case the \"tokens\" vector has a key (on a odd index) but no value (on an even index).</p>\n\n<p>Using std::map::insert() method does insert the new key/value pair <strong>only if the key does not already exist</strong> in the map. Another way to insert a key/value pair in a map <strong>and override the value if the key already exists</strong> is to use the <strong>[] operator</strong> like so :</p>\n\n<pre><code>block.params[key] = value;\n</code></pre>\n\n<p><strong>Additional notes :</strong> </p>\n\n<ol>\n<li>compiler optimization should get rid of the references-creation step, and directly pass \"tokens\" vector values to the std::map::insert() method, avoiding a superfluous overhead by creating useless-but-increasing-readability references.</li>\n</ol>\n"}], "owner": {"reputation": 13, "user_id": 10572023, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-iBUce6NHWKc/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbB4GuTsjRDBDqILuT_KPsMtdpLbXw/mo/photo.jpg?sz=128", "display_name": "The Robcio", "link": "https://stackoverflow.com/users/10572023/the-robcio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547062029, "creation_date": 1547048359, "question_id": 54113566, "link": "https://stackoverflow.com/questions/54113566/how-to-initialize-a-structure-field-stdmapstdstring-stdstring-called-pa", "title": "How to initialize a structure field std::map&lt;std::string, std::string&gt; called params", "body": "<p>I'm trying to initialize a structure using some data being held in a <code>std::vector&lt;tokens&gt;</code> - tokens are simply strings. My struct is:</p>\n\n<pre><code>struct parsedBlock{\nstd::string name;\nstd::map&lt;std::string, std::string&gt; params;\n} \n\nparsedBlock block;\n</code></pre>\n\n<p>tokens[0] is block.name so it's simple to just write <code>block.name = tokens[0]</code>\nBut the question is how to intialize a params field supposing that key is <code>tokens[i]</code> and value is <code>tokens[i+1]</code>. Thanks in advance. Greetings! </p>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 4, "creation_date": 1547048217, "post_id": 54113518, "comment_id": 95059540, "body": "A <code>BFunctor</code> has no member functions, so there is nothing to call with a pointer to a <code>BFunctor</code>. Do you know if <i>every</i> <code>BFunctor</code> has a <code>int operator()(int x, int y)</code>?"}, {"owner": {"reputation": 48100, "user_id": 645551, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/3231cd5016283f6ea5963ab1dfa6e27a?s=128&d=identicon&r=PG", "display_name": "freakish", "link": "https://stackoverflow.com/users/645551/freakish"}, "edited": false, "score": 0, "creation_date": 1547048317, "post_id": 54113518, "comment_id": 95059605, "body": "<code>BFunctor</code> deos not define <code>operator()</code>. Also you need <code>virtual</code> to make it work properly."}, {"owner": {"reputation": 405, "user_id": 4351430, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-R8tfp5tg5So/AAAAAAAAAAI/AAAAAAAADFQ/n6ZA52XYXhQ/photo.jpg?sz=128", "display_name": "Bernardo SOUSA", "link": "https://stackoverflow.com/users/4351430/bernardo-sousa"}, "reply_to_user": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547048366, "post_id": 54113518, "comment_id": 95059644, "body": "Hi, @Fran&#231;oisAndrieux, thanks for the prompt answer. So my base class cannot be empty, right? How can I define it generically, so that the behavior of the functors can be set in the sub-classes?"}, {"owner": {"reputation": 48100, "user_id": 645551, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/3231cd5016283f6ea5963ab1dfa6e27a?s=128&d=identicon&r=PG", "display_name": "freakish", "link": "https://stackoverflow.com/users/645551/freakish"}, "edited": false, "score": 1, "creation_date": 1547048408, "post_id": 54113518, "comment_id": 95059677, "body": "@BernardoSOUSA add <code>virtual int operator()(int, int) = 0;</code> in <code>BFunctor</code>."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547048492, "post_id": 54113518, "comment_id": 95059726, "body": "@BernardoSOUSA Seems you are looking for polymorphism. Luckily for you it&#39;s a feature c++ supports naively. You should read about the <a href=\"https://en.cppreference.com/w/cpp/language/virtual\" rel=\"nofollow noreferrer\"><code>virtual</code></a> keyword."}, {"owner": {"reputation": 405, "user_id": 4351430, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-R8tfp5tg5So/AAAAAAAAAAI/AAAAAAAADFQ/n6ZA52XYXhQ/photo.jpg?sz=128", "display_name": "Bernardo SOUSA", "link": "https://stackoverflow.com/users/4351430/bernardo-sousa"}, "edited": false, "score": 0, "creation_date": 1547048733, "post_id": 54113518, "comment_id": 95059904, "body": "I just added the virtual function to BFunctor, but both the linter and the compiler keep saying the same thing."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1547049022, "post_id": 54113518, "comment_id": 95060092, "body": "Because that was only one of your problems. See the excellent answers below."}], "answers": [{"comments": [{"owner": {"reputation": 405, "user_id": 4351430, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-R8tfp5tg5So/AAAAAAAAAAI/AAAAAAAADFQ/n6ZA52XYXhQ/photo.jpg?sz=128", "display_name": "Bernardo SOUSA", "link": "https://stackoverflow.com/users/4351430/bernardo-sousa"}, "edited": false, "score": 0, "creation_date": 1547060635, "post_id": 54113729, "comment_id": 95066129, "body": "Suppose I did need to implement it myself. Suppose the behavior was slightly different then the one provided by std::sum. How could it be done so that the functor could be called through the map the same way std::sum is called (without de-referencing)? I need to store all sorts of functors on that map, and they all need to be called the same way: ops[&quot;operation_name&quot;](arg1, arg2); In fact, I can&#39;t change the caller."}, {"owner": {"reputation": 34388, "user_id": 2610810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8c6433073e71478e8da278a188e1d15?s=128&d=identicon&r=PG", "display_name": "Caleth", "link": "https://stackoverflow.com/users/2610810/caleth"}, "reply_to_user": {"reputation": 405, "user_id": 4351430, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-R8tfp5tg5So/AAAAAAAAAAI/AAAAAAAADFQ/n6ZA52XYXhQ/photo.jpg?sz=128", "display_name": "Bernardo SOUSA", "link": "https://stackoverflow.com/users/4351430/bernardo-sousa"}, "edited": false, "score": 1, "creation_date": 1547071541, "post_id": 54113729, "comment_id": 95070724, "body": "@BernardoSOUSA a <code>std::function&lt;int(int, int)&gt;</code> can hold any type with an <code>operator()</code> which can take two <code>int</code>s and return an <code>int</code>. Anything like your <code>Add</code> is perfectly fine. You don&#39;t have to inherit anything"}], "tags": [], "owner": {"reputation": 34388, "user_id": 2610810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8c6433073e71478e8da278a188e1d15?s=128&d=identicon&r=PG", "display_name": "Caleth", "link": "https://stackoverflow.com/users/2610810/caleth"}, "is_accepted": true, "score": 7, "last_activity_date": 1547049286, "last_edit_date": 1547049286, "creation_date": 1547048892, "answer_id": 54113729, "question_id": 54113518, "link": "https://stackoverflow.com/questions/54113518/how-to-call-functors-stored-in-a-map/54113729#54113729", "title": "How to call functors stored in a map?", "body": "<p>As noted in the comments, you need to define members in <code>BFunctor</code> that you wish to use, in this case <code>operator()</code></p>\n\n<pre><code>class BFunctor {\n    virtual int operator()(int x, int y) = 0;\n};\n\nclass Add : public BFunctor {\npublic:\n    int operator()(int x, int y) override {\n        return x + y;\n    }\n};\n</code></pre>\n\n<p>You also need to dereference the pointer stored in the map, as a pointer <em>also</em> doesn't have an <code>operator()</code>.</p>\n\n<pre><code>std::map&lt;string, BFunctor*&gt; ops {};\nAdd add;\nops[\"sum\"] = &amp;add;\n\nint x = (*ops[\"sum\"])(3, 5);\n</code></pre>\n\n<p>But you don't need to do this yourself. It <a href=\"https://en.cppreference.com/w/cpp/utility/functional/plus\" rel=\"nofollow noreferrer\">already exists</a> in the <a href=\"https://en.cppreference.com/w/cpp/utility/functional/function\" rel=\"nofollow noreferrer\">standard library</a></p>\n\n<pre><code>#include &lt;functional&gt;\nusing BFunctor = std::function&lt;int(int, int)&gt;;\nusing Add = std::plus&lt;int&gt;;\n\nint main() {\n    std::map&lt;string, BFunctor&gt; ops {};\n    Add add;\n    ops[\"sum\"] = add;\n\n    int x = ops[\"sum\"](3, 5);\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 50917, "user_id": 947836, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a9addee65c2a92be93004ad689a7a415?s=128&d=identicon&r=PG&f=1", "display_name": "jrok", "link": "https://stackoverflow.com/users/947836/jrok"}, "is_accepted": false, "score": 5, "last_activity_date": 1547048942, "creation_date": 1547048942, "answer_id": 54113748, "question_id": 54113518, "link": "https://stackoverflow.com/questions/54113518/how-to-call-functors-stored-in-a-map/54113748#54113748", "title": "How to call functors stored in a map?", "body": "<p>There are several issues.</p>\n\n<p>As already mentioned in the comments, there's no <code>operator()</code> in the base class, so if you want to call through the pointer to it, you'll have to provide one (possibly without implementation) and also make it <code>virtual</code>, so it can dispatch to the correct derived class.</p>\n\n<p>Secondly, you have a pointer to a class, so you can't call through it like you would through pointer-to-a-function - you have to dereference it first:</p>\n\n<pre><code>(*ops[\"sum\"])(3, 5);\n</code></pre>\n\n<p>or, if you want:</p>\n\n<pre><code>ops[\"sum\"]-&gt;operator()(3,5);\n</code></pre>\n\n<p>Full example <a href=\"http://coliru.stacked-crooked.com/a/18a7f2e05eb8de80\" rel=\"noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 405, "user_id": 4351430, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-R8tfp5tg5So/AAAAAAAAAAI/AAAAAAAADFQ/n6ZA52XYXhQ/photo.jpg?sz=128", "display_name": "Bernardo SOUSA", "link": "https://stackoverflow.com/users/4351430/bernardo-sousa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 54113729, "answer_count": 2, "score": 2, "last_activity_date": 1547049286, "creation_date": 1547048133, "question_id": 54113518, "link": "https://stackoverflow.com/questions/54113518/how-to-call-functors-stored-in-a-map", "title": "How to call functors stored in a map?", "body": "<p>I have a base class and a class, that are supposed to be functors, like this:</p>\n\n<pre><code>class BFunctor {};\n\nclass Add : public BFunctor {\npublic:\n    int operator()(int x, int y) {\n        return x + y;\n    }\n};\n</code></pre>\n\n<p>I intend to create several of these sub-classes and store pointers to them in a map called ops, like so:</p>\n\n<pre><code>map&lt;string, BFunctor*&gt; ops {};\nAdd add;\nops[\"sum\"] = &amp;add;\n</code></pre>\n\n<p>However, after doing that, why can't I use the function objects like so:</p>\n\n<pre><code>int x = ops[\"sum\"](3, 5);\n</code></pre>\n\n<p>My linter says \"expression preceding parentheses of apparent call must have (pointer-to-) function type\"</p>\n\n<p>And the compiler says \"error: expression cannot be used as a function\".</p>\n"}, {"tags": ["c++", "types", "iterator", "typename", "iterator-traits"], "comments": [{"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547047787, "post_id": 54113330, "comment_id": 95059283, "body": "I generally use <a href=\"https://en.cppreference.com/w/cpp/types/decay\" rel=\"nofollow noreferrer\"><code>std::decay</code></a> for this. Though, I&#39;m reluctant to post this as an answer because I&#39;m not entirely comfortable with why it seems to fix all of these problems. So it might not be the right solution. You would write <code>const typename std::iterator_traits&lt;std::decay_t&lt;decltype(foo)&gt;&gt;::value_typ&zwnj;&#8203;e bar = 1;</code>."}, {"owner": {"reputation": 34957, "user_id": 2642059, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Jonathan Mee", "link": "https://stackoverflow.com/users/2642059/jonathan-mee"}, "reply_to_user": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547047923, "post_id": 54113330, "comment_id": 95059389, "body": "@Fran&#231;oisAndrieux Yeah, I was hoping I could make this work for either a <code>vector</code> or an array... <code>decay</code> <i>would</i> still work there though... so maybe that&#39;s best?"}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547047995, "post_id": 54113330, "comment_id": 95059435, "body": "@JonathanMee It does work for non-pointer iterator types as well. In my experience it fixes this kind of problem every time and magically works. Though again, the fact that it seems like magic to me leaves me nervous about recommending it."}, {"owner": {"reputation": 10915, "user_id": 5376789, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/6715b3506c7312f63950450070ed8345?s=128&d=identicon&r=PG&f=1", "display_name": "xskxzr", "link": "https://stackoverflow.com/users/5376789/xskxzr"}, "reply_to_user": {"reputation": 26959, "user_id": 1294207, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/Inny3.jpg?s=128&g=1", "display_name": "Fantastic Mr Fox", "link": "https://stackoverflow.com/users/1294207/fantastic-mr-fox"}, "edited": false, "score": 0, "creation_date": 1547088787, "post_id": 54113330, "comment_id": 95074787, "body": "@FantasticMrFox That change is intended to deal with <code>volatile T*</code>. It does not add a specialization for <code>T* const</code>."}], "answers": [{"comments": [{"owner": {"reputation": 480272, "user_id": 1968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd630f72eef3790bfb4ef38d08c7f85?s=128&d=identicon&r=PG", "display_name": "Konrad Rudolph", "link": "https://stackoverflow.com/users/1968/konrad-rudolph"}, "edited": false, "score": 1, "creation_date": 1547048262, "post_id": 54113450, "comment_id": 95059564, "body": "It \u201cfixes\u201d the problem by weakening the type contract of <code>foo</code>. This is hardly a good solution: <code>foo</code> <i>should</i> be declared <code>const</code>. Don\u2019t remove that!"}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "reply_to_user": {"reputation": 480272, "user_id": 1968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd630f72eef3790bfb4ef38d08c7f85?s=128&d=identicon&r=PG", "display_name": "Konrad Rudolph", "link": "https://stackoverflow.com/users/1968/konrad-rudolph"}, "edited": false, "score": 1, "creation_date": 1547048411, "post_id": 54113450, "comment_id": 95059680, "body": "I agree with @KonradRudolph that it would be best to leave <code>foo</code> as <code>const</code>. I feel like it would be better to instead fix the template argument given to <code>iterator_traits</code>."}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "reply_to_user": {"reputation": 480272, "user_id": 1968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd630f72eef3790bfb4ef38d08c7f85?s=128&d=identicon&r=PG", "display_name": "Konrad Rudolph", "link": "https://stackoverflow.com/users/1968/konrad-rudolph"}, "edited": false, "score": 1, "creation_date": 1547048829, "post_id": 54113450, "comment_id": 95059965, "body": "@KonradRudolph I&#39;ve updated the answer but it really depends on what the OP wants to do with it.  You can normally reassign <code>const_iterators</code> from containers so removing the <code>const</code> makes it behave the same."}], "tags": [], "owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "is_accepted": false, "score": 19, "last_activity_date": 1547048570, "last_edit_date": 1547048570, "creation_date": 1547047916, "answer_id": 54113450, "question_id": 54113330, "link": "https://stackoverflow.com/questions/54113330/why-cant-i-get-value-type-from-iterator-traits/54113450#54113450", "title": "Why can&#39;t I get value_type from iterator_traits?", "body": "<p>The issue here is with the line</p>\n\n<pre><code>const auto foo = cbegin(arr);\n</code></pre>\n\n<p><code>cbegin(arr)</code> is going to return a <code>int const *</code> (pointer to const int) so applying <code>const</code> to that with <code>const auto foo</code> means <code>foo</code> is a <code>int const * const</code> (const pointer to const int)</p>\n\n<p><code>std::iterator_traits</code> is only specialized for a <code>T*</code> or <code>T const*</code> so giving it a <code>T* const</code> fails since there is no valid specialization.</p>\n\n<p>You can fix this by removing the constness in the declaration of <code>bar</code> with</p>\n\n<pre><code>const typename std::iterator_traits&lt;std::remove_cv_t&lt;decltype(foo)&gt;&gt;::value_type\n</code></pre>\n\n<p>or you can change <code>foo</code> to</p>\n\n<pre><code>auto foo = std::cbegin(arr);\n</code></pre>\n\n<p>if you are okay with it not being <code>const</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 34957, "user_id": 2642059, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Jonathan Mee", "link": "https://stackoverflow.com/users/2642059/jonathan-mee"}, "edited": false, "score": 0, "creation_date": 1547060343, "post_id": 54113464, "comment_id": 95066000, "body": "It&#39;s worth pointing out <a href=\"https://stackoverflow.com/questions/54113330/why-cant-i-get-value-type-from-iterator-traits/54114989#comment95059225_54113330\">@FantasticMrFox&#39;s comment</a> that the <code>remove_cv_t</code> happens automatically in C++20. So I&#39;d say this is indeed the preferred solution."}], "tags": [], "owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "is_accepted": true, "score": 8, "last_activity_date": 1547048507, "last_edit_date": 1547048507, "creation_date": 1547047954, "answer_id": 54113464, "question_id": 54113330, "link": "https://stackoverflow.com/questions/54113330/why-cant-i-get-value-type-from-iterator-traits/54113464#54113464", "title": "Why can&#39;t I get value_type from iterator_traits?", "body": "<p>Indeed the <code>const</code> is problematic, you do basically:</p>\n\n<pre><code>std::iterator_traits&lt;const int* const&gt;::value_type // incorrect due to the last const\n</code></pre>\n\n<p>You might fix it by changing it to</p>\n\n<pre><code>std::iterator_traits&lt;const int*&gt;::value_type // Correct\n</code></pre>\n\n<p>You might use <code>std::decay</code> or <code>std::remove_cv</code> for that:</p>\n\n<pre><code>const typename std::iterator_traits&lt;std::remove_cv_t&lt;decltype(foo)&gt;&gt;::value_type\n</code></pre>\n\n<p>(or drop <code>const</code> from <code>foo</code> if relevant).</p>\n"}, {"comments": [{"owner": {"reputation": 34957, "user_id": 2642059, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Jonathan Mee", "link": "https://stackoverflow.com/users/2642059/jonathan-mee"}, "edited": false, "score": 0, "creation_date": 1547058306, "post_id": 54114989, "comment_id": 95065157, "body": "I mean <code>next</code> still works on it fine? It&#39;s the same argument against <code>const char* const</code> but in some cases this compiles into more optimized code than a <code>const char*</code>"}, {"owner": {"reputation": 573, "user_id": 7636018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IQbgw.jpg?s=128&g=1", "display_name": "Julien Villemure-Fr&#233;chette", "link": "https://stackoverflow.com/users/7636018/julien-villemure-fr%c3%a9chette"}, "reply_to_user": {"reputation": 34957, "user_id": 2642059, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Jonathan Mee", "link": "https://stackoverflow.com/users/2642059/jonathan-mee"}, "edited": false, "score": 0, "creation_date": 1547067857, "post_id": 54114989, "comment_id": 95069140, "body": "@JonathanMee <code>std::next</code> requires an argument that satisfy <a href=\"https://en.cppreference.com/w/cpp/named_req/InputIterator\" rel=\"nofollow noreferrer\">LegacyInputIterator</a>, which requires the type to be CopyAssignable through the LegacyIterator requirement. An Iterator type is intrinsically not const qualifiable."}, {"owner": {"reputation": 34957, "user_id": 2642059, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Jonathan Mee", "link": "https://stackoverflow.com/users/2642059/jonathan-mee"}, "edited": false, "score": 0, "creation_date": 1547070467, "post_id": 54114989, "comment_id": 95070262, "body": "@JulienVillrmure-Fr&#233;chette I assume from your statement: &quot;An Iterator type is intrinsically not const qualifiable.&quot; That you mean that the only way to modify a constant iterator would be to operate on a copy of it? And that generally the point of an iterator is modification?"}, {"owner": {"reputation": 9542, "user_id": 985296, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/fb867640ddc6aee363d96530573845b0?s=128&d=identicon&r=PG", "display_name": "stefan", "link": "https://stackoverflow.com/users/985296/stefan"}, "edited": false, "score": 0, "creation_date": 1547098555, "post_id": 54114989, "comment_id": 95076754, "body": "Trivial example to a meaningful iterator constant: the end of a range. Though I also don&#39;t see a use-case for const cbegin..."}], "tags": [], "owner": {"reputation": 573, "user_id": 7636018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IQbgw.jpg?s=128&g=1", "display_name": "Julien Villemure-Fr&#233;chette", "link": "https://stackoverflow.com/users/7636018/julien-villemure-fr%c3%a9chette"}, "is_accepted": false, "score": 1, "last_activity_date": 1547053065, "creation_date": 1547053065, "answer_id": 54114989, "question_id": 54113330, "link": "https://stackoverflow.com/questions/54113330/why-cant-i-get-value-type-from-iterator-traits/54114989#54114989", "title": "Why can&#39;t I get value_type from iterator_traits?", "body": "<p>Declaring a const qualified iterator <code>const auto foo = cbegin(arr);</code> is questionable. What use do you have for an iterator on which you cannot apply <code>operator++()</code>? Also, the <strong>Iterator</strong> requirement requires the type <code>int const *const</code> to be <strong>Copy Assignable</strong>; as such, the variable <code>foo</code> does not satisfy the <strong>Iterator</strong> requirement. So strictly speaking, <code>foo</code> is not an <strong>Iterator</strong>.</p>\n"}], "owner": {"reputation": 34957, "user_id": 2642059, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Jonathan Mee", "link": "https://stackoverflow.com/users/2642059/jonathan-mee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 882, "favorite_count": 0, "accepted_answer_id": 54113464, "answer_count": 3, "score": 13, "last_activity_date": 1547085202, "creation_date": 1547047424, "last_edit_date": 1547085202, "question_id": 54113330, "link": "https://stackoverflow.com/questions/54113330/why-cant-i-get-value-type-from-iterator-traits", "title": "Why can&#39;t I get value_type from iterator_traits?", "body": "<p>I'm doing this:</p>\n\n<pre><code>const int arr[] = { 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13 };\nconst auto foo = cbegin(arr);\nconst typename iterator_traits&lt;decltype(foo)&gt;::value_type bar = 1;\n</code></pre>\n\n<p>I would have expected <code>bar</code> to have the type <code>int</code>. But instead I'm getting an error:</p>\n\n<blockquote>\n  <p>error C2039: <code>value_type</code>: is not a member of <code>std::iterator_traits&lt;_Ty *const &gt;</code></p>\n</blockquote>\n\n<p>Is this a problem with the <code>const</code> do I need to strip that or something?</p>\n"}, {"tags": ["c++", "c++11", "type-conversion", "substring"], "comments": [{"owner": {"reputation": 6463, "user_id": 6387170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d425edf9cc20e61c8cc3be162915f06?s=128&d=identicon&r=PG&f=1", "display_name": "UKMonkey", "link": "https://stackoverflow.com/users/6387170/ukmonkey"}, "edited": false, "score": 1, "creation_date": 1547046842, "post_id": 54113125, "comment_id": 95058700, "body": "So when you got out your debugger and stepped through the program, what arguments were you passing to stoi?"}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 3, "creation_date": 1547046844, "post_id": 54113125, "comment_id": 95058701, "body": "Have you checked what <code>startPoint.substr(2,2)</code> yields?"}, {"owner": {"reputation": 7540, "user_id": 4474230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/713c7ce18010e541853962264a719d83?s=128&d=identicon&r=PG&f=1", "display_name": "Jeffrey", "link": "https://stackoverflow.com/users/4474230/jeffrey"}, "edited": false, "score": 0, "creation_date": 1547051011, "post_id": 54113125, "comment_id": 95061353, "body": "You do a single getline(), then check for &quot;START&quot; and then assume the next line will get read somehow. In fact, you need a second getline()"}], "answers": [{"comments": [{"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 1, "creation_date": 1547048153, "post_id": 54113224, "comment_id": 95059514, "body": "My advice would be to post confident answers and eliminate terms like &quot;My guess&quot;. You should post answers if you are confident they are correct and avoid answers that might not be correct. If you need more information you can try posting a comment on the question asking for it."}], "tags": [], "owner": {"reputation": 31, "user_id": 10883665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe6481a1004cb8051599600c0bd3efbd?s=128&d=identicon&r=PG&f=1", "display_name": "M. Hieronymus", "link": "https://stackoverflow.com/users/10883665/m-hieronymus"}, "is_accepted": false, "score": 3, "last_activity_date": 1547050769, "last_edit_date": 1547050769, "creation_date": 1547047035, "answer_id": 54113224, "question_id": 54113125, "link": "https://stackoverflow.com/questions/54113125/c-how-to-convert-substring-to-int/54113224#54113224", "title": "C++ How to convert substring to int", "body": "<p>Change </p>\n\n<pre><code>startX = std::stoi(startPoint.substr(1,1));\nstartY = std::stoi(startPoint.substr(2,2));\n</code></pre>\n\n<p>to</p>\n\n<pre><code>startX = std::stoi(startPoint.substr(0,1));\nstartY = std::stoi(startPoint.substr(2,1));\n</code></pre>\n\n<p>See <a href=\"http://www.cplusplus.com/reference/string/string/substr/\" rel=\"nofollow noreferrer\">http://www.cplusplus.com/reference/string/string/substr/</a></p>\n\n<p><code>substr</code> has two arguments: position and length of the substring.</p>\n\n<p>The same applies for your goal points.</p>\n"}, {"tags": [], "owner": {"reputation": 435402, "user_id": 179910, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8962238339d771f0348967be6f97b1b?s=128&d=identicon&r=PG", "display_name": "Jerry Coffin", "link": "https://stackoverflow.com/users/179910/jerry-coffin"}, "is_accepted": true, "score": 2, "last_activity_date": 1547153119, "last_edit_date": 1547153119, "creation_date": 1547054602, "answer_id": 54115377, "question_id": 54113125, "link": "https://stackoverflow.com/questions/54113125/c-how-to-convert-substring-to-int/54115377#54115377", "title": "C++ How to convert substring to int", "body": "<p>Instead of reading a string, then using <code>substr</code> to pull out the pieces you care about, I'd prefer to specify the expected input format a little more directly. In C, I'd probably have done something like this:</p>\n\n<pre><code>if (fscanf(infile, \"START(%d,%d)\", &amp;startX, &amp;startY) != 2)\n   // error in reading start point\n\nif (fscanf(infile, \"GOAL(%d,%d)\", &amp;goalX, &amp;goalY) != 2)\n    // error reading goal point\n</code></pre>\n\n<p>In C++, at least to me it seems to me like the code we'd really like to write is something on this order:</p>\n\n<pre><code>input &gt;&gt; \"START(\"&gt;&gt; startX &gt;&gt; \",\" &gt;&gt; startY &gt;&gt; \")\\n\";\ninput &gt;&gt; \"GOAL(\"&gt;&gt; goalX &gt;&gt; \",\" &gt;&gt; goalY &gt; \")\\n\";\n</code></pre>\n\n<p>So, at least as I see things, the question is whether (and if so how) we can support that. The answer is yes we can (probably pretty obvious--it would be pretty pointless to do a big build-up, then say \"sorry, but we can't do that\").</p>\n\n<p>To support that, we need an extractor for constant strings. At its simplest, it might look something like this:</p>\n\n<pre><code>template &lt;class charT&gt;\nstd::basic_istream&lt;charT&gt; &amp;operator&gt;&gt;(std::basic_istream&lt;charT&gt; &amp;is, charT const *fmt) {\n    while (*fmt) {\n        if (*fmt != is.peek())\n            is.setstate(std::ios_base::failbit);\n        ++fmt;\n        is.ignore(1);\n    }\n    return is;\n}\n</code></pre>\n\n<p>So, this basically just looks at one character at a time from the input stream, compares it to the current character from the format string. If they match, it just extracts that character from the stream and goes to the next. If they don't match, it sets the fail bit to say the extraction failed.</p>\n\n<p>That has one shortcoming: a stream has a <code>skipws</code> bit, and if it's set, we expect to skip white space before attempting to do anything else. That should probably apply here, so something like <code>infile &gt;&gt; \"ignore\"</code> would match input like \"   ignore\".</p>\n\n<p>To fix that, we could add a little loop something like this:</p>\n\n<pre><code>while (std::isspace(is.peek()))\n    is.ignore(1);\n</code></pre>\n\n<p>...before trying to match the string. That has another shortcoming though: it always uses the current global <code>locale</code>--but a stream can be imbued with its own <code>locale</code>, which should apply to reading from that stream. So, to skip white space properly, we should retrieve the stream's <code>locale</code>, then get the <code>ctype</code> facet from that <code>locale</code>, and use it to decide whether something is white space or not. Unfortunately, the code to do that is a little longer and more complex than anybody probably likes:</p>\n\n<pre><code>template &lt;class charT&gt;\nstd::basic_istream&lt;charT&gt; &amp;operator&gt;&gt;(std::basic_istream&lt;charT&gt; &amp;is, charT const *fmt) {\n    if (fmt == nullptr)\n        return is;\n\n    if (is.flags() &amp; std::ios_base::skipws) {\n        std::locale const &amp;loc = is.getloc();\n        if (std::has_facet&lt;std::ctype&lt;charT&gt;&gt;(loc)) {\n            auto const &amp;ct = std::use_facet&lt;std::ctype&lt;charT&gt;&gt;(loc);\n            while (ct.is(std::ctype_base::blank, is.peek()))\n                is.ignore(1);\n        }\n        else\n            while (std::isspace(is.peek()))\n                is.ignore(1);\n    }\n\n    while (*fmt) {\n        if (*fmt != is.peek())\n            is.setstate(std::ios_base::failbit);\n        ++fmt;\n        is.ignore(1);\n    }\n    return is;\n}\n</code></pre>\n\n<p>At least for the moment, I've written this so it retrieves the stream's <code>locale</code>, and uses its <code>ctype</code> facet if it has one, but if it has a <code>locale</code> with no ctype facet (which is at least theoretically possible) it falls back to using <code>std::isspace</code> to decide whether something is white space. There's probably room for argument that it would be better to just fail at that point, but I'll leave that question for another day.</p>\n\n<p>Once we're done, we can read things like we wanted to though:</p>\n\n<pre><code>int main() { \n    std::istringstream b(\"START(0, 0)\\nGOAL(1,2)\");\n\n    int startX, startY;\n    b &gt;&gt; \"START(\" &gt;&gt; startX &gt;&gt; \",\" &gt;&gt; startY &gt;&gt; \")\";\n    std::cout &lt;&lt; \"start_x: \" &lt;&lt; startX &lt;&lt; \", start_y: \" &lt;&lt; startY &lt;&lt; \"\\n\";\n\n    int goalX, goalY;\n    b &gt;&gt; \"GOAL(\" &gt;&gt; goalX &gt;&gt; \",\" &gt;&gt; goalY &gt;&gt; \")\";\n    std::cout &lt;&lt; \"goal_x: \" &lt;&lt; goalX &lt;&lt; \", goal_y: \" &lt;&lt; goalY &lt;&lt; \"\\n\";\n}\n</code></pre>\n\n<p>Note that the behavior here is still slightly different than <code>scanf</code> and company's. In particular, this will skip white space before the beginning of the format string you specify (if <code>skipws</code> is set), then attempt to match each character in the string you pass literally.</p>\n\n<p>By contrast, <code>scanf</code> and company treat any white space in your format string as a directive to skip a run of all consecutive white space in the input. You can (of course) change this to act like <code>scanf</code> and company if you want--but that behavior seems to surprise quite a few people, so I <em>think</em> it's probably better the way it is.</p>\n"}], "owner": {"reputation": 55, "user_id": 10241087, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72683043d29988a68031588609f830d4?s=128&d=identicon&r=PG&f=1", "display_name": "munjyong", "link": "https://stackoverflow.com/users/10241087/munjyong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2491, "favorite_count": 0, "accepted_answer_id": 54115377, "answer_count": 2, "score": 1, "last_activity_date": 1547153119, "creation_date": 1547046670, "last_edit_date": 1547059531, "question_id": 54113125, "link": "https://stackoverflow.com/questions/54113125/c-how-to-convert-substring-to-int", "title": "C++ How to convert substring to int", "body": "<p>What is printed to the console:</p>\n\n<pre><code>START(0,0)\nGOAL(0,2)\nooox\nxxoo\nooox\n</code></pre>\n\n<p>I want to be able to store the <code>START</code> and <code>GOAL</code> points as integers from a substring since what is printed onto the console are read from an external file.</p>\n\n<p>I am making an application to traverse the 2D grid, where the <code>x</code> represents the blocked paths and <code>o</code> represents unblocked.</p>\n\n<p>I have tried using <code>.substr()</code> to take only the parts of the string containing the coordinate pairs, and <code>std::stoi()</code> to convert the String type into an Int. </p>\n\n<pre><code>void Grid::loadFromFile(const std::string&amp; filename){\n     std::string line, startPoint, goalPoint;\n     std::vector&lt;std::string&gt; grid;\n     int startX, startY, goalX, goalY;\n\n     std::ifstream file(filename);\n\n     if (!file.is_open()) return;\n\n     if (!std::getline(file, line)) return;\n\n     if (line.compare(0, 5, \"START\") != 0) return;\n\n     startPoint = line.substr(6,3);\n\n     startX = std::stoi(startPoint.substr(1,1));\n     startY = std::stoi(startPoint.substr(2,2));\n\n     if (!std::getline(file, line)) return;\n\n     if (line.compare(0, 4, \"GOAL\") != 0) return;\n\n     goalPoint = line.substr(5,3);\n\n     goalX = std::stoi(goalPoint.substr(1,1));\n     goalY = std::stoi(goalPoint.substr(2,2));\n\n     test = line.substr(7,1);\n\n     while (std::getline(file, line)) {\n          grid.push_back(line);\n     }\n\n     file.close();\n\n     std::cout &lt;&lt; \"Start: \" &lt;&lt; startPoint &lt;&lt; \"\\n\";\n     std::cout &lt;&lt; \"Goal: \" &lt;&lt; goalPoint &lt;&lt; \"\\n\";\n     std::cout &lt;&lt; \"Start X: \" &lt;&lt; startX &lt;&lt; \"\\n\";\n     std::cout &lt;&lt; \"Start Y: \" &lt;&lt; startY &lt;&lt; \"\\n\";\n     std::cout &lt;&lt; \"Goal X: \" &lt;&lt; goalX &lt;&lt; \"\\n\";\n     std::cout &lt;&lt; \"Goal Y: \" &lt;&lt; goalY &lt;&lt; std::endl;\n}\n</code></pre>\n\n<p>The expected outcome of the code is to print the correct <code>startX/Y</code> &amp; <code>goalX/Y</code> values.</p>\n\n<p>The results I get:</p>\n\n<pre><code>Start: 0,0\nGoal: 0,2\nStart X: 1\nStart Y: 162010192\nGoal X: 0\nGoal Y: 1543563378\n</code></pre>\n\n<p>I don't know why I get the values that are returned as they are random and make no sense to me as to how I have obtained those values.</p>\n"}, {"tags": ["python", "c++", "opencv", "image-processing", "camera-calibration"], "comments": [{"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1547046517, "post_id": 54112943, "comment_id": 95058499, "body": "Seems you&#39;ve tagged your question with c++ and python, which are you actually asking for? If you are asking for a particular software, those tags are irrelevant and should be replaced with a tag identifying the software you are asking about."}, {"owner": {"reputation": 358, "user_id": 4174701, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/795f8a343604173c510dfc30d2bb64e9?s=128&d=identicon&r=PG&f=1", "display_name": "michelson", "link": "https://stackoverflow.com/users/4174701/michelson"}, "edited": false, "score": 0, "creation_date": 1547046523, "post_id": 54112943, "comment_id": 95058504, "body": "I&#39;d suggest digging into chapter 11. here <a href=\"http://www-cs.ccny.cuny.edu/~wolberg/capstone/opencv/LearningOpenCV.pdf\" rel=\"nofollow noreferrer\">www-cs.ccny.cuny.edu/~wolberg/capstone/opencv/&hellip;</a>"}, {"owner": {"reputation": 9838, "user_id": 1435240, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/esfoN.jpg?s=128&g=1", "display_name": "Francesco Callari", "link": "https://stackoverflow.com/users/1435240/francesco-callari"}, "edited": false, "score": 0, "creation_date": 1547059139, "post_id": 54112943, "comment_id": 95065521, "body": "You need to define your parameters a little more precisely. How close to 90deg? What is your acceptable error? What is the size of the cube? What is the field of view of the cameras. Note that if your required accuracy gets close to a tenth of degree or less you definitely need to start worrying about the mechanical and thermal stability of the setup, and control that as well"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 11022353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dd791cc0ef7179703e6bec0aaa0c3752?s=128&d=identicon&r=PG&f=1", "display_name": "musgani19", "link": "https://stackoverflow.com/users/11022353/musgani19"}, "is_accepted": false, "score": 0, "last_activity_date": 1549486208, "creation_date": 1549486208, "answer_id": 54562355, "question_id": 54112943, "link": "https://stackoverflow.com/questions/54112943/is-there-a-way-to-align-the-view-plane-of-my-camera-parallel-to-the-object-surfa/54562355#54562355", "title": "Is there a way to align the view plane of my camera parallel to the object surface in the scene?", "body": "<p>The pose estimation should be sufficient (why it is stop working in your case??).\nor you may need an alternative calibration, scroll below!</p>\n\n<p>first.\nyou define the intrinsic parameters of both camera.</p>\n\n<p>second.\nyou place chessboards pattern which is a good option since you will get more accurate image points result by detecting the corners. you already know the geometry and distance of those pattern and you define top left corner of the chessboard as origin (0,0,0) like standard opencv (is it?).</p>\n\n<p>third.\nyou use solvePnP to get the pose estimation (rotation and translation). You have to put (and be careful) initial rotation and translation into the solvePnP() as this will determine your whole result.</p>\n\n<p>fourth.\nyou adjust your cameras position into desired 90 degrees. at this point, make sure your cube sides where you put your chessboard is perfectly 90 degrees too. you can have the combination of manual calibration and pose estimation from opencv.</p>\n\n<p>alternatives: (light source callibration)</p>\n\n<p>you can use interferometer concept from optical physics, replace your camera with light source and mark its place carefully. replace cube with prism lense and mark its place carefully. </p>\n\n<p>you can borrow the interferrometer concept and set it in your own term.</p>\n\n<p>once you get what you want, put the camera back and take it as your initial rotation and translation position of step 3 above.</p>\n"}], "owner": {"reputation": 35, "user_id": 7237009, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FP2VO.jpg?s=128&g=1", "display_name": "Zachary Sun", "link": "https://stackoverflow.com/users/7237009/zachary-sun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 388, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1549486208, "creation_date": 1547046028, "last_edit_date": 1547219019, "question_id": 54112943, "link": "https://stackoverflow.com/questions/54112943/is-there-a-way-to-align-the-view-plane-of-my-camera-parallel-to-the-object-surfa", "title": "Is there a way to align the view plane of my camera parallel to the object surface in the scene?", "body": "<p>I'm setting up two cameras in an orthogonal way so that each camera can see one of the adjacent surfaces of the cube put in the middle and the angle between the principle lines of the two cameras is 90 degrees. I'm thinking about pasting two chessboard patterns on each side of the cube being viewed to help the alignment. How should I proceed or are there any other options?</p>\n\n<p>The layout is basically like this:\n<a href=\"https://i.stack.imgur.com/XK2LO.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/XK2LO.png\" alt=\"enter image description here\"></a></p>\n\n<p>The angle between the principle lines need to be very close to 90 degrees, or at least I can quantify the error some how, so I abandoned physical approaches.</p>\n\n<p>Thanks in advance.</p>\n\n<p><strong>Edit:</strong><br>\nThe distance between the center of the cube and the view planes of the two cameras is 400 inches;<br>\nthe focal length of the camera is 0.77 inches;<br>\nthe horizontal view angle of the FOV(field of view) is 0.95 rad;<br>\nthe aspect ratio of the view is 1280x720. </p>\n\n<p>The cube works as a reference object just to setup the cameras. It could be either big or small while I assume a 1m x 1m x 1m cube would be reasonable. </p>\n\n<p>The effect of thermal conditions can be ignored here. </p>\n\n<p>The error I am aiming at is +-1 degree. It seems doing calibrations on the target side gives me less error compared with using something like bubble tube on the camera side. </p>\n\n<p>I've been using pose estimation method with a chessboard (<a href=\"https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_calib3d/py_pose/py_pose.html\" rel=\"nofollow noreferrer\">https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_calib3d/py_pose/py_pose.html</a>). But it stopped working or being no longer accurate when the chessboard surface's normal vector is aligned with the normal vector from the view plane of the camera. </p>\n\n<p>Is there any other proper solutions to the problem explained above?</p>\n"}, {"tags": ["c++", "email"], "comments": [{"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1547046426, "post_id": 54112906, "comment_id": 95058438, "body": "Your question is asking for resources, so is <i>off-topic</i>. And it certainly is operating system specific"}, {"owner": {"reputation": 4299, "user_id": 798346, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/d7e5d155178f095778086f1cf84142ce?s=128&d=identicon&r=PG", "display_name": "Jim Rhodes", "link": "https://stackoverflow.com/users/798346/jim-rhodes"}, "edited": false, "score": 1, "creation_date": 1547046837, "post_id": 54112906, "comment_id": 95058696, "body": "There is &quot;Smtp-Client-for-Qt&quot; on github"}, {"owner": {"reputation": 1101, "user_id": 1021686, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/92d13d0d08ecf4a0e803aa1a361efe48?s=128&d=identicon&r=PG", "display_name": "Houbie", "link": "https://stackoverflow.com/users/1021686/houbie"}, "edited": false, "score": 0, "creation_date": 1547047799, "post_id": 54112906, "comment_id": 95059295, "body": "Where should I post this kind of question? It is quite hard to describe my approach if I have not decided which library to use."}, {"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1547049986, "post_id": 54112906, "comment_id": 95060748, "body": "Your question is <i>extremely</i> operating system specific in practice. So tell us about your OS, what documentation you have read, what library are you using, and ask some better question with an <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}], "answers": [{"comments": [{"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 1, "creation_date": 1547047728, "post_id": 54112994, "comment_id": 95059246, "body": "FWIW I have used vmime in the past and been pleased with the results."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 2, "creation_date": 1547047840, "post_id": 54112994, "comment_id": 95059328, "body": "Although I&#39;m not sure that reading all of C++11 standardese is the best way to discover that C++ doesn&#39;t have email support ;)"}], "tags": [], "owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "is_accepted": false, "score": 0, "last_activity_date": 1547049848, "last_edit_date": 1547049848, "creation_date": 1547046200, "answer_id": 54112994, "question_id": 54112906, "link": "https://stackoverflow.com/questions/54112906/send-mail-from-c-program/54112994#54112994", "title": "Send mail from C++ program", "body": "<p>C++11 does not know about emails (check by reading <a href=\"http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2012/n3337.pdf\" rel=\"nofollow noreferrer\">n3337</a>, or trust me about that).</p>\n\n<p>In practice, email sending could be <a href=\"https://en.wikipedia.org/wiki/Operating_system\" rel=\"nofollow noreferrer\">operating system</a> specific. You should read more about <a href=\"https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol\" rel=\"nofollow noreferrer\">SMTP</a>.</p>\n\n<p>Have you considered using <a href=\"https://www.vmime.org/\" rel=\"nofollow noreferrer\">vmime</a> ? It is a C++ library which might fit your needs (at least on Linux &amp; POSIX systems).</p>\n"}, {"tags": [], "owner": {"reputation": 1444, "user_id": 6534880, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6YTr5.jpg?s=128&g=1", "display_name": "Prodigle", "link": "https://stackoverflow.com/users/6534880/prodigle"}, "is_accepted": false, "score": 2, "last_activity_date": 1547046229, "creation_date": 1547046229, "answer_id": 54113004, "question_id": 54112906, "link": "https://stackoverflow.com/questions/54112906/send-mail-from-c-program/54113004#54113004", "title": "Send mail from C++ program", "body": "<p>It's a complex enough task that a library is the best call. libquickmail is a good call for something as simple as your use case. Curl also supports SMTP if you're familiar with that</p>\n"}], "owner": {"reputation": 1101, "user_id": 1021686, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/92d13d0d08ecf4a0e803aa1a361efe48?s=128&d=identicon&r=PG", "display_name": "Houbie", "link": "https://stackoverflow.com/users/1021686/houbie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 703, "favorite_count": 0, "closed_date": 1547047228, "answer_count": 2, "score": -1, "last_activity_date": 1547049848, "creation_date": 1547045879, "last_edit_date": 1547047400, "question_id": 54112906, "link": "https://stackoverflow.com/questions/54112906/send-mail-from-c-program", "closed_reason": "Not suitable for this site", "title": "Send mail from C++ program", "body": "<p>I am looking for the best way to send a mail from a C++ program.\nI tried to look online to find some good solutions, but I could not find anything which satisfies my needs.</p>\n\n<ul>\n<li>Should use SMTP</li>\n<li>Should be able to send plaintext and html</li>\n<li>I should be able to include attachments</li>\n<li>Would be able to run on a windows system</li>\n</ul>\n\n<p>I found this online: \n<a href=\"https://stackoverflow.com/questions/7298762/send-email-with-c\">Send Email with C++</a>\nBut this does not seem to offer a good and complete approach.</p>\n\n<p>I would prefer the most \"standard\" way. But if the only thing which can be done is a custom library, this is also an option. I am specifically looking for a way to do this in Qt or with Boost ASIO?</p>\n\n<p><strong><em>Edit</em></strong>\nThis is what i have found in the meantime: \n<a href=\"https://forum.qt.io/topic/29280/simple-tls-ssl-supported-smtp-client-for-qt5/23\" rel=\"nofollow noreferrer\">https://forum.qt.io/topic/29280/simple-tls-ssl-supported-smtp-client-for-qt5/23</a>\n<a href=\"https://github.com/xcoder123/SimpleSmtp_SSL_QT5\" rel=\"nofollow noreferrer\">https://github.com/xcoder123/SimpleSmtp_SSL_QT5</a></p>\n\n<p>Seems a good fit for my issue, but i would need to take a look.</p>\n\n<p>Thanks a lot for your time,\nSimon</p>\n"}, {"tags": ["c++", "sfml"], "comments": [{"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1547045657, "post_id": 54112745, "comment_id": 95057921, "body": "Check the difference between the current time and the last time the rectangle was moved. Using the <a href=\"https://en.cppreference.com/w/cpp/chrono\" rel=\"nofollow noreferrer\">standard C++ chrono library</a> it&#39;s very easy."}, {"owner": {"reputation": 1, "user_id": 10890197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d33f20954bc547274cd8782dd36727e9?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.JOEJOE", "link": "https://stackoverflow.com/users/10890197/mr-joejoe"}, "reply_to_user": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1547046367, "post_id": 54112745, "comment_id": 95058405, "body": "Nice one. I guess it&#39;s easier. For any chance could you give me an example? Like what is the statement that preceeds the rectanlge.move line if I want it to move every 10 seconds. I don&#39;t want to check the current and last time, I want to move it every 10 seconds. Meaning, while the (window.isOpen()) is running, so every 10 seconds the compiler tells to rectangle.move to move."}, {"owner": {"reputation": 1158, "user_id": 4956078, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44600007f35ab98b7badbf1110df0687?s=128&d=identicon&r=PG&f=1", "display_name": "JMAA", "link": "https://stackoverflow.com/users/4956078/jmaa"}, "edited": false, "score": 2, "creation_date": 1547048359, "post_id": 54112745, "comment_id": 95059637, "body": "You simply need to keep a variable that records the last time it was moved. Each loop, get the current time and compare it with the time you recorded, if it&#39;s more than 10 seconds then move it and record the new &quot;last moved&quot; time. Repeat. You&#39;ll learn much more reading the chrono library docs to find how to to do this than if somebody just codes it for you."}, {"owner": {"reputation": 1, "user_id": 10890197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d33f20954bc547274cd8782dd36727e9?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.JOEJOE", "link": "https://stackoverflow.com/users/10890197/mr-joejoe"}, "edited": false, "score": 0, "creation_date": 1547129076, "post_id": 54112745, "comment_id": 95091833, "body": "Right. I would learn much more. Still, I am not sure how it works."}, {"owner": {"reputation": 60876, "user_id": 2060725, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/WUKmO.png?s=128&g=1", "display_name": "nvoigt", "link": "https://stackoverflow.com/users/2060725/nvoigt"}, "edited": false, "score": 0, "creation_date": 1547218191, "post_id": 54112745, "comment_id": 95128587, "body": "You commands will &quot;teleport&quot; your object by 50 pixels every 10 seconds. Don&#39;t you want ti to smoothly move a distance of 50 pixels over 10 seconds? So it&#39;s at 5 pixels after a second, at 10 after 2 seconds and so on?"}], "answers": [{"tags": [], "owner": {"reputation": 689, "user_id": 9185797, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HJqOX.jpg?s=128&g=1", "display_name": "Phins", "link": "https://stackoverflow.com/users/9185797/phins"}, "is_accepted": false, "score": 0, "last_activity_date": 1547580903, "creation_date": 1547580903, "answer_id": 54205710, "question_id": 54112745, "link": "https://stackoverflow.com/questions/54112745/move-object-every-few-seconds/54205710#54205710", "title": "Move Object Every few Seconds", "body": "<p><strong>SFML</strong> does provide two classes for this purpose, <a href=\"https://www.sfml-dev.org/documentation/2.5.0/classsf_1_1Time.php\" rel=\"nofollow noreferrer\">Time</a> and <a href=\"https://www.sfml-dev.org/documentation/2.5.1/classsf_1_1Clock.php\" rel=\"nofollow noreferrer\">Clock</a>. These can be used like the following.</p>\n\n<pre><code>sf::Clock clock;\nsf::Time time;\n\ntime = clock.restart();\n// wait some time\nsf::Time ellapsed = clock.restart() - time;\nsf::Int32 ellapsedMiliseconds = ellapsed.asMiliseconds();\n</code></pre>\n\n<p><strong>More information for time <a href=\"https://www.sfml-dev.org/tutorials/2.5/system-time.php\" rel=\"nofollow noreferrer\">here</a></strong></p>\n"}], "owner": {"reputation": 1, "user_id": 10890197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d33f20954bc547274cd8782dd36727e9?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.JOEJOE", "link": "https://stackoverflow.com/users/10890197/mr-joejoe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 133, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547580903, "creation_date": 1547045328, "last_edit_date": 1547047808, "question_id": 54112745, "link": "https://stackoverflow.com/questions/54112745/move-object-every-few-seconds", "title": "Move Object Every few Seconds", "body": "<p>My question is how can I move an object every few seconds while another objects can be moved independently when I press the keyboard.</p>\n\n<p>So for example:</p>\n\n<pre><code>while (window.isOpen())\n{\nsf::Event event;\n    while (window.pollEvent(event))\n    {\n        switch (event.type)\n        {\n        case  sf::Event::Closed: \n            window.close(); \n            break;\n\n        case sf::Event::KeyPressed: \n            m_mo[0]-&gt;move(0.f, 50.f); //move when keyboard is pressed\n            break;\n        }\n    }\n    m_mo[1]-&gt;move(0.f, 50.f); //move every 10 seconds\n\n    window.clear();\n    window.draw(m_mo[0]);\n    window.draw(m-mo[1]);\n    window.display();\n    }\n</code></pre>\n\n<p>Anyone who got a time to give me an example please!</p>\n"}, {"tags": ["python", "c++", "numpy", "cython", "gil"], "comments": [{"owner": {"reputation": 26689, "user_id": 5769463, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/71a28b5fac23ee656a32cc7ea6df54ec?s=128&d=identicon&r=PG&f=1", "display_name": "ead", "link": "https://stackoverflow.com/users/5769463/ead"}, "edited": false, "score": 1, "creation_date": 1547045478, "post_id": 54112489, "comment_id": 95057780, "body": "Please take a look at <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. &quot;Minimal&quot; is a quite important part!"}, {"owner": {"reputation": 23048, "user_id": 4657412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4915a27d01efa79d81d322511ee517a9?s=128&d=identicon&r=PG&f=1", "display_name": "DavidW", "link": "https://stackoverflow.com/users/4657412/davidw"}, "edited": false, "score": 0, "creation_date": 1547045512, "post_id": 54112489, "comment_id": 95057806, "body": "You&#39;re trying to call a Python function (np.argpartition) in a nogil block. Although the first message you get is about assigning variables I don&#39;t think this is the fundamental problem. I&#39;m pretty sure this is never going to work."}, {"owner": {"reputation": 61, "user_id": 6777626, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/22sAE.jpg?s=128&g=1", "display_name": "Nikolay", "link": "https://stackoverflow.com/users/6777626/nikolay"}, "reply_to_user": {"reputation": 26689, "user_id": 5769463, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/71a28b5fac23ee656a32cc7ea6df54ec?s=128&d=identicon&r=PG&f=1", "display_name": "ead", "link": "https://stackoverflow.com/users/5769463/ead"}, "edited": false, "score": 0, "creation_date": 1547049351, "post_id": 54112489, "comment_id": 95060332, "body": "@ead edited question to be more compact and reproducible."}, {"owner": {"reputation": 61, "user_id": 6777626, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/22sAE.jpg?s=128&g=1", "display_name": "Nikolay", "link": "https://stackoverflow.com/users/6777626/nikolay"}, "reply_to_user": {"reputation": 23048, "user_id": 4657412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4915a27d01efa79d81d322511ee517a9?s=128&d=identicon&r=PG&f=1", "display_name": "DavidW", "link": "https://stackoverflow.com/users/4657412/davidw"}, "edited": false, "score": 0, "creation_date": 1547049567, "post_id": 54112489, "comment_id": 95060479, "body": "@DavidW you are right, there is a list of <a href=\"https://gist.githubusercontent.com/H0bbitBaron/df91614c5b129e5dd92ae009fc30069d/raw/0e20079170f023b45bc4070b3b35fa932d35945c/error.txt\" rel=\"nofollow noreferrer\">errors</a>, especially np.argpartition results in &quot;Calling gil-requiring function not allowed without gil&quot;. I wonder is there alternative with no gil, may be in numpy C-API?"}, {"owner": {"reputation": 23048, "user_id": 4657412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4915a27d01efa79d81d322511ee517a9?s=128&d=identicon&r=PG&f=1", "display_name": "DavidW", "link": "https://stackoverflow.com/users/4657412/davidw"}, "edited": false, "score": 1, "creation_date": 1547055858, "post_id": 54112489, "comment_id": 95064109, "body": "I think <code>np.argpartition</code> should be able to release the GIL internally, and thus if you put it inside a <code>with gil:</code> block then it should probably still manage to run multithreaded some of the of time. The trouble is that it doesn&#39;t really look like much of your code can run without the GIL, which may make it unsuitable for easy parallelization. You&#39;d have to reimplement <code>argpartition</code> and <code>argsort</code> and possibly some indexing functions..."}], "answers": [{"tags": [], "owner": {"reputation": 61, "user_id": 6777626, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/22sAE.jpg?s=128&g=1", "display_name": "Nikolay", "link": "https://stackoverflow.com/users/6777626/nikolay"}, "is_accepted": true, "score": 1, "last_activity_date": 1547629741, "creation_date": 1547629741, "answer_id": 54213598, "question_id": 54112489, "link": "https://stackoverflow.com/questions/54112489/how-to-assign-numpy-ndarray-to-temporary-variable-under-nogil-loop-in-cython/54213598#54213598", "title": "How to assign numpy.ndarray to temporary variable under nogil loop in cython?", "body": "<p>I ended up with custom C++ function, that fills numpy array in parallel with nogil via openmp. It required rewriting numpy's argpartition partial sorting with cython. Algorythm is like this (3-4 can be looped):</p>\n\n<ol>\n<li>define empty array A[i,j] and <a href=\"https://cython.readthedocs.io/en/latest/src/userguide/memoryviews.html\" rel=\"nofollow noreferrer\">memory view</a> B_mv[i,k]; where \"i\" is batch size, \"j\" some columns and \"k\" number of desired items to be returned after sorting</li>\n<li>create pointers on A&amp;B's memory</li>\n<li>run some calculations and fill A with data</li>\n<li>iterate in parallel over i-s and fill B</li>\n<li>transform result into readable form</li>\n</ol>\n\n<p>Solution consists of:</p>\n\n<p>topnc.h - header of custom function implementation:</p>\n\n<pre><code>/* \"Copyright [2019] &lt;Tych0n&gt;\"  [legal/copyright] */\n#ifndef IMPLICIT_TOPNC_H_\n#define IMPLICIT_TOPNC_H_\n\nextern void fargsort_c(float A[], int n_row, int m_row, int m_cols, int ktop, int B[]);\n\n#endif  // IMPLICIT_TOPNC_H_\n</code></pre>\n\n<p>topnc.cpp - body of the function:</p>\n\n<pre><code>#include &lt;vector&gt;\n#include &lt;limits&gt;\n#include &lt;algorithm&gt;\n#include &lt;iostream&gt;\n\n#include \"topnc.h\"\n\nstruct target {int index; float value;};\nbool targets_compare(target t_i, target t_j) { return (t_i.value &gt; t_j.value); }\n\nvoid fargsort_c ( float A[], int n_row, int m_row, int m_cols, int ktop, int B[] ) {\n    std::vector&lt;target&gt; targets;\n    for ( int j = 0; j &lt; m_cols; j++ ) {\n        target c;\n        c.index = j;\n        c.value = A[(n_row*m_cols) + j];\n        targets.push_back(c);\n    }\n    std::partial_sort( targets.begin(), targets.begin() + ktop, targets.end(), targets_compare );\n    std::sort( targets.begin(), targets.begin() + ktop, targets_compare );\n    for ( int j = 0; j &lt; ktop; j++ ) {\n        B[(m_row*ktop) + j] = targets[j].index;\n    }\n}\n</code></pre>\n\n<p>ctools.pyx - example usage</p>\n\n<pre><code># distutils: language = c++\n# cython: language_level=3\n# cython: boundscheck=False\n# cython: wraparound=False\n# cython: nonecheck=False\nfrom cython.parallel import parallel, prange\nimport numpy as np\ncimport numpy as np\n\ncdef extern from \"topnc.h\":\n    cdef void fargsort_c ( float A[], int n_row, int m_row, int m_cols, int ktop, int B[] ) nogil\n\nA = np.zeros((1000, 100), dtype=np.float32)\nA[:] = np.random.rand(1000, 100).astype(np.float32)\ncdef:\n    float[:,::1] A_mv = A\n    float* A_mv_p = &amp;A_mv[0,0]\n    int[:,::1] B_mv = np.zeros((1000, 5), dtype=np.intc)\n    int* B_mv_p = &amp;B_mv[0,0]\n    int i\nfor i in prange(1000, nogil=True, num_threads=10, schedule='dynamic'):\n    fargsort_c(A_mv_p, i, i, 100, 5, B_mv_p)\nB = np.asarray(B_mv)\n</code></pre>\n\n<p>compile.py - compile file; run it by command \"python compile.py build_ext --inplace -f\" in terminal (this will result in file ctools.cpython-*.so, which you then use for import):</p>\n\n<pre><code>from os import path\nimport numpy\nfrom setuptools import setup, Extension\nfrom Cython.Distutils import build_ext\nfrom Cython.Build import cythonize\n\next_utils = Extension(\n    'ctools'\n    , sources=['ctools.pyx', 'topnc.cpp']\n    , include_dirs=[numpy.get_include()]\n    , extra_compile_args=['-std=c++0x', '-Os', '-fopenmp']\n    , extra_link_args=['-fopenmp']\n    , language='c++'\n)\n\nsetup(\n    name='ctools',\n    setup_requires=[\n        'setuptools&gt;=18.0'\n        , 'cython'\n        , 'numpy'\n    ]\n    , cmdclass={'build_ext': build_ext}\n    , ext_modules=cythonize([ext_utils]),\n)\n</code></pre>\n\n<p>It was used for <a href=\"https://github.com/benfred/implicit/pull/179\" rel=\"nofollow noreferrer\">adding</a> \"recommend all\" functionality into <a href=\"https://implicit.readthedocs.io/en/latest/\" rel=\"nofollow noreferrer\">implicit</a> ALS model.</p>\n"}], "owner": {"reputation": 61, "user_id": 6777626, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/22sAE.jpg?s=128&g=1", "display_name": "Nikolay", "link": "https://stackoverflow.com/users/6777626/nikolay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 501, "favorite_count": 0, "accepted_answer_id": 54213598, "answer_count": 1, "score": 0, "last_activity_date": 1547630189, "creation_date": 1547044573, "last_edit_date": 1547630189, "question_id": 54112489, "link": "https://stackoverflow.com/questions/54112489/how-to-assign-numpy-ndarray-to-temporary-variable-under-nogil-loop-in-cython", "title": "How to assign numpy.ndarray to temporary variable under nogil loop in cython?", "body": "<p>I'm trying to implement <a href=\"https://github.com/benfred/implicit\" rel=\"nofollow noreferrer\">implicit</a> recommender model and have issues with code run time calculating top 5 suggestions to ~11kk users over ~100k items.</p>\n\n<p>I was able to partly solve the problem by numpy with some cython sparkles (in jupyter notebook). Lines with numpy sorting are still using single core:</p>\n\n<pre><code>%%cython -f\n# cython: language_level=3\n# cython: boundscheck=False\n# cython: wraparound=False\n# cython: linetrace=True\n# cython: binding=True\n# distutils: define_macros=CYTHON_TRACE_NOGIL=1\nfrom cython.parallel import parallel, prange\nimport numpy as np\nfrom tqdm import tqdm\n\ndef test(users_items=np.random.rand(11402139//1000, 134751//100)\n        , int N=5, show_progress=True, int num_threads=1):\n    # Define User count and loops indexes\n    cdef int users_c = users_items.shape[0], u, i\n    # Predefine zero 2-D C-ordered array for recommendations\n    cdef int[:,::1] users_recs = np.zeros((users_c, N), dtype=np.intc)\n    for u in tqdm(range(users_c), total=users_c, disable=not show_progress):\n        # numpy .dot multiplication using multiple cores\n        scores = np.random.rand(134751//1000, 10).dot(np.random.rand(10))\n        # numpy partial sort\n        ids_partial = np.argpartition(scores, -N)[-N:]\n        ids_top = ids_partial[np.argsort(scores[ids_partial])]\n        # Fill predefined 2-D array\n        for i in range(N):\n            users_recs[u, i] = ids_top[i]\n    return np.asarray(users_recs)\n# Working example\ntmp = test()\n</code></pre>\n\n<p>I profiled it - np.argpartition consumes 60% of function time and uses onde core. I'm trying to make it parallel, cause I have a server with 80 cores. So, I perform .dot operation on a subset of users (uses multiple cores) and plan to fill empty predefined array by numpy sorting results (which use single core) in parallel, but I'm stuck with error from question title:</p>\n\n<pre><code>%%cython -f\n# cython: language_level=3\n# cython: boundscheck=False\n# cython: wraparound=False\n# cython: linetrace=True\n# cython: binding=True\n# distutils: define_macros=CYTHON_TRACE_NOGIL=1\nfrom cython.parallel import parallel, prange\nimport numpy as np\nfrom tqdm import tqdm\nfrom math import ceil\ndef test(int N=10, show_progress=True, int num_threads=1):\n    # Define User and Item count and loops indexes\n    cdef int users_c = 11402139//1000, items_c = 134751//100, u, i, u_b\n    # Predefine zero 2-D C-ordered array for recommendations\n    cdef int[:,::1] users_recs = np.zeros((users_c, N), dtype=np.intc)\n    # Define memoryview var\n    cdef float[:,::1] users_items_scores_mv\n    progress = tqdm(total=users_c, disable=not show_progress)\n    # For a batch of Users\n    for u_b in range(5):\n        # Use .dot operation which use multiple cores\n        users_items_scores = np.random.rand(num_threads, 10).dot(np.random.rand(134751//100, 10).T)\n        # Create memory view to 2-D array, which I'm trying to sort row wise\n        users_items_scores_mv = users_items_scores\n        # Here it starts, try to use numpy sorting in parallel\n        for u in prange(num_threads, nogil=True, num_threads=num_threads):\n            ids_partial = np.argpartition(users_items_scores_mv[u], items_c-N)[items_c-N:]\n            ids_top = ids_partial[np.argsort(users_items_scores_mv[u][ids_partial])]\n            # Fill predefined 2-D array\n            for i in range(N):\n                users_recs[u_b + u, i] = ids_top[i]\n        progress.update(num_threads)\n    progress.close()\n    return np.asarray(users_recs)\n</code></pre>\n\n<p>and got this (<a href=\"https://gist.githubusercontent.com/H0bbitBaron/df91614c5b129e5dd92ae009fc30069d/raw/0e20079170f023b45bc4070b3b35fa932d35945c/error.txt\" rel=\"nofollow noreferrer\">full error</a>):</p>\n\n<pre><code>Error compiling Cython file:\n------------------------------------------------------------\n...\n        # Create memory view to 2-D array,\n        # which I'm trying to sort row wise\n        users_items_scores_mv = users_items_scores\n        # Here it starts, try to use numpy sorting in parallel\n        for u in prange(num_threads, nogil=True, num_threads=num_threads):\n            ids_partial = np.argpartition(users_items_scores_mv[u], items_c-N)[items_c-N:]\n           ^\n------------------------------------------------------------\n\n/datascc/enn/.cache/ipython/cython/_cython_magic_201b296cd5a34240b4c0c6ed3e58de7c.pyx:31:12: Assignment of Python object not allowed without gil\n</code></pre>\n\n<p>I read about memory views and malloc-ating but haven't found example applicable to my situation.</p>\n"}, {"tags": ["c++", "c", "visual-c++"], "comments": [{"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 1, "creation_date": 1547044530, "post_id": 54112438, "comment_id": 95057133, "body": "I would remove the <code>typedef U8 BOOL</code> definition. The <code>#ifndef</code> macro doesn&#39;t protect against typedef."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 5, "creation_date": 1547044618, "post_id": 54112438, "comment_id": 95057196, "body": "As a newbie in <i>both</i> C and C++, you should take to take to heart right now an important lesson: C and C++ are <b><i>different languages</i></b>.  There is no &quot;C/C++&quot;.  Random code written in either language cannot be assumed to have the same semantics in the other, and may not even compile in the other.  Writing code that has the same semantics in both languages is tricky."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "reply_to_user": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 0, "creation_date": 1547044663, "post_id": 54112438, "comment_id": 95057224, "body": "@Jean-Fran&#231;oisFabre I don&#39;t think it&#39;s intended to. It&#39;s adding a new type alias in the case that a macro hasn&#39;t already done that job. Unfortunately some other type alias has also already done that job in this case."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 3, "creation_date": 1547044718, "post_id": 54112438, "comment_id": 95057264, "body": "This seems to be more about compat between your old library and Windows&#39;s headers, than it is about C or C++ in particular."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1547045137, "post_id": 54112438, "comment_id": 95057528, "body": "Remove that whole code and replace it with <code>#include &lt;stdint.h&gt;</code> and <code>#include &lt;windows.h&gt;</code>. Done."}, {"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1547045158, "post_id": 54112438, "comment_id": 95057539, "body": "You say you have &quot;cloned an <b><i>older</i></b> protocol stack solution&quot; (emphasis mine). Is it possible to get a <i>newer</i> version of that library, that have fixed Windows compatibility? Or perhaps find some other library that works on Windows?"}, {"owner": {"reputation": 3140, "user_id": 1624844, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/SXXv0.png?s=128&g=1", "display_name": "Amir-Mousavi", "link": "https://stackoverflow.com/users/1624844/amir-mousavi"}, "reply_to_user": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1547045383, "post_id": 54112438, "comment_id": 95057705, "body": "@Someprogrammerdude bad usage of adj. :) and old (a legacy stack) which I am going to make a plugin and use that stack as the core. there is only one version of that"}], "answers": [{"comments": [{"owner": {"reputation": 3140, "user_id": 1624844, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/SXXv0.png?s=128&g=1", "display_name": "Amir-Mousavi", "link": "https://stackoverflow.com/users/1624844/amir-mousavi"}, "edited": false, "score": 0, "creation_date": 1547045537, "post_id": 54112581, "comment_id": 95057820, "body": "Thanks a lot, for the answer, I saw your comment in another answer which writer deleted it :("}, {"owner": {"reputation": 3140, "user_id": 1624844, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/SXXv0.png?s=128&g=1", "display_name": "Amir-Mousavi", "link": "https://stackoverflow.com/users/1624844/amir-mousavi"}, "edited": false, "score": 0, "creation_date": 1547045620, "post_id": 54112581, "comment_id": 95057888, "body": "That project is an old protocol stack implementing deferent layers of an standard (namely J1939 standard) no I want to use that stack and create plugin for a more modern tool."}], "tags": [], "owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "is_accepted": false, "score": 5, "last_activity_date": 1547044851, "creation_date": 1547044851, "answer_id": 54112581, "question_id": 54112438, "link": "https://stackoverflow.com/questions/54112438/bool-redefinition-after-including-minwindef-h/54112581#54112581", "title": "BOOL redefinition after including minwindef.h", "body": "<p>I don't know anything about the library you're trying to work with, because you did not tell us what it is. But I can make some guesses:</p>\n\n<ol>\n<li>The code did not used to interface with Windows code at all;</li>\n<li>By creating a Windows C++ application you have added Windows dependencies;</li>\n<li>The Windows dependencies (well-known for poisoning the namespace with short names like <code>BOOL</code>) are conflicting with the library's code (which is doing the same thing with its <code>BOOL</code> macro, when defined, and its <code>BOOL</code> type alias, otherwise).</li>\n</ol>\n\n<p>This isn't really to do with C vs C++ or anything like this, and there's no general fix you can make. You can either try to get rid of the Windows dependency (do you need that header for your task?) or you can patch your library not to touch <code>BOOL</code> (after making sure that Windows's <code>BOOL</code> is what you need it to be).</p>\n\n<p>And use this as a good lesson not to pollute namespaces!</p>\n"}], "owner": {"reputation": 3140, "user_id": 1624844, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/SXXv0.png?s=128&g=1", "display_name": "Amir-Mousavi", "link": "https://stackoverflow.com/users/1624844/amir-mousavi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 837, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1547045021, "creation_date": 1547044377, "last_edit_date": 1547045021, "question_id": 54112438, "link": "https://stackoverflow.com/questions/54112438/bool-redefinition-after-including-minwindef-h", "title": "BOOL redefinition after including minwindef.h", "body": "<p>I am a newbie in C/C++, just in case :)\nI have cloned an older protocol stack solution written in C with one main class in C++ imported it into VS \n(<em>Visual C++ 2017 v 15.9.5 targeting Windows SDK 10.0.17134.0</em>) it compiled correctly and working.</p>\n\n<p>Now made a C++ solution (windows console application) created a folder <code>lib</code> copy pasted all those <code>.h</code> and <code>.c</code> files into <code>lib</code> added the path to <code>additional include directories</code> and also in linker <code>additional library directories</code>.</p>\n\n<p>Building the Solution throwing tones of errors. the one I am trying to fix now is:</p>\n\n<p>One of the header files contains type definitions </p>\n\n<pre><code>typedef uint8_t U8;\n#ifndef BOOL\ntypedef U8 BOOL;\n#endif\n</code></pre>\n\n<p>but this is conflicting with <code>minwindef.h</code> from windows kit. though I <code>#include types.h</code> getting <code>C2371 'BOOL': redefinition; different basic types</code>\nin the whole solution, I want to use this definition of <code>BOOL</code> and all other ones defined in this header. </p>\n\n<p>How should I solve the issue? Or in General in case of using C codes in C++ projects what settings and MACRO (e.g. extern \"C\" in methods) should I follow</p>\n"}, {"tags": ["c++", "boost", "boost-asio"], "comments": [{"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1547044227, "post_id": 54112309, "comment_id": 95056919, "body": "Why did you add that line? Presumably the macro was left undefined in your environment for a reason? e.g. no suitable &quot;await_ready&quot; function is available."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 1, "creation_date": 1547044318, "post_id": 54112309, "comment_id": 95056982, "body": "First Google result for <code>BOOST_ASIO_HAS_CO_AWAIT</code> is <a href=\"https://blogs.msdn.microsoft.com/vcblog/2017/05/19/using-c-coroutines-with-boost-c-libraries/\" rel=\"nofollow noreferrer\">blogs.msdn.microsoft.com/vcblog/2017/05/19/&hellip;</a> which gives you a compiler switch to try..."}, {"owner": {"reputation": 61, "user_id": 10890169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdbc2087e26578022d3a7c2a870ed677?s=128&d=identicon&r=PG&f=1", "display_name": "rmlds", "link": "https://stackoverflow.com/users/10890169/rmlds"}, "reply_to_user": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1547044331, "post_id": 54112309, "comment_id": 95056989, "body": "I added that line to enable the experimental bits as described here <a href=\"https://stackoverflow.com/questions/53882914/how-to-build-boostasioexperimental\">https://stackoverflow.com/questions/53882914/how-to-build-bo&zwnj;&#8203;ostasioexperimental</a>"}], "answers": [{"comments": [{"owner": {"reputation": 148, "user_id": 1691072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1bb628a9dd3b9b398f4cbba392a6bc73?s=128&d=identicon&r=PG", "display_name": "pratikpc", "link": "https://stackoverflow.com/users/1691072/pratikpc"}, "edited": false, "score": 0, "creation_date": 1605219080, "post_id": 54113139, "comment_id": 114592031, "body": "Note that now the /await is not required as of VS 15.8"}], "tags": [], "owner": {"reputation": 61, "user_id": 10890169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdbc2087e26578022d3a7c2a870ed677?s=128&d=identicon&r=PG&f=1", "display_name": "rmlds", "link": "https://stackoverflow.com/users/10890169/rmlds"}, "is_accepted": false, "score": 4, "last_activity_date": 1547046709, "creation_date": 1547046709, "answer_id": 54113139, "question_id": 54112309, "link": "https://stackoverflow.com/questions/54112309/visual-studio-complains-about-co-await-in-authors-boost-asio-examples/54113139#54113139", "title": "Visual Studio complains about co_await in author&#39;s Boost Asio examples", "body": "<p>Thank you Lightness Races in Orbit for suggesting to try a compiler switch, that was the main problem, although I had a few others. If anyone encounters a similar problem, these are the steps I took:</p>\n\n<ol>\n<li>Move <code>#define BOOST_ASIO_HAS_CO_AWAIT</code> to the header file, in my case pch.h (dumb mistake)</li>\n<li>Add <code>/await</code> switch to <code>Project Properties &gt; C/C++ &gt; Command Line &gt; Additional Options</code>.</li>\n</ol>\n\n<p>At this point, everything compiled without errors. However, the <code>co_await</code> remains underlined in red because:</p>\n\n<blockquote>\n  <p>Intellisense compiler has not caught up with MSVC compiler yet.</p>\n</blockquote>\n\n<p>Source: <a href=\"https://blogs.msdn.microsoft.com/vcblog/2017/05/19/using-c-coroutines-with-boost-c-libraries/\" rel=\"nofollow noreferrer\">https://blogs.msdn.microsoft.com/vcblog/2017/05/19/using-c-coroutines-with-boost-c-libraries/</a></p>\n"}], "owner": {"reputation": 61, "user_id": 10890169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdbc2087e26578022d3a7c2a870ed677?s=128&d=identicon&r=PG&f=1", "display_name": "rmlds", "link": "https://stackoverflow.com/users/10890169/rmlds"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 439, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1547046709, "creation_date": 1547044004, "question_id": 54112309, "link": "https://stackoverflow.com/questions/54112309/visual-studio-complains-about-co-await-in-authors-boost-asio-examples", "title": "Visual Studio complains about co_await in author&#39;s Boost Asio examples", "body": "<p>I'm a total newbie when it comes to Boost Asio. I've played around with callbacks and everything worked well. However, now I'm trying to switch to coroutines and I'm facing a problem with <code>co_await</code>. Visual Studio 2017 Community edition says <code>\"this co_await expression requires a suitable \"await_ready\" function and none was found\"</code>.</p>\n\n<p>The code I'm using is the author's examples on Boost Asio website. Link:</p>\n\n<p><a href=\"https://www.boost.org/doc/libs/1_69_0/doc/html/boost_asio/example/cpp17/coroutines_ts/echo_server.cpp\" rel=\"nofollow noreferrer\">https://www.boost.org/doc/libs/1_69_0/doc/html/boost_asio/example/cpp17/coroutines_ts/echo_server.cpp</a></p>\n\n<p>The only modification I made to the code is <code>#define BOOST_ASIO_HAS_CO_AWAIT</code> at the very first line of the file.</p>\n\n<p>Why am I getting this error <code>\"this co_await expression requires a suitable \"await_ready\" function and none was found\"</code> on every occurrence of <code>co_await</code>? The author's examples should work without any problems, right? Am I missing an <code>#include</code> or something?</p>\n\n<p>Any help greatly appreciated.</p>\n"}, {"tags": ["c++", "vector"], "comments": [{"owner": {"reputation": 1727, "user_id": 5440453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3500f6dc5327b259bb48da3399268b0?s=128&d=identicon&r=PG&f=1", "display_name": "Algirdas Preid\u017eius", "link": "https://stackoverflow.com/users/5440453/algirdas-preid%c5%beius"}, "edited": false, "score": 0, "creation_date": 1547043979, "post_id": 54112279, "comment_id": 95056736, "body": "Please provide <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. Are <code>Hero</code> instances, in the <code>std::vector</code>, allocated with <code>new</code>?"}, {"owner": {"reputation": 15, "user_id": 10666069, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-gNzLIDStkwg/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-g1nE6y6WsoC3IdBqtHQFm-LfDiDw/mo/photo.jpg?sz=128", "display_name": "Kumar Aldani", "link": "https://stackoverflow.com/users/10666069/kumar-aldani"}, "reply_to_user": {"reputation": 1727, "user_id": 5440453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3500f6dc5327b259bb48da3399268b0?s=128&d=identicon&r=PG&f=1", "display_name": "Algirdas Preid\u017eius", "link": "https://stackoverflow.com/users/5440453/algirdas-preid%c5%beius"}, "edited": false, "score": 0, "creation_date": 1547044081, "post_id": 54112279, "comment_id": 95056804, "body": "yes , i did new when i input my hero to vector"}, {"owner": {"reputation": 1727, "user_id": 5440453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3500f6dc5327b259bb48da3399268b0?s=128&d=identicon&r=PG&f=1", "display_name": "Algirdas Preid\u017eius", "link": "https://stackoverflow.com/users/5440453/algirdas-preid%c5%beius"}, "edited": false, "score": 0, "creation_date": 1547044137, "post_id": 54112279, "comment_id": 95056850, "body": "@DavidZaltsman In that case, please provide <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 2055, "user_id": 6564148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/u3HL5.png?s=128&g=1", "display_name": "George", "link": "https://stackoverflow.com/users/6564148/george"}, "edited": false, "score": 1, "creation_date": 1547044258, "post_id": 54112279, "comment_id": 95056940, "body": "vector iterators are invalidated when something is erased from them."}, {"owner": {"reputation": 1968, "user_id": 846641, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/q1FW7.jpg?s=128&g=1", "display_name": "Philipp", "link": "https://stackoverflow.com/users/846641/philipp"}, "edited": false, "score": 1, "creation_date": 1547044696, "post_id": 54112279, "comment_id": 95057240, "body": "Is there more than one hero with the same name? Also, try to use smart pointers instead of raw pointers."}, {"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 0, "creation_date": 1547045179, "post_id": 54112279, "comment_id": 95057556, "body": "@DavidZaltsman Please see <a href=\"https://stackoverflow.com/questions/51583374/whats-wrong-with-this-method-of-deletion-in-a-vector/51583614#51583614\">this answer</a>.  This avoids having to write loops, and also allows you to delete and erase safely."}], "answers": [{"comments": [{"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 1, "creation_date": 1547045294, "post_id": 54112367, "comment_id": 95057637, "body": "Upvoted.  In addition, <a href=\"https://stackoverflow.com/questions/51583374/whats-wrong-with-this-method-of-deletion-in-a-vector/51583614#51583614\">this answer</a> avoids writing any loops."}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "reply_to_user": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 0, "creation_date": 1547045994, "post_id": 54112367, "comment_id": 95058150, "body": "@PaulMcKenzie would it not be sufficient to use remove_if - erase, while deleting in the predicate?"}, {"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 0, "creation_date": 1547046122, "post_id": 54112367, "comment_id": 95058231, "body": "@eerorika Possibly, but I&#39;m too chicken to try it.  Safer just to do this in stages."}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "edited": false, "score": 0, "creation_date": 1547046226, "post_id": 54112367, "comment_id": 95058305, "body": "Though, one should not have owning bare pointers in the first place, so there is little point arguing about how to best deal with them."}], "tags": [], "owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "is_accepted": false, "score": 3, "last_activity_date": 1547045499, "last_edit_date": 1547045499, "creation_date": 1547044143, "answer_id": 54112367, "question_id": 54112279, "link": "https://stackoverflow.com/questions/54112279/trying-to-delete-spesific-object-from-vector-and-fail/54112367#54112367", "title": "trying to delete spesific Object from vector and fail", "body": "<p><code>players.erase(iter)</code> operation invalidates <code>iter</code>. After the iteration, <code>++iter</code> is performed, and in next iteration <code>*iter</code> both of which have undefined behaviour because the iterator is invalid.</p>\n\n<p>You must use following algorithm:</p>\n\n<ul>\n<li>If iterator is erased, then <code>erase</code> returns the iterator to next element.</li>\n<li>Else, increment the iterator.</li>\n</ul>\n"}], "owner": {"reputation": 15, "user_id": 10666069, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-gNzLIDStkwg/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-g1nE6y6WsoC3IdBqtHQFm-LfDiDw/mo/photo.jpg?sz=128", "display_name": "Kumar Aldani", "link": "https://stackoverflow.com/users/10666069/kumar-aldani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1547045499, "creation_date": 1547043904, "last_edit_date": 1547044343, "question_id": 54112279, "link": "https://stackoverflow.com/questions/54112279/trying-to-delete-spesific-object-from-vector-and-fail", "title": "trying to delete spesific Object from vector and fail", "body": "<p>i have a vector that contains object and i want to delete some spesific object and my program just crash with the message \"Process finished with exit code 0\" in my \"delete (*iter)\" line  , and i dont have any idea why </p>\n\n<pre><code>void killHero(Hero* hero,vector&lt;Hero*&gt;&amp; players)\n{\n    std::vector&lt;Hero*&gt; ::iterator iter;\n    int count = 0;\n    for(iter=players.begin(); iter!=players.end();++iter) {\n        Hero *h = *iter;\n        if (h-&gt;getName() == hero-&gt;getName()) {\n            delete *iter;\n            players.erase(iter);\n            vecorSize--;\n        }\n    }\n\n}\n</code></pre>\n\n<p>my vector contains:</p>\n\n<pre><code>  void createNewGame(vector&lt;Hero*&gt; &amp;players,int warriors, int thieves, int necromancers)\n{\n    string nameOfwarrior=\"\";\n    for(int i=0; i&lt;warriors; i++)\n    {\n        cout &lt;&lt; \"Please insert warrior number \"&lt;&lt; i+1 &lt;&lt; \" name:\"&lt;&lt;endl;\n        std::getline(cin,nameOfwarrior);\n        try\n        {\n            digitCheck(nameOfwarrior);\n            Warrior *warr = new Warrior(nameOfwarrior);\n            players.push_back(warr);\n        }\n        catch(GameException&amp; e )\n        {\n            e.error();\n            i--;\n        }\n    }\n    for(int i=0; i&lt;thieves; i++)\n    {\n        cout &lt;&lt; \"Please insert thief number \"&lt;&lt; i+1 &lt;&lt; \" name:\"&lt;&lt;endl;\n        std::getline(cin,nameOfwarrior);\n        try\n        {\n            digitCheck(nameOfwarrior);\n            Thief* thief = new Thief(nameOfwarrior);\n            players.push_back(thief);\n        }\n        catch(GameException&amp; e)\n        {\n            e.error();\n            i--;\n        }\n    }\n    for(int i=0; i&lt;necromancers; i++)\n    {\n        cout &lt;&lt; \"Please insert necromancer number \"&lt;&lt; i+1 &lt;&lt; \" name:\"&lt;&lt;endl;\n        std::getline(cin,nameOfwarrior);\n        try\n        {\n            digitCheck(nameOfwarrior);\n            Necromancer* necro = new Necromancer(nameOfwarrior);\n            players.push_back(necro);\n        }\n        catch(GameException&amp; e)\n        {\n            e.error();\n            i--;\n        }\n    }\n}\n</code></pre>\n\n<p>what can solve the problem?\nthank you</p>\n"}, {"tags": ["c++", "c", "visual-studio-2010", "security", "secure-coding"], "comments": [{"owner": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 1, "creation_date": 1547043792, "post_id": 54112179, "comment_id": 95056607, "body": "I would remove the <code>c++</code> tag from this question. I believe the _s versions are non standard Microsoft additions however I am a <code>c++</code> programmer and never ever use these."}, {"owner": {"reputation": 213, "user_id": 5623335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e00e0647a5095f7b474c5b524828918d?s=128&d=identicon&r=PG&f=1", "display_name": "securityauditor", "link": "https://stackoverflow.com/users/5623335/securityauditor"}, "reply_to_user": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 0, "creation_date": 1547043951, "post_id": 54112179, "comment_id": 95056715, "body": "Why remove the C++ tag since I sometimes code in C++, or is it these secure versions only exist for C?"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 3, "creation_date": 1547044035, "post_id": 54112179, "comment_id": 95056773, "body": "@securityauditor Because tags should describe what the question is about."}, {"owner": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 1, "creation_date": 1547044115, "post_id": 54112179, "comment_id": 95056827, "body": "They exist in <code>c++</code> but <code>c++</code> has better ways of using strings in the standard library."}, {"owner": {"reputation": 213, "user_id": 5623335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e00e0647a5095f7b474c5b524828918d?s=128&d=identicon&r=PG&f=1", "display_name": "securityauditor", "link": "https://stackoverflow.com/users/5623335/securityauditor"}, "edited": false, "score": 0, "creation_date": 1547044195, "post_id": 54112179, "comment_id": 95056895, "body": "Lundin Well it&#39;s about using C and C++ with the standard library which is what my code bases use. I do not want to update each one to then not be able to execute them on our old legacy Win 2000 etc... computers!"}, {"owner": {"reputation": 42006, "user_id": 3807729, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UEUbF.jpg?s=128&g=1", "display_name": "Galik", "link": "https://stackoverflow.com/users/3807729/galik"}, "edited": false, "score": 1, "creation_date": 1547044408, "post_id": 54112179, "comment_id": 95057036, "body": "Personally I feel it is debatable if these functions add any real security. Also, generally in <code>C++</code> code, you would not be handling raw buffers that do not know their length. That&#39;s one of the main benefits of OO."}, {"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 1, "creation_date": 1547045590, "post_id": 54112179, "comment_id": 95057859, "body": "&quot;If we write code for Windows I do not mind if it&#39;s not portable to Linux&quot; - I&#39;d caution against that unless it&#39;s purely Win32 gui / api stuff."}], "answers": [{"comments": [{"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1547044428, "post_id": 54112419, "comment_id": 95057050, "body": "Buffer overrun has plenty to do with security. Do you know how many vulnerabilities are exploitable through buffer overruns?"}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1547044477, "post_id": 54112419, "comment_id": 95057093, "body": "Granted, there are other ways to avoid such a bug and fix that security problem ;)"}, {"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "reply_to_user": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1547044518, "post_id": 54112419, "comment_id": 95057117, "body": "@LightnessRacesinOrbit: Yup, I had a warped childhood and had a lot of fun on the exploiting side ;-) &quot;atdt&quot; still rings in my lugholes."}, {"owner": {"reputation": 13762, "user_id": 694733, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/0a3de8cd40d9ffb86cc1fed0c8cf2e19?s=128&d=identicon&r=PG", "display_name": "user694733", "link": "https://stackoverflow.com/users/694733/user694733"}, "edited": false, "score": 0, "creation_date": 1547044611, "post_id": 54112419, "comment_id": 95057194, "body": "<code>strncpy</code> is <b>not</b> acceptable substitute when speaking about protecting against buffer overruns."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1547044702, "post_id": 54112419, "comment_id": 95057243, "body": "@LightnessRacesinOrbit <code>strcpy</code> has nothing to do with buffer overruns. To protect against buffer overruns, you verify the data <i>before</i> you copy."}, {"owner": {"reputation": 42006, "user_id": 3807729, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UEUbF.jpg?s=128&g=1", "display_name": "Galik", "link": "https://stackoverflow.com/users/3807729/galik"}, "reply_to_user": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1547044854, "post_id": 54112419, "comment_id": 95057353, "body": "@LightnessRacesinOrbit Adding a length parameter does not guarantee you won&#39;t overrun a buffer. It gives you additional code-sites where you have to make the same change when you come to maintain the code and more chances for error if you forget one imo. It is a choice between getting the code correct in one place (the caller) or trying to get the code right every time you use a function (in the callee)."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "reply_to_user": {"reputation": 42006, "user_id": 3807729, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UEUbF.jpg?s=128&g=1", "display_name": "Galik", "link": "https://stackoverflow.com/users/3807729/galik"}, "edited": false, "score": 0, "creation_date": 1547045133, "post_id": 54112419, "comment_id": 95057524, "body": "@Galik Maybe. There&#39;s ways to minimise that risk to the point that it&#39;s better than the risk of having no length checking at all. IMO those ways are numerous and easy when compared to the ghastly alternative. But YMMV"}], "tags": [], "owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "is_accepted": false, "score": 4, "last_activity_date": 1547044301, "creation_date": 1547044301, "answer_id": 54112419, "question_id": 54112179, "link": "https://stackoverflow.com/questions/54112179/backwards-compatibility-and-secure-versions-of-functions/54112419#54112419", "title": "Backwards compatibility and secure versions of functions", "body": "<p>Avoid <code>strcpy_s()</code> if you want to write <em>portable</em> C (or C++) as it's a non-standard function.</p>\n\n<p><code>strncpy()</code> is the standard way of copying up to a certain number of characters, and can help guard against buffer overrun for which the term \"security\" is abused.</p>\n\n<p>There's nothing wrong with using <code>strcpy</code> so long as you know what you're doing. Much of this sentiment applies to C in general: its power is in its simplicity and minimal run-time checking.</p>\n"}, {"comments": [{"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 1, "creation_date": 1547044882, "post_id": 54112505, "comment_id": 95057376, "body": "Upped; nice and sensible."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1547045086, "post_id": 54112505, "comment_id": 95057492, "body": "UV warranted by &quot;the new library was a fiasco&quot; alone."}, {"owner": {"reputation": 27440, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1547136645, "post_id": 54112505, "comment_id": 95096713, "body": "Indeed.  <a href=\"http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1967.htm\" rel=\"nofollow noreferrer\"><b>Field Experience With Annex K \u2014 Bounds Checking Interfaces</b></a>:  &quot;Microsoft Visual Studio implements an early version of the APIs. However, the implementation is incomplete and conforms neither to C11 nor to the original TR 24731-1. ...  As a result of the numerous deviations from the specification the Microsoft implementation cannot be considered conforming or portable.&quot;"}], "tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": false, "score": 8, "last_activity_date": 1547044621, "creation_date": 1547044621, "answer_id": 54112505, "question_id": 54112179, "link": "https://stackoverflow.com/questions/54112179/backwards-compatibility-and-secure-versions-of-functions/54112505#54112505", "title": "Backwards compatibility and secure versions of functions", "body": "<p><code>strcpy</code> is perfectly safe, see <a href=\"https://stackoverflow.com/a/23490019/584518\">this</a>.</p>\n\n<p><code>strcpy_s</code> was only standardized as late as 2011 in the C11 optional bounds-checking interface. It is not supported by many compilers at all - the new library was a fiasco.</p>\n\n<p>Microsoft non-standard libraries are only partially compatible with the standardized bounds-checking interface. In some cases they don't follow the standard but have the same function name.</p>\n\n<p>Thus functions ending with <code>_s</code> are generally <em>unsafe</em>, since both standard and non-standard versions exists and are not necessarily compatible. They are certainly not portable.</p>\n\n<p>My advise is to avoid the following entirely:</p>\n\n<ul>\n<li>The C11 bounds-checking interface.</li>\n<li>Any function ending with <code>_s</code>.</li>\n<li>Visual Studio for the purpose of compiling C code.</li>\n</ul>\n\n<p>Instead use the safe and portable function <code>strcpy</code> which has been standardized and documented for over 30 years. Together with this, you should use an ISO C standard compliant compiler.</p>\n"}, {"tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": true, "score": 3, "last_activity_date": 1547133268, "last_edit_date": 1547133268, "creation_date": 1547046747, "answer_id": 54113148, "question_id": 54112179, "link": "https://stackoverflow.com/questions/54112179/backwards-compatibility-and-secure-versions-of-functions/54113148#54113148", "title": "Backwards compatibility and secure versions of functions", "body": "<blockquote>\n  <p>My question is if I use the newer secure version will I still be able\n  to execute my programs on older versions of Windows, for example\n  Windows 95? Due to requirements we can only have a single executable\n  file.</p>\n</blockquote>\n\n<p>The <code>_s</code> versions are not \"secure\", whether you're talking about Microsoft's implementations or implementations conforming to the actual standard.  They do incorporate mechanisms intended to help avoid or mitigate certain programming errors that have security implications, but the effectiveness of those is limited.</p>\n\n<p>But with respect to whether they will be supported on very old Windows versions, no, not by default.  The _s functions did not exist during Windows 95's lifetime, so versions of the C runtime library distributed with that version of Windows do not support them.  It is relatively common, however, for Windows applications to be packaged with a version of the MS C runtime library that supports their needs.  It may be that you can take that route, but I cannot speak to whether there is any version of the MS C runtime that supports all Windows versions from the past 24 years and contains the _s functions.</p>\n\n<p>Your best bet is to limit yourself to functions from the C90 standard library, WinAPI functions supported across all targeted Windows versions, and functions provided by your application itself and any third-party libraries distributed with it (which themselves should comply with the same limitations).  Or you could consider limiting support to fewer versions of Windows.  Microsoft itself has not supported Windows 95 for 18 years.</p>\n"}], "owner": {"reputation": 213, "user_id": 5623335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e00e0647a5095f7b474c5b524828918d?s=128&d=identicon&r=PG&f=1", "display_name": "securityauditor", "link": "https://stackoverflow.com/users/5623335/securityauditor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 54113148, "answer_count": 3, "score": 0, "last_activity_date": 1547133268, "creation_date": 1547043534, "last_edit_date": 1547045423, "question_id": 54112179, "link": "https://stackoverflow.com/questions/54112179/backwards-compatibility-and-secure-versions-of-functions", "title": "Backwards compatibility and secure versions of functions", "body": "<p>I am writing some programs in C (rarely C++). Normally they are simple, but often they can get larger. </p>\n\n<p>I am looking to learn more about using the secure versions of functions, for example <code>strcpy()</code> is insecure and <code>strcpy_s()</code> is Microsoft's new secure version of that function.</p>\n\n<p>I normally use Visual Studio 2010 when coding for Windows <strong>* I removed part about Linux - focus on Windows only*</strong></p>\n\n<p>My question is if I use the newer secure version will I still be able to execute my programs on older versions of Windows, for example Windows 95? Due to requirements we can only have a single executable file.</p>\n\n<p>Thank you.</p>\n\n<p><strong>EDIT:</strong>\nSorry this just appeared in my mind now - ignore the Linux part above. If we write code for Windows I do not mind if it's not portable to Linux, I only care if it still works on older versions of Windows.</p>\n"}, {"tags": ["c++", "c++11", "inheritance", "types", "template-meta-programming"], "comments": [{"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 1, "creation_date": 1547043475, "post_id": 54112145, "comment_id": 95056409, "body": "Putting all the functions in a single container at run time is going to be difficult since they all have different types."}, {"owner": {"reputation": 82712, "user_id": 598696, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/k1Yif.png?s=128&g=1", "display_name": "Vittorio Romeo", "link": "https://stackoverflow.com/users/598696/vittorio-romeo"}, "edited": false, "score": 2, "creation_date": 1547043480, "post_id": 54112145, "comment_id": 95056414, "body": "Does <code>Container</code> need to be modified at run-time? Is it OK if we add the functions at compile-time?"}, {"owner": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "edited": false, "score": 1, "creation_date": 1547043617, "post_id": 54112145, "comment_id": 95056496, "body": "<code>Container</code> could have three fields to store the three different function pointers, <code>add</code> could be three overloaded setters that set the respective function pointer, and then finally <code>Container</code> has a function that performs the <code>f(g(h())) </code> call."}, {"owner": {"reputation": 35327, "user_id": 27678, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/7496124d499d578df1e3a6ff85e7ae03?s=128&d=identicon&r=PG", "display_name": "AndyG", "link": "https://stackoverflow.com/users/27678/andyg"}, "edited": false, "score": 2, "creation_date": 1547043669, "post_id": 54112145, "comment_id": 95056532, "body": "@NeilButterworth: I parsed the sentence as &quot;without <code>dynamic_cast</code>, with C++11&quot;"}, {"owner": {"reputation": 365, "user_id": 9349415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5c66f9a1014ab3c32173cf528943c48?s=128&d=identicon&r=PG&f=1", "display_name": "svoltron", "link": "https://stackoverflow.com/users/9349415/svoltron"}, "reply_to_user": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1547043779, "post_id": 54112145, "comment_id": 95056600, "body": "@NathanOliver I know that :/  Vittorio, ideally yes, but I&#39;d be curious also in compile-time solutions. Sorry, I meant using &quot;C++11&quot;"}, {"owner": {"reputation": 365, "user_id": 9349415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5c66f9a1014ab3c32173cf528943c48?s=128&d=identicon&r=PG&f=1", "display_name": "svoltron", "link": "https://stackoverflow.com/users/9349415/svoltron"}, "reply_to_user": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "edited": false, "score": 0, "creation_date": 1547043928, "post_id": 54112145, "comment_id": 95056703, "body": "@Blaze good idea."}, {"owner": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "edited": false, "score": 1, "creation_date": 1547046357, "post_id": 54112145, "comment_id": 95058400, "body": "@svoltron As for compile-time solutions (that don&#39;t require <code>std::function</code> overhead), check out this one: <a href=\"https://stackoverflow.com/questions/54076787/can-i-get-the-return-type-of-multiple-chained-functions-calls\" title=\"can i get the return type of multiple chained functions calls\">stackoverflow.com/questions/54076787/&hellip;</a>. The question there is how to get the final type, but the solution just builds the call expression and then does a <code>decltype</code>, so just skip the latter."}, {"owner": {"reputation": 365, "user_id": 9349415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5c66f9a1014ab3c32173cf528943c48?s=128&d=identicon&r=PG&f=1", "display_name": "svoltron", "link": "https://stackoverflow.com/users/9349415/svoltron"}, "reply_to_user": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "edited": false, "score": 0, "creation_date": 1547046501, "post_id": 54112145, "comment_id": 95058488, "body": "@MaxLanghof very interesting indeed thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 365, "user_id": 9349415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5c66f9a1014ab3c32173cf528943c48?s=128&d=identicon&r=PG&f=1", "display_name": "svoltron", "link": "https://stackoverflow.com/users/9349415/svoltron"}, "edited": false, "score": 0, "creation_date": 1547044022, "post_id": 54112273, "comment_id": 95056766, "body": "really interesting solution Vittorio"}, {"owner": {"reputation": 365, "user_id": 9349415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5c66f9a1014ab3c32173cf528943c48?s=128&d=identicon&r=PG&f=1", "display_name": "svoltron", "link": "https://stackoverflow.com/users/9349415/svoltron"}, "edited": false, "score": 0, "creation_date": 1547044057, "post_id": 54112273, "comment_id": 95056786, "body": "Only doubt is the performance of std::function :/ Also the TODO part is something I&#39;m wondering how to do right now eheh"}, {"owner": {"reputation": 35327, "user_id": 27678, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/7496124d499d578df1e3a6ff85e7ae03?s=128&d=identicon&r=PG", "display_name": "AndyG", "link": "https://stackoverflow.com/users/27678/andyg"}, "reply_to_user": {"reputation": 365, "user_id": 9349415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5c66f9a1014ab3c32173cf528943c48?s=128&d=identicon&r=PG&f=1", "display_name": "svoltron", "link": "https://stackoverflow.com/users/9349415/svoltron"}, "edited": false, "score": 2, "creation_date": 1547044240, "post_id": 54112273, "comment_id": 95056927, "body": "@svoltron: You need type erasure of some sort. It&#39;s easy to reach for <code>std::function</code> rather than try to roll your own."}, {"owner": {"reputation": 82712, "user_id": 598696, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/k1Yif.png?s=128&g=1", "display_name": "Vittorio Romeo", "link": "https://stackoverflow.com/users/598696/vittorio-romeo"}, "reply_to_user": {"reputation": 365, "user_id": 9349415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5c66f9a1014ab3c32173cf528943c48?s=128&d=identicon&r=PG&f=1", "display_name": "svoltron", "link": "https://stackoverflow.com/users/9349415/svoltron"}, "edited": false, "score": 1, "creation_date": 1547044562, "post_id": 54112273, "comment_id": 95057156, "body": "@svoltron: added a possible implementation of the TODO part. It seems to work but haven&#39;t tested all edge cases."}, {"owner": {"reputation": 365, "user_id": 9349415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5c66f9a1014ab3c32173cf528943c48?s=128&d=identicon&r=PG&f=1", "display_name": "svoltron", "link": "https://stackoverflow.com/users/9349415/svoltron"}, "edited": false, "score": 0, "creation_date": 1547044691, "post_id": 54112273, "comment_id": 95057236, "body": "Great job @VittorioRomeo, it seems working, I&#39;ll check it out"}, {"owner": {"reputation": 35327, "user_id": 27678, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/7496124d499d578df1e3a6ff85e7ae03?s=128&d=identicon&r=PG", "display_name": "AndyG", "link": "https://stackoverflow.com/users/27678/andyg"}, "edited": false, "score": 1, "creation_date": 1547045584, "post_id": 54112273, "comment_id": 95057854, "body": "@VittorioRomeo: <a href=\"https://wandbox.org/permlink/EC0GWPJGtPh55KHj\" rel=\"nofollow noreferrer\">here is another recursive impl</a>, probably you can do better."}], "tags": [], "owner": {"reputation": 82712, "user_id": 598696, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/k1Yif.png?s=128&g=1", "display_name": "Vittorio Romeo", "link": "https://stackoverflow.com/users/598696/vittorio-romeo"}, "is_accepted": true, "score": 6, "last_activity_date": 1547044549, "last_edit_date": 1547044549, "creation_date": 1547043883, "answer_id": 54112273, "question_id": 54112145, "link": "https://stackoverflow.com/questions/54112145/sequential-heterogeneous-functions-executer/54112273#54112273", "title": "Sequential heterogeneous functions executer", "body": "<p>If <code>Container</code> needs to be modifiable at run-time, you can achieve this with <code>std::any</code> (or <code>boost::any</code>):</p>\n\n<pre><code>struct Container\n{   \n    std::vector&lt;std::function&lt;std::any(std::any)&gt;&gt; _fns;\n\n    template &lt;typename R, typename A&gt;\n    void add(R(*f)(A)) \n    { \n        _fns.emplace_back([f](std::any x) -&gt; std::any\n        {\n            return {f(std::any_cast&lt;A&gt;(x))};\n        }); \n    }\n\n    template &lt;typename T&gt;\n    std::any call(T x)\n    {\n        // TODO: replace with recursive version\n        return _fns[2](_fns[1](_fns[0](x)));\n    }\n};\n</code></pre>\n\n<p>Usage:</p>\n\n<pre><code>int h(int x) { return x; }\nstd::string g(int x) { return std::to_string(x); }\ndouble f(std::string x) { return x.size(); }\n\nint main()\n{\n    Container c;\n    c.add(h);\n    c.add(g);\n    c.add(f); \n\n    std::cout &lt;&lt; std::any_cast&lt;double&gt;(c.call(5)) &lt;&lt; '\\n';\n}\n</code></pre>\n\n<p>Output:</p>\n\n<blockquote>\n  <p>1</p>\n</blockquote>\n\n<p><a href=\"https://wandbox.org/permlink/RayO3EEHPZMkG3j5\" rel=\"nofollow noreferrer\"><strong>live example on wandbox.org</strong></a></p>\n\n<hr>\n\n<p>Possible recursive implementation:</p>\n\n<pre><code>template &lt;typename T&gt;\nstd::any call_impl(T x, const std::size_t next)\n{\n    return next == _fns.size() - 1 \n        ? _fns[next](x) \n        : call_impl(_fns[next](x), next + 1);\n}\n\ntemplate &lt;typename T&gt;\nstd::any call(T x)\n{\n    return call_impl(x, 0);\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 205, "user_id": 8527007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fb4570b7dd309f6f409f45aec2509c8?s=128&d=identicon&r=PG&f=1", "display_name": "MaLarsson", "link": "https://stackoverflow.com/users/8527007/malarsson"}, "is_accepted": false, "score": 1, "last_activity_date": 1547051538, "creation_date": 1547051538, "answer_id": 54114556, "question_id": 54112145, "link": "https://stackoverflow.com/questions/54112145/sequential-heterogeneous-functions-executer/54114556#54114556", "title": "Sequential heterogeneous functions executer", "body": "<p>This is more of a side note but I made something very similar for fun during the holiday season. It's too much code to fit here but you can check the code <a href=\"https://github.com/MaLarsson/functional/blob/master/include/chain.hpp\" rel=\"nofollow noreferrer\">here</a> or a live version <a href=\"https://wandbox.org/permlink/FYavsE25EOuMj9wV\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>basically it's a function which returns a lambda capturing all the functions to invoke. This allows you to write the following code:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;string&gt;\n\n#include \"chain.hpp\"\n\nint f(int x) { return x; }\nstd::string g(int x) { return std::to_string(x); }\ndouble h(std::string x) { return x.size(); }\n\nint main() {\n    auto function = fn::chain(f, g, h);\n    std::cout &lt;&lt; function(5) &lt;&lt; '\\n'; // prints 1\n\n    return 0;\n}\n</code></pre>\n\n<p>It will also try expanding retured tuples with std::apply if std::invoke does not work. This makes the following code valid:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;tuple&gt;\n\n#include \"chain.hpp\"\n\nint main() {\n    auto test = fn::chain([](int i, int j) { return i + j; },\n                          [](int i) { return i * 2; },\n                          [](int i) -&gt; std::tuple&lt;int, int&gt; {\n                              return {i, i};\n                          },\n                          [](int i, int j) { return i + j; });\n\n    std::cout &lt;&lt; test(1, 2) &lt;&lt; '\\n'; // prints 12\n}\n</code></pre>\n\n<p>As I said, this was just a fun experement but maybe it will be helpful!</p>\n"}], "owner": {"reputation": 365, "user_id": 9349415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5c66f9a1014ab3c32173cf528943c48?s=128&d=identicon&r=PG&f=1", "display_name": "svoltron", "link": "https://stackoverflow.com/users/9349415/svoltron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 3, "accepted_answer_id": 54112273, "answer_count": 2, "score": 4, "last_activity_date": 1547051538, "creation_date": 1547043391, "last_edit_date": 1547043728, "question_id": 54112145, "link": "https://stackoverflow.com/questions/54112145/sequential-heterogeneous-functions-executer", "title": "Sequential heterogeneous functions executer", "body": "<p>let's suppose that there are N functions that take different inputs and that return different values:</p>\n\n<pre><code>int h(int);\nstring g(int);\ndouble f(string);\n</code></pre>\n\n<p>Of course it is possible to write something like:</p>\n\n<pre><code>f(g(h(4)))  \n</code></pre>\n\n<p>Suppose now that I want to store these functions f,g,h into a kind of container like:</p>\n\n<pre><code>Container c;\nc.add(h);\nc.add(g);\nc.add(f); \n</code></pre>\n\n<p>Given an input for the first function (an int in the case of f) I would like these function being executed in a sequential way, with each of them taking as input the output of the previous one.</p>\n\n<p>Do you think is it possible in C++? possibly without using dynamic_cast and using C++11</p>\n"}, {"tags": ["c++", "c", "linux", "ioctl", "block-device"], "comments": [{"owner": {"reputation": 2999, "user_id": 7520531, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0107497596782a18d4a853214a883546?s=128&d=identicon&r=PG&f=1", "display_name": "Jose", "link": "https://stackoverflow.com/users/7520531/jose"}, "edited": false, "score": 1, "creation_date": 1547043406, "post_id": 54112087, "comment_id": 95056358, "body": "Are you looking for something beyond the return value (errno)? <a href=\"http://man7.org/linux/man-pages/man2/lseek.2.html\" rel=\"nofollow noreferrer\">man7.org/linux/man-pages/man2/lseek.2.html</a>"}, {"owner": {"reputation": 2257, "user_id": 1530018, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/bcbc00a1cd813900aedb1eebd7113d90?s=128&d=identicon&r=PG&f=1", "display_name": "kreuzerkrieg", "link": "https://stackoverflow.com/users/1530018/kreuzerkrieg"}, "reply_to_user": {"reputation": 2999, "user_id": 7520531, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0107497596782a18d4a853214a883546?s=128&d=identicon&r=PG&f=1", "display_name": "Jose", "link": "https://stackoverflow.com/users/7520531/jose"}, "edited": false, "score": 0, "creation_date": 1547043541, "post_id": 54112087, "comment_id": 95056444, "body": "Sure, errno is equal to EIO, like here <a href=\"http://man7.org/linux/man-pages/man2/read.2.html\" rel=\"nofollow noreferrer\">man7.org/linux/man-pages/man2/read.2.html</a> Then what?"}, {"owner": {"reputation": 6746, "user_id": 1143634, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/e7lca.png?s=128&g=1", "display_name": "StaceyGirl", "link": "https://stackoverflow.com/users/1143634/staceygirl"}, "edited": false, "score": 2, "creation_date": 1547045229, "post_id": 54112087, "comment_id": 95057592, "body": "@kreuzerkrieg I don&#39;t believe there is a way to do that. You should just check kernel logs. Also check <a href=\"https://yarchive.net/comp/linux/block_device_error_handling.html\" rel=\"nofollow noreferrer\">this</a>."}, {"owner": {"reputation": 2257, "user_id": 1530018, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/bcbc00a1cd813900aedb1eebd7113d90?s=128&d=identicon&r=PG&f=1", "display_name": "kreuzerkrieg", "link": "https://stackoverflow.com/users/1530018/kreuzerkrieg"}, "edited": false, "score": 0, "creation_date": 1547046684, "post_id": 54112087, "comment_id": 95058607, "body": "According to your link, looks like dead end... I guess nothing changed in the last decade and half :("}, {"owner": {"reputation": 10359, "user_id": 1216776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504692de390dabd9ca22fd716e178993?s=128&d=identicon&r=PG", "display_name": "stark", "link": "https://stackoverflow.com/users/1216776/stark"}, "edited": false, "score": 1, "creation_date": 1547048422, "post_id": 54112087, "comment_id": 95059684, "body": "File reads and writes are not 1:1 with device reads and writes due to logical volumes, write-back and readahead.  You would have to look for errors logged by the underlying kernel.  It will never be available to the user-space program."}], "answers": [{"comments": [{"owner": {"reputation": 2257, "user_id": 1530018, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/bcbc00a1cd813900aedb1eebd7113d90?s=128&d=identicon&r=PG&f=1", "display_name": "kreuzerkrieg", "link": "https://stackoverflow.com/users/1530018/kreuzerkrieg"}, "edited": false, "score": 0, "creation_date": 1547106855, "post_id": 54118314, "comment_id": 95079596, "body": "This is what I have right now, I wish to abandon the sg stuff, which does not work with NVMe, and switch to something more generic. As I understand there is no such a thing, so I would just drop work with block devices and switch to usermode NVMe (using SPDK)"}], "tags": [], "owner": {"reputation": 2626, "user_id": 300290, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wI1od.png?s=128&g=1", "display_name": "Mike Andrews", "link": "https://stackoverflow.com/users/300290/mike-andrews"}, "is_accepted": true, "score": 2, "last_activity_date": 1547067761, "creation_date": 1547067761, "answer_id": 54118314, "question_id": 54112087, "link": "https://stackoverflow.com/questions/54112087/how-to-retrieve-underlying-block-device-io-error/54118314#54118314", "title": "How to retrieve underlying block device IO error", "body": "<p>You can't get any more error detail out of the POSIX functions.  You're onto the right track with the SCSI generic stuff though.  But, boy, it's loaded with hair.  Check out the example in sg3_utils of how to do a SCSI READ(16).  This will let you look at the sense data when it comes back: </p>\n\n<p><a href=\"https://github.com/hreinecke/sg3_utils/blob/master/examples/sg_simple16.c\" rel=\"nofollow noreferrer\">https://github.com/hreinecke/sg3_utils/blob/master/examples/sg_simple16.c</a></p>\n\n<p>Of course, this technique doesn't work with NVMe drives.  (At least, not to my knowledge).</p>\n\n<p>One concept I've played with in the past is to use normal POSIX/libc block I/O functions like <code>pread</code> and <code>pwrite</code> until I get an EIO out.  At that point, you can bring in the SCSI-generic versions to try to figure out what happened.  In the ideal case, a <code>pread</code> or <code>lseek/read</code> fails with EIO.  You then turn around and re-issue it using a SG READ (10) or (16).  If it's not just a transient failure, this may return sense data that your application can use.</p>\n\n<p>Here's an example, using the command-line sg_read program.  I have an iSCSI attached disk that I'm reading and writing.  On the target, I remove its LUN mapping.  <code>dd</code> reports EIO:</p>\n\n<pre><code># dd if=/dev/sdb of=/tmp/output bs=512 count=1 iflag=direct\ndd: error reading \u2018/dev/sdb\u2019: Input/output error\n</code></pre>\n\n<p>but <code>sg_read</code> reports some more useful information:</p>\n\n<pre><code>[root@localhost src]# sg_read blk_sgio=1 bs=512 cdbsz=10 count=512 if=/dev/sdb odir=1 verbose=10\nOpened /dev/sdb for SG_IO with flags=0x4002\n    read cdb: 28 00 00 00 00 00 00 00 80 00\n      duration=9 ms\nreading: SCSI status: Check Condition\n Fixed format, current;  Sense key: Illegal Request\n Additional sense: Logical unit not supported\n Raw sense data (in hex):\n        70 00 05 00 00 00 00 0a  00 00 00 00 25 00 00 00\n        00 00\nsg_read: SCSI READ failed\nSome error occurred,  remaining block count=512\n0+0 records in\n</code></pre>\n\n<p>You can see the <code>Logical unit not supported</code> additional sense code in the above output, indicating that there's no such LU at the target.  </p>\n\n<p>Possible?  Yes.  But as you can see from the code in <code>sg_simple16.c</code>, it's not easy!</p>\n"}], "owner": {"reputation": 2257, "user_id": 1530018, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/bcbc00a1cd813900aedb1eebd7113d90?s=128&d=identicon&r=PG&f=1", "display_name": "kreuzerkrieg", "link": "https://stackoverflow.com/users/1530018/kreuzerkrieg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 383, "favorite_count": 0, "accepted_answer_id": 54118314, "answer_count": 1, "score": 2, "last_activity_date": 1547067761, "creation_date": 1547043175, "last_edit_date": 1547047488, "question_id": 54112087, "link": "https://stackoverflow.com/questions/54112087/how-to-retrieve-underlying-block-device-io-error", "title": "How to retrieve underlying block device IO error", "body": "<p>Consider a device in the system, something under /dev/hdd[sg][nvme]xx\nOpen the device, get the file descriptor and start working with it (<code>read(v)</code>/<code>write(v)</code>/<code>lseek</code>, etc), at some point you may get <code>EIO</code>. How do you retrieve the underlying error reported by the device driver?</p>\n\n<p>EDIT001: in case it is impossible using <code>unistd</code> functions, maybe there is other ways to work with block devices which can provide more low-level information like <code>sg_scsi_sense_hdr</code>?</p>\n"}, {"tags": ["c++", "algorithm", "data-structures", "stl", "deque"], "answers": [{"tags": [], "owner": {"reputation": 11200, "user_id": 1055395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be6778daa107272cbbf6bc69c6c24683?s=128&d=identicon&r=PG&f=1", "display_name": "Anatolii", "link": "https://stackoverflow.com/users/1055395/anatolii"}, "is_accepted": true, "score": 1, "last_activity_date": 1580563842, "last_edit_date": 1592644375, "creation_date": 1580559508, "answer_id": 60016796, "question_id": 54112056, "link": "https://stackoverflow.com/questions/54112056/given-an-array-and-integer-k-find-maximum-value-in-each-subarray-of-size-k/60016796#60016796", "title": "Given an array and integer k find maximum value in each subarray of size k", "body": "<h2>Introduction</h2>\n<p>To solve this problem efficiently, keep track of elements that can be maximum values within the current or following sliding windows.</p>\n<h2>Algorithm</h2>\n<p>In your <strong>Hackerrank</strong> exercise, you're supposed to use <code>std::deque</code> in order to solve the problem efficiently. So, I would suggest not to diverge from this and solve it using <code>std::deque</code>.</p>\n<p>Let's consider an example. Given an array <code>arr = [4, 3, 4, 2, 5]</code> and window <code>k = 3</code>, how to find a maximum value in each subarray of length <code>3</code>?</p>\n<ol>\n<li><p>Go through first <code>3</code> elements and keep relevant indices of array elements in the queue.</p>\n<pre><code>Step 1\narr:     |4| 3 4 2 5\nqueue :  |0|\n</code></pre>\n<p>Add an index of the first element because the queue is empty.</p>\n<pre><code>Step 2\narr:     |4 3| 4 2 5\nqueue :  |0 1|\n</code></pre>\n<p>Add an index <code>1</code> but keep <code>0</code> as <code>arr[0] &gt; arr[1]</code>. But why to keep <code>1</code> then? Even though <code>arr11]</code> is smaller in this sliding window it can be the largest in another one without <code>arr[0]</code>.</p>\n<pre><code>Step 3\narr:     |4 3 4| 2 5\nqueue :  |  2  |\n</code></pre>\n<p>In the last step, we kept only <code>2</code> in the queue. Why? Because <code>arr[2]</code> wasn't smaller than<br />\n<code>arr[0]</code> or <code>arr[1]</code>. So, it didn't make sense to keep those indices as the maximum\nvalue in this subarray would still be <code>arr[2]</code>.</p>\n<p>Since the first sliding window is complete, print <code>arr[queue.front()]</code>. The first element of the queue corresponds to an index of the maximum element in the subarray.</p>\n</li>\n<li><p>Once first <code>3</code> elements are processed, on each iteration the sliding window starts moving to the right:</p>\n<pre><code>arr:      4 |3 4 2| 5\nqueue :     | 2 3 | \n</code></pre>\n<p>Print <code>arr[2]</code> as the maximum value. Again, the first element of the queue corresponds to an index of the maximum element in the subarray. <code>3</code> is kept in the queue because potentially it can correspond to an index of the maximum value in the next sliding windows.</p>\n<pre><code>arr:      4 3 |4 2 5|\nqueue :       |  4  |\n</code></pre>\n<p>Finally, <code>4</code> remains the only element, as <code>2</code> is popped out anyways (it doesn't belong to the current window) and <code>arr[4] &gt;= arr[3]</code> so it doesn't make sense to keep it.</p>\n</li>\n</ol>\n<p>To summarise, here are the steps of an algorithm:</p>\n<ol>\n<li><p>For the first <code>k</code> elements of an array, store indices of possible max subarray elements in a queue. On each <code>i</code>-th iteration, keep popping out elements from the queue if their mapped values don't exceed <code>arr[i]</code> and then push <code>arr[i]</code> into the queue.</p>\n<p>In the end, the first element of the queue contains an index of the max value.</p>\n</li>\n<li><p>For the remaining array elements, on each iteration <code>i</code>, pop out the first element <code>front</code> only if it doesn't belong to the current sliding window anymore - <code>i - front == k</code>. Then, as before, pop out indices which mapped values don't exceed <code>arr[i]</code> and afterwards push <code>arr[i]</code> into the queue (again, at the end of each iteration, the queue contains an index of the max value).</p>\n</li>\n</ol>\n<p>Hopefully, now it's clear how this idea can be implemented. The time complexity of the solution is O(n). The space complexity is also O(n).</p>\n<h2>Code</h2>\n<pre><code>#include &lt;algorithm&gt;\n#include &lt;iostream&gt;\n#include &lt;deque&gt; \n\nvoid printKMax(int arr[], int n, int k){\n    std::deque&lt;int&gt; queue;\n\n    for (int i = 0; i &lt; k; i++) {\n        while (!queue.empty() &amp;&amp; arr[queue.back()] &lt;= arr[i]) {\n            queue.pop_back();\n        }\n\n        queue.push_back(i);\n    } \n\n    for (int i = k; i &lt; n; i++) {\n        std::cout &lt;&lt; arr[queue.front()] &lt;&lt; &quot; &quot;;\n\n        // an element with index queue.front() no longer belong to ths window\n        if (i - queue.front() == k) {\n            queue.pop_front();  \n        }\n\n        // pop all elements that don't exceed arr[i] as they're no longer useful\n        while (!queue.empty() &amp;&amp; arr[queue.back()] &lt;= arr[i]) {\n            queue.pop_back();\n        }  \n\n        queue.push_back(i);\n    }\n\n    std::cout &lt;&lt; arr[queue.front()] &lt;&lt; &quot;\\n&quot;;\n}\n</code></pre>\n"}], "owner": {"reputation": 269, "user_id": 8399525, "user_type": "registered", "profile_image": "https://graph.facebook.com/1603156583089926/picture?type=large", "display_name": "Shantanu Dwivedi", "link": "https://stackoverflow.com/users/8399525/shantanu-dwivedi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 242, "favorite_count": 1, "accepted_answer_id": 60016796, "answer_count": 1, "score": 1, "last_activity_date": 1580578804, "creation_date": 1547043036, "last_edit_date": 1580578804, "question_id": 54112056, "link": "https://stackoverflow.com/questions/54112056/given-an-array-and-integer-k-find-maximum-value-in-each-subarray-of-size-k", "title": "Given an array and integer k find maximum value in each subarray of size k", "body": "<p>I'm struggling with a question on hackerrank <a href=\"https://www.hackerrank.com/challenges/deque-stl/problem\" rel=\"nofollow noreferrer\">deque-stl</a>. I have implemented an algorithm which finds the maximum element in the windows and stores its index, then use this index of the maximum element in the previous window to find the maximum element in the next window only if the index of maximum element lies between the indexes of the next window. Using this algorithm and suggestions mentioned in the comments i've implemented this updated algorithm but i'm still getting Wrong Answer Error. </p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;algorithm&gt;\n#include &lt;bits/stdc++.h&gt;\nusing namespace std;\nint m,idx;\nvoid maxinwindow(int arr[], int start, int end)\n{\n    /*If the index of the maximum element in the previous window\n    is between the indexes of next windows then no need to compare \n    elements that were in previous window */\n    if(idx&gt;=start)\n    {\n        if(arr[idx]&gt;=arr[end])\n        {\n            m=arr[idx];\n        }\n        else\n        {\n            m=arr[end];\n            idx=end;\n        }\n    }\n    else\n    {\n        if(arr[start]&gt;=arr[start+1])\n            m=arr[start];\n        else\n            m=arr[start+1];\n        for(int k=start+2;k&lt;=end;k++)\n        {\n            if(arr[k]&gt;=m)\n            {\n                m=arr[k];\n                idx=k;\n            }\n        }\n    }\n}\nint main()\n{\n    int arr[100000];\n    int q;\n    cin&gt;&gt;q;\n    for(int i=1,size,ws;i&lt;=q;i++)\n    {\n        m=0;\n        cin&gt;&gt;size;  //Array size\n        cin&gt;&gt;ws;   //Window Size\n        //Entering The Elements In The Array\n        for(int j=1;j&lt;=size;j++)\n        {\n            cin&gt;&gt;arr[j];\n        }\n        //Boundary Condition i.e. Windows size is equal to 1\n        if(ws==1)\n        {\n            for(int j=1;j&lt;=size;j++)\n            {\n                cout&lt;&lt;arr[j]&lt;&lt;\" \";\n            }\n        }\n        else\n        {\n            for(int k=1;k&lt;=ws;k++)\n            {\n                if(arr[k]&gt;=m)\n                {\n                    m=arr[k];\n                    idx=k;\n                }\n            }\n            cout&lt;&lt;m&lt;&lt;\" \";\n            for(int k=2,j;k&lt;=(size-(ws-1));k++)\n            {\n                j=(k+(ws-1));\n                maxinwindow(arr,k,j);\n                cout&lt;&lt;m&lt;&lt;\" \";\n            }\n            cout&lt;&lt;endl;\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["c++", "qt", "qgraphicsview", "qgraphicsscene", "qgraphicsitem"], "comments": [{"owner": {"reputation": 185819, "user_id": 6622587, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gAYS0.jpg?s=128&g=1", "display_name": "eyllanesc", "link": "https://stackoverflow.com/users/6622587/eyllanesc"}, "edited": false, "score": 1, "creation_date": 1547042743, "post_id": 54111835, "comment_id": 95055917, "body": "I see that the item never leaves the scene but leaves the area of the QGraphicsPixmapItem. Could you correct it in your writing?"}, {"owner": {"reputation": 8010, "user_id": 10659910, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3zC2tMoc6PA/AAAAAAAAAAI/AAAAAAAAADg/n9BjRO9gFMo/photo.jpg?sz=128", "display_name": "William Miller", "link": "https://stackoverflow.com/users/10659910/william-miller"}, "edited": false, "score": 1, "creation_date": 1547053582, "post_id": 54111835, "comment_id": 95062936, "body": "How are you moving the <code>QGraphicsRectItem</code>?"}], "owner": {"reputation": 123, "user_id": 8270284, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b3e746ac1200caaee91a33047e4b7f?s=128&d=identicon&r=PG&f=1", "display_name": "Sayan Bera", "link": "https://stackoverflow.com/users/8270284/sayan-bera"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 34, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1547042650, "creation_date": 1547042317, "last_edit_date": 1547042650, "question_id": 54111835, "link": "https://stackoverflow.com/questions/54111835/qgraphicsrectitem-moves-out-of-the-scene", "title": "QGraphicsRectItem moves out of the scene", "body": "<p>I have an Image Viewer, where I draw QGraphicsRectItem.\nThe problem is the QGraphicsRectItem moves out of the scene.\nHow can I fix the items within the sceneRect?</p>\n\n<p>I add the rect items.\n<a href=\"https://i.stack.imgur.com/ebroQ.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ebroQ.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>I moved the item left and it went out\n<a href=\"https://i.stack.imgur.com/EcaCj.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/EcaCj.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>This completely got scrambled as I resized the viewer, ie, QGraphicsViewer\n<a href=\"https://i.stack.imgur.com/JjnYm.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/JjnYm.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>resizeEvent has been overridden by as below,</p>\n\n<pre><code>QTransform matrix(1, 0, 0, 0, 1, 0, 0, 0, 1);\nmatrix.scale(width() / sceneRect().width(), height() / sceneRect().height());\nsetTransform(matrix);\n</code></pre>\n\n<p>What could be the solution?</p>\n"}, {"tags": ["c++", "cmake", "conan"], "comments": [{"owner": {"reputation": 519, "user_id": 837816, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/74285139dbc24c216077d8c833cfd59c?s=128&d=identicon&r=PG", "display_name": "jgsogo", "link": "https://stackoverflow.com/users/837816/jgsogo"}, "edited": false, "score": 0, "creation_date": 1547051986, "post_id": 54111679, "comment_id": 95061992, "body": "Hi! I would put the <code>conanfile.py</code> directly in the library repository and build the package from there, why do you want to have two different repositories?"}, {"owner": {"reputation": 3796, "user_id": 3215383, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yAGNQ.jpg?s=128&g=1", "display_name": "drodri", "link": "https://stackoverflow.com/users/3215383/drodri"}, "edited": false, "score": 1, "creation_date": 1547074110, "post_id": 54111679, "comment_id": 95071567, "body": "The sources of a package are only retrieved when it is necessary to build from sources. But the conanfile.py of a package needs to know its dependencies, even if the sources are not retrieved at all. I would use just a <code>conanfile.py</code> in the repo, and that can be used both to consume and run <code>conan install .</code> in the local development, or to create a package with <code>conan create</code>."}], "owner": {"reputation": 383, "user_id": 10299721, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-mQnnLqAacmU/AAAAAAAAAAI/AAAAAAAAAD0/szKrU2XNEZM/photo.jpg?sz=128", "display_name": "AbbysSoul", "link": "https://stackoverflow.com/users/10299721/abbyssoul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 56, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1547041835, "creation_date": 1547041835, "question_id": 54111679, "link": "https://stackoverflow.com/questions/54111679/is-there-a-way-to-reuse-requries-from-the-project-being-packaged", "title": "Is there a way to (re)use &#39;requries&#39; from the project being packaged?", "body": "<p>I have create a conan package for my libraries and noticed that I need to duplicate <code>requires</code> list for the library and for the package recipe. I wonder if there is a better way of doing it. </p>\n\n<p>I am building conan packages for exising libraries. Say I have libA and libB - which depends on libA. That is in order to build libB I need libA built and 'installed'. So I have crafter conan package for libA which is build and installed as it has no other dependenices. I now can build libB with conan by specifiing in conanfile.txt that libB depends on libA.\nBut when I am developing a package for libB I have to duplicate a list of dependencies of libB in <code>requires</code> property in <code>conanfile.py</code>.</p>\n\n<pre><code>cat libB/conanfile.txt\n[requires]\nlibA/1@user/stable\n...\n\ncat conan-libsB/conanfile.py \n...\nclass LibBConan(ConanFile):\n...\nrequires = \"libA/1@user/stable\"\n...\ndef build(self):\n    cmake = CMake(self, parallel=True)\n    cmake.configure(source_folder=self.name)\n    cmake.build()\n    cmake.test()\n    cmake.install()\n</code></pre>\n\n<p>The above is a simplified version from the real library <a href=\"https://github.com/abbyssoul/conan-libstyxe/blob/master/conanfile.py\" rel=\"nofollow noreferrer\">https://github.com/abbyssoul/conan-libstyxe/blob/master/conanfile.py</a> and <a href=\"https://github.com/abbyssoul/libstyxe/blob/master/conanfile.txt\" rel=\"nofollow noreferrer\">https://github.com/abbyssoul/libstyxe/blob/master/conanfile.txt</a></p>\n\n<p>Is it possible for conan to figure out that if the source package contains <code>conanfile.[txt|py]</code> then this defines <code>requires</code> field.</p>\n\n<p>In case that a tool is required fist to source a package <code>build_requires</code> should be used.</p>\n"}, {"tags": ["c++", "c++11", "random", "mersenne-twister"], "comments": [{"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 4, "creation_date": 1547041773, "post_id": 54111569, "comment_id": 95055346, "body": "Why not set the <a href=\"https://en.cppreference.com/w/cpp/numeric/random/uniform_int_distribution\" rel=\"nofollow noreferrer\"><code>std::uniform_int_distribution</code></a> distrubution range properly: <code>std::uniform_int_distribution&lt;short&gt; dis(std::numeric_limits&lt;short&gt;::min(), std::numeric_limits&lt;short&gt;::max());</code>"}, {"owner": {"reputation": 15257, "user_id": 648078, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/9698c2f1c188de4ebf3c4496d9f07eb0?s=128&d=identicon&r=PG", "display_name": "Marius Bancila", "link": "https://stackoverflow.com/users/648078/marius-bancila"}, "reply_to_user": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1547041831, "post_id": 54111569, "comment_id": 95055388, "body": "I expected that using the default constructor would have the same effect."}, {"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1547041895, "post_id": 54111569, "comment_id": 95055425, "body": "No, since the default <a href=\"https://en.cppreference.com/w/cpp/numeric/random/uniform_int_distribution/uniform_int_distribution\" rel=\"nofollow noreferrer\">constructor</a> uses <code>0</code> as the bottom of the range."}, {"owner": {"reputation": 15257, "user_id": 648078, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/9698c2f1c188de4ebf3c4496d9f07eb0?s=128&d=identicon&r=PG", "display_name": "Marius Bancila", "link": "https://stackoverflow.com/users/648078/marius-bancila"}, "reply_to_user": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1547041989, "post_id": 54111569, "comment_id": 95055471, "body": "Right, you are correct. Just checked the implementation and saw that. Should have read the documentation more carefully. Thanks, I&#39;ll do that."}, {"owner": {"reputation": 9311, "user_id": 4944425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05592a58619d128e2eee1c3c17801e76?s=128&d=identicon&r=PG&f=1", "display_name": "Bob__", "link": "https://stackoverflow.com/users/4944425/bob"}, "reply_to_user": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1547045950, "post_id": 54111569, "comment_id": 95058127, "body": "@Someprogrammerdude Both comments of yours may become one good answer."}, {"owner": {"reputation": 42006, "user_id": 3807729, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UEUbF.jpg?s=128&g=1", "display_name": "Galik", "link": "https://stackoverflow.com/users/3807729/galik"}, "reply_to_user": {"reputation": 9311, "user_id": 4944425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05592a58619d128e2eee1c3c17801e76?s=128&d=identicon&r=PG&f=1", "display_name": "Bob__", "link": "https://stackoverflow.com/users/4944425/bob"}, "edited": false, "score": 0, "creation_date": 1547046147, "post_id": 54111569, "comment_id": 95058250, "body": "@Bob__ Ah my mistake, confusing it with floating point types."}, {"owner": {"reputation": 42006, "user_id": 3807729, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UEUbF.jpg?s=128&g=1", "display_name": "Galik", "link": "https://stackoverflow.com/users/3807729/galik"}, "edited": false, "score": 4, "creation_date": 1547046548, "post_id": 54111569, "comment_id": 95058521, "body": "As far as I recall the theory is the generator is simply a source of random <b>bits</b> and the <i>distribution</i> can hold <i>state</i>. So the <i>distribution</i> is free to hold a cache of bits it read from the generator and parcel them out in whatever size chunks are demanded. So, in your case the <code>16</code>bit distribution may call the generator half as often as a <i>distribution</i> configured to provide <code>32</code>bit numbers."}, {"owner": {"reputation": 1477, "user_id": 5899776, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/64b8e28377778d1b8ad57198ba46c319?s=128&d=identicon&r=PG&f=1", "display_name": "van dench", "link": "https://stackoverflow.com/users/5899776/van-dench"}, "edited": false, "score": 0, "creation_date": 1547052564, "post_id": 54111569, "comment_id": 95062328, "body": "C&#39;s <code>rand</code> has a slightly worse distribution than C++&#39;s twisters, but it is faster and actually only generates 16 bits of data. Intel&#39;s fast rand is faster than that and is intentionally made to mimic C&#39;s rand func (it is also 16 bit)."}, {"owner": {"reputation": 5668, "user_id": 4083309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6b4ef5a2e912153069b82607789a717?s=128&d=identicon&r=PG&f=1", "display_name": "Arne Vogel", "link": "https://stackoverflow.com/users/4083309/arne-vogel"}, "reply_to_user": {"reputation": 1477, "user_id": 5899776, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/64b8e28377778d1b8ad57198ba46c319?s=128&d=identicon&r=PG&f=1", "display_name": "van dench", "link": "https://stackoverflow.com/users/5899776/van-dench"}, "edited": false, "score": 1, "creation_date": 1547105853, "post_id": 54111569, "comment_id": 95079138, "body": "@vandench If by &quot;slightly worse&quot; you mean &quot;terrible&quot;, then we both agree on this point. On my instance of <code>dieharder</code>, <code>rand()</code> just failed 7 out of the first 10 statistical tests, while mt19937 got 9 PASSED and one WEAK. For once, the author of a question already knows how to use <code>&lt;random&gt;</code> properly and you tempt him to join the dark side anyway\u2026 it boggles the mind. As far as premature optimization goes, <code>return 0;</code> is a very very fast PRNG, by the way. (Oh, and <code>rand()</code> only gives 15 signiifcant bits.)"}], "answers": [{"comments": [{"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 1, "creation_date": 1547041901, "post_id": 54111613, "comment_id": 95055427, "body": "is it really that complex? If you take the last digit from random two digits numbers, then they are random as well. I know this is a crude simplification, but considering bits instead of digits cannot be that different. Looking forward to see the paper ;)"}, {"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "reply_to_user": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 5, "creation_date": 1547041968, "post_id": 54111613, "comment_id": 95055460, "body": "@user463035818: That&#39;s true for a true generator, but certainly not for others. E.g. for a linear congruential generator, the succession is typically odd-&gt;even-&gt;odd-&gt;even which means that the least significant bit is rather deterministic!"}, {"owner": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "edited": false, "score": 2, "creation_date": 1547042618, "post_id": 54111613, "comment_id": 95055855, "body": "To add to the <i>odd-&gt;even-&gt;odd-&gt;even</i>: AFAIK, <code>rand()</code> is especially prone to modulo with powers of 2. The less the power of 2 the more deterministic it becomes. I once realized this practically when I intended to make a sand texture out of 4 shades of brown and <code>rand()</code>. It gave a repeating pattern (looking like a strange 70&#39;s wallpaper). Increasing the colors to 5 (a prime) yieled in turn a fully satisfying result. :-)"}], "tags": [], "owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "is_accepted": true, "score": 8, "last_activity_date": 1547041985, "last_edit_date": 1547041985, "creation_date": 1547041648, "answer_id": 54111613, "question_id": 54111569, "link": "https://stackoverflow.com/questions/54111569/generating-pseudo-random-16-bit-integers/54111613#54111613", "title": "Generating pseudo-random 16-bit integers", "body": "<p>Your way is indeed the correct way.</p>\n\n<p>The mathematical arguments are complex (I'll try to dig out a paper), but taking the least significant bits of the Mersenne Twister, as implemented by the C++ standard library, is the correct thing to do.</p>\n\n<p>If you're in any doubt as to the quality of the sequence, then run it through the diehard tests.</p>\n"}, {"tags": [], "owner": {"reputation": 9311, "user_id": 4944425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05592a58619d128e2eee1c3c17801e76?s=128&d=identicon&r=PG&f=1", "display_name": "Bob__", "link": "https://stackoverflow.com/users/4944425/bob"}, "is_accepted": false, "score": 2, "last_activity_date": 1547239875, "last_edit_date": 1547239875, "creation_date": 1547222530, "answer_id": 54150030, "question_id": 54111569, "link": "https://stackoverflow.com/questions/54111569/generating-pseudo-random-16-bit-integers/54150030#54150030", "title": "Generating pseudo-random 16-bit integers", "body": "<p>There may be a misconception, considering this quote from OP's question (emphasis mine):</p>\n\n<blockquote>\n  <p>The problem I see here is that std::mt19937 produces 32-bit unsigned integers [\u2026].\n  That means <strong>static casting is done and only the least significant part of these 32-bit integers is used by the distribution</strong>.</p>\n</blockquote>\n\n<p>That's not how it works.</p>\n\n<p>The following are quotes from <a href=\"https://en.cppreference.com/w/cpp/numeric/random\" rel=\"nofollow noreferrer\">https://en.cppreference.com/w/cpp/numeric/random</a> </p>\n\n<blockquote>\n  <p>The random number library provides classes that generate random and\n  pseudo-random numbers. These classes include:  </p>\n  \n  <ul><li>Uniform random bit generators (URBGs), [\u2026]; </li>\n  <li>Random number distributions (e.g. uniform, normal, or poisson distributions) which convert the output of URBGs into various statistical distributions</li></ul>  \n  \n  <p>URBGs and distributions are designed to be used together to produce random values.</p>\n</blockquote>\n\n<p>So a uniform random bit generator, like <code>mt19937</code> or <code>random_device</code></p>\n\n<blockquote>\n  <p>is a function object returning unsigned integer values such that each value in the range of possible results has (ideally) equal probability of being returned. </p>\n</blockquote>\n\n<p>While a random number distribution, like <code>uniform_int_distribution</code></p>\n\n<blockquote>\n  <p><strong>post-processes the output of a URBG in such a way</strong> that resulting output is distributed according to a defined statistical probability density function. </p>\n</blockquote>\n\n<p>The way it's done uses <strong>all</strong> the bits from the source to produce an output. As an example, we can look at the implementation of <code>std::uniform_distribution</code> in  <a href=\"https://gcc.gnu.org/onlinedocs/libstdc%2B%2B/libstdc%2B%2B-api-4.5/a00987_source.html\" rel=\"nofollow noreferrer\"><code>libstdc++</code></a> (starting at line 824), which can be roughly simplified as</p>\n\n<pre><code>template &lt;typename Type&gt;\nclass uniform_distribution\n{\n    Type a_ = 0, b_ = std::numeric_limits&lt;Type&gt;::max();\npublic:\n    uniform_distribution(Type a, Type b) : a_{a}, b_{b} {}\n    template&lt;typename URBG&gt;\n    Type operator() (URBG &amp;gen)\n    {\n        using urbg_type = std::make_unsigned_t&lt;typename URBG::result_type&gt;;\n        using u_type    = std::make_unsigned_t&lt;Type&gt;;\n        using max_type  = std::conditional_t&lt;(sizeof(urbg_type) &gt; sizeof(u_type))\n                                            , urbg_type, u_type&gt;;\n\n        urbg_type urbg_min = gen.min();\n        urbg_type urbg_max = gen.max();\n        urbg_type urbg_range = urbg_max - urbg_min;\n\n        max_type urange = b_ - a_;\n        max_type udenom = urbg_range &lt;= urange ? 1 : urbg_range / (urange + 1);\n\n        Type ret;\n        // Note that the calculation may require more than one call to the generator\n        do\n            ret = (urbg_type(gen()) - urbg_min ) / udenom;\n            // which is 'ret = gen / 65535' with OP's parameters\n            // not a simple cast or bit shift\n        while (ret &gt; b_ - a_);\n        return ret + a_;\n    }\n};\n</code></pre>\n\n<p>This could be tested <a href=\"https://wandbox.org/permlink/prJDP22ocbKgpNLE\" rel=\"nofollow noreferrer\">HERE</a>.</p>\n"}], "owner": {"reputation": 15257, "user_id": 648078, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/9698c2f1c188de4ebf3c4496d9f07eb0?s=128&d=identicon&r=PG", "display_name": "Marius Bancila", "link": "https://stackoverflow.com/users/648078/marius-bancila"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 727, "favorite_count": 1, "accepted_answer_id": 54111613, "answer_count": 2, "score": 9, "last_activity_date": 1547239875, "creation_date": 1547041508, "last_edit_date": 1547111287, "question_id": 54111569, "link": "https://stackoverflow.com/questions/54111569/generating-pseudo-random-16-bit-integers", "title": "Generating pseudo-random 16-bit integers", "body": "<p>I need to generate 16-bit pseudo-random integers and I am wondering what the best choice is.</p>\n\n<p>The obvious way that comes in my mind is something as follows:</p>\n\n<pre><code>std::random_device rd;\nauto seed_data = std::array&lt;int, std::mt19937::state_size&gt; {};\nstd::generate(std::begin(seed_data), std::end(seed_data), std::ref(rd));\nstd::seed_seq seq(std::begin(seed_data), std::end(seed_data));\nstd::mt19937 generator(seq);\nstd::uniform_int_distribution&lt;short&gt; dis(std::numeric_limits&lt;short&gt;::min(), \n                                         std::numeric_limits&lt;short&gt;::max());\n\nshort n = dis(generator);\n</code></pre>\n\n<p>The problem I see here is that <code>std::mt19937</code> produces 32-bit unsigned integers since it's defined as this:</p>\n\n<pre><code>using mt19937 = mersenne_twister_engine&lt;unsigned int, \n                                        32, 624, 397, \n                                        31, 0x9908b0df,\n                                        11, 0xffffffff, \n                                        7, 0x9d2c5680, \n                                        15, 0xefc60000, \n                                        18, 1812433253&gt;;\n</code></pre>\n\n<p>That means static casting is done and only the least significant part of these 32-bit integers is used by the distribution. So I am wondering how good are these series of pseudo-random shorts and I don't have the mathematical expertise to answer that.</p>\n\n<p>I expect that a better solution would be to use your own defined <code>mersenne_twister_engine</code> engine for 16-bit integers. However, I haven't found any mentioned set for the template arguments (requirements can be found <a href=\"https://docs.microsoft.com/en-us/cpp/standard-library/mersenne-twister-engine-class?view=vs-2017\" rel=\"nofollow noreferrer\">here</a> for instance). Are there any? </p>\n\n<p><strong>UPDATE</strong>: I updated the code sample with proper initialization for the distribution.</p>\n"}, {"tags": ["python", "c++", "micropython"], "comments": [{"owner": {"reputation": 1594, "user_id": 3824945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RS5Rq.jpg?s=128&g=1", "display_name": "Dmitry", "link": "https://stackoverflow.com/users/3824945/dmitry"}, "edited": false, "score": 0, "creation_date": 1547041661, "post_id": 54111458, "comment_id": 95055283, "body": "Proper variant is <code>namedtuple</code>, but not <code>namedTuple</code>. Using this datatype is preferrable, there is no neccessary to build your own datatypes"}, {"owner": {"reputation": 1594, "user_id": 3824945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RS5Rq.jpg?s=128&g=1", "display_name": "Dmitry", "link": "https://stackoverflow.com/users/3824945/dmitry"}, "edited": false, "score": 0, "creation_date": 1547041721, "post_id": 54111458, "comment_id": 95055305, "body": "To decide Import error - please provide python version and system info"}, {"owner": {"reputation": 13, "user_id": 10889844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b5bf3a42d6500f6841530f3ba35cf8d?s=128&d=identicon&r=PG&f=1", "display_name": "makar", "link": "https://stackoverflow.com/users/10889844/makar"}, "reply_to_user": {"reputation": 1594, "user_id": 3824945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RS5Rq.jpg?s=128&g=1", "display_name": "Dmitry", "link": "https://stackoverflow.com/users/3824945/dmitry"}, "edited": false, "score": 0, "creation_date": 1547142716, "post_id": 54111458, "comment_id": 95100087, "body": "for that project I use micropython on wipy 3.0 with the latest firmware upgrade"}], "answers": [{"tags": [], "owner": {"reputation": 76, "user_id": 3122629, "user_type": "registered", "profile_image": "https://graph.facebook.com/722299867/picture?type=large", "display_name": "roeesha", "link": "https://stackoverflow.com/users/3122629/roeesha"}, "is_accepted": true, "score": 3, "last_activity_date": 1547041651, "creation_date": 1547041651, "answer_id": 54111614, "question_id": 54111458, "link": "https://stackoverflow.com/questions/54111458/how-to-use-c-struct-in-struct-in-python/54111614#54111614", "title": "How to use C++ struct in struct in Python", "body": "<p>In the following:</p>\n\n<pre><code>self.tag = tag_info\n</code></pre>\nYou are assigning a class to a variable.\nI assume you meant to do:\n\n<pre><code>self.tag = tag_info()\n</code></pre>\nbut if I understand correctly this is supposed to be a list of tag_info, so you actually need is:\n\n<pre><code>self.tag = [tag_info() for i in range(20)]\n</code></pre>\n\n<p>same goes for:</p>\n\n<pre><code>self.tags = tag_list()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 25463, "user_id": 5003756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8BUMb.jpg?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/5003756/james"}, "is_accepted": false, "score": 2, "last_activity_date": 1547041832, "creation_date": 1547041832, "answer_id": 54111677, "question_id": 54111458, "link": "https://stackoverflow.com/questions/54111458/how-to-use-c-struct-in-struct-in-python/54111677#54111677", "title": "How to use C++ struct in struct in Python", "body": "<p>This is a bit confusing as to what the expected behavior is supposed to be.  But it looks like you need to create 20 instances of <code>tag_info</code>.  Also you need to instantiate your instances using <code>()</code>.</p>\n\n<pre><code>class tag_info:\n    def __init__(self):\n        self.id = \"\"\n        self.rssi = 0\n\nclass tag_list:\n    def __init__(self):\n        self.tag = [tag_info() for _ in range(20)]\n\nclass data_packet():\n    def __init__(self):\n        self.timestamp=0\n        self.tags = tag_list()\n        self.heading=0\n        self.airt=0\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 10889844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b5bf3a42d6500f6841530f3ba35cf8d?s=128&d=identicon&r=PG&f=1", "display_name": "makar", "link": "https://stackoverflow.com/users/10889844/makar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 908, "favorite_count": 0, "accepted_answer_id": 54111614, "answer_count": 2, "score": 1, "last_activity_date": 1547041832, "creation_date": 1547041101, "last_edit_date": 1547041375, "question_id": 54111458, "link": "https://stackoverflow.com/questions/54111458/how-to-use-c-struct-in-struct-in-python", "title": "How to use C++ struct in struct in Python", "body": "<p>I have to transfer the C++ code into Micro Python to Wipy platform. Currently, I've some problems with it, especially with accesing the variables from other structures</p>\n\n<p>C++ code:</p>\n\n<pre><code>typedef struct {\n    char id[100];\n    int rssi;\n} tag_info;\n\ntypedef struct {\n    tag_info tag[20];\n} tag_list;\n\ntypedef struct {\n    int timestamp;\n    tag_list tags;\n    int heading;\n    int airt;\n} data_packet;\n\ndata_packet packet;\n\nfor (i = 0; i &lt; total_amount_of_tags - 1; i++) {\n            print_function(\"id\", packet.tags.tag[i].id, destination); \n            print_function(\"rssi\", packet.tags.tag[i].rssi, destination);\n        }\n</code></pre>\n\n<p>My MicroPython code:</p>\n\n<pre><code>class tag_info:\n    def __init__(self):\n        self.id = \"\"\n        self.rssi = 0\n\nclass tag_list:\n    def __init__(self):\n        self.tag = tag_info\n\nclass data_packet():\n    def __init__(self):\n        self.timestamp=0\n        self.tags = tag_list\n        self.heading=0\n        self.airt=0\n\npacket=data_packet()\n\nfor i in range(0, total_amount_of_tags -1)\n    print_function('id',packet.tags.tag[i].id,destination)\n    print_function(\"rssi\", packet.tags.tag[i].rssi, destination); \n</code></pre>\n\n<p>The problem in my code that I cant access tag[i] and further variables. Should I use inheritance or namedTuple in this case. If i try to use namedTuple <code>from collections import namedTuple</code> the following error message occurs: <code>no module called collections</code>, so I would prefer to avoid that library if possible</p>\n"}, {"tags": ["c++", "vtk", "point-cloud-library", "spline"], "answers": [{"tags": [], "owner": {"reputation": 552, "user_id": 3709062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xRZmX.jpg?s=128&g=1", "display_name": "GStav", "link": "https://stackoverflow.com/users/3709062/gstav"}, "is_accepted": true, "score": 0, "last_activity_date": 1547558535, "creation_date": 1547558535, "answer_id": 54199722, "question_id": 54111430, "link": "https://stackoverflow.com/questions/54111430/plot-splines-in-pcl-viewer/54199722#54199722", "title": "Plot Splines in pcl viewer", "body": "<p>I managed to plot splines together with the points by adding actors to the pcl viewer:</p>\n\n<pre><code>viewer-&gt;getRenderWindow ()-&gt;GetRenderers()-&gt;GetFirstRenderer()-&gt;AddActor(actor);\n</code></pre>\n\n<p>I found the answer in this <a href=\"http://www.pcl-users.org/add-vtk-actors-to-pcl-visualizer-td4026106.html\" rel=\"nofollow noreferrer\">discussion</a></p>\n"}], "owner": {"reputation": 552, "user_id": 3709062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xRZmX.jpg?s=128&g=1", "display_name": "GStav", "link": "https://stackoverflow.com/users/3709062/gstav"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 0, "accepted_answer_id": 54199722, "answer_count": 1, "score": 1, "last_activity_date": 1547558535, "creation_date": 1547041022, "question_id": 54111430, "link": "https://stackoverflow.com/questions/54111430/plot-splines-in-pcl-viewer", "title": "Plot Splines in pcl viewer", "body": "<p>I am working with point clouds that form curves and I use PCL viewer to visualize them (plot b). </p>\n\n<p>I would like to add the respective splines together with the points in the same viewer but so far I have only found ways to plot lines but not splines. However, I have managed to plot splines in Vtk based on this <a href=\"https://www.vtk.org/Wiki/VTK/Examples/Cxx/PolyData/ParametricSpline\" rel=\"nofollow noreferrer\">link</a> (plot a).</p>\n\n<p><a href=\"https://i.stack.imgur.com/dihuB.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/dihuB.png\" alt=\"enter image description here\"></a></p>\n\n<p>This is my code for the above plots:</p>\n\n<pre><code> // Load the point cloud \npcl::PointCloud&lt;pcl::PointXYZ&gt;::Ptr cloud_curve(new pcl::PointCloud&lt;pcl::PointXYZ&gt;);\nif (pcl::io::loadPCDFile&lt;pcl::PointXYZ&gt;(\"line.pcd\", *cloud_curve) == -1) \n{\n    PCL_ERROR(\"Couldn't read the pcd file.\\n\");\n    exit(1); \n}\n// Visualisze curve points in pcl Viewer\nboost::shared_ptr&lt;pcl::visualization::PCLVisualizer&gt; viewer(new pcl::visualization::PCLVisualizer( \"Simple Cloud Viewer\"));\nviewer-&gt;setBackgroundColor(0, 0, 0);\npcl::visualization::PointCloudColorHandlerCustom&lt;pcl::PointXYZ&gt; handler(cloud_curve, 255 , 0, 0);\nviewer-&gt;addPointCloud(cloud_curve, handler, \"cloud\");\nviewer-&gt;initCameraParameters();\n\nwhile (!viewer-&gt;wasStopped()) {\n    viewer-&gt;spinOnce(100);\n    boost::this_thread::sleep(boost::posix_time::microseconds(100000));\n}\n// Visualisze splines in vtk Viewer\n\ndouble p0[3] = {-5.91152, 4.65316, 28063.7};\ndouble p1[3] = { -6.2126, 3.8805, 28034.9};\ndouble p2[3] = {-6.54915, 4.6517, 28007};\n// Create a vtkPoints object and store the points in it\nvtkSmartPointer&lt;vtkPoints&gt; points = vtkSmartPointer&lt;vtkPoints&gt;::New();\npoints-&gt;InsertNextPoint(p0);\npoints-&gt;InsertNextPoint(p1);\npoints-&gt;InsertNextPoint(p2);\n// Setup render window, renderer, and interactor\nvtkSmartPointer&lt;vtkRenderer&gt; renderer = vtkSmartPointer&lt;vtkRenderer&gt;::New();\nvtkSmartPointer&lt;vtkRenderWindow&gt; renderWindow = vtkSmartPointer&lt;vtkRenderWindow&gt;::New();\nrenderWindow-&gt;SetSize(1000,2000); //(width, height)\nvtkSmartPointer&lt;vtkRenderWindowInteractor&gt; renderWindowInteractor = vtkSmartPointer&lt;vtkRenderWindowInteractor&gt;::New();\nvtkSmartPointer&lt;vtkParametricSpline&gt; spline = vtkSmartPointer&lt;vtkParametricSpline&gt;::New();\nspline-&gt;SetPoints(points);\nvtkSmartPointer&lt;vtkParametricFunctionSource&gt; functionSource = vtkSmartPointer&lt;vtkParametricFunctionSource&gt;::New();\nfunctionSource-&gt;SetParametricFunction(spline);\nfunctionSource-&gt;Update();\n\n// Setup actor and mapper\nvtkSmartPointer&lt;vtkPolyDataMapper&gt; mapper = vtkSmartPointer&lt;vtkPolyDataMapper&gt;::New();\nmapper-&gt;SetInputConnection(functionSource-&gt;GetOutputPort());\nvtkSmartPointer&lt;vtkActor&gt; actor = vtkSmartPointer&lt;vtkActor&gt;::New();\nactor-&gt;SetMapper(mapper);\nactor-&gt;GetProperty()-&gt;SetColor(1,0,0);\nrenderWindow-&gt;AddRenderer(renderer);\nrenderWindowInteractor-&gt;SetRenderWindow(renderWindow);\nrenderer-&gt;AddActor(actor);\nrenderWindow-&gt;Render();\nvtkSmartPointer&lt;vtkInteractorStyleSwitch&gt; style = vtkSmartPointer&lt;vtkInteractorStyleSwitch&gt;::New();\nstyle-&gt;SetCurrentStyleToTrackballCamera();\nrenderWindowInteractor-&gt;SetInteractorStyle( style );\nrenderWindowInteractor-&gt;Start();\n</code></pre>\n\n<p>Any suggestions on how to plot both points and splines in PCL viewer ?</p>\n"}, {"tags": ["c++", "visual-c++", "c++17", "typetraits"], "comments": [{"owner": {"reputation": 3422, "user_id": 19816, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/4fce1470d2e42ca3814b7dd7644857c8?s=128&d=identicon&r=PG", "display_name": "Pascal T.", "link": "https://stackoverflow.com/users/19816/pascal-t"}, "edited": false, "score": 0, "creation_date": 1547042057, "post_id": 54111146, "comment_id": 95055519, "body": "Does anyone agree with me that this is a compiler bug? If so, I will report it"}, {"owner": {"reputation": 3422, "user_id": 19816, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/4fce1470d2e42ca3814b7dd7644857c8?s=128&d=identicon&r=PG", "display_name": "Pascal T.", "link": "https://stackoverflow.com/users/19816/pascal-t"}, "edited": false, "score": 1, "creation_date": 1547043751, "post_id": 54111146, "comment_id": 95056578, "body": "I reported the issue here : <a href=\"https://developercommunity.visualstudio.com/content/problem/423254/invoke-result-for-template-function-with-auto-retu.html\" rel=\"nofollow noreferrer\">developercommunity.visualstudio.com/content/problem/423254/&hellip;</a>"}, {"owner": {"reputation": 245138, "user_id": 2069064, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/e4V2X.jpg?s=128&g=1", "display_name": "Barry", "link": "https://stackoverflow.com/users/2069064/barry"}, "edited": false, "score": 0, "creation_date": 1547049480, "post_id": 54111146, "comment_id": 95060427, "body": "Definite compiler bug, thanks for reporting it (although you should provide the code <i>in the report</i>, not just as a link)"}, {"owner": {"reputation": 3422, "user_id": 19816, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/4fce1470d2e42ca3814b7dd7644857c8?s=128&d=identicon&r=PG", "display_name": "Pascal T.", "link": "https://stackoverflow.com/users/19816/pascal-t"}, "reply_to_user": {"reputation": 245138, "user_id": 2069064, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/e4V2X.jpg?s=128&g=1", "display_name": "Barry", "link": "https://stackoverflow.com/users/2069064/barry"}, "edited": false, "score": 0, "creation_date": 1547057931, "post_id": 54111146, "comment_id": 95064979, "body": "@Barry : I tried and tried again, but I fought endlessly with the javascript code formatter; and in the end I lost. I will add it again, even if not formatted"}, {"owner": {"reputation": 3422, "user_id": 19816, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/4fce1470d2e42ca3814b7dd7644857c8?s=128&d=identicon&r=PG", "display_name": "Pascal T.", "link": "https://stackoverflow.com/users/19816/pascal-t"}, "reply_to_user": {"reputation": 245138, "user_id": 2069064, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/e4V2X.jpg?s=128&g=1", "display_name": "Barry", "link": "https://stackoverflow.com/users/2069064/barry"}, "edited": false, "score": 0, "creation_date": 1547058128, "post_id": 54111146, "comment_id": 95065070, "body": "I tried, but I give up: I think that the js editor is buggy to the point that I would need to post another question in order to get it to format the code correctly."}, {"owner": {"reputation": 38390, "user_id": 923854, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OecRr.png?s=128&g=1", "display_name": "Casey", "link": "https://stackoverflow.com/users/923854/casey"}, "edited": false, "score": 0, "creation_date": 1547082083, "post_id": 54111146, "comment_id": 95073424, "body": "@PascalT. Just paste it as garbage. It isn&#39;t customers&#39; problem that the Developer Community code editor explodes when there are empty lines in a codeblock. (Disclaimer: MSFT employee.)"}], "owner": {"reputation": 3422, "user_id": 19816, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/4fce1470d2e42ca3814b7dd7644857c8?s=128&d=identicon&r=PG", "display_name": "Pascal T.", "link": "https://stackoverflow.com/users/19816/pascal-t"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 249, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1547049528, "creation_date": 1547040102, "last_edit_date": 1547049528, "question_id": 54111146, "link": "https://stackoverflow.com/questions/54111146/invoke-result-for-template-function-with-auto-return-type-and-msvc-2017", "title": "invoke_result for template function with &quot;auto&quot; return type and MSVC 2017", "body": "<p>I'm trying to use <code>invoke_result</code> with a templated function whose return type is auto; and I have an issue with Visual Studio 2017 </p>\n\n<p>I get an error message that says \"a template-argument cannot be a type that contains 'auto'\"</p>\n\n<p>The code below works perfectly with GCC, Clang, and ICC. It fails with MSVC 2017. Of course, I did set the c++17 flag.</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>#include &lt;type_traits&gt;\n\ntemplate&lt;typename U&gt;\nauto add_auto_template_fn(U a) {\n    return a + 42;\n}\n\n\nvoid static_test_invoke_result()\n{\n    using T = std::invoke_result&lt; decltype(&amp;add_auto_template_fn&lt;int&gt;), int&gt;::type;\n    static_assert(std::is_same&lt;T, int&gt;::value, \"\");\n}\n</code></pre>\n\n<p>GCC:\n<a href=\"https://godbolt.org/z/Vkn46P\" rel=\"nofollow noreferrer\">https://godbolt.org/z/Vkn46P</a> (works with GCC, clang, ICC, etc)</p>\n\n<p>MSVC 2017:\n<a href=\"https://godbolt.org/z/jCK1cO\" rel=\"nofollow noreferrer\">https://godbolt.org/z/jCK1cO</a> (fails)</p>\n\n<p>Does anyone know if there is a way around this?</p>\n\n<hr>\n\n<p>EDIT :</p>\n\n<p>It does look like a compiler bug</p>\n\n<p>If I add a line above that forces the compiler to memoize the type, it works.</p>\n\n<p><a href=\"https://godbolt.org/z/9Y8yUH\" rel=\"nofollow noreferrer\">https://godbolt.org/z/9Y8yUH</a></p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>#include &lt;type_traits&gt;\n\ntemplate&lt;typename U&gt;\nauto add_auto_template_fn(U a) {\n    return a + 42;\n}\n\n\nvoid static_test_invoke_result()\n{\n    auto f = add_auto_template_fn&lt;int&gt;; // This innocent line will \"solve\" the issue\n    using T = std::invoke_result&lt; decltype(add_auto_template_fn&lt;int&gt;), int&gt;::type;\n    static_assert(std::is_same&lt;T, int&gt;::value, \"\");\n}\n</code></pre>\n"}, {"tags": ["c++", "c++17"], "comments": [{"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 3, "creation_date": 1547040018, "post_id": 54111046, "comment_id": 95054327, "body": "Why a weak pointer? Why not a shared pointer? And inside your application, perhaps you should write a wrapper-class for the library (with all access to the library should go through the wrapper-class, and not directly)?"}, {"owner": {"reputation": 32882, "user_id": 1870760, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/NAAkp.png?s=128&g=1", "display_name": "Hatted Rooster", "link": "https://stackoverflow.com/users/1870760/hatted-rooster"}, "edited": false, "score": 1, "creation_date": 1547047882, "post_id": 54111046, "comment_id": 95059361, "body": "A weak ptr cant hold a raw pointer. That&#39;s the whole idea behind a weak ptr. It only points to a different type smart pointer that manages ownership and deletion."}, {"owner": {"reputation": 14339, "user_id": 1466970, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/V1J6z.jpg?s=128&g=1", "display_name": "Richard Chambers", "link": "https://stackoverflow.com/users/1466970/richard-chambers"}, "edited": false, "score": 2, "creation_date": 1547048359, "post_id": 54111046, "comment_id": 95059636, "body": "Perhaps you should first start out with determining who owns the pointers versus who is referring to the pointed to objects but doesn&#39;t actually own the pointers and the objects being pointed to.  See <a href=\"https://stackoverflow.com/questions/12030650/when-is-stdweak-ptr-useful\">When is std::weak_ptr useful?</a> as well as <a href=\"https://stackoverflow.com/questions/4984381/shared-ptr-and-weak-ptr-differences\">shared_ptr and weak_ptr differences</a> as the answers to these have some interesting discussions about pointer ownership."}, {"owner": {"reputation": 119228, "user_id": 412080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/239e18525e4c29872d85b2b553b2e4d2?s=128&d=identicon&r=PG", "display_name": "Maxim Egorushkin", "link": "https://stackoverflow.com/users/412080/maxim-egorushkin"}, "edited": false, "score": 0, "creation_date": 1547051553, "post_id": 54111046, "comment_id": 95061702, "body": "Consider using <code>std::unique_ptr</code>. Only use <code>std::shared_ptr + std::weak_ptr</code> when nothing else does."}], "answers": [{"comments": [{"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1547056168, "post_id": 54115686, "comment_id": 95064243, "body": "Terminology: &quot;when the last pointer&quot; last owner? last <code>shared_ptr</code>? last strong ref?"}, {"owner": {"reputation": 34388, "user_id": 2610810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8c6433073e71478e8da278a188e1d15?s=128&d=identicon&r=PG", "display_name": "Caleth", "link": "https://stackoverflow.com/users/2610810/caleth"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1547058632, "post_id": 54115686, "comment_id": 95065307, "body": "@curiousguy for both <code>std::shared_ptr</code> and <code>std::unique_ptr</code>, the last owning pointer"}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1547059144, "post_id": 54115686, "comment_id": 95065523, "body": "OK ... although neither <code>std::shared_ptr</code> nor <code>std::unique_ptr</code>, they are classes. Only pointers (scalars) are really pointers."}, {"owner": {"reputation": 34388, "user_id": 2610810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8c6433073e71478e8da278a188e1d15?s=128&d=identicon&r=PG", "display_name": "Caleth", "link": "https://stackoverflow.com/users/2610810/caleth"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1547059422, "post_id": 54115686, "comment_id": 95065633, "body": "@curiousguy if you are going to be pedantic, they are <i>templates</i>. But they are templates for classes with pointer semantics, which is sufficient for a colloquial discussion, especially when using the qualifer &quot;raw pointers&quot; for things shaped <code>T*</code>"}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1547059995, "post_id": 54115686, "comment_id": 95065862, "body": "Not trying to be &quot;pedantic&quot;, but these so called &quot;smart pointers&quot; don&#39;t even have a conversion to a real pointer. (Also, almost all use practical uses of a <code>std::shared_ptr</code> are going to be on specializations of the template, that&#39;s why I mentioned classes not templates.)"}], "tags": [], "owner": {"reputation": 34388, "user_id": 2610810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8c6433073e71478e8da278a188e1d15?s=128&d=identicon&r=PG", "display_name": "Caleth", "link": "https://stackoverflow.com/users/2610810/caleth"}, "is_accepted": false, "score": 0, "last_activity_date": 1547055860, "creation_date": 1547055860, "answer_id": 54115686, "question_id": 54111046, "link": "https://stackoverflow.com/questions/54111046/is-it-possible-to-create-weak-pointer-for-c-style-pointer-or-raw-pointer-in-c1/54115686#54115686", "title": "Is it possible to create weak pointer for c style pointer or raw pointer in c++17", "body": "<p>One of the <em>fatal</em> problems with owing raw pointers, is that there is <em>nothing</em> you can do to observe that <em>somewhere else</em> has invalidated your pointer. Smart pointers work by tracking who knows about the object, and only destroying when the last pointer is destroyed. </p>\n\n<p><code>std::weak_ptr</code> is a complement to <code>std::shared_ptr</code> and nothing else. It does not magically know when <code>delete</code> is called on the object it is pointing to, it uses the same mechanism that <code>std::shared_ptr</code> does to know about the object's lifetime. Notice there is no constructor of <code>std::weak_ptr</code> that accepts a raw pointer.</p>\n\n<p>If the library is managing the ownership, it is <em>incorrect</em> for you to put them into a smart pointer that uses <code>std::default_delete</code>. The best you can do is use the library's <code>release</code> function as the deleter of your smart pointers, and wrap the <code>create</code> function so that you return such a smart pointer instead of the raw one.</p>\n"}], "owner": {"reputation": 11, "user_id": 4348877, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-N4IiagbiIVs/AAAAAAAAAAI/AAAAAAAAAGg/z43KOTLfbyM/photo.jpg?sz=128", "display_name": "Umang Akash", "link": "https://stackoverflow.com/users/4348877/umang-akash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 179, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547055860, "creation_date": 1547039813, "last_edit_date": 1547047671, "question_id": 54111046, "link": "https://stackoverflow.com/questions/54111046/is-it-possible-to-create-weak-pointer-for-c-style-pointer-or-raw-pointer-in-c1", "title": "Is it possible to create weak pointer for c style pointer or raw pointer in c++17", "body": "<p>I have a third party library which has a lot of c-style raw pointer. Now i am writing a thread in c++ 17. i want to use weak pointer for c style pointers of library. this library can be used by many other thread which modify/delete same pointers. how it can be achieved? is there any design pattern which can help?</p>\n\n<p>In library :</p>\n\n<pre><code>struct table *table = (struct table *) malloc(sizeof(table));\n</code></pre>\n\n<p>Now in my thread:</p>\n\n<pre><code>auto wp = std::make_weak&lt;struct table* &gt;(table)\n</code></pre>\n"}, {"tags": ["c++", "mysql-connector"], "comments": [{"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1547040147, "post_id": 54111042, "comment_id": 95054423, "body": "Don&#39;t forget that by default all function arguments are passed by <i>value</i>, meaning they are <i>copies</i>. Modifying (assigning to) a copy will not modify the original. Please learn more about <i>references</i> and how they can be used to solve your problem."}, {"owner": {"reputation": 83151, "user_id": 3943312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc00b38b94ca7b6f820622b0a8af8ded?s=128&d=identicon&r=PG", "display_name": "Sam Varshavchik", "link": "https://stackoverflow.com/users/3943312/sam-varshavchik"}, "edited": false, "score": 0, "creation_date": 1547040409, "post_id": 54111042, "comment_id": 95054580, "body": "<code>executeQuery()</code> returns <code>NULL</code>. That&#39;s what&#39;s assigned to <code>result</code>. What gets passed into this function for the <code>result</code>, by value, is utterly and completely irrelevant. It gets overwritten by <code>executeQuery()</code>&#39;s return value. The End."}, {"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1547041128, "post_id": 54111042, "comment_id": 95054979, "body": "Instead of trying to describe your code and what you&#39;re doing, please try to create a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> to <i>show</i> us. <i>Where</i> is the pointer null? <i>Where</i> is it not supposed to be null? Also please read about <a href=\"http://stackoverflow.com/help/how-to-ask\">how to ask good questions</a>, as well as <a href=\"https://codeblog.jonskeet.uk/2012/11/24/stack-overflow-question-checklist/\" rel=\"nofollow noreferrer\">this question checklist</a>."}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 6621164, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/924337e00ca87f95d18160d5929e1071?s=128&d=identicon&r=PG&f=1", "display_name": "HunterLee", "link": "https://stackoverflow.com/users/6621164/hunterlee"}, "edited": false, "score": 0, "creation_date": 1547042270, "post_id": 54111266, "comment_id": 95055666, "body": "Thanks for the response. I understand what you&#39;re saying now. Since I want the pointer I&#39;m passing to store the contents of the address from the resulting query, you have to pass it by *&amp; or **. This has corrected my issue. I&#39;ve never really had a problem like this before, but I understand now. Per the second statement, I&#39;ll have to double check that. I left that code in and result is still valid and returning the correct information after statement has been deleted."}], "tags": [], "owner": {"reputation": 6050, "user_id": 1030410, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e13caf6116a45714153bd145754fd292?s=128&d=identicon&r=PG", "display_name": "Daniel Trugman", "link": "https://stackoverflow.com/users/1030410/daniel-trugman"}, "is_accepted": true, "score": 2, "last_activity_date": 1547041662, "last_edit_date": 1547041662, "creation_date": 1547040464, "answer_id": 54111266, "question_id": 54111042, "link": "https://stackoverflow.com/questions/54111042/c-mysql-connector-results-from-query-going-out-of-scope/54111266#54111266", "title": "C++ MySql Connector - results from query going out of scope", "body": "<p>There are a couple of issues:</p>\n\n<p><strong>1. <code>result</code> is passed by value</strong></p>\n\n<p>You pass <code>result</code> by value. Meaning that the function receives a copy of the pointer you pass when calling the method.</p>\n\n<p>For example, if the code that calls <code>ExecuteQuery</code> look like this:</p>\n\n<pre><code>std::string query(\"SELECT ...\");\nsql::ResultSet *result = NULL;\nExecuteQuery(query, result);\n</code></pre>\n\n<p>Then <code>ExecuteQuery</code> cannot change the value of <code>result</code>, since it is COPIED into the method.\nIf you wish to change its value, you should pass a reference to result. You can do that by changing <code>ExecuteQuery</code> to:</p>\n\n<pre><code>bool MySQLConnector::ExecuteQuery( std::string query, sql::ResultSet *&amp; result )\n</code></pre>\n\n<p>Then, <code>ExecuteQuery</code> manipulates the original pointer, rather than a copy.</p>\n\n<p><strong>2. MySQL C++ API frees the <code>ResultSet</code> when the <code>Statement</code> is deleted</strong></p>\n\n<p>Just like @nos pointed out, when you call <code>delete statement</code>, you also free the resources that hold the information for your <code>result</code>.</p>\n\n<p><code>result</code> will still have a valid value because it won't be aware of the deallocated memory, but if you access it, it might cause a segmentation fault.</p>\n\n<p>The right way to handle this is to either:</p>\n\n<ul>\n<li>Copy the result</li>\n<li>OR</li>\n<li>Let the caller pass a statement object as well, and deallocate it after using the value from result.</li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1547040975, "post_id": 54111325, "comment_id": 95054912, "body": "<code>sql::ResultSet &amp;*result</code> makes <code>result</code> a pointer to a reference, something which is not really possible. <code>sql::ResultSet *&amp;result</code> is more correct. And please don&#39;t advice to do the old C-style pointer-as-a-way-to-<i>emulate</i>-pass-by-reference. C++ have proper references, use them."}, {"owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 1, "creation_date": 1547041188, "post_id": 54111325, "comment_id": 95055018, "body": "binary01 likely meant *&amp; instead of &amp;*. However there&#39;s perhaps a bigger issue - the MySQL C++ API claims to be compatible with the JDBC API -  and that would mean  <code>ResultSet</code> is also closed when the associated <code>Statement</code> is closed/deleted - and the code of the OP deletes the statement.before the <code>ResultSet</code> is used."}], "tags": [], "owner": {"reputation": 1342, "user_id": 5508532, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/67f7923644113e4d8897b755a75b8272?s=128&d=identicon&r=PG&f=1", "display_name": "binary01", "link": "https://stackoverflow.com/users/5508532/binary01"}, "is_accepted": false, "score": 1, "last_activity_date": 1547041053, "last_edit_date": 1547041053, "creation_date": 1547040658, "answer_id": 54111325, "question_id": 54111042, "link": "https://stackoverflow.com/questions/54111042/c-mysql-connector-results-from-query-going-out-of-scope/54111325#54111325", "title": "C++ MySql Connector - results from query going out of scope", "body": "<pre><code>bool MySQLConnector::ExecuteQuery( std::string query, sql::ResultSet * result )\n                                                                     ^^^^^^^^\n</code></pre>\n\n<p>Here, result is much like a local variable within a function, and it contains a <em>copy</em> of the variable of the caller.</p>\n\n<p>When you assign to it within ExecuteQuery, it'll only affect the variable within the function, not the variable of the caller.</p>\n\n<p>You can instead make it a reference, so it'll reference the variable of the caller like so:</p>\n\n<pre><code>bool MySQLConnector::ExecuteQuery( std::string query, sql::ResultSet *&amp;result )\n</code></pre>\n\n<p>Another approach is to pass in a pointer to the variable (and as the variable is itself a pointer, you'll deal with a pointer to a pointer). This lets you also modify the pointer of the caller :</p>\n\n<pre><code> bool MySQLConnector::ExecuteQuery( std::string query, sql::ResultSet **result ) {\n ...\n     *result = statement-&gt;executeQuery( query );\n</code></pre>\n\n<p>This also requires modification to the caller, so it passes in a pointer to its local variable, e.g.</p>\n\n<pre><code>sql::ResultSet *rs;\nc-&gt;ExecuteQuery(\"select ...\", &amp;rs);\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 6621164, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/924337e00ca87f95d18160d5929e1071?s=128&d=identicon&r=PG&f=1", "display_name": "HunterLee", "link": "https://stackoverflow.com/users/6621164/hunterlee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 268, "favorite_count": 0, "accepted_answer_id": 54111266, "answer_count": 2, "score": -2, "last_activity_date": 1547041662, "creation_date": 1547039796, "last_edit_date": 1547040525, "question_id": 54111042, "link": "https://stackoverflow.com/questions/54111042/c-mysql-connector-results-from-query-going-out-of-scope", "title": "C++ MySql Connector - results from query going out of scope", "body": "<p>I'm having a scoping issue with the results of a C++ mysql connector query execution.</p>\n\n<p>In the code below the <code>ResultSet *</code> result is passed from another function, initially <code>NULL</code>; however, after performing the line <code>result = statement-&gt;executeQuery( query )</code>, result is no longer <code>NULL</code>.</p>\n\n<p>There are no errors printed from the table either.</p>\n\n<p>The issue arises when returning from that function. The <code>ResultSet *</code> result goes from being not <code>NULL</code> to being equal to <code>NULL</code>.</p>\n\n<p>Clearly, there is some form of scoping on sql query results. Perhaps their function is returning a reference to a local variable ( Really not sure otherwise )?</p>\n\n<p>How do I get around this scoping issue, so that classes/functions calling this function may do with the results as they please and mitigate the need to write a bunch of specialized functions in this wrapper? Furthermore, copies should be minimized - hence the use of pointers.</p>\n\n<pre><code>bool MySQLConnector::ExecuteQuery( std::string query, sql::ResultSet * result )\n{\n\n   //connection is a member variable and has been initialized\n   sql::Statement * statement = connection-&gt;createStatement();\n\n   try\n   {\n       result = statement-&gt;executeQuery( query );\n   }\n   catch( sql::SQLException &amp;e )\n   {\n      //handle errors\n   }\n\n   delete statement;\n\n   if( result == NULL )\n   {\n       printf( \"Result is null File: %s Line %i\\n\", __FILE__, __LINE__ );\n       return false;\n   }\n   else\n   {\n        printf(\"Result is not null File: %s Line %i\\n\", __FILE__, __LINE__ );\n   }\n\n   return true;\n}\n</code></pre>\n\n<p>If I have a function <code>foo</code> that calls the function above with correct parameters. The <code>printf</code> stating that result is not null will print, but in <code>foo</code>, right after the execution of <code>ExecuteQuery</code>, the pointer passed into the function becomes <code>NULL</code>.</p>\n"}, {"tags": ["c++", "arrays", "random", "arduino", "random-seed"], "answers": [{"comments": [{"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 1, "creation_date": 1547043886, "post_id": 54111184, "comment_id": 95056670, "body": "the question you link is about getting true randomness as opposed to pseudo randomness, while picking a seed for a prng does not make it less pseudo. Not saying that you wrote anything wrong, just that it could be misunderstood as being able to get getting true randomness from a prng if you just pick a good seed"}, {"owner": {"reputation": 10498, "user_id": 669576, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/mRhrB.jpg?s=128&g=1", "display_name": "Johnny Mopp", "link": "https://stackoverflow.com/users/669576/johnny-mopp"}, "reply_to_user": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 1, "creation_date": 1547044851, "post_id": 54111184, "comment_id": 95057349, "body": "@user463035818 True. I just included the link since some of the answers address picking a good seed. <code>randomSeed(analogRead(0))</code> is probably sufficient for this application."}, {"owner": {"reputation": 1, "user_id": 9867568, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-UTZFoNn7HvI/AAAAAAAAAAI/AAAAAAAAACU/JYFVSBr05Og/photo.jpg?sz=128", "display_name": "Jim Hoggey", "link": "https://stackoverflow.com/users/9867568/jim-hoggey"}, "edited": false, "score": 0, "creation_date": 1547106853, "post_id": 54111184, "comment_id": 95079595, "body": "@JohnnyMopp Hey thank you so much for the quick and awesome answer. I posted this at 1 in the morning and when I woke up my question has been answered, soo awesome. Will try to implement it in my code now. ;-)))"}], "tags": [], "owner": {"reputation": 10498, "user_id": 669576, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/mRhrB.jpg?s=128&g=1", "display_name": "Johnny Mopp", "link": "https://stackoverflow.com/users/669576/johnny-mopp"}, "is_accepted": true, "score": 5, "last_activity_date": 1547040222, "creation_date": 1547040222, "answer_id": 54111184, "question_id": 54110906, "link": "https://stackoverflow.com/questions/54110906/how-to-print-a-variable-that-is-tied-to-a-word-arduino/54111184#54111184", "title": "How to print a variable that is tied to a word Arduino?", "body": "<p>You need to put the words into an array:</p>\n\n<pre><code>const char *words[] = {\"aye\", \"sup\", \"boi\", \"bruv\"};\n</code></pre>\n\n<p>Then pick a random index and send the word at that index:</p>\n\n<pre><code>// Calculate the number of words. Better than hardcoding\n// 4. If you add/remove words from array, this code\n// won't have to change\nint num_words = sizeof(words) / sizeof(words[0]);\nrandnumber = random(0, num_words);\nSerial.println(words[randnumber]);\n</code></pre>\n\n<p>You should also seed the RNG else you will get the same results each time. On a PC, people often seed the RNG with the current time, but there is no clock on the Arduino so it is more difficult. Here's a good discussion on that: <a href=\"https://arduino.stackexchange.com/questions/50671/getting-a-truly-random-number-in-arduino\">Getting a truly random number in Arduino</a>. </p>\n"}], "owner": {"reputation": 1, "user_id": 9867568, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-UTZFoNn7HvI/AAAAAAAAAAI/AAAAAAAAACU/JYFVSBr05Og/photo.jpg?sz=128", "display_name": "Jim Hoggey", "link": "https://stackoverflow.com/users/9867568/jim-hoggey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 311, "favorite_count": 1, "accepted_answer_id": 54111184, "answer_count": 1, "score": 0, "last_activity_date": 1547050533, "creation_date": 1547039329, "last_edit_date": 1547050533, "question_id": 54110906, "link": "https://stackoverflow.com/questions/54110906/how-to-print-a-variable-that-is-tied-to-a-word-arduino", "title": "How to print a variable that is tied to a word Arduino?", "body": "<p>I need my Arduino code to print out random words that are substituted as a variable. So like I would have a random number generator the spits out random numbers that are tided to a word that then as a variable needs to be printed out. Here is my code now, sorry I am still a beginner to Arduino. </p>\n\n<pre><code>long randnumber = 0;\n\nint aye = 1;\nint sup = 2;\nint boi = 3;\nint bruv = 4;\n\nvoid setup() {\n  Serial.begin(9600); // Starts the serial communication\n\n}\n\nvoid loop() {\nint randnumber = 0;\n  randnumber = random(0,4);\n  Serial.println(randnumber);\n\n}\n</code></pre>\n"}, {"tags": ["c++", "qt", "replace", "qt5", "text-editor"], "comments": [{"owner": {"reputation": 7130, "user_id": 10239789, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YeHJm.png?s=128&g=1", "display_name": "TrebledJ", "link": "https://stackoverflow.com/users/10239789/trebledj"}, "edited": false, "score": 0, "creation_date": 1547040479, "post_id": 54110774, "comment_id": 95054617, "body": "Maybe store the <a href=\"http://doc.qt.io/qt-5/qtextblock.html\" rel=\"nofollow noreferrer\">QTextBlock</a> after doing a Replace into your pool of ReplacedInstances. Then everytime you do findNext and move the cursor, <a href=\"http://doc.qt.io/qt-5/qtextcursor.html#block\" rel=\"nofollow noreferrer\">get the text block underneath</a> and <a href=\"http://doc.qt.io/qt-5/qtextblock.html#operator-eq-eq\" rel=\"nofollow noreferrer\">perform an equality check</a>?"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1547040714, "post_id": 54110774, "comment_id": 95054752, "body": "can I propose you to remove the tag C++ please ? nothing in your question is associated to C++"}, {"owner": {"reputation": 737, "user_id": 10480032, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e3df868838faff300155cf155251063?s=128&d=identicon&r=PG&f=1", "display_name": "AlexH", "link": "https://stackoverflow.com/users/10480032/alexh"}, "edited": false, "score": 0, "creation_date": 1547040751, "post_id": 54110774, "comment_id": 95054775, "body": "No problem, done"}, {"owner": {"reputation": 9396, "user_id": 2261538, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4e60dd44745bd1518ee933e081119de?s=128&d=identicon&r=PG", "display_name": "darune", "link": "https://stackoverflow.com/users/2261538/darune"}, "edited": false, "score": 1, "creation_date": 1547041721, "post_id": 54110774, "comment_id": 95055306, "body": "Not having read everything in detail, but usually a text model doesn&#39;t conceptually work well with fixed positions. For example a range of text (eg. a selection) shouldn&#39;t be stored by fixed positions outside the API since if the underlying text is updated the text range &#39; object &#39; should hold the same - also the case the if text is changed inside the range then the range has to reflect that. I know you asking how the internals work, but that is sort of same side of the coin."}, {"owner": {"reputation": 185819, "user_id": 6622587, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gAYS0.jpg?s=128&g=1", "display_name": "eyllanesc", "link": "https://stackoverflow.com/users/6622587/eyllanesc"}, "reply_to_user": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 2, "creation_date": 1547042194, "post_id": 54110774, "comment_id": 95055616, "body": "@bruno the c ++ tag is relevant, Qt is a library that provides support for several languages such as QML, c++, etc."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 185819, "user_id": 6622587, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gAYS0.jpg?s=128&g=1", "display_name": "eyllanesc", "link": "https://stackoverflow.com/users/6622587/eyllanesc"}, "edited": false, "score": 0, "creation_date": 1547042308, "post_id": 54110774, "comment_id": 95055685, "body": "@eyllanesc yes, but what is the difference if I replace the tag C++ by Java ? nothing, so the tag is not relevant, just my 2 cents"}, {"owner": {"reputation": 185819, "user_id": 6622587, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gAYS0.jpg?s=128&g=1", "display_name": "eyllanesc", "link": "https://stackoverflow.com/users/6622587/eyllanesc"}, "reply_to_user": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 2, "creation_date": 1547042450, "post_id": 54110774, "comment_id": 95055754, "body": "@bruno It is relevant since natively the Qt Widgets refer to C ++, and the implementations that are used as a solution will be based on that language."}], "owner": {"reputation": 737, "user_id": 10480032, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e3df868838faff300155cf155251063?s=128&d=identicon&r=PG&f=1", "display_name": "AlexH", "link": "https://stackoverflow.com/users/10480032/alexh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 83, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1547042127, "creation_date": 1547038854, "last_edit_date": 1592644375, "question_id": 54110774, "link": "https://stackoverflow.com/questions/54110774/qt-how-do-text-editors-perform-the-replace-operation-and-stop-once-they-cycle-b", "title": "Qt: How do text editors perform the Replace operation and stop once they cycle back to the first replacement they ever performed?", "body": "<p>I'm working on a <a href=\"https://github.com/AleksandrHovhannisyan/User-Friendly-Text-Editor\" rel=\"nofollow noreferrer\">text editor project</a> in Qt, and I'm currently trying to imitate the Find and Replace behavior of text editors and word processors.</p>\n<p>Consider this example from Microsoft Word, with the numbers indicating the cursor position/index at the end of each line:</p>\n<blockquote>\n<p>hello 5</p>\n<p>matey 11</p>\n<p>hello 17</p>\n</blockquote>\n<p>In other words, if the cursor is at the very start of the document (to the left of &quot;hello&quot;), its index will be 0. To the right of the first &quot;h&quot;, it will be 1. And so on. This is how Qt treats cursor positions within a <code>QTextEdit</code> (or, in this case, a <code>QPlainTextEdit</code>).</p>\n<p>Suppose our cursor is currently positioned right after &quot;matey,&quot; at position 11, and that we've opened the Find dialog (with Ctrl+F or the menu action).</p>\n<p>In a word processor like Microsoft Word, the search for &quot;hello&quot; would proceed to find the bottom &quot;hello&quot; at position 17, then cycle back to the top and find the first &quot;hello&quot; at position 5, and then stop searching as soon as it cycles back to the position where it found its very first match (17). This makes sense\u2014you wouldn't want to keep cycling the user through the whole document and giving the impression that you're finding &quot;new&quot; hits when you really aren't.</p>\n<p>Moreover, when you exit the search, your cursor will return to its initial position prior to the first search you conducted for the term in question (that is, the cursor will return to position 11 and will not remain at position 17, the &quot;false positive&quot; new find).</p>\n<p>This behavior is expected and works as intended in my own text editor. The relevant portions of code to examine are as follows:</p>\n<ul>\n<li><p><a href=\"https://github.com/AleksandrHovhannisyan/User-Friendly-Text-Editor/blob/master/CustomTextEditor/editor.cpp#L107\" rel=\"nofollow noreferrer\">on_findQueryText_ready</a> in editor.cpp</p>\n</li>\n<li><p><a href=\"https://github.com/AleksandrHovhannisyan/User-Friendly-Text-Editor/blob/master/CustomTextEditor/finddialog.h\" rel=\"nofollow noreferrer\">finddialog.h</a></p>\n</li>\n<li><p><a href=\"https://github.com/AleksandrHovhannisyan/User-Friendly-Text-Editor/blob/master/CustomTextEditor/finddialog.cpp\" rel=\"nofollow noreferrer\">finddialog.cpp</a></p>\n</li>\n</ul>\n<p>Let me explain my own approach before describing the problem in more detail:</p>\n<p>The <code>FindDialog</code> class keeps a map associating each search query/term with a pair of positions/integers: the first integer is the position the cursor was at prior to the first search for that term (using our example, 11); the second integer in the pair is the position at which the first match was found (using our example, that would be 17).</p>\n<p>The search proceeds until the end of the document. If a match is not found, it does another search from the start of the document. If we end up at a <a href=\"https://github.com/AleksandrHovhannisyan/User-Friendly-Text-Editor/blob/master/CustomTextEditor/editor.cpp#L155\" rel=\"nofollow noreferrer\">position equal to the first match</a>, we treat it as a &quot;find failure&quot;, reset our search history, and return.</p>\n<p>Now onto the Replace operation, which first calls the Find operation and then inserts the replacement text at the cursor positioned by the Find operation. See <a href=\"https://github.com/AleksandrHovhannisyan/User-Friendly-Text-Editor/blob/master/CustomTextEditor/finddialog.cpp#L99\" rel=\"nofollow noreferrer\">this line</a>.</p>\n<p>Here's the problem: with the <strong>Replace</strong> operation, suppose we search for &quot;hello&quot; and try to replace it with &quot;hellos&quot;. First, we'll replace the bottom &quot;hello&quot; with &quot;hellos&quot;. So far so good. Then we'll replace the top &quot;hello&quot; with &quot;hellos&quot;. And then we cycle back to the bottom &quot;hello&quot;. But here's the problem: our cursor is no longer at position 17, because the insertion of &quot;hellos&quot; at the top of the document just shifted all the indices/cursor positions up by 1. That is, the index to the very right of the bottom &quot;hello&quot; will be 18, not 17. Here's some debugging code that confirms this behavior:</p>\n<p><a href=\"https://i.stack.imgur.com/bbsNT.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/bbsNT.png\" alt=\"enter image description here\" /></a></p>\n<p>The reason I mention this is because there's a workaround I could use where I set some sort of flag in the Editor\u2014canReplace\u2014that's checked before replacing content. This flag would get set to false whenever we cycle back to the first Find match. Of course, when I tested this, it doesn't work because of the cursor positions shifting like I described above.</p>\n<p>Is there a cleaner or better solution that I'm just not thinking of? I know this was a really long post, but I'd appreciate any help. Thank you to those who read this all :)</p>\n"}, {"tags": ["c++", "multithreading", "c++11", "atomic"], "comments": [{"owner": {"reputation": 18020, "user_id": 580083, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/085edb5b64d5db3362d784bd9d35f99c?s=128&d=identicon&r=PG", "display_name": "Daniel Langr", "link": "https://stackoverflow.com/users/580083/daniel-langr"}, "edited": false, "score": 2, "creation_date": 1547038882, "post_id": 54110588, "comment_id": 95053627, "body": "IIRC, fences ensure synchronization order of stores/loads. However, you still access the same memory location (<code>isDataReady</code> variable) at once from two threads where one thread updates it, which is a definition of data race (and UB in C++)."}, {"owner": {"reputation": 3524, "user_id": 4950448, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/907276442666522/picture?type=large", "display_name": "Antoine Morrier", "link": "https://stackoverflow.com/users/4950448/antoine-morrier"}, "reply_to_user": {"reputation": 18020, "user_id": 580083, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/085edb5b64d5db3362d784bd9d35f99c?s=128&d=identicon&r=PG", "display_name": "Daniel Langr", "link": "https://stackoverflow.com/users/580083/daniel-langr"}, "edited": false, "score": 0, "creation_date": 1547039256, "post_id": 54110588, "comment_id": 95053866, "body": "@DanielLangr if there is a data race (even if it is not a &quot;problem&quot;), it is an UB in C++?"}, {"owner": {"reputation": 18020, "user_id": 580083, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/085edb5b64d5db3362d784bd9d35f99c?s=128&d=identicon&r=PG", "display_name": "Daniel Langr", "link": "https://stackoverflow.com/users/580083/daniel-langr"}, "edited": false, "score": 4, "creation_date": 1547039321, "post_id": 54110588, "comment_id": 95053908, "body": "@AntoineMorrier Yes: <a href=\"http://eel.is/c++draft/intro.races#21.sentence-3\" rel=\"nofollow noreferrer\">eel.is/c++draft/intro.races#21.sentence-3</a>."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1547899385, "post_id": 54110588, "comment_id": 95357074, "body": "You didn&#39;t mention the CPU."}], "answers": [{"comments": [{"owner": {"reputation": 20213, "user_id": 147845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e225ff5beb684088f5c9131d3979a18?s=128&d=identicon&r=PG", "display_name": "You", "link": "https://stackoverflow.com/users/147845/you"}, "edited": false, "score": 0, "creation_date": 1547039459, "post_id": 54110873, "comment_id": 95053987, "body": "Because of the forward progress guarantee, it would be equally reasonable for the compiler to emit nothing at all rather than an infinite loop (I believe)."}, {"owner": {"reputation": 3524, "user_id": 4950448, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/907276442666522/picture?type=large", "display_name": "Antoine Morrier", "link": "https://stackoverflow.com/users/4950448/antoine-morrier"}, "edited": false, "score": 0, "creation_date": 1547039699, "post_id": 54110873, "comment_id": 95054122, "body": "For 1), make <code>isDataReady</code> volatile fix the problem. 2) The volatile is not enough, and I need atomic operation. 3) The same, I need an atomic (since atomic operation are done in memory location), so the change of bool became visible in other thread. 4) Since I am using memory fencing, it is not really an issue.  Am I correct?"}, {"owner": {"reputation": 8857, "user_id": 3414900, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/KlvbC.jpg?s=128&g=1", "display_name": "bartop", "link": "https://stackoverflow.com/users/3414900/bartop"}, "reply_to_user": {"reputation": 3524, "user_id": 4950448, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/907276442666522/picture?type=large", "display_name": "Antoine Morrier", "link": "https://stackoverflow.com/users/4950448/antoine-morrier"}, "edited": false, "score": 0, "creation_date": 1547039889, "post_id": 54110873, "comment_id": 95054245, "body": "@AntoineMorrier AFAIK 1)y 2)y 3) and 4) yes, but you have to place memory fences properly."}, {"owner": {"reputation": 8857, "user_id": 3414900, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/KlvbC.jpg?s=128&g=1", "display_name": "bartop", "link": "https://stackoverflow.com/users/3414900/bartop"}, "reply_to_user": {"reputation": 20213, "user_id": 147845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e225ff5beb684088f5c9131d3979a18?s=128&d=identicon&r=PG", "display_name": "You", "link": "https://stackoverflow.com/users/147845/you"}, "edited": false, "score": 0, "creation_date": 1547039942, "post_id": 54110873, "comment_id": 95054277, "body": "@You I thought forward guarantee is important only for atomic, lock-free variables"}, {"owner": {"reputation": 3524, "user_id": 4950448, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/907276442666522/picture?type=large", "display_name": "Antoine Morrier", "link": "https://stackoverflow.com/users/4950448/antoine-morrier"}, "edited": false, "score": 0, "creation_date": 1547039971, "post_id": 54110873, "comment_id": 95054301, "body": "@bartop In my code my memory fences are well placed, no? The &quot;only issue&quot; in my code is because of the data race on <code>isDataReady</code>"}, {"owner": {"reputation": 8857, "user_id": 3414900, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/KlvbC.jpg?s=128&g=1", "display_name": "bartop", "link": "https://stackoverflow.com/users/3414900/bartop"}, "reply_to_user": {"reputation": 3524, "user_id": 4950448, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/907276442666522/picture?type=large", "display_name": "Antoine Morrier", "link": "https://stackoverflow.com/users/4950448/antoine-morrier"}, "edited": false, "score": 1, "creation_date": 1547040087, "post_id": 54110873, "comment_id": 95054377, "body": "@AntoineMorrier Yup, just move first memory fence line down, and the second inside <code>do{}while</code> line above and it will be all fine"}, {"owner": {"reputation": 20213, "user_id": 147845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e225ff5beb684088f5c9131d3979a18?s=128&d=identicon&r=PG", "display_name": "You", "link": "https://stackoverflow.com/users/147845/you"}, "edited": false, "score": 0, "creation_date": 1547040130, "post_id": 54110873, "comment_id": 95054416, "body": "@bartop: Not quite, I think: <a href=\"https://en.cppreference.com/w/cpp/language/memory_model#Progress_guarantee\" rel=\"nofollow noreferrer\">en.cppreference.com/w/cpp/language/&hellip;</a>"}, {"owner": {"reputation": 3524, "user_id": 4950448, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/907276442666522/picture?type=large", "display_name": "Antoine Morrier", "link": "https://stackoverflow.com/users/4950448/antoine-morrier"}, "edited": false, "score": 0, "creation_date": 1547040566, "post_id": 54110873, "comment_id": 95054683, "body": "@bartop I am reading this article <a href=\"http://www.modernescpp.com/index.php/acquire-release-fences\" rel=\"nofollow noreferrer\">modernescpp.com/index.php/acquire-release-fences</a> . It seems that the atomic_thread_fence are placed exactly like I did. The only difference between his code and mine is its <code>isDataReady</code> is an atomic variable. In this example, the intesting things is to not put an acquire release operation inside a loop, else we could just use an atomic_variable with relase/acquire operation. Since release/acquire operation are heavier than relaxed, using <code>atomic_thread_fence</code> should result in faster performance"}, {"owner": {"reputation": 18020, "user_id": 580083, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/085edb5b64d5db3362d784bd9d35f99c?s=128&d=identicon&r=PG", "display_name": "Daniel Langr", "link": "https://stackoverflow.com/users/580083/daniel-langr"}, "reply_to_user": {"reputation": 3524, "user_id": 4950448, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/907276442666522/picture?type=large", "display_name": "Antoine Morrier", "link": "https://stackoverflow.com/users/4950448/antoine-morrier"}, "edited": false, "score": 1, "creation_date": 1547041230, "post_id": 54110873, "comment_id": 95055044, "body": "@AntoineMorrier If you care about performance, you might be interested in non-blocking waiting (provided, e.g., by condition variables). Reading an atomic bool in a loop effectively blocks CPU (spin lock - busy waiting), which is useful only if you know that you cannot use that CPU (core) another way and that the waiting will be very short."}, {"owner": {"reputation": 18020, "user_id": 580083, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/085edb5b64d5db3362d784bd9d35f99c?s=128&d=identicon&r=PG", "display_name": "Daniel Langr", "link": "https://stackoverflow.com/users/580083/daniel-langr"}, "reply_to_user": {"reputation": 3524, "user_id": 4950448, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/907276442666522/picture?type=large", "display_name": "Antoine Morrier", "link": "https://stackoverflow.com/users/4950448/antoine-morrier"}, "edited": false, "score": 0, "creation_date": 1547041795, "post_id": 54110873, "comment_id": 95055360, "body": "@AntoineMorrier BTW, to illustrate the endless-loop problem, the compiler really generates an infinite loop at the machine code level, see <a href=\"https://godbolt.org/z/PJztDp\" rel=\"nofollow noreferrer\">godbolt.org/z/PJztDp</a> (<code>.L6: jmp .L6</code>). The only way to prevent it here would be to put the fence inside the loop. Or, better, to use <code>atomic&lt;bool&gt;</code>. Do not use <code>volatile</code> for what <code>atomic</code>s are for: <a href=\"https://stackoverflow.com/q/8819095/580083\">stackoverflow.com/q/8819095/580083</a>."}, {"owner": {"reputation": 19267, "user_id": 801894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=128&d=identicon&r=PG", "display_name": "Solomon Slow", "link": "https://stackoverflow.com/users/801894/solomon-slow"}, "edited": false, "score": 0, "creation_date": 1547062695, "post_id": 54110873, "comment_id": 95067008, "body": "Re, &quot;bool is not atomic ... reads can [get] garbage data.&quot;  Are you saying that an assignment to a <code>bool</code> variable could be a compound operation that temporarily stores a value that is neither <code>true</code> nor <code>false</code> before it stores the final value? I suppose the language standard could <i>allow</i> that behavior, but given how C++ was evolved from the &quot;C&quot; programming language, and given how conditional operations work in most CPU instruction architectures, I would be very surprised if any reasonable implementation actually worked in that way."}, {"owner": {"reputation": 19267, "user_id": 801894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=128&d=identicon&r=PG", "display_name": "Solomon Slow", "link": "https://stackoverflow.com/users/801894/solomon-slow"}, "reply_to_user": {"reputation": 3524, "user_id": 4950448, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/907276442666522/picture?type=large", "display_name": "Antoine Morrier", "link": "https://stackoverflow.com/users/4950448/antoine-morrier"}, "edited": false, "score": 0, "creation_date": 1547063125, "post_id": 54110873, "comment_id": 95067195, "body": "@AntoineMorrier, Re, &quot;only difference...is its isDataReady is an atomic variable.&quot; That&#39;s not a trivial difference. The compiler must emit appropriate memory fence instructions in proximity to every use of an <code>atomic</code> variable.  That&#39;s part of what <code>atomic</code> means."}, {"owner": {"reputation": 3524, "user_id": 4950448, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/907276442666522/picture?type=large", "display_name": "Antoine Morrier", "link": "https://stackoverflow.com/users/4950448/antoine-morrier"}, "reply_to_user": {"reputation": 19267, "user_id": 801894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=128&d=identicon&r=PG", "display_name": "Solomon Slow", "link": "https://stackoverflow.com/users/801894/solomon-slow"}, "edited": false, "score": 0, "creation_date": 1547066467, "post_id": 54110873, "comment_id": 95068573, "body": "@SolomonSlow i know that is not a trivial difference at all. I know the difference between an atomic and a non atomic variable. Ton only is maybe misused. But the discussion was about to put or not to put the fence inside the loop :). That is why I take the liberty to say &quot;only&quot; ;)"}], "tags": [], "owner": {"reputation": 8857, "user_id": 3414900, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/KlvbC.jpg?s=128&g=1", "display_name": "bartop", "link": "https://stackoverflow.com/users/3414900/bartop"}, "is_accepted": true, "score": 4, "last_activity_date": 1547041891, "last_edit_date": 1547041891, "creation_date": 1547039233, "answer_id": 54110873, "question_id": 54110588, "link": "https://stackoverflow.com/questions/54110588/atomic-thread-fence-why-is-there-a-data-race-on-this-non-atomic-variable-and-d/54110873#54110873", "title": "atomic thread fence: Why is there a data race on this non atomic variable? And does it matter?", "body": "<h3>TL;DR</h3>\n\n<p>This data race is dangerous and you should care about eliminating it. It may not manifest due to your luck, but it will eventually cause a headache.</p>\n\n<h3>A bit longer</h3>\n\n<p>This code has problems due to a few issues:</p>\n\n<ol>\n<li><p>While compiling <code>Consumer</code> compiler is not aware that <code>isDataReady</code> can change in background so it is perfectly reasonable to emit <code>while(!isDataReady)</code> an infinite loop or just nothing (due to <a href=\"https://en.cppreference.com/w/cpp/language/memory_model#Progress_guarantee\" rel=\"nofollow noreferrer\">forward progress guarantee</a>, as was pointed out in comments).</p></li>\n<li><p>If write and/or read to <code>bool</code> is not atomic (which is not the case on most platforms, yet is theoretically possible) any of reads can cause getting garbage data.</p></li>\n<li><p>Memory fence with <code>std::memory_order_release</code> ensures that changes that happend in the thread will be visible after other thread calls fence with <code>std::memory_order_acquire</code> (at least in simplification). So, the change of bool variable may be invisible in other thread.</p></li>\n<li><p>Due to superscalar architecture of modern processorss, <strong>operations may be reordered in runtime by processor</strong>. So order of memory writes in <code>Producer</code> visible from <code>Consumer</code> may be different than the one put in the code.</p></li>\n</ol>\n"}], "owner": {"reputation": 3524, "user_id": 4950448, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/907276442666522/picture?type=large", "display_name": "Antoine Morrier", "link": "https://stackoverflow.com/users/4950448/antoine-morrier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "accepted_answer_id": 54110873, "answer_count": 1, "score": 2, "last_activity_date": 1547041891, "creation_date": 1547038316, "question_id": 54110588, "link": "https://stackoverflow.com/questions/54110588/atomic-thread-fence-why-is-there-a-data-race-on-this-non-atomic-variable-and-d", "title": "atomic thread fence: Why is there a data race on this non atomic variable? And does it matter?", "body": "<p>Let's say we have 2 threads. One producer and one consumer. We have the producer that produce a data, and the consumer that use this data. However the guard is not atomic !</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>bool isDataReady = false;\nint data = 0;\n\nvoid Producer() {\n  data = 42;\n  std::atomic_thread_fence(std::memory_order_release);\n  isDataReady = true;\n}\n\nvoid Consumer() {\n  while(!isDataReady);\n  std::atomic_thread_fence(std::memory_order_acquire);\n  assert(data == 42);\n}\n</code></pre>\n\n<p>I wonder why is there a data race on <code>isDataReady</code>.\nNormally, the correct code should be to use <code>relaxed</code> ordering on an atomic bool variable.</p>\n\n<p>Is it because the write (transaction) to isDataReady could be not finished before the read? And even if it is the case, is it really an issue?</p>\n"}, {"tags": ["javascript", "c++", "sdl-2", "emscripten"], "comments": [{"owner": {"reputation": 3161, "user_id": 1513187, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3237cddbf003e1af3b51900c02ec005b?s=128&d=identicon&r=PG", "display_name": "Nikola Lukic", "link": "https://stackoverflow.com/users/1513187/nikola-lukic"}, "edited": false, "score": 1, "creation_date": 1568028514, "post_id": 54110524, "comment_id": 102132410, "body": "Try -s SDL2_IMAGE_FORMATS=&#39;[&quot;bmp&quot;,&quot;png&quot;]&#39; ."}], "answers": [{"tags": [], "owner": {"reputation": 3161, "user_id": 1513187, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3237cddbf003e1af3b51900c02ec005b?s=128&d=identicon&r=PG", "display_name": "Nikola Lukic", "link": "https://stackoverflow.com/users/1513187/nikola-lukic"}, "is_accepted": true, "score": 1, "last_activity_date": 1568028459, "last_edit_date": 1568028459, "creation_date": 1567770005, "answer_id": 57821328, "question_id": 54110524, "link": "https://stackoverflow.com/questions/54110524/browser-doesnt-load-local-images-while-using-sdl2-emscripten/57821328#57821328", "title": "Browser doesn&#39;t load local images while using SDL2 + emscripten", "body": "<p>I am not sure but maybe this args combination will help you.\n It's good to put -lSDL , emcc will handle other problems with linking libs.</p>\n\n<p>You need first go to the current dir. </p>\n\n<pre><code> cd c:/vc/sdl/\n</code></pre>\n\n<p>In this way we will use only relative paths.</p>\n\n<pre><code> emcc test.cpp -s USE_SDL=2 -lSDL --preload-file Resources -s USE_SDL_IMAGE=2 -s ALLOW_MEMORY_GROWTH=1 --use-preload-plugins -s SDL2_IMAGE_FORMATS='[\"bmp\",\"png\"]' -s GL_UNSAFE_OPTS=0  -o prueba.html \n</code></pre>\n"}], "owner": {"reputation": 329, "user_id": 6948983, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2fa4a74e794b053dc25ed159b0af54cd?s=128&d=identicon&r=PG&f=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/6948983/pablo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 391, "favorite_count": 1, "accepted_answer_id": 57821328, "answer_count": 1, "score": 1, "last_activity_date": 1568028459, "creation_date": 1547038048, "last_edit_date": 1547046504, "question_id": 54110524, "link": "https://stackoverflow.com/questions/54110524/browser-doesnt-load-local-images-while-using-sdl2-emscripten", "title": "Browser doesn&#39;t load local images while using SDL2 + emscripten", "body": "<p>I am trying to port SDL2 c++ code to JS using emscripten. My current filesystem looks like this (upper case for folders and lower case for files):</p>\n\n<pre><code>C\n|-VC\n   |-SDL\n       |-test.cpp\n       |-RESOURCES\n              |-hello.bmp\n</code></pre>\n\n<p>'hello.bmp' is any 640x480 px bitmap while 'test.cpp' contains the next source code:</p>\n\n<pre><code>#include &lt;SDL.h&gt;\n#include &lt;iostream&gt;\n\n#ifdef __EMSCRIPTEN__\n#include &lt;emscripten.h&gt;\n#endif\n\nstruct context\n{\n    SDL_Renderer *ren;\n    SDL_Texture *tex;\n};\n\nvoid mainloop(void* arg)\n{\n    context *con = static_cast&lt;context*&gt;(arg);\n    SDL_RenderClear(con-&gt;ren);\n    SDL_RenderCopy(con-&gt;ren, con-&gt;tex, NULL, NULL);\n    SDL_RenderPresent(con-&gt;ren);\n}\n\nint main(int, char**)\n{\n    if (SDL_Init(SDL_INIT_VIDEO) != 0)\n    {\n        std::cout &lt;&lt; \"SDL_Init Error: \" &lt;&lt; SDL_GetError() &lt;&lt; std::endl;\n        return 1;\n    }\n\n    SDL_Window *win = SDL_CreateWindow(\"Hello World!\", 100, 100, 640, 480, SDL_WINDOW_SHOWN);\n    if (win == nullptr)\n    {\n        std::cout &lt;&lt; \"SDL_CreateWindow Error: \" &lt;&lt; SDL_GetError() &lt;&lt; std::endl;\n        SDL_Quit();\n        return 1;\n    }\n\n    SDL_Renderer *ren = SDL_CreateRenderer(win, -1, SDL_RENDERER_ACCELERATED | SDL_RENDERER_PRESENTVSYNC);\n    if (ren == nullptr)\n    {\n        SDL_DestroyWindow(win);\n        std::cout &lt;&lt; \"SDL_CreateRenderer Error: \" &lt;&lt; SDL_GetError() &lt;&lt; std::endl;\n        SDL_Quit();\n        return 1;\n    }\n\n    std::string imagePath = \"Resources/hello.bmp\";\n    SDL_Surface *sur = SDL_LoadBMP(imagePath.c_str());\n    if (sur == nullptr)\n    {\n        SDL_DestroyRenderer(ren);\n        SDL_DestroyWindow(win);\n        std::cout &lt;&lt; \"SDL_LoadBMP Error: \" &lt;&lt; SDL_GetError() &lt;&lt; std::endl;\n        SDL_Quit();\n        return 1;\n    }\n\n    SDL_Texture *tex = SDL_CreateTextureFromSurface(ren, sur);\n    SDL_FreeSurface(sur);\n    if (tex == nullptr)\n    {\n        SDL_DestroyRenderer(ren);\n        SDL_DestroyWindow(win);\n        std::cout &lt;&lt; \"SDL_CreateTextureFromSurface Error: \" &lt;&lt; SDL_GetError() &lt;&lt; std::endl;\n        SDL_Quit();\n        return 1;\n    }\n\n#ifdef __EMSCRIPTEN__\n    context con = { ren, tex };\n    emscripten_set_main_loop_arg(mainloop, &amp;con, -1, 1);\n#else\n    for (int i = 0; i &lt; 5; ++i)\n    {\n        SDL_RenderClear(ren);\n        SDL_RenderCopy(ren, tex, NULL, NULL);\n        SDL_RenderPresent(ren);\n        SDL_Delay(1000);\n    }\n#endif\n\n    SDL_DestroyTexture(tex);\n    SDL_DestroyRenderer(ren);\n    SDL_DestroyWindow(win);\n    SDL_Quit();\n\n    return 0;\n}\n</code></pre>\n\n<p>I am using Windows 10 and emscripten 1.38.21. I am trans-compiling with the next command line in a console within dir \"C:\\emsdk-master\\emscripten\\1.38.21\":</p>\n\n<pre><code>emcc c:/vc/sdl/test.cpp -O2 -s USE_SDL=2 -s USE_SDL_IMAGE=2 -s --preload-file c:/vc/sdl/Resources -o prueba.html\n</code></pre>\n\n<p>The problem is that once hello.html has been generated I open it in Firefox 64.0 browser, and the next error text is shown:</p>\n\n<pre><code>SDL_LoadBMP Error: Couldn't open Resources/hello.bmp\n</code></pre>\n\n<p>In Chrome 71.0 an exception is launched and program halts.</p>\n\n<p>Please, any help with this for both Firefox / Chrome browsers?</p>\n"}, {"tags": ["c++", "serialization", "qlist", "qmap", "qsettings"], "answers": [{"comments": [{"owner": {"reputation": 162, "user_id": 2061905, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d91ae6dd89e9bbb22c5c2492dc9fd098?s=128&d=identicon&r=PG", "display_name": "Alaa Agwa", "link": "https://stackoverflow.com/users/2061905/alaa-agwa"}, "edited": false, "score": 0, "creation_date": 1547038481, "post_id": 54110607, "comment_id": 95053368, "body": "this one will not work with me as the keys of every map object inside the list are the same."}, {"owner": {"reputation": 1894, "user_id": 8473031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4878bfc9d6a80397a8446111fffa4dd?s=128&d=identicon&r=PG&f=1", "display_name": "RoQuOTriX", "link": "https://stackoverflow.com/users/8473031/roquotrix"}, "reply_to_user": {"reputation": 162, "user_id": 2061905, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d91ae6dd89e9bbb22c5c2492dc9fd098?s=128&d=identicon&r=PG", "display_name": "Alaa Agwa", "link": "https://stackoverflow.com/users/2061905/alaa-agwa"}, "edited": false, "score": 0, "creation_date": 1547038576, "post_id": 54110607, "comment_id": 95053428, "body": "So I would say this is a design problem and not a QSettings problem? Why using a map with always the same key?"}, {"owner": {"reputation": 162, "user_id": 2061905, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d91ae6dd89e9bbb22c5c2492dc9fd098?s=128&d=identicon&r=PG", "display_name": "Alaa Agwa", "link": "https://stackoverflow.com/users/2061905/alaa-agwa"}, "edited": false, "score": 0, "creation_date": 1547038681, "post_id": 54110607, "comment_id": 95053498, "body": "it&#39;s not a design problem of course, let&#39;s assume that these maps are some signals and it&#39;s values during some certain amount of time. the values are changing from a map to another."}, {"owner": {"reputation": 1894, "user_id": 8473031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4878bfc9d6a80397a8446111fffa4dd?s=128&d=identicon&r=PG&f=1", "display_name": "RoQuOTriX", "link": "https://stackoverflow.com/users/8473031/roquotrix"}, "reply_to_user": {"reputation": 162, "user_id": 2061905, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d91ae6dd89e9bbb22c5c2492dc9fd098?s=128&d=identicon&r=PG", "display_name": "Alaa Agwa", "link": "https://stackoverflow.com/users/2061905/alaa-agwa"}, "edited": false, "score": 0, "creation_date": 1547039062, "post_id": 54110607, "comment_id": 95053742, "body": "Then maybe at a timestamp to the QStrings? When I consider it right, all QMaps are one measurement of different singals at the same time? Or consider using an own class inheriting from QMap, where you add a timestamp member, that you can use while saving"}], "tags": [], "owner": {"reputation": 1894, "user_id": 8473031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4878bfc9d6a80397a8446111fffa4dd?s=128&d=identicon&r=PG&f=1", "display_name": "RoQuOTriX", "link": "https://stackoverflow.com/users/8473031/roquotrix"}, "is_accepted": false, "score": 0, "last_activity_date": 1547038366, "creation_date": 1547038366, "answer_id": 54110607, "question_id": 54110512, "link": "https://stackoverflow.com/questions/54110512/how-to-save-qlistqmap-into-qsettings-file/54110607#54110607", "title": "How to save QList&lt;QMap&gt; into QSettings file", "body": "<pre><code>QSettings settings(\"name\" \"key\");\nforeach(QMap&lt;QString, float&gt; element, list)\n    settings.value(element.key,element.value);\n</code></pre>\n\n<p>This would be my approach. What is not working?</p>\n"}, {"tags": [], "owner": {"reputation": 185819, "user_id": 6622587, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gAYS0.jpg?s=128&g=1", "display_name": "eyllanesc", "link": "https://stackoverflow.com/users/6622587/eyllanesc"}, "is_accepted": true, "score": 2, "last_activity_date": 1547041721, "creation_date": 1547041721, "answer_id": 54111647, "question_id": 54110512, "link": "https://stackoverflow.com/questions/54110512/how-to-save-qlistqmap-into-qsettings-file/54111647#54111647", "title": "How to save QList&lt;QMap&gt; into QSettings file", "body": "<p>In order to save some type of data <code>QSettings</code> uses <code>QDataStream</code> so you must implement it for <code>QMap &lt;QString, float&gt;</code>, in addition to registering it using <code>qRegisterMetaTypeStreamOperators</code>.</p>\n\n<pre><code>#include &lt;QCoreApplication&gt;\n#include &lt;QSettings&gt;\n#include &lt;QDebug&gt;\n#include &lt;QDataStream&gt;\n\n#ifndef QT_NO_DATASTREAM\nQDataStream &amp;operator&lt;&lt;(QDataStream &amp;stream, const QMap&lt;QString,float&gt; &amp;map)\n{\n    QMap&lt;QString, float&gt;::const_iterator i = map.constBegin();\n    while (i != map.constEnd()) {\n        stream &lt;&lt; i.key() &lt;&lt; i.value();\n        ++i;\n    }\n    return stream;\n}\nQDataStream &amp;operator&gt;&gt;(QDataStream &amp;stream, QMap&lt;QString,float&gt; &amp;map)\n{\n    QString key;\n    float value;\n    stream &gt;&gt; key;\n    stream &gt;&gt; value;\n    map[key] = value;\n    return stream;\n}\n#endif\n\nint main(int argc, char *argv[])\n{\n    QCoreApplication a(argc, argv);\n    qRegisterMetaTypeStreamOperators&lt;QMap&lt;QString,float&gt;&gt;(\"QMap&lt;QString,float&gt;\");\n    qRegisterMetaTypeStreamOperators&lt;QList&lt;QMap&lt;QString,float&gt;&gt;&gt;(\"QList&lt;QMap&lt;QString,float&gt;&gt;\");\n    {\n        QSettings settings;\n        QList&lt;QMap&lt;QString,float&gt;&gt; l;\n        for(int i=0; i&lt;3; i++){\n            QMap&lt;QString, float&gt; map;\n            map[\"a\"] = 0.1*(i+1);\n            map[\"b\"] = 0.2*(i+1);\n            map[\"c\"] = 0.3*(i+1);\n            l&lt;&lt; map;\n        }\n        QVariant v = QVariant::fromValue(l);\n        settings.setValue(\"val\", v);\n    }\n    {\n        QSettings settings;\n        QVariant v = settings.value(\"val\");\n        QList&lt;QMap&lt;QString,float&gt;&gt; l = v.value&lt;QList&lt;QMap&lt;QString,float&gt;&gt;&gt;();\n        int j=0;\n        for(const QMap&lt;QString, float&gt; &amp;map: l ){\n             qDebug()&lt;&lt; \"index: \" &lt;&lt; j;\n            QMap&lt;QString, float&gt;::const_iterator i = map.constBegin();\n            while (i != map.constEnd()) {\n                qDebug() &lt;&lt; i.key() &lt;&lt; \": \" &lt;&lt; i.value();\n                ++i;\n            }\n            j++;\n        }\n    }\n    return 0;\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>index:  0\n\"a\" :  0.1\n\"b\" :  0.2\n\"c\" :  0.3\nindex:  1\n\"a\" :  0.2\n\"b\" :  0.4\n\"c\" :  0.6\nindex:  2\n\"a\" :  0.3\n\"b\" :  0.6\n\"c\" :  0.9\n</code></pre>\n"}], "owner": {"reputation": 162, "user_id": 2061905, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d91ae6dd89e9bbb22c5c2492dc9fd098?s=128&d=identicon&r=PG", "display_name": "Alaa Agwa", "link": "https://stackoverflow.com/users/2061905/alaa-agwa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 505, "favorite_count": 0, "accepted_answer_id": 54111647, "answer_count": 2, "score": 1, "last_activity_date": 1547041721, "creation_date": 1547038005, "last_edit_date": 1547038725, "question_id": 54110512, "link": "https://stackoverflow.com/questions/54110512/how-to-save-qlistqmap-into-qsettings-file", "title": "How to save QList&lt;QMap&gt; into QSettings file", "body": "<p>I have a large amount of data stored in a variable of type <code>QList&lt;QMap&lt;QString,float&gt;&gt;</code> and I need to save the variable to easily retrieve it.\nI want to save it into a file with <code>QSettings</code> but with no luck. How can I do this?</p>\n"}, {"tags": ["c++", "class", "templates", "operator-overloading"], "comments": [{"owner": {"reputation": 12749, "user_id": 7976805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92a559df8b4b287aad23724b4c66d67c?s=128&d=identicon&r=PG&f=1", "display_name": "Yksisarvinen", "link": "https://stackoverflow.com/users/7976805/yksisarvinen"}, "edited": false, "score": 4, "creation_date": 1547037672, "post_id": 54110386, "comment_id": 95052847, "body": "You could use <a href=\"https://en.cppreference.com/w/cpp/types/enable_if\" rel=\"nofollow noreferrer\"><code>std::enable_if</code></a> and only enable second overload if the types <code>A</code> and <code>B</code> are not the same"}, {"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 8, "creation_date": 1547037772, "post_id": 54110386, "comment_id": 95052903, "body": "I think this is more of a design/analysis/requirements problem, and that you need to step back to the drawing board to avoid such problems. Yes you can do &quot;hacks&quot; to mitigate or work around the problem in the code itself, but such work-arounds tends to be less optimal and make the code much harder to understand and (more importantly) maintain."}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 1, "creation_date": 1547037778, "post_id": 54110386, "comment_id": 95052907, "body": "Which would be <code>typename std::enable_if&lt;!std::is_same_v&lt;A, B&gt;, B&gt;::type operator[](const A&amp;);</code> IIRC."}, {"owner": {"reputation": 9936, "user_id": 6525260, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-DdsW6uGdpjg/AAAAAAAAAAI/AAAAAAAAAAw/srXxxqCzyW0/photo.jpg?sz=128", "display_name": "Arnav Borborah", "link": "https://stackoverflow.com/users/6525260/arnav-borborah"}, "edited": false, "score": 0, "creation_date": 1547037801, "post_id": 54110386, "comment_id": 95052922, "body": "When indexing, how will you differentiate between the two overloads? i.e what should <code>test[5]</code> call? The first or the second indexing function?"}, {"owner": {"reputation": 147720, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 1, "creation_date": 1547037850, "post_id": 54110386, "comment_id": 95052960, "body": "You didn&#39;t provide context, but like Some programmer dude hints at... you probably need two aptly named functions, not operator overloads."}, {"owner": {"reputation": 26959, "user_id": 1294207, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/Inny3.jpg?s=128&g=1", "display_name": "Fantastic Mr Fox", "link": "https://stackoverflow.com/users/1294207/fantastic-mr-fox"}, "edited": false, "score": 3, "creation_date": 1547037860, "post_id": 54110386, "comment_id": 95052966, "body": "This is an <a href=\"http://xyproblem.info/\" rel=\"nofollow noreferrer\">x y problem</a>. What are you actually trying to do?"}, {"owner": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "reply_to_user": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 3, "creation_date": 1547038285, "post_id": 54110386, "comment_id": 95053223, "body": "@MatthieuBrucher Why not just make it an answer at that point?"}, {"owner": {"reputation": 105, "user_id": 3112666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7461ac4ea33d536f3de9792a2f9eba2?s=128&d=identicon&r=PG&f=1", "display_name": "user3112666", "link": "https://stackoverflow.com/users/3112666/user3112666"}, "reply_to_user": {"reputation": 26959, "user_id": 1294207, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/Inny3.jpg?s=128&g=1", "display_name": "Fantastic Mr Fox", "link": "https://stackoverflow.com/users/1294207/fantastic-mr-fox"}, "edited": false, "score": 0, "creation_date": 1547038334, "post_id": 54110386, "comment_id": 95053256, "body": "@FantasticMrFox This is what I wanted to do: Lets&#39;s say that the class has two member arrays of the same size(A* a1,  B* a2), I wanted to have two index operators that take an element of one array and returns the corresponding element of the other array (map)"}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "reply_to_user": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "edited": false, "score": 1, "creation_date": 1547038426, "post_id": 54110386, "comment_id": 95053325, "body": "@MaxLanghof because as other said, there are some murky points, it solves OP direct question, but I&#39;m not sure it&#39;s the proper answer for the actual problem. And seeing the last comment, it wouldn&#39;t have solved it apparently."}, {"owner": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "edited": false, "score": 1, "creation_date": 1547038564, "post_id": 54110386, "comment_id": 95053412, "body": "If you don&#39;t want to straight up forbid the <code>A == B</code> case, then you need a different way to distinguish between &quot;give me the corresponding A/B&quot;. A named function (<code>getCorrespondingA(const B&amp; b)</code>) would totally do the job - is there some requirement to use <code>operator[]</code>?"}, {"owner": {"reputation": 105, "user_id": 3112666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7461ac4ea33d536f3de9792a2f9eba2?s=128&d=identicon&r=PG&f=1", "display_name": "user3112666", "link": "https://stackoverflow.com/users/3112666/user3112666"}, "reply_to_user": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "edited": false, "score": 0, "creation_date": 1547038769, "post_id": 54110386, "comment_id": 95053553, "body": "@MaxLanghof yes, I was asked to do it using operator[]. Thanks"}, {"owner": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "edited": false, "score": 0, "creation_date": 1547039012, "post_id": 54110386, "comment_id": 95053709, "body": "So can you clarify how <code>myTest[1]</code> should behave? Should it give the value from <code>A</code> or <code>B</code>? Or is it maybe ok to forbid the <code>A == B</code> case?"}], "answers": [{"comments": [{"owner": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "edited": false, "score": 0, "creation_date": 1547038321, "post_id": 54110494, "comment_id": 95053246, "body": "This is technically a way, but you&#39;d probably have to duplicate everything else that the class does. Still gets an up from me."}, {"owner": {"reputation": 10915, "user_id": 5376789, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/6715b3506c7312f63950450070ed8345?s=128&d=identicon&r=PG&f=1", "display_name": "xskxzr", "link": "https://stackoverflow.com/users/5376789/xskxzr"}, "reply_to_user": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "edited": false, "score": 1, "creation_date": 1547038444, "post_id": 54110494, "comment_id": 95053341, "body": "@MaxLanghof Usually code duplicate can be avoided by inheriting a common base."}], "tags": [], "owner": {"reputation": 10915, "user_id": 5376789, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/6715b3506c7312f63950450070ed8345?s=128&d=identicon&r=PG&f=1", "display_name": "xskxzr", "link": "https://stackoverflow.com/users/5376789/xskxzr"}, "is_accepted": false, "score": 5, "last_activity_date": 1547037943, "creation_date": 1547037943, "answer_id": 54110494, "question_id": 54110386, "link": "https://stackoverflow.com/questions/54110386/c-template-class-operator-overloading-with-the-same-signatures/54110494#54110494", "title": "C++ template class operator overloading with the same signatures", "body": "<p>You can add a partial specialization:</p>\n\n<pre><code>template&lt;class A&gt;\nclass test&lt;A, A&gt;\n{\n  A a1, a2;\npublic:\n  A&amp; operator[](const A&amp;);\n};\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "is_accepted": false, "score": 2, "last_activity_date": 1547040229, "last_edit_date": 1547040229, "creation_date": 1547039870, "answer_id": 54111063, "question_id": 54110386, "link": "https://stackoverflow.com/questions/54110386/c-template-class-operator-overloading-with-the-same-signatures/54111063#54111063", "title": "C++ template class operator overloading with the same signatures", "body": "<p>You can avoid this issue and make the code more robust and expressive by converting the index to some other type that clarifies what the user wants. Usage would be like this:</p>\n\n<pre><code>bidirectional_map&lt;int, int&gt; myTest;\nint&amp; valueFor1 = myTest[Key{1}];\nint&amp; key1 = myTest[Value{valueFor1}];\n</code></pre>\n\n<p>Implemented like this:</p>\n\n<pre><code>template&lt;class TKey&gt;\nstruct Key { const TKey&amp; key; };\n\ntemplate&lt;class TValue&gt;\nstruct Value { const TValue&amp; value; };\n\n// Deduction guides (C++17), or use helper functions.\ntemplate&lt;class TValue&gt;\nValue(const TValue&amp;) -&gt; Value&lt;TValue&gt;;\ntemplate&lt;class TKey&gt;\nKey(const TKey&amp;) -&gt; Key&lt;TKey&gt;;\n\ntemplate&lt;class TKey, class TValue&gt;\nclass bidirectional_map\n{\n  TKey a1;   // Probably arrays\n  TValue a2; // or so?\npublic:\n  TValue &amp; operator[](Key&lt;TKey&gt; keyTag) { const TKey &amp; key = keyTag.key; /* ... */ }\n  TKey &amp; operator[](Value&lt;TValue&gt; valueTag) { const TValue&amp; value = valueTag.value; /* ... */ }\n};\n</code></pre>\n\n<p>Now, <code>Key</code> and <code>Value</code> are popular names so having them \"taken up\" by these auxiliary functions is not the best. Also, this is all just a pretty theoretical exercise, because member functions are of course a much better fit for this task:</p>\n\n<pre><code>template&lt;class TKey, class TValue&gt;\nclass bidirectional_map\n{\n  TKey a1;   // Probably arrays\n  TValue a2; // or so?\npublic:\n  TValue&amp; getValueForKey(const TKey&amp; key) { /* ... */ }\n  TKey&amp; getKeyForValue(const TValue&amp; value) { /* ... */ }\n};\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "is_accepted": false, "score": 1, "last_activity_date": 1547040375, "creation_date": 1547040375, "answer_id": 54111235, "question_id": 54110386, "link": "https://stackoverflow.com/questions/54110386/c-template-class-operator-overloading-with-the-same-signatures/54111235#54111235", "title": "C++ template class operator overloading with the same signatures", "body": "<p>In C++2a, you might use <code>requires</code> to \"discard\" the function in some case:</p>\n\n<pre><code>template&lt;class A, class B&gt;\nclass test\n{\n    A a1;\n    B a2;\npublic:\n    A&amp; operator[](const B&amp;);\n    B&amp; operator[](const A&amp;) requires (!std::is_same&lt;A, B&gt;::value);\n};\n</code></pre>\n\n<p><a href=\"http://coliru.stacked-crooked.com/a/f3bd40637361ca25\" rel=\"nofollow noreferrer\">Demo</a></p>\n"}, {"comments": [{"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 0, "creation_date": 1547111446, "post_id": 54112464, "comment_id": 95081810, "body": "Notice that OP returns the other type. Using <code>decltype(auto)</code> would fix that."}, {"owner": {"reputation": 4815, "user_id": 704028, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/64accf9ad1449326ae9f62e0f9e387c5?s=128&d=identicon&r=PG&f=1", "display_name": "tmaric", "link": "https://stackoverflow.com/users/704028/tmaric"}, "reply_to_user": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 0, "creation_date": 1547112260, "post_id": 54112464, "comment_id": 95082270, "body": "@Jarod42: I don&#39;t understand your comment, you mean <code>decltype(auto)</code> on the return type of the member function template? Why is this necessary, won&#39;t the <code>constexpr</code> parts together with the template argument deduction make sure the right <code>T</code> is replaced in the return (<code>T&amp;</code>)?"}, {"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 0, "creation_date": 1547113106, "post_id": 54112464, "comment_id": 95082774, "body": "Your code works, but in OP&#39;s case, it is not <code>T&amp; operator[](const T&amp; t)</code> but &quot;<code>TRes&amp; operator[](const T&amp; t)</code>&quot; (with <code>TRes = std::conditional_t&lt;std::is_same&lt;A, T&gt;::value, B, A&gt;</code>).  So even use traits for return type, or let compiler decide."}, {"owner": {"reputation": 4815, "user_id": 704028, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/64accf9ad1449326ae9f62e0f9e387c5?s=128&d=identicon&r=PG&f=1", "display_name": "tmaric", "link": "https://stackoverflow.com/users/704028/tmaric"}, "reply_to_user": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 0, "creation_date": 1547113812, "post_id": 54112464, "comment_id": 95083161, "body": "Hm, OK... OP is using <code>A&amp; operator[](const B&amp;); B&amp; operator[](const A&amp;);</code> directly. My code decides on <code>A&amp;</code> or <code>B&amp;</code> first using ADL, then the compiler enters the function body and used <code>if constexpr</code> to pick the return variable. OP asked about returning either <code>A</code> or <code>B</code> for different types, and in my code he/she can decide what to return if <code>A==B</code>. I still don&#39;t see the need for <code>decltype(auto)</code> in the return, as all cases are covered."}, {"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 1, "creation_date": 1547114071, "post_id": 54112464, "comment_id": 95083311, "body": "Firstly, there is no ADL here. Secondly, OP&#39;s code allows <code>test&lt;std::string, int&gt; t; std::string s = t[42];</code>, whereas your code expects <code>int i = t[42];</code>."}, {"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 1, "creation_date": 1547114164, "post_id": 54112464, "comment_id": 95083358, "body": "Moreover, you loose conversion: <code>test&lt;std::string, int&gt; t; t[&quot;c-string&quot;];</code> is invalid for you (need <code>t[std::string(&quot;c-string&quot;)]</code>)."}, {"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 1, "creation_date": 1547115631, "post_id": 54112464, "comment_id": 95084238, "body": "Both issues can be fixed, <code>decltype(auto)</code> for the first (and fixing implementation to return OP value ;-) ), and second is more tricky, but <code>std::is_same</code> and <code>std::is_convertible</code> might do the job but not sure it would give &quot;better&quot; code than alternatives."}, {"owner": {"reputation": 4815, "user_id": 704028, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/64accf9ad1449326ae9f62e0f9e387c5?s=128&d=identicon&r=PG&f=1", "display_name": "tmaric", "link": "https://stackoverflow.com/users/704028/tmaric"}, "reply_to_user": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "edited": false, "score": 0, "creation_date": 1547115719, "post_id": 54112464, "comment_id": 95084288, "body": "Already on it, thanks. I&#39;ll update the answer anyway, if nothing, it can be an example for <code>if constexpr</code> I guess."}], "tags": [], "owner": {"reputation": 4815, "user_id": 704028, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/64accf9ad1449326ae9f62e0f9e387c5?s=128&d=identicon&r=PG&f=1", "display_name": "tmaric", "link": "https://stackoverflow.com/users/704028/tmaric"}, "is_accepted": false, "score": 1, "last_activity_date": 1547044459, "creation_date": 1547044459, "answer_id": 54112464, "question_id": 54110386, "link": "https://stackoverflow.com/questions/54110386/c-template-class-operator-overloading-with-the-same-signatures/54112464#54112464", "title": "C++ template class operator overloading with the same signatures", "body": "<p>Here is an example solution using <code>if constexpr</code> that requires C++17: </p>\n\n<pre><code>#include &lt;type_traits&gt;\n#include &lt;cassert&gt;\n#include &lt;string&gt;\n\ntemplate &lt;class A, class B&gt; \nclass test\n{\n  A a1_;\n  B b1_;\n\npublic:\n\n    template&lt;typename T&gt; \n    T&amp; operator[](const T&amp; t)\n    {\n        constexpr bool AequalsB = std::is_same&lt;A,B&gt;(); \n        constexpr bool TequalsA = std::is_same&lt;T,A&gt;();\n\n        if constexpr (AequalsB)\n        {\n            if constexpr (TequalsA) \n                return a1_;  // Can also be b1_, same types;\n\n            static_assert(TequalsA, \"If A=B, then T=A=B, otherwise type T is not available.\");\n        }\n\n        if constexpr (! AequalsB)\n        {\n            constexpr bool TequalsB = std::is_same&lt;T,B&gt;();\n\n            if constexpr (TequalsA)\n                return a1_; \n\n            if constexpr (TequalsB)\n                return b1_; \n\n            static_assert((TequalsA || TequalsB), \"If A!=B, then T=A || T=B, otherwise type T is not available.\");\n        }\n    }\n\n};\n\nusing namespace std;\n\nint main()\n{\n    int x = 0;  \n    double y = 3.14; \n    string s = \"whatever\"; \n\n    test&lt;int, int&gt; o; \n    o[x]; \n    //o[y]; // Fails, as expected.\n    //o[s]; // Fails, as expected\n\n    test&lt;double, int&gt; t; \n    t[x]; \n    t[y]; \n    //t[s]; // Fails, as expected.\n\n    return 0; \n\n};\n</code></pre>\n"}], "owner": {"reputation": 105, "user_id": 3112666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7461ac4ea33d536f3de9792a2f9eba2?s=128&d=identicon&r=PG&f=1", "display_name": "user3112666", "link": "https://stackoverflow.com/users/3112666/user3112666"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 251, "favorite_count": 0, "answer_count": 4, "score": 4, "last_activity_date": 1547044459, "creation_date": 1547037507, "last_edit_date": 1547037706, "question_id": 54110386, "link": "https://stackoverflow.com/questions/54110386/c-template-class-operator-overloading-with-the-same-signatures", "title": "C++ template class operator overloading with the same signatures", "body": "<p>A simple C++ OO question regrading templates and operator overloading: In the following class, I have overloaded the index operator twice:</p>\n\n<pre><code>template&lt;class A, class B&gt;\nclass test\n{\n  A a1;\n  B a2;\npublic:\n  A&amp; operator[](const B&amp;);\n  B&amp; operator[](const A&amp;);\n};\n</code></pre>\n\n<p>Now, if I instantiate an object of this template class with the same typenames:</p>\n\n<pre><code>test&lt;int, int&gt; obj;\n</code></pre>\n\n<p>calling the index operator will result in an error, because the two overloaded functions will have the same signatures. </p>\n\n<p>Is there any way to resolve this issue?</p>\n\n<p>Sorry, if this is a basic question. I am still learning!</p>\n"}, {"tags": ["c++", "macos", "openssl", "x509"], "comments": [{"owner": {"reputation": 533, "user_id": 6251476, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z7gBw.png?s=128&g=1", "display_name": "dim", "link": "https://stackoverflow.com/users/6251476/dim"}, "edited": false, "score": 0, "creation_date": 1558363636, "post_id": 54110349, "comment_id": 99067222, "body": "This is because X509_get_ext_d2i(..., NID_ext_key_usage, ...) returns a EXTENDED_KEY_USAGE structure (not a ASN1_BIT_STRING like for NID_key_usage). Your static_cast breaks everything and there is no usage-&gt;data field. Key usages and extended key usages don&#39;t have the same format at all, neither in the underlying X509 encoding, and in the internal OpenSSL structures."}], "answers": [{"comments": [{"owner": {"reputation": 969, "user_id": 2928544, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/yeaGD.jpg?s=128&g=1", "display_name": "raidensan", "link": "https://stackoverflow.com/users/2928544/raidensan"}, "edited": false, "score": 0, "creation_date": 1547366376, "post_id": 54139216, "comment_id": 95163473, "body": "I tried your suggestion. Unfortunately <code>x-&gt;ex_flags</code> is <code>0</code>."}, {"owner": {"reputation": 12010, "user_id": 23235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6281820b28d03f98e85bb3d901ae3f39?s=128&d=identicon&r=PG", "display_name": "Shane Powell", "link": "https://stackoverflow.com/users/23235/shane-powell"}, "reply_to_user": {"reputation": 969, "user_id": 2928544, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/yeaGD.jpg?s=128&g=1", "display_name": "raidensan", "link": "https://stackoverflow.com/users/2928544/raidensan"}, "edited": false, "score": 0, "creation_date": 1547398629, "post_id": 54139216, "comment_id": 95171127, "body": "I haven&#39;t had any problem with the above code so maybe the issue is something else.  Maybe it&#39;s the way you load the certificate or maybe it&#39;s the certificate itself."}, {"owner": {"reputation": 12010, "user_id": 23235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6281820b28d03f98e85bb3d901ae3f39?s=128&d=identicon&r=PG", "display_name": "Shane Powell", "link": "https://stackoverflow.com/users/23235/shane-powell"}, "reply_to_user": {"reputation": 969, "user_id": 2928544, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/yeaGD.jpg?s=128&g=1", "display_name": "raidensan", "link": "https://stackoverflow.com/users/2928544/raidensan"}, "edited": false, "score": 0, "creation_date": 1547398922, "post_id": 54139216, "comment_id": 95171203, "body": "You could try using something like PEM_read_bio_X509_AUX to load the PEM file."}], "tags": [], "owner": {"reputation": 12010, "user_id": 23235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6281820b28d03f98e85bb3d901ae3f39?s=128&d=identicon&r=PG", "display_name": "Shane Powell", "link": "https://stackoverflow.com/users/23235/shane-powell"}, "is_accepted": false, "score": 1, "last_activity_date": 1547170181, "creation_date": 1547170181, "answer_id": 54139216, "question_id": 54110349, "link": "https://stackoverflow.com/questions/54110349/programmatically-verifying-x509v3-extendedkeyusage/54139216#54139216", "title": "Programmatically verifying x509v3 extendedKeyUsage", "body": "<p>In openssl 1.1 it's easy once you have a X509 pointer.  You just need to use the following methods: <a href=\"https://www.openssl.org/docs/man1.1.1/man3/X509_get_extension_flags.html\" rel=\"nofollow noreferrer\">X509_get_extension_flags</a> and <a href=\"https://www.openssl.org/docs/man1.1.1/man3/X509_get_extended_key_usage.html\" rel=\"nofollow noreferrer\">X509_get_extended_key_usage</a></p>\n\n<pre><code>if ((X509_get_extension_flags(x509) &amp; EXFLAG_XKUSAGE) == EXFLAG_XKUSAGE)\n{\n    auto const certificate_key_usage = X509_get_extended_key_usage(x509);\n    if ((certificate_key_usage &amp; (XKU_SSL_SERVER | XKU_SSL_CLIENT)) == (XKU_SSL_SERVER | XKU_SSL_CLIENT))\n    {\n        // has both TLS Web Server Authentication and TLS Web Client Authentication\n    }\n    else\n    {\n        // doesn't have both TLS Web Server Authentication and TLS Web Client Authentication\n    }\n}\n</code></pre>\n\n<p>For older versions of openssl you should be able to define the following to get the above code working:</p>\n\n<pre><code>#if OPENSSL_VERSION_NUMBER &lt; 0x10100000L\n#define X509_get_extension_flags(x) (x-&gt;ex_flags)\n#define X509_get_extended_key_usage(x)  (x-&gt;ex_xkusage)\n#endif\n</code></pre>\n"}], "owner": {"reputation": 969, "user_id": 2928544, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/yeaGD.jpg?s=128&g=1", "display_name": "raidensan", "link": "https://stackoverflow.com/users/2928544/raidensan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 587, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547374142, "creation_date": 1547037371, "last_edit_date": 1547374142, "question_id": 54110349, "link": "https://stackoverflow.com/questions/54110349/programmatically-verifying-x509v3-extendedkeyusage", "title": "Programmatically verifying x509v3 extendedKeyUsage", "body": "<p><strong>Background</strong></p>\n\n<p>I need to programmatically verify <code>extendedKeyUsage</code> in an x509 certificate. My goal here is to make sure only <code>TLS Web Server Authentication, TLS Web Client Authentication</code> is present in <code>extendedKeyUsage</code>. I am using <code>OpenSSL 1.0.2p</code> lib on MacOS.</p>\n\n<p>The following is my code for retrieving extendedKeyUsage fields:</p>\n\n<pre><code>#include &lt;openssl/x509v3.h&gt;\n#include &lt;openssl/bn.h&gt;\n#include &lt;openssl/asn1.h&gt;\n#include &lt;openssl/x509.h&gt;\n#include &lt;openssl/x509_vfy.h&gt;\n#include &lt;openssl/pem.h&gt;\n#include &lt;openssl/bio.h&gt;\n\nint verifyDeviceCertExtendedKeyUsage(){\n\n    OpenSSL_add_all_algorithms();\n\n    auto readBytes = MyApp::FileUtil::readAllBytes(\"path/to/pem\");\n\n    BIO *bio_mem = BIO_new(BIO_s_mem());\n    BIO_puts(bio_mem, readBytes.data());\n    X509 *x509 = PEM_read_bio_X509(bio_mem, NULL, NULL, NULL);\n\n    ASN1_BIT_STRING *usage = static_cast&lt;ASN1_BIT_STRING*&gt;(X509_get_ext_d2i(x509, NID_ext_key_usage, NULL, NULL));\n    if (usage &amp;&amp; (usage-&gt;length &gt; 0)){\n        _CERTUTIL_LOG-&gt;debug(\"in verifyDeviceCertExtendedKeyUsage, usage-&gt;data[0]: {0:x}\", (int)usage-&gt;data[0]);\n    }\n}\n</code></pre>\n\n<p>Also, an excerpt from output of <code>openssl x509 -text -noout -in path/to/pem</code>:</p>\n\n<pre><code>X509v3 Extended Key Usage: \n    TLS Web Server Authentication, TLS Web Client Authentication\n</code></pre>\n\n<p><strong>Issue</strong></p>\n\n<p>Each time I ran my code the value of <code>usage-&gt;data[0]</code> is different which is a sign that my code is causing undefined behavior. </p>\n\n<p>Note: I used a similar code to retrieve <code>keyUsage</code> fields succesfully by replacing <code>NID_ext_key_usage</code> to <code>NID_key_usage</code> in <code>X509_get_ext_d2i()</code>.</p>\n\n<p><em>If</em> my code returned correct value I would verify it by comparing to the following which is in <code>openssl/x509v3.h</code>:</p>\n\n<pre><code># define XKU_SSL_SERVER          0x1\n# define XKU_SSL_CLIENT          0x2\n</code></pre>\n\n<p><strong>Question</strong></p>\n\n<p>Is there something wrong with my code?</p>\n\n<p>How can I reliably get <code>extendedKeyUsage</code> fields and verify them?</p>\n\n<p><strong>Update</strong></p>\n\n<p>I have found a way, but it makes me uneasy to compare strings:</p>\n\n<pre><code>BIO *bio_mem = BIO_new(BIO_s_mem());\nBIO_puts(bio_mem, readBytes.data());\nX509 *x509 = PEM_read_bio_X509(bio_mem, NULL, NULL, NULL);\n\nauto extIndex = X509_get_ext_by_NID(x509, NID_ext_key_usage, -1);\nif(extIndex &lt; 0){\n    BIO_free(bio_mem);\n    X509_free(x509);\n    return ERR;\n}\n\nX509_EXTENSION *ext = X509_get_ext(x509, extIndex);\n\nEXTENDED_KEY_USAGE *eku = static_cast&lt;EXTENDED_KEY_USAGE*&gt;(X509V3_EXT_d2i(ext));\n\nfor(int i = 0 ; i &lt; sk_ASN1_OBJECT_num(eku) ; i++){\n    char buffer[100] = {0}; // &lt;--- init all elements with 0, compiler specific behavior?\n    OBJ_obj2txt(buffer, sizeof(buffer), sk_ASN1_OBJECT_value(eku, i), 1);\n\n    if(strcmp(buffer, \"1.3.6.1.5.5.7.3.1\") == 0 &amp;&amp; strcmp(buffer, \"1.3.6.1.5.5.7.3.1\") == 0){\n        BIO_free(bio_mem);\n        X509_free(x509);\n        return SUCCESS;\n    }\n}\n</code></pre>\n"}, {"tags": ["c++", "makefile"], "comments": [{"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1547038464, "post_id": 54110071, "comment_id": 95053351, "body": "One question per question please"}, {"owner": {"reputation": 795, "user_id": 10010538, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bae98bb47d1be523619caaba61416d37?s=128&d=identicon&r=PG&f=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/10010538/eric"}, "reply_to_user": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1547038641, "post_id": 54110071, "comment_id": 95053472, "body": "It is one question just split in 2 parts. I want to make my makefile folder structure independend and i cant get it to work. I honestly dont see how posting everything twice and ask for the include flag in a seperate thread makes any sense."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1547038674, "post_id": 54110071, "comment_id": 95053494, "body": "They&#39;re completely different questions and this is a Q&amp;A not a forum. Cheers"}, {"owner": {"reputation": 69991, "user_id": 939557, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/3VPea.png?s=128&g=1", "display_name": "MadScientist", "link": "https://stackoverflow.com/users/939557/madscientist"}, "edited": false, "score": 0, "creation_date": 1547048994, "post_id": 54110071, "comment_id": 95060068, "body": "Be aware: make&#39;s <code>wildcard</code> function uses traditional shell globbing, it does not understand advanced zsh-style globbing.  So for example, <code>**</code> and <code>*</code> mean exactly the same thing to make and match only files in a single directory.  make globbing doesn&#39;t support <code>**</code> to mean &quot;all matches in subdirectories recursively&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "is_accepted": false, "score": 1, "last_activity_date": 1547039022, "last_edit_date": 1547039022, "creation_date": 1547038625, "answer_id": 54110694, "question_id": 54110071, "link": "https://stackoverflow.com/questions/54110071/patsubst-in-makefile-doesnt-replace-the-full-filepath/54110694#54110694", "title": "patsubst in makefile doesnt replace the full filepath", "body": "<p>If you want to flatten paths, you can use <a href=\"https://www.gnu.org/software/make/manual/html_node/File-Name-Functions.html\" rel=\"nofollow noreferrer\"><code>notdir</code></a>.</p>\n\n<p>Unfortunately, because <code>%.o</code> is \"magic\", you can't just wrap it in a <code>$(notdir)</code>.</p>\n\n<p>By the way, as a matter of style, I'd leave the trailing slash out of those variables and use it in the expressions instead; it'll be much easier to read, and more flexible too.</p>\n\n<p>This works for me:</p>\n\n<pre><code>SRC=srcPath\nOBJ=objPath\nSOURCEFILES = $(wildcard $(SRC)/**/*.cpp)\nOBJECTFILES = $(addprefix $(OBJ)/, $(notdir $(patsubst $(SRC)/%.cpp, %.o, $(SOURCEFILES))))\n\nall:\n    echo $(OBJECTFILES)\n</code></pre>\n\n<p>More pleasing alternatives surely exist, but the point is that you can use <code>notdir</code> to build your solution.</p>\n"}, {"comments": [{"owner": {"reputation": 795, "user_id": 10010538, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bae98bb47d1be523619caaba61416d37?s=128&d=identicon&r=PG&f=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/10010538/eric"}, "edited": false, "score": 0, "creation_date": 1547049379, "post_id": 54113253, "comment_id": 95060353, "body": "This way i can clean all object files with a simple command like &quot;del Obj/*o&quot; if i want a full rebuild of my program. I do this because i had issues in the past where some of my files didnt get rebuild if i only changed the header file since the .o only depends on the .cpp.Because of that i dont really like the idea of the .o files being spread all across my source folders. If this is considered a bad practice im open for advice tho. Isn&#39;t having two source files with a indentical name within the same program something that should be avoided anyways?"}, {"owner": {"reputation": 13458, "user_id": 1773798, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/4Ljqn.png?s=128&g=1", "display_name": "Renaud Pacalet", "link": "https://stackoverflow.com/users/1773798/renaud-pacalet"}, "reply_to_user": {"reputation": 795, "user_id": 10010538, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bae98bb47d1be523619caaba61416d37?s=128&d=identicon&r=PG&f=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/10010538/eric"}, "edited": false, "score": 0, "creation_date": 1547049614, "post_id": 54113253, "comment_id": 95060510, "body": "It would be much easier if you had the same directory hierarchy in <code>Obj</code> and <code>Src</code>. And you could still get rid of all object files at once by deleting the <code>Obj</code> directory. And the dependencies in the header files are not magic, you must declare them properly for a minimal yet complete rebuild when some of them change. This why I advised you a nice reading at the end of my answer. Go, read it, it is a master piece."}], "tags": [], "owner": {"reputation": 13458, "user_id": 1773798, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/4Ljqn.png?s=128&g=1", "display_name": "Renaud Pacalet", "link": "https://stackoverflow.com/users/1773798/renaud-pacalet"}, "is_accepted": true, "score": 0, "last_activity_date": 1547047942, "last_edit_date": 1547047942, "creation_date": 1547047164, "answer_id": 54113253, "question_id": 54110071, "link": "https://stackoverflow.com/questions/54110071/patsubst-in-makefile-doesnt-replace-the-full-filepath/54113253#54113253", "title": "patsubst in makefile doesnt replace the full filepath", "body": "<p>Flattening your object files in one single directory is not necessarily a very good idea. Your Makefile is getting more complex (see below) and there is a name collision possibility if, by accident, you have two source files with the same base name.</p>\n\n<p>Anyway, it is what you want, and here is a possible solution:</p>\n\n<pre><code>SRC = Src\nOBJ = Obj\nSOURCEFILES = $(wildcard $(SRC)/**/*.cpp)\n\n# $(1): full path to source file\ndefine CompileRule\n$$(OBJ)/$$(patsubst %.cpp,%.o,$$(notdir $(1))): $(1)\n    $$(CC) -c $$&lt; $$(INC) -o $$@\nendef\n$(foreach f,$(SOURCEFILES),$(eval $(call CompileRule,$(f))))\n</code></pre>\n\n<p>It iteratively instantiates custom compilation rules for each of your source files. See <a href=\"https://www.gnu.org/software/make/manual/make.html#Eval-Function\" rel=\"nofollow noreferrer\">the GNU make manual</a> for a complete explanation.</p>\n\n<p>I am not sure I fully understand your second question but if you want to find all header files in <code>Src</code> and build the list of <code>-I&lt;dir&gt;</code> compile options, you can probably try something like:</p>\n\n<pre><code>HEADERFILES := $(wildcard $(SRC)/**/*.h)\nHEADERDIRS  := $(sort $(dir $(HEADERFILES)))\nINCLUDES    := $(patsubst %,-I%,$(HEADERDIRS))\n</code></pre>\n\n<p>But it is very sub-optimal because every directory containing header files will be involved as <code>-I&lt;dir&gt;</code> in the compilation of every source file.</p>\n\n<p>Last but not least, your next step could be \"<em>how do I automatically get the list of all header files a source file depends on?</em>\". If it is, you should probably have a look at <a href=\"http://make.mad-scientist.net/papers/advanced-auto-dependency-generation/\" rel=\"nofollow noreferrer\">this post about Auto-Dependency Generation</a>.</p>\n"}], "owner": {"reputation": 795, "user_id": 10010538, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bae98bb47d1be523619caaba61416d37?s=128&d=identicon&r=PG&f=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/10010538/eric"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 343, "favorite_count": 0, "accepted_answer_id": 54113253, "answer_count": 2, "score": 1, "last_activity_date": 1547047942, "creation_date": 1547036549, "question_id": 54110071, "link": "https://stackoverflow.com/questions/54110071/patsubst-in-makefile-doesnt-replace-the-full-filepath", "title": "patsubst in makefile doesnt replace the full filepath", "body": "<p>Im currently trying to get my makefile independend from my folder structure. So far i worked with a single specific folder containing all my .cpp files. My .o files are all placed in a seperate OBJ/ folder. However i now want my makefile to automatically grab all .cpp files from all subdirectories (any depth if possible) but still place all .o files the one same OBJ folder. This is how my makefile looks at the moment:</p>\n\n<pre><code>CC  = g++ -g    \nSRC = Src/\nOBJ = Obj/\nBIN = Bin/\nINC = -I Lib/GLFW/include/\\\n      -I Lib/GLAD/include/\\\n      -I Lib/STB/\\\n      -I Lib/GLM/\\\n      -I Src/Header/ \nLIB = -L Lib/GLFW/lib-mingw-w64 -lglfw3 -lopengl32 -lglu32 -lgdi32\nEXE = $(BIN)Test.exe   \n\nSOURCEFILES = $(wildcard $(SRC)**/*.cpp)\nOBJECTFILES = $(patsubst $(SRC)%.cpp,$(OBJ)%.o,$(SOURCEFILES))\n\nall: $(SOURCEFILES) $(EXE)\n\n$(EXE) : $(OBJECTFILES)\n    $(CC) -o $@ $^ $(LIB)\n\n$(OBJ)%.o: $(SRC)%.cpp  \n    $(CC) -c $&lt; $(INC) -o $@\n</code></pre>\n\n<p>It somewhat does what i want, but for some reason it currently is required to have the same folder structure of my SRC/ directory in OBJ/ aswell: If my .cpp file is <strong>SRC/foldername/name.cpp</strong> my makefile wants to create the .o as <strong>OBJ/foldername/name.o</strong>. I want it to be <strong>OBJ/name.o</strong> for all files regardless of the structure of SRC/ . What do i need to change to achieve that?</p>\n\n<p>My second question is about the include path. As it can be seen in the makefile, all my header files are in a single directory <strong>Src/Header/</strong>. Is it possible to somehow also automatically get and link the right .h files from Src/ and it's subdirectories?  </p>\n"}, {"tags": ["c++", "multithreading", "c++11", "atomic"], "answers": [{"comments": [{"owner": {"reputation": 3524, "user_id": 4950448, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/907276442666522/picture?type=large", "display_name": "Antoine Morrier", "link": "https://stackoverflow.com/users/4950448/antoine-morrier"}, "edited": false, "score": 0, "creation_date": 1547036987, "post_id": 54110180, "comment_id": 95052460, "body": "Even if the assignment to <code>data</code> happens-before the store call, the thread consumer could see an invalid data because of caching. That is why I wonder if it is the <code>acquire</code> operation that perform the &quot;invalidation&quot; of cache"}, {"owner": {"reputation": 45460, "user_id": 1670129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/32370783314a7efabe09b6cfadb11b12?s=128&d=identicon&r=PG&f=1", "display_name": "Igor Tandetnik", "link": "https://stackoverflow.com/users/1670129/igor-tandetnik"}, "reply_to_user": {"reputation": 3524, "user_id": 4950448, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/907276442666522/picture?type=large", "display_name": "Antoine Morrier", "link": "https://stackoverflow.com/users/4950448/antoine-morrier"}, "edited": false, "score": 1, "creation_date": 1547037098, "post_id": 54110180, "comment_id": 95052532, "body": "The compiler must ensure that the read of a variable observes the last value assigned by a write that <i>happens-before</i> that read. How this is achieved is an implementation detail; usually, it issues a CPU-specific instruction."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1547038104, "post_id": 54110180, "comment_id": 95053111, "body": "Interesting - didn&#39;t know this would affect the otherwise-unsynchronised <code>data</code> object. I&#39;m a little behind on C++&#39;s threading model, tending to shove in a few mutexes or atomics and hope for the best ;)"}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 1, "creation_date": 1547038170, "post_id": 54110180, "comment_id": 95053156, "body": "How far does this go, then? Is every assignment to everything in that function protected by the barrier provided by <code>ptr</code>?"}, {"owner": {"reputation": 3524, "user_id": 4950448, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/907276442666522/picture?type=large", "display_name": "Antoine Morrier", "link": "https://stackoverflow.com/users/4950448/antoine-morrier"}, "reply_to_user": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1547038881, "post_id": 54110180, "comment_id": 95053622, "body": "@LightnessRacesinOrbit You can see a release ordering by something like All writes to all memory made by the calling thread before the call to to fence function are observed by all threads as occurring before all writes to all memory made by the calling thread after the call to the fence function. And the same occurs for reads. Since the store in <code>ptr</code> is guaranteed to happen after the fence function, when the <code>ptr</code> is read as non null value in other thread, it is guaranteed that all the other values wrote before this barrier are visible"}, {"owner": {"reputation": 3524, "user_id": 4950448, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/907276442666522/picture?type=large", "display_name": "Antoine Morrier", "link": "https://stackoverflow.com/users/4950448/antoine-morrier"}, "edited": false, "score": 1, "creation_date": 1547038927, "post_id": 54110180, "comment_id": 95053653, "body": "To put it simple : release =&gt; flush the cache. Acquire =&gt; invalidate the cache. Consume operations are far more complex ^^"}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1547039266, "post_id": 54110180, "comment_id": 95053871, "body": "Ah right I see this is optional on top of the usual atomic semantics, a way of ordering non-atomics around it. Nice"}, {"owner": {"reputation": 45460, "user_id": 1670129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/32370783314a7efabe09b6cfadb11b12?s=128&d=identicon&r=PG&f=1", "display_name": "Igor Tandetnik", "link": "https://stackoverflow.com/users/1670129/igor-tandetnik"}, "reply_to_user": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 1, "creation_date": 1547045319, "post_id": 54110180, "comment_id": 95057661, "body": "@LightnessRacesinOrbit Think about it this way. <code>std::string</code> constructor makes a bunch of assignments to the object&#39;s members. I assume you are not surprised that <code>consumer</code> sees a fully initialized state of <code>*ptr</code> once it acquires <code>ptr</code> pointer. This works for the same reason that <code>data</code> works."}, {"owner": {"reputation": 15050, "user_id": 8605791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ae3be140b26db13a86d624dba4ef1c8?s=128&d=identicon&r=PG&f=1", "display_name": "llllllllll", "link": "https://stackoverflow.com/users/8605791/llllllllll"}, "reply_to_user": {"reputation": 3524, "user_id": 4950448, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/907276442666522/picture?type=large", "display_name": "Antoine Morrier", "link": "https://stackoverflow.com/users/4950448/antoine-morrier"}, "edited": false, "score": 2, "creation_date": 1547046150, "post_id": 54110180, "comment_id": 95058254, "body": "@AntoineMorrier FWIW, reasoning about acquire-release semantics as <i>flush the cache</i> would be harmful. It may lead to misimpression that these atomic operations necessarily have runtime cost. For CPU with strong memory model like x86, most store instructions <i>already</i> have acquire-release semantics, and the <code>std::atomic</code> + <code>memory_order_release</code> is only there to prevent compile-time reordering, the machine code has no difference. If you don&#39;t want to use <code>std::atomic</code>, using normal variable with a dummy <code>asm(&quot;&quot;:::&quot;memory&quot;)</code> suffices."}, {"owner": {"reputation": 3524, "user_id": 4950448, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/907276442666522/picture?type=large", "display_name": "Antoine Morrier", "link": "https://stackoverflow.com/users/4950448/antoine-morrier"}, "reply_to_user": {"reputation": 15050, "user_id": 8605791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ae3be140b26db13a86d624dba4ef1c8?s=128&d=identicon&r=PG&f=1", "display_name": "llllllllll", "link": "https://stackoverflow.com/users/8605791/llllllllll"}, "edited": false, "score": 0, "creation_date": 1547047212, "post_id": 54110180, "comment_id": 95058940, "body": "@liliscent that is true yes"}], "tags": [], "owner": {"reputation": 45460, "user_id": 1670129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/32370783314a7efabe09b6cfadb11b12?s=128&d=identicon&r=PG&f=1", "display_name": "Igor Tandetnik", "link": "https://stackoverflow.com/users/1670129/igor-tandetnik"}, "is_accepted": true, "score": 5, "last_activity_date": 1547036847, "creation_date": 1547036847, "answer_id": 54110180, "question_id": 54110041, "link": "https://stackoverflow.com/questions/54110041/std-atomic-synchronisation-and-non-atomic-variable-not-a-stale-data/54110180#54110180", "title": "std atomic synchronisation and non atomic variable : not a stale data?", "body": "<p>Assignment to <code>data</code> <a href=\"https://en.cppreference.com/w/cpp/atomic/memory_order#Happens-before\" rel=\"noreferrer\"><em>happens-before</em></a> <code>ptr.store</code> call. Accessing <code>data</code> <em>happens-after</em> that call (yes, by way of synchronization with the atomic object). Therefore, the access is guaranteed to see the value previously assigned. </p>\n"}], "owner": {"reputation": 3524, "user_id": 4950448, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/907276442666522/picture?type=large", "display_name": "Antoine Morrier", "link": "https://stackoverflow.com/users/4950448/antoine-morrier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 2, "accepted_answer_id": 54110180, "answer_count": 1, "score": 3, "last_activity_date": 1547036847, "creation_date": 1547036464, "question_id": 54110041, "link": "https://stackoverflow.com/questions/54110041/std-atomic-synchronisation-and-non-atomic-variable-not-a-stale-data", "title": "std atomic synchronisation and non atomic variable : not a stale data?", "body": "<p>I know that this code is correct (except the <code>delete</code> not done) :</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>#include &lt;thread&gt;\n#include &lt;atomic&gt;\n#include &lt;cassert&gt;\n#include &lt;string&gt;\n\nstd::atomic&lt;std::string*&gt; ptr;\nint data;\n\nvoid producer()\n{\n    std::string* p  = new std::string(\"Hello\");\n    data = 42;\n    ptr.store(p, std::memory_order_release);\n}\n\nvoid consumer()\n{\n    std::string* p2;\n    while (!(p2 = ptr.load(std::memory_order_acquire)))\n        ;\n    assert(*p2 == \"Hello\"); // never fires\n    assert(data == 42); // never fires\n}\n\nint main()\n{\n    std::thread t1(producer);\n    std::thread t2(consumer);\n    t1.join(); t2.join();\n}\n</code></pre>\n\n<p>However, I wonder why in the consumer thread data can not be a <em>stale data</em>. Is it because of the <code>acquire</code> operation?</p>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 0, "creation_date": 1547036019, "post_id": 54109874, "comment_id": 95051878, "body": "<code>k[get_n_dimensions()]</code>? That&#39;s not C++."}, {"owner": {"reputation": 82712, "user_id": 598696, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/k1Yif.png?s=128&g=1", "display_name": "Vittorio Romeo", "link": "https://stackoverflow.com/users/598696/vittorio-romeo"}, "reply_to_user": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 3, "creation_date": 1547036146, "post_id": 54109874, "comment_id": 95051944, "body": "@MatthieuBrucher: why not?"}, {"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "reply_to_user": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 3, "creation_date": 1547036268, "post_id": 54109874, "comment_id": 95052022, "body": "@MatthieuBrucher: <code>get_n_dimensions()</code> can be <code>constexpr</code>, else, indeed, it would be VLA."}, {"owner": {"reputation": 101, "user_id": 10889578, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78476bc1c02eb1723c94d8439406cf12?s=128&d=identicon&r=PG&f=1", "display_name": "zaphod", "link": "https://stackoverflow.com/users/10889578/zaphod"}, "edited": false, "score": 1, "creation_date": 1547036323, "post_id": 54109874, "comment_id": 95052063, "body": "Sorry it&#39;s a remnant of the rest of the code. To make it self-contained, I could have replaced it by sizeof...(indices)."}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 0, "creation_date": 1547036328, "post_id": 54109874, "comment_id": 95052067, "body": "Indeed, it could be <code>constexpr</code>."}, {"owner": {"reputation": 101, "user_id": 10889578, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78476bc1c02eb1723c94d8439406cf12?s=128&d=identicon&r=PG&f=1", "display_name": "zaphod", "link": "https://stackoverflow.com/users/10889578/zaphod"}, "edited": false, "score": 0, "creation_date": 1547036525, "post_id": 54109874, "comment_id": 95052200, "body": "If I use instead <code>size_t k[sizeof...(indices)];</code>, the second argument is correct but not the following ones."}, {"owner": {"reputation": 34388, "user_id": 2610810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8c6433073e71478e8da278a188e1d15?s=128&d=identicon&r=PG", "display_name": "Caleth", "link": "https://stackoverflow.com/users/2610810/caleth"}, "edited": false, "score": 0, "creation_date": 1547036946, "post_id": 54109874, "comment_id": 95052435, "body": "Aside: you can simplify this to <code>size_t i = sizeof...(indices); size_t k[] = { indicies... };</code>"}], "answers": [{"comments": [{"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 0, "creation_date": 1547036371, "post_id": 54109941, "comment_id": 95052092, "body": "I suppose what OP should do is use <code>operator()</code> instead."}], "tags": [], "owner": {"reputation": 82712, "user_id": 598696, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/k1Yif.png?s=128&g=1", "display_name": "Vittorio Romeo", "link": "https://stackoverflow.com/users/598696/vittorio-romeo"}, "is_accepted": false, "score": 7, "last_activity_date": 1547036463, "last_edit_date": 1547036463, "creation_date": 1547036104, "answer_id": 54109941, "question_id": 54109874, "link": "https://stackoverflow.com/questions/54109874/fold-expression-as-argument-of-operator/54109941#54109941", "title": "Fold expression as argument of [] operator", "body": "<blockquote>\n  <p>What is the reason? </p>\n</blockquote>\n\n<p>The array subscript operator (<code>operator[]</code>) must have exactly one argument. The first snippet you have shown is invalid for any <code>sizeof...(U) != 1</code>.</p>\n\n<p>A function template like <code>get</code> or another operator like <code>operator()</code> do not have a similar limitation.</p>\n\n<hr>\n\n<blockquote>\n  <p>What would be the solution?</p>\n</blockquote>\n\n<p>Do not use <code>operator[]</code>. </p>\n"}, {"comments": [{"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 1, "creation_date": 1547037851, "post_id": 54110353, "comment_id": 95052961, "body": "You have triggered my too-much-snark detector, and I didn&#39;t think <i>that</i> was possible...."}, {"owner": {"reputation": 101, "user_id": 10889578, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78476bc1c02eb1723c94d8439406cf12?s=128&d=identicon&r=PG&f=1", "display_name": "zaphod", "link": "https://stackoverflow.com/users/10889578/zaphod"}, "edited": false, "score": 0, "creation_date": 1547040051, "post_id": 54110353, "comment_id": 95054357, "body": "Thanks! I was afraid that it would not be possible with the [] operator. But since it compiled..."}], "tags": [], "owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "is_accepted": true, "score": 4, "last_activity_date": 1547038078, "last_edit_date": 1547038078, "creation_date": 1547037389, "answer_id": 54110353, "question_id": 54109874, "link": "https://stackoverflow.com/questions/54109874/fold-expression-as-argument-of-operator/54110353#54110353", "title": "Fold expression as argument of [] operator", "body": "<p>C++ does not have multi-dimensional indexing, and that's \"hard-wired\" into the syntax - you can't add it by overloading.</p>\n\n<p>The reason that your code compiles at all is that <code>p[a,b]</code> is equivalent to <code>p[(a,b)]</code> - that is, it uses the regular comma operator which will compute <code>a</code> and ignore the result, then produce the value of <code>b</code> as the index into <code>p</code>.  </p>\n\n<p>Thus, your template is never used \"variadically\", but is essentially the same as</p>\n\n<pre><code>template &lt;class U&gt; T&amp; operator[](U indices)\n</code></pre>\n\n<p>You need to name the function, or overload an operator that can take more than one parameter, such as <code>operator()</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 35327, "user_id": 27678, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/7496124d499d578df1e3a6ff85e7ae03?s=128&d=identicon&r=PG", "display_name": "AndyG", "link": "https://stackoverflow.com/users/27678/andyg"}, "is_accepted": false, "score": 0, "last_activity_date": 1547042965, "last_edit_date": 1547042965, "creation_date": 1547041901, "answer_id": 54111691, "question_id": 54109874, "link": "https://stackoverflow.com/questions/54109874/fold-expression-as-argument-of-operator/54111691#54111691", "title": "Fold expression as argument of [] operator", "body": "<p>As others have mentioned, the subscripting operator <code>operator[]</code> must accept only a single parameter.</p>\n\n<p>See [over.sub] (<strong>emphasis mine</strong>)</p>\n\n<blockquote>\n  <p><code>operator[]</code> shall be a non-static member function <strong>with exactly one parameter</strong>. It implements the subscripting syntax</p>\n</blockquote>\n\n<p>However, that one parameter doesn't have to be an integer.</p>\n\n<p>You could still do what you want if you are able to move your values into a <a href=\"https://en.cppreference.com/w/cpp/utility/integer_sequence\" rel=\"nofollow noreferrer\"><code>std::index_sequence</code></a> like so:</p>\n\n<pre><code>template&lt;size_t... indices&gt;\nT&amp; operator[](std::index_sequence&lt;indices...&gt;){\n    size_t i=0, k[get_n_dimensions()];\n    (... , void(k[i++]=indices));\n    // ...\n}\n</code></pre>\n\n<p>You'd call it like so</p>\n\n<pre><code>my_instance[std::make_index_sequence&lt;3&gt;{}]; // passes 0, 1, 2 to the function\n</code></pre>\n\n<h2><a href=\"https://wandbox.org/permlink/kOvbSbQvREdVb3ZZ\" rel=\"nofollow noreferrer\">Live Demo</a></h2>\n"}], "owner": {"reputation": 101, "user_id": 10889578, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78476bc1c02eb1723c94d8439406cf12?s=128&d=identicon&r=PG&f=1", "display_name": "zaphod", "link": "https://stackoverflow.com/users/10889578/zaphod"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 234, "favorite_count": 0, "accepted_answer_id": 54110353, "answer_count": 3, "score": 2, "last_activity_date": 1547042965, "creation_date": 1547035921, "last_edit_date": 1547036024, "question_id": 54109874, "link": "https://stackoverflow.com/questions/54109874/fold-expression-as-argument-of-operator", "title": "Fold expression as argument of [] operator", "body": "<p>I am trying to use a fold expression as the argument of the [] operator. Unfortunately, only the first element is correct.</p>\n\n<pre><code>template &lt;class ...U&gt; T&amp; operator[](U ...indices){\n    size_t i=0, k[get_n_dimensions()];\n    (... , void(k[i++]=indices));\n    // use k[0], k[1], ...\n    // only k[0] is correct\n}\n</code></pre>\n\n<p>However, if I use the same syntax for the argument of a function, it works fine.</p>\n\n<pre><code>template &lt;class ...U&gt; T get(U ...indices) const {\n    size_t i=0, k[get_n_dimensions()];\n    (... , void(k[i++]=indices));\n    // k[0], k[1], ... filled correctly\n}\n</code></pre>\n\n<p>What is the reason? What would be the solution?</p>\n"}, {"tags": ["c++", "boost", "typetraits", "c++03"], "comments": [{"owner": {"reputation": 83151, "user_id": 3943312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc00b38b94ca7b6f820622b0a8af8ded?s=128&d=identicon&r=PG", "display_name": "Sam Varshavchik", "link": "https://stackoverflow.com/users/3943312/sam-varshavchik"}, "edited": false, "score": 1, "creation_date": 1547034980, "post_id": 54109509, "comment_id": 95051231, "body": "You might be able to cobble together something based on <code>std::numeric_limits</code>. Should be fairly easy to use it to derive the rules for comparing two integer or two floating point types. The tricky part would be to work around the rules between an integer and a floating point type."}, {"owner": {"reputation": 18020, "user_id": 580083, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/085edb5b64d5db3362d784bd9d35f99c?s=128&d=identicon&r=PG", "display_name": "Daniel Langr", "link": "https://stackoverflow.com/users/580083/daniel-langr"}, "reply_to_user": {"reputation": 83151, "user_id": 3943312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc00b38b94ca7b6f820622b0a8af8ded?s=128&d=identicon&r=PG", "display_name": "Sam Varshavchik", "link": "https://stackoverflow.com/users/3943312/sam-varshavchik"}, "edited": false, "score": 1, "creation_date": 1547035802, "post_id": 54109509, "comment_id": 95051739, "body": "@SamVarshavchik <a href=\"https://en.cppreference.com/w/cpp/types/numeric_limits/digits\" rel=\"nofollow noreferrer\"><code>std::numeric_limits::digits</code></a> can help here to find out the size of a mantisa."}, {"owner": {"reputation": 4123, "user_id": 3378179, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/3mmbS.png?s=128&g=1", "display_name": "Caduchon", "link": "https://stackoverflow.com/users/3378179/caduchon"}, "edited": false, "score": 0, "creation_date": 1547036625, "post_id": 54109509, "comment_id": 95052234, "body": "@StoryTeller: Why not when I have less than 5 relevant tags. The tag c++03 is followed by only 69 watchers. But in my experience, it&#39;s not enough to avoid C++11 solutions without an explicit note. Sometimes, I even had to justify why..."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 1, "creation_date": 1547036800, "post_id": 54109509, "comment_id": 95052336, "body": "People shouldn&#39;t be questioning the frame of your question if it&#39;s specifically tagged <a href=\"https://stackoverflow.com/questions/tagged/c%2b%2b03\">c++03</a> (or <a href=\"https://stackoverflow.com/questions/tagged/c%2b%2b98\">c++98</a> which is basically the same thing). That&#39;s the reason we have the tag, after all!"}, {"owner": {"reputation": 147720, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 1, "creation_date": 1547036857, "post_id": 54109509, "comment_id": 95052378, "body": "I wasn&#39;t thinking about reaching those 69 watchers as much as constraining the question better. I know the search engine here leverages tags. It might even show relevant questions better. Also, it&#39;s good to be as specific as possible, and IMO language revision tags are an important part of it."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 2, "creation_date": 1547036945, "post_id": 54109509, "comment_id": 95052434, "body": "Indeed. I don&#39;t follow <a href=\"https://stackoverflow.com/questions/tagged/c%2b%2b03\">c++03</a>, but I do follow <a href=\"https://stackoverflow.com/questions/tagged/c%2b%2b\">c++</a>, and when examining any question posted with <a href=\"https://stackoverflow.com/questions/tagged/c%2b%2b\">c++</a>, I&#39;ll be sure to look for further constraining tags. My point is I doubt I&#39;m the only one working SO this way! Note that this is also why you should be sure to always use <a href=\"https://stackoverflow.com/questions/tagged/c%2b%2b\">c++</a> first and foremost - I see a lot of questions missing that when there is <a href=\"https://stackoverflow.com/questions/tagged/c%2b%2b11\">c++11</a> or <a href=\"https://stackoverflow.com/questions/tagged/c%2b%2b14\">c++14</a> or <a href=\"https://stackoverflow.com/questions/tagged/c%2b%2b17\">c++17</a> or <a href=\"https://stackoverflow.com/questions/tagged/c%2b%2b20\">c++20</a> and will always edit it in. In conclusion, you did the right thing, carry on!"}, {"owner": {"reputation": 4123, "user_id": 3378179, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/3mmbS.png?s=128&g=1", "display_name": "Caduchon", "link": "https://stackoverflow.com/users/3378179/caduchon"}, "edited": false, "score": 0, "creation_date": 1547037053, "post_id": 54109509, "comment_id": 95052502, "body": "Points for your point of view. I will try to always add this tag. ;-)"}], "answers": [{"comments": [{"owner": {"reputation": 18020, "user_id": 580083, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/085edb5b64d5db3362d784bd9d35f99c?s=128&d=identicon&r=PG", "display_name": "Daniel Langr", "link": "https://stackoverflow.com/users/580083/daniel-langr"}, "edited": false, "score": 0, "creation_date": 1547037012, "post_id": 54110145, "comment_id": 95052480, "body": "I don&#39;t think this answers the question. From Boost docs: <i>numeric_cast returns the result of converting a value of type Source to a value of type Target.</i> Therefore, it merely checks whether a single value can be &quot;safely&quot; casted. However, OP cares about <i>all possible values</i> of a source type. Is it possible with <code>numeric_cast</code>?"}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "reply_to_user": {"reputation": 18020, "user_id": 580083, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/085edb5b64d5db3362d784bd9d35f99c?s=128&d=identicon&r=PG", "display_name": "Daniel Langr", "link": "https://stackoverflow.com/users/580083/daniel-langr"}, "edited": false, "score": 1, "creation_date": 1547037170, "post_id": 54110145, "comment_id": 95052575, "body": "@DanielLangr My point is that if the OP wants to use such a hypothetical trait as part of a solution that&#39;s like <code>numeric_cast</code>, then they can use <code>numeric_cast</code>. And, otherwise, they can use the implementation of <code>numeric_cast</code> (which must surely at least contain the logic they&#39;re asking about) to create the hypothetical trait. And otherwise the answer is &quot;no&quot;. I feel I covered all those bases..."}], "tags": [], "owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "is_accepted": true, "score": 2, "last_activity_date": 1547036746, "creation_date": 1547036746, "answer_id": 54110145, "question_id": 54109509, "link": "https://stackoverflow.com/questions/54109509/is-there-a-typetrait-checking-inclusion-between-types/54110145#54110145", "title": "Is there a typetrait checking inclusion between types?", "body": "<p>No, you'd have to make it yourself.</p>\n\n<p>That being said, if you want to use this to make arithmetic conversions value-safe, Boost already has <a href=\"https://www.boost.org/doc/libs/1_45_0/libs/numeric/conversion/doc/html/boost_numericconversion/improved_numeric_cast__.html\" rel=\"nofollow noreferrer\"><code>numeric_cast</code></a> that achieves this.</p>\n\n<p>So, depending on your goal, you may not need a trait.</p>\n\n<p>At the very least you could probably examine the <code>numeric_cast</code> implementation and use its principles to build your own trait(s).</p>\n"}, {"comments": [{"owner": {"reputation": 942, "user_id": 399580, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/53b0446da51264683bb2e4a7321e919d?s=128&d=identicon&r=PG", "display_name": "Luis Machuca", "link": "https://stackoverflow.com/users/399580/luis-machuca"}, "edited": false, "score": 0, "creation_date": 1547040175, "post_id": 54110566, "comment_id": 95054437, "body": "A simple check for that would be to add a check for eg.: <code>is_integral&lt;T&gt;::value == is_integral&lt;U&gt;::value</code> or <code>is_floating_point&lt;T&gt;::value == is_floating_point&lt;U&gt;::value</code> in the condition. Both traits can be created by hand if they are not available."}, {"owner": {"reputation": 18020, "user_id": 580083, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/085edb5b64d5db3362d784bd9d35f99c?s=128&d=identicon&r=PG", "display_name": "Daniel Langr", "link": "https://stackoverflow.com/users/580083/daniel-langr"}, "reply_to_user": {"reputation": 942, "user_id": 399580, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/53b0446da51264683bb2e4a7321e919d?s=128&d=identicon&r=PG", "display_name": "Luis Machuca", "link": "https://stackoverflow.com/users/399580/luis-machuca"}, "edited": false, "score": 0, "creation_date": 1547040742, "post_id": 54110566, "comment_id": 95054769, "body": "@LuisMachuca I don&#39;t understand what for would be such checks useful."}, {"owner": {"reputation": 942, "user_id": 399580, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/53b0446da51264683bb2e4a7321e919d?s=128&d=identicon&r=PG", "display_name": "Luis Machuca", "link": "https://stackoverflow.com/users/399580/luis-machuca"}, "edited": false, "score": 0, "creation_date": 1547132732, "post_id": 54110566, "comment_id": 95094251, "body": "For preventing &quot;inclusion&quot; between floating point types and integral types, where their ranges and granularity are not really comparable (where are you going to place <code>-3154.901107</code> in a <code>long</code>&#39;s range?)."}, {"owner": {"reputation": 18020, "user_id": 580083, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/085edb5b64d5db3362d784bd9d35f99c?s=128&d=identicon&r=PG", "display_name": "Daniel Langr", "link": "https://stackoverflow.com/users/580083/daniel-langr"}, "reply_to_user": {"reputation": 942, "user_id": 399580, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/53b0446da51264683bb2e4a7321e919d?s=128&d=identicon&r=PG", "display_name": "Luis Machuca", "link": "https://stackoverflow.com/users/399580/luis-machuca"}, "edited": false, "score": 0, "creation_date": 1547133288, "post_id": 54110566, "comment_id": 95094576, "body": "@LuisMachuca Your checks does not cover cases where <code>T</code> is integral and <code>U</code> is floating point. You would neet 3 positive comparisons instead of 1 &quot;negative&quot; in my solution."}], "tags": [], "owner": {"reputation": 18020, "user_id": 580083, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/085edb5b64d5db3362d784bd9d35f99c?s=128&d=identicon&r=PG", "display_name": "Daniel Langr", "link": "https://stackoverflow.com/users/580083/daniel-langr"}, "is_accepted": false, "score": 1, "last_activity_date": 1547038230, "creation_date": 1547038230, "answer_id": 54110566, "question_id": 54109509, "link": "https://stackoverflow.com/questions/54109509/is-there-a-typetrait-checking-inclusion-between-types/54110566#54110566", "title": "Is there a typetrait checking inclusion between types?", "body": "<p>For fundamental integral and floating-point types, you can compare their <em>number of digits</em> as follows:</p>\n\n<pre><code>template &lt;typename T, typename U&gt;  \nstruct is_included_in\n  : boost::integral_constant&lt;bool,\n      std::numeric_limits&lt;T&gt;::digits &lt;= std::numeric_limits&lt;U&gt;::digits&gt; { };\n</code></pre>\n\n<p>It works for all you exemplary cases. The only problem is that it yields <code>true</code> for, e.g., <code>&lt;float, long&gt;</code>. A partial specialization helps here:</p>\n\n<pre><code>template &lt;typename T, typename U,\n  bool = boost::is_floating_point&lt;T&gt;::value &amp;&amp; boost::is_integral&lt;U&gt;::value&gt;\nstruct is_included_in\n  : boost::integral_constant&lt;bool,\n      std::numeric_limits&lt;T&gt;::digits &lt;= std::numeric_limits&lt;U&gt;::digits&gt; { };\n\ntemplate &lt;typename T, typename U&gt;\nstruct is_included_in&lt;T, U, true&gt; : boost::false_type { };\n</code></pre>\n\n<p>Live demo: <a href=\"https://wandbox.org/permlink/NBXFOUK8fX9sxyfm\" rel=\"nofollow noreferrer\">https://wandbox.org/permlink/NBXFOUK8fX9sxyfm</a>.</p>\n"}], "owner": {"reputation": 4123, "user_id": 3378179, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/3mmbS.png?s=128&g=1", "display_name": "Caduchon", "link": "https://stackoverflow.com/users/3378179/caduchon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 54110145, "answer_count": 2, "score": 1, "last_activity_date": 1547038230, "creation_date": 1547034733, "last_edit_date": 1547036423, "question_id": 54109509, "link": "https://stackoverflow.com/questions/54109509/is-there-a-typetrait-checking-inclusion-between-types", "title": "Is there a typetrait checking inclusion between types?", "body": "<p>I'm looking for a typetrait able to know if the range of a type is included in another. A typetrait where <code>is_included_in&lt;T,U&gt;::value</code> is <code>true</code> when each value of type <code>T</code> can be stored as a value of type <code>U</code>. Example :</p>\n\n<pre><code>is_included_in&lt;float,double&gt;::value; // true\nis_included_in&lt;double,float&gt;::value; // false\nis_included_in&lt;int,double&gt;::value; // true\nis_included_in&lt;bool,long int&gt;::value; // true\nis_included_in&lt;long long int,float&gt;::value; // false\n</code></pre>\n\n<p>Is there somthing in Boost able to do this ? Or have I to write it myself ?</p>\n\n<p><em>Note: I don't use C++11 for compatibility reason.</em></p>\n"}, {"tags": ["c++", "windows"], "comments": [{"owner": {"reputation": 15619, "user_id": 1548468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0745dce203d52699e63a575b3103ad70?s=128&d=identicon&r=PG", "display_name": "Botje", "link": "https://stackoverflow.com/users/1548468/botje"}, "edited": false, "score": 3, "creation_date": 1547035070, "post_id": 54109434, "comment_id": 95051287, "body": "Have you tried <a href=\"http://releases.llvm.org/download.html\" rel=\"nofollow noreferrer\">clang</a>? Worst case you could install it on your home computer, zip the install directory, and copy it to your laptop."}, {"owner": {"reputation": 83151, "user_id": 3943312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc00b38b94ca7b6f820622b0a8af8ded?s=128&d=identicon&r=PG", "display_name": "Sam Varshavchik", "link": "https://stackoverflow.com/users/3943312/sam-varshavchik"}, "edited": false, "score": 1, "creation_date": 1547035112, "post_id": 54109434, "comment_id": 95051310, "body": "Without admin rights, it&#39;s unlikely that it will be possible to install something as substantive as an entire C compiler."}, {"owner": {"reputation": 4815, "user_id": 3087601, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/ad2f9879fa1dea6fd47a45052ad02a09?s=128&d=identicon&r=PG&f=1", "display_name": "Zereges", "link": "https://stackoverflow.com/users/3087601/zereges"}, "edited": false, "score": 0, "creation_date": 1547035122, "post_id": 54109434, "comment_id": 95051322, "body": "This question is offtopic, but you can use Visual Studio Code. It can be installed in User mode and I believe there is an extension for C++ support."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "reply_to_user": {"reputation": 83151, "user_id": 3943312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc00b38b94ca7b6f820622b0a8af8ded?s=128&d=identicon&r=PG", "display_name": "Sam Varshavchik", "link": "https://stackoverflow.com/users/3943312/sam-varshavchik"}, "edited": false, "score": 3, "creation_date": 1547035169, "post_id": 54109434, "comment_id": 95051358, "body": "@SamVarshavchik Actually, I don&#39;t see why a compiler should require administrative privileges."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 1, "creation_date": 1547035183, "post_id": 54109434, "comment_id": 95051371, "body": "I&#39;m voting to close this question as off-topic because I&#39;m afraid it is not us that can help you with this; you should talk to your school&#39;s IT professionals."}, {"owner": {"reputation": 83151, "user_id": 3943312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc00b38b94ca7b6f820622b0a8af8ded?s=128&d=identicon&r=PG", "display_name": "Sam Varshavchik", "link": "https://stackoverflow.com/users/3943312/sam-varshavchik"}, "edited": false, "score": 0, "creation_date": 1547035209, "post_id": 54109434, "comment_id": 95051381, "body": "A mere compiler shouldn&#39;t. But we&#39;re talking Microsoft Windows."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1547035223, "post_id": 54109434, "comment_id": 95051398, "body": "@BartekBanachewicz While I certainly agree, I think it&#39;s more that installing <i>any</i> software tends to be an admin task for various reasons. Nobody&#39;s saying you need to be admin to <i>use</i> the software."}, {"owner": {"reputation": 12749, "user_id": 7976805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92a559df8b4b287aad23724b4c66d67c?s=128&d=identicon&r=PG&f=1", "display_name": "Yksisarvinen", "link": "https://stackoverflow.com/users/7976805/yksisarvinen"}, "edited": false, "score": 2, "creation_date": 1547035898, "post_id": 54109434, "comment_id": 95051802, "body": "Code::blocks comes with <i>some</i> version of MinGW and it has no-setup downloads. Might be worth trying"}, {"owner": {"reputation": 3108, "user_id": 4641116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gc52U.png?s=128&g=1", "display_name": "Eljay", "link": "https://stackoverflow.com/users/4641116/eljay"}, "edited": false, "score": 0, "creation_date": 1547036858, "post_id": 54109434, "comment_id": 95052379, "body": "The installation of components of the compiler probably require admin privs to be installed in protected locations.  The debugger probably needs special privs granted during installation by the installer (although sometimes the debugger first-run fixes up its privs, which at that moment requires elevated admin privs for a moment).  After installation, general compiling shouldn&#39;t require admin privs."}, {"owner": {"reputation": 1158, "user_id": 4956078, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44600007f35ab98b7badbf1110df0687?s=128&d=identicon&r=PG&f=1", "display_name": "JMAA", "link": "https://stackoverflow.com/users/4956078/jmaa"}, "edited": false, "score": 2, "creation_date": 1547039460, "post_id": 54109434, "comment_id": 95053989, "body": "For the sake of the people who own the laptop (i.e., your school) please just ask them for help with this. If they don&#39;t want you to have a compiler on there, they&#39;re entirely entitled to stop you."}], "answers": [{"tags": [], "owner": {"reputation": 163, "user_id": 3029911, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9bd37a4fb6b55a0d7f5b1b303d9f8c0b?s=128&d=identicon&r=PG", "display_name": "Don Shanil", "link": "https://stackoverflow.com/users/3029911/don-shanil"}, "is_accepted": false, "score": 0, "last_activity_date": 1587296346, "last_edit_date": 1587296346, "creation_date": 1587294485, "answer_id": 61303308, "question_id": 54109434, "link": "https://stackoverflow.com/questions/54109434/installing-c11-compiler-with-no-admin-permission/61303308#61303308", "title": "installing c++11(+) compiler with no admin permission", "body": "<p>As @Yksisarvinen states in the comments section above - you could download codeblocks. The non-admin zip file includes a C++ compiler. Probably the quickest way through.</p>\n\n<p>You can find it here - <a href=\"http://www.codeblocks.org/downloads/binaries\" rel=\"nofollow noreferrer\">http://www.codeblocks.org/downloads/binaries</a></p>\n"}, {"tags": [], "owner": {"reputation": 61409, "user_id": 485343, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e18b024a122df74275dd2c4486e8a2b4?s=128&d=identicon&r=PG", "display_name": "rustyx", "link": "https://stackoverflow.com/users/485343/rustyx"}, "is_accepted": false, "score": 0, "last_activity_date": 1587306386, "last_edit_date": 1587306386, "creation_date": 1587296718, "answer_id": 61303783, "question_id": 54109434, "link": "https://stackoverflow.com/questions/54109434/installing-c11-compiler-with-no-admin-permission/61303783#61303783", "title": "installing c++11(+) compiler with no admin permission", "body": "<p>It <em>is</em> possible, albeit difficult, to use MinGW-w64 without Admin rights.</p>\n\n<p>One possible solution is to download the entire toolchain as a single file, for example <a href=\"https://sourceforge.net/projects/mingw-w64/files/Toolchains%20targetting%20Win64/Personal%20Builds/mingw-builds/8.1.0/threads-win32/seh/\" rel=\"nofollow noreferrer\">x86_64-8.1.0-release-win32-seh-rt_v6-rev0.7z</a>, and unpack it to your personal folder (<code>C:\\Users\\&lt;name&gt;</code>).</p>\n\n<p>Though it's compressed with <a href=\"https://www.7-zip.org/download.html\" rel=\"nofollow noreferrer\">7-zip</a>, which you might need to install first (I hope it can also be installed into your personal folder without requiring Admin rights, if not try an alternative like <a href=\"https://www.peazip.org/peazip-portable.html\" rel=\"nofollow noreferrer\">peazip</a>).</p>\n\n<p>Alternatively you can try <a href=\"https://chocolatey.org/docs/installation#non-administrative-install\" rel=\"nofollow noreferrer\">chocolatey</a> which is a package manager that can run in portable mode without Admin rights. It can install, among other things, <a href=\"https://chocolatey.org/packages/7zip\" rel=\"nofollow noreferrer\">7zip</a> and <a href=\"https://chocolatey.org/packages/mingw#individual\" rel=\"nofollow noreferrer\">mingw</a>.</p>\n\n<p>Then add <code>C:\\Users\\&lt;name&gt;\\mingw64\\bin</code> to your <code>PATH</code> (Control Panel - System - Advanced - Advanced - Environment Variables).</p>\n\n<p>Then you should be able to compile normally using the <code>g++</code> command.</p>\n\n<p>As an editor/IDE you can try Visual Studio Code, in <a href=\"https://code.visualstudio.com/docs/setup/windows#_user-versus-system-setup\" rel=\"nofollow noreferrer\">user mode</a> it does not require admin rights.</p>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 14084585, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AOh14GjVyx446mZTh7VO1we07PrAD4oMHUnN21AVTTwyjg=k-s128", "display_name": "Chan Luo", "link": "https://stackoverflow.com/users/14084585/chan-luo"}, "is_accepted": false, "score": 2, "last_activity_date": 1597120332, "last_edit_date": 1597120332, "creation_date": 1597119899, "answer_id": 63351488, "question_id": 54109434, "link": "https://stackoverflow.com/questions/54109434/installing-c11-compiler-with-no-admin-permission/63351488#63351488", "title": "installing c++11(+) compiler with no admin permission", "body": "<p>You can download the 7z file from :\n<code>https://sourceforge.net/projects/mingw-w64/files/</code></p>\n<p>If you intend to install the windows version,\nclick the <code>x86_64-posix-seh</code> from MinGW-W64 GCC-8.1.0, and just uncompress the 7z file.</p>\n"}], "owner": {"reputation": 91, "user_id": 10425462, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-JU4Jx260cQI/AAAAAAAAAAI/AAAAAAAAABo/8KsJQrYrKrU/photo.jpg?sz=128", "display_name": "Danijel", "link": "https://stackoverflow.com/users/10425462/danijel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2362, "favorite_count": 0, "answer_count": 3, "score": 3, "last_activity_date": 1606384863, "creation_date": 1547034487, "last_edit_date": 1587294987, "question_id": 54109434, "link": "https://stackoverflow.com/questions/54109434/installing-c11-compiler-with-no-admin-permission", "title": "installing c++11(+) compiler with no admin permission", "body": "<p>So, I'm 15 and I program in c++ in visual studio at home, but now, when I moved to another school, I got laptop and I want to compile c++11(+) code on that laptop but I don't have admin permission to install \"MinGW-w64 - for 32 and 64 bit Windows\". I was searching for a solution, but with no result... maybe if you can give me the \"magic keyword(s)\", explain me how can I \"upgrade\" compiler or something, I would be grateful. If I can do something to program in code blocks on laptop, because I have some librarys that I made, and I don't want to put all the code in main. And, I'm not really familiar with \"compilers\".</p>\n\n<p>Thanks.</p>\n\n<p>ps. Sorry for my english.</p>\n"}, {"tags": ["c++", "arrays", "c++11"], "comments": [{"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 4, "creation_date": 1547034603, "post_id": 54109425, "comment_id": 95051005, "body": "<a href=\"https://en.cppreference.com/w/cpp/container/array\" rel=\"nofollow noreferrer\"><code>std::array</code></a> is an <i>aggregate</i> and initialization works because of <a href=\"https://en.cppreference.com/w/cpp/language/aggregate_initialization\" rel=\"nofollow noreferrer\">aggregate initialization</a>."}], "owner": {"reputation": 4815, "user_id": 704028, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/64accf9ad1449326ae9f62e0f9e387c5?s=128&d=identicon&r=PG&f=1", "display_name": "tmaric", "link": "https://stackoverflow.com/users/704028/tmaric"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 47, "favorite_count": 0, "closed_date": 1547034540, "answer_count": 0, "score": 1, "last_activity_date": 1547034451, "creation_date": 1547034451, "question_id": 54109425, "link": "https://stackoverflow.com/questions/54109425/if-the-stdarray-does-not-have-a-constructor-that-takes-stdinitializer-lis", "closed_reason": "Duplicate", "title": "If the `std::array` does not have a constructor that takes `std::initializer_list` how does the initialization then work?", "body": "<p>There are many questions and answers about initializing an <code>std::array</code> data member with a <code>std::initializer_list</code> and how it's not possible because there is no constructor for the <code>std::array</code> available that takes . I would like to know how does the initialization of the <code>std::array</code> then work? </p>\n\n<p>What happens under the hood when a call like this is made: </p>\n\n<pre><code>std::array&lt;int, 4&gt; a = {1,2,3,4};  // (1)\n</code></pre>\n\n<p>How is the argument then interpreted, if it is not an <code>std::initializer_list&lt;int&gt;</code>? </p>\n\n<p>I have tried to figure how the initialization works by looking at the <a href=\"https://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/a00041_source.html#l00094\" rel=\"nofollow noreferrer\">libstdc++ source code</a>, and figuring out what is done with the <code>_M_elems</code> (<code>__array_traits::_Tp</code>), but I can't seem find either the actual allocation of an array that stores the data. I see it being used all over the place however:</p>\n\n<pre><code>       // Element access.\n       _GLIBCXX17_CONSTEXPR reference\n       operator[](size_type __n) noexcept\n  { return _AT_Type::_S_ref(_M_elems, __n); }\n</code></pre>\n\n<p>And <code>_S_ref</code> is a <code>constexpr</code> function that seems to return a <code>nullptr</code>? </p>\n\n<p>Where is the actual array data declared? I could understand if the compiler does something behind the scenes, as all the constructors are generated automatically, but I would like to know what happens and how is the initialization call (1) possible.</p>\n\n<p>Also, if I use an <code>std::array</code> as a data member for an N-dimensional <code>Point</code>, I have found an answer that proposes something like this: </p>\n\n<pre><code>template&lt;std::size_t N, typename BT=double&gt;\nclass Point \n{\n    public: \n\n        Point() = default;\n\n        template&lt;typename ... Args&gt;\n        Point(Args&amp;&amp; ... args)\n        :\n            values_{std::forward&lt;Args&gt;(args)...} \n        {}\n\n    private:\n\n        std::array&lt;BT, N&gt;  values_; \n};\n</code></pre>\n\n<p>Which makes it possible to do </p>\n\n<pre><code>Point&lt;1&gt; P1 {1.};   // (2)\nPoint&lt;3&gt; P3 {1.,2.,3.}; // (3)\n</code></pre>\n\n<p>I understand that the forward is required because (what I understand as) initializer lists used in (2,3) are lvalues. However, why is the curly bracket necessary? If I use a round bracket to initialize <code>values_</code></p>\n\n<pre><code>            values_(std::forward&lt;Args&gt;(args)...)    \n</code></pre>\n\n<p>I get </p>\n\n<pre><code>main.cpp: In instantiation of \u2018Point&lt;N, BT&gt;::Point(Args&amp;&amp; ...) [with Args = {double}; long unsigned int N = 1; BT = double]\u2019:\nmain.cpp:37:20:   required from here\nmain.cpp:14:48: error: no matching function for call to \u2018std::array&lt;double, 1&gt;::array(double)\u2019\n             values_(std::forward&lt;Args&gt;(args)...)\n</code></pre>\n"}, {"tags": ["c++", "c++17"], "comments": [{"owner": {"reputation": 4398, "user_id": 3697264, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/5adc5afbd7a1145fdd762d872b4b43bb?s=128&d=identicon&r=PG", "display_name": "SPlatten", "link": "https://stackoverflow.com/users/3697264/splatten"}, "edited": false, "score": 0, "creation_date": 1547034095, "post_id": 54109159, "comment_id": 95050706, "body": "There should be a definition you can use in a header called MAX_PATH."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1547037080, "post_id": 54109159, "comment_id": 95052518, "body": "Seems like a duplicate of <a href=\"https://stackoverflow.com/q/54007437/560648\">stackoverflow.com/q/54007437/560648</a>, potentially?"}, {"owner": {"reputation": 3108, "user_id": 4641116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gc52U.png?s=128&g=1", "display_name": "Eljay", "link": "https://stackoverflow.com/users/4641116/eljay"}, "edited": false, "score": 0, "creation_date": 1547037510, "post_id": 54109159, "comment_id": 95052778, "body": "Unfortunately, MAX_PATH has the old limit, not the current limit of 32768 UTF-16 encoding units."}, {"owner": {"reputation": 14474, "user_id": 2064761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GoIUL.png?s=128&g=1", "display_name": "Michael Kenzel", "link": "https://stackoverflow.com/users/2064761/michael-kenzel"}, "reply_to_user": {"reputation": 3108, "user_id": 4641116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gc52U.png?s=128&g=1", "display_name": "Eljay", "link": "https://stackoverflow.com/users/4641116/eljay"}, "edited": false, "score": 1, "creation_date": 1547038929, "post_id": 54109159, "comment_id": 95053655, "body": "@Eljay this is only partially true. At least <a href=\"https://docs.microsoft.com/en-us/windows/desktop/FileIO/naming-a-file#maximum-path-length-limitation\" rel=\"nofollow noreferrer\">according to MSDN</a>, one can exceed the <code>MAX_PATH</code> limit only for absolute paths with a \\\\?\\ prefix. And even then, the limit will not necessarily be exactly 32768 but a bit less\u2026"}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "reply_to_user": {"reputation": 14474, "user_id": 2064761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GoIUL.png?s=128&g=1", "display_name": "Michael Kenzel", "link": "https://stackoverflow.com/users/2064761/michael-kenzel"}, "edited": false, "score": 2, "creation_date": 1547053029, "post_id": 54109159, "comment_id": 95062602, "body": "@MichaelKenzel a little further down on that same MSDN page: &quot;<i>Starting in Windows 10, version 1607, MAX_PATH limitations have been removed from common Win32 file and directory functions. However, you must opt-in to the new behavior.</i>&quot; So you don&#39;t need \\\\?\\ anymore if you opt in."}, {"owner": {"reputation": 14474, "user_id": 2064761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GoIUL.png?s=128&g=1", "display_name": "Michael Kenzel", "link": "https://stackoverflow.com/users/2064761/michael-kenzel"}, "reply_to_user": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 0, "creation_date": 1547069900, "post_id": 54109159, "comment_id": 95070009, "body": "@RemyLebeau oh, that&#39;s cool, no idea how I missed that. Thanks for pointing that out!"}], "answers": [{"comments": [{"owner": {"reputation": 5574, "user_id": 536874, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/00yFk.jpg?s=128&g=1", "display_name": "Johannes", "link": "https://stackoverflow.com/users/536874/johannes"}, "edited": false, "score": 1, "creation_date": 1547034104, "post_id": 54109263, "comment_id": 95050710, "body": "I tested it and this is what I was looking for... now I need to wait 7 Minutes to accept your answer. :)"}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "edited": false, "score": 5, "creation_date": 1547034622, "post_id": 54109263, "comment_id": 95051016, "body": "Note that the returned string is a temporary, and therefore will be destroyed at the end of the full expression. This code may be fine assuming SDL doesn&#39;t store the pointer for later use, but it should be made clear to future visitors that storing <code>string().c_str()</code> for later use won&#39;t work."}], "tags": [], "owner": {"reputation": 14474, "user_id": 2064761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GoIUL.png?s=128&g=1", "display_name": "Michael Kenzel", "link": "https://stackoverflow.com/users/2064761/michael-kenzel"}, "is_accepted": true, "score": 17, "last_activity_date": 1547036865, "last_edit_date": 1547036865, "creation_date": 1547033877, "answer_id": 54109263, "question_id": 54109159, "link": "https://stackoverflow.com/questions/54109159/convert-filesystempath-into-char-on-windows/54109263#54109263", "title": "Convert filesystem::path into char* on windows", "body": "<p>You can use the <a href=\"https://en.cppreference.com/w/cpp/filesystem/path/string\" rel=\"noreferrer\"><code>*string()</code></a> and <a href=\"https://en.cppreference.com/w/cpp/filesystem/path/generic_string\" rel=\"noreferrer\"><code>generic_*string()</code></a> member functions of the <a href=\"https://en.cppreference.com/w/cpp/filesystem/path\" rel=\"noreferrer\"><code>std::filesystem::path</code></a> object to convert the path into either a native or a generic (i.e., POSIX-style) string. For example:</p>\n\n<pre><code>SDL_LoadBMP(p.path().string().c_str());\n</code></pre>\n\n<p>Note that these methods return an <code>std::basic_string&lt;T&gt;</code> value. So one must make sure that, e.g., a pointer obtained from calling <code>.c_str()</code> directly on the return value\u2014like in the example above\u2014does not outlive the string it points to\u2026</p>\n"}], "owner": {"reputation": 5574, "user_id": 536874, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/00yFk.jpg?s=128&g=1", "display_name": "Johannes", "link": "https://stackoverflow.com/users/536874/johannes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2826, "favorite_count": 0, "accepted_answer_id": 54109263, "answer_count": 1, "score": 8, "last_activity_date": 1547126744, "creation_date": 1547033538, "last_edit_date": 1547126744, "question_id": 54109159, "link": "https://stackoverflow.com/questions/54109159/convert-filesystempath-into-char-on-windows", "title": "Convert filesystem::path into char* on windows", "body": "<p>The <a href=\"https://en.cppreference.com/w/cpp/filesystem\" rel=\"noreferrer\">C++17 filesystem</a> is based on boost.filesystem.</p>\n\n<p>I am using it on Windows with VS2017 right now.</p>\n\n<pre><code>#include &lt;filesystem&gt;\nnamespace fs = std::experimental::filesystem;\n</code></pre>\n\n<p>I iterate over a directory</p>\n\n<pre><code>for (auto&amp; p: fs::directory_iterator(\"media\"))\n</code></pre>\n\n<p>I want to pass the paths to a function that takes filepaths as <code>const char *</code></p>\n\n<p>I found a similar question about the <a href=\"https://stackoverflow.com/questions/52010788/converting-boostfilesystempath-into-char\">boost filesystem here</a>.\nA core difference is that the <a href=\"https://en.cppreference.com/w/cpp/filesystem/path\" rel=\"noreferrer\">path in C++17</a> is based on a <code>value_type</code>.\nwhere </p>\n\n<blockquote>\n  <p><strong>value_type</strong>: character type used by the native encoding of the filesystem: char on POSIX, wchar_t on Windows</p>\n</blockquote>\n\n<p>So what I get is a <code>const wchar_t *</code> string.</p>\n\n<p>The following \"works\" for me:</p>\n\n<pre><code>    char file[2000];\n    wcstombs(file, p.path().c_str(), 2000);\n    auto image = SDL_LoadBMP(file);\n</code></pre>\n\n<p>I am looking for a different version since this implementation is all sorts of messy (decaying array to pointer and _CRT_SECURE_NO_WARNINGS).</p>\n\n<p>I am looking for a prettier version that can go straight from path to <code>const char *</code> using the new C++17 filesystem on windows.</p>\n\n<p>Here is my SDL2 project that I used to explore this with.</p>\n\n<pre><code>#define _CRT_SECURE_NO_WARNINGS 1\n#include &lt;SDL.h&gt;\n#include &lt;vector&gt;\n#include &lt;filesystem&gt;\nnamespace fs = std::experimental::filesystem;\n\nint main(int argc, char* argv[])\n{\n    SDL_Init(SDL_INIT_EVERYTHING);\n    auto window = SDL_CreateWindow(\"Test\", SDL_WINDOWPOS_UNDEFINED, SDL_WINDOWPOS_UNDEFINED, 800, 400, SDL_WINDOW_SHOWN);\n    auto scrrenSurface = SDL_GetWindowSurface(window);\n\n    auto images = std::vector&lt;SDL_Surface*&gt;();\n\n    for (auto&amp; p: fs::directory_iterator(\"media\"))\n    {\n        char file[2000];\n        wcstombs(file, p.path().c_str(), 2000);\n        auto image = SDL_LoadBMP(file);\n        images.push_back(image);\n    }\n\n    for (auto&amp;image : images)\n    {\n        SDL_BlitSurface(image, NULL, scrrenSurface, NULL);\n        SDL_UpdateWindowSurface(window);\n        SDL_Delay(2000);\n    }\n\n    for (auto&amp;image : images)\n        SDL_FreeSurface(image);\n\n    SDL_DestroyWindow(window);\n    SDL_Quit();\n    return 0;\n}\n</code></pre>\n\n<p>EDIT:\nIn the comment section there is a simmilar question linked <a href=\"https://stackoverflow.com/questions/54007437/using-stdfilesystem-output-as-lpcwstr\">so-question</a>\nThat questions is a different manifestation of the same core issue which is converting path to a format that can be consumed by another method. I would argue against deleting this question because of the way both are found with different searches.</p>\n"}, {"tags": ["c++", "sockets", "packet-capture"], "comments": [{"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1547033765, "post_id": 54109154, "comment_id": 95050528, "body": "What do you mean by &quot;[s]end full ethernet packet&quot;? Do you mean that the packet data you have is the complete ethernet frame? Including IP and TCP headers?"}, {"owner": {"reputation": 617, "user_id": 7280140, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/fHhkQ.jpg?s=128&g=1", "display_name": "Ahmed Hussein", "link": "https://stackoverflow.com/users/7280140/ahmed-hussein"}, "reply_to_user": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1547033817, "post_id": 54109154, "comment_id": 95050556, "body": "Yes, I have a FULL packet binary including all headers"}, {"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1547033851, "post_id": 54109154, "comment_id": 95050575, "body": "And remember that <code>connect</code> will set error codes that you can check to find out why it failed. Read the platform-specific manual page for <code>connect</code> to find out more."}, {"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1547033895, "post_id": 54109154, "comment_id": 95050601, "body": "Then you can&#39;t use TCP connections, unless you want to send the ethernet frame wrapped inside an TCP stream. You should probably do some more research about networking, including the different layers and socket types (like e.g. <i>raw</i> sockets) and much more."}, {"owner": {"reputation": 61409, "user_id": 485343, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e18b024a122df74275dd2c4486e8a2b4?s=128&d=identicon&r=PG", "display_name": "rustyx", "link": "https://stackoverflow.com/users/485343/rustyx"}, "edited": false, "score": 0, "creation_date": 1547034061, "post_id": 54109154, "comment_id": 95050685, "body": "You need <code>socket(AF_PACKET, SOCK_RAW, IPPROTO_RAW)</code>. Anyway, try googling &quot;send raw packet&quot;."}, {"owner": {"reputation": 617, "user_id": 7280140, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/fHhkQ.jpg?s=128&g=1", "display_name": "Ahmed Hussein", "link": "https://stackoverflow.com/users/7280140/ahmed-hussein"}, "edited": false, "score": 0, "creation_date": 1547034082, "post_id": 54109154, "comment_id": 95050699, "body": "Actually after doing a lot of research, I tried multiple times. For example, when I use raw sockets, the packet gets encapsulated into additional headers (this smudges the packet)"}, {"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1547034313, "post_id": 54109154, "comment_id": 95050838, "body": "By the way, this question is an <a href=\"https://meta.stackexchange.com/questions/66377/what-is-the-xy-problem\">XY problem</a>: You look for help with a solution to an for us unknown problem. What is the <i>real</i> problem? <i>Why</i> do you need to send raw ethernet frames? Can you live with sending raw IP packets? What is the contents of the ethernet frame? There are simply to many unknowns for us to be able to really help you."}, {"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1547034332, "post_id": 54109154, "comment_id": 95050848, "body": "And also please read about <a href=\"http://stackoverflow.com/help/how-to-ask\">how to ask good questions</a>, as well as <a href=\"https://codeblog.jonskeet.uk/2012/11/24/stack-overflow-question-checklist/\" rel=\"nofollow noreferrer\">this question checklist</a>."}, {"owner": {"reputation": 617, "user_id": 7280140, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/fHhkQ.jpg?s=128&g=1", "display_name": "Ahmed Hussein", "link": "https://stackoverflow.com/users/7280140/ahmed-hussein"}, "edited": false, "score": 0, "creation_date": 1547034535, "post_id": 54109154, "comment_id": 95050973, "body": "I just need to send it as a test. No big picture here.. Also, the content of the packet doesn&#39;t matter here"}, {"owner": {"reputation": 617, "user_id": 7280140, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/fHhkQ.jpg?s=128&g=1", "display_name": "Ahmed Hussein", "link": "https://stackoverflow.com/users/7280140/ahmed-hussein"}, "reply_to_user": {"reputation": 61409, "user_id": 485343, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e18b024a122df74275dd2c4486e8a2b4?s=128&d=identicon&r=PG", "display_name": "rustyx", "link": "https://stackoverflow.com/users/485343/rustyx"}, "edited": false, "score": 0, "creation_date": 1547035142, "post_id": 54109154, "comment_id": 95051335, "body": "@rustyx I tried your suggestion and it gives the same error"}], "answers": [{"comments": [{"owner": {"reputation": 617, "user_id": 7280140, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/fHhkQ.jpg?s=128&g=1", "display_name": "Ahmed Hussein", "link": "https://stackoverflow.com/users/7280140/ahmed-hussein"}, "edited": false, "score": 0, "creation_date": 1547060901, "post_id": 54113686, "comment_id": 95066274, "body": "Could you please give me an example, because I am not able to find a good example of code snippets online"}, {"owner": {"reputation": 617, "user_id": 7280140, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/fHhkQ.jpg?s=128&g=1", "display_name": "Ahmed Hussein", "link": "https://stackoverflow.com/users/7280140/ahmed-hussein"}, "edited": false, "score": 0, "creation_date": 1547128682, "post_id": 54113686, "comment_id": 95091607, "body": "But where is the ip address to which the packet will be redirected ? All I see is that you only inject a packet on a local interface. We still need either to redirect the packet to a specific IP address or send it directly to some ip address without using the local interface. Did you get it?"}, {"owner": {"reputation": 4505, "user_id": 1168733, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5ewxJ.jpg?s=128&g=1", "display_name": "Sigi", "link": "https://stackoverflow.com/users/1168733/sigi"}, "reply_to_user": {"reputation": 617, "user_id": 7280140, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/fHhkQ.jpg?s=128&g=1", "display_name": "Ahmed Hussein", "link": "https://stackoverflow.com/users/7280140/ahmed-hussein"}, "edited": false, "score": 1, "creation_date": 1547131328, "post_id": 54113686, "comment_id": 95093302, "body": "the packet won&#39;t be redirected. It will be put &quot;on-wire&quot;. the packet already has a destination IP address, in it&#39;s IP layer. Since you explicitly asked  not to tunnel it, the only option you have is to <i>edit</i> it, and to replace the IP with your intended destination."}, {"owner": {"reputation": 617, "user_id": 7280140, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/fHhkQ.jpg?s=128&g=1", "display_name": "Ahmed Hussein", "link": "https://stackoverflow.com/users/7280140/ahmed-hussein"}, "edited": false, "score": 0, "creation_date": 1547150395, "post_id": 54113686, "comment_id": 95103673, "body": "Tunneling is a good option for me. Now, I am trying GRE tunnels, but it seems that GRE is only able to tunnel IP packets not ethernet packets. Do you know a way to tunnel a full ethernet packet?"}, {"owner": {"reputation": 617, "user_id": 7280140, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/fHhkQ.jpg?s=128&g=1", "display_name": "Ahmed Hussein", "link": "https://stackoverflow.com/users/7280140/ahmed-hussein"}, "edited": false, "score": 0, "creation_date": 1547279134, "post_id": 54113686, "comment_id": 95145650, "body": "Also I knew that unlike GIF tunnels, GRE tunnels cannot carry layer2 traffic. That&#39;s why I am thinking about GIF tunnels. Could you help me on my AskUbuntu question here: <a href=\"https://askubuntu.com/questions/1109080/how-can-i-create-gif-tunnel-in-ubuntu\" title=\"how can i create gif tunnel in ubuntu\">askubuntu.com/questions/1109080/&hellip;</a>"}, {"owner": {"reputation": 4505, "user_id": 1168733, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5ewxJ.jpg?s=128&g=1", "display_name": "Sigi", "link": "https://stackoverflow.com/users/1168733/sigi"}, "reply_to_user": {"reputation": 617, "user_id": 7280140, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/fHhkQ.jpg?s=128&g=1", "display_name": "Ahmed Hussein", "link": "https://stackoverflow.com/users/7280140/ahmed-hussein"}, "edited": false, "score": 1, "creation_date": 1547391658, "post_id": 54113686, "comment_id": 95169060, "body": "I&#39;ve further edited the answer. I wasn&#39;t sure a tunnel was able to transport injected traffic, so I desired to test it before coming back."}, {"owner": {"reputation": 617, "user_id": 7280140, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/fHhkQ.jpg?s=128&g=1", "display_name": "Ahmed Hussein", "link": "https://stackoverflow.com/users/7280140/ahmed-hussein"}, "edited": false, "score": 0, "creation_date": 1548607690, "post_id": 54113686, "comment_id": 95592867, "body": "Do you know how to do the same using ssh tunneling ? I need it because the tunnel will be established between AWS EC2 instances"}, {"owner": {"reputation": 4505, "user_id": 1168733, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5ewxJ.jpg?s=128&g=1", "display_name": "Sigi", "link": "https://stackoverflow.com/users/1168733/sigi"}, "reply_to_user": {"reputation": 617, "user_id": 7280140, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/fHhkQ.jpg?s=128&g=1", "display_name": "Ahmed Hussein", "link": "https://stackoverflow.com/users/7280140/ahmed-hussein"}, "edited": false, "score": 0, "creation_date": 1548630357, "post_id": 54113686, "comment_id": 95599134, "body": "use a VPN or PPP over SSH. AWS has their own networking product, to let different instances communicate each-other thought."}, {"owner": {"reputation": 617, "user_id": 7280140, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/fHhkQ.jpg?s=128&g=1", "display_name": "Ahmed Hussein", "link": "https://stackoverflow.com/users/7280140/ahmed-hussein"}, "edited": false, "score": 0, "creation_date": 1548784942, "post_id": 54113686, "comment_id": 95664199, "body": "OK, I configured a tunnel using PPP over SSH. But when I write a packet on host A interface <code>ppp0</code> nothing reaches host B <code>ppp0</code> (unlike <code>gretap1</code>). I am unable to know why?"}, {"owner": {"reputation": 617, "user_id": 7280140, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/fHhkQ.jpg?s=128&g=1", "display_name": "Ahmed Hussein", "link": "https://stackoverflow.com/users/7280140/ahmed-hussein"}, "edited": false, "score": 0, "creation_date": 1548949839, "post_id": 54113686, "comment_id": 95736784, "body": "I solved my problem now. After creating <code>ppp0</code> on both machines, I created a gretap connecting the PPP interfaces together"}], "tags": [], "owner": {"reputation": 4505, "user_id": 1168733, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5ewxJ.jpg?s=128&g=1", "display_name": "Sigi", "link": "https://stackoverflow.com/users/1168733/sigi"}, "is_accepted": true, "score": 1, "last_activity_date": 1547391960, "last_edit_date": 1547391960, "creation_date": 1547048799, "answer_id": 54113686, "question_id": 54109154, "link": "https://stackoverflow.com/questions/54109154/send-full-ethernet-packet-to-specific-ip-using-c/54113686#54113686", "title": "Send full ethernet packet to specific ip using C++", "body": "<p>Use <code>libpcap</code>, <a href=\"https://www.tcpdump.org/manpages/pcap_inject.3pcap.html\" rel=\"nofollow noreferrer\">pcap_inject()</a> in particular.</p>\n\n<p>You cannot use <code>socket()</code>, using <code>IPPROTO_RAW</code> either, because L2(eth) and L3(ip) will be forged by the IP stack of the OS in this case too. </p>\n\n<p>You need to inject the packet directly into the network card. If you want it delivered to an IP different from the original one, you have to \"edit\" the packet contents.</p>\n\n<p>Example pasted from here: <a href=\"http://www.microhowto.info/howto/send_an_arbitrary_ethernet_frame_using_libpcap.html\" rel=\"nofollow noreferrer\">http://www.microhowto.info/howto/send_an_arbitrary_ethernet_frame_using_libpcap.html</a></p>\n\n<pre><code>char pcap_errbuf[PCAP_ERRBUF_SIZE];\npcap_errbuf[0]='\\0';\n\npcap_t* pcap=pcap_open_live(if_name,65536,0,0,pcap_errbuf);\nif (pcap_errbuf[0]!='\\0') {\n    fprintf(stderr,\"%s\",pcap_errbuf);\n}\n\nif (!pcap) {\n    exit(1);\n}\n\nif (pcap_inject(pcap, &lt;PACKET_DATA&gt; , &lt;PACKET_SIZE&gt; )==-1) {\n    pcap_perror(pcap,0);\n    pcap_close(pcap);\n    exit(1);\n}\n\npcap_close(pcap)\n</code></pre>\n\n<p>If you don't want to edit the IP destination, the packet will be able to reach the other end of the wire only if you haven't switches/routers between the two peers.</p>\n\n<p>As an alternative the OP suggesting to use a tunnel. It actually works (I tested it with <code>tcpreplay</code>) - you can use a GRE tunnel, which actually can transport ethernet traffic too.</p>\n\n<p>On the two peers you can establish a <em>gretap</em> tunnel. I used these commands:</p>\n\n<p>on host A (its IP address is 192.168.1.211):</p>\n\n<pre><code>ip link add gretap1 type gretap local 192.168.1.211 remote 192.168.1.64\nip link set gretap1 up\n</code></pre>\n\n<p>on host B (its IP address is 192.168.1.64):</p>\n\n<pre><code>ip link add gretap1 type gretap local 192.168.1.64 remote 192.168.1.211\nip link set gretap1 up\n</code></pre>\n\n<p>At this point it's possible to use the L2 GRE tunnel and let it transport ETH traffic using the gretap1 interfaces. On one peer I injected the traffic into the tunnel with the command:</p>\n\n<pre><code>tcpreplay -i gretap1 test.pcap\n</code></pre>\n\n<p>and on the other peer verified the traffic was transmitted capturing it on the gretap1 interface using wireshark or tcpdump.</p>\n\n<p>Unfortunately there is a problem with this setup: the MTU of the tunnel is smaller than the MTU of the network, so it's not guaranteed that you can replay all the packets.</p>\n"}], "owner": {"reputation": 617, "user_id": 7280140, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/fHhkQ.jpg?s=128&g=1", "display_name": "Ahmed Hussein", "link": "https://stackoverflow.com/users/7280140/ahmed-hussein"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1229, "favorite_count": 0, "accepted_answer_id": 54113686, "answer_count": 1, "score": 0, "last_activity_date": 1547391960, "creation_date": 1547033531, "last_edit_date": 1547036158, "question_id": 54109154, "link": "https://stackoverflow.com/questions/54109154/send-full-ethernet-packet-to-specific-ip-using-c", "title": "Send full ethernet packet to specific ip using C++", "body": "<p>I am trying to send a full packet to specific IP address. The point is that I already have full packet binary and I don't want it to be encapsulated into any additional packet headers. Here is my logic:</p>\n\n<pre><code>std::string destination_ip = \"127.0.0.1\";\nuint16_t destination_port = 8080;\nint socket_fd;\n\nstruct sockaddr_in socket_attrs;\n\nif ((socket_fd = socket(AF_INET, SOCK_PACKET, htons(ETH_P_ALL))) &lt; 0)\n{\n    printf(\"Socket creation error\\n\");\n    return false;\n}\n\nmemset(&amp;socket_attrs, '0', sizeof(socket_attrs));\n\nsocket_attrs.sin_family = AF_INET;\nsocket_attrs.sin_port = htons(destination_port);\n\nif(inet_pton(AF_INET, destination_ip.c_str(), &amp;socket_attrs.sin_addr)&lt;=0)\n{\n    printf(\"Invalid IP address/ IP address not supported\\n\");\n    return false;\n}\n\nif (connect(socket_fd, (struct sockaddr *)&amp;socket_attrs, sizeof(socket_attrs)) &lt; 0)\n{\n    printf(\"Connection Failed\\n\");\n    return false;\n}\n\nif((write(socket_fd , &lt;PACKET_DATA&gt; , &lt;PACKET_SIZE&gt;)) &lt; 0){\n    std::cout &lt;&lt; \"Error sending packets to the network\" &lt;&lt; std::endl;\n    exit(1);\n}\n</code></pre>\n\n<p><strong>Output:</strong></p>\n\n<pre><code>Connection Failed\n</code></pre>\n\n<p>Could anyone help me achieve my goal?</p>\n"}, {"tags": ["c++", "templates", "stdset"], "comments": [{"owner": {"reputation": 18020, "user_id": 580083, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/085edb5b64d5db3362d784bd9d35f99c?s=128&d=identicon&r=PG", "display_name": "Daniel Langr", "link": "https://stackoverflow.com/users/580083/daniel-langr"}, "edited": false, "score": 1, "creation_date": 1547034111, "post_id": 54109146, "comment_id": 95050715, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/48176182/find-elements-of-stdset-by-custom-comparison-with-value-of-different-type\">Find elements of std::set by custom comparison with value of different type</a>"}, {"owner": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "edited": false, "score": 3, "creation_date": 1547035106, "post_id": 54109146, "comment_id": 95051308, "body": "I question the idea of a type where <code>a &lt; b</code> and <code>a == b</code> can be true at the same time."}, {"owner": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "edited": false, "score": 1, "creation_date": 1547035491, "post_id": 54109146, "comment_id": 95051559, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/2620862/using-custom-stdset-comparator\">Using custom std::set comparator</a>"}], "answers": [{"tags": [], "owner": {"reputation": 34388, "user_id": 2610810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8c6433073e71478e8da278a188e1d15?s=128&d=identicon&r=PG", "display_name": "Caleth", "link": "https://stackoverflow.com/users/2610810/caleth"}, "is_accepted": false, "score": 0, "last_activity_date": 1547041404, "last_edit_date": 1547041404, "creation_date": 1547040974, "answer_id": 54111420, "question_id": 54109146, "link": "https://stackoverflow.com/questions/54109146/change-stdset-to-find-item-by-t-type/54111420#54111420", "title": "Change std::set to find item by T type", "body": "<p><code>std::set</code> does not care about <code>operator==</code>, it uses an equivalence relation defined to have the same results as </p>\n\n<pre><code>bool equiv(T a, T b)\n{\n    if (a &lt; b) return false;\n    if (b &lt; a) return false;\n    return true;\n}\n</code></pre>\n\n<p>If you have <code>State&lt;T&gt;</code> values with differing <code>state</code> but equal <code>cost</code>, only one of them can go in your <code>std::set</code>.</p>\n\n<p>You might have success with a <a href=\"https://www.boost.org/doc/libs/1_69_0/libs/multi_index/doc/index.html\" rel=\"nofollow noreferrer\"><code>boost::multi_index_container</code></a>, where you can look things up by <em>either</em> <code>cost</code> or <code>state</code></p>\n\n<pre><code>namespace bmi = boost::multi_index;\nusing state_set = boost::multi_index_container&lt;State&lt;T&gt;, \n    bmi::indexed_by&lt;\n        bmi::ordered_unique&lt;bmi::member&lt;State&lt;T&gt;, double, &amp;State&lt;T&gt;::cost&gt;&gt;,\n        bmi::ordered_non_unique&lt;bmi::member&lt;State&lt;T&gt;, T, &amp;State&lt;T&gt;::state&gt;&gt;\n    &gt;\n&gt;;\n\nstate_set set = ...;\nauto &amp; states_view = set.nth_index&lt;1&gt;();\nif (auto it = states_view.find(x); it != states_view.end())\n    ...\n</code></pre>\n"}], "owner": {"reputation": 19, "user_id": 10519163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e096de530d7cfd9ecc33f5f5d72883e2?s=128&d=identicon&r=PG&f=1", "display_name": "AD1234", "link": "https://stackoverflow.com/users/10519163/ad1234"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 56, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547041404, "creation_date": 1547033506, "last_edit_date": 1547033917, "question_id": 54109146, "link": "https://stackoverflow.com/questions/54109146/change-stdset-to-find-item-by-t-type", "title": "Change std::set to find item by T type", "body": "<pre><code>template&lt;class T&gt;\nclass State {\n    T state;\n    double cost = 0;\n    State&lt;T&gt; *cameFrom = nullptr;\n</code></pre>\n\n<p>I have this template class, and i want to create a <code>std::set&lt;State&lt;T&gt;&gt;</code></p>\n\n<p>the <code>&lt;</code> operator of the class returns <code>this.cost &lt; other.cost</code></p>\n\n<p>the <code>==</code> operator of the class returns <code>this.state == other.state</code></p>\n\n<p>lets say i want to check if a <code>State&lt;T&gt; x</code> is in a set</p>\n\n<p>how can i make the set to return an iter !- end()(calling <code>set.find(x)</code>) iff the set contains a <code>State&lt;T&gt;</code> with the same <code>state(x.state)</code> as <code>x</code>?</p>\n"}, {"tags": ["c++", "boost", "cmake"], "comments": [{"owner": {"reputation": 3126, "user_id": 2955790, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vShcC.png?s=128&g=1", "display_name": "Duck Dodgers", "link": "https://stackoverflow.com/users/2955790/duck-dodgers"}, "edited": false, "score": 0, "creation_date": 1547035316, "post_id": 54109024, "comment_id": 95051448, "body": "Regarding the warning, you might take a look at this: <a href=\"https://cmake.org/cmake/help/v3.0/policy/CMP0022.html\" rel=\"nofollow noreferrer\">cmake CMP0022</a>. I don&#39;t think that is the problem."}, {"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 1, "creation_date": 1547037121, "post_id": 54109024, "comment_id": 95052542, "body": "&quot;not found&quot; just means that corresponded function is not implemented by the given compiler (Visual Studio 10 in your case). It doesn&#39;t prevent the project to be built. So, what is a <b>problem</b>?"}, {"owner": {"reputation": 26, "user_id": 9726925, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/96f42697f746aa81fb4b1266a9749f4c?s=128&d=identicon&r=PG&f=1", "display_name": "GiPag", "link": "https://stackoverflow.com/users/9726925/gipag"}, "edited": false, "score": 0, "creation_date": 1547038372, "post_id": 54109024, "comment_id": 95053284, "body": "yes I compiled them thanks they were in the folder \\driver\\Debug but without 2 sub-projects PACKAGE and INSTALL"}], "owner": {"reputation": 26, "user_id": 9726925, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/96f42697f746aa81fb4b1266a9749f4c?s=128&d=identicon&r=PG&f=1", "display_name": "GiPag", "link": "https://stackoverflow.com/users/9726925/gipag"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 32, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1547036471, "creation_date": 1547033015, "last_edit_date": 1547036471, "question_id": 54109024, "link": "https://stackoverflow.com/questions/54109024/compile-correcty-connector-1-1-7-in-debug-mode-for-pdb-with-vs2010", "title": "Compile correcty Connector 1.1.7 in debug mode for .pdb with VS2010", "body": "<p>Correct setting for compile on debug mode with VS2010 x86 ?</p>\n\n<p>i have set this:</p>\n\n<pre><code>set MYSQL_DIR=C:\\Program Files (x86)\\MySQL\\MySQL Server 5.7\nset BOOST_INCLUDE_DIRS=C:\\local\\boost_1_61_0\nand used this command:\ncmake -G \"Visual Studio 10 2010\"\n</code></pre>\ni'm using cmake version 3.13.2\n\n<pre><code>But it show:\n-- Looking for strtold\n-- Looking for strtold - not found\n-- Looking for strtol\n-- Looking for strtol - found\n-- Looking for strtoll\n-- Looking for strtoll - not found\n-- Looking for strtoul\n-- Looking for strtoul - found\n-- Looking for strtoull\n-- Looking for strtoull - not found\n-- Looking for strtoimax\n-- Looking for strtoimax - not found\n-- Looking for strtoumax\n-- Looking for strtoumax - not found\n\nand:\nCMake Warning (dev) in driver/CMakeLists.txt:\n  Policy CMP0022 is not set: INTERFACE_LINK_LIBRARIES defines the link\n  interface.  Run \"cmake --help-policy CMP0022\" for policy details.  Use the\n  cmake_policy command to set the policy and suppress this warning.\n</code></pre>\n\n<p>what is missing ?</p>\n"}, {"tags": ["c#", "c++", "msbuild", "visual-studio-2017", "dependency-walker"], "comments": [{"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 0, "creation_date": 1547032699, "post_id": 54108872, "comment_id": 95049952, "body": "If the third party libraries are designed so that resources allocated in them is also freed in them, then you may not have to recompile them."}, {"owner": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 0, "creation_date": 1547032814, "post_id": 54108872, "comment_id": 95050013, "body": "If any of the library dependencies depend on VC++ 10 redist then your executable automatically becomes dependent on VC++ 10 redist. So yes, it would be a good idea to recompile all the dependencies for which you have a source code. Recompilation is mandatory if dependency uses C++ interface. Also note that you can continue using old toolset with newer visual studio."}], "owner": {"reputation": 497, "user_id": 2218666, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/cc24be21f448cefbfda82e5b8f39cd02?s=128&d=identicon&r=PG", "display_name": "Deepak Selvakumar", "link": "https://stackoverflow.com/users/2218666/deepak-selvakumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 42, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1547032729, "creation_date": 1547032478, "last_edit_date": 1547032729, "question_id": 54108872, "link": "https://stackoverflow.com/questions/54108872/migrating-windows-project-to-vs-2017-with-third-party-libraries", "title": "Migrating windows project to VS 2017 with third party libraries", "body": "<p>I have a solution of about 10 projects, a mixture of c# and C++ which were built using VS 10 as DLLs and run with VC++ redist 10.\nIt uses various third-party libraries such as protobuf, gtest, openssl etc all built with vs 10 toolsets. And hence the application used to run smoothly loading these library dlls at runtime.</p>\n\n<p>Now I had to upgrade the project and build the solution in VS 17 i.e. toolset 15.0. I have built all the projects and third-party libraries as well.</p>\n\n<p>But I am using this one third-party Microsoft SCOM SDK library which I am not able to build with toolset 15.0</p>\n\n<p>And when I run my application it fails to load the base dll, the project dll itself(which in turn links to Microsoft scom SDK dll).</p>\n\n<p>dependency walker shows that the project's dll still depends on some vc++ 10 libraries despite building it with latest toolset 15.0 for vs2017.</p>\n\n<p>When doing the migration, do we really have to rebuild each and every dependent dll including third-party dlls which are linked at run time?</p>\n\n<ol>\n<li><p>Is my understanding correct?</p></li>\n<li><p>Does the dependency walker show the dependent libraries of the only the mentioned dll or also all the dlls recursively which it depends?</p></li>\n<li><p>Is there are any alternative way in handling this?</p></li>\n</ol>\n"}, {"tags": ["java", "c++", "recursion", "dynamic-programming", "memoization"], "comments": [{"owner": {"reputation": 481, "user_id": 6713871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6d0cf46b08a63241386786e74ae4b1f?s=128&d=identicon&r=PG&f=1", "display_name": "Chris Rollins", "link": "https://stackoverflow.com/users/6713871/chris-rollins"}, "edited": false, "score": 0, "creation_date": 1547033647, "post_id": 54108870, "comment_id": 95050463, "body": "It appears to have a compilation error. Are you sure you&#39;re not just running an older build of the program? Some IDEs will do that. You&#39;ve also got some warnings because you&#39;re doing comparisons between signed and unsigned ints and you really shouldn&#39;t ignore warnings in C++."}, {"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 0, "creation_date": 1547034642, "post_id": 54108870, "comment_id": 95051027, "body": "<i>The C++ code is returning false for &quot;applepenapple&quot; with dictionary [&quot;apple&quot;,&quot;pen&quot;]</i> -- Please post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> instead of a description."}, {"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 0, "creation_date": 1547035840, "post_id": 54108870, "comment_id": 95051764, "body": "It isn&#39;t a good idea to attempt to do a line-by-line translation from Java to C++ and vice-versa.  You are not learning C++ by doing this, instead it is an easy way to totally get things wrong.  For example <code>substr</code> in C++ is not the same as <code>substring</code> in Java.  In addition (as the other comment pointed out), you are not heeding the warnings of the compiler about <code>unsigned</code>.  Also, your usage of the variable name <code>set</code> is not a good idea, since there is a <code>std::set</code> in the C++ standard library, causing confusing code."}], "answers": [{"comments": [{"owner": {"reputation": 715, "user_id": 3586940, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9c9c03c81770b24d1a922d741af79c2?s=128&d=identicon&r=PG&f=1", "display_name": "user3586940", "link": "https://stackoverflow.com/users/3586940/user3586940"}, "edited": false, "score": 0, "creation_date": 1547037129, "post_id": 54109764, "comment_id": 95052546, "body": "Can confirm this fixed the erroneous test cases. Thanks a million."}], "tags": [], "owner": {"reputation": 20170, "user_id": 128812, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2a788bccab3ba83583d3f796f14cfb2?s=128&d=identicon&r=PG", "display_name": "gpeche", "link": "https://stackoverflow.com/users/128812/gpeche"}, "is_accepted": true, "score": 4, "last_activity_date": 1547035549, "creation_date": 1547035549, "answer_id": 54109764, "question_id": 54108870, "link": "https://stackoverflow.com/questions/54108870/c-vs-java-memoization-discrepancy/54109764#54109764", "title": "C++ vs Java Memoization Discrepancy", "body": "<p>I see a potential problem. From <a href=\"https://docs.oracle.com/javase/7/docs/api/java/lang/String.html#substring(int,%20int)\" rel=\"nofollow noreferrer\"><code>java.lang.String</code> Javadoc</a> (emphasis mine):</p>\n\n<blockquote>\n  <p><code>public String substring(int beginIndex, int endIndex)</code></p>\n  \n  <p>Returns a new string that is a substring of this string. The substring begins at the specified beginIndex and extends to the character at index endIndex - 1. Thus the length of the substring is endIndex-beginIndex.</p>\n  \n  <p>Examples:</p>\n\n<pre><code>\"hamburger\".substring(4, 8) returns \"urge\"\n\"smiles\".substring(1, 5) returns \"mile\"\n</code></pre>\n  \n  <p>Parameters:</p>\n  \n  <p>beginIndex - the beginning index, inclusive.</p>\n  \n  <p>endIndex - <strong>the ending index</strong>, exclusive.</p>\n</blockquote>\n\n<p>From <a href=\"https://en.cppreference.com/w/cpp/string/basic_string/substr\" rel=\"nofollow noreferrer\">cppreference.com documentation on strings</a>:</p>\n\n<blockquote>\n  <p><code>basic_string substr( size_type pos = 0, size_type count = npos ) const;</code></p>\n  \n  <p>Returns a substring [pos, pos+count). If the requested substring extends past the end of the string, or if count == npos, the returned substring is [pos, size()).</p>\n  \n  <p>Parameters</p>\n  \n  <p>pos   -   position of the first character to include</p>\n  \n  <p>count     -   <strong>length of the substring</strong> </p>\n</blockquote>\n\n<p>That is, in Java you should pass an index as second parameter to <code>String.substring(...)</code>, but in C++ you should pass a length to <code>basic_string::substr(...)</code>. However, you are doing:</p>\n\n<pre><code>s.substr(start, end)\n</code></pre>\n\n<p>and</p>\n\n<pre><code>s.substring(start, end)\n</code></pre>\n\n<p>in both cases.</p>\n\n<p>Maybe adjusting the C++ invocation to </p>\n\n<pre><code>s.substr(start, end - start)\n</code></pre>\n\n<p>will work?</p>\n"}], "owner": {"reputation": 715, "user_id": 3586940, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9c9c03c81770b24d1a922d741af79c2?s=128&d=identicon&r=PG&f=1", "display_name": "user3586940", "link": "https://stackoverflow.com/users/3586940/user3586940"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "closed_date": 1547037969, "accepted_answer_id": 54109764, "answer_count": 1, "score": 0, "last_activity_date": 1547035549, "creation_date": 1547032459, "last_edit_date": 1547032820, "question_id": 54108870, "link": "https://stackoverflow.com/questions/54108870/c-vs-java-memoization-discrepancy", "closed_reason": "Duplicate", "title": "C++ vs Java Memoization Discrepancy", "body": "<p>So I've been trying to solve the word break Dynamic Programming problem, which basically means that given a dictionary of strings and  a string, see if the words in the dictionary can be combined to form the string. For example, given word \"applepenapple\" and dictionary [\"apple\",\"pen\"] it should return true. </p>\n\n<p>I have a working java solution, but I'm trying to improve my C++ skills. My problem is even though my code looks extremely similar to the working solution in Java, I am failing a niche test case and I can't figure out why. </p>\n\n<p>C++ code:</p>\n\n<pre><code>bool wordBreak(string s, vector&lt;string&gt; &amp;wordDict) {\n    vector&lt;int&gt; bArr(s.length(), -1);\n    unordered_set&lt;string&gt; set(wordDict.begin(), wordDict.end());\n    return wordBreak(s, bArr, 0, set);\n}\n\nbool wordBreak(string s, vector&lt;int&gt; &amp;bArr, int start, unordered_set&lt;string&gt; &amp;set) {\n    if (start == s.length())\n        return true;\n    //If we have a memoized solution to this problem, avoid recurion\n    if (bArr[start] != -1)\n        return (bArr[start] == 1);\n    for (int end = start + 1; end &lt;= s.length(); end++) {\n        if (set.count(s.substr(start, end)) &amp;&amp; wordBreak(s, bArr, end, set)) {\n            bArr[start] = 1;\n            return bArr[start] == 1;\n        }\n    }\n    bArr[start] = 0;\n    return false;\n}\n</code></pre>\n\n<p>Working code using java:</p>\n\n<pre><code>public boolean wordBreak(String s, List&lt;String&gt; wordDict) {\n    Integer[] memo =new Integer[s.length()];\n    Arrays.fill(memo,-1);\n    return word_Break(s, new HashSet(wordDict), 0, memo);\n}\n\npublic boolean word_Break(String s, Set&lt;String&gt; wordDict, int start, Integer[] memo) {\n    if (start == s.length()) {\n        return true;\n    }\n    if (memo[start] != -1) {\n        return memo[start]==1;\n    }\n    for (int end = start + 1; end &lt;= s.length(); end++) {\n        if (wordDict.contains(s.substring(start, end)) &amp;&amp; word_Break(s, wordDict, end, memo)) {\n            memo[start] = 1;\n            return memo[start] == 1;\n        }\n    }\n    memo[start] = 0;\n    return false;\n}\n</code></pre>\n\n<p>The C++ code is returning false for \"applepenapple\" with dictionary [\"apple\",\"pen\"] and I don't know why since the java return true which is correct. The only major difference (I think) between the two solutions is that my C++ uses a vector instead of a native array in the java code. Initially I thought it might have to do with C++ using automatic storage (stack) vs the  free store (heap) which is why I used the vector instead of a C-style array to avoid memory management because of RAII. Despite this change, the bug persists. There is an easier solution avoiding recursion altogether, but I am very curious as to why the C++ is returning different output than the java. </p>\n"}, {"tags": ["c++", "arrays", "graphics", "sfml"], "answers": [{"comments": [{"owner": {"reputation": 9936, "user_id": 6525260, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-DdsW6uGdpjg/AAAAAAAAAAI/AAAAAAAAAAw/srXxxqCzyW0/photo.jpg?sz=128", "display_name": "Arnav Borborah", "link": "https://stackoverflow.com/users/6525260/arnav-borborah"}, "reply_to_user": {"reputation": 25, "user_id": 10807168, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-LbA4usjpUaU/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jRv2UJoUZ9AY5SfwgqXB4jOCay9g/mo/photo.jpg?sz=128", "display_name": "Constantine Freak", "link": "https://stackoverflow.com/users/10807168/constantine-freak"}, "edited": false, "score": 1, "creation_date": 1547032363, "post_id": 54108701, "comment_id": 95049788, "body": "@ConstantineFreak You might also consider using just one rectangle for the sake of not having 81 different rectangles (memory). In that case, render a rectangle and then move it to the next location."}, {"owner": {"reputation": 25, "user_id": 10807168, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-LbA4usjpUaU/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jRv2UJoUZ9AY5SfwgqXB4jOCay9g/mo/photo.jpg?sz=128", "display_name": "Constantine Freak", "link": "https://stackoverflow.com/users/10807168/constantine-freak"}, "edited": false, "score": 0, "creation_date": 1547032744, "post_id": 54108701, "comment_id": 95049975, "body": "Oh I see, so I can move a rectangle to a position, draw it, and then move it elsewhere and draw it again. So when I display the window all locations where the rectangle was drawn will display properly? Thats nice."}, {"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "reply_to_user": {"reputation": 25, "user_id": 10807168, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-LbA4usjpUaU/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jRv2UJoUZ9AY5SfwgqXB4jOCay9g/mo/photo.jpg?sz=128", "display_name": "Constantine Freak", "link": "https://stackoverflow.com/users/10807168/constantine-freak"}, "edited": false, "score": 0, "creation_date": 1547033549, "post_id": 54108701, "comment_id": 95050410, "body": "@ConstantineFreak Yes it&#39;s possible to do that. It&#39;s also a trade-of, do you want to be a little quicker but use more memory, or use less memory but use a little more CPU power? Though in this case the amount of extra memory or CPU power will be negligible and basically unmeasurable."}], "tags": [], "owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "is_accepted": true, "score": 4, "last_activity_date": 1547031906, "creation_date": 1547031906, "answer_id": 54108701, "question_id": 54108629, "link": "https://stackoverflow.com/questions/54108629/c-sfml-how-to-successfully-iteratively-render-shapes/54108701#54108701", "title": "C++ SFML: How to successfully Iteratively render shapes?", "body": "<p>I think the main problem is the definition</p>\n\n<pre><code>sf::RectangleShape tiles[81] = {sf::RectangleShape(sf::Vector2f(20, 20))};\n</code></pre>\n\n<p>Here you explicitly initialize only the <em>first</em> element (<code>tiles[0]</code>). All the rest of the elements will only have default-constructed shape objects.</p>\n\n<p>To properly initialize all elements to the same values, either use a loop</p>\n\n<pre><code>for (auto&amp; shape : tiles)\n    shape = sf::RectangleShape(sf::Vector2f(20, 20));\n</code></pre>\n\n<p>Or use a vector</p>\n\n<pre><code>std::vector&lt;sf::RectangleShape&gt; tiles(81, sf::RectangleShape(sf::Vector2f(20, 20)));\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 10807168, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-LbA4usjpUaU/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jRv2UJoUZ9AY5SfwgqXB4jOCay9g/mo/photo.jpg?sz=128", "display_name": "Constantine Freak", "link": "https://stackoverflow.com/users/10807168/constantine-freak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 370, "favorite_count": 0, "accepted_answer_id": 54108701, "answer_count": 1, "score": 0, "last_activity_date": 1547031906, "creation_date": 1547031646, "question_id": 54108629, "link": "https://stackoverflow.com/questions/54108629/c-sfml-how-to-successfully-iteratively-render-shapes", "title": "C++ SFML: How to successfully Iteratively render shapes?", "body": "<p>I'm looking to iteratively create a set of rectangle shapes of different colours and display them on the screen in different positions. This should produce a maze made up of rectangles.</p>\n\n<p>The positions of the shapes should reflect the array that stores a 9x9 maze.</p>\n\n<p>I'm able to successfully create a single shape, change it's colour and position. However, when I try to do the same to a shape inside an array it does not work. Only a single blue rectangle is generated in the top right corner of the screen.</p>\n\n<p>int main() {</p>\n\n<pre><code>sf::RenderWindow window(sf::VideoMode(1920, 1080), \"Baphomet\");\nsf::RectangleShape tiles[81] = {sf::RectangleShape(sf::Vector2f(20, 20))};\n\nchar maze[81] = {0, 0, 0, 0, 0, 0, 0, 0, 0,\n                 0, 1, 0, 1, 0, 1, 1, 1, 0,\n                 0, 1, 0, 1, 0, 1, 0, 1, 0,\n                 0, 1, 1, 1, 0, 1, 0, 1, 0,\n                 0, 0, 0, 1, 0, 1, 0, 1, 0,\n                 0, 1, 1, 1, 0, 1, 1, 1, 0,\n                 0, 0, 1, 0, 0, 0, 1, 0, 0,\n                 0, 0, 1, 1, 1, 1, 1, 1, 0,\n                 0, 0, 0, 0, 0, 0, 0, 0, 0};\n\nint x;\nint y;\n\nfor (int i = 0; i &lt; 81; i++) {\n\n    if (maze[i] == 0) {\n        tiles[i].setFillColor(sf::Color::Blue);\n    } else if (maze[i] == 1) {\n        tiles[i].setFillColor(sf::Color::Red);\n    }\n\n    x = (i % 9) * 20;\n    y = (i / 9) * 20;\n\n    std::cout &lt;&lt; x  &lt;&lt; \" \" &lt;&lt; y &lt;&lt; std::endl;\n\n    tiles[i].setPosition((float)x, (float)y);\n\n}\n\nwhile (window.isOpen())\n{\n    sf::Event event;\n    while (window.pollEvent(event))\n    {\n        if (event.type == sf::Event::Closed)\n            window.close();\n    }\n\n    window.clear();\n    for (int i = 0; i &lt; 81; i++) {\n        window.draw(tiles[i]);\n    }\n\n    window.display();\n}\n\nreturn 0;\n</code></pre>\n\n<p>}</p>\n\n<p>How can I make the shapes change their positions to the x and y variables successfully? </p>\n"}, {"tags": ["c++"], "comments": [{"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 3, "creation_date": 1547031521, "post_id": 54108488, "comment_id": 95049248, "body": "Use <a href=\"https://en.cppreference.com/w/cpp/string/basic_string/find\" rel=\"nofollow noreferrer\"><code>std::string::find()</code></a> or <code>std::regex</code> to check if a particular word or pattern appears in a line."}, {"owner": {"reputation": 916, "user_id": 3049394, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0145b4df8a9b3238b784bbcf300cd54?s=128&d=identicon&r=PG&f=1", "display_name": "TVK", "link": "https://stackoverflow.com/users/3049394/tvk"}, "edited": false, "score": 0, "creation_date": 1547031611, "post_id": 54108488, "comment_id": 95049323, "body": "check out this answer: <a href=\"https://stackoverflow.com/questions/26576714/deleting-specific-line-from-file\" title=\"deleting specific line from file\">stackoverflow.com/questions/26576714/&hellip;</a>"}, {"owner": {"reputation": 29, "user_id": 8226915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c84a331b910804671675311823c5781a?s=128&d=identicon&r=PG&f=1", "display_name": "Keii", "link": "https://stackoverflow.com/users/8226915/keii"}, "reply_to_user": {"reputation": 916, "user_id": 3049394, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0145b4df8a9b3238b784bbcf300cd54?s=128&d=identicon&r=PG&f=1", "display_name": "TVK", "link": "https://stackoverflow.com/users/3049394/tvk"}, "edited": false, "score": 0, "creation_date": 1547032132, "post_id": 54108488, "comment_id": 95049654, "body": "@TVK i&#39;m getting this kind of error &quot;terminate called after throwing an instance of &#39;std::out_of_range&#39;   what():  basic_string::replace: __pos (which is 18446744073709551615) &gt; this-&gt;size() (which is 3)&quot;"}, {"owner": {"reputation": 29, "user_id": 8226915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c84a331b910804671675311823c5781a?s=128&d=identicon&r=PG&f=1", "display_name": "Keii", "link": "https://stackoverflow.com/users/8226915/keii"}, "reply_to_user": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 0, "creation_date": 1547032150, "post_id": 54108488, "comment_id": 95049662, "body": "@\u03c0\u03ac\u03bd\u03c4\u03b1\u1fe5\u03b5\u1fd6 i&#39;ll check it . thanks"}], "answers": [{"comments": [{"owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "edited": false, "score": 0, "creation_date": 1547032045, "post_id": 54108570, "comment_id": 95049611, "body": "There&#39;s no standard C++ way of resizing a file. Your second option is better. If efficiency is a concern then the program needs to be redesigned"}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "reply_to_user": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "edited": false, "score": 1, "creation_date": 1547032102, "post_id": 54108570, "comment_id": 95049634, "body": "@john Yes there is: <code>std::filesystem::resize_file</code>. The second option is better, as I explain in the answer."}, {"owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "edited": false, "score": 0, "creation_date": 1547032597, "post_id": 54108570, "comment_id": 95049902, "body": "OK, I stand corrected. Haven&#39;t got round to looking at <code>std::filesystem</code> yet."}], "tags": [], "owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "is_accepted": false, "score": 0, "last_activity_date": 1547031482, "creation_date": 1547031482, "answer_id": 54108570, "question_id": 54108488, "link": "https://stackoverflow.com/questions/54108488/c-delete-whole-line-in-text-file/54108570#54108570", "title": "c++ delete whole line in text file", "body": "<p>You can use the following algorithm:</p>\n\n<ul>\n<li>Find where the line starts.</li>\n<li>Find where the line ends.</li>\n<li>Copy the character after the line into the file in position where the line starts. Repeat until the read position reaches the end of the file.</li>\n<li>Resize the file to match the old length minus the length of the removed line.</li>\n</ul>\n\n<p>Or the following:</p>\n\n<ul>\n<li>Read the source file line by line.</li>\n<li>If the line doesn't what you're searching for, then copy it into a new file.</li>\n<li>Repeat until end of the source file.</li>\n<li>Move the new file over the old.</li>\n</ul>\n\n<p>The latter algorithm may be slower since it copies also the beginning of the file, but safer in case the operation is interrupted.</p>\n"}, {"comments": [{"owner": {"reputation": 1968, "user_id": 846641, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/q1FW7.jpg?s=128&g=1", "display_name": "Philipp", "link": "https://stackoverflow.com/users/846641/philipp"}, "edited": false, "score": 1, "creation_date": 1547031734, "post_id": 54108598, "comment_id": 95049403, "body": "This seems more of a comment than an answer"}, {"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "reply_to_user": {"reputation": 1968, "user_id": 846641, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/q1FW7.jpg?s=128&g=1", "display_name": "Philipp", "link": "https://stackoverflow.com/users/846641/philipp"}, "edited": false, "score": 0, "creation_date": 1547032025, "post_id": 54108598, "comment_id": 95049597, "body": "@Philipp And what usually comes up from an OP with less than 50 rep?"}], "tags": [], "owner": {"reputation": 35, "user_id": 2033594, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b77d878620c96529e17b2d224ed1a5a?s=128&d=identicon&r=PG", "display_name": "user2033594", "link": "https://stackoverflow.com/users/2033594/user2033594"}, "is_accepted": false, "score": -2, "last_activity_date": 1547031566, "creation_date": 1547031566, "answer_id": 54108598, "question_id": 54108488, "link": "https://stackoverflow.com/questions/54108488/c-delete-whole-line-in-text-file/54108598#54108598", "title": "c++ delete whole line in text file", "body": "<p>Please tokenize the line using sstringstream to match the word with expected token and then write the line in a new file</p>\n"}], "owner": {"reputation": 29, "user_id": 8226915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c84a331b910804671675311823c5781a?s=128&d=identicon&r=PG&f=1", "display_name": "Keii", "link": "https://stackoverflow.com/users/8226915/keii"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1860, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1547031566, "creation_date": 1547031212, "question_id": 54108488, "link": "https://stackoverflow.com/questions/54108488/c-delete-whole-line-in-text-file", "title": "c++ delete whole line in text file", "body": "<p>how can i delete a whole line just by searching a single word in that line? \nfor example: \"i want to delete this line\" (this is the sentence in the line) and i will only search the delete word and the rest of the word in that line will be delete? </p>\n\n<p>here's my code</p>\n\n<pre><code>string deleteline;\nstring line;\n\nifstream fin;\nfin.open(\"example.txt\");\nofstream temp;\ntemp.open(\"temp.txt\");\ncout &lt;&lt; \"Enter word: \";\ncin &gt;&gt; deleteline;\n\n\nwhile (getline(fin,line))\n{\n    if(line != deleteline)\n    temp &lt;&lt; line &lt;&lt; endl;\n}\ntemp.close();\nfin.close();\nremove(\"example.txt\");\nrename(\"temp.txt\",\"example.txt\");\n</code></pre>\n"}, {"tags": ["c++", "parameter-passing", "variadic-templates"], "comments": [{"owner": {"reputation": 56893, "user_id": 3647361, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/xvjhM.png?s=128&g=1", "display_name": "Columbo", "link": "https://stackoverflow.com/users/3647361/columbo"}, "edited": false, "score": 1, "creation_date": 1547030671, "post_id": 54108256, "comment_id": 95048658, "body": "<code>func</code> is a type, not a variable."}], "answers": [{"comments": [{"owner": {"reputation": 555, "user_id": 7767044, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d56dea440af5ed95a30a594d547424d9?s=128&d=identicon&r=PG", "display_name": "Juri", "link": "https://stackoverflow.com/users/7767044/juri"}, "edited": false, "score": 0, "creation_date": 1547031551, "post_id": 54108386, "comment_id": 95049273, "body": "Thanks! Going to look into this: <a href=\"https://en.cppreference.com/w/cpp/language/raii\" rel=\"nofollow noreferrer\">RAII</a> and this <a href=\"https://stackoverflow.com/questions/2808398/easily-measure-elapsed-time\">Easily measure elapsed time</a>"}, {"owner": {"reputation": 555, "user_id": 7767044, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d56dea440af5ed95a30a594d547424d9?s=128&d=identicon&r=PG", "display_name": "Juri", "link": "https://stackoverflow.com/users/7767044/juri"}, "edited": false, "score": 0, "creation_date": 1547032009, "post_id": 54108386, "comment_id": 95049589, "body": "I also wasn&#39;t sure why we need std::forward. Where this resource helped <a href=\"https://stackoverflow.com/questions/3582001/advantages-of-using-forward\">Advantages of using forward</a>"}, {"owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "reply_to_user": {"reputation": 555, "user_id": 7767044, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d56dea440af5ed95a30a594d547424d9?s=128&d=identicon&r=PG", "display_name": "Juri", "link": "https://stackoverflow.com/users/7767044/juri"}, "edited": false, "score": 0, "creation_date": 1547032187, "post_id": 54108386, "comment_id": 95049683, "body": "<code>std::forward</code> allows to use function which use type such as <code>std::unique_ptr</code>, (or std::vector without copy)."}], "tags": [], "owner": {"reputation": 171938, "user_id": 2684539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c5fff6fb65e95570ad1a90fe1e3522e?s=128&d=identicon&r=PG&f=1", "display_name": "Jarod42", "link": "https://stackoverflow.com/users/2684539/jarod42"}, "is_accepted": true, "score": 1, "last_activity_date": 1547030903, "creation_date": 1547030903, "answer_id": 54108386, "question_id": 54108256, "link": "https://stackoverflow.com/questions/54108256/variadic-templates-expression-list-treated-as-compound-expression-in-functional/54108386#54108386", "title": "variadic templates: expression list treated as compound expression in functional cast error", "body": "<p>It should be:</p>\n\n<pre><code>template&lt;typename Func, typename ...Types&gt;\nvoid measure_time(Func func, Types&amp;&amp;... args)\n{\n    auto start = std::chrono::system_clock::now();\n\n    // execute function here\n    func(std::forward&lt;Types&gt;(args)...);\n\n    auto end = std::chrono::system_clock::now();\n    std::cout &lt;&lt; \"Time for execution \"\n        &lt;&lt; std::chrono::duration_cast&lt;std::chrono::microseconds&gt;(end-start).count()\n        &lt;&lt; \" microseconds\\n\";\n}\n</code></pre>\n\n<p>But even better would be to have your timing in a RAII class to allow to return value of your function easily.</p>\n"}], "owner": {"reputation": 555, "user_id": 7767044, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d56dea440af5ed95a30a594d547424d9?s=128&d=identicon&r=PG", "display_name": "Juri", "link": "https://stackoverflow.com/users/7767044/juri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 234, "favorite_count": 0, "accepted_answer_id": 54108386, "answer_count": 1, "score": 0, "last_activity_date": 1547030903, "creation_date": 1547030536, "question_id": 54108256, "link": "https://stackoverflow.com/questions/54108256/variadic-templates-expression-list-treated-as-compound-expression-in-functional", "title": "variadic templates: expression list treated as compound expression in functional cast error", "body": "<p>I try to pass a function as a parameter with a parameter pack as a second argument to a wrapper function.</p>\n\n<p>In this simple case, the wrapper function should execute the passed function with the parameter in the pack, measure execution time and exit. </p>\n\n<p>But I get the compile error with g++ 7.3.0 (c++14) on Ubuntu 18.04: </p>\n\n<pre><code>error: expression list treated as compound expression in functional cast [-fpermissive] \n</code></pre>\n\n<p>for the line:</p>\n\n<pre><code>func(&amp;args...);\n</code></pre>\n\n<p>The wrapper looks as follows:</p>\n\n<pre><code>template&lt;typename func, typename ...Types&gt;\nvoid measure_time(func, Types... args)\n{\n    auto start = std::chrono::system_clock::now();\n\n    // execute function here\n    func(&amp;args...);\n\n    auto end = std::chrono::system_clock::now();\n    std::cout &lt;&lt; \"Time for execution \"\n        &lt;&lt; std::chrono::duration_cast&lt;std::chrono::microseconds&gt;(end-start).count()\n        &lt;&lt; \" microseconds\\n\";\n}\n</code></pre>\n\n<p>I'm new to generic programming and parameter packs, but following the cpp reference for <a href=\"https://en.cppreference.com/w/cpp/language/parameter_pack\" rel=\"nofollow noreferrer\">parameter packs</a> this should work?</p>\n\n<p>calling the measure_time function e.g. with a simple binary_search:</p>\n\n<pre><code>int binary_search(int *a, int v, int l, int r)\n{\n    while(r &gt;= 1)\n    {\n        int m = (l+r)/2;\n        if(v == a[m]) return m;\n        if(v &lt; a[m]) r = m-1; else l = m+1;\n        if(l==m || r==m) break; \n    }\n    return -1;\n}\n</code></pre>\n\n<p>Produces the following instantiation (which seems correct to me) as source of error:</p>\n\n<pre><code> In instantiation of \u2018void measure_time(func, Types ...) [with func = int (*)(int*, int, int, int); Types = {int*, int, int, int}]\u2019:\n</code></pre>\n\n<p>I found this article describing a compiler error, but I lack the knowledge to understand the situation and can't seem to deduct a workable solution if this is the case: \n<a href=\"https://stackoverflow.com/questions/38185743/temporary-objects-with-variadic-template-arguments-another-g-clang-differen\">temporary objects with variadic template arguments; another g++/clang++ difference</a></p>\n\n<p><strong>EDIT:</strong> Running the program with the -fpermissive flag and then executing the program works flawlessly.</p>\n"}, {"tags": ["c++", "templates", "function-pointers"], "comments": [{"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 3, "creation_date": 1547030427, "post_id": 54108162, "comment_id": 95048485, "body": "Don&#39;t use function pointers, use simple template parameters instead. Then the <code>apply</code> function could be used with just about anything that is callable. And replicates what the standard library itself is doing."}, {"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 4, "creation_date": 1547030477, "post_id": 54108162, "comment_id": 95048515, "body": "Use <a href=\"https://en.cppreference.com/w/cpp/numeric/math/ceil\" rel=\"nofollow noreferrer\"><code>#include &lt;cmath&gt;</code></a> instead of <code>#include &lt;math.h&gt;</code>."}, {"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1547030503, "post_id": 54108162, "comment_id": 95048532, "body": "As for a simple way to solve your problem, you need to realize that the return type from the function is the same as the argument type. Which means you could drop the <code>T1</code> template argument, and use only <code>T</code> everywhere."}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 0, "creation_date": 1547030525, "post_id": 54108162, "comment_id": 95048544, "body": "Actually just including <code>cmath</code> is enough (checked on godholt after editing the question)."}, {"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1547032938, "post_id": 54108162, "comment_id": 95050085, "body": "error says <code>T apply(T (*func)(T),...</code> but in the code it is <code>T apply(T (*func)(T1)</code>, is this correct or a typo?"}, {"owner": {"reputation": 4121, "user_id": 4290866, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0727d9acdc35a0359d0703da9e11f239?s=128&d=identicon&r=PG&f=1", "display_name": "user32434999", "link": "https://stackoverflow.com/users/4290866/user32434999"}, "edited": false, "score": 0, "creation_date": 1547033564, "post_id": 54108162, "comment_id": 95050425, "body": "What is the correct version of ceil you had expected?"}], "answers": [{"comments": [{"owner": {"reputation": 34185, "user_id": 5470596, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BITFt.jpg?s=128&g=1", "display_name": "YSC", "link": "https://stackoverflow.com/users/5470596/ysc"}, "edited": false, "score": 1, "creation_date": 1547031051, "post_id": 54108397, "comment_id": 95048891, "body": "I&#39;d be curious however to know what difference(s) from g++-5 to g++-6 triggered that."}, {"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "reply_to_user": {"reputation": 34185, "user_id": 5470596, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BITFt.jpg?s=128&g=1", "display_name": "YSC", "link": "https://stackoverflow.com/users/5470596/ysc"}, "edited": false, "score": 0, "creation_date": 1547031191, "post_id": 54108397, "comment_id": 95048972, "body": "@YSC Good question. But <code>cmath</code> always was the correct header to use with c++ IIRC."}, {"owner": {"reputation": 19146, "user_id": 635654, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/b8fb58eef98caeec6ab3366e0ac986d7?s=128&d=identicon&r=PG", "display_name": "CygnusX1", "link": "https://stackoverflow.com/users/635654/cygnusx1"}, "edited": false, "score": 0, "creation_date": 1547033133, "post_id": 54108397, "comment_id": 95050171, "body": "Interestingly, using <code>std::ceil</code> will fail too. It must be <code>ceil</code>."}, {"owner": {"reputation": 8857, "user_id": 3414900, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/KlvbC.jpg?s=128&g=1", "display_name": "bartop", "link": "https://stackoverflow.com/users/3414900/bartop"}, "reply_to_user": {"reputation": 19146, "user_id": 635654, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/b8fb58eef98caeec6ab3366e0ac986d7?s=128&d=identicon&r=PG", "display_name": "CygnusX1", "link": "https://stackoverflow.com/users/635654/cygnusx1"}, "edited": false, "score": 1, "creation_date": 1547034350, "post_id": 54108397, "comment_id": 95050861, "body": "@CygnusX1 std::ceil does not work, as it is a function template"}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1547040892, "post_id": 54108397, "comment_id": 95054867, "body": "<code>ceil</code> is not guaranteed to be available in <code>&lt;cmath&gt;</code> (all standard headers put their names in the standard namespace) so this code is not portable."}, {"owner": {"reputation": 19146, "user_id": 635654, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/b8fb58eef98caeec6ab3366e0ac986d7?s=128&d=identicon&r=PG", "display_name": "CygnusX1", "link": "https://stackoverflow.com/users/635654/cygnusx1"}, "reply_to_user": {"reputation": 8857, "user_id": 3414900, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/KlvbC.jpg?s=128&g=1", "display_name": "bartop", "link": "https://stackoverflow.com/users/3414900/bartop"}, "edited": false, "score": 0, "creation_date": 1547045105, "post_id": 54108397, "comment_id": 95057506, "body": "@bartop I thought those are just overloads. But now I read, that there is this <code>double ceil(IntegralType)</code> that <i>may</i> be a template."}, {"owner": {"reputation": 367, "user_id": 5852487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hwIdw.jpg?s=128&g=1", "display_name": "gilgamec", "link": "https://stackoverflow.com/users/5852487/gilgamec"}, "edited": false, "score": 0, "creation_date": 1547130094, "post_id": 54108397, "comment_id": 95092481, "body": "Replacing <code>math.h</code> with <code>cmath</code> does indeed fix most of my problems.  The rest may be fodder for another question."}], "tags": [], "owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "is_accepted": true, "score": 4, "last_activity_date": 1547031244, "last_edit_date": 1547031244, "creation_date": 1547030934, "answer_id": 54108397, "question_id": 54108162, "link": "https://stackoverflow.com/questions/54108162/template-deduction-reversion-with-function-pointer/54108397#54108397", "title": "Template deduction reversion with function pointer", "body": "<blockquote>\n  <p>What have I done wrong and how can I fix it?</p>\n</blockquote>\n\n<p>The way to fix that is to <code>#include &lt;cmath&gt;</code> instead of using <code>#include &lt;math.h&gt;</code> as mentioned in the <a href=\"https://en.cppreference.com/w/cpp/numeric/math/ceil\" rel=\"nofollow noreferrer\">reference documentation</a>:</p>\n\n<pre><code>#include &lt;cmath&gt; // &lt;&lt;&lt; official header to use.\n#include &lt;iostream&gt;\n\ntemplate&lt;typename T,typename T1&gt;\nT apply(T (*func)(T1), const T1 &amp;val)\n{\n  return func(val);\n}\n\nint main(void)\n{\n  double val1 = 0.5, val2 = apply(ceil,val1);\n\n  std::cout &lt;&lt; val1 &lt;&lt; ' ' &lt;&lt; val2&lt;&lt; std::endl;\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 19146, "user_id": 635654, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/b8fb58eef98caeec6ab3366e0ac986d7?s=128&d=identicon&r=PG", "display_name": "CygnusX1", "link": "https://stackoverflow.com/users/635654/cygnusx1"}, "is_accepted": false, "score": 1, "last_activity_date": 1547033307, "creation_date": 1547033307, "answer_id": 54109098, "question_id": 54108162, "link": "https://stackoverflow.com/questions/54108162/template-deduction-reversion-with-function-pointer/54109098#54109098", "title": "Template deduction reversion with function pointer", "body": "<p>If you are using (or planning to use) C++17, you should know that there is a more robust library function doing what you are trying to do: <a href=\"https://en.cppreference.com/w/cpp/utility/functional/invoke\" rel=\"nofollow noreferrer\">std::invoke</a></p>\n\n<p>With it, your example can be reduced to:</p>\n\n<pre><code>#include &lt;cmath&gt;\n#include &lt;functional&gt;\n\nint main(void)\n{\n  double val1 = 0.5, val2 = std::invoke(ceil,val1);\n  return 0;\n}\n</code></pre>\n\n<p>Interestingly, with both your hand-crafted <code>apply</code> and the library <code>std::invoke</code>, the code will fail if you write <code>std::invoke(std::ceil, val1)</code>. This needs further investigation....</p>\n"}], "owner": {"reputation": 367, "user_id": 5852487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hwIdw.jpg?s=128&g=1", "display_name": "gilgamec", "link": "https://stackoverflow.com/users/5852487/gilgamec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 54108397, "answer_count": 2, "score": 6, "last_activity_date": 1547033307, "creation_date": 1547030226, "last_edit_date": 1547030604, "question_id": 54108162, "link": "https://stackoverflow.com/questions/54108162/template-deduction-reversion-with-function-pointer", "title": "Template deduction reversion with function pointer", "body": "<p>I've had previously-working code fail on moving from g++-5 to g++-6; a previously-deducible template is no longer deducible.  A minimal example:</p>\n\n<pre><code>#include &lt;math.h&gt;\n\ntemplate&lt;typename T,typename T1&gt;\nT apply(T (*func)(T1), const T1 &amp;val)\n{\n  return func(val);\n}\n\nint main(void)\n{\n  double val1 = 0.5, val2 = apply(ceil,val1);\n  return 0;\n}\n</code></pre>\n\n<p>g++-6 can't seem to find the correct version of <code>ceil</code>:</p>\n\n<pre><code>foo.cpp: In function \u2018int main()\u2019:\nfoo.cpp:11:44: error: no matching function for call to \u2018apply(&lt;unresolved overloaded function type&gt;, double&amp;)\u2019\n   double val1 = 0.5, val2 = apply(ceil,val1);\n                                        ^\nfoo.cpp:4:3: note: candidate: template&lt;class T, class T1&gt; T apply(T (*)(T), const T1&amp;)\n T apply(T (*func)(T), const T1 &amp;val)\n   ^~~~~\nfoo.cpp:4:3: note:   template argument deduction/substitution failed:\nfoo.cpp:11:44: note:   couldn't deduce template parameter \u2018T\u2019\n   double val1 = 0.5, val2 = apply(ceil,val1);\n</code></pre>\n\n<p>g++-5 has no problems and works as expected.  Using the Compiler Explorer with g++ 8 at <a href=\"https://godbolt.org/z/oBSopG\" rel=\"noreferrer\">https://godbolt.org/z/oBSopG</a>, I also see a reversion from clang-3.3 (compiles) to clang-3.4 (doesn't compile).</p>\n\n<p>Given that the code still doesn't work, even in current g++, I assume that the error is on my part.  What have I done wrong and how can I fix it?</p>\n"}, {"tags": ["c++", "class", "variables"], "comments": [{"owner": {"reputation": 29848, "user_id": 5958455, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/lBWIE.png?s=128&g=1", "display_name": "iBug", "link": "https://stackoverflow.com/users/5958455/ibug"}, "edited": false, "score": 0, "creation_date": 1547029222, "post_id": 54107816, "comment_id": 95047741, "body": "You want a static member, otherwise you have to instantiate it."}, {"owner": {"reputation": 29848, "user_id": 5958455, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/lBWIE.png?s=128&g=1", "display_name": "iBug", "link": "https://stackoverflow.com/users/5958455/ibug"}, "edited": false, "score": 2, "creation_date": 1547029255, "post_id": 54107816, "comment_id": 95047761, "body": "\uff0b1 for clear problem description, minimal sample code and good formatting."}, {"owner": {"reputation": 55, "user_id": 10884334, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Wz1hdZ7FoVk/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcaUibXoEoEbZsZB_zPdzMmCHHJUuA/mo/photo.jpg?sz=128", "display_name": "On Demand", "link": "https://stackoverflow.com/users/10884334/on-demand"}, "reply_to_user": {"reputation": 29848, "user_id": 5958455, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/lBWIE.png?s=128&g=1", "display_name": "iBug", "link": "https://stackoverflow.com/users/5958455/ibug"}, "edited": false, "score": 0, "creation_date": 1547029615, "post_id": 54107816, "comment_id": 95047976, "body": "@iBug if I go <code>static int x</code> I will get <code>undefined reference to &#39;MainInt::x&#39;</code>"}, {"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 1, "creation_date": 1547029691, "post_id": 54107816, "comment_id": 95048014, "body": "@OnDemand You have to put a definition like <code>int MainInt::x = 1;</code> outside of the class declaration."}, {"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "reply_to_user": {"reputation": 29848, "user_id": 5958455, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/lBWIE.png?s=128&g=1", "display_name": "iBug", "link": "https://stackoverflow.com/users/5958455/ibug"}, "edited": false, "score": 2, "creation_date": 1547029926, "post_id": 54107816, "comment_id": 95048164, "body": "@iBug That question is far from being <i>clear</i>. I&#39;d suspect the OP should read some <a href=\"https://stackoverflow.com/a/388282\">good book</a> to learn about the basics, before asking here. No mention of the compiler error, etc. ..."}, {"owner": {"reputation": 55, "user_id": 10884334, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Wz1hdZ7FoVk/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcaUibXoEoEbZsZB_zPdzMmCHHJUuA/mo/photo.jpg?sz=128", "display_name": "On Demand", "link": "https://stackoverflow.com/users/10884334/on-demand"}, "reply_to_user": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 0, "creation_date": 1547030132, "post_id": 54107816, "comment_id": 95048293, "body": "@\u03c0\u03ac\u03bd\u03c4\u03b1\u1fe5\u03b5\u1fd6 I have c++ for dummies"}, {"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 0, "creation_date": 1547030189, "post_id": 54107816, "comment_id": 95048333, "body": "@OnDemand Probably not the best book to follow :-P"}], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 10884334, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Wz1hdZ7FoVk/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcaUibXoEoEbZsZB_zPdzMmCHHJUuA/mo/photo.jpg?sz=128", "display_name": "On Demand", "link": "https://stackoverflow.com/users/10884334/on-demand"}, "edited": false, "score": 0, "creation_date": 1547029831, "post_id": 54107916, "comment_id": 95048100, "body": "static x doesnt work I get <code>undefined reference to &#39;MainInt::x&#39;</code>"}, {"owner": {"reputation": 55, "user_id": 10884334, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Wz1hdZ7FoVk/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcaUibXoEoEbZsZB_zPdzMmCHHJUuA/mo/photo.jpg?sz=128", "display_name": "On Demand", "link": "https://stackoverflow.com/users/10884334/on-demand"}, "edited": false, "score": 0, "creation_date": 1547030656, "post_id": 54107916, "comment_id": 95048644, "body": "Thanks its a traditional variable the second method works"}, {"owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "reply_to_user": {"reputation": 55, "user_id": 10884334, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Wz1hdZ7FoVk/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcaUibXoEoEbZsZB_zPdzMmCHHJUuA/mo/photo.jpg?sz=128", "display_name": "On Demand", "link": "https://stackoverflow.com/users/10884334/on-demand"}, "edited": false, "score": 0, "creation_date": 1547030692, "post_id": 54107916, "comment_id": 95048673, "body": "@OnDemand The first fails because you forgot this <code>&#47;&#47; in cpp: int MainInt::x = 1;</code> The two options are fundamentally different, they&#39;re not alternative ways of doing the same thing."}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "reply_to_user": {"reputation": 32386, "user_id": 4706785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdee2789e9bac57bfdd97abc4e533a4d?s=128&d=identicon&r=PG&f=1", "display_name": "Peter", "link": "https://stackoverflow.com/users/4706785/peter"}, "edited": false, "score": 0, "creation_date": 1547031030, "post_id": 54107916, "comment_id": 95048878, "body": "@Peter what&#39;s the difference with my second solution?"}, {"owner": {"reputation": 55, "user_id": 10884334, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Wz1hdZ7FoVk/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcaUibXoEoEbZsZB_zPdzMmCHHJUuA/mo/photo.jpg?sz=128", "display_name": "On Demand", "link": "https://stackoverflow.com/users/10884334/on-demand"}, "reply_to_user": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "edited": false, "score": 0, "creation_date": 1547031190, "post_id": 54107916, "comment_id": 95048971, "body": "@john I know the first one declares x in the cpp which I didn&#39;t want and the second one instantiates a variant of the class I want, I normally use is for creating gtk widgets like <code>Gtk::Box boxname;</code> it didn&#39;t pass my mind that i was supposed to do the same thing here."}, {"owner": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "reply_to_user": {"reputation": 55, "user_id": 10884334, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Wz1hdZ7FoVk/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcaUibXoEoEbZsZB_zPdzMmCHHJUuA/mo/photo.jpg?sz=128", "display_name": "On Demand", "link": "https://stackoverflow.com/users/10884334/on-demand"}, "edited": false, "score": 0, "creation_date": 1547031407, "post_id": 54107916, "comment_id": 95049144, "body": "@OnDemand OK fine, but that wasn&#39;t clear from your initial &#39;doesn&#39;t work&#39; comment. You wouldn&#39;t be the first person not to realise that you need to define static variables"}], "tags": [], "owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "is_accepted": true, "score": 1, "last_activity_date": 1547029863, "last_edit_date": 1547029863, "creation_date": 1547029412, "answer_id": 54107916, "question_id": 54107816, "link": "https://stackoverflow.com/questions/54107816/how-can-i-use-a-value-from-another-class-in-c/54107916#54107916", "title": "How can I use a value from another class in c++?", "body": "<p>Either <code>x</code> is a static variable (also known as a global variable), and in this case, this should be:</p>\n\n<pre><code>class MainInt\n{\npublic:\n    MainInt();\n    static int x;\n};\n\n// in cpp:\nint MainInt::x = 1;\n</code></pre>\n\n<p>or it's a traditional variable, as it it feels like from the constructor. In that case, you need to instantiate an object:</p>\n\n<pre><code>MainInt variable;\ncout &lt;&lt; variable.x &lt;&lt; endl;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 55, "user_id": 10884334, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Wz1hdZ7FoVk/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcaUibXoEoEbZsZB_zPdzMmCHHJUuA/mo/photo.jpg?sz=128", "display_name": "On Demand", "link": "https://stackoverflow.com/users/10884334/on-demand"}, "is_accepted": false, "score": 1, "last_activity_date": 1547030855, "creation_date": 1547030855, "answer_id": 54108368, "question_id": 54107816, "link": "https://stackoverflow.com/questions/54107816/how-can-i-use-a-value-from-another-class-in-c/54108368#54108368", "title": "How can I use a value from another class in c++?", "body": "<p>Using <a href=\"https://stackoverflow.com/users/2266772/matthieu-brucher\">Matthieu Brucher's</a> solution I did the following</p>\n\n<blockquote>\n  <p>main.cpp</p>\n</blockquote>\n\n<pre><code>#include &lt;iostream&gt;\n#include \"main.hpp\"\n\nusing namespace std;\n\nint main()\n{\n    MainInt x;\n    cout &lt;&lt; x.x &lt;&lt; endl;\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 10884334, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Wz1hdZ7FoVk/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcaUibXoEoEbZsZB_zPdzMmCHHJUuA/mo/photo.jpg?sz=128", "display_name": "On Demand", "link": "https://stackoverflow.com/users/10884334/on-demand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 54107916, "answer_count": 2, "score": 0, "last_activity_date": 1547032208, "creation_date": 1547029139, "last_edit_date": 1547032208, "question_id": 54107816, "link": "https://stackoverflow.com/questions/54107816/how-can-i-use-a-value-from-another-class-in-c", "title": "How can I use a value from another class in c++?", "body": "<p>I have the main function and a class, I'am trying to use an int that is in that other class in main.  </p>\n\n<blockquote>\n  <p>main.cpp</p>\n</blockquote>\n\n<pre><code>#include &lt;iostream&gt;\n#include \"main.hpp\"\n\nusing namespace std;\n\nint main()\n{\n    cout &lt;&lt; MainInt::x &lt;&lt; endl;\n    return 0;\n}\n</code></pre>\n\n<blockquote>\n  <p>main.hpp</p>\n</blockquote>\n\n<pre><code>class MainInt\n{\npublic:\n    MainInt();\n    int x;\n};\n\nMainInt::MainInt()\n{\n    x = 1;\n}\n</code></pre>\n\n<p>The way I am doing it currently doesn't feel right. I feel like <code>cout &lt;&lt; MainInt::x &lt;&lt; endl;</code> is just calling the variable x.</p>\n\n<blockquote>\n  <p>Currently I get <code>error: invalid use of non-static data member 'x'</code></p>\n</blockquote>\n\n<p>What I need is to call <strong>x</strong> which is a <strong>non-static</strong> variable in <strong>MainInt</strong> such that I can output the value of x on the console.\nHow do I go about doing that?</p>\n"}]