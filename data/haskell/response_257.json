[{"tags": ["haskell", "process", "typed-process"], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 1, "last_activity_date": 1576112070, "creation_date": 1576112070, "answer_id": 59296217, "question_id": 59295122, "link": "https://stackoverflow.com/questions/59295122/typed-process-withprocesswait-and-getexitcode-race-condition/59296217#59296217", "title": "typed-process withProcessWait_ and getExitCode race condition?", "body": "<p>The race condition is that three separate threads are consuming all available standard output (first thread) and standard error (second thread) and waiting on the exit code (third thread).  The standard output and standard error thread can complete and publish the full output to STM before the third thread publishes the exit code.</p>\n\n<p>Since <code>getExitCode</code> checks the exit code TMVar but doesn't wait on it, the exit code may not be available.  (In fact, if the child process closes standard output and error before exiting, it may genuinely still be running at this point!)</p>\n\n<p>If you replace <code>getExitCode</code> with <code>waitExitCode</code>, you reliably get <code>ExitSuccess</code>.  Of course, <code>withProcessWait_</code> is already waiting on the exit code and will raise an exception if it's not <code>ExitSuccess</code>, so there's no particular reason to do this anyway.</p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 59296217, "answer_count": 1, "score": 0, "last_activity_date": 1576158801, "creation_date": 1576103519, "last_edit_date": 1576158801, "question_id": 59295122, "link": "https://stackoverflow.com/questions/59295122/typed-process-withprocesswait-and-getexitcode-race-condition", "title": "typed-process withProcessWait_ and getExitCode race condition?", "body": "<pre><code>import System.Process.Typed\nimport Control.Monad.STM\nimport Control.Concurrent.STM.TVar\n\nprocessConf = setStderr byteStringOutput . setStdout byteStringOutput\n\nmain :: IO ()\nmain = do\n  withProcessWait_ (processConf $ proc \"sleep\" [\"1\"])\n          $ \\p -&gt; do\n            atomically (getStdout p) &gt;&gt;= print\n            atomically (getStderr p) &gt;&gt;= print\n            getExitCode p &gt;&gt;= print\n  print \"test\"\n</code></pre>\n\n<p>The above code mostly returns <code>Nothing</code> for the exit code, while other times it'll return <code>Just ExitSuccess</code>, so seemingly random / race condition.</p>\n\n<p>Why might this occur?</p>\n\n<p>The function in question is: <a href=\"http://hackage.haskell.org/package/typed-process-0.2.6.0/docs/System-Process-Typed.html#v:withProcessWait_\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/typed-process-0.2.6.0/docs/System-Process-Typed.html#v:withProcessWait_</a></p>\n\n<pre><code>withProcessWait_ :: MonadUnliftIO m =&gt; ProcessConfig stdin stdout stderr -&gt; (Process stdin stdout stderr -&gt; m a) -&gt; m a\n</code></pre>\n\n<hr>\n\n<p>My understanding of what the function will do is, run the process, wait till  it's terminated and then run the <code>IO a</code>. However... I just noticed there is a <code>readProcess</code> function which sounds like what I should actually be using instead <a href=\"http://hackage.haskell.org/package/typed-process-0.2.6.0/docs/System-Process-Typed.html#v:readProcess\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/typed-process-0.2.6.0/docs/System-Process-Typed.html#v:readProcess</a></p>\n\n<p>None the less, it would be useful to know what is actually happening in the above / <code>withProcessWait_</code>.</p>\n"}, {"tags": ["haskell", "lambda", "sharing"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1576103083, "post_id": 59294749, "comment_id": 104794470, "body": "Interesting. FWIW, in <i>interpreted</i> mode, <code>x3</code> is printed only once."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 1, "creation_date": 1576103569, "post_id": 59294749, "comment_id": 104794620, "body": "Try putting <code>myconst</code> in a library, compiling the library with optimizations, then rerunning your examples."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1576103809, "post_id": 59294749, "comment_id": 104794697, "body": "It&#39;s also printed only once if you put <code>{-# NOINLINE f #-} {-# NOINLINE myconst #-}</code>."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 3, "last_activity_date": 1576110387, "creation_date": 1576110387, "answer_id": 59296046, "question_id": 59294749, "link": "https://stackoverflow.com/questions/59294749/why-does-the-predefined-const-function-behave-differently-than-the-equivalent/59296046#59296046", "title": "Why does the predefined `const` function behave differently than the equivalent lambda function in certain contexts?", "body": "<p>If <code>myconst</code> is compiled into a separate module (even if the separate module is compiled with <code>-O0</code>), then the output is:</p>\n\n<pre><code>x1\nx2\nx2\nx3\n252\n</code></pre>\n\n<p>The difference is that -- in <code>-O0</code> code -- calling <code>myconst</code> in a separate module generates the code:</p>\n\n<pre><code>let x' = myconst (trace \"x3\" 42) in x' + x'\n</code></pre>\n\n<p>but calling <code>myconst</code> in the same module inlines it like so:</p>\n\n<pre><code>trace \"x4\" 42 + trace \"x4\" 42\n</code></pre>\n\n<p>Compiling with <code>-O2</code> completely changes the code -- everything is inlined and the traces are lifted to the top of the expression, so they only execute once each.</p>\n\n<p>You can clearly influence the compiler in this regard, for example by putting <code>myconst</code> in a separate module or not, or -- as pointed out by @leftroundabout -- by adding various inlining pragmas.</p>\n\n<p>I don't think you can <em>reliably</em> influence the compiler in this regard, and I'm not sure how much you can learn about real-world GHC code by studying unoptimized compilation output.  I think the above example clearly demonstrates that code generated with <code>-O0</code> will behave in completely arbitrary and contradictory ways based on minor aspects of the compilation that you wouldn't expect to matter.</p>\n"}], "owner": {"reputation": 135, "user_id": 11112994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c13e333c7d86ed9997ee55683b56394b?s=128&d=identicon&r=PG&f=1", "display_name": "nbu", "link": "https://stackoverflow.com/users/11112994/nbu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 59296046, "answer_count": 1, "score": 4, "last_activity_date": 1576110387, "creation_date": 1576101596, "question_id": 59294749, "link": "https://stackoverflow.com/questions/59294749/why-does-the-predefined-const-function-behave-differently-than-the-equivalent", "title": "Why does the predefined `const` function behave differently than the equivalent lambda function in certain contexts?", "body": "<p>While doing some experiments with sharing, I discovered that the predefined <code>const</code> function behaves differently in some contexts.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>f :: (() -&gt; Int) -&gt; Int\nf g = g () + g ()\n\nx1 = f (const   (trace \"x1\" 42))\nx2 = f (\\_ -&gt;   (trace \"x2\" 42))\nx3 = f (myconst (trace \"x3\" 42))\n\nmyconst :: a -&gt; b -&gt; a\nmyconst x _ =  x\n</code></pre>\n\n<p>When <a href=\"https://gist.github.com/nbun/2a47b3ceecafd7a312d51d8a92aeba86\" rel=\"nofollow noreferrer\">this example</a> is compiled without optimizations, evaluating <code>x1</code> triggers the evaluation of <code>trace</code> only once, while it is evaluated twice for <code>x2</code> and <code>x3</code>. This is plausible for <code>x2</code> due to the lambda function.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>x1\nx2\nx2\nx3\nx3\n252\n</code></pre>\n\n<p>The <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Base.html#const\" rel=\"nofollow noreferrer\">definition</a> of <code>const</code> suggests, however, that it is an ordinary function definition without any compiler annotations that could explain the difference. The function <code>myconst</code> should therefore behave the same, which it does not. How can this behavior be explained and is there a way to influence the compiler in this regard?</p>\n"}, {"tags": ["haskell", "functional-programming", "monads", "ghci", "writer-monad"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 4, "creation_date": 1576101516, "post_id": 59294655, "comment_id": 104793948, "body": "I think it&#39;s because you&#39;ve hidden the standard <code>Monad</code> class in <code>Prelude</code> and substituted it with your own. <code>do</code> notation is a special syntactic sugar which, I assume, only applies to &quot;the&quot; <code>Monad</code> class, not an arbitrary one that another module has called by the same name, and even if the definition happens to coincide."}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 4, "creation_date": 1576101733, "post_id": 59294655, "comment_id": 104794021, "body": "Try enable <code>RebindableSyntax</code>"}, {"owner": {"reputation": 3159, "user_id": 6770614, "user_type": "registered", "profile_image": "https://graph.facebook.com/201064376976820/picture?type=large", "display_name": "Boris Azanov", "link": "https://stackoverflow.com/users/6770614/boris-azanov"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1576227650, "post_id": 59294655, "comment_id": 104838781, "body": "@RobinZigmond maybe you are right, but I have case then I use do notation with my own monad class, see to update."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 2, "last_activity_date": 1576255359, "last_edit_date": 1576255359, "creation_date": 1576112509, "answer_id": 59296271, "question_id": 59294655, "link": "https://stackoverflow.com/questions/59294655/how-define-instance-monad-writer-with-custom-data-type/59296271#59296271", "title": "How define instance Monad Writer with custom data type", "body": "<p>As per @freestyle's comment, do-notation by design always uses the <code>Monad</code> class from <code>Prelude</code>, even if you have your own <code>Monad</code> class defined.  The <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#extension-RebindableSyntax\" rel=\"nofollow noreferrer\"><code>RebindableSyntax</code></a> extension can be enabled to make do-notation use whatever <code>Monad</code> class (or more specifically, whatever <code>&gt;&gt;=</code>, <code>&gt;&gt;</code>, and <code>fail</code> functions) are currently in scope.</p>\n\n<p>This also affects a bunch of other rebindable syntax.  See the link above for a list, and make sure you aren't overriding additional syntax you don't intend to.</p>\n\n<p>Also, <code>RebindableSyntax</code> implies <code>NoImplicitPrelude</code>, but that should be fine since you already have an <code>import Prelude</code> statement.</p>\n\n<p><em>UPDATE:</em>  However, it's important to make sure you've hidden <strong>ALL</strong> the applicable <code>Prelude</code> syntax, or you may find yourself unintentionally using the <code>Monad</code> class from <code>Prelude</code>, even if you didn't want to.  In your definition of:</p>\n\n<pre><code>batchLog :: Writer (Foo Integer) ()\nbatchLog = do\n  logLine \"line1\"   19450\n  logLine \"line2\"     760\n  logLine \"line3\"     218\n</code></pre>\n\n<p>the do-block is desugared into:</p>\n\n<pre><code>batchLog = logLine \"line1\" 19450 &gt;&gt; logLine \"line2\" 760 &gt;&gt; ...\n</code></pre>\n\n<p>And, where is <code>(&gt;&gt;)</code> defined?  In <code>Prelude</code>, of course.  You will need to hide that as well, and provide your own definition, either in your custom <code>Monad</code> class or as a standalone function.  After making the following modifications to your first code block, the do-block type checks correctly, and <code>runWriter batchLog</code> appears to work fine:</p>\n\n<pre><code>import Prelude hiding (..., (&gt;&gt;), ...)\n\n(&gt;&gt;) :: (Monad m) =&gt; m a -&gt; m b -&gt; m b\nact1 &gt;&gt; act2 = act1 &gt;&gt;= \\_ -&gt; act2\n</code></pre>\n"}], "owner": {"reputation": 3159, "user_id": 6770614, "user_type": "registered", "profile_image": "https://graph.facebook.com/201064376976820/picture?type=large", "display_name": "Boris Azanov", "link": "https://stackoverflow.com/users/6770614/boris-azanov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 59296271, "answer_count": 1, "score": 0, "last_activity_date": 1576271473, "creation_date": 1576101130, "last_edit_date": 1576271473, "question_id": 59294655, "link": "https://stackoverflow.com/questions/59294655/how-define-instance-monad-writer-with-custom-data-type", "title": "How define instance Monad Writer with custom data type", "body": "<p>I have module:</p>\n\n<pre><code>module Writer where\n\nimport Prelude hiding (Monad, (&gt;&gt;=), return, (=&lt;&lt;))\nmain = putStrLn \"hello\"\n\nclass Monad m where\n  return :: a -&gt; m a\n  (&gt;&gt;=) :: m a -&gt;  (a -&gt; m b) -&gt; m b\n  (=&lt;&lt;) :: (a -&gt; m b) -&gt; m a -&gt; m b\n  (=&lt;&lt;) = flip (&gt;&gt;=)\n\ndata Writer w a = Writer { runWriter :: (a, w) } deriving Show\n\ninstance (Monoid w) =&gt; Monad (Writer w) where\n  return x = Writer $ (x, mempty)\n  m &gt;&gt;= k  = let\n             (b, w1) = runWriter m\n             Writer (a, w2) = k b\n             in Writer (a, (w1 `mappend` w2))\n\nwriter :: (a, w) -&gt; Writer w a\nwriter = Writer\n\ninstance (Semigroup a, Num a) =&gt; Monoid (Foo a) where\n mempty = Foo 0\n mappend (Foo v1) (Foo v2) = Foo (v1 + v2)\n\ninstance Semigroup a =&gt; Semigroup (Foo a) where\n  (Foo v1) &lt;&gt; (Foo v2) = Foo (v1 &lt;&gt; v2)\n\ninstance Semigroup Integer where\n  a1 &lt;&gt; a2 = a1 + a2\n\n\ntell :: Monoid w =&gt; w -&gt; Writer w ()\ntell w = writer ((), w)\n\ndata Foo a = Foo { getFoo :: a } deriving Show\n\ntype LoggerFooInt = Writer (Foo Integer) ()\n\nlogLine :: String -&gt; Integer -&gt; LoggerFooInt\nlogLine _ = tell . Foo\n\nbatchLog :: Writer (Foo Integer) ()\nbatchLog = do\n  logLine \"line1\"   19450\n  logLine \"line2\"     760\n  logLine \"line3\"     218\n</code></pre>\n\n<p>I tried to write <code>batchLog</code> function but compiler said: </p>\n\n<pre><code>Writer.hs:46:3: error:\n    \u2022 No instance for (GHC.Base.Monad (Writer (Foo Integer)))\n        arising from a do statement\n    \u2022 In a stmt of a 'do' block: logLine \"line1\" 19450\n      In the expression:\n        do logLine \"line1\" 19450\n           logLine \"line2\" 760\n           logLine \"line3\" 218\n      In an equation for \u2018batchLog\u2019:\n          batchLog\n            = do logLine \"line1\" 19450\n                 logLine \"line2\" 760\n                 logLine \"line3\" 218\n   |\n46 |   logLine \"line1\"   19450\n   |   ^^^^^^^^^^^^^^^^^^^^^^^\nFailed, no modules loaded.\n</code></pre>\n\n<p>So, why I need to define any Monads else. I have already <code>instance (Monoid w) =&gt; Monad (Writer w)</code> and <code>instance (Semigroup a, Num a) =&gt; Monoid (Foo a)</code> and <code>instance Semigroup Integer</code>. Why it's not enough? Without <code>batchLog</code> function module compiles. </p>\n\n<blockquote>\n  <p>GHCi, version 8.6.5: <a href=\"http://www.haskell.org/ghc/\" rel=\"nofollow noreferrer\">http://www.haskell.org/ghc/</a></p>\n</blockquote>\n\n<p><strong>UPDATE:</strong> \nI tried to rewrite without do notation, and after a while I can do that and it compiles, but still can't understand, why another code, compiles with my own Monad and with do notation:</p>\n\n<pre><code>module MaybeMonad\nimport Prelude hiding (Monad, (&gt;&gt;=), return, (=&lt;&lt;))\nimport Control.Monad (ap, liftM)\nimport Data.Char\n\nmain = putStrLn \"hello\"\n\nclass Monad m where\n  return :: a -&gt; m a\n  (&gt;&gt;=) :: m a -&gt;  (a -&gt; m b) -&gt; m b\n  (=&lt;&lt;) :: (a -&gt; m b) -&gt; m a -&gt; m b\n\n\ninstance Monad Maybe where\n    return = Just\n    (&gt;&gt;=) Nothing _ = Nothing\n    (&gt;&gt;=) (Just x) k = k x\n    (=&lt;&lt;) = flip (&gt;&gt;=)\n\ndata Token = Number Int | Plus | Minus | LeftBrace | RightBrace\n    deriving (Eq, Show)\n\nasToken :: String -&gt; Maybe Token\nasToken \"+\" = Just(Plus)\nasToken \"-\" = Just(Minus)\nasToken \"(\" = Just(LeftBrace)\nasToken \")\" = Just(RightBrace)\nasToken str | all isDigit str = Just $ Number $ read str\nasToken _ = Nothing\n\ntokenize :: String -&gt; Maybe [Token]\ntokenize x = foldr (\\word maybeTokens -&gt; do\n  token &lt;- asToken word\n  tokens &lt;- maybeTokens\n  return $ token : tokens) (return []) $ words x\n</code></pre>\n\n<p><strong>Correct example:</strong></p>\n\n<pre><code>{-# LANGUAGE RebindableSyntax #-}\nmodule Writer where\n\nimport Prelude hiding (Monad, (&gt;&gt;=), return, (=&lt;&lt;), (&gt;&gt;))\n\nclass Monad m where\n  return :: a -&gt; m a\n  (&gt;&gt;=) :: m a -&gt;  (a -&gt; m b) -&gt; m b\n  (=&lt;&lt;) :: (a -&gt; m b) -&gt; m a -&gt; m b\n  (=&lt;&lt;) = flip (&gt;&gt;=)\n  (&gt;&gt;) :: m a -&gt; m b -&gt; m b\n\ndata Writer w a = Writer { runWriter :: (a, w) } deriving Show\n\ninstance (Monoid w) =&gt; Monad (Writer w) where\n  return x = Writer $ (x, mempty)\n  m &gt;&gt;= k  = let\n             (b, w1) = runWriter m\n             Writer (a, w2) = k b\n             in Writer (a, (w1 `mappend` w2))\n  ma &gt;&gt; mb = let\n              (_, w1) = runWriter ma\n              (vb, w2) = runWriter mb\n             in Writer(vb, (w1 `mappend` w2))\n\nwriter :: (a, w) -&gt; Writer w a\nwriter = Writer\n\ninstance (Semigroup a, Num a) =&gt; Monoid (Foo a) where\n mempty = Foo 0\n mappend (Foo v1) (Foo v2) = Foo (v1 + v2)\n\ninstance Semigroup a =&gt; Semigroup (Foo a) where\n  (Foo v1) &lt;&gt; (Foo v2) = Foo (v1 &lt;&gt; v2)\n\ninstance Semigroup Integer where\n  a1 &lt;&gt; a2 = a1 + a2\n\n\ntell :: Monoid w =&gt; w -&gt; Writer w ()\ntell w = writer ((), w)\n\ndata Foo a = Foo { getFoo :: a } deriving Show\n\nlogLine :: String -&gt; Integer -&gt; Writer (Foo Integer) ()\nlogLine _ = tell . Foo\n\nbatchLog :: Writer (Foo Integer) ()\nbatchLog = do\n  logLine \"line1\"   19450\n  logLine \"line2\"     760\n  logLine \"line3\"     218\n</code></pre>\n\n<p>after adding RebindableSyntax and hiding (>>) operator and adding my own realization it compiles and works properly. </p>\n"}, {"tags": ["haskell", "scotty"], "comments": [{"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "edited": false, "score": 0, "creation_date": 1576112067, "post_id": 59294592, "comment_id": 104796715, "body": "At the moment, I am considering wrapping ActionT in ExceptT with a custom error type that can be transformed into a response."}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1576114126, "post_id": 59294592, "comment_id": 104797132, "body": "I bet it doesn&#39;t print &quot;Couldn&#39;t parse cow mark &quot; either. If it does, try printing cowMark in ... in a case where it shouldn&#39;t have a value and see what happens."}, {"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "reply_to_user": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1576118312, "post_id": 59294592, "comment_id": 104797928, "body": "@Gurkenglas you are correct, it doesn&#39;t print that either"}], "answers": [{"comments": [{"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "edited": false, "score": 0, "creation_date": 1576161954, "post_id": 59297278, "comment_id": 104816379, "body": "Ah yes, this was a logic issue for me - I was using a query that parsed correctly, but was not in the database, and somehow while debugging this I had equated to two in my mind, forgetting that there was no check for whether or not it was in the database."}], "tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": true, "score": 1, "last_activity_date": 1576121080, "creation_date": 1576121080, "answer_id": 59297278, "question_id": 59294592, "link": "https://stackoverflow.com/questions/59294592/how-to-use-scottys-actiont-monad-like-a-maybe-monad-with-an-early-http-respons/59297278#59297278", "title": "How to use Scotty&#39;s ActionT monad like a Maybe monad, with an early http response returned for errors?", "body": "<p>Both problems stem from the <code>Nothing</code> case never being entered, because the <code>TR.readMaybe</code> always succeeds. Print <code>markTxt</code> and <code>cowMarkMaybe</code> in a case where the latter should be <code>Nothing</code>.</p>\n"}], "owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 33, "favorite_count": 0, "accepted_answer_id": 59297278, "answer_count": 1, "score": 1, "last_activity_date": 1576121080, "creation_date": 1576100793, "question_id": 59294592, "link": "https://stackoverflow.com/questions/59294592/how-to-use-scottys-actiont-monad-like-a-maybe-monad-with-an-early-http-respons", "title": "How to use Scotty&#39;s ActionT monad like a Maybe monad, with an early http response returned for errors?", "body": "<p>I would like to be able to return custom error pages and statuses to the user, and end computation in the <a href=\"https://hackage.haskell.org/package/scotty-0.11.5/docs/Web-Scotty-Internal-Types.html#t:ActionT\" rel=\"nofollow noreferrer\">ActionT</a> monad when such an error occurs. My understanding is that this is a bit like a <code>Maybe</code> monad, where computation ends when the first <code>Nothing</code> is encountered, but with a final error message emitted (to the user via HTTP).</p>\n\n<p>I have a code snippet that looks like this:</p>\n\n<pre><code>  liftIO $ scotty (config &amp; port &amp; fromEnum) $\n    get \"/cow/:mark\" $ do\n      qParams :: DM.Map LTxt.Text LTxt.Text &lt;- DM.fromList &lt;$&gt; params\n      markTxt &lt;- param \"mark\"\n      let intervalTxtMay = DM.lookup \"interval\" qParams\n      let cowMarkMaybe = TR.readMaybe $ Txt.unpack markTxt\n      cowMark &lt;- case cowMarkMaybe of\n        Nothing -&gt; do\n          status status404\n          textLazy $ \"Couldn't parse cow mark \" ++  markTxt ++ \" as integer.\"\n          finish\n        Just cmVal-&gt; pure $ CowMark cmVal\n      liftIO $ logLogIt Debug lgr [\"***** Made it past cowMark ******\"]\n      ...\n</code></pre>\n\n<p>There are at least two problems with the code: <code>finish</code> doesn't seem to do anything particularly useful here, i.e., computation continues and I still see the message <code>***** Made it past cowMark ******</code> in my logs each time load a page that would normally trigger the 404.\nThe second problem is that the 404 error is not enacted, I get a 200 response even when it should be a 404.</p>\n\n<p>Is there a way to achieve the desired behavior in Scotty?</p>\n"}, {"tags": ["haskell", "lambda", "monads", "sharing"], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 4, "creation_date": 1576091048, "post_id": 59290425, "comment_id": 104789562, "body": "A point I usually make about sharing-by-default: as leftaroundabout says, sometimes you want it and sometimes you don&#39;t, but GHC has to pick one behavior. If it chose sharing-by-default, it would be very difficult to get the no-sharing behavior. Since it instead chose no-sharing-by-default, it is easy to get the sharing behavior if you want it: hoist the stuff you want to share out of the lambda. I think this may be what you were getting at near the end, but it wasn&#39;t totally clear to me."}, {"owner": {"reputation": 135, "user_id": 11112994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c13e333c7d86ed9997ee55683b56394b?s=128&d=identicon&r=PG&f=1", "display_name": "nbu", "link": "https://stackoverflow.com/users/11112994/nbu"}, "edited": false, "score": 0, "creation_date": 1576097353, "post_id": 59290425, "comment_id": 104792315, "body": "That is helpful, thanks. I have removed the second part since it is unnecessarily complex. If I understand you correctly, you are saying that I can control whether sharing occurs by avoiding lambdas. My second example seems to boil down to something like this <a href=\"https://gist.github.com/nbun/ff6e2e3786f5f20bb6f9a3b67de1970d\" rel=\"nofollow noreferrer\">gist.github.com/nbun/ff6e2e3786f5f20bb6f9a3b67de1970d</a> . In this situation, however, replacing  lambdas with the function combinator does not introduce sharing. What am I doing wrong here?"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 5, "last_activity_date": 1576091173, "last_edit_date": 1576091173, "creation_date": 1576082640, "answer_id": 59290425, "question_id": 59289891, "link": "https://stackoverflow.com/questions/59289891/sharing-of-partially-applied-functions/59290425#59290425", "title": "Sharing of partially applied functions", "body": "<blockquote>\n  <p>I am interested in why there is no sharing within lambda functions.</p>\n</blockquote>\n\n<p>There are some applications where you really do <em>not</em> want sharing. The classical example is if the value that would be shared is a lazy (and perhaps infinite) list. Then in a non-shared situation, the first use site may process this list in a stream-fashion, and the garbage collector can immediately clean up after it. The second user of the list will then need to re-do the list build computations, yes, but everything happens in <em>O</em>(1) memory.</p>\n\n<p><em>With</em> sharing, in this situation you keep a reference to the list root around, so the garbage collector would only kick in after the second user has also consumed the list. Maybe that happens much later, after the first user has already expanded the list to several gigabytes of size. You don't want that, in general! So, lambdas (CAFs) offer a way to prevent sharing in such situations. Only if the compiler determines that sharing is really beneficial in some situation, it optimises to share anyway.</p>\n\n<blockquote>\n  <p>Is sharing of monadic computations for monad instances like <code>State</code> possible at all?</p>\n</blockquote>\n\n<p>Y...yes it is, but I don't really understand what you want to share and how. Please clarify the question.</p>\n"}], "owner": {"reputation": 135, "user_id": 11112994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c13e333c7d86ed9997ee55683b56394b?s=128&d=identicon&r=PG&f=1", "display_name": "nbu", "link": "https://stackoverflow.com/users/11112994/nbu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1576092839, "creation_date": 1576080731, "last_edit_date": 1576092839, "question_id": 59289891, "link": "https://stackoverflow.com/questions/59289891/sharing-of-partially-applied-functions", "title": "Sharing of partially applied functions", "body": "<p>I am currently experimenting with sharing of partially applied functions. In order to make sharing visible, I use the tracing effect. In order to illustrate my problem, I first show a <a href=\"https://gist.github.com/nbun/a601ed0a964ab08649775e83db4f88cf\" rel=\"nofollow noreferrer\">simplified example</a>.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>f1, f2, f3, f4 :: Int -&gt; Int\nf1   = \\x -&gt; trace \"f1\" 0 + x\nf2 x = trace \"f2\" 0 + x\nf3   = (trace \"f3\" 0 +)\nf4   = (+) (trace \"f4\" 0)\n</code></pre>\n\n<p>I compare these functions in the following scenario, where <code>f1</code> is substituted by the different functions.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>apply :: (Int -&gt; Int) -&gt; (Int -&gt; Int) -&gt; Int\napply f g = f 42 + g 42\n\nresult = let f = f1\n         in apply f f\n</code></pre>\n\n<p>The output (compiled without optimizations) is as follows.</p>\n\n<pre><code>f1 f1 f2 f2 f3 f4 336\n</code></pre>\n\n<p>The core code shows that both <code>f1</code> and <code>f2</code> are lambda functions, while <code>f3</code> and <code>f4</code> are partially applied functions. In the first case, there appears to be no sharing of the argument within the body of the lambda, while it works in the second case. Enabling compiler optimizations leads to sharing for all defintions, but I am interested in why there is no sharing within lambda functions.</p>\n"}, {"tags": ["function", "haskell", "scope"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 5, "creation_date": 1576073398, "post_id": 59287458, "comment_id": 104780393, "body": "Use pattern matching, not <code>==</code>. You can find some example in <a href=\"http://learnyouahaskell.com/making-our-own-types-and-typeclasses#algebraic-data-types\" rel=\"nofollow noreferrer\">LYAH</a>."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 0, "last_activity_date": 1576096928, "creation_date": 1576096928, "answer_id": 59293761, "question_id": 59287458, "link": "https://stackoverflow.com/questions/59287458/propositions-in-haskell/59293761#59293761", "title": "Propositions in haskell", "body": "<p>In a function definition like:</p>\n\n<pre><code>mapProp f prop | prop == Const a = f a\n               ^^^^^^^^^^^^^^^^^\n                this is a guard\n</code></pre>\n\n<p>the part <code>| prop == Const a</code> is a \"guard\".  It's a boolean expression that must be <em>evaluated</em> and yield true for the definition to match.</p>\n\n<p>Let me emphasize again that the guard expression needs to be <strong>evaluated</strong>.  You can't use a guard as a kind of \"equation solver\" to match <code>prop</code> to <code>Const a</code> and solve for the variable <code>a</code>.</p>\n\n<p>What's happening here is that Haskell is evaluating the expression <code>prop == Const a</code>.  It knows the value of <code>prop</code>, since that was matched by the pattern before the guard, but when it tries to evaluate <code>Const a</code>, the variable <code>a</code> hasn't been defined, so you get the error message \"Variable not in scope: a :: Bool\".</p>\n\n<p>In order to \"solve\" for <code>a</code>, you need to use the pattern part of the definition itself, not a guard.  So, you'd need to write the above definition as:</p>\n\n<pre><code>mapProp f (Const a) = f a\n          ^^^^^^^^^\n           pattern\n</code></pre>\n\n<p>Unfortunately, a consequence of this is that you can't use the handy syntax of boolean operators like <code>||</code> to combine a bunch of matching patterns on one line.  The most straightforward way of writing your function definition is to use multiple lines, one for each pattern, even though the right-hand side is redundant for some cases:</p>\n\n<pre><code>mapProp f (Const a) = f a\nmapProp f (Var a)   = f a\nmapProp f (Not a)   = f a\nmapProp (And a b) = And ((f a) (f b))\nmapProp (Or a b)  = And ((f a) (f b))\nmapProp f prop = f prop   -- the default case\n</code></pre>\n"}], "owner": {"reputation": 67, "user_id": 12425185, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hM3rBjfNTCM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re3s0GhoUFQ_2x3kAwI_wOB71hBkA/photo.jpg?sz=128", "display_name": "osobennyj", "link": "https://stackoverflow.com/users/12425185/osobennyj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 221, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1576096928, "creation_date": 1576072820, "last_edit_date": 1576073276, "question_id": 59287458, "link": "https://stackoverflow.com/questions/59287458/propositions-in-haskell", "title": "Propositions in haskell", "body": "<p>I am trying to implement function <strong>mapProp</strong>.</p>\n\n<pre><code>mapProp :: (Proposition -&gt; Proposition) -&gt; Proposition -&gt; Proposition\n</code></pre>\n\n<p>So when it finds proposition field as below</p>\n\n<p><a href=\"https://i.stack.imgur.com/44lXn.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/44lXn.png\" alt=\"enter image description here\"></a></p>\n\n<p>function is applied to the first argument <em>'a'</em>, then to the second argument <em>'b'</em> and then it is summed up by <strong><em>And 'a' 'b'</em></strong>.\nWhen no proposition field found - applies <strong>f</strong>.</p>\n\n<p>So far I had the description for </p>\n\n<pre><code>data Proposition =  Const Bool\n                | Var String\n                | And Proposition Proposition\n                | Or Proposition Proposition\n                | Not Proposition\n</code></pre>\n\n<p>Below is my attempt to implement the function, but it gives me an error that <em>variable is not in scope</em> of Proposition. Any hints?</p>\n\n<pre><code>mapProp f prop | prop == (Const a) || (Var a) || (Not a) = f a \n               | prop == (And a b) || (Or a b) = And ((f a) (f b))\n               | otherwise = f prop\n</code></pre>\n"}, {"tags": ["haskell", "recursion", "functional-programming"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 9, "last_activity_date": 1576070840, "last_edit_date": 1576070840, "creation_date": 1576069195, "answer_id": 59286410, "question_id": 59286337, "link": "https://stackoverflow.com/questions/59286337/loop-in-recursion-in-haskell/59286410#59286410", "title": "Loop in recursion in Haskell", "body": "<p><code>run (error \"urk!\")</code> will error out.</p>\n\n<p>Instead, <code>run [error \"urk!\"]</code> will successully return <code>1</code>.</p>\n\n<p>Why? Because <code>run</code> is defined by cases: empty list, nonempty list. Hence it has to evaluate its argument just enough to know if the list is empty or not. We don't have to evaluate the error in <code>[error \"urk!\"]</code> to see that the list is not empty, but we have if <code>error \"urk!\"</code> is the list itself.</p>\n\n<p>In the posted code, we evaluate <code>run (cycle out)</code> so we have to check if <code>cycle out</code> is empty or not. This triggers the evaluation of <code>cycle out</code>, which in turn triggers the evaluation of <code>out</code> (<code>cycle</code> is defined by cases as well). Since <code>out</code> is what we are defining, we get an infinite recursion.</p>\n\n<p>It happens that this infinite recursion is easy enough to be spotted by the GHC runtime, which kindly emits an exception <code>&lt;&lt;loop&gt;&gt;</code> instead of perform the non terminating computation.</p>\n\n<hr>\n\n<p>To stress the concept, consider these functions</p>\n\n<pre><code>strictPrepend :: [Int] -&gt; [Int]\nstrictPrepend []     = 1 : []\nstrictPrepend (x:xs) = 1 : x : xs\n\nlazyPrepend :: [Int] -&gt; [Int]\nlazyPrepend xs = 1 : xs\n</code></pre>\n\n<p>One might think that these functions are equal. Indeed, the first one is defined by cases, but in both cases it performs the same operation (prepending <code>1</code>), so it looks equivalent to the second.</p>\n\n<p>Concretely, we have that for all <em>bottom free</em> lists <code>ys</code>, the result of <code>strictPrepend ys</code> is the same as <code>lazyPrepend ys</code>.</p>\n\n<p>In the presence of bottoms (like <code>error \"..\"</code>, <code>undefined</code>, or infinite recursion), these functions differ. For instance <code>lazyPrepend undefined = 1 : undefined</code>, while <code>strictPrepend undefined = undefined</code> since it raises an exception before producing the initial element <code>1</code>.</p>\n\n<p>Consequently,</p>\n\n<pre><code>let ys = strictPrepend ys\n    zs = lazyPrepend zs\n</code></pre>\n\n<p>defines <code>ys</code> as bottom (infinite recursion) but <code>zs = 1:1:1:1:.....</code> is an infinite sequence of <code>1</code>s. This is the effect of producing the <code>1</code> before needing to evaluate the argument.</p>\n"}, {"tags": [], "owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "is_accepted": false, "score": 4, "last_activity_date": 1576069253, "creation_date": 1576069253, "answer_id": 59286429, "question_id": 59286337, "link": "https://stackoverflow.com/questions/59286337/loop-in-recursion-in-haskell/59286429#59286429", "title": "Loop in recursion in Haskell", "body": "<blockquote>\n  <p>The important thing about it is that it <code>head $ run &lt;whatever&gt;</code> is always <code>1</code>.</p>\n</blockquote>\n\n<p>Actually, no. Only when <code>whatever</code> is a non-empty list. When you pass in <code>[]</code>, the <code>run</code> function will return an empty list. The argument of <code>run</code> <em>is</em> evaluated, to the point where it can decide what case to match, in <a href=\"https://wiki.haskell.org/Weak_head_normal_form\" rel=\"nofollow noreferrer\">WHNF</a>. This does not evaluate the content of the list or the tail of the list.</p>\n\n<p>In <code>let out = run (cycle out)</code>, the <code>cycle</code> function has exactly the same problem - it needs to pattern match the list. Since that depends on the result of <code>cycle</code> itself, you would have a recursive evaluation, which the runtime complains about.</p>\n"}], "owner": {"reputation": 1082, "user_id": 4256283, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2dc2b4976c7421d83d6f34770bc36046?s=128&d=identicon&r=PG&f=1", "display_name": "Jytug", "link": "https://stackoverflow.com/users/4256283/jytug"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 59286410, "answer_count": 2, "score": 5, "last_activity_date": 1576070840, "creation_date": 1576068926, "question_id": 59286337, "link": "https://stackoverflow.com/questions/59286337/loop-in-recursion-in-haskell", "title": "Loop in recursion in Haskell", "body": "<p>I have stumbled upon the following problem. Say I have a recursive function like</p>\n\n<pre><code>run :: [Int] -&gt; [Int]\nrun [] = []\nrun (x:xs) = 1:x:run xs\n</code></pre>\n\n<p>The important thing about it is that it <code>head $ run &lt;whatever&gt;</code> is always <code>1</code>. This means \nthat the following will produce the output <code>1</code>:</p>\n\n<pre><code>head $ run [error \"shouldnt get here\"]\n\n</code></pre>\n\n<p>This proves that Haskell doesn't evaluate the argument if it doesn't need to -- obviously, since that's one of the most famous Haskell features. However, if I were to use the result as an argument, like:</p>\n\n<pre><code>let out = run (cycle out) in head out\n</code></pre>\n\n<p>I get a runtime error <code>&lt;&lt;loop&gt;&gt;</code>.</p>\n\n<p>How come?</p>\n\n<p>I am using <code>runghc 8.4.2</code>. Is that a bug or am I missing something here?</p>\n"}, {"tags": ["haskell", "split"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 8, "creation_date": 1576059197, "post_id": 59283225, "comment_id": 104772647, "body": "Don&#39;t use classes, just write a polymorphic function with the right type e.g. <code>split :: (Eq a) =&gt; [a] -&gt; a -&gt; [[a]]</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576059331, "post_id": 59283225, "comment_id": 104772707, "body": "Perhaps you want to make a <code>class Split f</code> with <code>split :: Eq a =&gt; f a -&gt; a -&gt; f a</code>, then you can define an <code>instance Split []</code>."}, {"owner": {"reputation": 53, "user_id": 9073915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09031c247f9982c3f01caf07567c62be?s=128&d=identicon&r=PG&f=1", "display_name": "KHumphs", "link": "https://stackoverflow.com/users/9073915/khumphs"}, "edited": false, "score": 0, "creation_date": 1576583456, "post_id": 59283225, "comment_id": 104939822, "body": "Classes were definitely the wrong way to solve this problem - I just included my attempt to try and demonstrate what I was trying to do"}], "answers": [{"comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1576067417, "post_id": 59283623, "comment_id": 104776953, "body": "subSlit is a typo of subSplit"}, {"owner": {"reputation": 53, "user_id": 9073915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09031c247f9982c3f01caf07567c62be?s=128&d=identicon&r=PG&f=1", "display_name": "KHumphs", "link": "https://stackoverflow.com/users/9073915/khumphs"}, "edited": false, "score": 0, "creation_date": 1576583518, "post_id": 59283623, "comment_id": 104939856, "body": "Exactly what I was looking for - thank you very much"}], "tags": [], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "is_accepted": true, "score": 4, "last_activity_date": 1576222735, "last_edit_date": 1576222735, "creation_date": 1576059942, "answer_id": 59283623, "question_id": 59283225, "link": "https://stackoverflow.com/questions/59283225/is-there-a-way-to-get-a-split-function-in-haskell-to-accept-two-different-type/59283623#59283623", "title": "Is there a way to get a &#39;split&#39; function in Haskell to accept two different types of input?", "body": "<p>You need a polymorphic function <code>split</code></p>\n\n<pre><code>split :: (Eq a) =&gt; [a]-&gt;a-&gt;[[a]]\n</code></pre>\n\n<p>Implementation is simple</p>\n\n<pre><code>split [] _    = [[]]\nsplit (x:xs) c\n  | x == c    = [] : (split xs c)\n  | otherwise = (x : head subSplit) : tail subSplit\n        where\n           subSplit = split xs c\n</code></pre>\n\n<p><strong>EDIT</strong>\nI suggest different implementation.</p>\n\n<pre><code>split :: Eq a =&gt; [a] -&gt; a -&gt; [[a]]\nsplit x c = map reverse $ split' x c []\n   where\n      split' :: Eq a =&gt; [a] -&gt; a -&gt; [a] -&gt; [[a]]\n      split' [] _ a = [a]\n      split' (x:xs) c a \n         | x == c    = a : split' xs c []\n         | otherwise = split' xs c (x:a)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "is_accepted": false, "score": 2, "last_activity_date": 1576062611, "creation_date": 1576062611, "answer_id": 59284495, "question_id": 59283225, "link": "https://stackoverflow.com/questions/59283225/is-there-a-way-to-get-a-split-function-in-haskell-to-accept-two-different-type/59284495#59284495", "title": "Is there a way to get a &#39;split&#39; function in Haskell to accept two different types of input?", "body": "<p>Just to contribute with an other approach. This solution uses <code>foldr</code>. I think it is quite neat but less undestable than @talex's</p>\n\n<pre><code>split :: (Eq a) =&gt; [a] -&gt; a -&gt; [[a]]\nsplit l c = foldr f acc l\n   where acc = [[]]\n         f a t@(i@(x:_):xs) = if a == c then []:t else (a:i):xs -- Case when the current accumulator is not empty\n--                                           |          |- cons a to current accumulator\n--                                           |- start a new accumulator\n         f a t@([]:xs)      = if a == c then t    else [a]:xs -- Case when the current accumulator is empty. Usefull when two separators are together\n--                                           |          |- cons a to current accumulator\n--                                           |- Don't start a new accumulator, just continue with the current\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": false, "score": 1, "last_activity_date": 1576066530, "creation_date": 1576066530, "answer_id": 59285632, "question_id": 59283225, "link": "https://stackoverflow.com/questions/59283225/is-there-a-way-to-get-a-split-function-in-haskell-to-accept-two-different-type/59285632#59285632", "title": "Is there a way to get a &#39;split&#39; function in Haskell to accept two different types of input?", "body": "<p>Just correct solution.</p>\n\n<pre><code>split :: Eq a =&gt; [a] -&gt; a -&gt; [[a]]                                          \nsplit xs delim = go $ dropWhile (== delim) xs                               \n  where                                                                     \n    go [] = []                                                              \n    go xs = let (tok, rest) = break (== delim) xs                           \n             in tok : go (dropWhile (== delim) rest)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1576079243, "creation_date": 1576079243, "answer_id": 59289411, "question_id": 59283225, "link": "https://stackoverflow.com/questions/59283225/is-there-a-way-to-get-a-split-function-in-haskell-to-accept-two-different-type/59289411#59289411", "title": "Is there a way to get a &#39;split&#39; function in Haskell to accept two different types of input?", "body": "<p><code>Data.List.Split.splitOn</code> (available from the <code>split</code> package) is close:</p>\n\n<pre><code>&gt; splitOn [0] [1,2,3,0,4,5,0,0,7,8,9]\n[[1,2,3],[4,5],[],[7,8,9]]\n&gt; splitOn \" \" \"Mary had a little lamb\"\n[\"Mary\",\"had\",\"a\",\"little\",\"lamb\"]\n</code></pre>\n\n<p>Your <code>split :: Eq a =&gt; [a] -&gt; a -&gt; [[a]]</code> would be</p>\n\n<pre><code>split lst d = filter (not.null) $ splitOn [d] lst\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 9073915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09031c247f9982c3f01caf07567c62be?s=128&d=identicon&r=PG&f=1", "display_name": "KHumphs", "link": "https://stackoverflow.com/users/9073915/khumphs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 59283623, "answer_count": 4, "score": -1, "last_activity_date": 1576222735, "creation_date": 1576058657, "question_id": 59283225, "link": "https://stackoverflow.com/questions/59283225/is-there-a-way-to-get-a-split-function-in-haskell-to-accept-two-different-type", "title": "Is there a way to get a &#39;split&#39; function in Haskell to accept two different types of input?", "body": "<p>I am trying to create a function split that can take either [Int] and Int <strong>or</strong> [Char] Char to split either a list of integers on an integer given or split a string on a  character given. I.e.</p>\n\n<pre><code>Main&gt; split [1,2,3,0,4,5,0,0,7,8,9] 0\n[[1,2,3],[4,5],[7,8,9]]\nMain&gt; split \"Mary had a little lamb\" ' '\n[\"Mary\",\"had\",\"a\",\"little\",\"lamb\"]\n</code></pre>\n\n<p>I've tried using Either and (Eq a) but it still doesn't seem to  work. Below is what I've tried doing using class instances but I know very little about this and get the error <code>Haskell 98 does not support multiple parameter classes</code>. \nThe best way I think I'd understand it would be to use pattern matching or list comprehensions. Any help much appreciated.</p>\n\n<pre><code>class Split a where\n  split :: (Eq a) =&gt; [a] -&gt; a -&gt; [a]\n\ninstance Split [Char] Char where\n  split [] c     = [\"\"]\n  split (x:xs) c\n    | x == c    = \"\" : (split xs c)\n    | otherwise = (x : head (split xs c)) : tail (split xs c)\n\ninstance Split [Int] Int where\n  split [] n = []\n  split (x:xs) n\n    | x == n = [] : (split xs n)\n    | otherwise = (x : head (split xs n)) : tail (split xs n)\n</code></pre>\n\n<p>I can get the split function to work with strings and characters but not lists of integers.</p>\n"}, {"tags": ["haskell", "compilation", "ghc", "interpretation"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1576058257, "post_id": 59282691, "comment_id": 104772103, "body": "I&#39;m not sure this is an on-topic question. But I would note that there&#39;s no dichotomy here \u2013 even interpreted code will usually call into pre-compiled libraries, so you still get good performance where it matters."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1576067723, "post_id": 59282691, "comment_id": 104777137, "body": "I suspect this is opinion-based, and I also suspect the answer is &quot;no&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 3, "last_activity_date": 1576086284, "creation_date": 1576086284, "answer_id": 59291355, "question_id": 59282691, "link": "https://stackoverflow.com/questions/59282691/haskell-interpreted-mode-for-real-world-app/59291355#59291355", "title": "Haskell interpreted mode for real world app", "body": "<p>Define \"common\".</p>\n\n<p>I have a program that I consider \"production code\" that takes a specification for a web page and generates the appropriate static HTML.  The specification isn't external; it's just a chunk of Haskell source code in the program.  About once a month, I update the specification and run the program.  I run it with <code>runghc</code> and the run time is a tiny fraction of a second, so compiling would be a waste of keystrokes.</p>\n\n<p>Out in the broader world, the popular <code>stack</code> tool comes with script support.  If you write a program like this:</p>\n\n<pre><code>#!/usr/bin/env stack\n{- stack script --resolver lts-14.17 -}\n\nmain = putStrLn \"Interpreted code is awesome!\"\n</code></pre>\n\n<p>and run it, it basically uses a version of <code>runghc</code> to run the script.  So, this is at least one sanctioned method for writing and running interpreted, production scripts for Haskell.</p>\n"}], "owner": {"reputation": 774, "user_id": 6034245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/n3qwA.jpg?s=128&g=1", "display_name": "chrisheyn", "link": "https://stackoverflow.com/users/6034245/chrisheyn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "closed_date": 1576090123, "accepted_answer_id": 59291355, "answer_count": 1, "score": -1, "last_activity_date": 1576086284, "creation_date": 1576057001, "last_edit_date": 1576062623, "question_id": 59282691, "link": "https://stackoverflow.com/questions/59282691/haskell-interpreted-mode-for-real-world-app", "closed_reason": "Opinion-based", "title": "Haskell interpreted mode for real world app", "body": "<p>One can run Haskell Code with <code>runhaskell ...</code> or compile it with <code>ghc ...</code>. It's clear that there are performance differences between interpreted code and an executable.</p>\n\n<p>But is it common to use interpreted Haskell code in real world applications?\nOr does this feature only exists for development purposes?</p>\n\n<p>EDIT:</p>\n\n<p>Is it common practice to run real world apps in interpreted mode like i would do with, for example, Node.js?</p>\n\n<p><code>$ node './app.js'</code></p>\n\n<p><code>$ runhaskell './Main.hs'</code></p>\n"}, {"tags": ["haskell", "shake-build-system"], "answers": [{"tags": [], "owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "is_accepted": true, "score": 2, "last_activity_date": 1576334647, "creation_date": 1576334647, "answer_id": 59336132, "question_id": 59282620, "link": "https://stackoverflow.com/questions/59282620/shake-build-read-filepath-list-from-config-file/59336132#59336132", "title": "shake build: read filepath list from config file", "body": "<p>The type of <code>file_list</code> is <code>Maybe String</code>, and the type of <code>fl</code> needs to be <code>[FilePath]</code>, so the question becomes how to write a function to transform between the two. One option is:</p>\n\n<pre><code>let fl = words (fromMaybe \"\" file_list)\n</code></pre>\n\n<p>The <code>fromMaybe</code> function replaces <code>Nothing</code> with <code>\"\"</code> - so you now have a <code>String</code>. The <code>words</code> function splits a string on the spaces, to produce <code>[String]</code>. In Haskell <code>FilePath</code> is a synonym for <code>String</code> so it all works out.</p>\n\n<p>If instead you want to error out if the key is missing, you can do:</p>\n\n<pre><code>Just file_list &lt;- getConfig \"file_list\"\nlet fl = words file_list\nneed fl\n</code></pre>\n\n<p>Now you are asserting and unwrapping the <code>Maybe</code> in <code>file_list</code>, so if it is <code>Nothing</code> you get a runtime crash, and if it is <code>Just</code> you get it without the <code>Just</code> wrapper, so can simply use <code>words</code>.</p>\n"}], "owner": {"reputation": 23, "user_id": 10657404, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-FyYj1dB9MFI/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-i9i620SoLk8lN3cUBQAcF--A87xQ/mo/photo.jpg?sz=128", "display_name": "Enzo Scossa-Romano", "link": "https://stackoverflow.com/users/10657404/enzo-scossa-romano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "accepted_answer_id": 59336132, "answer_count": 1, "score": -1, "last_activity_date": 1576334647, "creation_date": 1576056728, "question_id": 59282620, "link": "https://stackoverflow.com/questions/59282620/shake-build-read-filepath-list-from-config-file", "title": "shake build: read filepath list from config file", "body": "<p>I have a config.cfg file where a the variable file_list is a list of relative path to files</p>\n\n<pre><code>file_list = file1 dir1/file2 ../dir2/file3 \n</code></pre>\n\n<p>How do I read this variable in to get a <code>file_list::[FilePath]</code>?<br>\nTried to follow the <a href=\"https://hackage.haskell.org/package/shake-0.18.3/docs/Development-Shake-Config.html\" rel=\"nofollow noreferrer\">Development.Shake.Config API Doc</a> without success. I need something to achieve that</p>\n\n<pre><code>\nfile_list &lt;- getConfig \"file_list\"\nlet fl = ??? file_list\nneed fl\n\n</code></pre>\n\n<p>ps. I'am an Haskell beginner</p>\n"}, {"tags": ["list", "haskell", "search"], "answers": [{"tags": [], "owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "is_accepted": true, "score": 3, "last_activity_date": 1576056610, "creation_date": 1576056610, "answer_id": 59282580, "question_id": 59282445, "link": "https://stackoverflow.com/questions/59282445/how-to-create-a-function-in-haskell-that-takes-a-word-and-search-it-from-a-list/59282580#59282580", "title": "How to create a function in haskell that takes a word and search it from a list of lists", "body": "<p>One simple solution to this is to use the version of the function that returns an empty list if the output isn't found, but then \"replace\" an empty output with the desired <code>[(x, \"unknown\")]</code> value. You can even have the main lookup function as a purely local function, if you don't need it elsewhere:</p>\n\n<pre><code>pos = [[\"noun\",\"kid\",\"fox\"],[\"adj\",\"quick\",\"brown\"],[\"article\",\"The\"]]\n\nsearch x l = case lookup x l of\n    [] -&gt; [(x, \"unknown\")]\n    o  -&gt; o\n\n    where\n        lookup x [] = []\n        lookup x (y:ys) \n            | elem x y = (x, head y) : lookup x ys\n            | otherwise = lookup x ys\n</code></pre>\n\n<p>(Note that I've eliminated the <code>== True</code> from the <code>elem x y</code> guard, this isn't necessary, a guard needs its condition to be a Boolean expression and checks if it's <code>True</code> anyway.)</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1576056680, "creation_date": 1576056680, "answer_id": 59282600, "question_id": 59282445, "link": "https://stackoverflow.com/questions/59282445/how-to-create-a-function-in-haskell-that-takes-a-word-and-search-it-from-a-list/59282600#59282600", "title": "How to create a function in haskell that takes a word and search it from a list of lists", "body": "<p>You could add an extra parameter what to return as \"tail\" in case it is not found, like:</p>\n\n<pre><code>search :: Eq a =&gt; a -&gt; [[a]] -&gt; [(a, a)]\nsearch x = go [(x, \"Unknown\")]\n    where go t [] = t\n          go t (y:ys) | elem x ys = (x, head y) : go [] ys\n                      | otherwise = go t ys\n</code></pre>\n\n<p>That being said, I'm not convinced that your <code>search</code> function is designed in the correct way.</p>\n\n<p>It might be better to:</p>\n\n<ol>\n<li>use <code>[(a, [b])]</code> as \"database\", so a list of 2-tuples with <code>a</code> the \"tag\", and <code>b</code> the \"values\" for which the tag applies, and</li>\n<li>you might want to return just the empty list <code>[]</code> in case it can not find the element, since it might be possible that the tag \"Unknown\" is also part of the database.</li>\n</ol>\n\n<p>We can then implement this with:</p>\n\n<pre><code>search :: Eq a =&gt; a -&gt; [(b, [a])] -&gt; [(a, b)]\nsearch x = go\n    where go [] = []\n          go ([]:ys) = go ys\n          go ((t:vs):ys) | elem x vs = (x, t) : go ys\n                         | otherwise = go ys\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 9724336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca353c9406edbf9c0ae64264dbdfc869?s=128&d=identicon&r=PG&f=1", "display_name": "Rouge", "link": "https://stackoverflow.com/users/9724336/rouge"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 59282580, "answer_count": 2, "score": 1, "last_activity_date": 1576056680, "creation_date": 1576056230, "question_id": 59282445, "link": "https://stackoverflow.com/questions/59282445/how-to-create-a-function-in-haskell-that-takes-a-word-and-search-it-from-a-list", "title": "How to create a function in haskell that takes a word and search it from a list of lists", "body": "<p>I am working on a parts-of-speech tagger using haskell.\nIn order to do that I need to create a function that takes a word and search it in a library represented by a list of lists. So here is what I tried</p>\n\n<pre><code>pos = [[\"noun\",\"kid\",\"fox\"],[\"adj\",\"quick\",\"brown\"],[\"article\",\"The\"]]\n\nsearch x [] = [(x, \"unknown\")]\nsearch x (y:ys) \n    | elem x y == True = (x, head y) : search x ys\n    | otherwise = search x ys\n</code></pre>\n\n<p>The \"pos\" represents the library.\nThe search function takes a word and the library and returns a list of tuples containing the word and the parts of speech tag.\nMy problem is that when I call the function like this:</p>\n\n<p>search \"kid\" pos</p>\n\n<p>it returns:</p>\n\n<p>[(\"kid\", \"noun\"),(\"kid\", \"unknown\")]</p>\n\n<p>I got it that it's because of the first line in the function search that when the input is an empty list it returns the word and unknown </p>\n\n<pre><code>search x [] = [(x,\"unknown\")]\n</code></pre>\n\n<p>showing that the word was not found. However, if I change that part into:</p>\n\n<pre><code>search x [] = []\n</code></pre>\n\n<p>there would be no output when the word is not found.\nCan anyone suggest me methods to solve this?</p>\n"}, {"tags": ["haskell", "composition", "haskell-pipes"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1576048596, "post_id": 59280156, "comment_id": 104767480, "body": "&quot;pass information back and forth&quot;. <code>Pipe</code>s are unidirectional. If you need bidirectionality, perhaps you could use the <code>Client</code> and <code>Server</code> types and the  <code>request</code>, <code>respond</code>, <code>(+&gt;&gt;)</code> and <code>(&gt;&gt;~)</code> functions from <code>Pipes.Core</code><a href=\"http://hackage.haskell.org/package/pipes-4.3.13/docs/Pipes-Core.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/pipes-4.3.13/docs/Pipe&zwnj;&#8203;s-Core.html</a>"}, {"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1576050675, "post_id": 59280156, "comment_id": 104768278, "body": "Sorry not clear.  the information flows only one direction, but it flows around a closed loop.  I&#39;m trying to figure out how to close the loop."}, {"owner": {"reputation": 1958, "user_id": 939108, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/055cba8d3eb565a817f6f7f20f936814?s=128&d=identicon&r=PG", "display_name": "Hjulle", "link": "https://stackoverflow.com/users/939108/hjulle"}, "edited": false, "score": 0, "creation_date": 1576083601, "post_id": 59280156, "comment_id": 104786172, "body": "I think you&#39;ll need to decide what should happen when the number of <code>await</code>s don&#39;t match with the number of <code>yield</code>s. There is no good solution for that. The alternative of <code>request</code> and <code>respond</code> solves this by forcing them to be the same."}], "answers": [{"comments": [{"owner": {"reputation": 1958, "user_id": 939108, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/055cba8d3eb565a817f6f7f20f936814?s=128&d=identicon&r=PG", "display_name": "Hjulle", "link": "https://stackoverflow.com/users/939108/hjulle"}, "edited": false, "score": 0, "creation_date": 1576080568, "post_id": 59289354, "comment_id": 104784595, "body": "Is there any performance penalty for using an infinite chain of pipes like in loop? What happens if <code>f</code> and <code>g</code> are stateful? Also, I think <code>cyclic&#39;</code> is missing an argument in <code>yield input &gt;&gt; cyclic&#39; </code>."}, {"owner": {"reputation": 104, "user_id": 7876591, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58b32cd31f79f6ef03189317076fbab5?s=128&d=identicon&r=PG&f=1", "display_name": "mingmingrr", "link": "https://stackoverflow.com/users/7876591/mingmingrr"}, "reply_to_user": {"reputation": 1958, "user_id": 939108, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/055cba8d3eb565a817f6f7f20f936814?s=128&d=identicon&r=PG", "display_name": "Hjulle", "link": "https://stackoverflow.com/users/939108/hjulle"}, "edited": false, "score": 0, "creation_date": 1576081099, "post_id": 59289354, "comment_id": 104784892, "body": "It&#39;s more like a close pipe loop rather than an infinite chain of pipes, so the performance should be similar to something like <code>fibs = 0 : 1 : zipWith (+) fibs (tail fibs)</code>. <code>f</code> and <code>g</code> can still be stateful since there&#39;s no constrain on <code>m</code> other than <code>Monad m</code>."}, {"owner": {"reputation": 1958, "user_id": 939108, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/055cba8d3eb565a817f6f7f20f936814?s=128&d=identicon&r=PG", "display_name": "Hjulle", "link": "https://stackoverflow.com/users/939108/hjulle"}, "edited": false, "score": 0, "creation_date": 1576082095, "post_id": 59289354, "comment_id": 104785382, "body": "Here&#39;s an example: Say <code>f = cat</code>, <code>g = do {lift $ putStrLn &quot;hello&quot;; yield &quot;a&quot;; await}</code>. This will print &quot;hello&quot; twice, despite only yielding a single value. Is this intended?"}, {"owner": {"reputation": 104, "user_id": 7876591, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58b32cd31f79f6ef03189317076fbab5?s=128&d=identicon&r=PG&f=1", "display_name": "mingmingrr", "link": "https://stackoverflow.com/users/7876591/mingmingrr"}, "reply_to_user": {"reputation": 1958, "user_id": 939108, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/055cba8d3eb565a817f6f7f20f936814?s=128&d=identicon&r=PG", "display_name": "Hjulle", "link": "https://stackoverflow.com/users/939108/hjulle"}, "edited": false, "score": 0, "creation_date": 1576088025, "post_id": 59289354, "comment_id": 104788263, "body": "Ah, seems like anything before the first yield gets executed twice, so reordering <code>g</code> to <code>g = do { yield &quot;a&quot; ; lift (putStrLn &quot;hello&quot;) ; await }</code> makes it only print &quot;hello&quot; once."}, {"owner": {"reputation": 1958, "user_id": 939108, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/055cba8d3eb565a817f6f7f20f936814?s=128&d=identicon&r=PG", "display_name": "Hjulle", "link": "https://stackoverflow.com/users/939108/hjulle"}, "edited": false, "score": 0, "creation_date": 1576156616, "post_id": 59289354, "comment_id": 104813174, "body": "Yes, exactly. The problem is that you are not actually making a loop, just a potentially infinite chain of pipes that can be called whenever a part of the chain needs more values. Everything before a second yield will also be executed twice. And in that case, everything before the first yield is executed three times."}, {"owner": {"reputation": 1958, "user_id": 939108, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/055cba8d3eb565a817f6f7f20f936814?s=128&d=identicon&r=PG", "display_name": "Hjulle", "link": "https://stackoverflow.com/users/939108/hjulle"}, "edited": false, "score": 0, "creation_date": 1576157971, "post_id": 59289354, "comment_id": 104813957, "body": "I am confident that your solution is <code>O(n^2)</code>, since every await will cause everything before the corresponding yield to be re-executed. This is the performance-problem I was talking about."}, {"owner": {"reputation": 1958, "user_id": 939108, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/055cba8d3eb565a817f6f7f20f936814?s=128&d=identicon&r=PG", "display_name": "Hjulle", "link": "https://stackoverflow.com/users/939108/hjulle"}, "edited": false, "score": 0, "creation_date": 1576160800, "post_id": 59289354, "comment_id": 104815676, "body": "See my answer for a longer demonstration of this problem."}], "tags": [], "owner": {"reputation": 104, "user_id": 7876591, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58b32cd31f79f6ef03189317076fbab5?s=128&d=identicon&r=PG&f=1", "display_name": "mingmingrr", "link": "https://stackoverflow.com/users/7876591/mingmingrr"}, "is_accepted": false, "score": 0, "last_activity_date": 1576080612, "last_edit_date": 1576080612, "creation_date": 1576079048, "answer_id": 59289354, "question_id": 59280156, "link": "https://stackoverflow.com/questions/59280156/composing-pipes-into-a-loop-or-cycle-in-haskell/59289354#59289354", "title": "Composing Pipes into a loop or cycle in haskell", "body": "<p>You can make a cyclic pipe by tying the output of the pipe into the input.</p>\n\n<pre><code>cyclic :: Functor m =&gt; Producer a m r\ncyclic = cyclic &gt;-&gt; f &gt;-&gt; g\n</code></pre>\n\n<p>Consider the following example:</p>\n\n<pre><code>import Pipes\nimport qualified Pipes.Prelude as P\n\nf :: Monad m =&gt; Pipe Int Int m r\nf = P.map (* 2)\n\ng :: Monad m =&gt; Int -&gt; Pipe Int Int m Int\ng 0 = return 100\ng n = do x &lt;- await ; yield (x + 1) ; g (n - 1)\n</code></pre>\n\n<p>Since neither <code>f</code> nor <code>g</code> here yields any output before awaiting, using <code>cyclic = cyclic &gt;-&gt; f &gt;-&gt; g</code> would result in <code>f</code> awaiting forever. The key to avoiding this is making sure either <code>f</code> or <code>g</code> yields something before awaiting, or feeding in the initial input to the first pipe like so:</p>\n\n<pre><code>cyclic' :: Monad m =&gt; Int -&gt; Producer Int m Int\ncyclic' input = let pipe = (yield input &gt;&gt; pipe) &gt;-&gt; f &gt;-&gt; g 6 in pipe\n</code></pre>\n\n<p>Here running <code>runEffect (cyclic' 0 &gt;-&gt; P.print)</code> gives <code>return 100</code> and prints <code>1 3 7 15 31 63</code>.</p>\n\n<p>P.S. (possible Advent of Code 2019 spoilers) You can use this same scheme to complete day 7. If your Intcode computer has type <code>StateT IntcodeState (Pipe Int Int m)</code>, then you can use <code>replicate 5 (evalState runIntcode initialIntcodeState)</code> to get 5 pipes corresponding to each of the 5 amplifiers.</p>\n"}, {"comments": [{"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "edited": false, "score": 0, "creation_date": 1576306661, "post_id": 59289637, "comment_id": 104864551, "body": "Ok, Your point is well taken, but I am confused by the Pipes.Core documentation on request and respond.  I have opened another question seeking clairification: <a href=\"https://stackoverflow.com/questions/59333006/using-request-and-response-in-with-the-pipes-library-for-bidirectional-communica\" title=\"using request and response in with the pipes library for bidirectional communica\">stackoverflow.com/questions/59333006/&hellip;</a>"}], "tags": [], "owner": {"reputation": 1958, "user_id": 939108, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/055cba8d3eb565a817f6f7f20f936814?s=128&d=identicon&r=PG", "display_name": "Hjulle", "link": "https://stackoverflow.com/users/939108/hjulle"}, "is_accepted": true, "score": 2, "last_activity_date": 1576168729, "last_edit_date": 1576168729, "creation_date": 1576079875, "answer_id": 59289637, "question_id": 59280156, "link": "https://stackoverflow.com/questions/59280156/composing-pipes-into-a-loop-or-cycle-in-haskell/59289637#59289637", "title": "Composing Pipes into a loop or cycle in haskell", "body": "<h2>The answer</h2>\n\n<p>The easiest solution would be to use <code>Client</code> and <code>Server</code> as danidiaz suggested in the comments, since <code>pipes</code> doesn't have any built in support for cyclic pipes and it would be incredibly difficult, if not impossible to do so correctly. This is mostly because we need to handle cases where the number of <code>await</code>s doesn't match the number of <code>yield</code>s.</p>\n\n<p><strong>Edit:</strong> I added a section about the problems with the other answer. See section \"Another problematic alternative\"</p>\n\n<p><strong>Edit 2:</strong> I have added a less problematic possible solution below. See the section \"A possible solution\"</p>\n\n<h2>A problematic alternative</h2>\n\n<p>It is however possible to simulate it with the help of the <a href=\"http://hackage.haskell.org/package/pipes-4.3.13/docs/Pipes-Prelude.html#v:generalize\" rel=\"nofollow noreferrer\"><code>Proxy</code></a> framework (with <code>Client</code> and <code>Server</code>) and the neat function <a href=\"http://hackage.haskell.org/package/pipes-4.3.13/docs/Pipes-Prelude.html#v:generalize\" rel=\"nofollow noreferrer\"><code>generalize</code></a>, which turns a unidirectional <code>Pipe</code> into a bidirectional <code>Proxy</code>.</p>\n\n<pre><code>                                       generalize f x0\n   +-----------+                   +---------------------+\n   |           |                   |                     |\n   |           |                x &lt;======================== x\na ==&gt;    f    ==&gt; b   becomes      |                     |\n   |           |                a ==&gt;         f         ==&gt; b\n   |     |     |                   |                     |\n   +-----|-----+                   +----------|----------+\n         v                                    v     \n         r                                    r     \n</code></pre>\n\n<p>Now we can use <a href=\"http://hackage.haskell.org/package/pipes-4.3.13/docs/Pipes-Core.html#v:-47--47--62-\" rel=\"nofollow noreferrer\"><code>//&gt;</code></a> and <a href=\"http://hackage.haskell.org/package/pipes-4.3.13/docs/Pipes-Core.html#v:-62--92--92-\" rel=\"nofollow noreferrer\"><code>&gt;\\\\</code></a> to plug the ends and make the flow cyclic:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>loop :: Monad m =&gt; Pipe a a m r -&gt; a -&gt; Effect m r\nloop p x0 = pure &gt;\\\\ generalize p x0 //&gt; pure\n</code></pre>\n\n<p>which has this shape</p>\n\n<pre><code>            loop f\n\n              a \n        +-----|-----+\n        |     |     |\n /====&lt;=======/===&lt;========\\\n |      |           |      |\n \\=&gt; a ==&gt;    f    ==&gt; a ==/\n        |           |\n        +-----|-----+\n              v    \n              r    \n</code></pre>\n\n<p>As you can see, we are required to input an initial value for <code>a</code>. This is because there is no guarantee that the pipe won't <code>await</code> before it yields, which would force it to wait forever.</p>\n\n<p>Note however that this <strong>will throw away data</strong> if the pipe <code>yield</code>s multiple times before <code>await</code>ing, since generalize is internally implemented with a state monad that saves the last value when yielding and retrieves the last value when awaiting.</p>\n\n<h3>Usage (of the problematic idea)</h3>\n\n<p>To use it with your pipes, simply compose them and give them to <code>loop</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>runEffect $\u00a0loop (f &gt;-&gt; g)\n</code></pre>\n\n<p>But please don't use it, since it will randomly throw away data if you are not careful</p>\n\n<h2>Another problematic alternative</h2>\n\n<p>You could also make a lazily infinite chain of pipes like mingmingrr suggested</p>\n\n<pre><code>infiniteChain :: Functor m =&gt; Pipe a a m r -&gt; Producer a m r\ninfiniteChain f = infiniteChain &gt;-&gt; f\n</code></pre>\n\n<p>This solves the problem of discarded/duplicated values, but has several other problems. First is that awaiting first before yielding will cause an infinite loop with infinite memory usage, but that is already addressed in mingmingrr's answer.</p>\n\n<p>Another, more difficult to solve, issue is that every action before the corresponding yield is duplicated once for each await. We can see this if we modify their example to log what is happening:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Pipes\nimport qualified Pipes.Prelude as P\n\nf :: Monad m =&gt; Pipe Int Int m r\nf = P.map (* 2)\n\ng :: Monad m =&gt; Int -&gt; Pipe Int Int m ()\ng 0 = return ()\ng n = do\n  lift . putStrLn $ \"Awaiting. n = \" ++ show n\n  x &lt;- await\n  lift . putStrLn $ \"Got: x = \" ++ show x ++ \" and n = \"++ show n ;\n  yield (x + 1)\n  g (n - 1)\n\ncyclic' :: Monad m =&gt; Int -&gt; Producer Int m Int\ncyclic' input = let pipe = (yield input &gt;&gt; pipe) &gt;-&gt; f &gt;-&gt; g 6 in pipe\n</code></pre>\n\n<p>Now, running <code>runEffect (cyclic' 0 &gt;-&gt; P.print)</code> will print the following:</p>\n\n<pre><code>Awaiting. n = 6\nGot: x = 0 and n = 6\n1\nAwaiting. n = 5\nAwaiting. n = 6\nGot: x = 0 and n = 6\nGot: x = 2 and n = 5\n3\nAwaiting. n = 4\nAwaiting. n = 5\nAwaiting. n = 6\nGot: x = 0 and n = 6\nGot: x = 2 and n = 5\nGot: x = 6 and n = 4\n7\nAwaiting. n = 3\nAwaiting. n = 4\nAwaiting. n = 5\nAwaiting. n = 6\nGot: x = 0 and n = 6\nGot: x = 2 and n = 5\nGot: x = 6 and n = 4\nGot: x = 14 and n = 3\n15\nAwaiting. n = 2\nAwaiting. n = 3\nAwaiting. n = 4\nAwaiting. n = 5\nAwaiting. n = 6\nGot: x = 0 and n = 6\nGot: x = 2 and n = 5\nGot: x = 6 and n = 4\nGot: x = 14 and n = 3\nGot: x = 30 and n = 2\n31\nAwaiting. n = 1\nAwaiting. n = 2\nAwaiting. n = 3\nAwaiting. n = 4\nAwaiting. n = 5\nAwaiting. n = 6\nGot: x = 0 and n = 6\nGot: x = 2 and n = 5\nGot: x = 6 and n = 4\nGot: x = 14 and n = 3\nGot: x = 30 and n = 2\nGot: x = 62 and n = 1\n63\n</code></pre>\n\n<p>As you can see, for each <code>await</code>, we re-executed everything until the corresponding <code>yield</code>. More specifically, an await triggers a new copy of the pipe to run until it reaches a yield. When we await again, the copy will run until the next yield again and if it triggers an <code>await</code> during that, it will create yet another copy and run it until the first yield, and so on.</p>\n\n<p>This means that in the best case, we get <code>O(n^2)</code> instead of linear performance (And using <code>O(n)</code> instead of <code>O(1)</code> memory), since we are repeating everything for each action. In the worst case, e.g. if we were reading from or writing to a file, we could get completely wrong results since we are repeating side-effects.</p>\n\n<h2>A possible solution</h2>\n\n<p>If you really must use <code>Pipe</code>s and can't use <code>request</code>/<code>respond</code> instead and you are sure that your code will never <code>await</code> more than (or before) it <code>yield</code>s (or have a good default to give it in those cases), we could build upon my previous attempt above to make a solution that at least handles the case when <code>yield</code>ing more than you <code>await</code>.</p>\n\n<p>The trick is adding a buffer to the implementation of <code>generalize</code>, so the excess values are stored instead of being thrown away. We can also keep the extra argument as a default value for when the buffer is empty.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Pipes.Lift (evalStateP)\nimport Control.Monad.Trans.State.Strict (state, modify)\nimport qualified Data.Sequence\n\ngeneralize' :: Monad m =&gt; Pipe a b m r -&gt; x -&gt; Proxy x a x b m r\ngeneralize' p x0 = evalStateP Seq.empty $ up &gt;\\\\ hoist lift p //&gt; dn\n  where\n    up () = do\n        x &lt;- lift $ state (takeHeadDef x0)\n        request x\n    dn a = do\n        x &lt;- respond a\n        lift $ modify (Seq.|&gt; x)\n    takeHeadDef :: a -&gt; Seq.Seq a -&gt; (a, Seq.Seq a)\n    takeHeadDef x0 xs = (foldr const x0 xs, Seq.drop 1 xs)\n</code></pre>\n\n<p>If we now plug this into our definition of of <code>loop</code>, we will have solved the problem of discarding excess values (at the memory cost of keeping a buffer). It also prevents duplicating any values other than the default value and only uses the default value when the buffer is empty.</p>\n\n<pre><code>loop' :: Monad m =&gt; a -&gt; Pipe a a m r -&gt; Effect m r\nloop' x0 p = pure &gt;\\\\ generalize' p x0 //&gt; pure\n</code></pre>\n\n<p>If we want <code>await</code>ing before <code>yield</code>ing to be an error, we can simply give <code>error</code> as our default value: <code>loop' (error \"Await without yield\") somePipe</code>.</p>\n\n<h2>TL;DR</h2>\n\n<p>Use <code>Client</code> and <code>Server</code> from <a href=\"http://hackage.haskell.org/package/pipes-4.3.13/docs/Pipes-Core.html\" rel=\"nofollow noreferrer\"><code>Pipes.Core</code></a>. It will solve your problem and not cause a ton of strange bugs.</p>\n\n<p>If that is not possible, my \"Possible solution\" section with a modified version of <code>generalize</code> should do the job in most cases.</p>\n"}], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 246, "favorite_count": 0, "accepted_answer_id": 59289637, "answer_count": 2, "score": 2, "last_activity_date": 1576168729, "creation_date": 1576046671, "last_edit_date": 1576051129, "question_id": 59280156, "link": "https://stackoverflow.com/questions/59280156/composing-pipes-into-a-loop-or-cycle-in-haskell", "title": "Composing Pipes into a loop or cycle in haskell", "body": "<p>This question is about the Haskell library <a href=\"https://hackage.haskell.org/package/pipes\" rel=\"nofollow noreferrer\">Pipes</a>.</p>\n\n<p>This question is related to 2019 <a href=\"https://adventofcode.com/\" rel=\"nofollow noreferrer\">Advent of Code</a> <a href=\"https://adventofcode.com/2019/day/11\" rel=\"nofollow noreferrer\">Day 11</a> (possible spoiler warning)</p>\n\n<p>I have two <code>Pipe Int Int m r</code> <code>brain</code> and <code>robot</code> that need to pass information too each other in a continuous loop.  That is the output of <code>brain</code> need to go to the input of <code>robot</code> and the output of <code>robot</code> needs to go the the input of <code>brain</code>.  When <code>brain</code> finished I need the result of the computation.</p>\n\n<p>How do I compose <code>brain</code> and <code>robot</code> into a loop? Ideally a loop with the type <code>Effect m r</code> that I can pass to <code>runEffect</code> </p>\n\n<p>Edit: The result should look like this:</p>\n\n<pre><code>   +-----------+     +-----------+   \n   |           |     |           |   \n   |           |     |           |   \na ==&gt;    f    ==&gt; b ==&gt;    g    ==&gt; a=|\n^  |           |     |           |    |\n|  |     |     |     |     |     |    |\n|  +-----|-----+     +-----|-----+    |\n|        v                 v          |\n|        ()                r          |\n+=====================================+\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 5, "creation_date": 1576056098, "post_id": 59279587, "comment_id": 104770924, "body": "I can&#39;t think of any better term. Note that mixing record and non-record constructors in the same type is generally considered something to avoid, since it makes the fields partial functions."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1576061223, "post_id": 59279587, "comment_id": 104773797, "body": "I suppose the are called sum types."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1576087483, "post_id": 59279587, "comment_id": 104788026, "body": "@Redu That&#39;s only if you consider <code>B</code> as representing an anonymous type isomorphic to <code>()</code> and <code>C</code> representing one isomorphic to <code>b</code>. Also, <code>H</code> would also be included in the sum (representing something isomorphic to <code>(b, c)</code>)."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 2, "last_activity_date": 1576095668, "creation_date": 1576095668, "answer_id": 59293480, "question_id": 59279587, "link": "https://stackoverflow.com/questions/59279587/term-for-non-record-data-constructors-in-haskell/59293480#59293480", "title": "Term for non-record data constructors in haskell", "body": "<p>I'm not sure they <em>deserve</em> a special name.  A record constructor is basically just a non-record constructor with some automatically defined accessor functions and convenient syntactic support.  In your example above, I would consider <code>H</code> a binary constructor or a constructor of arity 2, since I can construct and destruct it like any other binary constructor:</p>\n\n<pre><code>let H a b = H (1+1) (2+2) in (a,b)\n</code></pre>\n\n<p>For what it's worth, the Haskell98 report just calls them \"constructors with field labels\" and \"constructors without field labels\" and makes it pretty clear that even with field labels they are still \"data constructors of arity k\".</p>\n"}], "owner": {"reputation": 43, "user_id": 8545960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5364653bb477df090b93c3e768f6abeb?s=128&d=identicon&r=PG&f=1", "display_name": "worudso", "link": "https://stackoverflow.com/users/8545960/worudso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 59293480, "answer_count": 1, "score": -1, "last_activity_date": 1576095668, "creation_date": 1576043481, "question_id": 59279587, "link": "https://stackoverflow.com/questions/59279587/term-for-non-record-data-constructors-in-haskell", "title": "Term for non-record data constructors in haskell", "body": "<pre class=\"lang-hs prettyprint-override\"><code>data A b c = B | C b | H { b :: b, c :: c }\n</code></pre>\n\n<p>AFAIK, <code>B</code> is called nullary constructor <code>C</code> is called unary constructor, while <code>H</code> is called record.</p>\n\n<p>But what is the term for arbitrary-arity constructors including both <code>B</code> and <code>C</code>?\nIs there something better than non-record constructors?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 668, "user_id": 2155544, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/caae6ef08bc308aaa3c34324286bad6d?s=128&d=identicon&r=PG", "display_name": "Michael restore Monica Cellio", "link": "https://stackoverflow.com/users/2155544/michael-restore-monica-cellio"}, "edited": false, "score": 2, "creation_date": 1576037418, "post_id": 59278300, "comment_id": 104764236, "body": "With respect, you haven&#39;t just been thrown in the deep end;  you&#39;ve been tossed into the ocean.  You need a more general tutorial on Haskell if you can&#39;t do this.  I don&#39;t mean this disparagingly;  I would be very happy to be able to work in Haskell."}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 2, "creation_date": 1576041505, "post_id": 59278300, "comment_id": 104765174, "body": "Note that an easier way to write <code>fst (x,y)</code> is <code>x</code> and an easier way to write <code>snd (x,y)</code> is <code>y</code>."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 2, "last_activity_date": 1576041378, "creation_date": 1576041378, "answer_id": 59279282, "question_id": 59278300, "link": "https://stackoverflow.com/questions/59278300/haskell-flag-pattern/59279282#59279282", "title": "Haskell Flag Pattern", "body": "<p>The main problem I see with your posted code is the missing <code>=</code> in the definition of <code>fill</code> and the mis-indented body.  Fixing that:</p>\n\n<pre><code>fill :: [(Int, Int)] -&gt; Int -&gt; String\nfill [(x:xs,y:ys)] a =   -- NOTE: need an `=` here\n  -- NOTE: function body needs to be indendented\n  if fst (x,y) == 0 then\n      if snd (x,y) &lt; a then \"*\" ++ fill [(xs,ys)]\n      else \"*\\n\" ++ fill [(xs,ys)]\n  else\n      if fst (x,y) == a then\n          if snd (x,y) &lt; a then \"*\" ++ fill [(xs,ys)]\n          else \"*\\n\" ++ fill [(xs,ys)]\n      else \n          if fst (x,y) + snd (x,y) == a then\n              if fst (x,y) == a then \"*\\n\" ++ fill [(xs,ys)]\n              else \"*\" ++ fill [(xs,ys)]\n          else \" \" ++ fill [(xs,ys)]\n</code></pre>\n\n<p>gets rid of the parse error and introduces about a billion type errors.  In your definition of <code>fill</code>:</p>\n\n<pre><code>fill [(x:xs,y:ys)] a = ...\n</code></pre>\n\n<p>the first argument pattern is not the right way to match a list of tuples:</p>\n\n<pre><code>[(0,0),(0,1),...]\n</code></pre>\n\n<p>Instead, you want to peel off the first tuple from the rest like so:</p>\n\n<pre><code>fill ((x,y):rest) a = ...\n</code></pre>\n\n<p>and pass <code>rest</code> to the recursive <code>fill</code> calls.  You've also forgotten, I think, to pass the second argument <code>a</code> to the recursive <code>fill</code> calls.  After fixing that, your function looks like this:</p>\n\n<pre><code>fill :: [(Int, Int)] -&gt; Int -&gt; String\nfill ((x,y):rest) a =\n  if fst (x,y) == 0 then\n      if snd (x,y) &lt; a then \"*\" ++ fill rest a\n      else \"*\\n\" ++ fill rest a\n  else\n      if fst (x,y) == a then\n          if snd (x,y) &lt; a then \"*\" ++ fill rest a\n          else \"*\\n\" ++ fill rest a\n      else\n          if fst (x,y) + snd (x,y) == a then\n              if fst (x,y) == a then \"*\\n\" ++ fill rest a\n              else \"*\" ++ fill rest a\n          else \" \" ++ fill rest a\n</code></pre>\n\n<p>This type checks, though <code>flagpattern 7</code> crashes with an unmatched pattern after outputting somewhat incorrect output:</p>\n\n<pre><code>&gt; flagpattern 7\n\"********\\n      *      *      *      *      *      *      ********\\n*** Exception: Flag.hs:(19,1)-(31,33): Non-exhaustive patterns in function fill\n</code></pre>\n\n<p>But maybe that'll help you keep working.</p>\n\n<p>Also, note that in Haskell, the expression <code>[0..a]</code> includes both endpoints:</p>\n\n<pre><code>&gt; [0..7]\n[0,1,2,3,4,5,6,7]\n</code></pre>\n\n<p>so it's possible you want to use either <code>[0..a-1]</code> or <code>[1..a]</code> in <code>grid</code> with corresponding changes to the tests in <code>fill</code>, if you expect <code>flagPattern 7</code> to return a 7x7 grid instead of an 8x8 grid.</p>\n"}], "owner": {"reputation": 9, "user_id": 12514998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2737c9fc0e34a2f80c84b0542909a9b?s=128&d=identicon&r=PG&f=1", "display_name": "petertrankarov", "link": "https://stackoverflow.com/users/12514998/petertrankarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1576041378, "creation_date": 1576033162, "question_id": 59278300, "link": "https://stackoverflow.com/questions/59278300/haskell-flag-pattern", "title": "Haskell Flag Pattern", "body": "<p>I'm a very new user to Haskell and have been thrown in the deep end with some work. I've been assigned the task to make a flag pattern function that produces something like this -</p>\n\n<p><a href=\"https://i.stack.imgur.com/wdf5o.png\" rel=\"nofollow noreferrer\">Here is a link to the image of what it should look like</a>\nTo describe it, its basically a hollow rectangle with an X in the middle produced with *'s</p>\n\n<p>The only problem is I'm not too sure how to use haskell almost entirely, especially coordinates or even if-then-else.</p>\n\n<p>Here's what I have so far, I'm pretty much stuck at the if then else part. Any help would be much appreciated!</p>\n\n<pre><code>flagpattern :: Int -&gt; String\nflagpattern a\n  | a &lt;= 4 = \"\"\n  | otherwise = fill (grid a) a\n\ngrid :: Int -&gt; [(Int, Int)]\ngrid a = [(x, y)| x&lt;- [0..a], y&lt;-[0..a]]\n\nfill :: [(Int, Int)] -&gt; Int -&gt; String\nfill [(x:xs,y:ys)] a\nif fst (x,y) == 0 then\n    if snd (x,y) &lt; a then \"*\" ++ fill [(xs,ys)]\n    else \"*\\n\" ++ fill [(xs,ys)]\nelse\n    if fst (x,y) == a then\n        if snd (x,y) &lt; a then \"*\" ++ fill [(xs,ys)]\n        else \"*\\n\" ++ fill [(xs,ys)]\n    else \n        if fst (x,y) + snd (x,y) == a then\n            if fst (x,y) == a then \"*\\n\" ++ fill [(xs,ys)]\n            else \"*\" ++ fill [(xs,ys)]\n        else \" \" ++ fill [(xs,ys)]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1576034666, "post_id": 59278246, "comment_id": 104763602, "body": "You&#39;d have to implement <code>f3</code> and <code>f4</code> independently, because their return types have nothing in common (a 3-tuple is not related to a 4-tuple at all in the type system). To make the implementation easy, you might consider using a ZipList."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 2, "last_activity_date": 1576040279, "creation_date": 1576040279, "answer_id": 59279117, "question_id": 59278246, "link": "https://stackoverflow.com/questions/59278246/consecutive-n-tuples-from-a-list-in-haskell/59279117#59279117", "title": "Consecutive n-tuples from a list in haskell", "body": "<p>As @amalloy points out in the comments, there's no straightforward way to define this operation generally across different tuple sizes, but if you're just looking for a general <em>pattern</em> for writing a set of such functions, there are a few possibilities.</p>\n\n<p>The simplest, though it looks a little physically repulsive, is just to write a simple recursive pattern match that spits out a tuple and then recurses on the tail of the argument, stopping as soon as the list becomes too short:</p>\n\n<pre><code>f3 :: [a] -&gt; [(a,a,a)]\nf3 (x1:nxt@(x2:x3:_)) = (x1,x2,x3):f3 nxt\nf3 _ = []\n\nf4 :: [a] -&gt; [(a,a,a,a)]\nf4 (x1:nxt@(x2:x3:x4:_)) = (x1,x2,x3,x4):f4 nxt\nf4 _ = []\n</code></pre>\n\n<p>While you could generalize the solution you linked to for pairs by writing:</p>\n\n<pre><code>f3' = zip3 &lt;*&gt; tail &lt;*&gt; tail.tail\nf4' = zip4 &lt;*&gt; tail &lt;*&gt; tail.tail &lt;*&gt; tail.tail.tail\n</code></pre>\n\n<p>this is too clever by half and also not a particularly efficient solution, as every argument repeats the tail operations of the previous argument when the results could be reused.</p>\n\n<p>An alternative and probably reasonably approach is:</p>\n\n<pre><code>f3'' str = let l1:l2:l3:_ = tails str in zip3 l1 l2 l3\nf4'' str = let l1:l2:l3:l4:_ = tails str in zip4 l1 l2 l3 l4\n</code></pre>\n\n<p>though it relies on having the right <code>zipk</code> available.  While <code>zip3</code> is defined in <code>Prelude</code> and <code>zip4</code> through <code>zip7</code> are defined in <code>Data.List</code>, if you need <code>zip8</code> or more, you need to define it yourself.</p>\n"}], "owner": {"reputation": 370, "user_id": 2180406, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f17fccd5d0377476bdb062c238d00210?s=128&d=identicon&r=PG", "display_name": "cheshirecatalyst", "link": "https://stackoverflow.com/users/2180406/cheshirecatalyst"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 59279117, "answer_count": 1, "score": 1, "last_activity_date": 1576040279, "creation_date": 1576032775, "last_edit_date": 1576035935, "question_id": 59278246, "link": "https://stackoverflow.com/questions/59278246/consecutive-n-tuples-from-a-list-in-haskell", "title": "Consecutive n-tuples from a list in haskell", "body": "<p>Is there an easy-ish / general way to get consecutive n-tuples? For example:</p>\n\n<pre><code>f3 [1,2,3,4,5,6] = [(1,2,3),(2,3,4),(3,4,5),(4,5,6)]\nf4 [1,2,3,4,5,6] = [(1,2,3,4),(2,3,4,5),(3,4,5,6)]\n</code></pre>\n\n<p><a href=\"https://stackoverflow.com/questions/36670539/consecutive-pairs-from-list-in-haskell\">Similar question</a> however it only covers pairs <code>(x,y)</code>. </p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1576017100, "post_id": 59275945, "comment_id": 104759571, "body": "I think it should be noted that this has still quadratic complexity while it could be O(N), e.g. using an accumulator-based recursive function. OP asks for &quot;optimality&quot;, and I am unsure about what they actually want."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1576017281, "post_id": 59275945, "comment_id": 104759648, "body": "Good point @chi, I interpreted the OP as just asking to write the function pure in terms of the <code>List</code> type without involving the built-in list type, and hadn&#39;t even considered complexity or how to reduce it. But I will happily admit, having thought about it, that this is <code>O(n^2)</code> and therefore very bad."}], "tags": [], "owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "is_accepted": false, "score": 1, "last_activity_date": 1576014877, "creation_date": 1576014877, "answer_id": 59275945, "question_id": 59275883, "link": "https://stackoverflow.com/questions/59275883/reverse-own-list-a-more-optimal-way/59275945#59275945", "title": "Reverse own list a more optimal way", "body": "<p>All you need to do is translate all the list functions you're using to ones on your <code>List</code> type. Here this means <code>++</code> - let's define this for your version, and call it say <code>listConcat</code> (feel free to come up with your own name):</p>\n\n<pre><code>listConcat :: List a -&gt; List a -&gt; List a\nlistConcat Nil as = as\nlistConcat (Cons a as) bs = Cons a (listConcat as bs) \n</code></pre>\n\n<p>And then you can just translate the definition of <code>reverseList</code> that you already have:</p>\n\n<pre><code>reverseList :: List a -&gt; List a\nreverseList Nil = Nil\nreverseList (Cons a as) = listConcat (reverseList as) (Cons a Nil) \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1576023454, "post_id": 59277044, "comment_id": 104761271, "body": "This is O(N), but I find it a bit more complex than needed. We can replace <code>conc Nil</code> with <code>id</code>. Further, <code>conc (Cons x Nil)</code> can be written as <code>Cons x</code>. At that point, <code>conc</code> is no longer needed."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1576024201, "post_id": 59277044, "comment_id": 104761453, "body": "@chi I shouldn&#39;t say that i have thought your points and left them so deliberately since i haven&#39;t... You are right, however i think, still it&#39;s fine this way since along with the comments in the code, they might be helpful for those who might get curious to understand what&#39;s going on."}], "tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 1, "last_activity_date": 1576022149, "creation_date": 1576022149, "answer_id": 59277044, "question_id": 59275883, "link": "https://stackoverflow.com/questions/59275883/reverse-own-list-a-more-optimal-way/59277044#59277044", "title": "Reverse own list a more optimal way", "body": "<p>You may perhaps do it in an applicative style efficiently. It should be O(n)</p>\n\n<pre><code>data List a = Nil | Cons a (List a) deriving Show\n\nconc :: List a -&gt; List a -&gt; List a\nconc Nil xs = xs\nconc (Cons x xs) ys = Cons x $ conc xs ys\n\nrevlist :: List a -&gt; List a\nrevlist xs = go xs Nil                                  -- invoke go xs function by Nil\n             where\n             go ::  List a -&gt; (List a -&gt; List a)\n             go Nil         = conc Nil                  -- such as ([]++)\n             go (Cons x xs) = go xs . conc (Cons x Nil) -- such as go xs . ([x]++)\n\n\u03bb&gt; revlist (Cons 1 (Cons 2 (Cons 3 Nil)))\nCons 3 (Cons 2 (Cons 1 Nil))\n</code></pre>\n\n<p>We are nesting the concatenation operations (<code>conc</code>) to the right. This is basically difference lists.</p>\n"}, {"tags": [], "owner": {"reputation": 3127, "user_id": 7096763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c1843972ea822c36c0c024d2ddcc8d7?s=128&d=identicon&r=PG&f=1", "display_name": "MikaelF", "link": "https://stackoverflow.com/users/7096763/mikaelf"}, "is_accepted": false, "score": 2, "last_activity_date": 1576038296, "last_edit_date": 1576038296, "creation_date": 1576035160, "answer_id": 59278539, "question_id": 59275883, "link": "https://stackoverflow.com/questions/59275883/reverse-own-list-a-more-optimal-way/59278539#59278539", "title": "Reverse own list a more optimal way", "body": "<p>Starting from <a href=\"https://stackoverflow.com/a/26847373/7096763\">this answer</a> to a similar question, you can let the compiler derive a <code>Traversable</code> instance to your <code>List</code> type:</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\n{-# LANGUAGE DeriveFoldable #-}\n{-# LANGUAGE DeriveTraversable #-}\n\ndata List a = Nil | Cons a (List a) deriving (Show, Functor, Foldable, Traversable)\n--You need the Functor and Foldable instances\n</code></pre>\n\n<p>Then, <code>reverse'</code> becomes simply:</p>\n\n<pre><code>reverse' = foldl (flip Cons) Nil\n</code></pre>\n\n<p>which is O(N) time complexity.</p>\n"}, {"comments": [{"owner": {"reputation": 7193, "user_id": 363663, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c59cd40f0edcd3feea80c7ca09bc8e76?s=128&d=identicon&r=PG", "display_name": "sof", "link": "https://stackoverflow.com/users/363663/sof"}, "edited": false, "score": 0, "creation_date": 1576075621, "post_id": 59281959, "comment_id": 104781681, "body": "This is exactly how <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.List.html#reverse\" rel=\"nofollow noreferrer\">reverse</a> in <code>Data.List</code> does!"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1576055588, "last_edit_date": 1576055588, "creation_date": 1576054540, "answer_id": 59281959, "question_id": 59275883, "link": "https://stackoverflow.com/questions/59275883/reverse-own-list-a-more-optimal-way/59281959#59281959", "title": "Reverse own list a more optimal way", "body": "<p>In my view, the most basic O(N) solution is to use recursion and an accumulator:</p>\n\n<pre><code>revlist :: List a -&gt; List a\nrevlist xs = go xs Nil\n   where\n   go ::  List a -&gt; List a -&gt; List a\n   go Nil         zs = zs\n   go (Cons y ys) zs = go ys (Cons y zs)\n</code></pre>\n\n<p>This exploits <code>go</code>, a tail-recursive function which essentially uses the two lists as stacks, repeatedly popping elements form the first stack and pushing them to the second stack. Once the first stack is empty, the second stack contains the reversed list.</p>\n"}], "owner": {"reputation": 7193, "user_id": 363663, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c59cd40f0edcd3feea80c7ca09bc8e76?s=128&d=identicon&r=PG", "display_name": "sof", "link": "https://stackoverflow.com/users/363663/sof"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 59281959, "answer_count": 4, "score": 2, "last_activity_date": 1576055588, "creation_date": 1576014519, "question_id": 59275883, "link": "https://stackoverflow.com/questions/59275883/reverse-own-list-a-more-optimal-way", "title": "Reverse own list a more optimal way", "body": "<p>Tried to mimic the <code>reverse</code> function to the ADT <code>List</code> below,</p>\n\n<pre><code> data List a = Nil | Cons a (List a) deriving (Show)                                                                   \n\n reverseList = convert . reverse'                                                                                      \n     where                                                                                                             \n         reverse' Nil = []                                                                                             \n         reverse' (Cons x list) = reverse' list ++ [x]                                                                 \n\n         convert [] = Nil                                                                                              \n         convert (x:xs) = Cons x (convert xs)  \n</code></pre>\n\n<p>The <code>reverseList</code> is composed of <code>convert</code> and <code>reverse'</code>, how to achieve it optimally for instance without the aid of the built-in list?                              </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1778, "user_id": 9063139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bze7O.png?s=128&g=1", "display_name": "Martin Morterol", "link": "https://stackoverflow.com/users/9063139/martin-morterol"}, "edited": false, "score": 0, "creation_date": 1576045684, "post_id": 59274603, "comment_id": 104766429, "body": "Downvoter, if you can point out what my question is missing, I will gladly improve it."}], "answers": [{"comments": [{"owner": {"reputation": 1778, "user_id": 9063139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bze7O.png?s=128&g=1", "display_name": "Martin Morterol", "link": "https://stackoverflow.com/users/9063139/martin-morterol"}, "edited": false, "score": 0, "creation_date": 1576045883, "post_id": 59274871, "comment_id": 104766505, "body": "AFAIU, this will return / print all value at each step of the <code>forever</code> loop, ( or print all then error at the first ). In both case it doesn&#39;t realy use the loop. Or did I miss something ?"}, {"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "reply_to_user": {"reputation": 1778, "user_id": 9063139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bze7O.png?s=128&g=1", "display_name": "Martin Morterol", "link": "https://stackoverflow.com/users/9063139/martin-morterol"}, "edited": false, "score": 0, "creation_date": 1576081836, "post_id": 59274871, "comment_id": 104785275, "body": "You need to restart your recursive <code>move</code> invocation for every new iteration of the <code>forever</code> loop, don&#39;t you? The <code>remainingTurns</code> parameter serves to track the <code>move</code>&#39;s invocations, not <code>main</code>&#39;s. It&#39;s like the &quot;accumulator parameter&quot; typical for recursive algoritms."}], "tags": [], "owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "is_accepted": false, "score": 0, "last_activity_date": 1576009672, "creation_date": 1576009672, "answer_id": 59274871, "question_id": 59274603, "link": "https://stackoverflow.com/questions/59274603/get-step-number-in-forever-loop/59274871#59274871", "title": "Get step number in forever loop", "body": "<p>Since all your data are immutable, and the only effectively updatable thing is the parameter list of a function, I would use it. </p>\n\n<p>The idea:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>move lx tx ly ty remainingTurns\n  | remainingTurns &lt; 1 = -- I don't know how do you signal an error.\n  | ... move lx (snd gd) ly (snd hb) (remainingTurns - 1) ...\n</code></pre>\n\n<p>You can also consider including the number of steps remaining in the returned value.</p>\n"}], "owner": {"reputation": 1778, "user_id": 9063139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bze7O.png?s=128&g=1", "display_name": "Martin Morterol", "link": "https://stackoverflow.com/users/9063139/martin-morterol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 87, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1576145561, "creation_date": 1576008429, "question_id": 59274603, "link": "https://stackoverflow.com/questions/59274603/get-step-number-in-forever-loop", "title": "Get step number in forever loop", "body": "<p>I am new to Haskell and want to improve with some exercices. \nOne is here: <a href=\"https://www.codingame.com/ide/puzzle/power-of-thor-episode-1\" rel=\"nofollow noreferrer\">https://www.codingame.com/ide/puzzle/power-of-thor-episode-1</a></p>\n\n<p>I solved this exercice with :</p>\n\n<pre><code>import System.IO\nimport Control.Monad\n\nupDown l t \n    | l&gt;t = (\"S\", (t+1))\n    | t&gt;l = (\"N\", (t-1))\n    | otherwise = (\"\", t)\n\nleftRight l t \n    | l&gt;t = (\"E\", (t+1))\n    | t&gt;l = (\"W\", (t-1))\n    |otherwise = (\"\", t)   \n\nmove lx tx ly ty \n    | lx==ly &amp;&amp; tx==ty = []\n    | otherwise =\n    ((fst hb ++ fst gd) : move lx (snd gd) ly (snd hb) )\n        where   gd = leftRight lx tx\n                hb = upDown ly ty \n\nmain :: IO ()\nmain = do\n    hSetBuffering stdout NoBuffering -- DO NOT REMOVE\n\n    input_line &lt;- getLine\n    let input = words input_line\n    let lightx = read (input!!0) :: Int -- the X position of the light of power\n    let lighty = read (input!!1) :: Int -- the Y position of the light of power\n    let initialtx = read (input!!2) :: Int -- Thor's starting X position\n    let initialty = read (input!!3) :: Int -- Thor's starting Y position\n\n    mapM_ putStrLn $ move lightx initialtx lighty initialty \n</code></pre>\n\n<p>I am very curious about the code template initially provided (see below). </p>\n\n<p><strong>My questions are :</strong> </p>\n\n<ul>\n<li>Is the following exercice just poorly translated from an procedural language ?</li>\n<li>I know how to generate the list of solution moves. How can I print them one by one in the forever loop ?</li>\n</ul>\n\n<p>The initial template :</p>\n\n<pre><code>import System.IO\nimport Control.Monad\n\nmain :: IO ()\nmain = do\n    hSetBuffering stdout NoBuffering -- DO NOT REMOVE\n\n    input_line &lt;- getLine\n    let input = words input_line\n    let lightx = read (input!!0) :: Int -- the X position of the light of power\n    let lighty = read (input!!1) :: Int -- the Y position of the light of power\n    let initialtx = read (input!!2) :: Int -- Thor's starting X position\n    let initialty = read (input!!3) :: Int -- Thor's starting Y position\n\n    forever $ do\n        input_line &lt;- getLine\n        let remainingturns = read input_line :: Int -- The remaining amount of turns Thor can move. Do not remove this line.\n\n        putStrLn \"SE\"\n</code></pre>\n\n<p>Note : we cannot use something like <code>initialValue - remainingturns</code> because we don't know the <code>initialValue</code></p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 105, "user_id": 12429061, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LPeFpqCo8pQ/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pvhFkdewt5Pm1XY2MTnIgr6USr8A/mo/photo.jpg?sz=128", "display_name": "German student 99", "link": "https://stackoverflow.com/users/12429061/german-student-99"}, "edited": false, "score": 0, "creation_date": 1575975776, "post_id": 59265374, "comment_id": 104739145, "body": "Thank you, now there is a case where, if two values are the same.. then they are ordered as the key, for example [(4,3), (2,3),(10,5)] -&gt; [(2,3), (4,3),(10,5)].  I add to the last function this line but it gives me an error in the main :: IO          where if sortOn snd == sortOn snd then sortOn fst"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 105, "user_id": 12429061, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LPeFpqCo8pQ/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pvhFkdewt5Pm1XY2MTnIgr6USr8A/mo/photo.jpg?sz=128", "display_name": "German student 99", "link": "https://stackoverflow.com/users/12429061/german-student-99"}, "edited": false, "score": 1, "creation_date": 1575978830, "post_id": 59265374, "comment_id": 104740751, "body": "Try <code>sortOn swap</code>. No need to make an explicit case distinction."}, {"owner": {"reputation": 3127, "user_id": 7096763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c1843972ea822c36c0c024d2ddcc8d7?s=128&d=identicon&r=PG&f=1", "display_name": "MikaelF", "link": "https://stackoverflow.com/users/7096763/mikaelf"}, "edited": false, "score": 0, "creation_date": 1577483875, "post_id": 59265374, "comment_id": 105185408, "body": "<code>comparing</code> is in Data.Ord"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 2, "last_activity_date": 1575974516, "creation_date": 1575974516, "answer_id": 59265374, "question_id": 59264711, "link": "https://stackoverflow.com/questions/59264711/program-takes-a-list-of-pair-and-return-it-ordered-from-small-to-big/59265374#59265374", "title": "Program takes a list of pair and return it ordered from small to big", "body": "<p>First, <em>what ever gave you the idea</em> that it would be a good idea to call this function \u201cvector\u201d?? Let's make it instead</p>\n\n<pre><code>import Data.List (maximumBy)\nimport Data.List (comparing)\n\nmaximumOnSnd :: Ord a =&gt; [(t, a)] -&gt; (t, a)\nmaximumOnSnd = maximumBy $ comparing snd\n</code></pre>\n\n<p>Now, you <em>could</em> use that for implementing <a href=\"https://en.wikipedia.org/wiki/Selection_sort\" rel=\"nofollow noreferrer\">a sorting function</a>, but it will be absurdly inefficient \u2013 not just because it's an <em>O</em> (<em>n</em><sup>2</sup>) algorithm, also because it requires some unnecessary extra list traversals. In particular, it's not enough to just <em>find</em> the highest element, you actually need to <em>extract</em> it. One possibility (both inefficient and unreliable) is to filter out the one you found:</p>\n\n<pre><code>extrMaximumOnSnd :: (Ord a, Eq t) =&gt; [(t, a)] -&gt; ((t, a), [(t, a)])\nextrMaximumOnSnd l = (maxMember, filter (/=maxMember) l)\n where maxMember = maximumOnSnd l\n</code></pre>\n\n<p>Given that, you can then recursively implement the selection sort:</p>\n\n<pre><code>sortOnSnd :: (Ord a, Eq t) =&gt; [(t, a)] -&gt; [(t, a)]\nsortOnSnd [] = []\nsortOnSnd l = case extrMaximumOnSnd l of\n     (maxMember, others) -&gt; sortOnSnd ++ [maxMember]\n</code></pre>\n\n<p>But again, keep in mind that this is very inefficient, less general then it should be (<code>Eq t</code> constraint) and unreliable, in particular when the list contains duplicate elements.</p>\n\n<p>A much better solution is</p>\n\n<pre><code>import Data.List (sortOn)\n\nsortOnSnd :: Ord a =&gt; [(t, a)] -&gt; [(t, a)]\nsortOnSnd = sortOn snd\n</code></pre>\n"}], "owner": {"reputation": 105, "user_id": 12429061, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LPeFpqCo8pQ/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pvhFkdewt5Pm1XY2MTnIgr6USr8A/mo/photo.jpg?sz=128", "display_name": "German student 99", "link": "https://stackoverflow.com/users/12429061/german-student-99"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 59265374, "answer_count": 1, "score": 2, "last_activity_date": 1575976931, "creation_date": 1575972425, "last_edit_date": 1575976931, "question_id": 59264711, "link": "https://stackoverflow.com/questions/59264711/program-takes-a-list-of-pair-and-return-it-ordered-from-small-to-big", "title": "Program takes a list of pair and return it ordered from small to big", "body": "<p>so I wrote this program where it takes a key value list and return the pair with the biggest value, now i want the program to return the the original list but organized as the smallest value at the first and then the biggest at the last for example <strong>[(4,3) , (2,10), (2,1)] -> it returns [(2,1) , (4,3), (2,10)]</strong></p>\n\n<pre><code>vector :: Ord a =&gt; [(t, a)] -&gt; (t, a)\nvector (x:xs) = maxTail x xs\n  where maxTail currentMax [] = currentMax\n        maxTail (m, n) (p:ps)\n          | n &lt; (snd p) = maxTail p ps\n          | otherwise = maxTail (m, n) ps\n\n</code></pre>\n\n<p>I tried to do this </p>\n\n<pre><code>vec xs = [ vector tt | tt &lt;- xs]\n\n</code></pre>\n\n<p>but does not work because vector function  brings back list of lists of pair and vector function takes lists of pair.</p>\n\n<p>how can I modify it to do what I want it to do</p>\n\n<hr>\n\n<p>@leftaroundabout helped with this function </p>\n\n<pre><code>import Data.List (sortOn)\n\nsortOnSnd :: Ord a =&gt; [(a, b)] -&gt; [(a, b)]\nsortOnSnd = sortOn snd \n</code></pre>\n\n<p>now if there was two values that equal each other I want the program to order it according to the key for example <strong>[(42,3), (3,3), (4,1)] -> [(4,1), (3,3), (42,3)]</strong>\nHere what I did </p>\n\n<pre><code>import Data.List (sortOn)\n\nsortOnSnd :: Ord a =&gt; [(a, b)] -&gt; [(a, b)]\nsortOnSnd = sortOn snd \nif sortOn snd == sortOn snd then sortOn fst \n</code></pre>\n\n<p>it gives error in the main IO function </p>\n"}, {"tags": ["algorithm", "debugging", "haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 3, "creation_date": 1575936863, "post_id": 59258455, "comment_id": 104726038, "body": "Sounds like you should be using <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:takeWhile\" rel=\"nofollow noreferrer\">takeWhile</a>. I&#39;ll leave you to come up with a suitable predicate function (which you could for example write with a fairly simple direct recursion)."}, {"owner": {"reputation": 341, "user_id": 9661260, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/696b4f4a7892396d5828d00157a2874d?s=128&d=identicon&r=PG&f=1", "display_name": "K.Madden", "link": "https://stackoverflow.com/users/9661260/k-madden"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1575937527, "post_id": 59258455, "comment_id": 104726201, "body": "Could this then be essentially used to get the longest common prefix?"}, {"owner": {"reputation": 308, "user_id": 1318115, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/NtGoy.jpg?s=128&g=1", "display_name": "Andrelec1", "link": "https://stackoverflow.com/users/1318115/andrelec1"}, "edited": false, "score": 0, "creation_date": 1575937590, "post_id": 59258455, "comment_id": 104726214, "body": "Is something like autocompletion, you start enter a world and you have a list of words start with same letters ?"}, {"owner": {"reputation": 341, "user_id": 9661260, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/696b4f4a7892396d5828d00157a2874d?s=128&d=identicon&r=PG&f=1", "display_name": "K.Madden", "link": "https://stackoverflow.com/users/9661260/k-madden"}, "edited": false, "score": 0, "creation_date": 1575937819, "post_id": 59258455, "comment_id": 104726260, "body": "It\u2019s a longest common prefix problem I\u2019m trying to perform"}, {"owner": {"reputation": 3127, "user_id": 7096763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c1843972ea822c36c0c024d2ddcc8d7?s=128&d=identicon&r=PG&f=1", "display_name": "MikaelF", "link": "https://stackoverflow.com/users/7096763/mikaelf"}, "edited": false, "score": 0, "creation_date": 1575939872, "post_id": 59258455, "comment_id": 104726665, "body": "Give this a try <code>takeWhile ((==1) . length . nub)</code>. Sorry for the curt comment, I&#39;m in a lecture ;)"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 3127, "user_id": 7096763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c1843972ea822c36c0c024d2ddcc8d7?s=128&d=identicon&r=PG&f=1", "display_name": "MikaelF", "link": "https://stackoverflow.com/users/7096763/mikaelf"}, "edited": false, "score": 3, "creation_date": 1575940654, "post_id": 59258455, "comment_id": 104726816, "body": "@MikaelF <code>nub</code> is needlessly expensive if all you want to know is that there&#39;s exactly one element. You could instead use <code>all</code> to test whether each element of the list is equal to the list&#39;s first element."}, {"owner": {"reputation": 341, "user_id": 9661260, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/696b4f4a7892396d5828d00157a2874d?s=128&d=identicon&r=PG&f=1", "display_name": "K.Madden", "link": "https://stackoverflow.com/users/9661260/k-madden"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1575941179, "post_id": 59258455, "comment_id": 104726907, "body": "@amalloy so how do you mean to go about it? Still use a takeWhile?"}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1575941475, "post_id": 59258455, "comment_id": 104726961, "body": "Related: <a href=\"https://stackoverflow.com/q/55815807/7509065\">Test if all elements of a Foldable are the same</a>"}], "answers": [{"comments": [{"owner": {"reputation": 341, "user_id": 9661260, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/696b4f4a7892396d5828d00157a2874d?s=128&d=identicon&r=PG&f=1", "display_name": "K.Madden", "link": "https://stackoverflow.com/users/9661260/k-madden"}, "edited": false, "score": 0, "creation_date": 1576416106, "post_id": 59259368, "comment_id": 104885276, "body": "Amazing! thank you so much. If you don&#39;t mind could you possibly give a quick breakdown of the line &#39;prefix = map (head . head) . takeWhile single . map group . transpose&#39; as in how it works on the string"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 4, "last_activity_date": 1575945555, "last_edit_date": 1575945555, "creation_date": 1575945047, "answer_id": 59259368, "question_id": 59258455, "link": "https://stackoverflow.com/questions/59258455/check-all-characters-are-the-same-in-a-string/59259368#59259368", "title": "Check all characters are the same in a string", "body": "<p>One way of doing it is to apply <code>group</code> to each string:</p>\n\n<pre><code>&gt; group \"hhhh\"\n[\"hhhh\"]\n&gt; group \"plml\"\n[\"p\",\"l\",\"m\",\"l\"]\n</code></pre>\n\n<p>Then, if you <code>takeWhile</code> the group count is 1, you'll get all the homogeneous strings:</p>\n\n<pre><code>&gt; test = [\"hello\",\"help\",\"hell\",\"helm\"]\n&gt; import Data.List\n&gt; takeWhile ((==1) . length) . map group . transpose $ test\n[[\"hhhh\"],[\"eeee\"],[\"llll\"]]\n</code></pre>\n\n<p>You can get rid of the extra list layer with <code>map head</code>.</p>\n\n<p>Also, it would actually be better to replace this test for single groups with a custom pattern match function:</p>\n\n<pre><code>single :: [a] -&gt; Bool\nsingle [a] = True\nsingle _ = False\n</code></pre>\n\n<p>and use:</p>\n\n<pre><code>&gt; map head . takeWhile single . map group . transpose $ test\n[\"hhhh\",\"eeee\",\"llll\"]]\n</code></pre>\n\n<p>The main difference is that <code>(==1) . length</code> needs to evaluate and count the length of the whole set of groups, but <code>single</code> can stop early.  For example, on an infinite string:</p>\n\n<pre><code>&gt; ((==1) . length) $ group $ \"aaa\" ++ repeat 'b'  -- hangs forever\n&gt; single $ group $ \"aaa\" ++ repeat 'b'  -- returns `False` at first 'b'\n</code></pre>\n\n<p>An alternative, suggested in the comments, would be to do a more direct check that the first character is equal to all the other characters:</p>\n\n<pre><code>allSame :: (Eq a) =&gt; [a] -&gt; Bool\nallSame (x:rest) = all (==x) rest\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>&gt; takeWhile allSame . transpose $ test\n[\"hhhh\",\"eeee\",\"llll\"]\n</code></pre>\n\n<p><strong>SPOILERS:</strong> \nAs per your comments, you're trying to find the longest prefix, so to finish things off, note that you want to <code>map head</code> across:</p>\n\n<pre><code>[\"hhhh\",\"eeee\",\"llll\"]\n</code></pre>\n\n<p>to get:</p>\n\n<pre><code>['h','e','l']\n</code></pre>\n\n<p>which is the same as:</p>\n\n<pre><code>\"hel\"\n</code></pre>\n\n<p>Since <code>map head</code> followed by <code>map head</code> can be written <code>map head . map head</code>, or even shorter <code>map (head . head)</code>, the final definition using <code>group</code> can be written:</p>\n\n<pre><code>prefix :: (Eq a) =&gt; [[a]] -&gt; [a]\nprefix = map (head . head) . takeWhile single . map group . transpose\n   where single [a] = True\n         single _ = False\n</code></pre>\n\n<p>and the final definition using <code>allSame</code> can be written:</p>\n\n<pre><code>prefix :: (Eq a) =&gt; [[a]] -&gt; [a]\nprefix = map head . takeWhile allSame . transpose\n   where allSame (x:rest) = all (==x) rest\n</code></pre>\n"}], "owner": {"reputation": 341, "user_id": 9661260, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/696b4f4a7892396d5828d00157a2874d?s=128&d=identicon&r=PG&f=1", "display_name": "K.Madden", "link": "https://stackoverflow.com/users/9661260/k-madden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 59259368, "answer_count": 1, "score": -1, "last_activity_date": 1575945555, "creation_date": 1575936698, "last_edit_date": 1575937977, "question_id": 59258455, "link": "https://stackoverflow.com/questions/59258455/check-all-characters-are-the-same-in-a-string", "title": "Check all characters are the same in a string", "body": "<p>Was wondering if you could help me, I'm writing a haskell program and im using the transpose method and its working as I wish. But I then wish to check each [string] returned from the transpose is of the same charcter e.g</p>\n\n<pre><code>transpose[\"hello\",\"help\",\"hell\",\"helm\"] \n</code></pre>\n\n<p>would return something like </p>\n\n<pre><code>[\"hhhh\",\"eeee\",\"llll\",\"plml\",\"o\"]\n</code></pre>\n\n<p>I wonder is it then possible to go through each the above and stopping when the string isn't of all the same characters e.g stoping at \"plml\"</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 5, "creation_date": 1575933760, "post_id": 59258022, "comment_id": 104725314, "body": "That&#39;s not the complete error. Post <i>complete</i> error."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 3, "creation_date": 1575934466, "post_id": 59258022, "comment_id": 104725491, "body": "You may do like <code>maximumBy (comparing snd) [(60,3),(10,4),(5,30)]</code> whereas <code>maximumBy</code> lives in the <code>Data.List</code> and <code>comparing</code> lives in the <code>Data.Ord</code> packages."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1575947272, "post_id": 59258022, "comment_id": 104728120, "body": "Read the error more closely. It is &quot;couldn&#39;t match expected type &lt;some type&gt; with actual type &lt;different type&gt;&quot;, and it tells you which expression is causing the problem.  This often gets you a long way toward seeing the problem."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1575968194, "creation_date": 1575968194, "answer_id": 59263422, "question_id": 59258022, "link": "https://stackoverflow.com/questions/59258022/finding-the-biggest-value-of-key-value-list/59263422#59263422", "title": "Finding the biggest value of key-value list", "body": "<p><code>maxTail</code> returns a pair (the maximum one), while <code>vector</code>'s type promises to return a list of pairs. Hence the mismatch. The full type error (which was not posted) should have provided this as a hint.</p>\n\n<p>Do you really need to return a list? There is only one pair returned, so I would change <code>vector</code>'s type to be <code>.... -&gt; (t, a)</code> instead.</p>\n"}], "owner": {"reputation": 105, "user_id": 12429061, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LPeFpqCo8pQ/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pvhFkdewt5Pm1XY2MTnIgr6USr8A/mo/photo.jpg?sz=128", "display_name": "German student 99", "link": "https://stackoverflow.com/users/12429061/german-student-99"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1575968194, "creation_date": 1575933537, "question_id": 59258022, "link": "https://stackoverflow.com/questions/59258022/finding-the-biggest-value-of-key-value-list", "title": "Finding the biggest value of key-value list", "body": "<p>Hey guys I am trying to build a program where check which pair have the biggest value and returned within a list \nfor example vector <strong>[(60,3),(10,4),(5,30)] returns [(5,30)]</strong>\nThis is what I am thinking:</p>\n\n<pre><code>vector :: Ord a =&gt; [(t, a)] -&gt; [(t, a)]\nvector (x:xs) = maxTail x xs\n  where maxTail currentMax [] = currentMax\n        maxTail (m, n) (p:ps)\n          | n &lt; (snd p) = maxTail p ps\n          | otherwise   = maxTail (m, n) ps\n</code></pre>\n\n<p>the error is <strong>Couldn't match expected type</strong></p>\n"}, {"tags": ["sql", "database", "postgresql", "haskell", "cabal"], "comments": [{"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 2, "creation_date": 1575934438, "post_id": 59257901, "comment_id": 104725485, "body": "<code>postgres</code> itself needs to be installed. Also, you&#39;ll save yourself some headache if you install and manage dependencies with <code>stack</code>."}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 0, "last_activity_date": 1578340959, "creation_date": 1578340959, "answer_id": 59618241, "question_id": 59257901, "link": "https://stackoverflow.com/questions/59257901/i-cant-install-postgresql-simple-on-haskell/59618241#59618241", "title": "I can&#39;t install postgresql-simple on haskell", "body": "<p>As the comment notes, you need to have postgres already installed on your system.</p>\n"}], "owner": {"reputation": 1, "user_id": 7833673, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-F8fhX7zfde4/AAAAAAAAAAI/AAAAAAAAAag/snVmEggZk-Y/photo.jpg?sz=128", "display_name": "Hazem Essam", "link": "https://stackoverflow.com/users/7833673/hazem-essam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 160, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1578340959, "creation_date": 1575932724, "question_id": 59257901, "link": "https://stackoverflow.com/questions/59257901/i-cant-install-postgresql-simple-on-haskell", "title": "I can&#39;t install postgresql-simple on haskell", "body": "<p>When I write this command: <strong>cabal install postgres-simple</strong> or <strong>cabal install postgresql-simple</strong></p>\n\n<p>This error appears:</p>\n\n<p><strong>cabal: Error: some packages failed to install: postgresql-libpg-0.9.4.2 failed during the configure step. The exception was: ExitFailure 1\npostgresql-simple-0.6.2 depends on postgresql-libpg-0.9.4.2 which failed to install.</strong></p>\n\n<p>I tried on windows and Ubuntu, the same error appears.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 2, "creation_date": 1575924566, "post_id": 59256312, "comment_id": 104722173, "body": "<code>[Char]</code> is not efficient, and should be avoided whenever possible."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1575925679, "post_id": 59256312, "comment_id": 104722662, "body": "There are good and bad data structures along with good and bad algorithms... It all depends on your approach."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 4, "creation_date": 1575925792, "post_id": 59256312, "comment_id": 104722710, "body": "On a 64 bit machine, <code>[Char]</code> uses at least 24 bytes <i>per character!</i> Use <code>Data.Text</code>."}, {"owner": {"reputation": 3023, "user_id": 580042, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9de9c20ec2600c251befe649280678ae?s=128&d=identicon&r=PG", "display_name": "ideaboxer", "link": "https://stackoverflow.com/users/580042/ideaboxer"}, "edited": false, "score": 0, "creation_date": 1575925960, "post_id": 59256312, "comment_id": 104722783, "body": "Thanks for the suggestion to use <code>Data.Text</code>. But please also answer my question about <code>splitOn</code>."}, {"owner": {"reputation": 3023, "user_id": 580042, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9de9c20ec2600c251befe649280678ae?s=128&d=identicon&r=PG", "display_name": "ideaboxer", "link": "https://stackoverflow.com/users/580042/ideaboxer"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1575926200, "post_id": 59256312, "comment_id": 104722894, "body": "@Redu Currently my approach is as simple as possible: I am putting all records into list and create a map from that list. What would you recommend? But before trying a new approach I need to understand why the <code>splitOn</code> function seems to be the most memory-hungry function."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 5, "creation_date": 1575926824, "post_id": 59256312, "comment_id": 104723137, "body": "<code>total alloc</code> is not the memory used. It&#39;s good to keep that down, but the actual maximum memory is given by <code>+RTS -s</code> &quot;maximum residency&quot;. Total allocations is usually a measure of &quot;work,&quot; being mostly temporary objects. Anyway, seeing the actual code is a necessity here. Also, careless/automatic profiling can block significant optimizations. <code>+RTS -s</code> works without profiling, check that (after recompiling with profiling off, ofc). 100,000 lines at 1,000 chars each is still &lt;3GB in a NF <code>[Char]</code>, according to @luqui, that may or may not signify something&#39;s up."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 3, "creation_date": 1575926850, "post_id": 59256312, "comment_id": 104723156, "body": "Perhaps you should show the critical part of the code, you believe being memory hungry. That way it would also help the community to stay away from such approaches if that&#39;s the case. Once you have a solid question, I am sure someone will point out the right direction with a solid answer."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1576724247, "post_id": 59256312, "comment_id": 104994233, "body": "@luqui, yes, and that&#39;s for ASCII or so; anything else is 40 bytes."}], "answers": [{"comments": [{"owner": {"reputation": 3023, "user_id": 580042, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9de9c20ec2600c251befe649280678ae?s=128&d=identicon&r=PG", "display_name": "ideaboxer", "link": "https://stackoverflow.com/users/580042/ideaboxer"}, "edited": false, "score": 1, "creation_date": 1576059933, "post_id": 59277232, "comment_id": 104773036, "body": "Thank you for the detailed explanation.  How would you write a (more efficient than mine) program that groups records by one of its fields? I think it is a pretty common and simple task."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 3023, "user_id": 580042, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9de9c20ec2600c251befe649280678ae?s=128&d=identicon&r=PG", "display_name": "ideaboxer", "link": "https://stackoverflow.com/users/580042/ideaboxer"}, "edited": false, "score": 2, "creation_date": 1576080357, "post_id": 59277232, "comment_id": 104784472, "body": "I&#39;d probably start by looking at the <code>cassava</code> package for parsing delimited text.  It&#39;s built on top of the high-performance Attoparsec parser and has been designed with efficiency in mind.  It can parse records into <code>Vector</code>s of <code>Text</code> (or <code>Vector</code>s of <code>ByteString</code> or arbitrary algebraic data types) and should take care of most of the tricky allocation issues I mentioned above."}, {"owner": {"reputation": 3023, "user_id": 580042, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9de9c20ec2600c251befe649280678ae?s=128&d=identicon&r=PG", "display_name": "ideaboxer", "link": "https://stackoverflow.com/users/580042/ideaboxer"}, "edited": false, "score": 2, "creation_date": 1576694886, "post_id": 59277232, "comment_id": 104985806, "body": "I simply replaced <code>splitOn</code> by <code>cassava</code> and now it eats only 4 Gigabytes of memory. That is still a lot but much better than before."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 5, "last_activity_date": 1576024152, "last_edit_date": 1576024152, "creation_date": 1576023748, "answer_id": 59277232, "question_id": 59256312, "link": "https://stackoverflow.com/questions/59256312/memory-footprint-of-spliton/59277232#59277232", "title": "Memory footprint of splitOn?", "body": "<p>As I'm sure you're aware, there's not really enough information here for us to help you make your program more efficient.  It might be worth posting some (complete, self-contained) code on the <a href=\"https://codereview.stackexchange.com/\">Code Review</a> site for that.</p>\n\n<p>However, I think I can answer your specific question about why <code>splitOn</code> allocates so much memory.  In fact, there's nothing particularly special about <code>splitOn</code> or how it's been implemented.  Many straightforward Haskell functions will allocate lots of memory, and this in itself doesn't indicate that they've been poorly written or are running inefficiently.  In particular, <code>splitOn</code>'s memory usage seems similar to other straightforward approaches to splitting a string based on delimiters.</p>\n\n<p>The first thing to understand is that GHC compiled code works differently than other compiled code you're likely to have seen.  If you know a lot of C and understand stack frames and heap allocation, or if you've studied some JVM implementations, you might reasonably expect that some of that understanding would translate to GHC executables, but you'd be mostly wrong.</p>\n\n<p>A GHC program is more or less an engine for allocating heap objects, and -- with a few exceptions -- that's all it really does.  Nearly every argument passed to a function or constructor (as well as the constructor application itself) allocates a heap object of at least 16 bytes, and often more.  Take a simple function like:</p>\n\n<pre><code>fact :: Int -&gt; Int\nfact 0 = 1\nfact n = n * fact (n-1)\n</code></pre>\n\n<p>With optimization turned off, it compiles to the following so-called \"STG\" form (simplified from the actual <code>-O0 -ddump-stg</code> output):</p>\n\n<pre><code>fact = \\n -&gt; case n of I# n' -&gt; case n' of\n  0# -&gt; I# 1#\n  _ -&gt; let sat1 = let sat2 = let one = I#! 1# in n-one\n                  in fact sat2;\n       in n*sat1\n</code></pre>\n\n<p>Everywhere you see a <code>let</code>, that's a heap allocation (16+ bytes), and there are presumably more hidden in the <code>(-)</code> and <code>(*)</code> calls.  Compiling and running this program with:</p>\n\n<pre><code>main = print $ fact 1000000\n</code></pre>\n\n<p>gives:</p>\n\n<pre><code> 113,343,544 bytes allocated in the heap\n  44,309,000 bytes copied during GC\n  25,059,648 bytes maximum residency (5 sample(s))\n      29,152 bytes maximum slop\n          23 MB total memory in use (0 MB lost due to fragmentation)\n</code></pre>\n\n<p>meaning that each iteration allocates over a hundred bytes on the heap, though it's literally just performing a comparison, a subtraction, a multiplication, and a recursive call,</p>\n\n<p>This is what @HTNW meant in saying that total allocation in a GHC program is a measure of \"work\".  A GHC program that isn't allocating probably isn't doing anything (again, with some rare exceptions), and a typical GHC program that <em>is</em> doing something will usually allocate at a relatively constant rate of several gigabytes per second when it's not garbage collecting.  So, total allocation has more to do with total runtime than anything else, and it isn't a particularly good metric for assessing code efficiency.  Maximum residency is also a poor measure of overall efficiency, though it can be helpful for assessing whether or not you have a space leak, if you find that it tends to grow linearly (or worse) with the size of the input where you expect the program should run in constant memory regardless of input size.</p>\n\n<p>For most programs, the most important true <em>efficiency</em> metric in the <code>+RTS -s</code> output is probably the \"productivity\" rate at the bottom -- it's the amount of time the program spends <em>not</em> garbage collecting.  And, admittedly, your program's productivity of 48% is pretty bad, which probably means that it is, technically speaking, allocating too much memory, but it's probably only allocating two or three times the amount it should be, so, at a guess, maybe it should \"only\" be allocating around 7-8 Gigs instead of 23 Gigs for this workload (and, consequently, running for about 5 seconds instead of 15 seconds).</p>\n\n<p>With that in mind, if you consider the following simple <code>breakDelim</code> implementation:</p>\n\n<pre><code>breakDelim :: String -&gt; [String]\nbreakDelim str = case break (=='\\t') str of\n  (a,_:b) -&gt; a : breakDelim b\n  (a,[])  -&gt; [a]\n</code></pre>\n\n<p>and use it like so in a simple tab-to-comma delimited file converter:</p>\n\n<pre><code>main = interact (unlines . map (intercalate \",\" . breakDelim) . lines)\n</code></pre>\n\n<p>Then, unoptimized and run on a file with 10000 lines of 1000 3-character fields each, it allocates a whopping 17 Gigs:</p>\n\n<pre><code>  17,227,289,776 bytes allocated in the heap\n   2,807,297,584 bytes copied during GC\n         127,416 bytes maximum residency (2391 sample(s))\n          32,608 bytes maximum slop\n               0 MB total memory in use (0 MB lost due to fragmentation)\n</code></pre>\n\n<p>and profiling it places a lot of blame on <code>breakDelim</code>:</p>\n\n<pre><code>COST CENTRE MODULE    SRC                    %time %alloc\n\nmain        Main      Delim.hs:8:1-71         57.7   72.6\nbreakDelim  Main      Delim.hs:(4,1)-(6,16)   42.3   27.4\n</code></pre>\n\n<p>In this case, compiling with <code>-O2</code> doesn't make much difference.  The key efficiency metric, productivity, is only 46%.  All these results seem to be in line with what you're seeing in your program.</p>\n\n<p>The <code>split</code> package has a lot going for it, but looking through the code, it's pretty clear that little effort has been made to make it particularly efficient or fast, so it's no surprise that <code>splitOn</code> performs no better than my quick-and-dirty custom <code>breakDelim</code> function.  And, as I said before, there's nothing special about <code>splitOn</code> that makes it unusually memory hungry -- my simple <code>breakDelim</code> has similar behavior.</p>\n\n<p>With respect to inefficiencies of the <code>String</code> type, it can often be problematic.  But, it can also participate in optimizations like list fusion in ways that <code>Text</code> can't.  The utility above could be rewritten in simpler form as:</p>\n\n<pre><code>main = interact $ map (\\c -&gt; if c == '\\t' then ',' else c)\n</code></pre>\n\n<p>which uses <code>String</code> but runs pretty fast (about a quarter as fast as a naive C <code>getchar</code>/<code>putchar</code> implementation) at 84% productivity, while allocating about 5 Gigs on the heap.</p>\n\n<p>It's quite likely that if you just take your program and \"convert it to <code>Text</code>\", you'll find it's slower and more memory hungry than the original!  While <code>Text</code> has the potential to be <em>much</em> more efficient than <code>String</code>, it's a complicated package, and the way in which <code>Text</code> objects behave with respect to allocation when they're sliced and diced (as when you're chopping a big <code>Text</code> file up into little <code>Text</code> fields) makes it more difficult to get right.</p>\n\n<p>So, some take-home lessons:</p>\n\n<ul>\n<li>Total allocation is a poor measure of efficiency.  Most well written GHC programs can and should allocate several gigabytes per second of runtime.</li>\n<li>Many innocuous Haskell functions will allocate lots of memory because of the way GHC compiled code works.  This isn't necessarily a sign that there's something wrong with the function.</li>\n<li>The <code>split</code> package provides a flexible framework for all manner of cool list splitting manipulations, but it was not designed with speed in mind, and it may not be the best method of processing a tab-delimited file.</li>\n<li>The <code>String</code> data type has a potential for terrible inefficiency, but isn't <em>always</em> inefficient, and <code>Text</code> is a complicated package that won't be a plug-in replacement to fix your <code>String</code> performance woes.</li>\n</ul>\n\n<p>Most importantly:</p>\n\n<ul>\n<li>Unless your program is too slow for its intended purpose, its run-time statistics and the theoretical advantages of <code>Text</code> over <code>String</code> are largely irrelevant.</li>\n</ul>\n"}], "owner": {"reputation": 3023, "user_id": 580042, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9de9c20ec2600c251befe649280678ae?s=128&d=identicon&r=PG", "display_name": "ideaboxer", "link": "https://stackoverflow.com/users/580042/ideaboxer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 2, "answer_count": 1, "score": 3, "last_activity_date": 1576694928, "creation_date": 1575924275, "last_edit_date": 1575928119, "question_id": 59256312, "link": "https://stackoverflow.com/questions/59256312/memory-footprint-of-spliton", "title": "Memory footprint of splitOn?", "body": "<p>I wrote a file indexing program that should read thousands of text file lines as records and finally group those records by fingerprint. It uses <code>Data.List.Split.splitOn</code> to split the lines at tabs and retrieve the record fields. The program consumes 10-20 GB of memory.</p>\n\n<p>Probably there is not much I can do to reduce that huge memory footprint, but I cannot explain why a function like <code>splitOn</code> (<code>breakDelim</code>) can consume that much memory:</p>\n\n<pre><code>    Mon Dec  9 21:07 2019 Time and Allocation Profiling Report  (Final)\n\n       group +RTS -p -RTS file1 file2 -o 2 -h\n\n    total time  =        7.40 secs   (7399 ticks @ 1000 us, 1 processor)\n    total alloc = 14,324,828,696 bytes  (excludes profiling overheads)\n\nCOST CENTRE                          MODULE                    SRC                                                %time %alloc\n\nfileToPairs.linesIncludingEmptyLines ImageFileRecordParser     ImageFileRecordParser.hs:35:7-47                    25.0   33.8\nbreakDelim                           Data.List.Split.Internals src/Data/List/Split/Internals.hs:(151,1)-(156,36)   24.9   39.3\nsortAndGroup                         Aggregations              Aggregations.hs:6:1-85                              12.9    1.7\nfileToPairs                          ImageFileRecordParser     ImageFileRecordParser.hs:(33,1)-(42,14)              8.2   10.7\nmatchDelim                           Data.List.Split.Internals src/Data/List/Split/Internals.hs:(73,1)-(77,23)      7.4    0.4\nonSublist                            Data.List.Split.Internals src/Data/List/Split/Internals.hs:278:1-72            3.6    0.0\ntoHashesView                         ImageFileRecordStatistics ImageFileRecordStatistics.hs:(48,1)-(51,24)          3.0    6.3\nmain                                 Main                      group.hs:(47,1)-(89,54)                              2.9    0.4\nnumberOfUnique                       ImageFileRecord           ImageFileRecord.hs:37:1-40                           1.6    0.1\ntoHashesView.sortedLines             ImageFileRecordStatistics ImageFileRecordStatistics.hs:50:7-30                 1.4    0.1\nimageFileRecordFromFields            ImageFileRecordParser     ImageFileRecordParser.hs:(11,1)-(30,5)               1.1    0.3\ntoHashView                           ImageFileRecord           ImageFileRecord.hs:(67,1)-(69,23)                    0.7    1.7\n</code></pre>\n\n<p>Or is type <code>[Char]</code> too memory inefficient (compared to <code>Text</code>), causing <code>splitOn</code> to take that much memory?</p>\n\n<p>UPDATE 1 (<code>+RTS -s</code> suggestion of user HTNW)</p>\n\n<pre><code>  23,446,268,504 bytes allocated in the heap\n  10,753,363,408 bytes copied during GC\n   1,456,588,656 bytes maximum residency (22 sample(s))\n      29,282,936 bytes maximum slop\n            3620 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0     45646 colls,     0 par    4.055s   4.059s     0.0001s    0.0013s\n  Gen  1        22 colls,     0 par    4.034s   4.035s     0.1834s    1.1491s\n\n  INIT    time    0.000s  (  0.000s elapsed)\n  MUT     time    7.477s  (  7.475s elapsed)\n  GC      time    8.089s  (  8.094s elapsed)\n  RP      time    0.000s  (  0.000s elapsed)\n  PROF    time    0.000s  (  0.000s elapsed)\n  EXIT    time    0.114s  (  0.114s elapsed)\n  Total   time   15.687s  ( 15.683s elapsed)\n\n  %GC     time      51.6%  (51.6% elapsed)\n\n  Alloc rate    3,135,625,407 bytes per MUT second\n\n  Productivity  48.4% of total user, 48.4% of total elapsed\n</code></pre>\n\n<p>The processed text files are smaller than usual (UTF-8 encoded, 37 MB). But still 3 GB of memory are used.</p>\n\n<p>UPDATE 2 (critical part of the code)</p>\n\n<p>Explanation: <code>fileToPairs</code> processes a text file. It returns a list of key-value pairs (key: fingerprint of record, value: record).</p>\n\n<pre><code>sortAndGroup associations = Map.fromListWith (++) [(k, [v]) | (k, v) &lt;- associations]\n\nmain = do\n  CommandLineArguments{..} &lt;- cmdArgs $ CommandLineArguments {\n    ignored_paths_file = def &amp;= typFile,\n    files = def &amp;= typ \"FILES\" &amp;= args,\n    number_of_occurrences = def &amp;= name \"o\",\n    minimum_number_of_occurrences = def &amp;= name \"l\",\n    maximum_number_of_occurrences = def &amp;= name \"u\",\n    number_of_hashes = def &amp;= name \"n\",\n    having_record_errors = def &amp;= name \"e\",\n    hashes = def\n  }\n    &amp;= summary \"Group image/video files\"\n    &amp;= program \"group\"\n\n  let ignoredPathsFilenameMaybe = ignored_paths_file\n  let filenames = files\n  let hashesMaybe = hashes\n\n  ignoredPaths &lt;- case ignoredPathsFilenameMaybe of\n    Just ignoredPathsFilename -&gt; ioToLines (readFile ignoredPathsFilename)\n    _ -&gt; return []\n\n  recordPairs &lt;- mapM (fileToPairs ignoredPaths) filenames\n\n  let allRecordPairs = concat recordPairs\n  let groupMap = sortAndGroup allRecordPairs\n  let statisticsPairs = map toPair (Map.toList groupMap) where toPair item = (fst item, imageFileRecordStatisticsFromRecords . snd $ item)\n\n  let filterArguments = FilterArguments {\n    numberOfOccurrencesMaybe = number_of_occurrences,\n    minimumNumberOfOccurrencesMaybe = minimum_number_of_occurrences,\n    maximumNumberOfOccurrencesMaybe = maximum_number_of_occurrences,\n    numberOfHashesMaybe = number_of_hashes,\n    havingRecordErrorsMaybe = having_record_errors\n  }\n  let filteredPairs = filterImageRecords filterArguments statisticsPairs\n\n  let filteredMap = Map.fromList filteredPairs\n  case hashesMaybe of\n        Just True -&gt; mapM_ putStrLn (map toHashesView (map snd filteredPairs))\n        _ -&gt; Char8.putStrLn (encodePretty filteredMap)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1575918885, "post_id": 59255056, "comment_id": 104719989, "body": "This is a simple to implement functionality but it makes me wonder, what is it good for as it makes you to loose the <code>fst</code> and <code>snd</code> relationship of a tuple. You might not need a tuple to start with."}, {"owner": {"reputation": 105, "user_id": 12429061, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LPeFpqCo8pQ/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pvhFkdewt5Pm1XY2MTnIgr6USr8A/mo/photo.jpg?sz=128", "display_name": "German student 99", "link": "https://stackoverflow.com/users/12429061/german-student-99"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1575919371, "post_id": 59255056, "comment_id": 104720188, "body": "you are right I have change it , but still have problem with the the vector function I tried to use the map function but does not work to , vector xs = map boomBangs"}, {"owner": {"reputation": 1958, "user_id": 939108, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/055cba8d3eb565a817f6f7f20f936814?s=128&d=identicon&r=PG", "display_name": "Hjulle", "link": "https://stackoverflow.com/users/939108/hjulle"}, "edited": false, "score": 0, "creation_date": 1575921107, "post_id": 59255056, "comment_id": 104720839, "body": "You forgot to use the argument <code>v</code> in the function <code>vector</code>."}, {"owner": {"reputation": 1958, "user_id": 939108, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/055cba8d3eb565a817f6f7f20f936814?s=128&d=identicon&r=PG", "display_name": "Hjulle", "link": "https://stackoverflow.com/users/939108/hjulle"}, "edited": false, "score": 0, "creation_date": 1575922297, "post_id": 59255056, "comment_id": 104721318, "body": "If you add <code>{-# OPTIONS_GHC -Wall #-}</code> to the top of the file, the compiler will warn about similar issues."}, {"owner": {"reputation": 1958, "user_id": 939108, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/055cba8d3eb565a817f6f7f20f936814?s=128&d=identicon&r=PG", "display_name": "Hjulle", "link": "https://stackoverflow.com/users/939108/hjulle"}, "edited": false, "score": 0, "creation_date": 1575922412, "post_id": 59255056, "comment_id": 104721349, "body": "Also, please include the error message you get in the question next time."}], "answers": [{"tags": [], "owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "is_accepted": true, "score": 2, "last_activity_date": 1575920860, "creation_date": 1575920860, "answer_id": 59255632, "question_id": 59255056, "link": "https://stackoverflow.com/questions/59255056/function-takes-a-list-of-2-tuples-and-a-number/59255632#59255632", "title": "function takes a list of 2-Tuples and a number", "body": "<p>Did you try to compile it? The compiler gives useful errors, you should read them and also include them in your questions in the future.</p>\n\n<p>You're very close to a working answer, but you're missing a few small things.</p>\n\n<p>Your <code>boomBangs</code> function is fine (but you'll need an <code>Eq a</code> constraint as the compiler will tell you), let's look at your <code>vector</code> implementations:</p>\n\n<pre><code>vector :: Eq a =&gt; [(a,a)] -&gt; a -&gt; [a]\nvector xs v = [boomBangs tt | tt &lt;- xs]\n</code></pre>\n\n<p>Your <code>boomBangs</code> function takes TWO arguments, but you're only passing one here, you're not using your <code>v</code> function at all. We need to pass <code>v</code> into the function:</p>\n\n<pre><code>vector :: Eq a =&gt; [(a,a)] -&gt; a -&gt; [a]\nvector xs v = [boomBangs tt v | tt &lt;- xs]\n</code></pre>\n\n<p>This is closer, but the compiler tells us more:</p>\n\n<pre><code>    \u2022 Occurs check: cannot construct the infinite type: a ~ [a]\n</code></pre>\n\n<p>This is saying that it's expecting an <code>a</code>, but got an <code>[a]</code> instead. Our <code>boomBangs</code> function returns a list, and the list comprehension embeds all the results in a list, so our expression is actually of type <code>[[a]]</code> when all is said and done. We need to flatten it out. There's a function for that: <code>concat :: [[a]] -&gt; [a]</code></p>\n\n<pre><code>vector :: Eq a =&gt; [(a,a)] -&gt; a -&gt; [a]\nvector xs v = concat [boomBangs tt v | tt &lt;- xs]\n</code></pre>\n\n<p>This compiles and should work as you expect.</p>\n\n<p>Your map version is also close, but you're again forgetting to apply all your arguments, you've only bound one of them (which you don't ever use!) and the other argument is being passed via point-free style (try not to mix the two styles).</p>\n\n<p>Here's how we can fix it up:</p>\n\n<pre><code>vector' :: Eq a =&gt; [(a, a)] -&gt; a -&gt; [a]\nvector' xs v = concat (map (flip boomBangs v) xs)\n</code></pre>\n\n<p>The flip is a little annoying, we can fix that by flipping the arguments to our original <code>boomBangs</code> function:</p>\n\n<pre><code>boomBangs :: Eq a =&gt;  a -&gt; (a, a) -&gt; [a]\n</code></pre>\n\n<p>This allows us to write:</p>\n\n<pre><code>vector' :: Eq a =&gt; [(a, a)] -&gt; a -&gt; [a]\nvector' xs v = concat (map (boomBangs v) xs)\n</code></pre>\n\n<p>If you prefer to simplify to point-free, we can flip the args to this function too:</p>\n\n<pre><code>vector' :: Eq a =&gt; a -&gt; [(a, a)] -&gt; [a]\nvector' v = concat . (map (boomBangs v))\n</code></pre>\n\n<p>And we can use <code>concatMap</code> which combines concat and map into one function:</p>\n\n<pre><code>vector' :: Eq a =&gt; a -&gt; [(a, a)] -&gt; [a]\nvector' v = concatMap (boomBangs v)\n</code></pre>\n\n<p>Cheers!</p>\n"}], "owner": {"reputation": 105, "user_id": 12429061, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LPeFpqCo8pQ/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pvhFkdewt5Pm1XY2MTnIgr6USr8A/mo/photo.jpg?sz=128", "display_name": "German student 99", "link": "https://stackoverflow.com/users/12429061/german-student-99"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 59255632, "answer_count": 1, "score": 0, "last_activity_date": 1575920860, "creation_date": 1575918018, "last_edit_date": 1575919423, "question_id": 59255056, "link": "https://stackoverflow.com/questions/59255056/function-takes-a-list-of-2-tuples-and-a-number", "title": "function takes a list of 2-Tuples and a number", "body": "<p>So.. I am trying to build a program that takes a list of 2-tuples and a number and check if the number equal one of the elements of the tuple, if it equal the first element then it return the last one and if it equal the last one it return the first one. </p>\n\n<p>**\nfor example <strong>[(5,4), (9,3) ,(4,2)] 4</strong> \n it returns [5,2]\n** </p>\n\n<p>Here is what I am thinking : </p>\n\n<pre><code>boomBangs :: (a, a) -&gt; a -&gt; [a]\nboomBangs tt t = if snd tt == t then [fst tt] \nelse if fst tt == t then [snd tt] else []\n\n</code></pre>\n\n<p>so the function takes a Tuple and a number, it check if the first element equal to the number if so it return the second element as a list if not it check if the second element equal the number if so it return the first element as list.</p>\n\n<p>now I tried to code the main function as I described above, </p>\n\n<pre><code>vector :: [(a,a)] -&gt; a -&gt; [a]\nvector xs v = [boomBangs tt | tt &lt;- xs]\n\n</code></pre>\n\n<p>I tied with function map but also not working </p>\n\n<pre><code>vector :: [(a, a)] -&gt; a -&gt; [a]\nvector xs = map boomBangs\n\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1575911623, "post_id": 59253414, "comment_id": 104716954, "body": "Worth noting that you can just write <code>listOfLists = map pairToList</code>"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1575912641, "last_edit_date": 1575912641, "creation_date": 1575911019, "answer_id": 59253475, "question_id": 59253414, "link": "https://stackoverflow.com/questions/59253414/convert-list-of-tupel-into-list-of-lists/59253475#59253475", "title": "convert list of Tupel into list of lists", "body": "<p>In the second attempt,</p>\n\n<pre><code>listoflists xs = [pairToList (a, a) | (a,a) &lt;- xs]\n</code></pre>\n\n<p>the part <code>(a,a) &lt;- xs</code> is illegal, since it tries to define variable <code>a</code> mutliple times. For instance, if <code>xs = [(1,2)]</code> then the generator <code>(a,a) &lt;- [(1,2)]</code> would define <code>a</code> as <code>1</code> and <code>2</code> at the same time which makes no sense.</p>\n\n<p>You need to use different variables, e.g. <code>(a1,a2) &lt;- xs</code>.</p>\n\n<hr>\n\n<p>In the first attempt,</p>\n\n<pre><code>listoflists xs = [pairToList (a, a) | a &lt;- xs]\n</code></pre>\n\n<p><code>a</code> represents a generic pair taken from <code>xs</code>. Because of that <code>(a,a)</code> will be a pair-of-pairs. Hence, <code>pairToList (a,a)</code> will produce a list-of-pairs, which is not what you wanted. You could fix this by directly calling <code>pairToList a</code> instead.</p>\n"}], "owner": {"reputation": 105, "user_id": 12429061, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LPeFpqCo8pQ/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pvhFkdewt5Pm1XY2MTnIgr6USr8A/mo/photo.jpg?sz=128", "display_name": "German student 99", "link": "https://stackoverflow.com/users/12429061/german-student-99"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 59253475, "answer_count": 1, "score": 0, "last_activity_date": 1575912641, "creation_date": 1575910786, "question_id": 59253414, "link": "https://stackoverflow.com/questions/59253414/convert-list-of-tupel-into-list-of-lists", "title": "convert list of Tupel into list of lists", "body": "<p>Hey guys I want to be able to change a list of  tuple in a list of lists . Here is what I am thinking: </p>\n\n<pre><code>pairToList :: (a, a) -&gt; [a]\npairToList (x,y) = [x,y]\n\nlistoflists :: [(a, a)] -&gt; [[a]]\nlistoflists xs = [pairToList (a, a) | a &lt;- xs]\n</code></pre>\n\n<p>The first function works perfectly which is change Tupels into list but the second one doesn't not work, I tried to write it like that. </p>\n\n<pre><code>listoflists :: [(a, a)] -&gt; [[a]]\nlistoflists xs = [pairToList (a, a) | (a,a) &lt;- xs]\n</code></pre>\n\n<p>I am new with using comprehension of lists that contain Tuples. </p>\n"}, {"tags": ["haskell", "types", "lambda-calculus", "higher-kinded-types", "type-theory"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1575917836, "post_id": 59253278, "comment_id": 104719586, "body": "I&#39;m not sure I see the issue with mu unfolding to an abstraction. In the first example <code>List</code> should unfold to <code>Cons A ((\u03bc ...) A) | Nil</code>, not <code>Cons A (\u03bc ...) | Nil</code> (i.e., the \u03bc should be applied to an A). Could that be the source of confusion? It definitely makes type checking difficult, but that doesn&#39;t seem to be a concern for you, is it?"}, {"owner": {"reputation": 156, "user_id": 6780481, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mtRgV.jpg?s=128&g=1", "display_name": "crunch", "link": "https://stackoverflow.com/users/6780481/crunch"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1575927520, "post_id": 59253278, "comment_id": 104723457, "body": "That is just a typo when I translated it from code, thanks for catching it."}], "answers": [{"comments": [{"owner": {"reputation": 156, "user_id": 6780481, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mtRgV.jpg?s=128&g=1", "display_name": "crunch", "link": "https://stackoverflow.com/users/6780481/crunch"}, "edited": false, "score": 0, "creation_date": 1575927139, "post_id": 59256087, "comment_id": 104723307, "body": "Ah, that&#39;s a typo, thanks for catching it. I promise I understand how the substitution works, and have it working in code :)."}, {"owner": {"reputation": 156, "user_id": 6780481, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mtRgV.jpg?s=128&g=1", "display_name": "crunch", "link": "https://stackoverflow.com/users/6780481/crunch"}, "edited": false, "score": 0, "creation_date": 1575927495, "post_id": 59256087, "comment_id": 104723449, "body": "Even with the correct substitution there, it is not well formed, because you cannot apply a recursive type to a concrete type, only a type abstraction.   Let&#39;s apply <code>Nat</code> to our properly substituted <code>List</code> type: <code>List = Cons Nat ((\u03bc \u039bX. \u039bA. Cons A (X A) | Nil) Nat) | Nil</code>. Nat cannot be substituted into the inner occurences of A, and as such we will have to store <code>Nat</code> somewhere so we apply it next time we need to fold."}, {"owner": {"reputation": 156, "user_id": 6780481, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mtRgV.jpg?s=128&g=1", "display_name": "crunch", "link": "https://stackoverflow.com/users/6780481/crunch"}, "edited": false, "score": 0, "creation_date": 1575928838, "post_id": 59256087, "comment_id": 104723937, "body": "I believe that even if you were to modify the typing rules so that you can perform the unfolding isomorphism during type checking (so that you could evaluate <code>(\u03bc \u039bX. \u039bA. Cons A (X A) | Nil) Nat</code>), you would end up in an infinite loop, since you are continually introducing a new type abstraction <code>\u039bA.</code>. Is this not correct?"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 156, "user_id": 6780481, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mtRgV.jpg?s=128&g=1", "display_name": "crunch", "link": "https://stackoverflow.com/users/6780481/crunch"}, "edited": false, "score": 0, "creation_date": 1575934511, "post_id": 59256087, "comment_id": 104725509, "body": "Why would you need to substitute <code>Nat</code> in? Just leave the application and let the type of the folding operator deal with it. <code>fold1_F_A :: F (\u03bc F) A -&gt; \u03bc F A</code>, and, in particular, <code>fold1_(\u039bX. \u039bA. Cons A (X A) | Nil)_Nat :: (Cons Nat ((\u03bc \u039bX. \u039bA. Cons A (X A) | Nil) Nat) | Nil) -&gt; ((\u03bc \u039bX. \u039bA. Cons A (X A) | Nil) Nat)</code>."}, {"owner": {"reputation": 156, "user_id": 6780481, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mtRgV.jpg?s=128&g=1", "display_name": "crunch", "link": "https://stackoverflow.com/users/6780481/crunch"}, "edited": false, "score": 0, "creation_date": 1576203884, "post_id": 59256087, "comment_id": 104832088, "body": "Thanks. I had thought that was another route. Andreas Abel&#39;s PhD thesis &quot;A   Polymorphic Lambda-Calculus with Sized Higher-Order Types&quot; covers this to some extent as well, sections 3.5 &amp; 4. I think the route you describe (and what the diss. also describes) is what I will likely end up using."}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 4, "last_activity_date": 1575923212, "creation_date": 1575923212, "answer_id": 59256087, "question_id": 59253278, "link": "https://stackoverflow.com/questions/59253278/implementing-nested-recursive-datatypes-in-the-presence-of-type-operators/59256087#59256087", "title": "Implementing nested/recursive datatypes in the presence of type operators", "body": "<pre><code>List = \u03bc \u039bX. \u039bA. Cons A (X A) | Nil\n-- \u03bcF unfolds to F(\u03bcF)\n= (\u039bX. \u039bA. Cons A (X A) | Nil) (\u03bc \u039bX. \u039bA. Cons A (X A) | Nil)\n-- substitute *correctly*\n= \u039bA. Cons A ((\u03bc \u039bX. \u039bA. Cons A (X A) | Nil) A) | Nil\n--                                           ^ you dropped this!\n-- folding back\nList = \u039bA. Cons A (List A) | Nil\n</code></pre>\n\n<p>The <code>A</code> does not need to be \"stored\" anywhere except the type itself. You dropped the application containing it when it should not have been dropped. Notice that your unfolding is ill-kinded. The second field of the top-level <code>Cons</code> has kind <code>* =&gt; *</code>, but that's not right. But the original was well-kinded, so the unfolding (which should preserve kinds) must have gone wrong.</p>\n\n<p>\"Lambda dropping\" is fine, but it's not always possible. Consider</p>\n\n<pre><code>data Binary a = Leaf a | Branch (Binary (a, a))\n</code></pre>\n\n<p>which contains precisely <code>2^n</code> <code>a</code>s for some natural <code>n</code>. This type is irregularly recursive and cannot be expressed in terms of <code>\u03bc :: (* =&gt; *) =&gt; *</code> as <code>List</code> can.</p>\n\n<pre><code>type Binary = \u03bc \u039bX. \u039bA. Leaf A | Branch (X (A, A))\n</code></pre>\n"}], "owner": {"reputation": 156, "user_id": 6780481, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mtRgV.jpg?s=128&g=1", "display_name": "crunch", "link": "https://stackoverflow.com/users/6780481/crunch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 2, "accepted_answer_id": 59256087, "answer_count": 1, "score": 4, "last_activity_date": 1575927538, "creation_date": 1575910160, "last_edit_date": 1575927538, "question_id": 59253278, "link": "https://stackoverflow.com/questions/59253278/implementing-nested-recursive-datatypes-in-the-presence-of-type-operators", "title": "Implementing nested/recursive datatypes in the presence of type operators", "body": "<p>I've been working on my implementation of System F-omega in Rust following Pierce's <em>Types and Programming Languages</em>, and I'm looking for guidance on adding recursive types to my implementation using iso-recursive <code>fold</code>/<code>unfold</code> operators. I have already added in sum, product, record, existential, and universal types.</p>\n\n<p>In System F (w/o type operators), I found it relatively straightforward to do, and I just had a visitor pass through the AST after parsing to perform the fold/unfold isomorphism during case analysis or type construction.</p>\n\n<p>With System F omega, the situation is somewhat more complicated due to the presence of lambda abstractions at the type level. For example (using standard lambda-calc/haskell-ish syntax), lets say I want to define a parameterized <code>List</code> datatype</p>\n\n<pre><code>datatype List a = Cons a (List a) | Nil\n</code></pre>\n\n<p>This can be encoded in our calculi as (omitting * kinds):</p>\n\n<pre><code>type List = \u03bc \u039bX::*=&gt;*. \u039bA. Cons A (X A) | Nil\nsubsts to: \u039bA. Cons A ((\u03bc \u039bX::*=&gt;*. \u039bA. Cons A (X A) | Nil) A) | Nil\n</code></pre>\n\n<p>But this has issues as soon as we try to unfold the value, since a new abstraction trying to bind <code>A</code> again is introduced. This seems like it could work, as long as we are storing the concrete type A somewhere. </p>\n\n<p>Or we can 'lambda drop' it to:</p>\n\n<pre><code>type ListF = \u039bX. \u039bA. Cons (A, X) | Nil\ntype List  = \u039bA. \u03bc (ListF A)\n</code></pre>\n\n<p>The lambda dropping works well for simple recursive types like this, and is straightforward to implement as well, and I can envision a way to automatically generate the <code>ListF</code> type. But I have a nagging feeling that something is off about this.</p>\n\n<p>I have been trying to read the literature around this (Mendler-style iteration, Andreas Abel, Ralph Matthes, Tarmo Uustalu, \"Iteration and coiteration schemes for higher-order and nested datatypes\", etc), but tbh some of it is a bit over my head, and I'm lost as to how to <em>actually</em> implement this in a concrete manner. Any advice would be greatly appreciated</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1575878214, "post_id": 59242365, "comment_id": 104699526, "body": "You never need do. In fact <code>do</code> is just syntactical sugar."}], "answers": [{"tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 18, "last_activity_date": 1575875795, "last_edit_date": 1575875795, "creation_date": 1575866099, "answer_id": 59242592, "question_id": 59242365, "link": "https://stackoverflow.com/questions/59242365/when-we-should-use-do/59242592#59242592", "title": "When we should use do?", "body": "<p><strong>Short answer:</strong> line breaks don't mean \"next statement\" in Haskell, like they do in many mainstream languages, like Python, Ruby, and recently even JavaScript.</p>\n\n<hr>\n\n<p><strong>Long answer</strong></p>\n\n<p>First, let's get rid of the <code>if</code>. It only clouds the issue:</p>\n\n<pre><code>countdown1 :: Int -&gt; IO ()\ncountdown1 x = putStrLn (show x)\n\ncountdown2 :: Int -&gt; IO ()\ncountdown2 x = putStrLn (show x)\n               countdown (x-1)\n</code></pre>\n\n<p>Notice that the type of your function is <code>IO ()</code>. That's the type of what the function must ultimately calculate. Or \"produce\", if you will. This means that whatever is on the right of the equality sign must be of type <code>IO ()</code>.</p>\n\n<pre><code>countdown x = .........\n              ^       ^\n              +-------+\n                  \\\n                   the type of whatever is here must be `IO ()`\n</code></pre>\n\n<p>The first version, <code>countdown1</code>, does satisfy this, because the expression <code>putStrLn (show x)</code> is, indeed, of type <code>IO ()</code></p>\n\n<p>The second version, <code>countdown2</code>, on the other hand, looks very strange to the compiler. It looks like you're trying to call <code>putStrLn</code>, and you're trying to pass it three parameters: <code>(show x)</code>, <code>countdown</code>, and <code>(x-1)</code>. </p>\n\n<p>Don't let the newline between <code>(show x)</code> and <code>countdown</code> confuse you: as mentioned above, newlines don't mean \"next statement\" in Haskell. This is because in Haskell there is no such thing as a \"statement\" in the first place. Everything is an expression.</p>\n\n<p>But wait! If newlines don't count as \"next statement\", then how the hell do I tell Haskell to perform several actions in order? Like, for example, first do <code>putStrLn</code>, and then do <code>countdown</code>?</p>\n\n<p>Well, this is where monads come in. Monads (of which <code>IO</code> is a prime example) were specifically brought into Haskell for this very reason: to express order of things. And the primary operation for that is <em>\"bind\"</em>, which in Haskell exists in the form of an operator <code>&gt;&gt;=</code>. This operator takes a monadic value (such as <code>IO Int</code> or <code>IO ()</code>) on the left, and takes a function that returns a monadic value (such as <code>Int -&gt; IO String</code>) on the right, and \"glues\" them together. The result is a new monadic action, which consists of the two input actions executed one after the other.</p>\n\n<p>Applying this to your example with <code>putStrLn</code> and <code>countdown</code>, it would look like this:</p>\n\n<pre><code>putStrLn (show x) &gt;&gt;= (\\y -&gt; countdown (x-1))\n^               ^     ^                     ^\n+---------------+     +---------------------+\n    \\                        \\\n     first monadic value      a function that takes the result of the\n                              first action as parameter and returns\n                              the second action\n</code></pre>\n\n<p>But this is a bit inconvenient. Sure, you can glue together two actions, maybe even three. But after a while this becomes very messy. (at first I had an example here, but then decided to do without; just trust me: it does get messy)</p>\n\n<p>So to relieve the mess, the language now offers syntactic sugar in the form of the <code>do</code> notation. Inside the <code>do</code> notation, newline <em>does</em>, in fact, mean \"next statement\", and these consecutive \"statements\" get desugared into a sequence of calls to the <code>&gt;&gt;=</code> operator, giving them the semantics of \"executing in order\". Something like this:</p>\n\n<pre><code>do\n  y &lt;- f x\n  z &lt;- h y            ====&gt;      f x &gt;&gt;= (\\y -&gt; h y &gt;&gt;= (\\z -&gt; g x y z))\n  g x y z\n</code></pre>\n\n<p>So to the naked eye the <code>do</code> notation does look roughly equivalent to multiple-line program in Python, Ruby, or JavaScript. But underneath it all, it's still a pure functional program, where everything is an expression, and the order of (non-pure, effectful) operations is explicitly controlled.</p>\n\n<hr>\n\n<p>So, to summarize: you need to use <code>do</code> in your program to express the order - first <code>putStrLn</code>, and then <code>countdown</code>:</p>\n\n<pre><code>countdown :: Int -&gt; IO ()\ncountdown x = if x &lt;= 0 \n              then putStrLn \"The End.\"\n              else do\n                     putStrLn (show (x)) \n                     countdown (x-1)\n</code></pre>\n\n<p>But you <em>don't</em> need to use <code>do</code> when there is just one operation, so there is no order to speak of.</p>\n\n<p>And if you don't want to use <code>do</code> for whatever reason, you can desugar it manually into the equivalent <code>&gt;&gt;=</code> call:</p>\n\n<pre><code>countdown :: Int -&gt; IO ()\ncountdown x = if x &lt;= 0 \n              then putStrLn \"The End.\"\n              else putStrLn (show (x)) &gt;&gt;= \\_ -&gt; countdown (x-1)\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 7180149, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-gY7w4P7PhUk/AAAAAAAAAAI/AAAAAAAAABM/zvnUk_iNJGQ/photo.jpg?sz=128", "display_name": "chen Crush", "link": "https://stackoverflow.com/users/7180149/chen-crush"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 1, "accepted_answer_id": 59242592, "answer_count": 1, "score": 1, "last_activity_date": 1575875795, "creation_date": 1575864081, "question_id": 59242365, "link": "https://stackoverflow.com/questions/59242365/when-we-should-use-do", "title": "When we should use do?", "body": "<p>Sometimes the program shows an error if I don't use do. But it runs well without do sometimes. \nex:</p>\n\n<pre><code>countdown ::Int -&gt; IO ()\ncountdown x =  if x &lt;= 0 \n               then putStrLn \"The End.\"\n               else putStrLn (show (x))\n</code></pre>\n\n<p>runs well \nBut </p>\n\n<pre><code>countdown ::Int -&gt; IO ()\ncountdown x =  if x &lt;= 0 \n               then putStrLn \"The End.\"\n               else putStrLn (show (x)) \n                    countdown (x-1)\n</code></pre>\n\n<p>shows error</p>\n"}, {"tags": ["haskell", "monads", "state-monad", "either"], "comments": [{"owner": {"reputation": 3127, "user_id": 7096763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c1843972ea822c36c0c024d2ddcc8d7?s=128&d=identicon&r=PG&f=1", "display_name": "MikaelF", "link": "https://stackoverflow.com/users/7096763/mikaelf"}, "edited": false, "score": 2, "creation_date": 1575859927, "post_id": 59241631, "comment_id": 104695026, "body": "What you need is a monad transformer. Look into StateT and EitherT from the <a href=\"http://hackage.haskell.org/package/mtl\" rel=\"nofollow noreferrer\">mtl</a> package."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1575921207, "post_id": 59242560, "comment_id": 104720890, "body": "Stacking them the other way is reasonable too; which is better depends on context."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1575923276, "post_id": 59242560, "comment_id": 104721669, "body": "@dfeuer I did say that, but OP&#39;s attempt seems to imply they want to recover the <code>Machine</code> on failure."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1575926584, "post_id": 59242560, "comment_id": 104723033, "body": "Sorry, I missed that."}, {"owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "edited": false, "score": 0, "creation_date": 1576875992, "post_id": 59242560, "comment_id": 105048591, "body": "Thanks! The <code>State Machine (Either String a)</code> type gave me the clue I needed to make the hybrid monad&#39;s <code>(&gt;&gt;=)</code> from scratch and the talk about monad transformers is a nice preview of them."}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 5, "last_activity_date": 1575865843, "creation_date": 1575865843, "answer_id": 59242560, "question_id": 59241631, "link": "https://stackoverflow.com/questions/59241631/is-it-possible-to-have-a-state-either-hybrid-monad/59242560#59242560", "title": "Is it possible to have a state-either hybrid monad?", "body": "<p>The combined monad should look like this:</p>\n\n<pre><code>newtype Interpreter a\n  = Interpreter { runInterpreter :: Machine -&gt; (Machine, Either String a) }\n</code></pre>\n\n<p>It takes a state, the <code>Machine</code>, returns a modified state, and returns either success or failure.</p>\n\n<pre><code>deriving instance Functor Interpreter\ninstance Monad Interpreter where\n    return x = _exercise\n    Interpreter x &gt;&gt;= f = _exercise\ninstance Applicative Interpreter where pure = return; (&lt;*&gt;) = ap\nliftEither :: Either String a -&gt; Interpreter a\nliftState :: State Machine a -&gt; Interpreter a\n</code></pre>\n\n<p>In general, to put monads together, you put one \"inside\" the other:</p>\n\n<pre><code>Interpreter a &lt;~&gt; State Machine (Either String a)\n</code></pre>\n\n<p>You could do it another way, <code>s -&gt; Either String (s, a)</code>, but then you don't get the state back on error. (Note that <code>Either String (State Machine a)</code> does not work: whether or not you fail would not be allowed to depend on the state. It's only an <code>Applicative</code>.)</p>\n\n<p>You do not have to write the <code>Monad Interpreter</code> instance yourself. The <a href=\"https://hackage.haskell.org/package/transformers-0.5.6.2\" rel=\"noreferrer\"><code>transformers</code></a> package (shipped with GHC) provides \"monad transformers\" for constructing monads compositionally. A monad transformer is a <code>T :: (Type -&gt; Type) -&gt; (Type -&gt; Type)</code> that takes a monad as argument and returns a new monad.</p>\n\n<pre><code>type Interpreter = <a href=\"https://hackage.haskell.org/package/transformers-0.5.6.2/docs/Control-Monad-Trans-Except.html#t:ExceptT\" rel=\"noreferrer\">ExceptT</a> String (<a href=\"https://hackage.haskell.org/package/transformers-0.5.6.2/docs/Control-Monad-Trans-State-Lazy.html#t:State\" rel=\"noreferrer\">State</a> Machine)\nliftEither = <a href=\"https://hackage.haskell.org/package/transformers-0.5.6.2/docs/Control-Monad-Trans-Except.html#v:except\" rel=\"noreferrer\">except</a>\nliftState = <a href=\"https://hackage.haskell.org/package/transformers-0.5.6.2/docs/Control-Monad-Trans-Class.html#v:lift\" rel=\"noreferrer\">lift</a></code></pre>\n\n<p><code>ExceptT String</code> is a monad transformer, and <code>State Machine</code> is a monad, so <code>Interpreter = ExceptT String (State Machine)</code> is also a monad. The other way I mentioned before would be <code>StateT Machine (Either String)</code>.</p>\n\n<p>The next step is to use the <a href=\"https://hackage.haskell.org/package/mtl-2.2.2\" rel=\"noreferrer\"><code>mtl</code></a>. This library provides classes on top of the <code>transformer</code> types such that monad-specific actions like <code>throwError</code> and <code>get</code> are overloaded to automatically lift themselves through as many monad transformers as needed. With the <code>mtl</code>, you can leave your own functions polymorphic in the monad stack:</p>\n\n<pre><code>checkedAddress :: MonadExcept String m => Integer -> m Int\ncheckedAddress n = do\n  -- you don't need to branch, failure short-circuits!\n  when (n &lt; toInteger (minBound :: Int)) $ <a href=\"https://hackage.haskell.org/package/mtl-2.2.2/docs/Control-Monad-Except.html#v:throwError\" rel=\"noreferrer\">throwError</a> _\n  when (n &gt; toInteger (maxBound :: Int)) $ throwError _\n  pure (fromInteger n)\n\nsetInstructionPointer :: MonadState Machine m => Int -> m ()\nsetInstructionPointer ip = <a href=\"https://hackage.haskell.org/package/mtl-2.2.2/docs/Control-Monad-State-Lazy.html#v:modify\" rel=\"noreferrer\">modify</a> \\(Machine _ mem) -> (Machine ip mem)\n\ngetInstructionPointer :: MonadState Machine m => m Int\ngetInstructionPointer = <a href=\"https://hackage.haskell.org/package/mtl-2.2.2/docs/Control-Monad-State-Lazy.html#v:gets\" rel=\"noreferrer\">gets</a> \\(Machine i _) -> i\n\n-- combined:\ncheckedOffsetJump :: (MonadState Machine m, MonadExcept String m) => Integer -> m ()\ncheckedOffsetJump off = setInstructionPointer =&lt;&lt; checkedAddress =&lt;&lt; (off +) &lt;$> toInteger &lt;$> getInstructionPointer\n-- read: setInstructionPointer(checkedAddress(off + toInteger(getInstructionPointer())))\n</code></pre>\n\n<p>And you can nail them down later, usually at the very end:</p>\n\n<pre><code><a href=\"https://hackage.haskell.org/package/transformers-0.5.6.2/docs/Control-Monad-Trans-State-Lazy.html#v:runState\" rel=\"noreferrer\">runState</a> $ <a href=\"https://hackage.haskell.org/package/transformers-0.5.6.2/docs/Control-Monad-Trans-Except.html#v:runExceptT\" rel=\"noreferrer\">runExceptT</a> $ checkedOffsetJump 0x8000 :: Machine -> (Either String (), Machine)</code></pre>\n"}], "owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 1, "accepted_answer_id": 59242560, "answer_count": 1, "score": 3, "last_activity_date": 1575865843, "creation_date": 1575856713, "question_id": 59241631, "link": "https://stackoverflow.com/questions/59241631/is-it-possible-to-have-a-state-either-hybrid-monad", "title": "Is it possible to have a state-either hybrid monad?", "body": "<h2>Goal</h2>\n\n<p>I'm trying to write the internals of an interpreter, and, for ergonomics purposes, I think I want to have a monad that works like both the state and either monads.</p>\n\n<p>For example, I'd like to do some things with either style:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>checkedAddress :: Integer -&gt; Interpreter Int\ncheckedAddress n = if (n &lt; toInteger (minBound :: Int))\n                      then fail $ \"Address \" ++ show n ++ \" is too low\"\n                   else if (n &gt; toInteger (maxBound :: Int))\n                      then fail $ \"Address \" ++ show n ++ \" is too high\"\n                   else return $ fromInteger n\n</code></pre>\n\n<p>I'd like to do other things with state style:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>setInstructionPointer :: Int -&gt; Interpreter ()\nsetInstructionPointer ip (Machine _ mem) = ((), Machine ip mem)\n\ngetInstructionPointer :: Interpreter Int\ngetInstructionPointer m@(Machine ip mem) = (ip, m)\n</code></pre>\n\n<h2>Questions</h2>\n\n<p>Is it possible to create a state-either hybrid monad like this?</p>\n\n<p>If it's impossible, why is it impossible? Is there an alternative that has the nice ergonomics and, I assume, efficiency of early termination of (like either stops further processing through <code>Left m &gt;&gt;= _ = Left m</code>) this approach?</p>\n\n<p>If it's possible, how do I write the monad instance for the type? I tried, but I got stuck when writing <code>(&gt;&gt;=)</code> because I can't see a way to know what constructor to produce without knowing the runtime <code>Machine</code> value.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Interpreter a = Running      (Machine -&gt; (a, Machine))\n                   | Halted       (Machine -&gt; Machine)\n                   | Error String (Machine -&gt; Machine)\n\ninstance Monad Interpreter where\n  return = Running . (,)\n  Running f     &gt;&gt;= g = DontKnowWhich $ \\ m -&gt; let (a, m') = f m\n                                               in  case g a of\n                                                        Running h -&gt;\n                                                        Halted  h -&gt;\n                                                        Error s h -&gt;\n  h@(Halted  _) &gt;&gt;= _ = h\n  e@(Error _ _) &gt;&gt;= _ = e\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 1047, "user_id": 1146183, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d5152bd68f7c09d1c3172874b3ce2150?s=128&d=identicon&r=PG", "display_name": "Marcus Buffett", "link": "https://stackoverflow.com/users/1146183/marcus-buffett"}, "is_accepted": false, "score": 0, "last_activity_date": 1575830301, "creation_date": 1575830301, "answer_id": 59238676, "question_id": 59238675, "link": "https://stackoverflow.com/questions/59238675/how-to-create-a-col-datatype-in-selda/59238676#59238676", "title": "How to create a Col datatype in selda?", "body": "<p>Hoogle was really helpful here, when I realized I have a <code>Text</code> but needed a <code>Col s Text</code>, hoogling <code>Text -&gt; Col s Text</code> gave me the <code>text</code> function from Selda. So all I had to change was:</p>\n\n<pre><code>  restrict ((book ! #title) `like` S.text (T.pack $ \"%\" ++ t ++ \"%\"))\n</code></pre>\n\n<p>where S is a qualified import of <code>Database.Selda</code>.</p>\n"}], "owner": {"reputation": 1047, "user_id": 1146183, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d5152bd68f7c09d1c3172874b3ce2150?s=128&d=identicon&r=PG", "display_name": "Marcus Buffett", "link": "https://stackoverflow.com/users/1146183/marcus-buffett"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 30, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1575830301, "creation_date": 1575830301, "question_id": 59238675, "link": "https://stackoverflow.com/questions/59238675/how-to-create-a-col-datatype-in-selda", "title": "How to create a Col datatype in selda?", "body": "<p>I'm trying to write a function that does a <code>LIKE</code> sql query based on a parameter. I'm using Selda. I had this working before parameterizing the function:</p>\n\n<pre><code>selectBookQuery :: Query s (Row s GoodreadsBook)\nselectBookQuery = do\n  book &lt;- select goodreadsBooks\n  restrict ((book ! #title) `like` (\"%Wheel of Time%\"))\n  return book\n\n</code></pre>\n\n<p>But, when I try to use the <code>t</code> param, like this:</p>\n\n<pre><code>selectBookQuery :: String -&gt; Query s (Row s GoodreadsBook)\nselectBookQuery t = do\n  book &lt;- select goodreadsBooks\n  restrict ((book ! #title) `like` (T.pack $ \"%\" ++ t ++ \"%\"))\n  return book\n</code></pre>\n\n<p>I get this error:</p>\n\n<pre><code>Couldn't match expected type \u2018Col s Text\u2019 with actual type \u2018Text\u2019\n</code></pre>\n\n<p>I think I have a rough idea of what's happening. The string literal that I'm using in the first example is being coerced through the magic of <code>OverloadedStrings</code> to a <code>Col s Text</code>, whereas once I make it a <code>Text</code> or <code>String</code>, it doesn't get coerced into a <code>Col s Text</code>.</p>\n"}, {"tags": ["haskell", "monads", "haskell-platform"], "comments": [{"owner": {"reputation": 641, "user_id": 2225804, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a53685c74f66320af0e7270a90022dca?s=128&d=identicon&r=PG", "display_name": "user2225804", "link": "https://stackoverflow.com/users/2225804/user2225804"}, "edited": false, "score": 0, "creation_date": 1575814904, "post_id": 59236163, "comment_id": 104684256, "body": "It will make it easier for others to answer if you provide the compiler output showing the failure rather than just saying it doesn&#39;t compile."}], "answers": [{"tags": [], "owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "is_accepted": false, "score": 2, "last_activity_date": 1575814208, "creation_date": 1575814208, "answer_id": 59236224, "question_id": 59236163, "link": "https://stackoverflow.com/questions/59236163/print-regards-following-functions-as-arguments/59236224#59236224", "title": "print regards following functions as arguments", "body": "<p>You need a <code>do</code> block in order to sequence <code>IO</code> actions*</p>\n\n<p>Try this instead:</p>\n\n<pre><code>func 0 = putSentence \"Sample Text.\"\nfunc x = if 3 == x\n            then do\n               putSentence \"Three.\"\n               func (x-1)\n            else do\n               putSentence \"Not three.\"\n               func (x-1)\n</code></pre>\n\n<p>*that's not strictly speaking true, as <code>do</code> blocks are just syntactic sugar for monadic functions, mainly the <code>(&gt;&gt;=)</code> operator. But <code>do</code> notation is often the easiest and most readable way, and certainly the easiest one to understand when you're first learning.</p>\n\n<p>For a greater understanding of doing simple intput and output in Haskell, I would recommend the following <a href=\"http://learnyouahaskell.com/input-and-output\" rel=\"nofollow noreferrer\">chapter</a> of the excellent Learn You a Haskell. Indeed I would recommend the entire book.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user12500336"}, "edited": false, "score": 0, "creation_date": 1575814579, "post_id": 59236229, "comment_id": 104684168, "body": "This works wonderfully. I was sure I already tried making them into a do block, but maybe I messed up the formatting. Thanks alot!"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1575814806, "post_id": 59236229, "comment_id": 104684226, "body": "@NinjaNinjaNinja Indentation matters after <code>do</code>: every action-line must start exactly on the same indentation level. (Instead the <code>if&#47;then&#47;else</code>, on its own, does not care about indentation.)"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1575814244, "creation_date": 1575814244, "answer_id": 59236229, "question_id": 59236163, "link": "https://stackoverflow.com/questions/59236163/print-regards-following-functions-as-arguments/59236229#59236229", "title": "print regards following functions as arguments", "body": "<p>The expression</p>\n\n<pre><code>putSentence \"Three.\" func (x-1)\n</code></pre>\n\n<p>calls <code>putSentence</code> with three arguments: <code>\"Three.\"</code>, <code>func</code>, and <code>(x-1)</code>. This is wrong.</p>\n\n<p>What you probably want to do is to perform the IO actions one after another. For that you can use <code>&gt;&gt;</code>:</p>\n\n<pre><code>putSentence \"Three.\" &gt;&gt; func (x-1)\n</code></pre>\n\n<p>Alternatively, use a <code>do</code> block:</p>\n\n<pre><code>do putSentence \"Three.\"\n   func (x-1)\n</code></pre>\n\n<p>E.g.</p>\n\n<pre><code>func x = if 3 == x\n   then do\n      putSentence \"Three.\"\n      func (x-1)\n   else do\n      putSentence \"Not three.\"\n      func (x-1)\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user12500336"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 59236229, "answer_count": 2, "score": 0, "last_activity_date": 1575814244, "creation_date": 1575813911, "question_id": 59236163, "link": "https://stackoverflow.com/questions/59236163/print-regards-following-functions-as-arguments", "title": "print regards following functions as arguments", "body": "<p>So I'm learning Haskell and have a broader programm which i want to run, but I managed to narrow down why it doesn't work to this problem:</p>\n\n<pre><code>putSentence:: String -&gt; IO ()\nputSentence sentence = print sentence\n\nfunc 0 =  putSentence \"Sample Text.\"\nfunc x = if 3 == x then putSentence \"Three.\" func (x-1) else putSentence \"Not three.\" func (x-1)\n</code></pre>\n\n<p>The above code doesn't compile because putSentence takes the following <code>func (x-1)</code> as an additional argument. This is the first time Haskell did it like that for me, and I already tried shuffling the priority around with parentheses and $, but didn't find a way to fix it, so help would be appreciated.</p>\n"}, {"tags": ["haskell", "commutativity"], "answers": [{"comments": [{"owner": {"reputation": 115, "user_id": 9295366, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54221da51c66e5e8a5e7d69a63c84ff2?s=128&d=identicon&r=PG", "display_name": "rolly", "link": "https://stackoverflow.com/users/9295366/rolly"}, "edited": false, "score": 0, "creation_date": 1575830080, "post_id": 59236263, "comment_id": 104688590, "body": "thanks for the explanation, I see now how I got the error message wrong."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1575835895, "last_edit_date": 1575835895, "creation_date": 1575814485, "answer_id": 59236263, "question_id": 59236057, "link": "https://stackoverflow.com/questions/59236057/haskell-usage-of-flip-results-in-error-equations-for-have-different-numbe/59236263#59236263", "title": "Haskell: Usage of flip results in error: Equations for \u2018.&gt;\u2019 have different numbers of arguments", "body": "<p>Haskell mandates that each equation for a function has the same number of explicit arguments on the left hand side. This is not allowed:</p>\n\n<pre><code>N .&gt; S = ...   -- two arguments\nW .&gt; E = ...   -- two arguments\n(.&gt;) = ...     -- no arguments\n</code></pre>\n\n<p>Even if the last line is morally correct, since the type of the <code>...</code> part has two arguments, Haskell does not allow it, since the arguments are not explicitly present in the left hand side. So, we need to make the arguments explicit, using something like</p>\n\n<pre><code>x .&gt; y = ... x y  -- two arguments\n</code></pre>\n\n<p>That is:</p>\n\n<pre><code>x .&gt; y = flip (.&gt;) x y\n</code></pre>\n\n<p>which can be simplified to</p>\n\n<pre><code>x .&gt; y = y .&gt; x\n</code></pre>\n\n<p>which is what you wrote in the question.</p>\n\n<p>If you wonder why this is disallowed, <a href=\"https://stackoverflow.com/questions/8745597/defining-a-function-by-equations-with-different-number-of-arguments\">there is a question for that</a>.</p>\n"}], "owner": {"reputation": 115, "user_id": 9295366, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54221da51c66e5e8a5e7d69a63c84ff2?s=128&d=identicon&r=PG", "display_name": "rolly", "link": "https://stackoverflow.com/users/9295366/rolly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "accepted_answer_id": 59236263, "answer_count": 1, "score": 1, "last_activity_date": 1575835895, "creation_date": 1575813199, "last_edit_date": 1575830126, "question_id": 59236057, "link": "https://stackoverflow.com/questions/59236057/haskell-usage-of-flip-results-in-error-equations-for-have-different-numbe", "title": "Haskell: Usage of flip results in error: Equations for \u2018.&gt;\u2019 have different numbers of arguments", "body": "<p>I am struggling to understand what's going on here.\nI want to implement a data type <code>Direction</code> and define a commutative operator <code>.&gt;</code> for it.\nSo far I have this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Direction = N | E | S | W | None\n\n(.&gt;) :: Direction -&gt; Direction -&gt; [Direction]\nN .&gt; S = [None]\nW .&gt; E = [None]\n(.&gt;) = flip (.&gt;)\n</code></pre>\n\n<p>I get the error <code>Equations for \u2018.&gt;\u2019 have different numbers of arguments</code>. That's what I don't understand, because both sides of the equation have the same numers of arguments when checked in ghci:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; :t (.&gt;)\n(.&gt;) :: Direction -&gt; Direction -&gt; [Direction]\n\u03bb&gt; :t flip (.&gt;)\nflip (.&gt;) :: Direction -&gt; Direction -&gt; [Direction]\n</code></pre>\n\n<p>I can resolve the error by writing <code>d1 .&gt; d2 = d2 .&gt; d1</code> instead of using <code>flip</code> but <em>I can't understand why flip won't work</em>. Any ideas?</p>\n\n<p><strong>Edit</strong>: removed second, unrelated question</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1575801150, "post_id": 59234403, "comment_id": 104681083, "body": "Your <code>hof</code> essentially takes a <code>[a]</code> and produces an <code>a</code>. You can&#39;t use that, unchanged, and turn a <code>[a]</code> into an <code>[a]</code>. This could be possible if <code>hof</code> had the type of <code>foldr</code>, which is more general since the result does not have to be <code>a</code>."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 2, "creation_date": 1575801276, "post_id": 59234403, "comment_id": 104681111, "body": "I&#39;m not able to check this at the moment, but it&#39;s very helpful if you include the full error message in your question. PS your <code>hof</code> is just a restricted form of <code>foldr</code>, with the arguments in a different order - this function is used everywhere in Haskell so I would advise getting familiar with it rather than rolling your own version."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 11196158, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-doBZYYKy_Ao/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcpr6DxDVCVm_YoWm0aPxVN_jreIg/mo/photo.jpg?sz=128", "display_name": "Matthew Flynn", "link": "https://stackoverflow.com/users/11196158/matthew-flynn"}, "edited": false, "score": 0, "creation_date": 1575813943, "post_id": 59235549, "comment_id": 104684002, "body": "Removing the type signature from f2 gives the following error. *Main&gt; f2 [1,2,3] [1,2,3]  &lt;interactive&gt;:22:1: error:     * Couldn&#39;t match expected type <code>[Integer] -&gt; t&#39;                   with actual type </code>[a0]&#39;     * The function <code>f2&#39; is applied to two arguments,       but its type </code>[[a0]] -&gt; [a0]&#39; has only one       In the expression: f2 [1, 2, 3] [1, 2, 3]       In an equation for `it&#39;: it = f2 [1, 2, 3] [1, 2, 3]     * Relevant bindings include it :: t (bound at &lt;interactive&gt;:22:1)"}, {"owner": {"reputation": 51, "user_id": 2927484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/051331b227eab5420d3f27d22109b4ad?s=128&d=identicon&r=PG&f=1", "display_name": "parkerbrads", "link": "https://stackoverflow.com/users/2927484/parkerbrads"}, "reply_to_user": {"reputation": 1, "user_id": 11196158, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-doBZYYKy_Ao/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcpr6DxDVCVm_YoWm0aPxVN_jreIg/mo/photo.jpg?sz=128", "display_name": "Matthew Flynn", "link": "https://stackoverflow.com/users/11196158/matthew-flynn"}, "edited": false, "score": 0, "creation_date": 1575836740, "post_id": 59235549, "comment_id": 104690498, "body": "That\u2019s not a bad type error we\u2019re not always so lucky with GHC :D.   First, <code>f2</code> expects one list, not two. Second, the inferred type of <code>f2</code> is there in the error message: <code>[[a0]] -&gt; [a0]</code>"}], "tags": [], "owner": {"reputation": 51, "user_id": 2927484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/051331b227eab5420d3f27d22109b4ad?s=128&d=identicon&r=PG&f=1", "display_name": "parkerbrads", "link": "https://stackoverflow.com/users/2927484/parkerbrads"}, "is_accepted": false, "score": 0, "last_activity_date": 1575809479, "creation_date": 1575809479, "answer_id": 59235549, "question_id": 59234403, "link": "https://stackoverflow.com/questions/59234403/problems-with-mapping-and-types-in-haskell-higher-order-functions/59235549#59235549", "title": "Problems with mapping and types in haskell higher order functions", "body": "<p><code>g</code> in the first version of <code>f1</code> doesn\u2019t use <code>b</code>. In your definition of <code>hof</code> that argument is where the recursion happens. If you don\u2019t use that argument you won\u2019t iterate over the list.</p>\n\n<p>As for the type error for <code>f2</code>: look closely at the type of <code>(++)</code>, the function required by <code>hof</code> and the type you\u2019ve said <code>f2</code> should have. I suspect that if you remove your type signature what you have will compile. Then you could use GHCi to ask for the inferred type for <code>f2</code>.</p>\n\n<p>It might be a good idea to remove the pattern matching from <code>f2</code> before you go to test it.</p>\n\n<p>Hope that helps :)</p>\n"}], "owner": {"reputation": 1, "user_id": 11196158, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-doBZYYKy_Ao/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcpr6DxDVCVm_YoWm0aPxVN_jreIg/mo/photo.jpg?sz=128", "display_name": "Matthew Flynn", "link": "https://stackoverflow.com/users/11196158/matthew-flynn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 74, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1575809479, "creation_date": 1575800226, "last_edit_date": 1575800577, "question_id": 59234403, "link": "https://stackoverflow.com/questions/59234403/problems-with-mapping-and-types-in-haskell-higher-order-functions", "title": "Problems with mapping and types in haskell higher order functions", "body": "<p>I have a higher order function as follows. F1 is simply adding 1 to the first element, but I want it to map to all elements and the second is getting a type error. I am wondering how I fix these problems.\n'''</p>\n\n<pre><code>hof :: a -&gt; (a-&gt;a-&gt;a) -&gt; [a] -&gt; a\nhof x _ [] = x\nhof x f (y:ys) = f y (hof x f ys)\n\n\nf1 :: (Num a)=&gt; [a] -&gt; a\nf1 xs = hof 0 g xs  \n      where g a b = 1 + a\n\nf2 :: [a] -&gt; [a]\nf2 (x:xs) = hof [] (++) (x:xs)\n</code></pre>\n\n<p>expected behavior should be</p>\n\n<pre><code>f1 [] = 0\nf1 x:xs = 1 + f1 xs\n\nf2 [] = []\nf2 (x:xs) = x ++ f4 xs\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1575786525, "post_id": 59232514, "comment_id": 104678545, "body": "Look for <code>extra-deps</code> in the official documentation: <a href=\"http://docs.haskellstack.org/en/stable/yaml_configuration/\" rel=\"nofollow noreferrer\">docs.haskellstack.org/en/stable/yaml_configuration</a>"}, {"owner": {"reputation": 689, "user_id": 1662829, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/94d0ee316f945415c5966773384c3dda?s=128&d=identicon&r=PG", "display_name": "decapo", "link": "https://stackoverflow.com/users/1662829/decapo"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1575787405, "post_id": 59232514, "comment_id": 104678634, "body": "@arrowd Is this the preferred method for doing this?  Also, how would I package up project-a as a zip or tar file?"}, {"owner": {"reputation": 689, "user_id": 1662829, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/94d0ee316f945415c5966773384c3dda?s=128&d=identicon&r=PG", "display_name": "decapo", "link": "https://stackoverflow.com/users/1662829/decapo"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1575787631, "post_id": 59232514, "comment_id": 104678663, "body": "@arrowd I found the <code>sdist</code> command, so I know how to package it."}], "answers": [{"tags": [], "owner": {"reputation": 689, "user_id": 1662829, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/94d0ee316f945415c5966773384c3dda?s=128&d=identicon&r=PG", "display_name": "decapo", "link": "https://stackoverflow.com/users/1662829/decapo"}, "is_accepted": false, "score": 0, "last_activity_date": 1575789805, "creation_date": 1575789805, "answer_id": 59233321, "question_id": 59232514, "link": "https://stackoverflow.com/questions/59232514/using-local-packages-with-haskell-stack/59233321#59233321", "title": "Using local packages with Haskell Stack", "body": "<p>Special thanks to @arrowd for pointing me in the right direction.  This is an answer to my question but if someone else has a better one I will accept it.</p>\n\n<p>In <strong>project a</strong> run the command</p>\n\n<pre><code>&gt; stack sdist\n</code></pre>\n\n<p>that will package your project up into a tarball and show you what directory it is in.</p>\n\n<p>Then go to <strong>project b</strong> and add the following to the <code>stack.yaml</code> file under the <code>extra-deps</code> section</p>\n\n<pre><code>extra-deps:\n- archive: /path/to/project-a/tar/file\n</code></pre>\n\n<p>and in your <code>package.yaml</code> file under dependencies</p>\n\n<pre><code>dependencies:\n# other dependencies\n- project-a == 2.0.0.0\n</code></pre>\n\n<p>then run</p>\n\n<pre><code>&gt; stack build\n</code></pre>\n\n<p>and project-a will be included in project-b.</p>\n"}], "owner": {"reputation": 689, "user_id": 1662829, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/94d0ee316f945415c5966773384c3dda?s=128&d=identicon&r=PG", "display_name": "decapo", "link": "https://stackoverflow.com/users/1662829/decapo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 95, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1575789805, "creation_date": 1575780396, "question_id": 59232514, "link": "https://stackoverflow.com/questions/59232514/using-local-packages-with-haskell-stack", "title": "Using local packages with Haskell Stack", "body": "<p>Say I have two projects (<code>project-a</code> and <code>project-b</code>) and I wanted to include project-a into project-b without uploading project-a to stackage.  How could I publish the package locally and include it into project-b like so?</p>\n\n<pre><code># package.yaml for project-b\ndependencies:\n- base      &gt;= 4.7 &amp;&amp; &lt; 5\n- project-a == 2.0.0.0\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1575795401, "post_id": 59231769, "comment_id": 104679870, "body": "As a general advice, using <code>length, head, tail</code> is considered a bad practice when pattern matching would suffice. In the worst case, you get a crashing program, like the above one: why should <code>head (tail xs)</code> be successful on a non empty list? Often you get an inefficient program: <code>length xs == 0</code> scans the whole list to count its elements, but there is no need to."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 1, "creation_date": 1575808363, "post_id": 59231769, "comment_id": 104682647, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/59225502/split-a-string-by-a-chosen-character-in-haskell\">Split a string by a chosen character in haskell</a>"}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 12458908, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b7fdd5c8aa307c0177b2a0f1aaf6973?s=128&d=identicon&r=PG&f=1", "display_name": "sad_banana_peel", "link": "https://stackoverflow.com/users/12458908/sad-banana-peel"}, "edited": false, "score": 0, "creation_date": 1575832906, "post_id": 59232215, "comment_id": 104689436, "body": "Thanks! The reason I tried to use <code>[head xs : splitlist (tail xs) n]</code> was because I was trying to fix the second problem that you pointed out - that it&#39;s always a list of only single element lists. I&#39;m still not sure how to do this - I&#39;m trying to put x as the first element of the list and then call the function again, but I&#39;m still getting the type errors and I&#39;m not too sure how to avoid that. I also tried using ++, but I don&#39;t think that&#39;s allowed in pattern matching."}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": true, "score": 1, "last_activity_date": 1575776193, "creation_date": 1575776193, "answer_id": 59232215, "question_id": 59231769, "link": "https://stackoverflow.com/questions/59231769/splitting-a-list-on-the-instance-of-a-specific-integer/59232215#59232215", "title": "Splitting a list on the instance of a specific integer", "body": "<p><code>xs</code> has type <code>[Int]</code>, so <code>head xs</code> has type <code>Int</code>. <code>splitlist</code> has type <code>[Int] -&gt; Int -&gt; [[Int]]</code>, so <code>splitlist (tail xs) n</code> has type <code>[[Int]]</code>. You're trying to call <code>:</code> on those values, which has type <code>a -&gt; [a] -&gt; [a]</code>. The problem is that no choice of <code>a</code> makes that work out: if you pick <code>Int</code> for <code>a</code>, then it's wrong because the second parameter is <code>[[Int]]</code> rather than <code>[Int]</code>, and if you pick <code>[Int]</code> for <code>a</code>, then it's wrong because the first parameter is <code>Int</code> rather than <code>[Int]</code>.</p>\n\n<p>I think you meant to write <code>[head xs] : splitlist (tail xs) n</code> instead of <code>[head xs : splitlist (tail xs) n]</code>, like in the line above that one. However, although this type-checks, it still doesn't <em>work</em> (it produces <code>[[3],[4],[6],[6],[7],[7]]</code> on your test case, and <code>splitlist [0] 0</code> bottoms).</p>\n\n<p>To actually fix it, let's first rewrite it to look a bit more idiomatic:</p>\n\n<pre><code>splitlist :: [Int] -&gt; Int -&gt; [[Int]]\nsplitlist [] _ = []\nsplitlist (x:xs) n\n  | x == n = [head xs] : splitlist xs n\n  | otherwise = [x] : splitlist xs n\n</code></pre>\n\n<p>The change I made is that I used pattern-matching in place of testing <code>length</code> and then using <code>head</code> and <code>tail</code>. Now the problems with the logic become apparent:</p>\n\n<ul>\n<li>It bottoms if the final element of the list is the separator</li>\n<li>The result is always a list of only single-element lists</li>\n<li>There's always one <code>Int</code> in the output for each <code>Int</code> in the input</li>\n</ul>\n\n<p>I assume this is some sort of exercise, so I'm not going to spoil the final answer. However, this should be enough to get you going again.</p>\n"}], "owner": {"reputation": 25, "user_id": 12458908, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b7fdd5c8aa307c0177b2a0f1aaf6973?s=128&d=identicon&r=PG&f=1", "display_name": "sad_banana_peel", "link": "https://stackoverflow.com/users/12458908/sad-banana-peel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 59232215, "answer_count": 1, "score": 0, "last_activity_date": 1575776193, "creation_date": 1575769423, "last_edit_date": 1575775239, "question_id": 59231769, "link": "https://stackoverflow.com/questions/59231769/splitting-a-list-on-the-instance-of-a-specific-integer", "title": "Splitting a list on the instance of a specific integer", "body": "<p>I'm trying to write a function which would split a list into few separate lists on the instance of one specific integer. Example:</p>\n\n<p><code>splitlist [3, 4, 0, 6, 0, 7] 0</code> would return <code>[[3, 4], [6], [7]]</code></p>\n\n<p>So far I've got:</p>\n\n<pre><code>splitlist :: [Int] -&gt; Int -&gt; [[Int]]\nsplitlist xs n \n  | length xs == 0 = []\n  | head xs == n = [head (tail xs)] : splitlist (tail xs) n \n  | otherwise = [head xs : splitlist (tail xs) n] \n</code></pre>\n\n<p>However, I'm getting a type error for <code>head xs</code> in line 5:</p>\n\n<pre><code>    \u2022 Couldn't match type \u2018[Int]\u2019 with \u2018Int\u2019\n      Expected type: [Int]\n        Actual type: [[Int]]\n    \u2022 In the second argument of \u2018(:)\u2019, namely \u2018splitlist (tail xs) n\u2019\n      In the expression: head xs : splitlist (tail xs) n\n      In the expression: [head xs : splitlist (tail xs) n]\n  |\n5 |   | otherwise = [head xs : splitlist (tail xs) n]\n  |                            ^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["parsing", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 1, "last_activity_date": 1575817777, "creation_date": 1575817777, "answer_id": 59236746, "question_id": 59231618, "link": "https://stackoverflow.com/questions/59231618/parsing-float-with-get-from-bytestring-not-behaving-as-expected/59236746#59236746", "title": "parsing Float with &#39;get&#39; from ByteString not behaving as expected", "body": "<p><a href=\"https://hackage.haskell.org/package/binary-0.8.7.0/docs/src/Data.Binary.Class.html#line-685\" rel=\"nofollow noreferrer\">The <code>Binary</code> instance of <code>Float</code></a> parses a pair \n<code>(Integer, Int)</code> and <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:encodeFloat\" rel=\"nofollow noreferrer\">then uses <code>encodeFloat :: Integer -&gt; Int -&gt; Float</code></a>, which is why it takes more than 32 bits.</p>\n\n<p>This is a known issue left around for backwards compatibility: <a href=\"https://github.com/kolmodin/binary/issues/69\" rel=\"nofollow noreferrer\">https://github.com/kolmodin/binary/issues/69</a></p>\n\n<p>Don't use <code>get</code> blindly, there is more than one way to encode things. In this case, there are other parsers for 32 bit formats of <code>Float</code>: <a href=\"https://hackage.haskell.org/package/binary-0.8.7.0/docs/Data-Binary-Get.html#v:getFloatbe\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/binary-0.8.7.0/docs/Data-Binary-Get.html#v:getFloatbe</a></p>\n"}], "owner": {"reputation": 131, "user_id": 9663052, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c5e77edc1e34cdb3eb39ca0b5a8854a?s=128&d=identicon&r=PG&f=1", "display_name": "notBob", "link": "https://stackoverflow.com/users/9663052/notbob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 59236746, "answer_count": 1, "score": 0, "last_activity_date": 1575823168, "creation_date": 1575767053, "last_edit_date": 1575823168, "question_id": 59231618, "link": "https://stackoverflow.com/questions/59231618/parsing-float-with-get-from-bytestring-not-behaving-as-expected", "title": "parsing Float with &#39;get&#39; from ByteString not behaving as expected", "body": "<p>In the context of creating a simple STL parser, I found some, at least to me, unexpected behavior in <code>get</code> from <code>Data.Binary</code>. It appears to me that it does not stop reading the <code>ByteString</code> after the 32 bits that I would assume it should.</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\nmodule STLTransform where\n\nimport qualified Data.ByteString.Lazy as BL\nimport Data.Binary\nimport Data.Binary.Get\nimport Data.Binary.Put\nimport Data.Word\nimport Numeric.LinearAlgebra\nimport GHC.Float\nimport System.Endian\n\ngetTriangle = do\n  normal   &lt;- getR3\n  vertices &lt;- sequence $ take 3 $ trace (show normal) $ repeat getR3\n  return (normal, vertices)\n  where getR3 = fmap (vector.fmap float2Double)\n              $ sequence $ take 3 $ repeat get\n\ngetSTL :: Get ([Word8], Word32, [(Vector R, [Vector R])], Word16)\ngetSTL = do\n  header &lt;- sequence $ take 80 $ repeat get\n  number &lt;- fmap (toBE32) $ get\n  triangles &lt;- sequence $ take (fromIntegral number) $ repeat getTriangle\n  attribute &lt;- get\n  return (header, number, triangles, attribute)\n\nreadSTL fn = BL.readFile fn &gt;&gt;= return.runGet getSTL\n</code></pre>\n\n<p>Attempting to read an STL-file using this code, I would get an error like</p>\n\n<pre><code>*Main STLTransform&gt; readSTL \"test.stl\"\n*** Exception: Data.Binary.Get.runGet at position 1268784: not enough bytes\nCallStack (from HasCallStack):\nerror, called at libraries/binary/src/Data/Binary/Get.hs:351:5 in binary-0.8.6.0:Data.Binary.Get\n</code></pre>\n\n<p>After some debugging, I isolated the problem to <code>getTriangle</code>, and more specifically the parsing of <code>Float</code> values. By replacing <code>float2Double</code> with <code>(\\a -&gt; fromIntegral (a :: Word32))</code> </p>\n\n<pre><code>getTriangle = do\n  normal   &lt;- getR3\n  vertices &lt;- sequence $ take 3 $ trace (show normal) $ repeat getR3\n  return (normal, vertices)\n  where getR3 = fmap (vector.fmap (\\a -&gt; fromIntegral (a :: Word32)))\n              $ sequence $ take 3 $ repeat get\n</code></pre>\n\n<p>I get code that runs as I intended (although obviously with incorrect numbers). So the the question is, why are <code>Float</code> and <code>Word32</code> treated differently? Is not <code>Float</code> also a 32 bit value?</p>\n\n<p>The version of the package used is <code>binary-0.8.6.0</code></p>\n\n<p>EDIT:\nThe corrected version of the function is</p>\n\n<pre><code>getTriangle :: Get (Vector R, [Vector R], Word16)\ngetTriangle = do\n  normal    &lt;- getR3\n  vertices  &lt;- sequence $ take 3 $ repeat getR3\n  attribute &lt;- get\n  return (normal, vertices, attribute)\n  where getR3 = fmap (vector.fmap float2Double)\n              $ sequence $ take 3 $ repeat getFloatle\n</code></pre>\n\n<p>Unrelated to the stated issue, but corrected from the original post, the attribute is on the triangle level, not on the file level.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1575754318, "post_id": 59230320, "comment_id": 104673915, "body": "You are correct. Indeed, we can have <code>k :: L</code> for any kind <code>L</code>, as long as <code>t :: L -&gt; *</code>. A compiler here must however choose some specific <code>L</code>, or resort to a polykind. A polykind would be the most general option, but here GHC chooses <code>L = *</code> (basic Haskell does not have polykinds, they have to be turned on as an extension). Since it chooses something which is rather arbitrary, LYAH uses the word &quot;assume&quot; (AFAICT)."}, {"owner": {"reputation": 11283, "user_id": 5825294, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Un5fU.png?s=128&g=1", "display_name": "Enlico", "link": "https://stackoverflow.com/users/5825294/enlico"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1575796103, "post_id": 59230320, "comment_id": 104680010, "body": "Ok, maybe <i>the compiler assumes</i> would have puzzled me at least less than <i>we assume</i>, or not at all."}], "answers": [{"comments": [{"owner": {"reputation": 11283, "user_id": 5825294, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Un5fU.png?s=128&g=1", "display_name": "Enlico", "link": "https://stackoverflow.com/users/5825294/enlico"}, "edited": false, "score": 0, "creation_date": 1589228996, "post_id": 59230380, "comment_id": 109205781, "body": "I have posted a related question <a href=\"https://stackoverflow.com/questions/61738702/making-a-datatype-an-instance-of-functor-to-map-on-a-field-which-is-of-parametri\">here</a>, if you are interested."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 20, "last_activity_date": 1575754083, "creation_date": 1575754083, "answer_id": 59230380, "question_id": 59230320, "link": "https://stackoverflow.com/questions/59230320/what-is-the-assumption-made-in-learn-you-a-haskell-when-deducing-the-kind/59230380#59230380", "title": "What is the assumption made in &quot;Learn You a Haskell&quot; when deducing the kind?", "body": "<p>In fact, the compiler does assume! But you can ask it not to with the PolyKinds extension. You can read about it in more detail <a href=\"https://downloads.haskell.org/ghc/8.8.1/docs/html/users_guide/glasgow_exts.html#extension-PolyKinds\" rel=\"noreferrer\">here</a>. With that extension turned on, the kind of <code>Barry</code> will be <code>forall k. (k -&gt; *) -&gt; k -&gt; * -&gt; *</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 7, "creation_date": 1575764450, "post_id": 59230440, "comment_id": 104675873, "body": "<code>k</code> is not constrained to be <code>*</code> as you claim it is while deducing <code>t</code>. We could have <code>k :: * -&gt; *</code> and <code>t :: (* -&gt; *) -&gt; *</code>, for example.  Add a field <code>doo :: k Int</code> to the record and it will pass with no issue."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1575808086, "post_id": 59230440, "comment_id": 104682591, "body": "@luqui.. Yes you are right... I won&#39;t delete this answer since your comment is really worth standing."}], "tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": -1, "last_activity_date": 1575806277, "last_edit_date": 1575806277, "creation_date": 1575754457, "answer_id": 59230440, "question_id": 59230320, "link": "https://stackoverflow.com/questions/59230320/what-is-the-assumption-made-in-learn-you-a-haskell-when-deducing-the-kind/59230440#59230440", "title": "What is the assumption made in &quot;Learn You a Haskell&quot; when deducing the kind?", "body": "<p>Good point. The author makes a needless assumtion. Perhaps just to make it easier to understand in his Type Foo chapter but people like yourself may rightfully question this.</p>\n\n<p>Both  <code>t</code>, <code>k</code> and <code>p</code> are type variables. As we see from <code>yabba :: p</code> it can live alone so it's like a constant function, as if it was a value instead of a type, it's type signature would say <code>Int</code> or <code>Char</code>, whatever... you name it. But since it is a type then it's kind signature is <code>*</code>.</p>\n\n<p>However <code>t</code> type here takes a type variable <code>k</code> to construct a type (<code>dabba :: t k</code>) <s>so we are sure that (no assumtion here) <code>t</code> has a kind signature like <code>* -&gt; *</code> and <code>k</code> has <code>*</code></s>.</p>\n\n<p>Once we know this... the type <code>Barry t k p</code>'s kind signature is <code>(* -&gt; *) -&gt; * -&gt; * -&gt; *</code> which means it takes <code>t</code> then <code>k</code> and then <code>p</code> and give us <code>Barry</code> type.</p>\n\n<p><strong>Edit</strong> Make sure to read @luqui's comment below.</p>\n"}], "owner": {"reputation": 11283, "user_id": 5825294, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Un5fU.png?s=128&g=1", "display_name": "Enlico", "link": "https://stackoverflow.com/users/5825294/enlico"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 674, "favorite_count": 2, "accepted_answer_id": 59230380, "answer_count": 2, "score": 19, "last_activity_date": 1575806277, "creation_date": 1575753633, "last_edit_date": 1575786209, "question_id": 59230320, "link": "https://stackoverflow.com/questions/59230320/what-is-the-assumption-made-in-learn-you-a-haskell-when-deducing-the-kind", "title": "What is the assumption made in &quot;Learn You a Haskell&quot; when deducing the kind?", "body": "<p>This question is not subjective. A very specific verb is used in the referenced book, and I'd like to understand what the implication of that phrasing is, because I'm afraid I'm misunderstanding something.</p>\n\n<p>From <a href=\"http://learnyouahaskell.com/making-our-own-types-and-typeclasses#recursive-data-structures\" rel=\"noreferrer\">Learn You a Haskell</a>, the following paragraph is the third and last one containing \"we assume <code>*</code>\".</p>\n\n<blockquote>\n<pre><code>data Barry t k p = Barry { yabba :: p, dabba :: t k }  \n</code></pre>\n  \n  <p>And now we want to make it an instance of <code>Functor</code>. <code>Functor</code> wants types of kind <code>* -&gt; *</code> but <code>Barry</code> doesn't look like it has that kind. What is the kind of <code>Barry</code>? Well, we see it takes three type parameters, so it's going to be <code>something -&gt; something -&gt; something -&gt; *</code>. It's safe to say that <code>p</code> is a concrete type and thus has a kind of <code>*</code>. <strong>For <code>k</code>, we assume <code>*</code> and so by extension, <code>t</code> has a kind of <code>* -&gt; *</code></strong>. Now let's just replace those kinds with the <code>something</code>s that we used as placeholders and we see it has a kind of <code>(* -&gt; *) -&gt; * -&gt; * -&gt; *</code>.</p>\n</blockquote>\n\n<p>Why are we assuming anything at all? Upon reading \"we assume X (i.e. we assume that X is true)\" it is natural for me to think that we should also consider the case that X is false. In the specific case of the example, couldn't <code>t</code> be of kind <code>(* -&gt; *) -&gt; *</code> and <code>k</code> of kind <code>(* -&gt; *)</code>? If this was the case, whatever <code>t</code> and <code>k</code> actually were, <code>t k</code> would still be a concrete type, no?</p>\n\n<p>I see that the whole line of reasoning is then checked against the compiler, but I don't think the compiler <strong>assumes</strong>. If it does, I'd like to know what, if it doesn't then again I'm afraid I'm missing the meaning of the paragraph.</p>\n"}, {"tags": ["haskell", "monad-transformers", "scotty"], "answers": [{"tags": [], "owner": {"reputation": 1047, "user_id": 1146183, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d5152bd68f7c09d1c3172874b3ce2150?s=128&d=identicon&r=PG", "display_name": "Marcus Buffett", "link": "https://stackoverflow.com/users/1146183/marcus-buffett"}, "is_accepted": false, "score": 2, "last_activity_date": 1575737578, "creation_date": 1575737578, "answer_id": 59228251, "question_id": 59227783, "link": "https://stackoverflow.com/questions/59227783/how-to-use-a-monad-stack-with-scotty-and-selda/59228251#59228251", "title": "How to use a monad stack with scotty and selda?", "body": "<p>I figured it out after looking around at a lot of other answers and learning more about monad transformers, the solution I came to was this:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric, OverloadedStrings, OverloadedLabels #-}\n\nmodule Server where\n\nimport Web.Scotty.Trans\nimport Database.Selda\nimport Database.Selda.SQLite\nimport Control.Monad.Trans.Class\nimport Control.Monad.Identity\nimport qualified Data.Text.Lazy as TL\n\nimport Models\n\nserver :: IO ()\nserver = scottyT 4200 withPersist router\n\nrouter :: ScottyT TL.Text (SeldaT SQLite IO) ()\nrouter = do\n  get \"/book/:id\" searchBook\n\nsearchBook:: ActionT TL.Text (SeldaT SQLite IO) ()\nsearchBook = do\n  books &lt;- lift $ query selectBookQuery\n  json books\n    where\n      selectBookQuery = do\n        book &lt;- select goodreadsBooks\n        restrict (book ! #goodreadsId .== \"20\")\n        return book\n</code></pre>\n\n<p>There were a few keys:</p>\n\n<ul>\n<li>Scotty has its own monad transformer, ScottyT, which has to be the outermost transformer</li>\n<li>Scott.Trans needs to be used to get transformer stacks to work with scotty, as the types are more general</li>\n<li>Need to use ActionT transformer for the actions, so they have access to the tranformer stack too</li>\n</ul>\n"}], "owner": {"reputation": 1047, "user_id": 1146183, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d5152bd68f7c09d1c3172874b3ce2150?s=128&d=identicon&r=PG", "display_name": "Marcus Buffett", "link": "https://stackoverflow.com/users/1146183/marcus-buffett"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1575737578, "creation_date": 1575734379, "last_edit_date": 1575735427, "question_id": 59227783, "link": "https://stackoverflow.com/questions/59227783/how-to-use-a-monad-stack-with-scotty-and-selda", "title": "How to use a monad stack with scotty and selda?", "body": "<p>I've been trying to get a web server running with scotty that can communicate with my db, using selda. I thought using a monad transformer stack would be the way to accomplish something like that. I've been trying to work it out, but I've run into a few dead-ends where the types just don't seem workable.</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric, OverloadedStrings, OverloadedLabels #-}\n\nmodule Server where\n\nimport Web.Scotty\nimport Data.Monoid (mconcat)\nimport Data.Aeson (ToJSON)\nimport GHC.Generics\nimport Web.Scotty\nimport Database.Selda\nimport Database.Selda.SQLite\nimport Control.Monad.Trans.Class\n\nimport Models\n\ntype App = SeldaT SQLite ScottyM\n\n-- withPersist:: (MonadIO m, MonadMask m) =&gt; SeldaT SQLite m a -&gt; m a\nserver = scotty 4200 (withPersist router)\n\nrouter :: App ()\nrouter = do\n  lift $ get \"/book/:id\" searchBook\n\nsearchBook:: ActionM ()\nsearchBook = do\n  books &lt;- query selectBookQuery\n  json books\n    where\n      selectBookQuery = do\n        book &lt;- select goodreadsBooks\n        restrict (book ! #goodreadsId .== \"20\")\n        return book\n</code></pre>\n\n<p>I tried to base it loosely off the answer <a href=\"https://stackoverflow.com/questions/28361505/scotty-monad-transformer-for-per-handler-reader\">here</a>, but I wanted to wrap the router instead of individual routes. I wouldn't want the # of connections I have open to be proportional to the # of routes I have, and I don't want each route to have to have a <code>withPersist</code> call, if I can avoid it.</p>\n\n<p>So I've got an <code>App</code> which is of type <code>SeldaT Sqlite ScottyM</code>, and using <code>withPersist</code> (which is == <code>withSQLite \"mydb.db\"</code>), I'd turn that <code>SeldaT Sqlite ScottyM</code> into a <code>ScottyM</code>. There are quite a few issues though, here's my understanding of them:</p>\n\n<ul>\n<li><code>SeldaT m a</code> is constrained by <code>(MonadIO m, MonadMask m)</code>, and ScottyM has no instance of <code>MonadIO</code></li>\n<li><code>Scotty.get</code> returns a <code>ScottyM ()</code>, I feel like this is where I'd use <code>lift</code> to make that into a <code>SeldaT Sqlite ScottyM</code>, but I get an error about it, maybe related to <code>ScottyM</code> not being an instance of <code>MonadIO</code> from above.</li>\n<li>Since <code>searchBook</code> is still an <code>ActionM</code>, I can't run queries inside it. Unsure how to get <code>get</code> to accept my transformer stack instead of an <code>ActionM</code></li>\n</ul>\n\n<p>Here are the errors:</p>\n\n<pre><code>/home/marcus/Documents/projects/nowwhatdoiread/nwdir-server/app/Server.hs:19:23: error:\n    \u2022 No instance for (MonadIO ScottyM)\n        arising from a use of \u2018withPersist\u2019\n    \u2022 In the second argument of \u2018scotty\u2019, namely \u2018(withPersist router)\u2019\n      In the expression: scotty 4200 (withPersist router)\n      In an equation for \u2018server\u2019:\n          server = scotty 4200 (withPersist router)\n   |\n19 | server = scotty 4200 (withPersist router)\n   |                       ^^^^^^^^^^^^^^^^^^\n\n/home/marcus/Documents/projects/nowwhatdoiread/nwdir-server/app/Server.hs:23:3: error:\n    \u2022 No instance for (MonadTrans (SeldaT SQLite))\n        arising from a use of \u2018lift\u2019\n    \u2022 In a stmt of a 'do' block: lift $ get \"/book/:id\" searchBook\n      In the expression: do lift $ get \"/book/:id\" searchBook\n      In an equation for \u2018router\u2019:\n          router = do lift $ get \"/book/:id\" searchBook\n   |\n23 |   lift $ get \"/book/:id\" searchBook\n   |   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n/home/marcus/Documents/projects/nowwhatdoiread/nwdir-server/app/Server.hs:27:12: error:\n    \u2022 No instance for (MonadSelda\n                         (Web.Scotty.Internal.Types.ActionT\n                            Data.Text.Internal.Lazy.Text IO))\n        arising from a use of \u2018query\u2019\n    \u2022 In a stmt of a 'do' block: books &lt;- query selectBookQuery\n      In the expression:\n        do books &lt;- query selectBookQuery\n           json books\n      In an equation for \u2018searchBook\u2019:\n          searchBook\n            = do books &lt;- query selectBookQuery\n                 json books\n            where\n                selectBookQuery\n                  = do book &lt;- select goodreadsBooks\n                       ....\n   |\n27 |   books &lt;- query selectBookQuery\n   |            ^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>UPDATE: I probably need to use ScottyT, after looking at some more similar questions. Not sure how to nest SeldaT in the ScottyT transformer though.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 1, "creation_date": 1575729723, "post_id": 59226842, "comment_id": 104667830, "body": "I think first things first your should condiser making Optional type an instance of Monad type class and then the Kleisli composition operator would come free of charge <code>f &gt;=&gt; g = \\x -&gt; f x &gt;&gt;= g</code>."}, {"owner": {"reputation": 1002, "user_id": 1620367, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wbTpy.jpg?s=128&g=1", "display_name": "vkubicki", "link": "https://stackoverflow.com/users/1620367/vkubicki"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 1, "creation_date": 1575729862, "post_id": 59226842, "comment_id": 104667864, "body": "I will try this later Redu, the point of the book is to gradually learn how to apply category theory."}], "answers": [{"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1575756690, "post_id": 59226926, "comment_id": 104674479, "body": "In a sense, <code>case</code> is the fundamental tool of destructuring in Haskell, in that other pattern matching desugars into <code>case</code> statements in the core language. So it is good to get a handle on it."}, {"owner": {"reputation": 1002, "user_id": 1620367, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wbTpy.jpg?s=128&g=1", "display_name": "vkubicki", "link": "https://stackoverflow.com/users/1620367/vkubicki"}, "edited": false, "score": 0, "creation_date": 1575815690, "post_id": 59226926, "comment_id": 104684458, "body": "OK, so the guards is a syntax sugar in the particular situation where the case is applied to an argument of a function, right ?"}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "reply_to_user": {"reputation": 1002, "user_id": 1620367, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wbTpy.jpg?s=128&g=1", "display_name": "vkubicki", "link": "https://stackoverflow.com/users/1620367/vkubicki"}, "edited": false, "score": 0, "creation_date": 1575841040, "post_id": 59226926, "comment_id": 104691599, "body": "@vkubicki I don\u2019t understand what you mean. What do you think a guard is? What do you think it\u2019s syntactic sugar for?"}, {"owner": {"reputation": 1002, "user_id": 1620367, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wbTpy.jpg?s=128&g=1", "display_name": "vkubicki", "link": "https://stackoverflow.com/users/1620367/vkubicki"}, "edited": false, "score": 0, "creation_date": 1575841201, "post_id": 59226926, "comment_id": 104691635, "body": "<a href=\"http://learnyouahaskell.com/syntax-in-functions\" rel=\"nofollow noreferrer\">learnyouahaskell.com/syntax-in-functions</a> there is section called guards"}, {"owner": {"reputation": 1002, "user_id": 1620367, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wbTpy.jpg?s=128&g=1", "display_name": "vkubicki", "link": "https://stackoverflow.com/users/1620367/vkubicki"}, "edited": false, "score": 0, "creation_date": 1575841833, "post_id": 59226926, "comment_id": 104691774, "body": "I thought that guards were used for pattern-matching, but it seems there are only used to perform tests on values."}], "tags": [], "owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "is_accepted": true, "score": 5, "last_activity_date": 1575842359, "last_edit_date": 1575842359, "creation_date": 1575728614, "answer_id": 59226926, "question_id": 59226842, "link": "https://stackoverflow.com/questions/59226842/how-to-pattern-match-an-intermediate-value-in-haskell/59226926#59226926", "title": "How to pattern-match an intermediate value in Haskell", "body": "<p>You can use <code>case</code> to do pattern matching:</p>\n\n<pre><code>f &gt;=&gt; g = \\x -&gt;\n  case f x of\n    Valid v -&gt; g v\n    Invalid -&gt; Invalid\n</code></pre>\n\n<p>In your question you also seem to be trying to use guards for pattern matching and binding values. Haskell does not allow this. A guard is just a boolean valued expression which must be true for the preceding (sometimes optional) pattern to match. Haskell the language doesn\u2019t really \u201cunderstand\u201d the <code>(==)</code> operator as meaning equality. It just sees it as a function like any other. And indeed one can define it for a type to not correspond to the same kind of equality that a pattern match requires.</p>\n\n<p>A guard is allowed to use variables from the pattern (or from a larger scope) but can\u2019t bind new ones like a pattern. Therefore this would be wrong because <code>v</code> would be undefined.</p>\n\n<pre><code>f &gt;=&gt; g = \\x -&gt;\n  case f x of\n    _ | x == Valid v -&gt; g v\n    _ | x == Invalid -&gt; Invalid\n</code></pre>\n\n<p>It would also make it basically impossible for the compiler to ever know if your patterns are exhaustive (ie that there are no values which wouldn\u2019t be matched by any case)</p>\n"}], "owner": {"reputation": 1002, "user_id": 1620367, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wbTpy.jpg?s=128&g=1", "display_name": "vkubicki", "link": "https://stackoverflow.com/users/1620367/vkubicki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 59226926, "answer_count": 1, "score": 2, "last_activity_date": 1575842359, "creation_date": 1575727996, "last_edit_date": 1575728971, "question_id": 59226842, "link": "https://stackoverflow.com/questions/59226842/how-to-pattern-match-an-intermediate-value-in-haskell", "title": "How to pattern-match an intermediate value in Haskell", "body": "<h1>Question</h1>\n\n<p>In the book <em>Category Theory for Programmers</em> by Bartosz Milewski, chapter 4.3.</p>\n\n<p>You must code a Kleisli category where morphisms are partial functions. Here is my attempt which does not compile:</p>\n\n<pre><code>data Optional a = Valid a | Invalid deriving (Show)\n\nreturn :: a -&gt; Optional a\nreturn x = Valid x\n\n(&gt;=&gt;) :: (a -&gt; Optional b) -&gt; (b -&gt; Optional c) -&gt; (a -&gt; Optional c)\nf (&gt;=&gt;) g = \\x -&gt;\n    let s = f x\n    in | s == Valid v = g v\n       | s == Invalid = Invalid\n</code></pre>\n\n<p>In the <code>&gt;=&gt;</code> operator definition, I want to pattern-match the intermediate value <code>s</code> to test if is <code>Valid</code> (and then call <code>f</code>) or if it is <code>Invalid</code> (and then return <code>Invalid</code>). How can I do this ?</p>\n"}, {"tags": ["haskell", "quickcheck"], "answers": [{"comments": [{"owner": {"reputation": 667, "user_id": 1773775, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/319d639ba5fe3f1b64a5c05454ea97ff?s=128&d=identicon&r=PG", "display_name": "alex_reader", "link": "https://stackoverflow.com/users/1773775/alex-reader"}, "edited": false, "score": 0, "creation_date": 1575723992, "post_id": 59225999, "comment_id": 104666486, "body": "Thanks for the answer ! Unfortunately, I&#39;ve added the other answer as it helped me to write a cleaner code in the end."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 1, "last_activity_date": 1575722024, "creation_date": 1575722024, "answer_id": 59225999, "question_id": 59225746, "link": "https://stackoverflow.com/questions/59225746/combining-generator-for-different-datatypes-in-quickcheck/59225999#59225999", "title": "Combining generator for different datatypes in Quickcheck", "body": "<p>The problem is that your <code>Proteins</code> data type doesn't actually contain any <code>AnimalProteins</code> or <code>Legumes</code>! Yes, you've named the <em>constructors</em> of <code>Proteins</code> the same way, but constructors live in the term language, not in the type language, so the compiler doesn't automatically associate them to the <code>AnimalProteins</code> <em>type</em>.</p>\n\n<p>To do that, you need to be explicit:</p>\n\n<pre><code>data Proteins = AnimalProteins AnimalProteins | Legumes Legumes\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 667, "user_id": 1773775, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/319d639ba5fe3f1b64a5c05454ea97ff?s=128&d=identicon&r=PG", "display_name": "alex_reader", "link": "https://stackoverflow.com/users/1773775/alex-reader"}, "edited": false, "score": 0, "creation_date": 1575724031, "post_id": 59226188, "comment_id": 104666495, "body": "Thanks for showing me <code>fmap</code>, it is indeed cleaner."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 1, "last_activity_date": 1575723571, "last_edit_date": 1575723571, "creation_date": 1575723265, "answer_id": 59226188, "question_id": 59225746, "link": "https://stackoverflow.com/questions/59225746/combining-generator-for-different-datatypes-in-quickcheck/59226188#59226188", "title": "Combining generator for different datatypes in Quickcheck", "body": "<p>Assuming that you intend to model <code>Proteins</code> as a choice between <code>AnimalProteins</code> and <code>Legumes</code>, you probable need something like this instead:</p>\n\n<pre><code>data AnimalProteins = Beef | Chicken | Fish deriving (Show, Eq)\ndata Legumes = WhiteBeans | RedBeans | Lentils | Chickpeas deriving (Show, Eq)\n\ndata Proteins = AP AnimalProteins | L Legumes deriving (Show, Eq)\n</code></pre>\n\n<p>You can combine generators like this:</p>\n\n<pre><code>rAnimalProteins :: Gen AnimalProteins\nrAnimalProteins = elements [Beef, Chicken, Fish]\n\nrLegumes :: Gen Legumes\nrLegumes = elements [WhiteBeans, RedBeans, Lentils, Chickpeas]\n\nrProteins :: Gen Proteins\nrProteins = oneof [fmap AP rAnimalProteins, fmap L rLegumes]\n</code></pre>\n\n<p>The <code>rAnimalProteins</code> and <code>rLegumes</code> are as you've already defined them. You can 'lift' them into two separate <code>Gen Proteins</code> values with <code>fmap</code>, since <code>Gen</code> is a <code>Functor</code>.</p>\n\n<p>For example, <code>fmap AP rAnimalProteins</code> maps the <code>Gen Legumes</code> value to a <code>Gen Proteins</code> value by mapping every generated <code>Legumes</code> value by wrapping it with the <code>AP</code> data constructor. While it's a <code>Gen Proteins</code> value, it'll always create <code>AP</code> values, that is, either <code>AP Beef</code>, <code>AP Chicken</code>, or <code>AP Fish</code>.</p>\n\n<p>Likewise, <code>fmap L rLegumes</code> lifts <code>rLegumes</code> from <code>Gen Legumes</code> to <code>Gen Proteins</code>. It'll always generate one of the values <code>L WhiteBeans</code>, <code>L RedBeans</code>, <code>L Lentils</code>, or <code>L Chickpeas</code>.</p>\n\n<p>By using <code>oneof</code>, you compose the two specialised generators to a more complex one that randomly selects one of those generators to generate a value.</p>\n"}], "owner": {"reputation": 667, "user_id": 1773775, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/319d639ba5fe3f1b64a5c05454ea97ff?s=128&d=identicon&r=PG", "display_name": "alex_reader", "link": "https://stackoverflow.com/users/1773775/alex-reader"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 59226188, "answer_count": 2, "score": 1, "last_activity_date": 1575723571, "creation_date": 1575719937, "last_edit_date": 1575722375, "question_id": 59225746, "link": "https://stackoverflow.com/questions/59225746/combining-generator-for-different-datatypes-in-quickcheck", "title": "Combining generator for different datatypes in Quickcheck", "body": "<p>I would like to combine two custom generators of different data type, but which are grouped together in another datatype.</p>\n\n<p>In the following example, I would like to use the generator for <code>Legumes</code> and <code>AnimalProteins</code> to create another one for Proteins. <code>choose</code> and <code>elements</code> does not work as the type are different. Casting the generators as <code>gen Proteins</code> does not work either.</p>\n\n<pre><code>data AnimalProteins = Beef | Chicken | Fish\ndata Legumes = WhiteBeans | RedBeans | Lentils | Chickpeas\n\ndata Proteins = AnimalProteins | Legumes deriving (Show)\n\nrAnimalProteins :: Gen AnimalProteins\nrAnimalProteins = elements [Beef , Chicken , Fish]\n\nrLegumes :: Gen Legumes\nrLegumes = elements [WhiteBeans , RedBeans , Lentils , Chickpeas]\n\n-- This does not work !\nrProteins :: Gen Proteins\nrProteins = choose (rLegumes, rAnimalProteins)\n</code></pre>\n\n<p>The solution may be simple but I'm quite stuck here as a beginner. Thanks !</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 41, "user_id": 9571776, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-FesSKFmssWI/AAAAAAAAAAI/AAAAAAAAAPY/cUNEphtI5Zw/photo.jpg?sz=128", "display_name": "Oleg Nykolyn", "link": "https://stackoverflow.com/users/9571776/oleg-nykolyn"}, "is_accepted": false, "score": 1, "last_activity_date": 1575721754, "creation_date": 1575721754, "answer_id": 59225955, "question_id": 59225502, "link": "https://stackoverflow.com/questions/59225502/split-a-string-by-a-chosen-character-in-haskell/59225955#59225955", "title": "Split a string by a chosen character in haskell", "body": "<p>\u2018Data.List.Split\u2019 is not in prelude and needs to be installed as a dependency package.\nInstall command depends on environment you are using:\n\u2018stack install split\u2019 for stack\n\u2018cabal install split\u2019 for cabal</p>\n"}, {"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 2, "last_activity_date": 1575721879, "creation_date": 1575721879, "answer_id": 59225974, "question_id": 59225502, "link": "https://stackoverflow.com/questions/59225502/split-a-string-by-a-chosen-character-in-haskell/59225974#59225974", "title": "Split a string by a chosen character in haskell", "body": "<p>If you're using <a href=\"https://en.wikipedia.org/wiki/Glasgow_Haskell_Compiler\" rel=\"nofollow noreferrer\">GHC</a> it comes with the standard Prelude and the modules in the <a href=\"http://hackage.haskell.org/package/base\" rel=\"nofollow noreferrer\">base package</a>, and perhaps a few other packages.</p>\n\n<p>Most packages, like the <a href=\"http://hackage.haskell.org/package/split\" rel=\"nofollow noreferrer\">split package</a> (which contains the <code>Data.List.Split</code> module), aren't part of GHC itself. You'll have to import them as an explicit compilation step. This is easiest done with a build tool. Most Haskellers use either <a href=\"https://www.haskell.org/cabal/\" rel=\"nofollow noreferrer\">Cabal</a> or <a href=\"https://docs.haskellstack.org/\" rel=\"nofollow noreferrer\">Stack</a>.</p>\n\n<p>With Stack, for example, you can add the <code>split</code> package to your <code>package.yaml</code> file:</p>\n\n<pre><code>dependencies:\n- base &gt;= 4.7 &amp;&amp; &lt; 5\n- split\n</code></pre>\n\n<p>You can also <a href=\"https://stackoverflow.com/a/39848577/126014\">load an extra package when you use Stack to start GHCi</a>. This is useful for ad-hoc experiments.</p>\n"}, {"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 1, "last_activity_date": 1575736521, "creation_date": 1575736521, "answer_id": 59228085, "question_id": 59225502, "link": "https://stackoverflow.com/questions/59225502/split-a-string-by-a-chosen-character-in-haskell/59228085#59228085", "title": "Split a string by a chosen character in haskell", "body": "<p>Basically this is a <code>foldr</code>ing job. So you may simply do like</p>\n\n<pre><code>\u03bb&gt; foldr (\\c (s:ss) -&gt; if c == ',' then \"\":s:ss else (c:s):ss) [\"\"] \"1,2,3,42,5\"\n[\"1\",\"2\",\"3\",\"42\",\"5\"]\n</code></pre>\n\n<p>So;</p>\n\n<pre><code>splitOn x = foldr (\\c (s:ss) -&gt; if c == x then \"\":s:ss else (c:s):ss) [\"\"]\n</code></pre>\n\n<p>However this will give us reasonable but perhaps not wanted results such as;</p>\n\n<pre><code>\u03bb&gt; splitOn ',' \",1,2,3,42,5,\"\n[\"\",\"1\",\"2\",\"3\",\"42\",\"5\",\"\"]\n</code></pre>\n\n<p>In this particular case it might be nice to trim the unwanted characters off of the string in advance. In Haskell though, this functionality i guess conventionally gets the name</p>\n\n<pre><code>dropAround :: (Char -&gt; Bool) -&gt; String -&gt; String\ndropAround b = dropWhile b . dropWhileEnd b\n\n\u03bb&gt; dropAround (==',') \",1,2,3,42,5,\"\n\"1,2,3,42,5\"\n</code></pre>\n\n<p>accordingly;</p>\n\n<pre><code>\u03bb&gt; splitOn (',') . dropAround (==',') $ \",1,2,3,42,5,\"\n[\"1\",\"2\",\"3\",\"42\",\"5\"]\n</code></pre>\n"}], "owner": {"reputation": 57, "user_id": 12387341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70aedd9870121ce97e4c01971ec649b0?s=128&d=identicon&r=PG&f=1", "display_name": "maf", "link": "https://stackoverflow.com/users/12387341/maf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "accepted_answer_id": 59225974, "answer_count": 3, "score": 1, "last_activity_date": 1575736521, "creation_date": 1575718138, "last_edit_date": 1575721963, "question_id": 59225502, "link": "https://stackoverflow.com/questions/59225502/split-a-string-by-a-chosen-character-in-haskell", "title": "Split a string by a chosen character in haskell", "body": "<p>I'm trying to split a string every time there is a chosen character. So if I receive <code>\"1,2,3,4,5\"</code>, and my chosen character is <code>\",\"</code> the result is a list such as <code>[\"1\",\"2\",\"3\",\"4\",\"5\"]</code>.</p>\n\n<p>I've been looking through the already answered questions in here and they point me to using <code>splitOn</code>. However, when i try to <code>import Data.List.Split</code> in order to use it, Haskell gives me the following error: <strong>Could not find module \u2018Data.List.Split\u2019</strong> . When I tried to just use <code>splitOn</code>without importing the module, it showed me <strong>Variable not in scope: splitOn</strong>.</p>\n\n<p>So my questions are,</p>\n\n<ol>\n<li>Is it normal that i'm getting this error? Is <code>splitOn</code> a viable option or should I just try something else?</li>\n<li>What other simple solutions are there?</li>\n</ol>\n\n<p>I can just write something that will do this for me but I'm wondering why I'm not able to import <code>Data.List.Split</code> and if there are other simpler options out there that I'm not seeing. Thank you!</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1575711823, "post_id": 59224618, "comment_id": 104663894, "body": "Is <code>lower</code> just <code>fmap (pure . runIdentity)</code>? What am I missing here?"}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1575712013, "post_id": 59224618, "comment_id": 104663920, "body": "@amalloy <code>ContT r Identity a</code> is <code>(a -&gt; Identity r) -&gt; Identity r</code>. Hence, <code>fmap</code> wouldn&#39;t work."}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1575861930, "post_id": 59224618, "comment_id": 104695409, "body": "@amalloy It turns out that <code>lower</code> is <code>hoist (pure . runIdentity)</code>, where <code>hoist</code> is a function defined by <a href=\"https://stackoverflow.com/users/34707/edward-kmett\">Edward Kmett</a> in his <a href=\"https://www.reddit.com/r/haskell/comments/106xwf/the_monadtrans_class_is_missing_a_method/\" rel=\"nofollow noreferrer\"><code>MonadHoist</code></a> class."}], "answers": [{"tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": true, "score": 1, "last_activity_date": 1575862648, "last_edit_date": 1592644375, "creation_date": 1575862648, "answer_id": 59242203, "question_id": 59224618, "link": "https://stackoverflow.com/questions/59224618/is-it-possible-to-write-a-function-of-the-type-monad-m-t-identity-a-t-m-a/59242203#59242203", "title": "Is it possible to write a function of the type `Monad m =&gt; t Identity a -&gt; t m a` for every monad transformer `t`?", "body": "<p>According to <a href=\"https://www.blogger.com/profile/12330175633010569183\" rel=\"nofollow noreferrer\">Mauro</a> we can't define a <code>MonadHoist</code> instance for <code>ContT</code><sup>[<a href=\"http://www.haskellforall.com/2012/09/the-monadtrans-class-is-missing-method.html?showComment=1348709161563#c8094017856997636775\" rel=\"nofollow noreferrer\">1</a>]</sup>.</p>\n<blockquote>\n<p>What Edward is proposing is to have a class of <em>functorial</em> monad transformers (transformers which are endofunctors in the category Mon(C) of monads over a category C and monad morphisms)</p>\n<p><strong>Note that some transformers, like the continuation monad transformer, are not functorial.</strong></p>\n</blockquote>\n"}], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 59242203, "answer_count": 1, "score": 1, "last_activity_date": 1575862648, "creation_date": 1575710799, "last_edit_date": 1575861786, "question_id": 59224618, "link": "https://stackoverflow.com/questions/59224618/is-it-possible-to-write-a-function-of-the-type-monad-m-t-identity-a-t-m-a", "title": "Is it possible to write a function of the type `Monad m =&gt; t Identity a -&gt; t m a` for every monad transformer `t`?", "body": "<p>Suppose we have the following type class.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class MonadTrans t =&gt; MonadLower t where\n    lower :: Monad m =&gt; t Identity a -&gt; t m a\n</code></pre>\n\n<p>As a trivial example, we can implement an instance of <code>MonadLower</code> for <code>MaybeT</code> as follows.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance MonadLower MaybeT where\n    lower (MaybeT (Identity maybe)) = MaybeT (return maybe)\n</code></pre>\n\n<p>However, I can't figure out how to implement an instance of <code>MonadLower</code> for <code>ContT r</code>.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance MonadLower (ContT r) where\n    lower (ContT f) = ContT $ \\k -&gt; ???\n</code></pre>\n\n<p>Is it even possible to create an instance of <code>MonadLower t</code> for every <code>MonadTrans t</code>?</p>\n\n<p>If not, which monad transformers (beside <code>ContT r</code>) can't have <code>MonadLower</code> instances?</p>\n\n<hr>\n\n<p><strong>Edit:</strong> <a href=\"https://stackoverflow.com/users/34707/edward-kmett\">Edward Kmett</a> has defined a similar type class called <a href=\"https://www.reddit.com/r/haskell/comments/106xwf/the_monadtrans_class_is_missing_a_method/\" rel=\"nofollow noreferrer\"><code>MonadHoist</code></a>.</p>\n\n\n\n<pre><code>class MonadHoist t where\n    hoist :: (Monad m, Monad n) =&gt; (forall a. m a -&gt; n a) -&gt; t m a -&gt; t n a\n</code></pre>\n\n<p>It turns out that <code>lower = hoist (return . runIdentity)</code>.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "is_accepted": false, "score": 2, "last_activity_date": 1575708197, "creation_date": 1575708197, "answer_id": 59224368, "question_id": 59224275, "link": "https://stackoverflow.com/questions/59224275/haskell-trying-to-understand-the-type-of-fmap-1/59224368#59224368", "title": "Haskell: trying to understand the type of fmap (+) (1)", "body": "<p>It's a simple consequence of the fact that number literals such as <code>1</code> are polymorphic - their type is <code>(Num a) =&gt; a</code>. In addition, there is no fixed list of numeric types, as Haskell allows you to make your own instances for any class - including <code>Num</code> - anywhere.</p>\n\n<p>As a result, in applying this:</p>\n\n<pre><code>Prelude&gt; :t  fmap (+)\nfmap (+) :: (Functor f, Num a) =&gt; f a -&gt; f (a -&gt; a)\n</code></pre>\n\n<p>to the literal <code>1</code>, the type checker only needs to check if it's possible to unify the type of <code>1</code> with the input type <code>f a</code>. Given the polymorphic type of <code>1</code> as above, this is clearly possible provided there is an instance of <code>Num</code> available for <code>f a</code> - as then <code>f a</code> is a valid type for <code>1</code>. And this explains the final type.</p>\n\n<p>As for <code>fmap (+) id</code>, this is rather different. Here GHC needs to unify <code>f a</code> (for a functor <code>f</code> and numeric <code>a</code>) with <code>a -&gt; a</code>, which results in the only possible choice for <code>f</code>, the \"function functor\" <code>((-&gt;) a)</code> (where <code>fmap</code> is just composition). That is <code>f b</code> here means <code>a -&gt; b</code>, and so <code>f (a -&gt; a)</code> is <code>a -&gt; a -&gt; a</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1575708663, "creation_date": 1575708663, "answer_id": 59224414, "question_id": 59224275, "link": "https://stackoverflow.com/questions/59224275/haskell-trying-to-understand-the-type-of-fmap-1/59224414#59224414", "title": "Haskell: trying to understand the type of fmap (+) (1)", "body": "<p>Numerical literals can fit <em>any</em> type, provided it is a numeric type (in class <code>Num</code>).</p>\n\n<p>GHC works under an open-world assumption, where even if a type does not belong to an instance right now, it might be in the future. This is because it is possible to write a new module and declare an instance there, and we want separate compilation.</p>\n\n<p>For numeric types, this means that even if a type is not numeric right now, it might still be later on.</p>\n\n<p>Suppose we write <code>reverse 1</code>. It looks wrong, since <code>reverse</code> expects a list, and <code>1</code> is not a list. Or is it? Even if <code>[a]</code> is not numeric now, it might be in the future, hence the type of <code>reverse 1</code> is <code>Num [a] =&gt; [a]</code>, and not a type error. Of course, under normal circumstances we won't have a <code>Num [a]</code> instance, but GHC can not assume that.</p>\n\n<p>In your specific example, <code>fmap</code> wants an <code>f a</code> and you pass <code>(1)</code>, which is the same as <code>1</code>. Here, this numeric literal gets instantiated as <code>Num (f a) =&gt; f a</code>, so that type checking works.</p>\n\n<pre><code>fmap (+) (1) :: (Functor f, Num a, Num (f a)) =&gt; f (a -&gt; a)\n</code></pre>\n\n<p>The above constraint <code>Num (f a)</code> is required to allow <code>1</code> to be interpreted in the type <code>f a</code>. Then <code>f</code> must be a functor because <code>fmap</code> requires it, and we must have <code>Num a</code> since <code>(+)</code> requires its argument to be numeric (the argument of <code>(+)</code> has type <code>a</code> and its result has type <code>a -&gt; a</code>, where <code>a</code> must be numeric). We get <code>f (a -&gt; a)</code> as a result again because of the return type of <code>(+)</code>.</p>\n\n<hr>\n\n<p>About <code>fmap (+) id</code>, this is simpler. Here <code>id :: (-&gt;) a a</code>, that is <code>id :: f a</code> where <code>f = (-&gt;) a</code>, which happens to be a functor. For this functor we have that <code>fmap = (.)</code>, the functional composition operator. Hence, <code>fmap (+) id</code> means <code>(.) (+) id</code>, or <code>(+) . id</code> which is simply <code>(+)</code>.</p>\n"}], "owner": {"reputation": 463, "user_id": 3203476, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c7935bf89df5baff4e39ea43be4ce4e?s=128&d=identicon&r=PG&f=1", "display_name": "user3203476", "link": "https://stackoverflow.com/users/3203476/user3203476"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 59224414, "answer_count": 2, "score": 4, "last_activity_date": 1575708663, "creation_date": 1575707359, "last_edit_date": 1575708132, "question_id": 59224275, "link": "https://stackoverflow.com/questions/59224275/haskell-trying-to-understand-the-type-of-fmap-1", "title": "Haskell: trying to understand the type of fmap (+) (1)", "body": "<p>i am trying to understand why there is no type error for <code>fmap (+) (1)</code></p>\n\n<p>I do understand the following sequence:</p>\n\n<pre><code>Prelude&gt; :t  fmap \nfmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\nPrelude&gt; :t  (+)  \n(+) :: Num a =&gt; a -&gt; a -&gt; a                          # like a-&gt; b with b = a -&gt; a\nPrelude&gt; :t  fmap (+)\nfmap (+) :: (Functor f, Num a) =&gt; f a -&gt; f (a -&gt; a)\nPrelude&gt; :t  fmap (+) (Just 1)                       \nfmap (+) (Just 1) :: Num a =&gt; Maybe (a -&gt; a)         # f=Maybe is implied by the Just constructor\nPrelude&gt;\n</code></pre>\n\n<p>I expected a type error for <code>fmap (+) (1)</code> since there is no functor implied for (1), instead i get:</p>\n\n<pre><code>Prelude&gt; :t (1)\n(1) :: Num p =&gt; p\nPrelude&gt; :t  (+)  \n(+) :: Num a =&gt; a -&gt; a -&gt; a                          \nPrelude&gt; :t  fmap (+)\nfmap (+) :: (Functor f, Num a) =&gt; f a -&gt; f (a -&gt; a)\nPrelude&gt; :t  fmap (+) (1)\nfmap (+) (1) :: (Functor f, Num a, Num (f a)) =&gt; f (a -&gt; a)  ## why ??\nPrelude&gt;\n</code></pre>\n\n<p>why is this ?</p>\n\n<p>Similarly, i don't understand the type of <code>fmap (+) id</code>:</p>\n\n<pre><code>Prelude&gt; :t  fmap (+)   \nfmap (+) :: (Functor f, Num a) =&gt; f a -&gt; f (a -&gt; a)\nPrelude&gt; :t  id      \nid :: a -&gt; a\nPrelude&gt; :t  fmap (+) id\nfmap (+) id :: Num a =&gt; a -&gt; a -&gt; a       ## why no error ?\nPrelude&gt;\n</code></pre>\n"}, {"tags": ["haskell", "types"], "answers": [{"comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1575708039, "post_id": 59224329, "comment_id": 104663203, "body": "Why can <code>Show</code> instances not be written for <code>TF</code>, and, further, why are they unnecessary?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1575709158, "post_id": 59224329, "comment_id": 104663428, "body": "@HTNW Instances must be associated to a type constructor to allow instance resolution. <code>TF</code> is a type family, and is disallowed. Indeed, we can not really expect GHC to solve a basic constraint like <code>C T</code> by observing that <code>T = F (some complex type)</code> and then realizing it can use the instance for type family <code>F</code> -- that would require too magic to solve undecidable problems. They are not nececessary in this case since in <code>TF p String</code> we have that <code>p</code> is <code>&#39;A</code> or <code>&#39;B</code>, so <code>TF p String</code> is either <code>()</code> or <code>String</code>. (We might need a singleton to prove <code>p</code> is such later on.)"}, {"owner": {"reputation": 2913, "user_id": 419132, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ceb79cce6e5c19e5a79b3b55cbbc8cd2?s=128&d=identicon&r=PG", "display_name": "wespiserA", "link": "https://stackoverflow.com/users/419132/wespisera"}, "edited": false, "score": 0, "creation_date": 1575710971, "post_id": 59224329, "comment_id": 104663755, "body": "Thank you! I understand that the <code>TF p String</code> is represented as <code>a</code> or <code>()</code> after type family application, but what&#39;s the reasoning behind adding the constraint <code>Show (TF p String)</code> ? Are type families not yet applied when type checking if <code>ShowMe</code> is a valid instance of Show?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2913, "user_id": 419132, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ceb79cce6e5c19e5a79b3b55cbbc8cd2?s=128&d=identicon&r=PG", "display_name": "wespiserA", "link": "https://stackoverflow.com/users/419132/wespisera"}, "edited": false, "score": 2, "creation_date": 1575712760, "post_id": 59224329, "comment_id": 104664043, "body": "@wespiserA GHC is not so powerful to make the reasoning step &quot;<code>TF p String</code> is either this or that, and in both cases we have <code>Show</code>, so we can assume <code>Show</code>&quot;. One of the reason which prevents that is that at runtime <code>p</code> is not known (types are erased for efficiency) so it can not be tested, hence GHC has to know during compilation which <code>Show</code> instance to use. Passing a context tells GHC to use that instance."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2913, "user_id": 419132, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ceb79cce6e5c19e5a79b3b55cbbc8cd2?s=128&d=identicon&r=PG", "display_name": "wespiserA", "link": "https://stackoverflow.com/users/419132/wespisera"}, "edited": false, "score": 1, "creation_date": 1575713306, "post_id": 59224329, "comment_id": 104664158, "body": "@wespiserA This is related to the fact that we can&#39;t define <code>whichOne :: forall p . Either (p :~: &#39;A) (p :~: &#39;B)</code> which would prove that <code>p</code> is either <code>A</code> or <code>B</code>. We could do that in dependently typed languages like Agda or Coq, but in Haskell we can&#39;t due to type erasure. Worse, Haskell allows <code>type family G t :: Tag</code> without any defining equations, causing <code>G Bool :: Tag</code> even if that can not be reduced to either <code>A</code> or <code>B</code> -- a sort of &quot;unspecified tag constant&quot;. This of course makes handling <code>TF (G Bool) String</code> impossible, since we can&#39;t simplify that type."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1575707834, "creation_date": 1575707834, "answer_id": 59224329, "question_id": 59224239, "link": "https://stackoverflow.com/questions/59224239/deriving-show-instance-for-adt-not-working-with-higher-kinded-type-families/59224329#59224329", "title": "Deriving Show Instance for ADT not working with Higher Kinded Type Families", "body": "<p>You need to add</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE UndecidableInstances #-}\n</code></pre>\n\n<p>and then suggest the wanted context to GHC:</p>\n\n<pre><code>deriving instance Show (TF p String) =&gt; Show (ShowMe p)\n</code></pre>\n\n<p>GHC won't add that context automatically since it can be surprising to the programmer.</p>\n"}], "owner": {"reputation": 2913, "user_id": 419132, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ceb79cce6e5c19e5a79b3b55cbbc8cd2?s=128&d=identicon&r=PG", "display_name": "wespiserA", "link": "https://stackoverflow.com/users/419132/wespisera"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 59224329, "answer_count": 1, "score": 0, "last_activity_date": 1575707834, "creation_date": 1575707060, "question_id": 59224239, "link": "https://stackoverflow.com/questions/59224239/deriving-show-instance-for-adt-not-working-with-higher-kinded-type-families", "title": "Deriving Show Instance for ADT not working with Higher Kinded Type Families", "body": "<p>I was just working through Chris Done's ADT with default example <a href=\"https://gist.github.com/chrisdone/7dddadd089e6a5d2e3e9445c4692d2c2\" rel=\"nofollow noreferrer\">gist available here</a> and ran into a problem: my ADT, with fields defined by higher kinded type families, is not working with a deriving show instance. GHC is telling me I need to derive a Show instance for a Type Family, but I'm not sure how to do. Here's what I have, so far, any comments would be helpful.</p>\n\n<p>In the following example (using <strong>ghc 8.8.1</strong>), the objective is to define an instance of <code>Show</code> for <code>ShowMe</code>, using derive if possible.</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE StandaloneDeriving #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE PartialTypeSignatures #-}\n{-# LANGUAGE ConstraintKinds #-}\n\ndata Tag = A | B deriving (Show)\n\ntype family TF (p :: Tag) a where\n  TF 'A a = ()\n  TF 'B a = a\n\ndata ShowMe p = ShowMe\n  { a :: !(TF p String)\n  , b :: String\n  }\n\nmain =  connect showMeDefaults { a = \"some string\" }\n   where\n     connect :: ShowMe B -&gt; IO ()\n     connect _ = pure ()\n     showMeDefaults :: ShowMe A\n     showMeDefaults = ShowMe { a = (), b = \"asdf\" }\n\n-- This works to define Show\n{-\ninstance Show (ShowMe p) where\n  show _ = \"hello\"\n-}\n-- This instance is the line that causes an error\nderiving instance Show (ShowMe p)\n</code></pre>\n\n<p>Subsequently, I'm getting an error that I'm not familiar with from GHC:</p>\n\n<pre><code>show_tf.hs:35:1: error:\n    \u2022 No instance for (Show (TF p String))\n        arising from a use of \u2018showsPrec\u2019\n    \u2022 In the first argument of \u2018(.)\u2019, namely \u2018(showsPrec 0 b1)\u2019\n      In the second argument of \u2018(.)\u2019, namely\n        \u2018((.)\n            (showsPrec 0 b1)\n            ((.)\n               GHC.Show.showCommaSpace\n               ((.)\n                  (showString \"b = \") ((.) (showsPrec 0 b2) (showString \"}\")))))\u2019\n      In the second argument of \u2018(.)\u2019, namely\n        \u2018((.)\n            (showString \"a = \")\n            ((.)\n               (showsPrec 0 b1)\n               ((.)\n                  GHC.Show.showCommaSpace\n                  ((.)\n                     (showString \"b = \") ((.) (showsPrec 0 b2) (showString \"}\"))))))\u2019\n      When typechecking the code for \u2018showsPrec\u2019\n        in a derived instance for \u2018Show (ShowMe p)\u2019:\n        To see the code I am typechecking, use -ddump-deriv\n   |\n35 | deriving instance Show (ShowMe p)\n</code></pre>\n\n<p>If we recompile, using the <code>ghc -ddump-deriv</code>, the following is returned:</p>\n\n<pre><code>[1 of 1] Compiling Main             ( show_tf.hs, show_tf.o )\n\n==================== Derived instances ====================\nDerived class instances:\n  instance GHC.Show.Show Main.Tag where\n    GHC.Show.showsPrec _ Main.A = GHC.Show.showString \"A\"\n    GHC.Show.showsPrec _ Main.B = GHC.Show.showString \"B\"\n\n\nDerived type family instances:\n\n\n\n==================== Filling in method body ====================\nGHC.Show.Show [Main.Tag]\n  GHC.Show.show = GHC.Show.$dmshow @(Main.Tag)\n\n\n\n==================== Filling in method body ====================\nGHC.Show.Show [Main.Tag]\n  GHC.Show.showList = GHC.Show.$dmshowList @(Main.Tag)\n\n\nLinking show_tf ...\n</code></pre>\n\n<p>Conceptually, I think what I should be able to derive a Show instance for <code>TF</code>, but when I do that, I get the following: </p>\n\n<pre><code>show_tf.hs:36:31: error:\n    \u2022 Illegal type synonym family application \u2018TF 'A a\u2019 in instance:\n        Show (TF 'A a)\n    \u2022 In the stand-alone deriving instance for\n        \u2018(Show a) =&gt; Show (TF 'A a)\u2019\n\n   |\n36 | deriving instance (Show a) =&gt; Show (TF 'A a)\n</code></pre>\n\n<p>This error also appears if I just try to define the Show instance myself for <code>TF 'A a</code>. I've searched \"Illegal type synonym\", and haven't come up up with a way around this.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 4, "creation_date": 1575689039, "post_id": 59222632, "comment_id": 104660536, "body": "You need to represent the numbers at <i>type level</i>.  <code>Integral k</code> means <code>k</code> is a type which contains integer(-like thing)s, but you want to say <code>k</code> is itself an integer.  Research type-level naturals, there is a lot of material about it."}, {"owner": {"reputation": 2577, "user_id": 6263317, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Imx4J.jpg?s=128&g=1", "display_name": "Jon Deaton", "link": "https://stackoverflow.com/users/6263317/jon-deaton"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1575689159, "post_id": 59222632, "comment_id": 104660549, "body": "Ahh thanks thats very helpful. Part of my issue was not knowing what the proper terms are to describe this to search for."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1575706553, "post_id": 59222632, "comment_id": 104662916, "body": "Like <a href=\"http://hackage.haskell.org/package/arithmoi-0.10.0.0/docs/Math-NumberTheory-Moduli-Class.html\" rel=\"nofollow noreferrer\">this</a>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1575719778, "post_id": 59222632, "comment_id": 104665590, "body": "Ir <a href=\"http://hackage.haskell.org/package/modular-arithmetic-1.2.1.5/docs/Data-Modular.html\" rel=\"nofollow noreferrer\">this</a>."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 1, "last_activity_date": 1575742091, "creation_date": 1575742091, "answer_id": 59228880, "question_id": 59222632, "link": "https://stackoverflow.com/questions/59222632/create-a-type-for-each-integer-in-haskell/59228880#59228880", "title": "Create a type for each Integer in Haskell?", "body": "<p>As noted in the comments, the idea is to make use of a type-level representation of natural numbers, so you have separate identifiable types for 2 versus 3 versus 4, etc.  This requires an extension:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n</code></pre>\n\n<p>There are two main methods for representing naturals as types.  The first is to define a recursive data type:</p>\n\n<pre><code>data Nat' = Z | S Nat'\n</code></pre>\n\n<p>which the <code>DataKinds</code> extension automatically lifts to the type level.  You can then use this as, among other things, a type-level tag to define a family of related but distinct types:</p>\n\n<pre><code>{-# LANGUAGE KindSignatures #-}\ndata Foo (n :: Nat') = Foo Int\n\ntwoFoo :: Foo (S (S Z))\ntwoFoo = Foo 10\n\nthreeFoo :: Foo (S (S (S Z)))\nthreeFoo = Foo 20\n\naddFoos :: Foo n -&gt; Foo n -&gt; Foo n\naddFoos (Foo x) (Foo y) = Foo (x + y)\n\nokay = addFoos twoFoo twoFoo\nbad =  addFoos twoFoo threefoo -- error: different types\n</code></pre>\n\n<p>The second is to use a built-in GHC facility that automatically lifts integer literals, like <code>2</code> and <code>3</code> to the type level.  It works much the same way:</p>\n\n<pre><code>import GHC.TypeLits (Nat)\n\ndata Foo (n :: Nat) = Foo Int\n\ntwoFoo :: Foo 2\ntwoFoo = Foo 10\n\nthreeFoo :: Foo 3\nthreeFoo = Foo 20\n\naddFoos :: Foo n -&gt; Foo n -&gt; Foo n\naddFoos (Foo x) (Foo y) = Foo (x + y)\n\nokay = addFoos twoFoo twoFoo\nbad =  addFoos twoFoo threefoo -- type error\n</code></pre>\n\n<p>When you're using naturals only to \"tag\" a type, it's generally more convenient to use the <code>GHC.TypeLits</code> version of <code>Nat</code>.  If you have to actually do type-level computations on the types, some computations are more easily done using the recursive version.</p>\n\n<p>Since we only need the naturals as tags, we can stick with the <code>GHC.TypeLits</code> solution.  So, we'd define your data type like so:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE KindSignatures #-}\nimport GHC.TypeLits\ndata Z (n :: Nat) = El Integer\n</code></pre>\n\n<p>In the <code>Show</code> instance, we need to make use of some other facilities in <code>GHC.TypeLits</code> to convert the type-level <code>Nat</code> to a value-level <code>Integer</code> that we can include in the printed representation:</p>\n\n<pre><code>instance (KnownNat n) =&gt; Show (Z n) where\n  show el@(El e) = show e ++ \" (mod \" ++ show (natVal el) ++ \")\"\n</code></pre>\n\n<p>There's magic going on here!  The <code>natVal</code> function has signature:</p>\n\n<pre><code>natVal :: forall n proxy. KnownNat n =&gt; proxy n -&gt; Integer\n</code></pre>\n\n<p>meaning that for a <code>\"KnownNat\"</code>, whatever that means, it can take a proxy value whose type is of form <code>proxy n</code>, and return the actual integer corresponding to the type-level argument <code>n</code>.  Fortunately, our original element has type <code>Z n</code> which fits the <code>proxy n</code> type pattern just fine, so by running <code>natVal el</code>, we get the value-level <code>Integer</code> corresponding to the type-level <code>n</code> in <code>Z n</code>.</p>\n\n<p>We'll use the same magic in the <code>Integral</code> instance:</p>\n\n<pre><code>instance (KnownNat k) =&gt; Num (Z k) where\n    (+) el@(El a) (El b) = El (mod (a + b) k) where k = natVal el\n    (-) el@(El a) (El b) = El (mod (a - b) k) where k = natVal el\n    (*) el@(El a) (El b) = El (mod (a * b) k) where k = natVal el\n    negate el@(El a) = El (mod (0 - a) k) where k = natVal el\n    abs el@(El a) = El a where k = natVal el\n    signum el@(El a) = El 1\n    fromInteger i = El (fromIntegral i)\n</code></pre>\n\n<p>Note that the <code>k</code> disappears from the <code>El</code> constructor, because it's not a data-level quantity.  Where needed, it can be retrieved using <code>natVal el</code> using the <code>KnownNat</code> instance.</p>\n\n<p>The full program is:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE KindSignatures #-}\nimport GHC.TypeLits\ndata Z (n :: Nat) = El Integer\n\ninstance (KnownNat n) =&gt; Show (Z n) where\n  show el@(El e) = show e ++ \" (mod \" ++ show (natVal el) ++ \")\"\n\ninstance (KnownNat k) =&gt; Num (Z k) where\n    (+) el@(El a) (El b) = El (mod (a + b) k) where k = natVal el\n    (-) el@(El a) (El b) = El (mod (a - b) k) where k = natVal el\n    (*) el@(El a) (El b) = El (mod (a * b) k) where k = natVal el\n    negate el@(El a) = El (mod (0 - a) k) where k = natVal el\n    abs el@(El a) = El a where k = natVal el\n    signum el@(El a) = El 1\n    fromInteger i = El (fromIntegral i)\n</code></pre>\n\n<p>and it works as intended:</p>\n\n<pre><code>&gt; :set -XDataKinds\n&gt; (El 2 :: Z 5) + (El 3 :: Z 5)\n0 (mod 5)\n&gt; (El 2 :: Z 5) + (El 3 :: Z 7)\n\n&lt;interactive&gt;:15:18: error:\n    \u2022 Couldn't match type \u20187\u2019 with \u20185\u2019\n      Expected type: Z 5\n        Actual type: Z 7\n    \u2022 In the second argument of \u2018(+)\u2019, namely \u2018(El 3 :: Z 7)\u2019\n      In the expression: (El 2 :: Z 5) + (El 3 :: Z 7)\n      In an equation for \u2018it\u2019: it = (El 2 :: Z 5) + (El 3 :: Z 7)\n</code></pre>\n"}], "owner": {"reputation": 2577, "user_id": 6263317, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Imx4J.jpg?s=128&g=1", "display_name": "Jon Deaton", "link": "https://stackoverflow.com/users/6263317/jon-deaton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 59228880, "answer_count": 1, "score": 3, "last_activity_date": 1575931727, "creation_date": 1575687951, "last_edit_date": 1575931727, "question_id": 59222632, "link": "https://stackoverflow.com/questions/59222632/create-a-type-for-each-integer-in-haskell", "title": "Create a type for each Integer in Haskell?", "body": "<p>I would like to create a data type in Haskell that represents the integers mod <code>n</code>, and which is an instance of <code>Num</code> to help perform simple modular arithmetic operations. My first attempt at this looked like this</p>\n\n<pre><code>data Z n e = El n e\ninstance (Show n, Show e) =&gt; Show (Z n e) where\n    show (El n e) = show e ++ \" (mod \" ++ show n ++ \")\"\n\ninstance (Integral k, Integral e) =&gt; Num (Z k e) where\n    (+) (El n a) (El m b) = El n (mod (a + b) n)\n    (-) (El n a) (El m b) = El n (mod (a - b) n)\n    (*) (El n a) (El m b) = El n (mod (a * b) n)\n    negate (El n a) = El n (mod (0 - a) n)\n    abs (El n a) = El n a\n    signum (El n a) = El n a\n    fromInteger i = -- problematic...\n</code></pre>\n\n<p>This compiles but is problematic not only because its unclear how to implement <code>fromInteger</code> since <code>k</code> is out of scope, but also because it is permissible to add an integer <code>mod 4</code> with an integer <code>mod 5</code> without a type error. In my second attempt I tried to resolve these issues</p>\n\n<pre><code>data Z n = El Integer\ninstance (Show n) =&gt; Show (Z n) where\n    show (El n e) = show e ++ \" (mod \" ++ show n ++ \")\"\n\ninstance (Integral k) =&gt; Num (Z k) where\n    (+) (El k a) (El k b) = El k (mod (a + b) k)\n    (-) (El k a) (El k b) = El k (mod (a - b) k)\n    (*) (El k a) (El k b) = El k (mod (a * b) k)\n    negate (El k a) = El k (mod (0 - a) k)\n    abs (El k a) = El k a\n    signum (El k a) = El k a\n    fromInteger i = El (fromIntegral i) k\n</code></pre>\n\n<p>but I am running into trouble implementing the <code>Num</code> interface because of conflicting definitions of <code>k</code> which is still out of scope. How can I make such a data type in Haskell?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 0, "creation_date": 1575680625, "post_id": 59221967, "comment_id": 104659452, "body": "I wanted <code>U</code> to be like a <code>newtype</code> wrapper of <code>i</code>, carrying the constraints without loss of information. Can <code>U</code> be defined as a function instead? Something like <code>emulatedDataConstructor :: (Integral i,j) =&gt; i -&gt; j -&gt; (i, j)</code>?"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 2, "creation_date": 1575685077, "post_id": 59221967, "comment_id": 104660101, "body": "@sevo Did you want <code>data U = forall i. Integral i =&gt; U i</code>? The <code>forall</code> has to go outside the constructor for that. However a) I smell an XY problem and b) that type probably can and should be algebra&#39;d down to something simpler (<code>Integer</code>?) (in the same way that <code>data U = forall i. Show i =&gt; U i</code> can be reduced to <code>data U = U String</code> (pedantically, <code>Either Natural Int -&gt; String</code>)). What is <code>U</code> <i>for</i>?"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 8, "last_activity_date": 1575678700, "creation_date": 1575678700, "answer_id": 59221967, "question_id": 59221622, "link": "https://stackoverflow.com/questions/59221622/loss-of-information-with-rankntypes-and-do-notation/59221967#59221967", "title": "Loss of information with RankNTypes and do notation", "body": "<p>I think you're misinterpreting the type signature:</p>\n\n<pre><code>z :: (Integral i) =&gt; Parser i\n</code></pre>\n\n<p>This does <strong>not</strong> indicate that <code>z</code> (or equivalently <code>decimal</code>) is a parser that returns a <code>forall i. (Integral i) =&gt; i</code> (i.e., a value of some general type <code>i</code> that's left unspecified at compile time except for its <code>Integral</code>-ness).</p>\n\n<p>Rather, it says that <code>z</code> is a polymorphic parser function with type of form <code>Parser i</code> that can be instantiated for <code>i</code> at any specific <code>Integral</code> type, so <code>z</code> can be a <code>Parser Int</code> (parser that returns an <code>Int</code>) or a <code>Parser Word8</code> (parser that returns a <code>Word8</code>) and so on, meaning that if you actually use <code>z</code> to parse an integral quantity and it returns a value, that value has a specific, concrete type like <code>Int</code> or <code>Integer</code> that's known and fixed at compile time.</p>\n\n<p>So, there's no need (and no way, short of converting between numeric types) to store it as a value in \"<code>Integral</code> type limbo\", the way you're trying to do here.</p>\n\n<p>In this specific code, because <code>c &lt;- z</code> uses <code>z</code> in a context that under-specifies how <code>Parser i</code> should be concretely instantiated, GHC applies its defaulting rules to instantiate it at <code>Parser Integer</code>.  This gives <code>c</code> the type <code>Integer</code>, which does not match the type of the field in the <code>U</code> constructor, hence the error.</p>\n\n<p>In order to do what you're trying to do, you'd want a parser of type:</p>\n\n<pre><code>z :: Parser (forall i. Integral i =&gt; i)\n</code></pre>\n\n<p>Because Haskell doesn't support something with the unlikely name of \"impredicative polymorphism\", this type signature isn't valid.  You can fake it by using a wrapper (exactly the wrapper <code>U</code> that you already have), so you <em>could</em> write a <code>z :: Parser U</code>.  Specifically, you could write it:</p>\n\n<pre><code>z :: Parser U\nz = do\n  n &lt;- P.decimal\n  return $ U { c = fromIntegral n }\n</code></pre>\n\n<p>This looks like it's doing something exciting, but it's not.  <code>P.decimal</code> is again instantiated at <code>Parser Integer</code> by the defaulting rules, so <code>n</code> is just an <code>Integer</code>, but <code>fromIntegral</code> generalizes it to any <code>Num</code> type, which satisfies the field type of <code>U</code>.  In other words, this is just the \"converting between numeric types\" I was talking about before.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1575678700, "creation_date": 1575675112, "question_id": 59221622, "link": "https://stackoverflow.com/questions/59221622/loss-of-information-with-rankntypes-and-do-notation", "title": "Loss of information with RankNTypes and do notation", "body": "<p>Given this code:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\nmodule MyLib where\n\nimport Data.Attoparsec.Text as P\n\ndata U = U { c :: forall i. (Integral i) =&gt; i }\n\nz :: (Integral i) =&gt; Parser i\nz = P.decimal\n\nparse :: Parser U\nparse = do \n    c &lt;- z\n    return $ U { c = c }\n</code></pre>\n\n<p>Why does GHC insist that <code>c</code> is of the type of <code>Integer</code>, not <code>forall i. (Integral i) =&gt; i</code>?</p>\n\n<pre><code>rankntypesdo.hs:15:22: error:\n    \u2022 Couldn't match expected type \u2018i\u2019 with actual type \u2018Integer\u2019\n      \u2018i\u2019 is a rigid type variable bound by\n        a type expected by the context:\n          forall i. Integral i =&gt; i\n        at rankntypesdo.hs:15:14-24\n    \u2022 In the \u2018c\u2019 field of a record\n      In the second argument of \u2018($)\u2019, namely \u2018U {c = c}\u2019\n      In a stmt of a 'do' block: return $ U {c = c}\n   |\n15 |     return $ U { c = c }\n   |                      ^\n\n\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1575672871, "creation_date": 1575672871, "answer_id": 59221346, "question_id": 59221326, "link": "https://stackoverflow.com/questions/59221326/sum-of-consecutives-numbers-from-a-list-using-list-comprehension/59221346#59221346", "title": "Sum of consecutives numbers from a list using List Comprehension", "body": "<p>You can make use of <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:tails\" rel=\"nofollow noreferrer\"><strong><code>tails :: [a] -&gt; [[a]]</code></strong></a> here to iterate over every two consecutive elements, and sum these:</p>\n\n<pre><code>import Data.List(<b>tails</b>)\n\nfunc :: Num n =&gt; [n] -&gt; [n]\nfunc xs = [x1+x2 | (x1:x2:_) &lt;- <b>tails</b> xs]</code></pre>\n"}, {"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 2, "last_activity_date": 1575673084, "creation_date": 1575673084, "answer_id": 59221379, "question_id": 59221326, "link": "https://stackoverflow.com/questions/59221326/sum-of-consecutives-numbers-from-a-list-using-list-comprehension/59221379#59221379", "title": "Sum of consecutives numbers from a list using List Comprehension", "body": "<p>The classic answer to problems of this sort is to zip a list together with its own tail, yielding tuples of consecutive elements, which you can further process however you like. In this case, you just want to add them, so you can write:</p>\n\n<pre><code>f xs = zipWith (+) xs (tail xs)\n</code></pre>\n\n<p>or if you are feeling clever, there is a standard trick for \"combine a list with its tail\":</p>\n\n<pre><code>f = zipWith (+) &lt;*&gt; tail\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 12493794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95011e32b9a982df2c941fc6e8dc3fe7?s=128&d=identicon&r=PG&f=1", "display_name": "bug2012", "link": "https://stackoverflow.com/users/12493794/bug2012"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 59221346, "answer_count": 2, "score": 1, "last_activity_date": 1575673084, "creation_date": 1575672680, "question_id": 59221326, "link": "https://stackoverflow.com/questions/59221326/sum-of-consecutives-numbers-from-a-list-using-list-comprehension", "title": "Sum of consecutives numbers from a list using List Comprehension", "body": "<p>I have to create a program that sum the head of a list with his consecutive number frlm the list using <strong>list comprehension</strong>. It hace to be something like this:\nfunc [1,2,3,4,5]   -> shows [3,5,7,9]\nfunc [2,0,1,2]  -> it shows [2,1,3]</p>\n\n<p>I'm trying with this</p>\n\n<pre><code>func [] = []\nfunc (c:d:xs) = [y | x&lt;-d:xs, y&lt;- (c+d)] ++ func (d:xs)\n</code></pre>\n\n<p>but obviously isn't working </p>\n"}, {"tags": ["string", "list", "haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1575663438, "post_id": 59219705, "comment_id": 104654981, "body": "The function <a href=\"https://hoogle.haskell.org/?hoogle=replicate\" rel=\"nofollow noreferrer\"><code>replicate</code></a> may be of use to you. Really though, you should make an attempt and ask about any issues that arise with that, rather than just asking for a solution."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1575663455, "post_id": 59219705, "comment_id": 104654983, "body": "first of all, it&#39;s <code>createField (4, 5)</code>. second, can you write what <code>createField (4, 1)</code> should return? or even <code>createField (4, 0)</code>? do you see how to get the former from the latter? and then <code>createField (4, 2)</code> from <code>createField (4, 1)</code>? can this be generalized?"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1575663986, "creation_date": 1575663986, "answer_id": 59219913, "question_id": 59219705, "link": "https://stackoverflow.com/questions/59219705/create-list-of-strings/59219913#59219913", "title": "Create list of strings", "body": "<p>Although not wrong, using a 2-tuple for parameters is not very common. It is more <em>Haskell-ish</em> to write a function with signature:</p>\n\n<pre><code>createField :: <b>Int -&gt; Int</b> -&gt; [String]</code></pre>\n\n<p>you can then invoke this with <code>createField 4 5</code> for example.</p>\n\n<p>You can make make use of <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:replicate\" rel=\"nofollow noreferrer\"><strong><code>replicate :: Int -&gt; a -&gt; [a]</code></strong></a> here, both to construct the <code>String</code> <em>and</em> the list of <code>String</code>s. For example:</p>\n\n<pre><code>GHCi&gt; replicate 4 '.'\n\"....\"\n</code></pre>\n\n<p>I leave it as an exercise to construct the list itself. The function will be of the form:</p>\n\n<pre><code>createField :: Int -&gt; Int -&gt; [String]\ncreateField m n = _ (replicate m '.')\n</code></pre>\n\n<p>Where the <code>_</code> is something you need to fill in yourself.</p>\n"}], "owner": {"reputation": 13, "user_id": 12493154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c35ac930042eb9ff360a2695c8653a2e?s=128&d=identicon&r=PG&f=1", "display_name": "Drew1515", "link": "https://stackoverflow.com/users/12493154/drew1515"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "closed_date": 1575667344, "accepted_answer_id": 59219913, "answer_count": 1, "score": 0, "last_activity_date": 1575663986, "creation_date": 1575663032, "question_id": 59219705, "link": "https://stackoverflow.com/questions/59219705/create-list-of-strings", "closed_reason": "Duplicate", "title": "Create list of strings", "body": "<p>I have list of strings</p>\n\n<pre><code>field :: [String]\nfield = [\"......\",\n         \"......\",\n         \"......\",\n         \"......\",\n         \"......\",\n         \"......\"] \n</code></pre>\n\n<p>But it is static. I am trying to write function, that take two numbers (length of one string X and number of all strings Y).</p>\n\n<pre><code>createField :: (Int, Int) -&gt; [String]\n</code></pre>\n\n<p>For example: \n<code>createField 4, 5</code></p>\n\n<p>It should return this</p>\n\n<pre><code>[\"....\",\n \"....\",\n \"....\",\n \"....\",\n \"....\"] \n</code></pre>\n\n<p>Can you help me with this?</p>\n"}, {"tags": ["haskell", "reflection", "ghc", "ghci"], "answers": [{"tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 5, "last_activity_date": 1575659909, "last_edit_date": 1575659909, "creation_date": 1575656048, "answer_id": 59218341, "question_id": 59218075, "link": "https://stackoverflow.com/questions/59218075/how-can-i-interrogate-the-current-ghci-environment/59218341#59218341", "title": "How can I interrogate the current GHCi environment?", "body": "<p>I'd start by looking at template Haskell for this. The various <a href=\"https://hackage.haskell.org/package/template-haskell-2.15.0.0/docs/Language-Haskell-TH.html#g:3\" rel=\"nofollow noreferrer\">reify functions</a> let you extract information from the compiler environment.  I don't have a proof of concept around for this, but it looks like it should be doable.</p>\n"}], "owner": {"reputation": 1373, "user_id": 1277934, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1b24cd3f51d70811c40605802b3205d2?s=128&d=identicon&r=PG", "display_name": "Mark Dominus", "link": "https://stackoverflow.com/users/1277934/mark-dominus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 59218341, "answer_count": 1, "score": 4, "last_activity_date": 1575659909, "creation_date": 1575654763, "last_edit_date": 1575655953, "question_id": 59218075, "link": "https://stackoverflow.com/questions/59218075/how-can-i-interrogate-the-current-ghci-environment", "title": "How can I interrogate the current GHCi environment?", "body": "<p>I want to produce revised, fresh versions of this diagram, which appears in the Haskell98 standard:</p>\n\n<p><a href=\"https://i.stack.imgur.com/5xsYP.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/5xsYP.gif\" alt=\"enter image description here\"></a></p>\n\n<p>In 2019 I will do this by generating a description of the graph I want, and feeding it to Graphviz.  A proof-of-concept implementation I did yesterday, told only that there is something called <code>Monad</code>, can automatically produce this diagram:</p>\n\n<p><a href=\"https://i.stack.imgur.com/BggGt.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/BggGt.png\" alt=\"enter image description here\"></a></p>\n\n<p>The proof-of-concept program is rather awful, because the way it traverses the graph is by sending <code>:info</code> commands to GHCi and attempting to parse the output.  I am not interested in pushing this approach any further.</p>\n\n<p>The right way to do this is to figure out how GHC represents the class and instance information internally, then use its API to interrogate those data structures directly.</p>\n\n<p>I have spent quite some time looking around in <a href=\"https://downloads.haskell.org/~ghc/7.10.2/docs/html/libraries/ghc-7.10.2/\" rel=\"nofollow noreferrer\">the GHC API documents</a> but I have not found the entry points I need.</p>\n\n<p>I think I want to ask GHC for a list of the names of all the typeclass and instance information currently in scope, and for a description of the constraints for each one.</p>\n\n<blockquote>\n  <p>What are good ways to proceed with this? Where should I be looking?</p>\n</blockquote>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1575651980, "post_id": 59217393, "comment_id": 104650703, "body": "General, your data type stays unconstrained, and you put the constraints on functions that use values. That is, <code>data Foo a = ...</code> can use values of any type <code>a</code>, but <code>fooOp :: Integral a =&gt; Foo a -&gt; Foo a</code> can only a subset of all possible <code>Foo a</code> types."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1575652093, "post_id": 59217393, "comment_id": 104650755, "body": "What are you actually trying to do? There are two things your description might mean, and both are somewhere between &quot;extremely niche&quot; and &quot;don&#39;t do this&quot;. What&#39;s the use case? What do you want to happen?"}, {"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 0, "creation_date": 1575654869, "post_id": 59217393, "comment_id": 104651909, "body": "I wanted to to parse a few numbers from input lines like &quot;some_text 1 2 15%&quot; using Haskell and print out sums of some columns. Got stuck with type classes because I wasn&#39;t sure if the numbers were integers or floats and couldn&#39;t figure out what to do. I got impression that either type should work, just didn&#39;t know how to construct the record containing that one type."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 2, "creation_date": 1575655553, "post_id": 59217393, "comment_id": 104652137, "body": "Then this is definitely not how you want to do it. Classes shouldn&#39;t be involved at all. Maybe you want to use <code>Rational</code>. Maybe you want a  data type with constructors for each of <code>Integer</code> and <code>Double</code> and promotion rules for how to do arithmetic when the operands are mixed. But you are parsing data with a fixed format. You don&#39;t need to support whatever esoteric flavors of <code>Integral</code> might happen to be defined in your code or a library it imports."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1575658837, "post_id": 59217393, "comment_id": 104653286, "body": "I second what Carl wrote. If you really can not commit to a specific numeric type, make your record type be parametric over it, e.g. <code>data MyRecord a = { x1 :: a , x2 :: String , x3 :: [a] }</code>, and then write something like <code>myParser :: Integral a =&gt; Parser (MyRecord a)</code>. You&#39;ll need to add <code>Integral a =&gt;</code> to a lot of other function. In any case, I don&#39;t think you really want a universal or existential quantification in your record type. Stick to <code>Integer</code>, or use the parametric approach I just suggested."}, {"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1575659370, "post_id": 59217393, "comment_id": 104653504, "body": "Thanks @chi, this actually helped me to recall the &quot;pattern&quot; that I completely forgot about."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1575670639, "post_id": 59217393, "comment_id": 104657399, "body": "Re: your &quot;EDIT&quot;.  Actually, there&#39;s exactly one answer and half a comment telling you not to do that.  There are 2.5 comments and one answer telling you exactly how to do it."}], "answers": [{"comments": [{"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 0, "creation_date": 1575672828, "post_id": 59217523, "comment_id": 104657956, "body": "If I understand correctly, the &quot;ExistentialQuantification&quot; version loses information contained in <code>decimal</code> result, so it cannot be a correct answer. It sounds that &quot;RankNTypes&quot; does propagate the information fully - a caller of <code>decimal</code> can pick any type satisfying the constraint. Please help me confirm and I&#39;ll be happy to mark the answer as accepted."}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": false, "score": 0, "last_activity_date": 1575652151, "creation_date": 1575652151, "answer_id": 59217523, "question_id": 59217393, "link": "https://stackoverflow.com/questions/59217393/how-does-one-put-typeclass-into-a-record/59217523#59217523", "title": "How does one put typeclass into a record?", "body": "<p>I can interpret your question in two different ways. Depending on which one you meant, one of these will be what you're asking for:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\ndata Foo = MkFoo { bar :: forall a. Integral a =&gt; a }\n</code></pre>\n\n<p>In the first one, you can only put in polymorphic things that can become any possible <code>Integral</code>, and as a result, you can use it as whatever <code>Integral</code> type you want when you take it out. This is a higher-rank type.</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\n\ndata Foo = forall a. Integral a =&gt; MkFoo { bar :: a }\n</code></pre>\n\n<p>In the second one, you can put in any <code>Integral</code> type you want, but then when you take it out, the exact type is forgotten, so you can only do things on it that the <code>Integral</code> typeclass allows, rather than anything specific to the type you put in. This is an existential type.</p>\n"}, {"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 1, "last_activity_date": 1575661771, "last_edit_date": 1575661771, "creation_date": 1575660758, "answer_id": 59219258, "question_id": 59217393, "link": "https://stackoverflow.com/questions/59217393/how-does-one-put-typeclass-into-a-record/59219258#59219258", "title": "How does one put typeclass into a record?", "body": "<p>If only there was a numeric type that could somehow store both integers <em>and</em> floating point numbers...</p>\n\n<pre><code>x :: [Double]\nx = [10, 3.1415]\n</code></pre>\n\n<p>Well, would you look at that!</p>\n\n<p>In short, unless you are batshit crazy or parsing a few billion lines of ad hoc data where floating point performance becomes a critical issue, you should just use <code>Double</code>.  The function <code>fromIntegral</code> would do a bang up job converting the result from <code>decimal</code> to a <code>Double</code>, but since you want to be able to parse both <code>10</code> and <code>3.1415</code>, you don't want to use <code>decimal</code> anyway.  Use <a href=\"http://hackage.haskell.org/package/attoparsec-0.13.2.3/docs/Data-Attoparsec-Text.html#v:double\" rel=\"nofollow noreferrer\"><code>double</code></a>.</p>\n\n<p>And before anyone says anything foolish, calculations on integral <code>Double</code> values are always exact, unless you need to store a number with absolute value greater than <a href=\"https://stackoverflow.com/a/1848762/7203016\">2^53</a> = 9007199254740992.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1575669890, "creation_date": 1575651614, "last_edit_date": 1575669890, "question_id": 59217393, "link": "https://stackoverflow.com/questions/59217393/how-does-one-put-typeclass-into-a-record", "title": "How does one put typeclass into a record?", "body": "<p>While dusting off Haskell, I wanted to parse some ad-hoc data. </p>\n\n<p>I found <a href=\"http://hackage.haskell.org/package/attoparsec-0.13.2.3/docs/Data-Attoparsec-Text.html#v:decimal\" rel=\"nofollow noreferrer\">decimal</a> that can parse a number.</p>\n\n<p>But I cannot put things like <code>Integral a</code> into a record easily. What is the recommended approach to put such data into a structure with named fields?</p>\n\n<p>EDIT: There's a lot of answers/comments of the kind \"don't\" and \"why would you want to do that\". So, let me restate the question: given <code>decimal :: Integral a =&gt; Parser a</code>, and that I can get <code>a</code> by running the parser, how do I put that <code>a</code> into a record?</p>\n"}, {"tags": ["haskell", "type-theory", "hindley-milner"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 2, "creation_date": 1575648193, "post_id": 59216254, "comment_id": 104648992, "body": "Constraints can be desugared into dictionary passing so the problem is reduced to one without constraints, but types can be higher-rank, I&#39;m pretty sure that makes the problem undecidable. The name of this class of problems is &quot;proof search&quot; if you want to start looking around."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 8, "creation_date": 1575648468, "post_id": 59216254, "comment_id": 104649122, "body": "Have you seen the <a href=\"https://www.joachim-breitner.de/blog/735-The_magic_%E2%80%9CJust_do_it%E2%80%9D_type_class\" rel=\"nofollow noreferrer\">&quot;Just do it&quot;</a> typeclass?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1575650431, "post_id": 59216254, "comment_id": 104650040, "body": "Maybe the fixed set of constraints makes it still decidable after all..."}], "answers": [{"tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": true, "score": 5, "last_activity_date": 1575659433, "creation_date": 1575659433, "answer_id": 59218977, "question_id": 59216254, "link": "https://stackoverflow.com/questions/59216254/is-there-an-effective-way-to-generate-a-function-given-a-generic-esp-with-mona/59218977#59218977", "title": "Is there an effective way to generate a function given a generic (esp. with monads) type signature in Haskell?", "body": "<p>Amazingly enough, this is actually possible! Have a look at <a href=\"https://www.hedonisticlearning.com/djinn/\" rel=\"noreferrer\">Djinn</a> (or you could compile <a href=\"https://github.com/augustss/djinn\" rel=\"noreferrer\">the executable</a> yourself), which implements this for you. For instance, given <code>f :: a -&gt; (a -&gt; b) -&gt; (a -&gt; b -&gt; c) -&gt; c</code>, Djinn outputs <code>f a b c = c a (b a)</code> (amongst other possibilities). You can find more examples (with the command-line version) at <a href=\"http://lambda-the-ultimate.org/node/1178\" rel=\"noreferrer\">http://lambda-the-ultimate.org/node/1178</a>. Unfortunately it doesn\u2019t support typeclasses though, but I wouldn\u2019t rule out another tool that I haven\u2019t found which does support them.</p>\n\n<p>(If you\u2019re interested in how this works, read up about the <em>Curry-Howard Isomorphism</em>, which states that a program in a language such as Haskell is equivalent to a proof. For instance, writing an implementation for <code>f :: a -&gt; (a -&gt; b) -&gt; (a -&gt; b -&gt; c) -&gt; c</code> is equivalent to proving the statement \u2018given a proposition <code>a</code>, then if <code>a</code> implies <code>b</code>, and <code>a</code> and <code>b</code> together imply <code>c</code>, then <code>c</code> is true\u2019. Because of this, you can use an automated prover to figure out the implementation and then just mechanically translate this into code to get an implementation.)</p>\n"}], "owner": {"reputation": 161, "user_id": 10930850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b0d0d1a42c2b9ca84ac1d6102d547ef?s=128&d=identicon&r=PG&f=1", "display_name": "Trebor", "link": "https://stackoverflow.com/users/10930850/trebor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 1, "accepted_answer_id": 59218977, "answer_count": 1, "score": 5, "last_activity_date": 1575659433, "creation_date": 1575647108, "question_id": 59216254, "link": "https://stackoverflow.com/questions/59216254/is-there-an-effective-way-to-generate-a-function-given-a-generic-esp-with-mona", "title": "Is there an effective way to generate a function given a generic (esp. with monads) type signature in Haskell?", "body": "<p>I have already seen a variety of questions of the form \"Given type signature <code>XXX</code>, find implementation in Haskell.\" Therefore it is natural to ask whether this can be generalized or algorithmized. A similar question is <a href=\"https://stackoverflow.com/questions/10205793/given-a-haskell-type-signature-is-it-possible-to-generate-the-code-automaticall\">here</a>. However, it is clear that generally this task is impossible. So the next question is to trade some generality for practicality.</p>\n\n<blockquote>\n  <p><strong>Question</strong>: Is the problem decidable if all the type signatures consists of rigid type variables together with some constraints, drawn from a fixed set (e.g. <code>Monad, Traversable, Foldable</code>?)</p>\n</blockquote>\n\n<p>A typical problem would be <code>(Monad m) =&gt; (m j -&gt; [m d]) -&gt; m [j] -&gt; [m [d]]</code>, where I used <code>[]</code> instead of <code>(..Constraints t) =&gt; t</code> for convenience.</p>\n"}, {"tags": ["parsing", "haskell", "monads"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 2, "creation_date": 1575610979, "post_id": 59207437, "comment_id": 104632325, "body": "Why do you think you need an equivalent of <code>try</code>?"}, {"owner": {"reputation": 3991, "user_id": 6378530, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5325e39f6f9f2d12029b11d4f8e56a69?s=128&d=identicon&r=PG&f=1", "display_name": "doctopus", "link": "https://stackoverflow.com/users/6378530/doctopus"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1575611047, "post_id": 59207437, "comment_id": 104632343, "body": "I&#39;m parsing HTML and need it for lookahead functions"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1575611113, "post_id": 59207437, "comment_id": 104632363, "body": "Your <code>(&gt;&gt;=)</code> method looks suspect. What if <code>doParse p1 cs</code> returns more than one result -- or none, for that matter?"}, {"owner": {"reputation": 3991, "user_id": 6378530, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5325e39f6f9f2d12029b11d4f8e56a69?s=128&d=identicon&r=PG&f=1", "display_name": "doctopus", "link": "https://stackoverflow.com/users/6378530/doctopus"}, "edited": false, "score": 0, "creation_date": 1575611194, "post_id": 59207437, "comment_id": 104632396, "body": "Yes at the moment it only returns the first result.."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1575611215, "post_id": 59207437, "comment_id": 104632404, "body": "I would start with a test here.  Show (yourself first of all) what you need to parse and how your current combinators fall short. Keep it simple."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 3, "last_activity_date": 1575745369, "creation_date": 1575745369, "answer_id": 59229284, "question_id": 59207437, "link": "https://stackoverflow.com/questions/59207437/how-to-implement-parsecs-try-method/59229284#59229284", "title": "How to implement parsec&#39;s try method?", "body": "<p>You don't need <code>try</code> for your kind of parser.  Or, if you really want one, you can define it trivially as:</p>\n\n<pre><code>try :: Parser a -&gt; Parser a\ntry = id\n</code></pre>\n\n<p>Parsec makes a distinction between failing after consuming some input and failing without consuming any input.  For example, if you look at the documentation for Parsec's <a href=\"https://hackage.haskell.org/package/parsec-3.1.14.0/docs/Text-Parsec.html#v:-60--124--62-\" rel=\"nofollow noreferrer\"><code>(&lt;|&gt;)</code></a>, you'll find an important emphasized piece of text:</p>\n\n<blockquote>\n  <p>The parser <code>p &lt;|&gt; q</code> first applies <code>p</code>. If it succeeds, the value of <code>p</code> is returned. If <code>p</code> fails <strong><em>without consuming any input,</em></strong> parser <code>q</code> is tried.</p>\n</blockquote>\n\n<p>Unstated is the fact that, if <code>p</code> fails after consuming partial input, the whole thing fails and <code>q</code> is never tried.  That means that in Parsec, the parser:</p>\n\n<pre><code>broken :: Parser String\nbroken = string \"hello\" &lt;|&gt; string \"hi\"\n</code></pre>\n\n<p>doesn't work.  It can parse <code>\"hello\"</code>, but it can't parse <code>\"hi\"</code>, because the first parser <code>string \"hello\"</code> consumes the <code>\"h\"</code> before discovering that the rest doesn't match, so it never tries the <code>string \"hi\"</code> parser:</p>\n\n<pre><code>&gt; parseTest broken \"hello\"\n\"hello\"\n&gt; parseTest broken \"hi\"\nparse error at (line 1, column 1):\nunexpected \"i\"\nexpecting \"hello\"\n</code></pre>\n\n<p>To fix this, you have to use <code>try</code>, which allows you to override this rule:</p>\n\n<pre><code>okay :: Parser String\nokay = try (string \"hello\") &lt;|&gt; string \"hi\"\n</code></pre>\n\n<p>giving:</p>\n\n<pre><code>&gt; parseTest okay \"hello\"\n\"hello\"\n&gt; parseTest okay \"hi\"\n\"hi\"\n</code></pre>\n\n<p>Your parser is different.  Even though you haven't given a definition of <code>choose</code>, I can tell from your <code>Parser</code> type that it has no sensible way of signalling \"failure after consuming input\" versus \"failure without consuming input\", so your implementation of <code>p &lt;|&gt; q</code> undoubtedly tries <code>q</code> whenever <code>p</code> fails, even if it fails after processing a bit of input.</p>\n\n<p>As a result, your parser acts as if every single term is surrounded by <code>try</code>, so a <code>try</code> function would be redundant.</p>\n"}], "owner": {"reputation": 3991, "user_id": 6378530, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5325e39f6f9f2d12029b11d4f8e56a69?s=128&d=identicon&r=PG&f=1", "display_name": "doctopus", "link": "https://stackoverflow.com/users/6378530/doctopus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 59229284, "answer_count": 1, "score": 1, "last_activity_date": 1575745369, "creation_date": 1575610457, "last_edit_date": 1575611593, "question_id": 59207437, "link": "https://stackoverflow.com/questions/59207437/how-to-implement-parsecs-try-method", "title": "How to implement parsec&#39;s try method?", "body": "<p>I want to implement the same method as parsec's <a href=\"https://hackage.haskell.org/package/parsec-3.1.14.0/docs/Text-Parsec.html#v:try\" rel=\"nofollow noreferrer\">try</a> method. But instead of using a parse transformer, I am using a <code>Parser</code> object that holds state:</p>\n\n<pre><code>try :: Parser String -&gt; Parser String\ntry p = P $ \\s -&gt; case doParse p s of\n            [] -&gt; [(\"\", s)]\n            [(a, s')] -&gt; [(a, s')]\n</code></pre>\n\n<p>I'm pretty sure my effort is way off the mark here. So any help would be greatly appreciated.</p>\n\n<pre><code>newtype Parser a = P (String -&gt; [(a, String)])\n\ninstance Functor Parser where\n   fmap = liftA\n\ninstance Applicative Parser where\n   pure x    = P (\\cs -&gt; [ (x,cs) ])\n   p1 &lt;*&gt; p2 = P (\\cs -&gt; do (f, cs')  &lt;- doParse p1 cs\n                            (x, cs'') &lt;- doParse p2 cs'\n                            return (f x, cs''))\n\ninstance Monad Parser where\n    return = pure\n    p1 &gt;&gt;= f = P (\\cs -&gt; let [(a, s)] = doParse p1 cs\n                         in doParse (f a) s)\n\ninstance Alternative Parser where\n  -- the parser that always fails\n  empty     = P $ const []\n  -- | Combine two parsers together in parallel, but only use the\n  -- first result. This means that the second parser is used only\n  -- if the first parser completely fails.\n  p1 &lt;|&gt; p2 = P $ \\cs -&gt; case doParse (p1 `choose` p2) cs of\n                          []   -&gt; []\n                          x:_ -&gt; [x]\n\ndoParse :: Parser a -&gt; String -&gt; [(a, String)]\ndoParse (P p) = p\n</code></pre>\n\n<p>EDIT:</p>\n\n<p>Example of what I would like to parse:</p>\n\n<pre><code>&lt;!-- This is a random \n     HTML\n   Comment --&gt;\n</code></pre>\n\n<p>By running:</p>\n\n<pre><code>doParse simpleComment excomment\n</code></pre>\n\n<p>simpleComment is taken from the Parsec website, along with manyTill:</p>\n\n<pre><code>simpleComment   = do{ string \"&lt;!--\"\n                     ; manyTill anyChar (try (string \"--&gt;\"))\n                     }\n\nmanyTill p end      = scan\n                    where\n                      scan  = do{ _ &lt;- end; return [] }\n                            &lt;|&gt;\n                              do{ x &lt;- p; xs &lt;- scan; return (x:xs) }\n</code></pre>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 2, "creation_date": 1575593637, "post_id": 59204924, "comment_id": 104628608, "body": "Would it be useful to suggest you use <code>stack</code> to build and run executables? All my cabal problems went away when I started using <code>stack</code>."}], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 0, "closed_date": 1575621897, "answer_count": 0, "score": 1, "last_activity_date": 1575599116, "creation_date": 1575590063, "question_id": 59204924, "link": "https://stackoverflow.com/questions/59204924/executable-cant-find-imported-module", "closed_reason": "Duplicate", "title": "Executable can&#39;t find imported module", "body": "<p>I'm using <code>cabal-3.0.0.0</code> to build a very simple executable:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- 2019/day/5/part1.hs\nmodule Main where\nimport Test.DocTest (doctest)\n\nmain :: IO ()\nmain = do\n  doctest [\"2019/day/5/part1.hs\"]\n  return ()\n</code></pre>\n\n<p>With this in my cabalfile:</p>\n\n<pre><code>-- advent-of-code.cabal\n-- ...\nexecutable day5-part1\n  main-is:             2019/day/5/part1.hs\n  build-depends:       base, doctest\n  default-language:    Haskell2010\n</code></pre>\n\n<p>It builds fine:</p>\n\n<pre><code>\u27a4 cabal --version\ncabal-install version 3.0.0.0\ncompiled using version 3.0.0.0 of the Cabal library\n\u27a4 cabal build day5-part1\nResolving dependencies...\nBuild profile: -w ghc-8.6.5 -O1\nIn order, the following will be built (use -v for more details):\n - advent-of-code-0.1.0.0 (exe:day5-part1) (first run)\nConfiguring executable 'day5-part1' for advent-of-code-0.1.0.0..\nPreprocessing executable 'day5-part1' for advent-of-code-0.1.0.0..\nBuilding executable 'day5-part1' for advent-of-code-0.1.0.0..\n[1 of 1] Compiling Main             ( 2019/day/5/part1.hs, /Users/rampion/Projects/AdventOfCode2019/dist-newstyle/build/x86_64-osx/ghc-8.6.5/advent-of-code-0.1.0.0/x/day5-part1/build/day5-part1/day5-part1-tmp/Main.o )\nLinking /Users/rampion/Projects/AdventOfCode2019/dist-newstyle/build/x86_64-osx/ghc-8.6.5/advent-of-code-0.1.0.0/x/day5-part1/build/day5-part1/day5-part1 ...\n</code></pre>\n\n<p>But fails at runtime:</p>\n\n<pre><code>\u27a4 cabal run day5-part1\nUp to date\n\n2019/day/5/part1.hs:2:1: error:\n    Could not find module \u2018Test.DocTest\u2019\n    Use -v to see a list of the files searched for.\n  |\n2 | import Test.DocTest (doctest)\n  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 1, "creation_date": 1575573336, "post_id": 59201769, "comment_id": 104621522, "body": "You should perhaps considert folding the list."}, {"owner": {"reputation": 17170, "user_id": 1671066, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bd4c9461f2d17a884fba66eeed20e320?s=128&d=identicon&r=PG", "display_name": "Micha Wiedenmann", "link": "https://stackoverflow.com/users/1671066/micha-wiedenmann"}, "edited": false, "score": 0, "creation_date": 1575573572, "post_id": 59201769, "comment_id": 104621647, "body": "Is there anything you tried that failed?"}, {"owner": {"reputation": 17170, "user_id": 1671066, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bd4c9461f2d17a884fba66eeed20e320?s=128&d=identicon&r=PG", "display_name": "Micha Wiedenmann", "link": "https://stackoverflow.com/users/1671066/micha-wiedenmann"}, "edited": false, "score": 3, "creation_date": 1575573619, "post_id": 59201769, "comment_id": 104621671, "body": "What would you do to determine the highest number of <code>[3, 2, 5]</code>?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 6, "creation_date": 1575573644, "post_id": 59201769, "comment_id": 104621681, "body": "Try <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:maximumBy\" rel=\"nofollow noreferrer\"><code>maximumBy</code></a>."}, {"owner": {"reputation": 1, "user_id": 12461848, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ccf8562a2efa09cffb2d4a1d5bad2a6d?s=128&d=identicon&r=PG&f=1", "display_name": "lowtiersmush", "link": "https://stackoverflow.com/users/12461848/lowtiersmush"}, "edited": false, "score": 0, "creation_date": 1575575212, "post_id": 59201769, "comment_id": 104622402, "body": "Could you give me a headsup on how to begin?"}, {"owner": {"reputation": 1, "user_id": 12461848, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ccf8562a2efa09cffb2d4a1d5bad2a6d?s=128&d=identicon&r=PG&f=1", "display_name": "lowtiersmush", "link": "https://stackoverflow.com/users/12461848/lowtiersmush"}, "edited": false, "score": 0, "creation_date": 1575575351, "post_id": 59201769, "comment_id": 104622465, "body": "If I use the maximum function it will only look on the first item in the tuple. I want it to only look at the number"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1575576131, "post_id": 59201769, "comment_id": 104622776, "body": "What if there are two tuples with the maximum number as second item?"}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 5, "last_activity_date": 1575577905, "creation_date": 1575577905, "answer_id": 59202860, "question_id": 59201769, "link": "https://stackoverflow.com/questions/59201769/get-the-highest-value-of-tuple/59202860#59202860", "title": "Get the highest value of tuple?", "body": "<p>Use <code>Data.List.maximumBy</code> with <code>Data.Ord.comparing</code> to create the comparison function to use in place of the <code>Ord</code> instance for tuples.</p>\n\n<pre><code>&gt;&gt;&gt; maximum [(\"zoo\", 1), (\"ant\", 10)]\n(\"zoo\", 1)  -- Because (\"zoo\", 1) &gt; (\"ant\", 10), because \"zoo\" &gt; \"ant\"\n&gt;&gt;&gt; maximumBy (comparing snd) [(\"zoo\", 1), (\"ant\", 10)]\n(\"ant\", 10)  -- Because 10 &gt; 1\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 12492057, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ec2158cf25891be580a54d917740c8f?s=128&d=identicon&r=PG&f=1", "display_name": "SanchezSDario", "link": "https://stackoverflow.com/users/12492057/sanchezsdario"}, "is_accepted": false, "score": 0, "last_activity_date": 1575645175, "creation_date": 1575645175, "answer_id": 59215734, "question_id": 59201769, "link": "https://stackoverflow.com/questions/59201769/get-the-highest-value-of-tuple/59215734#59215734", "title": "Get the highest value of tuple?", "body": "<p>First attempt:</p>\n\n<pre><code>maxTupleL :: [(a, Int)] -&gt; (a, Int)\nmaxTupleL (t:[]) = t\nmaxTupleL (t:ts) = maxT t (maxTupleL ts)\n\nmaxT :: (a, Int) -&gt; (a, Int) -&gt; (a, Int)\nmaxT (v1, n) (v2, m) = if (n &gt; m)\n                       then (v1, n)\n                       else (v2, m)\n</code></pre>\n\n<hr>\n\n<p>Maybe you should try using a fold but you need to handle the empty list case (which I don't handle), the if-clause could be changed, as I said this is a first attempt.\nPlease modify the title of the question, It doesn't match the question itself.</p>\n"}], "owner": {"reputation": 1, "user_id": 12461848, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ccf8562a2efa09cffb2d4a1d5bad2a6d?s=128&d=identicon&r=PG&f=1", "display_name": "lowtiersmush", "link": "https://stackoverflow.com/users/12461848/lowtiersmush"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1575645175, "creation_date": 1575572630, "last_edit_date": 1575573559, "question_id": 59201769, "link": "https://stackoverflow.com/questions/59201769/get-the-highest-value-of-tuple", "title": "Get the highest value of tuple?", "body": "<p>If I have ha list of tuple like <code>[(\"candy\",3), (\"icecream\",2), (\"meat\",6)]</code>. How do I get the tuple with the highest number?</p>\n\n<p>Otherwise, Would a recursive function that collects all the numbers be of help? If so, how would I do?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1575572096, "post_id": 59201442, "comment_id": 104620922, "body": "What are the types UglyForm and PrettyForm?"}, {"owner": {"reputation": 15, "user_id": 8716469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/167963634d9fba251ec03f2a12fd5f57?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/8716469/max"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1575572595, "post_id": 59201442, "comment_id": 104621163, "body": "the difference between Ugly and Pretty forms - Pretty allowed to have arrays, while Ugly forced to be recursive. For example UglyForm = Variable Int | Applicatoin UglyForm UglyForm, while PrettyForm = Vatiable Int | Applicatoin PrettyForm [PrettyForm]"}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1575590582, "post_id": 59201442, "comment_id": 104627854, "body": "I am not sure why this question is sub-zero voted. I find it to be an entertaining line of thought."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1575636698, "post_id": 59201442, "comment_id": 104643203, "body": "It&#39;s downvoted because the question itself shows no effort to actually write <code>makePretty</code>. Self-answered questions are fine, but this reads more like a blog post than an actual question."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1575715402, "post_id": 59201442, "comment_id": 104664594, "body": "I downvoted because the question lacks sufficient information to answer it. The OP&#39;s answer is fine (and positively voted), but it relies on a bunch of information that wasn&#39;t in the question."}], "answers": [{"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 1, "creation_date": 1575631823, "post_id": 59205591, "comment_id": 104640902, "body": "I support your posting here with my votes. But you may also try <a href=\"https://www.reddit.com/r/haskell/\" rel=\"nofollow noreferrer\">the Haskell subreddit</a>. It is a different kind of mess, and may be more conducive to your <i>&quot;informal&quot;</i> manner of conversation."}], "tags": [], "owner": {"reputation": 15, "user_id": 8716469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/167963634d9fba251ec03f2a12fd5f57?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/8716469/max"}, "is_accepted": true, "score": 0, "last_activity_date": 1575595549, "creation_date": 1575595549, "answer_id": 59205591, "question_id": 59201442, "link": "https://stackoverflow.com/questions/59201442/writing-a-sugar-function-in-haskell/59205591#59205591", "title": "Writing a sugar function in Haskell", "body": "<p>It looks like I shouldn't post here. Sorry for annoying this community. </p>\n\n<p>Here is an answer in case somebody else would meet the same problem. </p>\n\n<p>I'm using here the idea from CPS (Continuation Passing Style) and auxiliary function to not be involved in type conflicts. </p>\n\n<pre><code>sugar :: UglyForm -&gt; PrettyForm\nsugar (Variable s) = Variable' s\nsugar (Operator x y) = peelExpr (Operator' [x] (sugar y))\n\npeelExpr :: PrettyForm -&gt; PrettyForm\npeelExpr (Operator' x (Operator' y z)) = peelExpr (Operator' (x++y) z)\npeelExpr (Operator' x y) = Operator' x y\n</code></pre>\n\n<p>It looks simple and even trivial, so my apologies. \nThis is simplified version that should on input:</p>\n\n<p><code>Operator \"x\" (Operator \"y\" (Operator \"z\" (Variable \"a\")))</code></p>\n\n<p>give you an answer </p>\n\n<p><code>Operator' [\"x\",\"y\",\"z\"] (Variable' \"a\")</code></p>\n\n<p>Data type could look like:  </p>\n\n<pre><code>UglyForm = Variable String | Operator String UglyForm \nPrettyForm = Vatiable' String | Operator' [String] PrettyForm\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 8716469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/167963634d9fba251ec03f2a12fd5f57?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/8716469/max"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 59205591, "answer_count": 1, "score": -3, "last_activity_date": 1575595549, "creation_date": 1575571316, "question_id": 59201442, "link": "https://stackoverflow.com/questions/59201442/writing-a-sugar-function-in-haskell", "title": "Writing a sugar function in Haskell", "body": "<p>I was trying to write a function that \"sugars\" lambda expressions, but it looks like I'm doing everything wrong. \nIdea is to have a function:</p>\n\n<p><code>makePretty :: UglyForm -&gt; PrettyForm</code> that on input: </p>\n\n<p><code>(1+(2+(3+4)))</code> outputs <code>+ [1,2,3] (4)</code></p>\n\n<p>and</p>\n\n<p><code>(div (div (div 1 2) 3) 4)</code> results in <code>div (1) [2,3,4]</code></p>\n\n<p>This is a simplified version but the logic of transformation should be the same. I'm new to Haskell so my apologies if this is a trivial thing to ask, but I just can't help myself and need a gentle push towards a right direction. </p>\n"}, {"tags": ["haskell", "post", "scotty"], "answers": [{"comments": [{"owner": {"reputation": 328, "user_id": 1131412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19fbce08ff13604a854921ba208b597b?s=128&d=identicon&r=PG&f=1", "display_name": "mttpgn", "link": "https://stackoverflow.com/users/1131412/mttpgn"}, "edited": false, "score": 0, "creation_date": 1575566041, "post_id": 59199930, "comment_id": 104618128, "body": "Amazing. By the way, <code>_ &lt;- lift $ rawSystem ...</code> produces an error &quot;The last statement in a &#39;do&#39; block must be an expression&quot;. However, <code>void . lift $ rawSystem ...</code> works perfectly."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "reply_to_user": {"reputation": 328, "user_id": 1131412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19fbce08ff13604a854921ba208b597b?s=128&d=identicon&r=PG&f=1", "display_name": "mttpgn", "link": "https://stackoverflow.com/users/1131412/mttpgn"}, "edited": false, "score": 1, "creation_date": 1575566094, "post_id": 59199930, "comment_id": 104618152, "body": "That is why I also added <code>pure ()</code>. You must have glanced over it."}, {"owner": {"reputation": 328, "user_id": 1131412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19fbce08ff13604a854921ba208b597b?s=128&d=identicon&r=PG&f=1", "display_name": "mttpgn", "link": "https://stackoverflow.com/users/1131412/mttpgn"}, "edited": false, "score": 0, "creation_date": 1575566473, "post_id": 59199930, "comment_id": 104618327, "body": "That appears exactly to be what happened. Thanks!"}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 3, "last_activity_date": 1575565687, "last_edit_date": 1575565687, "creation_date": 1575565117, "answer_id": 59199930, "question_id": 59199528, "link": "https://stackoverflow.com/questions/59199528/execute-shell-script-from-a-post-request-with-scotty/59199930#59199930", "title": "Execute shell script from a POST request with scotty", "body": "<p>The mismatch is in the monad in which the functions run. <code>rawSystem</code> runs in the <code>IO</code> monad, as indicated by <a href=\"https://www.stackage.org/haddock/lts-14.16/process-1.6.5.0/System-Cmd.html#v:rawSystem\" rel=\"nofollow noreferrer\">its type</a>, as well as in the error message. But <code>scotty</code>'s <code>run</code> function expects a thing that runs in the <a href=\"https://www.stackage.org/haddock/lts-14.16/scotty-0.11.5/Web-Scotty-Internal-Types.html#t:ActionT\" rel=\"nofollow noreferrer\"><code>ActionT e m</code> monad</a>. </p>\n\n<p>The error message tells you as much: <em>cannot match type <code>IO _</code> with <code>ActionT Text IO _</code></em>.</p>\n\n<p>Since <code>ActionT</code> has an instance of <code>MonadTrans</code>, you can just <a href=\"https://www.stackage.org/haddock/lts-14.16/transformers-0.5.6.2/Control-Monad-Trans-Class.html#v:lift\" rel=\"nofollow noreferrer\"><code>lift</code></a> an <code>IO</code> function into <code>ActionT _ IO</code>:</p>\n\n<pre><code>lift $ rawSystem \"./shellscript.sh\" [...]\n</code></pre>\n\n<p>After you have done that, your next problem will be the return type: <code>rawSystem</code> returns an <code>ExitCode</code>, while <code>scotty</code>'s <code>run</code> function expects unit. If you're ok just throwing away the exit code (though I don't recomment it), you can either bind it to an unnamed variable:</p>\n\n<pre><code>_ &lt;- lift $ rawSystem ...\npure ()\n</code></pre>\n\n<p>Or, better yet, you can use <a href=\"https://www.stackage.org/haddock/lts-14.16/base-4.12.0.0/Control-Monad.html#v:void\" rel=\"nofollow noreferrer\"><code>void</code></a> to discard the value:</p>\n\n<pre><code>void . lift $ rawSystem ...\n</code></pre>\n"}], "owner": {"reputation": 328, "user_id": 1131412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19fbce08ff13604a854921ba208b597b?s=128&d=identicon&r=PG&f=1", "display_name": "mttpgn", "link": "https://stackoverflow.com/users/1131412/mttpgn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 59199930, "answer_count": 1, "score": 2, "last_activity_date": 1575642847, "creation_date": 1575563521, "last_edit_date": 1575642847, "question_id": 59199528, "link": "https://stackoverflow.com/questions/59199528/execute-shell-script-from-a-post-request-with-scotty", "title": "Execute shell script from a POST request with scotty", "body": "<p>I'm using scotty and I'm getting the same type error any way I try to execute a shell script from a POST request.</p>\n\n<pre><code>main = scotty 3000 $ do    \n  post \"MyPage/ScriptTime/run\" $ do\n      aparameter &lt;- param \"aparameter\"\n      bparameter &lt;- param \"bparameter\"\n      cparameter &lt;- param \"cparameter\"\n      dparameter &lt;- param \"dparameter\"\n      eparameter &lt;- param \"eparameter\"\n      rawSystem \"./shellscript.sh\" [ \"-a\"\n                                   , aparameter\n                                   , \"-b\"\n                                   , bparameter\n                                   , \"-c\"\n                                   , cparameter\n                                   , dparameter\n                                   , eparameter\n                                   ]\n</code></pre>\n\n<p>Using the answers on <a href=\"https://stackoverflow.com/questions/10536614/is-it-possible-to-invoke-bash-or-shell-scripts-from-a-haskell-program\">Is it possible to invoke bash or shell scripts from a haskell program?</a> and <a href=\"https://stackoverflow.com/questions/3470955/executing-a-system-command-in-haskell\">Executing a system command in Haskell</a> have not helped me change the error message.</p>\n\n<p>The error reads:</p>\n\n<pre><code>Main.hs:68:5: error:\n\u2022 Couldn't match type \u2018IO\u2019\n                 with \u2018Web.Scotty.Internal.Types.ActionT\n                         Data.Text.Internal.Lazy.Text IO\u2019\n  Expected type: Web.Scotty.Internal.Types.ActionT\n                   Data.Text.Internal.Lazy.Text IO ()\n    Actual type: IO GHC.IO.Exception.ExitCode\n\u2022 In a stmt of a 'do' block:\n    rawSystem \"./shellscript.sh\" [\"-a\", aparameter, \"-b\", bparameter, ....]\n  In the second argument of \u2018($)\u2019, namely\n    \u2018do aparameter &lt;- param \"aparameter\"\n        bparameter &lt;- param \"bparameter\"\n        cparameter &lt;- param \"cparameter\"\n        dparameter &lt;- param \"dparameter\"\n        ....\u2019\n</code></pre>\n\n<p>I've changed the function and library used for invoking the shell script several ways, including:</p>\n\n<p><code>() &lt;- createProcess (proc \"./shellscript.sh\" [\"-a\", aparameter, \"-b\", bparameter, ...])</code></p>\n\n<p><code>runProcess (shell \"./shellscript.sh -a aparameter -b bparameter ...\") &gt;&gt;= print</code></p>\n\n<p>I have tried using System.Process, System.Process.Typed, and System.Cmd libraries. </p>\n\n<p>Can someone help me understand my type mismatch.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 8185086, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67159d6a04157a0a8f572a8a4e27d378?s=128&d=identicon&r=PG&f=1", "display_name": "Lazare Rossillon", "link": "https://stackoverflow.com/users/8185086/lazare-rossillon"}, "edited": false, "score": 0, "creation_date": 1575566714, "post_id": 59199771, "comment_id": 104618454, "body": "Thanks. I had noticed it missed a concat."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1575567050, "post_id": 59199771, "comment_id": 104618634, "body": "There is an <code>Applicative</code> solution, namely <code>flip applyOperator  operator &lt;$&gt; secondList &lt;*&gt; firstList</code>. If you use <code>ApplicativeDo</code>, that might be what the <code>do</code> block desugars to."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1575567275, "post_id": 59199771, "comment_id": 104618734, "body": "@chepner Doesn&#39;t that have the same problem as my original wrong answer, in that it will create an extra layer of nesting?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1575567658, "post_id": 59199771, "comment_id": 104618898, "body": "Maybe I&#39;m misinterpreting what the output should be (especially since my suggestion is the same as <code>liftA2</code>, just spelled differently)."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1575567738, "post_id": 59199771, "comment_id": 104618936, "body": "But isn&#39;t your <code>do</code> block <i>also</i> the same, especially if <code>ApplicativeDo</code> is in use? The extra layer of nesting would come, I think, from using <code>test</code>, which your updated solution ignores."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1575567918, "post_id": 59199771, "comment_id": 104619026, "body": "@chepner Consider <code>do x &lt;- xs; y &lt;- ys; f xs ys</code> vs. <code>do x &lt;- xs; y &lt;- ys; pure (f xs ys)</code>. My original answer and your comment are basically the second, but based on the original code in the question, the OP wants the first."}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": true, "score": 1, "last_activity_date": 1575567347, "last_edit_date": 1575567347, "creation_date": 1575564499, "answer_id": 59199771, "question_id": 59199411, "link": "https://stackoverflow.com/questions/59199411/apply-a-function-to-every-element-in-a-list-to-every-element-in-another-list/59199771#59199771", "title": "Apply a function to every element in a list to every element in another list", "body": "<p>This can be done concisely with a <code>do</code> block:</p>\n\n<pre><code>applyOperatorBetweenVariableLists firstList operator secondList = do\n  secondVariable &lt;- secondList\n  firstVariable &lt;- firstList\n  applyOperatorBetweenVariables secondVariable operator firstVariable\n</code></pre>\n\n<p>If you wanted to be even more concise, you could reorder the arguments to both <code>applyOperatorBetweenVariableLists</code> and <code>applyOperatorBetweenVariables</code>, and then use either <a href=\"https://hackage.haskell.org/package/utility-ht-0.0.14/docs/Control-Monad-HT.html#v:liftJoin2\" rel=\"nofollow noreferrer\"><code>liftJoin2</code></a> or <a href=\"https://hackage.haskell.org/package/util-0.1.14.0/docs/Util.html#v:bind2\" rel=\"nofollow noreferrer\"><code>bind2</code></a> to implement it (like my final sentence below but with it in place of <code>liftA2</code>).</p>\n\n<hr>\n\n<p>My original answer was wrong, as it left a layer of nesting (i.e., should have done an extra <code>concat</code> or <code>join</code>):</p>\n\n<p><del>That's <em>almost</em> just <code>liftA2</code>, but your arguments are in a weird order. Here's how you'd implement what you wrote in terms of that:</del></p>\n\n<pre><code>import Control.Applicative (liftA2)\napplyOperatorBetweenVariableLists firstList operator secondList = liftA2 (flip applyOperatorBetweenVariables operator) secondList firstList\n</code></pre>\n\n<p><del>From that definition, it should be clear how you could change and simplify that to <code>applyOperatorBetweenVariableLists = liftA2 . applyOperatorBetweenVariables</code> just by reordering the arguments to it and to <code>applyOperatorBetweenVariables</code>.</del></p>\n"}], "owner": {"reputation": 43, "user_id": 8185086, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67159d6a04157a0a8f572a8a4e27d378?s=128&d=identicon&r=PG&f=1", "display_name": "Lazare Rossillon", "link": "https://stackoverflow.com/users/8185086/lazare-rossillon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 59199771, "answer_count": 1, "score": 1, "last_activity_date": 1575567347, "creation_date": 1575563184, "last_edit_date": 1575564618, "question_id": 59199411, "link": "https://stackoverflow.com/questions/59199411/apply-a-function-to-every-element-in-a-list-to-every-element-in-another-list", "title": "Apply a function to every element in a list to every element in another list", "body": "<p>I'd like a more elegant way to write the following two functions, ideally in one :</p>\n\n<pre><code>applyOperatorBetweenVariableLists:: [Variable] -&gt; String -&gt; [Variable] -&gt; [Variable]\napplyOperatorBetweenVariableLists firstList operator secondList = concat $ map (test firstList operator) secondList\n\ntest:: [Variable] -&gt; String -&gt; Variable -&gt; [Variable]\ntest firstVariables operator secondVariable = concat $ map (applyOperatorBetweenVariables secondVariable operator) firstVariables\n</code></pre>\n\n<p>The declaration of <code>applyOperatorBetweenVariables</code> is :</p>\n\n<p><code>applyOperatorBetweenVariables:: Variable -&gt; String -&gt; Variable -&gt; [Variable]</code></p>\n\n<p>I'm quite sure there must be a Prelude Function that does exactly this, or a very elegant way to write it.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 3, "creation_date": 1575531150, "post_id": 59190195, "comment_id": 104599710, "body": "<code>take n (repeat 0)</code> is called <code>replicate</code>: <a href=\"https://hackage.haskell.org/package/base/docs/Prelude.html#v:replicate\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base/docs/Prelude.html#v:replica&zwnj;&#8203;te</a>"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1575531442, "post_id": 59190195, "comment_id": 104599819, "body": "Hint: you can simply apply the <code>replicate</code> function (mentioned by @arrowd) twice with the appropriate arguments, to get what you want."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1575571507, "post_id": 59190195, "comment_id": 104620661, "body": "If you feel totally stuck in a problem like this you&#39;re better served by 1) breaking it into subproblems, and then 2) solving them with explicit recursion, before moving on. Try writing replicate yourself."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1575549365, "post_id": 59190669, "comment_id": 104608812, "body": "I might make the type <code>Int -&gt; Int -&gt; a -&gt; [[a]]</code> to be consistent with <code>replicate</code>. Then <code>genericMkBoard m n = replicate m . replicate n</code>."}, {"owner": {"reputation": 1148, "user_id": 11619101, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Pgyla3H7sk4/AAAAAAAAAAI/AAAAAAAAABc/XQ20NuIAEmM/photo.jpg?sz=128", "display_name": "Yuri Kovalenko", "link": "https://stackoverflow.com/users/11619101/yuri-kovalenko"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1575550309, "post_id": 59190669, "comment_id": 104609344, "body": "@chepner I thought about it, but I used a principle &quot;arguments that are likely to be defaulted should go first, so you can default them with currying&quot;"}, {"owner": {"reputation": 1148, "user_id": 11619101, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Pgyla3H7sk4/AAAAAAAAAAI/AAAAAAAAABc/XQ20NuIAEmM/photo.jpg?sz=128", "display_name": "Yuri Kovalenko", "link": "https://stackoverflow.com/users/11619101/yuri-kovalenko"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1575550532, "post_id": 59190669, "comment_id": 104609466, "body": "@chepner I think it depends on your usage: if your common usage is <code>mkBoard :: Int -&gt; Int -&gt; [[Int]]</code>, then my version is handier, but if you need something like <code>boardOf :: a -&gt; [[a]]</code> with already captured size, then your way is more appropriate, like <code>boardOf = genericMkBoard defaultH defaultW</code>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1575554630, "post_id": 59190669, "comment_id": 104611773, "body": "Yeah, I was originally going to comment that it would be more likely that you would specify a size, <i>then</i> decide what to fill the board with, but I couldn&#39;t convince myself that was true."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1575554735, "post_id": 59190669, "comment_id": 104611835, "body": "Or you could define some monstrosity like <code>genericMkBoard = flip ((.) . replicate) . flip replicate</code> :)"}, {"owner": {"reputation": 1148, "user_id": 11619101, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Pgyla3H7sk4/AAAAAAAAAAI/AAAAAAAAABc/XQ20NuIAEmM/photo.jpg?sz=128", "display_name": "Yuri Kovalenko", "link": "https://stackoverflow.com/users/11619101/yuri-kovalenko"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1575555086, "post_id": 59190669, "comment_id": 104612044, "body": "@chepner Yeah, point-free notation is sometimes not the most readable thing :) I often try to rewrite my code with point-free style, but get something scary, so I have to go back for simple one"}], "tags": [], "owner": {"reputation": 1148, "user_id": 11619101, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Pgyla3H7sk4/AAAAAAAAAAI/AAAAAAAAABc/XQ20NuIAEmM/photo.jpg?sz=128", "display_name": "Yuri Kovalenko", "link": "https://stackoverflow.com/users/11619101/yuri-kovalenko"}, "is_accepted": false, "score": 4, "last_activity_date": 1575554510, "last_edit_date": 1575554510, "creation_date": 1575533041, "answer_id": 59190669, "question_id": 59190195, "link": "https://stackoverflow.com/questions/59190195/how-to-create-a-list-of-list-of-numbers-in-haskell/59190669#59190669", "title": "How to create a list of list of numbers in Haskell", "body": "<p>As @arrowd already mentioned, there is a <code>replicate</code> function for <code>take n (repeat x)</code>. You can create one row of your board with <code>replicate n 0</code>, and then create a board of such rows like <code>mkBoard m n = replicate m (replicate n 0)</code>.</p>\n\n<p>Also you can create more generic version of this function to fill the field with any value:</p>\n\n<pre><code>genericMkBoard :: a -&gt; Int -&gt; Int -&gt; [[a]]\ngenericMkBoard x m n = replicate m (replicate n x)\n</code></pre>\n\n<p>And define your <code>mkBoard</code> with <a href=\"http://learnyouahaskell.com/higher-order-functions#curried-functions\" rel=\"nofollow noreferrer\">partial application</a>:</p>\n\n<pre><code>mkBoard = genericMkBoard 0\n</code></pre>\n\n<p><strong>UPD</strong>: Also you can make it like this to be more consistent with <code>replicate</code> (thanks to @chepner):</p>\n\n<pre><code>replicate2D m n x = replicate m (replicate n x)\n\nmkBoard m n = replicate2D m n 0\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 3, "last_activity_date": 1575533220, "creation_date": 1575533220, "answer_id": 59190708, "question_id": 59190195, "link": "https://stackoverflow.com/questions/59190195/how-to-create-a-list-of-list-of-numbers-in-haskell/59190708#59190708", "title": "How to create a list of list of numbers in Haskell", "body": "<p>There is no need to use list comprehension here. We can make use of <a href=\"https://hackage.haskell.org/package/base/docs/Prelude.html#v:replicate\" rel=\"nofollow noreferrer\"><strong><code>replicate :: Int -&gt; a -&gt; [a]</code></strong></a> that will convert an <code>Int</code> <em>n</em> and an <code>a</code> to a list that repeats that value <em>n</em> times.</p>\n\n<p>We thus can construct a list of three <code>0</code>s with <code>replicate 3 0</code>. We can then use <code>replicate</code> a second time to construct a list that contains that list two times for example.</p>\n\n<pre><code>mkBoard :: Num n =&gt; Int -&gt; Int -&gt; [[n]]\nmkBoard m n = replicate m (replicate n 0)\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 12484188, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba197c7012a6451d473622d37eb5d658?s=128&d=identicon&r=PG&f=1", "display_name": "ot7", "link": "https://stackoverflow.com/users/12484188/ot7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1575554510, "creation_date": 1575530892, "question_id": 59190195, "link": "https://stackoverflow.com/questions/59190195/how-to-create-a-list-of-list-of-numbers-in-haskell", "title": "How to create a list of list of numbers in Haskell", "body": "<p>I need to create a function that makes a board of size row and column and then populate that with zeros. \nmkBoard 2 3 would make\n[[0,0,0],[0,0,0]]</p>\n\n<p>I don't really know where to start as I am new to Haskell programming I was thinking that the function would be something like this:</p>\n\n<pre><code>mkBoard m n= [m | ???? take n (repeat 0)]\n</code></pre>\n\n<p>But I am not sure if this would be the correct approach.</p>\n\n<p>Thank you for your help.</p>\n"}]