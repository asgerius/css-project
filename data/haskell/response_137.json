[{"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 7, "last_activity_date": 1503527821, "last_edit_date": 1503527821, "creation_date": 1503525777, "answer_id": 45849957, "question_id": 45849782, "link": "https://stackoverflow.com/questions/45849782/why-program-flow-control-executes-randomly/45849957#45849957", "title": "Why program flow control executes randomly", "body": "<p>In <code>funPercentOfNumberToAnother</code>, you have this clause:</p>\n\n<pre><code>if uglyAnswers ([ofNum, isNum], [percentDec])\n    then do\n        putStrLn (\"ofNum: \" ++ show ofNum)\n        putStrLn (\"isNum: \" ++ show isNum)\n        putStrLn \"___________________________\"\n        funPercentOfNumberToAnother\n    else do\n        putStrLn (\"ofNum: \" ++ show ofNum)\n        putStrLn (\"isNum: \" ++ show isNum)\n        putStrLn \"Percents\"\n</code></pre>\n\n<p>Your intent is to go back to the beginning of the function and start over, if the numbers are ugly; or otherwise continue with showing the numbers to the user. That works as far as it goes, but ask yourself...what happens at the end of this <code>if</code> clause? The stuff that is not in either the <code>then</code> or <code>else</code> branch is executed regardless, once either the <code>then</code> or <code>else</code> is done executing.</p>\n\n<p>So, when you get some ugly numbers, you start a recursive call that looks for better numbers and displays them. Then when that recursive call is finished, you go on to show the user the original, ugly numbers anyway!</p>\n\n<p>You will need a different control flow here, such as writing a function that always returns a non-ugly number, and then just using that in your (now non-recursive) <code>funPercentOfNumberToAnother</code> function. Or you could pull the rest of the function's body, the part that shows the numbers to the user, into the <code>else</code> part of the <code>if</code>, so that you don't do it for numbers that are ugly.</p>\n"}, {"tags": [], "owner": {"reputation": 53, "user_id": 8414960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a2ca8f52a1df09c6886cf96bf499c4d?s=128&d=identicon&r=PG&f=1", "display_name": "kit", "link": "https://stackoverflow.com/users/8414960/kit"}, "is_accepted": false, "score": 0, "last_activity_date": 1503560920, "last_edit_date": 1503560920, "creation_date": 1503539890, "answer_id": 45851802, "question_id": 45849782, "link": "https://stackoverflow.com/questions/45849782/why-program-flow-control-executes-randomly/45851802#45851802", "title": "Why program flow control executes randomly", "body": "<p>As per amalloy's great explanation I understood what was happening and fixed, then tested the issue. Having code outside the if statement of:</p>\n\n<pre><code>if uglyAnswers\n   then funPercentOfNumberToAnother\n   else ...\n</code></pre>\n\n<p>caused the bad answers to later make their way down when the recursion stopped. So essentially I was stocking up on them.</p>\n\n<p>Maybe this can explain it better. See that I got a clean answer on the first try so it didn't have to go through the recursion. For the second go there were two calls because the first call found a fractional answer:</p>\n\n<pre><code>     __  __       _   _                          _   _         \n    |  \\/  | __ _| |_| |__   ___ _ __ ___   __ _| |_(_) ___ ___ \n    | |\\/| |/ _` | __| '_ \\ / _ \\ '_ ` _ \\ / _` | __| |/ __/ __|\n    | |  | | (_| | |_| | | |  __/ | | | | | (_| | |_| | (__\\__ \n    |_|  |_|\\__,_|\\__|_| |_|\\___|_| |_| |_|\\__,_|\\__|_|\\___|___/\n\n1.) Learn Math\n2.) Math Lookup\n3.) Quit Excolo\n\n1\nIn the else statement\n===================================\nFinally outside the else statement\nofNum: 10\nisNum: 4\n\n     __  __       _   _                          _   _         \n    |  \\/  | __ _| |_| |__   ___ _ __ ___   __ _| |_(_) ___ ___ \n    | |\\/| |/ _` | __| '_ \\ / _ \\ '_ ` _ \\ / _` | __| |/ __/ __|\n    | |  | | (_| | |_| | | |  __/ | | | | | (_| | |_| | (__\\__ \n    |_|  |_|\\__,_|\\__|_| |_|\\___|_| |_| |_|\\__,_|\\__|_|\\___|___/\n\n1.) Learn Math\n2.) Math Lookup\n3.) Quit Excolo\n\n1\nBad answer alert!\n===================================\nIn the else statement\n===================================\nFinally outside the else statement\nofNum: 160\nisNum: 80\n===================================\nFinally outside the else statement\nofNum: 55\nisNum: 0.55\n</code></pre>\n\n<p>Here's the <em>workable</em> code snippets from the original question:</p>\n\n<pre><code>funPercentOfNumberToAnother :: IO ()\nfunPercentOfNumberToAnother = do\n    (percentDec, percentStr) &lt;- getPercent\n    ofNum &lt;- getDecimal (200 :: Decimal)\n    let isNum = percentDec * ofNum\n    if uglyAnswers ([ofNum, isNum], [percentDec])\n        then funPercentOfNumberToAnother\n        else do\n            let message = show isNum ++ \" is what percent of \" ++ show ofNum ++ \"?\\n\"\n            testProblem (percentStr ++ \"%\", message)\n\n\ntestProblem :: (String, String) -&gt; IO ()\ntestProblem (correctAns, message) = do\n    putStrLn message\n    putStrLn \"\\n\\n\"\n    putStr \"&gt; \"\n    myAns &lt;- getLine\n    if myAns == correctAns\n        then putStrLn \"Congratz!\"\n        else do\n            putStrLn (\"Sorry the correct answer is: \" ++ show correctAns)\n    pause\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 8414960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a2ca8f52a1df09c6886cf96bf499c4d?s=128&d=identicon&r=PG&f=1", "display_name": "kit", "link": "https://stackoverflow.com/users/8414960/kit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 45849957, "answer_count": 2, "score": 5, "last_activity_date": 1503560920, "creation_date": 1503524771, "question_id": 45849782, "link": "https://stackoverflow.com/questions/45849782/why-program-flow-control-executes-randomly", "title": "Why program flow control executes randomly", "body": "<p>I'm trying to learn math and Haskell at the same time by programming a simple math learning program.</p>\n\n<p>It starts by: </p>\n\n<ol>\n<li>Generating random numbers.</li>\n<li><strong>Filters those numbers to create an easy problem to work with.</strong></li>\n<li>Display the question then take my answer</li>\n<li>Lastly, it hands both my answer and the correct answer to another function to give me feedback (a \"Congratulations\" --or-- \"Sorry, the correct answer is BLANK).</li>\n</ol>\n\n<p>For some reason, after the congratulations function ends, it seems to randomly choose where it goes next, either:</p>\n\n<ol>\n<li>It returns to <strong>main</strong> (which is what I expect it to do). </li>\n<li>Or at random loops it'll go immediately to the math testing function. When this happens, <strong>step 2</strong> from above doesn't occur and I start getting fractional numbers in the question. Then it may repeat this step or go back to <strong>main</strong>.</li>\n</ol>\n\n<p>When trying to debug the problem I would just keep hitting RETURN and it would occur at different times. I've also added some debug 'print' statements.</p>\n\n<p>Here's 3 functions from the program. Note that main calls funPercentOfNumberToAnother:</p>\n\n<pre><code>funPercentOfNumberToAnother :: IO ()\nfunPercentOfNumberToAnother = do\n    (percentDec, percentStr) &lt;- getPercent\n    ofNum &lt;- getDecimal (200 :: Decimal)\n    let isNum = percentDec * ofNum\n    if uglyAnswers ([ofNum, isNum], [percentDec])\n        then do\n            putStrLn (\"ofNum: \" ++ show ofNum)\n            putStrLn (\"isNum: \" ++ show isNum)\n            putStrLn \"___________________________\"\n            funPercentOfNumberToAnother\n        else do\n            putStrLn (\"ofNum: \" ++ show ofNum)\n            putStrLn (\"isNum: \" ++ show isNum)\n            putStrLn \"Percents\"\n    -- putStrLn \"\\n\\n\"\n    putStrLn (show isNum ++ \" is what percent of \" ++ show ofNum ++ \"?\\n\" )\n    putStr \"&gt; \"\n    ans &lt;- getLine\n    submitStringAnswer (ans, percentStr ++ \"%\")\n\nsubmitStringAnswer :: (String, String) -&gt; IO ()\nsubmitStringAnswer (myAns, correctAns) = do\n    if myAns == correctAns\n        then putStrLn \"Congratz!\"\n        else do\n            putStrLn (\"Sorry the correct answer is: \" ++ show correctAns)\n    pause\n\n\npause :: IO ()\npause = do\n    x &lt;- getLine\n    putStrLn \"\"\n</code></pre>\n\n<p>Here's my debug output. Notice that The only time it gives fractional numbers is after it doesn't return to main immediately after <strong>pause</strong> ends.</p>\n\n<pre><code>     __  __       _   _                          _   _         \n    |  \\/  | __ _| |_| |__   ___ _ __ ___   __ _| |_(_) ___ ___ \n    | |\\/| |/ _` | __| '_ \\ / _ \\ '_ ` _ \\ / _` | __| |/ __/ __|\n    | |  | | (_| | |_| | | |  __/ | | | | | (_| | |_| | (__\\__ \n    |_|  |_|\\__,_|\\__|_| |_|\\___|_| |_| |_|\\__,_|\\__|_|\\___|___/\n\n1.) Learn Math\n2.) Math Lookup\n3.) Quit Excolo\n\n1\nofNum: 35\nisNum: 15.75\n___________________________\nofNum: 120\nisNum: 102\nPercents\n102 is what percent of 120?\n\n&gt; \nSorry the correct answer is: \"85%\"\n\n\n15.75 is what percent of 35?\n\n&gt; \nSorry the correct answer is: \"45%\"\n\n\n\n     __  __       _   _                          _   _         \n    |  \\/  | __ _| |_| |__   ___ _ __ ___   __ _| |_(_) ___ ___ \n    | |\\/| |/ _` | __| '_ \\ / _ \\ '_ ` _ \\ / _` | __| |/ __/ __|\n    | |  | | (_| | |_| | | |  __/ | | | | | (_| | |_| | (__\\__ \n    |_|  |_|\\__,_|\\__|_| |_|\\___|_| |_| |_|\\__,_|\\__|_|\\___|___/\n\n1.) Learn Math\n2.) Math Lookup\n3.) Quit Excolo\n\n1\nofNum: 80\nisNum: 44\nPercents\n44 is what percent of 80?\n\n&gt; \nSorry the correct answer is: \"55%\"\n\n\n\n     __  __       _   _                          _   _         \n    |  \\/  | __ _| |_| |__   ___ _ __ ___   __ _| |_(_) ___ ___ \n    | |\\/| |/ _` | __| '_ \\ / _ \\ '_ ` _ \\ / _` | __| |/ __/ __|\n    | |  | | (_| | |_| | | |  __/ | | | | | (_| | |_| | (__\\__ \n    |_|  |_|\\__,_|\\__|_| |_|\\___|_| |_| |_|\\__,_|\\__|_|\\___|___/\n\n1.) Learn Math\n2.) Math Lookup\n3.) Quit Excolo\n\n1\nofNum: 15\nisNum: 2.25\n___________________________\nofNum: 60\nisNum: 0.6\n___________________________\nofNum: 40\nisNum: 30\nPercents\n30 is what percent of 40?\n\n&gt; \nSorry the correct answer is: \"75%\"\n\n\n0.6 is what percent of 60?\n\n&gt; \nSorry the correct answer is: \"1%\"\n\n\n2.25 is what percent of 15?\n\n&gt; \nSorry the correct answer is: \"15%\"\n</code></pre>\n\n<p>If it helps, the only thing that is remotely relevant that I've found so far is: <a href=\"https://stackoverflow.com/questions/34101020/second-of-several-forked-processes-does-not-run-in-haskell-ghc-7-8-4/34101772#34101772\">Second of several forked processes does not run in Haskell\n</a>.</p>\n\n<p>Lastly, I'm right at the entry level of Monads if that helps formulate your answer.</p>\n\n<p>I would appreciate any help anyone can give as to what's happening, id est, why it's not returning straight to main after <em>pause</em> ends, and why would it skip the fractional number filter.</p>\n\n<p>Thanks ^^</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 22952, "user_id": 210211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8721ff8fa4b5c658058f4a2803231f44?s=128&d=identicon&r=PG", "display_name": "comingstorm", "link": "https://stackoverflow.com/users/210211/comingstorm"}, "edited": false, "score": 0, "creation_date": 1503521616, "post_id": 45846776, "comment_id": 78656393, "body": "You forgot to write the &quot;success&quot; case, where you actually find the last element, and return it!"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 6, "last_activity_date": 1503512843, "last_edit_date": 1503512843, "creation_date": 1503512286, "answer_id": 45846833, "question_id": 45846776, "link": "https://stackoverflow.com/questions/45846776/lastlist-function-in-a-list-without-calling-a-prelude-in-haskell/45846833#45846833", "title": "lastList function in a list without calling a Prelude in Haskell", "body": "<p><strong>The problem</strong>: you only define <code>Empty</code> as basecase, which will error. So every non-infinite list, will eventually result in the <code>Empty</code> basecase, and error. Infinite lists will loop forever, but that is something we can not circumvent since infinite lists simply have no last element.</p>\n\n<p>Since the <code>List</code> is a linked list with a <code>head</code> (which is an element) and a <code>tail</code> (which is the rest of the list) as <code>Cons head tail</code> and a <code>Empty</code>, a list with one element is thus <code>Cons x Empty</code>. So that means in case we obtain such a pattern, we should return <code>x</code>.</p>\n\n<p>Furthermore in case the <code>tail</code> is not <code>Empty</code>, we should perform recursion on the tail, until we obtain a list with only one element left.</p>\n\n<p>In case the list is <code>Empty</code>, the list is empty, and thus we should error on this input.</p>\n\n<pre><code>lastList :: List a -&gt; a\nlastList Empty = error \"List is empty\"\nlastList (Cons x Empty) = x\nlastList (Cons _ xs) = lastList xs\n</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 7607246, "user_type": "registered", "profile_image": "https://graph.facebook.com/1018314468270458/picture?type=large", "display_name": "Alan  Kantserov", "link": "https://stackoverflow.com/users/7607246/alan-kantserov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1503512843, "creation_date": 1503512075, "question_id": 45846776, "link": "https://stackoverflow.com/questions/45846776/lastlist-function-in-a-list-without-calling-a-prelude-in-haskell", "title": "lastList function in a list without calling a Prelude in Haskell", "body": "<p>I have this function lastList that is suppose to call the last element of a list. I need to do manually, without predefined \"last\" in Prelude.\nI have this code so far</p>\n\n<pre><code>lastList :: List a -&gt; a\nlastList list = case list of\n    Empty -&gt; error \"List is empty\"\n    Cons _ xs -&gt; lastList xs\n</code></pre>\n\n<p>It gives me an output \"List is empty\" with the list </p>\n\n<pre><code>test3 :: List Double\ntest3 = Cons 1.3 (Cons 5.2 (Cons 3.0 (Cons 8.7 (Cons 9.1 Empty))))\n</code></pre>\n\n<p>What is the problem? Thank you</p>\n"}, {"tags": ["list", "haskell", "swap"], "answers": [{"comments": [{"owner": {"reputation": 27, "user_id": 7607246, "user_type": "registered", "profile_image": "https://graph.facebook.com/1018314468270458/picture?type=large", "display_name": "Alan  Kantserov", "link": "https://stackoverflow.com/users/7607246/alan-kantserov"}, "edited": false, "score": 0, "creation_date": 1503507985, "post_id": 45845535, "comment_id": 78649268, "body": "Thank you very much for your response."}, {"owner": {"reputation": 27, "user_id": 7607246, "user_type": "registered", "profile_image": "https://graph.facebook.com/1018314468270458/picture?type=large", "display_name": "Alan  Kantserov", "link": "https://stackoverflow.com/users/7607246/alan-kantserov"}, "edited": false, "score": 0, "creation_date": 1503508240, "post_id": 45845535, "comment_id": 78649405, "body": "I have this. []:x:y -&gt; Just ([]:y:x) Probably I still don&#39;t understand something..."}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 27, "user_id": 7607246, "user_type": "registered", "profile_image": "https://graph.facebook.com/1018314468270458/picture?type=large", "display_name": "Alan  Kantserov", "link": "https://stackoverflow.com/users/7607246/alan-kantserov"}, "edited": false, "score": 0, "creation_date": 1503508453, "post_id": 45845535, "comment_id": 78649535, "body": "The empty array brackets <code>[]</code> go on the <i>right</i>, like in the example I&#39;ve shown."}, {"owner": {"reputation": 27, "user_id": 7607246, "user_type": "registered", "profile_image": "https://graph.facebook.com/1018314468270458/picture?type=large", "display_name": "Alan  Kantserov", "link": "https://stackoverflow.com/users/7607246/alan-kantserov"}, "edited": false, "score": 0, "creation_date": 1503508571, "post_id": 45845535, "comment_id": 78649610, "body": "If I put it that way it returns &quot;Nothing&quot; &lt;code&gt;x:y:[] -&gt; Just (y:x:[])&lt;/code&gt;"}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 27, "user_id": 7607246, "user_type": "registered", "profile_image": "https://graph.facebook.com/1018314468270458/picture?type=large", "display_name": "Alan  Kantserov", "link": "https://stackoverflow.com/users/7607246/alan-kantserov"}, "edited": false, "score": 0, "creation_date": 1503508691, "post_id": 45845535, "comment_id": 78649673, "body": "You are missing at least one more case. Hint, what should happen with the pattern <code>x:y:z:zs</code>?"}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 27, "user_id": 7607246, "user_type": "registered", "profile_image": "https://graph.facebook.com/1018314468270458/picture?type=large", "display_name": "Alan  Kantserov", "link": "https://stackoverflow.com/users/7607246/alan-kantserov"}, "edited": false, "score": 0, "creation_date": 1503508830, "post_id": 45845535, "comment_id": 78649744, "body": "Also, you are returning a <code>Maybe [a]</code> value which will complicate your case handling. I recommend - for incremental learning purposes - preserving the input list for the <code>_</code> case (instead of returning <code>Nothing</code>), such that your function signature is <code>swapLastTwo :: [a] -&gt; [a]</code>"}, {"owner": {"reputation": 27, "user_id": 7607246, "user_type": "registered", "profile_image": "https://graph.facebook.com/1018314468270458/picture?type=large", "display_name": "Alan  Kantserov", "link": "https://stackoverflow.com/users/7607246/alan-kantserov"}, "edited": false, "score": 0, "creation_date": 1503509444, "post_id": 45845535, "comment_id": 78650043, "body": "you are saying about x y z zs, but it handles only first 3 values and the rest of the list. Why should I care about it if I only need last 2 values? Thank you"}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 27, "user_id": 7607246, "user_type": "registered", "profile_image": "https://graph.facebook.com/1018314468270458/picture?type=large", "display_name": "Alan  Kantserov", "link": "https://stackoverflow.com/users/7607246/alan-kantserov"}, "edited": false, "score": 0, "creation_date": 1503509709, "post_id": 45845535, "comment_id": 78650177, "body": "With pattern matching, you need to &quot;deconstruct&quot; the list from the head recursively in order to locate the last two elements. If you only handle <code>[x,y]</code> and <code>_</code>, then you will always return <code>Nothing</code> except when the list is exactly 2 items long. Might I recommend reviewing some <a href=\"http://learnyouahaskell.com/syntax-in-functions\" rel=\"nofollow noreferrer\">instructions on pattern matching</a>?"}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": false, "score": 1, "last_activity_date": 1503507760, "creation_date": 1503507760, "answer_id": 45845535, "question_id": 45845447, "link": "https://stackoverflow.com/questions/45845447/how-to-swap-last-2-elements-in-haskell/45845535#45845535", "title": "How to swap last 2 elements in Haskell?", "body": "<p>When using the cons operator <code>:</code>, the last item on the right of the colon is a list, while everything to the left is a single item in the list. That is why <code>swapFirstTwo</code> compiles successfully: the <code>x</code> and <code>y</code> from <code>x:y:xs</code> are individual items, while <code>xs</code> is a list.</p>\n\n<p>You can confine a pattern match to a two element List by either of these methods:</p>\n\n<pre><code>x:y:[] -&gt; ...\n-- or\n[x,y] -&gt; ...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 27, "user_id": 7607246, "user_type": "registered", "profile_image": "https://graph.facebook.com/1018314468270458/picture?type=large", "display_name": "Alan  Kantserov", "link": "https://stackoverflow.com/users/7607246/alan-kantserov"}, "edited": false, "score": 0, "creation_date": 1503510286, "post_id": 45846135, "comment_id": 78650491, "body": "Thank you very much! That works now. Didn&#39;t expect it to be so confusing."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1503528946, "post_id": 45846135, "comment_id": 78659176, "body": "@leftroundabout, &quot;This actually has much worse runtime characteristics&quot;: seems like they are both O(n) and spine-strict to me.  If you got rid of the <code>Maybe</code>, on the other hand, then it could be made lazy/productive.  (It can be done with the <code>Maybe</code> too, but it&#39;s a bit more subtle and the naive implementation doesn&#39;t cut it)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1503530778, "post_id": 45846135, "comment_id": 78659612, "body": "@luqui true, I didn&#39;t think of the <code>Maybe</code> strictness."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 8, "last_activity_date": 1503531165, "last_edit_date": 1503531165, "creation_date": 1503509870, "answer_id": 45846135, "question_id": 45845447, "link": "https://stackoverflow.com/questions/45845447/how-to-swap-last-2-elements-in-haskell/45846135#45846135", "title": "How to swap last 2 elements in Haskell?", "body": "<p>First, note that there's no reason to use <code>case</code> for this kind of pattern-matching \u2013 just match right in the function arguments:</p>\n\n<pre><code>swapFirstTwo :: [a] -&gt; Maybe [a]\nswapFirstTwo (x:y:xs) = Just (y:x:xs)\nswapFirstTwo _ = Nothing\n</code></pre>\n\n<p>Now... Haskell lists aren't symmetric. At all. Anything you do with pattern-matching will always focus on the <em>left</em> end on the list, that's why your <code>swapLastTwo</code> doesn't work. You can only get at the <em>right</em> end by disassembling the whole list (if at all, namely, this only works for <em>finite</em> lists). This can be done through <em>recursion</em>. First write out the base cases:</p>\n\n<pre><code>swapLastTwo [] = Nothing\nswapLastTwo [_] = Nothing\nswapLastTwo [x,y] = Just [y,x]\n</code></pre>\n\n<p>For any list <em>longer</em> than that, you need to first pop off elements and then later put them back. Hence the recursive clause</p>\n\n<pre><code>swapLastTwo (x:xs) = (x:) &lt;$&gt; swapLastTwo xs\n</code></pre>\n\n<p>In case you're wondering what <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Control-Applicative.html#v:-60--36--62-\" rel=\"nofollow noreferrer\"><code>&lt;$&gt;</code></a> is: in this case, it simply prepends <code>x</code> to whatever <code>Just</code> result the recursive call may yield.</p>\n\n<p>An alternative, kind of brute-force solution would be</p>\n\n<pre><code>swapLastTwo = fmap reverse . swapFirstTwo . reverse\n</code></pre>\n\n<p><del>This actually has much worse runtime characteristics in this example, but</del><sup>See Luke's comment</sup> generally, such \u201ccompose simple functions instead of doing manual recursion\u201d solutions are often much more effective.</p>\n"}, {"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 0, "last_activity_date": 1503524619, "creation_date": 1503524619, "answer_id": 45849752, "question_id": 45845447, "link": "https://stackoverflow.com/questions/45845447/how-to-swap-last-2-elements-in-haskell/45849752#45849752", "title": "How to swap last 2 elements in Haskell?", "body": "<p>I can not make sure if this more efficient than @leftaroundabout solution but just for a variety you may use lists as an applicative functor such as;</p>\n\n<pre><code>swapLastTwo :: [a] -&gt; Maybe [a]\nswapLastTwo []  = Nothing\nswapLastTwo [_] = Nothing\nswapLastTwo xs  = Just (concat $ [reverse . drop 2 . reverse, take 2 . reverse] &lt;*&gt; [xs])\n\n*Main&gt; swapLastTwo []\nNothing\n*Main&gt; swapLastTwo [1]\nNothing\n*Main&gt; swapLastTwo [1,2,3,4,5]\nJust [1,2,3,5,4]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 3, "last_activity_date": 1503529688, "creation_date": 1503529688, "answer_id": 45850582, "question_id": 45845447, "link": "https://stackoverflow.com/questions/45845447/how-to-swap-last-2-elements-in-haskell/45850582#45850582", "title": "How to swap last 2 elements in Haskell?", "body": "<p>Here's the productive version I mentioned for fun.</p>\n\n<pre><code>swapLastTwo :: [a] -&gt; [a]\nswapLastTwo [] = []\nswapLastTwo [x] = [x]\nswapLastTwo [x,y] = [y,x]\nswapLastTwo (x:xs) = x : swapLastTwo xs\n</code></pre>\n\n<p>It's lazy:</p>\n\n<pre><code>ghci&gt; swapLastTwo [1,2,3,4,5]\n[1,2,3,5,4]\n&gt;&gt;&gt; swapLastTwo (1:2:3:4:5:undefined)\n[1,2,3*** Exception: Prelude.undefined\n</code></pre>\n\n<p>And you can also do it with <code>Maybe</code> (which is why I wrote this answer, because I enjoy the <code>asJust</code> pattern, and the way it can make strict things productive when properly placed &mdash; essentially we are codifying some extra structural information that is not clear from the types alone).</p>\n\n<pre><code>swapLastTwo' :: [a] -&gt; Maybe [a]\nswapLastTwo' [] = Nothing\nswapLastTwo' [x] = Nothing\nswapLastTwo' [x,y] = Just [y,x]\nswapLastTwo' (x:xs) = (x:) &lt;$&gt; asJust (swapLastTwo' xs)\n    where\n    assertJust ~(Just x) = Just x\n</code></pre>\n\n<p>Which is also lazy</p>\n\n<pre><code>ghci&gt; swapLastTwo' (1:2:3:4:5:undefined)\nJust [1,2,3*** Exception: Prelude.undefined\nghci&gt; swapLastTwo [1]\nNothing\n</code></pre>\n\n<p>In a lazy dependent-typed world, would <code>swapLastTwo'</code> (with an appropriately accurate type) be lazy without any extra effort, the way <code>swapLastTwo</code> is here? </p>\n"}], "owner": {"reputation": 27, "user_id": 7607246, "user_type": "registered", "profile_image": "https://graph.facebook.com/1018314468270458/picture?type=large", "display_name": "Alan  Kantserov", "link": "https://stackoverflow.com/users/7607246/alan-kantserov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 847, "favorite_count": 0, "answer_count": 4, "score": 1, "last_activity_date": 1503531165, "creation_date": 1503507405, "last_edit_date": 1503508258, "question_id": 45845447, "link": "https://stackoverflow.com/questions/45845447/how-to-swap-last-2-elements-in-haskell", "title": "How to swap last 2 elements in Haskell?", "body": "<p>I need to swap last 2 elements of a list in Haskell</p>\n\n<p>Here is what I've got so far and it doesn't compile.</p>\n\n<pre><code>swapLastTwo :: [a] -&gt; Maybe [a]\nswapLastTwo list = case list of\n    xs:x:y -&gt; Just (xs:y:x)\n    _ -&gt; Nothing\n</code></pre>\n\n<p>However this one compiles:</p>\n\n<pre><code>swapFirstTwo :: [a] -&gt; Maybe [a]\nswapFirstTwo list = case list of\n    x:y:xs -&gt; Just (y:x:xs)\n    _      -&gt; Nothing\n</code></pre>\n\n<p>What is the difference? I guess there is a problem with these x y xs etc. I am not quite certain with them.</p>\n\n<p>Compiler gives this error</p>\n\n<pre><code> \u2022 Couldn't match expected type \u2018[[a]]\u2019 with actual type \u2018a\u2019\n       \u2018a\u2019 is a rigid type variable bound by\n         the type signature for:\n           swapLastTwo :: forall a. [a] -&gt; Maybe [a]\n         at BuiltInList.hs:69:16\n     \u2022 In the second argument of \u2018(:)\u2019, namely \u2018x\u2019\n       In the second argument of \u2018(:)\u2019, namely \u2018y : x\u2019\n       In the first argument of \u2018Just\u2019, namely \u2018(xs : y : x)\u2019\n     \u2022 Relevant bindings include\n         y :: [a] (bound at BuiltInList.hs:71:10)\n         x :: a (bound at BuiltInList.hs:71:8)\n         xs :: a (bound at BuiltInList.hs:71:5)\n         list :: [a] (bound at BuiltInList.hs:70:13)\n         swapLastTwo :: [a] -&gt; Maybe [a] (bound at BuiltInList.hs:70:1) Failed, modules loaded: none.\n</code></pre>\n\n<p>Thank you.</p>\n"}, {"tags": ["haskell", "io", "state"], "answers": [{"comments": [{"owner": {"reputation": 5242, "user_id": 50962, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e39b7acdae85aedee02487bed17ff5f6?s=128&d=identicon&r=PG", "display_name": "altern", "link": "https://stackoverflow.com/users/50962/altern"}, "edited": false, "score": 0, "creation_date": 1503670210, "post_id": 45845543, "comment_id": 78725173, "body": "Where did you import <code>lift</code> function from? And should it be <code>get = lift . get</code> instead of <code>get = lift get</code>? Also I am changing signature of <code>parseInput</code> function from <code>String -&gt; InputT IO ()</code> to (as you suggested) <code>String -&gt; InputT (StateT [Int] IO)</code>, but getting error <code>Couldn&#39;t match type \u2018StateT [Int] IO\u2019 with \u2018IO\u2019     Expected type: String -&gt; InputT IO ()       Actual type: String -&gt; InputT (StateT [Int] IO) ()</code> in the <code>mainLoop</code> function. How could I rewrite <code>mainLoop</code> to accommodate changes of <code>parseInput</code> type?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 5242, "user_id": 50962, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e39b7acdae85aedee02487bed17ff5f6?s=128&d=identicon&r=PG", "display_name": "altern", "link": "https://stackoverflow.com/users/50962/altern"}, "edited": false, "score": 0, "creation_date": 1503680621, "post_id": 45845543, "comment_id": 78731599, "body": "<code>lift</code> is from the <a href=\"https://hackage.haskell.org/package/transformers-0.5.4.0/docs/Control-Monad-Trans-Class.html\" rel=\"nofollow noreferrer\"><code>MonadTrans</code></a> class. <code>lift get</code> is right; <code>get</code> isn&#39;t a function."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 5, "last_activity_date": 1503681115, "last_edit_date": 1503681115, "creation_date": 1503507778, "answer_id": 45845543, "question_id": 45844720, "link": "https://stackoverflow.com/questions/45844720/haskell-maintaining-different-states-of-global-variable/45845543#45845543", "title": "Haskell - maintaining different states of global variable", "body": "<p>One clean way to handle this is to add <a href=\"https://hackage.haskell.org/package/transformers-0.5.4.0/docs/Control-Monad-Trans-State-Strict.html#t:StateT\" rel=\"nofollow noreferrer\"><code>StateT</code></a> to your transformer stack.</p>\n\n<p>Instead of using the type <code>InputT IO</code> you'd use either <code>StateT [Int] (InputT IO)</code> or <code>InputT (StateT [Int] IO)</code>. Since <code>InputT</code> has more operations to mess around with lifting, I'd use <code>InputT (StateT [Int] IO)</code> to keep the complicated operations on the outside.</p>\n\n<p>To make things simple I'd add an orphan <a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-State-Class.html\" rel=\"nofollow noreferrer\"><code>MonadState</code></a> instance for <code>MonadState m =&gt; MonadState (InputT m)</code></p>\n\n<pre><code>instance MonadState s m =&gt; MonadState s (InputT m) where\n    get = lift get\n    put = lift . put\n    state = lift . state\n</code></pre>\n\n<p>Then when you want to modify the state you'd use <code>get</code>, <code>put</code>, or <code>state</code>.</p>\n\n<pre><code>  | inp =~ \"^\\\\:new\" = do\n    mydata &lt;- get                     -- reads the state\n    put $ mydata ++ [last mydata + 1] -- updates the state\n    mainLoop\n</code></pre>\n\n<p>You can then clean up the type signatures to make your code more general. Instead of only working on <code>InputT (StateT [Int] IO)</code> you can make the code work for <code>(MonadState [Int] m, MonadIO m) =&gt; InputT m</code>.</p>\n\n<p>To run a <code>StateT</code> use <a href=\"http://hackage.haskell.org/package/transformers-0.5.4.0/docs/Control-Monad-Trans-State-Lazy.html#v:runStateT\" rel=\"nofollow noreferrer\"><code>runStateT</code></a>. If you change the type of <code>mainloop</code> to <code>InputT (StateT [Int] IO) ()</code> or the more general <code>(MonadState [Int] m, MonadIO m) =&gt; InputT m ()</code> then you can run it with  </p>\n\n<pre><code>main :: IO ()\nmain = do \n    greet \n    runStateT (runInputT defaultSettings mainLoop) []\n--  ^          ^ run the outer InputT              ^\n--  run the inner StateT ..... with starting state []\n</code></pre>\n"}], "owner": {"reputation": 5242, "user_id": 50962, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e39b7acdae85aedee02487bed17ff5f6?s=128&d=identicon&r=PG", "display_name": "altern", "link": "https://stackoverflow.com/users/50962/altern"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 364, "favorite_count": 0, "accepted_answer_id": 45845543, "answer_count": 1, "score": 2, "last_activity_date": 1503681115, "creation_date": 1503504737, "last_edit_date": 1503505272, "question_id": 45844720, "link": "https://stackoverflow.com/questions/45844720/haskell-maintaining-different-states-of-global-variable", "title": "Haskell - maintaining different states of global variable", "body": "<p>I have done some research on stackoverflow to find viable solution to the common problem of maintaining different states of global variable. </p>\n\n<p>I found <a href=\"https://stackoverflow.com/questions/15467925/maintaining-complex-state-in-haskell\">this</a> elaborate question that addresses similar concern. It raises important issue of godlike global variable and that's an antipattern in Haskell. I perfectly understand that my situation is similar and I am trying to introduce this antipattern, but I don't really like the answer. It seems that <code>Netwire</code> is an overkill for my task at hand, it could be done in much more simple and elegant way. </p>\n\n<p>And I also found <a href=\"https://stackoverflow.com/questions/19502268/updating-record-when-referenced-by-multiple-data-structures\">this one</a>, but both question and answers address more general concerns and approaches, while I have concrete problem and, hopefully, concrete solution. What I also want (and could not find in previous questions) is to make a qualitative step in understanding of maintaining variable states through the simple example. </p>\n\n<p>In the code below I am trying to update state of the godlike variable from two different places executing <code>:load</code> and <code>:new</code> commands, but, obviously, it doesn't work. </p>\n\n<p>My question is how to modify following code in order to accommodate possibility of changing global variable value in a functional way? Should I throw away all the code because it represents imperative-style approach and replace it totally new <code>parseInput</code> that follows rules of functional world? Should I replace global variable with something else? I assume I could use <code>IORef</code> somehow, it seems appropriate. Or <code>ST Monad</code> as <a href=\"https://stackoverflow.com/questions/7880555/st-monad-code-smell\">this question/answer</a> recommends. </p>\n\n<p>What would be the easiest and straightforward step to address this problem without an overkill? I understand that I might need to better grasp the notion of Monads (State Monad in particular) and I am ready to learn how they could help with addressing this particular problem. But the articles I have read so far (<a href=\"https://wiki.haskell.org/State_Monad\" rel=\"nofollow noreferrer\">this</a> and <a href=\"http://brandon.si/code/the-state-monad-a-tutorial-for-the-confused/\" rel=\"nofollow noreferrer\">this</a>), didn't help much. I assume that State Monad is not really appropriate because my example does not have return value, only updated state. If I am wrong, could you please explain how and what missing links would help me to understand states in Haskell better?</p>\n\n<pre><code>{-# LANGUAGE QuasiQuotes #-}\n\nimport Text.Regex.PCRE\nimport System.Console.Haskeline\nimport TH (litFile)\nimport System.FilePath\nimport System.IO\nimport Control.Monad\nimport Control.Monad.IO.Class\nimport Data.List \n\nmydata :: [Int]\nmydata = [0]\n\nsaveDataToFile :: [Int] -&gt; IO ()\nsaveDataToFile mydata = withFile \"data.txt\" WriteMode $ \\h -&gt; System.IO.hPutStr h (unwords $ map show mydata)\n\nloadDataFromFile :: [Int]\nloadDataFromFile = map read . words $ [litFile|data.txt|]\n\nhelp :: InputT IO ()\nhelp = liftIO $ mapM_ putStrLn\n       [ \"\"\n       , \":help     - this help\"\n       , \":q        - quit\"\n       , \":commands - list available commands\"\n       , \"\"\n       ]\n\ncommands :: InputT IO ()\ncommands = liftIO $ mapM_ putStrLn\n       [ \"\"\n       , \":show     - display data\"\n       , \":save     - save results to file\"\n       , \":load     - loads data from file\"\n       , \":new      - generate new element \"\n       , \"\"\n       ]\n\nparseInput :: String -&gt; InputT IO ()\nparseInput inp\n  | inp =~ \"^\\\\:q\"        = return ()\n\n  | inp =~ \"^\\\\:he\"       = help &gt;&gt; mainLoop\n\n  | inp =~ \"^\\\\:commands\" = commands &gt;&gt; mainLoop\n\n  | inp =~ \"^\\\\:show\" = do\n    liftIO $ putStrLn $ unwords $ map show mydata\n    mainLoop \n\n  | inp =~ \"^\\\\:save\" = do\n    liftIO $ saveDataToFile mydata\n    mainLoop\n\n  | inp =~ \"^\\\\:load\" = do\n    let mydata = loadDataFromFile -- &lt;-- should update mydata \n    mainLoop\n\n  | inp =~ \"^\\\\:new\" = do\n    let mydata = mydata ++ [last mydata + 1] -- &lt;-- should update mydata\n    mainLoop\n\n  | inp =~ \":\" = do\n    outputStrLn $ \"\\nNo command \\\"\" ++ inp ++ \"\\\"\\n\"\n    mainLoop\n\n  | otherwise = handleInput inp\n\nhandleInput :: String -&gt; InputT IO ()\nhandleInput inp = mainLoop\n\nmainLoop :: InputT IO ()\nmainLoop = do\n  inp &lt;- getInputLine \"% \"\n  maybe (return ()) (parseInput) inp\n\ngreet :: IO ()\ngreet = mapM_ putStrLn\n        [ \"\"\n        , \"          MyProgram\"\n        , \"==============================\"\n        , \"For help type \\\":help\\\"\"\n        , \"\"\n        ]\n\nmain :: IO ()\nmain = do \n    greet \n    runInputT defaultSettings (mainLoop)\n</code></pre>\n\n<p>PS. I use Template Haskell definitions (TH module) from <a href=\"https://stackoverflow.com/questions/12716215/load-pure-global-variable-from-file/12717160#12717160\">this answer</a>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1503494920, "post_id": 45841108, "comment_id": 78639630, "body": "A <code>class</code> in Haskell is not a class like in Java. It is more an <code>interface</code> in Java. Hence you cannot attach a type to it. You can of course make a <code>null</code> (some sort of default constructor), with <code>null :: a</code> here."}, {"owner": {"reputation": 1361, "user_id": 2556165, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/fGy2y.jpg?s=128&g=1", "display_name": "wowofbob", "link": "https://stackoverflow.com/users/2556165/wowofbob"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1503495179, "post_id": 45841108, "comment_id": 78639869, "body": "@WillemVanOnsem I thought about making something like <code>null :: a</code>. But it&#39;s not enough. I feel like I&#39;m going in wrong direction :("}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1503499866, "post_id": 45841108, "comment_id": 78643912, "body": "@wowofbob It&#39;s a bit tough to tell what you want, but I propose another direction you could consider that might get closer to your goal. I agree with Willem that you seem to be misunderstanding what classes are used for in Haskell."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1503526148, "post_id": 45841108, "comment_id": 78658237, "body": "Generally speaking, where you would make a class in OOP, in Haskell you would make a <i>module</i>, not a typeclass. The exports of the module correspond to the public interface of the class."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1503498804, "creation_date": 1503498804, "answer_id": 45842659, "question_id": 45841108, "link": "https://stackoverflow.com/questions/45841108/haskell-how-to-make-a-class-with-constructor/45842659#45842659", "title": "Haskell: how to make a class with constructor?", "body": "<p>The problem here is lack of injectivity, as it usually happens with type families. Consider this.</p>\n\n<pre><code>data T1 = ...\ndata T2 = ...\n\ninstance A T1 where\n  type T T1 = Int\n  ...\ninstance A T2 where\n  type T T2 = Int\n  ...\n\nmk defT :: T1  -- error\n</code></pre>\n\n<p>The last line requires <code>defT :: Int</code>. However, both instances define <code>defT :: Int ~ T T1 ~ T T2</code>, so GHC can't decide which one to pick.</p>\n\n<p>Worse, GHC refuses the type <code>defT :: T a</code> in the type class, since it's ambiguous: even if we know that we want <code>defT :: SomeGivenType</code>, there is no way that GHC can understand what <code>a</code> it should choose.</p>\n\n<p>The easiest solution, in my opinion, is to: 1) allow ambiguous types, and 2) to choose the instance explicitly.</p>\n\n<pre><code>{-# LANGUAGE AllowAmbiguousTypes, TypeApplications #-}\nmk (defT @ T1)  -- after the @ we explicitly pass the type \"a\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1361, "user_id": 2556165, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/fGy2y.jpg?s=128&g=1", "display_name": "wowofbob", "link": "https://stackoverflow.com/users/2556165/wowofbob"}, "edited": false, "score": 0, "creation_date": 1503500221, "post_id": 45842986, "comment_id": 78644209, "body": "I have a bunch of classes like <code>HashDBUser</code> from <code>Yesod.Auth.HashDB</code>. I need them to get rid of dependency from <code>Model.hs</code> in <code>yesod</code> scaffolding site. But in some cases I need to create records in database, so I need a constructors. I mean, I can&#39;t use <code>data</code>, or maybe I don&#39;t know how to do it properly. If I&#39;ll use <code>data</code>, I&#39;ll need a way, some proxy between this <code>data</code> and actual record type stored in database. As I see now, my question is a bit confusing :)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1361, "user_id": 2556165, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/fGy2y.jpg?s=128&g=1", "display_name": "wowofbob", "link": "https://stackoverflow.com/users/2556165/wowofbob"}, "edited": false, "score": 3, "creation_date": 1503500423, "post_id": 45842986, "comment_id": 78644342, "body": "@wowofbob Sounds like you&#39;ve scrubbed all the relevant details from your question, then. I suspect you did that to try to make your example as minimal as possible, which all of us here appreciate very much. But you&#39;ve gone too far, I think; I encourage you to open a fresh question with just a few more of the background details explaining what you&#39;re trying to do and why."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1503499653, "creation_date": 1503499653, "answer_id": 45842986, "question_id": 45841108, "link": "https://stackoverflow.com/questions/45841108/haskell-how-to-make-a-class-with-constructor/45842986#45842986", "title": "Haskell: how to make a class with constructor?", "body": "<p>I suspect you want a new data type, not a class. For example:</p>\n\n<pre><code>data A a = Mk { get :: a }\n</code></pre>\n\n<p>This defines a bunch of stuff for you, but of especial interest are these two functions:</p>\n\n<pre><code>Mk :: a -&gt; A a\nget :: A a -&gt; a\n</code></pre>\n\n<p>You can have multiple fields; for example, in:</p>\n\n<pre><code>data Counted a = Counted { value :: a, count :: Int }\n</code></pre>\n\n<p>These functions now exist:</p>\n\n<pre><code>Counted :: a -&gt; Int -&gt; Counted a\nvalue :: Counted a -&gt; a\ncount :: Counted a -&gt; Int\n</code></pre>\n"}], "owner": {"reputation": 1361, "user_id": 2556165, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/fGy2y.jpg?s=128&g=1", "display_name": "wowofbob", "link": "https://stackoverflow.com/users/2556165/wowofbob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1503499653, "creation_date": 1503494838, "question_id": 45841108, "link": "https://stackoverflow.com/questions/45841108/haskell-how-to-make-a-class-with-constructor", "title": "Haskell: how to make a class with constructor?", "body": "<p>I want to write a class which has a constructor. For example:</p>\n\n<pre><code>class A a where\n\n  -- `a`'s field\n  type T a\n\n  -- default value\n  defT :: T a\n\n  -- constructor\n  mk :: T a -&gt; a\n</code></pre>\n\n<p>I also need a default constructor:</p>\n\n<pre><code>mkDef :: A a =&gt; a\nmkDef = mk defT\n</code></pre>\n\n<p>But I get compilation error:</p>\n\n<pre><code>Couldn't match expected type \u2018T a\u2019 with actual type \u2018T a1\u2019\nNB: \u2018T\u2019 is a type function, and may not be injective\nThe type variable \u2018a1\u2019 is ambiguous\nRelevant bindings include\n  mkDef :: a\nIn the first argument of \u2018mk\u2019, namely \u2018defT\u2019\nIn the expression: mk defT\n</code></pre>\n\n<p>I think compiler doesn't know which instance of <code>A a</code> the first argument of <code>mk</code> belongs to. Please correct me if I'm wrong.</p>\n\n<p>Attempt to use <code>ScopedTypeVariables</code> doesn't help here, I get mostly the same compilation error:</p>\n\n<pre><code>mkDef :: forall a . A a =&gt; a\nmkDef = mk (defT :: T a)\n</code></pre>\n\n<p>Another idea would be to use <code>FunctionalDependencies</code>:</p>\n\n<pre><code>class A' a t | a -&gt; t where\n\n  -- Get t from a\n  getT' :: a -&gt; t\n\n  defT' :: t\n\n  mk' :: t -&gt; a\n</code></pre>\n\n<p>But, still, I can't get working default constructor:</p>\n\n<pre><code>mkDef' :: forall a t . A' a t =&gt; a\nmkDef' = make def\n  where\n\n    def :: t\n    def = defT' `asTypeOf` (getT' (undefined :: a))\n\n    make :: t -&gt; a\n    make = mk'\n</code></pre>\n\n<p>Information about which <code>a</code> <code>t</code> belongs is lost:</p>\n\n<pre><code>Could not deduce (A' a0 t) arising from a use of \u2018defT'\u2019\nfrom the context (A' a t)\n  bound by the type signature for mkDef' :: A' a t =&gt; a\nThe type variable \u2018a0\u2019 is ambiguous\nRelevant bindings include\n  def :: t\n  make :: t -&gt; a\nIn the first argument of \u2018asTypeOf\u2019, namely \u2018defT'\u2019\nIn the expression: defT' `asTypeOf` (getT' (undefined :: a))\nIn an equation for \u2018def\u2019:\n    def = defT' `asTypeOf` (getT' (undefined :: a))\n</code></pre>\n\n<p>Also I don't like this approach because all such <code>t</code> should be a class parameters.</p>\n\n<hr>\n\n<p>I'd like to solve it staying with <code>TypeFamilies</code> 'cause I already have some code written in such manner. Also, please let me know is there a common solution for this problem or not.</p>\n"}, {"tags": ["performance", "haskell", "vector", "functional-programming", "immutability"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1503492301, "post_id": 45840094, "comment_id": 78637485, "body": "Probably if <i>after</i> the operation is performed, no object is pointing to the original vectoy anymore."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 4, "creation_date": 1503493637, "post_id": 45840094, "comment_id": 78638558, "body": "Looking at the source code, I can&#39;t see how it would ever not copy the vector; It seems to always call <code>basicUnsafeCopy</code>, which copies the vector."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1503496769, "post_id": 45840094, "comment_id": 78641228, "body": "Pretty sure there is no way to guarantee any such thing through the standard Haskell type system; it&#39;s actually one of the main goals of GHC&#39;s <a href=\"https://ghc.haskell.org/trac/ghc/wiki/LinearTypes\" rel=\"nofollow noreferrer\">linear types</a> research to make that possible."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1503497819, "post_id": 45840094, "comment_id": 78642112, "body": "Perhaps that&#39;s a (confusing) way to indicate that the monadic modifier-function argument <code>forall s. MVector s a -&gt; ST s ()</code> can write on the vector many times without vector copies being made after the initial one. That is: the vector is copied only once, even if the modifier-function reads/writes a large number of times."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 2, "creation_date": 1503504015, "post_id": 45840094, "comment_id": 78646893, "body": "@Cubic You see, it is never safe to do so, so the documentation remains correct\u2014if unhelpful."}, {"owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1503510686, "post_id": 45840094, "comment_id": 78650747, "body": "@cubic / others... feel free to post an answer!"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1503528599, "post_id": 45840094, "comment_id": 78659072, "body": "And this is a good time to never forget rewrite rules, which can change a program drastically.  Look at the code <i>and</i> the rewrite rules."}], "answers": [{"comments": [{"owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "edited": false, "score": 0, "creation_date": 1503558666, "post_id": 45850410, "comment_id": 78667954, "body": "Does this mean that for <code>modify</code> the vector is <i>never</i> copied? Or are there still some cases for which it is?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "edited": false, "score": 0, "creation_date": 1503581574, "post_id": 45850410, "comment_id": 78684280, "body": "I dare say in most cases it still is."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 10, "last_activity_date": 1503591383, "last_edit_date": 1503591383, "creation_date": 1503528419, "answer_id": 45850410, "question_id": 45840094, "link": "https://stackoverflow.com/questions/45840094/when-does-modify-copy-the-vector/45850410#45850410", "title": "When does `modify` copy the vector?", "body": "<p>Modify calls <code>Data.Vector.Generic.modify</code> which calls <code>clone</code> which has the following rewrite rule:</p>\n\n<pre><code>\"clone/new [Vector]\" forall p.\n  clone (new p) = p\n</code></pre>\n\n<p>So when something is in a syntactic form of <code>new p</code> it isn't copied.  It appears <code>modify</code>, <code>slice</code>, <code>init</code>, <code>tail</code>, <code>take</code>, <code>drop</code>, <code>unstream</code>, and <code>clone</code> are the main thing that fuse well here.  This is all closely related to the stream fusion work (google-able paper for deep dives) that underpins vector's design.</p>\n\n<p>EDIT: Based on your comment I'll elaborate.  Only things syntactically in the form <code>new p</code> will avoid copying.  Since you're probably not writing <code>new</code> yourself then it will only appear as a result of inlined use of function from the vector package.  Looking at vector <a href=\"https://hackage.haskell.org/package/vector-0.12.0.1/docs/src/Data-Vector-Generic.html\" rel=\"noreferrer\">1</a>, it appears the functions I identified above use <code>new</code> and should thus allow <code>modify</code> to not copy <em>if things are inlined</em> and even then most those only preserve newness, the vector still had to be freshly constructed via something like <code>create</code>, <code>force</code>, <code>modify</code>, or <code>unstream</code>.</p>\n\n<p>For example, if you have the code:</p>\n\n<pre><code>v = fromList [1..10]\ng = modify f v\nf = undefined\n</code></pre>\n\n<p>Then <code>v</code> will be inlined and the vector is in the form <code>new p</code> (because <code>fromList</code> uses <code>unstream</code> which is <code>new</code>) and therefore <code>modify</code> will not have to copy the array.</p>\n\n<p>On the other hand, consider:</p>\n\n<pre><code>v = let v0 = fromList [1..10] in \n{-# NOINLINE v #-}\ng = modify f v\n</code></pre>\n\n<p>Now <code>v</code> is not inlined explicitly - it could also not be inlined because it is from a different module or the expression is shared.  As a result there is no code that is <em>syntactically</em> <code>modify f (new p)</code> and the rewrite rule won't fire.</p>\n\n<p>Less contrived, consider:</p>\n\n<pre><code>g = let v = fromList [1..10]\n        t = v ! 4\n        v2 = modify f v\n    in t + (v2 ! 4)\n</code></pre>\n\n<p>This is a common pattern where a vector is both read and modified - it obviously can't be modified before the read and the rewrite rules either won't fire (because there is no <code>new</code> there) or you'll have to lose sharing of <code>v</code>.</p>\n\n<p><a href=\"https://hackage.haskell.org/package/vector-0.12.0.1/docs/src/Data-Vector-Generic.html\" rel=\"noreferrer\">1</a> See <a href=\"https://hackage.haskell.org/package/vector-0.12.0.1/docs/src/Data-Vector-Generic.html\" rel=\"noreferrer\">here</a> for the rules \"slice/new [Vector]\", for example.</p>\n"}], "owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 204, "favorite_count": 1, "accepted_answer_id": 45850410, "answer_count": 1, "score": 12, "last_activity_date": 1503591383, "creation_date": 1503492211, "question_id": 45840094, "link": "https://stackoverflow.com/questions/45840094/when-does-modify-copy-the-vector", "title": "When does `modify` copy the vector?", "body": "<p>From <a href=\"https://hackage.haskell.org/package/vector-0.12.0.1/docs/Data-Vector.html#v:modify\" rel=\"noreferrer\">https://hackage.haskell.org/package/vector-0.12.0.1/docs/Data-Vector.html#v:modify</a></p>\n\n<blockquote>\n  <p>Apply a destructive operation to a vector. The operation will be performed in place if it is safe to do so and will modify a copy of the vector otherwise.</p>\n</blockquote>\n\n<p>This sounds like it can have drastically different performance characteristics depending on whether it is deemed \"safe\" to modify the vector in place. This motivates the questions...</p>\n\n<p>When will the modify be performed in place, and when will the vector be copied? Is there some way to ensure, by use of the type-system for example, that it <em>will</em> be modified in place?</p>\n"}, {"tags": ["haskell", "haskell-warp"], "comments": [{"owner": {"reputation": 2538, "user_id": 2622892, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/2902113df4fb9a260da8ba7ee1707228?s=128&d=identicon&r=PG", "display_name": "Deckerz", "link": "https://stackoverflow.com/users/2622892/deckerz"}, "edited": false, "score": 0, "creation_date": 1503492388, "post_id": 45839972, "comment_id": 78637551, "body": "Use something like <code>error &quot;Oops!&quot;</code> to throw an error, as by default Warp doesnt handle errors."}], "answers": [{"comments": [{"owner": {"reputation": 45723, "user_id": 18243, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/607cfd4a5b41fe6c886c978128b9c03e?s=128&d=identicon&r=PG", "display_name": "Jean-Paul Calderone", "link": "https://stackoverflow.com/users/18243/jean-paul-calderone"}, "edited": false, "score": 0, "creation_date": 1503575035, "post_id": 45846292, "comment_id": 78679299, "body": "Thanks.  This seems interesting but my Haskell abilities are too limited to actually understand what it means or how to integrate it into my app."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 45723, "user_id": 18243, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/607cfd4a5b41fe6c886c978128b9c03e?s=128&d=identicon&r=PG", "display_name": "Jean-Paul Calderone", "link": "https://stackoverflow.com/users/18243/jean-paul-calderone"}, "edited": false, "score": 0, "creation_date": 1503576167, "post_id": 45846292, "comment_id": 78680089, "body": "I&#39;ve added a full example now that I&#39;m back at my computer."}, {"owner": {"reputation": 701, "user_id": 3877993, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbce6b7e90ceede184992bfefb3b5f85?s=128&d=identicon&r=PG", "display_name": "cocreature", "link": "https://stackoverflow.com/users/3877993/cocreature"}, "edited": false, "score": 4, "creation_date": 1503587284, "post_id": 45846292, "comment_id": 78688660, "body": "What happens if <code>race_</code> kills the <code>warp</code> thread before it gets to <code>send</code>? Does <code>warp</code> guarantee that the response will still be send in that case?"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1503623415, "post_id": 45846292, "comment_id": 78704842, "body": "No, there are no such guarantees. If you want graceful shutdown, you can create the listening socket yourself and then close it, but you&#39;ll still need to figure out when it&#39;s the right time to exit the process."}, {"owner": {"reputation": 45723, "user_id": 18243, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/607cfd4a5b41fe6c886c978128b9c03e?s=128&d=identicon&r=PG", "display_name": "Jean-Paul Calderone", "link": "https://stackoverflow.com/users/18243/jean-paul-calderone"}, "edited": false, "score": 0, "creation_date": 1503657484, "post_id": 45846292, "comment_id": 78717304, "body": "How do you figure out when the right time is?  Clearly there are no absolutely guarantees possible that the peer has received the data sent -  but it is at least possible to wait for the local send buffer to empty.  Does Wai/Warp expose that information?"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1503659548, "post_id": 45846292, "comment_id": 78718493, "body": "No it doesn&#39;t. We could theoretically add some kind of bookkeeping for all of the open worker threads, but this has never been a case people have asked to be addressed. Instead, it&#39;s common to either leave the server running indefinitely (waiting for machine failure or a new deployment), or just let any in-flight requests to die and let the client resubmit."}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 9, "last_activity_date": 1504578790, "last_edit_date": 1504578790, "creation_date": 1503510389, "answer_id": 45846292, "question_id": 45839972, "link": "https://stackoverflow.com/questions/45839972/how-do-i-cause-a-warp-server-to-terminate/45846292#45846292", "title": "How do I cause a WARP server to terminate?", "body": "<p>I'm on my phone right now, so I can't type exact code for you. But the basic idea is to throw your Warp thread an async exception. That may sound complicated, but the easiest way to approach it is to use the race function from the async library. Something like this:</p>\n\n<pre><code>toExitVar &lt;- newEmptyMVar\nrace warp (takeMVar toExitVar)\n</code></pre>\n\n<p>And then in your handler, when you want Warp to exit:</p>\n\n<pre><code>putMVar toExitVar ()\n</code></pre>\n\n<p><strong>EDIT</strong> A day later and I'm back at my computer, here's a fully worked example:</p>\n\n<pre><code>#!/usr/bin/env stack\n-- stack --resolver lts-9.0 script\n{-# LANGUAGE OverloadedStrings #-}\n\nmodule Main where\n\nimport Network.Wai\nimport Network.Wai.Handler.Warp\nimport Network.HTTP.Types\nimport Control.Concurrent.Async\nimport Control.Concurrent.MVar\n\nmain :: IO ()\nmain = do\ntoDie &lt;- newEmptyMVar\nrace_ (takeMVar toDie) $ run 3000 $ \\req send -&gt;\n    if pathInfo req == [\"die\"]\n    then do\n        putMVar toDie ()\n        send $ responseLBS status200 [] \"Goodbye!\"\n    else send $ responseLBS status200 [] \"Still alive!\"\n</code></pre>\n"}], "owner": {"reputation": 45723, "user_id": 18243, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/607cfd4a5b41fe6c886c978128b9c03e?s=128&d=identicon&r=PG", "display_name": "Jean-Paul Calderone", "link": "https://stackoverflow.com/users/18243/jean-paul-calderone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 719, "favorite_count": 0, "accepted_answer_id": 45846292, "answer_count": 1, "score": 5, "last_activity_date": 1504578790, "creation_date": 1503491918, "question_id": 45839972, "link": "https://stackoverflow.com/questions/45839972/how-do-i-cause-a-warp-server-to-terminate", "title": "How do I cause a WARP server to terminate?", "body": "<p>I have an HTTP application server that needs to exit when handling a certain request under certain conditions (in order to be restarted by a supervisor).</p>\n\n<p>Given a main like:</p>\n\n<pre><code>import Network.Wai.Handler.Warp (run)\n\nmain :: IO ()\nmain = do\n  config &lt;- readConfig\n  run (portNumber config) (makeApp config)\n</code></pre>\n\n<p>and a handler something like:</p>\n\n<pre><code>livenessServer1 :: UTCTime -&gt; FilePath -&gt; Server LivenessProbeAPI1\nlivenessServer1 initialModificationTime monitorPath = do\n  mtime &lt;- liftIO $ getModificationTime monitorPath\n  case mtime == initialModificationTime of\n    True  -&gt; return $ Liveness initialModificationTime mtime\n    False -&gt; throwError $ err500 { errBody = \"File modified.\" }\n</code></pre>\n\n<p>How do I cause the process to end after delivering the 500 response?</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "edited": false, "score": 1, "creation_date": 1503474308, "post_id": 45833619, "comment_id": 78624351, "body": "what did you tried already?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1503474772, "post_id": 45833619, "comment_id": 78624650, "body": "Why should the last list not be part of the output? What do you mean with tuple, these are lists."}, {"owner": {"reputation": 53, "user_id": 8504674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/294f1b0497d2874f1081b56e8379e1f8?s=128&d=identicon&r=PG&f=1", "display_name": "Yi Justin", "link": "https://stackoverflow.com/users/8504674/yi-justin"}, "edited": false, "score": 0, "creation_date": 1503474974, "post_id": 45833619, "comment_id": 78624775, "body": "Because the last list doesn&#39;t contain any any pairs in List 1,"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1503479271, "post_id": 45833619, "comment_id": 78627676, "body": "Please first show what you&#39;ve tried. Right now this looks like a &quot;solve my homework for me&quot;-question..."}], "answers": [{"tags": [], "owner": {"reputation": 754, "user_id": 2140910, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CtvpI.jpg?s=128&g=1", "display_name": "Bjartur Thorlacius", "link": "https://stackoverflow.com/users/2140910/bjartur-thorlacius"}, "is_accepted": true, "score": 1, "last_activity_date": 1503495392, "creation_date": 1503495392, "answer_id": 45841328, "question_id": 45833619, "link": "https://stackoverflow.com/questions/45833619/haskell-how-should-i-check-and-return-the-elements-in-one-tuple-that-partially-e/45841328#45841328", "title": "Haskell How should I check and return the elements in one tuple that partially exists in the other tuple?", "body": "<p>Your example output contains the first three sublists from <code>List2</code>. Your <code>List1</code> is of length 3. Do you want to truncate <code>List2</code> to the length of <code>List1</code>? If so, try </p>\n\n<pre><code>list1 = [[\"H1\",\"B1\"],[\"H2\",\"B2\"],[\"H3\",\"B2\"]]\nlist2 = [[\"H1\",\"B1\",\"H5\"],[\"H2\",\"B2\",\"H5\"],[\"H2\",\"H3\",\"B2\"]]\n\ntruncatedList2 = take (length list1) list2\n\nmain = print truncatedList2\n</code></pre>\n\n<p>Try <a href=\"http://codepad.org/fOgOCQ4a\" rel=\"nofollow noreferrer\">running the Haskell snippet</a>.</p>\n"}], "owner": {"reputation": 53, "user_id": 8504674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/294f1b0497d2874f1081b56e8379e1f8?s=128&d=identicon&r=PG&f=1", "display_name": "Yi Justin", "link": "https://stackoverflow.com/users/8504674/yi-justin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 45841328, "answer_count": 1, "score": -4, "last_activity_date": 1503495392, "creation_date": 1503474276, "last_edit_date": 1503490770, "question_id": 45833619, "link": "https://stackoverflow.com/questions/45833619/haskell-how-should-i-check-and-return-the-elements-in-one-tuple-that-partially-e", "title": "Haskell How should I check and return the elements in one tuple that partially exists in the other tuple?", "body": "<p>I am new to Haskell programming, I currently Have a list1 [[String]] that contains </p>\n\n<blockquote>\n  <p>[[\"H1\",\"B1\"],[\"H2\",\"B2\"],[\"H3\",\"B2\"]]</p>\n</blockquote>\n\n<p>and another List2 [[String]]</p>\n\n<blockquote>\n  <p>[[\"H1\",\"B1\",\"H5\"],[\"H2\",\"B2\",\"H5\"],[\"H2\",\"H3\",\"B2\"],[\"H5\",\"B1\",\"H4\"]]</p>\n</blockquote>\n\n<p>and I want to return a result based on list2 that contains elements in List1 like</p>\n\n<blockquote>\n  <p>[[\"H1\",\"B1\",\"H5\"],[\"H2\",\"B2\",\"H5\"],[\"H2\",\"H3\",\"B2\"]]</p>\n</blockquote>\n\n<p>does anyone understand what I mean? \nI totally have no idea how to start on this problem, Thanks for helping\nI want to use it as filter and what I design was </p>\n\n<pre><code>isInList :: [[String]] -&gt; [[String]] -&gt; Bool\nisInList (x:xs) y = filter (any (`elem` x)) y\n</code></pre>\n\n<p>But this gave me a wrong answer [[\"H1\",\"B1\",\"H5\"],[\"H5\",\"B1\",\"H4\"]]\nwhere did I wrong?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1503466445, "post_id": 45831323, "comment_id": 78620016, "body": "What does your code do? (I know what it does, but I want you to tell me)"}, {"owner": {"reputation": 153, "user_id": 8504003, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/beac662dffbe284ed51aa8f6ca49ecb8?s=128&d=identicon&r=PG&f=1", "display_name": "Liu Junhan", "link": "https://stackoverflow.com/users/8504003/liu-junhan"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1503466665, "post_id": 45831323, "comment_id": 78620092, "body": "this code just a filter function and I want to apply it to my other function"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1503466985, "post_id": 45831323, "comment_id": 78620206, "body": "What other function? And what does it <i>actually do</i>?"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 5, "creation_date": 1503467010, "post_id": 45831323, "comment_id": 78620222, "body": "<code>filter (any (elem &#39;2&#39;))</code>"}, {"owner": {"reputation": 153, "user_id": 8504003, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/beac662dffbe284ed51aa8f6ca49ecb8?s=128&d=identicon&r=PG&f=1", "display_name": "Liu Junhan", "link": "https://stackoverflow.com/users/8504003/liu-junhan"}, "edited": false, "score": 0, "creation_date": 1503468066, "post_id": 45831323, "comment_id": 78620654, "body": "What do you mean? I just wanna use this function to find every pair of the list that contains 2 or other words I want to search"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1503468331, "post_id": 45831323, "comment_id": 78620795, "body": "I don&#39;t know if you meant me or 4castle, but my question is literally <i>what does your function do?</i>..."}], "answers": [{"tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": false, "score": 0, "last_activity_date": 1503468554, "creation_date": 1503468554, "answer_id": 45831854, "question_id": 45831323, "link": "https://stackoverflow.com/questions/45831323/haskell-how-can-i-traverse-a-string-type-to-check-whether-a-given-string-is/45831854#45831854", "title": "Haskell, how can I traverse a [[String type]] to check whether a given string is in the list?", "body": "<p>By the type definition <code>isIn :: Int -&gt; [String] -&gt; Bool</code> I assume that the function is iterating the list of strings (for example <code>[\"A1\",\"A2\",\"A3\"]</code>).</p>\n\n<p>Therefore, the problem is in <code>show a == x</code>. <code>x</code> is equal to <code>\"A1\"</code>, <code>\"A2\"</code>, <code>\"A3\"</code>; <code>show 2</code> is <code>\"2\"</code>; but <code>\"2\"</code> is not equal to any of these strings.</p>\n\n<p>You'll need to use the function that verifies that a string <code>contains</code> \"2\", not <code>equal</code> to \"2\" (there's <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Prelude.html#v:elem\" rel=\"nofollow noreferrer\">elem</a> function)</p>\n\n<p>Or implement it:</p>\n\n<pre><code>isInString :: Int -&gt; [Char] -&gt; Bool\nisInString a [] = False\nisInString a (x:xs)\n  | intToDigit a == x = True\n  | otherwise = isInString a xs\n</code></pre>\n\n<p>And then use it in <code>isIn</code>:</p>\n\n<pre><code>isIn :: Int -&gt; [String] -&gt; Bool\nisIn a [] = False\nisIn a (x:xs)\n  | isInString a x = True\n  | otherwise = isIn a xs\n</code></pre>\n"}], "owner": {"reputation": 153, "user_id": 8504003, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/beac662dffbe284ed51aa8f6ca49ecb8?s=128&d=identicon&r=PG&f=1", "display_name": "Liu Junhan", "link": "https://stackoverflow.com/users/8504003/liu-junhan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 113, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1503468554, "creation_date": 1503466287, "last_edit_date": 1503466388, "question_id": 45831323, "link": "https://stackoverflow.com/questions/45831323/haskell-how-can-i-traverse-a-string-type-to-check-whether-a-given-string-is", "title": "Haskell, how can I traverse a [[String type]] to check whether a given string is in the list?", "body": "<p>I am having a problem, I have a list like this <code>[[\"A1\",\"A2\",\"A3\"],[\"B1\",\"B2\",\"B3\"],[\"A1\",\"B3\"\"C3\"]]</code>\nI want to return a list if every string contains 2,\nthe desired return should be as follows:</p>\n\n<pre><code>[[\"A1\",\"A2\",\"A3\"],[\"B1\",\"B2\",\"B3\"]]\n</code></pre>\n\n<p>my recent approach is  </p>\n\n<pre><code>isIn :: Int -&gt; [String] -&gt; Bool\nisIn a [] = False\nisIn a (x:xs)\n  | show a == x = True\n  | otherwise = isIn a xs\n</code></pre>\n\n<p>And I tested it using the list above it gave me False, what did I wrong?\nHow should I fix this?</p>\n"}, {"tags": ["haskell", "functional-programming", "monads"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1503466039, "post_id": 45831014, "comment_id": 78619844, "body": "<code>findM f = fold (\\rest x -&gt; do b &lt;- f x; if b then return $ Just x else rest) (return Nothing)</code> should do it."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1503504510, "post_id": 45831014, "comment_id": 78647239, "body": "Note that <a href=\"http://hoogle.haskell.org/?hoogle=Monad+m+%3D%3E+%28a+-%3E+m+Bool%29+-%3E+%5Ba%5D+-%3E+m+%28Maybe+a%29&amp;scope=set%3Astackage\" rel=\"nofollow noreferrer\">the new alpha version Hoogle does find it</a>."}], "answers": [{"tags": [], "owner": {"reputation": 231, "user_id": 5824635, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c43dd400f3c9c2cbaeb8986532cd359b?s=128&d=identicon&r=PG&f=1", "display_name": "homura", "link": "https://stackoverflow.com/users/5824635/homura"}, "is_accepted": false, "score": 5, "last_activity_date": 1503465829, "creation_date": 1503465829, "answer_id": 45831224, "question_id": 45831014, "link": "https://stackoverflow.com/questions/45831014/how-to-implement-findm-in-haskell/45831224#45831224", "title": "How to implement findM in Haskell?", "body": "<p>Yes. From the package \"extra\", module Control.Monad.Extra</p>\n\n<p><a href=\"https://hackage.haskell.org/package/extra-1.6/docs/Control-Monad-Extra.html#v:findM\" rel=\"noreferrer\">https://hackage.haskell.org/package/extra-1.6/docs/Control-Monad-Extra.html#v:findM</a></p>\n"}], "owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1503488871, "creation_date": 1503464822, "last_edit_date": 1503488871, "question_id": 45831014, "link": "https://stackoverflow.com/questions/45831014/how-to-implement-findm-in-haskell", "title": "How to implement findM in Haskell?", "body": "<p>Is there existing implementation for the following function? I couldn't find it on hoogle</p>\n\n<pre><code>findM :: Monad m =&gt; (a -&gt; m Bool) -&gt; [a] -&gt; m (Maybe a)\n</code></pre>\n"}, {"tags": ["haskell", "action", "monads", "haskell-snap-framework"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1503464956, "post_id": 45830569, "comment_id": 78619444, "body": "What does it mean to &quot;mutate the MonadSnap&quot;? Mutable values can be mutated, whereas <code>MonadSnap</code> is a typeclass, which is not even a value. <code>modifyResponse</code> modifies the Response - it does so by calling a function which modifies the entire <code>SnapState</code>, and modifies only the portion of the state corresponding to the <code>Response</code>."}, {"owner": {"reputation": 47, "user_id": 4032862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d0dc7b2d21065cd40272893a40d927c?s=128&d=identicon&r=PG&f=1", "display_name": "lhcopetti", "link": "https://stackoverflow.com/users/4032862/lhcopetti"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503491899, "post_id": 45830569, "comment_id": 78637149, "body": "I don&#39;t think I phrased that correctly. My question is how can I mutate the underlying SnapState which is itself contained inside the Snap record without even receiving it as a parameter. I got carried away by saying MonadSnap because it was the only thing that I could see in the declaration that was not so clear to me"}], "answers": [{"comments": [{"owner": {"reputation": 47, "user_id": 4032862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d0dc7b2d21065cd40272893a40d927c?s=128&d=identicon&r=PG&f=1", "display_name": "lhcopetti", "link": "https://stackoverflow.com/users/4032862/lhcopetti"}, "edited": false, "score": 0, "creation_date": 1503499091, "post_id": 45831146, "comment_id": 78643237, "body": "Your answer about the indirection was especially enlightening. Another reference that actually helped me visualize what I was trying to understand comes from this question: <a href=\"https://stackoverflow.com/questions/39807736/how-can-i-write-this-simple-code-using-the-state-monad?rq=1\" title=\"how can i write this simple code using the state monad\">stackoverflow.com/questions/39807736/&hellip;</a>. The same way as <code>modifyResponse</code> does, the <code>addToState</code> acts upon the state without actually receiving it as a parameter. I guess that is a pattern I should get accustomed to."}], "tags": [], "owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "is_accepted": true, "score": 2, "last_activity_date": 1503466065, "last_edit_date": 1503466065, "creation_date": 1503465451, "answer_id": 45831146, "question_id": 45830569, "link": "https://stackoverflow.com/questions/45830569/how-can-one-mutate-a-state-when-returning-an-empty-action/45831146#45831146", "title": "How can one mutate a state when returning an empty action", "body": "<p>Here's the <a href=\"https://hackage.haskell.org/package/snap-core-1.0.3.0/docs/src/Snap-Internal-Core.html#modifyResponse\" rel=\"nofollow noreferrer\">source code</a> for <code>modifyResponse</code>:</p>\n\n<pre><code>modifyResponse :: MonadSnap m =&gt; (Response -&gt; Response) -&gt; m ()\nmodifyResponse f = liftSnap $\n     smodify $ \\ss -&gt; ss { _snapResponse = f $ _snapResponse ss }\n</code></pre>\n\n<p>The only function in the <code>MonadSnap</code> typeclass is <a href=\"https://hackage.haskell.org/package/snap-core-1.0.3.0/docs/Snap-Core.html#v:liftSnap\" rel=\"nofollow noreferrer\"><code>liftSnap</code></a>, and the only pre-defined instance of the typeclass is the <a href=\"https://hackage.haskell.org/package/snap-core-1.0.3.0/docs/src/Snap-Internal-Core.html#line-403\" rel=\"nofollow noreferrer\"><code>Snap</code></a> monad (where it's defined as <code>liftSnap = id</code>).</p>\n\n<p>It's just a tiny bit of indirection in order to allow the function to work with other types that implement <code>MonadSnap</code> also. It makes working with <a href=\"https://en.wikipedia.org/wiki/Monad_transformer\" rel=\"nofollow noreferrer\">Monad Transformer</a> stacks much easier. The signature could have been:</p>\n\n<pre><code>modifyResponse :: (Response -&gt; Response) -&gt; Snap ()\n</code></pre>\n\n<hr>\n\n<p>Now, perhaps your next question is: <strong>\"How does <code>smodify</code> work?\"</strong></p>\n\n<p>Here's the <a href=\"https://hackage.haskell.org/package/snap-core-1.0.3.0/docs/src/Snap-Internal-Core.html#smodify\" rel=\"nofollow noreferrer\">source code</a>:</p>\n\n<pre><code>smodify :: (SnapState -&gt; SnapState) -&gt; Snap ()\nsmodify f = Snap $ \\sk _ st -&gt; sk () (f st)\n</code></pre>\n\n<p>As you can see, it's not magic, just functions. The internal <code>SnapState</code> is being hidden from you, because you don't need to know the internals of <code>Snap</code> in order to use it. Just like how you don't need to know the internals of the <code>IO</code> monad in order to use it.</p>\n"}, {"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 1, "last_activity_date": 1503465785, "creation_date": 1503465785, "answer_id": 45831213, "question_id": 45830569, "link": "https://stackoverflow.com/questions/45830569/how-can-one-mutate-a-state-when-returning-an-empty-action/45831213#45831213", "title": "How can one mutate a state when returning an empty action", "body": "<p>Every instance of <code>MonadSnap</code> must provide a <a href=\"https://hackage.haskell.org/package/snap-core-1.0.3.0/docs/src/Snap-Internal-Core.html#liftSnap\" rel=\"nofollow noreferrer\"><code>liftSnap</code></a> method:</p>\n\n<blockquote>\n<pre><code>-- | 'MonadSnap' is a type class, analogous to 'MonadIO' for 'IO', that makes it\n-- easy to wrap 'Snap' inside monad transformers.\nclass (Monad m, MonadIO m, MonadBaseControl IO m, MonadPlus m, Functor m,\n       Applicative m, Alternative m) =&gt; MonadSnap m where\n  -- | Lift a computation from the 'Snap' monad.\n  liftSnap :: Snap a -&gt; m a\n</code></pre>\n</blockquote>\n\n<p>The means that any time there's a <code>MonadSnap m</code> it's easy to convert a concrete <code>Snap a</code> into <code>m a</code> via <code>liftSnap</code>.</p>\n\n<p>Modifying a concrete <a href=\"https://hackage.haskell.org/package/snap-core-1.0.3.0/docs/src/Snap-Internal-Core.html#Snap\" rel=\"nofollow noreferrer\"><code>Snap</code></a>'s state <a href=\"https://hackage.haskell.org/package/snap-core-1.0.3.0/docs/src/Snap-Internal-Core.html#smodify\" rel=\"nofollow noreferrer\">is done</a> by succeeding with the new <a href=\"https://hackage.haskell.org/package/snap-core-1.0.3.0/docs/src/Snap-Internal-Core.html#SnapState\" rel=\"nofollow noreferrer\"><code>SnapState</code></a> and a unit <code>()</code> value. <code>sk</code> is the success continuation for what to do on success.</p>\n\n<blockquote>\n<pre><code>-- | Local Snap monad version of 'modify'.\nsmodify :: (SnapState -&gt; SnapState) -&gt; Snap ()\nsmodify f = Snap $ \\sk _ st -&gt; sk () (f st)\n{-# INLINE smodify #-}\n</code></pre>\n</blockquote>\n\n<p><a href=\"https://hackage.haskell.org/package/snap-core-1.0.3.0/docs/src/Snap-Internal-Core.html#modifyResponse\" rel=\"nofollow noreferrer\"><code>modifyResponse</code></a> lifts <code>smodify</code> from <code>Snap a</code> to <code>MonadSnap m =&gt; m a</code>. The function <code>f</code> passed to <code>smodify</code> is a function that modifies only the <code>_snapResponse</code> field of the <code>SnapState</code> record.</p>\n\n<blockquote>\n<pre><code>modifyResponse :: MonadSnap m =&gt; (Response -&gt; Response) -&gt; m ()\nmodifyResponse f = liftSnap $\n     smodify $ \\ss -&gt; ss { _snapResponse = f $ _snapResponse ss }\n{-# INLINE modifyResponse #-}\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 47, "user_id": 4032862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d0dc7b2d21065cd40272893a40d927c?s=128&d=identicon&r=PG&f=1", "display_name": "lhcopetti", "link": "https://stackoverflow.com/users/4032862/lhcopetti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "accepted_answer_id": 45831146, "answer_count": 2, "score": 0, "last_activity_date": 1503466065, "creation_date": 1503461772, "question_id": 45830569, "link": "https://stackoverflow.com/questions/45830569/how-can-one-mutate-a-state-when-returning-an-empty-action", "title": "How can one mutate a state when returning an empty action", "body": "<p>I have been learning haskell for some time and I just finished reading 'Learn you a Haskell for great good'. My question comes from an assignment I'm currently trying to complete. Basically, I have been using the Snap Framework and I'm currently having a hard time understanding how the state (in this case the Request + Response object, the MonadSnap) is mutated when making calls such the one below:</p>\n\n<pre><code>modifyResponse :: MonadSnap m =&gt; (Response -&gt; Response) -&gt; m ()\n</code></pre>\n\n<p>I can't quite figure out how the <a href=\"https://hackage.haskell.org/package/snap-core-1.0.3.0/docs/Snap-Core.html#v:modifyResponse\" rel=\"nofollow noreferrer\">modifyResponse</a> method mutates the underlying <code>MonadSnap</code> while only specifying it as a type constraint.</p>\n\n<p>I've come across this similar concept while searching for the answer and I believe the same answer would apply if I wanted to keep a state and make the below functions work as intended, like the OP proposed in <a href=\"https://stackoverflow.com/questions/7840126/why-monads-how-does-it-resolve-side-effects\">this answer</a>:</p>\n\n<pre><code>instance M Monad where ...\n\n-- Modify the counter and do not produce any result:\nincrementCounter :: M ()\ndecrementCounter :: M ()\n\n-- Get the current value of the counter\nreadCounter :: M Integer\n</code></pre>\n"}, {"tags": ["haskell", "record"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 5, "creation_date": 1503456489, "post_id": 45829812, "comment_id": 78617323, "body": "Try <code>A {f = \\x -&gt; x * 2 }</code>."}, {"owner": {"reputation": 39, "user_id": 7451098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39fe959bc517e75cc15b38f3605a5936?s=128&d=identicon&r=PG&f=1", "display_name": "owen", "link": "https://stackoverflow.com/users/7451098/owen"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1503458422, "post_id": 45829812, "comment_id": 78617751, "body": "That works, but I don&#39;t understand why it can&#39;t be done in the way above."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 3, "creation_date": 1503461654, "post_id": 45829812, "comment_id": 78618482, "body": "The <a href=\"https://www.haskell.org/onlinereport/exps.html#record-construction\" rel=\"nofollow noreferrer\">Haskell report</a> defines record construction as requiring that each field name is written exactly as defined, and there can&#39;t be anything but whitespace between <code>k</code> and <code>=</code> in <code>k = v</code>. I guess they just didn&#39;t think of it or didn&#39;t think it was worth the effort of defining."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1503564873, "post_id": 45829812, "comment_id": 78672039, "body": "With the <code>RecordWildCards</code> extension you can also use <code>let f x = x * 2 in A{..}</code> but IMO it&#39;s simpler to use a lambda as Alec suggested. The syntax could allow your form, which makes sense. Probably, since you can&#39;t define arbitrary identifiers inside <code>A{}</code>, the Haskell designers choose a custom syntax rather than re-using the one for definitions."}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1503696936, "post_id": 45829812, "comment_id": 78738913, "body": "Are you asking about &quot;why&quot; as in &quot;why was haskell chosen to be written this way?&quot; or, &quot;why&quot; as in &quot;what part of the haskell spec says that this can&#39;t be done&quot;?"}], "answers": [{"tags": [], "owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "is_accepted": false, "score": 0, "last_activity_date": 1503664086, "creation_date": 1503664086, "answer_id": 45881459, "question_id": 45829812, "link": "https://stackoverflow.com/questions/45829812/haskell-cannot-define-function-as-part-of-record/45881459#45881459", "title": "Haskell cannot define function as part of record?", "body": "<p>The following is the grammar for constructions using field labels.</p>\n\n<pre><code>aexp    \u2192   qcon { fbind1 , \u2026 , fbindn }        (labeled construction, n \u2265 0)\nfbind   \u2192   qvar = exp\n</code></pre>\n\n<p>Note that <code>qcon</code> is a constructor syntax, <code>qvar</code> is a variable syntax, and <code>exp</code> is an expression syntax.</p>\n\n<p>The reason <code>A {f x = x * 2}</code> does not work therefore is because it is invalid syntax. A syntax that is valid and that is probably what you want is <code>A {f = \\x -&gt; x * 2}</code>. Alternatively, <code>A {f = (* 2)}</code>, <code>A {f = (2 *)}</code>, or <code>A {f = (*) 2}</code>.</p>\n\n<p>Construction using field labels operates like named parameters. Given a data type definition such as</p>\n\n<pre><code>data Person = Person { name :: String, age :: Int }\n</code></pre>\n\n<p>The expression</p>\n\n<pre><code>Person { age = 65, name = \"Wilbur Suidae\" }\n</code></pre>\n\n<p>Means</p>\n\n<pre><code>Person \"Wilbur Suidae\" 65\n</code></pre>\n\n<p>That is, the constructor arguments are ordered to match the order of fields according to the constructor definition.</p>\n\n<p>The expression</p>\n\n<pre><code>Person { age = 65 }\n</code></pre>\n\n<p>Means</p>\n\n<pre><code>Person undefined 65\n</code></pre>\n\n<p>That is, if a field is not explicitly assigned a value it is implicitly assigned the value <code>undefined</code>.</p>\n\n<h3>References</h3>\n\n<ul>\n<li><a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-520003.15.2\" rel=\"nofollow noreferrer\"><em>Construction Using Field Labels</em>, \u00a7 3.15.2, Haskell Report 2010</a></li>\n</ul>\n"}], "owner": {"reputation": 39, "user_id": 7451098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39fe959bc517e75cc15b38f3605a5936?s=128&d=identicon&r=PG&f=1", "display_name": "owen", "link": "https://stackoverflow.com/users/7451098/owen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 89, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1503664086, "creation_date": 1503456234, "question_id": 45829812, "link": "https://stackoverflow.com/questions/45829812/haskell-cannot-define-function-as-part-of-record", "title": "Haskell cannot define function as part of record?", "body": "<p>I would like to define a data type that is a record with one function named f:</p>\n\n<p><code>data A = A { f :: Int -> Int }</code></p>\n\n<p>and I would like to create an instance:</p>\n\n<p><code>A {f x = x * 2 }</code></p>\n\n<p>However: this gives a syntax error:</p>\n\n<p><code>error: parse error on input \u2018x\u2019</code></p>\n"}, {"tags": ["haskell", "list-comprehension", "monads"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1503458251, "post_id": 45829766, "comment_id": 78617721, "body": "In both cases, the <code>recordsForPeople</code> lines can be written <code>mapM (recordsForPeople population) mTypes</code>. All that is left then is to generalize the integer passed to <code>choose</code>. <code>measures</code> becomes quite simply <code>fromList (choose allMeasurementTypes k) &gt;&gt;= mapM (recordsForPeople population)</code>, where <code>k</code> is a parameter passed to <code>allMeasurements</code>."}, {"owner": {"reputation": 163, "user_id": 1726711, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/5ee3c84885f5344315b2c555454433e3?s=128&d=identicon&r=PG", "display_name": "Dahan", "link": "https://stackoverflow.com/users/1726711/dahan"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503500931, "post_id": 45829766, "comment_id": 78644707, "body": "Wonderful! That&#39;s exactly, what I was missing in my understanding. I overlooked this superpower of <code>mapM</code>."}], "answers": [{"tags": [], "owner": {"reputation": 163, "user_id": 1726711, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/5ee3c84885f5344315b2c555454433e3?s=128&d=identicon&r=PG", "display_name": "Dahan", "link": "https://stackoverflow.com/users/1726711/dahan"}, "is_accepted": false, "score": 1, "last_activity_date": 1503503350, "creation_date": 1503503350, "answer_id": 45844272, "question_id": 45829766, "link": "https://stackoverflow.com/questions/45829766/haskell-list-monad-generalize-by-parameter/45844272#45844272", "title": "Haskell List Monad \u2014 generalize by parameter", "body": "<pre><code>allMeasurements :: Int -&gt; [Human] -&gt; Seq (Int, [(String, [Double])])\nallMeasurements k population = mapWithIndex (,) measures\n  where\n    measures = mapM (recordsForPeople population) =&lt;&lt; fromList (choose allMeasurementTypes k)\n</code></pre>\n\n<p>Soo easy. I just overlooked <code>mapM</code> superpower.</p>\n"}], "owner": {"reputation": 163, "user_id": 1726711, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/5ee3c84885f5344315b2c555454433e3?s=128&d=identicon&r=PG", "display_name": "Dahan", "link": "https://stackoverflow.com/users/1726711/dahan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1503503350, "creation_date": 1503455920, "question_id": 45829766, "link": "https://stackoverflow.com/questions/45829766/haskell-list-monad-generalize-by-parameter", "title": "Haskell List Monad \u2014 generalize by parameter", "body": "<p>Let's imagine a population (of humans). Each human has things, that have length (left arm, right arm, left leg, right leg). Each human has things, that may have width (chest, waist). There are much more parameters that a human may have.</p>\n\n<p>All measurement types are</p>\n\n<pre><code>allMeasurementTypes = [Width, Length, Diameter, Weight] -- and similar things.\n</code></pre>\n\n<p>For statistics I want to get for all population all possible pairs of measurements.</p>\n\n<p>Something like that:</p>\n\n<pre><code>Pair1_LeftLeg Pair1_Waist Pair2_LeftLeg Pair2_Chest Pair3_RightLeg Pair3_Waist...\n102           70          102           90          101            70         ...\n115           60          115           85          116            60         ...\n...           ...         ...           ...         ...            ...        ...\n</code></pre>\n\n<p>Don't tell me, that there are duplications here. I know. But it is easier for me to have it like that to process further in statistical applications.</p>\n\n<p>So I construct this in the following way</p>\n\n<pre><code>allMeasurements :: [Human] -&gt; Seq (Int, [(String, [Double])])\nallMeasurements population = mapWithIndex (,) measures\n  where\n    measures = do\n      mTypes &lt;- fromList $ choose allMeasurementTypes 2\n      rec1 &lt;- recordsForPeople population $ head mTypes\n      rec2 &lt;- recordsForPeople population $ mTypes !! 1\n      return [rec1, rec2]\n</code></pre>\n\n<p>And now I explain it line by line.</p>\n\n<pre><code>allMeasurements :: [Human] -&gt; Seq (Int, [(String, [Double])])\n</code></pre>\n\n<p>Here <code>Int</code> is the number of the pair. If it is <code>Pair1</code>, then <code>String</code> would be <code>\"LeftLeg\"</code> and then <code>\"Waist\"</code>. <code>[Double]</code> is the array of values of each measurement on <em>all population.</em></p>\n\n<pre><code>allMeasurements population = mapWithIndex (,) measures\n  where\n    measures = do\n      mTypes &lt;- fromList $ choose allMeasurementTypes 2\n</code></pre>\n\n<p>This iterates through all possible pairs of measurement types. <code>choose</code> gets all possible pairs like <code>[Width, Length]</code>, <code>[Width, Diameter]</code>...</p>\n\n<pre><code>      rec1 &lt;- recordsForPeople population $ head mTypes\n</code></pre>\n\n<p>Assuming, that first mType is <code>Length</code>, <code>rec1</code> iterates through all possible lengths. <code>rec1</code> iterates through <code>(\"LeftLeg\", [102, 115, ...])</code>, <code>(\"RightLeg\", [101, 116, ...])</code>...</p>\n\n<pre><code>      rec2 &lt;- recordsForPeople population $ mTypes !! 1\n</code></pre>\n\n<p>Assuming, that second mType is <code>Width</code>, <code>rec2</code> iterates through all possible widths. <code>rec2</code> iterates through <code>(\"Waist\", [70, 60, ...])</code>, <code>(\"Chest\", [90, 85, ...])</code>...</p>\n\n<pre><code>      return [rec1, rec2]\n</code></pre>\n\n<p>And finally I collect together all everything. It gives full <code>Seq</code> of all possible pairs of individual measurements for all population. <code>mapWithIndex</code> above just runs through this full list and injects actual <code>Int</code> number of pair inside. I chose <code>Seq</code> actually only because it has this <code>mapWithIndex</code>. Then it all goes out for rendering to <code>csv</code> or <code>json</code>.</p>\n\n<p>Maybe I might do it better and smarter. Uff.</p>\n\n<p>Here comes the real question.</p>\n\n<p>Besides table of pairs, I also want to generate table of trinities.</p>\n\n<pre><code>allTriMeasurements :: [Human] -&gt; Seq (Int, [(String, [Double])])\nallTriMeasurements population = mapWithIndex (,) measures\n  where\n    measures = do\n      mTypes &lt;- fromList $ choose allMeasurementTypes 3\n      rec1 &lt;- recordsForPeople population $ head mTypes\n      rec2 &lt;- recordsForPeople population $ mTypes !! 1\n      rec3 &lt;- recordsForPeople population $ mTypes !! 2\n      return [rec1, rec2, rec3]\n</code></pre>\n\n<p>Is it anyhow possible to generalize these two functions <code>allMeasurements</code> and <code>allTriMeasurements</code> by parameter <code>n</code>, defining if it is 2 for pairs or 3 for trinities.</p>\n\n<p>I already dropped the ideas about <code>fmap</code> and similar, because here for (monadic) list comprehension all <code>rec_i &lt;- ...</code> should go one after another. And any kind of <code>doSomething &lt;$&gt; [0 .. (n-1)]</code> breaks the structure.</p>\n\n<p>It is pretty possible, that I did it all wrong. If anyone besides me is able to understand, what is going on here, I would greatly appreciate any ideas. As it seems to me the ugliest place in my code.</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1503453135, "post_id": 45829110, "comment_id": 78616494, "body": "If such terse mathematical language is accessible to you, I think <a href=\"https://ncatlab.org/nlab/show/monad\" rel=\"nofollow noreferrer\">this</a> is a clear definition. Basically, the left-hand diagram corresponds to the first two laws you&#39;ve stated (<code>join . pure = join . fmap pure = id</code>) and the right-hand diagram can be stated as <code>join . join = join . fmap join</code>. Note that <code>(\\h k m -&gt; join (fmap h (join (fmap k m)))) id id = \\m -&gt; join (join m)</code> - this follows from <code>fmap id = id</code> (and likewise for the other side of the two equalities). In other words, your law expresses both functor and monad laws in one statement."}], "answers": [{"comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 4, "creation_date": 1503461684, "post_id": 45829556, "comment_id": 78618490, "body": "With your English explanation, I think I actually prefer these laws to the Kleisli composition version."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1509221799, "post_id": 45829556, "comment_id": 80934527, "body": "You&#39;re missing one law: <code>join . fmap (fmap f) \u2261 fmap f . join</code>"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 3, "creation_date": 1509222225, "post_id": 45829556, "comment_id": 80934640, "body": "@Shersh That&#39;s implied by <code>join</code> being a natural transformation. A natural transformation is <code>f: F -&gt; G</code> must have <code>f . F(m) = G(m) . f</code> for all morphisms <code>m</code>."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 1, "creation_date": 1509223769, "post_id": 45829556, "comment_id": 80935100, "body": "All this is really good... But I can&#39;t see how to derive this law from other two laws in your question. The origin question is about Monad laws in terms of join so it&#39;s quite reasonable to see all laws for Monad. It&#39;s just the fact that not every person knows Category Theory but this person may google &quot;Monad laws in terms of join&quot; and won&#39;t find all laws."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1509228224, "post_id": 45829556, "comment_id": 80936268, "body": "@Shersh You derive it from it&#39;s type. Any definition of <code>join</code> that typechecks (and doesn&#39;t cheat with bottom) obeys that law. You can edit it in if you feel like it, but make a note that it is automatically true."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1509228820, "post_id": 45829556, "comment_id": 80936424, "body": "But this law can&#39;t be derived from other laws. I don&#39;t understand what it means to derive from type... It&#39;s not clear for me, how one person can look at type class <code>class Functor m =&gt; MonadJoin m where</code> in Haskell and automatically come up with all laws for this type class."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 2, "creation_date": 1509229550, "post_id": 45829556, "comment_id": 80936599, "body": "<code>join :: forall m a. Monad m =&gt; m (m a) -&gt; m a</code> (<code>join</code> is indexed by <code>m</code> and is parametric in <code>a</code>). Parametric types give rise to theorems. In particular, if <code>Functor f, g</code>, then for any <code>r :: forall a. f a -&gt; g a</code>, the type tells you that <code>r . fmap @f k = fmap @g k . r</code> for all <code>k</code>. In the case of <code>join</code>, <code>g = m</code> and <code>f = m . m</code>, so <code>fmap @f k = fmap @m (fmap @m k)</code> and you get the law <code>join . (fmap (fmap k)) = fmap k . join</code> This law is therefore implied by the type of <code>join</code> and is checked by the typechecker. <a href=\"https://people.mpi-sws.org/~dreyer/tor/papers/wadler.pdf\" rel=\"nofollow noreferrer\">people.mpi-sws.org/~dreyer/tor/papers/wadler.pdf</a>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1521223685, "post_id": 45829556, "comment_id": 85655771, "body": "@Shersh [1/2] HTNW&#39;s explanation is appropriate. <code>join . fmap (fmap f) \u2261 fmap f . join</code> isn&#39;t usually taken as a monad law, as it follows from parametricity and/or naturality (a typical presentation goes like this: &quot;<code>join</code> and <code>return</code> are natural transformations that obey the following three laws...&quot;). If you allow me an unsubstantiated guess, I suspect you might have been thinking of either of the following two passages..."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1521223690, "post_id": 45829556, "comment_id": 85655774, "body": "[2/2] ...from <a href=\"https://en.wikipedia.org/wiki/Monad_(functional_programming)#fmap_and_join\" rel=\"nofollow noreferrer\">Wikipedia</a> and the <a href=\"https://en.wikibooks.org/wiki/Haskell/Category_theory#The_third_and_fourth_laws\" rel=\"nofollow noreferrer\">Haskell Wikibook</a>, which confusingly add <code>join . fmap (fmap f) \u2261 fmap f . join</code> as a law (and even, in the Wikibook, talk about a &quot;fourth law&quot;). With respect to the Wikibook, <a href=\"https://en.wikibooks.org/wiki/Talk:Haskell/Category_theory#Second_monad_law\" rel=\"nofollow noreferrer\">I have been aware of this problem for quite a while</a>, but have been continuously procrastinating a rewrite of the relevant section -- shame on me... :P"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1563911740, "post_id": 45829556, "comment_id": 100855899, "body": "@duplode I&#39;ve edited this into the body of the answer; but it got me thinking: the &quot;fourth Monad law&quot; is guaranteed by <code>join</code> being a natural transformation, but what&#39;s the guarantee for a given monad&#39;s <code>join</code> to be natural transformation? so maybe this condition, that <code>join</code> is natural transformation, itself becomes the fourth monad law?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1563933268, "post_id": 45829556, "comment_id": 100860993, "body": "@WillNess <code>join . fmap (fmap f) \u2261 fmap f . join</code> is itself saying that <code>join</code> is a natural transformation -- one from the Hask endofunctor <code>Compose m m</code> to the Hask endofunctor <code>m</code>. The guarantee that it holds is given by parametricity."}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 23, "last_activity_date": 1563911203, "last_edit_date": 1563911203, "creation_date": 1503454143, "answer_id": 45829556, "question_id": 45829110, "link": "https://stackoverflow.com/questions/45829110/monad-laws-expressed-in-terms-of-join-instead-of-bind/45829556#45829556", "title": "Monad laws expressed in terms of join instead of bind?", "body": "<p>Stolen straight from <a href=\"https://en.wikipedia.org/wiki/Monad_(category_theory)#Formal_definition\" rel=\"noreferrer\">Wikipedia</a>:</p>\n\n<p>(The natural transformation <code>\u03b7: 1 -&gt; T</code> is <code>pure</code>; the natural transformation <code>\u00b5: T^2 -&gt; T</code> is <code>join</code>)</p>\n\n<blockquote>\n  <p><code>\u00b5 . T\u00b5 = \u00b5 . \u00b5T</code></p>\n</blockquote>\n\n<p>In Haskell:</p>\n\n<pre><code>join . fmap join = join . join\n</code></pre>\n\n<p>In English: If you start with three layers of monad as <code>mmma :: Monad m =&gt; m (m (m a))</code>, it doesn't matter if you flatten it inner layer first and then outer, or flatten it outer layer first and then inner. This is the same law as what you listed as the third (associativity).</p>\n\n<blockquote>\n  <p><code>\u00b5 . T\u03b7 = \u00b5 . \u03b7T = 1</code></p>\n</blockquote>\n\n<p>In Haskell:</p>\n\n<p><code>join . fmap pure = join . pure = id</code></p>\n\n<p>In English: If you start with one layer of monad as <code>ma :: Monad m =&gt; m a</code>, it doesn't matter if you create a new layer inside it and then flatten it, or if you create a new layer outside it and then flatten it, and both are the same as doing nothing at all. This law is a combination of your first two.</p>\n\n<p>Also, <code>join</code> being a natural transformation means that</p>\n\n<p><code>join . fmap (fmap f) = fmap f . join</code></p>\n\n<p>because of parametricity.</p>\n"}], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1578, "favorite_count": 5, "accepted_answer_id": 45829556, "answer_count": 1, "score": 23, "last_activity_date": 1563911203, "creation_date": 1503450467, "question_id": 45829110, "link": "https://stackoverflow.com/questions/45829110/monad-laws-expressed-in-terms-of-join-instead-of-bind", "title": "Monad laws expressed in terms of join instead of bind?", "body": "<p>The monad laws are traditionally described in terms of <code>&gt;&gt;=</code> and <code>pure</code>:</p>\n\n<pre><code>pure a &gt;&gt;= k = k a\nm &gt;&gt;= pure = m\nm &gt;&gt;= (\\x -&gt; k x &gt;&gt;= h) = (m &gt;&gt;= k) &gt;&gt;= h\n</code></pre>\n\n<p>However, monads can also be defined in terms of <code>join</code> instead of <code>&gt;&gt;=</code>. I would like to come up with a formulation of the monad laws in terms of <code>join</code>.</p>\n\n<p>Using <code>x &gt;&gt;= f = join (fmap f x)</code>, it\u2019s easy to rewrite the existing monad laws to eliminate <code>&gt;&gt;=</code>. Simplifying the results slightly with the help of the applicative laws, the first two laws are quite pleasantly expressed:</p>\n\n<pre><code>join . pure = id\njoin . fmap pure = id\n</code></pre>\n\n<p>The intuition for these laws is easy, too, since clearly, introducing an extra \u201clayer\u201d with <code>pure</code> should be a no-op when combined with <code>join</code>. The third law, however, is not nearly so nice. It ends up looking like this:</p>\n\n<pre><code>  join (fmap (\\x -&gt; join (fmap h (k x))) m)\n= join (fmap h (join (fmap k m)))\n</code></pre>\n\n<p>This does not pleasantly reduce using the applicative laws, and it\u2019s much harder to understand without staring at it for a while. It certainly doesn\u2019t have the same easy intuition.</p>\n\n<p>Is there an equivalent, alternative formulation of the monad laws in terms of <code>join</code> that is easier to understand? Alternatively, is there any way to simplify the above law, or to make it easier to grok? The version with <code>&gt;&gt;=</code> is already less nice than the one expressed with Kleisli composition, but the version with <code>join</code> is nearly unreadable.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1503450794, "post_id": 45829076, "comment_id": 78616012, "body": "We actually don&#39;t have one of those in the standard library.  Weird, huh?  First thing that comes to mind is using a <a href=\"https://hackage.haskell.org/package/regex-compat-0.95.1/docs/Text-Regex.html\" rel=\"nofollow noreferrer\">regex package</a>."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1503451299, "post_id": 45829168, "comment_id": 78616112, "body": "Hey answer accepter -- this code has bugs!  Still working on it :-P"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1503451376, "post_id": 45829168, "comment_id": 78616127, "body": "ok it&#39;s better now"}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 1, "last_activity_date": 1503451422, "last_edit_date": 1503451422, "creation_date": 1503451042, "answer_id": 45829168, "question_id": 45829076, "link": "https://stackoverflow.com/questions/45829076/how-can-i-replace-the-last-occurrence-of-a-string-with-another-string/45829168#45829168", "title": "How can I replace the last occurrence of a String with another String?", "body": "<p>There isn't one in the standard library.  It's not hard to write though (however it's not the most efficient implementation).  Because of the structure of lists, it's actually much more convenient to replace the first one.</p>\n\n<pre><code>import Data.List (stripPrefix)\n\nreplace :: (Eq a) =&gt; [a] -&gt; [a] -&gt; [a] -&gt; [a]\nreplace needle newNeedle [] = []\nreplace needle newNeedle (h:haystack) =\n    case stripPrefix needle (h:haystack) of\n        Just haystack' -&gt; newNeedle ++ haystack'\n        Nothing -&gt; h : replace needle newNeedle haystack\n</code></pre>\n\n<p>Then to get the last one you can do some reversal gymnastics.</p>\n\n<pre><code>replaceLast :: (Eq a) =&gt; [a] -&gt; [a] -&gt; [a] -&gt; [a]\nreplaceLast needle newNeedle haystack\n    = reverse $ replace (reverse needle) (reverse newNeedle) (reverse haystack)\n</code></pre>\n"}], "owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "closed_date": 1503468541, "accepted_answer_id": 45829168, "answer_count": 1, "score": 0, "last_activity_date": 1503451422, "creation_date": 1503450195, "last_edit_date": 1503450554, "question_id": 45829076, "link": "https://stackoverflow.com/questions/45829076/how-can-i-replace-the-last-occurrence-of-a-string-with-another-string", "closed_reason": "Not suitable for this site", "title": "How can I replace the last occurrence of a String with another String?", "body": "<p>I am looking for a function of type <code>String (what to replace) -&gt; String (what to replace it with) -&gt; String (the string) -&gt; String (the result)</code>. It should only replace the last occurrence. I would accept a solution that uses <code>Text</code> instead of <code>String</code>. I searched hoogle and stackage and did not find a function.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1503440680, "post_id": 45827586, "comment_id": 78613768, "body": "This code does not produce an error for me. Are you sure this is the exact code (maybe you used <code>fdivide</code> instead of <code>edivision</code>)?"}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1503440960, "post_id": 45827586, "comment_id": 78613855, "body": "I <i>can</i> reproduce the error on GHC 7.10.3, with several dubious <code>LANGUAGE</code> directives to get past the ambiguities."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 1, "creation_date": 1503441058, "post_id": 45827586, "comment_id": 78613892, "body": "By the way, just as a general note. GHC will sometimes say something to the effect of &quot;error! ... you can use SomethingExtension to disable this check&quot;. Enabling the extension is usually a bad idea, so consider whether or not you actually need the behavior you&#39;re trying to get."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503444892, "post_id": 45827586, "comment_id": 78614809, "body": "I cannot reproduce on any version of GHC (7.8-8.0.1) so I&#39;m voting to close. (If any commenters are aware of how to reproduce precisely this error, please edit the question with the actual code necessary)."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 1, "creation_date": 1503445453, "post_id": 45827586, "comment_id": 78614931, "body": "@SilvioMayolo I disagree with &quot;enabling the extension is usually a bad idea.&quot; I often forget exactly an extension pragma that I need for something I&#39;m doing, so it is very useful for me as a reminder. I guess it depends heavily on how much experience you have with the extensions involved, though. I mainly want to point out that extensions are definitely not a bad thing, in general."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1503445539, "post_id": 45827586, "comment_id": 78614944, "body": "@SilvioMayolo Also, how are you getting the error? If I copy and paste the exact code in the question (after adding the two <code>LANGUAGE</code> pragmas GHC suggests), it compiles with no error for me on GHC 7.10.3 or GHC 8.0.2 (the only two I&#39;ve tried so far)."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1503445604, "post_id": 45827586, "comment_id": 78614960, "body": "@DavidYoung I suppose there are some extensions that are acceptable in general use, but haphazard use of <code>UndecidableInstances</code>, <code>OverlappingInstances</code>, and <code>IncoherentInstances</code> (all of which GHC suggests from time to time) leads only to more problems down the road."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1503445842, "post_id": 45827586, "comment_id": 78615007, "body": "@DavidYoung This is the exact file that I&#39;m loading. <a href=\"https://pastebin.com/uSNZhVz7\" rel=\"nofollow noreferrer\">pastebin.com/uSNZhVz7</a> It gives the error the OP reports. I&#39;m on Ubuntu 16.04. It errs in GHCI, with <code>runhaskell</code>, and also with straight compilation using <code>ghc</code> (with a trivial <code>main</code> added, of course)"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1503446797, "post_id": 45827586, "comment_id": 78615187, "body": "@SilvioMayolo Ahh, I think I see what&#39;s happening. I missed the part of the question that says &quot;If I put  <code>(Field d)</code> in the declaration of <code>EuclideanDomain</code> [...]&quot;. So I guess the literal code in the question does compile ok for everyone (if the appropriate extensions are enabled)?"}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1503447190, "post_id": 45827586, "comment_id": 78615271, "body": "The code, as posted in the OP&#39;s question and also on the pastebin that I linked, does not compile for me. Adding the <code>Field d</code> constraint does in fact fix the problem for me, but as the OP said, doing so defeats the purpose of the code."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1503447214, "post_id": 45827586, "comment_id": 78615279, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/152581/discussion-between-david-young-and-silvio-mayolo\">continue this discussion in chat</a>."}], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1503445153, "post_id": 45827931, "comment_id": 78614864, "body": "While this answer contains good advice, it doesn&#39;t actually (even attempt to) answer the question as stated (which is &quot;here is some code, it throws this error, why does this error occur?&quot;)."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1503447008, "post_id": 45827931, "comment_id": 78615243, "body": "BTW using <a href=\"https://downloads.haskell.org/~ghc/7.2.1/docs/html/users_guide/type-class-extensions.html#class-default-signatures\" rel=\"nofollow noreferrer\">default signatures</a> can make Option 1 even nicer: the user only needs to give an empty <code>instance EuclideanDomain MyType</code>."}, {"owner": {"reputation": 191, "user_id": 2442826, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/991e3291a5f56f87355ceab6f3ccc8c0?s=128&d=identicon&r=PG", "display_name": "Andrei Kh", "link": "https://stackoverflow.com/users/2442826/andrei-kh"}, "edited": false, "score": 0, "creation_date": 1503479784, "post_id": 45827931, "comment_id": 78628087, "body": "Thank you for this comprehensive answer, I&#39;ll consider one of these options for me. But as I&#39;m new to Haskell, I would like to know what exactly is the cause of this error? Is it the possibility of making an instance to both Field and EuclideanDomain (and therefore the resulting ambiguity)? This error is still there, even if I enable OverlappingInstances!"}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "reply_to_user": {"reputation": 191, "user_id": 2442826, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/991e3291a5f56f87355ceab6f3ccc8c0?s=128&d=identicon&r=PG", "display_name": "Andrei Kh", "link": "https://stackoverflow.com/users/2442826/andrei-kh"}, "edited": false, "score": 0, "creation_date": 1503504770, "post_id": 45827931, "comment_id": 78647392, "body": "@AndreiKh I&#39;m honestly not sure. I&#39;m able to reproduce your error but some other people are having trouble doing so (see the comments on the original question). With that in mind, I&#39;m starting to lean toward the idea that this might be a GHC bug and that the correct behavior is to allow the code."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1503706587, "post_id": 45827931, "comment_id": 78741177, "body": "@luqui, that is nicer, but that extension is fundamentally upside down. You can only get a default definition of a superclass method from one of potentially many subclasses. For example, <code>fmap</code> could be defaulted based on <code>Applicative</code>, <code>Monad</code>, <code>Traversable</code>, <code>Comonad</code>, etc., and also some things that are not subclasses, like <code>Bifunctor</code>, <code>Profunctor</code>, and <code>Generic1</code>."}], "tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": true, "score": 2, "last_activity_date": 1503440791, "creation_date": 1503440791, "answer_id": 45827931, "question_id": 45827586, "link": "https://stackoverflow.com/questions/45827586/haskell-could-not-deduce/45827931#45827931", "title": "Haskell &quot;Could not deduce...&quot;", "body": "<p><strong>tl;dr</strong> You probably don't want to do what you're trying to do. It creates too much complexity within the type system. The easy solution is to just not write an instance as generic as the one you're trying to write.</p>\n\n<h2>The Long Version</h2>\n\n<pre><code>instance (Field f, IntegralDomain f) =&gt; EuclideanDomain f where\n</code></pre>\n\n<p>You don't want to do this. I don't believe Haskell will even let you do this by default (you may have turned on some compiler extensions to get it to work at some point). What you're saying here is \"every field is a Euclidean domain in the way that <em>I</em> say so\". If someone comes along and makes a new type <code>Foo</code>, they may want to define an instance for <code>EuclideanDomain</code> and <code>Field</code>, but if they do then there are two instances of <code>EuclideanDomain</code> for the same type.</p>\n\n<p>This is a problem. You can tell GHC to ignore this problem and just hope things work out with the <code>OverlappingInstances</code> compiler extension, but like I said, you probably don't want to do that, because it makes your code significantly more confusing. You'll probably also need <code>FlexibleInstances</code> and perhaps a few other ones to get a typeclass instance that generic to pass the typechecker. Now, you've got two options.</p>\n\n<h2>Option 1</h2>\n\n<p>Just let sleeping dogs lie and assume the user is smart enough to implement both <code>Field</code> and <code>EuclideanDomain</code>. If you want to do this, you can make it easy for them by providing \"default\" functionality that they can just copy into their instance declaration if they truly want to derive <code>EuclideanDomain</code> from <code>Field</code>.</p>\n\n<pre><code>edegDefault :: Field f =&gt; f -&gt; Integer\nedegDefault x = 0\nedivisionDefault :: Field f =&gt; f -&gt; f -&gt; (f, f)\nedivisionDefault x y = (fdivide x y, gzero)\n</code></pre>\n\n<p>Then the user can implement <code>EuclideanDomain</code> of their own accord. If they want to implement the functionality themselves, they can do so freely, but if they don't, they can always do this.</p>\n\n<pre><code>instance EuclideanDomain f where\n    edeg = edegDefault\n    edivision = edivisionDefault\n</code></pre>\n\n<h2>Option 2</h2>\n\n<p>The other option, which you see from time to time, is more for the cases where the user might genuinely forget to implement <code>EuclideanDomain</code>. In this case, we would wrap our <code>Field</code> instance in a <code>newtype</code> and declare that <code>newtype</code> to be a <code>EuclideanDomain</code>.</p>\n\n<pre><code>newtype WrappedField f = WrappedField f\n\ninstance Field f =&gt; EuclideanDomain (WrappedField f) where\n    ...\n</code></pre>\n\n<p>Then you still get the functionality without intruding on the user's instance space. This pattern is seen in the Haskell standard library. For the longest time, <code>Monad</code> was not a subclass of <code>Applicative</code> for historical reasons, even though mathematically it should have been. So, the Haskell language designers implemented a <code>WrappedMonad</code> newtype which took a <code>Monad</code> instance and provided the <code>Applicative</code> instance for it.</p>\n"}], "owner": {"reputation": 191, "user_id": 2442826, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/991e3291a5f56f87355ceab6f3ccc8c0?s=128&d=identicon&r=PG", "display_name": "Andrei Kh", "link": "https://stackoverflow.com/users/2442826/andrei-kh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 655, "favorite_count": 0, "accepted_answer_id": 45827931, "answer_count": 1, "score": 2, "last_activity_date": 1503440791, "creation_date": 1503438915, "question_id": 45827586, "link": "https://stackoverflow.com/questions/45827586/haskell-could-not-deduce", "title": "Haskell &quot;Could not deduce...&quot;", "body": "<p>I'm a beginner to Haskell and was implementing some basic algebra, like </p>\n\n<pre><code>class (Eq g) =&gt; AbelianGroup g where\n    gplus :: g -&gt; g -&gt; g\n    gnegate :: g -&gt; g \n    gzero :: g\n    gminus :: g -&gt; g -&gt; g\n    gminus a b = gplus a (gnegate b)\n    gmult :: Integer -&gt; g -&gt; g\n\nclass (AbelianGroup d) =&gt; IntegralDomain d where\n    idtimes :: d -&gt; d -&gt; d\n    idone :: d            \n\n{- you can ignore upper code, it is added only for sake of completeness -}\n\nclass (IntegralDomain d) =&gt; EuclideanDomain d where\n    edeg :: d -&gt; Integer\n    edivision :: d -&gt; d -&gt; (d, d)\n    egcd :: d -&gt; d -&gt; d\n    egcd f g | g == gzero = f \n             | f == gzero = g\n             | otherwise = let (q, r) = edivision f g in egcd g r\n\nclass (IntegralDomain f) =&gt; Field f where\n    finvert :: f -&gt; f\n    fdivide :: f -&gt; f -&gt; f\n    fdivide a b = idtimes a (finvert b)\n\ninstance (Field f, IntegralDomain f) =&gt; EuclideanDomain f where\n    edeg x = 0\n    edivision x y = (fdivide x y, gzero)\n</code></pre>\n\n<p>when I got the error </p>\n\n<pre><code>* Could not deduce (Field d) arising from a use of `edivision'\n  from the context: EuclideanDomain d\n  bound by the class declaration for `EuclideanDomain'\n  at ...\n  Possible fix:\n  add (Field d) to the context of\n  the class declaration for `EuclideanDomain'\n* In the expression: edivision f g\n  In a pattern binding: (q, r) = edivision f g\n  In the expression: let (q, r) = edivision f g in egcd g r\n</code></pre>\n\n<p>where the error comes - as in error statement - from \"edivision f g\" in the dafault definiton of \"egcd\" in \"EuclideanDomain\". So as I am new to Haskell, my question is </p>\n\n<blockquote>\n  <p>Why is there this error? </p>\n</blockquote>\n\n<p>If I put (Field d) in the declaration of EuclideanDomain, this error vanishes. But then of course, the whole code becomes useless (not every Euclidean Domain is a Field etc.)</p>\n"}, {"tags": ["haskell", "error-handling", "console"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1503434006, "post_id": 45826373, "comment_id": 78611054, "body": "And what&#39;s the problem?"}, {"owner": {"reputation": 2595, "user_id": 3787253, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/U9bkB.jpg?s=128&g=1", "display_name": "smatthewenglish", "link": "https://stackoverflow.com/users/3787253/smatthewenglish"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1503437238, "post_id": 45826373, "comment_id": 78612567, "body": "the problem is I don&#39;t know haskell really at all- how would I log such an error message to the console?"}, {"owner": {"reputation": 307, "user_id": 922813, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9c3c102cdb4c4f1499015b6063699ed2?s=128&d=identicon&r=PG", "display_name": "Xavier Denis", "link": "https://stackoverflow.com/users/922813/xavier-denis"}, "edited": false, "score": 0, "creation_date": 1503442730, "post_id": 45826373, "comment_id": 78614296, "body": "I can&#39;t find the haskell code in the project you linked could you show where it is more precisely?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503445489, "post_id": 45826373, "comment_id": 78614936, "body": "This question has a lot of unnecessary information (like most of the code, which isn&#39;t even complete) and lacks a lot of necessary information (like what you&#39;ve tried to do to accomplish the stated behaviour). Logging a message is easy (it&#39;s just <code>putStrLn</code>, or you seem to be using some other function <code>logf&#39;</code>) - how do you want your program to proceed if the filepath given isn&#39;t valid? I see this as a much bigger issue, as I don&#39;t see a sensible way to do so; and a complete answer would likely required this information."}, {"owner": {"reputation": 2595, "user_id": 3787253, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/U9bkB.jpg?s=128&g=1", "display_name": "smatthewenglish", "link": "https://stackoverflow.com/users/3787253/smatthewenglish"}, "edited": false, "score": 0, "creation_date": 1503495044, "post_id": 45826373, "comment_id": 78639743, "body": "Here&#39;s a link to a <a href=\"https://gist.github.com/s-matthew-english/41e18c23d34009bd7b69ed925b4ed2d8\" rel=\"nofollow noreferrer\">gist file with the context of the function I&#39;m trying to implement</a>, as well as the attempt to modify the code as recommended in the answer below, the original file is <a href=\"https://github.com/s-matthew-english/constellation/blob/master/Constellation/Node/Main.hs\" rel=\"nofollow noreferrer\">here</a>"}, {"owner": {"reputation": 18763, "user_id": 472495, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4rtxd.png?s=128&g=1", "display_name": "halfer", "link": "https://stackoverflow.com/users/472495/halfer"}, "edited": false, "score": 0, "creation_date": 1504780124, "post_id": 45826373, "comment_id": 79149577, "body": "Hi Matthew. I notice that a large number of your titles are written in lower-case stylistically, and they are slowly being repaired by volunteer editors as they are noticed. Might I ask you to observe the standard case rules here (initial upper case, upper case for proper nouns)? It would save us a great deal of work. Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 2595, "user_id": 3787253, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/U9bkB.jpg?s=128&g=1", "display_name": "smatthewenglish", "link": "https://stackoverflow.com/users/3787253/smatthewenglish"}, "edited": false, "score": 0, "creation_date": 1503494889, "post_id": 45828256, "comment_id": 78639601, "body": "So, I tried to implement this function, but- I&#39;m very new to haskell- haven&#39;t been able to get it to click, <a href=\"https://gist.github.com/s-matthew-english/41e18c23d34009bd7b69ed925b4ed2d8\" rel=\"nofollow noreferrer\">here&#39;s a link to a gist</a> with the full file including these modifications, as well as the error message I got in my console."}, {"owner": {"reputation": 368, "user_id": 2492166, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/54b4fd0a3406e65b532e27dfd9b3ad0d?s=128&d=identicon&r=PG", "display_name": "Iron Gremlin", "link": "https://stackoverflow.com/users/2492166/iron-gremlin"}, "reply_to_user": {"reputation": 2595, "user_id": 3787253, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/U9bkB.jpg?s=128&g=1", "display_name": "smatthewenglish", "link": "https://stackoverflow.com/users/3787253/smatthewenglish"}, "edited": false, "score": 1, "creation_date": 1503525291, "post_id": 45828256, "comment_id": 78657952, "body": "My apologies. I updated the example function so that it actually compiles, and threw a comment up on your gist trying to explain a bit about what&#39;s going on there."}, {"owner": {"reputation": 2595, "user_id": 3787253, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/U9bkB.jpg?s=128&g=1", "display_name": "smatthewenglish", "link": "https://stackoverflow.com/users/3787253/smatthewenglish"}, "edited": false, "score": 0, "creation_date": 1503534258, "post_id": 45828256, "comment_id": 78660419, "body": "Thank you so much for this wonderful explanation :) I&#39;m still new to Haskell and so this information is all fresh + extremely valuable for me. I&#39;ve tried both invocations you suggested, but I ran into errors in each time, <a href=\"https://gist.github.com/s-matthew-english/22dcc13e5d9c05069ea251cb43618636\" rel=\"nofollow noreferrer\">here</a> is the first way you described- by the replicated pattern, and <a href=\"https://gist.github.com/s-matthew-english/d8c4e354d3df2f9efc7547c3ed0bbf38\" rel=\"nofollow noreferrer\">this is in the piggy-back style</a>, I put the console output I ended up with as a comment at the end of both files"}], "tags": [], "owner": {"reputation": 368, "user_id": 2492166, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/54b4fd0a3406e65b532e27dfd9b3ad0d?s=128&d=identicon&r=PG", "display_name": "Iron Gremlin", "link": "https://stackoverflow.com/users/2492166/iron-gremlin"}, "is_accepted": false, "score": 3, "last_activity_date": 1503523017, "last_edit_date": 1503523017, "creation_date": 1503443250, "answer_id": 45828256, "question_id": 45826373, "link": "https://stackoverflow.com/questions/45826373/haskell-error-handling-log-invalid-file-path-to-console/45828256#45828256", "title": "Haskell error handling, log invalid file path to console", "body": "<p>I'm not sure you have enough information in this code snippet for someone to deduce precisely what's going on here with you type signatures.</p>\n\n<p>The project you've linked seems like it's written in go?</p>\n\n<p>There appear to be a number of project specific functions that you're calling in your code example.</p>\n\n<p>For the case of 'does this file path point to a file,' you'd do something like:</p>\n\n<pre><code>checkForAFile :: FilePath -&gt; IO ()\ncheckForAFile path = do\n    validFile &lt;- doesFileExist path\n    if validFile\n       then putStrLn $ path ++ \" is a file that exists\"\n       else putStrLn $ path ++ \" is not a file that exists\"\n</code></pre>\n\n<p><code>doesFileExist</code> is a function available in the <code>System.Directory</code> library, and is the canonical way to answer your question of whether or not the filepath points to a file.</p>\n\n<p>Not knowing what this code is doing, I can't suggest a proper place to toss in that check, but hopefully that's enough for you to go on.</p>\n\n<p>If it isn't, I may suggest trying to whet your teeth on some Haskell code that has a little less going on.</p>\n"}, {"comments": [{"owner": {"reputation": 2595, "user_id": 3787253, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/U9bkB.jpg?s=128&g=1", "display_name": "smatthewenglish", "link": "https://stackoverflow.com/users/3787253/smatthewenglish"}, "edited": false, "score": 0, "creation_date": 1503518742, "post_id": 45845163, "comment_id": 78655023, "body": "cool, thank you for that insight- just tried re-running the code with this modification tho- and it wouldn&#39;t build- something about <code>Variable not in scope</code>, I put the full console output <a href=\"https://gist.github.com/s-matthew-english/46de53159c61c097a440ce44875cf04c\" rel=\"nofollow noreferrer\">here on this gist</a>"}], "tags": [], "owner": {"reputation": 307, "user_id": 922813, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9c3c102cdb4c4f1499015b6063699ed2?s=128&d=identicon&r=PG", "display_name": "Xavier Denis", "link": "https://stackoverflow.com/users/922813/xavier-denis"}, "is_accepted": false, "score": 1, "last_activity_date": 1503506346, "creation_date": 1503506346, "answer_id": 45845163, "question_id": 45826373, "link": "https://stackoverflow.com/questions/45826373/haskell-error-handling-log-invalid-file-path-to-console/45845163#45845163", "title": "Haskell error handling, log invalid file path to console", "body": "<p>In your linked <a href=\"https://gist.github.com/s-matthew-english/41e18c23d34009bd7b69ed925b4ed2d8#file-main-hs-L142\" rel=\"nofollow noreferrer\">gist</a> you have the following function causing a syntax error:</p>\n\n<pre><code>checkForAFile :: FilePath -&gt; IO ()\ncheckForAFile path\n    validFile &lt;- doesFileExist filePath\n    if validFile\n       then putStrLn $ filePath ++ \" is a file that exists\"\n       else putStrLn $ filePath ++ \" is not a file that exists\"\n</code></pre>\n\n<p>That's because you forgot the <code>=</code> sign. Use this instead:</p>\n\n<pre><code>checkForAFile :: FilePath -&gt; IO ()\ncheckForAFile path = do\n    validFile &lt;- doesFileExist filePath\n    if validFile\n       then putStrLn $ filePath ++ \" is a file that exists\"\n       else putStrLn $ filePath ++ \" is not a file that exists\"\n</code></pre>\n"}], "owner": {"reputation": 2595, "user_id": 3787253, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/U9bkB.jpg?s=128&g=1", "display_name": "smatthewenglish", "link": "https://stackoverflow.com/users/3787253/smatthewenglish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 236, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1504788587, "creation_date": 1503433452, "last_edit_date": 1504788587, "question_id": 45826373, "link": "https://stackoverflow.com/questions/45826373/haskell-error-handling-log-invalid-file-path-to-console", "title": "Haskell error handling, log invalid file path to console", "body": "<p>As part of <a href=\"https://github.com/s-matthew-english/quorum\" rel=\"nofollow noreferrer\">this project</a>, I'd like to validate the path of the file that's provided with passwords, i.e. <code>pwds &lt;- case cfgPasswords of Just passPath -&gt; (map (Just . T.unpack) . lines) &lt;$&gt; readFileUtf8 passPath</code>, in the case that the path for the file is not valid I'd like to log a message to that effect to the console.</p>\n\n<p>How to accomplish this in Haskell? </p>\n\n<pre><code>logf' \"Log level is {}\" [show logLevel]\nsetLogLevel logLevel\ndebugf' \"Configuration: {}\" [show cfg]\nncpus &lt;- getNumProcessors\nlogf' \"Utilizing {} core(s)\" [ncpus]\nsetNumCapabilities ncpus\npwds &lt;- case cfgPasswords of\n    Just passPath -&gt; (map (Just . T.unpack) . lines) &lt;$&gt;\n        readFileUtf8 passPath\n    Nothing       -&gt; return $ replicate (length cfgPublicKeys) Nothing\nwhen (length cfgPublicKeys /= length cfgPrivateKeys) $\n    errorL' \"The same amount of public keys and private keys must be specified\"\nwhen (length cfgPublicKeys /= length pwds) $\n    errorL' \"The same amount of passwords must be included in the passwords file as the number of private keys. (If a private key has no password, include a blank line.)\"\nwhen (cfgPort == 0) $\n    errorL' \"A listening port must be specified with 'port' in the configuration file or --port at runtime\"\n</code></pre>\n\n<p>The idea is that it would go right above the line <code>when (length cfgPublicKeys /= length cfgPrivateKeys) $</code>. </p>\n"}, {"tags": ["haskell", "church-encoding"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1503426283, "post_id": 45824350, "comment_id": 78607286, "body": "You can lookup them in GHCi or write <code>:: _</code> and make the compiler show the type for you."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1503427311, "post_id": 45824350, "comment_id": 78607822, "body": "Of course GHC will infer <code>exp :: a -&gt; (a -&gt; b) -&gt; b</code>, which is not very helpful if you want to relate it to exponentiation of church numerals. It&#39;s correct, but it&#39;s general enough that it&#39;s hard to see how it lines up with what was intended."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1503429348, "post_id": 45824350, "comment_id": 78608849, "body": "Using a monotype for Church numerals might restrict their applicability. I&#39;d consider using a polytype <code>type Numeral = forall a. (a-&gt;a)-&gt;a-&gt;a</code> using the needed extensions."}], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503445691, "post_id": 45825737, "comment_id": 78614973, "body": "At some point this will hit a wall due to impredicative types. If one plans to actually use such code for anything practical, one is better off with <code>newtype Numeral = Numeral (forall a. (a -&gt; a) -&gt; (a -&gt; a))</code>. Of course the version in this answer is just as good for the purpose of demonstration/learning."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1503445770, "post_id": 45825737, "comment_id": 78614994, "body": "Here&#39;s a pile of things I threw together with this: <a href=\"https://repl.it/KVI1/4\" rel=\"nofollow noreferrer\">repl.it/KVI1/4</a>"}, {"owner": {"reputation": 6566, "user_id": 3565885, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/BetMM.jpg?s=128&g=1", "display_name": "acontell", "link": "https://stackoverflow.com/users/3565885/acontell"}, "edited": false, "score": 0, "creation_date": 1503508511, "post_id": 45825737, "comment_id": 78649569, "body": "Regarding sum, I had two versions, the one that you mention and the one I posted. I posted the second one because it looked more concise, however, I didn&#39;t realize it was wrong. Thanks for pointing that out and for the answer. BTW, I think the corrected version of sum (and using some of the tips you provided) could be: <code>sum2 :: Numeral ((a -&gt; a) -&gt; (a -&gt; a)) -&gt; Numeral a -&gt; Numeral a sum2 m n = m churchSucc n</code>. I agree in that your version looks more concise and the generality of the Church numerals though. Cheers!"}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 6, "last_activity_date": 1503445708, "last_edit_date": 1503445708, "creation_date": 1503430798, "answer_id": 45825737, "question_id": 45824350, "link": "https://stackoverflow.com/questions/45824350/type-signature-declaration-of-some-operations-with-church-numerals/45825737#45825737", "title": "Type signature declaration of some operations with Church numerals", "body": "<p>The reason <code>exp</code> cannot be written the way you have it is that it involves passing a <code>Numeral</code> as argument to a <code>Numeral</code>. This requires having a <code>Numeral (a -&gt; a)</code>, but you only have a <code>Numeral a</code>. You can write it as</p>\n\n<pre><code>exp :: Numeral a -&gt; Numeral (a -&gt; a) -&gt; Numeral a\nexp n m = m n\n</code></pre>\n\n<p>I don't see what's wrong with <code>toNumeral</code>, aside from the fact that patterns like <code>x + 1</code> should not be used.</p>\n\n<pre><code>toNumeral :: Integer -&gt; Numeral a -- No need to restrict it to Integer\ntoNumeral 0 = \\f v -&gt; v\ntoNumeral x\n  | x &gt; 0 = churchSucc $ toNumeral $ x - 1\n  | otherwise = error \"negative argument\"\n</code></pre>\n\n<p>Also, your <code>sum</code> is bugged, because <code>m . churchSucc n</code> is <code>m * (n + 1)</code>, so it should be:</p>\n\n<pre><code>sum :: Numeral a -&gt; Numeral a -&gt; Numeral a\nsum m n f x = m f $ n f x -- Repeat f, n times on x, and then m more times.\n</code></pre>\n\n<p>However, church numerals are functions that work on <em>all</em> types. That is, <code>Numeral String</code> should not be different from <code>Numeral Integer</code>, because a <code>Numeral</code> shouldn't care what type it's working on. This is a <em>universal quantification</em>: <code>Numeral</code> is a function, for all types <code>a</code>, <code>(a -&gt; a) -&gt; (a -&gt; a)</code>, which is written, with <code>RankNTypes</code>, as <code>type Numeral = forall a. (a -&gt; a) -&gt; (a -&gt; a)</code>.</p>\n\n<p>This makes sense: a church numeral is defined by how many times its function argument is repeated. <code>\\f v -&gt; v</code> calls <code>f</code> 0 times, so it is 0, <code>\\f v -&gt; f v</code> is 1, etc. Forcing a <code>Numeral</code> to work for all <code>a</code> makes sure that it can <em>only</em> do that. However, allowing a <code>Numeral</code> to care what type <code>f</code> and <code>v</code> have removes the restriction, and lets you write <code>(\\f v -&gt; \"nope\") :: Numeral String</code>, even though that clearly isn't a <code>Numeral</code>.</p>\n\n<p>I would write this as</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\ntype Numeral = forall a. (a -&gt; a) -&gt; (a -&gt; a)\n\n_0 :: Numeral\n_0 _ x = x\n-- The numerals can be defined inductively, with base case 0 and inductive step churchSucc\n-- Therefore, it helps to have a _0 constant lying around\n\nchurchSucc :: Numeral -&gt; Numeral\nchurchSucc n f x = f (n f x) -- Cleaner without lambdas everywhere\n\nsum :: Numeral -&gt; Numeral -&gt; Numeral\nsum m n f x = m f $ n f x\n\nmult :: Numeral -&gt; Numeral -&gt; Numeral\nmult n m = n . m\n\nexp :: Numeral -&gt; Numeral -&gt; Numeral\nexp n m = m n\n\nnumerify :: Numeral -&gt; Integer\nnumerify n = n (1 +) 0\n\ntoNumeral :: Integer -&gt; Numeral\ntoNumeral 0 = _0\ntoNumeral x\n  | x &gt; 0 = churchSucc $ toNumeral $ x - 1\n  | otherwise = error \"negative argument\"\n</code></pre>\n\n<p>instead, which looks so much cleaner, and is less likely to run into roadblocks than the original.</p>\n\n<p>Demo:</p>\n\n<pre><code>main = do out \"5:\" _5\n          out \"2:\" _2\n          out \"0:\" _0\n          out \"5^0:\" $ exp _5 _0\n          out \"5 + 2:\" $ sum _5 _2\n          out \"5 * 2:\" $ mult _5 _2\n          out \"5^2:\" $ exp _5 _2\n          out \"2^5:\" $ exp _2 _5\n          out \"(0^2)^5:\" $ exp (exp _0 _2) _5\n       where _2 = toNumeral 2\n             _5 = toNumeral 5\n             out :: String -&gt; Numeral -&gt; IO () -- Needed to coax the inferencer\n             out str n = putStrLn $ str ++ \"\\t\" ++ (show $ numerify n)\n</code></pre>\n"}], "owner": {"reputation": 6566, "user_id": 3565885, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/BetMM.jpg?s=128&g=1", "display_name": "acontell", "link": "https://stackoverflow.com/users/3565885/acontell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 0, "accepted_answer_id": 45825737, "answer_count": 1, "score": 2, "last_activity_date": 1503445708, "creation_date": 1503425484, "question_id": 45824350, "link": "https://stackoverflow.com/questions/45824350/type-signature-declaration-of-some-operations-with-church-numerals", "title": "Type signature declaration of some operations with Church numerals", "body": "<p>I was trying to implement Church numerals in Haskell. This is my code:</p>\n\n<pre><code>-- Church numerals in Haskell.\ntype Numeral a = (a -&gt; a) -&gt; (a -&gt; a)\n\nchurchSucc :: Numeral a -&gt; Numeral a\nchurchSucc n f = \\x -&gt; f (n f x)\n\n-- Operations with Church numerals.\nsum :: Numeral a -&gt; Numeral a -&gt; Numeral a\nsum m n = m . churchSucc n\n\nmult :: Numeral a -&gt; Numeral a -&gt; Numeral a\nmult n m = n . m\n\n-- Here comes the first problem\n-- exp :: Numeral a -&gt; Numeral a -&gt; Numeral a\nexp n m = m n\n\n-- Convenience function to \"numerify\" a Church numeral.\nadd1 :: Integer -&gt; Integer\nadd1 = (1 +)\n\nnumerify :: Numeral Integer -&gt; Integer\nnumerify n = n add1 0\n\n-- Here comes the second problem\ntoNumeral :: Integer -&gt; Numeral Integer\ntoNumeral 0 = zero\ntoNumeral (x + 1) = churchSucc (toNumeral x)\n</code></pre>\n\n<p>My problem comes from exponentiation. If I declare the type signature of <code>toNumeral</code> and <code>exp</code>, the code doesn't compile. However, if I comment the type signature declarations, everything works fine. What would be the correct declarations for <code>toNumeral</code> and <code>exp</code>?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1503468455, "post_id": 45821643, "comment_id": 78620857, "body": "When I look in prelude <code>Prelude&gt; :t pure $ Hi 34 pure $ Hi 34 :: (Num a, Applicative f) =&gt; f (Hello a b)</code> I can not see the <code>IO</code> type. Why?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 1, "creation_date": 1503490880, "post_id": 45821643, "comment_id": 78636344, "body": "<code>IO</code> is only used as a default when you try to evaluate it."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 6, "last_activity_date": 1503491117, "last_edit_date": 1503491117, "creation_date": 1503415508, "answer_id": 45821643, "question_id": 45821556, "link": "https://stackoverflow.com/questions/45821556/why-can-i-use-pure-function-to-convert-to-applicative/45821643#45821643", "title": "Why can I use pure function to convert to applicative", "body": "<p>Since you aren't specifying any <code>Applicative</code> type in particular, <code>ghci</code> is defaulting to <code>IO</code>, i.e. <code>pure $ Hi 34</code> returns a value of type <code>Num a =&gt; IO (Hello a b)</code>. That is, <code>Hello a b</code> isn't the <code>f</code> in <code>a -&gt; f a</code>, it's the <code>a</code>.</p>\n\n<p>You can see more explicitly that <code>Hello a b</code> is the typed wrapped by an arbitrary <code>Applicative</code> by specifying various <code>Applicative</code> functors for the value:</p>\n\n<pre><code>Prelude&gt; (pure $ Hi 34) :: Either String (Hello Int b)\nRight (Hi 34)\nPrelude&gt; (pure $ Hi 34) :: Maybe (Hello Int b)\nJust (Hi 34)\nPrelude&gt; (pure $ Hi 34) :: [Hello Int b]\n[Hi 34]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": false, "score": 4, "last_activity_date": 1503418201, "creation_date": 1503418201, "answer_id": 45822507, "question_id": 45821556, "link": "https://stackoverflow.com/questions/45821556/why-can-i-use-pure-function-to-convert-to-applicative/45822507#45822507", "title": "Why can I use pure function to convert to applicative", "body": "<p>When you call <code>pure x</code> it is not <code>x</code> that should be <code>Applicative</code>, but the whole <code>pure x</code> expression. Take a look at <code>pure</code> type:</p>\n\n<pre><code>Prelude&gt; :t pure\npure :: Applicative f =&gt; a -&gt; f a\n</code></pre>\n\n<p>See? You pass it <code>a</code>, but <code>Applicative</code> constraint is on <code>f</code>, and that <code>f</code> only appears in the result. So, it is the result that should be of class <code>Applicative</code>, and as @chepner said, GHCi prompt defaults to <code>IO</code>, which is <code>Applicative</code>.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 45821643, "answer_count": 2, "score": 1, "last_activity_date": 1503491117, "creation_date": 1503415243, "question_id": 45821556, "link": "https://stackoverflow.com/questions/45821556/why-can-i-use-pure-function-to-convert-to-applicative", "title": "Why can I use pure function to convert to applicative", "body": "<p>I have following type definition:</p>\n\n<pre><code>  data Hello a b =  Hi a\n                  | Sali b\n                  deriving (Show, Eq) \n</code></pre>\n\n<p>and it isn't an instance of <code>Applicative</code> but I can still use <code>pure</code> to convert it to <code>Applicative</code> why?</p>\n\n<pre><code>*ExercisesTraversable Data.Monoid Control.Applicative&gt; :t pure $ Hi 34\npure $ Hi 34 :: (Num a, Applicative f) =&gt; f (Hello a b)\n\n*ExercisesTraversable Data.Monoid Control.Applicative&gt; pure $ Hi 34\nHi 34\n</code></pre>\n\n<p>And when I try:</p>\n\n<pre><code>*ExercisesTraversable Data.Monoid Control.Applicative&gt; (Sali (*2)) &lt;*&gt; (Sali 4)\n\n&lt;interactive&gt;:23:1: error:\n    * Non type-variable argument\n        in the constraint: Applicative (Hello a)\n      (Use FlexibleContexts to permit this)\n    * When checking the inferred type\n        it :: forall b a. (Num b, Applicative (Hello a)) =&gt; Hello a b\n</code></pre>\n\n<p>that is clear, because it isn't an <code>Applicative</code> instance.</p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 7, "last_activity_date": 1503926865, "last_edit_date": 1503926865, "creation_date": 1503404814, "answer_id": 45817638, "question_id": 45815830, "link": "https://stackoverflow.com/questions/45815830/cabal-2-0-required-when-using-a-nightly-snapshot-with-stack/45817638#45817638", "title": "Cabal 2.0 required when using a nightly snapshot with stack", "body": "<p>Cabal's file format has changed in the 2.0 release of it (likely because of backpack). You have to use Stack version >= <code>1.5.1</code> which bypasses this error. A proper fix for this will be likely released in the next version of Stack. IIRC, the fix is already in the master brach of the stack - so the upgrade via <code>--source-only</code> willl also work for you.</p>\n\n<p>You can read the <a href=\"https://github.com/commercialhaskell/stack/releases/tag/v1.5.1\" rel=\"nofollow noreferrer\">changelog</a> here to know more information about it.</p>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 830, "favorite_count": 0, "accepted_answer_id": 45817638, "answer_count": 1, "score": 5, "last_activity_date": 1522744128, "creation_date": 1503399598, "last_edit_date": 1503402783, "question_id": 45815830, "link": "https://stackoverflow.com/questions/45815830/cabal-2-0-required-when-using-a-nightly-snapshot-with-stack", "title": "Cabal 2.0 required when using a nightly snapshot with stack", "body": "<p>I'm trying to setup a new project using the <code>nightly-2017-08-17</code> snapshot</p>\n\n<pre><code>stack new test --resolver nightly-2017-08-17\n</code></pre>\n\n<p>However this gives the following error:</p>\n\n<pre><code>Downloading template \"new-template\" to create project \"test\" in test/ ...\nLooking for .cabal or package.yaml files to use to init the project.\nUsing cabal packages:\n- test/test.cabal\n\nSelected resolver: nightly-2017-08-17\nUnable to parse cabal file: FromString \"This package requires at least Cabal version 2.0\" Nothing\n</code></pre>\n\n<p>Cabal is in its latest version:</p>\n\n<pre><code>stack setup --upgrade-cabal\nCurrently installed Cabal is 2.0.0.2, newest is 2.0.0.2. I'm not upgrading Cabal.\nstack will use a sandboxed GHC it installed\nFor more information on paths, see 'stack path' and 'stack exec env'\nTo use this GHC and packages outside of a project, consider using:\nstack ghc, stack ghci, stack runghc, or stack exec\n</code></pre>\n\n<p>Is this not the correct way of selecting this nightly snapshot with <code>stack</code> or is this a bug in the tool?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 469137, "user_id": 476, "user_type": "moderator", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a235706e3d81b614acaec3368edfea4b?s=128&d=identicon&r=PG", "display_name": "deceze", "link": "https://stackoverflow.com/users/476/deceze"}, "edited": false, "score": 5, "creation_date": 1503388205, "post_id": 45811770, "comment_id": 78581127, "body": "Total Haskell newbie, but as in most other languages, you&#39;ll likely see a difference with negative numbers\u2026"}, {"owner": {"reputation": 1928, "user_id": 4667966, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5cd71b49d2ff11be77e85289e5ef29b?s=128&d=identicon&r=PG", "display_name": "Tom Gijselinck", "link": "https://stackoverflow.com/users/4667966/tom-gijselinck"}, "reply_to_user": {"reputation": 469137, "user_id": 476, "user_type": "moderator", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a235706e3d81b614acaec3368edfea4b?s=128&d=identicon&r=PG", "display_name": "deceze", "link": "https://stackoverflow.com/users/476/deceze"}, "edited": false, "score": 1, "creation_date": 1503388785, "post_id": 45811770, "comment_id": 78581492, "body": "This was indeed my problem. :) Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 1928, "user_id": 4667966, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5cd71b49d2ff11be77e85289e5ef29b?s=128&d=identicon&r=PG", "display_name": "Tom Gijselinck", "link": "https://stackoverflow.com/users/4667966/tom-gijselinck"}, "edited": false, "score": 1, "creation_date": 1503388677, "post_id": 45811862, "comment_id": 78581420, "body": "Thank you for the clear answer and the reference to the docs. I was indeed only verifying it with positive numbers."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 23, "last_activity_date": 1503388299, "creation_date": 1503388299, "answer_id": 45811862, "question_id": 45811770, "link": "https://stackoverflow.com/questions/45811770/is-there-a-difference-between-floor-and-truncate-in-haskell/45811862#45811862", "title": "Is there a difference between floor and truncate in Haskell", "body": "<p>Yes, for negative numbers. If we read the documentation, we see:</p>\n\n<blockquote>\n  <p><strong><code>truncate :: Integral b =&gt; a -&gt; b</code></strong></p>\n  \n  <p><code>truncate x</code> returns the integer nearest <code>x</code> between zero and <code>x</code></p>\n</blockquote>\n\n<p>and:</p>\n\n<blockquote>\n  <p><strong><code>floor :: Integral b =&gt; a -&gt; b</code></strong></p>\n  \n  <p><code>floor x</code> returns the greatest integer not greater than <code>x</code></p>\n</blockquote>\n\n<p>So if we enter a <strong>negative number</strong>, like <code>-3.5</code> we obtain:</p>\n\n<pre><code>Prelude&gt; truncate (-3.5)\n-3\nPrelude&gt; floor (-3.5)\n-4\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "is_accepted": false, "score": 6, "last_activity_date": 1503388391, "creation_date": 1503388391, "answer_id": 45811897, "question_id": 45811770, "link": "https://stackoverflow.com/questions/45811770/is-there-a-difference-between-floor-and-truncate-in-haskell/45811897#45811897", "title": "Is there a difference between floor and truncate in Haskell", "body": "<p>It's not haskell specific, but there's a difference between those functions. Floor means the highest integer no higher than a given number. Truncate means to remove at some length, in this case the fractional part. Those have the same effect for zero and positive numbers, but not negative. </p>\n\n<p>Here's a quick comparison in Python:</p>\n\n<pre><code>&gt;&gt;&gt; for i in range(-5,6):\n...   j=0.5*i\n...   print(j,floor(j),ceil(j),trunc(j),round(j))\n...\n-2.5 -3 -2 -2 -2\n-2.0 -2 -2 -2 -2\n-1.5 -2 -1 -1 -2\n-1.0 -1 -1 -1 -1\n-0.5 -1 0 0 0\n0.0 0 0 0 0\n0.5 0 1 0 0\n1.0 1 1 1 1\n1.5 1 2 1 2\n2.0 2 2 2 2\n2.5 2 3 2 2\n</code></pre>\n\n<p>Essentially trunc() goes towards zero and floor() towards negative infinity. </p>\n"}, {"comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1503407135, "post_id": 45811948, "comment_id": 78594368, "body": "Mind that <code>floor (-2.1)</code> is <code>-3</code>."}], "tags": [], "owner": {"reputation": 2426, "user_id": 8459403, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vnPdw.png?s=128&g=1", "display_name": "Dr. X", "link": "https://stackoverflow.com/users/8459403/dr-x"}, "is_accepted": false, "score": 1, "last_activity_date": 1503388529, "creation_date": 1503388529, "answer_id": 45811948, "question_id": 45811770, "link": "https://stackoverflow.com/questions/45811770/is-there-a-difference-between-floor-and-truncate-in-haskell/45811948#45811948", "title": "Is there a difference between floor and truncate in Haskell", "body": "<p>Truncate:</p>\n\n<pre><code>1    --&gt;  1 \n3.1  --&gt;  3\n3.9  --&gt;  3\n-2.1 --&gt; -2\n-2.9 --&gt; -2\n</code></pre>\n\n<p>Floor:</p>\n\n<pre><code>1    --&gt;  1 \n3.1  --&gt;  3\n3.9  --&gt;  3\n-2.1 --&gt; -2\n-2.9 --&gt; -3 (Different!...)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6233, "user_id": 1143013, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/18b2043f1470f68ff6e223e7f48c0cd7?s=128&d=identicon&r=PG", "display_name": "raam86", "link": "https://stackoverflow.com/users/1143013/raam86"}, "is_accepted": false, "score": 5, "last_activity_date": 1503388634, "creation_date": 1503388634, "answer_id": 45811994, "question_id": 45811770, "link": "https://stackoverflow.com/questions/45811770/is-there-a-difference-between-floor-and-truncate-in-haskell/45811994#45811994", "title": "Is there a difference between floor and truncate in Haskell", "body": "<p>Looking at the source code the difference emerges quite quickly:</p>\n\n<pre><code>truncate x          =  m  where (m,_) = properFraction x\n</code></pre>\n\n<p>and </p>\n\n<pre><code>floor x             =  if r &lt; 0 then n - 1 else n\n                       where (n,r) = properFraction x\n</code></pre>\n\n<p>we see the difference will only emerge on negative numbers and so:</p>\n\n<pre><code>Prelude&gt; floor (negate 2.1)\n-3\nPrelude&gt; truncate (negate 2.1)\n-2\n</code></pre>\n"}], "owner": {"reputation": 1928, "user_id": 4667966, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5cd71b49d2ff11be77e85289e5ef29b?s=128&d=identicon&r=PG", "display_name": "Tom Gijselinck", "link": "https://stackoverflow.com/users/4667966/tom-gijselinck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2145, "favorite_count": 0, "accepted_answer_id": 45811862, "answer_count": 4, "score": 11, "last_activity_date": 1503388634, "creation_date": 1503387980, "question_id": 45811770, "link": "https://stackoverflow.com/questions/45811770/is-there-a-difference-between-floor-and-truncate-in-haskell", "title": "Is there a difference between floor and truncate in Haskell", "body": "<p>Does there exist a difference in functionality between <code>floor</code> and <code>truncate</code> in Haskell?</p>\n\n<p>They seem to perform the same functionality and they have the same type signature:</p>\n\n<ul>\n<li><code>truncate :: (Integral b, RealFrac a) =&gt; a -&gt; b</code></li>\n<li><code>floor :: (Integral b, RealFrac a) =&gt; a -&gt; b</code></li>\n</ul>\n"}, {"tags": ["haskell", "tuples", "list-comprehension"], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 6939382, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f6b4c0ed75d2689f2536af78dcb4472a?s=128&d=identicon&r=PG&f=1", "display_name": "looker", "link": "https://stackoverflow.com/users/6939382/looker"}, "edited": false, "score": 0, "creation_date": 1503387201, "post_id": 45811449, "comment_id": 78580448, "body": "Thanks!! I&#39;m having a hard time with the sintax."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1503387325, "post_id": 45811449, "comment_id": 78580538, "body": "I&#39;m reasonably sure this is a homework question - the original function signature was probably <code>Eq a =&gt; a -&gt; [(a,b)] -&gt; [b]</code>"}, {"owner": {"reputation": 35, "user_id": 6939382, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f6b4c0ed75d2689f2536af78dcb4472a?s=128&d=identicon&r=PG&f=1", "display_name": "looker", "link": "https://stackoverflow.com/users/6939382/looker"}, "edited": false, "score": 0, "creation_date": 1503387392, "post_id": 45811449, "comment_id": 78580590, "body": "Umm another question. If I wanted to do it using list comprehension then how it would be?"}, {"owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "reply_to_user": {"reputation": 35, "user_id": 6939382, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f6b4c0ed75d2689f2536af78dcb4472a?s=128&d=identicon&r=PG&f=1", "display_name": "looker", "link": "https://stackoverflow.com/users/6939382/looker"}, "edited": false, "score": 0, "creation_date": 1503387427, "post_id": 45811449, "comment_id": 78580615, "body": "@Luis you cant use list comprehension over tuples."}, {"owner": {"reputation": 35, "user_id": 6939382, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f6b4c0ed75d2689f2536af78dcb4472a?s=128&d=identicon&r=PG&f=1", "display_name": "looker", "link": "https://stackoverflow.com/users/6939382/looker"}, "edited": false, "score": 0, "creation_date": 1503387490, "post_id": 45811449, "comment_id": 78580662, "body": "It is, but I don&#39;t want the exact answer, just examples to see how it works because I really dont understand and everything that I see online doesn&#39;t help me"}, {"owner": {"reputation": 35, "user_id": 6939382, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f6b4c0ed75d2689f2536af78dcb4472a?s=128&d=identicon&r=PG&f=1", "display_name": "looker", "link": "https://stackoverflow.com/users/6939382/looker"}, "edited": false, "score": 0, "creation_date": 1503387525, "post_id": 45811449, "comment_id": 78580683, "body": "ugh yeah sorry!! I meant that question for the [(a,b)] type"}, {"owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "reply_to_user": {"reputation": 35, "user_id": 6939382, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f6b4c0ed75d2689f2536af78dcb4472a?s=128&d=identicon&r=PG&f=1", "display_name": "looker", "link": "https://stackoverflow.com/users/6939382/looker"}, "edited": false, "score": 0, "creation_date": 1503387553, "post_id": 45811449, "comment_id": 78580698, "body": "@Luis, change the question and ill update the answer for that type"}, {"owner": {"reputation": 35, "user_id": 6939382, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f6b4c0ed75d2689f2536af78dcb4472a?s=128&d=identicon&r=PG&f=1", "display_name": "looker", "link": "https://stackoverflow.com/users/6939382/looker"}, "edited": false, "score": 0, "creation_date": 1503388031, "post_id": 45811449, "comment_id": 78581011, "body": "ok I feel really dumb right now, it was very simple in the end... Thanks alot"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1503389022, "post_id": 45811449, "comment_id": 78581639, "body": "Shouldn&#39;t you <code>map snd</code> instead of <code>map fst</code>?"}], "tags": [], "owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "is_accepted": true, "score": 3, "last_activity_date": 1503389245, "last_edit_date": 1503389245, "creation_date": 1503386946, "answer_id": 45811449, "question_id": 45811369, "link": "https://stackoverflow.com/questions/45811369/how-to-access-the-content-of-a-tuple-inside-a-list-in-haskell/45811449#45811449", "title": "how to access the content of a tuple inside a list in haskell?", "body": "<p>You can filter the list and take the <code>fst</code> values:</p>\n\n<pre><code>associated :: (Eq a) =&gt; a -&gt; [(a,b)] -&gt; [b]\nassociated a tuplst = map snd $ filter (\\(x,_) -&gt; a == x) tuplst\n</code></pre>\n\n<p>Or use similar behaviour comprehension:</p>\n\n<pre><code>associated a tuplst = [b | (a', b) &lt;- tupls, a == a']\n</code></pre>\n\n<p>You can pattern match the tuples inside the comprehension with <code>(a', b) &lt;- tupls</code>, this will unpack the values into <code>a'</code> and 'b' and then just add the filter <code>a == a'</code> too while just taking <code>b</code>.</p>\n"}], "owner": {"reputation": 35, "user_id": 6939382, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f6b4c0ed75d2689f2536af78dcb4472a?s=128&d=identicon&r=PG&f=1", "display_name": "looker", "link": "https://stackoverflow.com/users/6939382/looker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 325, "favorite_count": 0, "accepted_answer_id": 45811449, "answer_count": 1, "score": 0, "last_activity_date": 1503389245, "creation_date": 1503386688, "last_edit_date": 1503387783, "question_id": 45811369, "link": "https://stackoverflow.com/questions/45811369/how-to-access-the-content-of-a-tuple-inside-a-list-in-haskell", "title": "how to access the content of a tuple inside a list in haskell?", "body": "<p>I'm trying to do a very simple example to try to get how Haskell works and I have the following doubt:</p>\n\n<p>I have this code: </p>\n\n<pre><code>associated :: (Eq a) =&gt; a -&gt; [(a,b)] -&gt; [b]\nassociated a tuple = [b  | b  &lt;- tuple, a==fst(tuple) ]\n</code></pre>\n\n<p>I want to know how to access the content of the tuples of the lists to make comparisons. Thanks.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1503387046, "post_id": 45811310, "comment_id": 78580344, "body": "It expects something of type <code>Maybe Integer -&gt; b</code> for some <code>b</code> but you&#39;ve given it <code>Maybe (Integer -&gt; Integer)</code>. But that is just restating what the compiler has stated. What part of this error have you misunderstood? (The error is indeed referring to <code>[Just (*2), Just (+9)]</code>, but that is also clearly stated in the error itself. The type variable <code>b</code> refers to any type - hence why it is a free type variable)"}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503387628, "post_id": 45811310, "comment_id": 78580745, "body": "Awesome, now I see. <code>Maybe (Integer -&gt; Integer)</code> is not a function, but rather just only a type. Thanks."}], "answers": [{"tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": false, "score": 2, "last_activity_date": 1503387562, "creation_date": 1503387562, "answer_id": 45811635, "question_id": 45811310, "link": "https://stackoverflow.com/questions/45811310/what-does-the-compiler-mean/45811635#45811635", "title": "What does the compiler mean?", "body": "<p>There's a wrong substitution here:</p>\n\n<pre><code>(&lt;*&gt;) :: [] (Maybe Integer -&gt; b) -&gt; [] (Maybe Integer) -&gt; [] b\n</code></pre>\n\n<p><code>[Just (*2), Just (+9)]</code> has the following type: <code>Num a =&gt; [Maybe (a -&gt; a)]</code></p>\n\n<p>That's because <code>List</code> is <code>f</code> in <code>(&lt;*&gt;) :: f (a -&gt; b) -&gt; f a -&gt; f b</code>.</p>\n\n<p>According to the <code>(&lt;*&gt;)</code>'s type, you can have:</p>\n\n<pre><code>[(*2), (+9)] &lt;*&gt; [2, 3]\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>Just (*2) &lt;*&gt; Just 2\n</code></pre>\n\n<p>and <code>[]</code> and <code>Maybe</code> will be Applicative contexts in these expressions correspondingly, but not both, using just <code>(&lt;*&gt;)</code></p>\n\n<p>The following esoteric expression will compile:</p>\n\n<pre><code>[(Just (*2) &lt;*&gt;), (Just (+9) &lt;*&gt;)] &lt;*&gt; [(Just 3), (Just 4), (Just 5)]\n</code></pre>\n\n<p>But I'm not sure it is what you're looking for.</p>\n"}, {"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 3, "last_activity_date": 1503387727, "creation_date": 1503387727, "answer_id": 45811687, "question_id": 45811310, "link": "https://stackoverflow.com/questions/45811310/what-does-the-compiler-mean/45811687#45811687", "title": "What does the compiler mean?", "body": "<p>Let's substitute more carefully</p>\n\n<pre><code>(&lt;*&gt;) :: (Applicative f) =&gt; f (a -&gt; b) -&gt; f a -&gt; f b\n[Just (*2), Just (+9)] :: [Maybe (Int -&gt; Int)]   --wlog\n[Just 3, Just 4, Just 5] :: [Maybe Int]\n</code></pre>\n\n<p>So <code>f = []</code>, thus:</p>\n\n<pre><code>(&lt;*&gt;) :: [a -&gt; b] -&gt; [a] -&gt; [b]\n</code></pre>\n\n<p>But now we are to match <code>[a -&gt; b]</code> against <code>[Maybe (Int -&gt; Int)]</code> and that's impossible -- a function and a <code>Maybe</code> can't be the same.  You are trying to do function application under <em>two</em> functors, not just one.  I.e. you would need something of type</p>\n\n<pre><code>f (g (a -&gt; b)) -&gt; f (g a) -&gt; f (g b)\n</code></pre>\n\n<p>Fortunately, that's easy to make:  <code>liftA2 (&lt;*&gt;)</code>.</p>\n\n<p>Or, if you want something fancier, you could operate instead on the composite functor <a href=\"https://hackage.haskell.org/package/transformers-0.3.0.0/docs/Data-Functor-Compose.html\" rel=\"nofollow noreferrer\"><code>Compose [] Maybe</code></a>.</p>\n\n<pre><code>getCompose $ Compose [Just (*2), Just (+9)] &lt;*&gt; Compose [Just 3, Just 4, Just 5]\n</code></pre>\n\n<p>(But when <code>Compose</code> is cool is when you don't immediately <code>getCompose</code> the result, but use it as an important abstraction in whatever program you are writing.)</p>\n"}, {"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 3, "last_activity_date": 1503387758, "creation_date": 1503387758, "answer_id": 45811695, "question_id": 45811310, "link": "https://stackoverflow.com/questions/45811310/what-does-the-compiler-mean/45811695#45811695", "title": "What does the compiler mean?", "body": "<p>The compiler is referring to this part of your code (<code>In the expression: Just (* 2)</code>):</p>\n\n<pre><code>[Just (*2), Just (+9)] &lt;*&gt; [(Just 3),(Just 4), (Just 5)]\n ^^^^^^^^^\n</code></pre>\n\n<p>It's also saying that the actual type of <code>Just (*2)</code> is <code>Maybe (Integer -&gt; Integer)</code>, but the way you're using it requires a value of type <code>Maybe Integer -&gt; b</code> (for some type <code>b</code>).</p>\n\n<p>If you look at the type of</p>\n\n<pre><code>(&lt;*&gt;) :: f (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>you can see that the first argument must be some type constructor <code>f</code> applied to a function type <code>a -&gt; b</code>. You have a list of values, so <code>f</code> is <code>[]</code>.</p>\n\n<p>Therefore the first argument must be a list of functions, but what you have is a list of <code>Maybe</code>s. That's why this code is an error.</p>\n\n<p>The rest of the error message comes from the second argument of <code>&lt;*&gt;</code>, <code>[(Just 3),(Just 4), (Just 5)]</code>, which is a list of arguments (for the list of functions in the first argument). That is, the compiler knows it needs a value of type <code>f a</code> and you gave it <code>[(Just 3),(Just 4), (Just 5)]</code>, so it deduces <code>f = []</code>, <code>a = Maybe Integer</code>.</p>\n\n<p>So the type of the first argument <code>f (a -&gt; b)</code> becomes <code>[] (Maybe Integer -&gt; b)</code> (which is the same as <code>[Maybe Integer -&gt; b]</code>). <code>b</code> here is completely free. You can use whatever result type you want and you'll get <code>f b</code> (i.e. <code>[b]</code> (a list of results)) back from <code>&lt;*&gt;</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 0, "last_activity_date": 1503408535, "creation_date": 1503408535, "answer_id": 45819013, "question_id": 45811310, "link": "https://stackoverflow.com/questions/45811310/what-does-the-compiler-mean/45819013#45819013", "title": "What does the compiler mean?", "body": "<p>In</p>\n\n<pre><code>Prelude&gt; [Just (*2), Just (+9)] &lt;*&gt; [(Just 3),(Just 4), (Just 5)]\n</code></pre>\n\n<p>instruction there are two functors. The outer one is <code>List</code> and the inner one is <code>Maybe</code> So when you put the <code>&lt;*&gt;</code> applicative operation in between two lists the first list should contain some function type elements to become an applicative functor, such as;</p>\n\n<pre><code>Prelude&gt; [(+1),(*2)] &lt;*&gt; [1,2]\n[2,3,2,4]\n</code></pre>\n\n<p>However in your instruction the first list just contains some <code>Maybe</code> values. This doesn't qualify the list as an applicative functor. But the elements of the list are of type <code>Maybe (a -&gt; b)</code>. That means not the list  itself but it's contents are applicative functors. So in order to turn our list into an applicative list, you are expected replace the applicative Maybe values with a function which takes an applicative <code>Maybe (a -&gt; b)</code> and a <code>Maybe a</code> and gives a <code>Maybe b</code> In another words <code>f (a -&gt; b) -&gt; f a -&gt; f b</code> and this happens to be <code>&lt;*&gt;</code> operator.</p>\n\n<p>So if you rephrase your code as follows you will get the expected result;</p>\n\n<pre><code>Prelude&gt; (&lt;*&gt;) &lt;$&gt; [Just (*2), Just (+9)] &lt;*&gt; [(Just 3),(Just 4),(Just 5)]\n[Just 6,Just 8,Just 10,Just 12,Just 13,Just 14]\n</code></pre>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 45811687, "answer_count": 4, "score": 2, "last_activity_date": 1503408535, "creation_date": 1503386497, "last_edit_date": 1503386976, "question_id": 45811310, "link": "https://stackoverflow.com/questions/45811310/what-does-the-compiler-mean", "title": "What does the compiler mean?", "body": "<p>I have following applicative expression and I know it is wrong:</p>\n\n<pre><code>Prelude&gt; [Just (*2), Just (+9)] &lt;*&gt; [(Just 3),(Just 4), (Just 5)]\n</code></pre>\n\n<p>and the compiler complains:</p>\n\n<pre><code>&lt;interactive&gt;:2:2: error:\n    * Couldn't match expected type `Maybe Integer -&gt; b'\n                  with actual type `Maybe (Integer -&gt; Integer)'\n    * Possible cause: `Just' is applied to too many arguments\n      In the expression: Just (* 2)\n      In the first argument of `(&lt;*&gt;)', namely `[Just (* 2), Just (+ 9)]'\n      In the expression:\n        [Just (* 2), Just (+ 9)] &lt;*&gt; [(Just 3), (Just 4), (Just 5)]\n    * Relevant bindings include it :: [b] (bound at &lt;interactive&gt;:2:1)\n</code></pre>\n\n<p>What does the compiler is trying to say? </p>\n\n<p>This error message:</p>\n\n<pre><code>* Couldn't match expected type `Maybe Integer -&gt; b'\n              with actual type `Maybe (Integer -&gt; Integer)'\n</code></pre>\n\n<p>it means this part <code>[Just (*2), Just (+9)]</code> of the expression? </p>\n\n<p>Let's look the signature of the function <code>(&lt;*&gt;)</code>:</p>\n\n<pre><code>(&lt;*&gt;) :: f (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>substitute it with <code>List</code> and <code>Maybe</code> type constructor above: </p>\n\n<pre><code>(&lt;*&gt;) :: [] (Maybe Integer -&gt; b) -&gt; [] (Maybe Integer) -&gt; [] b\n</code></pre>\n\n<p>Which type should the <code>b</code> have?</p>\n"}, {"tags": ["haskell", "lazy-evaluation", "knights-tour"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503388794, "post_id": 45811233, "comment_id": 78581496, "body": "What have you tried to debug the code? How does the 2nd version of the code differ from the first (it seems to use identical logic, just in a more convoluted and verbose manner)? Does it work for smaller <code>size</code> (I believe that 5 is the smallest square board which has solutions)?"}, {"owner": {"reputation": 73, "user_id": 5570924, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf0ad67df4d5808ef0476daa8ec2441?s=128&d=identicon&r=PG&f=1", "display_name": "Allen Wang", "link": "https://stackoverflow.com/users/5570924/allen-wang"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503390734, "post_id": 45811233, "comment_id": 78582694, "body": "@user2407038 I think two solutions are logically identical after taking a second look. I tested both versions with size 5, 6, 7, and they produce correct results(the first solution found) in no time, whch makes sense because the solution space is relatively small(for size 7, the number of tours is around 6 million). When tested with size 8, it runs forever. It seems both versions search the whole solution space, but I cannot figure out the reason."}], "answers": [{"comments": [{"owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "edited": false, "score": 0, "creation_date": 1503421202, "post_id": 45823275, "comment_id": 78604612, "body": "And indeed, over 114 million dead ends encountered now"}, {"owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "edited": false, "score": 0, "creation_date": 1503423940, "post_id": 45823275, "comment_id": 78605992, "body": "Now over 360 million dead ends encountered, still no <code>count</code> higher than 61. I need my computer&#39;s CPU and disk space back, so I&#39;m going to kill this experiment for now. Later I might consider how to go about solving this more quickly (though it&#39;s still going to be slow because the problem is larger than you expect)."}, {"owner": {"reputation": 73, "user_id": 5570924, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf0ad67df4d5808ef0476daa8ec2441?s=128&d=identicon&r=PG&f=1", "display_name": "Allen Wang", "link": "https://stackoverflow.com/users/5570924/allen-wang"}, "edited": false, "score": 0, "creation_date": 1503461626, "post_id": 45823275, "comment_id": 78618471, "body": "In conclusion, laziness did work as expected to produce the first solution. The long running time is caused by millions of failed searches before hitting the first solution. That order of magnitude is quite counter-intuitive, because size of 8 seems quite small."}], "tags": [], "owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "is_accepted": true, "score": 2, "last_activity_date": 1503425837, "last_edit_date": 1503425837, "creation_date": 1503421168, "answer_id": 45823275, "question_id": 45811233, "link": "https://stackoverflow.com/questions/45811233/finding-one-solution-to-knights-tour-in-haskell/45823275#45823275", "title": "Finding one solution to Knight&#39;s Tour in Haskell", "body": "<p>So first the good news: your code is doing what you expect, and only producing the first solution!</p>\n\n<p>That's also the bad news: it really is taking this long to even find the first solution. I think something you underestimate greatly is how many \"dead ends\" need to be encountered in order to produce a solution.</p>\n\n<p>For example, here's a tweak of your initial version using the <code>Debug.Trace</code> module to let us know how many dead ends you encounter while trying to find the first path:</p>\n\n<pre><code>import Control.Monad\nimport Debug.Trace (trace)\nimport System.Environment (getArgs)\n\nknightsTour :: Int -&gt; [[(Int, Int)]]\nknightsTour size = go 1 [(1, 1)]\n  where\n    maxSteps = size * size\n    isValid (x, y) = x &gt;= 1 &amp;&amp; x &lt;= size &amp;&amp; y &gt;= 1 &amp;&amp; y &lt;= size\n\n    go :: Int -&gt; [(Int, Int)] -&gt; [[(Int, Int)]]\n    go count acc | count == maxSteps = return $ reverse acc\n    go count acc = do\n      let nextPossible' = [ next |\n                            next &lt;- nextSteps (head acc)\n                            , isValid next &amp;&amp; next `notElem` acc]\n          nextPossible = if null nextPossible'\n            then trace (\"dead end; count: \" ++ show count) []\n            else nextPossible'\n      next &lt;- nextPossible\n      -- guard $ isValid next &amp;&amp; next `notElem` acc\n      go (count + 1) (next : acc)\n\n\nfs = replicateM 2 [(*1), (*(-1))]\nnextSteps :: (Int, Int) -&gt; [(Int, Int)]\nnextSteps (x, y) = do\n  (x', y') &lt;- [(1, 2), (2, 1)]\n  [f, f'] &lt;- fs\n  return (x + f x', y + f' y')\n\nmain :: IO ()\nmain = do\n  [n] &lt;- getArgs\n  print (head $ knightsTour (read n))\n</code></pre>\n\n<p>Now, let's see how much output that gives us for different board sizes:</p>\n\n<pre><code>/tmp$ ghc -o kntest -O2 kntest.hs \n[1 of 1] Compiling Main             ( kntest.hs, kntest.o )\nLinking kntest ...\n/tmp$ ./kntest 5 2&gt;&amp;1 | wc\n   27366  109461  547424\n/tmp$ ./kntest 6 2&gt;&amp;1 | wc\n  783759 3135033 15675378\n/tmp$ ./kntest 7 2&gt;&amp;1 | wc\n  818066 3272261 16361596\n</code></pre>\n\n<p>Okay, so we encountered 27,365 dead ends on a board size of 5 and over 800 thousand dead ends on a board size of 7. For a board size of eight, I redirected it to a file:</p>\n\n<pre><code>/tmp$ ./kntest 8 2&gt; kn8.deadends.txt\n</code></pre>\n\n<p>It's still running. At this point, it's encountered over 38 million dead ends:</p>\n\n<pre><code>/tmp$ wc -l kn8.deadends.txt \n 38178728 kn8.deadends.txt\n</code></pre>\n\n<p>How many of those dead ends were really close to the end?</p>\n\n<pre><code>/tmp$ wc -l kn8.deadends.txt ; fgrep 'count: 61' kn8.deadends.txt | wc -l ; fgrep 'count: 62' kn8.deadends.txt | wc -l; fgrep 'count: 63' kn8.deadends.txt | wc -l ; wc -l kn8.deadends.txt\n 52759655 kn8.deadends.txt\n    1448\n       0\n       0\n 64656651 kn8.deadends.txt\n</code></pre>\n\n<p>So it's up to well over 64 million dead ends now and it still hasn't found a dead end longer than 61 steps.</p>\n\n<p>And now it's at 85 million, and if I take too long to write the rest of this it could be at over 100 million by the time I finish this answer.</p>\n\n<p>There are some things you might do to speed up your program (such as using a vector to track already visited spots rather than the O(n) <code>notElem</code> lookup), but fundamentally it's taking so long to get just the first answer because it's really much, much longer to the first answer than you initially thought.</p>\n\n<hr>\n\n<p>EDIT: If you add a very simple, naive implementation of <a href=\"https://en.wikipedia.org/wiki/Knight%27s_tour#Warnsdorf.27s_rule\" rel=\"nofollow noreferrer\">Warnsdorf's rule</a> then you get the first knight's tour almost instantly even for very large (40x40) boards:</p>\n\n<pre><code>import Control.Monad\nimport System.Environment (getArgs)\nimport Data.List (sort)\n\nknightsTour :: Int -&gt; [[(Int, Int)]]\nknightsTour size = go 1 [(1, 1)]\n  where\n    maxSteps = size * size\n    isValid (x, y) = x &gt;= 1 &amp;&amp; x &lt;= size &amp;&amp; y &gt;= 1 &amp;&amp; y &lt;= size\n\n    getValidFor from acc = do\n      next &lt;- nextSteps from\n      guard $ isValid next &amp;&amp; next `notElem` acc\n      return next\n\n    go :: Int -&gt; [(Int, Int)] -&gt; [[(Int, Int)]]\n    go count acc | count == maxSteps = return $ reverse acc\n    go count acc = do\n      let allPoss = getValidFor (head acc) acc\n          sortedPossible = map snd $ sort $\n                           map (\\x -&gt; (length $ getValidFor x acc, x))\n                           allPoss\n      next &lt;- sortedPossible\n      go (count + 1) (next : acc)\n\nfs = replicateM 2 [(*1), (*(-1))]\nnextSteps :: (Int, Int) -&gt; [(Int, Int)]\nnextSteps (x, y) = do\n  (x', y') &lt;- [(1, 2), (2, 1)]\n  [f, f'] &lt;- fs\n  return (x + f x', y + f' y')\n\nmain :: IO ()\nmain = do\n  [n] &lt;- getArgs\n  print (head $ knightsTour (read n))\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 5570924, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf0ad67df4d5808ef0476daa8ec2441?s=128&d=identicon&r=PG&f=1", "display_name": "Allen Wang", "link": "https://stackoverflow.com/users/5570924/allen-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 447, "favorite_count": 0, "accepted_answer_id": 45823275, "answer_count": 1, "score": 3, "last_activity_date": 1503425837, "creation_date": 1503386275, "last_edit_date": 1503389780, "question_id": 45811233, "link": "https://stackoverflow.com/questions/45811233/finding-one-solution-to-knights-tour-in-haskell", "title": "Finding one solution to Knight&#39;s Tour in Haskell", "body": "<p>I'm trying to solve <a href=\"https://en.wikipedia.org/wiki/Knight%27s_tour\" rel=\"nofollow noreferrer\">Knight's Open Tour</a> in Haskell\uff0cand come up with a solution to generate all possible solutions:</p>\n\n<pre><code>knightsTour :: Int -&gt; [[(Int, Int)]]\nknightsTour size = go 1 [(1, 1)]\n  where\n    maxSteps = size^2\n    isValid (x, y) = x &gt;= 1 &amp;&amp; x &lt;= size &amp;&amp; y &gt;= 1 &amp;&amp; y &lt;= size\n\n    go :: Int -&gt; [(Int, Int)] -&gt; [[(Int, Int)]]\n    go count acc | count == maxSteps = return $ reverse acc\n    go count acc = do\n      next &lt;- nextSteps (head acc)\n      guard $ isValid next &amp;&amp; next `notElem` acc\n      go (count + 1) (next : acc)\n\n\nfs = replicateM 2 [(*1), (*(-1))]\nnextSteps :: (Int, Int) -&gt; [(Int, Int)]\nnextSteps (x, y) = do\n  (x', y') &lt;- [(1, 2), (2, 1)]\n  [f, f'] &lt;- fs\n  return (x + f x', y + f' y')\n</code></pre>\n\n<p>However, when tested with 8-by-8 chess board, the above function never stops, which is because the solution space is insanely large(19,591,828,170,979,904 different open tours according to <a href=\"https://en.wikipedia.org/wiki/Knight%27s_tour\" rel=\"nofollow noreferrer\">1</a>). So I want to find only one solution. Fisrt, I tried:</p>\n\n<pre><code>-- First try    \nhead (knightsTour 8)\n</code></pre>\n\n<p>with the hope that Haskell's lazy evaluation may come to save the day. But that didn't happen, the solution still runs forever.\nThen, I tried\uff1a</p>\n\n<pre><code>-- second try\n\nimport Data.List (find)\nimport Data.Maybe (fromMaybe)\n\nknightsTour' :: Int -&gt; [(Int, Int)]\nknightsTour' size = go 1 [(1, 1)]\n  where\n    maxSteps = size^2\n    isValid (x, y) = x &gt;= 1 &amp;&amp; x &lt;= size &amp;&amp; y &gt;= 1 &amp;&amp; y &lt;= size\n\n    go :: Int -&gt; [(Int, Int)] -&gt; [(Int, Int)]\n    go count acc | count == maxSteps = reverse acc\n    go count acc =\n      let\n        nextSteps' = [step | step &lt;- nextSteps (head acc), isValid step &amp;&amp; step `notElem` acc]\n      in\n        fromMaybe [] (find (not . null) $ fmap (\\step -&gt; go (count+1) (step:acc)) nextSteps')\nfs = replicateM 2 [(*1), (*(-1))]\nnextSteps :: (Int, Int) -&gt; [(Int, Int)]\nnextSteps (x, y) = do\n  (x', y') &lt;- [(1, 2), (2, 1)]\n  [f, f'] &lt;- fs\n  return (x + f x', y + f' y')\n</code></pre>\n\n<p>But the solution above still cannot deliver, because it still runs forever.\nMy questions are:</p>\n\n<ol>\n<li>Why can't lazy evaluation work as I expected to produce only the first solution found? In my opinion, in both tries, only the first solution is required.</li>\n<li>How to change the code above to produce only the first solution?</li>\n</ol>\n"}, {"tags": ["node.js", "haskell", "ghcjs"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 4, "creation_date": 1503385455, "post_id": 45810878, "comment_id": 78579301, "body": "That error message doesn&#39;t <i>sound</i> like it is out of memory. It sounds like it is trying to write to a file that has already been closed: perhaps a race condition in ghcjs or in your usage of it?"}, {"owner": {"reputation": 97, "user_id": 2645074, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a2b6368d18d97f293c0018f34ee54660?s=128&d=identicon&r=PG", "display_name": "user2645074", "link": "https://stackoverflow.com/users/2645074/user2645074"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1503386686, "post_id": 45810878, "comment_id": 78580090, "body": "ok, you are right, that interpretation also makes sense.  what would be a good way to find more evidence here?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1503387503, "post_id": 45810878, "comment_id": 78580670, "body": "On that topic I&#39;m afraid I have no clever ideas. You could do what you&#39;re doing now: try giving it more memory and see if that helps."}, {"owner": {"reputation": 97, "user_id": 2645074, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a2b6368d18d97f293c0018f34ee54660?s=128&d=identicon&r=PG", "display_name": "user2645074", "link": "https://stackoverflow.com/users/2645074/user2645074"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1503392863, "post_id": 45810878, "comment_id": 78584226, "body": "yes, but that was my original question.  (-:"}, {"owner": {"reputation": 97, "user_id": 2645074, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a2b6368d18d97f293c0018f34ee54660?s=128&d=identicon&r=PG", "display_name": "user2645074", "link": "https://stackoverflow.com/users/2645074/user2645074"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1503392884, "post_id": 45810878, "comment_id": 78584241, "body": "i.e., how do i call ghcjs so that it gives more memory to node?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503446298, "post_id": 45810878, "comment_id": 78615099, "body": "GHCJS doesn&#39;t seem to permit passing options to node (see e.g. <a href=\"https://github.com/ghcjs/ghcjs/blob/ee742e015edb8ba8bc443d7869361f312ddb4cd7/src/Gen2/TH.hs#L695-L698\" rel=\"nofollow noreferrer\">here</a>, where it starts node to compile TH). Based on my cursory glance at the source code, you have two options: make a node alias which calls the node executable with the appropriate &#39;extra memory&#39; flag; or modify GHCJS itself to accept an additional flag which is then passed to node at that point (and maybe others) - this could be far from trivial!"}, {"owner": {"reputation": 97, "user_id": 2645074, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a2b6368d18d97f293c0018f34ee54660?s=128&d=identicon&r=PG", "display_name": "user2645074", "link": "https://stackoverflow.com/users/2645074/user2645074"}, "edited": false, "score": 0, "creation_date": 1503527510, "post_id": 45810878, "comment_id": 78658713, "body": "that&#39;s useful, thanks!  writing a wrapper script was actually not too hard (since i couldn&#39;t get the argv escaping done in sh or bash i just did it in python).  the problem still happens with 8GB, so the theory that there is some open files ulimit or something similar, more node-specific is still in the race.  but i coulnd&#39;t find a flag for that even in the node options.  but shouldn&#39;t handle limits be far higher by default than what&#39;s needed for a couple of template haskell threads?"}], "owner": {"reputation": 97, "user_id": 2645074, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a2b6368d18d97f293c0018f34ee54660?s=128&d=identicon&r=PG", "display_name": "user2645074", "link": "https://stackoverflow.com/users/2645074/user2645074"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 71, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1503386744, "creation_date": 1503385173, "last_edit_date": 1503386744, "question_id": 45810878, "link": "https://stackoverflow.com/questions/45810878/increase-memory-for-node-as-called-by-ghcjs", "title": "increase memory for node as called by ghcjs", "body": "<p>I get this error from time to time when I run ghcjs on a large-ish code base (~10k LOC, lots of template haskell):</p>\n\n<pre><code>fd:40: hPutBuf: illegal operation (handle is closed)\n</code></pre>\n\n<p>my best bet is that this is an out-of-memory error.  when i re-run the build it usually works the second or third time (probably because it can build on the partial result from the previous runs?).</p>\n\n<p>now i am wondering if there is a way to give node more memory than the 1GB (i think?) that it gets by default.  there is <code>--max_old_space_size</code>, which i found when searching here for \"increase node memory\", but i haven't found a way to pass that argument to node as called from ghcjs.</p>\n\n<p>thanks!</p>\n\n<p>EDIT: possibly related: <a href=\"https://github.com/ghcjs/ghcjs/issues/601\" rel=\"nofollow noreferrer\">https://github.com/ghcjs/ghcjs/issues/601</a>, <a href=\"https://github.com/ghcjs/ghcjs/issues/588\" rel=\"nofollow noreferrer\">https://github.com/ghcjs/ghcjs/issues/588</a></p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503385456, "post_id": 45809958, "comment_id": 78579303, "body": "The page you linked doesn&#39;t have explicit Windows instructions, but certainly it&#39;s <a href=\"https://github.com/tensorflow/tensorflow/blob/61c0b39011671628ee85c2b49bc8845520018aa2/tensorflow/c/c_api.h#L75\" rel=\"nofollow noreferrer\">designed</a> to be built on Windows as well. <a href=\"https://github.com/tensorflow/tensorflow/tree/r0.12/tensorflow/contrib/cmake\" rel=\"nofollow noreferrer\">Here</a> is such a build."}, {"owner": {"reputation": 144, "user_id": 8299684, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/13e72908732ef4648880cd34f9b0279d?s=128&d=identicon&r=PG", "display_name": "Raskell", "link": "https://stackoverflow.com/users/8299684/raskell"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503386181, "post_id": 45809958, "comment_id": 78579739, "body": "I&#39;ve found what is supposed to be the C library here: <a href=\"https://stackoverflow.com/questions/44682845/tensorflow-c-library-available-for-windows\" title=\"tensorflow c library available for windows\">stackoverflow.com/questions/44682845/&hellip;</a> but I&#39;m not sure what to tell cabal what to do with it"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503387410, "post_id": 45809958, "comment_id": 78580601, "body": "You can pass the flag <code>--extra-lib-dirs=&lt;..&gt;</code> to cabal (stack has a corresponding field which can be placed in the config file). I don&#39;t know this will be enough; you may need the <code>.lib</code> file as well as the <code>.dll</code> (I don&#39;t know enough about how GHC links things to know if it&#39;ll actually be the case)."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503387973, "post_id": 45809958, "comment_id": 78580980, "body": "Feel free to edit your question with your attempt - there is not much anyone can do with a single line of an error message in isolation."}, {"owner": {"reputation": 144, "user_id": 8299684, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/13e72908732ef4648880cd34f9b0279d?s=128&d=identicon&r=PG", "display_name": "Raskell", "link": "https://stackoverflow.com/users/8299684/raskell"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503388408, "post_id": 45809958, "comment_id": 78581256, "body": "Using Cabal, I&#39;ve included the following .cabal file in my directory: <code>cabal-version: &gt;= 1.2 Executable hax     Includes: c_api.h     Extra-libraries: tensorflow</code> but I still receive the errors:  cabal.exe: Missing dependency on a foreign library: * Missing C library: tensorflow The exception was: user error (Using &#39;build-type: Custom&#39; but there is no Setup.hs or Setup.lhs script.)"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503389054, "post_id": 45809958, "comment_id": 78581657, "body": "This cabal file would imply that you are trying to write your own Haskell program which depends directly on the <code>tensorflow</code> C library. The rest of the question implies you are trying to build the <code>tensorflow</code> Haskell library (which are different things!); if you want to use the Haskell bindings, you must depend on the Haskell package, and you don&#39;t need to add the transitive foreign dependency to your own cabal file. (The error &quot;(Using &#39;build-type: Custom&#39; but there is no Setup.hs or Setup.lhs script.)&quot; is completely unrelated to this - see the cabal docs for what <code>build-type: custom</code> means)"}, {"owner": {"reputation": 144, "user_id": 8299684, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/13e72908732ef4648880cd34f9b0279d?s=128&d=identicon&r=PG", "display_name": "Raskell", "link": "https://stackoverflow.com/users/8299684/raskell"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503390377, "post_id": 45809958, "comment_id": 78582483, "body": "Removing everything but the cabal-version, I am still getting the same errors."}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 0, "last_activity_date": 1517002492, "creation_date": 1517002492, "answer_id": 48469881, "question_id": 45809958, "link": "https://stackoverflow.com/questions/45809958/cabal-missing-dependency-on-foreign-c-library/48469881#48469881", "title": "Cabal: missing dependency on foreign C library", "body": "<p>You write \"According to the Tensorflow website: <a href=\"https://www.tensorflow.org/install/install_c\" rel=\"nofollow noreferrer\">https://www.tensorflow.org/install/install_c</a> , the C package for Tensorflow only runs on Unix machines. I am not sure if this is a dead end or if there is some workaround.\"</p>\n\n<p>Indeed, if you don't have the <code>tensorflow</code> C package installed on your machine -- because it won't run on it, then you can't find it to bind to it.</p>\n\n<p>There is no work around for that.</p>\n"}], "owner": {"reputation": 144, "user_id": 8299684, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/13e72908732ef4648880cd34f9b0279d?s=128&d=identicon&r=PG", "display_name": "Raskell", "link": "https://stackoverflow.com/users/8299684/raskell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 660, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1517002492, "creation_date": 1503381835, "last_edit_date": 1503388506, "question_id": 45809958, "link": "https://stackoverflow.com/questions/45809958/cabal-missing-dependency-on-foreign-c-library", "title": "Cabal: missing dependency on foreign C library", "body": "<p>I have been trying to install the tensorflow/haskell package on my Windows machine. </p>\n\n<p>However, both while installing with stack and cabal, I keep running into this error: </p>\n\n<pre><code>Cabal-simple_Z6RU0evB_1.24.2.0_ghc-8.0.2.exe: Missing dependency on a foreign\n    library:\n    * Missing C library: tensorflow\nThis problem can usually be solved by installing the system package that\n    provides this library (you may need the \"-dev\" version). If the library is\n    already installed but in a non-standard location then you can use the flags\n    --extra-include-dirs= and --extra-lib-dirs= to specify where it is.\n</code></pre>\n\n<p>According to the Tensorflow website: <a href=\"https://www.tensorflow.org/install/install_c\" rel=\"nofollow noreferrer\">https://www.tensorflow.org/install/install_c</a>\n, the C package for Tensorflow only runs on Unix machines. I am not sure if this is a dead end or if there is some workaround.</p>\n\n<p>I am not experienced with linking libraries or with cabal, and would appreciate some assistance.</p>\n\n<p>Using Cabal, I've included the following .cabal file in my directory: </p>\n\n<pre><code>cabal-version: &gt;= 1.2 \nExecutable hax \nIncludes: c_api.h \nExtra-libraries: tensorflow \n</code></pre>\n\n<p>but I still receive the errors: <code>cabal.exe: Missing dependency on a foreign library: * Missing C library: tensorflow The exception was: user error (Using 'build-type: Custom' but there is no Setup.hs or Setup.lhs script.)</code></p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 7, "last_activity_date": 1503446245, "last_edit_date": 1503446245, "creation_date": 1503376896, "answer_id": 45809031, "question_id": 45808975, "link": "https://stackoverflow.com/questions/45808975/haskell-how-could-i-construct-a-new-datatype-so-that-the-value-of-that-type-is/45809031#45809031", "title": "Haskell, How could I construct a new datatype so that the value of that type is 1 or 2 or 3?", "body": "<p>You can't really make arbitrary subtypes like that.  What you can do is make a data type with three constructors, you just have to understand some things about data declarations:</p>\n\n<p>When you declare a new data type, you declare it <em>with</em> its constructors.  The constructors you use are <em>brand new</em> names that don't already have a meaning.  The datatype and its constructors must all begin with a capital letter. So you say</p>\n\n<pre><code>data Oct = One | Two | Three\n</code></pre>\n\n<p>This declares the <em>type</em> <code>Oct</code> and three <em>values</em> <code>One</code>, <code>Two</code>, and <code>Three</code> -- four declarations at once.</p>\n\n<p>Another alternative is to use a <a href=\"https://wiki.haskell.org/Smart_constructors\" rel=\"nofollow noreferrer\">smart constructor</a> with a type like</p>\n\n<pre><code>newtype Oct = Oct Int\n</code></pre>\n\n<p>as shown in more detail in @Nawaz's answer.</p>\n\n<p>There is a way to make numeric literals work, so you can use <code>1 :: Oct</code>, but for this case it's not good because (the way the libraries are designed) numeric literals ought to come with numeric structure as well, which <code>Oct</code> doesn't have (well, unless you want to start doing fancy math).  Also using <code>4 :: Oct</code> would typecheck but would be a runtime error, which we also don't like.</p>\n"}, {"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1503385240, "post_id": 45809273, "comment_id": 78579166, "body": "&quot;data type&quot; is the wrong phrase to use for describing a data constructor."}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1503425917, "post_id": 45809273, "comment_id": 78607093, "body": "@amalloy Thank you for the feedback. I have made the suggested change."}], "tags": [], "owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "is_accepted": false, "score": 1, "last_activity_date": 1503429272, "last_edit_date": 1503429272, "creation_date": 1503378400, "answer_id": 45809273, "question_id": 45808975, "link": "https://stackoverflow.com/questions/45808975/haskell-how-could-i-construct-a-new-datatype-so-that-the-value-of-that-type-is/45809273#45809273", "title": "Haskell, How could I construct a new datatype so that the value of that type is 1 or 2 or 3?", "body": "<blockquote>\n  <p>but the Haskell shows the error like this: Cannot parse data constructor in a data/newtype declaration: 1</p>\n</blockquote>\n\n<p>This error message tells you that <code>1</code> is not a valid name for a data constructor. The rules for names of data constructors are similar to those of variables in most languages. Here the compiler complains because the name starts with a digit, which is not allowed.</p>\n"}, {"tags": [], "owner": {"reputation": 325758, "user_id": 415784, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/2WX9Z.jpg?s=128&g=1", "display_name": "Nawaz", "link": "https://stackoverflow.com/users/415784/nawaz"}, "is_accepted": true, "score": 5, "last_activity_date": 1503672532, "last_edit_date": 1503672532, "creation_date": 1503386900, "answer_id": 45811433, "question_id": 45808975, "link": "https://stackoverflow.com/questions/45808975/haskell-how-could-i-construct-a-new-datatype-so-that-the-value-of-that-type-is/45811433#45811433", "title": "Haskell, How could I construct a new datatype so that the value of that type is 1 or 2 or 3?", "body": "<p>I think you want to limit the value of <code>Int</code> to one of <code>{1,2,3}</code>. If so, you can define a <em>newtype</em> <code>Oct</code> as:</p>\n\n<pre><code>newtype Oct = Oct Int deriving(Show)\n</code></pre>\n\n<p>and then define a function <code>oct</code> that makes <code>Oct</code> as:</p>\n\n<pre><code>oct :: Int -&gt; Oct\noct n \n   | n &gt; 0 &amp;&amp; n &lt; 4 = Oct n \n   | otherwise      = error \"invalid value: \" ++ show n\n</code></pre>\n\n<p>If throwing <code>error</code> is not acceptable, then maybe <code>Maybe</code> will help:</p>\n\n<pre><code>oct :: Int -&gt; Maybe Oct\noct n \n   | n &gt; 0 &amp;&amp; n &lt; 4 = Just (Oct n) \n   | otherwise      = Nothing\n</code></pre>\n\n<p>Hope that helps.</p>\n"}], "owner": {"reputation": 55, "user_id": 8427253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97fb640b9b8dc240d26ef134f6fe22d7?s=128&d=identicon&r=PG&f=1", "display_name": "Junhan Liu", "link": "https://stackoverflow.com/users/8427253/junhan-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1076, "favorite_count": 0, "accepted_answer_id": 45811433, "answer_count": 3, "score": 4, "last_activity_date": 1503672532, "creation_date": 1503376545, "question_id": 45808975, "link": "https://stackoverflow.com/questions/45808975/haskell-how-could-i-construct-a-new-datatype-so-that-the-value-of-that-type-is", "title": "Haskell, How could I construct a new datatype so that the value of that type is 1 or 2 or 3?", "body": "<p>I want to construct a new data type called Oct, and it should return 1 or 2 or 3, so my code is something like this :\ndata Oct = 1|2|3</p>\n\n<p>but the Haskell shows the error like this: Cannot parse data constructor in a data/newtype declaration: 1</p>\n\n<p>And I don`t know what does this error means. how should I fix it?</p>\n"}, {"tags": ["haskell", "optimization", "floating-point"], "comments": [{"owner": {"reputation": 649, "user_id": 2998746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fc15b842026d8a039ffdd1b2a528aec?s=128&d=identicon&r=PG&f=1", "display_name": "Euge", "link": "https://stackoverflow.com/users/2998746/euge"}, "edited": false, "score": 0, "creation_date": 1503368443, "post_id": 45807344, "comment_id": 78573721, "body": "<code>floor</code> function has the following type <code>floor :: (RealFrac a, Integral b) =&gt; a -&gt; b</code>, so you can instantiate it to take a <code>Float</code> and return an <code>Int</code>  (<a href=\"https://www.haskell.org/hoogle/?hoogle=floor\" rel=\"nofollow noreferrer\">haskell.org/hoogle/?hoogle=floor</a>)"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1503371404, "post_id": 45807344, "comment_id": 78574397, "body": "Notably, both Float and Double are instances of RealFrac, so your concerns that you use them instead of using RealFrac is misplaced."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503375020, "post_id": 45807344, "comment_id": 78575121, "body": "Why not <code>fract = snd . properFraction</code>? (<code>fract = \\x -&gt; x - fromIntegral (floor x)</code> has the correct type and almost does what you want, but doesn&#39;t work for negative numbers). It is entirely unnecessary to &#39;cast&#39; a <code>Float</code> to an <code>Int</code> here (whatever &#39;cast&#39; actually means to you)."}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 1, "creation_date": 1503378795, "post_id": 45807344, "comment_id": 78576173, "body": "&quot;floor in Haskell is defined only for the RealFrac typeclass.&quot; I suggest you learn what a typeclass is. Most likely you can still use this for your purposes."}], "answers": [{"tags": [], "owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "is_accepted": true, "score": 1, "last_activity_date": 1503430093, "creation_date": 1503430093, "answer_id": 45825528, "question_id": 45807344, "link": "https://stackoverflow.com/questions/45807344/best-way-to-implement-floor-and-fract-for-floating-point-numbers-in-haskell/45825528#45825528", "title": "Best way to implement floor and fract for floating point numbers in Haskell?", "body": "<p>As the comments say, <code>floor</code> is already implemented for floating point numbers, and <code>frac</code> is straightforward; this code compiles:</p>\n\n<pre><code>aDouble :: Double\naDouble = -5.675\n\naFloat :: Float\naFloat = 10.675\n\nfrac :: RealFrac a =&gt; a -&gt; a\nfrac x = x - fromIntegral (floor x :: Integer)\n\nmain :: IO ()\nmain = do\n  putStrLn \"aDouble is\"\n  print aDouble\n  putStrLn \"frac(aDouble) is\"\n  print (frac aDouble)\n  putStrLn \"aFloat is\"\n  print aFloat\n  putStrLn \"frac(aFloat) is\"\n  print (frac aFloat)\n</code></pre>\n\n<p>and produces:</p>\n\n<pre><code>$ runhaskell /tmp/a.hs\naDouble is\n-5.675\nfrac(aDouble) is\n0.3250000000000002\naFloat is\n10.675\nfrac(aFloat) is\n0.6750002\n</code></pre>\n"}], "owner": {"reputation": 693, "user_id": 7564554, "user_type": "registered", "accept_rate": 82, "profile_image": "https://lh3.googleusercontent.com/-h7KkTmgJty0/AAAAAAAAAAI/AAAAAAAAAAo/ZFEGeg_bQ6Y/photo.jpg?sz=128", "display_name": "Eben Kadile", "link": "https://stackoverflow.com/users/7564554/eben-kadile"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 190, "favorite_count": 0, "accepted_answer_id": 45825528, "answer_count": 1, "score": 1, "last_activity_date": 1503430093, "creation_date": 1503362542, "question_id": 45807344, "link": "https://stackoverflow.com/questions/45807344/best-way-to-implement-floor-and-fract-for-floating-point-numbers-in-haskell", "title": "Best way to implement floor and fract for floating point numbers in Haskell?", "body": "<p><code>floor</code> in Haskell is defined only for the <code>RealFrac</code> typeclass. I don't really know much about this typeclass and the rest of my code only uses floating point numbers.</p>\n\n<p>I can't find any function for casting a <code>Float</code> to an <code>Int</code>. If there were then <code>floor</code> would be equivalent to <code>fromIntegral (fromFloating x)</code> and <code>fract</code> would be defined as</p>\n\n<pre><code>fract x = x - floor x\n</code></pre>\n\n<p>However, as I said, I haven't found any function that does anything like what I want <code>fromFloating</code> to do. So this is the only way I could think of for implementing <code>fract</code>:</p>\n\n<pre><code>fract x \n    | x &lt; 0 = 1 - fract (abs x)\n    | x &lt; 1 = x\n    | otherwise = fract (x - 1)\n</code></pre>\n\n<p>and then of course <code>floor x</code> would be <code>x - fract x</code>. The algorithm above, however, is O(n) and it's going to drastically slow things down, so I'm hoping there's a way to do this that is constant time.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 6, "creation_date": 1503355285, "post_id": 45806167, "comment_id": 78570792, "body": "Note that isn&#39;t the type of <code>over</code> as defined by the <a href=\"https://hackage.haskell.org/package/lens-4.15.4/docs/Control-Lens-Setter.html#v:over\" rel=\"nofollow noreferrer\"><code>lens</code></a> library. That being said, your version doesn&#39;t work because <code>Lens</code> is <code>forall f . Functor f =&gt; ..</code> and <code>_all&#39; 2 :: forall f . Applicative f =&gt; ..</code>; in other words, <code>over</code> is demanding a function which works for any <code>Functor</code>, but you&#39;ve provided one which only works for <code>Applicative</code> (which is a stronger constraint, in that <code>Functor</code> doesn&#39;t imply <code>Applicative</code>)."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503392731, "post_id": 45806167, "comment_id": 78584122, "body": "@user2407038 that&#39;s an answer."}, {"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 0, "creation_date": 1503433969, "post_id": 45806167, "comment_id": 78611036, "body": "Having explicit signatures available on the right hand expressions only is sufficient to engage the type checker before inferencer can deduce the appropriate constraint on the left hand side. I&#39;m posting this as comment because I don&#39;t understand whether that&#39;s necessary or incidental."}], "answers": [{"comments": [{"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 0, "creation_date": 1503594281, "post_id": 45824970, "comment_id": 78693147, "body": "A more specific question is, why does GHC not infer the context of the left hand side of the expression given constraints can be inferred from what is on the right hand?"}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "reply_to_user": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 0, "creation_date": 1503599946, "post_id": 45824970, "comment_id": 78696353, "body": "I think inference is not the problem here; there is no way for <code>over (_all&#39; 2)</code> to type-check since you have defined <code>over</code> too restrictively. There will never be a way for <code>forall f. Functor f =&gt; ...</code> to type-check with <code>Applicative f =&gt; ...</code>. It&#39;s not that GHC can&#39;t infer the right context; it&#39;s that you&#39;ve asked it to infer something impossible."}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": false, "score": 1, "last_activity_date": 1503428030, "creation_date": 1503428030, "answer_id": 45824970, "question_id": 45806167, "link": "https://stackoverflow.com/questions/45806167/when-does-ghci-not-deduce-the-required-context/45824970#45824970", "title": "When does GHCI not deduce the required context?", "body": "<blockquote>\n  <p>Note that isn't the type of <code>over</code> as defined by the lens library. That being said, your version doesn't work because <code>Lens</code> is</p>\n\n<pre><code>type Lens = forall f. Functor f =&gt; (a -&gt; f b) -&gt; s -&gt; f t\n</code></pre>\n  \n  <p>and</p>\n\n<pre><code>_all' 2 :: forall f. Applicative f =&gt; ..\n</code></pre>\n  \n  <p>In other words, <code>over</code> is demanding a function which works for any <code>Functor</code>, but you've provided one which only works for <code>Applicative</code> (which is a stronger constraint, in that <code>Functor</code> doesn't imply <code>Applicative</code>).</p>\n</blockquote>\n\n<p>Comment by @user2407038.</p>\n\n<p>As alluded to in the comment, you can fix your problem by fixing the type signature for <code>over</code>. It should either be the complicated fancy thing in <code>lens</code> using distributive functors or the simpler</p>\n\n<pre><code>type Setter s t a b = (a -&gt; Identity b) -&gt; s -&gt; Identity t\nover :: Setter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t\n</code></pre>\n\n<p>As the identity type is both a functor and an applicative, it unifies with lenses and (I assume in your case) traversals.</p>\n\n\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1503428030, "creation_date": 1503353089, "question_id": 45806167, "link": "https://stackoverflow.com/questions/45806167/when-does-ghci-not-deduce-the-required-context", "title": "When does GHCI not deduce the required context?", "body": "<p>Why does GHCI add constraint for the required context here:</p>\n\n<pre><code>&gt; let f = fmap show\n\n&gt; :t f\nf :: (Functor f, Show a) =&gt; f a -&gt; f String\n</code></pre>\n\n<p>But not here?</p>\n\n<pre><code>&gt; :t over\nover :: Lens s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t\n\n&gt; :t _all'\n_all' :: (Applicative f, Eq a) =&gt; a -&gt; (a -&gt; f a) -&gt; [a] -&gt; f [a]\n\n&gt; :t over (_all' 2)\n\n&lt;interactive&gt;:1:7: error:\n    \u2022 Could not deduce (Applicative f) arising from a use of \u2018_all'\u2019\n</code></pre>\n\n<p>Is there any major difference between these two cases?</p>\n"}, {"tags": ["haskell", "semigroup"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 6, "creation_date": 1503349422, "post_id": 45805440, "comment_id": 78568790, "body": "Unfortunately (or fortunately, depends how you look at it) laws attached to type classes aren&#39;t checked by the type system (doing that would require a theorem solver)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1503352714, "post_id": 45805440, "comment_id": 78570127, "body": "Probably pragmatics trumped exactness here. Not having a working <code>Sum Double</code> might be considered worse than having a &quot;working&quot; one which ignores rounding errors."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 4, "creation_date": 1503356192, "post_id": 45805440, "comment_id": 78571015, "body": "You can think of it from this alternative point of view: the law <code>(a &lt;&gt; b) &lt;&gt; c = a &lt;&gt; (b &lt;&gt; c)</code> doesn&#39;t specify which equality should be used, i.e. what specific relation the <code>=</code> denotes. It is natural to think of it in terms of structural equality, but note that very few typeclass laws actually hold up to structural equality (e.g. try proving <code>fmap id = id</code> for <code>[]</code> as opposed to <code>forall x . fmap id x = id x</code>). For this case, you could think of the <code>=</code> as an equality which judges <code>Double</code>s to be equal if the absolute value of their difference is less than machine epsilon."}], "owner": {"reputation": 517, "user_id": 280774, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4e45a04748c6dcaed9ec8249b1683ec6?s=128&d=identicon&r=PG", "display_name": "HBu", "link": "https://stackoverflow.com/users/280774/hbu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 91, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1503349228, "creation_date": 1503349228, "question_id": 45805440, "link": "https://stackoverflow.com/questions/45805440/floating-points-wrapped-in-sum-and-product-even-if-it-breaks-associativity", "title": "Floating points wrapped in Sum and Product even if it breaks associativity?", "body": "<p>Trying to learn Haskell and stumbled upon this:</p>\n\n<pre><code>Prelude&gt; import Data.Semigroup\nPrelude Data.Semigroup&gt; let x = Sum 0.1 &lt;&gt; Sum 0.2 &lt;&gt; Sum 0.3\nPrelude Data.Semigroup&gt; let y = (Sum 0.1 &lt;&gt; Sum 0.2) &lt;&gt; Sum 0.3\nPrelude Data.Semigroup&gt; x == y\nFalse\n</code></pre>\n\n<p>Obviously that's the normal inaccuracy with floating point arithmetic, but why are floating point values instances of <code>Num</code> or perhaps why is there an instance <code>instance Num a =&gt; Semigroup (Sum a)</code> if associativity doesn't hold? Are there any other areas where the guarantees of the type system aren't guarantees that one should be aware of? Besides fixed-width numerical values?</p>\n"}, {"tags": ["haskell", "recursion", "binary-tree", "postfix-notation"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1503327325, "post_id": 45800081, "comment_id": 78558280, "body": "What about <code>add Empty [] x</code>? Or <code>add (Leaf x) token []</code>? Are you sure that you captured <i>all</i> patterns that can happen in <code>add</code> itself?"}, {"owner": {"reputation": 35, "user_id": 6165798, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/db3735bb4acffd1d5c496ccd4ccc3424?s=128&d=identicon&r=PG&f=1", "display_name": "Mafi", "link": "https://stackoverflow.com/users/6165798/mafi"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1503327646, "post_id": 45800081, "comment_id": 78558504, "body": "You mean: <code>add Empty [] stack = Empty</code> ?"}, {"owner": {"reputation": 35, "user_id": 6165798, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/db3735bb4acffd1d5c496ccd4ccc3424?s=128&d=identicon&r=PG&f=1", "display_name": "Mafi", "link": "https://stackoverflow.com/users/6165798/mafi"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1503327927, "post_id": 45800081, "comment_id": 78558709, "body": "I will try to write a code for patterns: <code>add (Leaf x) token []</code>"}, {"owner": {"reputation": 35, "user_id": 6165798, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/db3735bb4acffd1d5c496ccd4ccc3424?s=128&d=identicon&r=PG&f=1", "display_name": "Mafi", "link": "https://stackoverflow.com/users/6165798/mafi"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1503328361, "post_id": 45800081, "comment_id": 78559016, "body": "I was thinking about your question and I am not sure, if there is a situation in the algorithm, when the stack is empty, current node is a leaf and string is non-empty."}], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 6165798, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/db3735bb4acffd1d5c496ccd4ccc3424?s=128&d=identicon&r=PG&f=1", "display_name": "Mafi", "link": "https://stackoverflow.com/users/6165798/mafi"}, "edited": false, "score": 0, "creation_date": 1503337404, "post_id": 45802838, "comment_id": 78563642, "body": "Thank you. Your answer helped a lot :]"}], "tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": true, "score": 2, "last_activity_date": 1503337214, "creation_date": 1503337214, "answer_id": 45802838, "question_id": 45800081, "link": "https://stackoverflow.com/questions/45800081/haskell-convert-postfix-expression-to-binary-tree/45802838#45802838", "title": "Haskell - convert postfix expression to binary tree", "body": "<p>I've managed to reproduce the error by simple example:</p>\n\n<pre><code>add Empty [\"10\", \"1\", \"+\"] []\n</code></pre>\n\n<p>The program successfully adds <code>Leaf \"10\"</code> to the stack, but can't add <code>Leaf \"1\"</code> to the stack, because the <code>add</code> is called with the following args:</p>\n\n<pre><code>add Empty [\"1\", \"+\"] [Leaf \"10\"]\n</code></pre>\n\n<p>But it doesn't match any pattern, because <code>add Empty (x:xs) (a:b:bs)</code> expects the third argument to have two <code>Tree</code> elements and a list. Therefore, a pattern that matches third argument as a list with one element is needed. For example, adding:</p>\n\n<pre><code>add Empty (x:xs) [a] = add Empty xs (Leaf x:[a])\n</code></pre>\n\n<p>fixes the error and prints the following:</p>\n\n<pre><code>Node (Leaf \"10\") \"+\" (Leaf \"1\")\n</code></pre>\n\n<p>Hope it'll help you to continue with the task, unless you've already solved it :)</p>\n"}], "owner": {"reputation": 35, "user_id": 6165798, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/db3735bb4acffd1d5c496ccd4ccc3424?s=128&d=identicon&r=PG&f=1", "display_name": "Mafi", "link": "https://stackoverflow.com/users/6165798/mafi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 501, "favorite_count": 0, "accepted_answer_id": 45802838, "answer_count": 1, "score": 1, "last_activity_date": 1503337214, "creation_date": 1503326898, "question_id": 45800081, "link": "https://stackoverflow.com/questions/45800081/haskell-convert-postfix-expression-to-binary-tree", "title": "Haskell - convert postfix expression to binary tree", "body": "<p>I am trying to convert postfix expression to binary tree. My function takes as argument a list of tokens (strings).</p>\n\n<p>Everytime I give the function any input, debugger writes a message: Non-exhaustive patterns in function \"add\".</p>\n\n<p>My idea was:  read a token after token and determine, if it is an operator or an operand. If it is operand, don't save any node to the tree and store the number to the stack. Otherwise I create a node with an operator, pop symbols from stack, set them as children of new node and push the operator to stack.</p>\n\n<p>If the list of strings is empty, functions print the binary tree.</p>\n\n<p>Would someone explain to me, why the function gives non-exhaustive patterns error and how can I fix the function?  </p>\n\n<pre><code>data Tree = Leaf String | Empty | Node Tree String Tree deriving (Show)\n\nadd :: Tree -&gt; [String] -&gt; [Tree] -&gt; Tree\nadd (Node l v p) [] stack = (Node l v p)\nadd Empty (x:xs) []\n        | x `elem` [\"*\",\"-\",\"+\"] = add (Leaf x) xs [Leaf x]\n        | otherwise = add Empty xs [Leaf x]\nadd Empty (x:xs) (a:b:bs)\n        | x `elem` [\"*\",\"-\",\"+\"] = add (Node b x a) xs (Leaf x:a:b:bs)\n        | otherwise = add Empty xs (Leaf x:a:b:bs)\nadd (Leaf x) token (a:b:bs)\n        | x `elem` [\"*\",\"-\",\"+\"] = add (Node b x a) token (Leaf x:bs)\n        | otherwise = Leaf x\nadd (Node l v p) (x:xs) (a:b:bs)\n        | x `elem` [\"*\",\"-\",\"+\"] = add (Node b x a) xs (Leaf x:bs)\n        | otherwise = add (Node l v p) xs (Leaf x:a:b:bs) \n\nparse :: String -&gt; Tree\nparse input = add Empty (words (toPostfix input)) []\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503324112, "post_id": 45798242, "comment_id": 78555948, "body": "Functor would be enough for the <code>Identity</code> instance, but that is a trivial instance. It isn&#39;t enough for pretty much any recursive type - take a look at the <code>Traversable []</code> instance."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1503378150, "post_id": 45798242, "comment_id": 78575971, "body": "The non-applicative version is called <code>Functor</code>"}], "answers": [{"comments": [{"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1503407977, "post_id": 45799141, "comment_id": 78595039, "body": "Can you please clarify more about ` traverse` and <code>Applicative f</code>, I can not follow."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1503408402, "post_id": 45799141, "comment_id": 78595401, "body": "Yeah... what do you not understand?"}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1503409332, "post_id": 45799141, "comment_id": 78596175, "body": "The last section about <code>traverse</code> and <code>Applicative f</code>."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1503412197, "post_id": 45799141, "comment_id": 78598466, "body": "If <code>traverse</code> do not a part of Applicative, what is going to happen?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1503414568, "post_id": 45799141, "comment_id": 78600320, "body": "Well, you can do neither <code>pure mempty</code> nor <code>liftA2 (&lt;&gt;)</code> without <code>Applicative</code>, so no way of combining the individual results."}, {"owner": {"reputation": 355, "user_id": 3150464, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6994392ca8aa3dc2bc3cfbf83e02044e?s=128&d=identicon&r=PG&f=1", "display_name": "klabe", "link": "https://stackoverflow.com/users/3150464/klabe"}, "edited": false, "score": 0, "creation_date": 1609813572, "post_id": 45799141, "comment_id": 115934054, "body": "&quot;and reconstructs the structure as it was&quot;. What&#39;s the &quot;structure&quot; here? I understand fmap keeps the structure but how does traverse do that?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 355, "user_id": 3150464, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6994392ca8aa3dc2bc3cfbf83e02044e?s=128&d=identicon&r=PG&f=1", "display_name": "klabe", "link": "https://stackoverflow.com/users/3150464/klabe"}, "edited": false, "score": 0, "creation_date": 1609862635, "post_id": 45799141, "comment_id": 115951598, "body": "@klabe <i>by definition</i> in the same way. I.e., <code>traverse (pure . f) \u2261 pure . fmap f</code>."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 19, "last_activity_date": 1503336655, "last_edit_date": 1503336655, "creation_date": 1503324300, "answer_id": 45799141, "question_id": 45798242, "link": "https://stackoverflow.com/questions/45798242/the-purpose-of-the-traversable-typeclass/45799141#45799141", "title": "The purpose of the Traversable typeclass", "body": "<p><code>Identity</code> is a bit of a poor example as it always contains exactly one value. You're right \u2013 in this case, a <code>Functor f</code> constraint would be sufficient. But clearly, most traversables aren't so structurally trivial.</p>\n\n<p>What <code>traverse</code> does is: it \u201cvisits\u201d, in some well-specified order, all elements in a container, performs some operation on them, and reconstructs the structure as it was. This is more powerful than either</p>\n\n<ul>\n<li><code>Functor t</code>, which also allows you to visit/modify all elements and reconstructs the structure, but only completely independent of one another (thus allowing to choose an arbitrary order-of-computation, returning a thunk to the structure before any of the elements have been (lazily) mapped at all, etc.).</li>\n<li><p><code>Foldable t</code>, which brings the elements in a linear order, but does not reconstruct the structure. Basically, <code>Foldable</code> is just the class of containers that can be demoted to a simple list, as witnessed by</p>\n\n<pre><code>toList :: Foldable t =&gt; t a -&gt; [a]\n</code></pre>\n\n<p>...or to a concatenation of any monoidal type, via</p>\n\n<pre><code>foldMap :: (Foldable t, Monoid m) =&gt; (a -&gt; m) -&gt; t a -&gt; m\n</code></pre>\n\n<p>Here, the results of the operation on each element are <em>combined</em> through the monoid operation (or, in case the are no elements, the result is <code>mempty</code>).</p></li>\n</ul>\n\n<p>In case of <code>traverse</code>, the <code>Applicative f</code> constraint basically lifts this monoid-combining to something in which you can also reconstruct the structure. The correspondence is</p>\n\n<pre><code>mempty      ::   m\npure mempty :: f m\n</code></pre>\n\n<p>and</p>\n\n<pre><code>(&lt;&gt;)        ::   m -&gt;   m -&gt;   m\nliftA2 (&lt;&gt;) :: f m -&gt; f m -&gt; f m\n</code></pre>\n\n<p>...but in addition, because <code>f</code> is also a functor, you can wrap the local results in any data constructor and thus build not only a generic list-like thing but an arbitrary container, including one with the original structure.</p>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1503340464, "post_id": 45801791, "comment_id": 78564953, "body": "The &quot;Compared to ...&quot; part can be misunderstood, I think. Surely the IO monad allows to check for 7, save it in some ref, and fire missiles later on when processing the next element."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1503342003, "post_id": 45801791, "comment_id": 78565658, "body": "@chi But the IO action that will read the reference is &quot;fixed&quot; in a sense. It depends only on the current element. You can&#39;t choose <i>not</i> to read a reference depending on previous results!"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1503346077, "post_id": 45801791, "comment_id": 78567419, "body": "I completely agree, but it&#39;s quite subtle. You don&#39;t have <i>direct</i> access to the value the previous IO action returned. You do have access to the same references, in which one might choose to save the previously returned value. A &quot;fixed&quot; IO action could start by (unconditionally!) accessing a reference to a log of what was done before, and then depending on it, choosing whether to access other references."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 12, "last_activity_date": 1503333538, "last_edit_date": 1503333538, "creation_date": 1503332745, "answer_id": 45801791, "question_id": 45798242, "link": "https://stackoverflow.com/questions/45798242/the-purpose-of-the-traversable-typeclass/45801791#45801791", "title": "The purpose of the Traversable typeclass", "body": "<p><code>Traversable</code> in Haskell unifies the concept of mapping over a container (getting a similary-shaped container in return) with the concept of <a href=\"https://stackoverflow.com/questions/224648/external-iterator-vs-internal-iterator\">\"internal iterator\"</a> that performs an effect for each element.</p>\n\n<p>Compared to external iterators, internal iterators are constrained in that we can't use a value obtained for one element to decide what to do with other elements. We can't say \"mmmm, if the operation returns 7 for some element, launch the missiles when processing the next one\".</p>\n\n<p>This type of \"rigid\" computations, that can't change course based on values determined mid-way, is represented in Haskell by the <code>Applicative</code> typeclass. That's the reason <code>Traversable</code> (the containers) and <code>Applicative</code> (the effects) go hand-in-hand. <code>Functor</code> is not enough because it doesn't provide a method to combine effectful actions.</p>\n\n<p>Allowing any kind of <code>Applicative</code> effect is a boon; it means we can traverse a container performing IO, <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Either.html#t:Either\" rel=\"noreferrer\">existing early from failure</a>, <a href=\"http://hackage.haskell.org/package/transformers-0.5.4.0/docs/Control-Monad-Trans-Writer-Strict.html\" rel=\"noreferrer\">collecting log messages</a>, <a href=\"http://hackage.haskell.org/package/transformers-0.5.4.0/docs/Control-Applicative-Lift.html#g:2\" rel=\"noreferrer\">collecting error messages from failed iterations</a>, <a href=\"http://hackage.haskell.org/package/async-2.1.1.1/docs/Control-Concurrent-Async.html#t:Concurrently\" rel=\"noreferrer\">iterating concurrently</a>... or <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Functor-Compose.html\" rel=\"noreferrer\">any combination</a> of those effects.</p>\n"}, {"tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": false, "score": 14, "last_activity_date": 1503419192, "last_edit_date": 1503419192, "creation_date": 1503351349, "answer_id": 45805873, "question_id": 45798242, "link": "https://stackoverflow.com/questions/45798242/the-purpose-of-the-traversable-typeclass/45805873#45805873", "title": "The purpose of the Traversable typeclass", "body": "<blockquote>\n  <p>The result type of the application f a has to be an applicative, why? Would a functor not be enough?</p>\n</blockquote>\n\n<p>This is a <em>fantastic</em> question. The original <a href=\"http://strictlypositive.org/Idiom.pdf\" rel=\"noreferrer\">McBride &amp; Paterson</a> paper goes in the other direction: it notices that a lot of computation are applicative in nature (can be rewritten with <code>pure</code> and <code>&lt;*&gt;</code>). <em>Then</em> it notices that certain containers, like <code>[]</code>, allow for a function of this type:</p>\n\n<pre><code> idist :: Applicative f =&gt; [f a] -&gt; f [a]\n idist = ...\n</code></pre>\n\n<p>This we now call <code>sequence</code> in the <code>Traversable</code> class. All well and good, but it helps to probe the <em>strength</em> of our assumptions when we write abstractions. What if we tried to build a traversable library without <code>Applicative</code>, using only <code>Functor</code>? What exactly would go wrong?</p>\n\n<h2>Products!</h2>\n\n<p>For this it helps to read through the <a href=\"https://arxiv.org/pdf/1202.2919.pdf\" rel=\"noreferrer\">Jaskelioff &amp; Rypacek</a> paper that tries to pin down structures in category theory that correspond to applicative functors and traversable containers. The most interesting property of traversable containers is that they are <em>closed</em> under finite <em>sums</em> and <em>products</em>. This is great for Haskell programming, where a vast number of datatypes can be defined with sums and products:</p>\n\n<pre><code>data WeirdSum a = ByList [a] | ByMaybe (Maybe a)\n\ninstance Traversable WeirdSum where\n  traverse a2fb (ByList as) =\n    ByList &lt;$&gt; traverse a2fb as\n  traverse a2fb (ByMaybe maybeA) =\n    ByMaybe &lt;$&gt; traverse a2fb maybeA\n</code></pre>\n\n<p>Ah, more evidence that we do not need all the power of Applicative! We are only using <code>fmap</code> here. Now finite products:</p>\n\n<pre><code>data WeirdProduct a = WeirdProduct [a] (Maybe a)\n\ninstance Traversable WeirdProduct where\n  traverse a2fb (WeirdProduct as aMaybe) =\n    WeirdProduct &lt;$&gt; traverse a2fb as &lt;*&gt; traverse a2fb aMaybe\n</code></pre>\n\n<p>Here it is impossible to write a definition with <em>just</em> functors: <code>fmap</code> is great for sums but gives us no way to \"glue\" together two different functorial values. It is only with <code>&lt;*&gt;</code> that we are able to \"close\" traversable containers over finite products.</p>\n\n\n\n<p>This is all well and good but lacks precision. We are sort of cherry-picking evidence here that <code>Functor</code> might be bad, but could we argue from first principles that <code>Applicative</code> is exactly what we need, no more and no less?</p>\n\n<h2>Category theory!</h2>\n\n<p>This problem is tackled in the second half of the Jaskelioff &amp; Rypacek paper. In category-theoretic terms, a functor <code>T</code> is traversable iff it allows for a family of natural transformations</p>\n\n<pre><code>{ sequence | sequence : TFX -&gt; FTX, any applicative F }\n</code></pre>\n\n<p>where each natural transformation is \"natural in F\" and respects the \"<a href=\"https://bartoszmilewski.com/2017/02/06/applicative-functors/\" rel=\"noreferrer\">monoidal structure of applicative functor composition</a>.\" It is that last phrase, that last little piece of jargon, where it is important to have <code>Applicative</code> rather than <code>Functor</code>. With <code>Applicative f</code>, we are able to glue together values of type <code>f a</code> and <code>f b</code>, where we either act on them (a la <code>foo &lt;$&gt; fa &lt;*&gt; fb</code> where <code>foo :: a -&gt; b -&gt; c</code> and <code>fa, fb :: f a, f b</code>) or just shove them into a tuple <code>f (a, b)</code>. This gives rise to the aforementioned \"monoidal structure\"; we need this to then prove that traversable functors are closed over finite products, just like we showed above. Without applicatives we couldn't even begin talking about how functors and products interact! If <strong>Hask</strong> is our category of Haskell types, then an applicative is just a way to name <strong>Hask</strong>-to-<strong>Hask</strong> endofunctors that \"behave well\" around <code>(-&gt;)</code> types and product types. </p>\n\n<p>Hopefully this two-pronged answer, one in practical programming and one in categorical foo-foo, gives a little intuition as to why you want applicative functors when talking about traversability. I think often traversables are introduced with an element of magic around them, but they are very much motivated by practical concerns with solid theoretical foundations. Other language ecosystems may have easier-to-use iteration patterns and libraries, but I for one love the simplicity and elegance of <code>traverse</code> and <code>sequence</code>.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1028, "favorite_count": 2, "accepted_answer_id": 45799141, "answer_count": 3, "score": 14, "last_activity_date": 1503419192, "creation_date": 1503321694, "last_edit_date": 1503333122, "question_id": 45798242, "link": "https://stackoverflow.com/questions/45798242/the-purpose-of-the-traversable-typeclass", "title": "The purpose of the Traversable typeclass", "body": "<p>Could someone please explain to me, what is the purpose of the typeclass <code>Traversable</code>?  </p>\n\n<p>The typeclass definition is:</p>\n\n<pre><code>class (Functor t, Foldable t) =&gt; Traversable (t :: * -&gt; *) where\n</code></pre>\n\n<p>So <code>Traversable</code> is a <code>Functor t</code> and <code>Foldable t</code>.  </p>\n\n<p>The <code>traverse</code> function is a member of <code>Traversable</code> and has the following signature:  </p>\n\n<pre><code>traverse :: Applicative f =&gt; (a -&gt; f b) -&gt; t a -&gt; f (t b)\n</code></pre>\n\n<p>Why does the result have to be wrapped into an applicative? What is the sense of it?   </p>\n\n<p>I have the following example:</p>\n\n<pre><code>module ExercisesTraversable where\n\n  import Test.QuickCheck (Arbitrary, arbitrary)\n  import Test.QuickCheck.Checkers (quickBatch, eq, (=-=), EqProp)\n  import Test.QuickCheck.Classes (traversable)\n\n  type TI = []\n\n  newtype IdentityT a = IdentityT a\n    deriving (Eq, Ord, Show)\n\n  instance Functor IdentityT where\n    fmap f (IdentityT a) = IdentityT (f a)\n\n  instance Foldable IdentityT where\n    foldMap f (IdentityT a) = f a\n\n  instance Traversable IdentityT where\n    traverse f (IdentityT a) = IdentityT &lt;$&gt; f a\n\n  instance Arbitrary a =&gt; Arbitrary (IdentityT a) where\n    arbitrary = do\n      a &lt;- arbitrary\n      return (IdentityT a)\n\n  instance Eq a =&gt; EqProp (IdentityT a) where (=-=) = eq\n\n  main = do\n    let trigger = undefined :: TI (Int, Int, [Int])\n    quickBatch (traversable trigger)  \n</code></pre>\n\n<p>Let's take a look at the <code>traverse</code> implementation:</p>\n\n<pre><code>traverse f (IdentityT a) = IdentityT &lt;$&gt; f a\n</code></pre>\n\n<p>The result type of the application <code>f a</code> has to be an applicative, why? Would a functor not be enough?</p>\n"}, {"tags": ["c++", "haskell", "macos-sierra", "haskell-stack"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1503320887, "post_id": 45797730, "comment_id": 78553487, "body": "May be relevant <a href=\"https://stackoverflow.com/questions/10357804/configure-error-c-compiler-cannot-create-executables\" title=\"configure error c compiler cannot create executables\">stackoverflow.com/questions/10357804/&hellip;</a>"}, {"owner": {"reputation": 825, "user_id": 7933478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VZEUU.jpg?s=128&g=1", "display_name": "Dylan Landry", "link": "https://stackoverflow.com/users/7933478/dylan-landry"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1503328747, "post_id": 45797730, "comment_id": 78559260, "body": "@n.m. After reading the accepted answer in your link, I was led to check my Xcode command line tools version. My version was fine, but then I noticed an additional line in my <code>config.log</code>.  <code>Agreeing to the Xcode&#47;iOS license requires admin privileges, please run \u201csudo xcodebuild -license\u201d and then retry this command</code> Running <code>sudo xcodebuild -license</code> fixed my issue. Thanks for the lead n.m."}], "answers": [{"tags": [], "owner": {"reputation": 825, "user_id": 7933478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VZEUU.jpg?s=128&g=1", "display_name": "Dylan Landry", "link": "https://stackoverflow.com/users/7933478/dylan-landry"}, "is_accepted": true, "score": 3, "last_activity_date": 1503329133, "creation_date": 1503329133, "answer_id": 45800790, "question_id": 45797730, "link": "https://stackoverflow.com/questions/45797730/haskell-stack-setup-cant-recognize-cpp-program/45800790#45800790", "title": "Haskell Stack Setup - Can&#39;t Recognize CPP Program", "body": "<p>@n.m Commented a link leading me to a question's answer that recommended I check my xCode listed version of the developer command line tools. Turns out my version was fine, but I did later find this line in <code>.stack/programs/x86_64-osx/ghc-8.0.2.temp/ghc-8.0.2/config.log</code> that led me to the solution of my problem.</p>\n\n<pre><code>Agreeing to the Xcode/iOS license requires admin privileges, please run \u201csudo xcodebuild -license\u201d and then retry this command\n</code></pre>\n\n<p><code>sudo xcodebuild -license</code> allowed me to then run <code>stack install</code> successfully.</p>\n"}], "owner": {"reputation": 825, "user_id": 7933478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VZEUU.jpg?s=128&g=1", "display_name": "Dylan Landry", "link": "https://stackoverflow.com/users/7933478/dylan-landry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 210, "favorite_count": 0, "accepted_answer_id": 45800790, "answer_count": 1, "score": 4, "last_activity_date": 1503329133, "creation_date": 1503320162, "question_id": 45797730, "link": "https://stackoverflow.com/questions/45797730/haskell-stack-setup-cant-recognize-cpp-program", "title": "Haskell Stack Setup - Can&#39;t Recognize CPP Program", "body": "<p>I am following the Udemy Haskell course, which at one point I'm shown to download Haskell using the Stack option. I've configured my $PATH and ran stack setup when I run into an issue.</p>\n\n<pre><code>configure: WARNING: configure can't recognize your CPP program, you may need to set --with-hs-cpp-flags=FLAGS explicitly\nconfigure: error: in `/Users/Dylan/.stack/programs/x86_64-osx/ghc-8.0.2.temp/ghc-8.0.2':\nconfigure: error: C compiler cannot create executables\n</code></pre>\n\n<p>I have looked into <code>.stack/programs/x86_64-osx/ghc-8.0.2.temp/ghc-8.0.2/config.log</code> and found this...</p>\n\n<pre><code>configure:2234: checking for path to top of build tree\nconfigure:2255: result: /Users/Dylan/.stack/programs/x86_64-osx/ghc-8.0.2.temp/$\nconfigure:2981: checking for perl\nconfigure:2999: found /usr/bin/perl\nconfigure:3011: result: /usr/bin/perl\nconfigure:3070: checking for a BSD-compatible install\nconfigure:3138: result: /usr/bin/install -c\nconfigure:3152: checking whether ln -s works\nconfigure:3156: result: yes\nconfigure:3168: checking for gsed\nconfigure:3199: result: sed\nconfigure:3211: checking XCode version\nconfigure:3222: result: 8.3.3\nconfigure:3226: XCode version component 1: 8\nconfigure:3228: XCode version component 2: 3\nconfigure:3263: checking for gcc\nconfigure:3281: found /usr/bin/gcc\nconfigure:3293: result: /usr/bin/gcc\nconfigure:3573: WARNING: configure can't recognize your CPP program, you may ne$\nconfigure:3623: checking for llc-3.7\nconfigure:3656: result: no\nconfigure:3739: checking for llc\nconfigure:3772: result: no\nconfigure:3872: checking for opt-3.7\nconfigure:3905: result: no\nconfigure:3988: checking for opt\nconfigure:4021: result: no\nconfigure:4120: checking for ld\nconfigure:4138: found /usr/bin/ld\nconfigure:4150: result: /usr/bin/ld\nconfigure:4388: checking for gcc\nconfigure:4415: result: /usr/bin/gcc\nconfigure:4644: checking for C compiler version\nconfigure:4653: /usr/bin/gcc --version &gt;&amp;5\n</code></pre>\n\n<p>I am able to read <code>configure: WARNING: configure can't recognize your CPP program, you may need to set --with-hs-cpp-flags=FLAGS explicitly</code>, but I am not sure how or where to do that. I've found my settings.in file...</p>\n\n<pre><code>[(\"GCC extra via C opts\", \"@GccExtraViaCOpts@\"),\n (\"C compiler command\", \"@SettingsCCompilerCommand@\"),\n (\"C compiler flags\", \"@SettingsCCompilerFlags@\"),\n (\"C compiler link flags\", \"@SettingsCCompilerLinkFlags@\"),\n (\"C compiler supports -no-pie\", \"@SettingsCCompilerSupportsNoPie@\"),\n (\"Haskell CPP command\",\"@SettingsHaskellCPPCommand@\"),\n (\"Haskell CPP flags\",\"@SettingsHaskellCPPFlags@\"),\n (\"ld command\", \"@SettingsLdCommand@\"),\n (\"ld flags\", \"@SettingsLdFlags@\"),\n (\"ld supports compact unwind\", \"@LdHasNoCompactUnwind@\"),\n (\"ld supports build-id\", \"@LdHasBuildId@\"),\n (\"ld supports filelist\", \"@LdHasFilelist@\"),\n (\"ld is GNU ld\", \"@LdIsGNULd@\"),\n (\"ar command\", \"@SettingsArCommand@\"),\n (\"ar flags\", \"@ArArgs@\"),\n (\"ar supports at file\", \"@ArSupportsAtFile@\"),\n (\"touch command\", \"@SettingsTouchCommand@\"),\n (\"dllwrap command\", \"@SettingsDllWrapCommand@\"),\n (\"windres command\", \"@SettingsWindresCommand@\"),\n (\"libtool command\", \"@SettingsLibtoolCommand@\"),\n (\"perl command\", \"@SettingsPerlCommand@\"),\n (\"cross compiling\", \"@CrossCompiling@\"),\n (\"target os\", \"@HaskellTargetOs@\"),\n (\"target arch\", \"@HaskellTargetArch@\"),\n (\"target word size\", \"@WordSize@\"),\n (\"target has GNU nonexec stack\", \"@HaskellHaveGnuNonexecStack@\"),\n (\"target has .ident directive\", \"@HaskellHaveIdentDirective@\"),\n (\"target has subsections via symbols\", \"@HaskellHaveSubsectionsViaSymbols@\"),\n (\"Unregisterised\", \"@Unregisterised@\"),\n (\"LLVM llc command\", \"@SettingsLlcCommand@\"),\n (\"LLVM opt command\", \"@SettingsOptCommand@\")\n ]\n</code></pre>\n\n<p>But again, I do not know what to do with it. Sorry, if my question is basic, but I have not done something similar to this before, and what I have found online has been difficult to interpret how it is applicable to my situation.</p>\n\n<p>Any help would be greatly appreciated. \ud83d\ude00</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1503315832, "creation_date": 1503315832, "answer_id": 45796266, "question_id": 45796115, "link": "https://stackoverflow.com/questions/45796115/how-to-use-a-specific-constructor-from-a-datatype-while-there-are-multiple-possi/45796266#45796266", "title": "How to use a specific constructor from a datatype while there are multiple possible type constructor", "body": "<p>You need parentheses here</p>\n\n<pre><code>data Sport a = SF (Football a) | ST (Tennis a)\n</code></pre>\n\n<p>Then you need to pattern match against sports, not other types:</p>\n\n<pre><code>instance Show a =&gt; Show (Sport a) where\n  show (SF Football{..}) = \"&lt;== Football ==&gt;\"\n  show (ST Tennis{..}) = \"&lt;== Tennis ==&gt;\"\n</code></pre>\n"}], "owner": {"reputation": 157, "user_id": 7631220, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/42ac4a8aebbc6491db718dbd189c78ba?s=128&d=identicon&r=PG&f=1", "display_name": "Babas", "link": "https://stackoverflow.com/users/7631220/babas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "accepted_answer_id": 45796266, "answer_count": 1, "score": 1, "last_activity_date": 1503315832, "creation_date": 1503315365, "question_id": 45796115, "link": "https://stackoverflow.com/questions/45796115/how-to-use-a-specific-constructor-from-a-datatype-while-there-are-multiple-possi", "title": "How to use a specific constructor from a datatype while there are multiple possible type constructor", "body": "<p>I have the following data types and I would like to create an instance of Sport but I don't know how to call the type Football from the data type Sport. </p>\n\n<pre><code>`data Football a  = Football\n{ players       :: Players a    \n, Stadium       :: Stadium  a\n}     \n\ndata Tennis a  = Tennis\n{ players1      :: Players a    \n, Stadium1      :: Stadium  a\n}\ndata Sport a = SF  Football a  | ST Tennis a\n</code></pre>\n\n<p>When I do: </p>\n\n<pre><code>Instance Show a =&gt; Show (Sport a) where\nshow Football{..} = \"&lt;== Football ==&gt;\"\nshow Tennis{..} = \"&lt;== Tennis ==&gt;\"\n</code></pre>\n\n<p>I get a error message: Couldn't match expected type \u2018Sport a\u2019\n              with actual type \u2018Football t6\u2019\nI tryed  some other ways and check some other example but I could figure out how to do it... does some one have an idea?</p>\n\n<p>Thanks in advance :) </p>\n"}, {"tags": ["haskell", "io", "scheme", "ioref"], "comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 3, "creation_date": 1503314965, "post_id": 45795814, "comment_id": 78549448, "body": "<code>global</code> create new <code>SCM</code> with new <code>IORef</code>. You should reorganize your loop, where <code>global</code> will be performed once."}], "answers": [{"comments": [{"owner": {"reputation": 473, "user_id": 3895039, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e76642ac5323616edb410119b0be9b16?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Vong", "link": "https://stackoverflow.com/users/3895039/alex-vong"}, "edited": false, "score": 0, "creation_date": 1503316435, "post_id": 45796125, "comment_id": 78550388, "body": "Thank you, so my misconception was to think of it as a global. But in fact, it behaves more like a constructor, right?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 473, "user_id": 3895039, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e76642ac5323616edb410119b0be9b16?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Vong", "link": "https://stackoverflow.com/users/3895039/alex-vong"}, "edited": false, "score": 0, "creation_date": 1503323002, "post_id": 45796125, "comment_id": 78555194, "body": "@AlexVong right. You can think of any <code>IO a</code> as an <i>action</i> that will yield an <code>a</code> if executed. For example, <code>readLine :: IO String</code> will give you a <code>String</code> when you execute it, yet you don&#39;t expect <code>readLine</code> to return the same string for every call (it depends on the user&#39;s input)."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 7, "last_activity_date": 1503315390, "creation_date": 1503315390, "answer_id": 45796125, "question_id": 45795814, "link": "https://stackoverflow.com/questions/45795814/ioref-still-refers-to-the-old-value-after-update/45796125#45796125", "title": "IORef still refers to the old value after update", "body": "<p>We can cut your example down to <code>main = (global &gt;&gt;= loop) &gt;&gt; main</code>. The problem is that <code>global</code> is not a single global variable, instead its a <code>IO SCM</code>, an action that will create the global value. Let us rename it:</p>\n\n<pre><code>createSCM :: IO SCM\ncreateSCM = Environment &lt;$&gt; newIORef False &lt;*&gt; pure Empty'Environment\n</code></pre>\n\n<p>Now the name is closer to the truth. We create a new <code>SCM</code> every time we call that function. So your program works like this:</p>\n\n<pre><code>main = (createSCM &gt;&gt;= loop) &gt;&gt; main\n     = (createSCM &gt;&gt;= loop) &gt;&gt; (createSCM &gt;&gt;= loop) &gt;&gt; main\n     = (createSCM &gt;&gt;= loop) &gt;&gt; (createSCM &gt;&gt;= loop) &gt;&gt; ...\n</code></pre>\n\n<p>As you can see we create new <code>SCM</code> all the time. Therefore you don't get the expected behavior.</p>\n\n<p>The solution is simple. Create your <code>global</code> and <code>loop</code> explicitly:</p>\n\n<pre><code>main = do\n  global &lt;- createSCM\n  let loop = do\n         ...\n         loop\n  loop\n</code></pre>\n"}], "owner": {"reputation": 473, "user_id": 3895039, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e76642ac5323616edb410119b0be9b16?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Vong", "link": "https://stackoverflow.com/users/3895039/alex-vong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "accepted_answer_id": 45796125, "answer_count": 1, "score": 5, "last_activity_date": 1526821243, "creation_date": 1503314458, "last_edit_date": 1526821243, "question_id": 45795814, "link": "https://stackoverflow.com/questions/45795814/ioref-still-refers-to-the-old-value-after-update", "title": "IORef still refers to the old value after update", "body": "<h1>Background</h1>\n\n<p>I am a Schemer starting to learn Haskell. I am trying to implement a Scheme interpreter in C, following <a href=\"https://mitpress.mit.edu/sicp/full-text/book/book-Z-H-25.html#%_chap_4\" rel=\"noreferrer\">chapter 4</a> of SICP. It turns out programming directly in C is too hard. So I decide to first prototype in Haskell. With the help of <a href=\"https://en.wikibooks.org/wiki/Write_Yourself_a_Scheme_in_48_Hours\" rel=\"noreferrer\">Write Yourself a Scheme in 48 Hours</a>, I have implemented everything except variables, closures and environment.</p>\n\n<h1>Problem</h1>\n\n<p>The modification to <code>IORef</code> doesn't persist between invocations of <code>main</code>. I expect the program to print <strong>(False) (True) (True) (True)</strong>... but in fact it prints <strong>(False) (True) (False) (True) (False) (True)</strong>...</p>\n\n<p>Strip-down version of the code:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.IORef\n\ndata SCM = Environment (IORef Bool) SCM | Empty'Environment\n\nglobal :: IO SCM\nglobal = Environment &lt;$&gt; newIORef False &lt;*&gt; pure Empty'Environment\n\nprint'' :: SCM -&gt; IO ()\nprint'' ls =\n  case ls of\n    Empty'Environment -&gt; pure ()\n    Environment first rest -&gt; readIORef first &gt;&gt;= putStr . show &gt;&gt; print'' rest\n\nprint' :: SCM -&gt; IO ()\nprint' ls = putStr \"(\" *&gt; print'' ls *&gt; putStrLn \")\"\n\nmain :: IO ()\nmain = global &gt;&gt;=\n       \\ls -&gt; case ls of\n                Empty'Environment -&gt; pure ()\n                Environment first _ -&gt; print' ls *&gt;\n                                       modifyIORef first (const True) *&gt;\n                                       print' ls *&gt;\n                                       main\n</code></pre>\n\n<p>Syntax-highlighted version:\n<a href=\"https://i.stack.imgur.com/538Ir.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/538Ir.png\" alt=\"ioref.hs\"></a></p>\n\n<p>Thanks for your help!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1503302476, "post_id": 45791969, "comment_id": 78541674, "body": "Well you made a constructor <code>Football :: Players a -&gt; Stadium a -&gt; Football a</code>, and now you made an additional constructor <code>Football :: Sport</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1503303045, "post_id": 45791969, "comment_id": 78541956, "body": "Also note that record field names must be lowercase: <code>Stadium</code> can&#39;t be a field."}, {"owner": {"reputation": 157, "user_id": 7631220, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/42ac4a8aebbc6491db718dbd189c78ba?s=128&d=identicon&r=PG&f=1", "display_name": "Babas", "link": "https://stackoverflow.com/users/7631220/babas"}, "edited": false, "score": 0, "creation_date": 1503303125, "post_id": 45791969, "comment_id": 78542003, "body": "I correct my mistake by adding Sport a  = Football a | Tennis a but still the problem continues"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1503337957, "post_id": 45791969, "comment_id": 78563899, "body": "Other potential duplicates: <a href=\"https://stackoverflow.com/q/32551751/625403\">stackoverflow.com/q/32551751/625403</a>, <a href=\"https://stackoverflow.com/q/10242709/625403\">stackoverflow.com/q/10242709/625403</a>, <a href=\"https://stackoverflow.com/q/12543662/625403\">stackoverflow.com/q/12543662/625403</a>"}], "answers": [{"comments": [{"owner": {"reputation": 157, "user_id": 7631220, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/42ac4a8aebbc6491db718dbd189c78ba?s=128&d=identicon&r=PG&f=1", "display_name": "Babas", "link": "https://stackoverflow.com/users/7631220/babas"}, "edited": false, "score": 0, "creation_date": 1503305281, "post_id": 45792102, "comment_id": 78543204, "body": "Thank you my friend! Beautiful answer :)"}], "tags": [], "owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "is_accepted": true, "score": 10, "last_activity_date": 1503303627, "last_edit_date": 1503303627, "creation_date": 1503302859, "answer_id": 45792102, "question_id": 45791969, "link": "https://stackoverflow.com/questions/45791969/haskell-multiple-declaration-of-datatype/45792102#45792102", "title": "Haskell: Multiple declaration of datatype", "body": "<p>Your idea is correct in spirit but Haskell uses tagged unions (also called \"discriminated unions\", \"disjoint unions\",  \"variants\", and \"sum types\"). This means you need an additional tag to determine if Sport is constructed with Football or if it is constructed with Tennis.</p>\n\n<pre><code>data Sport = SportFootball Football | SportTennis Tennis\n</code></pre>\n\n<p>These tags are known in Haskell as <em>data constructors</em>. That is, this defines a constructor <code>SportFootball :: Football -&gt; Sport</code> and a constructor <code>SportTennis :: Tennis -&gt; Sport</code>.</p>\n\n<p>Suppose Haskell did not require this extra tag, then what would be this type?</p>\n\n<pre><code>data UntaggedInt = Int | Int\n</code></pre>\n\n<p>An untagged union should have the property <code>(x | x) = x</code> and so this must be equivalent to:</p>\n\n<pre><code>data UntaggedInt = Int\n</code></pre>\n\n<p>Whereas with tagged unions we can define:</p>\n\n<pre><code>data TaggedInt = This Int | That Int\n</code></pre>\n\n<p>That is, tagged unions are not <em>idempotent</em>.</p>\n\n<p>Also consider something else which happens without constructors. Suppose we have a definition such as:</p>\n\n<pre><code>data UntaggedLists = String | [String]\n</code></pre>\n\n<p>And now we are tasked with finding the type of the expression <code>\"hello world\"</code>. Should the type be <code>String</code> or <code>UntaggedLists</code>? Then suppose we have another similar definition:</p>\n\n<pre><code>data AnotherUntaggedLists = String | [String]\n</code></pre>\n\n<p>Is it true that <code>UntaggedLists</code> and <code>AnotherUntaggedLists</code> are equal types?</p>\n\n<p>These are not unanswerable questions, but it does demonstrate a profound systematic difference between having tags and not.</p>\n"}], "owner": {"reputation": 157, "user_id": 7631220, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/42ac4a8aebbc6491db718dbd189c78ba?s=128&d=identicon&r=PG&f=1", "display_name": "Babas", "link": "https://stackoverflow.com/users/7631220/babas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2193, "favorite_count": 1, "closed_date": 1503395550, "accepted_answer_id": 45792102, "answer_count": 1, "score": 4, "last_activity_date": 1503303627, "creation_date": 1503302381, "last_edit_date": 1503303079, "question_id": 45791969, "link": "https://stackoverflow.com/questions/45791969/haskell-multiple-declaration-of-datatype", "closed_reason": "Duplicate", "title": "Haskell: Multiple declaration of datatype", "body": "<p>I have a little problem while creating data types.</p>\n\n<p>I have two data types, Football and Tennis</p>\n\n<pre><code>data Football a  = Football\n  { players       :: Players a    \n  , Stadium       :: Stadium  a\n  }     \n\ndata Tennis a  = Tennis\n  { players1      :: Players a    \n  , Stadium1      :: Stadium  a\n  }\n</code></pre>\n\n<p>And I want to create an other datatype Sport using as a constructor the datatype football and tennis\n<code>data Sport a =  Football a  | Tennis a</code>\nand I get the following error, multiple declarations of Football I don't understand what I am doing wrong.</p>\n\n<p>Best regards   </p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "is_accepted": true, "score": 3, "last_activity_date": 1503282183, "creation_date": 1503282183, "answer_id": 45788575, "question_id": 45788559, "link": "https://stackoverflow.com/questions/45788559/dynamically-create-list-with-function/45788575#45788575", "title": "Dynamically create list with function", "body": "<p><a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Prelude.html#v:iterate\" rel=\"nofollow noreferrer\"><code>iterate</code></a>:</p>\n\n<pre><code>Prelude&gt; let f x = (x + 2) * 10 in take 5 $ iterate f 1\n[1,30,320,3220,32220]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 2, "last_activity_date": 1503321125, "last_edit_date": 1503321125, "creation_date": 1503282261, "answer_id": 45788581, "question_id": 45788559, "link": "https://stackoverflow.com/questions/45788559/dynamically-create-list-with-function/45788581#45788581", "title": "Dynamically create list with function", "body": "<p>There's <code>iterate</code></p>\n\n<pre><code>iterate :: (a -&gt; a) -&gt; a -&gt; [a] -- Repeat a function forever, making a list of values\n</code></pre>\n\n<p>If you want to start with a list and only operate on its last element:</p>\n\n<pre><code>func f xs = (init xs) ++ (iterate f $ last xs)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1503286396, "post_id": 45788923, "comment_id": 78535722, "body": "How about <code>iterate f (f x)</code> instead of <code>map f (iterate f x)</code>?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1503298247, "post_id": 45788923, "comment_id": 78539368, "body": "@Ryan Yours is a better implementation, and indeed the one that GHC uses."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1503313767, "post_id": 45788923, "comment_id": 78548705, "body": "<code>iterate f x = ys where ys = x : map f ys</code> should be better."}, {"owner": {"reputation": 649, "user_id": 2998746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fc15b842026d8a039ffdd1b2a528aec?s=128&d=identicon&r=PG&f=1", "display_name": "Euge", "link": "https://stackoverflow.com/users/2998746/euge"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1503325803, "post_id": 45788923, "comment_id": 78557222, "body": "@Ryan you are right, it is better implementation-wise, but putting it this way, or even Will&#39;s way it&#39;s more clear that there&#39;s a fix point going around."}], "tags": [], "owner": {"reputation": 649, "user_id": 2998746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fc15b842026d8a039ffdd1b2a528aec?s=128&d=identicon&r=PG&f=1", "display_name": "Euge", "link": "https://stackoverflow.com/users/2998746/euge"}, "is_accepted": false, "score": 0, "last_activity_date": 1503296570, "last_edit_date": 1503296570, "creation_date": 1503286034, "answer_id": 45788923, "question_id": 45788559, "link": "https://stackoverflow.com/questions/45788559/dynamically-create-list-with-function/45788923#45788923", "title": "Dynamically create list with function", "body": "<p>You've already got your answer: you use <code>iterate</code>. Here's how you can code it yourself.</p>\n\n<p><code>iterate</code> takes a function <code>f</code> and a <em>seed</em> <code>x</code>, and repeats function application forever (i.e. returns <code>[x, f x, f (f x), f (f (f x)), ...]</code>)</p>\n\n<pre><code>iterate :: (a -&gt; a) -&gt; a -&gt; [a]\niterate f x = x : map f (iterate f x)\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 6707409, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/576c0ebaaa58d501b9d4bfaabceaa526?s=128&d=identicon&r=PG&f=1", "display_name": "Kyle&#39;s Corpse", "link": "https://stackoverflow.com/users/6707409/kyles-corpse"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 558, "favorite_count": 0, "accepted_answer_id": 45788575, "answer_count": 3, "score": 1, "last_activity_date": 1503321125, "creation_date": 1503282019, "question_id": 45788559, "link": "https://stackoverflow.com/questions/45788559/dynamically-create-list-with-function", "title": "Dynamically create list with function", "body": "<p>My goal is to create an infinite list by applying a function to the last element. For example if I begin with a list that looks like</p>\n\n<pre><code>[1]\n</code></pre>\n\n<p>and apply the function f(x) = (x + 2) * 10, I should end with</p>\n\n<pre><code>[1, 30, 320, 3220, 32220...]\n</code></pre>\n\n<p>How would I code this in Haskell? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503266197, "post_id": 45787086, "comment_id": 78531991, "body": "It&#39;s 11 lines of not-at-all complicated code. How small do you hope to make it? <code>mapM_ f $ map g x</code> can be written <code>mapM_ (f . g) x</code>; you could write <code>getCase</code> in applicative style, but that saves you maybe 10 characters; you don&#39;t need a type signature on the first <code>readLn</code>. (Aside: you <i>do</i> need <code>numbersCount</code> to verify that the user entered well-formed input.)"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 5, "creation_date": 1503266614, "post_id": 45787086, "comment_id": 78532098, "body": "Sure, if you want to throw more safety and readability out of the window: <code>main = readLn &gt;&gt;= (`replicateM_` (getLine &gt;&gt; (print =&lt;&lt; sum . map read . words &lt;$&gt; getLine)))</code>. :)"}, {"owner": {"reputation": 11366, "user_id": 672018, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/02deb8d589e1c74650bc334394529571?s=128&d=identicon&r=PG&f=1", "display_name": "Andrzej Gis", "link": "https://stackoverflow.com/users/672018/andrzej-gis"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1503267244, "post_id": 45787086, "comment_id": 78532230, "body": "@Alec This is exactly what I was looking for :). Of course, it&#39;s just for academic purposes - for me, to find out some interesting language features."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1503269380, "post_id": 45787086, "comment_id": 78532670, "body": "@gisek If you go one step further, you can get rid of almost all parens and turn the while thing into an unreadable blob: <code>main = readLn &gt;&gt;= flip replicateM_ (getLine &gt;&gt; sum . map read . words &lt;$&gt; getLine &gt;&gt;= print)</code>"}, {"owner": {"reputation": 11366, "user_id": 672018, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/02deb8d589e1c74650bc334394529571?s=128&d=identicon&r=PG&f=1", "display_name": "Andrzej Gis", "link": "https://stackoverflow.com/users/672018/andrzej-gis"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1503270105, "post_id": 45787086, "comment_id": 78532808, "body": "@Alec Very nice :) BTW, if you explained every step of this beast, it would actually be an excellent answer."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1503270997, "post_id": 45787086, "comment_id": 78532978, "body": "@Alec You can get rid of the last paren using <code>$</code>, right? <code>... flip replicateM_ $ getLine ...</code>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1503271757, "post_id": 45787086, "comment_id": 78533093, "body": "@amalloy Nope. :)"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1503271817, "post_id": 45787086, "comment_id": 78533101, "body": "Oh, I see. Because then it would be <code>(readLn &gt;&gt;= flip replicateM_ (...))</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1503281551, "post_id": 45787086, "comment_id": 78534884, "body": "If I were you, I&#39;d instead focus on efficiency and good error handling. Handle format errors with <code>IO</code> exceptions or <code>ExceptT</code>. Can you see why your program could run out of memory if fed a tremendous number of lines? How could you fix that?"}, {"owner": {"reputation": 11366, "user_id": 672018, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/02deb8d589e1c74650bc334394529571?s=128&d=identicon&r=PG&f=1", "display_name": "Andrzej Gis", "link": "https://stackoverflow.com/users/672018/andrzej-gis"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1503302392, "post_id": 45787086, "comment_id": 78541631, "body": "@dfeuer I try to focus on every aspect :). I can see it could run out of memory if a line is very long, although I thought I&#39;m handling only one line at the time. Why would many lines use up all the memory?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1503320318, "post_id": 45787086, "comment_id": 78553100, "body": "@gisek, <code>replicateM linesCount getCase</code> will read in the entire file before allowing you to proceed with printing the output lines. You need to interleave reading and writing. erisco&#39;s answer does this by using laziness. Another way is to do it manually in a loop. Another is to use a streaming framework like <code>pipes</code>, <code>conduit</code>, or <code>streaming</code>."}, {"owner": {"reputation": 11366, "user_id": 672018, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/02deb8d589e1c74650bc334394529571?s=128&d=identicon&r=PG&f=1", "display_name": "Andrzej Gis", "link": "https://stackoverflow.com/users/672018/andrzej-gis"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1503323086, "post_id": 45787086, "comment_id": 78555258, "body": "@dfeuer Thanks, I didn&#39;t expect that"}, {"owner": {"reputation": 11366, "user_id": 672018, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/02deb8d589e1c74650bc334394529571?s=128&d=identicon&r=PG&f=1", "display_name": "Andrzej Gis", "link": "https://stackoverflow.com/users/672018/andrzej-gis"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1503533353, "post_id": 45787086, "comment_id": 78660214, "body": "@Alec I added a secondary answer with the breakdown of your code. Would you mind taking a look if I missed anything?"}], "answers": [{"tags": [], "owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "is_accepted": true, "score": 3, "last_activity_date": 1503306860, "last_edit_date": 1503306860, "creation_date": 1503306540, "answer_id": 45793251, "question_id": 45787086, "link": "https://stackoverflow.com/questions/45787086/handling-complicated-input-with-nested-values/45793251#45793251", "title": "Handling complicated input (with nested values)", "body": "<p>If you merely want to make code shorter then check out the <a href=\"https://codegolf.stackexchange.com/\">Stack Exchange community for code golfing</a>. That is primarily for fun and games.</p>\n\n<p>If we are thinking there is too much code it may not be that we need to make it shorter but rather that we need to make it <em>clearer</em>. Achieving this is a matter of experience and good practice. What we want to do is isolate simple concepts which are obviously correct and then combine them in obviously correct ways. Methodologies include top-down design (break the solution into smaller pieces) and bottom-up design (from smaller pieces build up to the solution) and mixes thereof.</p>\n\n<p>A bottom-up piece that hits me straight away is the task of summing a list of numbers. This has a definition in Haskell's Prelude called <code>sum :: (Num a, Foldable t) =&gt; t a -&gt; a</code>. Somewhere in the final solution we are going to use this.</p>\n\n<p>Another method is to simplify the problem. We can be lead astray by the way a problem is phrased. Upon closer inspection we might find an equivalent and simpler phrasing.</p>\n\n<p>What information do we actually need from the input? Just the lists of numbers. What is the simplest way to obtain the lists of numbers? The number of lists seems irrelevant because there is no need to have this information before we start looking at the lists. Drop the first line and we are left with:</p>\n\n<pre><code>5\n1 2 3 4 5\n2\n-100 100\n</code></pre>\n\n<p>Then, the length of each list is also irrelevant because we do not need that information before summing the list. Therefore lets also drop every other line from this point:</p>\n\n<pre><code>1 2 3 4 5\n-100 100\n</code></pre>\n\n<p>Now we just have the lists of numbers separated by line returns where each number is separated by a space.</p>\n\n<p>At this point we have a clear way to break apart the solution in a top-down manner. First we simplify the input. Secondly we parse the lists of numbers. Thirdly we sum the lists. Fourthly we print the sums. This is therefore the skeleton of our solution:</p>\n\n<pre><code>simplifyInput :: String -&gt; [String]\n\nparseNumberList :: String -&gt; [Integer]\n\n-- Note we can use `sum` from Prelude to sum the number lists.\n\nprintSums :: [Integer] -&gt; IO ()\n\nmain :: IO ()\nmain = getContents &gt;&gt;= printSums . fmap (sum . parseNumberList) . simplifyInput\n</code></pre>\n\n<p>Now it is just a matter of implementing each obvious piece of the solution.</p>\n\n<pre><code>simplifyInput :: String -&gt; [String]\nsimplifyInput = dropEveryOther . drop 1 . lines\n  where\n  dropEveryOther :: [a] -&gt; [a]\n</code></pre>\n\n<p>In writing <code>simplifyInput</code> I discovered that dropping every other line requires some more work. That is okay, we can just break the solution apart again.</p>\n\n<pre><code>dropEveryOther :: [a] -&gt; [a]\ndropEveryOther [] = []\ndropEveryOther (x:y:xs) = y : dropEveryOther xs\n</code></pre>\n\n<p>Then continuing...</p>\n\n<pre><code>parseNumberList :: String -&gt; [Integer]\nparseNumberList = fmap read . words\n\nprintSums :: [Integer] -&gt; IO ()\nprintSums = putStr . unlines . fmap show\n</code></pre>\n\n<p>Therefore, in totality:</p>\n\n<pre><code>simplifyInput :: String -&gt; [String]\nsimplifyInput = dropEveryOther . drop 1 . lines\n  where\n  dropEveryOther :: [a] -&gt; [a]\n  dropEveryOther [] = []\n  dropEveryOther (_:y:xs) = y : dropEveryOther xs\n\nparseNumberList :: String -&gt; [Integer]\nparseNumberList = fmap read . words\n\nprintSums :: [Integer] -&gt; IO ()\nprintSums = putStr . unlines . fmap show\n\nmain :: IO ()\nmain = getContents &gt;&gt;= printSums . fmap (sum . parseNumberList) . simplifyInput\n</code></pre>\n\n<p>The amount of code we have has gone up (compared to the first solution) but in exchange the code is made obvious. Now you should add some documentation comments so we do not forget our explanation for the solution.</p>\n"}, {"comments": [{"owner": {"reputation": 11366, "user_id": 672018, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/02deb8d589e1c74650bc334394529571?s=128&d=identicon&r=PG&f=1", "display_name": "Andrzej Gis", "link": "https://stackoverflow.com/users/672018/andrzej-gis"}, "edited": false, "score": 0, "creation_date": 1503533595, "post_id": 45850991, "comment_id": 78660261, "body": "I&#39;m not really sure if some of the &#39;functions&#39;  <code>handleBatch</code>  e.g. are really functions as they take no parameters. On the other hand, they perform multiple actions with different results, depending on the IO."}], "tags": [], "owner": {"reputation": 11366, "user_id": 672018, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/02deb8d589e1c74650bc334394529571?s=128&d=identicon&r=PG&f=1", "display_name": "Andrzej Gis", "link": "https://stackoverflow.com/users/672018/andrzej-gis"}, "is_accepted": false, "score": 2, "last_activity_date": 1503533201, "creation_date": 1503533201, "answer_id": 45850991, "question_id": 45787086, "link": "https://stackoverflow.com/questions/45787086/handling-complicated-input-with-nested-values/45850991#45850991", "title": "Handling complicated input (with nested values)", "body": "<p>Alec posted a super compressed version of my original code in one of the comments. I decided to post a small breakdown, in case someone gets lost and has no idea what's going on in there :)</p>\n\n<p>Snippets below need to be preceded with valid imports:</p>\n\n<pre><code>import Control.Monad\nimport Control.Applicative\n</code></pre>\n\n<p>So we start with Alec's version:</p>\n\n<pre><code>main = readLn &gt;&gt;= flip replicateM_ (getLine &gt;&gt; sum . map read . words &lt;$&gt; getLine &gt;&gt;= print)\n</code></pre>\n\n<p>He used the <code>flip</code> function in order to remove one set of parenthesis:</p>\n\n<pre><code>main = readLn &gt;&gt;= (`replicateM_` (getLine &gt;&gt; (print =&lt;&lt; sum . map read . words &lt;$&gt; getLine)))\n</code></pre>\n\n<p>He used the infix notation for <code>replicateM_</code> in order to partially apply the second parameter of <code>replicateM_</code>, we can replace is with a lambda:</p>\n\n<pre><code>main = readLn &gt;&gt;= \\n -&gt; replicateM_ n (getLine &gt;&gt; (print =&lt;&lt; sum . map read . words &lt;$&gt; getLine))\n</code></pre>\n\n<p>Now let's start extracting some pieces of code into separate meaningful functions:</p>\n\n<pre><code>printBatchResult = print =&lt;&lt; sum . map read . words &lt;$&gt; getLine\nmain = readLn &gt;&gt;= \\n -&gt; replicateM_ n (getLine &gt;&gt; printBatchResult)\n</code></pre>\n\n<p>We can flip the <code>print =&lt;&lt;</code> for more readability:</p>\n\n<pre><code>printBatchResult = sum . map read . words &lt;$&gt; getLine &gt;&gt;= print\nmain = readLn &gt;&gt;= \\n -&gt; replicateM_ n (getLine &gt;&gt; printBatchResult)\n</code></pre>\n\n<p>And so on:</p>\n\n<pre><code>printBatchResult = sum . map read . words &lt;$&gt; getLine &gt;&gt;= print\nhandleBatch = getLine &gt;&gt; printBatchResult\nmain = readLn &gt;&gt;= \\n -&gt; replicateM_ n handleBatch\n</code></pre>\n\n<p>And again:</p>\n\n<pre><code>sumLine = sum . map read . words\nprintBatchResult = sumLine &lt;$&gt; getLine &gt;&gt;= print\nhandleBatch = getLine &gt;&gt; printBatchResult\nmain = readLn &gt;&gt;= \\n -&gt; replicateM_ n handleBatch\n</code></pre>\n\n<p>And one more time:</p>\n\n<pre><code>sumLine = sum . map read . words\nhandleNumbersLine = sumLine &lt;$&gt; getLine\nprintBatchResult = handleNumbersLine &gt;&gt;= print\nhandleBatch = getLine &gt;&gt; printBatchResult\nmain = readLn &gt;&gt;= (\\n -&gt; replicateM_ n handleBatch)\n</code></pre>\n\n<p>And finally the last time:</p>\n\n<pre><code>sumLine = sum . map read . words\nhandleNumbersLine = sumLine &lt;$&gt; getLine\nprintBatchResult = handleNumbersLine &gt;&gt;= print\nhandleBatch = getLine &gt;&gt; printBatchResult\nhandleAllBatches n = replicateM_ n handleBatch\nmain = readLn &gt;&gt;= handleAllBatches\n</code></pre>\n\n<p>We can replace <code>&lt;$&gt;</code> with <code>fmap</code>:</p>\n\n<pre><code>sumLine = sum . map read . words\nhandleNumbersLine = fmap sumLine getLine\nprintBatchResult = handleNumbersLine &gt;&gt;= print\nhandleBatch = getLine &gt;&gt; printBatchResult\nhandleAllBatches n = replicateM_ n handleBatch\nmain = readLn &gt;&gt;= handleAllBatches\n</code></pre>\n\n<p>We can also remove every partial application:</p>\n\n<pre><code>sumLine line = (sum . map read . words) line\nhandleNumbersLine = fmap sumLine getLine\nprintBatchResult = handleNumbersLine &gt;&gt;= \\sum -&gt; print sum\nhandleBatch = getLine &gt;&gt; printBatchResult\nhandleAllBatches n = replicateM_ n handleBatch\nmain = readLn &gt;&gt;= \\numberOfBatches -&gt; handleAllBatches numberOfBatches\n</code></pre>\n\n<p>And finally, add signatures:</p>\n\n<pre><code>sumLine :: String -&gt; Int\nsumLine line = (sum . map read . words) line\n\nhandleNumbersLine :: IO Int\nhandleNumbersLine = fmap sumLine getLine\n\nprintBatchResult :: IO ()\nprintBatchResult = handleNumbersLine &gt;&gt;= \\sum -&gt; print sum\n\nhandleBatch :: IO ()\nhandleBatch = getLine &gt;&gt; printBatchResult\n\nhandleAllBatches :: Int -&gt; IO ()\nhandleAllBatches n = replicateM_ n handleBatch\n\nmain = readLn &gt;&gt;= \\numberOfBatches -&gt; handleAllBatches numberOfBatches\n</code></pre>\n\n<p>Some final comments:</p>\n\n<ul>\n<li><code>&gt;&gt;=</code> - the <code>bind</code> function from monad converts one monad to another (or the same) and transforms its value. In <code>main</code> function it takes <code>IO Int</code>, transformation lambda and returns <code>IO ()</code> - the result of the transformation, which is empty and prints result in the process.</li>\n<li><code>&gt;&gt;</code> - (used in <code>handleBatch</code>) ignores the left parameter (how many numbers there are in a line is (arguably) unnecessary) and just returns the right parameter - which is a function handling a line with numbers.</li>\n</ul>\n"}], "owner": {"reputation": 11366, "user_id": 672018, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/02deb8d589e1c74650bc334394529571?s=128&d=identicon&r=PG&f=1", "display_name": "Andrzej Gis", "link": "https://stackoverflow.com/users/672018/andrzej-gis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 45793251, "answer_count": 2, "score": 0, "last_activity_date": 1503533201, "creation_date": 1503265740, "question_id": 45787086, "link": "https://stackoverflow.com/questions/45787086/handling-complicated-input-with-nested-values", "title": "Handling complicated input (with nested values)", "body": "<p>There is the following task:</p>\n\n<ol>\n<li>First line is the number of cases</li>\n<li>For each case there is a line with the number of numbers to add</li>\n<li>For each case there is also a line with the numbers</li>\n<li>For each case I have to print summed numbers</li>\n</ol>\n\n<p>Example:</p>\n\n<pre><code>Input:\n2\n5\n1 2 3 4 5\n2\n-100 100\n\nOutput:\n15\n0\n</code></pre>\n\n<p>This is my implementation</p>\n\n<pre><code>import Control.Monad\n\nmain = do \n    linesCount &lt;- readLn :: IO Int\n    numbers &lt;- replicateM linesCount getCase\n    mapM_ putStrLn $ map (show.sum) numbers\n\ngetCase :: IO [Int]\ngetCase = do\n    numbersCount &lt;- readLn :: IO Int -- actually I don't need this variable\n    numbersString &lt;- getLine\n    let numbers = map read $ words numbersString\n    return numbers\n</code></pre>\n\n<p>It looks like a lot of code for parsing input. Are there any tricks to \"compress\" it? :)</p>\n"}, {"tags": ["haskell", "io", "lazy-evaluation", "processing-efficiency"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1503268234, "post_id": 45787011, "comment_id": 78532456, "body": "I think the library <code>getLine</code> and your <code>getLine&#39;</code> are both equally strict. IO actions can not return lazily unless by leveraging some <code>unsafe</code> function -- this is referred to as &quot;lazy IO&quot; and must handled with some care, since the actual reading will start later due to laziness, which might cause some issues. Lazy IO is (in)famously hard to debug. You could however use a strict custom <code>get3Ints</code> which only reads the part of the string you need."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 3, "creation_date": 1503271373, "post_id": 45787011, "comment_id": 78533037, "body": "<code>getLine</code> must be strict in order to be correct, and as chi says your <code>getLine&#39;</code> behaves exactly the same. If <code>getLine</code> were non-strict, then pure computations you do later would cause IO, by realizing more characters from the lazy input. This would be a nightmare when you consider that other IO can also be going on, also reading from stdin: which characters go where will be extremely hard to figure out."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 1, "creation_date": 1503325142, "post_id": 45787011, "comment_id": 78556692, "body": "Cf. <a href=\"https://codereview.stackexchange.com/a/120037/16551\">this answer</a> to see a bit more about <code>IO</code> and laziness. If you want a lazy <code>getLine</code>, it&#39;ll probably need to have a type similar to <code>IO (ListT IO Char)</code> where <code>data ListT m a = Nil | Cons a (m (ListT m a))</code> (You could also have <code>ListT IO String</code> instead of <code>ListT IO Char</code> if you read the input in chunks of a given length to be more efficient)."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1503386714, "post_id": 45787011, "comment_id": 78580113, "body": "what in the world is the down-vote for?"}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 1, "last_activity_date": 1504393901, "creation_date": 1504393901, "answer_id": 46018990, "question_id": 45787011, "link": "https://stackoverflow.com/questions/45787011/is-getline-lazy/46018990#46018990", "title": "Is getLine lazy?", "body": "<p>While <code>getLine</code> isn't lazy, <code>getContents</code> is, and it can be combined with functions like <code>lines</code> and <code>words</code>.  Therefore, the following program will only read enough of stdin to get (up to) three integers from the first line and print their sum:</p>\n\n<pre><code>main :: IO ()\nmain = do contents &lt;- getContents\n          let lns = lines contents\n              result = sum $ map read $ take 3 $ words $ head lns\n          print (result :: Integer)\n</code></pre>\n\n<p>Note that, if you modify the program to access subsequent lines -- for example, if you added:</p>\n\n<pre><code>putStrLn $ take 80 $ lns !! 1\n</code></pre>\n\n<p>to the bottom of the program to print the first 80 characters of the second line, then the program would have to finish reading the first line (and so would hang for a bit between the last two lines of the program) before processing the first 80 characters of the second.  In other words, this lazy line reading is only useful if you <em>only</em> need to read the first bit of the first line, if that wasn't obvious to you -- Haskell doesn't have any magic way to skip the rest of the first line to get to the second.</p>\n\n<p>Finally, note that, for the above program, if there are fewer than three integers on the first line, it'll just sum those numbers and won't try to read past the first line (which I think is what you wanted).  If you don't actually care about the line endings and just want to sum the first three numbers in the file, regardless of how they're divided up into lines, then you can break the contents up directly into words like so:</p>\n\n<pre><code>main = do contents &lt;- getContents\n          let result = sum $ map read $ take 3 $ words contents\n          print (result :: Integer)\n</code></pre>\n"}], "owner": {"reputation": 11366, "user_id": 672018, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/02deb8d589e1c74650bc334394529571?s=128&d=identicon&r=PG&f=1", "display_name": "Andrzej Gis", "link": "https://stackoverflow.com/users/672018/andrzej-gis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 410, "favorite_count": 0, "accepted_answer_id": 46018990, "answer_count": 1, "score": 3, "last_activity_date": 1504393901, "creation_date": 1503264990, "last_edit_date": 1503386692, "question_id": 45787011, "link": "https://stackoverflow.com/questions/45787011/is-getline-lazy", "title": "Is getLine lazy?", "body": "<p>Is <code>getLine</code> lazy?</p>\n\n<p>Say I have a very long line on the input. It's just a sequence of numbers. I only need to sum 3 first numbers. Will <code>getLine</code> be efficient and read only the first part of the line, or do I have to create my own function for lazy line reading, that would read characters one by one?</p>\n\n<p>Will my implementation be efficient if I were to sum the whole line? (Will there be an overhead due to reading characters one by one?)</p>\n\n<pre><code>import Control.Applicative\n\nmain = do\n    line &lt;- getLine'\n    print $ sum $ map read $ take 3 $ words line\n\ngetLine' :: IO String\ngetLine' = do\n    c &lt;- getChar\n    if c == '\\n' then return [] else (c:) &lt;$&gt; getLine'\n</code></pre>\n"}, {"tags": ["haskell", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1503265028, "post_id": 45786924, "comment_id": 78531702, "body": "I think you are looking for <a href=\"https://hackage.haskell.org/package/transformers-0.5.4.0/docs/Control-Monad-Trans-Except.html#v:mapExceptT\" rel=\"nofollow noreferrer\"><code>mapExceptT</code></a>, but your concrete example is difficult to follow."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1503292255, "post_id": 45786924, "comment_id": 78536963, "body": "See also point (2) at <a href=\"https://stackoverflow.com/a/27206159/791604\">Lift to fix the inside of a monad transformer stack</a>. Perhaps this question is a duplicate of that one."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 5, "last_activity_date": 1503265093, "creation_date": 1503265093, "answer_id": 45787019, "question_id": 45786924, "link": "https://stackoverflow.com/questions/45786924/add-a-monad-to-the-middle-of-a-transformer-stack/45787019#45787019", "title": "Add a monad to the middle of a transformer stack", "body": "<p>Ignoring the <code>ExceptT</code> newtypes, you have</p>\n\n<pre><code>IO (Either Error Foo)\n</code></pre>\n\n<p>And you want</p>\n\n<pre><code>StateT Bar IO (Either Error Foo)\n</code></pre>\n\n<p>(I don't see what you want with <code>Baz</code>, so I'm ignoring it.)</p>\n\n<p>That is just <code>lift</code>. So I believe you should be able to use</p>\n\n<pre><code>ExceptT . lift . runExceptT\n</code></pre>\n\n<p>As <a href=\"https://stackoverflow.com/questions/45786924/add-a-monad-to-the-middle-of-a-transformer-stack/45787019#comment78531702_45786924\">Alec noted</a>, this can be written using <a href=\"https://hackage.haskell.org/package/transformers-0.5.4.0/docs/Control-Monad-Trans-Except.html#v:mapExceptT\" rel=\"noreferrer\"><code>mapExceptT</code></a>:</p>\n\n<pre><code>mapExceptT lift\n</code></pre>\n"}], "owner": {"reputation": 813, "user_id": 1333945, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/5ba8a397763592097387117373dbb13a?s=128&d=identicon&r=PG", "display_name": "Nathan Ringo", "link": "https://stackoverflow.com/users/1333945/nathan-ringo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 45787019, "answer_count": 1, "score": 2, "last_activity_date": 1503265093, "creation_date": 1503264210, "question_id": 45786924, "link": "https://stackoverflow.com/questions/45786924/add-a-monad-to-the-middle-of-a-transformer-stack", "title": "Add a monad to the middle of a transformer stack", "body": "<p>I'm trying to \"semilift\" an <code>(ExceptT Error IO Foo)</code> to an <code>(ExceptT Error (StateT Bar IO) Baz)</code>.</p>\n\n<p>I've tried <code>lift</code>, <code>fmap lift</code>, and <code>fmap return</code>, and none work; is there a standard idiom here?</p>\n\n<pre><code>&gt; import Control.Monad.Except\n&gt; import Control.Monad.State\n&gt; data Error\n&gt; data Foo\n&gt; data Bar\n&gt; data Baz\n&gt; x = undefined :: ExceptT Error IO Foo\n&gt; y = undefined :: (ExceptT Error (StateT Bar IO) Baz) -&gt; a\n\n&gt; f = ??? -- This is what I'm trying to find.\n\n&gt; :t y (f x)\ny (f x) :: a\n</code></pre>\n"}, {"tags": ["haskell", "cabal", "hackage"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1503253967, "post_id": 45785553, "comment_id": 78528716, "body": "Do you mean, the <code>yourproject.cabal</code> file (you must have that in order for cabal to do anything at all with your project!) or the <code>yourpackage-0.1.0.0.tar.gz</code> tarball that can be uploaded to Hackage?"}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1503254600, "post_id": 45785553, "comment_id": 78528923, "body": "The <code>yourpackage-0.1.0.0.tar.gz</code> tarball."}, {"owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "edited": false, "score": 2, "creation_date": 1503254622, "post_id": 45785553, "comment_id": 78528930, "body": "Sounds like you are looking for <code>cabal sdist</code>? Seems as if <code>setup</code> in the documentation is overloaded and refers to either <code>cabal</code> or <code>runhaskell .&#47;Setup.hs</code> <a href=\"https://www.haskell.org/cabal/users-guide/installing-packages.html#building-and-installing-packages\" rel=\"nofollow noreferrer\">haskell.org/cabal/users-guide/&hellip;</a>"}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1531754054, "post_id": 45785553, "comment_id": 89702375, "body": "Here is a useful guide: <a href=\"https://functor.tokyo/blog/2018-07-16-release-haskell-packages-to-hackage\" rel=\"nofollow noreferrer\">functor.tokyo/blog/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": true, "score": 2, "last_activity_date": 1531591156, "last_edit_date": 1531591156, "creation_date": 1503257187, "answer_id": 45786025, "question_id": 45785553, "link": "https://stackoverflow.com/questions/45785553/how-to-create-a-package-to-upload-to-hackage/45786025#45786025", "title": "How to create a package to upload to Hackage?", "body": "<p>To generate the package:</p>\n\n<ul>\n<li><p>With cabal: <code>cabal sdist</code></p></li>\n<li><p>With stack: <code>stack sdist</code></p></li>\n</ul>\n\n<p>Thanks to @ppb</p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 347, "favorite_count": 0, "accepted_answer_id": 45786025, "answer_count": 1, "score": 1, "last_activity_date": 1531591156, "creation_date": 1503253816, "question_id": 45785553, "link": "https://stackoverflow.com/questions/45785553/how-to-create-a-package-to-upload-to-hackage", "title": "How to create a package to upload to Hackage?", "body": "<p>How do I generate the appropriate package file? </p>\n\n<p>The hackage upload page has a link to: <a href=\"https://www.haskell.org/cabal/users-guide/installing-packages.html#setup-sdist\" rel=\"nofollow noreferrer\">https://www.haskell.org/cabal/users-guide/installing-packages.html#setup-sdist</a> but after reading that I'm still unsure.</p>\n\n<p>I've tried:</p>\n\n<pre><code>cabal setup sdist\ncabal: unrecognised command: setup (try --help)\n</code></pre>\n\n<p>As well as:</p>\n\n<pre><code>setup sdist\nzsh: command not found: setup\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1503268616, "post_id": 45785461, "comment_id": 78532535, "body": "I think you are aware that the last definition fills the array with non-terminating computations, but I wanted to point that out just in case."}, {"owner": {"reputation": 438, "user_id": 6371869, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mUzus.jpg?s=128&g=1", "display_name": "Shadasviar", "link": "https://stackoverflow.com/users/6371869/shadasviar"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1503336044, "post_id": 45785461, "comment_id": 78563080, "body": "@chi, This is only minimal senseless example of the problem, thanks"}], "answers": [{"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 5, "last_activity_date": 1503253399, "creation_date": 1503253399, "answer_id": 45785484, "question_id": 45785461, "link": "https://stackoverflow.com/questions/45785461/cannot-construct-the-infinite-type-e-e/45785484#45785484", "title": "cannot construct the infinite type: e ~ [e]", "body": "<p>In a list comprehension, the right side of <code>&lt;-</code> is a <em>list</em> to take elements from.  But you can use <code>let</code> expressions:</p>\n\n<pre><code>[ ... | ..., let x = a ! (i,j) ]\n</code></pre>\n"}], "owner": {"reputation": 438, "user_id": 6371869, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mUzus.jpg?s=128&g=1", "display_name": "Shadasviar", "link": "https://stackoverflow.com/users/6371869/shadasviar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 45785484, "answer_count": 1, "score": 0, "last_activity_date": 1503253399, "creation_date": 1503253247, "question_id": 45785461, "link": "https://stackoverflow.com/questions/45785461/cannot-construct-the-infinite-type-e-e", "title": "cannot construct the infinite type: e ~ [e]", "body": "<p>Why this code:</p>\n\n<pre><code>a=array ((0,0),(5,5)) [((i,j),x) | i &lt;- [0..5], j &lt;- [0..5], x &lt;- a!(i,j)]\n</code></pre>\n\n<p>cause error <code>cannot construct the infinite type: e ~ [e]</code>,\nbut if rewrite it like this: </p>\n\n<pre><code>a=array ((0,0),(5,5)) [((i,j),a!(i,j)) | i &lt;- [0..5], j &lt;- [0..5]]\n</code></pre>\n\n<p>it works fine?</p>\n"}, {"tags": ["arrays", "haskell", "websocket", "ghc", "bytestring"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 1, "creation_date": 1503248986, "post_id": 45784663, "comment_id": 78527040, "body": "Can you give an idea of what kind of performance your current solution has on what size of array?"}, {"owner": {"reputation": 153, "user_id": 8044523, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56a725d3fe22777d96c9cfd82d95d57b?s=128&d=identicon&r=PG&f=1", "display_name": "felixgb", "link": "https://stackoverflow.com/users/8044523/felixgb"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1503250055, "post_id": 45784663, "comment_id": 78527361, "body": "Edited the question to provide a bit more information. Looking at the <code>.prof</code> file I can&#39;t see more information than the %time."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1503250063, "post_id": 45784663, "comment_id": 78527365, "body": "<code>IOUArray</code> is implemented as a <a href=\"https://hackage.haskell.org/package/array-0.5.2.0/docs/src/Data.Array.Base.html#STUArray\" rel=\"nofollow noreferrer\"><code>MutableByteArray#</code></a>. <code>ByteString</code> is implemented as a <a href=\"https://hackage.haskell.org/package/bytestring-0.10.8.2/docs/src/Data.ByteString.Internal.html#ByteString\" rel=\"nofollow noreferrer\"><code>ForeignPtr</code></a>. You can copy the former to the latter using <a href=\"https://hackage.haskell.org/package/ghc-prim-0.4.0.0/docs/GHC-Prim.html#v:copyMutableByteArrayToAddr-35-\" rel=\"nofollow noreferrer\">this</a> function. This copy is the almost certainly the fastest way to do this."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503250316, "post_id": 45784663, "comment_id": 78527441, "body": "@user2407038 Is there no possibility that GHC will move around the byte array? In any case, it makes sense to start by freezing the <code>IOUArray Word8</code> into a <code>IO (UArray Word8)</code> before doing this stuff..."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1503251049, "post_id": 45784663, "comment_id": 78527680, "body": "@Alec It certainly might, but I don&#39;t see why that would be an issue. My guess is that a byte array wouldn&#39;t be moved during a copy operation anyways, but even if it were possible, I imagine that copy would be designed to deal with that. I also don&#39;t see how freezing would affect this, since <code>UArray</code> is just <code>ByteArray#</code> and those can be moved as well."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503251876, "post_id": 45784663, "comment_id": 78528004, "body": "@user2407038 Apologies! I misread your comment; I hadn&#39;t realized you were proposing a full copy of the data. Ideally, one should be able to do this with only some unsafe pointer hacks (and no copying)...."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1503252617, "post_id": 45784663, "comment_id": 78528225, "body": "@Alec Indeed, that would be ideal, but I don&#39;t think it&#39;s possible. The problem being, like you&#39;ve said, is that arrays can be moved. (However, the inverse - i.e. <code>ByteString -&gt; ForeignPtr Word8</code> <a href=\"https://stackoverflow.com/questions/4908880/is-there-any-hope-to-cast-foreignptr-to-bytearray-for-a-function-bytestring\">is possible</a>). I&#39;m fairly sure (after a cursory glance at the source code) that <code>IOUArray</code> are not pinned arrays, and I&#39;m also fairly sure that an unpinned array can&#39;t be converted to a pinned one (without a copy, which of course brings us back to the original problem)."}, {"owner": {"reputation": 153, "user_id": 8044523, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56a725d3fe22777d96c9cfd82d95d57b?s=128&d=identicon&r=PG&f=1", "display_name": "felixgb", "link": "https://stackoverflow.com/users/8044523/felixgb"}, "edited": false, "score": 0, "creation_date": 1503255661, "post_id": 45784663, "comment_id": 78529240, "body": "Looking at <code>copyMutableByteArrayToAddr#</code>... Any idea what the two <code>#Int</code> parameters are?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1503260143, "post_id": 45784663, "comment_id": 78530376, "body": "@felixgb The first <code>Int#</code> is the offset in the source <code>MutableByteArray#</code> and the second is the number of bytes to copy. This is just an educated guess based on the more descriptive docs of <a href=\"https://hackage.haskell.org/package/ghc-prim-0.5.1.0/docs/GHC-Prim.html#v:copyMutableArray-35-\" rel=\"nofollow noreferrer\"><code>copyMutableArray#</code></a>."}], "answers": [{"tags": [], "owner": {"reputation": 153, "user_id": 8044523, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56a725d3fe22777d96c9cfd82d95d57b?s=128&d=identicon&r=PG&f=1", "display_name": "felixgb", "link": "https://stackoverflow.com/users/8044523/felixgb"}, "is_accepted": false, "score": 1, "last_activity_date": 1503260559, "last_edit_date": 1503260559, "creation_date": 1503259242, "answer_id": 45786303, "question_id": 45784663, "link": "https://stackoverflow.com/questions/45784663/iouarray-to-bytesring-as-quickly-as-possible/45786303#45786303", "title": "IOUArray to ByteSring, as quickly as possible", "body": "<p>Ok, thanks to user2407038 I have <em>something</em> (Note that I have never played with primitives or unboxed types before):</p>\n\n<pre><code>import Control.Monad.ST\nimport qualified Data.ByteString as BS\nimport Data.Word\nimport Data.Array.ST\nimport Data.Array.Base\nimport Data.ByteString.Internal\nimport GHC.Prim\nimport GHC.Exts\nimport GHC.ForeignPtr\n\nbs2Addr# :: BS.ByteString -&gt; Addr#\nbs2Addr# (PS fptr offset len) = case fptr of\n  (ForeignPtr addr _ ) -&gt; addr\n\narrayPrim (STUArray _ _ _ x) = x\n\nunbox :: Int -&gt; Int#\nunbox (I# n#) = n#\n\ncopy :: Int -&gt; IO BS.ByteString\ncopy len = do\n  -- Get the length as unboxed\n  let len# = unbox len\n\n  -- Bytestring to copy to, filled with 0s initially\n  let bs = BS.pack (replicate len 0)\n\n  -- Create a new STUArray. I don't know why it needs to be length * 2.\n  arr &lt;- stToIO (newArray (0, len * 2) 255 :: ST s (STUArray s Int Word8))\n\n  -- MutableByteArray#\n  let mArrPrim = arrayPrim arr\n\n  -- Addr#\n  let addr = bs2Addr# bs\n\n  -- I don't know what the 2nd and 4th Int# arguments are suppose to be.\n  let _ = copyMutableByteArrayToAddr# mArrPrim len# addr len# realWorld#\n  return bs\n</code></pre>\n\n<p>I am using <code>STUArray</code> here instead of <code>IOUArray</code> now because I couldn't find the <code>IOUArray</code> constructor.</p>\n\n<p>Results of profiling this code with 4000000 element array:</p>\n\n<pre><code>    Sun Aug 20 20:49 2017 Time and Allocation Profiling Report  (Final)\n\n       shoot-exe +RTS -N -p -RTS\n\n    total time  =        0.05 secs   (47 ticks @ 1000 us, 1 processor)\n    total alloc = 204,067,640 bytes  (excludes profiling overheads)\n\nCOST CENTRE MODULE SRC                        %time %alloc\n\ncopy.bs     Lib    src/Lib.hs:32:7-36          66.0   96.0\ncopy        Lib    src/Lib.hs:(27,1)-(45,11)   34.0    3.9\n</code></pre>\n\n<p>This is the code that I compared it against:</p>\n\n<pre><code>arrayToBS :: (STUArray s Int Word8) -&gt; ST s (BS.ByteString)\narrayToBS = (fmap BS.pack) . getElems\n\nslowCopy :: Int -&gt; IO BS.ByteString\nslowCopy len = do\n  arr &lt;- stToIO (newArray (0, len - 1) 255 :: ST s (STUArray s Int Word8))\n  stToIO $ arrayToBS arr\n</code></pre>\n\n<p>And its profiling report:</p>\n\n<pre><code>    Sun Aug 20 20:48 2017 Time and Allocation Profiling Report  (Final)\n\n       shoot-exe +RTS -N -p -RTS\n\n    total time  =        0.55 secs   (548 ticks @ 1000 us, 1 processor)\n    total alloc = 1,604,073,872 bytes  (excludes profiling overheads)\n\nCOST CENTRE MODULE SRC                        %time %alloc\n\narrayToBS   Lib    src/Lib.hs:48:1-37          98.2   99.7\nslowCopy    Lib    src/Lib.hs:(51,1)-(53,24)    1.6    0.2\n</code></pre>\n\n<p>OK, new version is faster. They both produce the same output. However, I would still like to know what the <code>#Int</code> parameters to <code>copyMutableByteArrayToAddr#</code> and why I have to multiply the length of the array in the fast version by 2. I'll play around a bit more and update this answer if I find out.</p>\n\n<h1>Update: Alec's answer</h1>\n\n<p>For those curious, this is the result of profiling Alec's answer:</p>\n\n<pre><code>    Sun Aug 20 21:13 2017 Time and Allocation Profiling Report  (Final)\n\n       shoot-exe +RTS -N -p -RTS\n\n    total time  =        0.01 secs   (7 ticks @ 1000 us, 1 processor)\n    total alloc =   8,067,696 bytes  (excludes profiling overheads)\n\nCOST CENTRE   MODULE SRC                          %time %alloc\n\nnewBuffer     Other  src/Other.hs:23:1-33          85.7   49.6\narrayToBS.\\.\\ Other  src/Other.hs:19:5-69          14.3    0.0\narrayToBS     Other  src/Other.hs:(16,1)-(20,21)    0.0   49.6\n</code></pre>\n\n<p>Looks like that's the one to use.</p>\n"}, {"comments": [{"owner": {"reputation": 153, "user_id": 8044523, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56a725d3fe22777d96c9cfd82d95d57b?s=128&d=identicon&r=PG&f=1", "display_name": "felixgb", "link": "https://stackoverflow.com/users/8044523/felixgb"}, "edited": false, "score": 0, "creation_date": 1503260144, "post_id": 45786336, "comment_id": 78530377, "body": "Awesome. Thank you. This is also much faster than the method that I answered with."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 153, "user_id": 8044523, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56a725d3fe22777d96c9cfd82d95d57b?s=128&d=identicon&r=PG&f=1", "display_name": "felixgb", "link": "https://stackoverflow.com/users/8044523/felixgb"}, "edited": false, "score": 0, "creation_date": 1503260254, "post_id": 45786336, "comment_id": 78530407, "body": "@felixgb I&#39;m not surprised, but I am curious: by how much? Also, note that you probably shouldn&#39;t throw around <code>realWorld#</code> since it often means part of your computation can be inadvertently optimized away by the compiler!"}, {"owner": {"reputation": 153, "user_id": 8044523, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56a725d3fe22777d96c9cfd82d95d57b?s=128&d=identicon&r=PG&f=1", "display_name": "felixgb", "link": "https://stackoverflow.com/users/8044523/felixgb"}, "edited": false, "score": 0, "creation_date": 1503260679, "post_id": 45786336, "comment_id": 78530537, "body": "Results are at the bottom of my answer. To be honest, I don&#39;t really know what <code>realWorld#</code> is-- I&#39;m not an experienced Haskeller and totally unaware of the internals!"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 2, "last_activity_date": 1556026993, "last_edit_date": 1556026993, "creation_date": 1503259654, "answer_id": 45786336, "question_id": 45784663, "link": "https://stackoverflow.com/questions/45784663/iouarray-to-bytesring-as-quickly-as-possible/45786336#45786336", "title": "IOUArray to ByteSring, as quickly as possible", "body": "<p><strong>Disclaimer</strong>: I'm not very familiar with these low level primitives so this might be unsafe in some cases.</p>\n\n<hr>\n\n<p>You will at the very least need to copy the data over once since, as @user2407038 remarks, the underlying data stored in an <code>IOUArray</code> is an unpinned array, so we can't count on GHC not moving the array around. The reverse direction (<code>ByteString</code> to <code>IOArray</code>) is however possible without a copy. </p>\n\n<pre><code>{-# LANGUAGE UnboxedTuples, MagicHash #-}\n\nimport Data.ByteString.Internal (ByteString(..))\nimport Data.Array.IO.Internals  (IOUArray(..))\nimport Data.Array.Base          (STUArray(..))\nimport Data.Word                (Word8)\n\nimport Foreign.ForeignPtr (mallocForeignPtrBytes, withForeignPtr)\nimport GHC.IO             (IO(..))\nimport GHC.Exts           (copyMutableByteArrayToAddr#, Ptr(..), Int(..))\n\narrayToBS :: IOUArray Int Word8 -&gt; IO ByteString\narrayToBS (IOUArray (STUArray _ _ n@(I# n') mutByteArr)) = do\n  bytes &lt;- mallocForeignPtrBytes n\n  withForeignPtr bytes $ \\(Ptr addr) -&gt; IO $ \\state -&gt;\n    (# copyMutableByteArrayToAddr# mutByteArr 0# addr n' state, () #)\n  pure (PS bytes 0 n)\n</code></pre>\n\n<p>Here is a test of this working (remember that the ascii code for <code>'A'</code> is <code>65</code>):</p>\n\n<pre><code>ghci&gt; iou &lt;- newListArray (-2,9) [65,67..] :: IO (IOUArray Int Word8)\nghci&gt; arrayToBS iou\n\"ACEGIKMOQSUW\"\n</code></pre>\n"}], "owner": {"reputation": 153, "user_id": 8044523, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56a725d3fe22777d96c9cfd82d95d57b?s=128&d=identicon&r=PG&f=1", "display_name": "felixgb", "link": "https://stackoverflow.com/users/8044523/felixgb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 45786336, "answer_count": 2, "score": 5, "last_activity_date": 1556026993, "creation_date": 1503248229, "last_edit_date": 1503260586, "question_id": 45784663, "link": "https://stackoverflow.com/questions/45784663/iouarray-to-bytesring-as-quickly-as-possible", "title": "IOUArray to ByteSring, as quickly as possible", "body": "<p>I need to mutate elements in a fixed size array of <code>Word8</code> very quickly. For this purpose I am using an <code>IOUArray</code>. I need to send this array over a websocket connection. The function <code>sendBinaryData</code> from the websockets package requires a <code>ByteString</code>. I need to convert from one representation to the other. I am using this function currently:</p>\n\n<pre><code>arrayToBS :: IOUArray Int Word8 -&gt; IO (BS.ByteString)\narrayToBS = (fmap BS.pack) . getElems\n</code></pre>\n\n<p>This function converts the elements of an array to a <code>[Word8]</code> before packing that list into a bytestring, and from profiling I can see that it is quite slow. I was wondering if there a way to speed up this function, or possibly send the array over a websocket connection directly?</p>\n\n<p>The array that I am using currently is:</p>\n\n<pre><code>size = 1000;\nnumBytes = size * size * 4\n\nnewBuffer :: IO (IOUArray Int Word8)\nnewBuffer = newArray (0, numBytes) 200 :: IO (IOUArray Int Word8)\n</code></pre>\n\n<p>and an except from the performance report:</p>\n\n<pre><code>COST CENTRE MODULE SRC                        %time %alloc\n\narrayToBS   Lib    src/Lib.hs:28:1-37          88.1   99.0\nnewBuffer   Lib    src/Lib.hs:(23,1)-(25,12)    9.9    0.8\n</code></pre>\n\n<p>Ideally <code>arrayToBS</code> would be much faster than creating the array. \nIf I change the <code>size</code> to 100:</p>\n\n<pre><code>COST CENTRE         MODULE                          SRC                                                %time %alloc\n\narrayToBS           Lib                             src/Lib.hs:21:1-37                           100.0   86.1\nmkEncodeTable.table Data.ByteString.Base64.Internal Data/ByteString/Base64/Internal.hs:105:5-75    0.0    8.0\nmkEncodeTable.ix    Data.ByteString.Base64.Internal Data/ByteString/Base64/Internal.hs:104:5-43    0.0    1.1\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "edited": false, "score": 4, "creation_date": 1503245884, "post_id": 45784275, "comment_id": 78525950, "body": "As far as I know, this is an inconsistency with no rationale behind it."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1503246690, "post_id": 45784275, "comment_id": 78526250, "body": "I&#39;m guessing you mean <a href=\"https://www.stackage.org/haddock/lts-9.1/base-4.9.1.0/Control-Applicative.html#t:Const\" rel=\"nofollow noreferrer\">this</a> <code>Const</code>? Why would you expect there to be a <code>runConst</code> function? What type would it have? Or would you expect <code>getConst</code> to be named <code>runConst</code>? There is no convention as to what a record selector should be named (except, perhaps, that it should reflect somehow the semantics of the field). (Aside: these are not typeclass function)"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 2, "creation_date": 1503251621, "post_id": 45784275, "comment_id": 78527919, "body": "I don&#39;t know of a convention, but I usually imagine <code>runX</code> to <i>do</i> something (like execute/return a function or return a monadic action), and then <code>getX</code> to <i>extract</i> something. <code>runConst</code> wouldn&#39;t make too much sense as a name, given that it&#39;s just unboxing a value."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 4, "creation_date": 1503254368, "post_id": 45784275, "comment_id": 78528855, "body": "Another common variant to add to the confusion is <code>unX</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 5, "creation_date": 1503258977, "post_id": 45784275, "comment_id": 78530081, "body": "@4castle, sure, but we have <code>runIdentity</code>, which is an extractor if ever there was one. BTW, I wouldn&#39;t call this &quot;unboxing&quot;; that has a rather different meaning."}], "answers": [{"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": true, "score": 5, "last_activity_date": 1575725674, "last_edit_date": 1575725674, "creation_date": 1503274436, "answer_id": 45787937, "question_id": 45784275, "link": "https://stackoverflow.com/questions/45784275/why-is-there-no-runconst-function-in-haskell/45787937#45787937", "title": "Why is there no runConst function in Haskell?", "body": "<p>It's purely a matter of how the author preferred to think about what they're representing. And it's often more about the \"abstract concept\" being represented, not the actual data structure being used to represent it.</p>\n\n<p>If you have some type <code>X</code> and think of an <code>X</code> value as a <em>computation</em> that could be run to get a value, then you'd have a <code>runX</code> function. If you think of it as more like a <em>container</em>, then you'd have a <code>getX</code> function (There are other possible interpretations that could lead to <code>runX</code> or <code>getX</code> or something else, these are just 2 commonly recurring ways of thinking about values).</p>\n\n<p>Of course when we're using first class Haskell values to represent things (and functions are perfectly good values), a lot of the time you could interpret something as either a computation or a container reasonably well. Consider <code>State</code> for representing stateful computations; <em>surely</em> that has to be interpreted as a computation, right? We say <code>runState :: State s a -&gt; s -&gt; (a , s)</code> because we think of it as \"running\" the <code>State s a</code>, needing an <code>s</code> as additional input. But we could just as easily think of it as \"getting\" an <code>s -&gt; (a, s)</code> out of the <code>State s a</code> - treating <code>State</code> more like a container.</p>\n\n<p>So the choice between <code>runX</code> and <code>getX</code> isn't really meaningful in any profound tense, but it tells you how the author was thinking about <code>X</code> (and perhaps how they think you should think about it).</p>\n\n<p><code>Const</code> is so-named in analogy to the function <code>const</code> (which takes an argument to produce the \"constant function\" that takes another input, ignores it, and returns whatever the first input to <code>const</code> was). But it's thought of as operating at the <em>type</em> level; <code>Const</code> takes a <em>type</em> and generates a \"type-level function\" that ignores whatever type it is applied to and then is isomorphic to the first type <code>Const</code> was applied to. Isomorphic rather than equal because to create a new type that could have different instances, it needs to have a constructor. At the <em>value</em> level, in order to be an isomorphism you need to be able to get a <code>Const a b</code> from an <code>a</code> (that's the <code>Const</code> constructor), and get the <code>a</code> back out of a <code>Const a b</code>. Since \"being isomorphic to <code>a</code>\" is <em>all</em> the properties we need it to have there's no real need to think of it as doing anything other than being a simple container of <code>a</code>, so we have <code>getConst</code>.</p>\n\n<p><code>Identity</code> seems similarly obvious as \"just a container\" and we have <code>runIdentity</code>. But one of the main motivations for having <code>Identity</code> is to think of <code>Identity a</code> as being a \"monadic computation\" in the same way that <code>State s a</code>, <code>Reader e a</code>, etc values are. So to continue the analogy we think of <code>Identity</code> as a \"do-nothing\" computation we <em>run</em>, rather than a simple wrapper container that we get a value out of. It <em>would</em> be perfectly valid to think of <code>Identity</code> as a container (the simplest possible one), but that wasn't the interpretation the authors chose to focus on.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "accepted_answer_id": 45787937, "answer_count": 1, "score": 3, "last_activity_date": 1575725674, "creation_date": 1503245717, "question_id": 45784275, "link": "https://stackoverflow.com/questions/45784275/why-is-there-no-runconst-function-in-haskell", "title": "Why is there no runConst function in Haskell?", "body": "<p>Is there a convention so that I know when to expect <code>runX</code> versus <code>getX</code> typeclass functions?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 7, "creation_date": 1503234837, "post_id": 45781989, "comment_id": 78522376, "body": "Yup, that sounds exactly like a job for QuickCheck. However, I&#39;d argue that you <i>should</i> refactor this regardless of any errors \u2013 needing random numbers is not an excuse for putting your result in <code>IO</code> (that&#39;s far too general, use <a href=\"http://hackage.haskell.org/package/rvar-0.2.0.3/docs/Data-RVar.html#t:RVar\" rel=\"nofollow noreferrer\">a dedicated monad</a> instead), and <code>!</code> is of course always unsafe, you should probably switch to something <code>lookup</code>ey."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1503240127, "post_id": 45781989, "comment_id": 78523965, "body": "As @leftaroundabout says, you should change <code>!</code> to <code>lookup</code> - this would allow you to produce a custom error message when <code>lookup</code> produces <code>Nothing</code>. If you have multiple uses of <code>!</code>, the error message can be different at each use site, which would give you an easy way to figure out which use is producing the error."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503241348, "post_id": 45781989, "comment_id": 78524381, "body": "@user2407038 yes, though GHC-8.2 actually tells you where the offending <code>!</code> is located, so this isn&#39;t as big of a problem anymore."}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1503231167, "creation_date": 1503231167, "question_id": 45781989, "link": "https://stackoverflow.com/questions/45781989/how-to-find-minimal-input-crashing-the-haskell-code", "title": "How to find minimal input crashing the Haskell code?", "body": "<p>I have a function that crashes on some inputs. The algoritm breaks an invariant where the Map should contain a value for a given key. It might as well be that the input is invalid.</p>\n\n<p>The function is of type <code>IntMap.IntMap [Int] -&gt; IO Int</code>. <code>IO</code> is used for random numbers and it crashes on <code>!</code> function.</p>\n\n<p>Is it possible to narrow down the error conditions for this function without refactoring it first using Haskell tools like QuickCheck?</p>\n"}, {"tags": ["haskell", "dsl"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1503239802, "post_id": 45781896, "comment_id": 78523842, "body": "The simplest way is to express each optimization (each line in the table) as a function <code>Program -&gt; Maybe Program</code> (call this type <code>Opt</code>); you can express combinators on <code>Opt</code>, e.g. which apply an optimization until it fails, which apply an optimization at every node of the AST, try each given optimization in sequence, apply all the given optimizations, etc. <code>no_skips</code> is just a function <code>Program -&gt; Maybe (Program, Program)</code>. For a more advanced approach, see <a href=\"https://hackage.haskell.org/package/compdata-0.11/docs/Data-Comp-TermRewriting.html\" rel=\"nofollow noreferrer\">here</a>."}], "answers": [{"tags": [], "owner": {"reputation": 1008, "user_id": 2302508, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/t3O8C.png?s=128&g=1", "display_name": "BlackCap", "link": "https://stackoverflow.com/users/2302508/blackcap"}, "is_accepted": false, "score": 0, "last_activity_date": 1503254227, "last_edit_date": 1503254227, "creation_date": 1503253878, "answer_id": 45785561, "question_id": 45781896, "link": "https://stackoverflow.com/questions/45781896/clean-way-to-do-rewrite-rules/45785561#45785561", "title": "Clean way to do rewrite rules", "body": "<h1>Use pattern matching!</h1>\n\n<p>This is what I wanted to avoid, I am posting it for reference</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>module Pattern where\n\nimport Lang\n\n\noptimize :: Program -&gt; Program\noptimize p\n  | p' &lt;- reorder $ rewrite $ moveSkip p\n  , p /= p'   = optimize p'\n  | otherwise = p\n\nrewrite :: Program -&gt; Program\nrewrite (Move a : Move b : x) = rewrite $ Move (a+b) : x\nrewrite (Add  a : Add  b : x) = rewrite $ Add  (a+b) : x\nrewrite (Move 0          : x) = rewrite x\nrewrite (Add  0          : x) = rewrite x\nrewrite (Skip   : Skip   : x) = rewrite x\nrewrite (Halt            : _) = [Halt]\nrewrite (Skip : x : xs) = Skip : x : rewrite xs\nrewrite (x : xs)        = x : rewrite xs\nrewrite []              = []\n\nmoveSkip :: Program -&gt; Program\nmoveSkip (Skip : a : x) = x ++ [Skip, a]\nmoveSkip x = x\n\nreorder :: Program -&gt; Program\nreorder (Move x : xs)\n  | (no_skips  , Move y : xs') &lt;- break isMove xs\n  , (no_skips' , Move w :  q ) &lt;- break isMove xs'\n  , x == -y\n  , all (/=Skip) no_skips\n  , all (/=Skip) no_skips'\n  = Move x : no_skips ++ no_skips' ++ Move (w-x) : reorder q\n  | otherwise  = Move x : reorder xs\nreorder (Skip : x : xs) = Skip : x : reorder xs\nreorder (x:xs) = x : reorder xs\nreorder []     = []\n\nisMove (Move _) = True\nisMove _        = False\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1008, "user_id": 2302508, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/t3O8C.png?s=128&g=1", "display_name": "BlackCap", "link": "https://stackoverflow.com/users/2302508/blackcap"}, "is_accepted": false, "score": 2, "last_activity_date": 1503260726, "last_edit_date": 1503260726, "creation_date": 1503253975, "answer_id": 45785581, "question_id": 45781896, "link": "https://stackoverflow.com/questions/45781896/clean-way-to-do-rewrite-rules/45785581#45785581", "title": "Clean way to do rewrite rules", "body": "<h1>Use Maybe's!</h1>\n\n<p>@user2407038 told me that I could use Maybe in a comment</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>module MaybeProg where\n\nimport Lang\nimport Control.Monad\n\ntype Opt = Program -&gt; Maybe Program\n\noptimize = untilFail step\n  where step p | p' &lt;- atEveryButSkipNextWhen (==Skip) rewrite\n                     . atEvery   delNopSkip\n                     $ untilFail moveSkips p\n               , p /= p' = Just p'\n               | otherwise = Nothing\n        rewrite = tryAll [joinMoves, joinAdds, delNopMov, delNopAdd, termHalt, reorder]\n\njoinMoves  p = do (Move a : Move b : x) &lt;- pure p; Just $ Move (a+b) : x\njoinAdds   p = do (Add  a : Add  b : x) &lt;- pure p; Just $ Add  (a+b) : x\ndelNopMov  p = do (Move 0          : x) &lt;- pure p; Just x\ndelNopAdd  p = do (Add  0          : x) &lt;- pure p; Just x\ndelNopSkip p = do (Skip   : Skip   : x) &lt;- pure p; Just x\ntermHalt   p = do (Halt            : _) &lt;- pure p; Just [Halt]\nmoveSkips  p = do (Skip   : x : y  : z) &lt;- pure p; Just $ y : z ++ [Skip, x]\n\nreorder p = do\n  (Move x : rst)      &lt;- pure p\n  (as, Move y : rst') &lt;- break' isMove rst\n  guard $ x == -y &amp;&amp; all (/=Skip) as\n  (bs, Move w :   q ) &lt;- break' isMove rst'\n  guard $ all (/=Skip) bs\n  return $ Move x : as ++ bs ++ Move (w-x) : q\n where isMove (Move _) = True\n       isMove _        = False\n\n--------\n\nuntilFail :: Opt -&gt; Program -&gt; Program\nuntilFail o p | Just p' &lt;- o p = untilFail o p'\n              | otherwise   = p\n\natEvery :: Opt -&gt; Program -&gt; Program\natEvery o p | (x:xs) &lt;- untilFail o p = x : atEvery o xs\n            | otherwise               = []\n\natEveryButSkipNextWhen c o p@(h:_)\n  | not $ c h\n  , (x:xs) &lt;- untilFail o p = x : atEveryButSkipNextWhen c o xs\n  | (p1:p2:ps) &lt;- p = p1:p2:atEveryButSkipNextWhen c o ps\n  | otherwise = p\natEveryButSkipNextWhen _ _ [] = []\n\ntryAll :: [Opt] -&gt; Opt\ntryAll os p = do\n  Just x : _ &lt;- pure . dropWhile (==Nothing) $ ($p) &lt;$&gt; os\n  return x\n\nbreak' f p | (x, y) &lt;- break f p\n           , not $ null y = Just (x, y)\n           | otherwise = Nothing\n</code></pre>\n"}], "owner": {"reputation": 1008, "user_id": 2302508, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/t3O8C.png?s=128&g=1", "display_name": "BlackCap", "link": "https://stackoverflow.com/users/2302508/blackcap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 1, "answer_count": 2, "score": 3, "last_activity_date": 1503260726, "creation_date": 1503230396, "last_edit_date": 1503249643, "question_id": 45781896, "link": "https://stackoverflow.com/questions/45781896/clean-way-to-do-rewrite-rules", "title": "Clean way to do rewrite rules", "body": "<p>I have the following toy language:</p>\n\n<pre><code>module Lang where\n\ndata Op = Move Int -- Move the pointer N steps\n        | Add  Int -- Add N to the value under the pointer\n        | Skip     -- Skip next op if the value under the pointer is 0\n        | Halt     -- End execution\n        deriving (Show, Eq)\n\ntype Program = [Op]\n</code></pre>\n\n<p>The language has a finite tape of memory cells that wraps around, and a pointer that points at some cell. All the cells are initially zero. The program is executed repeatedly until the halt instruction is read.</p>\n\n<p>Now I would like to write a function that optimizes a given program. Here is the optimizations that I would like to perform:</p>\n\n<pre><code>| Original code       | Optimization   |\n|---------------------|----------------|\n| Move a : Move b : x | Move (a+b) : x |\n| Add  a : Add  b : x | Add  (a+b) : x |\n| Move 0 : x          | x              |\n| Add  0 : x          | x              |\n| Skip : Skip : x : y | x : y          |\n| Halt : _            | Halt           |\n</code></pre>\n\n<p>Additionally, I can only do an optimization on code that is not directly after a skip, because doing that would change the meaning of the program.</p>\n\n<p>Is repeatedly pattern matching on the list until no more optimizations can be performed really the best/cleanest way to do this?</p>\n\n<p>What if I decide that I also want to perform more advanced rewrites like these:</p>\n\n<pre><code>| Original code                                          | Optimization                                   |\n|--------------------------------------------------------|------------------------------------------------|\n| if the program begins with (Skip : a)                  | move it to the end of the program              |\n| Move x ++ no_skips : Move -x ++ no_skips' : Move w : q | Move x ++ no_skips ++ no_skips' : Move w-x : q |\n</code></pre>\n"}, {"tags": ["haskell", "curl"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1503218523, "post_id": 45780131, "comment_id": 78517627, "body": "If you remove the <code>GZip.compress</code> step and just write <code>body</code>, how long does it take?"}, {"owner": {"reputation": 548, "user_id": 1027846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c6542596c12abd13a7dd4b337b8f6d8?s=128&d=identicon&r=PG", "display_name": "Mustafa \u0130lhan", "link": "https://stackoverflow.com/users/1027846/mustafa-%c4%b0lhan"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1503218656, "post_id": 45780131, "comment_id": 78517673, "body": "I tried it and GZip.compress does not effect the result too much. <code>$ time .&#47;fetcher   real\t0m9.171s user\t0m8.776s sys\t0m0.072s</code>"}, {"owner": {"reputation": 548, "user_id": 1027846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c6542596c12abd13a7dd4b337b8f6d8?s=128&d=identicon&r=PG", "display_name": "Mustafa \u0130lhan", "link": "https://stackoverflow.com/users/1027846/mustafa-%c4%b0lhan"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1503220152, "post_id": 45780131, "comment_id": 78518094, "body": "Also, ghc -O2 -o fetcher fetcher.hs doesn&#39;t make any change."}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 1, "creation_date": 1503220891, "post_id": 45780131, "comment_id": 78518273, "body": "Can you reproduce it with any request, e.g. <code>http:&#47;&#47;example.com&#47;</code>?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1503221199, "post_id": 45780131, "comment_id": 78518357, "body": "I think it&#39;s interesting how much time is spent in <code>user</code> relative to <code>real</code>. Seems like there is a lot of <code>MUT</code> and/or <code>GC</code> going on. Use <code>.&#47;fetcher +RTS -s</code> to check if there&#39;s too much garbage collection, and profile your program if the statistics don&#39;t provide enough information. Also keep in mind that you might need <code>-O2 -fforce-recomp</code> if GHC does not want to recompile your original source, for example if you didn&#39;t change anything."}, {"owner": {"reputation": 548, "user_id": 1027846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c6542596c12abd13a7dd4b337b8f6d8?s=128&d=identicon&r=PG", "display_name": "Mustafa \u0130lhan", "link": "https://stackoverflow.com/users/1027846/mustafa-%c4%b0lhan"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1503221649, "post_id": 45780131, "comment_id": 78518483, "body": "@Ryan I tried <code>http:&#47;&#47;example.com</code>, <code>https:&#47;&#47;google.com</code>, <code>https:&#47;&#47;twitter.com</code> and they are fast (above 1sec)."}, {"owner": {"reputation": 548, "user_id": 1027846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c6542596c12abd13a7dd4b337b8f6d8?s=128&d=identicon&r=PG", "display_name": "Mustafa \u0130lhan", "link": "https://stackoverflow.com/users/1027846/mustafa-%c4%b0lhan"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1503221812, "post_id": 45780131, "comment_id": 78518521, "body": "@Zeta I guess you are right. MUT 4.4 sec, GC 4.9 sec"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1503222560, "post_id": 45780131, "comment_id": 78518694, "body": "@mustilica time to <code>-prof</code>ile your code. Unfortunately, I won&#39;t have time to investigate that problem for another 12h :/"}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1503227528, "post_id": 45780131, "comment_id": 78520098, "body": "Are you sure the result you get with <code>curl</code> is <i>correct</i>? The website appears to block its UA header. (Given the timings you found, this is unlikely to be the issue, but it\u2019s worth eliminating possibilities.)"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503239918, "post_id": 45780131, "comment_id": 78523894, "body": "Could lazy bytestrings be the issue here?"}, {"owner": {"reputation": 548, "user_id": 1027846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c6542596c12abd13a7dd4b337b8f6d8?s=128&d=identicon&r=PG", "display_name": "Mustafa \u0130lhan", "link": "https://stackoverflow.com/users/1027846/mustafa-%c4%b0lhan"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1503247703, "post_id": 45780131, "comment_id": 78526596, "body": "@Ryan I checked files with diff, they are same."}, {"owner": {"reputation": 548, "user_id": 1027846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c6542596c12abd13a7dd4b337b8f6d8?s=128&d=identicon&r=PG", "display_name": "Mustafa \u0130lhan", "link": "https://stackoverflow.com/users/1027846/mustafa-%c4%b0lhan"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1503248080, "post_id": 45780131, "comment_id": 78526743, "body": "@Zeta sorry I couldn&#39;t understand last suggestion <code>-prof</code>?"}, {"owner": {"reputation": 548, "user_id": 1027846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c6542596c12abd13a7dd4b337b8f6d8?s=128&d=identicon&r=PG", "display_name": "Mustafa \u0130lhan", "link": "https://stackoverflow.com/users/1027846/mustafa-%c4%b0lhan"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503248208, "post_id": 45780131, "comment_id": 78526781, "body": "@user2407038 Maybe, but this is what wreq package returns?"}, {"owner": {"reputation": 412, "user_id": 6593641, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xVNVQ.jpg?s=128&g=1", "display_name": "madnight", "link": "https://stackoverflow.com/users/6593641/madnight"}, "edited": false, "score": 0, "creation_date": 1503254323, "post_id": 45780131, "comment_id": 78528841, "body": "something is strange, when i try both versions, haskell and curl, i get different gzip results hash: 2c5eca8...  outhas.html.gz sha512sum out.html.gz                                                                                                                                                   hash: e9d695ec9aa025...  out.html.gz 4338 Aug 20 20:36 outhas.html.gz 1494 Aug 20 20:36 out.html.gz"}, {"owner": {"reputation": 548, "user_id": 1027846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c6542596c12abd13a7dd4b337b8f6d8?s=128&d=identicon&r=PG", "display_name": "Mustafa \u0130lhan", "link": "https://stackoverflow.com/users/1027846/mustafa-%c4%b0lhan"}, "reply_to_user": {"reputation": 412, "user_id": 6593641, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xVNVQ.jpg?s=128&g=1", "display_name": "madnight", "link": "https://stackoverflow.com/users/6593641/madnight"}, "edited": false, "score": 0, "creation_date": 1503255349, "post_id": 45780131, "comment_id": 78529131, "body": "@madnight so do I, but skip the gzip part, diff command returns no difference."}, {"owner": {"reputation": 412, "user_id": 6593641, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xVNVQ.jpg?s=128&g=1", "display_name": "madnight", "link": "https://stackoverflow.com/users/6593641/madnight"}, "edited": false, "score": 0, "creation_date": 1503261502, "post_id": 45780131, "comment_id": 78530771, "body": "i get different file contents 2918 Aug 20 22:35 out-curl.html <a href=\"http://lpaste.net/2998667100014247936\" rel=\"nofollow noreferrer\">lpaste.net/2998667100014247936</a> 11088 Aug 20 22:35 out-hask.html <a href=\"http://lpaste.net/357842\" rel=\"nofollow noreferrer\">lpaste.net/357842</a>"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1503266549, "post_id": 45780131, "comment_id": 78532085, "body": "@mustilica See <a href=\"https://downloads.haskell.org/~ghc/8.0-latest/docs/html/users_guide/profiling.html\" rel=\"nofollow noreferrer\">section 7 (profiling) of the GHC guide</a>."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1503268449, "post_id": 45780131, "comment_id": 78532499, "body": "I get 1.3s on Windows for your code, regardless whether I compile with <code>-O2</code> or without, which seems more reasonable than the 9s. For completeness, please add your used <code>ghc</code> version, the used versions of the libraries (or the stackage LTS variant you use) and the exact command line (since yours does not use optimization)."}, {"owner": {"reputation": 548, "user_id": 1027846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c6542596c12abd13a7dd4b337b8f6d8?s=128&d=identicon&r=PG", "display_name": "Mustafa \u0130lhan", "link": "https://stackoverflow.com/users/1027846/mustafa-%c4%b0lhan"}, "reply_to_user": {"reputation": 412, "user_id": 6593641, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xVNVQ.jpg?s=128&g=1", "display_name": "madnight", "link": "https://stackoverflow.com/users/6593641/madnight"}, "edited": false, "score": 0, "creation_date": 1503335608, "post_id": 45780131, "comment_id": 78562907, "body": "@madnight yours also different than mine, probably website sends different html page by considering user-agent, ip locations etc."}, {"owner": {"reputation": 548, "user_id": 1027846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c6542596c12abd13a7dd4b337b8f6d8?s=128&d=identicon&r=PG", "display_name": "Mustafa \u0130lhan", "link": "https://stackoverflow.com/users/1027846/mustafa-%c4%b0lhan"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1503337579, "post_id": 45780131, "comment_id": 78563727, "body": "@Zeta My <code>ghc version is 7.10.3</code> and compile command is <code>ghc -o fetcher fetcher.hs</code>. I tried <code>-prof</code> but it ended with a disaster, it suggested that reinstalling some packages, but i cannot reinstall them because of dependencies and after I removed them but after that I can not reinstall them because cabal cannot find package versions etc. Maybe I need a clean installation but I don&#39;t how to remove haskell, cabal and stack..."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1503345989, "post_id": 45780131, "comment_id": 78567381, "body": "And you did try to remove any temporary files and the executable and then <code>ghc -O2 -o fetcher fetcher.hs</code>, right?"}, {"owner": {"reputation": 412, "user_id": 6593641, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xVNVQ.jpg?s=128&g=1", "display_name": "madnight", "link": "https://stackoverflow.com/users/6593641/madnight"}, "edited": false, "score": 0, "creation_date": 1503346650, "post_id": 45780131, "comment_id": 78567625, "body": "@mustilica yup and thats why this is not a valid comparison, maybe Network.Wreq also evaluates javascript, while curl does not?"}, {"owner": {"reputation": 548, "user_id": 1027846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c6542596c12abd13a7dd4b337b8f6d8?s=128&d=identicon&r=PG", "display_name": "Mustafa \u0130lhan", "link": "https://stackoverflow.com/users/1027846/mustafa-%c4%b0lhan"}, "reply_to_user": {"reputation": 412, "user_id": 6593641, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xVNVQ.jpg?s=128&g=1", "display_name": "madnight", "link": "https://stackoverflow.com/users/6593641/madnight"}, "edited": false, "score": 0, "creation_date": 1503383897, "post_id": 45780131, "comment_id": 78578386, "body": "@madnight network is not the case I think because I checked it via tcpdump, but yes javascript or any other html content could be handled by wreq differently."}, {"owner": {"reputation": 548, "user_id": 1027846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c6542596c12abd13a7dd4b337b8f6d8?s=128&d=identicon&r=PG", "display_name": "Mustafa \u0130lhan", "link": "https://stackoverflow.com/users/1027846/mustafa-%c4%b0lhan"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1503384018, "post_id": 45780131, "comment_id": 78578450, "body": "@Zeta what type of temporary files do you mean? I actually don&#39;t remove files in the folder, I only change the code file and run the compile command."}, {"owner": {"reputation": 15161, "user_id": 1067003, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e3af2bd4b5604b0b661b5e6646544eba?s=128&d=identicon&r=PG", "display_name": "hanshenrik", "link": "https://stackoverflow.com/users/1067003/hanshenrik"}, "edited": false, "score": 0, "creation_date": 1549013222, "post_id": 45780131, "comment_id": 95760066, "body": "Curl reads number of bytes equal to the <code>Conent-Length</code> header, and then stops. a common theme with many naive http clients is to just keep reading until the remote server close the socket, which is potentially <i>much</i> slower than just reading until Content-Length bytes are reached. is your http client optimized to consider the Content-Length header?"}, {"owner": {"reputation": 548, "user_id": 1027846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c6542596c12abd13a7dd4b337b8f6d8?s=128&d=identicon&r=PG", "display_name": "Mustafa \u0130lhan", "link": "https://stackoverflow.com/users/1027846/mustafa-%c4%b0lhan"}, "reply_to_user": {"reputation": 15161, "user_id": 1067003, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e3af2bd4b5604b0b661b5e6646544eba?s=128&d=identicon&r=PG", "display_name": "hanshenrik", "link": "https://stackoverflow.com/users/1067003/hanshenrik"}, "edited": false, "score": 0, "creation_date": 1549052073, "post_id": 45780131, "comment_id": 95779825, "body": "hi @hanshenrik, your suggestion makes sense, let me try it again in a couple days and return back to you. I&#39;ll check <code>Content-Length</code> field."}], "answers": [{"comments": [{"owner": {"reputation": 548, "user_id": 1027846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c6542596c12abd13a7dd4b337b8f6d8?s=128&d=identicon&r=PG", "display_name": "Mustafa \u0130lhan", "link": "https://stackoverflow.com/users/1027846/mustafa-%c4%b0lhan"}, "edited": false, "score": 0, "creation_date": 1549114190, "post_id": 54486803, "comment_id": 95792536, "body": "Thank you for your answer, I tried your your suggestion with this code: <code>{-# LANGUAGE OverloadedStrings #-} import Network.HTTP.Simple import qualified Data.ByteString.Char8 as B8  main :: IO () main = httpBS &quot;http:&#47;&#47;127.0.0.1:9999&quot; &gt;&gt;= B8.putStrLn . getResponseBody</code> The result is abc. Furthermore, I checked the sahibinden link again, and this time it takes 0,5 second in real. In other words, I couldn&#39;t reproduce the problem."}, {"owner": {"reputation": 15161, "user_id": 1067003, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e3af2bd4b5604b0b661b5e6646544eba?s=128&d=identicon&r=PG", "display_name": "hanshenrik", "link": "https://stackoverflow.com/users/1067003/hanshenrik"}, "reply_to_user": {"reputation": 548, "user_id": 1027846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c6542596c12abd13a7dd4b337b8f6d8?s=128&d=identicon&r=PG", "display_name": "Mustafa \u0130lhan", "link": "https://stackoverflow.com/users/1027846/mustafa-%c4%b0lhan"}, "edited": false, "score": 0, "creation_date": 1549136195, "post_id": 54486803, "comment_id": 95798812, "body": "@Mustafa\u0130lhan well, i guess your software stack has been updated since the 17+ months that has passed since you noticed the issue? i guess an update to your http client fixed the issue :)"}, {"owner": {"reputation": 548, "user_id": 1027846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c6542596c12abd13a7dd4b337b8f6d8?s=128&d=identicon&r=PG", "display_name": "Mustafa \u0130lhan", "link": "https://stackoverflow.com/users/1027846/mustafa-%c4%b0lhan"}, "edited": false, "score": 0, "creation_date": 1549184731, "post_id": 54486803, "comment_id": 95807037, "body": "yes, update on software stack is a big change, and it may be the reason of fix."}], "tags": [], "owner": {"reputation": 15161, "user_id": 1067003, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e3af2bd4b5604b0b661b5e6646544eba?s=128&d=identicon&r=PG", "display_name": "hanshenrik", "link": "https://stackoverflow.com/users/1067003/hanshenrik"}, "is_accepted": false, "score": 3, "last_activity_date": 1549054217, "last_edit_date": 1549054217, "creation_date": 1549053259, "answer_id": 54486803, "question_id": 45780131, "link": "https://stackoverflow.com/questions/45780131/why-is-my-https-getter-in-haskell-so-slow-compared-to-curl/54486803#54486803", "title": "Why is my https getter in Haskell so slow compared to curl?", "body": "<p>my best guess is that your HTTP client does not consider the <code>Content-Length</code> http header, and merely keeps downloading until the remote server close the connection, which is</p>\n\n<p>a: potentially <em>much</em> slower than just reading the <code>Content-Length</code> header, many webservers keep sockets open for much longer than need be (usually for a socket reuse scheme)</p>\n\n<p>b: a common theme among naive/simple http clients. </p>\n\n<p>you can confirm this with a little netcat http server like this:</p>\n\n<pre><code>printf \"HTTP/1.0 200 OK\\r\\nContent-Length: 3\\r\\n\\r\\nabcx\" | nc -l 9999\n</code></pre>\n\n<p>now hit <a href=\"http://127.0.0.1:9999\" rel=\"nofollow noreferrer\">http://127.0.0.1:9999</a> and check the response, a http client optimized to consider the <code>Content-Length</code> header will say that the response body is <code>abc</code>, while a http client not optimized to consider the <code>Content-Length</code> header will say that the response body is <code>abcx</code></p>\n\n<p><a href=\"https://i.stack.imgur.com/HupKS.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/HupKS.png\" alt=\"enter image description here\"></a></p>\n\n<p>note: this command should work on unix-like systems (Linux, *BSD, MacOS), but probably won't work on Windows-systems. if you're running Windows, it will work on <a href=\"https://cygwin.com/install.html\" rel=\"nofollow noreferrer\">Cygwin</a> (and probably work on WSL, but i haven't tried, i am still rolling windows 7 which doesn't support WSL)</p>\n"}], "owner": {"reputation": 548, "user_id": 1027846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c6542596c12abd13a7dd4b337b8f6d8?s=128&d=identicon&r=PG", "display_name": "Mustafa \u0130lhan", "link": "https://stackoverflow.com/users/1027846/mustafa-%c4%b0lhan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 368, "favorite_count": 2, "answer_count": 1, "score": 11, "last_activity_date": 1549115272, "creation_date": 1503218249, "last_edit_date": 1549115272, "question_id": 45780131, "link": "https://stackoverflow.com/questions/45780131/why-is-my-https-getter-in-haskell-so-slow-compared-to-curl", "title": "Why is my https getter in Haskell so slow compared to curl?", "body": "<p>I'm writing a simple https getter code in Haskell. After I get the response I save it to a file with compression. However my version is very slow compared to curl and gzip combination. How can I make it faster that curl? Details are below.</p>\n\n<p>Haskell code (fetcher.hs):</p>\n\n<pre><code>import Control.Lens\nimport qualified Codec.Compression.GZip as GZip\nimport qualified Data.ByteString.Lazy as BL\nimport Network.Wreq\n\nwriteURIBodyToFile :: FilePath -&gt; String -&gt; IO()\nwriteURIBodyToFile filePath uri = do\n  response &lt;- get uri\n  let body = (response ^. responseBody)\n  BL.writeFile filePath (GZip.compress body)\n\nmain :: IO ()\nmain = writeURIBodyToFile \"out.html.gz\" \"https://www.sahibinden.com/ilan/vasita-otomobil-seat-hatasiz-boyasiz-tramersiz-dsg-leon-469484363/detay/\"\n</code></pre>\n\n<p>Haskell result:</p>\n\n<pre><code>$ ghc -o fetcher fetcher.hs\n$ time ./fetcher \n\nreal    0m9.240s\nuser    0m8.840s\nsys     0m0.232s\n</code></pre>\n\n<p>curl result:</p>\n\n<pre><code>$ time curl \"https://www.sahibinden.com/ilan/vasita-otomobil-seat-hatasiz-boyasiz-tramersiz-dsg-leon-469484363/detay/\" | gzip &gt; out.html.gz\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100  102k  100  102k    0     0   331k      0 --:--:-- --:--:-- --:--:--  332k\n\nreal    0m0.524s\nuser    0m0.156s\nsys     0m0.040s\n</code></pre>\n\n<p>Edit:\nI also tried with http-conduit package, nothing changed.</p>\n\n<pre><code>import qualified Data.ByteString.Lazy as BL\nimport           Network.HTTP.Simple\n\nmain :: IO ()\nmain = do\n    response &lt;- httpLBS \"https://www.sahibinden.com/ilan/vasita-otomobil-seat-hatasiz-boyasiz-tramersiz-dsg-leon-469484363/detay/\"\n    BL.writeFile \"outnew.html\" $ getResponseBody response\n</code></pre>\n\n<p>Edit2: I also checked the connection with tcpdump, and there is no connection issue.</p>\n\n<p>Edit3: <code>GHCi, version 7.10.3</code></p>\n\n<p>Edit4: compile command <code>ghc -o fetcher fetcher.hs</code></p>\n\n<p>Edit5: the problem couldn't be reproducible with this code on Feb 2019:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport Network.HTTP.Simple\nimport qualified Data.ByteString.Char8 as B8\n\nmain :: IO ()\nmain = httpBS \"https://www.sahibinden.com/ilan/vasita-otomobil-mercedes-benz-mercedes-benz-c-180-fascination-7g-tronic-ozel-renk-652750468/detay\" &gt;&gt;= B8.putStrLn . getResponseBody\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>$ ghc -o fetcher fetcher.hs\n$ time ./fetcher \nreal    0m0,549s\nuser    0m0,093s\nsys     0m0,021s\n</code></pre>\n\n<p>Edit6: again, the problem couldn't be reproducible on the first code sample on Feb 2019 <code>GHCi, version 8.0.2</code></p>\n"}, {"tags": ["haskell", "monads", "yesod"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 5, "creation_date": 1503217172, "post_id": 45779957, "comment_id": 78517281, "body": "<code>Handler</code> is a <a href=\"https://hackage.haskell.org/package/transformers-0.3.0.0/docs/Control-Monad-IO-Class.html\" rel=\"nofollow noreferrer\"><code>MonadIO</code></a>, so you can <code>result &lt;- liftIO $ mapM toTMDBMovie reccMovies</code>"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1503217367, "post_id": 45779957, "comment_id": 78517327, "body": "This is related to <a href=\"https://en.wikibooks.org/wiki/Haskell/Monad_transformers\" rel=\"nofollow noreferrer\">monad transformers</a> if you want to learn more."}, {"owner": {"reputation": 701, "user_id": 2750514, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/f8414c0ea2ced7a5d29767da6d700042?s=128&d=identicon&r=PG&f=1", "display_name": "Biffy", "link": "https://stackoverflow.com/users/2750514/biffy"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1503217634, "post_id": 45779957, "comment_id": 78517405, "body": "@luqui Thank you, that&#39;s exactly what I was looking for. If you post this as an Answer, I&#39;ll mark it as correct. :)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1503217713, "post_id": 45779957, "comment_id": 78517418, "body": "The point here is realizing that you don&#39;t need to turn <code>IO [Movie]</code> to <code>[Movie]</code>, which is impossible to do safely, but to <code>Handler [Movie]</code>, which is done by <code>liftIO</code>."}], "answers": [{"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 4, "last_activity_date": 1503217651, "creation_date": 1503217651, "answer_id": 45780055, "question_id": 45779957, "link": "https://stackoverflow.com/questions/45779957/how-to-avoid-unsafeperformio-in-the-handler-monad/45780055#45780055", "title": "How to avoid unsafePerformIO in the Handler Monad?", "body": "<p>If a monad <code>m</code> you are working in is of <code>MonadIO</code> class, you can use <code>liftIO :: IO a -&gt; m a</code> to perform IO actions inside.</p>\n\n<p>As for Yesod, you can perform IO action in its <code>Handler</code> actions, as well as Persistent's <code>runDB</code> blocks.</p>\n"}], "owner": {"reputation": 701, "user_id": 2750514, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/f8414c0ea2ced7a5d29767da6d700042?s=128&d=identicon&r=PG&f=1", "display_name": "Biffy", "link": "https://stackoverflow.com/users/2750514/biffy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 45780055, "answer_count": 1, "score": 0, "last_activity_date": 1503217651, "creation_date": 1503216969, "question_id": 45779957, "link": "https://stackoverflow.com/questions/45779957/how-to-avoid-unsafeperformio-in-the-handler-monad", "title": "How to avoid unsafePerformIO in the Handler Monad?", "body": "<p>I have problems wrapping my head around avoiding an unsafePerformIO in a Yesod Handler. The code in the Handler is living in the Handler Monad, so how can I execute the IO operation?</p>\n\n<pre><code>getProfileR :: Handler Html\ngetProfileR = do\n\n  -- toTMDBMovie's return-type is IO Movie\n  -- Without the unsafePerformIO the type of result would be IO [Movie]\n  -- How do I get from IO [Movie] to [Movie]?\n  -- Ignore reccMovies - it's just a parameter.\n\n  let result = unsafePerformIO $ mapM toTMDBMovie reccMovies\n\n  defaultLayout $ do\n      setTitle \"Profile\"\n      $(widgetFile \"profile\")\n</code></pre>\n\n<p>Thank you for your help!</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 8460216, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db819f8b569b17039dd3721499cd8bf9?s=128&d=identicon&r=PG&f=1", "display_name": "Deindery", "link": "https://stackoverflow.com/users/8460216/deindery"}, "edited": false, "score": 0, "creation_date": 1503196633, "post_id": 45777953, "comment_id": 78513499, "body": "when I fix that I get this error: <code>Not in scope: type variable \u2018show\u2019     Perhaps you meant type constructor or class \u2018Show\u2019 (imported from Prelude)</code>"}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "reply_to_user": {"reputation": 21, "user_id": 8460216, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db819f8b569b17039dd3721499cd8bf9?s=128&d=identicon&r=PG&f=1", "display_name": "Deindery", "link": "https://stackoverflow.com/users/8460216/deindery"}, "edited": false, "score": 0, "creation_date": 1503196738, "post_id": 45777953, "comment_id": 78513520, "body": "Capitalize <code>show</code> on the second-to-last line. These are quite simple typographical errors. Remember that GHC tells you the line number to look at to fix the problem. You can usually sort out typos like this pretty easily once you know the line number."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "reply_to_user": {"reputation": 21, "user_id": 8460216, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db819f8b569b17039dd3721499cd8bf9?s=128&d=identicon&r=PG&f=1", "display_name": "Deindery", "link": "https://stackoverflow.com/users/8460216/deindery"}, "edited": false, "score": 0, "creation_date": 1503196885, "post_id": 45777953, "comment_id": 78513545, "body": "@Deindery There are several little typographical errors like that in your posted code. See my edit."}, {"owner": {"reputation": 21, "user_id": 8460216, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db819f8b569b17039dd3721499cd8bf9?s=128&d=identicon&r=PG&f=1", "display_name": "Deindery", "link": "https://stackoverflow.com/users/8460216/deindery"}, "edited": false, "score": 0, "creation_date": 1503197420, "post_id": 45777953, "comment_id": 78513618, "body": "Thank you very much, now my code works after I remove all the auto tabs and fix the typos"}], "tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": true, "score": 2, "last_activity_date": 1503196864, "last_edit_date": 1503196864, "creation_date": 1503196594, "answer_id": 45777953, "question_id": 45777937, "link": "https://stackoverflow.com/questions/45777937/haskell-parse-error-on-input-when-trying-to-compile/45777953#45777953", "title": "Haskell parse error on input \u2018|\u2019 when trying to compile", "body": "<p>On Line 27:</p>\n\n<pre><code>| a &lt; 0 + -1\n</code></pre>\n\n<p>A simple typo. You put <code>+</code> where you meant <code>=</code></p>\n\n<pre><code>| a &lt; 0 = -1\n</code></pre>\n\n<p>You'll also want to capitalize <code>show</code> on the second-to-last line. Your <code>deriving</code> clause for your type shouldn't include <code>Show</code> either, because you define an instance explicitly rather than deriving it. Finally, your module export list should look like this.</p>\n\n<pre><code>module Fraccion(Frac(Div),mcd,fraccion) where\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 8460216, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db819f8b569b17039dd3721499cd8bf9?s=128&d=identicon&r=PG&f=1", "display_name": "Deindery", "link": "https://stackoverflow.com/users/8460216/deindery"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 0, "accepted_answer_id": 45777953, "answer_count": 1, "score": -2, "last_activity_date": 1503217816, "creation_date": 1503196370, "last_edit_date": 1503217816, "question_id": 45777937, "link": "https://stackoverflow.com/questions/45777937/haskell-parse-error-on-input-when-trying-to-compile", "title": "Haskell parse error on input \u2018|\u2019 when trying to compile", "body": "<p>Hi all I'm learning haskell and I made this code to implemente fractions but when I compile it I get the error <code>parse error on input \u2018|\u2019</code>\nMy code is the following:</p>\n\n<pre><code>module Fraccion(Frac,Div,mcd,fraccion) where\n\n\ndata Frac = Div Integer Integer deriving (Eq, Show)\n\n\nmcd :: Integer -&gt; Integer -&gt; Integer\nmcd a b | a &gt; b = mcd (a-b) b\n        | a &lt; b = mcd a (b-a)\n        | a == b = a\n\nfraccion :: Integer -&gt; Integer -&gt; Frac \nfraccion a b | b == 0 = error \"divisor can't be 0\"\n             | b &lt;  0 = fraccion (-a) (-b)\n             | b &gt;  0 = Div (a `div` mcdab) (b `div` mcdab)\n                        where mcdab = mcd (abs a) b\n\ninstance (Num Frac) where\n    negate (Div a b)      = (Div (-a) b)\n    abs    (Div a b)      = (Div (abs a) b)\n    (Div a b) * (Div c d) = fraccion (a*c) (b*d)\n    (Div a b) + (Div c d) = fraccion (a*d+b*c) (b*d)\n    (Div a b) - (Div c d) = fraccion (a*d-b*c) (b*d)\n    fromInteger n = (Div n 1)\n    signum (Div a b) | a &gt; 0 = 1\n                     | a &lt; 0 + -1\n                     | a == b = 0\n\ninstance show Frac where\n    show (Div a b) = (show a) ++ \"/\" ++ (show b)\n</code></pre>\n\n<p>Could you please help me with this error?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1503193619, "post_id": 45777703, "comment_id": 78513100, "body": "Which version of stack do you have <code>stack --version</code>? And which ghc?"}, {"owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1503194922, "post_id": 45777703, "comment_id": 78513264, "body": "@epsilonhalbe Please see edit."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503197300, "post_id": 45777703, "comment_id": 78513602, "body": "At some point, cabal decides to add <code>-O</code> to the <code>ghc --make</code> command (I&#39;ve confirmed this on my machine with stack 1.1.3 and cabal 1.24.2.0). As the docs state, this also causes assertions to be turned off. I&#39;m not actually sure why - maybe somebody more knowledgeable will show up and explain it. You can get around it by adding <code>-fno-ignore-asserts</code> to <code>ghc-options</code> (or <code>-O0</code> I&#39;m guessing, but that probably would have undesired side-effects)."}, {"owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503197735, "post_id": 45777703, "comment_id": 78513649, "body": "@user2407038 Hmm I don&#39;t see any difference even after adding the <code>-fno-ignore-asserts</code> flag. How do you see the flags used to build a particular executable, so that I can check if assertions are being disabled?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503198727, "post_id": 45777703, "comment_id": 78513794, "body": "Add <code>-v</code> (or <code>-v2</code> or <code>-v3</code>) to the <code>ghc-options</code> field. But I&#39;ve also verified this behaviour (that is, <code>stack build</code>, adding the <code>-fno-ignore-asserts</code> flag and then <code>stack build</code>) doesn&#39;t actually take affect. Even <code>stack build --reconfigure --force-dirty</code> doesn&#39;t work! I had to delete the <code>.stack-work</code> directory. (This one definitely looks like a bug, but keep in mind that stack-1.1.2 and 1.1.3 are very, very outdated)"}], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 0, "last_activity_date": 1503214236, "creation_date": 1503214236, "answer_id": 45779595, "question_id": 45777703, "link": "https://stackoverflow.com/questions/45777703/turning-on-assertions-while-compiling-with-haskells-stack-build-system/45779595#45779595", "title": "Turning on assertions while compiling with Haskell&#39;s stack build system", "body": "<p>Try passing in the --fast flag, which will disable optimizations (via <code>--ghc-options -O0</code>) and allow assertions to run.</p>\n"}], "owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 202, "favorite_count": 0, "accepted_answer_id": 45779595, "answer_count": 1, "score": 2, "last_activity_date": 1503214236, "creation_date": 1503192876, "last_edit_date": 1503196274, "question_id": 45777703, "link": "https://stackoverflow.com/questions/45777703/turning-on-assertions-while-compiling-with-haskells-stack-build-system", "title": "Turning on assertions while compiling with Haskell&#39;s stack build system", "body": "<p>I am using Stack 9.0 as my Haskell build system for my project. </p>\n\n<p>I've just noticed that when I compile my Haskell project with Stack, all assertions are switched off. By contrast while doing \"normal\" GHC builds at the command-line, assertions are turned on by default unless explicitly switched off with the <code>-fignore-asserts</code> flag (<a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Control-Exception-Base.html#v:assert\" rel=\"nofollow noreferrer\">link</a>).</p>\n\n<p>For instance this simple main function fails to throw an assertion error</p>\n\n<pre><code>import Control.Exception.Base\n\nmain :: IO ()\nmain = assert (1==2) $ print \"Hello World!\"\n</code></pre>\n\n<p>How do I edit the .cabal file of my project to turn on assertions? Currently inside my .cabal file I see the following ghc options</p>\n\n<pre><code> ghc-options: -threaded -rtsopts -with-rtsopts=-N\n</code></pre>\n\n<p>which is strange because assertions have not been explicitly turned off within this list. </p>\n\n<p>EDIT:</p>\n\n<p>I have <code>Version 1.1.2 x86_64 hpack-0.14.0</code> after running <code>stack --version</code>. In particular, I am using <code>stack lts 9.0</code> with <code>ghc 8.0.2</code></p>\n"}, {"tags": ["haskell", "servant"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1503193071, "post_id": 45777592, "comment_id": 78513027, "body": "Hi, right now it is very broad and unclear what concrete problem you have. As a rule of thumb, when asking for help I try to put as last as much effort in writing the question as i would expect someone answering it."}, {"owner": {"reputation": 11, "user_id": 3412668, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ebf10435c634d603cee09baaef64033?s=128&d=identicon&r=PG&f=1", "display_name": "paparga", "link": "https://stackoverflow.com/users/3412668/paparga"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1503265757, "post_id": 45777592, "comment_id": 78531882, "body": "Thanks for the feedback!"}, {"owner": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 0, "creation_date": 1503408555, "post_id": 45777592, "comment_id": 78595523, "body": "Regardless of the &quot;message passing&quot; mechanism that you&#39;ll pick, you definitely want the long running computation/process to happen in a separate thread or even process. The servant handler here would therefore just &quot;submit&quot; the computation to this separate thread or process and return some identifier that would allow one to later get the status of the job, in case the caller needs the output of the computation."}], "answers": [{"tags": [], "owner": {"reputation": 1227, "user_id": 5053374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe57f0998df065470ff42c938f781cf?s=128&d=identicon&r=PG", "display_name": "Libby", "link": "https://stackoverflow.com/users/5053374/libby"}, "is_accepted": false, "score": 1, "last_activity_date": 1503192865, "creation_date": 1503192865, "answer_id": 45777700, "question_id": 45777592, "link": "https://stackoverflow.com/questions/45777592/processing-a-job-in-background-with-haskell-servant/45777700#45777700", "title": "Processing a job in background with Haskell Servant", "body": "<p>I use <a href=\"http://hackage.haskell.org/package/hworker\" rel=\"nofollow noreferrer\">hworker</a> at work for something like this -- sending batch emails. You make instances of <code>Job</code>, <code>ToJSON</code>, and <code>FromJSON</code> for your long-running job, then use <code>queue</code> whenever you want to start the job. You'll also need  Redis to keep track of the state of your jobs to use hworker.</p>\n"}], "owner": {"reputation": 11, "user_id": 3412668, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ebf10435c634d603cee09baaef64033?s=128&d=identicon&r=PG&f=1", "display_name": "paparga", "link": "https://stackoverflow.com/users/3412668/paparga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 238, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1503265732, "creation_date": 1503191172, "last_edit_date": 1503265732, "question_id": 45777592, "link": "https://stackoverflow.com/questions/45777592/processing-a-job-in-background-with-haskell-servant", "title": "Processing a job in background with Haskell Servant", "body": "<p>I'm building a Facebook Messenger chatbot that can process long running jobs (that may fail), and I need to respond 200 to Facebook before the job is completed.</p>\n\n<p>I've tried using Pipes, but after a while I realized that I didn't know what I was doing.</p>\n\n<p>How can I achieve this?</p>\n\n<p>Thanks in advance</p>\n\n<p>EDIT:\nAs epsilonhalbe pointed, the question is very broad. I would try to make it more clear.</p>\n\n<p>Right now I have this:</p>\n\n<pre><code>myHandler :: Message -&gt; Handler Text\nmyHandler msg = do\n    doSomeStuff msg\n    return \"ok\"\n</code></pre>\n\n<p>The problem is that \"doSomeStuff\" is a long proccess and it can give a timeout error. So what I want to achieve is to respond \"ok\" before the process is completed. The Http code is 202 Accepted.</p>\n\n<p>I was thinking that sending a message to a mailbox could be a solution. But I would like a more idiomatic way to doing it.</p>\n"}, {"tags": ["haskell", "template-haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1503196212, "post_id": 45777491, "comment_id": 78513455, "body": "<code>map (\\c -&gt; FunD func_name ..) ..</code> produces multiple different functions which happen to have the same name (move <code>FunD</code> out of <code>map</code>). When pretty printed, this produces code which looks syntactically valid. However, you must remember that GHC is processing the TH AST <i>directly</i>, as opposed to converting it to a string and then once again parsing that code. The pretty printed representation of the TH AST should not be taken as representing the semantics of the actual generated code (it may be correct as printed, as it is here, or it may not even be syntactically well-formed in some cases)."}, {"owner": {"reputation": 1307, "user_id": 1549736, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/LBwQu.jpg?s=128&g=1", "display_name": "dbanas", "link": "https://stackoverflow.com/users/1549736/dbanas"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503228538, "post_id": 45777491, "comment_id": 78520428, "body": "Yep, that was it; thanks! Copying/pasting your comment, as the answer."}], "answers": [{"tags": [], "owner": {"reputation": 1307, "user_id": 1549736, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/LBwQu.jpg?s=128&g=1", "display_name": "dbanas", "link": "https://stackoverflow.com/users/1549736/dbanas"}, "is_accepted": true, "score": 1, "last_activity_date": 1503228755, "creation_date": 1503228755, "answer_id": 45781674, "question_id": 45777491, "link": "https://stackoverflow.com/questions/45777491/template-haskell-show-instance-not-working/45781674#45781674", "title": "Template Haskell Show instance not working", "body": "<p>Comment from @user2407038, above, gives the answer. Here is the corrected code for <em>mkShow()</em>:</p>\n\n<pre><code>mkShow :: Name -&gt; Q [Dec]\nmkShow typName = do\n  t@(TyConI (DataD _ _ _ _ constructors _)) &lt;- reify typName  -- Get all the information on the type.\n  let func_name = mkName \"show\"\n  let var_name  = mkName \"x\"\n  let clause_decs = map ( \\c@(NormalC nm _) -&gt;\n                            Clause [ConP (simpleName nm) [VarP var_name]]\n                                   (NormalB (AppE (VarE func_name) (VarE var_name)))\n                                   []\n                        )\n                        constructors\n  return [InstanceD Nothing [] (AppT (ConT (mkName \"Show\")) (ConT (simpleName typName))) [FunD func_name clause_decs]]\n</code></pre>\n"}], "owner": {"reputation": 1307, "user_id": 1549736, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/LBwQu.jpg?s=128&g=1", "display_name": "dbanas", "link": "https://stackoverflow.com/users/1549736/dbanas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 45781674, "answer_count": 1, "score": 1, "last_activity_date": 1503228755, "creation_date": 1503189629, "last_edit_date": 1503191122, "question_id": 45777491, "link": "https://stackoverflow.com/questions/45777491/template-haskell-show-instance-not-working", "title": "Template Haskell Show instance not working", "body": "<p>Does anyone know why this code:</p>\n\n<pre><code>module Language.P4.UtilTest where\n\nimport Language.P4.Util (mkShow)\n\ndata Dummy = Bogus    Char\n           | Nonsense Int\n\n$(mkShow ''Dummy)\n</code></pre>\n\n<p>is producing this error:</p>\n\n<pre><code>Davids-Air-2:P4 dbanas$ stack ghc -- UtilTest.hs -ddump-splices\n[1 of 1] Compiling Language.P4.UtilTest ( UtilTest.hs, UtilTest.o )\nUtilTest.hs:24:3-16: Splicing declarations\n    mkShow ''Dummy\n  ======&gt;\n    instance Show Dummy where\n      show (Bogus x) = show x\n      show (Nonsense x) = show x\n\nUtilTest.hs:24:3: error:\n    Conflicting definitions for \u2018show\u2019\n    Bound at: UtilTest.hs:24:3-16\n              UtilTest.hs:24:3-16\n   |\n24 | $(mkShow ''Dummy)\n   |   ^^^^^^^^^^^^^^\n</code></pre>\n\n<p>?</p>\n\n<p>The TH splice expansion looks correct to me.\nIf I comment out the second constructor (<code>Nonsense Int</code>), the code compiles without error. Also, if I enter the TH splice expansion shown, manually, into the code (commenting out the <code>$(mkShow ''Dummy)</code> line, of course), it compiles without error.</p>\n\n<pre><code>mkShow :: Name -&gt; Q [Dec]\nmkShow typName = do\n  t@(TyConI (DataD _ _ _ _ constructors _)) &lt;- reify typName  -- Get all the information on the type.\n  let func_name = mkName \"show\"\n  let var_name  = mkName \"x\"\n  let func_decs = map ( \\c@(NormalC nm _) -&gt; FunD func_name\n                                                  [ Clause [ConP (simpleName nm) [VarP var_name]]\n                                                           (NormalB (AppE (VarE func_name) (VarE var_name)))\n                                                           []\n                                                  ]\n                      )\n                      constructors\n  return [InstanceD Nothing [] (AppT (ConT (mkName \"Show\")) (ConT (simpleName typName))) func_decs]\n\nsimpleName :: Name -&gt; Name\nsimpleName nm =\n   let s = nameBase nm\n   in case dropWhile (/=':') s of\n        []          -&gt; mkName s\n        _:[]        -&gt; mkName s\n        _:t         -&gt; mkName t\n</code></pre>\n"}, {"tags": ["haskell", "monads", "functor"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 7, "creation_date": 1503172875, "post_id": 45775730, "comment_id": 78509455, "body": "Your <code>mmap</code> is, not surprisingly, <code>=&lt;&lt;</code>. Monadic bind is not analogous to function composition; it is more like function application."}, {"owner": {"reputation": 1698, "user_id": 4050510, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f3123195051caa2f71674df0798284b0?s=128&d=identicon&r=PG", "display_name": "LudvigH", "link": "https://stackoverflow.com/users/4050510/ludvigh"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1503182186, "post_id": 45775730, "comment_id": 78511493, "body": "Good point about application/composition chepner. I ended up switching to Kliesli composition (&lt;=&lt;) instead of reverse bind (=&lt;&lt;),"}], "answers": [{"tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": true, "score": 7, "last_activity_date": 1503173664, "creation_date": 1503173664, "answer_id": 45775898, "question_id": 45775730, "link": "https://stackoverflow.com/questions/45775730/what-is-the-name-of-the-monadic-versions-of-fmap/45775898#45775898", "title": "What is the name of the monadic &quot;versions&quot; of fmap?", "body": "<blockquote>\n  <p>Is there a <code>mmap</code> already defined? What is is called?</p>\n</blockquote>\n\n<p><a href=\"https://www.haskell.org/hoogle/\" rel=\"noreferrer\">Hoogle</a> is your friend. The type signature of <a href=\"https://www.haskell.org/hoogle/?hoogle=%28%3E%3E%3D%29\" rel=\"noreferrer\"><code>(&gt;&gt;=)</code></a> is:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>Hence, you're looking for a function with the type signature:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>flip (&gt;&gt;=) :: Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b\n</code></pre>\n\n<p>This is in fact the <a href=\"https://www.haskell.org/hoogle/?hoogle=%28%3D%3C%3C%29\" rel=\"noreferrer\"><code>=&lt;&lt;</code></a> function. Hence, you can write <code>fun3 =&lt;&lt; fun2 =&lt;&lt; fun1</code>.</p>\n\n<blockquote>\n  <p>Why is bind defined as an operator with arguments in an order that feels backwards?</p>\n</blockquote>\n\n<p>It's because monadic code looks a lot like imperative code. For example, consider the following:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>permute2 :: [a] -&gt; [[a]]\npermute2 xs = do\n    x  &lt;- xs\n    xs &lt;- map return xs\n    return (x:xs)\n</code></pre>\n\n<p>Without the syntactic sugar of <code>do</code> it would be written as:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>permute2 :: [a] -&gt; [[a]]\npermute2 xs =\n    xs &gt;&gt;= \\x -&gt;\n    map return xs &gt;&gt;= \\xs -&gt;\n    return (x:xs)\n</code></pre>\n\n<p>See the similarity? If we used <code>=&lt;&lt;</code> instead it would look like:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>permute2 :: [a] -&gt; [[a]]\npermute2 xs = (\\x -&gt; (\\xs -&gt; return (x:xs)) =&lt;&lt; map return xs) =&lt;&lt; xs\n</code></pre>\n\n<p>Not very readable is it?</p>\n"}], "owner": {"reputation": 1698, "user_id": 4050510, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f3123195051caa2f71674df0798284b0?s=128&d=identicon&r=PG", "display_name": "LudvigH", "link": "https://stackoverflow.com/users/4050510/ludvigh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 45775898, "answer_count": 1, "score": 3, "last_activity_date": 1503173664, "creation_date": 1503172229, "question_id": 45775730, "link": "https://stackoverflow.com/questions/45775730/what-is-the-name-of-the-monadic-versions-of-fmap", "title": "What is the name of the monadic &quot;versions&quot; of fmap?", "body": "<p>Having a background in powershell scripting i first thought it natural to think of function composition in a pipe kind of way. That means the syntax for composition should be <code>fun1 | fun2 | fun3</code> in a psudocode kind of way. (where <code>fun[i]</code> is the <code>i</code>'th function to apply in order). This order of functions is also what you find in haskell monadic binds. <code>fun1 &gt;&gt;= fun2 &gt;&gt;= fun3</code>.</p>\n\n<p>But in other occasions in haskell, the order of functions is more math'y, such as <code>fun3 . fun2 . fun1</code>, or in the functorial setting <code>fmap fun3 . fmap fun2 . fmap fun1</code>.</p>\n\n<p>I am very much aware that the functions have different signature in the two examples, but it puzzles me that the structure is reversed, still. My workaround is to sometimes define a function <code>mmap = flip (&gt;&gt;=)</code> such that I can write <code>mmap fun3 . mmap fun2 . mmap fun1</code>.</p>\n\n<p>So to the question:</p>\n\n<ol>\n<li>Is there a <code>mmap</code> already defined? What is is called?</li>\n<li>Why if bind defined as an operator with arguments in an order that feels backwards?</li>\n</ol>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "comments": [{"owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "edited": false, "score": 0, "creation_date": 1503174795, "post_id": 45775326, "comment_id": 78509941, "body": "I think the bug is because it is looking for the path in the wrong drive: D instead of C: <code>ghc.EXE: addLibrarySearchPath: D:\\Users\\Razvan\\AppData\\Local\\Programs\\stack\\x86_64-windows\\&zwnj;&#8203;msys2-20150512\\mingw&zwnj;&#8203;64\\lib\\ (Win32 error 3): The system cannot find the path specified.</code>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1503183165, "post_id": 45775326, "comment_id": 78511636, "body": "<a href=\"https://stackoverflow.com/questions/45210863/unable-to-load-hmatrix-with-stack-ghci\">Here</a> is another question with basically the exact same issue (foreign lib, ghc looking in D:\\.. instead of C:\\.., and (perhaps coincidentally) also using pacman for the foreign lib). This isn&#39;t to do with <code>c++</code>, <code>icu</code>, or <code>haskell-lsp</code>. I suggest you try to reproduce a build w/o <code>stack</code> - if it no longer fails, post this on the <code>stack</code> issue tracker. Otherwise, I&#39;d guess it is either an issue with GHC (less likely) or pacman (more likely)."}, {"owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503183737, "post_id": 45775326, "comment_id": 78511718, "body": "@user2407038 It is weird since I can&#39;t even reproduce the error anymore. Thank you for the obervations, was suspecting it might be ghc issue also, but not sure."}], "owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 305, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1503183211, "creation_date": 1503169333, "last_edit_date": 1503183211, "question_id": 45775326, "link": "https://stackoverflow.com/questions/45775326/building-haskell-ide-engine-error-unknown-symbol-ucnv-getmaxcharsize-58", "title": "Building haskell-ide-engine error - &quot;unknown symbol `ucnv_getMaxCharSize_58&#39;&quot;", "body": "<p>Environment:</p>\n\n<ul>\n<li>Windows 10 64 bit</li>\n<li>MINGW 64 bit</li>\n<li>stack Version 1.5.1, Git revision 600c1f01435a10d127938709556c1682ecfd694e x86_64 hpack-0.17.1</li>\n</ul>\n\n<p>When running <code>stack install</code> I first got the following error:</p>\n\n<pre><code>Missing C libraries: icuuc, icuin, icudt\n</code></pre>\n\n<p><img src=\"https://i.imgur.com/s6gTccc.png\" alt=\"\"></p>\n\n<p>To fix it I run: <code>stack exec -- pacman -Sy mingw64/mingw-w64-x86_64-icu</code></p>\n\n<p>After that the build stopped on another error which seemed to have to do with stack building multiple things at same time.</p>\n\n<p>On running again it passed by that error and it printed the following error:</p>\n\n<pre><code>haskell-lsp-0.1.0.0: build (lib + exe)\nProgress: 1/13\n--  While building package haskell-lsp-0.1.0.0 using:\n  C:\\sr\\setup-exe-cache\\x86_64-windows\\Cabal-simple_Z6RU0evB_1.24.2.0_ghc-8.0.2.exe --builddir=.stack-work\\dist\\ca59d0ab build lib:haskell-lsp exe:lsp-hello --ghc-options \" -ddump-hi -ddump-to-file\"\nProcess exited with code: ExitFailure 1\nLogs have been written to: D:\\Sources\\haskell-ide-engine\\.stack-work\\logs\\haskell-lsp-0.1.0.0.log\n\nPreprocessing library haskell-lsp-0.1.0.0...\n[ 2 of 10] Compiling Language.Haskell.LSP.TH.ClientCapabilities ( src\\Language\\Haskell\\LSP\\TH\\ClientCapabilities.hs, .stack-work\\dist\\ca59d0ab\\build\\Language\\Haskell\\LSP\\TH\\ClientCapabilities.o )\nghc.EXE: unable to load package `text-icu-0.7.0.1'\nghc.EXE: addLibrarySearchPath: D:\\Users\\Razvan\\AppData\\Local\\Programs\\stack\\x86_64-windows\\msys2-20150512\\mingw64\\lib\\ (Win32 error 3): The system cannot find the path specified.\nghc.EXE: C:\\sr\\snapshots\\c7200f2c\\lib\\x86_64-windows-ghc-8.0.2\\text-icu-0.7.0.1-EllpGYmNw3bJ3FIJMPisuJ\\HStext-icu-0.7.0.1-EllpGYmNw3bJ3FIJMPisuJ.o: unknown symbol `ucnv_getMaxCharSize_58'\n</code></pre>\n\n<p>Any suggestions on how to fix it?</p>\n\n<p>Github Issue: <a href=\"https://github.com/alanz/haskell-lsp/issues/56\" rel=\"nofollow noreferrer\">https://github.com/alanz/haskell-lsp/issues/56</a></p>\n"}, {"tags": ["haskell", "haskell-platform"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8488758"}, "edited": false, "score": 0, "creation_date": 1503169565, "post_id": 45775290, "comment_id": 78508552, "body": "Where can I find the directory with the compiled modules?"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1503169679, "post_id": 45775290, "comment_id": 78508580, "body": "It generally depends on what system you are running and what tool you used to build them. <code>stack</code> place stuff in STACK_ROOT and ~/.stack/snapshots, for instance."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8488758"}, "edited": false, "score": 0, "creation_date": 1503170122, "post_id": 45775290, "comment_id": 78508717, "body": "My installation is using <code>cabal</code>, on Windows 8.1. I tried to use Windows search with some keywords, but I did not get any result."}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1503170192, "post_id": 45775290, "comment_id": 78508742, "body": "cabal install into <code>&#47;Users&#47;user&#47;.cabal</code>, IIRC."}], "tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 2, "last_activity_date": 1503169064, "creation_date": 1503169064, "answer_id": 45775290, "question_id": 45775224, "link": "https://stackoverflow.com/questions/45775224/where-can-i-find-the-source-code-of-packages-modules/45775290#45775290", "title": "Where can I find the source code of packages/modules?", "body": "<p>That directory contains compiled modules, so you wouldn't be able to read the source there.</p>\n\n<p>What you can do is to find your function in <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Data-List.html#v:sort\" rel=\"nofollow noreferrer\">online documentation</a> and then click \"Source\" on the right.</p>\n"}, {"tags": [], "owner": {"reputation": 4004, "user_id": 1498178, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/2a7f53f1d991f2ab18a4957a1f192960?s=128&d=identicon&r=PG", "display_name": "toraritte", "link": "https://stackoverflow.com/users/1498178/toraritte"}, "is_accepted": false, "score": 1, "last_activity_date": 1542387861, "creation_date": 1542387861, "answer_id": 53342372, "question_id": 45775224, "link": "https://stackoverflow.com/questions/45775224/where-can-i-find-the-source-code-of-packages-modules/53342372#53342372", "title": "Where can I find the source code of packages/modules?", "body": "<p>As <a href=\"https://stackoverflow.com/a/45775290/1498178\">@arrowd notes in his answer</a>,</p>\n\n<blockquote>\n  <p>That directory contains compiled modules, so you wouldn't be able to\n  read the source there.</p>\n</blockquote>\n\n<p>The <a href=\"http://git.haskell.org/ghc.git\" rel=\"nofollow noreferrer\">GHC repo</a> (and <a href=\"https://github.com/ghc/ghc\" rel=\"nofollow noreferrer\">its Github mirror</a>) can be directly browsed, but there is an easier way: </p>\n\n<ol>\n<li><p><strong>Use <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow noreferrer\">Hoogle</a> or <a href=\"https://www.stackage.org/\" rel=\"nofollow noreferrer\">Stackage</a> to find the package where the module/function resides</strong></p>\n\n<p>Note that <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow noreferrer\">Hoogle</a> and <a href=\"https://www.stackage.org/\" rel=\"nofollow noreferrer\">Stackage</a> are <em>case-sensitive</em>. (It's best to look up modules with their capitalized names.)  </p>\n\n<p>A query for <code>sort</code> in <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow noreferrer\">Hoogle</a> yields  a list similar to the one below. <a href=\"https://www.stackage.org/\" rel=\"nofollow noreferrer\">Stackage</a> has a slightly different style, but the basics are the same (mostly because it uses Hoogle for lookup). The lines in green under the result headings show the name(s) of the containing </p>\n\n<p>(1) package(s) (in small caps) and </p>\n\n<p>(2) module(s) (capitalized).</p>\n\n<p>There can be multiple functions with the same name, but the module and package name helps to choose the right one.</p>\n\n<p><a href=\"https://i.stack.imgur.com/o38kB.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/o38kB.png\" alt=\"Hoogle lookup\"></a></p></li>\n<li><p><strong>Click on the function/module name</strong></p></li>\n<li><p><strong>Click on \"#Source\"</strong> </p>\n\n<p><a href=\"https://i.stack.imgur.com/jeFCn.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/jeFCn.png\" alt=\"Hackage lookup\"></a></p></li>\n</ol>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8488758"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 274, "favorite_count": 0, "accepted_answer_id": 45775290, "answer_count": 2, "score": 1, "last_activity_date": 1542387861, "creation_date": 1503168595, "last_edit_date": 1542351064, "question_id": 45775224, "link": "https://stackoverflow.com/questions/45775224/where-can-i-find-the-source-code-of-packages-modules", "title": "Where can I find the source code of packages/modules?", "body": "<p>I would like to look at the code of functions defined in modules, such as Data.List or Data.Map.</p>\n\n<p>I can import Data.List module with </p>\n\n<pre><code>import Data.List\n</code></pre>\n\n<p>and then I can use the functions <code>nub</code> or <code>sort</code>.</p>\n\n<p>I would like to know where I can find these functions to look at their code.</p>\n\n<p><strong>In which directory are the modules installed by default?</strong></p>\n\n<p>PS: Windows 8.1, I installed Haskell Platform.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 110, "user_id": 3982150, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5b47baacc0b5111efb0f12ea9d315a1c?s=128&d=identicon&r=PG&f=1", "display_name": "FintanH", "link": "https://stackoverflow.com/users/3982150/fintanh"}, "is_accepted": true, "score": 0, "last_activity_date": 1503172576, "creation_date": 1503172576, "answer_id": 45775775, "question_id": 45775144, "link": "https://stackoverflow.com/questions/45775144/how-can-i-write-response-body-of-https-request-to-file-in-haskell/45775775#45775775", "title": "How can I write response body of HTTPS request to file in Haskell?", "body": "<p>Your code:\n<code>body &lt;- (response ^. responseBody)</code></p>\n\n<p>Should be:\n<code>let body = response ^. responseBody</code></p>\n\n<p>To explain the type error you're getting: the compiler is saying <code>Couldn't match type \u2018IO BL.ByteString\u2019 with \u2018BL.ByteString\u2019</code>. So it's saying with the code you wrote it was expecting an <code>IO ByteString</code> but you gave it a <code>ByteString</code>. This is down to the <code>&lt;-</code> operator in the <code>do</code> block. This, desugared, would look like <code>response ^. responseBody &gt;&gt;= \\body -&gt; &lt;rest of code&gt;</code>.</p>\n\n<p>The type of <code>(&gt;&gt;=)</code> is <code>Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b</code>. So the compiler thought you were saying that <code>response ^. responseBody</code> would have the type of <code>m a</code> or more specifically <code>IO a</code> (where <code>a</code> is <code>ByteString</code>).</p>\n\n<p>Luckily we can use <code>let</code> in a <code>do</code> block and assign <code>body</code> that way :)</p>\n"}], "owner": {"reputation": 548, "user_id": 1027846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c6542596c12abd13a7dd4b337b8f6d8?s=128&d=identicon&r=PG", "display_name": "Mustafa \u0130lhan", "link": "https://stackoverflow.com/users/1027846/mustafa-%c4%b0lhan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 45775775, "answer_count": 1, "score": 0, "last_activity_date": 1503172576, "creation_date": 1503168104, "question_id": 45775144, "link": "https://stackoverflow.com/questions/45775144/how-can-i-write-response-body-of-https-request-to-file-in-haskell", "title": "How can I write response body of HTTPS request to file in Haskell?", "body": "<p>I want to write the content of the web page to a file. However I am stuck at file writing part. Because it gives me a type error.</p>\n\n<pre><code>import Control.Lens\nimport qualified Data.ByteString.Lazy as BL\nimport Network.Wreq\n\nwriteURIBodyToFile :: FilePath -&gt; String -&gt; IO()\nwriteURIBodyToFile filePath uri = do\n  response &lt;- get uri\n  body &lt;- (response ^. responseBody)\n  BL.writeFile filePath body\n</code></pre>\n\n<p>Here is the error:</p>\n\n<pre><code>Couldn't match type \u2018IO BL.ByteString\u2019 with \u2018BL.ByteString\u2019\nExpected type: Getting\n                 (IO BL.ByteString) (Response BL.ByteString) (IO BL.ByteString)\n  Actual type: (BL.ByteString\n                -&gt; Const (IO BL.ByteString) BL.ByteString)\n               -&gt; Response BL.ByteString\n               -&gt; Const (IO BL.ByteString) (Response BL.ByteString)\nIn the second argument of \u2018(^.)\u2019, namely \u2018responseBody\u2019\nIn a stmt of a 'do' block: body &lt;- (response ^. responseBody)\n</code></pre>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["haskell", "parallel-processing"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1503164106, "post_id": 45773761, "comment_id": 78506964, "body": "How were they compiled and run? Please show full command lines."}], "owner": {"reputation": 466, "user_id": 8301676, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-9sxaRcYasSk/AAAAAAAAAAI/AAAAAAAAADM/88G9HkhtcPc/photo.jpg?sz=128", "display_name": "V\u0169 T&#244;", "link": "https://stackoverflow.com/users/8301676/v%c5%a9-t%c3%b4"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 163, "favorite_count": 0, "answer_count": 0, "score": 7, "last_activity_date": 1503164289, "creation_date": 1503159615, "last_edit_date": 1503164289, "question_id": 45773761, "link": "https://stackoverflow.com/questions/45773761/parlist-vs-partraversable", "title": "parList vs parTraversable", "body": "<p>I found a \"strange\" behavior here. I got this:</p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\n\nimport Data.List\nimport Control.Parallel\nimport Control.Parallel.Strategies\n\nfib 0 = 1\nfib 1 = 1\nfib n = fib (n-1) + fib (n-2)\n\nmain =\n  let xs = [ fib (20 + n `mod` 2) | n &lt;- [0..1000] ]\n              `using` test rseq\n   in print (sum xs)\n\ntest :: Strategy a -&gt; Strategy [a]\ntest strat xs = do\n  parTraversable strat xs  -- case #1\n  -- parList strat xs      -- case #2\n  return xs\n</code></pre>\n\n<p><code>case #1</code> means using <code>parTraversable</code>, <code>case #2</code> means using <code>parList</code>. The results are different:</p>\n\n<pre><code>case #1: SPARKS: 1001 (1 converted, 0 overflowed, 0 dud, 1000 GC'd, 0 fizzled)\ncase #2: SPARKS: 1001 (1000 converted, 0 overflowed, 0 dud, 0 GC'd, 1 fizzled)\n</code></pre>\n\n<p>As far as I know, <code>parList</code> is the same as <code>parTraversable</code>. In <code>Control/Parallel/Strategies.hs</code>:</p>\n\n<pre><code>parTraversable :: Traversable t =&gt; Strategy a -&gt; Strategy (t a)\nparTraversable strat = evalTraversable (rparWith strat)\n\nparList :: Strategy a -&gt; Strategy [a]\nparList = parTraversable\n</code></pre>\n\n<p>So I supposed they have to act the same. Anything need to be uncover here?</p>\n\n<p><strong>Update #1</strong>:</p>\n\n<p>Commands to compile and run:</p>\n\n<pre><code>stack ghc -- -O2 -threaded -rtsopts -eventlog parlist2.hs\n./parList2 +RTS -N2 -s\n</code></pre>\n"}, {"tags": ["haskell", "streaming"], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 2, "last_activity_date": 1503205308, "last_edit_date": 1503205308, "creation_date": 1503181618, "answer_id": 45776818, "question_id": 45773251, "link": "https://stackoverflow.com/questions/45773251/how-to-implement-folds-and-foldsm-from-pipes-group-for-the-streaming-package/45776818#45776818", "title": "How to implement folds and foldsM from pipes-group for the streaming package?", "body": "<p>It looks like <code>Streaming.mapped</code> is the key tool.</p>\n\n<pre><code>mapped :: (Monad m, Functor f)\n       =&gt; (forall x. f x -&gt; m (g x)) \n       -&gt; Stream f m r\n       -&gt; Stream g m r\n\nmapped :: (Monad m, Functor f)\n       =&gt; (forall x. Stream f m x -&gt; m (g x))\n       -&gt; Stream (Stream f m) m r\n       -&gt; Stream g m r\n\nmapped :: Monad m\n       =&gt; (forall x. Stream (Of a) m x -&gt; m (Of b x))\n       -&gt; Stream (Stream (Of a) m) m r\n       -&gt; Stream (Of b) m r\n</code></pre>\n\n<p>We also have the relevant provided folds,</p>\n\n<pre><code>fold :: Monad m\n     =&gt; (x -&gt; a -&gt; x) -&gt; x -&gt; (x -&gt; b)\n     -&gt; Stream (Of a) m r -&gt; m (Of b r)\n\nfoldM :: Monad m\n      =&gt; (x -&gt; a -&gt; m x) -&gt; m x -&gt; (x -&gt; m b)\n      -&gt; Stream (Of a) m r -&gt; m (Of b r)\n</code></pre>\n\n<p>So you should be able to apply <code>mapped</code> to a partially applied <code>fold</code> or <code>foldM</code> to produce a stream of summaries.</p>\n\n<p>Caution: I have not yet attempted this.</p>\n"}], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 45776818, "answer_count": 1, "score": 2, "last_activity_date": 1503205308, "creation_date": 1503156211, "question_id": 45773251, "link": "https://stackoverflow.com/questions/45773251/how-to-implement-folds-and-foldsm-from-pipes-group-for-the-streaming-package", "title": "How to implement folds and foldsM from pipes-group for the streaming package?", "body": "<p>The <a href=\"http://hackage.haskell.org/package/pipes-group-1.0.7\" rel=\"nofollow noreferrer\">pipes-group</a> library lets you delimit groups in effectful streams without having to hold an entire group in memory at any time.</p>\n\n<p>Two useful function from pipes-groups are <a href=\"http://hackage.haskell.org/package/pipes-group-1.0.7/docs/Pipes-Group.html#v:folds\" rel=\"nofollow noreferrer\"><code>folds</code></a> and <a href=\"http://hackage.haskell.org/package/pipes-group-1.0.7/docs/Pipes-Group.html#v:foldsM\" rel=\"nofollow noreferrer\"><code>foldsM</code></a>:</p>\n\n<blockquote>\n  <p>folds :: Monad m  => (x -> a -> x) -> x   -> (x -> b) -> FreeT (Producer\n  a m) m r   -> Producer b m r</p>\n  \n  <p>foldsM :: Monad m => (x -> a -> m x) -> m x   -> (x -> m b) -> FreeT\n  (Producer a m) m r -> Producer b m r</p>\n</blockquote>\n\n<p>They summarize each group within a delimited stream and return a stream of the results.</p>\n\n<p>The <a href=\"http://hackage.haskell.org/package/streaming-0.1.4.5\" rel=\"nofollow noreferrer\">streaming</a> package <a href=\"http://hackage.haskell.org/package/streaming-0.1.4.5/docs/Streaming-Prelude.html#g:5\" rel=\"nofollow noreferrer\">also supports delimited streams</a>, by using the <code>Stream</code> type itself as the functor parameter:</p>\n\n<blockquote>\n  <p>Stream (Stream (Of a) m) m r</p>\n</blockquote>\n\n<p>There doesn't seem to exist direct analogues of <code>folds</code> and <code>foldsM</code> though.\n (Folds for undivided streams <a href=\"http://hackage.haskell.org/package/streaming-0.1.4.5/docs/Streaming-Prelude.html#g:7\" rel=\"nofollow noreferrer\">do exist</a>).</p>\n\n<p>How to implement these functions with the machinery of <em>streaming</em>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1503156138, "post_id": 45773213, "comment_id": 78504465, "body": "It&#39;s called an <a href=\"https://wiki.haskell.org/Section_of_an_infix_operator\" rel=\"nofollow noreferrer\">operator section</a>."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1503156292, "post_id": 45773213, "comment_id": 78504510, "body": "<code>(&lt; 3)</code> is the same as <code>\\x -&gt; x &lt; 3</code>, or <code>\\x -&gt; (&lt;) x 3</code>. Does it make sense now? Which of the two results (<code>False</code> for the first or <code>True</code> for the second) is the unexpected one?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1503163124, "post_id": 45773213, "comment_id": 78506654, "body": "<code>(x &lt; y)  =  (x &lt;) y  =  (&lt; y) x  =  (&lt;) x y  =  ((&lt;) x) y</code>."}], "answers": [{"tags": [], "owner": {"reputation": 97030, "user_id": 189205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c60305494593d556e57a3cf8e4a8c163?s=128&d=identicon&r=PG", "display_name": "interjay", "link": "https://stackoverflow.com/users/189205/interjay"}, "is_accepted": false, "score": 9, "last_activity_date": 1503221064, "last_edit_date": 1503221064, "creation_date": 1503156262, "answer_id": 45773257, "question_id": 45773213, "link": "https://stackoverflow.com/questions/45773213/difference-between-haskell-x-y-and-x-y/45773257#45773257", "title": "Difference between Haskell ((&lt; x) y) and (((&lt;) x) y)", "body": "<p><code>(&lt;) 3</code> applies <code>3</code> as the first (left) argument of <code>&lt;</code>. So <code>(&lt;) 3 2</code> is the same as <code>3 &lt; 2</code>.</p>\n\n<p><code>(&lt; 3)</code> is a <a href=\"https://wiki.haskell.org/Section_of_an_infix_operator\" rel=\"nofollow noreferrer\">section</a> that applies <code>3</code> as the right operand of <code>&lt;</code>. This is special syntax that can be used with binary infix operators. So <code>(&lt; 3) 2</code> is the same as <code>2 &lt; 3</code>.</p>\n\n<p>To apply <code>3</code> as the left operand with a section, you would write: <code>(3 &lt;)</code>. So <code>(3 &lt;) 2</code> is the same as <code>3 &lt; 2</code>.</p>\n\n<p>Demonstrating with lambdas: <code>(&lt; 3)</code> is the same as <code>\\x -&gt; x &lt; 3</code>, and <code>(3 &lt;)</code> is the same as <code>\\x -&gt; 3 &lt; x</code>.</p>\n"}], "owner": {"reputation": 143, "user_id": 4398524, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-cJJWF3Vsajc/AAAAAAAAAAI/AAAAAAAAAAA/LgmVS1-OBRE/photo.jpg?sz=128", "display_name": "Greg C", "link": "https://stackoverflow.com/users/4398524/greg-c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1503221064, "creation_date": 1503155987, "question_id": 45773213, "link": "https://stackoverflow.com/questions/45773213/difference-between-haskell-x-y-and-x-y", "title": "Difference between Haskell ((&lt; x) y) and (((&lt;) x) y)", "body": "<p>I can't wrap my head around why these would be different.:</p>\n\n<pre><code>Prelude&gt; :t ((&lt;) 3)\n((&lt;) 3) :: (Num a, Ord a) =&gt; a -&gt; Bool\nPrelude&gt; ((&lt;) 3) 2\nFalse\nPrelude&gt; \n\nPrelude&gt; :t (&lt; 3)\n(&lt; 3) :: (Num a, Ord a) =&gt; a -&gt; Bool\nPrelude&gt; (&lt; 3) 2\nTrue\nPrelude&gt; \n</code></pre>\n\n<p>I suspect there's a straightforward answer, but I don't even know what words to use to describe the difference between the first and second cases. I'm happy to edit my question to use proper nomenclature once someone tells me what it is in this case.</p>\n"}, {"tags": ["haskell", "types", "typeclass", "induction"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1503155941, "post_id": 45773151, "comment_id": 78504396, "body": "&quot;I&#39;ve tried using readsPrec and readPrec, but I only get mismatched type errors.&quot; - this is the correct way to go. You should include your type errors. <code>readPrec = fmap fromInteger . readPrec</code> should work. (Aside: <code>show $ fromEnum x</code> will give an error for naturals which don&#39;t fit into <code>Int</code>. You should implement <code>Integral Natural</code> and then write <code>show $ toInteger x</code>)"}], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 4907247, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-MC3f7YZnmzI/AAAAAAAAAAI/AAAAAAAAHko/F5e6WGnLVtM/photo.jpg?sz=128", "display_name": "Alex Danilov", "link": "https://stackoverflow.com/users/4907247/alex-danilov"}, "edited": false, "score": 0, "creation_date": 1503156719, "post_id": 45773233, "comment_id": 78504628, "body": "I&#39;m new to Haskell and what you wrote seems hard to me. Could you suggest me some ways to implement <code>showsPrec</code> instead of <code>show</code>?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 53, "user_id": 4907247, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-MC3f7YZnmzI/AAAAAAAAAAI/AAAAAAAAHko/F5e6WGnLVtM/photo.jpg?sz=128", "display_name": "Alex Danilov", "link": "https://stackoverflow.com/users/4907247/alex-danilov"}, "edited": false, "score": 1, "creation_date": 1503156984, "post_id": 45773233, "comment_id": 78504713, "body": "Same way I&#39;ve implemented <code>readsPrec</code>, namely in terms of <code>showsPrec p n</code> where <code>n</code> is an <code>Int</code>. You already have a way to build an <code>Int</code> out of a <code>Natural</code>. Unfortunately, both <code>readsPrec</code> and <code>showsPrec</code> use slightly &quot;obfuscated&quot; types due to <code>ReadS</code> and <code>ShowS</code>, but it gets slightly easier if you wrote them out."}, {"owner": {"reputation": 53, "user_id": 4907247, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-MC3f7YZnmzI/AAAAAAAAAAI/AAAAAAAAHko/F5e6WGnLVtM/photo.jpg?sz=128", "display_name": "Alex Danilov", "link": "https://stackoverflow.com/users/4907247/alex-danilov"}, "edited": false, "score": 0, "creation_date": 1503158399, "post_id": 45773233, "comment_id": 78505135, "body": "According to <code>:i showsPrec</code> and <code>:i ShowS</code>, I got the full signature for showsPrec: <code>showsPrec :: Int -&gt; a -&gt; String -&gt; String</code>. But you&#39;ve written <code>showsPrec p n</code> (only 2 arguments). Where am I wrong?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 53, "user_id": 4907247, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-MC3f7YZnmzI/AAAAAAAAAAI/AAAAAAAAHko/F5e6WGnLVtM/photo.jpg?sz=128", "display_name": "Alex Danilov", "link": "https://stackoverflow.com/users/4907247/alex-danilov"}, "edited": false, "score": 0, "creation_date": 1503161307, "post_id": 45773233, "comment_id": 78506046, "body": "I&#39;m not sure whether you know this already, but instead of writing <code>addFive x = (+) 5 x</code>, one can also write <code>addFive = (+) 5</code>. This is called partial application. But you can be explicit and write <code>showsPrec p n s = showsPrec p (magic n) s</code> (where you have to replace <code>magic</code> with another function)."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 5, "last_activity_date": 1503156113, "creation_date": 1503156113, "answer_id": 45773233, "question_id": 45773151, "link": "https://stackoverflow.com/questions/45773151/implementing-instance-of-read-typeclass-in-haskell/45773233#45773233", "title": "Implementing instance of Read typeclass in haskell", "body": "<p>Your function has the wrong type. Your <code>readsPrec</code> has type <code>String -&gt; Natural</code>, whereas you should have used <code>Int -&gt; String -&gt; [(Natural, String)]</code>. But we can adjust that:</p>\n\n<pre><code>readsPrec p s = [(fromInteger i, s') | (i, s') &lt;- readsPrec p s]\n</code></pre>\n\n<p>This uses <code>Integer</code>'s <code>readsPrec</code> function. Since you want to read <code>Integer</code>s it's just fitting to use it for convenience.</p>\n\n<p>For symmetry reasons, I suggest you to implement<code>showsPrec</code> instead of <code>show</code> in your <code>Show</code> instance.</p>\n"}], "owner": {"reputation": 53, "user_id": 4907247, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-MC3f7YZnmzI/AAAAAAAAAAI/AAAAAAAAHko/F5e6WGnLVtM/photo.jpg?sz=128", "display_name": "Alex Danilov", "link": "https://stackoverflow.com/users/4907247/alex-danilov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 670, "favorite_count": 1, "accepted_answer_id": 45773233, "answer_count": 1, "score": 2, "last_activity_date": 1503156113, "creation_date": 1503155644, "question_id": 45773151, "link": "https://stackoverflow.com/questions/45773151/implementing-instance-of-read-typeclass-in-haskell", "title": "Implementing instance of Read typeclass in haskell", "body": "<p>I've been playing around with inductive types (defined natural numbers and arithmetic operations on them) a little bit, and I can't get Haskell read function to work.</p>\n\n<p>Here's my code:</p>\n\n<pre><code>data Natural = Zero | Succ Natural\n    deriving (Eq, Ord)\n\ninstance Enum Natural where\n    pred Zero = undefined\n    pred (Succ x) = x\n\n    succ x = Succ x\n\n    toEnum 0 = Zero\n    toEnum x = Succ (toEnum (x - 1))\n\n    fromEnum Zero = 0\n    fromEnum (Succ x) = fromEnum x + 1\n\ninstance Num Natural where\n    (+) x Zero = x\n    (+) x (Succ y) = Succ (x + y)\n\n    (-) Zero (Succ x) = undefined\n    (-) x Zero = x\n    (-) (Succ x) (Succ y) = x - y\n\n    (*) x Zero = Zero\n    (*) x (Succ y) = x * y + x\n\n    abs x = x\n\n    signum Zero = Zero\n    signum (Succ x) = Succ Zero\n\n    fromInteger 0 = Zero\n    fromInteger x = Succ (fromInteger (x - 1))\n\ninstance Show Natural where\n    show x = show $ fromEnum x\n\n-- Not working!\n\ninstance Read Natural where\n    readsPrec x = fromInteger $ (read x) :: Integer\n</code></pre>\n\n<p>I want this expression to be valid:\n    <code>naturalNumber = read someStringWithInteger :: Natural</code>, so I can't just derive Read typeclass.</p>\n\n<p>I've tried using <code>readsPrec</code> and <code>readPrec</code>, but I only get mismatched type errors.</p>\n\n<p><strong>How do I implement an instance of Read typeclass?</strong></p>\n"}, {"tags": ["haskell", "command-line-interface", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 674, "user_id": 7478655, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/UL7XU.jpg?s=128&g=1", "display_name": "vrom911", "link": "https://stackoverflow.com/users/7478655/vrom911"}, "edited": false, "score": 0, "creation_date": 1503175769, "post_id": 45774738, "comment_id": 78510173, "body": "I know that I can read arguments with <code>getArgs</code>. But how can I pass my custom user-defined arguments so they can be used in hooks?"}], "tags": [], "owner": {"reputation": 21, "user_id": 2980842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/420629359fdd3c6dce1a7029732fe3fb?s=128&d=identicon&r=PG&f=1", "display_name": "wbj", "link": "https://stackoverflow.com/users/2980842/wbj"}, "is_accepted": false, "score": 0, "last_activity_date": 1503165537, "creation_date": 1503165537, "answer_id": 45774738, "question_id": 45773025, "link": "https://stackoverflow.com/questions/45773025/how-to-pass-custom-command-line-arguments-to-setup-hs/45774738#45774738", "title": "How to pass custom command line arguments to Setup.hs", "body": "<p>It may depends on what's your customized build process. <code>Setup.hs</code> has a main function, so you can parse arguments by <code>getArgs</code> and do specific things; or if you'd like to pass the arguments along then you can use <code>UserHooks</code>, such as:</p>\n\n<pre><code>defaultMainWithHooks (simpleUserHooks {preBuild = xxx, postClean = yyy, ... } )\n</code></pre>\n\n<p>Each hook accepts <code>Args</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 674, "user_id": 7478655, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/UL7XU.jpg?s=128&g=1", "display_name": "vrom911", "link": "https://stackoverflow.com/users/7478655/vrom911"}, "is_accepted": true, "score": 1, "last_activity_date": 1503231096, "creation_date": 1503231096, "answer_id": 45781982, "question_id": 45773025, "link": "https://stackoverflow.com/questions/45773025/how-to-pass-custom-command-line-arguments-to-setup-hs/45781982#45781982", "title": "How to pass custom command line arguments to Setup.hs", "body": "<p>Apparently I haven't found better solution than using custom environment variable. And in <code>Setup.hs</code> you can call <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/System-Environment.html#v:lookupEnv\" rel=\"nofollow noreferrer\"><code>lookupEnv</code></a> function to check the desired environment variable.</p>\n\n<p>Also, there is <a href=\"http://shakebuild.com/\" rel=\"nofollow noreferrer\">Shake</a> build tool which is designed to customize building process and should be preferred to <code>Setup.hs</code> configurations.</p>\n"}], "owner": {"reputation": 674, "user_id": 7478655, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/UL7XU.jpg?s=128&g=1", "display_name": "vrom911", "link": "https://stackoverflow.com/users/7478655/vrom911"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 45781982, "answer_count": 2, "score": 2, "last_activity_date": 1503231096, "creation_date": 1503154906, "question_id": 45773025, "link": "https://stackoverflow.com/questions/45773025/how-to-pass-custom-command-line-arguments-to-setup-hs", "title": "How to pass custom command line arguments to Setup.hs", "body": "<p>I have <code>stack</code> project. I want to be able to pass my own arguments to <code>Setup.hs</code> so that I could customize building process. How can I do that?</p>\n"}, {"tags": ["haskell", "testing", "config", "travis-ci", "software-distribution"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1503155027, "post_id": 45772912, "comment_id": 78504093, "body": "Where do you actually use <code>ARGS</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1503171054, "post_id": 45773097, "comment_id": 78508979, "body": "So each value of <code>RESOLVER</code> will be used in turn?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1503177761, "post_id": 45773097, "comment_id": 78510651, "body": "@raxacoricofallapatorius yes, each environment will be used in turn."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1503179036, "post_id": 45773097, "comment_id": 78510921, "body": "Ah, I see: I misread &quot;does not respect <code>ARGS</code>&quot; to mean that Travis didn&#39;t have a clever way of using <code>env</code>."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 2, "last_activity_date": 1503155372, "creation_date": 1503155372, "answer_id": 45773097, "question_id": 45772912, "link": "https://stackoverflow.com/questions/45772912/how-do-specify-the-resolver-and-ghc-travis-should-use-to-test-my-haskell-packa/45773097#45773097", "title": "How do specify the resolver (and GHC) Travis should use to test my Haskell package?", "body": "<p>With <code>env</code> you just define environment variables. You still have to use them. <code>stack</code> on its own does not respect the <code>ARGS</code> variable, so use it in your script, e.g.</p>\n\n\n\n<pre class=\"lang-yaml prettyprint-override\"><code>install:\n# Build dependencies\n- stack $ARGS --no-terminal --install-ghc test --only-dependencies\n\nscript:\n# Build the package, its tests, and its docs and run the tests\n- stack $ARGS --no-terminal --install-ghc test --haddock --no-haddock-deps\n</code></pre>\n\n<p>You should probably use a better name, for example <code>RESOLVER</code>:</p>\n\n<pre class=\"lang-yaml prettyprint-override\"><code>env:\n- RESOLVER=lts-4.0\n- RESOLVER=lts-6.0\n- RESOLVER=lts-8.0\n\ninstall:\n# Build dependencies\n- stack --resolver $RESOLVER --no-terminal --install-ghc test --only-dependencies\n\nscript:\n# Build the package, its tests, and its docs and run the tests\n- stack --resolver $RESOLVER --no-terminal --install-ghc test --haddock --no-haddock-deps\n</code></pre>\n\n<p>Also keep in mind that it's usually a better idea to use multiple <code>stack.yml</code> to hold the configuration for that specific LTS variant.</p>\n\n<p>For more information, see <a href=\"https://docs.haskellstack.org/en/stable/travis_ci/\" rel=\"nofollow noreferrer\"><code>stack</code>'s Travis documentation</a> and <a href=\"https://docs.travis-ci.com/user/environment-variables/\" rel=\"nofollow noreferrer\">Travis' environment variables documentation</a>.</p>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 1, "accepted_answer_id": 45773097, "answer_count": 1, "score": 0, "last_activity_date": 1503155372, "creation_date": 1503154318, "question_id": 45772912, "link": "https://stackoverflow.com/questions/45772912/how-do-specify-the-resolver-and-ghc-travis-should-use-to-test-my-haskell-packa", "title": "How do specify the resolver (and GHC) Travis should use to test my Haskell package?", "body": "<p>I'm trying to test <a href=\"https://hackage.haskell.org/package/crypto-enigma\" rel=\"nofollow noreferrer\">my Haskell package</a> against several <a href=\"https://www.stackage.org\" rel=\"nofollow noreferrer\">Stackage</a> resolvers on <a href=\"https://travis-ci.org/orome/crypto-enigma-hs\" rel=\"nofollow noreferrer\">Travis</a>, but my <code>--resolver</code> environment variable is being ignored.</p>\n\n<p>For example, if I specify </p>\n\n<pre><code>env:\n- ARGS=\"--resolver lts-4.0\"\n</code></pre>\n\n<p>in my <a href=\"https://github.com/orome/crypto-enigma-hs/blob/develop/.travis.yml\" rel=\"nofollow noreferrer\"><code>.travis.yml</code></a>,  I still still seem to be using a different resolver (the one in <a href=\"https://github.com/orome/crypto-enigma-hs/blob/develop/stack.yaml\" rel=\"nofollow noreferrer\">my <code>stack.yaml</code></a>?) and GHC, as shown by lines like </p>\n\n<pre><code>Installing library in\n/home/travis/build/orome/crypto-enigma-hs/.stack-work/install/x86_64-linux/lts-9.1/8.0.2/lib/x86_64-linux-ghc-8.0.2/crypto-enigma-0.0.2.9-6Cs7XSzJkwSDxsEMnLKb0X\n</code></pre>\n\n<p>in the corresponding <a href=\"https://travis-ci.org/orome/crypto-enigma-hs/jobs/266286949\" rel=\"nofollow noreferrer\">build log</a>, which indicates a different resolver (9.1), and corresponding GHC (8.0.2) being used.</p>\n\n<p>How should my build (<code>stack.yaml</code>, <code>.travis.yml</code>, etc.) be configured to ensure that the resolvers (and corresponding GHC) I specify are used to preform my Travis builds and tests? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1503148724, "post_id": 45771847, "comment_id": 78502114, "body": "I think that example is meant to be informal, an not real Haskell code. That&#39;s not made explicit in the example text, which makes it quite confusing. Anyway, I&#39;d say you are correct above. A real working definition is shown below the informal example, and is called <code>RealRepUserTree</code> (&quot;real&quot; points out that the first one was a dummy) but it&#39;s much more complex."}], "answers": [{"tags": [], "owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "is_accepted": false, "score": 0, "last_activity_date": 1525962958, "creation_date": 1525962958, "answer_id": 50275434, "question_id": 45771847, "link": "https://stackoverflow.com/questions/45771847/haskell-generics-documentation-incorrect/50275434#50275434", "title": "haskell generics documentation incorrect?", "body": "<p>It is just a dummy example to give you an idea of what it is doing because the details are a bit more complex. But it might be worth understanding why it doesn't compile because it is good to understand what is going wrong in these situations if you want to do any sort of type level programming in Haskell.</p>\n\n<p>If you look at the type parameters of <code>(:+:)</code> and <code>(:*:)</code>, you can see that they each take three types, <code>f g p</code>. They are both kind <code>* -&gt; * -&gt; * -&gt; *</code>.</p>\n\n<pre><code>data (:+:) f g p = L1 (f p) | R1 (g p)\ndata (:*:) f g p = f p :*: g p\n</code></pre>\n\n<p>and <code>p</code> is given to <code>f</code> and <code>g</code>, so we know that <code>f</code> and <code>g</code> must be at least kind <code>* -&gt; *</code>. The <code>UserTree</code> type's kind is <code>* -&gt; *</code>.</p>\n\n<pre><code>data UserTree a = Node a (UserTree a) (UserTree a) | Leaf\n</code></pre>\n\n<p>but in the declaration we have <code>UserTree a</code>, which is of kind <code>*</code> whereas what (:*:) is expecting two things of at least kind <code>* -&gt; *</code>.</p>\n\n<pre><code>type RepUserTree a = U1 :+: a :*: UserTree a :*: UserTree a\n</code></pre>\n\n<p>If you remove the <code>a</code> you get it to compile.</p>\n\n<pre><code>type RepUserTree a = U1 :+: a :*: UserTree :*: UserTree\n</code></pre>\n\n<p>Now look at <code>U1</code>, <code>K1</code> and <code>M1</code> they all end in the <code>p</code> parameter. Notice that in the <code>RealRepUserTree</code> example, <code>U1</code>, <code>K1</code> and <code>M1</code> all take one type less they than can. These meets the requirements of both <code>(:+:)</code> and <code>(:*:)</code>.</p>\n"}], "owner": {"reputation": 1, "user_id": 8487800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7cfa11f3b90053bc541d7e9e3d2cc081?s=128&d=identicon&r=PG&f=1", "display_name": "Disnesquick", "link": "https://stackoverflow.com/users/8487800/disnesquick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 49, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1525962958, "creation_date": 1503147709, "last_edit_date": 1503148133, "question_id": 45771847, "link": "https://stackoverflow.com/questions/45771847/haskell-generics-documentation-incorrect", "title": "haskell generics documentation incorrect?", "body": "<p>I've been going through the <a href=\"https://wiki.haskell.org/GHC.Generics\" rel=\"nofollow noreferrer\">GHC Generics documentation here</a> and it seems the example code is incorrect. The part I have trouble with is this:</p>\n\n<pre><code>type RepUserTree a =\n  -- A UserTree is either a Leaf, which has no arguments\n      U1\n  -- ... or it is a Node, which has three arguments that we put in a product\n  :+: a :*: UserTree a :*: UserTree a\n</code></pre>\n\n<p>given that the the <code>(:*:)</code> type operator is defined as <code>data (:*:) f g p = f p :*: g p</code>, as expected, the above bit of code gives the kind error:</p>\n\n<pre><code> Blockquotetest.hs:26:13: error:\n    \u2022 Expecting one fewer argument to \u2018UserTree a\u2019\n      Expected kind \u2018* -&gt; *\u2019, but \u2018UserTree a\u2019 has kind \u2018*\u2019\n    \u2022 In the first argument of \u2018:*:\u2019, namely \u2018UserTree a\u2019\n      In the second argument of \u2018:*:\u2019, namely \u2018UserTree a :*: UserTree a\u2019\n      In the second argument of \u2018:+:\u2019, namely\n        \u2018a :*: (UserTree a :*: UserTree a)\u2019\n</code></pre>\n\n<p>Is the documentation incorrect? Am I missing an extension that makes the above work? I'm not really sure how to go about changing the above to compile.</p>\n"}, {"tags": ["haskell", "parallel-processing"], "owner": {"reputation": 466, "user_id": 8301676, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-9sxaRcYasSk/AAAAAAAAAAI/AAAAAAAAADM/88G9HkhtcPc/photo.jpg?sz=128", "display_name": "V\u0169 T&#244;", "link": "https://stackoverflow.com/users/8301676/v%c5%a9-t%c3%b4"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1503147115, "creation_date": 1503147115, "question_id": 45771760, "link": "https://stackoverflow.com/questions/45771760/how-sparks-are-counted-as-gcd", "title": "How Sparks are counted as GC&#39;d?", "body": "<p>I'm experiment with Parallel and Concurrency in Haskell, and come up with this problem. I have 2 functions that evaluate each element of a list in parallel:</p>\n\n<pre><code>    parMap' :: (a -&gt; b) -&gt; [a] -&gt; Eval [b]\n    parMap' f [] = return []\n    parMap' f (a:as) = do\n       b &lt;- rpar (f a)\n       bs &lt;- parMap' f as\n       return (b:bs)\n\n    parListWHNF :: Strategy [a]\n    parListWHNF xs = go xs `pseq` return xs\n      where -- go :: [a] -&gt; [a]\n        go []     = []\n        go (y:ys) = y `par` go ys\n</code></pre>\n\n<p>If I use them directly, everything is just fine (all the sparks was converted):</p>\n\n<pre><code>    let solutions = runEval (parMap' solve puzzles)\nresult: SPARKS: 1000 (1000 converted, 0 overflowed, 0 dud, 0 GC'd, 0 fizzled)\n\n    let solutions = map solve puzzles `using` parListWHNF\nresult: SPARKS: 1000 (1000 converted, 0 overflowed, 0 dud, 0 GC'd, 0 fizzled)\n</code></pre>\n\n<p>But if I wrap them inside another function like this:</p>\n\n<pre><code>    parList' :: (NFData a) =&gt; Strategy a -&gt; Strategy [a]\n    parList' strat xs = do\n      parMap' id xs          -- case #1\n      -- parListWHNF xs      -- case #2\n      return xs\n\n    let solutions = map solve puzzles `using` parList' rseq\n</code></pre>\n\n<p>Then, only <code>case #2</code> works (all the sparks was converted), <code>case #1</code> results in a lot of sparks were GC'd:</p>\n\n<pre><code>    SPARKS: 1000 (3 converted, 0 overflowed, 0 dud, 997 GC'd, 0 fizzled)\n</code></pre>\n\n<p>Anyone can explain this plz ?</p>\n"}, {"tags": ["javascript", "haskell", "promise", "monads", "es6-promise"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1503142446, "post_id": 45770915, "comment_id": 78500118, "body": "I would consider that to be a monad. Being used to Haskell, I find the automagic processing (join, map) a bit confusing, but underneath that magic there&#39;s still a monad. I guess if I really wanted a less magic behavior I could wrap the promise inside some object, and construct something like <code>m (Identity (m a))</code>, so that the join does not happen. Inconvenient, but doable."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 4, "creation_date": 1503143867, "post_id": 45770915, "comment_id": 78500558, "body": "Well, do the laws hold? That&#39;s all you have to check."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1503144453, "post_id": 45770915, "comment_id": 78500783, "body": "As you&#39;ve noted, for promises to have any chance of being a monad, you&#39;ll have to do some handwaving. So begin with some hypothetical operations similar to the ones implemented by promises (i.e. <code>return</code> which doesn&#39;t also <code>join</code>, <code>bind</code> which has an unambiguous type) and then prove the monad laws for these functions. Once you&#39;ve done that, attempt to concretely implement these in terms of actual promise functions. In my mind, this would be a reasonable proof - the 1st (and more important) part being formal, the 2nd being &#39;informal&#39; or hand-wavy."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 2, "creation_date": 1503146815, "post_id": 45770915, "comment_id": 78501544, "body": "&quot;<i>I cannot think of a meaningful semantics for <code>Promise (Promise a)</code></i>&quot; - they&#39;re the same semantics as for any other <code>Promise x</code>, and that&#39;s what makes them meaningful."}, {"owner": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1559099410, "post_id": 45770915, "comment_id": 99309746, "body": "@Zeta Indeed, and in this case the laws don&#39;t hold: <a href=\"https://stackoverflow.com/a/50173415/1614973\">stackoverflow.com/a/50173415/1614973</a>"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1503154726, "post_id": 45772042, "comment_id": 78503997, "body": "&quot;<i>destroys referential transparency if we consider execution order</i>&quot;. This is very interesting. I need to reason about it..."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1503158947, "post_id": 45772042, "comment_id": 78505305, "body": "Also when promises are nested the inner ones would be able to access the outer promises scope. This might be useful to pass values directly without using global variables or returning objects by means of object destructuring to pass multiple arguments to the next <code>.then</code> stage."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1503165948, "post_id": 45772042, "comment_id": 78507489, "body": "@Redu Not sure, do you mean that in <code>ppx.then(px =&gt; px.then(x =&gt; \u2026</code> the <code>px</code> promise is scope? I don&#39;t see how that&#39;s particularly useful. We <a href=\"https://stackoverflow.com/a/28250687/1048572\">can always &quot;pass&quot; values by simply nesting <code>then</code> calls</a>, similar to what <code>async</code>/<code>await</code> or monadic <code>do</code> notation desugar, we don&#39;t need promises of promises for that."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1503175393, "post_id": 45772042, "comment_id": 78510086, "body": "I dont think in JS by any means you can do like <code>ppx.then(px =&gt; px.then(x =&gt; ...)</code> at least not in the sense of <code>Promise err1 (Promise err2 a)</code>.  What i&#39;d meant was <code>Promise.resolve(2).then(v =&gt; (y = (x =&gt; 2*x)(v), Promise.resolve(y+3))).then(v =&gt; console.log(v));</code>. Where the nested promise depends on the resolution of the previous. In Haskell though my promise data type would be like <code>data Promise a b = Resolve a | Reject b</code> for instance where <code>a</code> in fact could be a data type including another promise."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1503180598, "post_id": 45772042, "comment_id": 78511178, "body": "@Redu Yes, you cannot do <code>Promise err1 (Promise err2 a)</code> with native promises, but that&#39;s exactly what we&#39;re talking about here. The thing you did with the (global) <code>y</code> variable has nothing to do with promises, you can do that in any function."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1503182128, "post_id": 45772042, "comment_id": 78511481, "body": "@Bergi Well sorry... obviously it was meant to be <code>var y</code>. By the way i think Haskell promise type would look more JS ish if defined like <code>data Promise a b = Resolve a b | Reject b</code> or would it be more meaningful if done like <code>data Promise a b = Then a b | Catch b</code>..?"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1503220953, "post_id": 45772042, "comment_id": 78518288, "body": "@Redu It&#39;s more like <code>newtype Promise a b = Promise (Mvar (Either a b))</code> I think"}, {"owner": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "edited": false, "score": 0, "creation_date": 1559100480, "post_id": 45772042, "comment_id": 99309939, "body": "&quot;Applying the monad laws is fun and occasionally useful, but we need lots of pragmatism indeed.&quot; --- There is a lot of pragmatism in using monads for writing safe and composable code. And less pragmatism in spending time on debugging and fixing subtle errors due to leaky abstractions."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "edited": false, "score": 0, "creation_date": 1559121534, "post_id": 45772042, "comment_id": 99318156, "body": "@DmitriZaitsev Leaky abstractions still allow writing composable code, that&#39;s why I said they&#39;re useful. If you want to reason about safety and concurrency, then promises are probably the wrong monad type for it."}, {"owner": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "edited": false, "score": 0, "creation_date": 1559134576, "post_id": 45772042, "comment_id": 99325595, "body": "They are certainly useful but having proper monad/functor with chain/map methods would likely have been more useful and safer. Promises are basically written for people too lazy to distinguish between <code>map</code> and <code>chain</code>, but there is price to pay in which it is harder to see the code intention and catche subtle errors due to the magic."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "edited": false, "score": 0, "creation_date": 1559142301, "post_id": 45772042, "comment_id": 99330341, "body": "@DmitriZaitsev Oh, you were referring to that. Yes, I&#39;d prefer <code>chain</code>+<code>map</code> as well, but even an implementation like Creed that heeds the type signatures cannot provide true monadic promises - the abstraction is leaky as explained in the last paragraph of my answer."}, {"owner": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "edited": false, "score": 0, "creation_date": 1559189816, "post_id": 45772042, "comment_id": 99345249, "body": "I wonder what you think of <a href=\"https://github.com/dmitriz/cpsfy\" rel=\"nofollow noreferrer\">github.com/dmitriz/cpsfy</a> as replacement for promises? It is meant to provide all promises&#39; benefits along with correct functional interfaces (and going beyond functors and monads towards their multi-args versions.)"}], "tags": [], "owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "is_accepted": true, "score": 4, "last_activity_date": 1503148926, "creation_date": 1503148926, "answer_id": 45772042, "question_id": 45770915, "link": "https://stackoverflow.com/questions/45770915/what-are-the-implications-of-the-recursive-joining-of-promises-in-terms-of-monad/45772042#45772042", "title": "What are the implications of the recursive joining of Promises in terms of Monads?", "body": "<blockquote>\n  <p>The first issue can easily be bypassed by always providing a function with the right type <code>a -&gt; Promise a</code>.</p>\n</blockquote>\n\n<p>Or by not using <code>then</code> as the <code>bind</code> operation of the monad, but some type-correct ones. <a href=\"http://blog.briancavalier.com/creed/\" rel=\"nofollow noreferrer\">Creed</a> is a functionally minded promise library that provides <code>map</code> and <code>chain</code> methods which implements the <a href=\"https://github.com/fantasyland/fantasy-land\" rel=\"nofollow noreferrer\">Fantasy-land spec</a> for algebraic types.</p>\n\n<p>The second issue can be bypassed as well with the same approach, by not using <code>resolve</code> but <code>fulfill</code> instead, and the static <code>of</code> method as the unit function.</p>\n\n<blockquote>\n  <p>But what would this structure mean in the context of promises/asynchronous computations?</p>\n</blockquote>\n\n<p>It's a promise for a promise for a value. Not every constructible type needs to be \"meaningful\" or \"useful\" :-)</p>\n\n<p>However, a good example of a similar type is provided by the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API\" rel=\"nofollow noreferrer\">Fetch API</a>: it returns a promise that resolves to a <code>Response</code> object, which again \"contains\" a promise that resolves to the body of the response.</p>\n\n<p>So a <code>Promise (Promise a)</code> might have only one success result value, which could as well be accessed through a <code>Promise a</code>, however the two levels of promises</p>\n\n<ul>\n<li>might fulfill at different times, adding a \"middle step\"</li>\n<li>might reject with different causes - e.g. the outer one representing a network problem while the inner one represents a parsing problem</li>\n</ul>\n\n<p>Notice that the <code>Promise</code> type should have a second type variable for the rejection reason, similar to an <code>Either</code>. A two-level <code>Promise err1 (Promise err2 a)</code> is quite different from a <code>Promise err a</code>.</p>\n\n<blockquote>\n  <p>I know that Javascript's promises are technically neither functors nor monads in the sense of Haskell</p>\n</blockquote>\n\n<p>You haven't mentioned the biggest issue yet, however: they're mutable. The transition from pending to settled state is a side effect that destroys referential transparency if we consider execution order, and of course our usual use cases for promises involve lots of IO that isn't modelled by the promise type at all.</p>\n\n<pre><code>Promise.delay(50).then(() =&gt; Promise.delay(50))\n// does something different than\nconst a = Promise.delay(50); a.then(() =&gt; a)\n</code></pre>\n\n<p>Applying the monad laws is fun and occasionally useful, but we need lots of pragmatism indeed.</p>\n"}, {"tags": [], "owner": {"reputation": 11683, "user_id": 1614973, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1gpM0.jpg?s=128&g=1", "display_name": "Dmitri Zaitsev", "link": "https://stackoverflow.com/users/1614973/dmitri-zaitsev"}, "is_accepted": false, "score": 0, "last_activity_date": 1559102741, "last_edit_date": 1559102741, "creation_date": 1559102226, "answer_id": 56352900, "question_id": 45770915, "link": "https://stackoverflow.com/questions/45770915/what-are-the-implications-of-the-recursive-joining-of-promises-in-terms-of-monad/56352900#56352900", "title": "What are the implications of the recursive joining of Promises in terms of Monads?", "body": "<blockquote>\n  <p>I know that Javascript's promises are technically neither functors nor monads in the sense of Haskell</p>\n</blockquote>\n\n<p><a href=\"https://stackoverflow.com/a/50173415/1614973\">Not only in the sense of Haskell</a>, in any other way as well.</p>\n\n<blockquote>\n  <ul>\n  <li>they include a bind operation that falls back to map when a pure function is passed in (and thus has an ambiguous type)</li>\n  </ul>\n</blockquote>\n\n<p>there is no <code>bind</code> operator provided by JS native promises</p>\n\n<blockquote>\n  <ul>\n  <li>both the Promise constructor and resolve (aka return) join nested promises recursively</li>\n  </ul>\n</blockquote>\n\n<p>I presume you mean unwrapping \"theneables\", i.e. calling functions stored under <code>then</code> prop whenever there is such function.</p>\n\n<blockquote>\n  <p>The first issue can easily be bypassed by always providing a function with the right type <code>a -&gt; Promise b</code>.</p>\n</blockquote>\n\n<p>This would not resemble <code>map</code> e.g. when <code>map(f)</code> is used for \n<code>f = x =&gt; {then: a =&gt; a}</code>.</p>\n\n<blockquote>\n  <p>The second issue obviously violates the parametricity trait of parametric polymorphic functions, i.e. one cannot construct a <code>m (m a)</code> structure. </p>\n</blockquote>\n\n<p>Indeed.</p>\n\n<blockquote>\n  <p>But what would this structure mean in the context of promises/asynchronous computations? I cannot think of a meaningful semantics for <code>Promise (Promise a)</code>, where <code>Promise</code> is a monad. So what do we lose? What are the implications of the recursive joining?</p>\n</blockquote>\n\n<p>You need to allow storing arbitrary values. Promises are not allowed to store theneables (without unwrapping), which is the problem. So you need to change semantics of both objects and methods. Allow objects to store theneables without change and implement <code>.bind</code> aka <code>.chain</code> that unwraps (or joins) theneables precisely once - no recursion.</p>\n\n<p>This is what <a href=\"https://github.com/briancavalier/creed\" rel=\"nofollow noreferrer\"><code>creed</code></a> does for promise-like objects and <a href=\"https://github.com/dmitriz/cpsfy\" rel=\"nofollow noreferrer\"><code>cpsfy</code></a> for callback-based (aka continuation passing style) functions.</p>\n\n<hr>\n\n<blockquote>\n  <p>Provided we are pretty pragmatic (and that's what we should be when we're programming Javascript), can't we claim that a Promise is a monad in Javascript if we take care of the edge cases?</p>\n</blockquote>\n\n<p>Writing safe, succinct and composable code is pragmatic. Risking introduce subtle bugs via leaky abstractions that might crash critical software with far going consequences is not. \nEvery edge case is a potential source of such risk.</p>\n\n<p>In that respect, claiming that <code>Promise</code> is a monad does more harm than help, beside being incorrect. It does harm because you cannot safely apply monadic transformations to promises. E.g. it is unsafe to use any code conforming to the monadic interface with promises as if they were monads. If used correctly, monads are there to help abstracting and reusing your code, not to introduce lines of checking and hunting for edge cases.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 802, "favorite_count": 1, "accepted_answer_id": 45772042, "answer_count": 2, "score": 4, "last_activity_date": 1559102741, "creation_date": 1503141703, "last_edit_date": 1503163518, "question_id": 45770915, "link": "https://stackoverflow.com/questions/45770915/what-are-the-implications-of-the-recursive-joining-of-promises-in-terms-of-monad", "title": "What are the implications of the recursive joining of Promises in terms of Monads?", "body": "<p>I know that Javascript's promises are technically neither functors nor monads in the sense of Haskell, because (among other things)</p>\n\n<ul>\n<li>they include a <code>bind</code> operation that falls back to <code>map</code> when a pure function is passed in (and thus has an ambiguous type)</li>\n<li>both the <code>Promise</code> constructor and <code>resolve</code> (aka <code>return</code>) join nested promises recursively</li>\n</ul>\n\n<p>The first issue can easily be bypassed by always providing a function with the right type <code>a -&gt; Promise b</code>.</p>\n\n<p>The second issue obviously violates the parametricity trait of parametric polymorphic functions, i.e. one cannot construct a <code>m (m a)</code> structure. But what would this structure mean in the context of promises/asynchronous computations? I cannot think of a meaningful semantics for <code>Promise (Promise a)</code>, where <code>Promise</code> is a monad. So what do we lose? What are the implications of the recursive joining?</p>\n\n<p>Provided we are pretty pragmatic (and that's what we should be when we're programming Javascript), can't we claim that a <code>Promise</code> is a monad in Javascript if we take care of the edge cases?</p>\n"}, {"tags": ["haskell", "functional-programming", "list-comprehension"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1503141871, "creation_date": 1503141871, "answer_id": 45770942, "question_id": 45770861, "link": "https://stackoverflow.com/questions/45770861/haskell-list-comprehension-predicate-order/45770942#45770942", "title": "Haskell list comprehension predicate order", "body": "<p><code>[a | a &lt;- xs, a &lt;- combSet]</code> is equivalent to <code>[a | x &lt;- xs, a &lt;- combSet]</code>, since the first <code>a</code> is being \"shadowed\" by the second one.  This always happens when there are nested redefinitions of the same identifier, e.g. in <code>\\a -&gt; ... (\\a -&gt; ....)</code>.</p>\n\n<p>Turning on warnings with <code>-Wall</code> should spot this issue.</p>\n\n<p>You could instead use <code>[a | a &lt;- xs, elem a combSet]</code> to check that <code>a</code> occurs inside <code>combSet</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 63, "user_id": 2461616, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d67e24bf7da950b578244ed382bcba49?s=128&d=identicon&r=PG", "display_name": "user2461616", "link": "https://stackoverflow.com/users/2461616/user2461616"}, "edited": false, "score": 0, "creation_date": 1503142646, "post_id": 45770945, "comment_id": 78500179, "body": "Ah, thanks for the clarification. I&#39;m from a mathematical background, and thought list comprehensions were identical to set definitions."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 5, "last_activity_date": 1503141888, "creation_date": 1503141888, "answer_id": 45770945, "question_id": 45770861, "link": "https://stackoverflow.com/questions/45770861/haskell-list-comprehension-predicate-order/45770945#45770945", "title": "Haskell list comprehension predicate order", "body": "<p>You don't have a predicate to begin with. You have two lists, <code>xs</code> and <code>combSet</code> you take your elements from. So let us check the behaviour with a simpler example:</p>\n\n<pre><code>example = [a | a &lt;- [1,2,3], a &lt;- [4,5,6]]\n</code></pre>\n\n<p>This will lead to <code>concat $ replicate 3 [4,5,6]</code>, i.e. <code>[4,5,6,4,5,6,4,5,6]</code>. Note that there is no element from the first list, the later binding of <code>a</code> <strong><em>shadows</em></strong> the previous.</p>\n\n<p>We can the code above as \"for all elements in the list <code>[1,2,3]</code>: name the current element a and then for all elements in the list <code>[4,5,6]</code>: name the current element in the list also a (and forget the previous variant therefore) and return those <code>a</code>s\".</p>\n\n<p>The code above is therefore equivalent to</p>\n\n<pre><code>example = [a | _ &lt;- [1,2,3], a &lt;- [4,5,6]]\n</code></pre>\n\n<p>or any other name instead of <code>_</code>.</p>\n\n<p>For a predicate, you need a <code>Bool</code> expression, e.g.</p>\n\n<pre><code>evenNumbers = [a | a &lt;- [1..100], even a]\n</code></pre>\n\n<p>In your case, the boolean expression is likely <code>a `elem` combSet</code>.</p>\n"}], "owner": {"reputation": 63, "user_id": 2461616, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d67e24bf7da950b578244ed382bcba49?s=128&d=identicon&r=PG", "display_name": "user2461616", "link": "https://stackoverflow.com/users/2461616/user2461616"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 255, "favorite_count": 0, "accepted_answer_id": 45770945, "answer_count": 2, "score": 1, "last_activity_date": 1503143691, "creation_date": 1503141324, "last_edit_date": 1503143691, "question_id": 45770861, "link": "https://stackoverflow.com/questions/45770861/haskell-list-comprehension-predicate-order", "title": "Haskell list comprehension predicate order", "body": "<p>I'm very new to Haskell and am trying to do some stuff with algebraic groups. My first function is just to take an operation and a set and find all the members of the set that can be produced by performing that operation on a pair of that same set's members. This is my code for this:</p>\n\n<pre><code>group' f xs = [a | a &lt;- xs, a &lt;- combSet]\n    where combSet = [f x y | x &lt;- xs, y &lt;- xs]\n</code></pre>\n\n<p>However, this code just returns the set of members of combSet, ignoring the <code>a &lt;- xs</code> predicate:</p>\n\n<pre><code>*Main&gt; group' (*) [1, 2, 3, 4, 5]\n[1,2,3,4,5,2,4,6,8,10,3,6,9,12,15,4,8,12,16,20,5,10,15,20,25,1,2,3,4,5,2,4,6,8,10,3,6,9,12,15,4,8,12,16,20,5,10,15,20,25,1,2,3,4,5,2,4,6,8,10,3,6,9,12,15,4,8,12,16,20,5,10,15,20,25,1,2,3,4,5,2,4,6,8,10,3,6,9,12,15,4,8,12,16,20,5,10,15,20,25,1,2,3,4,5,2,4,6,8,10,3,6,9,12,15,4,8,12,16,20,5,10,15,20,25]\n</code></pre>\n\n<p>But when I switch the order of the comprehension predicates, to </p>\n\n<pre><code>group' f xs = [a | a &lt;- combSet, a &lt;- xs]\n    where combSet = [f x y | x &lt;- xs, y &lt;- xs]\n</code></pre>\n\n<p>it returns the correct values, but the list is way bigger than expected:</p>\n\n<pre><code>*Main&gt; group' (*) [1, 2, 3, 4, 5]\n[1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5]\n</code></pre>\n\n<p>Can anyone tell me why this happens, or if I've done something stupid?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1503143370, "post_id": 45770444, "comment_id": 78500392, "body": "Unless this happens to be a known bug, there is not nearly enough information here to diagnose this. To downgrade, get the source <a href=\"https://github.com/commercialhaskell/stack/tree/v1.4.0\" rel=\"nofollow noreferrer\">here</a> and build it (I can&#39;t find 1.4.1 but 1.4.0 is pretty close. Alternatively, browse the tree manually to find 1.4.1)"}, {"owner": {"reputation": 463, "user_id": 7342065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a47003905491d69d47a261235044a44?s=128&d=identicon&r=PG&f=1", "display_name": "kye", "link": "https://stackoverflow.com/users/7342065/kye"}, "edited": false, "score": 0, "creation_date": 1534099545, "post_id": 45770444, "comment_id": 90578612, "body": "I just ran into this problem with <code>stack build --profile</code>, where it would unregister all packages every time. Doing <code>stack build -dry-run --profile</code> revealed that one package (parser-combinators) continuously failed to set the profile flag correctly. I was able to fix the problem by manually doing <code>stack install --profile parser-combinators; stack build --profile megaparsec; stack build --profile</code>."}], "answers": [{"tags": [], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "is_accepted": false, "score": 0, "last_activity_date": 1503158226, "creation_date": 1503158226, "answer_id": 45773557, "question_id": 45770444, "link": "https://stackoverflow.com/questions/45770444/what-can-cause-stack-build-to-keep-unregistering-local-dependencies-every-time/45773557#45773557", "title": "What can cause `stack build` to keep unregistering local dependencies every time?", "body": "<p>As a partial solution, I found that I can</p>\n\n<pre><code>stack upgrade --binary-version 1.4.0\n</code></pre>\n\n<p>Which readily performs the downgrade:</p>\n\n<pre><code>Current Stack version: 1.5.1, available download version: 1.4.0\nForcing binary upgrade\nQuerying for archive location for platform: linux-x86_64-static\nDownloading from: https://github.com/commercialhaskell/stack/releases/download/v1.4.0/stack\n-1.4.0-linux-x86_64-static.tar.gz\nDownload complete, testing executable\nVersion 1.4.0, Git revision e714f1dd3fade19496d91bd6a017e435a96a6bcd (4640 commits) x86_64 \nhpack-0.17.0\nNew stack executable available at /home/user/.local/bin/stack\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "is_accepted": true, "score": 3, "last_activity_date": 1503414965, "creation_date": 1503414965, "answer_id": 45821463, "question_id": 45770444, "link": "https://stackoverflow.com/questions/45770444/what-can-cause-stack-build-to-keep-unregistering-local-dependencies-every-time/45821463#45821463", "title": "What can cause `stack build` to keep unregistering local dependencies every time?", "body": "<p>Long story short: changing <code>resolver: lts-7.19</code> to <code>resolver: lts-7.24</code> in <code>stack.yaml</code> seems to have fixed the error for me.</p>\n\n<hr>\n\n<p>I have some guesses and hunches what may have gone wrong in the background, but I am not entirely sure.</p>\n\n<p>I got a clue from the <code>--dry-run</code> flag that some of the missing packages it reports are build-time haskell package dependencies, like <code>alex</code>, <code>happy</code>, etc...</p>\n\n<p>So maybe the older <code>lts</code> didn't install those correctly? If someone is more knowledgeable on the subject, I'd love to hear more.</p>\n\n<p>And I'm also sad that this incident has destroyed some of my trust in stack's promise of reproducible builds, as a (AFAIK purported-to-be-safe) <code>stack upgrade</code> (and even with subsequent downgrade) suddenly left one of my projects un-buildable for days.</p>\n\n<p>And at any rate, I'd love if </p>\n\n<ol>\n<li><code>stack</code> would warn and ask me before it makes destructive changes on my system, especially if it results in hours of recompilation. (Which actually meant days of head-scratching in my case since any idea I tried I had to wait quite a bit of time in-between.)</li>\n<li>It could employ a similar build store as nix, whereas even if I change some configuration, I can switch back to the previous working configuration readily.</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": false, "score": 0, "last_activity_date": 1544451640, "last_edit_date": 1544451640, "creation_date": 1544451265, "answer_id": 53707515, "question_id": 45770444, "link": "https://stackoverflow.com/questions/45770444/what-can-cause-stack-build-to-keep-unregistering-local-dependencies-every-time/53707515#53707515", "title": "What can cause `stack build` to keep unregistering local dependencies every time?", "body": "<p>It could have been the case the you were hitting this bug: <a href=\"https://github.com/commercialhaskell/stack/issues/3922\" rel=\"nofollow noreferrer\">Better calculation of SourceMap</a>, but again not enough information to tell for sure. Considering that this issue will get fixed soon, it shouldn't be a problem anymore, but if anyone is looking for a work around <a href=\"https://www.fpcomplete.com/blog/2017/07/stacks-new-extensible-snapshots\" rel=\"nofollow noreferrer\">custom snapshots</a> seem to work pretty well.</p>\n\n<p>The gist of custom snapshots is by moving all immutable packages from <code>extra-deps</code> into a custom snapshot will prevent stack from recalculating dependencies for these packages.</p>\n"}], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 334, "favorite_count": 2, "accepted_answer_id": 45821463, "answer_count": 3, "score": 6, "last_activity_date": 1544451640, "creation_date": 1503138630, "last_edit_date": 1503187405, "question_id": 45770444, "link": "https://stackoverflow.com/questions/45770444/what-can-cause-stack-build-to-keep-unregistering-local-dependencies-every-time", "title": "What can cause `stack build` to keep unregistering local dependencies every time?", "body": "<p>I've tried <code>stack clean</code>, and also removing <code>.stack-work</code>.\nBut still, every time I run build it unregisters 5 (the same) packages.\n<code>stack build --dry-run</code> tells me the list, but not any reason why.</p>\n\n<p>I've also recently upgraded from 1.4.1 </p>\n\n<p>Also, if it is not quite simple how to figure this out, I'd like to get back to using 1.4.1. Any simple way to downgrade <code>haskell-stack</code> to that version?</p>\n\n<h3>Edit 1</h3>\n\n<p>Downgrading to 1.4.0 didn't help. About 70 packages got unregistered and rebuilt, and after that I got into the same 5-unregister-loop.</p>\n\n<p>So I thought, where else could have my local state be corrupted since ~yesterday? <code>~/.stack</code>! So  I've (re)moved my <code>~/.stack</code> folder, and also <code>.stack-work</code> folder, thinking that if anything could have gone wrong it's in these two places, and now I am in an even worse of a rut. Now the constant unregister cycle includes 23 packages (some of them quite heavy) instead of just 5.</p>\n\n<pre><code>Would unregister locally:\ncairo-0.13.3.1 (missing dependencies: gtk2hs-buildtools)\ndump-0.3.0 (missing dependencies: haskell-src-meta, interpolatedstring-perl6)\nentropy-0.3.7\nghcjs-dom-0.2.4.0 (missing dependencies: glib, gtk3, webkitgtk3)\ngio-0.13.3.1 (missing dependencies: glib, gtk2hs-buildtools)\nglib-0.13.4.1 (missing dependencies: gtk2hs-buildtools)\ngtk2hs-buildtools-0.13.2.2 (missing dependencies: happy)\ngtk3-0.14.6 (missing dependencies: cairo, gio, glib, gtk2hs-buildtools, pango)\nhaskell-src-exts-1.17.1 (missing dependencies: happy)\nhaskell-src-meta-0.6.0.14 (missing dependencies: haskell-src-exts)\nhere-1.2.9 (missing dependencies: haskell-src-meta)\nhs-di-0.4.0 (missing dependencies: haskell-src-meta, interpolate, interpolatedstring-perl6)\ninterpolate-0.1.0 (missing dependencies: haskell-src-meta)\ninterpolatedstring-perl6-1.0.0 (missing dependencies: haskell-src-meta)\npango-0.13.3.1 (missing dependencies: cairo, glib, gtk2hs-buildtools)\nreflex-0.5.0 (missing dependencies: haskell-src-exts, haskell-src-meta)\nreflex-dom-0.4 (missing dependencies: ghcjs-dom, glib, gtk3, reflex, webkitgtk3, webkitgtk3-javascriptcore)\nthreepenny-gui-0.7.1.0\nuuid-1.3.13\nwebkitgtk3-0.14.2.1 (missing dependencies: cairo, glib, gtk2hs-buildtools, gtk3, pango)\nwebkitgtk3-javascriptcore-0.13.2.0 (missing dependencies: glib, gtk2hs-buildtools, gtk3, webkitgtk3)\nwebsockets-0.9.8.2\nwebsockets-snap-0.10.0.0\n</code></pre>\n\n<p>@user2407038, what kind of information might help to start diagnosing this? Is the above helpful to begin with? Under what circumstances can ever such an unregister-loop arise?</p>\n\n<p>I have one more idea that I could try: this particular project depends on a few local packages, and afaik their <code>.stack-work</code> folder may play a role in this. So maybe I could (re)move those as well.</p>\n\n<p>Any more ideas should the above one fail?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 1, "last_activity_date": 1503127189, "creation_date": 1503127189, "answer_id": 45768854, "question_id": 45768722, "link": "https://stackoverflow.com/questions/45768722/haskell-messed-up-parsing-of-parentheses-character/45768854#45768854", "title": "Haskell - messed up parsing of parentheses character?", "body": "<p>The second line has a lower-case <code>n</code>, but Haskell is case-sensitive. Change it to:</p>\n\n<pre><code>findNextParens :: Int -&gt; String -&gt; Int\nfindNextParens 1 (')':str) = 1\nfindNextParens n (c:str)   = 1 + findNextParens n str\nfindNextParens n ('(':str) = 1 + findNextParens (n + 1) str\nfindNextParens n (')':str) = 1 + findNextParens (n - 1) str\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1503129040, "creation_date": 1503129040, "answer_id": 45769102, "question_id": 45768722, "link": "https://stackoverflow.com/questions/45768722/haskell-messed-up-parsing-of-parentheses-character/45769102#45769102", "title": "Haskell - messed up parsing of parentheses character?", "body": "<p>Let's load the code in GHCi:</p>\n\n<pre><code>&gt; :{\n| findNextParens :: Int -&gt; String -&gt; Int\n| findNextParens 1 (')':str) = 1\n| findnextParens n (c:str)   = 1 + findNextParens n str\n| findNextParens n ('(':str) = 1 + findNextParens (n + 1) str\n| findNextParens n (')':str) = 1 + findNextParens (n - 1) str\n| :}\n\n&lt;interactive&gt;:14:1: error: \n    Multiple declarations of \u2018findNextParens\u2019\n</code></pre>\n\n<p>Multiple declarations? Oh, the third line defines <code>findnextParens</code> instead of <code>findNextParens</code>, so it counts as a declaration of a new function.</p>\n\n<p>Let's fix that typo:</p>\n\n<pre><code>&gt; :{\n| findNextParens :: Int -&gt; String -&gt; Int\n| findNextParens 1 (')':str) = 1\n| findNextParens n (c:str)   = 1 + findNextParens n str\n| findNextParens n ('(':str) = 1 + findNextParens (n + 1) str\n| findNextParens n (')':str) = 1 + findNextParens (n - 1) str\n| :}\n\n&lt;interactive&gt;:21:1: warning: [-Woverlapping-patterns]\n    Pattern match is redundant\n    In an equation for \u2018findNextParens\u2019:\n        findNextParens n ('(' : str) = ...\n\n&lt;interactive&gt;:22:1: warning: [-Woverlapping-patterns]\n    Pattern match is redundant\n    In an equation for \u2018findNextParens\u2019:\n        findNextParens n (')' : str) = ...\n</code></pre>\n\n<p>Ah, two redundant (= unreachable) patterns!</p>\n\n<p>Indeed, the line <code>findNextParens n (c:str)   = 1 + findNextParens n str</code> catches even those cases where <code>c</code> is a open/closed parentheses, so the next lines are never reached.</p>\n\n<p>Summary: always turn on warnings (<code>-Wall</code>) when compiling your code!</p>\n"}], "owner": {"reputation": 693, "user_id": 7564554, "user_type": "registered", "accept_rate": 82, "profile_image": "https://lh3.googleusercontent.com/-h7KkTmgJty0/AAAAAAAAAAI/AAAAAAAAAAo/ZFEGeg_bQ6Y/photo.jpg?sz=128", "display_name": "Eben Kadile", "link": "https://stackoverflow.com/users/7564554/eben-kadile"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 45769102, "answer_count": 2, "score": 0, "last_activity_date": 1503129040, "creation_date": 1503126169, "question_id": 45768722, "link": "https://stackoverflow.com/questions/45768722/haskell-messed-up-parsing-of-parentheses-character", "title": "Haskell - messed up parsing of parentheses character?", "body": "<p>According to <a href=\"https://stackoverflow.com/questions/18563575/haskell-multiple-declarations-of-function-name\">this question</a> Haskell patterns have to have the same number of arguments in each line. Here is my function:</p>\n\n<pre><code>findNextParens :: Int -&gt; String -&gt; Int\nfindNextParens 1 (')':str) = 1\nfindnextParens n (c:str)   = 1 + findNextParens n str\nfindNextParens n ('(':str) = 1 + findNextParens (n + 1) str\nfindNextParens n (')':str) = 1 + findNextParens (n - 1) str\n</code></pre>\n\n<p>Given the number of open parantheses and a string, it's supposed to find the index of the parantheses that closes the first one. When I try to load this function I get an error saying I've declared the function on the 1st and 3rd lines of its pattern. I have two arguments per line, so what's the cause of this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "edited": false, "score": 0, "creation_date": 1503087360, "post_id": 45764425, "comment_id": 78487218, "body": "Why not use <code>Either X Y</code>?"}, {"owner": {"reputation": 2970, "user_id": 1763955, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/3a7a94d762a9d702b88404f840e31d8f?s=128&d=identicon&r=PG&f=1", "display_name": "Carbon", "link": "https://stackoverflow.com/users/1763955/carbon"}, "reply_to_user": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "edited": false, "score": 0, "creation_date": 1503087398, "post_id": 45764425, "comment_id": 78487236, "body": "I want to instance behavior on it. maybe newtype either x y?"}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "edited": false, "score": 0, "creation_date": 1503087425, "post_id": 45764425, "comment_id": 78487248, "body": "newtype would work: <code>newtype EitherXY = EitherXY (Either X Y)</code>"}, {"owner": {"reputation": 2970, "user_id": 1763955, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/3a7a94d762a9d702b88404f840e31d8f?s=128&d=identicon&r=PG&f=1", "display_name": "Carbon", "link": "https://stackoverflow.com/users/1763955/carbon"}, "reply_to_user": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "edited": false, "score": 0, "creation_date": 1503087439, "post_id": 45764425, "comment_id": 78487253, "body": "ah lovely, thank you."}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "edited": false, "score": 0, "creation_date": 1503087475, "post_id": 45764425, "comment_id": 78487271, "body": "Maybe update your question to reflect that you need an instance?"}], "answers": [{"tags": [], "owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "is_accepted": true, "score": 9, "last_activity_date": 1503164205, "last_edit_date": 1503164205, "creation_date": 1503087620, "answer_id": 45764505, "question_id": 45764425, "link": "https://stackoverflow.com/questions/45764425/haskell-either-with-fixed-types/45764505#45764505", "title": "Haskell Either with fixed types", "body": "<p>The OP has clarified in the comments that they want 'instance behaviour' for some type <code>Either X Y</code>. Typically, you'd use a <code>newtype</code> in this situation:</p>\n\n<pre><code>newtype EitherXY = EitherXY (Either X Y)\n</code></pre>\n\n<p>In case you're not already aware, <code>newtypes</code> can have a record-like unwrapping function.</p>\n\n<pre><code>newtype EitherXY = EitherXY { unwrap :: Either X Y } deriving (...)\n</code></pre>\n\n<p>You may also auto-derive certain type classes (as with data declarations). The set of derivable classes depends on the compiler version and the set of enabled extensions. I won't <a href=\"https://downloads.haskell.org/~ghc/8.2.1/docs/html/users_guide/glasgow_exts.html#generalised-derived-instances-for-newtypes\" rel=\"nofollow noreferrer\">elaborate</a> on it here.</p>\n"}, {"comments": [{"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "edited": false, "score": 1, "creation_date": 1503092033, "post_id": 45765123, "comment_id": 78489216, "body": "Good point, but all the combinators available for <code>Either</code> might come in handy..."}], "tags": [], "owner": {"reputation": 108, "user_id": 6476589, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-OHBMKOvbfng/AAAAAAAAAAI/AAAAAAAADjw/5ye5MX8Sbzo/photo.jpg?sz=128", "display_name": "Brendan Murphy", "link": "https://stackoverflow.com/users/6476589/brendan-murphy"}, "is_accepted": false, "score": 9, "last_activity_date": 1503090793, "creation_date": 1503090793, "answer_id": 45765123, "question_id": 45764425, "link": "https://stackoverflow.com/questions/45764425/haskell-either-with-fixed-types/45765123#45765123", "title": "Haskell Either with fixed types", "body": "<p>It's probably better to just do </p>\n\n<pre><code>data X_Or_Y = InX X | InY Y\n</code></pre>\n\n<p>This type is isomorphic to Either X Y, but it's easier to work with/pattern match on than a newtype, since it only has 2 layers of nested constructors</p>\n"}], "owner": {"reputation": 2970, "user_id": 1763955, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/3a7a94d762a9d702b88404f840e31d8f?s=128&d=identicon&r=PG&f=1", "display_name": "Carbon", "link": "https://stackoverflow.com/users/1763955/carbon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 0, "accepted_answer_id": 45764505, "answer_count": 2, "score": 1, "last_activity_date": 1503164205, "creation_date": 1503087226, "question_id": 45764425, "link": "https://stackoverflow.com/questions/45764425/haskell-either-with-fixed-types", "title": "Haskell Either with fixed types", "body": "<p>I have two types, assume they both have monoid implementations. Is there a way to have another type that will be specified to contain an X or a Y? Or is this not the right way to go about this?</p>\n\n<pre><code>data X = X [Int]\ndata Y = Y Double\n</code></pre>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1503106591, "post_id": 45763535, "comment_id": 78492231, "body": "<code>2:xs</code> is a list of length at least 1, not of length 2."}], "answers": [{"tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 6, "last_activity_date": 1503083301, "creation_date": 1503083301, "answer_id": 45763546, "question_id": 45763535, "link": "https://stackoverflow.com/questions/45763535/pattern-matching-redundant/45763546#45763546", "title": "Pattern Matching Redundant", "body": "<p>End the list pattern with empty brackets:</p>\n\n<pre><code>func (2:x:[]) = expression\n</code></pre>\n\n<p>This will ensure <code>x</code> is a single element from the list.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 7, "last_activity_date": 1503084521, "creation_date": 1503084521, "answer_id": 45763809, "question_id": 45763535, "link": "https://stackoverflow.com/questions/45763535/pattern-matching-redundant/45763809#45763809", "title": "Pattern Matching Redundant", "body": "<p>Adapt this as needed:</p>\n\n<pre><code>func [] = ... -- empty case\nfunc [x] = ... -- length=1 case\nfunc [x,y] = ... -- length=2 case\nfunc (x:y:z:zs) = ... -- length&gt;=3 case\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 6707409, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/576c0ebaaa58d501b9d4bfaabceaa526?s=128&d=identicon&r=PG&f=1", "display_name": "Kyle&#39;s Corpse", "link": "https://stackoverflow.com/users/6707409/kyles-corpse"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 904, "favorite_count": 0, "accepted_answer_id": 45763546, "answer_count": 2, "score": 0, "last_activity_date": 1503084521, "creation_date": 1503083235, "question_id": 45763535, "link": "https://stackoverflow.com/questions/45763535/pattern-matching-redundant", "title": "Pattern Matching Redundant", "body": "<p>How can I make sure the pattern </p>\n\n<pre><code>func (2:xs) = expression\n</code></pre>\n\n<p>where 2:xs is a length 2 list doesn't match with the pattern </p>\n\n<pre><code>func (2:x:xs) = expression2\n</code></pre>\n\n<p>where 2:x:xs is a length 3 list?</p>\n"}, {"tags": ["haskell", "command-line-arguments", "haskell-stack", "build-tools"], "answers": [{"comments": [{"owner": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "edited": false, "score": 1, "creation_date": 1503145064, "post_id": 45764515, "comment_id": 78500963, "body": "I think you&#39;re right in a way, on the other hand if that option is not recognized it would be better IMHO to not silently throw it away, but report an error or a warning. I&#39;ll make a ticket."}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": true, "score": 3, "last_activity_date": 1503087665, "creation_date": 1503087665, "answer_id": 45764515, "question_id": 45761886, "link": "https://stackoverflow.com/questions/45761886/build-haskell-stack-tests-without-running/45764515#45764515", "title": "Build haskell stack tests without running", "body": "<p>You should put <code>build</code> option before <code>--test</code> like this:</p>\n\n<pre><code>$ stack build --test --no-run-tests\n</code></pre>\n\n<p>I'm not sure whether it's bug or feature. You can open issue <a href=\"https://github.com/commercialhaskell/stack/issues\" rel=\"nofollow noreferrer\">here</a> if you're interested in feedback from developers. Personally for me it seems strange to pass <code>--test</code> before <code>build</code>. In some reasonable sense <code>--test</code> is subpart of <code>build</code> and subparts or options are usually specified to the right of main option.</p>\n\n<p>Also there's shorter version of what you want (because <code>build --test</code> is just <code>test</code>):</p>\n\n<pre><code>$ stack test --no-run-tests\n</code></pre>\n"}], "owner": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 45764515, "answer_count": 1, "score": 3, "last_activity_date": 1503087665, "creation_date": 1503076823, "last_edit_date": 1503087658, "question_id": 45761886, "link": "https://stackoverflow.com/questions/45761886/build-haskell-stack-tests-without-running", "title": "Build haskell stack tests without running", "body": "<p>I've made a very simple project with a failing test suite <a href=\"https://github.com/k-bx/noruntests-play\" rel=\"nofollow noreferrer\">https://github.com/k-bx/noruntests-play</a></p>\n\n<p>Now when I run <code>stack --test --no-run-tests build</code> I would expect it to build the project, but not run the tests. Instead, it runs the tests:</p>\n\n<pre><code>\u279c  noruntests-play git:(master) stack --test --no-run-tests build\nnoruntests-play-0.1.0.0: test (suite: test)\n\ntest: error\nCallStack (from HasCallStack):\n  error, called at tests/Tests.hs:4:8 in main:Main\n\nTest suite failure for package noruntests-play-0.1.0.0\n    test:  exited with: ExitFailure 1\nLogs printed to console\n</code></pre>\n\n<p>What am I doing wrong here? Thank you!</p>\n"}, {"tags": ["sqlite", "haskell", "functional-programming", "monads", "scotty"], "answers": [{"comments": [{"owner": {"reputation": 329, "user_id": 3211617, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6dae0b7cdab506b3656c0294ba1554e8?s=128&d=identicon&r=PG&f=1", "display_name": "jo_wil", "link": "https://stackoverflow.com/users/3211617/jo-wil"}, "edited": false, "score": 0, "creation_date": 1503089213, "post_id": 45762918, "comment_id": 78488095, "body": "Awesome thank you I did not know these existed! Just more to learn."}], "tags": [], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "is_accepted": true, "score": 4, "last_activity_date": 1503080829, "creation_date": 1503080829, "answer_id": 45762918, "question_id": 45761610, "link": "https://stackoverflow.com/questions/45761610/working-with-scotty-and-sqlite-and-having-some-trouble-with-the-monads/45762918#45762918", "title": "Working with Scotty and Sqlite and having some trouble with the Monads", "body": "<p>Monads stack (technically, Monad Transformers stack).  Which means that in some advanced monads it is possible to do thing with more basic monads further down the stack.</p>\n\n<p>The <code>lift</code> function will take a function from one level down the stack and \"lift\" it into the current one.  the <code>liftIO</code> function will take a generic IO function and lift it into the current context.  (IO, if it is included, is always the bottom of the Monad Transformer stack)</p>\n\n<p><a href=\"http://book.realworldhaskell.org/read/monad-transformers.html\" rel=\"nofollow noreferrer\">Real World Haskell</a> and the <a href=\"https://en.wikibooks.org/wiki/Haskell/Monad_transformers\" rel=\"nofollow noreferrer\">Haskell Wiki</a> both have good chapters on Monad Transformers.</p>\n"}], "owner": {"reputation": 329, "user_id": 3211617, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6dae0b7cdab506b3656c0294ba1554e8?s=128&d=identicon&r=PG&f=1", "display_name": "jo_wil", "link": "https://stackoverflow.com/users/3211617/jo-wil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 45762918, "answer_count": 1, "score": 2, "last_activity_date": 1503080829, "creation_date": 1503075668, "question_id": 45761610, "link": "https://stackoverflow.com/questions/45761610/working-with-scotty-and-sqlite-and-having-some-trouble-with-the-monads", "title": "Working with Scotty and Sqlite and having some trouble with the Monads", "body": "<p>Hi I a pretty new to Haskell and I have been working on a small web application with Scotty and Sqlite.</p>\n\n<p>I am having trouble performing Sqlite operations inside the Scotty Actions.\nI kind of understanding the two libraries when used in isolation.</p>\n\n<p>Here is the MVP of my code </p>\n\n<pre><code>-- imports ...\n\nroutes :: ScottyM ()\nroutes = do \n    post \"data/:id\" $ do\n        id &lt;- param \"id\"\n        -- HERE IS WHERE I GET CONFUSED\n        -- This is what I want to do\n        db &lt;- open \"store.db\"\n        exec db \"INSERT INTO Store (id, value) VALUES (\" &lt;&gt; id &lt;&gt; \", 'Test Value');\" -- I know there is SQL Injection here I will learn about parameterized queries in haskell next\n        close db\n        -- END THE PART I AM CONFUSED BY\n        text $ \"created a record with \" &lt;&gt; id &lt;&gt; \" id.\"\n\nmain :: IO()\n    scotty 3000 routes\n</code></pre>\n\n<p>So as you can see I am still stuck thinking too imperatively.\nI know the type of post is ActionM () -> ScottyM ()\nand I know the type of close db is IO ()</p>\n\n<p>So what I think I need is a composite function that goes \nActionM () -> IO () -> ScottyM ()\nI am just not sure how to write this.</p>\n\n<p>Is this on the right track?</p>\n\n<p>Any and all advice is greatly appreciated.</p>\n"}, {"tags": ["json", "haskell", "aeson"], "answers": [{"comments": [{"owner": {"reputation": 5242, "user_id": 50962, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e39b7acdae85aedee02487bed17ff5f6?s=128&d=identicon&r=PG", "display_name": "altern", "link": "https://stackoverflow.com/users/50962/altern"}, "edited": false, "score": 0, "creation_date": 1503076875, "post_id": 45761722, "comment_id": 78481834, "body": "How comes you don&#39;t need to do <code>BLS.pack</code>? :)"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 5242, "user_id": 50962, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e39b7acdae85aedee02487bed17ff5f6?s=128&d=identicon&r=PG", "display_name": "altern", "link": "https://stackoverflow.com/users/50962/altern"}, "edited": false, "score": 0, "creation_date": 1503076973, "post_id": 45761722, "comment_id": 78481878, "body": "@altern Ooops. I always turn on <code>-XOverloadedStrings</code>. I&#39;ll make that clearer. :)"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 2, "last_activity_date": 1503077297, "last_edit_date": 1503077297, "creation_date": 1503076146, "answer_id": 45761722, "question_id": 45761509, "link": "https://stackoverflow.com/questions/45761509/parsing-json-into-rosetree-recursive-parsing/45761722#45761722", "title": "Parsing JSON into RoseTree (recursive parsing)", "body": "<p>Weird GHCi typing rules strike again! Everything works as expected if you add type annotations:</p>\n\n<pre><code>ghci&gt; :set -XOverloadedStrings\nghci&gt; JSON.decode \"{\\\"children\\\":[],\\\"value\\\":1}\" :: Maybe (RoseTree Int)\nJust (RoseTree 1 [])\n</code></pre>\n\n<p>Without knowing what type you are trying to parse (it sees <code>FromJSON a =&gt; Maybe a</code>), GHCi defaults <code>a ~ ()</code>. You can try this out by testing the <code>FromJSON ()</code> instance out and noticing that it succeeds!</p>\n\n<pre><code>ghci&gt; JSON.decode \"[]\"\nJust ()\n</code></pre>\n\n<hr>\n\n<p>Couple side notes on your code if this is actually for a project (and not just for fun and learning):</p>\n\n<ul>\n<li>I encourage you to check out <code>OverloadedStrings</code> (you can basically drop almost all uses of <code>T.pack</code> from your code since string literals will infer whether they should have type <code>String</code>, lazy/strict <code>Text</code>, lazy/strict <code>ByteString</code> etc.)</li>\n<li>You can use <code>DeriveGeneric</code> and <code>DeriveAnyClass</code> to get JSON parsing almost for free (although I concede the behavior will be <em>slightly</em> different from what you currently have)</li>\n</ul>\n\n<p>With those suggestions, here is a rewrite of your code:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings, DeriveGeneric, DeriveAnyClass #-}\n\nimport qualified Data.Aeson as JSON\nimport qualified Data.ByteString.Lazy.Char8 as BS\nimport GHC.Generics (Generic)\nimport Data.Maybe (fromMaybe)\n\ndata RoseTree a = RoseTree { value :: a, children :: [RoseTree a] }\n                    deriving (Show, Generic, JSON.FromJSON, JSON.ToJSON)\n</code></pre>\n\n<p>Note that <code>decode</code> from <code>Data.Aeson</code> does (almost) what <code>parseRoseTreeFromJSON</code> does...</p>\n\n<pre><code>ghci&gt; :set -XOverloadedStrings\nghci&gt; JSON.encode (RoseTree 1 [])\n\"{\\\"children\\\":[],\\\"value\\\":1}\"\nghci&gt; JSON.encode (RoseTree 1 [RoseTree 2 []])\n\"{\\\"children\\\":[{\\\"children\\\":[],\\\"value\\\":2}],\\\"value\\\":1}\"\nghci&gt; JSON.decode \"{\\\"children\\\":[],\\\"value\\\":1}\" :: Maybe (RoseTree Int)\nJust (RoseTree {value = 1, children = []})\nghci&gt; JSON.decode \"{\\\"children\\\":[{\\\"children\\\":[],\\\"value\\\":2}],\\\"value\\\":1}\" :: Maybe (RoseTree Int)\nJust (RoseTree {value = 1, children = [RoseTree {value = 2, children = []}]})\n</code></pre>\n"}], "owner": {"reputation": 5242, "user_id": 50962, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e39b7acdae85aedee02487bed17ff5f6?s=128&d=identicon&r=PG", "display_name": "altern", "link": "https://stackoverflow.com/users/50962/altern"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 45761722, "answer_count": 1, "score": 0, "last_activity_date": 1503082176, "creation_date": 1503075179, "last_edit_date": 1503082176, "question_id": 45761509, "link": "https://stackoverflow.com/questions/45761509/parsing-json-into-rosetree-recursive-parsing", "title": "Parsing JSON into RoseTree (recursive parsing)", "body": "<p>I am struggling with a function that would take <code>String</code> JSON as an input and return <code>RoseTree</code> structure as an output.</p>\n\n<p>My code is as follows:</p>\n\n<pre><code>import qualified Data.Aeson as JSON\nimport qualified Data.Text as T\nimport qualified Data.Aeson.Types as AT\nimport Control.Applicative\nimport qualified Data.ByteString.Char8 as BS\nimport Data.Attoparsec.ByteString.Char8\n\ndata RoseTree a = Empty | RoseTree a [RoseTree a]\n                   deriving (Show)\n\ninstance (Show a) =&gt; JSON.ToJSON (RoseTree a) where\n    toJSON (RoseTree n cs) =\n        JSON.object [T.pack \"value\" JSON..= show n\n        , T.pack \"children\" JSON..= JSON.toJSON cs] \n\ninstance (Show a, JSON.FromJSON a) =&gt; JSON.FromJSON (RoseTree a) where\n    parseJSON (JSON.Object o) =\n        RoseTree &lt;$&gt; o JSON..: T.pack \"value\"\n        &lt;*&gt; o JSON..: T.pack \"children\"\n\nparseRoseTreeFromJSON :: (Show a, JSON.FromJSON a) =&gt; String -&gt; (RoseTree a)\nparseRoseTreeFromJSON json = \n      let bs = BS.pack json in case parse JSON.json bs of\n               (Done rest r) -&gt; case AT.parseMaybe JSON.parseJSON r of\n                    (Just x) -&gt; x\n                    Nothing -&gt; Empty \n               _ -&gt; Empty\n</code></pre>\n\n<p>It converts <code>RoseTree</code> structure into JSON perfectly fine. For example, when I run <code>JSON.encode $ JSON.toJSON $ RoseTree 1 []</code>, it returns <code>\"{\\\"children\\\":[],\\\"value\\\":\\\"1\\\"}\"</code>, running <code>JSON.encode $ JSON.toJSON $ RoseTree 1 [RoseTree 2 []]</code> returns <code>\"{\\\"children\\\":[{\\\"children\\\":[],\\\"value\\\":\\\"2\\\"}],\\\"value\\\":\\\"1\\\"}\"</code>.</p>\n\n<p>But when I try to supply that JSON I have got on the previous step into the parser, it always returns <code>Empty</code>:</p>\n\n<pre><code>*Main&gt; parseRoseTreeFromJSON \"{\\\"children\\\":[],\\\"value\\\":1}\"\nEmpty\n\n*Main&gt; parseRoseTreeFromJSON \"{\\\"children\\\":[{\\\"children\\\":[],\\\"value\\\":\\\"2\\\"}],\\\"value\\\":\\\"1\\\"}\"\nEmpty\n</code></pre>\n\n<p>Similarly, </p>\n\n<pre><code>*Main&gt; JSON.decode $ BLS.pack \"{\\\"children\\\":[{\\\"children\\\":[],\\\"value\\\":\\\"2\\\"}],\\\"value\\\":\\\"1\\\"}\"\nNothing\n</code></pre>\n\n<p>I suspect that my parser is incorrectly defined. But I cannot tell what exactly is wrong. Is the approach I am using  the correct one to approach recursive parsing? What would be the right way to do it recursively?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1503066543, "post_id": 45757839, "comment_id": 78475894, "body": "what do you not like about your <code>nubSeq</code> it seems fine to me. If you worry about performance, I&#39;d suggest benchmarking with <a href=\"https://hackage.haskell.org/package/criterion\" rel=\"nofollow noreferrer\"><code>criterion</code></a> and if you really want to be thorough - <code>--dump-simpl</code> the output of both versions and compare them."}], "answers": [{"comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1503068493, "post_id": 45759119, "comment_id": 78477193, "body": "Using <code>HashMap</code> instead of <code>Map</code> can potentially improve performance."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1503069475, "post_id": 45759119, "comment_id": 78477865, "body": "If you are already using a different data structure why not <code>Seq.fromList . Set.toList . Set.fromList . Seq.toList</code>?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 3, "creation_date": 1503069514, "post_id": 45759119, "comment_id": 78477890, "body": "@epsilonhalbe - because it does not preserve the ordering - you dummy"}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 1, "creation_date": 1503069697, "post_id": 45759119, "comment_id": 78478020, "body": "I thought you were pretty rude until I realised you were answering to yourself. :D"}, {"owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "edited": false, "score": 3, "creation_date": 1503075624, "post_id": 45759119, "comment_id": 78481240, "body": "<code>Map</code> and sorting does seem like overkill though.  How about just going through the sequence keeping a <code>Set</code> of elements seen so far?"}, {"owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "edited": false, "score": 0, "creation_date": 1503075787, "post_id": 45759119, "comment_id": 78481320, "body": "Martin Erwig has a page about this basic pattern. Nice explanatory .gif and background reading for those interested. <a href=\"http://web.engr.oregonstate.edu/~erwig/meta/\" rel=\"nofollow noreferrer\">web.engr.oregonstate.edu/~erwig/meta</a>"}], "tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 4, "last_activity_date": 1503406767, "last_edit_date": 1503406767, "creation_date": 1503066562, "answer_id": 45759119, "question_id": 45757839, "link": "https://stackoverflow.com/questions/45757839/removing-duplicate-elements-in-a-seq/45759119#45759119", "title": "Removing duplicate elements in a Seq", "body": "<p>Not sure whether this qualifies as more elegant but it splits the concerns in independent functions (caveat: you need an <code>Ord</code> constraint on <code>a</code>):</p>\n\n<ul>\n<li><p><code>seqToNubMap</code> takes a <code>Seq</code> and outputs a <code>Map</code> associating to each <code>a</code> the smallest index at which it appeared in the sequence</p></li>\n<li><p><code>mapToList</code> takes a <code>Map</code> of values and positions and produces a list of values in increasing order according to the specified positions</p></li>\n<li><p><code>nubSeq</code> combines these to generate a sequence without duplicates</p></li>\n</ul>\n\n<p>The whole thing should be O(n*log(n)), I believe:</p>\n\n<pre><code>module NubSeq where\n\nimport Data.Map      as Map\nimport Data.List     as List\nimport Data.Sequence as Seq\nimport Data.Function\n\nseqToNubMap :: Ord a =&gt; Seq a -&gt; Map a Int\nseqToNubMap = foldlWithIndex (\\ m k v -&gt; insertWith min v k m) Map.empty\n\nmapToList :: Ord a =&gt; Map a Int -&gt; [a]\nmapToList = fmap fst . List.sortBy (compare `on` snd) . Map.toList\n\nnubSeq :: Ord a =&gt; Seq a -&gt; Seq a\nnubSeq = Seq.fromList . mapToList . seqToNubMap\n</code></pre>\n\n<p>Or a simpler alternative following @DavidFletcher's comment:</p>\n\n<pre><code>nubSeq' :: forall a. Ord a =&gt; Seq a -&gt; Seq a\nnubSeq' xs = Fold.foldr cons nil xs Set.empty where\n\n  cons :: a -&gt; (Set a -&gt; Seq a) -&gt; (Set a -&gt; Seq a)\n  cons x xs seen\n    | x `elem` seen = xs seen\n    | otherwise     = x &lt;| xs (Set.insert x seen)\n\n  nil :: Set a -&gt; Seq a\n  nil _ = Seq.empty\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "is_accepted": false, "score": 0, "last_activity_date": 1503084388, "creation_date": 1503084388, "answer_id": 45763790, "question_id": 45757839, "link": "https://stackoverflow.com/questions/45757839/removing-duplicate-elements-in-a-seq/45763790#45763790", "title": "Removing duplicate elements in a Seq", "body": "<p>Another way with an <code>Ord</code> constraint - use a scan to make the sets of\nelements that appear in each prefix of the list.  Then we can filter out\nany element that's already been seen.</p>\n\n<pre><code>import Data.Sequence as Seq\nimport Data.Set as Set\n\nnubSeq :: Ord a =&gt; Seq a -&gt; Seq a\nnubSeq xs = (fmap fst . Seq.filter (uncurry notElem)) (Seq.zip xs seens)\n  where\n    seens = Seq.scanl (flip Set.insert) Set.empty xs\n</code></pre>\n\n<p>Or roughly the same thing as a mapAccumL:</p>\n\n<pre><code>nubSeq' :: Ord a =&gt; Seq a -&gt; Seq a\nnubSeq' = fmap fst . Seq.filter snd . snd . mapAccumL f Set.empty\n  where\n    f s x = (Set.insert x s, (x, x `notElem` s))\n</code></pre>\n\n<p>(If I was using lists I would use Maybes instead of the pairs with\nBool, then use catMaybes instead of filtering.  There doesn't seem to be catMaybes\nfor Sequence though.)</p>\n"}, {"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": -2, "last_activity_date": 1503146673, "creation_date": 1503146673, "answer_id": 45771697, "question_id": 45757839, "link": "https://stackoverflow.com/questions/45757839/removing-duplicate-elements-in-a-seq/45771697#45771697", "title": "Removing duplicate elements in a Seq", "body": "<p>I think your code should be pretty efficient. Since Sequences are tree data structures using another tree type data structure like Map or HashMap to store and lookup the previous items doesn't make too much sense to me.</p>\n\n<p>Instead i take the first item and check it's existence in the rest. If exists i drop that item and proceed the same with the rest recursively. If not then construct a new sequence with first element is the unique element and the rest is the result of nubSeq fed by the rest. Should be typical. I use ViewPatterns.</p>\n\n<pre><code>{-# LANGUAGE ViewPatterns #-}\nimport Data.Sequence as Seq\n\nnubSeq :: Eq a =&gt; Seq a -&gt; Seq a\nnubSeq (viewl -&gt; EmptyL)    = empty\nnubSeq (viewl -&gt; (x :&lt; xs)) | elemIndexL x xs == Nothing = x &lt;| nubSeq xs\n                            | otherwise                  = nubSeq xs\n\n*Main&gt; nubSeq . fromList $ [1,2,3,4,4,2,3,6,7,1,2,3,4]\nfromList [6,7,1,2,3,4]\n</code></pre>\n"}], "owner": {"reputation": 85, "user_id": 5444309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80bf5225a7f0542c18486d6371553560?s=128&d=identicon&r=PG&f=1", "display_name": "esjmb", "link": "https://stackoverflow.com/users/5444309/esjmb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 234, "favorite_count": 0, "answer_count": 3, "score": 3, "last_activity_date": 1503406767, "creation_date": 1503062783, "last_edit_date": 1503064644, "question_id": 45757839, "link": "https://stackoverflow.com/questions/45757839/removing-duplicate-elements-in-a-seq", "title": "Removing duplicate elements in a Seq", "body": "<p>wondering how to implement <code>nub</code> over a <code>Seq a</code></p>\n\n<p>I get that one could do:</p>\n\n<pre><code>nubSeq :: Seq a -&gt; Seq a\nnubSeq = fromList . nub . toList\n</code></pre>\n\n<p>Just wondering is there something standard that does not convert to Lists in order to call <code>nub :: [a]-&gt;[a]</code>? </p>\n\n<p>An implementation that occurred to me, based obviously on nub, is:</p>\n\n<pre><code>nubSeq :: (Eq a) =&gt; Seq a -&gt; Seq a\nnubSeq = Data.Sequence.foldrWithIndex \n           (\\_ x a -&gt; case x `Data.Sequence.elemIndexR` a of\n                        Just _ -&gt; a\n                        Nothing -&gt; a |&gt; x) Data.Sequence.empty \n</code></pre>\n\n<p>But there must be something more elegant?</p>\n\n<p>thanks.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "edited": false, "score": 1, "creation_date": 1503058398, "post_id": 45753657, "comment_id": 78469892, "body": "You don&#39;t. You get a Maybe last element!"}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1503130880, "post_id": 45753657, "comment_id": 78496842, "body": "Are you worried about using the built-in function &#39;error&#39; ?"}], "answers": [{"tags": [], "owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "is_accepted": false, "score": 7, "last_activity_date": 1503073491, "last_edit_date": 1503073491, "creation_date": 1503049951, "answer_id": 45753715, "question_id": 45753657, "link": "https://stackoverflow.com/questions/45753657/returning-the-last-element-of-a-list-in-haskell-using-recursion/45753715#45753715", "title": "Returning the last element of a list in haskell using recursion", "body": "<p>You just have to check when an element is cons with an <code>Empty</code>:</p>\n\n<pre><code>lastList :: List a -&gt; a\nlastList lst =\n   case lst of\n       Cons x Empty -&gt; x\n       Cons _ xs    -&gt; lastList xs\n       Empty        -&gt; error \"lastList of empty list\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 3, "last_activity_date": 1503057873, "last_edit_date": 1503057873, "creation_date": 1503056242, "answer_id": 45755756, "question_id": 45753657, "link": "https://stackoverflow.com/questions/45753657/returning-the-last-element-of-a-list-in-haskell-using-recursion/45755756#45755756", "title": "Returning the last element of a list in haskell using recursion", "body": "<p>The <code>Cons</code> is a <em>Lisp</em> like list where a list is represented as a linked list. Each <code>Cons h t</code> is a node where <code>h</code> refers to the <em>head</em> of that node (an element), an the <code>t</code> to the <em>tail</em> of the list: the remainder. Furthermore the end of the list (the empty list) is here represented with <code>Empty</code>.</p>\n\n<p>So that means that a <em>list with one element</em> <code>x</code> is represented as <code>Cons x Empty</code> (this is equivalent to <code>[x]</code>). In case we encounter this, we have to return <code>x</code>, since the last element of a list with one element is that element.</p>\n\n<p>So the question is what to do in the case we have a <code>Cons h t</code> where <code>t</code> is not <code>Empty</code>. In that case the list thus looks like <code>[x1,x2,...]</code>. Now the last element of that list is the same as the last element of the <code>[x2,x3,...]</code> list, so we can use recursion on the tail.</p>\n\n<p>Finally we have to find a way to resolve the case where we provide an empty list to the function. In that case we probably better provide an <code>error</code>.</p>\n\n<p>So we can implement it like:</p>\n\n<pre><code>lastList :: List a -&gt; a\nlastList (Cons h Empty) = h\nlastList (Cons _ t) = lastList t\nlastList Empty = error \"An empty list has no lastElement\"\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 8482870, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-CuPwDQeQGq4/AAAAAAAAAAI/AAAAAAAABBM/VYiINvmC2bo/photo.jpg?sz=128", "display_name": "Amirul Hidayat Ahmad", "link": "https://stackoverflow.com/users/8482870/amirul-hidayat-ahmad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 823, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1503073491, "creation_date": 1503049764, "last_edit_date": 1503049853, "question_id": 45753657, "link": "https://stackoverflow.com/questions/45753657/returning-the-last-element-of-a-list-in-haskell-using-recursion", "title": "Returning the last element of a list in haskell using recursion", "body": "<p>How do I get the last element in a list in haskell? I have written some of the code below: </p>\n\n<pre><code>lastList :: List a -&gt; a\nlastList lst =\n   case lst of\n       Cons x xs -&gt; lastList xs\n       Cons _ xs -&gt; lastList xs\n       Empty    -&gt; error \"lastList of empty list\"\n</code></pre>\n\n<p>How do I do it without using any of the built in functions?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1503023947, "post_id": 45747497, "comment_id": 78452630, "body": "This is one pass of <a href=\"https://en.wikipedia.org/wiki/Bubble_sort\" rel=\"nofollow noreferrer\">bubble sort</a>. You need to keep calling <code>order</code> until the list stops changing."}], "answers": [{"tags": [], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "is_accepted": true, "score": 6, "last_activity_date": 1503036814, "last_edit_date": 1503036814, "creation_date": 1503025022, "answer_id": 45747807, "question_id": 45747497, "link": "https://stackoverflow.com/questions/45747497/recursion-error-while-sorting-a-list-of-numbers-without-quicksort/45747807#45747807", "title": "Recursion error while sorting a list of numbers without quicksort", "body": "<p>The code is fine and does exactly what you implemented, but what you implemented does not in fact sort a list.  Let's try it with <code>[4,3,2]</code>:</p>\n\n<pre><code>order [4,3,2]\n\norder [] = []               -- Nope not an empty list\norder [x] = [x]             -- nope not a singleton\norder (x:y:xs) = if x&gt;y     -- x=4, y=3, xs =[2]; x &gt;y  is true\nthen [y] ++ (order (x:xs))  -- this branch [3] ++ (order [4,2])\nelse [x] ++ (order (y:xs))  -- not this branch\n</code></pre>\n\n<p>So we get to <code>[3] ++ (order [4,2])</code>.  Question for you: how does <code>2</code> move to the other side of <code>3</code>?</p>\n"}], "owner": {"reputation": 23, "user_id": 8481011, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6daa884062c9d06851c53ed88920d233?s=128&d=identicon&r=PG&f=1", "display_name": "Sandy Sea", "link": "https://stackoverflow.com/users/8481011/sandy-sea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 45747807, "answer_count": 1, "score": 1, "last_activity_date": 1503036814, "creation_date": 1503022405, "last_edit_date": 1503025984, "question_id": 45747497, "link": "https://stackoverflow.com/questions/45747497/recursion-error-while-sorting-a-list-of-numbers-without-quicksort", "title": "Recursion error while sorting a list of numbers without quicksort", "body": "<pre><code>order :: [Int] -&gt; [Int]\norder [] = []\norder [x] = [x]\norder (x:y:xs) = if x&gt;y\nthen [y] ++ (order (x:xs))\nelse [x] ++ (order (y:xs))\n</code></pre>\n\n<p>I tried to use this Haskell code to sort a list of numbers, but when I input a list with more than 4 elements it doesn't sort them correctly. I want to keep the code as it compiles but I don't know how to make the recursion work correctly.</p>\n"}, {"tags": ["haskell", "opengl", "glut"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503025296, "post_id": 45747355, "comment_id": 78452905, "body": "I would begin by testing the equivalent C program to determine if the issue is with the Haskell bindings. Also note that GLUT (provided by <code>glut32.dll</code> or <code>freeglut.dll</code>) and OpenGL (provided by <code>glu32.dll</code> and <code>opengl32.dll</code>) are different libraries (although the latter is a dependency of the former)."}, {"owner": {"reputation": 2336, "user_id": 799829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/736cd516c29ee2f6cdc2c8f454a36bb9?s=128&d=identicon&r=PG", "display_name": "Tim", "link": "https://stackoverflow.com/users/799829/tim"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1503028174, "post_id": 45747355, "comment_id": 78453645, "body": "Yep, I was aware that glut wraps the other DLLs. I was hoping it was something obvious, e.g.  &quot;Yes, known bug in the Haskell OGL bindings....&quot; Surely, a similar &quot;hello world&quot; example gets tested by the bindings library. I guess I have to write the C program. :("}, {"owner": {"reputation": 8142, "user_id": 1973259, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Yg5l5.png?s=128&g=1", "display_name": "radical7", "link": "https://stackoverflow.com/users/1973259/radical7"}, "edited": false, "score": 1, "creation_date": 1503035343, "post_id": 45747355, "comment_id": 78455826, "body": "I don&#39;t think this is a Haskell-specific problem. I vaguely recall that some GLUT implementations would cause an OpenGL error before the first application-issued OpenGL call (I think it was something related to trying to check extensions without a context).  To see if that&#39;s the problem, call <code>glGetError()</code> as soon as you have a context (which occurs in GLUT when the window opens).  The GL error flag persists across calls until <code>glGetError</code> is called, so you may indeed be getting a stale error."}, {"owner": {"reputation": 2336, "user_id": 799829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/736cd516c29ee2f6cdc2c8f454a36bb9?s=128&d=identicon&r=PG", "display_name": "Tim", "link": "https://stackoverflow.com/users/799829/tim"}, "edited": false, "score": 0, "creation_date": 1503086043, "post_id": 45747355, "comment_id": 78486562, "body": "Hmm. Still in Haskell. There are no errors after context creation, but I did determine that the error is only raised once (on the first <code>glEnd()</code>. Successive frames don&#39;t create errors. I&#39;ll try C."}], "owner": {"reputation": 2336, "user_id": 799829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/736cd516c29ee2f6cdc2c8f454a36bb9?s=128&d=identicon&r=PG", "display_name": "Tim", "link": "https://stackoverflow.com/users/799829/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 110, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1503021398, "creation_date": 1503021398, "question_id": 45747355, "link": "https://stackoverflow.com/questions/45747355/minimal-haskell-opengl-example-causes-opengl-error", "title": "Minimal Haskell OpenGL Example causes OpenGL Error", "body": "<p>I was toying with an OpenGL example and ran into a problem.  I minimized it to one of the <a href=\"https://wiki.haskell.org/OpenGLTutorial1\" rel=\"nofollow noreferrer\">mainstream Haskell/OpenGL examples</a>.  This is with Windows 10, Haskell Platform (32-bit 8.0.2-a.  Almost positive it's the -a variant).</p>\n\n<pre><code>import Graphics.UI.GLUT\n\nmain :: IO ()\nmain = do\n  (_progName, _args) &lt;- getArgsAndInitialize\n  _window &lt;- createWindow \"Hello World\"\n  displayCallback $= display\n  mainLoop\n\ndisplay = do\n  let color3f r g b = color $ Color3 r g (b :: GLfloat)\n      vertex3f x y z = vertex $ Vertex3 x y (z :: GLfloat)\n  clear [ColorBuffer]\n  renderPrimitive Points $ do\n    -- color3f 1 0 0\n    -- vertex3f 0 0 0\n    return ()\n  -- &lt;&lt; error on glEnd() of renderPrimtive &gt;&gt;\n\n  flush\n  reportErrors\n</code></pre>\n\n<p>Facts:</p>\n\n<ul>\n<li><p>I've tried this with the default <code>glut32.dll</code> that comes with the Haskell Platform (GHC 8.0.2) and I also tried <code>freeglut</code>.  Using gDEBugger, I was able to determine that the <code>glEnd</code> command reports the error first (called by <code>renderPrimtive</code>).  Even with no body (vertices or color changes), the render issues some command that makes OpenGL unhappy (, or the empty command generates a different error).</p></li>\n<li><p>I tried this with other primitives too <code>Lines</code> and even the example program from the link above (uses <code>Quads</code>).</p></li>\n<li><p>The primitives actually render correctly on my screen even with the error.  (But I desire error checking for my own screw ups, so this false positive is bad.)</p></li>\n</ul>\n\n<p><em>Does anyone have an idea how to go about debugging this?</em> Thanks!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1503000288, "post_id": 45744009, "comment_id": 78445496, "body": "Please post the error you obtain. Furthermore instead of simply stopping with &quot;there are compiler errors&quot;, it would be nice to show what you think the errors mean. Usually a compiler aims to be descriptive about what the errors are."}], "answers": [{"comments": [{"owner": {"reputation": 1309, "user_id": 4121440, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh6.googleusercontent.com/-sa6Am0YxEy0/AAAAAAAAAAI/AAAAAAAAABg/4mikHQDhZbI/photo.jpg?sz=128", "display_name": "Oleg", "link": "https://stackoverflow.com/users/4121440/oleg"}, "edited": false, "score": 0, "creation_date": 1503000456, "post_id": 45744076, "comment_id": 78445579, "body": "thanks , that got me moving but the book exercise give me this signature groupElems :: Eq a =&gt; [a] -&gt; [[a]]"}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 1309, "user_id": 4121440, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh6.googleusercontent.com/-sa6Am0YxEy0/AAAAAAAAAAI/AAAAAAAAABg/4mikHQDhZbI/photo.jpg?sz=128", "display_name": "Oleg", "link": "https://stackoverflow.com/users/4121440/oleg"}, "edited": false, "score": 2, "creation_date": 1503000543, "post_id": 45744076, "comment_id": 78445616, "body": "In that case, why are you trying to compare less-than-or-equal-to? Why not just compare for equality?"}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": false, "score": 2, "last_activity_date": 1503000263, "creation_date": 1503000263, "answer_id": 45744076, "question_id": 45744009, "link": "https://stackoverflow.com/questions/45744009/group-consecutive-alike-elements/45744076#45744076", "title": "Group consecutive alike elements", "body": "<p>You are constraining your function so that <code>a</code> must be of class <code>Eq</code>. However, the function <code>&lt;=</code> belongs to the <code>Ord</code> typeclass. Try changing the function annotation to this:</p>\n\n<pre><code>groupElems :: Ord a =&gt; [a] -&gt; [[a]]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": false, "score": 3, "last_activity_date": 1503000556, "creation_date": 1503000556, "answer_id": 45744143, "question_id": 45744009, "link": "https://stackoverflow.com/questions/45744009/group-consecutive-alike-elements/45744143#45744143", "title": "Group consecutive alike elements", "body": "<p>The compiler says that <code>a</code> must be an instance of <code>Ord</code> typeclass, because of using <code>&lt;=</code>. So you can correct your code to this:</p>\n\n<pre><code>groupElems :: Ord a =&gt; [a] -&gt; [[a]]\n</code></pre>\n\n<p>But if you still need to use <code>Eq</code>, you can use <code>==</code> instead of <code>&lt;=</code> and the code will work.</p>\n\n<p>I also noticed, that your version of code returned <code>[1, [], [3]]</code> on <code>[1,2,2,3,3]</code> example, because you passed <code>xs</code> instead of the whole list.</p>\n\n<pre><code>groupElems :: Eq a =&gt; [a] -&gt; [[a]]\ngroupElems [] = []\ngroupElems all@(x:xs) =\n    let (a,b) = span (== x) all\n    in a : (groupElems b)\n</code></pre>\n\n<p>By the way, there's <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Data-List.html#v:group\" rel=\"nofollow noreferrer\">group</a> function in <code>Data.List</code> module that does exactly what you're going to achieve</p>\n"}, {"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 3, "last_activity_date": 1503000726, "creation_date": 1503000726, "answer_id": 45744182, "question_id": 45744009, "link": "https://stackoverflow.com/questions/45744009/group-consecutive-alike-elements/45744182#45744182", "title": "Group consecutive alike elements", "body": "<p>I think what you are looking for is <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Data-List.html#v:group\" rel=\"nofollow noreferrer\">Data.List.group</a>;</p>\n\n<pre><code>Prelude&gt; Data.List.group [1,2,2,2,4]\n[[1],[2,2,2],[4]]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 8, "last_activity_date": 1503000821, "creation_date": 1503000821, "answer_id": 45744202, "question_id": 45744009, "link": "https://stackoverflow.com/questions/45744009/group-consecutive-alike-elements/45744202#45744202", "title": "Group consecutive alike elements", "body": "<p>The compiler says:</p>\n\n<blockquote>\n<pre><code>Could not deduce (Ord a) arising from a use of \u2018&lt;=\u2019\nfrom the context (Eq a)\n  bound by the type signature for groupElems :: Eq a =&gt; [a] -&gt; [[a]]\n</code></pre>\n</blockquote>\n\n<p>What the Haskell compiler aims to say is that you use <code>&lt;= x</code> om your code, but the <code>&lt;=</code> function is <em>not</em> part of the <code>Eq</code> typeclass: if we ask where <code>&lt;=</code> originates from, we get:</p>\n\n<pre><code>Prelude&gt; :i (&lt;=)\nclass Eq a =&gt; Ord a where\n  ...\n  (&lt;=) :: a -&gt; a -&gt; Bool\n  ...\n    -- Defined in \u2018GHC.Classes\u2019\ninfix 4 &lt;=\n</code></pre>\n\n<p>So we can solve the issue by using the <code>Ord</code> typeclass: it means that the elements are ordered. But based on your examples this is <em>not</em> what you want. If we use <code>Ord a</code> as type constraint, like:</p>\n\n<pre><code>groupElems :: <b>Ord</b> a =&gt; [a] -&gt; [[a]]\ngroupElems [] = []\ngroupElems (x:xs) = \n    let (a,b) = span (&lt;= x) xs\n    in a : (groupElems b)</code></pre>\n\n<p>A second problem is that we *call <code>span</code> on the <code>xs</code> list. <code>xs</code> is the <em>tail</em> of the list. So that means we will not take the head into account. We can alter this by using an alias <code>@</code> and process the entire list <code>xa</code>:</p>\n\n<pre><code>groupElems :: <b>Ord</b> a =&gt; [a] -&gt; [[a]]\ngroupElems [] = []\ngroupElems <b>xa@</b>(x:<b>_</b>) = \n    let (a,b) = span (&lt;= x) xa\n    in a : (groupElems b)</code></pre>\n\n<p>we will obtain:</p>\n\n<pre><code>GHci &gt; groupElems []\n[]\nGHci &gt; groupElems [1,2]\n[[1],[2]]\nGHci &gt; groupElems [1,2,2,2,4]\n[[1],[2,2,2],[4]]\nGHci &gt; groupElems [1,2,3,2,4]\n[[1],[2],[3,2],[4]]\n</code></pre>\n\n<p>Note that the last test case is not correct. That is because both <code>3</code> and <code>2</code> satisfy the <code>&lt;= 3</code> predicate.</p>\n\n<p>In case you want to group by <em>equality</em>, you should use the <code>(==) :: Eq a =&gt; a -&gt; a -&gt; Bool</code> function:</p>\n\n<pre><code>groupElems :: <b>Eq</b> a =&gt; [a] -&gt; [[a]]\ngroupElems [] = []\ngroupElems <b>xa@</b>(x:_) = \n    let (a,b) = span (<b>==</b> x) <b>xa</b>  -- use == instead of &lt;=\n    in a : (groupElems b)</code></pre>\n\n<p>which then produces:</p>\n\n<pre><code>GHci &gt; groupElems []\n[]\nGHci &gt; groupElems [1,2]\n[[1],[2]]\nGHci &gt; groupElems [1,2,2,2,4]\n[[1],[2,2,2],[4]]\nGHci &gt; groupElems [1,2,3,2,4]\n[[1],[2],[3],[2],[4]]\n</code></pre>\n"}], "owner": {"reputation": 1309, "user_id": 4121440, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh6.googleusercontent.com/-sa6Am0YxEy0/AAAAAAAAAAI/AAAAAAAAABg/4mikHQDhZbI/photo.jpg?sz=128", "display_name": "Oleg", "link": "https://stackoverflow.com/users/4121440/oleg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 198, "favorite_count": 0, "accepted_answer_id": 45744202, "answer_count": 4, "score": 0, "last_activity_date": 1503001336, "creation_date": 1502999926, "last_edit_date": 1503001336, "question_id": 45744009, "link": "https://stackoverflow.com/questions/45744009/group-consecutive-alike-elements", "title": "Group consecutive alike elements", "body": "<p>I'm new to Haskell and here's what I want to do :\n<a href=\"https://i.stack.imgur.com/hejrv.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/hejrv.png\" alt=\"enter image description here\"></a></p>\n\n<p>So far only compiler errors :</p>\n\n<pre><code>groupElems :: Eq a =&gt; [a] -&gt; [[a]]\ngroupElems [] = []\ngroupElems (x:xs) = \n    let (a,b) = span (&lt;= x) xs\n    in a : (groupElems b)\n</code></pre>\n\n<p>Thank you.</p>\n\n<p>Error :</p>\n\n<pre><code>Could not deduce (Ord a) arising from a use of \u2018&lt;=\u2019\nfrom the context (Eq a)\n  bound by the type signature for groupElems :: Eq a =&gt; [a] -&gt; [[a]]\n</code></pre>\n"}, {"tags": ["haskell", "typeclass", "existential-type", "subtyping"], "comments": [{"owner": {"reputation": 2044, "user_id": 6733371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5a4c02ed1ce17fd1f60579e73384d310?s=128&d=identicon&r=PG&f=1", "display_name": "qfwfq", "link": "https://stackoverflow.com/users/6733371/qfwfq"}, "edited": false, "score": 0, "creation_date": 1502997593, "post_id": 45743125, "comment_id": 78444087, "body": "I&#39;m pretty new to existentials, but the way I am reading this is <code>f1</code> does not satisfy the &quot;unknown instance&quot; part. It is set at <code>Int</code>, it isn&#39;t unknown. I think if you changed the signature of <code>f1</code> to <code>Integral a =&gt; () -&gt; a</code> it would work."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1502998306, "post_id": 45743125, "comment_id": 78444450, "body": "What sort of subtyping are you looking at? Haskell doesn&#39;t really support subtyping (in the usual sense, at the very least)."}, {"owner": {"reputation": 2044, "user_id": 6733371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5a4c02ed1ce17fd1f60579e73384d310?s=128&d=identicon&r=PG&f=1", "display_name": "qfwfq", "link": "https://stackoverflow.com/users/6733371/qfwfq"}, "edited": false, "score": 0, "creation_date": 1502998682, "post_id": 45743125, "comment_id": 78444661, "body": "Looking at the answer, I think I may have initially misunderstood the question."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1502998848, "post_id": 45743125, "comment_id": 78444753, "body": "There are no existentials in the code you posted, only universals."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1502999451, "post_id": 45743125, "comment_id": 78445048, "body": "@chi If Haskell supported it, I believe a <code>forall</code> in that position would be equivalent to an existential."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1503004828, "post_id": 45743125, "comment_id": 78447693, "body": "@DavidYoung Why? Agda, Coq, etc. support &quot;exists&quot; and &quot;forall&quot; in all positions, but &quot;forall&quot; is always a universal. And so is in Haskell, except in type declarations like <code>data T = forall a. K ...</code> (which IMO are a very bad choice of syntax)."}, {"owner": {"reputation": 55, "user_id": 2240422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fca9c7157a98d067cfc4e614a4949090?s=128&d=identicon&r=PG", "display_name": "gcnew", "link": "https://stackoverflow.com/users/2240422/gcnew"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1503005933, "post_id": 45743125, "comment_id": 78448140, "body": "@chi My terminology might be wrong. My intended behaviour is &quot;some type t that cannot be specified by the user&quot;. As far as I know it&#39;s an &quot;existential&quot;. I.e. I&#39;m trying to write a function that returns an unboxed value, for which the only thing we know is that it&#39;s an instance of some type class. Based on other explicit <code>forall</code> usages I&#39;ve seen, I was expecting the above snippet to work, but for some reason the compiler floats the <code>forall</code> out. I guess this syntax does not have the meaning I&#39;ve thought it to have."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1503006858, "post_id": 45743125, "comment_id": 78448485, "body": "@gcnew If &quot;user&quot; is the caller the the function, then yes, that would be an existential. Haskell does not support them, unless under some data or newtype wrapper (as in David Young&#39;s answer). <code>forall a.</code>, in the position shown in the question, is chosen by the user, and indicates a universal."}, {"owner": {"reputation": 55, "user_id": 2240422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fca9c7157a98d067cfc4e614a4949090?s=128&d=identicon&r=PG", "display_name": "gcnew", "link": "https://stackoverflow.com/users/2240422/gcnew"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1503007000, "post_id": 45743125, "comment_id": 78448547, "body": "@chi I think that&#39;s the real answer to the question, do you mind posting it as such?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1503007123, "post_id": 45743125, "comment_id": 78448589, "body": "Another way of having existentials (without defining a data type) is via CPS ala <code>(forall a. Integral a =&gt; a -&gt; c) -&gt; c</code> instead of <code>data ExistsIntegral = forall a. Integral a =&gt; ExistsIntegral a</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1503007310, "post_id": 45743125, "comment_id": 78448652, "body": "@Alec Indeed, albeit I fear that might be confusing for a beginner. The main difference is that, in the CPS variant the <code>forall</code> appears in <i>contravariant</i> (argument) position, since it is at the left of <code>-&gt;</code>."}, {"owner": {"reputation": 55, "user_id": 2240422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fca9c7157a98d067cfc4e614a4949090?s=128&d=identicon&r=PG", "display_name": "gcnew", "link": "https://stackoverflow.com/users/2240422/gcnew"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1503007659, "post_id": 45743125, "comment_id": 78448790, "body": "@Alec, Yes, indeed. Unfortunately it fails when I try to use it for to infer the result of <code>f1 :: Int</code>; <code>f2 :: (forall a. Integral a =&gt; a -&gt; r) -&gt; r</code>; <code>r = if True then f1 else f2 id</code>. Thank you!"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1503007867, "post_id": 45743125, "comment_id": 78448869, "body": "@gcnew True. The only subtyping you get is with foralls. Otherwise, the next closest thing you gets is wrapped existentials. I was just trying to point out that your use of <code>forall</code> does <i>not</i> amount to an existential (and I did this by showing you how you <i>could</i> use <code>forall</code> to simulate an existential)."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1503041140, "post_id": 45743125, "comment_id": 78458921, "body": "@chi You&#39;re right. I was confusing this with the equivalence of existentials in a <i>left</i>-hand side of an arrow/contravariant position (the equivalence of <code>(exists a. a) -&gt; r</code> and <code>forall a. (a -&gt; r)</code>, given a hypothetical <code>exists</code> feature in Haskell)."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1503053467, "post_id": 45743125, "comment_id": 78466792, "body": "Re. the co/contravariance relationship, <code>() -&gt; (forall a. Integral a =&gt; a)</code> is the same as <code>forall a. Integral a =&gt; () -&gt; a</code>, which might make it clearer why that doesn\u2019t do what you want. People don\u2019t usually do this, but you can actually write type signatures like <code>traverse :: forall a b f. Applicative f =&gt; (a -&gt; f b) -&gt; forall t. Traversable t =&gt; t a -&gt; f (t b)</code>\u2014which I guess could be useful for readability sometimes."}], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 2240422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fca9c7157a98d067cfc4e614a4949090?s=128&d=identicon&r=PG", "display_name": "gcnew", "link": "https://stackoverflow.com/users/2240422/gcnew"}, "edited": false, "score": 0, "creation_date": 1503003571, "post_id": 45743403, "comment_id": 78447122, "body": "Yes, I saw that the existential is floated out, but I didn&#39;t understand why. Do you have any source explaining that behaviour?  I&#39;m trying to use Haskell as a tool to verify the behaviour of other languages, that&#39;s why my example is so contrived. In this specific instance, I&#39;m trying to see whether I can simulate something like <a href=\"https://github.com/Microsoft/TypeScript/issues/17863\" rel=\"nofollow noreferrer\">github.com/Microsoft/TypeScript/issues/17863</a>. I.e. if my above example was working, what would have the inferred type of <code>if True then f1 else f2</code> been."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 55, "user_id": 2240422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fca9c7157a98d067cfc4e614a4949090?s=128&d=identicon&r=PG", "display_name": "gcnew", "link": "https://stackoverflow.com/users/2240422/gcnew"}, "edited": false, "score": 0, "creation_date": 1503038098, "post_id": 45743403, "comment_id": 78457131, "body": "This answer uses the term &quot;existential&quot; in a confusing way, and it seems like it successfully confused @gcnew. The way <code>f2</code> was written in the OP is a <i>universal</i>, and the floating happens mostly as a convenience to the compiler, because the types are equivalent.  Without floating, <code>() -&gt; forall a. &lt;...&gt;</code> and <code>forall a. () -&gt; &lt;...&gt;</code> are still essentially the same type, and there is nothing existential about either of them. I don&#39;t think quantifier floating has anything to do with this question."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1503040935, "post_id": 45743403, "comment_id": 78458811, "body": "@luqui You&#39;re right. I was confusing this with the equivalence between <code>(exists a. a) -&gt; r</code> and <code>forall a. (a -&gt; r)</code>. I have updated my answer to hopefully correct the incorrect bits and improve the unclear information."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 55, "user_id": 2240422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fca9c7157a98d067cfc4e614a4949090?s=128&d=identicon&r=PG", "display_name": "gcnew", "link": "https://stackoverflow.com/users/2240422/gcnew"}, "edited": false, "score": 0, "creation_date": 1503042220, "post_id": 45743403, "comment_id": 78459552, "body": "@gcnew Also, for the purposes of examining the behavior of existential types, you might want to try a language like Coq that has better support for them. Coq is somewhat similar to Haskell, at least in how a lot of its basics work. There is <a href=\"https://softwarefoundations.cis.upenn.edu/current/index.html\" rel=\"nofollow noreferrer\">a nice free book on Coq too</a>. Coq was also specifically designed for verification tasks."}], "tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": true, "score": 6, "last_activity_date": 1503045426, "last_edit_date": 1503045426, "creation_date": 1502997634, "answer_id": 45743403, "question_id": 45743125, "link": "https://stackoverflow.com/questions/45743125/why-doesnt-subtyping-via-existentials-and-constraints-work/45743403#45743403", "title": "Why doesn&#39;t subtyping via existentials and constraints work?", "body": "<p>The <code>a</code> type you have in your <code>f2</code> is universally quantified, not existentially quantified. GHC doesn't <em>directly</em> support kind of existential types that you're looking for.</p>\n\n<p>You can, however, get something like this by wrapping it up in a new data type:</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\n{-# LANGUAGE ConstraintKinds           #-}\n\ndata Constrained c = forall a. c a =&gt; Constrained a\n\nf1 :: () -&gt; Int\nf1 _ = 5\n\nf2 :: () -&gt; Constrained Integral\nf2 unit = Constrained (f1 unit)\n</code></pre>\n\n<p>Now, this often isn't terribly useful because all that has been accomplished is that we've thrown out all (type) information about <code>f2 ()</code> except that its type is an instance of <code>Integral</code>. You no longer know it's an <code>Int</code>. It's possible to keep track of this information as well, but that may or may not be useful depending on what you're doing.</p>\n\n<p>More context for what you're doing and what you're looking to see would make it easier what sort of information about those kinds of things I should add.</p>\n\n<p>As a side note: it isn't necessary to make those into functions that take an argument. You could just have <code>f1 :: Int</code> and <code>f2 :: Constrained Integral</code>.</p>\n\n<p>Also, I would feel a bit remiss if I didn't mention that, despite downplaying the utility of these sorts of types in Haskell a bit earlier in this answer, <a href=\"https://stackoverflow.com/questions/33586720/list-of-showables-oop-beats-haskell/33587837#33587837\">I wrote an answer that describes some potentially practical uses for constrained existential types</a>. While we're somewhat on the subject, it's probably also worth pointing out that <code>ConstraintKinds</code> is a powerful extension, whose use goes beyond just constrained existentials.</p>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 5, "last_activity_date": 1503047140, "last_edit_date": 1503047140, "creation_date": 1503044218, "answer_id": 45751842, "question_id": 45743125, "link": "https://stackoverflow.com/questions/45743125/why-doesnt-subtyping-via-existentials-and-constraints-work/45751842#45751842", "title": "Why doesn&#39;t subtyping via existentials and constraints work?", "body": "<p>You're reading the type of <code>f2</code> the wrong way around.</p>\n\n<p>The type of <code>f2</code> says \"if you give me a <code>()</code>, I will give you a <code>(forall a. Integral a =&gt; a)</code>. That is, <code>f2</code> promises to give you a value that can be used as if it were in <strong>any</strong> type that is a member of <code>Integral</code>.</p>\n\n<p>However the implementation of <code>f2</code> says it will achieve this by simply calling <code>f1</code>. But <code>f1</code> only returns <code>Int</code>! That is indeed a member of <code>Integral</code>, but it's not usable as <em>any</em> type that is a member of <code>Integral</code>.</p>\n\n<p>In fact, the type <code>f1</code> is actually a subtype of <code>f2</code>'s type, rather than the other way around! This actually works:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\nf1 :: () -&gt; Int\nf1 = f2\n\nf2 :: () -&gt; (forall a. Integral a =&gt; a)\nf2 _ = 5\n</code></pre>\n\n<p>It works because numeric literals are polymorphic, so a <code>5</code> can be any <code>Num</code> type (and <code>Num</code> is a super class of <code>Integral</code>, so if it can be any <code>Num</code> it can also be any <code>Integral</code>). <code>f1</code> then calls <code>f2</code> requesting that <code>Int</code> be the choice for <code>a</code>.</p>\n\n<p>You noticed that GHC seems to be converting the type you wrote to <code>f2 :: forall a. Integral a =&gt; () -&gt; a</code>, and you're right; it <em>does</em> actually normalise what you wrote to that type. The reason is those two types actually are the same thing with the way GHC's type system works. The caller instantiates any type variables quantified over the whole type of <code>f2</code>, and the caller would also be the one who receives the return value and so instantiates any type variables quantified over just the return value. Introducing a type variable with <code>forall</code> is the same if you scope if over the whole type or just over the return type of the function; it only makes a difference if it's scoped over the <em>left</em> side of the arrow (which is where higher-rank types come in).</p>\n"}], "owner": {"reputation": 55, "user_id": 2240422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fca9c7157a98d067cfc4e614a4949090?s=128&d=identicon&r=PG", "display_name": "gcnew", "link": "https://stackoverflow.com/users/2240422/gcnew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 188, "favorite_count": 0, "accepted_answer_id": 45743403, "answer_count": 2, "score": 3, "last_activity_date": 1503047140, "creation_date": 1502996586, "last_edit_date": 1502997047, "question_id": 45743125, "link": "https://stackoverflow.com/questions/45743125/why-doesnt-subtyping-via-existentials-and-constraints-work", "title": "Why doesn&#39;t subtyping via existentials and constraints work?", "body": "<p>I've been trying to see how Haskell copes with subtyping so I came up with the following snippet:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE RankNTypes #-}\n\nf1 :: () -&gt; Int\nf1 _ = 5\n\nf2 :: () -&gt; (forall a. Integral a =&gt; a)\nf2 = f1\n</code></pre>\n\n<p>The line <code>f2 = f1</code> fails with an unexpected error message:</p>\n\n<pre><code>Couldn't match type \u2018a\u2019 with \u2018Int\u2019\n  \u2018a\u2019 is a rigid type variable bound by\n    the type signature for:\n      f2 :: forall a. Integral a =&gt; () -&gt; a\n</code></pre>\n\n<p>It seems that the existential has been promoted to a universal, which of course is unintended.</p>\n\n<p>My guess is that in implementation terms <code>f2</code> needs to return a value and a corresponding dictionary, while <code>f1</code> simply returns a value of type <code>Int</code>. However, from a logical perspective the contract of <code>f2</code> is \"a function from <code>()</code> to some unknown instance of <code>Integral</code>\" and <code>f1</code> satisfies it perfectly.</p>\n\n<p>Should GHC do some implicit magic to make it work or am I missing something?</p>\n"}, {"tags": ["haskell", "lambda-calculus", "lexical"], "answers": [{"tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": false, "score": 2, "last_activity_date": 1502995606, "creation_date": 1502995606, "answer_id": 45742862, "question_id": 45742789, "link": "https://stackoverflow.com/questions/45742789/how-are-apostrophes-character-literals-parsed-in-haskell/45742862#45742862", "title": "How are apostrophes/character literals parsed in Haskell?", "body": "<p>The backslash is the escape character so it needs to be doubled up to represent a single backslash: <code>'\\\\'</code>.</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>processInput ('\\\\':input) = processLambda input\n...\n\n-- or...\nprocessInput input\n    | head input == '\\\\'                      = processLambda (tail input)\n...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 6, "last_activity_date": 1502995664, "creation_date": 1502995664, "answer_id": 45742875, "question_id": 45742789, "link": "https://stackoverflow.com/questions/45742789/how-are-apostrophes-character-literals-parsed-in-haskell/45742875#45742875", "title": "How are apostrophes/character literals parsed in Haskell?", "body": "<p>The backslash is a special character in string and character literals. You use to represent non-printable characters, line breaks and characters that would otherwise have special meaning in a literal. For example <code>'\\n'</code> is a line break <code>'\\b'</code> is a back space and <code>'\\''</code> is a single quote (without the <code>\\</code>, the second ' would be seen as the end of the character literal).</p>\n\n<p>So when you write <code>'\\'</code>, the lexer sees the start of a character literal, followed by an escaped <code>'</code>. Now it expects another <code>'</code> to close the character literal, but gets a colon instead, causing the error.</p>\n\n<p>To represent a backslash as a character literal, you escape the backslash with another backslash like this: <code>'\\\\'</code>.</p>\n"}], "owner": {"reputation": 693, "user_id": 7564554, "user_type": "registered", "accept_rate": 82, "profile_image": "https://lh3.googleusercontent.com/-h7KkTmgJty0/AAAAAAAAAAI/AAAAAAAAAAo/ZFEGeg_bQ6Y/photo.jpg?sz=128", "display_name": "Eben Kadile", "link": "https://stackoverflow.com/users/7564554/eben-kadile"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 530, "favorite_count": 1, "accepted_answer_id": 45742875, "answer_count": 2, "score": 2, "last_activity_date": 1502995664, "creation_date": 1502995303, "question_id": 45742789, "link": "https://stackoverflow.com/questions/45742789/how-are-apostrophes-character-literals-parsed-in-haskell", "title": "How are apostrophes/character literals parsed in Haskell?", "body": "<p>I'm trying to write something that reads Lambda expressions and outputs a beta reduced version. Lambdas will be typed as follows : \\variable -> expression and applications will be of the form (expression) (expression). So if '\\' is found at the beginning of the string it knows to process a Lambda and if '(' is found it knows to process an application. </p>\n\n<p>I have a type for Lambda Expressions defined:</p>\n\n<pre><code>data Expression = Variable String\n                | Lambda Expression Expression \n                | Apply Expression Expression \n</code></pre>\n\n<p>Here's my first attempt at writing a function for reading the input</p>\n\n<pre><code>processInput :: String -&gt; Expression\nprocessInput ('\\':input) = processLambda input\nprocessInput ('(':input) = processApply input\nprocessInput str         = Variable str\n</code></pre>\n\n<p>When I try to load this function I get</p>\n\n<pre><code>lexical error in string/character literal at ':'\n</code></pre>\n\n<p>So I tried using guards instead:</p>\n\n<pre><code>processInput input\n    | head input == '\\'                      = processLambda (tail input)\n    | head input == '('                      = processApply (tail input)\n    | otherwise                              = Variable input\n</code></pre>\n\n<p>But got </p>\n\n<pre><code>lexical error in string/character literal at character ' '\n</code></pre>\n\n<p>I have no idea what's wrong with either of these functions.</p>\n"}, {"tags": ["sockets", "haskell", "networking"], "comments": [{"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 6, "creation_date": 1502995713, "post_id": 45741572, "comment_id": 78443099, "body": "After obtaining a free port, why are you closing the socket that was used to obtain it?  Don&#39;t do that.  Just use that same socket, don&#39;t create and bind a new socket to the same port, that is indeed a race condition.  Closing the previous socket puts the port into a <code>TIME_WAIT</code> state that prevents it from being reused for a period of time unless you use the <code>SO_REUSEADDR</code>/<code>SO_REUSEPORT</code> socket option"}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "reply_to_user": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 0, "creation_date": 1502996170, "post_id": 45741572, "comment_id": 78443354, "body": "Problem is that I have to pass the port number to two external processes that will communicate on that port. That&#39;s why I have to close it."}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 1, "creation_date": 1502996275, "post_id": 45741572, "comment_id": 78443408, "body": "Why aren&#39;t those 2 processes obtaining ports for themselves and coordinating with each other? Why are you doing this in a 3rd process?  You can&#39;t obtain a port and then close it, and then expect the processes to be able to use it.  You need to rethink your approach."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "reply_to_user": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 0, "creation_date": 1502997221, "post_id": 45741572, "comment_id": 78443912, "body": "Yes, it sounds ackward. But that was the way the two processes were designed. They expect a port number on which to communicate with each other. I cannot change that. An alternative might be to assign a random port number in some range."}], "answers": [{"tags": [], "owner": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "is_accepted": true, "score": 3, "last_activity_date": 1502998672, "creation_date": 1502998672, "answer_id": 45743661, "question_id": 45741572, "link": "https://stackoverflow.com/questions/45741572/why-re-binding-to-a-socket-will-fail-randomly/45743661#45743661", "title": "Why re-binding to a socket will fail randomly?", "body": "<p>As a general remark, the pattern of <code>check if a resource is available and if so take it</code> is often an anti-pattern. Whenever you do that you run the risk that another process takes the resource after the check but before you actually acquire it yourself.</p>\n\n<p>The only info you have after such a check is that the resource was not used at that particular point in time. It may or may not help you to guess the port's state in the future but the information you have is in no way binding at any later time. You cannot assume that because the resource was free at time <code>t</code> it will still be free at <code>t+dt</code>. Even if <code>dt</code> is very small. It's maybe a bit more likely that it will still be free when you ask <em>fast</em>. But that's just it - maybe a higher probability.</p>\n\n<p>You should just try to acquire a resource and handle failure appropriately. The only way you can be sure a port was really free is when you just successfully opened it. Then you know it was indeed free. As soon as you close it all bets are off again.</p>\n\n<p>I don't think you can ever safely check if a port is free in one process and then assume it still is free in another process. That does not make sense. It does not even make sense within the same process!</p>\n\n<p>At the very least you would have to design a protocol that would go back and forth:</p>\n\n<ol>\n<li>here's a port that was just free, try that</li>\n<li>nope, it's taken now</li>\n<li>ok, here's another one</li>\n<li>nope, it's taken now</li>\n<li>ok, here's another one</li>\n<li>yep, got it, thanks</li>\n</ol>\n\n<p>But that is pretty silly to begin with. The process that needs the port should just open it. When it already has the port open and not before, then it should communicate the port number to the other party.</p>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 45743661, "answer_count": 1, "score": 1, "last_activity_date": 1502998672, "creation_date": 1502990975, "question_id": 45741572, "link": "https://stackoverflow.com/questions/45741572/why-re-binding-to-a-socket-will-fail-randomly", "title": "Why re-binding to a socket will fail randomly?", "body": "<p>This question is related to <a href=\"https://stackoverflow.com/q/45675403/2289983\">a question about getting a free port in Haskell</a>, where I included a <code>getFreePort</code> function that retrieved the first available port. This function works on a Windows system, but when I tried on my Linux box it fails randomly (the free port is reported as busy).</p>\n\n<p>I've modified the function to try to re-bind to the free address, and it fails at random:</p>\n\n<pre><code>getFreePort :: IO Integer\ngetFreePort = do\n  sock &lt;- socket AF_INET Stream defaultProtocol\n  bind sock (SockAddrInet aNY_PORT iNADDR_ANY)\n  port &lt;- socketPort sock\n  close sock\n  print \"Trying to rebind to the sock\"\n  sock &lt;- socket AF_INET Stream defaultProtocol\n  bind sock (SockAddrInet port 0x0100007f)\n  port &lt;- socketPort sock\n  close sock\n  return (toInteger port)\n</code></pre>\n\n<p>I understand that there is a race condition about other process acquiring that port, but isn't this unlikely?</p>\n"}, {"tags": ["haskell", "st-monad"], "comments": [{"owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "edited": false, "score": 4, "creation_date": 1502986939, "post_id": 45739872, "comment_id": 78438317, "body": "What kind of refactoring are you interested? What error messages do you got from GHC?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 4, "creation_date": 1502987080, "post_id": 45739872, "comment_id": 78438416, "body": "Please always add relevant import statements to a question."}, {"owner": {"reputation": 41, "user_id": 8064494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7cd9f057e367fd620a7b8edb0e9aa998?s=128&d=identicon&r=PG&f=1", "display_name": "vamsikal", "link": "https://stackoverflow.com/users/8064494/vamsikal"}, "reply_to_user": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "edited": false, "score": 0, "creation_date": 1502992905, "post_id": 45739872, "comment_id": 78441617, "body": "@RodrigoRibeiro I want to take the code that processes start_1 and start_2 as highlighted in the above code and move it to a different function, which I can simply call twice."}, {"owner": {"reputation": 41, "user_id": 8064494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7cd9f057e367fd620a7b8edb0e9aa998?s=128&d=identicon&r=PG&f=1", "display_name": "vamsikal", "link": "https://stackoverflow.com/users/8064494/vamsikal"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1502992924, "post_id": 45739872, "comment_id": 78441627, "body": "@leftaroundabout Added imports."}], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 8064494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7cd9f057e367fd620a7b8edb0e9aa998?s=128&d=identicon&r=PG&f=1", "display_name": "vamsikal", "link": "https://stackoverflow.com/users/8064494/vamsikal"}, "edited": false, "score": 0, "creation_date": 1502998866, "post_id": 45742492, "comment_id": 78444763, "body": "Thanks, adding that fixed the issue. But, I would rather not use a language feature I do not fully understand, so I am leaving the copy-paste as is, I do not understand why regular Haskell without any extensions allow me to refactor some copy-paste code to a different function."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 41, "user_id": 8064494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7cd9f057e367fd620a7b8edb0e9aa998?s=128&d=identicon&r=PG&f=1", "display_name": "vamsikal", "link": "https://stackoverflow.com/users/8064494/vamsikal"}, "edited": false, "score": 2, "creation_date": 1503004435, "post_id": 45742492, "comment_id": 78447525, "body": "At this point in time worrying about writing Haskell 98 code (as in 1998) is nearly senseless. GHC is now the defacto standard for Haskell. <code>FlexibleContexts</code>, <code>FlexibleInstances</code>, and <code>MultiParamTypeClasses</code> should be part of the language spec. You&#39;re already using <code>MultiParamTypeClasses</code> via <code>Data.Array</code> because the type class <code>MArray</code> has multiple parameters. You&#39;re already using <code>FlexibleInstances</code> because the <code>MArray</code> instance for <code>STArray</code> requires it. Needing <code>FlexibleContexts</code> is an inevitable consequence of using <code>FlexibleInstances</code>. They just hadn&#39;t shown up in your code yet."}, {"owner": {"reputation": 41, "user_id": 8064494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7cd9f057e367fd620a7b8edb0e9aa998?s=128&d=identicon&r=PG&f=1", "display_name": "vamsikal", "link": "https://stackoverflow.com/users/8064494/vamsikal"}, "edited": false, "score": 0, "creation_date": 1503027746, "post_id": 45742492, "comment_id": 78453530, "body": "Thanks for the clarification. I am not too familiar with FlexibleContexts, FlexibleInstances and MultiParamTypeClasses. I will try to learn about them. Also, don&#39;t we have a standard of Haskell after 1998 i.e. Haskell 2010? Based on this link, <a href=\"https://wiki.haskell.org/Haskell_2010\" rel=\"nofollow noreferrer\">Haskell 2010</a> the features you mentioned are not in Haskell 2010 either."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 3, "last_activity_date": 1502994218, "creation_date": 1502994218, "answer_id": 45742492, "question_id": 45739872, "link": "https://stackoverflow.com/questions/45739872/refactor-haskell-monadic-code-to-avoid-copy-paste/45742492#45742492", "title": "Refactor Haskell monadic code to avoid copy-paste", "body": "<p>The compiler tells you to </p>\n\n<blockquote>\n<pre><code>Use FlexibleContexts to permit this\n</code></pre>\n</blockquote>\n\n<p>That means enable the <a href=\"https://downloads.haskell.org/~ghc/8.0.2/docs/html/users_guide/glasgow_exts.html#relaxed-rules-for-instance-contexts\" rel=\"nofollow noreferrer\"><code>FlexibleContexts</code> language extension</a>. You can do this by adding a <a href=\"https://downloads.haskell.org/~ghc/8.0.2/docs/html/users_guide/glasgow_exts.html#language-pragma\" rel=\"nofollow noreferrer\"><code>LANGUAGE</code> pragma</a> to the top of your source file</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 8064494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7cd9f057e367fd620a7b8edb0e9aa998?s=128&d=identicon&r=PG&f=1", "display_name": "vamsikal", "link": "https://stackoverflow.com/users/8064494/vamsikal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 45742492, "answer_count": 1, "score": 0, "last_activity_date": 1502994218, "creation_date": 1502985411, "last_edit_date": 1502993842, "question_id": 45739872, "link": "https://stackoverflow.com/questions/45739872/refactor-haskell-monadic-code-to-avoid-copy-paste", "title": "Refactor Haskell monadic code to avoid copy-paste", "body": "<p>I have written the following code in Haskell using ST monad and it works. My only question is how do I avoid the copy-paste shown in the code below. When I tried to refactor the code, I got compiler errors I could not fully understand. Is there a way to avoid the copy-paste in the code below. I would like to know, if I could refactor the code that processes for start_1 and start_2 (as of now copy/paste) to another helper function.</p>\n\n<pre><code>import qualified Control.Monad as CM\nimport qualified Control.Monad.ST as CMST\nimport qualified Data.Array as A\nimport qualified Data.Array.Unboxed as AU\nimport qualified Data.Array.ST as AST\n\n\nprime_factors :: Int -&gt; Int -&gt; [(Int, Int)] -&gt; A.Array Int [(Int, Int)]\nprime_factors a_low a_high prms_sqrts = AST.runSTArray $ do\n  pfs &lt;- AST.newArray (a_low, a_high) [] :: CMST.ST s (AST.STArray s Int [(Int, Int)])\n  as &lt;- AST.newArray (a_low, a_high) 0 :: CMST.ST s (AST.STArray s Int Int)\n  CM.forM_ [a_low..a_high] $ \\i -&gt; do\n    AST.writeArray as i ((i * i) + 1)\n  CM.forM_ (takeWhile (\\(prm, _) -&gt; prm &lt;= (a_high + 1)) prms_sqrts) $ \\(prm, sqr_rt) -&gt; do\n    let (q, r) = a_low `divMod` prm\n    let start_1 = a_low + sqr_rt - r\n    -- !!!! CODE TO DO SOME PROCESSING FOR start_1 !!!!!\n    CM.forM_ (takeWhile (&lt;= a_high) [start_1 + (x * prm) | x &lt;- [0..]]) $ \\i -&gt; do\n      a_i &lt;- AST.readArray as i\n      let (a_i', mul) = remove_factor a_i prm 0\n      CM.when (mul &gt; 0) $ do\n        AST.writeArray as i a_i'\n        pfs_i &lt;- AST.readArray pfs i\n        AST.writeArray pfs i ((prm, mul) : pfs_i)\n    let start_2 = a_low + (prm - sqr_rt) - r\n    -- !!!! COPY-PASTE ABOVE CODE TO PROCESS start_2 !!!!\n    CM.forM_ (takeWhile (&lt;= a_high) [start_2 + (x * prm) | x &lt;- [0..]]) $ \\i -&gt; do\n      a_i &lt;- AST.readArray as i\n      let (a_i', mul) = remove_factor a_i prm 0\n      CM.when (mul &gt; 0) $ do\n        AST.writeArray as i a_i'\n        pfs_i &lt;- AST.readArray pfs i\n        AST.writeArray pfs i ((prm, mul) : pfs_i)\n  CM.forM_ [a_low..a_high] $ \\i -&gt; do\n    a_i &lt;- AST.readArray as i\n    CM.when (a_i &gt; 1) $ do\n      pfs_i &lt;- AST.readArray pfs i\n      AST.writeArray pfs i ((a_i, 1) : pfs_i)\n  return pfs\n  where remove_factor m p mul\n          | m `mod` p == 0 = remove_factor (m `div` p) p (mul + 1)\n          | otherwise = (m, mul)\n</code></pre>\n\n<p>The error message I get when I try to move the above copy-paste code to a local function (named sieve_factors) created with a 'let' binding is:</p>\n\n<pre><code>vamsi@vamsi-laptop:~/learn/project_euler/129_to_256/problem_224$ ghc --make -O -i../.. problem_224.hs\n[3 of 3] Compiling Main             ( problem_224.hs, problem_224.o )\n\nproblem_224.hs:39:9: error:\n    \u2022 Non type-variable argument\n        in the constraint: AST.MArray (AST.STArray s) Int m\n      (Use FlexibleContexts to permit this)\n    \u2022 When checking the inferred type\n        sieve_factors :: forall (m :: * -&gt; *).\n                         (AST.MArray (AST.STArray s) Int m,\n                          AST.MArray (AST.STArray s) [(Int, Int)] m) =&gt;\n                         Int -&gt; m ()\n      In the expression:\n        do { let sieve_factors start = ...;\n             let (q, r) = a_low `divMod` prm;\n             let start_1 = a_low + sqr_rt - r;\n             sieve_factors start_1;\n             .... }\n      In the second argument of \u2018($)\u2019, namely\n        \u2018\\ (prm, sqr_rt)\n           -&gt; do { let ...;\n                   let ...;\n                   .... }\u2019\n</code></pre>\n"}, {"tags": ["json", "haskell", "filter", "haskell-lens", "aeson"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502979029, "post_id": 45736393, "comment_id": 78432533, "body": "The idiomatic way is to parse the entire JSON document, then write a filter function for the ADT which results from that."}, {"owner": {"reputation": 115, "user_id": 989386, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb4fd57c9ce61b216817894512f79cbe?s=128&d=identicon&r=PG", "display_name": "Axel Hanikel", "link": "https://stackoverflow.com/users/989386/axel-hanikel"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502979625, "post_id": 45736393, "comment_id": 78433041, "body": "Yes, so I already have the above JSON as a <code>Value</code>, and I know how to filter e.g. the <code>instanceId</code>s out of it. However, my condition involves a different part of the tree, i.e. the <code>tags</code>, and I would like to know how to filter instanceIds where the tags match the condition."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502979981, "post_id": 45736393, "comment_id": 78433320, "body": "Sorry, I should have been more clear - parse the document to an ADT which models the specific structure of your document (e.g. <code>data Tag = Tag { value :: Text, key :: Text }; data Instance = Instance { ID :: Text, tag :: Tag }; newtype Instances = Instances [Instance]</code>). What if the JSON is well-formed, but doesn&#39;t match your desired structure? Say, there is an object with <code>instanceId</code> and <code>tags</code> nested inside one of the tags field of some other object. Any filtering of <code>Value</code> will not detect this; but if you parse to your own ADT first, the structure of your document will be enforced."}, {"owner": {"reputation": 115, "user_id": 989386, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb4fd57c9ce61b216817894512f79cbe?s=128&d=identicon&r=PG", "display_name": "Axel Hanikel", "link": "https://stackoverflow.com/users/989386/axel-hanikel"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502980512, "post_id": 45736393, "comment_id": 78433770, "body": "Ah, I misinterpreted &quot;ADT&quot; as &quot;AST&quot;, sorry :-) But I think freestyles&#39;s answer below is quite exactly what I was looking for. Thank you very much!"}], "answers": [{"comments": [{"owner": {"reputation": 115, "user_id": 989386, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb4fd57c9ce61b216817894512f79cbe?s=128&d=identicon&r=PG", "display_name": "Axel Hanikel", "link": "https://stackoverflow.com/users/989386/axel-hanikel"}, "edited": false, "score": 0, "creation_date": 1502980222, "post_id": 45737572, "comment_id": 78433503, "body": "Thank you so much, that&#39;s exactly what I was looking for!"}, {"owner": {"reputation": 115, "user_id": 989386, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb4fd57c9ce61b216817894512f79cbe?s=128&d=identicon&r=PG", "display_name": "Axel Hanikel", "link": "https://stackoverflow.com/users/989386/axel-hanikel"}, "edited": false, "score": 0, "creation_date": 1503056647, "post_id": 45737572, "comment_id": 78468764, "body": "A small addendum:  I asked hayoo for &lt;&amp;&amp;&gt; and found it in the &quot;cond&quot; and &quot;control-bool&quot; packages, both of which weren&#39;t available in stack lts-7.3 that I&#39;m using. The solution was to just define it myself as <code>liftM2 (&amp;&amp;)</code>. Now it works like a charm!"}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "reply_to_user": {"reputation": 115, "user_id": 989386, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb4fd57c9ce61b216817894512f79cbe?s=128&d=identicon&r=PG", "display_name": "Axel Hanikel", "link": "https://stackoverflow.com/users/989386/axel-hanikel"}, "edited": false, "score": 1, "creation_date": 1503057245, "post_id": 45737572, "comment_id": 78469117, "body": "<code>&lt;&amp;&amp;&gt; = liftA2 (&amp;&amp;)</code> will be more general."}], "tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": true, "score": 2, "last_activity_date": 1502979326, "creation_date": 1502979326, "answer_id": 45737572, "question_id": 45736393, "link": "https://stackoverflow.com/questions/45736393/how-to-extract-part-of-an-aeson-value-that-satisfies-a-condition/45737572#45737572", "title": "How to extract part of an aeson value that satisfies a condition?", "body": "<p>If you want to use lens, you can use <code>filtered</code> optic, as instance:</p>\n\n<pre><code>  key \"instances\" . values\n. filtered (anyOf (key \"tags\" . values) $\n    allOf (key \"key\") (==\"hostname\")\n    &lt;&amp;&amp;&gt; allOf (key \"value\") (==\"author1useast1\"))\n. key \"instanceId\"\n</code></pre>\n"}], "owner": {"reputation": 115, "user_id": 989386, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb4fd57c9ce61b216817894512f79cbe?s=128&d=identicon&r=PG", "display_name": "Axel Hanikel", "link": "https://stackoverflow.com/users/989386/axel-hanikel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 220, "favorite_count": 0, "accepted_answer_id": 45737572, "answer_count": 1, "score": 1, "last_activity_date": 1502979326, "creation_date": 1502976335, "question_id": 45736393, "link": "https://stackoverflow.com/questions/45736393/how-to-extract-part-of-an-aeson-value-that-satisfies-a-condition", "title": "How to extract part of an aeson value that satisfies a condition?", "body": "<p>I have a JSON structure which looks like this:</p>\n\n<pre><code>{\n  \"instances\": [\n    {\n      \"instanceId\": \"i-1234\",\n      \"tags\": [\n        {\n          \"value\": \"author1useast1\",\n          \"key\": \"hostname\"\n        }\n      ]\n    },\n    {\n      \"instanceId\": \"i-5678\",\n      \"tags\": [\n        {\n          \"value\": \"proxy1useast1\",\n          \"key\": \"hostname\"\n        }\n      ]\n    }\n  ]\n}\n</code></pre>\n\n<p>I would like to get a list of all <code>instances/instanceId</code> where <code>instances/tags</code> has a <code>hostname</code> of <code>author1useast1</code>.</p>\n\n<p>I have thought about getting a list of instances with <code>key \"instances\" . _Values</code> first, then mapping it into a list of (<code>instanceId</code>, <code>tags</code>) tuples and then doing the filtering. However that looks very inefficient to me.</p>\n\n<p>Is there a more elegant / idiomatic way of doing this?</p>\n\n<p>Thanks a lot!</p>\n"}, {"tags": ["haskell", "logging"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502979257, "post_id": 45735694, "comment_id": 78432716, "body": "You&#39;ve misunderstood what the type <code>(A -&gt; B) -&gt; IO ()</code> means. This doesn&#39;t demand a value of type <code>A</code>; it demands a value of type <code>A -&gt; B</code>. By supplying a function of type <code>A -&gt; B</code> you can access a value of type <code>A</code>, but only within the scope of that function. In other words, <code>TimedFastLogger</code> supplies you with a <code>FormattedTime</code>, not the other way around."}, {"owner": {"reputation": 410, "user_id": 3927886, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/689a75ec29af93dcc938fdbd5f039b54?s=128&d=identicon&r=PG&f=1", "display_name": "RamiroPastor", "link": "https://stackoverflow.com/users/3927886/ramiropastor"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502980849, "post_id": 45735694, "comment_id": 78434018, "body": "I just really dont understand why <code>TimedFastLogger</code> is defined like that"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502985978, "post_id": 45735694, "comment_id": 78437690, "body": "How would you expect it to be defined? Or what do you think is wrong with the actual definition? This seems like a natural way to define it to me."}], "answers": [{"tags": [], "owner": {"reputation": 20980, "user_id": 241990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/265f1d52e6e484c9abe60b4da20fb8ee?s=128&d=identicon&r=PG", "display_name": "Shaun the Sheep", "link": "https://stackoverflow.com/users/241990/shaun-the-sheep"}, "is_accepted": true, "score": 2, "last_activity_date": 1505749453, "last_edit_date": 1505749453, "creation_date": 1503064726, "answer_id": 45758502, "question_id": 45735694, "link": "https://stackoverflow.com/questions/45735694/fast-logger-clean-up-action-haskell/45758502#45758502", "title": "Fast-logger clean up action (haskell)", "body": "<p>If you look at <a href=\"http://hackage.haskell.org/package/fast-logger-2.4.10/docs/src/System-Log-FastLogger.html#newTimedFastLogger\" rel=\"nofollow noreferrer\">the source for the function</a> you will see that the clean-up action is a call to <code>rmLoggerSet</code>. The documentation for that says:</p>\n\n<blockquote>\n  <p>Flushing the buffers, closing the internal file information and freeing the buffers.</p>\n</blockquote>\n\n<p>So that should answer your first question. You would run it when you don't need the logger anymore to make sure any state state associated with it is \"cleaned up\". It may do different things depending on the type of logger you are using.</p>\n\n<p>For the second question <code>IO FormattedTime</code> is an action which can be called by the logger whenever it needs a timestamp for a log message. So it may call it multiple times and get a different <code>FormattedTime</code>. When you call <code>newTimedFastLogger</code> you pass this action as the first argument and it gives you back a logger and the clean up action. So, using it would go something like:</p>\n\n<pre><code>import System.Log.FastLogger\nimport Data.Monoid ((&lt;&gt;))\n\nmain :: IO ()\nmain = do\n    timeCache &lt;- newTimeCache simpleTimeFormat\n    (logger, cleanUp) &lt;- newTimedFastLogger timeCache (LogStdout defaultBufSize)\n    log logger \"Some log message\"\n    cleanUp\n\nlog :: ToLogStr msg =&gt; TimedFastLogger -&gt; msg -&gt; IO ()\nlog logger msg = logger $ \\ft -&gt; toLogStr ft &lt;&gt; toLogStr \": \" &lt;&gt; toLogStr msg\n</code></pre>\n\n<p>Each time you log a message, you are calling <code>logger</code>, and passing in a callback that tells it how to combine your message with whatever value of the time (<code>ft</code>) it currently has. Depending on your requirements, you might want a different format, perhaps including log levels in the output.</p>\n"}], "owner": {"reputation": 410, "user_id": 3927886, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/689a75ec29af93dcc938fdbd5f039b54?s=128&d=identicon&r=PG&f=1", "display_name": "RamiroPastor", "link": "https://stackoverflow.com/users/3927886/ramiropastor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 329, "favorite_count": 0, "accepted_answer_id": 45758502, "answer_count": 1, "score": 1, "last_activity_date": 1505749453, "creation_date": 1502974439, "question_id": 45735694, "link": "https://stackoverflow.com/questions/45735694/fast-logger-clean-up-action-haskell", "title": "Fast-logger clean up action (haskell)", "body": "<p>I'm willing to use the fast-logger haskell library, but i have some questions:</p>\n\n<p>Function <code>newTimedFastLogger</code> is explained as:</p>\n\n<blockquote>\n  <p>Initialize a FastLogger with timestamp attached to each message. a tuple of logger and clean up action are returned.</p>\n</blockquote>\n\n<p>So, first question, what is this \"clean up action\" for?</p>\n\n<p>Also, that function takes an <code>IO FormattedTime</code> as first argument, but then we have:</p>\n\n<p><code>type TimedFastLogger = (FormattedTime -&gt; LogStr) -&gt; IO ()\n</code></p>\n\n<p>That's my second question, why do i have to supply a FormattedTime both when creating the TimedFastLogger and when using it?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "edited": false, "score": 0, "creation_date": 1502975059, "post_id": 45735186, "comment_id": 78429493, "body": "Not sure which recent update you&#39;re referring to. These errors seem to indicate you are missing some dependencies to your project. <code>Data.List.Split</code> is from <code>split</code> package. <code>Data.String.Utils</code> appears to be from <code>MissingH</code>. Do you have those installed? Are you using haskell platform, stack or nix?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1502979348, "post_id": 45735186, "comment_id": 78432803, "body": "Use your build tool to query which version of the package you are using, then look at the documentation for that version of the package (which is often installed locally on your machine - the location will depend on which build tool you are using)."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1502986425, "post_id": 45735186, "comment_id": 78437968, "body": "You&#39;re talking about updating GHC, right? If so, I believe you have to reinstall your packages. I don&#39;t think there&#39;s a way around that, since different versions of GHC probably can&#39;t really be guaranteed to generate code that is compatible (down to the object file level)."}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 109, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1502975202, "creation_date": 1502973014, "question_id": 45735186, "link": "https://stackoverflow.com/questions/45735186/where-can-i-see-how-haskell-modules-have-been-restructured", "title": "Where can I see how Haskell modules have been restructured?", "body": "<p>Since the recent update of Haskell on my system, I'm getting numerous import errors. For example, I get:</p>\n\n<pre><code>Crypto/Enigma.hs:64:1: error:\n    Could not find module \u2018Data.List.Split\u2019\n    Use -v to see a list of the files searched for.\n   |\n64 | import           Data.List.Split        (splitOn)\n   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\nCrypto/Enigma.hs:70:1: error:\n    Could not find module \u2018Data.String.Utils\u2019\n    Use -v to see a list of the files searched for.\n   |\n70 | import           Data.String.Utils       (replace)\n   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>Is there a place I can go to see what changes have been made to the package structure in the recent update? Im particular, where the functions I'm looking for have gone (to what modules)?</p>\n"}, {"tags": ["haskell", "function-composition"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 8, "creation_date": 1502972140, "post_id": 45734828, "comment_id": 78427326, "body": "Mind that <code>a -&gt; b -&gt; c</code> is short for <code>a -&gt; (b -&gt; c)</code>. In Haskell, all functions only take <i>one</i> argument."}, {"owner": {"reputation": 55, "user_id": 8086500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d95f9d69cd4be6200257afe5b6d3da2?s=128&d=identicon&r=PG&f=1", "display_name": "Nicrophorus", "link": "https://stackoverflow.com/users/8086500/nicrophorus"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1502975615, "post_id": 45734828, "comment_id": 78429943, "body": "I was thinking about that. But I couldn&#39;t decide wether it should be split up as <code>a -&gt; (b -&gt; c)</code> or <code>(a -&gt; b) -&gt; c</code>. But what you say makes sense to me now. Am I correct then if I think about it this way: if we want to consider map as a &quot;one-parameter-function&quot; its type is <code>(a -&gt; b) -&gt; ([a] -&gt; [b])</code>, since if we supply it with its first parameter (the <code>(a -&gt; b)</code> function) what we get in return is a function of type <code>([a] -&gt; [b])</code>. So the types <code>(a -&gt; b)</code> and <code>([a] -&gt; [b])</code> correspond to the <code>a</code> and <code>b</code> in <code>(a -&gt; b)</code> in the type for <code>(map . map)</code>?"}, {"owner": {"reputation": 410, "user_id": 3927886, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/689a75ec29af93dcc938fdbd5f039b54?s=128&d=identicon&r=PG&f=1", "display_name": "RamiroPastor", "link": "https://stackoverflow.com/users/3927886/ramiropastor"}, "edited": false, "score": 3, "creation_date": 1502976015, "post_id": 45734828, "comment_id": 78430258, "body": "<code>a -&gt; b -&gt; c</code> is the same as <code>a -&gt; (b -&gt; c)</code> but different that <code>(a -&gt; b) -&gt; c</code>"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1502976064, "post_id": 45734828, "comment_id": 78430302, "body": "Related question: <a href=\"https://stackoverflow.com/questions/23030638/how-fmap-fmap-typechecks\" title=\"how fmap fmap typechecks\">stackoverflow.com/questions/23030638/how-fmap-fmap-typecheck&zwnj;&#8203;s</a>"}], "answers": [{"tags": [], "owner": {"reputation": 410, "user_id": 3927886, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/689a75ec29af93dcc938fdbd5f039b54?s=128&d=identicon&r=PG&f=1", "display_name": "RamiroPastor", "link": "https://stackoverflow.com/users/3927886/ramiropastor"}, "is_accepted": false, "score": 5, "last_activity_date": 1502975548, "creation_date": 1502975548, "answer_id": 45736081, "question_id": 45734828, "link": "https://stackoverflow.com/questions/45734828/type-of-map-map/45736081#45736081", "title": "Type of (map . map)", "body": "<p>Quoting GHCI:</p>\n\n<pre><code>Prelude&gt; :t map.map\nmap.map :: (a -&gt; b) -&gt; [[a]] -&gt; [[b]]\n</code></pre>\n\n<p>But for map itself, type is</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]\n</code></pre>\n\n<p>which you can see as </p>\n\n<pre><code>map :: (a -&gt; b) -&gt; ([a] -&gt; [b])\n</code></pre>\n\n<p>So, if we have that \n<code>(.) :: (t2 -&gt; t3) -&gt; (t1 -&gt; t2) -&gt; t1 -&gt; t3</code></p>\n\n<p>Then:</p>\n\n<ul>\n<li>type <code>t1</code> is <code>(a -&gt; b)</code></li>\n<li>type <code>t2</code> is <code>([a] -&gt; [b])</code></li>\n<li>type <code>t3</code> is <code>([[a]] -&gt; [[b]])</code></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "is_accepted": false, "score": 1, "last_activity_date": 1503006083, "last_edit_date": 1503006083, "creation_date": 1502978912, "answer_id": 45737420, "question_id": 45734828, "link": "https://stackoverflow.com/questions/45734828/type-of-map-map/45737420#45737420", "title": "Type of (map . map)", "body": "<p>One way I like to think of it is that <code>map</code> turns an <code>a -&gt; b</code> into an <code>[a] -&gt; [b]</code>, so <code>map . map</code> does it twice.  The first map turns your <code>a -&gt; b</code> into an <code>[a] -&gt; [b]</code>, and the second map repeats the process, turning it into an <code>[[a]] -&gt; [[b]]</code>.</p>\n\n<p>\"Applying <code>map</code> to an <code>a -&gt; b</code> turns it into an <code>[a] -&gt; [b]</code>\", so, it seems pretty pretty logical that applying <code>map</code> to an <code>[a] -&gt; [b]</code> would turn it into an <code>[[a]] -&gt; [[b]]</code>.  You're just applying <code>map</code> to a function twice.</p>\n\n<p>Incidentally:</p>\n\n<pre><code>-- apply map to a function once\n            map :: (a -&gt; b) -&gt; (  [a]   -&gt;   [b]  )\n-- apply map to a function twice\n      map . map :: (a -&gt; b) -&gt; ( [[a]]  -&gt;  [[b]] )\n-- apply map to a function three times\nmap . map . map :: (a -&gt; b) -&gt; ([[[a]]] -&gt; [[[b]]])\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 8086500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d95f9d69cd4be6200257afe5b6d3da2?s=128&d=identicon&r=PG&f=1", "display_name": "Nicrophorus", "link": "https://stackoverflow.com/users/8086500/nicrophorus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 710, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1503037596, "creation_date": 1502972036, "question_id": 45734828, "link": "https://stackoverflow.com/questions/45734828/type-of-map-map", "title": "Type of (map . map)", "body": "<p>I'm trying to understand the type of the expression <code>(map . map)</code>. Since the type of <code>(.)</code> is <code>(b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</code> I don't understand how this works with the map function, because map takes two arguments which doesn't fit with the functions <code>(b -&gt; c)</code> and <code>(a -&gt; b)</code>.</p>\n"}, {"tags": ["haskell", "ghc", "specialization", "coercion", "singleton-type"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1502987067, "post_id": 45734362, "comment_id": 78438405, "body": "I think your diagnosis is correct, but I should mention that last I heard the GHC documentation was kind of lying about <code>SPECIALIZE</code> and GADTs. That pragma (probably) has no effect, and if specialization happens its through constructor specialization."}, {"owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1502990147, "post_id": 45734362, "comment_id": 78440123, "body": "Ah, that explains the warnings (something along the lines of &#39;SPECIALIZE has no effect here&#39;). But even in my bigger use case, GHC specializes correctly beyond module boundaries without warnings, probably because there are also some type class dictionaries involved which I don&#39;t really specialize. Edit: That might have to do with INLINABLE..."}, {"owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1502990194, "post_id": 45734362, "comment_id": 78440152, "body": "Anyway, I&#39;m going with the type class solution <a href=\"https://github.com/sgraf812/pomaps/blob/ebfad35ca1864c6cb8f5921fb804cac26ca944f7/library/Data/POMap/Internal.hs#L207-L211\" rel=\"nofollow noreferrer\">github.com/sgraf812/pomaps/blob/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1502992436, "post_id": 45737382, "comment_id": 78441367, "body": "The pattern match shouldn&#39;t be terribly expensive. It&#39;s really just <code>seq</code>; once the value is in WHNF, there&#39;s nothing else to do. And if you use a <code>SingI</code> class method that produces a <code>SingBool</code>, the application of <code>sing</code> to the result should be optimized properly, I believe. The problem with an overly class-based approach is that it gets messy when the type isn&#39;t statically known."}, {"owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1502994527, "post_id": 45737382, "comment_id": 78442514, "body": "I&#39;ll probably benchmark this when the rest of the code is stable."}], "tags": [], "owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "is_accepted": true, "score": 2, "last_activity_date": 1503042848, "last_edit_date": 1503042848, "creation_date": 1502978808, "answer_id": 45737382, "question_id": 45734362, "link": "https://stackoverflow.com/questions/45734362/specialization-of-singleton-parameters/45737382#45737382", "title": "Specialization of singleton parameters", "body": "<p>OK, to mostly answer my own question: Knowing that <code>SingBool 'False</code> only has one inhabitant is not enough for GHC to get rid of the pattern match, because we could call the function like <code>singSFalse (error \"matched\")</code>, e.g. bottom is always another inhabitant.</p>\n\n<p>So, specialization (e.g. inlining based on concrete <code>TypeApplication</code>s) does not really work well with singletons (turning those type applications into presumably constant value applications) in Haskell (lazy, non-total) w.r.t. zero cost abstractions.</p>\n\n<p>However, by using a <a href=\"https://hackage.haskell.org/package/singletons-2.3.1/docs/Data-Singletons.html#t:SingI\" rel=\"nofollow noreferrer\"><code>SingI</code></a>-style type class with a proxy (e.g. <a href=\"https://hackage.haskell.org/package/singletons-2.3.1/docs/Data-Singletons.html#v:singByProxy\" rel=\"nofollow noreferrer\"><code>singByProxy</code></a>), we don't have the same problems:</p>\n\n<pre><code>{-# LANGUAGE DataKinds      #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE MagicHash      #-}\n\nmodule Data.Test where\n\nimport           GHC.Exts (Proxy#)\n\nclass SingIBool (b :: Bool) where\n  sing :: Proxy# b -&gt; Bool\n\ninstance SingIBool 'False where\n  sing _ = False\n\ninstance SingIBool 'True where\n  sing _ = True\n\nrefurbulate :: SingIBool b =&gt; Proxy# b -&gt; Int\nrefurbulate p\n  | sing p = 0\n  | otherwise = 1\n</code></pre>\n\n<p>The specialization <code>refurbulate @(Proxy# 'False)</code> will not only be implemented as <code>const False</code>, also there will not be passed any <code>Proxy#</code> argument at the value level, so it's rather <code>coerce False :: Proxy# -&gt; Bool</code>. Neat! However, I don't get to use singletons in the real world :(</p>\n\n<hr>\n\n<p>To recap why singletons fail (to get optimized) and type classes work:</p>\n\n<p>By specializing the type class instance, we get to know the RHS of <code>sing</code>, from which we can deduce totality.</p>\n\n<p>By specializing the singleton, we get to know what value the parameter evaluates to, <em>if evaluation terminates</em>.</p>\n\n<p>Knowing the canonical RHS of a type class method <code>x :: ()</code> is more informative than just knowing that a parameter <code>x :: ()</code> can only evaluate to one value in a non-total, lazy (e.g. Haskell's) setting.</p>\n"}], "owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 45737382, "answer_count": 1, "score": 3, "last_activity_date": 1503042848, "creation_date": 1502970638, "last_edit_date": 1502971737, "question_id": 45734362, "link": "https://stackoverflow.com/questions/45734362/specialization-of-singleton-parameters", "title": "Specialization of singleton parameters", "body": "<p>I'm playing around with specialization of singletons:</p>\n\n<pre><code>{-# LANGUAGE DataKinds      #-}\n{-# LANGUAGE GADTs          #-}\n{-# LANGUAGE KindSignatures #-}\n\nmodule Data.Test where\n\ndata SingBool (b :: Bool) where\n  STrue :: SingBool 'True\n  SFalse :: SingBool 'False\n\nsing :: SingBool b -&gt; Bool\nsing SFalse = False\nsing STrue  = True\n{-# SPECIALIZE sing :: SingBool 'False -&gt; Bool #-}\n</code></pre>\n\n<p>This specializes to something like the following:</p>\n\n<pre><code>singSFalse :: SingBool 'False -&gt; Bool\nsingSFalse SFalse = False\n</code></pre>\n\n<p>I'd expect it to generate an RHS of <code>singSFalse _ = False</code> instead. </p>\n\n<p>Is that coercion unpacked only to satisfy the type-checker or is there actual runtime overhead involved in that pattern match? I imagine that GHC does not discard the pattern match on the argument to account for <code>bottom</code>, in order not to increase laziness. But I want to be sure before I begin to model this through <code>Proxy</code> + a <code>SingI</code>-style type class.</p>\n"}, {"tags": ["haskell", "functional-programming", "monads", "typeclass", "monad-transformers"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1502968132, "post_id": 45733042, "comment_id": 78424619, "body": "I don&#39;t think this is possible. It is well-known that the standard functor, monad etc. classes don&#39;t cope well with additional constraints. <code>Data.Set</code> should be a functor, but it is not because of the <code>Ord</code> constraint, for instance. Some more advanced classes have been proposed, like indexed monads, to address this issue, but they never became really popular."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1502968290, "post_id": 45733042, "comment_id": 78424732, "body": "@chi Can you elaborate on indexed monads being used to add extra class constraints?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1502969273, "post_id": 45733042, "comment_id": 78425379, "body": "@gallais <code>class IxMonad m a b where (&gt;&gt;=) :: m a -&gt; (a-&gt;m b) -&gt; m b</code> allows for <code>instance IxMonad [] a b</code> and <code>instance (Ord a, Ord b) =&gt; IxMonad Data.Set a b</code>. Or, <code>class CMonad m (c :: * -&gt; Constraint) where (&gt;&gt;=) :: (c a, c b) =&gt; ...</code> allows for an additional constraint. (I am probably using the term &quot;indexed monad&quot; here a bit loosely, but you get the idea)"}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1502969474, "post_id": 45733042, "comment_id": 78425513, "body": "Oh okay, so not <a href=\"https://stackoverflow.com/questions/28690448/what-is-indexed-monad\">indexed monads</a>? Your definition looks pretty dodgy though: you&#39;d be able to give different instances for e.g. <code>IxMonad m Int a</code> and <code>IxMonad m Integer a</code>, etc. You give up on the &quot;uniformity&quot; of the effect handling."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1502970480, "post_id": 45733042, "comment_id": 78426188, "body": "@gallais I agree, I was fetching terms from memory and got it wrong. <a href=\"http://okmij.org/ftp/Haskell/RestrictedMonad.lhs\" rel=\"nofollow noreferrer\">Restricted monad</a> is probably a better term.  I&#39;m unsure if the real indexed monads can be used for this, I&#39;d guess they can&#39;t. <code>CMonad</code> should be a bit more uniform, though."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1502971801, "post_id": 45733042, "comment_id": 78427097, "body": "Yeah <code>CMonad</code> looks good."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1502986444, "post_id": 45733042, "comment_id": 78437983, "body": "@chi, I don&#39;t know if it&#39;s fair to say that &quot;they never became really popular.&quot; Idris has incorporated some of those ideas as part of the language. I don&#39;t know that they did quite the right thing there, but I think it demonstrates that people really want these things. Balancing power against syntactic convenience is not so easy, and Haskell tends to be somewhat conservative about syntax. I think given a bit more time we may yet see these ideas rise to more prominence."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1502993119, "post_id": 45733042, "comment_id": 78441732, "body": "@dfeuer Probably it is a bit unfair -- still, in the vast majority of Hackage packages we can find monads/applicatives/etc. instead of their indexed/restricted generalizations. More concretely, what I wanted to say is that, until such generalizations become the &quot;default&quot; choice in the Haskell package ecosystem, even if one defined a proper instance there is (unfortunately) little chance that said instance will interact with existing libraries, which instead only consider the regular monads/etc. In the future, this might change, of course."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1503066592, "post_id": 45733042, "comment_id": 78475931, "body": "@chi, yes, very fair. I just don&#39;t want people to give up on these ideas just because they&#39;re not <i>yet</i> very popular. Especially since the machinery to support them keeps improving, slowly."}], "owner": {"reputation": 533, "user_id": 3847023, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/mUqNl.jpg?s=128&g=1", "display_name": "Nick Tchayka", "link": "https://stackoverflow.com/users/3847023/nick-tchayka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 155, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1502966737, "creation_date": 1502966737, "question_id": 45733042, "link": "https://stackoverflow.com/questions/45733042/impose-constraint-on-monadio-return-type", "title": "Impose constraint on MonadIO return type", "body": "<p>I'm trying to make an instance of <code>MonadIO</code> for a type that represents computations in the cloud. So <code>liftIO</code> would represent an <code>IO</code> action that is executed locally.</p>\n\n<p><a href=\"https://hackage.haskell.org/package/transient-universe-0.4.6.1/docs/Transient-Move.html#t:Cloud\" rel=\"nofollow noreferrer\">transient-universe</a>, the library that provides this, provides a function <code>localIO</code> that does exactly this. But it is not composable in some other library that could embed any other <code>MonadIO</code>.</p>\n\n<p>The problem is, that <code>localIO</code> requires the return type of the <code>IO</code> action to be an instance of <code>Read</code>, <code>Show</code> and <code>Typeable</code>. Whereas <code>MonadIO</code> doesn't contemplate this case:</p>\n\n<pre><code>class MonadIO m where\n    liftIO :: IO a -&gt; m a\n</code></pre>\n\n<p>In my case, I'd need to write another type class, that does it:</p>\n\n<pre><code>class RestrictableMonadIO (m a) where\n    liftRestrictedIO :: IO a -&gt; m a\n</code></pre>\n\n<p>So it would allow me to do this:</p>\n\n<pre><code>instance (Read a, Show a, Typeable a) =&gt; MonadIO (Cloud a) where\n    liftRestrictedIO = localIO\n</code></pre>\n\n<p>Is there a way of doing this without having to declare my own typeclass?</p>\n"}, {"tags": ["haskell", "cygwin"], "answers": [{"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 3, "last_activity_date": 1502948589, "creation_date": 1502948589, "answer_id": 45727399, "question_id": 45727183, "link": "https://stackoverflow.com/questions/45727183/ctrl-c-causes-cygwin-to-crash-on-ghci/45727399#45727399", "title": "Ctrl-c causes cygwin to crash on ghci", "body": "<p>When you start <code>ghci</code> on Windows, it displays this message:</p>\n\n<pre><code>$ ghci\nWARNING: GHCi invoked via 'ghci.exe' in *nix-like shells (cygwin-bash, in particular)\n         doesn't handle Ctrl-C well; use the 'ghcii.sh' shell wrapper instead\nGHCi, version 8.0.1: http://www.haskell.org/ghc/  :? for help\n</code></pre>\n\n<p>Instead of running <code>ghci</code>, run <code>ghcii.sh</code>.</p>\n"}], "owner": {"reputation": 2928, "user_id": 5927758, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/QmcMj.png?s=128&g=1", "display_name": "Mitch", "link": "https://stackoverflow.com/users/5927758/mitch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 0, "accepted_answer_id": 45727399, "answer_count": 1, "score": 2, "last_activity_date": 1502948589, "creation_date": 1502947547, "question_id": 45727183, "link": "https://stackoverflow.com/questions/45727183/ctrl-c-causes-cygwin-to-crash-on-ghci", "title": "Ctrl-c causes cygwin to crash on ghci", "body": "<p>Im trying to start to learn Haskell and I am using cygwin to do so as I like the linux type commands. However when I try to exit from a session with Ctrl-C the console freezes and crashes, this problem also occurs on cmd </p>\n\n<p>Similarly putting it to sleep with Ctrl-Z and calling kill %1 also doesn't work</p>\n\n<p>Any idea of how I could exit ghci without a crash? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1502948127, "post_id": 45725313, "comment_id": 78411877, "body": "Sometimes you can provide a much faster <code>Eq</code> instance than the one which would be derived. The idea behind <a href=\"http://hackage.haskell.org/package/intern\" rel=\"nofollow noreferrer\">interned</a> strings (and other interned structures) is that you can compare them for equality in O(1) time. I could see a situation like that but slightly different, where you might want a standard <code>Ord</code> instance from <code>deriving</code> but a special <code>Eq</code> instance."}], "answers": [{"comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1502935947, "post_id": 45725438, "comment_id": 78408744, "body": "There&#39;s also a bit more flexible definition: <code>data Foo = ... deriving (Ord); instance Eq Foo where x == y = compare x y == EQ</code>. GHC then effectively autogenerates both instances."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1502936986, "post_id": 45725438, "comment_id": 78408947, "body": "(Of course, <code>deriving (Eq, Ord)</code> already does that, more or less, so that might not be super useful.)"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 5, "last_activity_date": 1502934612, "creation_date": 1502934612, "answer_id": 45725438, "question_id": 45725313, "link": "https://stackoverflow.com/questions/45725313/what-happens-if-we-derive-ord-but-not-eq-while-making-a-data-type/45725438#45725438", "title": "What happens if we derive Ord but not Eq while making a data type?", "body": "<p>One could plausibly derive <code>Ord</code> but instantiate <code>Eq</code> by hand:</p>\n\n<pre><code>data Foo = Foo deriving Ord\ninstance Eq Foo where\n    _ == _ = True\n</code></pre>\n\n<p>I can't think of a place off-hand where this would be useful, but there's no reason to prevent it.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1502947156, "post_id": 45726981, "comment_id": 78411530, "body": "The bigger problem is that sometimes the superclass could be derived based on any of several subclasses. In that case, which one should it pick? For example, <code>Functor</code> could be derived from <code>Applicative</code> or from <code>Traversable</code> or from <code>Comonad</code>."}, {"owner": {"reputation": 506, "user_id": 1779797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f6e55d52a394abfca69f53c04690dc8?s=128&d=identicon&r=PG", "display_name": "Tesseract", "link": "https://stackoverflow.com/users/1779797/tesseract"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1502948256, "post_id": 45726981, "comment_id": 78411920, "body": "None of those can be automatically derived in a data declaration though?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1502954177, "post_id": 45726981, "comment_id": 78415136, "body": "@Tesseract, <code>Traversable</code> and <code>Functor</code> both can with suitable extensions.  Of course that means dfeuer&#39;s ambiguity can&#39;t happen in practice, but that seems more of a coincidence, and in principle it&#39;s an issue worth thinking about."}], "tags": [], "owner": {"reputation": 506, "user_id": 1779797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f6e55d52a394abfca69f53c04690dc8?s=128&d=identicon&r=PG", "display_name": "Tesseract", "link": "https://stackoverflow.com/users/1779797/tesseract"}, "is_accepted": false, "score": 2, "last_activity_date": 1502946480, "creation_date": 1502946480, "answer_id": 45726981, "question_id": 45725313, "link": "https://stackoverflow.com/questions/45725313/what-happens-if-we-derive-ord-but-not-eq-while-making-a-data-type/45726981#45726981", "title": "What happens if we derive Ord but not Eq while making a data type?", "body": "<p>You are required to write <code>Eq</code> for the same reason that you have to write an instance for <code>Eq</code> before writing an instance for <code>Ord</code> (or at least before compiling it). It would be possible to deduce one, but that property does not apply to all typeclass contexts so you need to be explicit.</p>\n\n<p>The compiler could easily know to derive <code>Eq</code> (and this would probably be fairly harmless), but it might cause some surprises to have an instance of a typeclass without explicitly asking for it. This could be very confusing if it somehow happened to more complicated typeclasses.</p>\n"}], "owner": {"reputation": 610, "user_id": 4132408, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-qduksoQ23dA/AAAAAAAAAAI/AAAAAAAAFfs/1X6QQSwe20A/photo.jpg?sz=128", "display_name": "Prashant Solanki", "link": "https://stackoverflow.com/users/4132408/prashant-solanki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 491, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1502992081, "creation_date": 1502933557, "last_edit_date": 1502992081, "question_id": 45725313, "link": "https://stackoverflow.com/questions/45725313/what-happens-if-we-derive-ord-but-not-eq-while-making-a-data-type", "title": "What happens if we derive Ord but not Eq while making a data type?", "body": "<p>I understand that in haskell if we make a data type deriving Ord it should be deriving Eq as well, but why do we have to explicitly write both of them in the definition?</p>\n"}, {"tags": ["haskell", "haskell-wai", "haskell-warp"], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 1, "last_activity_date": 1502950318, "creation_date": 1502950318, "answer_id": 45727758, "question_id": 45725148, "link": "https://stackoverflow.com/questions/45725148/how-do-i-force-warp-to-use-a-status-code-other-than-200-when-using-responsefile/45727758#45727758", "title": "How do I force warp to use a status code other than 200 when using ResponseFile?", "body": "<p>It looks like a bug in Warp. Can you open an issue on the tracker?</p>\n"}], "owner": {"reputation": 506, "user_id": 1779797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f6e55d52a394abfca69f53c04690dc8?s=128&d=identicon&r=PG", "display_name": "Tesseract", "link": "https://stackoverflow.com/users/1779797/tesseract"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 45727758, "answer_count": 1, "score": 0, "last_activity_date": 1502950318, "creation_date": 1502932084, "question_id": 45725148, "link": "https://stackoverflow.com/questions/45725148/how-do-i-force-warp-to-use-a-status-code-other-than-200-when-using-responsefile", "title": "How do I force warp to use a status code other than 200 when using ResponseFile?", "body": "<p>When trying to produce a custom 404 error, I attempt to respond with <code>responseFile notFound404 [(\"Content-Type\",\"text/html\")] \"404.html\" Nothing</code>. However, if \"404.html\" is present in my filesystem, Warp sends the data with status code 200.</p>\n\n<p>Is this behavior expected by servers that support the wai interface? If so, why does responseFile have a status argument?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 4, "creation_date": 1502928531, "post_id": 45724701, "comment_id": 78407163, "body": "Your data definition defines a new type constructor (something that lives in the space of types) called <code>Expression</code> and two data constructors <code>Expression</code> and <code>Int</code> (which live in the space of values/functions). The <code>Int</code> constructor has no relation to the <code>Int</code> type (they live in separate namespaces)."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 2, "creation_date": 1502928699, "post_id": 45724701, "comment_id": 78407199, "body": "Did you mean something like <code>\u2026 | Literal { value :: Int }</code>?"}, {"owner": {"reputation": 293, "user_id": 6675961, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/46f11b114fe506c0a7b305e730a02a64?s=128&d=identicon&r=PG&f=1", "display_name": "northlane", "link": "https://stackoverflow.com/users/6675961/northlane"}, "edited": false, "score": 0, "creation_date": 1502928779, "post_id": 45724701, "comment_id": 78407216, "body": "Yes, I believe this is what I meant. Thanks."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1502961049, "post_id": 45724701, "comment_id": 78419424, "body": "If you follow this approach, note that the <code>lhs,rhs</code> accessors are partial -- they will crash your program if you ever feed them a non-<code>Expression</code>. I&#39;d either not define them at all, or use them only in pattern matching as in <code>foo (Expression{lhs = x}) = ...</code>. Unfortunately Haskell does not allow to restrict fields only for pattern matching."}], "answers": [{"tags": [], "owner": {"reputation": 22952, "user_id": 210211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8721ff8fa4b5c658058f4a2803231f44?s=128&d=identicon&r=PG", "display_name": "comingstorm", "link": "https://stackoverflow.com/users/210211/comingstorm"}, "is_accepted": true, "score": 7, "last_activity_date": 1502934488, "creation_date": 1502934488, "answer_id": 45725426, "question_id": 45724701, "link": "https://stackoverflow.com/questions/45724701/can-you-mix-record-syntax-with-enumerations-in-haskell-data-types/45725426#45725426", "title": "Can you mix record syntax with enumerations in Haskell data types?", "body": "<p>Things to know up front:</p>\n\n<ul>\n<li>every data constructor in a Haskell <code>data</code> declaration has its own name</li>\n<li>data constructors live in an entirely separate namespace from type names</li>\n</ul>\n\n<hr>\n\n<p>As the comments note, you are defining both a type named <code>Expression</code> and a data constructor named <code>Expression</code>.  Because Haskell has separate namespaces for types and data constructors, the compiler is fine with this.</p>\n\n<p>Also, you are creating a second data constructor named <code>Int</code> (which likewise doesn't conflict with the existing type named <code>Int</code>).  This is probably not what you want, and is confusing to boot!</p>\n\n<p>When you try to construct a value such as <code>myExpr = Expression x y</code>, you are using the first data constructor, not the type name or the second data constructor.  The <code>Expression</code> data constructor expects two arguments: first an <code>Int</code>, then an <code>Expression</code>.  That is why, if you just provide the first argument, you will get a partially applied function.</p>\n\n<hr>\n\n<p>A corrected, more idiomatic version of your example might be:</p>\n\n<pre><code>data Expression = Assignment { lhs :: Int, rhs :: Expression }\n                | Literal { value :: Int }\n</code></pre>\n\n<p>It is actually fairly common to see a data constructor with the same name as its type, if it is the <em>only</em> data constructor:</p>\n\n<pre><code>data Foo = Foo { unwrapFoo :: Int }\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1502958416, "post_id": 45725546, "comment_id": 78417661, "body": "This answer would be improved by an explanation of why this type of definition is not tremendously idiomatic."}], "tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": false, "score": 4, "last_activity_date": 1502935629, "creation_date": 1502935629, "answer_id": 45725546, "question_id": 45724701, "link": "https://stackoverflow.com/questions/45724701/can-you-mix-record-syntax-with-enumerations-in-haskell-data-types/45725546#45725546", "title": "Can you mix record syntax with enumerations in Haskell data types?", "body": "<p>For the sake of completeness, the answer to your question is yes. The other answer provides an excellent explanation of what your current code does, but the short answer to your question is that</p>\n\n<pre><code>data Expression = Assignment { lhs :: Int, rhs :: Expression }\n                | Literal Int\n</code></pre>\n\n<p>is a completely valid type declaration. That being said, it's not tremendously idiomatic, so if you're going to use record syntax, you should probably use it for each data constructor of a given type.</p>\n"}], "owner": {"reputation": 293, "user_id": 6675961, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/46f11b114fe506c0a7b305e730a02a64?s=128&d=identicon&r=PG&f=1", "display_name": "northlane", "link": "https://stackoverflow.com/users/6675961/northlane"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 256, "favorite_count": 1, "accepted_answer_id": 45725426, "answer_count": 2, "score": 3, "last_activity_date": 1502935629, "creation_date": 1502928104, "last_edit_date": 1502934701, "question_id": 45724701, "link": "https://stackoverflow.com/questions/45724701/can-you-mix-record-syntax-with-enumerations-in-haskell-data-types", "title": "Can you mix record syntax with enumerations in Haskell data types?", "body": "<p>I've written the following:</p>\n\n<pre><code>data Expression = Expression { lhs :: Int, rhs :: Expression } | Int\n</code></pre>\n\n<p>The problem is if I try to construct an Expression with just an int I get a partially applied function. What's the best way to fix this?</p>\n"}]