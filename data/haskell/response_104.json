[{"tags": ["haskell", "typeclass"], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1483577633, "last_edit_date": 1483577633, "creation_date": 1483577111, "answer_id": 41475591, "question_id": 41474847, "link": "https://stackoverflow.com/questions/41474847/representing-game-state-with-typeclass-in-haskell/41475591#41475591", "title": "Representing game state with typeclass in Haskell", "body": "<p>First of all, if you can do something without type classes then it's often a good idea to just stay away from them. You can always just make a simpler wrapper for a particular application, especially if you flip the arguments suitably:</p>\n\n<pre><code>bestMove :: (s -&gt; [m]) -&gt; (m -&gt; s -&gt; s) -&gt; s -&gt; m\n\nbestChessMove :: ChessState -&gt; ChessMove\nbestChessMove = bestMove possibleChessMoves applyChessMove\n</code></pre>\n\n<p>That said, I don't find the class you envision unsensible (unlike many an OO class that somebody wants to squeeze into Haskell...). And you're quite on the right track that it should be a multiparam class:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-} \n\nclass MoveState m s where\n  apply :: m -&gt; s -&gt; s\n  possibleMoves :: s -&gt; [m]\n\ninstance MoveState ChessMove ChessState where\n  apply = ...\n  possibleMoves = ...\n</code></pre>\n\n<p>Then</p>\n\n<pre><code>bestMove :: MoveState m s =&gt; (s -&gt; Cost) -&gt; s -&gt; m\n</code></pre>\n\n<p>Actually that class is more general than makes sense though: for any given state type, you probably have only one move type. One way to express this is would be a <a href=\"https://ocharles.org.uk/blog/posts/2014-12-14-functional-dependencies.html\" rel=\"nofollow noreferrer\">functional dependency</a> <code>| s -&gt; m</code>; what I usually prefer is to instead make the <code>Move</code> type simple a \u201cproperty\u201d of the state class:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-} \n\nclass GameState s where\n  type Move s :: *\n  apply :: Move s -&gt; s -&gt; s\n  possibleMoves :: s -&gt; [Move s]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3124, "user_id": 631004, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d8c9b1e28e202f4aea71129683fa681?s=128&d=identicon&r=PG", "display_name": "Tilo", "link": "https://stackoverflow.com/users/631004/tilo"}, "edited": false, "score": 0, "creation_date": 1483656856, "post_id": 41476304, "comment_id": 70198522, "body": "I had a hard time deciding between this answer and the answer I accepted. I felt that this answer describes a better solution, but might not be as useful for someone who runs into this question from a different context."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 4, "last_activity_date": 1483582222, "creation_date": 1483582222, "answer_id": 41476304, "question_id": 41474847, "link": "https://stackoverflow.com/questions/41474847/representing-game-state-with-typeclass-in-haskell/41476304#41476304", "title": "Representing game state with typeclass in Haskell", "body": "<p>You could consider just passing in the whole darn game tree:</p>\n\n<pre><code>data GameTree m s = GameTree s [(m, GameTree m s)]\n\nbestMove :: GameTree m s -&gt; (s -&gt; Int) -&gt; Maybe m\nbestMove gameTree evaluateState = ...\n</code></pre>\n\n<p>Rely on laziness to expand only the parts of the game tree you actually look at.</p>\n"}], "owner": {"reputation": 3124, "user_id": 631004, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d8c9b1e28e202f4aea71129683fa681?s=128&d=identicon&r=PG", "display_name": "Tilo", "link": "https://stackoverflow.com/users/631004/tilo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 618, "favorite_count": 0, "accepted_answer_id": 41475591, "answer_count": 2, "score": 1, "last_activity_date": 1483582222, "creation_date": 1483571815, "last_edit_date": 1483572142, "question_id": 41474847, "link": "https://stackoverflow.com/questions/41474847/representing-game-state-with-typeclass-in-haskell", "title": "Representing game state with typeclass in Haskell", "body": "<p>I'm implementing some functions to search game trees for my own amusement. For example, one such function would execute the <a href=\"http://www.geeksforgeeks.org/minimax-algorithm-in-game-theory-set-1-introduction/\" rel=\"nofollow noreferrer\">Minimax</a> algorithm. These functions are using two kinds of objects:</p>\n\n<ol>\n<li>Game state, e.g. the positions of the pieces on a chess board, the next player to move, etc.</li>\n<li>Moves, e.g. \"Pawn e2 to e5\"</li>\n</ol>\n\n<p>My goal is to have search functions that work for different games, so I'm passing in game-specific knowledge as helper functions like: </p>\n\n<ul>\n<li>Generate all possible moves from a given game state</li>\n<li>Given a state and a move, apply the move to the state to get the resulting state</li>\n<li>Find out if this is a winning position</li>\n<li>etc.</li>\n</ul>\n\n<p>This way, my search function is indeed not game-specific, but the solution still doesn't feel right. It also makes my parameter lists rather long:</p>\n\n<pre><code>-- Given a game state find the best next move\nbestMove :: s -&gt; (s -&gt; [m]) -&gt; (s -&gt; m -&gt; s) -&gt; m    -- more parameters in my real code\nbestMove currentState possibleMoves applyMove = ...\n</code></pre>\n\n<h2>Question</h2>\n\n<p>Can I replace these helper functions with typeclasses? I'm looking for something along the lines of this:</p>\n\n<pre><code>class Move m where\n  apply :: State s =&gt; s -&gt; m -&gt; s\n\nclass State s where\n  possibleMoves :: Move m =&gt; s -&gt; [m]\n\nbestMove :: State s =&gt; Move m =&gt; s -&gt; m\nbestMove currentState = ... -- e.g. = head $ possibleMoves state\n</code></pre>\n\n<p>The problem is that any instance of <code>State</code> is only supposed to work together with one specific instance of <code>Move</code> and vice versa: </p>\n\n<pre><code>{-# LANGUAGE InstanceSigs #-} \n\ndata ChessState = ...\ndata ChessMove  = ...\n\ninstance Move ChessMove where\n  apply :: ChessState -&gt; ChessMove -&gt; ChessState\n  apply s m = ...\n</code></pre>\n\n<p>The type signature for <code>apply</code> is of course wrong. It should be </p>\n\n<pre><code>apply :: S s =&gt; s -&gt; ChessMove -&gt; s\n</code></pre>\n\n<p>but I do need properties that are specific to <code>ChessState</code> in order to create a <code>ChessMove</code>.</p>\n\n<p>Am I completely on the wrong track with the whole idea or is there a way to encode the relationship between <code>ChessState</code> and <code>ChessMove</code>? I have made some little progress with <a href=\"https://wiki.haskell.org/Multi-parameter_type_class\" rel=\"nofollow noreferrer\"><code>MultiParamTypeClasses</code></a>, but it's still not looking the way I was hoping.</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 5, "creation_date": 1483550617, "post_id": 41469699, "comment_id": 70145220, "body": "Main.hs is probably the executable, not the library, so you\u2019d have to add <code>random</code> to the executable\u2019s dependencies."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1483552256, "post_id": 41469699, "comment_id": 70146170, "body": "Tangential note: you can find whether e.g. <i>random</i> is in Stackage by visiting <a href=\"https://www.stackage.org/package/random\" rel=\"nofollow noreferrer\">stackage.org/package/random</a> . Doing it the other way around, a full list of packages in e.g. lts-7.14 lies at <a href=\"https://www.stackage.org/lts-7.14\" rel=\"nofollow noreferrer\">stackage.org/lts-7.14</a> ."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1483554795, "post_id": 41469699, "comment_id": 70147519, "body": "Tangential note II: <code>random</code> is a really bad RNG.  Use something else, like <code>entropy</code>, <code>drbg</code>, <code>tf-random</code>, etc."}, {"owner": {"reputation": 21, "user_id": 7375363, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/027a5697007f5a9719439e9d5906621d?s=128&d=identicon&r=PG&f=1", "display_name": "Haskell learner", "link": "https://stackoverflow.com/users/7375363/haskell-learner"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1483565531, "post_id": 41469699, "comment_id": 70152907, "body": "Yes @Alexis , putting random in the executable dependencies does just the trick. Thanks for that, and other tips too."}], "owner": {"reputation": 21, "user_id": 7375363, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/027a5697007f5a9719439e9d5906621d?s=128&d=identicon&r=PG&f=1", "display_name": "Haskell learner", "link": "https://stackoverflow.com/users/7375363/haskell-learner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 86, "favorite_count": 0, "closed_date": 1483610856, "answer_count": 0, "score": 1, "last_activity_date": 1483550324, "creation_date": 1483550324, "question_id": 41469699, "link": "https://stackoverflow.com/questions/41469699/haskell-stack-random-numbers-package", "closed_reason": "Duplicate", "title": "haskell stack - random numbers package", "body": "<p>We are new users trying to use random numbers in a new stack project, but cannot <code>import System.Random</code>. It doesn't seem to be in the curated set(?)</p>\n\n<p>We've got a new stack project setup as in the user manual. We've edited the cabal file putting <code>random</code> in library build depends, and later put <code>- random-1.1</code> in the yaml extra-deps. However after stack build it reaches Main.hs but then fails with </p>\n\n<pre><code>Failed to load interface for System.Random\nIt is a member of the hidden package random-1.1\n</code></pre>\n\n<p>How do we get a simple working random package in there.</p>\n"}, {"tags": ["haskell", "cabal", "nix"], "comments": [{"owner": {"reputation": 2373, "user_id": 3335288, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/qfxhh.jpg?s=128&g=1", "display_name": "Zimm i48", "link": "https://stackoverflow.com/users/3335288/zimm-i48"}, "edited": false, "score": 0, "creation_date": 1483616126, "post_id": 41469582, "comment_id": 70172788, "body": "Confirmed on my machine. I <i>think</i> that this is the kind of things that should be reported as bugs on <a href=\"https://github.com/NixOS/nixpkgs/issues\" rel=\"nofollow noreferrer\">github.com/NixOS/nixpkgs/issues</a> instead of being posted here on SO."}], "answers": [{"tags": [], "owner": {"reputation": 2585, "user_id": 1190453, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/8bc78ac3f1246f30c55f3339c3e7586f?s=128&d=identicon&r=PG", "display_name": "danbst", "link": "https://stackoverflow.com/users/1190453/danbst"}, "is_accepted": true, "score": 3, "last_activity_date": 1486297874, "creation_date": 1486297874, "answer_id": 42052072, "question_id": 41469582, "link": "https://stackoverflow.com/questions/41469582/why-does-nix-shell-fail-with-missing-test-suite-dependencies-when-i-only-ask/42052072#42052072", "title": "Why does `nix-shell` fail with missing `test-suite` dependencies when I only ask for a `library` of `haskellPackages`?", "body": "<p>Replace </p>\n\n<pre><code>p.compose-ltr\n</code></pre>\n\n<p>with</p>\n\n<pre><code>(haskell.lib.dontCheck p.compose-ltr)\n</code></pre>\n\n<p>which disables tests for this package. Overall this should be included into <a href=\"https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/haskell-modules/configuration-common.nix\" rel=\"nofollow noreferrer\">https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/haskell-modules/configuration-common.nix</a> (a PR on GitHub will be welcome, I think)</p>\n"}], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 375, "favorite_count": 0, "accepted_answer_id": 42052072, "answer_count": 1, "score": 1, "last_activity_date": 1486297874, "creation_date": 1483549942, "question_id": 41469582, "link": "https://stackoverflow.com/questions/41469582/why-does-nix-shell-fail-with-missing-test-suite-dependencies-when-i-only-ask", "title": "Why does `nix-shell` fail with missing `test-suite` dependencies when I only ask for a `library` of `haskellPackages`?", "body": "<p>Might anyone of you know why</p>\n\n<pre><code>$ nix-shell \\\n  -I nixpkgs=https://github.com/NixOS/nixpkgs-channels/archive/nixos-unstable.tar.gz \\\n  -p \"haskellPackages.ghcWithPackages (p: [p.compose-ltr])\" \\\n  --run ghci\n</code></pre>\n\n<p>fails with</p>\n\n<pre><code>Configuring compose-ltr-0.2.3...\n\nSetup: Encountered missing dependencies:\nQuickCheck ==2.8.1, hspec ==2.2.0\n\nbuilder for \u2018/nix/store/pvmm9qcp9xpj5hw77nbfyfj4wxs49jl8-compose-ltr-0.2.3.drv\u2019 failed with exit code 1\ncannot build derivation \u2018/nix/store/41znxh9qi408n9j63fqvixrlkaasrgkx-ghc-8.0.1-with-packages.drv\u2019: 1 dependencies couldn't be built\n</code></pre>\n\n<p>?</p>\n\n<p>(blank lines added for separation and emphasis)</p>\n\n<p>I'm asking since as far as I am aware I'm not asking <code>nix</code> to build/run unit tests of <code>compose-ltr</code>, so why does it care about <code>QuickCheck</code> and <code>hspec</code>?</p>\n\n<p>Yes, QuickCheck and hspec are mentioned <a href=\"https://github.com/Wizek/compose-ltr/blob/master/compose-ltr.cabal#L32\" rel=\"nofollow noreferrer\">in the <code>.cabal</code> file, but only for <code>test-suite spec</code> and not <code>library</code></a>.</p>\n\n<hr>\n\n<p>Additionally, can I fix this either by</p>\n\n<ol>\n<li>specifying something further in my <code>nix-shell</code> command, </li>\n<li>changing something in the <code>.cabal</code> file of <code>compose-ltr</code>, or</li>\n<li>adding a <code>.nix</code> file to <code>compose-ltr</code>?</li>\n</ol>\n\n<p>I wouldn't say I have much experience with <code>nix</code> yet, so a detailed response is welcome.</p>\n"}, {"tags": ["haskell", "dependent-type"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1483557206, "post_id": 41469419, "comment_id": 70148834, "body": "I don&#39;t have time to write a full answer, so: In <code>look</code> you have <code>Lookup s (&#39;(s&#39;, b) : xs) ~ Just a</code>. In the <code>Nothing</code> branch GHC doesn&#39;t know how to build <code>Lookup s xs ~ Just a</code> when you recursively <code>look</code>. You could prove the law of the excluded middle <code>Natty n -&gt; Natty m -&gt; Either (n :~: m) (Not (n :~: m))</code> (for the sake of discussion I&#39;m switching from <code>Symbol</code>s to <code>Nat</code>s and singleton <code>Natty</code>s because opaque <code>Symbol</code>s have no singleton partner), where <code>Not a = a -&gt; Void</code>. Then in the <code>Right</code> branch you can use said evidence to eliminate impossible cases when building the smaller context."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1483557355, "post_id": 41469419, "comment_id": 70148922, "body": "My instinct here is to walk away from all this theorem-proving, though. Instead try an automated proof search for the aforementioned typed indices using the class system. <code>class EL x xs where el :: El x xs</code> and a pair of instances which attempt to match <code>x</code> against the head of the list. You might need to use <a href=\"https://wiki.haskell.org/GHC/AdvancedOverlap\" rel=\"nofollow noreferrer\">this trick</a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1483563839, "post_id": 41469419, "comment_id": 70152106, "body": "Implementing <code>LookupIndex</code> instead of <code>Lookup</code> -- essentially converting your names to deBruijn indices -- would probably work and should be pretty simple, and would still let you expose a public interface that was in terms of names."}], "answers": [{"comments": [{"owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "edited": false, "score": 0, "creation_date": 1483629097, "post_id": 41475403, "comment_id": 70182091, "body": "Thanks @user3237465! Using your code, I&#39;ve managed to get a satisfactory solution!"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "edited": false, "score": 0, "creation_date": 1483643073, "post_id": 41475403, "comment_id": 70191358, "body": "@Rodrigo Ribeiro, could you show it or describe shortly?"}, {"owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "edited": false, "score": 0, "creation_date": 1484076935, "post_id": 41475403, "comment_id": 70358684, "body": "Sorry... I thought that what I changed was correct, but after a little testing I found a missing bug. I&#39;m still have some troubles on this. Anyway, thanks for your partial solution."}], "tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": true, "score": 3, "last_activity_date": 1483575753, "last_edit_date": 1495542830, "creation_date": 1483575753, "answer_id": 41475403, "question_id": 41469419, "link": "https://stackoverflow.com/questions/41469419/proving-a-rather-simple-theorem-in-haskell/41475403#41475403", "title": "Proving a rather simple theorem in Haskell", "body": "<p>One problem is explained by <a href=\"https://stackoverflow.com/users/1523776/benjamin-hodgson\">Benjamin Hodgson</a> in the comments. For this to solve you just need a more typed <code>sameSymbol</code>:</p>\n\n<pre><code>sameOrNotSymbol :: (KnownSymbol a, KnownSymbol b)\n                =&gt; Proxy a -&gt; Proxy b -&gt; Either ((a == b) :~: 'False) (a :~: b)\nsameOrNotSymbol s s' = maybe (Left $ unsafeCoerce Refl) Right $ sameSymbol s s'\n</code></pre>\n\n<p>Then <code>look</code> can be defined as (assuming <code>weak</code> is proved):</p>\n\n<pre><code>look :: (Lookup s xs ~ 'Just a, KnownSymbol s)\n     =&gt; Proxy s -&gt; HList xs -&gt; Exp (DropWhileNotSame (s, a) xs) a\nlook s ((s',p) :* rho) = case sameOrNotSymbol s s' of\n  Left  Refl -&gt; weak s $ look s rho\n  Right Refl -&gt; p\n</code></pre>\n\n<p>The ambiguity error you get is due to the fact that <code>s</code> is mentioned in the constraints, but is not determined anywhere. This is easy to fix \u2014 just provide a <code>Proxy s</code>:</p>\n\n<pre><code>weak :: forall s s' xs a b. (KnownSymbol s\n        , KnownSymbol s'\n        , (s == s') ~ 'False)\n     =&gt; Proxy s -&gt; Exp xs a -&gt; Exp ('(s', b) ': xs) a\nweak s (Val n) = Val n\nweak s (Var t) = ...\n</code></pre>\n\n<p>But here we encounter a problem that is much harder to fix. What if a symbol stored in that <code>Exp xs a</code> is the same as <code>s'</code> \u2014 the symbol prepended to the list? Returning <code>Var t</code> would be incorrect in this case, because the meaning of <code>Var t</code> is changed: it no longer denotes a symbol somewhere in the middle of the list \u2014 it's in the head now. And it's not type correct, since that requires <code>a</code> and <code>b</code> to be the same type. So this version type checks:</p>\n\n<pre><code>weak :: forall s s' xs a a. (KnownSymbol s\n        , KnownSymbol s'\n        , (s == s') ~ 'False)\n     =&gt; Proxy s -&gt; Exp xs a -&gt; Exp ('(s', a) ': xs) a\nweak s (Val n) = Val n\nweak s (Var t) = case sameOrNotSymbol t (Proxy :: Proxy s') of\n  Left  Refl -&gt; Var t\n  Right Refl -&gt; Var (Proxy :: Proxy s')\n</code></pre>\n\n<p>but the one you desire does not. \"But we know that a stored symbol cannot be <code>s'</code>, because this situation is explicitly refuted by the way <code>look</code> is defined\" \u2014 you might say. Good luck proving it.</p>\n\n<p>Just use de Bruijn indices, really.</p>\n"}], "owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 180, "favorite_count": 0, "accepted_answer_id": 41475403, "answer_count": 1, "score": 5, "last_activity_date": 1483575753, "creation_date": 1483549373, "question_id": 41469419, "link": "https://stackoverflow.com/questions/41469419/proving-a-rather-simple-theorem-in-haskell", "title": "Proving a rather simple theorem in Haskell", "body": "<p>I'm trying, without success, some experiments with dependently typed programming in Haskell. My idea is to express some sort of weakening property on finite mappings. The whole code is as follows:</p>\n\n<pre><code>{-# LANGUAGE PolyKinds                #-}\n{-# LANGUAGE GADTs                    #-}\n{-# LANGUAGE DataKinds                #-}\n{-# LANGUAGE TypeFamilies             #-}\n{-# LANGUAGE RankNTypes               #-}\n{-# LANGUAGE TypeOperators            #-}\n{-# LANGUAGE UndecidableInstances     #-}\n{-# LANGUAGE MultiParamTypeClasses    #-}\n{-# LANGUAGE FlexibleContexts         #-}\n{-# LANGUAGE FlexibleInstances        #-}\n{-# LANGUAGE ScopedTypeVariables      #-}\n\nmodule Exp where\n\nimport Data.Proxy\nimport Data.Type.Equality\nimport GHC.TypeLits\n\n data Exp (env :: [(Symbol,*)]) (a :: *) where\n   Val :: Int -&gt; Exp env Int\n   Var :: (KnownSymbol s, Lookup s env ~ 'Just a) =&gt; Proxy s -&gt; Exp env a\n\n data HList (xs :: [(Symbol,*)]) where\n    Nil :: HList '[]\n    (:*) :: KnownSymbol s =&gt; (Proxy s, Exp ('(s,a) ': xs) a) -&gt; HList xs -&gt; HList ('(s,a) ': xs)\n\n infixr 5 :*\n\n type family If (b :: Bool) (l :: k) (r :: k) :: k where\n    If 'True  l r = l\n    If 'False l r = r\n\n type family Lookup (s :: Symbol) (env :: [(Symbol,*)]) :: Maybe * where\n    Lookup s '[]             = 'Nothing\n    Lookup s ('(t,a) ': env) = If (s == t) ('Just a) (Lookup s env)\n\n look :: (Lookup s xs ~ 'Just a, KnownSymbol s) =&gt; Proxy s -&gt; HList xs -&gt; Exp xs a\n look s ((s',p) :* rho) = case sameSymbol s s' of\n                            Just Refl -&gt; p\n                            Nothing   -&gt; look s rho\n</code></pre>\n\n<p>GHC complains that call <code>look s rho</code> doesn't have type <code>Exp xs a</code>, since recursive call is done on a finite environment <code>rho</code> with less entries than the original one. I believe that the solution is to weaken <code>Exp xs a</code> to <code>Exp ('(s,b) ': xs) a</code>. Here goes my try to weaken expressions:</p>\n\n<pre><code>weak :: (Lookup s xs ~ 'Just a\n        , KnownSymbol s\n        , KnownSymbol s'\n        , (s == s') ~ 'False) =&gt; Exp xs a -&gt; Exp ('(s', b) ': xs) a\nweak (Val n) = Val n\nweak (Var s) = Var (Proxy :: Lookup s ('(s', b) ': xs) ~ 'Just a =&gt; Proxy s)\n</code></pre>\n\n<p>and GHC responds with a type ambiguity error:</p>\n\n<pre><code>Could not deduce: Lookup s0 xs ~ 'Just a\n  from the context: (Lookup s xs ~ 'Just a,\n                     KnownSymbol s,\n                     KnownSymbol s',\n                     (s == s') ~ 'False)\n    bound by the type signature for:\n               weak :: (Lookup s xs ~ 'Just a, KnownSymbol s, KnownSymbol s',\n                        (s == s') ~ 'False) =&gt;\n                       Exp xs a -&gt; Exp ('(s', b) : xs) a\n</code></pre>\n\n<p>I'm aware that such weakening can be easily implemented if we use typed De Bruijn indexes to represent variables. My question is: Is possible to implement it for names instead of indexes? If so, how it can be done?</p>\n"}, {"tags": ["haskell", "data-kinds"], "comments": [{"owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "edited": false, "score": 6, "creation_date": 1483549203, "post_id": 41469252, "comment_id": 70144334, "body": "I believe its a GHCi thing. Try writing <code>:set -XDataKinds</code> to manually enable the extension. For some reason the interpreter doesn&#39;t load it automatically when you load a file."}], "answers": [{"comments": [{"owner": {"reputation": 1225, "user_id": 1553313, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c254d80f35c4c00cf529252f98f23fea?s=128&d=identicon&r=PG", "display_name": "m-renaud", "link": "https://stackoverflow.com/users/1553313/m-renaud"}, "edited": false, "score": 0, "creation_date": 1483552572, "post_id": 41469371, "comment_id": 70146310, "body": "Thanks! That makes sense. I was reading a similar question and one of the answers mentioned that you only need the DataKinds extension when you use the promoted constructors, which seems to be equivalent of needing to enable the extension in the repl."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 3, "creation_date": 1483561378, "post_id": 41469371, "comment_id": 70150920, "body": "It&#39;s often better to use <code>:seti</code> instead of <code>:set</code> \u2013 using <code>:set</code> will <i>also</i> cause extensions to be enabled in <i>all loaded files</i>, as though you&#39;d run <code>ghc</code> with those options.  The <code>:seti</code> command just <i>set</i>s the extensions for <i>i</i>nteractive use.  For example, GHCi behaves as though the user had specified <code>:seti -XNoMonomorphismRestriction</code> by default \u2013 GHCi-bound variables aren&#39;t monomorphized, but variables bound in loaded files are left alone."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1483564482, "post_id": 41469371, "comment_id": 70152396, "body": "@AntalSpector-Zabusky I&#39;ve edited the answer to reference <code>:seti</code>. I had not been aware of that option and looking it up I agree that its behavior would be less surprising in this case."}], "tags": [], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "is_accepted": true, "score": 10, "last_activity_date": 1483564342, "last_edit_date": 1483564342, "creation_date": 1483549226, "answer_id": 41469371, "question_id": 41469252, "link": "https://stackoverflow.com/questions/41469252/cant-specify-type-signature-in-ghci-when-using-datakinds/41469371#41469371", "title": "Can&#39;t specify type signature in GHCI when using DataKinds", "body": "<p><code>SomeData 2 Nothing :: SomeData 'KindA</code> works if you first <code>:seti -XDataKinds</code>. My thought is that the pragmas in the code files are incorporated when loading the file, but for things evaluated in the REPL you need to enable them inside GHCi explicitly as well.</p>\n\n<p>I would think of this as when in GHCi, the file(s) you load are more like imported modules and any code in the REPL has its own set of language extensions. When loading multiple files in GHCi, you might not necessarily want all language extensions in all loaded files to be enabled/available.</p>\n"}], "owner": {"reputation": 1225, "user_id": 1553313, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c254d80f35c4c00cf529252f98f23fea?s=128&d=identicon&r=PG", "display_name": "m-renaud", "link": "https://stackoverflow.com/users/1553313/m-renaud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1099, "favorite_count": 1, "accepted_answer_id": 41469371, "answer_count": 1, "score": 7, "last_activity_date": 1483564342, "creation_date": 1483548865, "question_id": 41469252, "link": "https://stackoverflow.com/questions/41469252/cant-specify-type-signature-in-ghci-when-using-datakinds", "title": "Can&#39;t specify type signature in GHCI when using DataKinds", "body": "<p>So, ghci is giving me an interesting error when I try and pin down the type of a polymorphic return value when using <code>DataKinds</code>. I have the following code:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE ExistentialQuantification #-}\n{-# LANGUAGE StandaloneDeriving #-}\n\ndata DataKind\n    = KindA\n    | KindB\n\ndata SomeData (a :: DataKind) = forall c. SomeData\n    { val :: Int\n    , sub :: Maybe (SomeData c)\n    }\n\nderiving instance Show (SomeData a)\n\ntwo :: SomeData 'KindA\ntwo = SomeData 2 Nothing\n</code></pre>\n\n<p>This code compiles as expected. If I construct <code>SomeData</code> in ghci and don't specify the type it works fine:</p>\n\n<pre><code>&gt; two\nSomeData {val = 2, sub = Nothing}\n\n&gt; :t two\ntwo :: SomeData 'KindA\n\n&gt; SomeData 2 Nothing\nSomeData 2 Nothing :: SomeData a\n</code></pre>\n\n<p>But if I try and specify the type it errors:</p>\n\n<pre><code>&gt; SomeData 2 Nothing :: SomeData 'KindA\n&lt;interactive&gt;:745:32-37: error:\n\u2022 Data constructor \u2018KindA\u2019 cannot be used here\n    (Perhaps you intended to use DataKinds)\n\u2022 In the first argument of \u2018SomeData\u2019, namely \u2018KindA\u2019\n  In an expression type signature: SomeData KindA\n  In the expression: SomeData 1 Nothing :: SomeData KindA\n</code></pre>\n\n<p>It appears that the quote is not being interpreted by ghci. I started the repl using <code>stack ghci</code>. Has anyone encountered this before? Thanks in advance for any help.</p>\n"}, {"tags": ["list", "haskell", "gtk2hs"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1483544746, "post_id": 41467392, "comment_id": 70141080, "body": "What&#39;s the problem with just using an ordinary list of <a href=\"http://hackage.haskell.org/package/gtk3-0.14.6/docs/Graphics-UI-Gtk-Abstract-Widget.html#t:Widget\" rel=\"nofollow noreferrer\"><code>Widget</code>s</a>?"}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1483545709, "post_id": 41467392, "comment_id": 70141760, "body": "something like the following? <code>map (\\c -&gt; boxPackStart box c PackNatural 0) [content1, content2, content3]</code>"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 1, "last_activity_date": 1483548796, "creation_date": 1483548796, "answer_id": 41469227, "question_id": 41467392, "link": "https://stackoverflow.com/questions/41467392/list-of-gtk2hs-widgets/41469227#41469227", "title": "list of gtk2hs widgets", "body": "<p>For widgets specifically, you can use</p>\n\n<pre><code>toWidget :: WidgetClass o =&gt; o -&gt; Widget\n</code></pre>\n\n<p>to safely upcast labels and buttons to widgets, as in:</p>\n\n<pre><code>do\n    label &lt;- labelNew (Just \"foo\")\n    button &lt;- buttonNewWithLabel \"bar\"\n    col PackNatural [toWidget label, toWidget button]\n</code></pre>\n\n<p>Other gtk2hs classes have similar casting functions; generally in that package collection, <code>to*</code> is a safe upcast and <code>castTo*</code> is an unsafe downcast.</p>\n"}], "owner": {"reputation": 191, "user_id": 4690599, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/w0DCU.jpg?s=128&g=1", "display_name": "some idiot", "link": "https://stackoverflow.com/users/4690599/some-idiot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 41469227, "answer_count": 1, "score": 0, "last_activity_date": 1483548796, "creation_date": 1483543615, "question_id": 41467392, "link": "https://stackoverflow.com/questions/41467392/list-of-gtk2hs-widgets", "title": "list of gtk2hs widgets", "body": "<p>how do I create a List (or whatever. Not a Tuple though) that accepts different instances of some typeclass? \nSpecifically, I want to do something like the following: </p>\n\n<pre><code>[labelNew (Just \"foo\"), buttonNewWithLabel \"bar\"]\n</code></pre>\n\n<p>I don\u2019t care for the syntax-sugar, I just want to pass a list of widgets to a function that will pass them to another function which accepts any widgets. </p>\n\n<p>Right now, the purpose is only to get rid of the line-noise, like that</p>\n\n<pre><code>boxPackStart box content1 PackNatural 0\nboxPackStart box content2 PackNatural 0\n...\nboxPackStart box content100 PackNatural 0\n</code></pre>\n\n<p>should be eg</p>\n\n<pre><code>box &lt;- col PackNatural [content1, content2, ..., content100]\n</code></pre>\n\n<p>I found some pages mentioning some dynamic lists but stopped reading when it said \"not typesafe\"</p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 2, "creation_date": 1483541805, "post_id": 41466740, "comment_id": 70139130, "body": "<code>response</code> has type <code>IO (Response ByteString)</code>, but <code>responseStatus</code> is a lens that operates on a value of type <code>Response ByteString</code>."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 4, "creation_date": 1483543125, "post_id": 41466740, "comment_id": 70139953, "body": "If you are completely new to haskell, I would recommend you to learn the basics before trying out a library like wreq which has a lensy API. It would save you a lot of time/frustration in the long run."}, {"owner": {"reputation": 457, "user_id": 7169108, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QRp7Z.jpg?s=128&g=1", "display_name": "Sumanth Kumar Mora", "link": "https://stackoverflow.com/users/7169108/sumanth-kumar-mora"}, "edited": false, "score": 0, "creation_date": 1483774322, "post_id": 41466740, "comment_id": 70243957, "body": "Thank you Alexis King &amp; Sibi"}], "answers": [{"tags": [], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "is_accepted": true, "score": 1, "last_activity_date": 1483630995, "last_edit_date": 1483630995, "creation_date": 1483607603, "answer_id": 41481051, "question_id": 41466740, "link": "https://stackoverflow.com/questions/41466740/extract-responsestatus-from-response-using-network-wreq/41481051#41481051", "title": "Extract responseStatus from Response using Network.Wreq", "body": "<p>As the comments above pointed out, it is probably a good idea to learn Haskell before using more complex libraries. As stated, you have a type mismatch in your code. <code>response</code> is not a value as you might think, but a monad. If you want to get the status code of your response you could try this:</p>\n\n<pre><code>status :: IO Status\nstatus = do\n  resp &lt;- get \"url\" -- This is how the value returned by get is obtained.\n  return (resp ^. responseStatus)\n</code></pre>\n\n<p>Note that everything is done inside the IO monad, which is the way Haskell has to deal with IO side-effects.</p>\n"}], "owner": {"reputation": 457, "user_id": 7169108, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QRp7Z.jpg?s=128&g=1", "display_name": "Sumanth Kumar Mora", "link": "https://stackoverflow.com/users/7169108/sumanth-kumar-mora"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "accepted_answer_id": 41481051, "answer_count": 1, "score": 0, "last_activity_date": 1483630995, "creation_date": 1483541581, "last_edit_date": 1483573191, "question_id": 41466740, "link": "https://stackoverflow.com/questions/41466740/extract-responsestatus-from-response-using-network-wreq", "title": "Extract responseStatus from Response using Network.Wreq", "body": "<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport Network.Wreq\nimport Data.ByteString.Lazy\nimport Control.Lens\n\ntotalResponse :: IO (Response ByteString)\ntotalResponse =  response\n\nstatus :: Status\nstatus =  response ^. responseStatus\n\nresponse = get \"url\"\n</code></pre>\n\n<p>which gives </p>\n\n<pre><code>getRequest.hs:10:23: error:\n    \u2022 Couldn't match type \u2018Response body0\u2019\n                     with \u2018IO (Response ByteString)\u2019\n      Expected type: Getting Status (IO (Response ByteString)) Status\n        Actual type: (Status -&gt; Const Status Status)\n                     -&gt; Response body0 -&gt; Const Status (Response body0)\n    \u2022 In the second argument of \u2018(^.)\u2019, namely \u2018responseStatus\u2019\n      In the expression: response ^. responseStatus\n      In an equation for \u2018status\u2019: status = response ^. responseStatus\n</code></pre>\n\n<p>when I look for </p>\n\n<pre><code>:type response ^. responseStatus\n</code></pre>\n\n<p>in <code>ghci</code> it gives</p>\n\n<pre><code>response ^. responseStatus :: Status\n</code></pre>\n\n<p>I'm completely new to Haskell.</p>\n"}, {"tags": ["haskell", "types", "functional-programming", "immutability", "value-type"], "answers": [{"comments": [{"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 1, "creation_date": 1483572760, "post_id": 41466712, "comment_id": 70156005, "body": "I got the following error with GHC 8.0.1: <code>Could not deduce (KnownSymbol n0) arising from a use of \u2018symbolVal\u2019 [...] The type variable \u2018n0\u2019 is ambiguous</code>. Making <code>legal</code> a scoped type variable and giving a signature for <code>r</code> solved the issue. I&#39;m confused though why it couldn&#39;t infer the type of <code>r</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 2, "creation_date": 1483573482, "post_id": 41466712, "comment_id": 70156235, "body": "@jpath it can actually infer this, but only when <code>-XMonoLocalBinds</code> is enabled. I didn&#39;t notice, because I have <code>-XGADTs</code> in my <code>.ghci</code> file, which implies <code>-XMonoLocalBinds</code>."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 14, "last_activity_date": 1483573515, "last_edit_date": 1483573515, "creation_date": 1483541494, "answer_id": 41466712, "question_id": 41466132, "link": "https://stackoverflow.com/questions/41466132/constrained-value-types-in-haskell/41466712#41466712", "title": "Constrained Value Types in Haskell", "body": "<p>Can be done in modern GHC (>= 7.10, perhaps already 7.8).</p>\n\n<pre><code>{-# LANGUAGE KindSignatures, DataKinds, MonoLocalBinds #-}\nimport GHC.TypeLits\n\nnewtype LegalChar (legalSet :: Symbol)\n   = LegalChar {getLegalChar :: Char}\n  deriving (Show)\n\nfromChar :: KnownSymbol legal =&gt; Char -&gt; Maybe (LegalChar legal)\nfromChar c\n   | c`elem`symbolVal r = Just r\n   | otherwise          = Nothing\n where r = LegalChar c\n</code></pre>\n\n<p>Then</p>\n\n<pre><code>*Main&gt; fromChar 'a' :: Maybe (LegalChar \"abc\")\nJust (LegalChar {getLegalChar = 'a'})\n*Main&gt; fromChar 'x' :: Maybe (LegalChar \"abc\")\nNothing\n</code></pre>\n\n<p>I think in GHC-8 you can even give <code>legalSet</code> the kind <code>String</code> and do away with the <code>KnownSymbol</code> constraint, not sure how that would work.</p>\n"}], "owner": {"reputation": 2379, "user_id": 5045375, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/17ed0af705e0449fe49b74d8814a8ce2?s=128&d=identicon&r=PG", "display_name": "Filip Allberg", "link": "https://stackoverflow.com/users/5045375/filip-allberg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 1, "accepted_answer_id": 41466712, "answer_count": 1, "score": 5, "last_activity_date": 1535163908, "creation_date": 1483539801, "last_edit_date": 1535163908, "question_id": 41466132, "link": "https://stackoverflow.com/questions/41466132/constrained-value-types-in-haskell", "title": "Constrained Value Types in Haskell", "body": "<p>Is it possible to define constrained types in Haskell, i.e. I would like to be able to express,</p>\n\n<pre><code>Prelude&gt; let legalCharacters = ' ':['A'..'Z']\nPrelude&gt; legalCharacters\n\" ABCDEFGHIJKLMNOPQRSTUVWXYZ\"\n</code></pre>\n\n<p>as a type, if possible. </p>\n"}, {"tags": ["haskell", "functional-programming", "fold"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1483535047, "post_id": 41464389, "comment_id": 70134520, "body": "Try with your own recursion first, then use <code>foldl</code> (if applicable at all)."}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 2, "creation_date": 1483535174, "post_id": 41464389, "comment_id": 70134607, "body": "You could use <code>unfoldr</code> along with <code>splitAt</code>."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 4, "creation_date": 1483535244, "post_id": 41464389, "comment_id": 70134652, "body": "<a href=\"http://hackage.haskell.org/package/split-0.2.3.1/docs/Data-List-Split.html#v:chunksOf\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/split-0.2.3.1/docs/&hellip;</a>"}, {"owner": {"reputation": 161, "user_id": 6731064, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/e3e89af583f596652d94294cd481ae31?s=128&d=identicon&r=PG&f=1", "display_name": "user6731064", "link": "https://stackoverflow.com/users/6731064/user6731064"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1483536006, "post_id": 41464389, "comment_id": 70135149, "body": "@Bergi thanks recursion was the right way to go, think this should work <code>bundle :: Int -&gt; [a] -&gt; [[a]] bundle _ [] = [] bundle n xs = take n xs : bundle n (drop n xs)</code>"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1483536341, "post_id": 41464389, "comment_id": 70135345, "body": "Yes. You can do a bit better by using <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-List.html#v:splitAt\" rel=\"nofollow noreferrer\"><code>splitAt</code></a> instead of <code>take</code>+<code>drop</code>, but ultimately this solution is much easier than a <code>fold</code> with counters."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1483540794, "post_id": 41464389, "comment_id": 70138380, "body": "You don&#39;t need the <code>length xss &gt; 1 ==&gt;</code>. <code>all p [] = True</code>. On the other hand, your test doesn&#39;t fully specify the function--can you see its weak spot?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1483540968, "post_id": 41464389, "comment_id": 70138488, "body": "Also, <code>foldl</code> would be lousy here. You could do it well with <code>foldr</code>, but you&#39;d need that fold to produce a <i>function</i>. This is a common technique, but it sounds like you&#39;re probably not ready for it yet."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 2, "last_activity_date": 1483542133, "creation_date": 1483542133, "answer_id": 41466927, "question_id": 41464389, "link": "https://stackoverflow.com/questions/41464389/how-to-bundle-values-into-set-length-lists-in-haskell/41466927#41466927", "title": "How to bundle values into set length lists in Haskell?", "body": "<p>Well, you can use <code>splitAt</code>, e.g.</p>\n\n<pre><code>bundle :: Int -&gt; [a] -&gt; [[a]]\nbundle _ [] = []\nbundle n xs = as : bundle n bs\n  where (as, bs) = splitAt n xs\n</code></pre>\n\n<p>however, you should make sure <code>n</code> is positive, otherwise you'll end up with an infinite list of empty lists. This function holds your properties: <code>splitAt n</code> returns a pair where the first part of the tuple has exactly <code>n</code> elements. Since all but the last list entry are created that way, your second property holds. The first property holds for obvious reasons.</p>\n\n<p>However, those \"bundles\" are usually called \"chunks\". The package <code>split</code> provides the fitting function <code>chunksOf</code>, which does exactly the same:</p>\n\n<pre><code>import Data.List.Split (chunksOf)\n\nbundle :: Int -&gt; [a] -&gt; [[a]]\nbundle = chunksOf\n</code></pre>\n"}], "owner": {"reputation": 161, "user_id": 6731064, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/e3e89af583f596652d94294cd481ae31?s=128&d=identicon&r=PG&f=1", "display_name": "user6731064", "link": "https://stackoverflow.com/users/6731064/user6731064"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 202, "favorite_count": 0, "accepted_answer_id": 41466927, "answer_count": 1, "score": 1, "last_activity_date": 1483542133, "creation_date": 1483534557, "question_id": 41464389, "link": "https://stackoverflow.com/questions/41464389/how-to-bundle-values-into-set-length-lists-in-haskell", "title": "How to bundle values into set length lists in Haskell?", "body": "<p>Trying to write a function in Haskell that bundles a list of xs into lists of size n e.g. the result of <code>bundle 3 [1..10]</code> should be <code>[[1,2,3],[4,5,6],[7,8,9],[10]]</code>.</p>\n\n<p>I know the type should be </p>\n\n<pre><code>bundle :: Int -&gt; [a] -&gt; [[a]]\n</code></pre>\n\n<p>and needs to satisfy something like </p>\n\n<pre><code>concat $ bundle n xs == xs\nlength xss &gt; 1 ==&gt; all (\\xs -&gt; n  == length xs) (init xss)\n</code></pre>\n\n<p>but when I come to actually try to implement it I get stuck. I imagine I need to use foldl but can't think of what function to apply. </p>\n"}, {"tags": ["haskell", "typeclass", "higher-rank-types"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1483528056, "post_id": 41462189, "comment_id": 70130057, "body": "Why are you using that universal type? What are you trying to achieve?"}, {"owner": {"reputation": 273, "user_id": 5374074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/24e06dbaa357b25b6d0946f988dc223d?s=128&d=identicon&r=PG&f=1", "display_name": "denormal", "link": "https://stackoverflow.com/users/5374074/denormal"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1483528402, "post_id": 41462189, "comment_id": 70130289, "body": "I am trying to limit the type of functions to those working with <code>Floating</code> types. My earlier declaration was <code>data Something a</code> without a universal type, but I run into other problems. These had to do with wrapping <code>Something a</code> into an existential wrapper (it has other parameters besides <code>a</code>) and using the <code>ad</code> package (the differentiable function type is a bit misleading, I just need a labeled function). My code pretty much works now, except this function that tries to extract the label. I may post another question at a later point about restoring the <code>a</code> parameter."}, {"owner": {"reputation": 273, "user_id": 5374074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/24e06dbaa357b25b6d0946f988dc223d?s=128&d=identicon&r=PG&f=1", "display_name": "denormal", "link": "https://stackoverflow.com/users/5374074/denormal"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1483528641, "post_id": 41462189, "comment_id": 70130449, "body": "@chi Long story short: the <code>ad</code> package doesn&#39;t work with concrete types such as <code>Double</code>, it needs these typeclass constraints (actually the universal quantifier) to be able to use its own types that instantiate them."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1483535078, "post_id": 41462189, "comment_id": 70134543, "body": "The issue here is that your <code>l</code> variable must be polytypes and GHC can&#39;t infer polytypes. You probably need to use <code>let l = case f of (_,_,x)-&gt;x in ...</code> and probably need an explicit annotation for <code>l</code>. Without seeing the rest of the code, I&#39;d still think that using the <code>Something a</code> approach is simpler, though."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1483552163, "post_id": 41462189, "comment_id": 70146127, "body": "Have you mistyped your pattern-match? <code>(_, _, l)</code> is quite different from <code>(_, _. l)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 273, "user_id": 5374074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/24e06dbaa357b25b6d0946f988dc223d?s=128&d=identicon&r=PG&f=1", "display_name": "denormal", "link": "https://stackoverflow.com/users/5374074/denormal"}, "edited": false, "score": 0, "creation_date": 1483537158, "post_id": 41464392, "comment_id": 70135893, "body": "Thanks. If I pick Double and then use the same <code>something</code>, somewhere where a <code>DifferentiableFunction Float</code> is required, could that create problems?"}, {"owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "reply_to_user": {"reputation": 273, "user_id": 5374074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/24e06dbaa357b25b6d0946f988dc223d?s=128&d=identicon&r=PG&f=1", "display_name": "denormal", "link": "https://stackoverflow.com/users/5374074/denormal"}, "edited": false, "score": 0, "creation_date": 1483537721, "post_id": 41464392, "comment_id": 70136222, "body": "@denormal no that won&#39;t cause problems, because the <code>f</code> binding is polymorphic due to the forall, so it can be used at different types in different places."}], "tags": [], "owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "is_accepted": true, "score": 2, "last_activity_date": 1483534573, "creation_date": 1483534573, "answer_id": 41464392, "question_id": 41462189, "link": "https://stackoverflow.com/questions/41462189/could-not-deduce-typeclass-a0-arising-from-a-use-of-variable/41464392#41464392", "title": "Could not deduce (TypeClass a0) arising from a use of \u2018variable\u2019", "body": "<p>The problem is that <code>let (_, _. l) = f in l</code> does not specify what type to use for <code>f</code>: it could be <code>DifferentiableFunction n Double</code> or <code>DifferentiableFunction n Float</code> or something else altogether. Because you only use a part which does not depend on <code>a</code> (<code>l</code> is just a <code>String</code>, no matter what <code>a</code> is), the compiler is unable to decide what type <code>f</code> should have (<code>a</code> is ambigious, i.e. the compile does not know what to pick for <code>a</code>). </p>\n\n<p>The solution therefore is to give an explicit type signature for f:</p>\n\n<pre><code>case something of\n  (Operator s f) -&gt; let (_, _, l) = (f :: DifferentiableFunction n Double) in l\n</code></pre>\n\n<p>Or alternatively, lift the <code>String</code> out of the forall:</p>\n\n<pre><code>type DifferentiableFunction n a = (Function n a, List n (Function n a))\ndata Something where\n  Operator :: Something -&gt; (forall a . Floating a =&gt; DifferentiableFunction n a) -&gt; String -&gt; Something -- String is not inside the `forall a.`\n</code></pre>\n\n<p>Now you can get the <code>String</code> without needing to pick a specific <code>a</code>, because it really is independent of <code>a</code>.</p>\n"}], "owner": {"reputation": 273, "user_id": 5374074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/24e06dbaa357b25b6d0946f988dc223d?s=128&d=identicon&r=PG&f=1", "display_name": "denormal", "link": "https://stackoverflow.com/users/5374074/denormal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "accepted_answer_id": 41464392, "answer_count": 1, "score": 0, "last_activity_date": 1483552237, "creation_date": 1483527591, "last_edit_date": 1483552237, "question_id": 41462189, "link": "https://stackoverflow.com/questions/41462189/could-not-deduce-typeclass-a0-arising-from-a-use-of-variable", "title": "Could not deduce (TypeClass a0) arising from a use of \u2018variable\u2019", "body": "<p>I have a type:</p>\n\n<pre><code>type DifferentiableFunction n a = (Function n a, List n (Function n a), String)\n</code></pre>\n\n<p>Elsewhere I define:</p>\n\n<pre><code>data Something where\n  Operator :: Something -&gt; (forall a . Floating a =&gt; DifferentiableFunction n a) -&gt; Something\n</code></pre>\n\n<p>Now I try to pattern match:</p>\n\n<pre><code>case something of\n  (Operator s f) -&gt; let (_, _, l) = f in l\n</code></pre>\n\n<p>I get <code>Could not deduce (Floating a0) arising from a use of \u2018f\u2019</code>. I don't understand why this is happening.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "edited": false, "score": 0, "creation_date": 1483514404, "post_id": 41457200, "comment_id": 70122257, "body": "Avoid tacking on extras to functions precisely because you run into situations like this. Functions are defined once and used in many places. The caller can adapt your function by using, for example, function composition. If you think having a Text interface will be helpful then you can add a module such as <code>Rasa.Text</code> which simply wraps your regular API with Text conversion."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1483514764, "post_id": 41457200, "comment_id": 70122425, "body": "I&#39;m not sure this type class is a good idea, but <a href=\"http://stackoverflow.com/questions/32130011/how-do-you-write-rewrite-rules-for-typeclass-methods\">this question</a> may be useful."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1483518979, "post_id": 41457200, "comment_id": 70124384, "body": "You should take a look at how it&#39;s done in GHC for <a href=\"https://www.stackage.org/haddock/lts-7.14/base-4.9.0.0/src/GHC-Real.html#fromIntegral\" rel=\"nofollow noreferrer\"><code>fromIntegral</code></a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1483564154, "post_id": 41457200, "comment_id": 70152236, "body": "If Rasa uses <code>YiString</code> everywhere internally, why not make it the core type rather than <code>Text</code>, as in <code>class TextLike a where textLike :: Iso&#39; a YiString</code>? Then converting internally does no work (other than a very cheap <code>id</code>), and presumably the extensions that choose to use other types do no <i>extra</i> work since they would have to convert at the extension boundary anyway."}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1483812227, "post_id": 41457200, "comment_id": 70255160, "body": "This is good advice; I&#39;ll probably do this, but it&#39;s interesting to see how the inlining rules work too :)"}], "answers": [{"tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": true, "score": 4, "last_activity_date": 1483523680, "last_edit_date": 1483523680, "creation_date": 1483517701, "answer_id": 41459108, "question_id": 41457200, "link": "https://stackoverflow.com/questions/41457200/type-level-optimizations-on-function/41459108#41459108", "title": "Type-level Optimizations on function", "body": "<p>I haven't tested it, but you should be able to use rewrite rules for this optimization:</p>\n\n<pre><code>textConvert :: (TextLike a, TextLike b) =&gt; a -&gt; b\ntextConvert = fromText . toText\n{-# INLINE [1] textConvert #-}\n\n{-# RULES\n \"toTextY/fromTextY\" forall x. textConvert (x :: Y.YiString) = x\n #-} \n</code></pre>\n\n<p>This will effectively replace all inefficient conversions. You can later verify if this rule fires by compiling with <code>-ddump-rule-firings</code> flag. Here is a tutorial that goes into all the details on rewrite rules: <a href=\"https://wiki.haskell.org/GHC/Using_rules\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/GHC/Using_rules</a></p>\n"}], "owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 41459108, "answer_count": 1, "score": 2, "last_activity_date": 1483523680, "creation_date": 1483509992, "question_id": 41457200, "link": "https://stackoverflow.com/questions/41457200/type-level-optimizations-on-function", "title": "Type-level Optimizations on function", "body": "<p>I'm working on <a href=\"https://github.com/ChrisPenner/rasa\" rel=\"nofollow noreferrer\">Rasa</a>, my text-editor and I'm doing most of my low-level text manipulation using <a href=\"https://hackage.haskell.org/package/yi-rope\" rel=\"nofollow noreferrer\">Yi.Rope</a>, but I'd like to expose a nicer interface for people developing extensions. Instead of restricting people to using ropes, strings, or text I figured why not just let people use whatever they want? So I wrote this type-class which allows moving between text-types by using the common denominator of Text:</p>\n\n<pre><code>import Control.Lens\nimport qualified Yi.Rope as Y\nimport qualified Data.Text as T\n\nclass TextLike a where\n  toText :: a -&gt; T.Text\n  fromText :: T.Text -&gt; a\n  asText :: Iso' a T.Text\n  asText = iso toText fromText\n\ninstance TextLike Y.YiString where\n  toText = Y.toText\n  fromText = Y.fromText\n\ninstance TextLike T.Text where\n  toText = id\n  fromText = id\n\ninstance TextLike [Char] where\n  toText = T.pack\n  fromText = T.unpack\n\ntextConvert :: (TextLike a, TextLike b) =&gt; a -&gt; b\ntextConvert = fromText . toText\n</code></pre>\n\n<p>Now my external api functions can use a constraint like: <code>myFunc :: TextLike a =&gt; a -&gt; ...</code> constraint and call <code>textConvert</code> inside to convert FROM any TextLike TO any TextLike. This actually works quite well, but since my internals use the YiString structure and the intermediary is Text; any time I call a function using this technique I convert from YiString to YiString, but the implementation of textConvert actually goes YiString to Text, then Text back to YiString, which is obviously inefficient :P</p>\n\n<p>I'd love to keep a similar sort of generality (whatever the best way is); but I'd like to optimize certain cases, especially the special case <code>textConvert :: YiString -&gt; YiString</code>. Anyone know of a good way? Maybe type level programming, maybe a different approach altogether?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "haskell-lens", "type-families", "lenses"], "answers": [{"comments": [{"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "edited": false, "score": 0, "creation_date": 1496062316, "post_id": 41460311, "comment_id": 75494862, "body": "In <code>class HasClientId s a | s -&gt; a where</code>, what&#39;s the pipe for? Also, what&#39;s the arrow for? Could you post a link to something that might explain it please? I&#39;ve never seen an explanation of this, and I&#39;ve searched quite a bit before."}, {"owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "reply_to_user": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "edited": false, "score": 0, "creation_date": 1496130887, "post_id": 41460311, "comment_id": 75521296, "body": "@Julian Leviston it&#39;s the syntax of the FunctionalDependencies (often abbreviated fundeps) extension"}, {"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "edited": false, "score": 0, "creation_date": 1496149612, "post_id": 41460311, "comment_id": 75534224, "body": "Thanks. I&#39;ll look it up."}], "tags": [], "owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "is_accepted": false, "score": 3, "last_activity_date": 1483522093, "creation_date": 1483522093, "answer_id": 41460311, "question_id": 41456869, "link": "https://stackoverflow.com/questions/41456869/how-to-make-lenses-for-records-with-type-families/41460311#41460311", "title": "How to make lenses for records with type-families", "body": "<p>The problem here is that <code>makeLensesFor</code> will try to generate an instance as follows:</p>\n\n<pre><code>instance HasClientId (NewTag f) (Incoming f Int64) where\n  ....\n</code></pre>\n\n<p>This, however, is an error because you cannot create an instance for the result of a type family application. To avoid this, we can write the instance manually for each of the two possible choices for <code>f</code>:</p>\n\n<pre><code>-- generate lenses _foo for each record selector foo\n-- (in this case, generates _ntClientId and _ntTag lenses)\nmakeLensesWith (lensRules &amp; lensField .~ mappingNamer (\\x -&gt; ['_' : x])) ''NewTag\n\nclass HasClientId s a | s -&gt; a where\n  clientId :: Lens' s a\n\ninstance HasClientId (NewTag Validated) Int64 where\n  clientId = _ntClientId\n\ninstance HasClientId (NewTag ValidationErrors) (Either [T.Text] Int64) where\n  clientId f a = f (ntClientId a) &lt;&amp;&gt; \\ntClientId' -&gt; a { ntClientId = ntClientId' }\n\nclass HasTag s a | s -&gt; a where\n  tag :: Lens' s a\n\ninstance HasTag (NewTag Validated) Tag where\n  tag = _ntTag\n\ninstance HasTag (NewTag ValidationErrors) (Either [T.Text] Tag) where\n  tag = _ntTag\n</code></pre>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 0, "closed_date": 1483530075, "answer_count": 1, "score": 2, "last_activity_date": 1483522093, "creation_date": 1483508150, "last_edit_date": 1483508804, "question_id": 41456869, "link": "https://stackoverflow.com/questions/41456869/how-to-make-lenses-for-records-with-type-families", "closed_reason": "Duplicate", "title": "How to make lenses for records with type-families", "body": "<p>Here's what I've got, which is not compiling:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE StandaloneDeriving #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE TemplateHaskell #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE FunctionalDependencies #-}\n\nimport Data.Text as T\nimport Data.Int (Int64)\nimport Control.Lens\n\ntype family Incoming validationResult baseType\ntype instance Incoming Validated baseType = baseType\ntype instance Incoming ValidationErrors baseType = Either [T.Text] baseType\n\ndata Validated\ndata ValidationErrors\n\ndata Tag = Tag {unTag :: T.Text} deriving (Eq, Show)\n\ndata NewTag f = NewTag\n  {\n    ntClientId :: Incoming f Int64\n  , ntTag :: Incoming f Tag\n  }\n\n$(makeLensesWith abbreviatedFields ''NewTag)\n</code></pre>\n\n<p>Compilation error:</p>\n\n<pre><code>27   3 error           error:\n \u2022 Illegal type synonym family application in instance:\n     Incoming f_a1Kvx Int64\n \u2022 In the instance declaration for\n     \u2018HasClientId (NewTag f_a1Kvx) (Incoming f_a1Kvx Int64)\u2019 (intero)\n27   3 error           error:\n \u2022 Illegal type synonym family application in instance:\n     Incoming f_a1Kvx Tag\n \u2022 In the instance declaration for\n     \u2018HasTag (NewTag f_a1Kvx) (Incoming f_a1Kvx Tag)\u2019 (intero)\n</code></pre>\n"}, {"tags": ["haskell", "type-families", "deriving"], "comments": [{"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 1, "creation_date": 1483508350, "post_id": 41456841, "comment_id": 70119839, "body": "Please make sure your example is complete; this doesn&#39;t compile as-is (it&#39;s missing module imports and a definition of <code>Tag</code>).  Also, include the error messages you get; they often offer a suggestion (here, it&#39;s &quot;Use FlexibleInstances if you want to disable this.&quot;).  Let us know what you&#39;ve done \u2013 have you tried the suggestion?  What are you having trouble with, exactly?"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 1, "creation_date": 1483508439, "post_id": 41456841, "comment_id": 70119872, "body": "Hang on... fixing all of this."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 1, "creation_date": 1483508580, "post_id": 41456841, "comment_id": 70119919, "body": "@AntalSpector-Zabusky edited the question. Is this acceptable now?"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1483508669, "post_id": 41456841, "comment_id": 70119955, "body": "@AntalSpector-Zabusky still not compiling with <code>FlexibleInstances</code> turned on."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1483508691, "post_id": 41456841, "comment_id": 70119962, "body": "Can you edit that into the question, too?  Thanks!"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1483508853, "post_id": 41456841, "comment_id": 70120025, "body": "@AntalSpector-Zabusky done."}], "answers": [{"comments": [{"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1483520548, "post_id": 41457687, "comment_id": 70125283, "body": "If I get rid of the deriving lines, will I be able to use <code>show</code> on a <code>NewTag Validated</code> ?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1483548228, "post_id": 41457687, "comment_id": 70143663, "body": "@SaurabhNanda Yes, once you add <code>deriving instance (Show (Incoming f Int64), Show (Incoming f Tag)) =&gt; Show (NewTag f)</code>."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 4, "last_activity_date": 1483511984, "creation_date": 1483511984, "answer_id": 41457687, "question_id": 41456841, "link": "https://stackoverflow.com/questions/41456841/how-to-derive-instances-for-records-with-type-families/41457687#41457687", "title": "How to derive instances for records with type-families", "body": "<p>You have two problems here. The first one is what GHC is telling you. Basically, you can't have an instance that depends on a type family (the type family can be there, but only if all the arguments it gets are concrete types). All sorts of bad things can start happening once you allow this, not the least of which is that the right hand side of your type family could have calls to other type families.</p>\n\n<p>Generally, one can solve this sort of problem by moving the type family application to a constraint:</p>\n\n<pre><code>deriving instance (Show baseType, i ~ Incoming Validated baseType) =&gt; Show i\nderiving instance (Show baseType, i ~ Incoming ValidationErrors baseType) =&gt; Show i\n</code></pre>\n\n<p>Doing this actually makes the second problem obvious: your instance heads are too general.</p>\n\n<p>That said, I'm not sure there is even anything to fix - just get rid of the deriving lines. You would like the first one to boil down to saying: derive an instance of <code>Show basetype</code> given the <code>Show basetype</code> constraint (which is completely pointless). The second one is equally pointless - <code>Either</code> already has an instance of <code>Show</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1483520810, "post_id": 41457704, "comment_id": 70125449, "body": "Thank you for the great explanation. Give me a couple of hours to wrap my head around all this."}], "tags": [], "owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "is_accepted": false, "score": 4, "last_activity_date": 1483512084, "creation_date": 1483512084, "answer_id": 41457704, "question_id": 41456841, "link": "https://stackoverflow.com/questions/41456841/how-to-derive-instances-for-records-with-type-families/41457704#41457704", "title": "How to derive instances for records with type-families", "body": "<p>This can't be made to work.  Here's the problem: </p>\n\n<pre><code>Incoming Validated        (Either [T.Text] Int) ~ Either [T.Text] Int\nIncoming ValidationErrors Int                   ~ Either [T.Text] Int\n</code></pre>\n\n<p>Now, if you want a <code>Show (Either [T.Text] Int)</code>, you have three options:</p>\n\n<pre><code>instance (Show a, Show b) =&gt; Show (Either a b) -- from Prelude\ninstance Show baseType    =&gt; Show (Incoming Validated baseType)\ninstance Show baseType    =&gt; Show (Incoming ValidationErrors baseType)\n</code></pre>\n\n<p>Any of these would be a valid instance, and GHC requires global uniqueness of instances.  Indeed, the problem is that type families aren't injective, and so just because you know that you need an <code>instance TyCls A</code>, GHC can't generate the application <code>TyFam B1 B2 B3</code> that would produce an <code>A</code> \u2013 such an application might not even be unique!</p>\n\n<hr>\n\n<p>There are a couple ways you could fix this.</p>\n\n<ol>\n<li><p>Do you really need the <code>Show</code> instance?  Maybe all that you need is a <code>Show</code> <em>constraint</em> on the functions that want to use it.  So for example:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts, UndecidableInstances #-}\n-- But not FlexibleInstances\n\nderiving instance (Show (Incoming f Int64), Show (Incoming f Tag))\n  =&gt; Show (NewTag f)\n</code></pre>\n\n<p>GHC will propagate those constraints everywhere, but they'll always be satisfiable by the end user.  And if <code>f</code> is ever a concrete type, they'll vanish entirely!</p></li>\n<li><p>Do you really want <code>Incoming</code> things to be indistinguishable from base types?  If not, you could use a GADT here:</p>\n\n<pre><code>{-# LANGUAGE GADTs, FlexibleInstances #-}\n\n-- ...\n\ndata Incoming :: * -&gt; * -&gt; * where\n  IncomingValidated        :: baseType\n                           -&gt; Incoming Validated baseType\n  IncomingValidationErrors :: Either [T.Text] baseType\n                           -&gt; Incoming ValidationErrors baseType\n\n-- ...\n\nderiving instance Show (NewTag Validated)\nderiving instance Show (NewTag ValidationErrors)\n</code></pre></li>\n</ol>\n\n<p>The downside here is twofold: first, you have to pattern-match everywhere you use these; second, you can't (on GHC 7.10, at least) use <code>StandaloneDeriving</code> for the GADT <code>Show</code> instances, you need to write them by hand:</p>\n\n<pre><code>    -- deriving instance Show baseType =&gt; Show (Incoming Validated baseType)\n    instance Show baseType =&gt; Show (Incoming Validated baseType) where\n      show (IncomingValidated bt) = \"IncomingValidated \" ++ show bt\n\n    -- deriving instance Show baseType =&gt; Show (Incoming ValidationErrors baseType)\n    instance Show baseType =&gt; Show (Incoming ValidationErrors baseType) where\n      show (IncomingValidationErrors e) = \"IncomingValidationErrors \" ++ show e\n</code></pre>\n\n<p>Either of these could be a good solution; option (1) is the smallest change from what you're already doing, and so would likely be where I would step first.</p>\n\n<hr>\n\n<p>One other note: in modern (7.10+) GHCs, we can clean up something in your code.  Right now, you have two places your code allows too much flexibility.</p>\n\n<ol>\n<li>You can consider a value of the type <code>NewTag Bool</code>, or <code>NewTag ()</code>, or \u2026.</li>\n<li>The <code>Incoming</code> type family is <em>open</em> \u2013 anybody could add a <code>type instance Incoming Bool baseType = Maybe baseType</code>, or <code>Incoming () () = Int</code>, or \u2026.</li>\n</ol>\n\n<p>You only want to consider <code>Validated</code> or <code>ValidationErrors</code> there, and you've already written all the possible type family instances!  GHC provides two features for improving this: <code>DataKinds</code> and closed type families.  With closed type families, you can write</p>\n\n<pre><code>type family Incoming validationResult baseType where\n  Incoming Validated        baseType = baseType\n  Incoming ValidationErrors baseType = Either [T.Text] baseType\n</code></pre>\n\n<p>Now, this is <em>closed</em> \u2013 nobody else can ever add a new case.  This solves #2.</p>\n\n<p>As for #1, if we turn on <code>DataKinds</code>, GHC automatically promotes our value constructors to the type level!  So just as we have that <code>Int :: *</code>, we have that <code>'False :: Bool</code> \u2013 the <code>'</code> indicates to GHC that we're on the type level.  Adding this feature looks as follows:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n\n-- ...\n\ndata ValidationResult = Validated | ValidationErrors\n                      deriving (Eq, Ord, Enum, Bounded, Show, Read)\n\n---- EITHER:\n---- Option (1), with a type family\n-- The only change here is to add tick marks!\ntype family Incoming validationResult baseType where\n  Incoming 'Validated        baseType = baseType\n  Incoming 'ValidationErrors baseType = Either [T.Text] baseType\n\n---- OR:\n---- Option (2), with a GADT\n-- Here, we change the kind signature and add tick marks\ndata Incoming :: ValidationResult -&gt; * -&gt; * where\n    IncomingValidated        :: baseType\n                             -&gt; Incoming 'Validated baseType\n    IncomingValidationErrors :: Either [T.Text] baseType\n                             -&gt; Incoming 'ValidationErrors baseType\n</code></pre>\n\n<p>We can also add kind signatures if we want \u2013 <code>type family Incoming (validationResult :: ValidationResult) (baseType :: *) :: * where \u2026</code> or <code>data NewTag (f :: ValidationResult) = \u2026</code>, but those will be inferred, and are consequently optional.</p>\n\n<p>If the tick <em>really</em> irritates you, you can use the following trick, which I picked up from the GHC source code:</p>\n\n<pre><code>type Validated        = 'Validated\ntype ValidationErrors = 'ValidationErrors\n</code></pre>\n\n<hr>\n\n<p>OK, one more type-level fun thing, because I can't resist :-)  Let's consider option (1) again, with the type family.  We have to provide this annoying <code>(Show (Incoming f Int64), Show (Incoming f Tag))</code> constraint everywhere, which is kinda bulky, especially if we want to abstract over it \u2013 to produce an <code>Eq</code> instance, it's the same, but with <code>Eq</code> instead of <code>Show</code>.  And what if there are more fields?</p>\n\n<p>If we turn on <code>ConstraintKinds</code>, we <em>can</em> abstract over constraints.  That works like so:</p>\n\n<pre><code>{-# LANGUAGE ConstraintKinds #-}\n\nimport GHC.Exts (Constraint)\n\ntype NewTagFieldsAre (c :: * -&gt; Constraint) f =\n  (c (Incoming f Int64), c (Incoming f Tag))\n</code></pre>\n\n<p>(We need the kind signature so GHC doesn't think this produces an ordinary tuple.)  Then we can specify</p>\n\n<pre><code>deriving instance NewTagFieldsAre Eq   f =&gt; Eq   (NewTag f)\nderiving instance NewTagFieldsAre Ord  f =&gt; Ord  (NewTag f)\nderiving instance NewTagFieldsAre Show f =&gt; Show (NewTag f)\nderiving instance NewTagFieldsAre Read f =&gt; Read (NewTag f)\n</code></pre>\n\n<p>And everything is much shorter!</p>\n\n<hr>\n\n<p>Putting this all together, here's what option (1) looks like, with the type family.  The only thing that's different about this is that I consolidated the changes I made, reformatted things slightly, and made a few other taste-based changes.</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts, UndecidableInstances, TypeFamilies,\n             ConstraintKinds, DataKinds, StandaloneDeriving #-}\n\nimport Data.Text as T\nimport Data.Int (Int64)\nimport GHC.Exts (Constraint)\n\ndata Tag = Tag { unTag :: T.Text } deriving (Eq, Ord, Show, Read)\n\ndata ValidationResult = Validated | ValidationErrors\n                      deriving (Eq, Ord, Enum, Bounded, Show, Read)\n\ntype family Incoming (vres :: ValidationResult) (base :: *) :: * where\n  Incoming 'Validated        base = base\n  Incoming 'ValidationErrors base = Either [T.Text] base\n\ndata NewTag f = NewTag { ntClientId :: Incoming f Int64\n                       , ntTag      :: Incoming f Tag }\n\ntype NewTagFieldsAre (c :: * -&gt; Constraint) f =\n  (c (Incoming f Int64), c (Incoming f Tag))\n\nderiving instance NewTagFieldsAre Eq   f =&gt; Eq   (NewTag f)\nderiving instance NewTagFieldsAre Ord  f =&gt; Ord  (NewTag f)\nderiving instance NewTagFieldsAre Show f =&gt; Show (NewTag f)\nderiving instance NewTagFieldsAre Read f =&gt; Read (NewTag f)\n</code></pre>\n\n<p>And for completeness, the GADT option:</p>\n\n<pre><code>{-# LANGUAGE GADTs, FlexibleInstances, TypeFamilies, DataKinds,\n             StandaloneDeriving #-}\n\nimport Data.Text as T\nimport Data.Int (Int64)\n\ndata Tag = Tag { unTag :: T.Text } deriving (Eq, Ord, Show, Read)\n\ndata ValidationResult = Validated | ValidationErrors\n                      deriving (Eq, Ord, Enum, Bounded, Show, Read)\n\ndata Incoming :: ValidationResult -&gt; * -&gt; * where\n  IncomingValidated        :: base\n                           -&gt; Incoming Validated base\n  IncomingValidationErrors :: Either [T.Text] base\n                           -&gt; Incoming ValidationErrors base\n\ninstance Eq base =&gt; Eq (Incoming Validated base) where\n  IncomingValidated x == IncomingValidated y = x == y\n\ninstance Eq base =&gt; Eq (Incoming ValidationErrors base) where\n  IncomingValidationErrors ex == IncomingValidationErrors ey = ex == ey\n\ninstance Ord base =&gt; Ord (Incoming Validated base) where\n  IncomingValidated x `compare` IncomingValidated y = x `compare` y\n\ninstance Ord base =&gt; Ord (Incoming ValidationErrors base) where\n  IncomingValidationErrors ex `compare` IncomingValidationErrors ey = ex `compare` ey\n\ninstance Show base =&gt; Show (Incoming Validated base) where\n  show (IncomingValidated x) = \"IncomingValidated \" ++ show x\n\ninstance Show base =&gt; Show (Incoming ValidationErrors base) where\n  show (IncomingValidationErrors ex) = \"IncomingValidationErrors \" ++ show ex\n\n-- `Show` properly handling precedence, along with the `Read` instance, are left\n-- as an exercise for the interested reader.\n\ndata NewTag f = NewTag { ntClientId :: Incoming f Int64\n                       , ntTag      :: Incoming f Tag }\n\nderiving instance Eq   (NewTag Validated)\nderiving instance Eq   (NewTag ValidationErrors)\nderiving instance Ord  (NewTag Validated)\nderiving instance Ord  (NewTag ValidationErrors)\nderiving instance Show (NewTag Validated)\nderiving instance Show (NewTag ValidationErrors)\n</code></pre>\n\n<p>That need to hand-derive the instances is really dragging it down!</p>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 598, "favorite_count": 2, "answer_count": 2, "score": 5, "last_activity_date": 1483512084, "creation_date": 1483508005, "last_edit_date": 1483508564, "question_id": 41456841, "link": "https://stackoverflow.com/questions/41456841/how-to-derive-instances-for-records-with-type-families", "title": "How to derive instances for records with type-families", "body": "<p>Here's what I'm trying but it doesn't compile:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE StandaloneDeriving #-}\n{-# LANGUAGE FlexibleInstances #-}\n\nimport Data.Text as T\nimport Data.Int (Int64)\n\ntype family Incoming validationResult baseType\ntype instance Incoming Validated baseType = baseType\ntype instance Incoming ValidationErrors baseType = Either [T.Text] baseType\n\ndata Validated\ndata ValidationErrors\n\ndata Tag = Tag {unTag :: T.Text} deriving (Eq, Show)\n\ndata NewTag f = NewTag\n  {\n    ntClientId :: Incoming f Int64\n  , ntTag :: Incoming f Tag\n  }\n\nderiving instance (Show baseType) =&gt; Show (Incoming Validated baseType)\nderiving instance (Show baseType) =&gt; Show (Incoming ValidationErrors baseType)\n</code></pre>\n\n<p>Compilation errors:</p>\n\n<pre><code>23  38 error           error:\n \u2022 Illegal type synonym family application in instance:\n     Incoming Validated baseType\n \u2022 In the stand-alone deriving instance for\n     \u2018(Show baseType) =&gt; Show (Incoming Validated baseType)\u2019 (intero)\n24  38 error           error:\n \u2022 Illegal type synonym family application in instance:\n     Incoming ValidationErrors baseType\n \u2022 In the stand-alone deriving instance for\n     \u2018(Show baseType) =&gt; Show (Incoming ValidationErrors baseType)\u2019 (intero)\n</code></pre>\n"}, {"tags": ["haskell", "dictionary", "recursion", "fold"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1483495223, "post_id": 41454972, "comment_id": 70116650, "body": "It might just be a typo in your question, but you appear to be confusing <code>k1</code> (a tuple argument to <code>cMove&#39;</code>) and <code>ks</code> (the list argument to <code>cMove</code>). Also, are <code>s</code> and <code>myMap</code> supposed to be the same value?"}, {"owner": {"reputation": 71, "user_id": 7346297, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10209290974621035/picture?type=large", "display_name": "Daniel", "link": "https://stackoverflow.com/users/7346297/daniel"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1483495537, "post_id": 41454972, "comment_id": 70116711, "body": "It was a typo, thank you for noticing. Yes, s and myMap are supposed to be the same value. I have edited the question to avoid any confusion."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1483496714, "post_id": 41454972, "comment_id": 70116944, "body": "You are also calling <code>M.delete k</code>, not <code>M.delete k1</code>."}, {"owner": {"reputation": 71, "user_id": 7346297, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10209290974621035/picture?type=large", "display_name": "Daniel", "link": "https://stackoverflow.com/users/7346297/daniel"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1483496990, "post_id": 41454972, "comment_id": 70117000, "body": "Yes, but I need to delete both k and k1 from myMap. Is there a way to delete both of them in the same iteration?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 2, "creation_date": 1483497043, "post_id": 41454972, "comment_id": 70117015, "body": "@DanielJ&#248;rgensen: unless I&#39;m misunderstanding, isn&#39;t that simply <code>M.insert k&#39; False . M.delete k . M.delete k1 $ myMap</code>?"}, {"owner": {"reputation": 71, "user_id": 7346297, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10209290974621035/picture?type=large", "display_name": "Daniel", "link": "https://stackoverflow.com/users/7346297/daniel"}, "edited": false, "score": 0, "creation_date": 1483497264, "post_id": 41454972, "comment_id": 70117072, "body": "Thank you. Sadly, I did not know that. Is there a way to apply foldr to <code>k&#39;</code> instead of using <code>k</code> for the rest of the <code>ks</code>?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1483498212, "post_id": 41454972, "comment_id": 70117283, "body": "@DanielJ&#248;rgensen Should <code>k&#39;</code> <i>always</i> replace <code>k</code> for the next call, or only when it is/isn&#39;t found?"}, {"owner": {"reputation": 71, "user_id": 7346297, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10209290974621035/picture?type=large", "display_name": "Daniel", "link": "https://stackoverflow.com/users/7346297/daniel"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1483502439, "post_id": 41454972, "comment_id": 70118229, "body": "@chepner <code>k&#39;</code> should only replace <code>k</code> when it isn&#39;t found."}], "answers": [{"comments": [{"owner": {"reputation": 71, "user_id": 7346297, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10209290974621035/picture?type=large", "display_name": "Daniel", "link": "https://stackoverflow.com/users/7346297/daniel"}, "edited": false, "score": 0, "creation_date": 1483502360, "post_id": 41455340, "comment_id": 70118215, "body": "Are you sure that <code>cMoves&#39;</code> should return <code>k1</code> for the next step instead of <code>k&#39;</code>? And is there a way to avoid inserting the vertices with negative values? Like, not inserting (-1,2) and (-2,-4)"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 71, "user_id": 7346297, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10209290974621035/picture?type=large", "display_name": "Daniel", "link": "https://stackoverflow.com/users/7346297/daniel"}, "edited": false, "score": 0, "creation_date": 1483504381, "post_id": 41455340, "comment_id": 70118695, "body": "No, I am not sure at all because I don&#39;t actually understand the particular problem you&#39;re trying to solve :) My answer was aimed at explaining how to change the <code>k</code> while you&#39;re traversing <code>ks</code> and keep modifying <code>myMap</code>."}, {"owner": {"reputation": 71, "user_id": 7346297, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10209290974621035/picture?type=large", "display_name": "Daniel", "link": "https://stackoverflow.com/users/7346297/daniel"}, "edited": false, "score": 0, "creation_date": 1483547852, "post_id": 41455340, "comment_id": 70143370, "body": "I see. I found the problem though. foldr takes the last item of the list and traverses from last to first, but I need to do the opposite."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 2, "last_activity_date": 1483500630, "last_edit_date": 1483500630, "creation_date": 1483497221, "answer_id": 41455340, "question_id": 41454972, "link": "https://stackoverflow.com/questions/41454972/looping-over-dictionary-while-using-different-values-to-insert-and-remove-keys/41455340#41455340", "title": "Looping over dictionary while using different values to insert and remove keys", "body": "<p>If I understand the question right, you want to change <code>k</code> to <code>k'</code> from iteration to iteration. You can do that by changing the state of your fold to include <code>k</code> as well:</p>\n\n<pre><code>cMove :: Key -&gt; [Key] -&gt; Map Key Bool -&gt; Map Key Bool\ncMove k ks myMap = snd $ foldr cMoves' (k, myMap) ks\n    where\n        cMoves' :: Key -&gt; (Key, Map Key Bool) -&gt; (Key, Map Key Bool)\n        cMoves' k1 (k, myMap) = case M.lookup k' myMap of\n            Nothing -&gt; (k1, M.insert k' False . M.delete k . M.delete k1 $ myMap)\n            Just x -&gt; (k, myMap)\n          where\n            k' = (2 * fst k1 - fst k, 2 * snd k1 - snd k)\n</code></pre>\n"}], "owner": {"reputation": 71, "user_id": 7346297, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10209290974621035/picture?type=large", "display_name": "Daniel", "link": "https://stackoverflow.com/users/7346297/daniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 41455340, "answer_count": 1, "score": 1, "last_activity_date": 1483618052, "creation_date": 1483494252, "last_edit_date": 1483618052, "question_id": 41454972, "link": "https://stackoverflow.com/questions/41454972/looping-over-dictionary-while-using-different-values-to-insert-and-remove-keys", "title": "Looping over dictionary while using different values to insert and remove keys", "body": "<p>I'm using vertices and a <code>Data.Map.Strict</code>, where I need to implement a capture move for the game Checkers. <code>cMove</code> is supposed to take a vertex <code>k</code> and a list of vertices <code>ks</code> and a map <code>myMap</code>. <code>cMove</code> needs to check if the new vertex (the position which <code>k</code> will get when it jumps over a vertex in <code>ks</code>) is in <code>myMap</code>, as <code>myMap</code> contains the positions of all the pieces on the board. <code>k</code> and <code>k1</code> (a vertex in <code>ks</code>) should be removed from <code>myMap</code> and the new vertex should be inserted into <code>myMap</code>, where the new vertex should be used to check the next vertex in <code>ks</code> and so on, till there are no more elements in the list. I have tried this:</p>\n\n<pre><code>type Key = (Integer, Integer)\n\ncMove :: Key -&gt; [Key] -&gt; Map Key Bool -&gt; Map Key Bool\ncMove k ks myMap = foldr cMoves' myMap ks\n    where\n        cMoves' :: Key -&gt; Map Key Bool -&gt; Map Key Bool\n        cMoves' k1 myMap = case M.lookup k' myMap of\n            Nothing -&gt; M.insert k' False (M.delete k myMap)\n            Just x -&gt; myMap\n          where\n            k' = (2 * fst k1 - fst k, 2 * snd k1 - snd k)\n</code></pre>\n\n<p>which iterates through the list <code>k1</code> as supposed and inserts the new vertex. The problem here is, that <code>k1</code> is not getting removed and the new vertex is not used instead of <code>k</code>. How do I achieve this?</p>\n\n<p>If any part of my question seems vague, don't hesitate to let me know.</p>\n"}, {"tags": ["haskell", "recursive-datastructures"], "comments": [{"owner": {"reputation": 9485, "user_id": 20371, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/32c7a412ad0caf812ae974df5eb8ffcd?s=128&d=identicon&r=PG", "display_name": "Yawar", "link": "https://stackoverflow.com/users/20371/yawar"}, "edited": false, "score": 0, "creation_date": 1483477787, "post_id": 41452340, "comment_id": 70111170, "body": "You may be interested in the following: <a href=\"https://gist.github.com/jdegoes/97459c0045f373f4eaf126998d8f65dc#data--codata\" rel=\"nofollow noreferrer\">gist.github.com/jdegoes/&hellip;</a> <a href=\"https://gist.github.com/jdegoes/97459c0045f373f4eaf126998d8f65dc#recursion-schemes\" rel=\"nofollow noreferrer\">gist.github.com/jdegoes/&hellip;</a>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1483477955, "post_id": 41452340, "comment_id": 70111237, "body": "In this case, <code>idList</code> is simply taking advantage of lazy evaluation; F-algebras are not involved."}, {"owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1483478233, "post_id": 41452340, "comment_id": 70111340, "body": "@chepner <code>idList</code> is just an example. My question is about the recursive type <code>data List a = Nil | Cons a (List a)</code>. What is its mathematical foundation ?"}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1483478558, "post_id": 41452340, "comment_id": 70111474, "body": "<a href=\"https://en.wikipedia.org/wiki/System_F\" rel=\"nofollow noreferrer\">System F</a>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1483478560, "post_id": 41452340, "comment_id": 70111477, "body": "Again, I think it&#39;s just laziness. <a href=\"https://www.schoolofhaskell.com/user/bartosz/understanding-algebras\" rel=\"nofollow noreferrer\">schoolofhaskell.com/user/bartosz/understanding-algebras</a> has an interesting comment at the very end, to the effect that the compiler [presumably, GHC] optimizes recursive code poorly, so writing explicitly non-recursive code has performance benefits."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 3, "creation_date": 1483478813, "post_id": 41452340, "comment_id": 70111605, "body": "A possibly-infinite list <code>data List a = Nil | Cons a (List a)</code> (or definitely infinite <code>data List a = Cons a (List a)</code>) is codata (greatest fixed point), while a finite list <code>data List a = Nil | Cons a !(List a)</code> is data (least fixed point)."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 1, "creation_date": 1483479321, "post_id": 41452340, "comment_id": 70111853, "body": "@JonPurdy ...and greatest and least fixed points coincide in Haskell due to laziness, right? (Can&#39;t remember where I read that...)"}, {"owner": {"reputation": 9485, "user_id": 20371, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/32c7a412ad0caf812ae974df5eb8ffcd?s=128&d=identicon&r=PG", "display_name": "Yawar", "link": "https://stackoverflow.com/users/20371/yawar"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1483481363, "post_id": 41452340, "comment_id": 70112758, "body": "@BenjaminHodgson, I believe Jon Purdy&#39;s code example shows both lazy and eager (strict) definitions of lists, in other words greatest and least fixed point versions."}], "owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 474, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1483477437, "creation_date": 1483477437, "question_id": 41452340, "link": "https://stackoverflow.com/questions/41452340/lists-as-least-fixed-point-of-a-functor", "title": "Lists as least fixed point of a functor", "body": "<p>I thought I understood Haskell's lists, until I stumbled recently on recursive infinite lists, such as</p>\n\n<pre><code>let idList = 0 : (map (+1) idList)\n</code></pre>\n\n<p>which is the infinite list of numbers 0, 1, 2, ...</p>\n\n<p>Now I wonder what is the mathematical definition of Haskell's recursive data types like lists and trees. This article about <a href=\"https://en.wikipedia.org/wiki/F-algebra\" rel=\"nofollow noreferrer\">F-algebras</a> mentions \"Types defined by using least fixed point construct with functor F can be regarded as an initial F-algebra, provided that parametricity holds for the type.\".</p>\n\n<p>Is this where Haskell's types come from ?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 4, "creation_date": 1483470344, "post_id": 41450448, "comment_id": 70107643, "body": "<code>Int#</code> isn&#39;t &quot;<code>Int</code> with some unary operator <code>#</code> at the end&quot;. <code>Int#</code> is the name of a type, and doesn&#39;t <i>really</i> have anything to do with <code>Int</code> (as far as the type system is concerned anyway)."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 4, "creation_date": 1483470422, "post_id": 41450448, "comment_id": 70107686, "body": "Note you are missing an <code>!</code> before the <code>Int</code> for the <code>UNPACK</code> variant."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1483470452, "post_id": 41450448, "comment_id": 70107698, "body": "If I am reading the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#unpack-pragma\" rel=\"nofollow noreferrer\">docs</a> right, there is no difference between these."}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1483470522, "post_id": 41450448, "comment_id": 70107743, "body": "@Cubic: fair enough. But in this case the type <code>Int#</code> is defined. Is there still any difference between <code>{-# UNPACK #-} !Int</code> and <code>Int#</code>? And is the general difference merely that <code>{-# UNPACK #-}</code> can be used with any type, whereas <code>Type#</code> can only be used with the limited list of types including <code>Int#</code>?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1483470523, "post_id": 41450448, "comment_id": 70107745, "body": "In general, however, <code>UNPACK</code> is more powerful as it can flatten more complex data structures automatically."}], "answers": [{"tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": false, "score": 3, "last_activity_date": 1483505224, "last_edit_date": 1483505224, "creation_date": 1483470711, "answer_id": 41450723, "question_id": 41450448, "link": "https://stackoverflow.com/questions/41450448/difference-between-unpack-type-in-ghc-haskell/41450723#41450723", "title": "Difference between {-# UNPACK #-} Type# in GHC Haskell?", "body": "<p>As you know, from <a href=\"https://downloads.haskell.org/~ghc/7.8.2/docs/html/users_guide/pragmas.html\" rel=\"nofollow noreferrer\">here</a>:</p>\n\n<blockquote>\n  <p>The <code>UNPACK</code> indicates to the compiler that it should unpack the\n  contents of a constructor field into the constructor itself, removing\n  a level of indirection</p>\n</blockquote>\n\n<p><code>Int#</code> is the name for GHC's unboxed Int type. <code>Int</code> is simply a wrapper around this type.</p>\n\n<pre><code>Prelude&gt; import GHC.Int\nPrelude GHC.Int&gt; :info Int\ndata Int = I# GHC.Prim.Int#     -- Defined in \u2018GHC.Types\u2019\n</code></pre>\n\n<p>The hash is simply a naming convention for unboxed types which have no heap representation. You'll need to enable the extension <code>-XMagicHash</code> to refer to these names though.</p>\n"}, {"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 1, "last_activity_date": 1483548596, "creation_date": 1483548596, "answer_id": 41469159, "question_id": 41450448, "link": "https://stackoverflow.com/questions/41450448/difference-between-unpack-type-in-ghc-haskell/41469159#41469159", "title": "Difference between {-# UNPACK #-} Type# in GHC Haskell?", "body": "<p>Maybe it's too obvious to say but the main difference is that in the first case the constructor will have type</p>\n\n<pre><code>T :: Int -&gt; T\n</code></pre>\n\n<p>and in the second case</p>\n\n<pre><code>T :: Int# -&gt; T\n</code></pre>\n\n<p>In terms of the runtime representation, there will be no difference (except that I think <code>UNPACK</code> is ignored if optimizations are disabled). So in the case of <code>T {-# UNPACK #-} !Int</code>, for example, pattern matching <code>case t of T n -&gt; ...</code> has to create a new <code>I#</code> box for <code>n</code> (which hopefully will cancel with another <code>case</code> nearby).</p>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 280, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1483548596, "creation_date": 1483469681, "last_edit_date": 1483472035, "question_id": 41450448, "link": "https://stackoverflow.com/questions/41450448/difference-between-unpack-type-in-ghc-haskell", "title": "Difference between {-# UNPACK #-} Type# in GHC Haskell?", "body": "<p>In GHC, what is the difference between the <code>{-# UNPACK #-}</code> pragma and the <code>#</code> type suffix operator?</p>\n\n<p>For example, what is the difference between:</p>\n\n<pre><code>data T = T {-# UNPACK #-} Int\n</code></pre>\n\n<p>and</p>\n\n<pre><code>data T = T Int#\n</code></pre>\n"}, {"tags": ["haskell", "ghc"], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 6, "last_activity_date": 1483464845, "creation_date": 1483464845, "answer_id": 41449170, "question_id": 41448940, "link": "https://stackoverflow.com/questions/41448940/foreign-types-vs-unboxed-types-in-haskell/41449170#41449170", "title": "Foreign Types vs. Unboxed Types in Haskell", "body": "<p>I don't think there such a thing as <code>CInt#</code>.</p>\n\n<ul>\n<li><code>CInt</code> is just a custom type which is guaranteed to play well with <code>C</code> (see <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Foreign-C-Types.html\" rel=\"noreferrer\">the blurb at the top of this page</a> for a more formal take on that). It is boxed, so you take a performance hit for that.</li>\n<li><code>Int#</code> is a \"magic\" unboxed int. As it turns out, it <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ffi-chap.html#unboxed-types\" rel=\"noreferrer\">does play well with the FFi</a>, so use that if you want every bit of performance.</li>\n</ul>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1483465382, "creation_date": 1483464039, "last_edit_date": 1483465382, "question_id": 41448940, "link": "https://stackoverflow.com/questions/41448940/foreign-types-vs-unboxed-types-in-haskell", "title": "Foreign Types vs. Unboxed Types in Haskell", "body": "<p>What is the relation between, e.g., <code>CInt</code> vs <code>Int#</code> vs. <code>CInt#</code>?</p>\n\n<p>For example, if I call a foreign function which returns a <code>CInt</code>, isn't it already a <code>CInt#</code> by construction (i.e., it's a raw <code>int</code> on the stack, not a pointer to something on the heap which contains an <code>int</code>)? </p>\n\n<p>And in that case, what would be the difference between <code>CInt</code> and <code>Int#</code>?</p>\n\n<p>If I'm trying to eke out every bit of performance that I can, which one to use out of <code>CInt</code> and <code>Int#</code> and <code>CInt#</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1483462883, "post_id": 41448562, "comment_id": 70103590, "body": "By your type signature, <code>tails&#39; xs</code> must already be a list of lists. Enclosing it in brackets as <code>[[tails&#39; xs]]</code> wraps that list of lists in two extra singleton lists. All you need is <code>tails&#39; (x:xs) = xs:tails&#39; xs</code>."}, {"owner": {"reputation": 10256, "user_id": 1139023, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/7e720df07b8a3ef623cf6a7587f21ab8?s=128&d=identicon&r=PG", "display_name": "Ashwin", "link": "https://stackoverflow.com/users/1139023/ashwin"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1483497058, "post_id": 41448562, "comment_id": 70117020, "body": "@Alec : You are right. It works. But I still don&#39;t get it why the brackets should be removed (aside from the fact that it makes the program work:)). Isn&#39;t it the job of the programmer to ensure that the returned value matches the one in type signature?? Because the way you are putting : type signature takes care of converting it into a list of lists"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1521232643, "post_id": 41448562, "comment_id": 85660187, "body": "(1) Closely related: <a href=\"https://stackoverflow.com/q/48884276/2751851\"><i>Why doesn&#39;t this function work if I use \u201c&#91;xs&#93;\u201d instead of \u201cxs\u201d?</i></a> (2) While the answer you have accepted covers your immediate issue, its solution is wrong -- for instance, <code>tails [] = [[]]</code> and <code>head (tails xs) = xs</code> are supposed to hold. I recommend switching the accept mark to another answer."}], "answers": [{"comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1483463993, "post_id": 41448703, "comment_id": 70104252, "body": "You don&#39;t even need the parens: <code>xs : tails&#39; xs</code> works fine."}, {"owner": {"reputation": 10256, "user_id": 1139023, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/7e720df07b8a3ef623cf6a7587f21ab8?s=128&d=identicon&r=PG", "display_name": "Ashwin", "link": "https://stackoverflow.com/users/1139023/ashwin"}, "edited": false, "score": 0, "creation_date": 1483496857, "post_id": 41448703, "comment_id": 70116974, "body": "@Leandro Galvan : Can you please explain why you removed the brackets?"}, {"owner": {"reputation": 302, "user_id": 4858356, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/058bc.jpg?s=128&g=1", "display_name": "Leandro Galvan", "link": "https://stackoverflow.com/users/4858356/leandro-galvan"}, "reply_to_user": {"reputation": 10256, "user_id": 1139023, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/7e720df07b8a3ef623cf6a7587f21ab8?s=128&d=identicon&r=PG", "display_name": "Ashwin", "link": "https://stackoverflow.com/users/1139023/ashwin"}, "edited": false, "score": 1, "creation_date": 1483535734, "post_id": 41448703, "comment_id": 70134989, "body": "@Ashwin the term <code>tails&#39; xs</code> without the brackets is already a list of lists, i.e., of type <code>[[a]]</code>. It&#39;s a little confusing because the function is recursive, but if you look at the type you declared, it reads <b>tails&#39; takes a list and returns a list of lists</b>; since <code>xs</code> is a list, applying it to <code>tails&#39;</code> yields a list of lists."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 2, "creation_date": 1521240467, "post_id": 41448703, "comment_id": 85663067, "body": "another quibble - to be the same as <code>Data.List.tails</code>, <code>head (tails xs) == xs</code>"}], "tags": [], "owner": {"reputation": 302, "user_id": 4858356, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/058bc.jpg?s=128&g=1", "display_name": "Leandro Galvan", "link": "https://stackoverflow.com/users/4858356/leandro-galvan"}, "is_accepted": true, "score": 6, "last_activity_date": 1483470433, "last_edit_date": 1483470433, "creation_date": 1483463183, "answer_id": 41448703, "question_id": 41448562, "link": "https://stackoverflow.com/questions/41448562/implementing-the-tails-function-in-haskell/41448703#41448703", "title": "Implementing the tails function in Haskell", "body": "<p>Replace</p>\n\n<pre><code>tails' (x:xs) = xs:[[tails' xs]]\n</code></pre>\n\n<p>with:</p>\n\n<pre><code>tails' (x:xs) = xs : tails' xs\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1483468505, "post_id": 41448891, "comment_id": 70106711, "body": "Even your implementation is not to-spec. Compare the result of <code>null (tails undefined)</code> between your implementation and <code>Data.List</code>&#39;s."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1483493086, "post_id": 41448891, "comment_id": 70116117, "body": "@DanielWagner I see how the implementation in Data.List manages to return <code>False</code> for that input, but why is it a useful property that <code>tails undefined = undefined : tails (tail undefined)</code>?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1483496622, "post_id": 41448891, "comment_id": 70116924, "body": "@amalloy Let me turn the question around on you: why is it useful to be more strict than necessary?"}], "tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 5, "last_activity_date": 1483464512, "last_edit_date": 1483464512, "creation_date": 1483463849, "answer_id": 41448891, "question_id": 41448562, "link": "https://stackoverflow.com/questions/41448562/implementing-the-tails-function-in-haskell/41448891#41448891", "title": "Implementing the tails function in Haskell", "body": "<p>Aside from the <s>syntax</s> type error, your implementation is not correct (to the spec).  Compare it with this one...</p>\n\n<pre><code>Prelude&gt; let tails [] = [[]]\nPrelude|     tails y@(x:xs) = y:(tails xs)\nPrelude|\nPrelude&gt; tails \"abc\"\n[\"abc\",\"bc\",\"c\",\"\"]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1521232213, "post_id": 49328053, "comment_id": 85660015, "body": "While this is a good answer, I&#39;m not sure that &quot;no correct answers [had been] given&quot;. The solution you arrive at is essentially the same as <a href=\"https://stackoverflow.com/a/41448891/2751851\">the one by karafka</a>, down to the detail about strictness mentioned by Daniel Wagner."}], "tags": [], "owner": {"reputation": 2862, "user_id": 1343488, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c3ee657e2498d831dd1cd055b11f0620?s=128&d=identicon&r=PG&f=1", "display_name": "zhirzh", "link": "https://stackoverflow.com/users/1343488/zhirzh"}, "is_accepted": false, "score": 1, "last_activity_date": 1521227930, "creation_date": 1521227930, "answer_id": 49328053, "question_id": 41448562, "link": "https://stackoverflow.com/questions/41448562/implementing-the-tails-function-in-haskell/49328053#49328053", "title": "Implementing the tails function in Haskell", "body": "<p>It's been over a year now but no correct answers were given so here's my take on it.</p>\n\n<p>Let's start with the type signature:</p>\n\n<pre><code>tails' :: [a] -&gt; [[a]]\n</code></pre>\n\n<p>This sugests that <code>tails'</code> should return a list-of-lists. The terminal case you syggested is just an empty list. Change it to:</p>\n\n<pre><code>tails' [] = [[]]\n</code></pre>\n\n<p>Now, the general case. Let's <em>assume</em> that our <code>tails'</code> works the way we want it to:</p>\n\n<pre><code>tails' []      -&gt; [[]]\ntails' [1]     -&gt; [[1], []]\ntails' [2,1]   -&gt; [[2,1], [1], []]\ntails' [3,2,1] -&gt; [[3,2,1], [2,1], [1], []]\n</code></pre>\n\n<p>As we can see, we want to include the original list and the empty list. This means that given an input list <code>xs</code>, we want to concatenate <code>xs</code> onto <em>something else</em>.</p>\n\n<p>But what's that <em>something else</em>? Let's do a bit of pseudo-haskell math:</p>\n\n<pre><code>let A = tails' [3,2,1] = [[3,2,1], [2,1], [1], []]\nlet B = tails' [2,1] = [[2,1], [1], []]\n=&gt; A = [[3,2,1], B] -- (1)\n\ntail [3,2,1] == [2,1]\n=&gt; B = tails' (tail [3,2,1]) -- (2)\n\nBy (1) and (2)\nA = [[3,2,1], tails' (tail [3,2,1])]\n=&gt; tails' [3,2,1] = [[3,2,1], tails' (tail [3,2,1])] -- (3)\n\nBy replacing [3,2,1] in (3) with xs\ntails' xs = [xs, tails' (tail xs)]\n</code></pre>\n\n<p>Translating all this into Haskell gives us:</p>\n\n<pre><code>tails' :: [a] -&gt; [[a]]\ntails' [] = [[]]\ntails' xs = xs : (tails' $ tail xs)\n\n\nmain = do\n  print $ tails' [1,2,3]\n\n-- [[1,2,3],[2,3],[3],[]]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1522037010, "post_id": 49381221, "comment_id": 85970343, "body": "&quot;With [<code>LambdaCase</code>], however, you cannot specify the type signature of the alg function&quot; -- I tried that over here and it worked fine (I kept the <code>alg</code> definition in the <code>where</code> clause, though)."}], "tags": [], "owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "is_accepted": false, "score": 1, "last_activity_date": 1521540134, "creation_date": 1521540134, "answer_id": 49381221, "question_id": 41448562, "link": "https://stackoverflow.com/questions/41448562/implementing-the-tails-function-in-haskell/49381221#49381221", "title": "Implementing the tails function in Haskell", "body": "<p><code>tails</code> is the canonical example with simple lists for the recursion scheme called <em>paramorphism</em>. The following example uses the <a href=\"http://hackage.haskell.org/package/recursion-schemes\" rel=\"nofollow noreferrer\">recursion-schemes</a> library from Edward Kmett:</p>\n\n<pre><code>import Data.Functor.Foldable\nimport Data.List (tails)                      -- just for our test\n\nparatails :: [a] -&gt;  [[a]]\nparatails = para alg where\n    alg :: ListF a ([a], [[a]]) -&gt; [[a]]\n    alg (Cons x (hs, res)) = (x : hs) : res\n    alg Nil = [[]]\n\n-- $\n-- &gt;&gt;&gt; paratails [1,2,3,4]\n-- [[1,2,3,4],[2,3,4],[3,4],[4],[]]\n-- &gt;&gt;&gt; paratails []\n-- [[]]\n-- &gt;&gt;&gt; paratails [1,2,3,4] == (tails [1,2,3,4])\n-- True\n-- &gt;&gt;&gt; paratails [] == (tails [])\n-- True\n</code></pre>\n\n<p>Note: To shorten the code, you may use <em>LambdaCase</em>. With this extension, however, you cannot specify the type signature of the <em>alg</em> function</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 2, "last_activity_date": 1522036839, "creation_date": 1522036839, "answer_id": 49483747, "question_id": 41448562, "link": "https://stackoverflow.com/questions/41448562/implementing-the-tails-function-in-haskell/49483747#49483747", "title": "Implementing the tails function in Haskell", "body": "<p>As there now is a <em>recursion-schemes</em> fold answer, I feel obliged to add a <em>recursion-schemes</em> unfold answer:</p>\n\n<pre><code>import Data.Functor.Foldable\n\ntailsApo :: [a] -&gt; [[a]]\ntailsApo = apo coalgTails\n    where\n    coalgTails = \\case\n        [] -&gt; Cons [] (Left [])\n        li@(_:xs) -&gt; Cons li (Right xs)\n</code></pre>\n\n<p>I have used an apomorphism instead of a plain anamorphism because we don't want to produce an empty list out of an empty list (<code>tails [] == [[]]</code>).</p>\n"}], "owner": {"reputation": 10256, "user_id": 1139023, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/7e720df07b8a3ef623cf6a7587f21ab8?s=128&d=identicon&r=PG", "display_name": "Ashwin", "link": "https://stackoverflow.com/users/1139023/ashwin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4300, "favorite_count": 0, "accepted_answer_id": 41448703, "answer_count": 5, "score": 1, "last_activity_date": 1522037127, "creation_date": 1483462656, "last_edit_date": 1522037127, "question_id": 41448562, "link": "https://stackoverflow.com/questions/41448562/implementing-the-tails-function-in-haskell", "title": "Implementing the tails function in Haskell", "body": "<p>I am trying to implement the function <a href=\"https://www.haskell.org/hoogle/?hoogle=tails\" rel=\"nofollow noreferrer\"><code>tails</code></a>. This is my attempt: </p>\n\n<pre><code>tails' :: [a] -&gt; [[a]]\ntails' [] = []\ntails' (x:xs) = xs:[[tails' xs]]\n</code></pre>\n\n<p>I keep running into compilation errors:</p>\n\n<pre><code>Couldn't match expected type \u2018a\u2019 with actual type \u2018[[a]]\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n          the type signature for tails' :: [a] -&gt; [[a]] at..\n</code></pre>\n\n<p>What is wrong with my implementation?</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 1, "creation_date": 1483461339, "post_id": 41447846, "comment_id": 70102545, "body": "you might be interested in this (opinionated) post about <a href=\"https://www.schoolofhaskell.com/user/commercial/content/exceptions-best-practices\" rel=\"nofollow noreferrer\">error handling in haskell</a>"}], "answers": [{"tags": [], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "is_accepted": true, "score": 2, "last_activity_date": 1483475189, "last_edit_date": 1483475189, "creation_date": 1483474621, "answer_id": 41451638, "question_id": 41447846, "link": "https://stackoverflow.com/questions/41447846/rerun-computation-after-throwing-error/41451638#41451638", "title": "Rerun computation after throwing error", "body": "<p>The code as you have it now seems like it would be trying to catch exceptions not represented in the <code>ErrorT String</code> result. My thought is that you are actually looking to retry if <code>runErrorT</code> results in a <code>Left</code> value (an \"expected\" exception). In that case, something like this <code>retryForever</code> may work:</p>\n\n<pre><code>retryForever :: AskMonad a -&gt; IO a\nretryForever action =\n  runErrorT action &gt;&gt;= either (\\ex -&gt; putStrLn ex &gt;&gt; retryForever action) return\n</code></pre>\n\n<p>which could be used like:</p>\n\n<pre><code>direction &lt;- retryForever askSomething\n</code></pre>\n\n<p>P.S. I believe <code>ErrorT</code> was deprecated in favor of <code>ExceptT</code>, and that <code>ExceptT</code> is only more general so the transition should be trivial if you decide to switch.</p>\n"}], "owner": {"reputation": 8222, "user_id": 1833854, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b744b12985ddcf7cad8574ebdd49e33b?s=128&d=identicon&r=PG", "display_name": "JNevens", "link": "https://stackoverflow.com/users/1833854/jnevens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 41451638, "answer_count": 1, "score": 1, "last_activity_date": 1483475189, "creation_date": 1483460507, "question_id": 41447846, "link": "https://stackoverflow.com/questions/41447846/rerun-computation-after-throwing-error", "title": "Rerun computation after throwing error", "body": "<p>I would like to combine the Error Monad and the IO Monad in Haskell. Here is an excerpt from my code:</p>\n\n<pre><code>type AskMonad = ErrorT String IO\n\naskSomething :: AskMonad Direction\naskSomething = do\n  liftIO $ putStrLn \"Choose an element from the list [1,2,3,4]\"\n  input &lt;- liftIO getLine\n  let entry = read input :: Int\n  if entry `elem` [1,2,3,4]\n  then return $ toEnum entry -- from Int to Direction\n  else throwError \"Invalid input!\"\n\nselectMove :: [Player] -&gt; Board -&gt; IO (Direction, Position)\nselectMove players board = do\n  direction &lt;- runErrorT (askSomething) `catchError` --What to put here???\n  -- Other IO stuff...\n</code></pre>\n\n<p>I would like to achieve the following behavior:</p>\n\n<ul>\n<li>if <code>askSomething</code> succeeds, get the <code>Direction</code>.</li>\n<li>if <code>askSomething</code> fails, <code>show</code> the error and run <code>askSomething</code> again.</li>\n</ul>\n\n<p>However, I don't know what to put as the second argument of <code>catchError</code> in order to get this behavior. I think it should be of the following type signature: <code>Either String Direction -&gt; AskMonad Direction</code>, but how can I access the computation that needs to be rerun (<code>askSomething</code> in this case).</p>\n"}, {"tags": ["haskell", "template-haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1483440928, "post_id": 41441765, "comment_id": 70089722, "body": "Why do you think the AST doesn&#39;t directly go to GHC? That would honestly surprise me."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1483467890, "post_id": 41441765, "comment_id": 70106338, "body": "The title doesn&#39;t seem to match the question. I assumed you were looking for <code>-ddump-splices</code>"}, {"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1483538947, "post_id": 41441765, "comment_id": 70137062, "body": "@jberryman I agree. Please suggest a better one."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1483543261, "post_id": 41441765, "comment_id": 70140054, "body": "&quot;Parsing haskell code strings in a template haskell splice&quot;? I may not be sure all what you&#39;re asking though"}], "answers": [{"comments": [{"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "edited": false, "score": 0, "creation_date": 1483444081, "post_id": 41442034, "comment_id": 70091563, "body": "Hmm, this is almost good enough but it still doesn&#39;t help with stuff like TH inexplicably not supporting visible type applications while <code>haskell-src-exts</code> does. Not to mention comments/docs."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1483461252, "post_id": 41442034, "comment_id": 70102491, "body": "Regarding <a href=\"http://stackoverflow.com/a/40985623/3072788\">why Template Haskell doesn&#39;t expose a parser for the quoters</a>."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1483463833, "post_id": 41442034, "comment_id": 70104151, "body": "@Alec So presumably <a href=\"https://ghc.haskell.org/trac/ghc/wiki/NativeMetaprogramming\" rel=\"nofollow noreferrer\">the proposal for native metaprogramming</a> would make that a lot easier?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1483464380, "post_id": 41442034, "comment_id": 70104473, "body": "@AlexisKing I think that proposal is largely <i>motivated</i> by this very problem, so yes: it would make this a lot easier. Thanks for the link!"}], "tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": true, "score": 6, "last_activity_date": 1483441408, "creation_date": 1483441408, "answer_id": 41442034, "question_id": 41441765, "link": "https://stackoverflow.com/questions/41441765/is-it-possible-to-emit-raw-source-code-with-template-haskell/41442034#41442034", "title": "Is it possible to emit raw source code with Template Haskell?", "body": "<blockquote>\n  <p>I'm pretty sure the AST doesn't directly go to GHC so there's going to be a printing and then a parsing stage anyways.</p>\n</blockquote>\n\n<p>Why would you think that? That isn\u2019t the case, the TH AST is converted to GHC\u2019s internal AST directly; it never gets converted back to text at any point in that process. (If it did, that would be pretty strange.)</p>\n\n<p>Still, it would be somewhat nice if Template Haskell exposed a way to parse Haskell source to expressions, types, and declarations, basically exposing the parsers behind various <code>e</code>, <code>t</code>, and <code>d</code> quoters that are built in to Template Haskell. Unfortunately, it does not, and I don\u2019t believe there are currently any plans to change that.</p>\n\n<p>Currently, you need to go through <code>haskell-src-exts</code> instead. This is somewhat less than ideal, since there <em>are</em> differences between <code>haskell-src-exts</code>\u2019s parser and GHCs, but it\u2019s as good as you\u2019re currently going to get. To lessen the pain, there is <a href=\"https://hackage.haskell.org/package/haskell-src-meta\" rel=\"noreferrer\">a package called <code>haskell-src-meta</code></a> that bridges <code>haskell-src-exts</code> and <code>template-haskell</code>.</p>\n\n<p>For your use case, you can use the <code>parseDecs</code> function from <a href=\"https://hackage.haskell.org/package/haskell-src-meta-0.7.0/docs/Language-Haskell-Meta-Parse.html\" rel=\"noreferrer\"><code>Language.Haskell.Meta.Parse</code></a>, which has the type <code>String -&gt; Either String [Dec]</code>, which is what you\u2019re looking for.</p>\n"}], "owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 1, "accepted_answer_id": 41442034, "answer_count": 1, "score": 1, "last_activity_date": 1483441408, "creation_date": 1483440520, "question_id": 41441765, "link": "https://stackoverflow.com/questions/41441765/is-it-possible-to-emit-raw-source-code-with-template-haskell", "title": "Is it possible to emit raw source code with Template Haskell?", "body": "<p>Say I have a <code>String</code> (or <code>Text</code> or whatever) containing valid Haskell code. Is there a way to convert it into a <code>[Dec]</code> with Template Haskell?</p>\n\n<p>I'm pretty sure the AST doesn't directly go to GHC so there's going to be a printing and then a parsing stage anyways.</p>\n\n<p>This would be great to have since it would allow different \"backends\" for TH. For example you could use the AST from <code>haskell-src-exts</code> which supports more Haskell syntax than TH does.</p>\n"}, {"tags": ["string", "haskell", "unicode", "ghc"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 3, "creation_date": 1483440152, "post_id": 41438441, "comment_id": 70089248, "body": "What&#39;s the error message?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1483442632, "post_id": 41438441, "comment_id": 70090784, "body": "In general GHC needs to know the Unicode character categories of characters in its input (to decide what is a normal identifier vs. an operator, etc.), so I&#39;d guess the answer is whatever characters are defined in the Unicode database when GHC was built. It looks like GHC only allows printable characters in string literals, and it doesn&#39;t know whether your made-up characters are printable."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1483445776, "post_id": 41438441, "comment_id": 70092617, "body": "What is the platform? What is the encoding of the input file?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1483446037, "post_id": 41438441, "comment_id": 70092788, "body": "@ReidBarton I thought Unicode was specifically designed to prevent this issue. I mean, one should be able to decode, say, utf8 into Unicode codepoints without caring about what those are. Between quotes, and with the usual escaping rules, I believe GHC should not care about what category the codepoints belong to. If it does error on valid unicode between quotes, that looks as a bug to me."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1483446687, "post_id": 41438441, "comment_id": 70093199, "body": "I think GHC is actually rather more permissive than what the Report says it should accept in string literals. (The lexical syntax bottoms out in things like &quot;any Unicode lowercase letter&quot;, &quot;any Unicode symbol or punctuation&quot;, etc. Never &quot;any Unicode character&quot;.)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1483454297, "post_id": 41438441, "comment_id": 70097961, "body": "Weird, I can&#39;t even <i>copy those strings to my terminal</i>! (xfce4-terminal 0.6.3) In IHaskell I get the same error as mb21 below."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1483461544, "post_id": 41438441, "comment_id": 70102665, "body": "@leftaroundabout I thought the same thing, but it turned out I just can&#39;t copy them to GHCi... Using iTerm on macOS."}], "answers": [{"comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1483455775, "post_id": 41445867, "comment_id": 70098949, "body": "I think it comes from here <a href=\"https://github.com/ghc/ghc/blob/master/compiler/parser/Lexer.x#L1495\" rel=\"nofollow noreferrer\">github.com/ghc/ghc/blob/master/compiler/parser/Lexer.x#L1495</a> -- <code>isAny</code> checks whether the character is printable."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1483461980, "post_id": 41445867, "comment_id": 70102957, "body": "@ReidBarton Am I reading <a href=\"https://github.com/ghc/ghc/blob/876b00ba25a615423f48b0cf9d443a9fd5dbd6f4/libraries/base/cbits/WCsubst.c\" rel=\"nofollow noreferrer\">this</a> right? Does GHC have an array of all the characters it supports!?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1483463111, "post_id": 41445867, "comment_id": 70103711, "body": "@Alec yes, this is how functions like <code>isPrint</code> are implemented. The table is generated automatically from files from the Unicode standard."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1483463759, "post_id": 41445867, "comment_id": 70104109, "body": "@ReidBarton. Thanks a lot!"}], "tags": [], "owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "is_accepted": true, "score": 10, "last_activity_date": 1483455282, "last_edit_date": 1483455282, "creation_date": 1483454076, "answer_id": 41445867, "question_id": 41438441, "link": "https://stackoverflow.com/questions/41438441/range-of-unicode-characters-ghc-accepts/41445867#41445867", "title": "Range of unicode characters GHC accepts", "body": "<p>Saving <code>main = putStrLn \"\ud83e\udd53  \ud83e\udd50  \ud83e\udd52  \ud83e\udd54\"</code> as UTF-8 and running it with <code>ghc 8.0.1</code> on macOS, I got:</p>\n\n<pre><code>lexical error in string/character literal at character '\\129365'\n</code></pre>\n\n<p>I found this related (but closed) <a href=\"https://ghc.haskell.org/trac/ghc/ticket/5518\" rel=\"noreferrer\">ghc bug report</a>:</p>\n\n<blockquote>\n  <p>The cause (for both problems) was that older versions of GHC support a older version of Unicode:</p>\n\n<pre><code>$ ghc-7.0.3 -e \"Data.Char.generalCategory '\\8342'\"\nNotAssigned\n</code></pre>\n</blockquote>\n\n<p>So the problem seems to be that the version of ghc we're using doesn't support the newer emojis yet \u2013 it thinks the unicode code point is unassigned and errors out even though it's assigned to the emoji in newer versions of unicode.</p>\n\n<p>A related <a href=\"https://ghc.haskell.org/trac/ghc/ticket/8524\" rel=\"noreferrer\">open ghc bug ticket</a> which mostly discusses which whitespace chars are allowed though.</p>\n\n<p>Finally, the <a href=\"https://github.com/ghc/ghc/blob/master/compiler/parser/Lexer.x#L1685\" rel=\"noreferrer\"><code>lit_error</code> function in <code>Lexer.x</code></a> seems to be where the error is surfaced. There are multiple functions in that file that call that error though, so not sure where it's coming from exactly...</p>\n"}], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 375, "favorite_count": 1, "accepted_answer_id": 41445867, "answer_count": 1, "score": 15, "last_activity_date": 1483455282, "creation_date": 1483428412, "question_id": 41438441, "link": "https://stackoverflow.com/questions/41438441/range-of-unicode-characters-ghc-accepts", "title": "Range of unicode characters GHC accepts", "body": "<p>This may sound a bit ridiculous, but GHC fails to compile my string containing bacon, a croissant, cucumber, and a potato:</p>\n\n<pre><code>main = putStrLn \"\ud83e\udd53  \ud83e\udd50  \ud83e\udd52  \ud83e\udd54\"\n</code></pre>\n\n<p>I realize I could easily write</p>\n\n<pre><code>main = putStrLn \"\\x1F953  \\x1F950  \\x1F952  \\x1F954\"\n</code></pre>\n\n<p>to the same effect, but I had always assumed GHC would accept any unicode in its source. So: <strong>what are the actual restrictions on unicode characters GHC accepts in source files</strong>?</p>\n\n<hr>\n\n<p>BTW: I realize that supporting this sort of thing is hell for the GHC lexer (actually I ran across the above problem while writing test cases for a lexer I wrote), but I still am a tad bit disappointed.</p>\n"}, {"tags": ["haskell", "currying"], "comments": [{"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1483413095, "post_id": 41434442, "comment_id": 70077657, "body": "I don&#39;t think this question has anything to do with currying; are you confusing &quot;currying&quot; with the desugaring of <code>do</code>-notation, maybe?"}, {"owner": {"reputation": 4398, "user_id": 2012715, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0a04a0851dba37de648917cf0abea9b8?s=128&d=identicon&r=PG", "display_name": "Dmitry", "link": "https://stackoverflow.com/users/2012715/dmitry"}, "reply_to_user": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1483413478, "post_id": 41434442, "comment_id": 70077735, "body": "the do notation desugars into the monadic form, this is a bit deeper in that I want to know whether it is possible to turn the desugared version into a explicit functional expression for performing such a chaining. It appears that it is impossible to bypass the need for &gt;&gt;= or &gt;&gt; but it is definitely possible to decouple the need for &gt;&gt;= and &gt;&gt; from the explicit functional version, and then evaluate that free of interpretation version independently."}, {"owner": {"reputation": 4398, "user_id": 2012715, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0a04a0851dba37de648917cf0abea9b8?s=128&d=identicon&r=PG", "display_name": "Dmitry", "link": "https://stackoverflow.com/users/2012715/dmitry"}, "reply_to_user": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1483413873, "post_id": 41434442, "comment_id": 70077816, "body": "I am still unconvinced that it is completely impossible to replace &gt;&gt; and &gt;&gt;= with some clever currying, but it seems impossible without resorting to building up a listlike object and folding over it before returning."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1483445698, "post_id": 41434442, "comment_id": 70092564, "body": "Maybe you should have a look at <a href=\"http://hackage.haskell.org/package/IOSpec\" rel=\"nofollow noreferrer\">IOSpec</a>, a pure implementation of the IO monad."}], "answers": [{"comments": [{"owner": {"reputation": 4398, "user_id": 2012715, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0a04a0851dba37de648917cf0abea9b8?s=128&d=identicon&r=PG", "display_name": "Dmitry", "link": "https://stackoverflow.com/users/2012715/dmitry"}, "edited": false, "score": 0, "creation_date": 1483400943, "post_id": 41434550, "comment_id": 70075219, "body": "I think its possible if putStrLn and IO is replaced with a free monad representing putStrLn operation. This way the result of testCurry produces a list of actions that can be mapped into IO space and reduced/folded using &gt;&gt; operator."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 4398, "user_id": 2012715, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0a04a0851dba37de648917cf0abea9b8?s=128&d=identicon&r=PG", "display_name": "Dmitry", "link": "https://stackoverflow.com/users/2012715/dmitry"}, "edited": false, "score": 0, "creation_date": 1483401592, "post_id": 41434550, "comment_id": 70075388, "body": "@Dmitry Sure, if you use a &quot;pure&quot; IO definition you can do that. But you will not get actual outputs unless you use the standard IO and something like <code>&gt;&gt;</code> to sequence effects. This can be done, as you mention, with a fold with <code>&gt;&gt;</code>."}, {"owner": {"reputation": 4398, "user_id": 2012715, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0a04a0851dba37de648917cf0abea9b8?s=128&d=identicon&r=PG", "display_name": "Dmitry", "link": "https://stackoverflow.com/users/2012715/dmitry"}, "edited": false, "score": 0, "creation_date": 1483402288, "post_id": 41434550, "comment_id": 70075537, "body": "I posted a good enough solution based on that; i don&#39;t care about side effects, I just want to know how to represent operation chaining via composition so I can then use it as a proof of concept for a similar JavaScript experiment in which I want to represent everything in terms of functions of single arguments, without any semicolons nor automatic semicolon insertion that happens even if you don&#39;t put semicolons. But this has nothing to do with side effects, but rather it has to do with &quot;operation chaining&quot;; IO monad is the only monad that lets you see what&#39;s going on in the middle-"}, {"owner": {"reputation": 4398, "user_id": 2012715, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0a04a0851dba37de648917cf0abea9b8?s=128&d=identicon&r=PG", "display_name": "Dmitry", "link": "https://stackoverflow.com/users/2012715/dmitry"}, "edited": false, "score": 0, "creation_date": 1483402598, "post_id": 41434550, "comment_id": 70075616, "body": "The only other way to inspect whats going on in the middle of a monad(IO monad cheats by having side effects) is to create a freeish monad(not necessarily a full blown Free Monad\u2122) and then map sequences of such objects to the second order functions representing the real functions, and then reduce these functions."}, {"owner": {"reputation": 4398, "user_id": 2012715, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0a04a0851dba37de648917cf0abea9b8?s=128&d=identicon&r=PG", "display_name": "Dmitry", "link": "https://stackoverflow.com/users/2012715/dmitry"}, "edited": false, "score": 0, "creation_date": 1483414763, "post_id": 41434550, "comment_id": 70078012, "body": "I was curious about keeping it in IO but never using &gt;&gt;= nor &gt;&gt; but instead cleverly currying the actions around. But I am convinced that even though IO () is empty, it works by folding over the implicit sequence of actions before returning, collapsing them into a unit tuple. So I can&#39;t just throw away each next expression without silencing them. In all cases, I must either snowball the expressions and reduce over them otherwise only one statement gets evaluated."}, {"owner": {"reputation": 4398, "user_id": 2012715, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0a04a0851dba37de648917cf0abea9b8?s=128&d=identicon&r=PG", "display_name": "Dmitry", "link": "https://stackoverflow.com/users/2012715/dmitry"}, "edited": false, "score": 0, "creation_date": 1483415925, "post_id": 41434550, "comment_id": 70078268, "body": "I think the closest I can get to is <code>test = foldl (\\a -&gt; \\b -&gt; a &gt;&gt; b) (return ()) ([putStrLn &quot;hello&quot;] ++ [putStrLn &quot;world&quot;])</code> but theres no way to collapse 2 IO actions into a single io action without &gt;&gt; or &gt;&gt;=, even unsafePerformIO doesnt work since the compiler knows that the second argument is just going to get ignored so it never reaches to the unsafePerformIO statement.  eg <code>test = foldl (\\a -&gt; \\b -&gt; (const b) (Unsafe.unsafePerformIO a))(return ()) ([putStrLn &quot;hello&quot;] ++ [putStrLn &quot;world&quot;])</code>  only shows the last statement which is world."}, {"owner": {"reputation": 4398, "user_id": 2012715, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0a04a0851dba37de648917cf0abea9b8?s=128&d=identicon&r=PG", "display_name": "Dmitry", "link": "https://stackoverflow.com/users/2012715/dmitry"}, "edited": false, "score": 0, "creation_date": 1483416183, "post_id": 41434550, "comment_id": 70078335, "body": "Basically in haskell, even unsafePerformIO is lazy, and the only way to chain a and b monads together without ending up not evaluating them is to use <code>&gt;&gt;</code> or <code>&gt;&gt;=</code> both of which perform evaluation and compose a new object, or in IO case, only perform evaluation and create an empty tuple, but it evaluates in a way that even unsafePerformIO seems to not be able to(<code>(\\_ -&gt; putStrLn &quot;hello&quot;) (unsafePerformIO (putStrLn &quot;world&quot;))</code> will only print hello, the argument is thrown out together with unsafePerformIO even if it was given a name.)"}, {"owner": {"reputation": 4398, "user_id": 2012715, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0a04a0851dba37de648917cf0abea9b8?s=128&d=identicon&r=PG", "display_name": "Dmitry", "link": "https://stackoverflow.com/users/2012715/dmitry"}, "edited": false, "score": 0, "creation_date": 1483416994, "post_id": 41434550, "comment_id": 70078536, "body": "actually it doesn&#39;t even work if I do <code>(\\a -&gt; (return a) &gt;&gt; putStrLn &quot;hi&quot;) (unsafePerformIO (putStrLn &quot;something&quot;))</code>. I imagine it sees that the argument is of type empty tuple and treats it as return () without evaluating it. Even if i try being clever with function calls it doesnt work O.o. <code>(\\f -&gt; (return (f &quot;hello&quot;)))(\\a -&gt; unsafePerformIO (putStrLn a))</code> Im confused."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1483445690, "post_id": 41434550, "comment_id": 70092560, "body": "Correct analysis. As I already alluded, <code>unsafePerformIO</code> is not relevant at all here. Indeed that function is <i>not</i> part of Haskell but of the <i>foreign function interface</i>, namely for calling C functions (and possibly memory allocations etc. around them); those could after all have side-effects and thus not correspond to Haskell functions. The sole purpose of <code>unsafePerformIO</code> is to <i>retrieve the results of such functions</i> without a monadic bind, under the assumption that there is no observable side-effect. But if you use that for actions which do have side-effects, the result is undefined."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1483445957, "post_id": 41434550, "comment_id": 70092730, "body": "That said: you <i>can</i> in fact trick GHC into sequencing the side-effects of \u201cpure\u201d values, by <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:seq\" rel=\"nofollow noreferrer\">forcing evaluation</a>: <code>(\\a -&gt; a `seq` putStrLn &quot;hello&quot;) (unsafePerformIO (putStrLn &quot;world&quot;))</code> prints first \u201cworld\u201d, then \u201chello\u201d. Incidentally, you don&#39;t need any of those lambdas to achieve that, <code>unsafePerformIO (putStrLn &quot;world&quot;) `seq` putStrLn &quot;hello&quot;</code> does the same thing. But by no means rely on that kind of behaviour: the compiler may actually optimise this in a way that completely screws up the order etc.!"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1483446769, "post_id": 41434550, "comment_id": 70093256, "body": "Nevertheless, if your question is really whether you specifically need the <code>Monad</code> class to sequence actions in general then the answer is <i>no</i>. That&#39;s just very much the natural interface for doing it, but you could also have a type without such an instance which nevertheless describes a sequence of side-effectful actions. I&#39;ll expand my answer..."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1483448101, "last_edit_date": 1483448101, "creation_date": 1483399976, "answer_id": 41434550, "question_id": 41434442, "link": "https://stackoverflow.com/questions/41434442/how-can-i-get-this-currying-experiment-to-behave-as-expected/41434550#41434550", "title": "How can I get this currying experiment to behave as expected?", "body": "<blockquote>\n  <p>But I don't know how to simulate the <code>&gt;&gt;</code> (then) behavior only using functions.</p>\n</blockquote>\n\n<p>Well, you can't! <code>&gt;&gt;</code> is (in this case) about ordering side-effects. A Haskell function can never have a side effect<sup>\u2020</sup>. Side effects can only happen in monadic actions, and can be thus ordered by monadic combinators including <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Monad-Instances.html#v:-62--62-\" rel=\"nofollow noreferrer\"><code>&gt;&gt;</code></a>, but without a <code>Monad</code><sup>\u2021</sup> constraint the notion of \u201cdo this and also that\u201d simply doesn't make any sense in Haskell. A Haskell function is not <em>executed</em>, it's merely a mathematical transformation whose result you may <em>evaluate</em>. That result may itself be an actual <em>action</em> with type e.g. <code>IO ()</code>, and such an <em>action</em> can be executed and/or monadically chained with other actions. But this is actually somewhat orthogonal to the evaluation of the function that yielded this action.</p>\n\n<p>So that's the answer: \u201cHow can I get this currying experiment to behave as expected?\u201d You can't, you need to use one of the monadic combinators instead (or <code>do</code> notation, which is just syntactic sugar for the same).</p>\n\n<hr>\n\n<p>To also tackle this question from a bit of a different angle: you do <em>not</em> \u201cneed monads\u201d to express sequencing of side effects. I might for instance define a type that \u201cspecifies side-effects\u201d by generating e.g. Python code which when executed has these effects:</p>\n\n<pre><code>newtype Effect = Effect { pythons :: [String] }\n</code></pre>\n\n<p>Here, you could then sequence effects by simply concatenating the instruction lists. Again though, this sequencing would not be accomplished by any kind of currying exercise but by boring list concatenation. The preferable interface for this is the <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Monoid.html\" rel=\"nofollow noreferrer\">monoid class</a>:</p>\n\n<pre><code>import Data.Monoid\ninstance Monoid Effect where\n  mempty = Effect []\n  mappend (Effect e\u2080) (Effect e\u2081) = Effect $ e\u2080 ++ e\u2081\n</code></pre>\n\n<p>And then you could simply do:</p>\n\n<pre><code>hello :: Effect\nhello = Effect [\"print('hello')\"] &lt;&gt; Effect [\"print('world')\"]\n</code></pre>\n\n<p>(<code>&lt;&gt;</code> is just a shorthand synonym for <code>mappend</code>. You could as well define a custom operator, say <code>#</code> instead to chain those actions, but if there's a standard class that supports some operation it's usually a good idea to employ that!)</p>\n\n<p>Ok, perfectly fine sequencing, no monadic operators required.</p>\n\n<p>But very clearly, just <em>evaluating</em> <code>hello</code> would not cause anything to be printed: it would merely give you some other source code. You'd actually need to feed these instructions to a Python interpreter to accomplish the side-effects.<br>And in principle that's no different with the <code>IO</code> type: evaluating an <code>IO</code> action also never causes any side-effects, only linking it to main (or to the GHCi repl) does. How many lambdas you wrap the subexpressions in is completely irrelevant for this, because side-effect occurance has <em>nothing</em> to do with whether a function gets called anywhere! It only has to do with how the actions get linked to an actual \u201cexecutor\u201d, be that a Python interpreter or Haskell's own <code>main</code>.</p>\n\n<p>If you now wonder why it has to be those whacky monads if the simpler <code>Monoid</code> also does the trick... the problem with <code>Effect</code> is that it has no such thing as a return value. You can perfectly well generate \u201cpure output\u201d actions this way that simply execute a predetermined Python program, but you can never <em>get back</em> any values from Python this way to use within Haskell to decide what should happen next. This is what monads allow you to do.</p>\n\n<p><hr>\n<sup>\u2020</sup><sub>Yes, <em>never</em>. Haskell <em>does <strong>not</strong> include</em> something called <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/System-IO-Unsafe.html#v:unsafePerformIO\" rel=\"nofollow noreferrer\"><code>unsafePerformIO</code></a>. Anybody who claims otherwise in the comments shall <a href=\"http://hackage.haskell.org/package/acme-missiles-0.3/docs/Acme-Missiles.html#v:launchMissiles\" rel=\"nofollow noreferrer\">suffer nuclear retaliation</a>.</sub></p>\n\n<p><sup>\u2021</sup><sub>To be precise, <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Applicative.html#v:-42--62-\" rel=\"nofollow noreferrer\">the weaker <code>Applicative</code> is sufficient</a>.</sub></p>\n"}], "owner": {"reputation": 4398, "user_id": 2012715, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0a04a0851dba37de648917cf0abea9b8?s=128&d=identicon&r=PG", "display_name": "Dmitry", "link": "https://stackoverflow.com/users/2012715/dmitry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1483448101, "creation_date": 1483399207, "last_edit_date": 1483411229, "question_id": 41434442, "link": "https://stackoverflow.com/questions/41434442/how-can-i-get-this-currying-experiment-to-behave-as-expected", "title": "How can I get this currying experiment to behave as expected?", "body": "<p>I am writing a currying experiment to get a feel for how multiple statements in haskell are chained together to work one after another.</p>\n\n<p>Here is what I got so far</p>\n\n<pre><code>testCurry :: IO ()\ntestCurry =     \n    (\\b -&gt;\n        (\\_ -&gt; putStrLn b)\n        ((\\a -&gt; \n            putStrLn a\n        ) (show 2))\n    ) (show 3)\n\ntestCurryExpected :: IO ()\ntestCurryExpected = do {\n    a &lt;- return (show 2);\n    putStrLn a;\n    b &lt;- return (show 3);\n    putStrLn b;\n}\n\nmain :: IO ()\nmain = \n    putStrLn \"expected: \" &gt;&gt;\n    testCurryExpected &gt;&gt;\n    putStrLn \"given: \" &gt;&gt;\n    testCurry\n</code></pre>\n\n<p>I know it works if I do it this way:</p>\n\n<pre><code>testCurry :: IO ()\ntestCurry =     \n    (\\b -&gt;\n        (\\next -&gt; next &gt;&gt; putStrLn b)\n        ((\\a -&gt; \n            putStrLn a\n        ) (show 2))\n    ) (show 3)\n\ntestCurryExpected :: IO ()\ntestCurryExpected = do {\n    a &lt;- return (show 2);\n    putStrLn a;\n    b &lt;- return (show 3);\n    putStrLn b;\n}\n\nmain :: IO ()\nmain = \n    putStrLn \"expected: \" &gt;&gt;\n    testCurryExpected &gt;&gt;\n    putStrLn \"given: \" &gt;&gt;\n    testCurry\n</code></pre>\n\n<p>But I don't know how to simulate the \">>\"(then) behavior only using functions.</p>\n\n<p>I know <code>a &gt;&gt; b</code> is defined in terms of <code>a &gt;&gt;= \\_ -&gt; b</code>, but I am not sure how <code>&gt;&gt;=</code> is defined in terms of <code>IO a &gt;&gt;= IO b</code> but don't know how to translate this into raw function composition.</p>\n\n<p>Can somebody please help me get this experiment to work?</p>\n\n<p>In short, I want to know if there is a way to do this without >> or >>= operators nor wrapping these operators.</p>\n\n<pre><code>(\\a -&gt; \\b -&gt; a &gt;&gt; b)(putStrLn \"one\")(putStrLn \"two\")\n</code></pre>\n\n<p>Note: For the sake of concept, I restrict myself to using anonymous functions of at most one argument.</p>\n\n<p>Edit: I found a good-enough solution by creating my own Free representation of putStrLn called Free_PutStrLn that is free of interpretation; using Lists to construct the operation chain, then evaluate it myself later.</p>\n\n<pre><code>data Free_PutStrLn = Free_PutStrLn String deriving Show\n\neval :: [Free_PutStrLn] -&gt; IO ()\neval a = \n    foldl (\\a -&gt; \\b -&gt; \n        let deconstruct (Free_PutStrLn str) = str in\n        a &gt;&gt; putStrLn (deconstruct b)\n    ) (return ()) a\n\ntestCurry :: [Free_PutStrLn]\ntestCurry = \n    (\\a -&gt;\n        [Free_PutStrLn a] ++\n        ((\\b -&gt;\n            [Free_PutStrLn b]\n        ) (show 3))\n    )(show 2)\n\nmain = \n    putStrLn (show testCurry) &gt;&gt;\n    eval (testCurry)\n</code></pre>\n\n<p>JavaScript proof of concept:</p>\n\n<pre><code>// | suspends an object within a function context.\n// | first argument is the object to suspend.\n// | second argument is the function object into which to feed the suspended\n// |     argument(first).\n// | third argument is where to feed the result of the first argument feeded into \n// |     second argument. use a =&gt; a as identity.\nconst pure = obj =&gt; fn =&gt; f =&gt; f(fn(obj));\n\n// | the experiment\npure({'console': {\n    'log': str =&gt; new function log() {\n        this.str = str;\n    }\n}})(free =&gt;\n    pure(str =&gt; () =&gt; console.log(str))\n    (putStrLn =&gt; \n        pure(\"hello\")(a =&gt; \n            [free.console.log(a)].concat (\n            pure(\"world\")(b =&gt; \n                [free.console.log(b)]\n            )(a =&gt; a))\n        )((result =&gt; \n            pure(logObj =&gt; logObj.str)\n            (deconstruct =&gt; \n                result.map(str =&gt; putStrLn(deconstruct(str)))\n            )(result =&gt;\n                result.forEach(f =&gt; f())\n            )        \n        )\n    )\n    )(a =&gt; a)\n)(a =&gt; a)\n</code></pre>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 2, "creation_date": 1483392525, "post_id": 41433445, "comment_id": 70072881, "body": "I think the only way to do this would be to use Template Haskell to do the validation via compile-time splice."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1483410461, "post_id": 41433445, "comment_id": 70077145, "body": "For something heavy weight, you could try to use liquid-haskell&#39;s totality checker.  At the very least it would be fun."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1483446192, "post_id": 41433445, "comment_id": 70092899, "body": "This would be great for <code>printf</code> and its format string, for instance."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 16, "last_activity_date": 1483393458, "creation_date": 1483393458, "answer_id": 41433663, "question_id": 41433445, "link": "https://stackoverflow.com/questions/41433445/how-can-i-get-compile-time-validation-of-literals-in-isstring-instances/41433663#41433663", "title": "How can I get compile-time validation of literals in IsString instances?", "body": "<p>It really sounds like what you want is a <a href=\"http://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#template-haskell-quasi-quotation\" rel=\"noreferrer\">quasiquoter</a> and not <code>OverloadedStrings</code>. The validation logic then goes inside the <a href=\"https://hackage.haskell.org/package/template-haskell-2.11.0.0/docs/Language-Haskell-TH.html#t:Q\" rel=\"noreferrer\"><code>Q</code></a> monad, which runs at compile time. For your simple example above:</p>\n\n<pre><code>{-# LANGUAGE QuasiQuotes, TemplateHaskell #-}\n\nmodule Name (Name(getName), name) where\n\nimport Data.Text (Text)\nimport qualified Data.Text as Text\n\nimport Language.Haskell.TH.Quote hiding (Name)\nimport Language.Haskell.TH hiding (Name)\n\n-- | A guaranteed non-empty name.\nnewtype Name = Name { getName :: Text } deriving (Eq, Show, Ord)\n\nmakeName :: String -&gt; Q Exp\nmakeName name\n  | null name = fail \"Invalid name\"\n  | otherwise = [| Name (Text.pack name) |]\n\nname :: QuasiQuoter\nname = QuasiQuoter { quoteExp = makeName }\n</code></pre>\n\n<p>Then, in another module, the following compiles:</p>\n\n<pre><code>{-# LANGUAGE QuasiQuotes #-}\nimport Name\n\nmain = print [name|valid-name|]\n</code></pre>\n\n<p>But the following doesn't, and spits out the <code>Invalid name</code> error message.</p>\n\n<pre><code>{-# LANGUAGE QuasiQuotes #-}\nimport Name\n\nmain = print [name||]\n</code></pre>\n\n<p>Note that you can get quasiquoters that work for patterns too (so something like <code>myFunc [name|valid-name|] = True</code> could be a valid function definition)!</p>\n"}], "owner": {"reputation": 945, "user_id": 463800, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1327ce755b24b956995d68accae3eab2?s=128&d=identicon&r=PG", "display_name": "jml", "link": "https://stackoverflow.com/users/463800/jml"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 328, "favorite_count": 2, "accepted_answer_id": 41433663, "answer_count": 1, "score": 11, "last_activity_date": 1487663454, "creation_date": 1483392187, "last_edit_date": 1487663454, "question_id": 41433445, "link": "https://stackoverflow.com/questions/41433445/how-can-i-get-compile-time-validation-of-literals-in-isstring-instances", "title": "How can I get compile-time validation of literals in IsString instances?", "body": "<p>I would like to be able to make <code>IsString</code> instances using the GHC <code>OverloadedStrings</code> extension such that my instance rejects some literals as being invalid and such that that rejection happens at compile time, so that programming mistakes don't make it into the code I give to my users.</p>\n\n<p>I have a couple of use cases where I have a <code>Name</code> type that only admits certain strings. e.g.</p>\n\n<pre><code>module Name (Name(getName), makeName) where\n\nimport Data.Text (Text)\nimport qualified Data.Text as Text\n\n-- | A guaranteed non-empty name.\nnewtype Name = Name { getName :: Text } deriving (Eq, Show, Ord)\n\nmakeName :: Text -&gt; Maybe Name\nmakeName name\n  | Text.null name = Nothing\n  | otherwise = Just name\n</code></pre>\n\n<p>In a real use case, I'd check for valid characters, not starting with a digit, that sort of thing.</p>\n\n<p>The idea is that we don't export the <code>Name</code> constructor, which means anyone using a <code>Name</code> value can trust that it has certain properties (in this case, non-empty).</p>\n\n<p>My problem is that I'd like to use literal names in many places. e.g.</p>\n\n<pre><code>programName :: Name\nprogramName = fromJust $ makeName \"the-great-and-powerful-turtle\"\n</code></pre>\n\n<p>Because I do this a lot, I've defined an <code>unsafeMakeName</code> helper that does pretty much the same thing:</p>\n\n<pre><code>unsafeMakeName :: Text -&gt; Name\nunsafeMakeName name = fromMaybe (error $ \"Invalid name: \" &lt;&gt; Text.unpack name) (makeName name)\n</code></pre>\n\n<p>The problem with this approach is that even though the cause of the mistake is a programming error, I don't find out about it until run time.</p>\n\n<p>What I'd like to do is write an <code>IsString</code> instance for <code>Name</code> which does that validation, e.g.</p>\n\n<pre><code>instance IsString Name where\n  fromString = unsafeMakeName . Text.pack\n</code></pre>\n\n<p>... but to get the error about invalid names in literals at compile-time. </p>\n\n<p>When I try this, I only seem to get the errors at run-time, when the literal value is used. This is less than ideal, since it's an error in my actual code.</p>\n\n<p>Is there any way I can do this? Is this something that could be remedied in GHC? Note that I've already <a href=\"https://ghc.haskell.org/trac/ghc/ticket/13028\">filed a bug</a> there.</p>\n"}, {"tags": ["haskell", "pattern-matching", "higher-rank-types"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1483383518, "post_id": 41431972, "comment_id": 70069705, "body": "Haskell does not support types like <code>D (forall a. (Floating a) =&gt; a)</code>, which is the type it looks like you actually want for <code>n</code> here, because that would require impredicative polymorphism. While <code>1</code> is indeed polymorphic here, <code>D 1</code> still defaults to <code>D Double</code> due to Haskell\u2019s type defaulting rules (otherwise the type would be considered ambiguous)."}], "answers": [{"tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": true, "score": 4, "last_activity_date": 1483384190, "last_edit_date": 1495540909, "creation_date": 1483384190, "answer_id": 41432127, "question_id": 41431972, "link": "https://stackoverflow.com/questions/41431972/pattern-matching-inferred-type/41432127#41432127", "title": "Pattern matching inferred type", "body": "<p>It appears that the type you are expecting for <code>n</code> is <code>D (forall a. (Floating a) =&gt; a)</code>, but that is emphatically <em>not</em> the type that is inferred. In fact, if you try and add that type annotation to <code>n</code>, you will find that GHC will loudly complain. Such a type would require GHC to support impredicative polymorphism, and it currently does not (for more information on what that is and why it is complicated, see <a href=\"https://stackoverflow.com/questions/33092864/what-is-predicativity\">What is predicativity?</a>).</p>\n\n<p>The type that is actually inferred for <code>n</code> is <code>D Double</code>. This is actually the result of two things at play: the dreaded <a href=\"https://stackoverflow.com/questions/32496864/what-is-the-monomorphism-restriction\">monomorphism restriction</a> and Haskell\u2019s type defaulting rules. Due to the monomorphism restriction, <code>n</code> must be inferred to be a monomorphic type (since it is not syntactically a function and does not have an explicit type annotation). For this reason, <code>D 1</code> would be ambiguous, since <code>1 :: forall a. (Floating a) =&gt; a</code> is polymorphic. However, in this case, Haskell has defaulting rules for numeric types, mostly to avoid the need to resolve ambiguities due to Haskell\u2019s polymorphic number literals.</p>\n\n<p>Since you have explicitly added a type annotation to <code>1</code> to make it <code>Floating</code>, then Haskell applies its default rule for floating-point types and defaults to <code>Double</code>. Therefore, the type of <code>n</code> is inferred to be <code>D Double</code>.</p>\n\n<p>If you disable the monomorphism restriction, then the type of <code>n</code> would be the slightly more interesting type <code>forall a. Floating a =&gt; D a</code>, but that is the simpler universally quantified type rather than the existentially quantified one that you want.</p>\n"}], "owner": {"reputation": 273, "user_id": 5374074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/24e06dbaa357b25b6d0946f988dc223d?s=128&d=identicon&r=PG&f=1", "display_name": "denormal", "link": "https://stackoverflow.com/users/5374074/denormal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 41432127, "answer_count": 1, "score": 2, "last_activity_date": 1483384190, "creation_date": 1483383215, "question_id": 41431972, "link": "https://stackoverflow.com/questions/41431972/pattern-matching-inferred-type", "title": "Pattern matching inferred type", "body": "<p>Why doesn't the below type-check? The type of <code>_</code> is inferred as Double.</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables, Rank2Types #-}\n\nmodule Main (main) where\n\ndata D a = D a\n\nmain =\n  let\n    n = D (1 :: forall a. (Floating a) =&gt; a)\n  in\n    case n of\n      D (_ :: forall a. (Floating a) =&gt; a) -&gt; return ()\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1483381226, "post_id": 41431568, "comment_id": 70068903, "body": "Add parens around the <code>x:xs</code> pattern, so <code>flatten (x:xs) = x ++ (flatten xs)</code>"}, {"owner": {"reputation": 473, "user_id": 2935155, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/987d5791e3b9e6c9ce5fb52f305b98ee?s=128&d=identicon&r=PG&f=1", "display_name": "Saqib Shamsi", "link": "https://stackoverflow.com/users/2935155/saqib-shamsi"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1483381363, "post_id": 41431568, "comment_id": 70068941, "body": "@Alec It worked, thanks. But how did parens make a difference?"}, {"owner": {"reputation": 473, "user_id": 2935155, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/987d5791e3b9e6c9ce5fb52f305b98ee?s=128&d=identicon&r=PG&f=1", "display_name": "Saqib Shamsi", "link": "https://stackoverflow.com/users/2935155/saqib-shamsi"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1483382080, "post_id": 41431568, "comment_id": 70069205, "body": "I got the answer here <a href=\"http://stackoverflow.com/questions/20311918/parentheses-in-the-pattern-matching-in-a-function-declaration-haskell\" title=\"parentheses in the pattern matching in a function declaration haskell\">stackoverflow.com/questions/20311918/&hellip;</a>"}], "owner": {"reputation": 473, "user_id": 2935155, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/987d5791e3b9e6c9ce5fb52f305b98ee?s=128&d=identicon&r=PG&f=1", "display_name": "Saqib Shamsi", "link": "https://stackoverflow.com/users/2935155/saqib-shamsi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 34, "favorite_count": 0, "closed_date": 1483395720, "answer_count": 0, "score": 0, "last_activity_date": 1483381157, "creation_date": 1483381157, "question_id": 41431568, "link": "https://stackoverflow.com/questions/41431568/error-while-flattening-a-list-using-pattern-matching", "closed_reason": "Duplicate", "title": "Error while flattening a list using pattern matching", "body": "<p>I was trying to come up with a function on my own that would flatten a list of lists. Below is my code</p>\n\n<pre><code>flatten :: [[t]] -&gt; [t]\nflatten [] = []\nflatten x:xs = x ++ (flatten xs)\n</code></pre>\n\n<p>When I try to compile the code above (contained in a file test.hs), I get the following error:</p>\n\n<pre><code>tests.hs:3:1: Parse error in pattern: flatten\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["haskell", "types", "type-inference", "gadt"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 4, "creation_date": 1483381544, "post_id": 41431216, "comment_id": 70069000, "body": "Any disambiguation rule would sometimes choose the \u201cwrong\u201d type; that is, it would pick a type that the user did not want. The decision was to fail fast and tell the user about the ambiguity rather than sometimes do the wrong thing, which is a decision I agree with. Failing early is usually the right thing to do, in my experience, rather than trying to figure out what was actually intended and blazing ahead with a potentially wrong choice."}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 1, "creation_date": 1483385602, "post_id": 41431216, "comment_id": 70070412, "body": "yeah, i would categorize this as ghc trying to behave according to the principle of least surprise"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1483387919, "post_id": 41431216, "comment_id": 70071303, "body": "When I try to compile this, I get an error because the return values are too specific for an inferred type of <code>Expr t1 -&gt; t</code>. That seems like a problem other than ambiguity between possible valid types."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1483388095, "post_id": 41431216, "comment_id": 70071360, "body": "It should compile if you add any of the types above."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1483388128, "post_id": 41431216, "comment_id": 70071368, "body": "@DamianNadales Yes, which makes it all the more puzzling (to me) that <code>Expr t1 -&gt; t</code> is what is inferred."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1483394506, "post_id": 41431216, "comment_id": 70073453, "body": "I know I&#39;ve answered this before, with essentially the same answer I wrote below (and possibly a link to a mailing list post that I learned the answer from), but I can&#39;t find it now. If somebody else manages to find the dupe, let me know -- I&#39;ll be happy to vote to close."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 8, "last_activity_date": 1483394816, "last_edit_date": 1483394816, "creation_date": 1483393953, "answer_id": 41433732, "question_id": 41431216, "link": "https://stackoverflow.com/questions/41431216/gadts-is-there-a-reason-why-the-weakest-or-strongest-type-is-not-chosen/41433732#41433732", "title": "GADT&#39;s: Is there a reason why the weakest or strongest type is not chosen", "body": "<p>For your example, <code>Expr a -&gt; String</code> is a strictly better type than <code>Expr Int -&gt; String</code>: anywhere that an <code>Expr Int -&gt; String</code> could be used, an <code>Expr a -&gt; String</code> will certainly do. But sometimes there <em>isn't</em> a \"weakest\" or \"strongest\" type.</p>\n\n<p>Let's simplify your example even further:</p>\n\n<pre><code>data SoSimple a where\n    SoSimple :: SoSimple Int\n\neval SoSimple = 3 :: Int\n</code></pre>\n\n<p>Now here are two perfectly good types to give <code>eval</code>:</p>\n\n<pre><code>eval :: SoSimple a -&gt; a\neval :: SoSimple a -&gt; Int\n</code></pre>\n\n<p>These types aren't interchangeable! Each is useful in different situations. Compare:</p>\n\n<pre><code>{-# LANGUAGE EmptyCase #-}\n{-# LANGUAGE GADTs #-}\nimport Data.Void\n\ndata SomeSimple where\n    SomeSimple :: SoSimple a -&gt; SomeSimple\n\n-- typechecks if eval :: SoSimple a -&gt; Int,\n--    but not if eval :: SoSimple a -&gt; a\nevalSome :: SomeSimple -&gt; Int\nevalSome (SomeSimple x) = eval x\n\n-- typechecks if eval :: SoSimple a -&gt; a,\n--    but not if eval :: SoSimple a -&gt; Int\nevalNone :: SoSimple Void -&gt; Void\nevalNone = eval\n</code></pre>\n\n<p>So neither of these is more general than the other (and it turns out that no type is more general than both while still letting <code>eval</code> itself typecheck). Since there is no most-general type for <code>eval</code>, it makes sense to refuse to pick a type and force the user to decide which of the many possible types they want this time around.</p>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 41433732, "answer_count": 1, "score": 3, "last_activity_date": 1483407930, "creation_date": 1483379505, "last_edit_date": 1483407930, "question_id": 41431216, "link": "https://stackoverflow.com/questions/41431216/gadts-is-there-a-reason-why-the-weakest-or-strongest-type-is-not-chosen", "title": "GADT&#39;s: Is there a reason why the weakest or strongest type is not chosen", "body": "<p>I'm reading <a href=\"http://www.cs.ox.ac.uk/ralf.hinze/publications/With.pdf\" rel=\"nofollow noreferrer\">Fun With Phantom Types</a>. The first exercise asks why it is necessary to provide a signature to functions operating on Phantom Types. While I cannot come up with a general reason, I do see a problem in the following example:</p>\n\n<pre><code>data Expr a where\n  I :: Int -&gt; Expr Int\n  B :: Bool -&gt; Expr Bool\n  Add :: Expr Int -&gt; Expr Int -&gt; Expr Int\n  Eq :: (Eq a) =&gt; Expr a -&gt; Expr a -&gt; Expr Bool\n\n\nwhatIs (I _) = \"an integer expression\"\nwhatIs (Add _ _) = \"an adition operation\"\n</code></pre>\n\n<p>Now I understand that there are two possible types for <code>whatIs</code> above, namely:</p>\n\n<pre><code>Expr a -&gt; String\n</code></pre>\n\n<p>and</p>\n\n<pre><code>Expr Int -&gt; String\n</code></pre>\n\n<p>however, the compiler instead gives an error:</p>\n\n<pre><code>\u2022 Couldn't match expected type \u2018t\u2019 with actual type \u2018[Char]\u2019\n    \u2018t\u2019 is untouchable\n      inside the constraints: t1 ~ Int\n      bound by a pattern with constructor: I :: Int -&gt; Expr Int,\n               in an equation for \u2018whatIs\u2019\n      at ti.hs:9:9-11\n  \u2018t\u2019 is a rigid type variable bound by\n    the inferred type of whatIs :: Expr t1 -&gt; t at ti.hs:9:1\n  Possible fix: add a type signature for \u2018whatIs\u2019\n\u2022 In the expression: \"someString\"\n  In an equation for \u2018whatIs\u2019: whatIs (I _) = \"someString\"\n\u2022 Relevant bindings include\n    whatIs :: Expr t1 -&gt; t (bound at ti.hs:9:1)\n</code></pre>\n\n<p>I'm wondering why the compiler does not choose any of the two.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1483379403, "post_id": 41431059, "comment_id": 70068203, "body": "<code>newtype Triangular a = Triangular (Array (Int, Int) a)</code>, write a custom <code>Show</code> instance, and make sure your code never accidentally accesses the undefined parts of the array. You won&#39;t get much help with that from the type checker, though."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1483379589, "post_id": 41431059, "comment_id": 70068286, "body": "Alternately, you could also define a new type of <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Ix.html\" rel=\"nofollow noreferrer\"><code>Ix</code></a> index"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 1, "creation_date": 1483380322, "post_id": 41431059, "comment_id": 70068567, "body": "If you want to avoid wasting half the space you could use a 1-dimensional array and compute the index as &quot;d i j = (i * (i-1)) <code>div</code> 2 + j&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 7, "last_activity_date": 1483384009, "creation_date": 1483384009, "answer_id": 41432098, "question_id": 41431059, "link": "https://stackoverflow.com/questions/41431059/how-to-do-a-triangular-array-in-haskell/41432098#41432098", "title": "How to do a triangular array in Haskell", "body": "<p>A simple <em>upper triangular index</em> can be defined as:</p>\n\n<pre><code>import Data.Ix (Ix, range, index, inRange)\n\ndata UpperTriagIndex = Int :. Int\n  deriving (Show, Ord, Eq)\n\ninstance Ix UpperTriagIndex where\n  range (a :. b, c :. d) = concatMap (\\i -&gt; (i :.) &lt;$&gt; [max i b..d]) [a..c]\n  inRange (a :. b, c :. d) (i :. j) = a &lt;= i &amp;&amp; i &lt;= c &amp;&amp; b &lt;= j &amp;&amp; j &lt;= d\n\n  index pr@(a :. b, c :. d) ix@(i :. j)\n    | inRange pr ix = f a - f i + j - i\n    | otherwise     = error \"out of range!\"\n    where f x = let s = d + 1 - max x b in s * (s + 1) `div` 2\n</code></pre>\n\n<p>One can verify that <code>range</code> and <code>index</code> round trip even if the array is <em>not</em> square. For example:</p>\n\n<pre><code>\\&gt; let pr = (0 :. 0, 3 :. 5) in index pr &lt;$&gt; range pr\n[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]  -- [0..17] \n</code></pre>\n\n<p>and:</p>\n\n<pre><code>\\&gt; import Data.Array (array, (!))\n\\&gt; let f i j = (i :. j, \"row: \" ++ show i ++ \", col: \" ++ show j)\n\\&gt; let a = array ((0 :. 0), (3 :. 3)) [f i j | i &lt;- [0..3], j &lt;- [i..3]]\n\\&gt; a ! (2 :. 3)\n\"row: 2, col: 3\"\n</code></pre>\n"}], "owner": {"reputation": 967, "user_id": 1465472, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/64ca2c1540eb6254acb10aec1958655c?s=128&d=identicon&r=PG", "display_name": "Mike Flynn", "link": "https://stackoverflow.com/users/1465472/mike-flynn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 177, "favorite_count": 0, "accepted_answer_id": 41432098, "answer_count": 1, "score": 2, "last_activity_date": 1483384009, "creation_date": 1483378793, "last_edit_date": 1483379854, "question_id": 41431059, "link": "https://stackoverflow.com/questions/41431059/how-to-do-a-triangular-array-in-haskell", "title": "How to do a triangular array in Haskell", "body": "<p>I want to do something like</p>\n\n<pre><code>array ((0,0), (25, 25)) [((i,j), 1) | i &lt;- [0..25], j &lt;- [i..25]]\n</code></pre>\n\n<p>which you can see by the array index, is only defined when <code>i &lt;= j</code>.  However, when I try to print this out in ghci I get an error because it tries to print things like <code>(1,0)</code> due to the array bounds. </p>\n\n<pre><code>((1,0),*** Exception: (Array.!): undefined array element\n</code></pre>\n\n<p>I could just have the array be square and put something like 0's in those entries, but I think that would be suboptimal. Is there a way I can set up the bounds of this array to be \"triangular\"?</p>\n"}, {"tags": ["haskell", "functional-programming", "currying"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 1, "creation_date": 1483378239, "post_id": 41430924, "comment_id": 70067709, "body": "Your last error is because <code>[xs]</code> will only match a list with a single element. Just remove the square braces from the parameter and the argument to <code>map</code>."}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 3, "creation_date": 1483378448, "post_id": 41430924, "comment_id": 70067800, "body": "Downvoter should comment, given neither the answer or question are really that bad."}, {"owner": {"reputation": 161, "user_id": 6731064, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/e3e89af583f596652d94294cd481ae31?s=128&d=identicon&r=PG&f=1", "display_name": "user6731064", "link": "https://stackoverflow.com/users/6731064/user6731064"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1483378572, "post_id": 41430924, "comment_id": 70067858, "body": "@Carcigenicate Ah thank you that makes sense"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1483398452, "post_id": 41430924, "comment_id": 70074614, "body": "@Carcigenicate I don&#39;t think this question deserves a downvote either, but that&#39;s not my call to make, or yours. People can vote how they like, and there&#39;s no obligation to explain why in the comments."}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1483400434, "post_id": 41430924, "comment_id": 70075106, "body": "@amalloy It&#39;s good etiquette to explain a downvote though; especially when the OP only has only 8 rep and may be unaware of something wrong they did. Not necessary, no, but certainly helpful to people who aren&#39;t familiar with the site."}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1483378411, "post_id": 41430959, "comment_id": 70067788, "body": "Didn&#39;t down vote, but I reckon the person who did would&#39;ve wanted you to explain the <code>Non-exhaustive patterns in function all</code> error."}, {"owner": {"reputation": 161, "user_id": 6731064, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/e3e89af583f596652d94294cd481ae31?s=128&d=identicon&r=PG&f=1", "display_name": "user6731064", "link": "https://stackoverflow.com/users/6731064/user6731064"}, "edited": false, "score": 1, "creation_date": 1483378535, "post_id": 41430959, "comment_id": 70067843, "body": "@Simon H that&#39;s great thank you, clearly I need to brush up on composition and application"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1483379775, "post_id": 41430959, "comment_id": 70068371, "body": "Note: you do need to have the <code>fn</code> parameter at all: <code>all = and . map</code> is fine."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1483403617, "post_id": 41430959, "comment_id": 70075822, "body": "@Bakuriu See <a href=\"http://stackoverflow.com/q/16888222/625403\">stackoverflow.com/q/16888222/625403</a> for one of the many questions asking why the thing you propose doesn&#39;t work."}], "tags": [], "owner": {"reputation": 17837, "user_id": 1923190, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/D0JyZ.jpg?s=128&g=1", "display_name": "Simon H", "link": "https://stackoverflow.com/users/1923190/simon-h"}, "is_accepted": true, "score": 2, "last_activity_date": 1483378671, "last_edit_date": 1483378671, "creation_date": 1483378252, "answer_id": 41430959, "question_id": 41430924, "link": "https://stackoverflow.com/questions/41430924/how-to-use-curried-functions-in-haskell-with-map/41430959#41430959", "title": "How to use curried functions in Haskell with map?", "body": "<p>You mixed up function application with composition. Does this help?</p>\n\n<pre><code>all :: (a -&gt; Bool) -&gt; [a] -&gt; Bool\nall fn = and . (map fn)\n</code></pre>\n\n<p>In practise, this is equivalent to your code + the comment from  @Carcigenicate</p>\n"}], "owner": {"reputation": 161, "user_id": 6731064, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/e3e89af583f596652d94294cd481ae31?s=128&d=identicon&r=PG&f=1", "display_name": "user6731064", "link": "https://stackoverflow.com/users/6731064/user6731064"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 326, "favorite_count": 0, "accepted_answer_id": 41430959, "answer_count": 1, "score": 0, "last_activity_date": 1483453430, "creation_date": 1483378027, "question_id": 41430924, "link": "https://stackoverflow.com/questions/41430924/how-to-use-curried-functions-in-haskell-with-map", "title": "How to use curried functions in Haskell with map?", "body": "<p>Trying to learn how to use folds by redefining prelude functions:</p>\n\n<pre><code>import Prelude hiding (sum, product, length, and, or, all, any, filter)\n</code></pre>\n\n<p>So far I've got up to all working, but I can't figure out what I'm doing wrong with all. I'm defining it as follows:</p>\n\n<pre><code>and :: [Bool] -&gt; Bool\nand = foldr (&amp;&amp;) True\n\n...\n\nall :: (a -&gt; Bool) -&gt; [a] -&gt; Bool\nall = and $ map\n</code></pre>\n\n<p>But this displays an error saying :</p>\n\n<pre><code>Probable cause: \u2018map\u2019 is applied to too few arguments\n</code></pre>\n\n<p>I've also tried defining it as:</p>\n\n<pre><code>and :: [Bool] -&gt; Bool\nand = foldr (&amp;&amp;) True\n\n...\n\nall :: (a -&gt; Bool) -&gt; [a] -&gt; Bool\nall f [xs] = and $ map f [xs]\n</code></pre>\n\n<p>This compiles fine, but when I try to call it it says:</p>\n\n<pre><code>[1 of 1] Compiling Fold             ( Fold.hs, interpreted )\nOk, modules loaded: Fold.\n*Fold&gt; all even [0,2,4,6]\n*** Exception: Fold.hs:17:1-29: Non-exhaustive patterns in function all\n</code></pre>\n\n<p>which I don't understand since shouldn't [xs] match any list, even an empty one? Why can I curry foldr without including the list but not map? Any help would be appreciated.</p>\n"}, {"tags": ["haskell", "haskell-lens", "lenses", "traversable"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1483380333, "post_id": 41430669, "comment_id": 70068569, "body": "Not really a full answer, but some little bits of intuition I&#39;ve skimmed from the docs: given <code>fx :: f a</code> then <code>(&lt;*&gt; fx) :: forall r. f (a -&gt; r) -&gt; f r</code>, ripe to be passed to <code>Curried</code>. So it&#39;s a bit like a higher-order encoding of the application operator. Furthermore, looking at <a href=\"https://hackage.haskell.org/package/kan-extensions-5.0.1/docs/src/Data-Functor-Day-Curried.html#line-48\" rel=\"nofollow noreferrer\">its Applicative instance</a> you can see that <code>&lt;*&gt;</code> is implemented using <code>.</code>, like difference lists&#39; <code>mappend</code>, which I guess is what the docs mean when they talk about reassociating <code>&lt;*&gt;</code> calls."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1483384741, "post_id": 41430669, "comment_id": 70070122, "body": "@BenjaminHodgson, I&#39;m not really after reassociating the <code>&lt;*&gt;</code> calls, per se, so maybe <code>confusing</code> isn&#39;t the right model. What I really want, I think, is to replace <code>f &lt;$&gt; m &lt;*&gt; (g &lt;$&gt; n)</code> with <code>(\\mr nr -&gt; f mr (g nr)) &lt;$&gt; m &lt;*&gt; n</code>, and to do that recursively. I wonder if I need to look less at <code>Traversable</code> and more at <code>Applicative</code> itself."}, {"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 1, "creation_date": 1533489060, "post_id": 41430669, "comment_id": 90354359, "body": "It&#39;s discussed in subsection <i>8.4.2</i> of <a href=\"https://arxiv.org/abs/1805.06798\" rel=\"nofollow noreferrer\"><i>Generic Deriving of Generic Traversals</i></a>"}, {"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 1, "creation_date": 1533493672, "post_id": 41430669, "comment_id": 90355604, "body": "I also want to point out, that <code>Yoneda</code> has the type of <code>flip fmap</code> applied to a single argument. <code>Curried</code> has the type of <code>flip (&lt;*&gt;)</code> applied to a single argument. <code>(&lt;$&gt; ..) :: forall x. (A -&gt; x) -&gt; F x</code> and <code>(&lt;*&gt; ..) :: forall x. F (A -&gt; x) -&gt; F x</code>."}], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 145, "favorite_count": 0, "answer_count": 0, "score": 5, "last_activity_date": 1604010702, "creation_date": 1483376648, "last_edit_date": 1604010702, "question_id": 41430669, "link": "https://stackoverflow.com/questions/41430669/understanding-confusing", "title": "Understanding confusing", "body": "<p>I've been thinking about whether there's some method that could be added to <code>Traversable</code> to make it compose more cheaply in the presence of expensive functors. The inspiration was <a href=\"https://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Traversal.html#v:confusing\" rel=\"noreferrer\"><code>Control.Lens.Traversal.confusing</code></a>, which uses a special <code>Applicative</code> to do something similar.</p>\n\n<pre><code>confusing :: Applicative f =&gt; LensLike (Curried (Yoneda f) (Yoneda f)) s t a b -&gt; LensLike f s t a b\n</code></pre>\n\n<p>Unfortunately, <code>confusing</code> really lives up to its name&mdash;I don't understand what it's actually doing. In particular, I have no intuition about <code>Curried</code>.</p>\n\n<p>Furthermore, <code>confusing</code> has a CPS flavor to it, which suggests it's probably too strict for my purpose. <code>Yoneda</code> can be swapped out for <code>Coyoneda</code> to enhance laziness, but I have no idea what to do about the <code>Curried</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 4, "creation_date": 1483377690, "post_id": 41430428, "comment_id": 70067495, "body": "&quot;Odd!&quot; - it&#39;s actually the only possible implementation, but the syntax for the tuple type which puns on the data constructor sort of hides it. More straightforward would be: <code>data Tuple a b = Tuple a b</code> ; <code>instance Functor (Tuple a)</code> ... so the concrete type signature for <code>fmap</code> on tuples is (with redundant parens for clarity): <code>fmap :: (b -&gt; c) -&gt; (Tuple a) b -&gt; (Tuple a) c</code> where <code>Tuple a</code> is your <code>f</code>."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1483407228, "post_id": 41430428, "comment_id": 70076502, "body": "I will validate that this &quot;last type parameter&quot; business was indeed very odd looking when I first encountered it.  Haskell is somewhat sensitive to the order of parameters, especially type parameters, which is quite different from basically every other language where it doesn&#39;t really matter."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 10, "last_activity_date": 1483378135, "last_edit_date": 1483378135, "creation_date": 1483375857, "answer_id": 41430521, "question_id": 41430428, "link": "https://stackoverflow.com/questions/41430428/any-built-in-fmap-of-sorts-on-all-values-of-a-tuple/41430521#41430521", "title": "Any built-in fmap-of-sorts on all values of a tuple?", "body": "<p>In terms of \"mapping\" over both elements of a tuple, the best you have is <code>bimap :: Bifunctor p =&gt; (a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d</code> defined in <a href=\"https://hackage.haskell.org/package/bifunctors-3.2.0.1/docs/Data-Bifunctor.html\" rel=\"noreferrer\"><code>Data.Bifunctor</code></a> (now in <code>base</code>!). With that, you can write</p>\n\n<pre><code>ghci&gt; bimap reverse reverse (\"aA\",\"bB\")\n(\"Aa\",\"Bb\")\n</code></pre>\n\n<p>Alternately, you can use <code>(***) :: Arrow a =&gt; a b c -&gt; a b' c' -&gt; a (b, b') (c, c')</code> defined in <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Arrow.html\" rel=\"noreferrer\"><code>Control.Arrow</code></a> (in particular using the <code>Arrow (-&gt;)</code> instance). With that, you can write</p>\n\n<pre><code>ghci&gt; (reverse *** reverse) (\"aA\",\"bB\")\n(\"Aa\",\"Bb\")\n</code></pre>\n\n<p>However, if you are trying to map over both elements of a tuple at the same time, perhaps you are looking for an abstraction that groups together two values of type <code>a</code>. If this is the case, I would recommend you use a <code>newtype</code> around <code>(a,a)</code>. Then, you can turn on the <code>-XDeriveFunctor</code> extension as get the following</p>\n\n<pre><code>ghci&gt; :set -XDeriveFunctor\nghci&gt; newtype Pair a = Pair (a,a) deriving (Show,Functor)\nghci&gt; fmap reverse (Pair (\"aA\",\"bB\"))\nPair (\"Aa\",\"Bb\")\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1483386157, "creation_date": 1483386157, "answer_id": 41432478, "question_id": 41430428, "link": "https://stackoverflow.com/questions/41430428/any-built-in-fmap-of-sorts-on-all-values-of-a-tuple/41432478#41432478", "title": "Any built-in fmap-of-sorts on all values of a tuple?", "body": "<p>You need to consider the full type. In the type <code>(a,b)</code>, which is the same a s <code>(,) a b</code>, the functor is <code>(,) a</code>. Hence we get</p>\n\n<pre><code>fmap :: (b -&gt; c) -&gt; (,) a b -&gt; (,) a c\n</code></pre>\n\n<p>This makes it clear that the first component is unaffected by <code>fmap</code>.</p>\n\n<pre><code>&gt; fmap reverse (True,\"bB\")\n(True,\"Bb\")\n</code></pre>\n\n<p>You are probably thinking of another functor</p>\n\n<pre><code>-- user-defined\ndata Pair a = Pair a a deriving Functor\n</code></pre>\n\n<p>Here we do have</p>\n\n<pre><code>fmap :: (b -&gt; c) -&gt; Pair b -&gt; Pair c\n</code></pre>\n\n<p>affecting both components, but this type is not the regular tuple type.</p>\n\n<p>Bonus puzzle: for the same reason</p>\n\n<pre><code>&gt; length (1,2)\n1\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 34861, "user_id": 110081, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/cSvwm.jpg?s=128&g=1", "display_name": "Roman Cheplyaka", "link": "https://stackoverflow.com/users/110081/roman-cheplyaka"}, "is_accepted": false, "score": 4, "last_activity_date": 1483388248, "creation_date": 1483388248, "answer_id": 41432806, "question_id": 41430428, "link": "https://stackoverflow.com/questions/41430428/any-built-in-fmap-of-sorts-on-all-values-of-a-tuple/41432806#41432806", "title": "Any built-in fmap-of-sorts on all values of a tuple?", "body": "<p>This is certainly an overkill for this particular example, and it's not in base, but most generic programming libraries will let you do that. E.g. with <a href=\"https://hackage.haskell.org/package/traverse-with-class-0.2.0.4/docs/Data-Generics-Traversable.html\" rel=\"nofollow noreferrer\">traverse-with-class</a>:</p>\n\n<pre><code>{-# LANGUAGE ImplicitParams #-}\nimport Data.Generics.Traversable\nimport Data.Proxy\n\nmain = do\n  -- specify the constraint to make 'reverse' type-check.\n  -- (~) String means \"equal to String\"\n  let ?c = Proxy :: Proxy ((~) String)\n  print $ gmap reverse (\"aA\",\"bB\")\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1483407113, "post_id": 41435168, "comment_id": 70076474, "body": "<a href=\"https://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Tuple.html\" rel=\"nofollow noreferrer\">That <code>lens</code> module</a>, for reference"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 4, "last_activity_date": 1483412725, "last_edit_date": 1483412725, "creation_date": 1483406172, "answer_id": 41435168, "question_id": 41430428, "link": "https://stackoverflow.com/questions/41430428/any-built-in-fmap-of-sorts-on-all-values-of-a-tuple/41435168#41435168", "title": "Any built-in fmap-of-sorts on all values of a tuple?", "body": "<p>As Alec indicated, <code>bimap</code> is good for pairs. If you want to deal with tuples more generally, one option is to use a class. The below was inspired by some ideas in <code>lens</code> (especially <a href=\"https://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Tuple.html\" rel=\"nofollow noreferrer\"><code>Control.Lens.Tuple</code></a>), but I don't think it's quite the same as anything there.</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses, FunctionalDependencies #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE UndecidableInstances #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeFamilies #-}\n\nmodule Tuplish where\nimport Data.Functor.Identity (Identity (..))\nimport Data.Profunctor.Unsafe ((#.), (.#))\n\nclass Tuply s t a b | s -&gt; a, t -&gt; b, s b -&gt; t, t a -&gt; s where\n  ttraverse :: Applicative f =&gt; (a -&gt; f b) -&gt; s -&gt; f t\n\nmapTuple :: Tuply s t a b =&gt; (a -&gt; b) -&gt; (s -&gt; t)\nmapTuple = (runIdentity .) #. ttraverse .# (Identity .)\n\n\ninstance (a1 ~ a, a2 ~ a, b1 ~ b, b2 ~ b)\n    =&gt; Tuply (a1, a2) (b1, b2) a b where\n  ttraverse f (x,y) = (,) &lt;$&gt; f x &lt;*&gt; f y\n\ninstance (a1 ~ a, a2 ~ a, a3 ~ a, b1 ~ b, b2 ~ b, b3 ~ b)\n    =&gt; Tuply (a1,a2,a3) (b1,b2,b3) a b where\n  ttraverse f (x,y,z) = (,,) &lt;$&gt; f x &lt;*&gt; f y &lt;*&gt; f z\n\ninstance (a1 ~ a, a2 ~ a, a3 ~ a, a4 ~ a, b1 ~ b, b2 ~ b, b3 ~ b, b4 ~ b)\n    =&gt; Tuply (a1,a2,a3,a4) (b1,b2,b3,b4) a b where\n  ttraverse f (x,y,z,w) = (,,,) &lt;$&gt; f x &lt;*&gt; f y &lt;*&gt; f z &lt;*&gt; f w\n\ninstance (a1 ~ a, a2 ~ a, a3 ~ a, a4 ~ a, a5 ~ a,\n          b1 ~ b, b2 ~ b, b3 ~ b, b4 ~ b, b5 ~ b)\n    =&gt; Tuply (a1,a2,a3,a4,a5) (b1,b2,b3,b4,b5) a b where\n  ttraverse f (x,y,z,w,u) = (,,,,) &lt;$&gt; f x &lt;*&gt; f y &lt;*&gt; f z &lt;*&gt; f w &lt;*&gt; f u\n\ninstance (a1 ~ a, a2 ~ a, a3 ~ a, a4 ~ a, a5 ~ a, a6 ~ a,\n          b1 ~ b, b2 ~ b, b3 ~ b, b4 ~ b, b5 ~ b, b6 ~ b)\n    =&gt; Tuply (a1,a2,a3,a4,a5,a6) (b1,b2,b3,b4,b5,b6) a b where\n\n  ttraverse f (x,y,z,w,u,v) = (,,,,,) &lt;$&gt; f x &lt;*&gt; f y &lt;*&gt; f z &lt;*&gt; f w &lt;*&gt; f u &lt;*&gt; f v\n</code></pre>\n"}], "owner": {"reputation": 2044, "user_id": 1258491, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/yyvEu.png?s=128&g=1", "display_name": "metaleap", "link": "https://stackoverflow.com/users/1258491/metaleap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 0, "accepted_answer_id": 41430521, "answer_count": 4, "score": 4, "last_activity_date": 1483412725, "creation_date": 1483375354, "question_id": 41430428, "link": "https://stackoverflow.com/questions/41430428/any-built-in-fmap-of-sorts-on-all-values-of-a-tuple", "title": "Any built-in fmap-of-sorts on all values of a tuple?", "body": "<p>For now I have this little helper:</p>\n\n<pre><code>both f (one,two) = (f one , f two)\n</code></pre>\n\n<p>Then I was idly wondering whether <code>fmap</code> \"iterates\" a tuple so I asked GHCi:</p>\n\n<pre><code>fmap reverse (\"aA\",\"bB\")\n</code></pre>\n\n<p>Result being:</p>\n\n<pre><code>(\"aA\",\"Bb\")\n</code></pre>\n\n<p>Odd! So the semantics of fmap over a tuple seems to be \"to apply func to the snd\", if you will.</p>\n\n<p>Anything in <code>base</code> or <code>Prelude</code> I should use instead of my own <code>both</code>? Hoogle gave <a href=\"https://www.haskell.org/hoogle/?hoogle=(t1%20-%3E%20t)%20-%3E%20(t1%2C%20t1)%20-%3E%20(t%2C%20t)\" rel=\"nofollow noreferrer\">no promising results</a> or I parsed them wrongly.</p>\n"}, {"tags": ["haskell", "either"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1483377892, "post_id": 41430815, "comment_id": 70067576, "body": "Isn&#39;t <code>Except</code> pretty much the same as <code>Either</code>? <code>ExceptT e m a</code> has different instances from <code>m (Either e a)</code>, but <code>ExceptT e Identity a</code> should be equivalent to <code>Either e a</code>, I believe."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1483378065, "post_id": 41430815, "comment_id": 70067632, "body": "@dfeuer Totally is. I prefer using it just because the name conveys the intention of possible having an exception. That said, it is worth pointing out that all of the <code>Except</code> in the code above could be replaced with <code>Either</code> without changing anything else."}, {"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "edited": false, "score": 0, "creation_date": 1483380258, "post_id": 41430815, "comment_id": 70068549, "body": "Thank you, looks much cleaner and simpler."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 3, "last_activity_date": 1483377451, "creation_date": 1483377451, "answer_id": 41430815, "question_id": 41430135, "link": "https://stackoverflow.com/questions/41430135/either-monad-or-not/41430815#41430815", "title": "Either Monad or not?", "body": "<p>I would use the <a href=\"https://hackage.haskell.org/package/transformers-0.5.2.0/docs/Control-Monad-Trans-Except.html\" rel=\"nofollow noreferrer\"><code>Monad Except</code></a> or <code>Monad Either</code> for this - it conveys better the intent of your function: that both <code>evalLatitude lat</code> and <code>evalLongitude lng</code> must succeed, otherwise you fail with an error message.</p>\n\n<pre><code>import Control.Monad.Except    \n\nmkLatLngPoint :: LatitudeDMS -&gt; LongitudeDMS -&gt; Datum -&gt; Except String LatLng\nmkLatLngPoint lat lng dtm = do\n    lt &lt;- withExcept (const \"Invalid latitude\") evalLatitude lat\n    ln &lt;- withExcept (const \"Invalid longitude\") evalLongitude lng\n    let p = LatLngPoint { latitude = lt , longitude = ln, height = 0 }\n    pure (LatLng { point = p , datum = dtm })\n\n  where evalLatitude :: LatitudeDMS -&gt; Except String Double\n        evalLatitude (North p) = dmsToLatLngPoint p 1\n        evalLatitude (South p) = dmsToLatLngPoint p (-1)\n\n        evalLongitude :: LongitudeDMS -&gt; Except String Double\n        evalLongitude (East p) = dmsToLatLngPoint p 1\n        evalLongitude (West p) = dmsToLatLngPoint p (-1)\n\n        dmsToLatLngPoint :: DMSPoint -&gt; Double -&gt; Except String Double\n        dmsToLatLngPoint DMSPoint { degrees = d, minutes = m, seconds = s } cardinal\n          | d + m + s &lt; 90 = throwError \"Invalid point\"\n          | otherwise = pure (cardinal * (d + m + s / 324.9))\n</code></pre>\n\n<p>Note that neither this solution, nor your <code>case</code> solution evaluate more than they need: as soon as one of the two fails, the function can fail as a whole (for your case, remember Haskell is lazy!).</p>\n"}, {"comments": [{"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "edited": false, "score": 0, "creation_date": 1483430147, "post_id": 41434637, "comment_id": 70083730, "body": "thank you for the answer. The link is interesting and I am going to read it. As you said the code looks more verbose and &quot;repetitive&quot; but the approach is interesting."}], "tags": [], "owner": {"reputation": 587, "user_id": 1015602, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/ea1629e2c2d1d82ab8c3645d82ecc60d?s=128&d=identicon&r=PG", "display_name": "Free_D", "link": "https://stackoverflow.com/users/1015602/free-d"}, "is_accepted": false, "score": 0, "last_activity_date": 1483400635, "creation_date": 1483400635, "answer_id": 41434637, "question_id": 41430135, "link": "https://stackoverflow.com/questions/41430135/either-monad-or-not/41434637#41434637", "title": "Either Monad or not?", "body": "<p>I see there is already an accepted answer, but just giving another solution (although very similar).  Following the guidelines outlined here: <a href=\"https://www.fpcomplete.com/blog/2016/11/exceptions-best-practices-haskell\" rel=\"nofollow noreferrer\">https://www.fpcomplete.com/blog/2016/11/exceptions-best-practices-haskell</a> (a good thing to read either way), you would get something like this.</p>\n\n<pre><code>import Control.Monad.Catch\n\ndata LatitudeException = LatitudeException\ninstance Show LatitudeException where\n  show LatitudeException = \"Invalid Latitude\"\ninstance Exception LatitudeException\n\ndata LongitudeException = LongitudeException\ninstance Show LongitudeException where\n  show LongitudeException = \"Invalid Longitude\"\ninstance Exception LongitudeException\n\nmkLatLngPoint :: (MonadThrow m) =&gt; LatitudeDMS -&gt; LongitudeDMS -&gt; Datum -&gt; m LatLng\nmkLatLngPoint lat lng dtm = do\n  lt &lt;- evalLatitude lat\n  ln &lt;- evalLongitude lng\n  let p = LatLngPoint { latitude = lt , longitude = ln, height = 0 }\n  return $ LatLng { point = p , datum = dtm }\n\n  where evalLatitude :: (MonadThrow m) =&gt; LatitudeDMS -&gt; m Double\n        evalLatitude (North p) = case dmsToLatLngPoint p 1 of\n                                  (Just d) -&gt; return d\n                                  Nothing -&gt; throwM LatitudeException\n        evalLatitude (South p) = case dmsToLatLngPoint p (-1) of\n                                  (Just d) -&gt; return d\n                                  Nothing -&gt; throwM LatitudeException\n\n        evalLongitude :: (MonadThrow m) =&gt; LongitudeDMS -&gt; m Double\n        evalLongitude (East p) = case dmsToLatLngPoint p 1 of\n                                  (Just d) -&gt; return d\n                                  Nothing -&gt; throwM LongitudeException\n        evalLongitude (West p) = case dmsToLatLngPoint p (-1) of\n                                  (Just d) -&gt; return d\n                                  Nothing -&gt; throwM LongitudeException\n\n        dmsToLatLngPoint :: DMSPoint -&gt; Double -&gt; Maybe Double\n        dmsToLatLngPoint DMSPoint { degrees = d, minutes = m, seconds = s } cardinal\n          | d + m + s &lt; 90 = Nothing\n          | otherwise = Just (cardinal * (d + m + s / 324.9))\n</code></pre>\n\n<p>There is definitely a little more boilerplate to deal with but gives a little more flexibility.  Check out the article and see if the benefits outway that for your situation.</p>\n"}], "owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 41430815, "answer_count": 2, "score": 1, "last_activity_date": 1483400635, "creation_date": 1483373942, "last_edit_date": 1483377859, "question_id": 41430135, "link": "https://stackoverflow.com/questions/41430135/either-monad-or-not", "title": "Either Monad or not?", "body": "<p>In this code:</p>\n\n<pre><code>data LatLngPoint = LatLngPoint { latitude :: Double\n                               , longitude :: Double\n                               , height :: Double\n                               }\n\ndata LatLng = LatLng { point :: LatLngPoint\n                     , datum :: Datum\n                     }\n\ndata LatitudeDMS = North DMSPoint | South DMSPoint\n\ndata LongitudeDMS = East DMSPoint | West DMSPoint\n\ndata DMSPoint = DMSPoint { degrees :: Double\n                         , minutes :: Double\n                         , seconds :: Double\n                         }\n\nmkLatLngPoint :: LatitudeDMS -&gt; LongitudeDMS -&gt; Datum -&gt; Either String LatLng\nmkLatLngPoint lat lng dtm =\n  case evalLatitude lat of\n    Nothing -&gt; Left \"Invalid latitude\"\n    Just lt -&gt; case evalLongitude lng of\n                 Nothing -&gt; Left \"Invalid longitude\"\n                 Just ln -&gt; let p = LatLngPoint { latitude = lt , longitude = ln, height = 0 }\n                            in Right LatLng { point = p , datum = dtm }\n\n  where evalLatitude :: LatitudeDMS -&gt; Maybe Double\n        evalLatitude (North p) = dmsToLatLngPoint p 1\n        evalLatitude (South p) = dmsToLatLngPoint p (-1)\n\n        evalLongitude :: LongitudeDMS -&gt; Maybe Double\n        evalLongitude (East p) = dmsToLatLngPoint p 1\n        evalLongitude (West p) = dmsToLatLngPoint p (-1)\n\n        dmsToLatLngPoint :: DMSPoint -&gt; Double -&gt; Maybe Double\n        dmsToLatLngPoint DMSPoint { degrees = d, minutes = m, seconds = s } cardinal\n          | d + m + s &lt; 90 = Nothing\n          | otherwise = Just (cardinal * (d + m + s / 324.9))\n</code></pre>\n\n<p>I made one simple consideration, that the 2 main parameters in the function:</p>\n\n<p><code>mkLatLngPoint :: LatitudeDMS -&gt; LongitudeDMS -&gt; ...</code></p>\n\n<p>were different type, to avoid extra check based on their Cardinal direction.\nNow I have ended up to a nested Maybe/Either situation. I thought about using Either Monad but not sure if it is worthy and how to make it clean.</p>\n\n<p>I have even created a second version:</p>\n\n<pre><code>case (evalLatitude lat, evalLongitude lng) of\n    (Nothing, _) -&gt; Left \"Invalid latitude\"\n    (_, Nothing) -&gt; Left \"Invalid longitude\"\n    (Just latPoint, Just lngPoint) -&gt;\n      let p = LatLngPoint { latitude = latPoint , longitude = lngPoint, height = 0 }\n      in Right LatLng { point = p , datum = dtm }\n</code></pre>\n\n<p>but I think is ugly and verbose.</p>\n\n<p>How can I improve the code (included changing type data)?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1483378975, "post_id": 41429680, "comment_id": 70068022, "body": "Do you want to experiment on the package itself, as in play around with the package&#39;s codebase? Or do you just want that package to be available to write your own code against?"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1483379222, "post_id": 41429680, "comment_id": 70068109, "body": "@MichaelLitchard: I want to be able to use it as if installed, but sandbox it. So, for example, be able to go into ghci (using <code>stack ghci</code> and import it and use it there). It seems like the trick (having messed with this a bit) is to use <code>stack ghci --no-package-hiding</code>. But may only work for ghci, and also doesn&#39;t seem like &quot;best practice&quot; for how to accomplish this."}], "answers": [{"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1483380739, "post_id": 41431400, "comment_id": 70068731, "body": "Yeah, what throws me is that the workflow at the global level (just build and it works) can&#39;t be simply replicated in sandbox (without some file editing). I&#39;d have thought that once one has a sandbox (<code>stack new tester &amp;&amp; cd tester</code>) it would behave like the global &quot;box&quot; (and <code>stack build PKG &amp;&amp; stack ghci</code> would be sufficient). Instead the closest one can get to that (without editing files) is to add <code>--no-package-hiding</code> to the GHCi invocation, which just seems messy (not to mention obscure)."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1483381040, "post_id": 41431400, "comment_id": 70068849, "body": "Can you please describe precisely, step-by-step, what you did, and where your experience diverged from your expectations?"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1483381178, "post_id": 41431400, "comment_id": 70068888, "body": "I thought I just did. I&#39;m just surprised that I have to have to use <code>--no-package-hiding</code> (or the more complex procedure of editing the <code>.cabal</code> file manually), especially since neither is necessary at the global level."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1483381389, "post_id": 41431400, "comment_id": 70068947, "body": "Ok, I reread your first comment, and I think I understand what you mean. To me, the distinction makes sense: In a usual project I care about reproducibility. The global project is just scratch-space to me."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1483381485, "post_id": 41431400, "comment_id": 70068980, "body": "Still, feel free to <a href=\"https://github.com/commercialhaskell/stack/issues/new\" rel=\"nofollow noreferrer\">open an issue</a>!"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1483381518, "post_id": 41431400, "comment_id": 70068991, "body": "Ah, that&#39;s interesting. I&#39;d inverted my thinking, but viewing the global project as scratch has it all making much more sense. So that&#39;s really what I should be doing (its a lot simpler). I should probably follow with <code>stack clean --force</code> when I&#39;m done (or is there something better?)."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1483381794, "post_id": 41431400, "comment_id": 70069102, "body": "Projects are pretty well isolated from each other, including the global project. But you can <code>stack clean --force</code> if you want to prevent any interaction between different packages that you try in the same project."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1483384194, "post_id": 41431400, "comment_id": 70069933, "body": "Could I perform first steps of your second approach without editing using <code>stack new --param ... --solver</code> to modify the <code>.cabal</code> file and generate the corresponding changes to the <code>stack.yml</code>? If so, what should the argument to <code>--param</code> look like to set library build-depends to, say <code>my-pkg &gt; 0.0.2.2</code>?"}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1483384576, "post_id": 41431400, "comment_id": 70070054, "body": "The build-depends can&#39;t be populated via a paramater AFAIK. That would be a pretty hacky approach too. I agree though that this work-flow should be better supported. I think you may find similar feature requests on the issue tracker. Maybe chime in there."}], "tags": [], "owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "is_accepted": true, "score": 1, "last_activity_date": 1483380443, "creation_date": 1483380443, "answer_id": 41431400, "question_id": 41429680, "link": "https://stackoverflow.com/questions/41429680/workflow-for-using-stack-to-test-hackage-packages-not-in-stackage/41431400#41431400", "title": "Workflow for using stack to test Hackage packages (not in Stackage)", "body": "<p>To play with a package that isn't available on Stackage, I usually first try to build it in the global project:</p>\n\n<pre><code>$ cd ~/\n$ stack build the-package\n$ stack ghci\n</code></pre>\n\n<p>If that doesn't work, usually because of missing dependencies or bounds issues, I resort to the following workflow:</p>\n\n<pre><code>$ stack new playground\n$ cd playground\n# In playground.cabal, add the-package to the library build-depends section \n$ stack solver --update-config\n$ stack ghci\n# Play with the package\n</code></pre>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 350, "favorite_count": 1, "accepted_answer_id": 41431400, "answer_count": 1, "score": 2, "last_activity_date": 1483380443, "creation_date": 1483372035, "last_edit_date": 1483378260, "question_id": 41429680, "link": "https://stackoverflow.com/questions/41429680/workflow-for-using-stack-to-test-hackage-packages-not-in-stackage", "title": "Workflow for using stack to test Hackage packages (not in Stackage)", "body": "<p>What is the workflow for using stack to preform an isolated download and install (for testing and experimentation) of a Haskell package that's in Hackage, but not in Stackage?</p>\n\n<p>For example</p>\n\n<pre><code>stack new tester\ncd tester\n# Then add the package PKG to 'extra-deps'\nstack build . --force-dirty\n</code></pre>\n\n<p>is not sufficient, and results in errors (\"not a module in the current program, or in any known package\") when an <code>import</code> of part of the package is attempted. </p>\n\n<p>Explicitly building the package (which seems like it shouldn't be necessary) with</p>\n\n<pre><code>stack build PKG\n</code></pre>\n\n<p>doesn't work either (resulting in warnings that it \"is a member of the hidden package PKG...\").</p>\n\n<p>If I instead simply</p>\n\n<pre><code>stack new tester --force \ncd tester \nstack build PKG\n</code></pre>\n\n<p>I get the same \"hidden package\" error when I try to import a component of the package in a <code>stack ghci</code> session.</p>\n\n<p>What is the (best practice) workflow for using Haskell stack to create an isolated temporary installation for a working with specific package on Hackage?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1483369119, "post_id": 41428937, "comment_id": 70063704, "body": "If you didn&#39;t run <code>stack init</code> in <code>foo</code>, stack used the &quot;implicit global project&quot; in <code>~&#47;.stack&#47;global-project</code> to build that package. The link seems unrelated."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1483369158, "post_id": 41428937, "comment_id": 70063724, "body": "You might get a better answer if you make the question more concrete, with a concrete package etc.\u2026"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1483369467, "post_id": 41428937, "comment_id": 70063888, "body": "@sjakobi: That&#39;s not a bad answer already! So I was just missing <code>stack init</code>, without which I&#39;m working in the &quot;implicit global project&quot;; and if I&#39;d done <code>stack init</code>, I&#39;d have gotten the behavior I was expecting. (In both cases there is the expected <code>.stack-work</code>; but without <code>stack init</code>, its the global one.) Correct?"}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1483370742, "post_id": 41428937, "comment_id": 70064536, "body": "I&#39;m not sure which behavior precisely you were expecting, so I can&#39;t tell. Executables from non-local packages that are part of the current snapshot will be put in the <code>bin</code> folder of the snapshot and will be available to other projects that use that snapshot."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1483372106, "post_id": 41428937, "comment_id": 70065100, "body": "@sjakobi: That building alone &quot;would create` foo/.stack-work` and put the specified package there&quot;."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1483372211, "post_id": 41428937, "comment_id": 70065152, "body": "@sjakobi: I think you&#39;ve answered this question though. The global project is used if <code>stack init</code> (or <code>stack new</code>?) hasn&#39;t been run, and I haven&#39;t entered the directory it creates. If that&#39;s all that&#39;s the issue here, <a href=\"http://stackoverflow.com/q/41429680/656912\">I have a relate follow up.</a>"}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1483375743, "post_id": 41428937, "comment_id": 70066741, "body": "Does <a href=\"https://docs.haskellstack.org/en/stable/GUIDE/#different-databases\" rel=\"nofollow noreferrer\">this section</a> help explain where package that is built, is put?"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1483444930, "post_id": 41428937, "comment_id": 70092106, "body": "@sjakobi: I think explaining the bit about how &quot;implicit global project&quot; in <code>~&#47;.stack&#47;global-project</code> gets used would constitute an answer (along with mentioning how <code>stack exec -- ghc-pkg list</code> can be helpful)."}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 99, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1483369490, "creation_date": 1483368651, "last_edit_date": 1483369490, "question_id": 41428937, "link": "https://stackoverflow.com/questions/41428937/where-does-stack-build-pkg-install-pkg-how-do-i-isolate-the-install-of-pkg", "title": "Where does &#39;stack build PKG&#39; install &#39;PKG&#39;; how do I isolate the install of &#39;PKG&#39;?", "body": "<p>I'm confused about where <code>stack build PKG</code> places the packages it installs. I had thought that, for example</p>\n\n<pre><code>mkdir foo\ncd foo\nstack build PKG_IN_HACKAGE_NOT_IN_RESOLVER\n</code></pre>\n\n<p>would create <code>foo/.stack-work</code> and put the specified package there (as if to had been specified as an \"extra dependency\"); but I seen on <code>.stack-work</code> and the package is available globally on my system.</p>\n\n<p>If what I want is an entirely isolated (temporary) Haskell configuration in which to install and use <code>PKG</code>, how do I do that?</p>\n"}, {"tags": ["haskell", "typeclass", "custom-data-type"], "comments": [{"owner": {"reputation": 1804, "user_id": 1260229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a918b56d3f83f46ced68b33737396b87?s=128&d=identicon&r=PG", "display_name": "sn&#248;reven", "link": "https://stackoverflow.com/users/1260229/sn%c3%b8reven"}, "edited": false, "score": 1, "creation_date": 1483363586, "post_id": 41427571, "comment_id": 70060837, "body": "1a) Looks good, but you always need to add the whole tuples together, not just <code>fst</code> or <code>snd</code>; 1b) looks good;"}, {"owner": {"reputation": 1804, "user_id": 1260229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a918b56d3f83f46ced68b33737396b87?s=128&d=identicon&r=PG", "display_name": "sn&#248;reven", "link": "https://stackoverflow.com/users/1260229/sn%c3%b8reven"}, "edited": false, "score": 1, "creation_date": 1483365208, "post_id": 41427571, "comment_id": 70061705, "body": "2) Have you tried extracting a list of all the possible paths?"}, {"owner": {"reputation": 1804, "user_id": 1260229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a918b56d3f83f46ced68b33737396b87?s=128&d=identicon&r=PG", "display_name": "sn&#248;reven", "link": "https://stackoverflow.com/users/1260229/sn%c3%b8reven"}, "edited": false, "score": 1, "creation_date": 1483365425, "post_id": 41427571, "comment_id": 70061827, "body": "3) I don&#39;t know what <code>x:set1</code> is supposed to mean, this is not Haskell syntax. You just need the two sets/variables <code>set1</code> and <code>set2</code> (or <code>x</code> and <code>y</code> like you used in the longdrink example) and then use some function that checks your desired criterion."}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "reply_to_user": {"reputation": 1804, "user_id": 1260229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a918b56d3f83f46ced68b33737396b87?s=128&d=identicon&r=PG", "display_name": "sn&#248;reven", "link": "https://stackoverflow.com/users/1260229/sn%c3%b8reven"}, "edited": false, "score": 1, "creation_date": 1483366567, "post_id": 41427571, "comment_id": 70062407, "body": "@sn&#248;reven x:set1 is a pattern match on a list. @banzai You have to match on the <code>S</code> constructor from Set too. So <code>S (x:set1)</code>."}, {"owner": {"reputation": 1804, "user_id": 1260229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a918b56d3f83f46ced68b33737396b87?s=128&d=identicon&r=PG", "display_name": "sn&#248;reven", "link": "https://stackoverflow.com/users/1260229/sn%c3%b8reven"}, "edited": false, "score": 1, "creation_date": 1483366668, "post_id": 41427571, "comment_id": 70062459, "body": "ad 3: Sorry I went over that too quickly: The data type doesn&#39;t compile because standard Haskell doesn&#39;t allow typeclass restrictions here (there is the GADTs extensions for doing things like that). You are doing it right with the restriction on the <code>Eq</code> instance. In your <code>(==)</code> function you can just pattern match the &quot;wrapped&quot; lists like so <code>(S xs) == (S ys) = ...</code> and then use the &quot;Set&quot; operations from <code>Data.List</code> on them."}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 1, "creation_date": 1483366711, "post_id": 41427571, "comment_id": 70062477, "body": "@banzai Also you are missing the pattern match on <code>S []</code>."}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "reply_to_user": {"reputation": 1804, "user_id": 1260229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a918b56d3f83f46ced68b33737396b87?s=128&d=identicon&r=PG", "display_name": "sn&#248;reven", "link": "https://stackoverflow.com/users/1260229/sn%c3%b8reven"}, "edited": false, "score": 1, "creation_date": 1483366769, "post_id": 41427571, "comment_id": 70062512, "body": "@sn&#248;reven I don&#39;t think using the set operations from <code>Data.List</code> was the intention of the assignment."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1483366779, "post_id": 41427571, "comment_id": 70062518, "body": "One question per post only, please. After all, an answer might focus only on one of those questions. Which of the answers will you accept? Instead of a StackOverflow answer, you <i>might</i> need a Haskell mentor/tutor."}, {"owner": {"reputation": 1804, "user_id": 1260229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a918b56d3f83f46ced68b33737396b87?s=128&d=identicon&r=PG", "display_name": "sn&#248;reven", "link": "https://stackoverflow.com/users/1260229/sn%c3%b8reven"}, "edited": false, "score": 1, "creation_date": 1483366896, "post_id": 41427571, "comment_id": 70062590, "body": "@Zata: I think that whole thing is more of a topic for the chat than a StackOverflow question anyway."}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1483367244, "post_id": 41427571, "comment_id": 70062780, "body": "Let&#39;s move to chat? <a href=\"https://chat.stackoverflow.com/rooms/132110/function-to-calculate-portions-and-instance-of-a-class-in-haskell\">chat.stackoverflow.com/rooms/132110/&hellip;</a>"}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 1, "creation_date": 1483370976, "post_id": 41427571, "comment_id": 70064640, "body": "@banzai I&#39;m a bit unclear what a path is in 2.. Is this only paths from the root to a leaf or paths from any node to a leaf or paths from any node to any node or leaf?"}, {"owner": {"reputation": 55, "user_id": 4780017, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cec207e58d37f226adf78d5b798184ec?s=128&d=identicon&r=PG&f=1", "display_name": "banzai", "link": "https://stackoverflow.com/users/4780017/banzai"}, "edited": false, "score": 0, "creation_date": 1483376692, "post_id": 41427571, "comment_id": 70067117, "body": "I&#39;m sorry, I thought it would actually be worse to clutter the board with questions rather than posting one. Will remember for the future. Thank you for your answers."}], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 4780017, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cec207e58d37f226adf78d5b798184ec?s=128&d=identicon&r=PG&f=1", "display_name": "banzai", "link": "https://stackoverflow.com/users/4780017/banzai"}, "edited": false, "score": 0, "creation_date": 1483376780, "post_id": 41429787, "comment_id": 70067142, "body": "Thank you, that helps. as for task #2, it&#39;s supposed to count all even paths starting from the root. But I&#39;m working on something for that now thanks to the advice and i think i got it."}], "tags": [], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "is_accepted": true, "score": 0, "last_activity_date": 1483376856, "last_edit_date": 1483376856, "creation_date": 1483372440, "answer_id": 41429787, "question_id": 41427571, "link": "https://stackoverflow.com/questions/41427571/function-to-calculate-portions-and-instance-of-a-class-in-haskell/41429787#41429787", "title": "Function to calculate portions and instance of a class in haskell", "body": "<ol>\n<li><p>a) Almost good, but you have to add up the vodka and energy components of both parts of the mix, not just the vodka from the first and the energy from the second. Furthermore it is often nicer to use pattern-matching instead of accessor methods like <code>fst</code> and <code>snd</code> if possible.</p>\n\n<pre><code>mixPortion :: VodkaEnergy -&gt; (Int,Int)\nmixPortion (Vodka x)  = (x,0)\nmixPortion (Energy y) = (0,y)\nmixPortion (Mix x y)  = (v1+v2,e1+e2)\n  where (v1,e1) = (mixPortion x)\n        (v2,e2) = (mixPortion y)\n</code></pre>\n\n<p>b) is correct.</p></li>\n<li><p>As I said in the comment I don't really know what exactly question wants. Assuming that the task is to find the number of even paths from the root to any leaf, you could approach it like this: You write a function <code>evenOddBranches :: Tree -&gt; (Int,Int)</code> that gives the number of even paths and odd paths. This is easier, since an even path of a subtree of a node is an odd path if you add that node to the path. That way you get a simple recursion: The number even paths of a node are the sum of the odd paths of it's two subtrees and the number odd paths is the sum of the even paths of the subtrees.</p></li>\n<li><p>The <code>Eq</code> constraint on <code>Set</code> used to be correct syntax but isn't anymore since Haskell 2010. The correct way to do this is to just leaf out the <code>Eq</code> constraint in the data definition and add it where needed.</p>\n\n<p>There are also some flaws with your code. First of all you can not pattern-match on it with <code>x:set1</code>, because it is not a list, but a <code>Set</code>, which means you have the <code>S</code> wrapper. So instead you have to pattern-match like this: <code>S (x:xs)</code>. Note that <code>xs</code> is a list and not a <code>Set</code>, so for the recursive call you have to wrap it with <code>S</code> again. Furthermore if you match on <code>S (x:xs)</code> you should also match on <code>S []</code>. So fixing your code on a syntactical level we get the following:</p>\n\n<pre><code>data Set a = S [a]\ninstance (Eq a) =&gt; Eq (Set a) where\n  S [] == S []     = True\n  S [] == S (_:_)  = False\n  S (x:xs) == S ys = x `elem` ys &amp;&amp; S xs == S ys &amp;&amp; S ys == S xs\n</code></pre>\n\n<p>This will compile but does not work. For example with <code>S [0] == S [0]</code> is <code>False</code>.</p>\n\n<p>The easiest way to write a set equality is with two set inclusions. So you should write a function <code>subsetEq :: Eq a =&gt; Set a -&gt; Set a -&gt; Bool</code> that is <code>True</code> iff every element of the first set is also an element of the second set. Then you can implement set equality like this:</p>\n\n<pre><code>instance (Eq a) =&gt; Eq (Set a) where\n  set1 == set2 = set1 `subsetEq` set2 &amp;&amp; set2 `subsetEq` set1\n</code></pre>\n\n<p>I think with only an <code>Eq</code> constraint this is actually the best you can do.</p></li>\n</ol>\n"}], "owner": {"reputation": 55, "user_id": 4780017, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cec207e58d37f226adf78d5b798184ec?s=128&d=identicon&r=PG&f=1", "display_name": "banzai", "link": "https://stackoverflow.com/users/4780017/banzai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 41429787, "answer_count": 1, "score": 0, "last_activity_date": 1483376856, "creation_date": 1483362891, "question_id": 41427571, "link": "https://stackoverflow.com/questions/41427571/function-to-calculate-portions-and-instance-of-a-class-in-haskell", "title": "Function to calculate portions and instance of a class in haskell", "body": "<p>in preparation for an exam on haskell our teacher gave us some exercises but was then sick on the day we were supposed to discuss them.\nSome of them I solved, some of them I can't figure out:</p>\n\n<p>1) Write a function that calculates the parts of vodka and energy in a longdrink:</p>\n\n<pre><code>data VodkaEnergy = Vodka Int | Energy Int | Mix VodkaEnergy VodkaEnergy\n</code></pre>\n\n<p>I didn't manage to do much more than:</p>\n\n<pre><code>mixPortion :: VodkaEnergy-&gt;(Int,Int)\nmixPortion (Vodka x) = (x,0)\nmixPortion (Energy y) = (0,y)\nmixPortion (Mix x y) = (a,b)\n where a = fst (mixPortion x)\n       b = snd (mixPortion y)\n</code></pre>\n\n<p>I realize this is a oversimplified solution that doesn't catch all inputs but I'm at a loss.</p>\n\n<p>1b) VodkaEnergy should be a part of Eq, making 2 longdrinks equal if they have the same ratio of vodka and energy.</p>\n\n<p>This one I can't solve until I have the function but I'm assuming it would go like this:</p>\n\n<pre><code>instance Eq VodkaEnergy where\n x == y    = mixPortion x == mixPortion y\n</code></pre>\n\n<p>typeclasses are still difficult for me, so do correct me.</p>\n\n<p>2) Write a function that counts the paths that has an even amount of Leaves + Nodes in</p>\n\n<pre><code>data Tree = Leaf Int | Ndoe Int Tree Tree\n</code></pre>\n\n<p>Again, at a loss all I got so far is a function that counts all nodes and leaves in the tree, which doesn't help much</p>\n\n<p>3)</p>\n\n<pre><code>data Eq a =&gt; Set a = S [a]\n</code></pre>\n\n<p>Make set an instance of Eq, where two sets are the same if all elements of set1 are contained in set2 and vice versa.</p>\n\n<p>This one confuses me because the data type in the task doesn't compile with the \"Eq a =>\" there. But what I tried so far is this:</p>\n\n<pre><code>instance (Eq a) =&gt; Eq (Set a) where\n x:set1 == set2      = x `elem` set2 &amp;&amp; set1 == set2 &amp;&amp; set2 == set1\n</code></pre>\n\n<p>but the \"x:set1\" part doesn't compile because it expects a different type</p>\n\n<p>I know these are probably newbie questions. I mean, I AM a newbie to haskell. I'm finding it hard to find good ressources for questions on haskell like these, so do link me if I missed the answers floating on the web somewhere. I'm honestly a little desperate, the exam is coming closer and I still don't quite 'get' functional programming.\nThank you very much for any help.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1483347225, "post_id": 41423562, "comment_id": 70052856, "body": "Note that you had to use <code>let ... = ...</code> in GHCi prior to version 8."}], "answers": [{"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1483347351, "post_id": 41423725, "comment_id": 70052940, "body": "Hm. Now that I found the duplicate, should I delete my answer?"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 0, "last_activity_date": 1483347145, "creation_date": 1483347145, "answer_id": 41423725, "question_id": 41423562, "link": "https://stackoverflow.com/questions/41423562/haskell-ghci-script-versus-direct-entry/41423725#41423725", "title": "Haskell: GHCi script versus direct entry", "body": "<p>The later definition of <code>altmap</code> overrides the older one. Therefore, you really only have one pattern defined.</p>\n\n<p>Basically, you did this:</p>\n\n<pre><code>ghci&gt; x = 5\nghci&gt; x = 42\nghci&gt; print x\n42\n</code></pre>\n\n<p>You either need to define both in the same line or use multi-lines:</p>\n\n<pre><code>*Main Lib&gt; altmap f g [] = []; altmap f g (x:y:xs) = f x : g y : atmap f g xs\n</code></pre>\n\n<p>Note that <code>altmap f g xs</code> can also be written as <code>zipWith ($) (cycle [f,g]) xs</code>.</p>\n\n<p>For your additional question: the modules before the <code>&gt;</code> are the ones you have currently imported. So you have imported <code>Main</code> (with all symbols) and <code>Lib</code>. Have a look at the GHC documentation for more information.</p>\n"}], "owner": {"reputation": 67, "user_id": 3150422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2191bc1435b756d5b3f46e9c9e2404ce?s=128&d=identicon&r=PG&f=1", "display_name": "user3150422", "link": "https://stackoverflow.com/users/3150422/user3150422"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 96, "favorite_count": 0, "closed_date": 1483347184, "answer_count": 1, "score": 1, "last_activity_date": 1483347145, "creation_date": 1483346189, "last_edit_date": 1483346854, "question_id": 41423562, "link": "https://stackoverflow.com/questions/41423562/haskell-ghci-script-versus-direct-entry", "closed_reason": "Duplicate", "title": "Haskell: GHCi script versus direct entry", "body": "<p>Working through Hutton's new text, I encountered strange behavior in ghci.  When I load the function altmap from a text file, it behaves correctly; however typing the same two lines directly into ghci gives the error shown below:</p>\n\n<pre><code>*Main Lib&gt; altmap f g [] = []\n\n*Main Lib&gt; altmap f g (x:y:xs) = (f x):(g y):(altmap f g xs)\n\n*Main Lib&gt; altmap (2*) (3*) [1,2,3,4,5,6]\n\n[2,6,6,12,10,18*** Exception: interactive:2:1-49: Non-exhaustive patterns in function altmap\n</code></pre>\n\n<p>While I'm at it, can someone explain the difference between \"Prelude\" and \"Main Lib\" ? I'm using the rc2 release of ghc 8.0.2</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 10256, "user_id": 1139023, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/7e720df07b8a3ef623cf6a7587f21ab8?s=128&d=identicon&r=PG", "display_name": "Ashwin", "link": "https://stackoverflow.com/users/1139023/ashwin"}, "edited": false, "score": 0, "creation_date": 1483347322, "post_id": 41422277, "comment_id": 70052921, "body": "If dollar is a function shouldn&#39;t the function part be applied be applied to parameters instead of the applying the function to a paramter. I am pretty sure that I have got something wrong :) Just not able to figure what I have got wrong"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 10256, "user_id": 1139023, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/7e720df07b8a3ef623cf6a7587f21ab8?s=128&d=identicon&r=PG", "display_name": "Ashwin", "link": "https://stackoverflow.com/users/1139023/ashwin"}, "edited": false, "score": 0, "creation_date": 1483347394, "post_id": 41422277, "comment_id": 70052960, "body": "@Ashwin err, what? What do you mean by &quot;shouldn&#39;t the function part be applied be applied to parameters instead of the applying the function to a paramter&quot;?"}, {"owner": {"reputation": 10256, "user_id": 1139023, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/7e720df07b8a3ef623cf6a7587f21ab8?s=128&d=identicon&r=PG", "display_name": "Ashwin", "link": "https://stackoverflow.com/users/1139023/ashwin"}, "edited": false, "score": 0, "creation_date": 1483347396, "post_id": 41422277, "comment_id": 70052962, "body": "I mean  shouldn&#39;t it be other way around. (4+) should take 3 as parameter instead of 3 taking (4+) as parameter?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 10256, "user_id": 1139023, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/7e720df07b8a3ef623cf6a7587f21ab8?s=128&d=identicon&r=PG", "display_name": "Ashwin", "link": "https://stackoverflow.com/users/1139023/ashwin"}, "edited": false, "score": 1, "creation_date": 1483347445, "post_id": 41422277, "comment_id": 70053005, "body": "No. <code>($3)</code> takes <code>(4+)</code> as &quot;parameter&quot;. Remember <code>($3)</code> is a shorthand for <code>($3) = \\f -&gt; f $ 3</code>, so <code>($3) (4+)</code> is <code>(4+) 3</code> or <code>4 + 3</code>"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 5, "last_activity_date": 1483338560, "creation_date": 1483338560, "answer_id": 41422277, "question_id": 41422170, "link": "https://stackoverflow.com/questions/41422170/need-help-in-understanding-the-function-application-operator-in-haskell/41422277#41422277", "title": "Need help in understanding the function application operator in haskell", "body": "<p>Remember that <code>($)</code> is actually a function:</p>\n\n<pre><code>($) :: (a -&gt; b) -&gt; a -&gt; b\nf $ x = f x\n</code></pre>\n\n<p><code>($ 3)</code> is shorthand for <code>\\f -&gt; (f $ 3)</code>. And its type? Well:</p>\n\n<pre><code>3     ::                  Double -- for sake of simplicity\n($)   :: (a      -&gt; b) -&gt; a      -&gt; b\n($ 3) :: (Double -&gt; b)           -&gt; b\n</code></pre>\n\n<p>So <code>($ 3)</code> is a function that takes a function from <code>Double</code> to something and applies that function to <code>3</code>. Now, if we use <code>map</code>, we end up with:</p>\n\n<pre><code>map ($ 3) [(4+), (10*), (^2), sqrt]  \n = [($ 3) (4+), ($ 3) (10*), ($ 3)(^2), ($ 3) sqrt]  \n = [(4+) $ 3, (10*) $ 3, (^2) $ 3, sqrt $ 3]  \n = [4 + 3, 10 * 3, 3 ^ 2, sqrt 3]\n = [7, 30, 9, sqrt 3]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 10256, "user_id": 1139023, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/7e720df07b8a3ef623cf6a7587f21ab8?s=128&d=identicon&r=PG", "display_name": "Ashwin", "link": "https://stackoverflow.com/users/1139023/ashwin"}, "edited": false, "score": 0, "creation_date": 1483347028, "post_id": 41422424, "comment_id": 70052764, "body": "How did you rewrite ($3) (4+) as ($) (4+) 3  ?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 10256, "user_id": 1139023, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/7e720df07b8a3ef623cf6a7587f21ab8?s=128&d=identicon&r=PG", "display_name": "Ashwin", "link": "https://stackoverflow.com/users/1139023/ashwin"}, "edited": false, "score": 2, "creation_date": 1483347696, "post_id": 41422424, "comment_id": 70053120, "body": "@Ashwin: <code>($3) = \\f -&gt; f $ 3</code>, or <code>\\f -&gt; ($) f 3</code> in prefix notation. Replace <code>f</code> by <code>(4+)</code>."}], "tags": [], "owner": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "is_accepted": false, "score": 3, "last_activity_date": 1506552981, "last_edit_date": 1506552981, "creation_date": 1483339463, "answer_id": 41422424, "question_id": 41422170, "link": "https://stackoverflow.com/questions/41422170/need-help-in-understanding-the-function-application-operator-in-haskell/41422424#41422424", "title": "Need help in understanding the function application operator in haskell", "body": "<p>Let's first review the type signature of <code>($)</code>:</p>\n\n<pre><code>ghci&gt;&gt; :t ($)\n($) :: (a -&gt; b) -&gt; a -&gt; b\n</code></pre>\n\n<p>And definition:</p>\n\n<pre><code>($) f x = f x\n</code></pre>\n\n<p>Or:</p>\n\n<pre><code>f $ x = f x\n</code></pre>\n\n<p>And above, we have a <strong>section</strong> where we've created a partially applied version of <code>($)</code> with the second argument (of type <code>a</code>) set as <code>3</code>. Now, we know that <code>3</code> has type <code>Num a =&gt; a</code>, so the type signature of our partial application must be <code>Num a =&gt; (a -&gt; b) -&gt; b</code>.</p>\n\n<p>Next, let's look at each of the functions in our list, each of which will be an argument to ($ 3). As expected, they are functions and it turns out that their type <code>Num a -&gt; a -&gt; a</code> is actually more constrained than was required (so we're good). Just to be clear, we can look at what one application would entail:</p>\n\n<pre><code>($3) (4+)\n</code></pre>\n\n<p>Which we can rewrite without the section as:</p>\n\n<pre><code>($) (4+) 3\n</code></pre>\n\n<p>At which point it's pretty clear from the function definition above how application proceeds.</p>\n\n<p>The last confusing part might be about the type of the list <code>($3) (4+)</code> evaluates as <code>7</code>, rather than <code>7.0</code> in the repl. If we recall that lists are homogeneous and notice that one of the functions in the list, <code>sqrt</code>, accepts and returns a floating value, we see that this type enforced for all applications.</p>\n"}], "owner": {"reputation": 10256, "user_id": 1139023, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/7e720df07b8a3ef623cf6a7587f21ab8?s=128&d=identicon&r=PG", "display_name": "Ashwin", "link": "https://stackoverflow.com/users/1139023/ashwin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 0, "accepted_answer_id": 41422277, "answer_count": 2, "score": 2, "last_activity_date": 1506552981, "creation_date": 1483337883, "question_id": 41422170, "link": "https://stackoverflow.com/questions/41422170/need-help-in-understanding-the-function-application-operator-in-haskell", "title": "Need help in understanding the function application operator in haskell", "body": "<p>This haskell piece of code     </p>\n\n<pre><code>map ($ 3) [(4+), (10*), (^2), sqrt]  \n</code></pre>\n\n<p>gives the output </p>\n\n<pre><code>[7.0,30.0,9.0,1.7320508075688772]  \n</code></pre>\n\n<p>I know that $ has the lowest precedence and hence the expression to the right of $ is evaluated together. But what I don't understand is how does ($ 3) behave as a function (Because Map takes a function and a list as parameters). I don't understand why each function in the list is applied to 3.\n<br></p>\n"}, {"tags": ["haskell", "infix-notation"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1483338709, "post_id": 41422137, "comment_id": 70050057, "body": "<a href=\"http://hayoo.fh-wedel.de/?query=%28a+-%3E+b%29+-%3E+%28b+-%3E+c%29+-%3E+a+-%3E+c\" rel=\"nofollow noreferrer\">This</a> may interest you. Right off the bat, <code>(|&gt;)</code> from <a href=\"http://hackage.haskell.org/package/hx-0.4/docs/Haskell-X-Ops.html#v:-124--62-\" rel=\"nofollow noreferrer\">here</a> might be what you want."}, {"owner": {"reputation": 1044, "user_id": 4469745, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/ae66806e9a5fc63482f58779c34d0f69?s=128&d=identicon&r=PG&f=1", "display_name": "xiang", "link": "https://stackoverflow.com/users/4469745/xiang"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1483344033, "post_id": 41422137, "comment_id": 70051731, "body": "@Alec Thank you very much"}], "owner": {"reputation": 1044, "user_id": 4469745, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/ae66806e9a5fc63482f58779c34d0f69?s=128&d=identicon&r=PG&f=1", "display_name": "xiang", "link": "https://stackoverflow.com/users/4469745/xiang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 89, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1483337667, "creation_date": 1483337667, "question_id": 41422137, "link": "https://stackoverflow.com/questions/41422137/is-there-a-infix-function-equivalent-for-flip-has-same-or-nearby-infix-lev", "title": "Is there a infix function equivalent for `flip (.)` has same or nearby infix level with `(.)`?", "body": "<p>Is there a infix function equivalent for <code>flip (.)</code> has same or nearby infix level with <code>(.)</code> ? </p>\n\n<p>(not self defined, just like  <code>flip ($)</code> for <code>(&amp;)</code> in module <code>Data.Function</code>)</p>\n\n<p>In <code>Control.Category</code>, <code>(&lt;&lt;&lt;)</code> and <code>(&gt;&gt;&gt;)</code> is <code>infixr 1</code>, and <code>(.)</code> is <code>infixr 9</code>,  the infix level between them are too far away.</p>\n"}, {"tags": ["haskell", "category-theory"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1483348298, "post_id": 41421367, "comment_id": 70053390, "body": "Does that kind-check? I&#39;d expect <code>L :: s x -&gt; (s :+: t) (&#39;Left x)</code>"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1483356432, "post_id": 41421367, "comment_id": 70057249, "body": "@chi I think that&#39;s the answer the questioneer is looking for."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 5, "creation_date": 1483357696, "post_id": 41421367, "comment_id": 70057859, "body": "The short answer is: the uniform version keeps &quot;choice&quot; separate from &quot;reindexing&quot;. The proposed thing is a <i>particular</i> reindexing, which can be coded readily. (By the way, I think chi is correct that there is a kind error but has fixed up the output index instead of the input index.) I&#39;ll try to write a proper answer later, but I&#39;ve got to run."}, {"owner": {"reputation": 365, "user_id": 3117573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TEuTH.jpg?s=128&g=1", "display_name": "mnish", "link": "https://stackoverflow.com/users/3117573/mnish"}, "edited": false, "score": 0, "creation_date": 1483359624, "post_id": 41421367, "comment_id": 70058859, "body": "If  this is intended to construct a comma category, then the original version seems categorically &#39;more correct&#39;."}], "answers": [{"tags": [], "owner": {"reputation": 452, "user_id": 2006135, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef3ac5dd2108e05f505ff9ed04740196?s=128&d=identicon&r=PG", "display_name": "Erik Schnetter", "link": "https://stackoverflow.com/users/2006135/erik-schnetter"}, "is_accepted": false, "score": 0, "last_activity_date": 1483547055, "creation_date": 1483547055, "answer_id": 41468646, "question_id": 41421367, "link": "https://stackoverflow.com/questions/41421367/sum-of-indexed-functors/41468646#41468646", "title": "Sum of indexed functors", "body": "<p>@chi Thanks for your pointer. It turns out I was wrong -- my suggestion doesn't work, it is not possible to combine different inputs. However, it is possible to use <code>Either</code> for the output kinds, leading to the constructor @chi suggested:</p>\n\n<pre><code>data (:+:) :: (i -&gt;- o) -&gt; (i -&gt;- u) -&gt; (i -&gt;- Either o u) where\n    L :: s x o -&gt; (s :+: t) x ('Left o)\n    R :: t x u -&gt; (s :+: t) x ('Right u)\n</code></pre>\n\n<p>Both the <code>:+:</code> and the <code>:*:</code> types on the slides take two types as arguments, i.e. essentially a pair of arguments. I believe my suggestion might work if they took an alternative (i.e. an <code>Either</code>) of type arguments, as in</p>\n\n<pre><code>data (:|:) :: Either (i -&gt;- o) (j -&gt;- o) -&gt; (Either i j -&gt;- o)\n</code></pre>\n"}], "owner": {"reputation": 452, "user_id": 2006135, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef3ac5dd2108e05f505ff9ed04740196?s=128&d=identicon&r=PG", "display_name": "Erik Schnetter", "link": "https://stackoverflow.com/users/2006135/erik-schnetter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 176, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1483547055, "creation_date": 1483331472, "question_id": 41421367, "link": "https://stackoverflow.com/questions/41421367/sum-of-indexed-functors", "title": "Sum of indexed functors", "body": "<p>In <a href=\"http://strictlypositive.org/slicing-jpgs/\" rel=\"nofollow noreferrer\">Slicing It</a>, Conor McBride develops indexed functors, and then describes their sums and products on a slide \"Sum and Product\" (slides are unlabelled, about 90% into the presentation). This slide begins</p>\n\n<pre><code>-- sum - choose between compatible structures\ndata (:+:) :: (i -&gt;- o) -&gt; (i -&gt;- o) -&gt; (i -&gt;- o) where\n    L :: s x :-&gt; (s :+: t) x\n    R :: t x :-&gt; (s :+: t) x\ninstance (IFunctor s, IFunctor t) =&gt; IFunctor (s :+: t) where\n    imap f (L sx) = L (imap f sx)\n    imap f (R tx) = R (imap f tx)\n</code></pre>\n\n<p>In particular, this definition of <code>:+:</code> requires that both indexed functors have the same source index <code>i</code>. I wonder why this is the case. Can this be relaxed e.g. to allowing</p>\n\n<pre><code>-- sum - choose between compatible structures\ndata (:+:) :: (i -&gt;- o) -&gt; (j -&gt;- o) -&gt; (Either i j -&gt;- o) where\n    L :: s x :-&gt; (s :+: t) x\n    R :: t x :-&gt; (s :+: t) x\n</code></pre>\n\n<p>where <code>i</code> and <code>j</code> are now different types?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 1, "last_activity_date": 1483320163, "last_edit_date": 1483320163, "creation_date": 1483316461, "answer_id": 41420191, "question_id": 41420060, "link": "https://stackoverflow.com/questions/41420060/controlling-array-fill-in-haskell/41420191#41420191", "title": "Controlling array fill in Haskell", "body": "<p>From <a href=\"https://hackage.haskell.org/package/array-0.5.1.1/docs/Data-Array.html#v:array\" rel=\"nofollow noreferrer\">the docs</a>:</p>\n\n<blockquote>\n  <p><code>array</code> is strict in the bounds argument and in the indices of the association list, but non-strict in the values.</p>\n</blockquote>\n\n<p>So your expression will compute only the entries that you actually use. Your <code>z</code> is effectively a memo table for the recursive function you specified at the top of your question, and the run-time evaluation order is naturally controlled by the data dependencies in your code work out. In other words, <code>z ! (i, j)</code> will be computed efficiently for free, thanks to laziness.</p>\n\n<p>On the question of the readability of your code: I find your functional implementation far more readable than your procedural one. The Haskell code is a lot closer to the specification you gave using the programming language called <em>maths</em>: whereas your C code talks about incrementing indexes and accumulating totals, in Haskell you're actually talking about making recursive calls to <code>z</code> over a range of values and summing the results. You could use list comprehensions instead of <code>map</code> to make it look even more similar to the mathematical notation:</p>\n\n<pre><code>z = array ((0,0), (10,10))\n       [((i, j), 1 + sum [z ! (i, k) | k &lt;- [0..j-1]]\n                   + sum [z ! (k, j) | k &lt;- [0..i-1]]) | i &lt;- [0..10], j &lt;- [0..10]]\n</code></pre>\n"}], "owner": {"reputation": 967, "user_id": 1465472, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/64ca2c1540eb6254acb10aec1958655c?s=128&d=identicon&r=PG", "display_name": "Mike Flynn", "link": "https://stackoverflow.com/users/1465472/mike-flynn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 281, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1483320163, "creation_date": 1483314767, "last_edit_date": 1483315661, "question_id": 41420060, "link": "https://stackoverflow.com/questions/41420060/controlling-array-fill-in-haskell", "title": "Controlling array fill in Haskell", "body": "<p>Let's say I have a simple recursive function</p>\n\n<pre><code>Z(i,j) = Sum(Z(i, k), k = 0..j-1) + Sum(Z(k, j), k = 0..i-1) \nZ(0,0) = 1\n</code></pre>\n\n<p>If you lay this out in a table, with (0,0) on the bottom left and (i,j) on the top right, you can see that in general, all cells only depend on each of the cells to their left and below, and the top-left to bottom-right diagonals can all be computed in parallel. </p>\n\n<p>For a language like C, I might implement the dynamic programming fill starting from the bottom-left and working my way up the columns:</p>\n\n<pre><code>// for Z[n][m] \nfor(i = 0; i &lt;= n; i++) {\n for(j = 0; j &lt;= m; j++) {\n  for(k = 0; k &lt; j; k++) {\n   Z[i,j] += Z(i, k)\n  }\n  for(k = 0; k &lt; i; k++) {\n   Z[i,j] += Z(k, j)\n  }\n }\n}\n</code></pre>\n\n<p>If I wanted to parallelize this, I could simply collect the indices of the diagonal that is currently working, and then dispatch the appropriate function on each of the indices.</p>\n\n<p>In Haskell I could do something like:</p>\n\n<pre><code>z = array ((0,0), (10,10))\n       [((i, j), 1 + (sum (map (\\x -&gt; z ! (i, x)) [0..j-1]))  +\n                 (sum (map (\\x -&gt; z ! (x, j)) [0..i-1]))) | i &lt;- [0..10], j &lt;- [0..10]]\n</code></pre>\n\n<p>There are a couple of things I don't like about this. 1: it is harder to read and less clear what is going on. 2: I have no control over the execution order. How do I know if Haskell is filling the array in the most efficient way possible? Is there a way to implement this in Haskell so that it is both easy to read and I have control over the computational flow?</p>\n"}, {"tags": ["c", "haskell", "ffi"], "comments": [{"owner": {"reputation": 420, "user_id": 6496011, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5da204ac4ee7e380ab27daa05996a2a?s=128&d=identicon&r=PG&f=1", "display_name": "Antisthenes", "link": "https://stackoverflow.com/users/6496011/antisthenes"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1483309505, "post_id": 41419355, "comment_id": 70044444, "body": "I overlooked that i was copying from old version. Fixed that in the question."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1483309864, "post_id": 41419355, "comment_id": 70044524, "body": "What version of GHC are you using? You might want to do some error checking in <code>enorm</code>."}, {"owner": {"reputation": 420, "user_id": 6496011, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5da204ac4ee7e380ab27daa05996a2a?s=128&d=identicon&r=PG&f=1", "display_name": "Antisthenes", "link": "https://stackoverflow.com/users/6496011/antisthenes"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1483310070, "post_id": 41419355, "comment_id": 70044562, "body": "8.0.1. I will check status of cudaMalloc and cublasnorm, and add them to question."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1483310201, "post_id": 41419355, "comment_id": 70044583, "body": "You may be running into <a href=\"https://ghc.haskell.org/trac/ghc/ticket/12573\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/12573</a>. Worth trying with an older version of GHC."}, {"owner": {"reputation": 420, "user_id": 6496011, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5da204ac4ee7e380ab27daa05996a2a?s=128&d=identicon&r=PG&f=1", "display_name": "Antisthenes", "link": "https://stackoverflow.com/users/6496011/antisthenes"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1483317516, "post_id": 41419355, "comment_id": 70045892, "body": "Using ghc-7.10.3 helped. Thank you very much for quick response."}], "owner": {"reputation": 420, "user_id": 6496011, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5da204ac4ee7e380ab27daa05996a2a?s=128&d=identicon&r=PG&f=1", "display_name": "Antisthenes", "link": "https://stackoverflow.com/users/6496011/antisthenes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 155, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1535552971, "creation_date": 1483307524, "last_edit_date": 1535552971, "question_id": 41419355, "link": "https://stackoverflow.com/questions/41419355/passing-storable-vector-to-a-c-function-allocating-stored-data-on-gpu", "title": "Passing Storable Vector to a C function allocating stored data on GPU", "body": "<p>I have the following C code:</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;math.h&gt;\n#include &lt;cuda_runtime.h&gt;\n#include &lt;cublas_v2.h&gt;\n\ndouble enorm(double* v1, int length){\n    cublasHandle_t handle;\n    double result = 0;\n    double* vector;\n    cudaMalloc((void**) &amp;vector, length * sizeof(double));\n    cublasSetVector(length, sizeof(double), v1, 1, vector,1);\n    cublasCreate(&amp;handle);\n    cublasDnrm2(handle, length, vector, 1, &amp;result);\n    cudaFree(vector);\n    return result;\n}\n\ndouble testnorm(double* v1, int len){\n    double tmp = 0;\n    for(int i = 0; i &lt; len; i++){\n        tmp += v1[i]*v1[i];\n    }\n    return sqrt(tmp);\n}\n\nint main() {\n    double* a = malloc(2 * sizeof(double));\n    a[0] = 3;\n    a[1] = 4;\n    printf(\"%.f\\n\", enorm(a, 2));\n    printf(\"%.f\\n\", testnorm(a,2));\n    return 0;\n}\n</code></pre>\n\n<p>And following Haskell code, which borrows functions from above:</p>\n\n<pre><code>import qualified Foreign.Ptr as P\nimport System.IO.Unsafe\nimport Foreign.C.Types\nimport qualified Data.Vector.Storable as SV\nimport Foreign.C.Types\n\nforeign import ccall \"enorm\" c_enorm :: P.Ptr CDouble -&gt; CInt -&gt; CDouble\n\nforeign import ccall \"testnorm\" c_testnorm :: P.Ptr CDouble -&gt; CInt -&gt; CDouble\n\nenorm :: SV.Vector CDouble -&gt; CDouble\nenorm v1 = unsafePerformIO $ do\n  let len = fromIntegral $ SV.length v1\n  SV.unsafeWith v1 $ \\ptr -&gt; return (c_enorm ptr len)\n\ntestnorm :: SV.Vector CDouble -&gt; CDouble\ntestnorm v1 = unsafePerformIO $ do\n  let len = fromIntegral $ SV.length v1\n  SV.unsafeWith v1 $ \\ptr -&gt; return (c_testnorm ptr len)\n\nmain :: IO ()\nmain = do\n  let a = SV.fromList [3,4] :: SV.Vector CDouble\n  print $ enorm a\n  print $ testnorm a\n</code></pre>\n\n<p>For some reason even though C program returns, as expected 5 and 5, the Haskell equivalent returns 0 and 5 which means that even though array is successfully passed to C function, there is some problem with copying this data to GPU. What is the cause of this behavior and how to do it so that it would give expected result?</p>\n\n<p>C is compiled with:</p>\n\n<pre><code>gcc -o cmain blas.c -I/opt/cuda/include -L/opt/cuda/lib64 -lcublas -lcudart -lm\n</code></pre>\n\n<p>Haskell:</p>\n\n<pre><code>gcc -c -fPIC -o testblas.o blas.c -I/opt/cuda/include -L/opt/cuda/lib64 -lcublas -lcudart -lm\ngcc -shared -o libtestblas.so  testblas.o\nghc -o main Main.hs -I/opt/cuda/include -L/opt/cuda/lib64 -lcublas -lcudart -lm -L./ -ltestblas\nexport LD_LIBRARY_PATH=./; ./main \n</code></pre>\n\n<p>EDIT: In Haskell cudaMalloc returns cudaErrorMemoryAllocation (unable to allocate enough memory) while in C everything ends with success.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 37744, "user_id": 578411, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/qj33e.png?s=128&g=1", "display_name": "rene", "link": "https://stackoverflow.com/users/578411/rene"}, "edited": false, "score": 4, "creation_date": 1483306211, "post_id": 41419163, "comment_id": 70043611, "body": "I think this is a duplicate: <a href=\"http://stackoverflow.com/q/20690304/578411\">stackoverflow.com/q/20690304/578411</a>"}, {"owner": {"reputation": 420, "user_id": 6496011, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5da204ac4ee7e380ab27daa05996a2a?s=128&d=identicon&r=PG&f=1", "display_name": "Antisthenes", "link": "https://stackoverflow.com/users/6496011/antisthenes"}, "edited": false, "score": 0, "creation_date": 1483309698, "post_id": 41419163, "comment_id": 70044488, "body": "Could you show your script?"}], "owner": {"user_type": "does_not_exist", "display_name": "user3292534"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 33, "favorite_count": 0, "closed_date": 1483336312, "answer_count": 0, "score": 1, "last_activity_date": 1483305859, "creation_date": 1483305859, "question_id": 41419163, "link": "https://stackoverflow.com/questions/41419163/transforming-ghci-snippet-to-a-script", "closed_reason": "Duplicate", "title": "transforming ghci snippet to a script", "body": "<p>I've came up with this:</p>\n\n<pre><code>Prelude&gt; let a = \\x -&gt; print x\nPrelude&gt; let b = \\x -&gt; return x\nPrelude&gt; b 123 &gt;&gt;= a\n123\n</code></pre>\n\n<p>My problem is, script version does not compile:</p>\n\n<pre><code>monad_1.hs:2:11:\n    No instance for (Monad m0) arising from a use of \u2018return\u2019\n    The type variable \u2018m0\u2019 is ambiguous\n    Relevant bindings include b :: a -&gt; m0 a (bound at monad_1.hs:2:1)\n    Note: there are several potential instances:\n      instance Monad Maybe -- Defined in \u2018GHC.Base\u2019\n      instance Monad IO -- Defined in \u2018GHC.Base\u2019\n      instance Monad ((-&gt;) r) -- Defined in \u2018GHC.Base\u2019\n      ...plus one other\n    In the expression: return x\n    In the expression: \\ x -&gt; return x\n    In an equation for \u2018b\u2019: b = \\ x -&gt; return x\n</code></pre>\n"}, {"tags": ["haskell", "gcc", "ghc", "haskell-stack"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1483309900, "post_id": 41419102, "comment_id": 70044532, "body": "It would help if you could provide the failing <code>gcc</code> invocation. Probably adding <code>-v</code> to that <code>ghc-options</code> line would do it."}, {"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "edited": false, "score": 1, "creation_date": 1483313404, "post_id": 41419102, "comment_id": 70045191, "body": "something like this? <a href=\"https://ghc.haskell.org/trac/ghc/ticket/12759\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/12759</a>"}, {"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "edited": false, "score": 0, "creation_date": 1483341552, "post_id": 41419102, "comment_id": 70050914, "body": "Hmm, is this a bug then? Updated post with gcc call"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 2, "creation_date": 1483343638, "post_id": 41419102, "comment_id": 70051593, "body": "<a href=\"https://www.fpcomplete.com/blog/2016/10/static-compilation-with-stack\" rel=\"nofollow noreferrer\">This blog post</a> which uses Alpine and Musl may be a more reliable approach. You can see it in practice in <a href=\"https://github.com/fpco/stack-docker-image-build/blob/master/build-static.sh\" rel=\"nofollow noreferrer\">this build script</a>."}, {"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "edited": false, "score": 0, "creation_date": 1483355072, "post_id": 41419102, "comment_id": 70056527, "body": "Excellent post &amp; example, but it unfortunately results in <code>Error parsing targets: The specified targets matched no packages. Perhaps you need to run &#39;stack init&#39;?</code>"}, {"owner": {"reputation": 7714, "user_id": 149901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1a6db7a9fb5385fde6ba426e27d5ac6?s=128&d=identicon&r=PG", "display_name": "ondra", "link": "https://stackoverflow.com/users/149901/ondra"}, "edited": false, "score": 0, "creation_date": 1483355680, "post_id": 41419102, "comment_id": 70056870, "body": "Why do you need a static linking?"}, {"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "edited": false, "score": 0, "creation_date": 1483358774, "post_id": 41419102, "comment_id": 70058388, "body": "Deploying to AWS Lambda fails with vrtsioning warnings and a returncode of - 11 if I bundle all libs. AWS recommends you deploy static bins to Lambda also."}, {"owner": {"reputation": 7714, "user_id": 149901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1a6db7a9fb5385fde6ba426e27d5ac6?s=128&d=identicon&r=PG", "display_name": "ondra", "link": "https://stackoverflow.com/users/149901/ondra"}, "edited": false, "score": 0, "creation_date": 1483361598, "post_id": 41419102, "comment_id": 70059851, "body": "Depends on libs you use, 7.10.3 (stack lts-6.25) binary seems to work on lambda withour problems."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1483363274, "post_id": 41419102, "comment_id": 70060679, "body": "I think you left out many important flags from the gcc invocation, such as the actual object files it is supposed to link, or the <code>-o</code> flag."}], "answers": [{"tags": [], "owner": {"reputation": 193, "user_id": 1584186, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a4ec10e07f5fe8d78d7227180dcfc9da?s=128&d=identicon&r=PG", "display_name": "Er&#232;be", "link": "https://stackoverflow.com/users/1584186/er%c3%a8be"}, "is_accepted": false, "score": 4, "last_activity_date": 1516017278, "last_edit_date": 1516017278, "creation_date": 1483360973, "answer_id": 41427067, "question_id": 41419102, "link": "https://stackoverflow.com/questions/41419102/haskell-stack-static-binary-relocation-r-x86-64-32-against-tmc-end-can-not/41427067#41427067", "title": "Haskell Stack Static Binary relocation R_X86_64_32 against `__TMC_END__&#39; can not be used when making a shared object", "body": "<p>@Reid Barton is right, regarding the root cause of the problem. The real issue here is that stack is building a shared binary by default. By passing the options <code>-static</code> or ghc-options: <code>-optl-static</code> we are only addressing respectively the ghc layer and ld layer.</p>\n\n<pre><code>stack\n |_ cabal\n      |_ ghc\n          |_ gcc\n              |_ ld (linker)\n</code></pre>\n\n<p>The correct way to solve the issue is to tell cabal that we want a static binary, as it pilots the build.</p>\n\n<p>The answer on how to do that was provided by sausade on reddit: you just have to add the following to your .cabal file in the executable section:</p>\n\n<pre><code>directive:\n\n`ld-options: -static`\n</code></pre>\n\n<p>This will hint to cabal that we want a static binary and as so it will not pass <code>-shared</code> to ghc.</p>\n\n<p>So once you have added this directive in your cabal file, you just have to run:</p>\n\n<p><code>stack install --ghc-options=\"-fPIC\"</code></p>\n\n<p>and voil\u00e0!</p>\n\n<p>P.S: If you don't have static libraries on your system (like with Archlinux) <code>ld</code> will fallback to dynamic linking</p>\n\n<hr>\n\n<p>Previous answer:</p>\n\n<p>That's an old gcc issue that no one care to fix.\n<a href=\"https://bugs.launchpad.net/ubuntu/+source/gcc-4.4/+bug/640734\" rel=\"nofollow noreferrer\">https://bugs.launchpad.net/ubuntu/+source/gcc-4.4/+bug/640734</a></p>\n\n<p>For your original problem here are two useful links to show you how to do it:</p>\n\n<ul>\n<li><a href=\"https://gist.github.com/erebe/9611b2c8f1d26cc91cc3fb33bbae0eb9\" rel=\"nofollow noreferrer\">https://gist.github.com/erebe/9611b2c8f1d26cc91cc3fb33bbae0eb9</a></li>\n<li><a href=\"https://www.fpcomplete.com/blog/2016/10/static-compilation-with-stack\" rel=\"nofollow noreferrer\">https://www.fpcomplete.com/blog/2016/10/static-compilation-with-stack</a></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 2, "last_activity_date": 1483370330, "creation_date": 1483370330, "answer_id": 41429309, "question_id": 41419102, "link": "https://stackoverflow.com/questions/41419102/haskell-stack-static-binary-relocation-r-x86-64-32-against-tmc-end-can-not/41429309#41429309", "title": "Haskell Stack Static Binary relocation R_X86_64_32 against `__TMC_END__&#39; can not be used when making a shared object", "body": "<p>I'm guessing a bit here, but I think this is just a case of breaking things by going behind the build system's back.</p>\n\n<p>It's wrong to write</p>\n\n<pre><code>ghc-options:\n    \"*\": -static\n</code></pre>\n\n<p>because the choice to build dynamic or static libraries has ramifications for how the rest of the build needs to go. Here it looks like Stack or Cabal told ghc to build a dynamic library and this flag overrode your attempt to set <code>-static</code>. As a result gcc probably ended up with the option combination <code>-shared -static</code> which led to the bug mentioned in Er\u00e8be's answer. (If your flag <code>-static</code> had won over <code>-dynamic</code>, then ghc might have succeeded in building a static library but then Stack/Cabal would probably get confused about what to do next.)</p>\n\n<p>The right way to do this is not to use <code>-static</code> in <code>ghc-options</code>, but instead tell Stack not to build a shared library in the first place. I don't know how you do that in Stack, but the Cabal flag is <code>--disable-shared</code>.</p>\n"}], "owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2924, "favorite_count": 1, "answer_count": 2, "score": 7, "last_activity_date": 1516017278, "creation_date": 1483305342, "last_edit_date": 1483341613, "question_id": 41419102, "link": "https://stackoverflow.com/questions/41419102/haskell-stack-static-binary-relocation-r-x86-64-32-against-tmc-end-can-not", "title": "Haskell Stack Static Binary relocation R_X86_64_32 against `__TMC_END__&#39; can not be used when making a shared object", "body": "<p>When using the following in my <code>stack.yaml</code> to (attempt) to compile a static binary through Stack:</p>\n\n<pre><code>ghc-options:\n    \"*\": -static -optc-static -optl-static -optl-pthread -fPIC\n</code></pre>\n\n<p>I get this error:</p>\n\n<pre><code>usr/bin/ld: /usr/lib/gcc/x86_64-amazon-linux/4.8.3/crtbeginT.o: relocation R_X86_64_32 against `__TMC_END__' can not be used when making a shared object; recompile with -fPIC\n/usr/lib/gcc/x86_64-amazon-linux/4.8.3/crtbeginT.o: could not read symbols: Bad value\ncollect2: error: ld returned 1 exit status\n`gcc' failed in phase `Linker'. (Exit code: 1)\n</code></pre>\n\n<p>I'm using stack with docker enabled and a customised Amazon Linux image for building a static binary for use with AWS Lambda.</p>\n\n<p>I have no prior experience with static binary compilation, so I'm a bit stumped on this linker error. Any ideas please?</p>\n\n<p>Here's the gcc args using -v:</p>\n\n<pre><code>/usr/bin/gcc -fno-stack-protector -DTABLES_NEXT_TO_CODE '-Wl,--hash-size=31' -Wl,--reduce-memory-overheads -Wl,--no-as-needed -Wl,-rpath&lt;snipped LOADS&gt; -lHSghc&lt;SNIPPED LOADS&gt; -lpq -lz -lrt -lutil -ldl -lgmp\n</code></pre>\n"}, {"tags": ["haskell", "recursion", "directed-acyclic-graphs", "binary-decision-diagram"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1483361188, "post_id": 41418028, "comment_id": 70059641, "body": "What is the <i>sharing</i> property and how is it different from <i>no-redundancy</i>?"}, {"owner": {"reputation": 407, "user_id": 7336327, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a335cdfc0685d53545c7dc39135d2493?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/7336327/david"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1483393468, "post_id": 41418028, "comment_id": 70073163, "body": "More information, including diagrams can be found at <a href=\"https://pdfs.semanticscholar.org/52da/cc39b049e04d67529c829b56d0b32c19c0c0.pdf\" rel=\"nofollow noreferrer\">pdfs.semanticscholar.org/52da/&hellip;</a>"}], "owner": {"reputation": 407, "user_id": 7336327, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a335cdfc0685d53545c7dc39135d2493?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/7336327/david"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 253, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1483296225, "creation_date": 1483296225, "question_id": 41418028, "link": "https://stackoverflow.com/questions/41418028/create-a-reduced-ordered-binary-decision-diagram-from-boolean-expression-in-hask", "title": "Create a Reduced Ordered Binary Decision Diagram from boolean expression in Haskell", "body": "<p>Assuming the following definitions:</p>\n\n<pre><code>type Index = Int\n\ndata BExp = Prim Bool | IdRef Index | Not BExp | And BExp BExp | Or BExp BExp\n           deriving (Eq, Ord, Show)\n\ntype NodeId = Int\n\ntype BDDNode =  (NodeId, (Index, NodeId, NodeId))\n\ntype BDD = (NodeId, [BDDNode])\n</code></pre>\n\n<p>I want to build a ROBDD from a boolean expression. So far, I've been able to construct a BDD that doesn't satisfy the <em>no-redundancy</em> or <em>sharing</em> properties.</p>\n\n<pre><code>buildBDD :: BExp -&gt; [Index] -&gt; BDD\nbuildBDD e idxs\n = buildBDD' e 2 idxs\n\nbuildBDD' :: BExp -&gt; NodeId -&gt; [Index] -&gt; BDD\nbuildBDD' (Prim bool) _ []\n  | bool       = (1, [])\n  | otherwise  = (0, [])\nbuildBDD' e nodeId (idx : idxs)\n = (nodeId, [newNode] ++ tl ++ tr)\n where\n   newNode = (nodeId, (idx, il, ir))\n   (il, tl) = buildBDD' (restrict e idx False) (2 * nodeId) idxs\n   (ir, tr) = buildBDD' (restrict e idx True) (2 * nodeId + 1) idxs\n</code></pre>\n\n<p>The naming and style may not be the best, as this is still work in progress. </p>\n\n<p>The nodes are internally represented by a unique id. It starts from 2. The root node of the left subtree will be labelled <em>2n</em> and the root node of the right subtree will be labelled <em>2n + 1</em>.</p>\n\n<p>The function will take as input the boolean expression and a list of indices for the variables that appear in the expression.</p>\n\n<p>For example, for the following expression:</p>\n\n<pre><code>And (IdRef 7) (Or (IdRef 2) (Not (IdRef 3)))\n</code></pre>\n\n<p>The call <code>buildBDD bexp [2,3,7]</code> will return</p>\n\n<pre><code>(2,[(2,(2,4,5)),(4,(3,8,9)),(8,(7,0,1)),(9,(7,0,0)),(5,(3,10,11)),(10,(7,0,1)),\n(11,(7,0,1))])\n</code></pre>\n\n<p>I've made the following changes to account for the <em>no-redundancy</em> property (this has not been tested thoroughly, but appears to be working)</p>\n\n<pre><code>checkEqual (_, l, r)\n  | l == r    = True\n  | otherwise = False\n\ngetElemFromTuple (_, _, e)\n  = e\n\ngetTuple = snd . head\n\nbuildROBDD' e nodeId (idx : idxs)\n     = (nodeId, [newNode] ++ left ++ right)\n where\n   newNode   = (nodeId, (idx, lId, rId))\n   (il, tl)  = buildROBDD' (restrict e idx False) (2 * nodeId) idxs\n   (ir, tr)  = buildROBDD' (restrict e idx True) (2 * nodeId + 1) idxs\n   lId       = if (not . null) tl &amp;&amp; (checkEqual . getTuple) tl then (getElemFromTuple . getTuple) tl else il\n   rId       = if (not . null) tr &amp;&amp; (checkEqual . getTuple) tr then (getElemFromTuple . getTuple) tr else ir\n   left      = if (not . null) tl &amp;&amp; (checkEqual . getTuple) tl then [] else tl\n   right     = if (not . null) tr &amp;&amp; (checkEqual . getTuple) tr then [] else tr\n</code></pre>\n\n<p>(excuse the clumsy expressions above)</p>\n\n<p>However, I don't know how to approach the sharing property, especially because the shared node might be anywhere in the graph and I am not storing the current tree. The formula for the unique node ids can be changed if needed.</p>\n\n<p>Note: this is meant as an exercise, so the types and style involved might not be optimal. I am also not supposed to change them (I am free to change the function though).</p>\n"}, {"tags": ["jquery", "haskell", "reflex"], "comments": [{"owner": {"reputation": 3188, "user_id": 590347, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca28027d24f8a5aacd4d9d9098a09b5?s=128&d=identicon&r=PG", "display_name": "Bartosz", "link": "https://stackoverflow.com/users/590347/bartosz"}, "edited": false, "score": 0, "creation_date": 1483303285, "post_id": 41417678, "comment_id": 70042831, "body": "Related: <a href=\"https://www.reddit.com/r/reflexfrp/comments/55mqni/material_design_lite_calling/?utm_source=amp&amp;utm_medium=comment_list\" rel=\"nofollow noreferrer\">reddit.com/r/reflexfrp/comments/55mqni/&hellip;</a>"}], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 217, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1518385479, "creation_date": 1483293625, "last_edit_date": 1518385479, "question_id": 41417678, "link": "https://stackoverflow.com/questions/41417678/material-ui-reflex-frp-dropdown-select-not-working", "title": "material UI + reflex-frp =&gt; dropdown/select not working", "body": "<p>I have tried to integrate Material UI with reflex frp - while normal (css only elements) look nice and slick - it seems that dropdowns/select-form elements need some jQuery to initialize - which does not work:</p>\n\n<p>I have tried to reorder the <code>&lt;script&gt;</code> statements in <code>index.html</code> and put the document-ready-jQuery string before the <code>runmain.js</code>-line into the body.</p>\n\n<p>I also checked that the script tags are executed, by inserting an <code>alert</code>.</p>\n\n<h2><code>Main.hs</code></h2>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE RecursiveDo       #-}\nimport Reflex\nimport Reflex.Dom\nimport Data.Monoid ((&lt;&gt;))\nimport qualified Data.Map as Map\nimport Safe      (readMay)\nimport Data.Text (pack, unpack, Text)\nimport Control.Applicative ((&lt;*&gt;), (&lt;$&gt;))\n\nmain = mainWidget $ do\n  el \"script\" $ text \"$(document).ready(function(){$('select').material_select(); });\"\n  nx &lt;- divClass \"row\" $ numberInput\n  d &lt;- divClass \"input-field col s12\" $ do\n    d &lt;- dropdown \"*\" (constDyn ops) def\n    el \"label\" $ text \"Operation\"\n    return d\n  ny &lt;- divClass \"row\" $ numberInput\n  let values = zipDynWith (,) nx ny\n      result = zipDynWith (\\o (x,y) -&gt; textToOp o &lt;$&gt; x &lt;*&gt; y)\n                          (_dropdown_value d)\n                          values\n      resultText = fmap (pack . show) result\n  text \" = \"\n  dynText resultText\n\nnumberInput :: (MonadWidget t m) =&gt; m (Dynamic t (Maybe Double))\nnumberInput = do\n  let errorState = \"style\" =: \"border-color: red\"\n      validState = \"style\" =: \"border-color: green\"\n  rec n &lt;- textInput $ def &amp; textInputConfig_inputType .~ \"number\"\n                           &amp; textInputConfig_initialValue .~ \"0\"\n                           &amp; textInputConfig_attributes .~ attrs\n      let result = fmap (readMay . unpack) $ _textInput_value n\n          attrs  = fmap (maybe errorState (const validState)) result\n  return result\n\nops = Map.fromList [(\"+\", \"+\"), (\"-\", \"-\"), (\"*\", \"*\"), (\"/\", \"/\")]\n\ntextToOp :: (Fractional a) =&gt; Text -&gt; a -&gt; a -&gt; a\ntextToOp s = case s of\n                    \"-\" -&gt; (-)\n                    \"*\" -&gt; (*)\n                    \"/\" -&gt; (/)\n                    _ -&gt; (+)\n</code></pre>\n\n<h2><code>index.html</code></h2>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n    &lt;head&gt;\n        &lt;link href=\"http://fonts.googleapis.com/icon?family=Material+Icons\" rel=\"stylesheet\"&gt;\n        &lt;link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/css/materialize.min.css\"&gt;\n        &lt;script type=\"text/javascript\" src=\"https://code.jquery.com/jquery-2.1.1.min.js \"&gt;&lt;/script&gt;\n        &lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/js/materialize.min.js\"&gt;&lt;/script&gt;\n        &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n\n        &lt;script language=\"javascript\" src=\"https://rawgit.com/epsilonhalbe/4472d2462c3df7019beb881cec322b0d/raw/3c741f3dc676a8b9a9833bfbc89af4eca44be35f/rts.js\"&gt;&lt;/script&gt;\n        &lt;script language=\"javascript\" src=\"https://rawgit.com/epsilonhalbe/4472d2462c3df7019beb881cec322b0d/raw/3c741f3dc676a8b9a9833bfbc89af4eca44be35f/lib.js\"&gt;&lt;/script&gt;\n        &lt;script language=\"javascript\" src=\"https://rawgit.com/epsilonhalbe/4472d2462c3df7019beb881cec322b0d/raw/3c741f3dc676a8b9a9833bfbc89af4eca44be35f/out.js\"&gt;&lt;/script&gt;\n    &lt;/head&gt;\n\n    &lt;body&gt;\n        &lt;script language=\"javascript\" src=\"https://rawgit.com/epsilonhalbe/4472d2462c3df7019beb881cec322b0d/raw/3c741f3dc676a8b9a9833bfbc89af4eca44be35f/runmain.js\" defer&gt;&lt;/script&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1483283509, "post_id": 41416131, "comment_id": 70037248, "body": "you can always use <code>(&gt;&gt;&gt;)</code> instead of <code>(.)</code>. One other way would be to <code>import qualified Control.Category as CAT</code> and then use <code>CAT..</code> - but I don&#39;t see the point (pun intended) of importing all parts of Function and Category, usually I only need a few bits which I list explicitly, or import the whole module qualified"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 2, "creation_date": 1483293842, "post_id": 41416131, "comment_id": 70040120, "body": "IMO this is a non-problem. <code>Data.Function</code> defines <code>.</code>, and <code>Prelude</code> re-exports it because, well, it\u2019s the <code>Prelude</code>. It re-exports things. However, it\u2019s pretty unlikely that other modules would re-export <code>.</code> from <code>Data.Function</code>, so I think \u201cIf I&#39;ll import more module, I may type more\u201d is an unsubstantiated fear. If you wanted to get rid of one more <code>hiding</code>, you could use a custom prelude, but otherwise there\u2019s not really getting around these two."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1483303226, "post_id": 41416131, "comment_id": 70042816, "body": "The only things in <code>Data.Function</code> that aren&#39;t in <code>Prelude</code> are <code>(&amp;)</code> <code>on</code> and <code>fix</code>. Why not just import whichever of them you need?"}, {"owner": {"reputation": 1044, "user_id": 4469745, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/ae66806e9a5fc63482f58779c34d0f69?s=128&d=identicon&r=PG&f=1", "display_name": "xiang", "link": "https://stackoverflow.com/users/4469745/xiang"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1483336132, "post_id": 41416131, "comment_id": 70049245, "body": "@AlexisKing    So\uff0cOnly <code>Prelure</code> will repeat the import of the module. So I should only <code>import Prelure hiding (functions)</code> and <code>import ModuleName (x,y,andOtherNeedFunctions) </code>."}, {"owner": {"reputation": 1044, "user_id": 4469745, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/ae66806e9a5fc63482f58779c34d0f69?s=128&d=identicon&r=PG&f=1", "display_name": "xiang", "link": "https://stackoverflow.com/users/4469745/xiang"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1483336534, "post_id": 41416131, "comment_id": 70049360, "body": "@epsilonhalbe <code>&gt;&gt;&gt;</code> and <code>.</code> have different infix level. (I wonder if there is a function has the same infix level with <code>(.)</code> and has the same infix level with <code>flip (.)</code>)"}], "owner": {"reputation": 1044, "user_id": 4469745, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/ae66806e9a5fc63482f58779c34d0f69?s=128&d=identicon&r=PG&f=1", "display_name": "xiang", "link": "https://stackoverflow.com/users/4469745/xiang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 206, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1483280172, "creation_date": 1483280172, "question_id": 41416131, "link": "https://stackoverflow.com/questions/41416131/the-override-of-imported-function", "title": "The override of imported function", "body": "<p>I want to import Category and include it's function (.)</p>\n\n<p>And then, I'll use</p>\n\n<pre><code>import Data.Function hiding ((.))\nimport Control.Category\nimport Prelude hiding ((.))\n</code></pre>\n\n<p>So, I should type <code>hiding ((.))</code> twice. If I'll import more module, I may type more.</p>\n\n<p>Is there exist a more elegant way to import <code>Control.Category</code></p>\n"}, {"tags": ["parsing", "haskell", "monads", "alternative-functor"], "comments": [{"owner": {"reputation": 649, "user_id": 2998746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fc15b842026d8a039ffdd1b2a528aec?s=128&d=identicon&r=PG&f=1", "display_name": "Euge", "link": "https://stackoverflow.com/users/2998746/euge"}, "edited": false, "score": 0, "creation_date": 1483282705, "post_id": 41415922, "comment_id": 70037040, "body": "You don&#39;t need <code>try</code> for this simple parser library. <code>p &lt;|&gt; q</code> already behaves like <code>try p &lt;|&gt; q</code>. Am I right?"}, {"owner": {"reputation": 245, "user_id": 2885648, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/8d48ae786c7bb44cb40d237742b6329f?s=128&d=identicon&r=PG&f=1", "display_name": "elfeck", "link": "https://stackoverflow.com/users/2885648/elfeck"}, "reply_to_user": {"reputation": 649, "user_id": 2998746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fc15b842026d8a039ffdd1b2a528aec?s=128&d=identicon&r=PG&f=1", "display_name": "Euge", "link": "https://stackoverflow.com/users/2998746/euge"}, "edited": false, "score": 0, "creation_date": 1483282946, "post_id": 41415922, "comment_id": 70037102, "body": "Well <code>&lt;|&gt; :: Parser a -&gt; Parser a -&gt; Parser a</code> needs an alternative to my <i>tried</i> option. I was hoping for something I can just <code>try</code> and if it fails, do nothing and just move onto the next statement in my <code>do</code> notation."}, {"owner": {"reputation": 649, "user_id": 2998746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fc15b842026d8a039ffdd1b2a528aec?s=128&d=identicon&r=PG&f=1", "display_name": "Euge", "link": "https://stackoverflow.com/users/2998746/euge"}, "edited": false, "score": 0, "creation_date": 1483283602, "post_id": 41415922, "comment_id": 70037271, "body": "That&#39;s exactly how <code>&lt;|&gt;</code> works already."}], "answers": [{"comments": [{"owner": {"reputation": 245, "user_id": 2885648, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/8d48ae786c7bb44cb40d237742b6329f?s=128&d=identicon&r=PG&f=1", "display_name": "elfeck", "link": "https://stackoverflow.com/users/2885648/elfeck"}, "edited": false, "score": 1, "creation_date": 1483292047, "post_id": 41416510, "comment_id": 70039573, "body": "Thanks for your answer but this does not work correctly. <code>parse (untilStop &quot;end&quot;) &quot;abcdef end&quot;</code> gives <code>[(&quot;abcd&quot;, &quot;ef end&quot;)]</code>.  It also does not really use the combinators which I think should be the goal."}, {"owner": {"reputation": 245, "user_id": 2885648, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/8d48ae786c7bb44cb40d237742b6329f?s=128&d=identicon&r=PG&f=1", "display_name": "elfeck", "link": "https://stackoverflow.com/users/2885648/elfeck"}, "edited": false, "score": 0, "creation_date": 1483304254, "post_id": 41416510, "comment_id": 70043117, "body": "Thanks <b>a lot</b>, that works in theory, but I suggested an edit to your solution to make it compile and copy-pastable. Formatting and such"}], "tags": [], "owner": {"reputation": 649, "user_id": 2998746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fc15b842026d8a039ffdd1b2a528aec?s=128&d=identicon&r=PG&f=1", "display_name": "Euge", "link": "https://stackoverflow.com/users/2998746/euge"}, "is_accepted": true, "score": 1, "last_activity_date": 1483304863, "last_edit_date": 1483304863, "creation_date": 1483284112, "answer_id": 41416510, "question_id": 41415922, "link": "https://stackoverflow.com/questions/41415922/implementing-try-look-ahead-and-untilstop-with-parser-combinators/41416510#41416510", "title": "Implementing try (look-ahead) and untilStop with parser combinators", "body": "<p>As I said in a comment, I think you don't need to have a Parsec-like <code>try</code>.</p>\n\n<p>For the <code>untilStop</code>, check this:</p>\n\n<pre><code>untilStop :: String -&gt; Parser String\nuntilStop [] = everything\nuntilStop (c:cs) = item &gt;&gt;= fun\n  where fun i = do { s &lt;- untilStop cs;\n                     if i == c &amp;&amp; s == \"\" then return \"\" else failure } &lt;|&gt; do\n                     s &lt;- untilStop (c : cs)\n                     return (i : s)\n</code></pre>\n\n<p>First, if the stop string is empty, you parse everything.  Where <code>everything</code> is:</p>\n\n<pre><code>everything :: Parser String\neverything = Parser (\\inp -&gt; [(inp,\"\")])\n</code></pre>\n\n<p>Otherwise, if it is of the form <code>c:cs</code>, then parse a character <code>i</code> and consider two cases: </p>\n\n<ul>\n<li><p>The stop string is right in the front of the parsing stream (because <code>c == i</code> and parsing with the rest of the string <code>cs</code> gives an empty result), then return \"\". Or,</p></li>\n<li><p>It is somewhere in the stream, so you look for it further. </p></li>\n</ul>\n\n<p>Note that the <code>&lt;|&gt;</code> operator is used to backtrack. If <code>untilStop cs</code> fails to be what we want, we need to <em>reparse</em>, using <code>untilStop (c:cs)</code> instead.</p>\n"}], "owner": {"reputation": 245, "user_id": 2885648, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/8d48ae786c7bb44cb40d237742b6329f?s=128&d=identicon&r=PG&f=1", "display_name": "elfeck", "link": "https://stackoverflow.com/users/2885648/elfeck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 457, "favorite_count": 0, "accepted_answer_id": 41416510, "answer_count": 1, "score": 0, "last_activity_date": 1613796122, "creation_date": 1483278301, "last_edit_date": 1613796122, "question_id": 41415922, "link": "https://stackoverflow.com/questions/41415922/implementing-try-look-ahead-and-untilstop-with-parser-combinators", "title": "Implementing try (look-ahead) and untilStop with parser combinators", "body": "<p>I am following <a href=\"http://dev.stephendiehl.com/fun/002_parsers.html\" rel=\"nofollow noreferrer\">this tutorial</a> for implementing Parser Combinators (a la parsec) in Haskell. I implemented everything of the NanoParsec mentioned throught this post.</p>\n\n<p>For some hours now, I am struggeling to implement</p>\n\n<pre><code>-- try p. If p fails continue without consuming anything\ntry :: Parser a -&gt; Parser a\ntry p = ...\n\n-- Parser for everything, until the character-sequence stop appears. \n-- If stop does not appear at all: fail\nuntilStop :: String -&gt; Parser String\nuntilStop stop = ...\n</code></pre>\n\n<p>My best attempt to implement <code>untilStop</code> looks like somewhat like this and does not quite work</p>\n\n<pre><code>untilStop :: String -&gt; Parser String\nuntilStop (c : cs) = do\n  s &lt;- some $ satisfy (/= d)\n  string (c : cs) &lt;|&gt; do\n    i &lt;- item\n    untilStop (d : ds)\n  -- maybe use msum from MonadPlus to combine?\n</code></pre>\n\n<p>I could not figure out how to combine <code>s</code>, <code>i</code> and the recursive call without failing everthing because of <code>string</code> are not getting everything together.</p>\n\n<p>I think once I have <code>try</code>, <code>untilStop</code> should be straightforward. Can someone point me in the right direction or implement it (<code>try</code>) for me?</p>\n\n<p>Right now I am still learning about Monads, Applicative and related stuff so trying to understand the sourcecode of parsec was impossible for me.</p>\n"}, {"tags": ["haskell", "ghc", "cabal", "cabal-install", "ghc-mod"], "answers": [{"tags": [], "owner": {"reputation": 313, "user_id": 5953321, "user_type": "registered", "profile_image": "https://graph.facebook.com/886468944803810/picture?type=large", "display_name": "Junyoung Clare Jang", "link": "https://stackoverflow.com/users/5953321/junyoung-clare-jang"}, "is_accepted": false, "score": 0, "last_activity_date": 1483270660, "last_edit_date": 1483270660, "creation_date": 1483270348, "answer_id": 41415137, "question_id": 41414971, "link": "https://stackoverflow.com/questions/41414971/cabal-cabal-install-error-in-ubuntu-14-04/41415137#41415137", "title": "cabal cabal-install error in Ubuntu 14.04", "body": "<p>If you install <code>haskell-platform</code> via <code>apt-get</code>, version of <code>ghc</code> is under <code>7.10.3</code> until yakkety (Ubuntu 16.10).</p>\n\n<p>This is problematic because <code>cabal-1.24</code> requires <code>ghc &gt;= 8.0.1</code>.</p>\n\n<p>To solve this</p>\n\n<ol>\n<li>install more recent version of <code>ghc</code> from its <a href=\"https://github.com/ghc/ghc/tree/ghc-8.0\" rel=\"nofollow noreferrer\">code</a>,</li>\n<li>just use <code>stack</code> and <code>ghc-mod</code> for <code>stack</code>.</li>\n</ol>\n\n<p>P.S. if you are emacsen, I recommand you to use <code>intero</code> (<a href=\"https://commercialhaskell.github.io/intero/\" rel=\"nofollow noreferrer\">site</a>) instead of <code>ghc-mod</code>.</p>\n"}], "owner": {"reputation": 228, "user_id": 6455798, "user_type": "registered", "accept_rate": 17, "profile_image": "https://lh6.googleusercontent.com/-Ui9ZpTgdbnw/AAAAAAAAAAI/AAAAAAAABUM/EMoDVigcevk/photo.jpg?sz=128", "display_name": "Vijeth Aradhya", "link": "https://stackoverflow.com/users/6455798/vijeth-aradhya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 217, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1483270660, "creation_date": 1483268452, "last_edit_date": 1483268563, "question_id": 41414971, "link": "https://stackoverflow.com/questions/41414971/cabal-cabal-install-error-in-ubuntu-14-04", "title": "cabal cabal-install error in Ubuntu 14.04", "body": "<p>I followed the procedure <a href=\"https://gist.github.com/wting/8498731#option-ghc-784--cabal\" rel=\"nofollow noreferrer\">here</a> for installing GHC and cabal, and then for ghc-mod.</p>\n\n<p>But, I get this error at this step</p>\n\n<pre><code>cabal update &amp;&amp; cabal install cabal-install\n</code></pre>\n\n<blockquote>\n  <p>Configuring cabal-install-1.24.0.2... Failed to install\n  cabal-install-1.24.0.2 cabal: Error: some packages failed to install:\n  cabal-install-1.24.0.2 failed during the configure step. ExitFailure\n  11</p>\n</blockquote>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 5, "creation_date": 1483238329, "post_id": 41412958, "comment_id": 70029882, "body": "This looks an awful lot like you&#39;re trying to squeeze OO classes into Haskell. Why do you need this (or <i>think</i> you need it)?"}, {"owner": {"reputation": 435, "user_id": 7287132, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7330188252bcb217a107b1250ec120d?s=128&d=identicon&r=PG&f=1", "display_name": "LambdaScientist", "link": "https://stackoverflow.com/users/7287132/lambdascientist"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1483239117, "post_id": 41412958, "comment_id": 70029981, "body": "I have several versions of the types: Config, PIn, St, and a function called <code>runOneTest</code>. The code using the types and the function is the same. The type signature for <code>runOneTest</code> will always be <code>runOneTest :: Config -&gt; Signal TestResult</code>  I want to be able to reuse all the other code that calls the <code>runOneTest</code> function. I posted about this on CodeReview yesterday with no results yet.  [<a href=\"http://codereview.stackexchange.com/questions/151278/abstracting-haskell-types-to-increase-code-reuse](Code)\" title=\"abstracting haskell types to increase code reuse%5d(Code)\">codereview.stackexchange.com/questions/151278/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 4, "last_activity_date": 1483246100, "last_edit_date": 1495541637, "creation_date": 1483243127, "answer_id": 41413252, "question_id": 41412958, "link": "https://stackoverflow.com/questions/41412958/in-haskell-how-can-i-match-a-type-class-with-an-instance-of-that-type-class/41413252#41413252", "title": "In Haskell how can I match a type class with an instance of that type class?", "body": "<p>To understand why your code does not type check perhaps see: <a href=\"https://stackoverflow.com/questions/14299638/existential-vs-universally-quantified-types-in-haskell\">existential vs. universally quantified types</a>. To make this work, one possibility would be to use <a href=\"https://prime.haskell.org/wiki/FunctionalDependencies\" rel=\"nofollow noreferrer\">Functional Dependencies</a>. Then your type-class would be:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses, FunctionalDependencies #-}\n\nclass (PortIn pin, Show pin, SysState st, Show st) =&gt; Configuration c pin st\n    | c -&gt; pin, c -&gt; st where\n  input   :: c -&gt; pin\n  startSt :: c -&gt; st\n</code></pre>\n\n<p>and the instance definition would be:</p>\n\n<pre><code>instance Configuration Config PIn St where\n  input   = input'\n  startSt = startSt'\n</code></pre>\n\n<p>This will make your code type check, though may not be what you are after.</p>\n\n<p>A different direction would be to use <a href=\"https://wiki.haskell.org/Existential_types\" rel=\"nofollow noreferrer\">existential types</a>. In that case:</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\n\ndata PortInShow   = forall a . (PortIn a,   Show a) =&gt; PortInShow a\ndata SysStateShow = forall a . (SysState a, Show a) =&gt; SysStateShow a\n\nclass Configuration c where\n  input   :: c -&gt; PortInShow\n  startSt :: c -&gt; SysStateShow\n\ninstance Configuration Config where\n  input   = PortInShow   . input'\n  startSt = SysStateShow . startSt'\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 4, "last_activity_date": 1483287822, "creation_date": 1483287822, "answer_id": 41416960, "question_id": 41412958, "link": "https://stackoverflow.com/questions/41412958/in-haskell-how-can-i-match-a-type-class-with-an-instance-of-that-type-class/41416960#41416960", "title": "In Haskell how can I match a type class with an instance of that type class?", "body": "<p>The applicability of the linked question in behzad.nouri's answer might not be clear to someone who doesn't already understand what's going on here. To answer the actual question in more detail:</p>\n\n<pre><code>class Configuration c where\n  input :: (PortIn pin, Show pin) =&gt; c -&gt; pin\n  startSt :: (SysState st, Show st) =&gt; c -&gt; st\n</code></pre>\n\n<p>means that the type of <code>input</code> will be</p>\n\n<pre><code>input :: (Configuration c, PortIn pin, Show pin) =&gt; c -&gt; pin\n</code></pre>\n\n<p>which in turn means the <strong>caller</strong> of <code>input</code> can choose any types they like for <code>c</code> and <code>pin</code> in the type of <code>input</code>, as long as <code>c</code> is an instance of <code>Configuration</code> and <code>pin</code> is an instance of <code>PortIn</code> and <code>Show</code>. (This is the way all polymorphic functions work: <code>even :: Integral a =&gt; a -&gt; Bool</code> means that the caller can apply <code>even</code> to a value of any type that is an instance of <code>Integral</code>, and <code>fromInteger :: Num a =&gt; Integer -&gt; a</code> means that the caller can treat the result of <code>fromInteger</code> as having any type that is an instance of <code>Num</code>.)</p>\n\n<p>It follows that you, the <strong>implementor</strong> of the <code>input</code> method for the <code>Configuration Config</code>, must provide an implementation that works for any type <code>pin</code> that is an instance of <code>PortIn</code> and <code>Show</code>. But your implementation <code>input = input'</code> can only possibly work for the single type <code>PIn</code>. That's why the compiler rejects it. (It tells you that the type <code>pin</code> of the result is a \"rigit type variable\", meaning you don't get to choose it as the implementor but must assume it has already \"rigidly\" been chosen by the caller.)</p>\n\n<p>As for what to do about this, you already got a good answer in a comment on the codereview question from Gurkenglas: you can simply parameterize <code>Config</code> and other types as necessary on the type of the ports and states.</p>\n"}], "owner": {"reputation": 435, "user_id": 7287132, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7330188252bcb217a107b1250ec120d?s=128&d=identicon&r=PG&f=1", "display_name": "LambdaScientist", "link": "https://stackoverflow.com/users/7287132/lambdascientist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 267, "favorite_count": 0, "accepted_answer_id": 41413252, "answer_count": 2, "score": 4, "last_activity_date": 1483287822, "creation_date": 1483237522, "question_id": 41412958, "link": "https://stackoverflow.com/questions/41412958/in-haskell-how-can-i-match-a-type-class-with-an-instance-of-that-type-class", "title": "In Haskell how can I match a type class with an instance of that type class?", "body": "<p><strong>I have defined the following classes:</strong></p>\n\n<pre><code>class Configuration c where\n  input :: (PortIn pin, Show pin) =&gt; c -&gt; pin\n  startSt :: (SysState st, Show st) =&gt; c -&gt; st\n\nclass (Eq pin, Show pin) =&gt; PortIn pin\n\nclass (Eq st, Show st) =&gt; SysState st\n</code></pre>\n\n<p><strong>The following types and instances:</strong></p>\n\n<pre><code>--inputs\ndata PIn = PIn { _clk   :: Bit\n               , _reset :: Bool\n               , _start :: Bool\n               , _stop  :: Bool\n               } deriving (Eq)\ninstance PortIn PIn\ninstance Show PIn where\n  show PIn {..} =\n    \"PIn\\n\\t _clk = \" P.++ show _clk\n    P.++ \"\\n\\t _reset = \" P.++ show _reset\n    P.++ \"\\n\\t _start = \" P.++ show _start\n    P.++ \"\\n\\t _stop = \" P.++ show _stop\n\n--Outputs and state data\ndata St = St { _cnt_en   :: Bool\n             , _count_us :: BitVector 4\n             , _stop_d1  :: Bool\n             , _stop_d2  :: Bool\n             , _count    :: BitVector 4\n             } deriving (Eq)\n\ninstance SysState St\ninstance Show St where\n show St {..} =\n        \"St\\n\\t _cnt_en = \" P.++ show _cnt_en\n\n   P.++ \"\\n\\t _count_us = \" P.++ show _count_us\n   P.++ \"\\n\\t _stop_d1 = \" P.++ show _stop_d1\n   P.++ \"\\n\\t _stop_d2 = \" P.++ show _stop_d2\n   P.++ \"\\n\\t _count = \" P.++ show _count\n</code></pre>\n\n<p><strong>Why am I unable to  create an instance of Configuration here:</strong></p>\n\n<pre><code>data Config = Config { input'  :: PIn\n                     , startSt' :: St\n                     } deriving (Eq)\n\ninstance Show Config where\n show Config {..} =\n        \"Config:\\n input = \" P.++ show input'\n   P.++ \"\\n startSt = \" P.++ show startSt'\n\ninstance Configuration Config where\n  input = input'\n  startSt = startSt'\n</code></pre>\n\n<p><strong>I get the following error:</strong></p>\n\n<pre><code>Couldn't match type \u2018pin\u2019 with \u2018PIn\u2019\n  \u2018pin\u2019 is a rigid type variable bound by\n        the type signature for\n          input :: (PortIn pin, Show pin) =&gt; Config -&gt; pin\n        at Clks_n_regs_4.hs:101:3\nExpected type: Config -&gt; pin\n  Actual type: Config -&gt; PIn\nRelevant bindings include\n  input :: Config -&gt; pin (bound at Clks_n_regs_4.hs:101:3)\nIn the expression: input'\nIn an equation for \u2018input\u2019: input = input'\n</code></pre>\n\n<p>I would think I can use input' because it results in a PIn which in an instance of pin. </p>\n\n<p>I have a misunderstanding somewhere, hopefully someone can explain what I am missing. </p>\n"}, {"tags": ["haskell", "concurrency", "haskell-pipes"], "comments": [{"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 1, "creation_date": 1483236190, "post_id": 41412823, "comment_id": 70029610, "body": "<a href=\"https://hackage.haskell.org/package/pipes-async-0.1.1/docs/src/Pipes-Async.html#buffer\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/pipes-async-0.1.1/docs/src/&hellip;</a> looks like it could be adjusted to have multiple given pipes feed into the TQueue, so we get <code>[Pipe a b] -&gt; Pipe a b</code>. I&#39;ve posted a <a href=\"https://github.com/jwiegley/pipes-async/issues/1\" rel=\"nofollow noreferrer\">feature request</a>... one hour ago &gt;:D"}], "answers": [{"tags": [], "owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "is_accepted": true, "score": 2, "last_activity_date": 1483466148, "last_edit_date": 1483466148, "creation_date": 1483465360, "answer_id": 41449296, "question_id": 41412823, "link": "https://stackoverflow.com/questions/41412823/how-can-i-make-a-pipe-concurrent-with-haskells-pipe-library/41449296#41449296", "title": "How can I make a Pipe concurrent with Haskell&#39;s Pipe library?", "body": "<p>EDIT: I misunderstood what you were asking; \nYou may be able to do this inside a pipe, but I'm not really sure what the motivation would be. I'd recommend building re-usable pipe chains and just dispatching to them using workers rather than trying to build workers INSIDE the pipe. You'll lose any ordering guarantees that the first in is the first out if you build it into the pipe itself.</p>\n\n<p>The section on <a href=\"https://hackage.haskell.org/package/pipes-concurrency-2.0.7/docs/Pipes-Concurrent-Tutorial.html#g:2\" rel=\"nofollow noreferrer\">Work Stealing</a> is what you're looking for, this code is basically verbatim from the tutorial, but let's break down how it works. Here's one way we could do what you want:</p>\n\n<pre><code>module Main(main) where\nimport Pipes\nimport Pipes.Concurrent\n\nimport Control.Concurrent.Async (async, wait)\nimport Control.Concurrent (threadDelay)\nimport Control.Monad (forM)\n\na :: Producer Int IO ()\na = each [1..10]\n\nb :: Pipe Int Int IO ()\nb = do\n  x &lt;- await\n  yield (x*2)\n  b\n\nc :: Consumer Int IO ()\nc = do\n  x &lt;- await\n  lift $ print x\n  c\n\nmain :: IO ()\nmain = do\n  (output, input) &lt;- spawn unbounded\n  feeder &lt;- async $ do runEffect $ a &gt;-&gt; toOutput output\n                       performGC\n\n  workers &lt;- forM [1..3] $ \\i -&gt;\n    async $ do runEffect $ fromInput input  &gt;-&gt; b &gt;-&gt; c\n               performGC\n\n  mapM_ wait (feeder:workers)\n</code></pre>\n\n<p>The first line <code>spawn unbounded</code> is from Pipes.Concurrent, it initializes a 'mailbox' that has a handle for input and output. It confused me at first, but in this case we send messages TO the output and pull them FROM the input. This resembles a push-pull message channel in languages like golang.</p>\n\n<p>We specify a <a href=\"https://hackage.haskell.org/package/pipes-concurrency-2.0.7/docs/Pipes-Concurrent.html#t:Buffer\" rel=\"nofollow noreferrer\">Buffer</a> to say how many messages we can store, in this case we set no-limit with unbounded.</p>\n\n<p>Okay, so the mailbox is initialized, we can now create <code>Effect</code>s which send messages to it. The mailbox channels are implemented using the <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/GHC-Conc.html#t:STM\" rel=\"nofollow noreferrer\">STM</a>, so that's how it can collect messages asynchronously.</p>\n\n<p>Let's create an asynchronous job that feeds the mailbox;</p>\n\n<pre><code>feeder &lt;- async $ do runEffect $ a &gt;-&gt; toOutput output\n                     performGC\n</code></pre>\n\n<p>The <code>a &gt;-&gt; toOutput output</code> is just normal pipe composition, we need <code>toOutput</code> to convert output into a pipe. Note the <code>performGC</code> call that's also part of the IO, it allows Pipes.Concurrent to know to clean up after the job has completed. We could run this using <code>forkIO</code> if we like, but in this case we use <code>async</code> so that we can wait for the result to finish later on. Okay, so our mailbox should be asynchronously <em>receiving</em> messages, let's pull them out and do some work.</p>\n\n<pre><code>workers &lt;- forM [1..3] $ \\i -&gt;\n  async $ do runEffect $ fromInput input  &gt;-&gt; b &gt;-&gt; c\n             performGC\n</code></pre>\n\n<p>Same idea as before, but this time we're just spawning a few of them. We read from the input just like a normal pipe using <code>fromInput</code> and then run it through the rest of our chain, cleaning up when we're done. <code>input</code> will ensure that each time a value is pulled out that only one worker receives it. When all the jobs feeding into <code>output</code> complete (it keeps track of all the open jobs) then it will close the <code>input</code> pipe and the workers will finish.</p>\n\n<p>If you're using this in a web-worker scenario you would have a main loop which keeps sending requests to the <code>toOutput output</code> channel, and then spawn as many workers as you like who pull into their pipeline from <code>fromInput input</code>.</p>\n"}], "owner": {"reputation": 8047, "user_id": 565879, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/de9dab7c27809643dc51c5193d58429c?s=128&d=identicon&r=PG", "display_name": "Buttons840", "link": "https://stackoverflow.com/users/565879/buttons840"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 385, "favorite_count": 0, "accepted_answer_id": 41449296, "answer_count": 1, "score": 3, "last_activity_date": 1483466148, "creation_date": 1483235029, "last_edit_date": 1483311375, "question_id": 41412823, "link": "https://stackoverflow.com/questions/41412823/how-can-i-make-a-pipe-concurrent-with-haskells-pipe-library", "title": "How can I make a Pipe concurrent with Haskell&#39;s Pipe library?", "body": "<p>I have some Haskell code that uses Pipes:</p>\n\n<pre><code>module Main(main) where\nimport Pipes\n\na :: Producer Int IO ()\na = each [1..10]\n\nb :: Pipe Int Int IO ()\nb = do\n  x &lt;- await\n  yield (x*2)\n  b\n\nc :: Consumer Int IO ()\nc = do\n  x &lt;- await\n  lift $ print x\n  c\n\nmain :: IO ()\nmain = runEffect $ a &gt;-&gt; b &gt;-&gt; c\n</code></pre>\n\n<p>The <a href=\"https://hackage.haskell.org/package/pipes-concurrency-2.0.7/docs/Pipes-Concurrent-Tutorial.html#g:2\" rel=\"nofollow noreferrer\">Pipes.Concurrent tutorial</a> demonstrates using multiple workers along with work stealing. How can I do something similar inside of <code>b</code>? I would like <code>b</code> to perform it's work concurrently using a set number of workers.</p>\n\n<p>Obviously, concurrency isn't useful in this exact case, but it's the simplest example I could come up with. In my real use case I'd like to make some web requests concurrently using a limited number of workers.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1483233132, "post_id": 41412695, "comment_id": 70029236, "body": "For what it&#39;s worth, I&#39;m not even sure GHC 8 still comes with the Haskell98 library.  Something about it being incompatible with the GHC changes for the AMP update."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1483233304, "post_id": 41412695, "comment_id": 70029261, "body": "Interesting... although that seems weird, since the AMP is already in 7.10. Also, you can <i>always</i> <code>RebindableSyntax</code> to anything else. But, I suppose just nobody really cares that much for keeping haskell98."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1483233424, "post_id": 41412695, "comment_id": 70029281, "body": "Ah, ok, <code>haskell98</code> actually requires <code>base&lt;4.8</code>, i.e. it doesn&#39;t work already with GHC-7.10. Still a bit strange IMO..."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1483232944, "creation_date": 1483232944, "answer_id": 41412695, "question_id": 41412636, "link": "https://stackoverflow.com/questions/41412636/haskell-packages-base-versus-haskel98/41412695#41412695", "title": "haskell packages: base versus haskel98", "body": "<p>Well, you can just put those options in your <code>~/.ghci</code> file:</p>\n\n<pre><code>:set -hide-package base\n:set -package haskell98\n</code></pre>\n\n<p>But, I really recommend you <strong>don't</strong> do this. Just get used to the modern libraries.</p>\n\n<pre><code>GHCi, version 7.10.2: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; map Data.Char.toUpper \"Hello\"\n\"HELLO\"\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>Prelude&gt; :m +Data.Char\nPrelude Data.Char&gt; toUpper &lt;$&gt; \"Hello\"\n\"HELLO\"\n</code></pre>\n"}], "owner": {"reputation": 91026, "user_id": 131433, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/e6eeaf8698180e971e169a925d8e0f4f?s=128&d=identicon&r=PG", "display_name": "bmargulies", "link": "https://stackoverflow.com/users/131433/bmargulies"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 41412695, "answer_count": 1, "score": 3, "last_activity_date": 1483232944, "creation_date": 1483231971, "question_id": 41412636, "link": "https://stackoverflow.com/questions/41412636/haskell-packages-base-versus-haskel98", "title": "haskell packages: base versus haskel98", "body": "<p>I installed haskell-platform on my Ubuntu system. Now I need to run </p>\n\n<pre><code>ghci -package haskell98 -hide-package base\n</code></pre>\n\n<p>in order to try out simple things like:</p>\n\n<pre><code> map Char.toUpper \"Hello World\"\n</code></pre>\n\n<p>Is there a way to make this the default? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1483231388, "post_id": 41412513, "comment_id": 70029018, "body": "No idea, but I&#39;d try adding an explicit type signature for <code>&gt;~</code> as well in you module <code>Util</code>"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1483231983, "post_id": 41412513, "comment_id": 70029095, "body": "This sounds like the monomorphism restriction - which @chi&#39;s suggestion would address.  And that&#39;s also why <code>&gt;&gt;~</code> needed a type signature.  And for what it&#39;s worth, only primitive functions are built-in.  Certainly nothing in <code>Control.Monad</code> is primitive."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1483257888, "post_id": 41412513, "comment_id": 70032127, "body": "<i>&quot;The explicit type sig is only because despite the bleedingly obvious &quot;it&#39;s just an alias for a built-in func&quot; GHC couldn&#39;t figure this out and forced me to, so let&#39;s ignore this here.&quot;</i> No. Don&#39;t ignore. That&#39;s exactly the source for your error. Never write pointfree bindings without a type signature if you want to export them. Even better, never export any function without a type signature, their behavior might break (silently) on a library update."}, {"owner": {"reputation": 2044, "user_id": 1258491, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/yyvEu.png?s=128&g=1", "display_name": "metaleap", "link": "https://stackoverflow.com/users/1258491/metaleap"}, "edited": false, "score": 0, "creation_date": 1483261666, "post_id": 41412513, "comment_id": 70032741, "body": "For simple <code>my_alias_name = defined_elsewhere</code> no-special-annotations usage, not sure I&#39;ll ever grasp why the issue even comes up. In each &amp; every such instance, right after the successful parse and first round of processing, <code>my_alias_name</code> shouldn&#39;t even <i>exist</i> as its own identity anymore and be replaced throughout by the thing it pointed to, no? Why keep such useless pointers even around, they only existed (indeed, given their <i>id</i> nature only possibly <i>could</i> exist) for readability/swappability.. This then wouldn&#39;t even necessitate type inference since the original definition is taken."}, {"owner": {"reputation": 2044, "user_id": 1258491, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/yyvEu.png?s=128&g=1", "display_name": "metaleap", "link": "https://stackoverflow.com/users/1258491/metaleap"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1483262914, "post_id": 41412513, "comment_id": 70032941, "body": "@chi tried (just used what <i>ghci</i> gave me on <code>:t (flip fmap)</code>) and other code that previously compiled (and worked) now demanded type sigs too apparently or in any event type-errored-out. Well I tend to wait with my sigs until a project is &quot;done&quot;, so in the very few cases where <code>&gt;~</code> won&#39;t work (usually in combination with <code>&gt;&gt;~</code>) I&#39;ll just go with <code>&lt;$&gt;</code> instead."}], "owner": {"reputation": 2044, "user_id": 1258491, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/yyvEu.png?s=128&g=1", "display_name": "metaleap", "link": "https://stackoverflow.com/users/1258491/metaleap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 0, "closed_date": 1483258025, "answer_count": 0, "score": 1, "last_activity_date": 1483230407, "creation_date": 1483229871, "last_edit_date": 1483230407, "question_id": 41412513, "link": "https://stackoverflow.com/questions/41412513/why-does-my-infix-operator-compile-unless-imported", "closed_reason": "Duplicate", "title": "Why does my infix operator compile unless imported?", "body": "<p>I have the following in a <code>module Util</code> that I use widely without issues:</p>\n\n<pre><code>(&gt;~) = flip fmap\ninfix 8 &gt;~\n\n(&gt;&gt;~) :: (Traversable t, Monad m) =&gt; t a -&gt; (a -&gt; m b) -&gt; m (t b)\n(&gt;&gt;~) = Control.Monad.forM\ninfix 8 &gt;&gt;~\n</code></pre>\n\n<p><em>(The explicit type sig is only because despite the bleedingly obvious \"it's just an alias for a built-in func\" GHC couldn't figure this out and forced me to, so let's ignore this here.)</em></p>\n\n<p>NOW, in another module (same project) I import the above operators and oddly enough, the following few lines <strong>DO</strong> compile just-fine:</p>\n\n<pre><code>listAllFiles rootdirpath reldirs modtimer =\n    let allfiles = (dirpaths &gt;&gt;~ foreachdir) &gt;~~ concat\n        (&gt;~~) = flip fmap\n        infix 8 &gt;~~\n        ...\n</code></pre>\n\n<p>But the following variation (which I'd prefer obviously) will fail to compile:</p>\n\n<pre><code>listAllFiles rootdirpath reldirs modtimer =\n    let allfiles = (dirpaths &gt;&gt;~ foreachdir) &gt;~ concat\n        ...\n</code></pre>\n\n<p>Isn't that odd, given how the <em>successful</em> <code>&gt;~~</code> declared locally right above was defined in <em>exactly the very identical way</em> as the imported <code>&gt;~</code>?</p>\n\n<p>Where's the logic in that, can anyone share their insights on this? Oh, here's the error:</p>\n\n<pre><code>Files.hs:88:21: error:\n* Couldn't match type `IO' with `[]'\n  Expected type: [[[(FilePath, Data.Time.Clock.UTCTime)]]]\n    Actual type: IO [[(FilePath, Data.Time.Clock.UTCTime)]]\n* In the first argument of `(&gt;~)', namely\n    `(dirpaths &gt;&gt;~ foreachdir)'\n  In the expression: (dirpaths &gt;&gt;~ foreachdir) &gt;~ concat\n  In an equation for `allfiles':\n      allfiles = (dirpaths &gt;&gt;~ foreachdir) &gt;~ concat\n</code></pre>\n\n<p>.. but obviously this question isn't about how to deal with <em>\"Couldn't match type 'a' with 'b'\"</em> errors per-se / in the general case --- keep in mind in a functional language I expect identical definitions to work identically, whether defined in a local <code>let</code> or in an imported module. What in the heck could be disrupting this general principle in this specific instance?</p>\n\n<p>It's not a show-stopper, I could skip the fancy ops go <code>fmap concat (etc)</code> and just get on with business. But I guess there's maybe something deeper to learn here (or an obscure bug encountered to be reported)!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1483220080, "post_id": 41411687, "comment_id": 70027381, "body": "<a href=\"http://stackoverflow.com/questions/41404647/how-to-implement-search-in-file-system-in-haskell\">Maybe relevant from yesterday</a>."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 1, "creation_date": 1483223996, "post_id": 41411687, "comment_id": 70028018, "body": "Not an answer, but note that you can use <code>listDirectory</code> in place of <code>getDirectoryContents</code> to automatically filter out the <code>.</code> and <code>..</code> special directories."}, {"owner": {"reputation": 169, "user_id": 4386129, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100000394595220/picture?type=large", "display_name": "BarbedWire", "link": "https://stackoverflow.com/users/4386129/barbedwire"}, "edited": false, "score": 0, "creation_date": 1483226053, "post_id": 41411687, "comment_id": 70028347, "body": "Yes, I noticed listDirectory. Actually I oversaw that filtering from this function. :) Happy new year."}, {"owner": {"reputation": 463, "user_id": 2976251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe393a6e3c9fe3857dc7b27ff5db473?s=128&d=identicon&r=PG&f=1", "display_name": "hasufell", "link": "https://stackoverflow.com/users/2976251/hasufell"}, "edited": false, "score": 1, "creation_date": 1483355369, "post_id": 41411687, "comment_id": 70056689, "body": "The directory package is wrong and dangerous, since it uses a false representation of filepath (String). Look at the <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Proposal/AbstractFilePath\" rel=\"nofollow noreferrer\">AbstractFilePath</a> proposal for reasoning. Some packages like <a href=\"https://hackage.haskell.org/package/hpath-0.8.0/docs/System-Posix-Directory-Traversals.html#v:allDirectoryContents\" rel=\"nofollow noreferrer\">hpath</a> and <a href=\"https://hackage.haskell.org/package/posix-paths-0.2.1.0/docs/System-Posix-Directory-Traversals.html\" rel=\"nofollow noreferrer\">posix-paths</a> (not maintained anymore) have recursive functions for that and use a safe ByteString representation for filepath."}], "answers": [{"tags": [], "owner": {"reputation": 533, "user_id": 919930, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Vmekk.jpg?s=128&g=1", "display_name": "Slaven Glumac", "link": "https://stackoverflow.com/users/919930/slaven-glumac"}, "is_accepted": true, "score": 1, "last_activity_date": 1483273897, "creation_date": 1483273897, "answer_id": 41415469, "question_id": 41411687, "link": "https://stackoverflow.com/questions/41411687/nested-directories-list-in-haskell/41415469#41415469", "title": "Nested directories list in Haskell", "body": "<p>If it's ok to use <a href=\"https://hackage.haskell.org/package/FileManip-0.3.3.1/docs/System-FilePath-Find.html\" rel=\"nofollow noreferrer\">filemanip</a> package:</p>\n\n<pre><code>import System.FilePath.Find\n\ngetDirList dir = find always (fileType ==? Directory) dir\n</code></pre>\n"}], "owner": {"reputation": 169, "user_id": 4386129, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100000394595220/picture?type=large", "display_name": "BarbedWire", "link": "https://stackoverflow.com/users/4386129/barbedwire"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "accepted_answer_id": 41415469, "answer_count": 1, "score": 1, "last_activity_date": 1483273897, "creation_date": 1483217968, "question_id": 41411687, "link": "https://stackoverflow.com/questions/41411687/nested-directories-list-in-haskell", "title": "Nested directories list in Haskell", "body": "<p>I'm just wondering if I can use any specific method from System.Directory package or something to get a list of all nested directories given a specified path. I have not found any appropriate function so I came up with something like this:</p>\n\n<pre><code>getDirList :: FilePath -&gt; IO [FilePath]\ngetDirList dir = do\n  contents &lt;- getDirectoryContents dir\n  all &lt;- mapM (return . (dir &lt;/&gt;)) $ filter (\\f -&gt; f /= \".\" &amp;&amp; f /= \"..\") contents\n  dirs &lt;- filterM doesDirectoryExist all\n  dirs' &lt;- mapM getDirList dirs\n  return (dir : concat dirs')\n</code></pre>\n\n<p>May be I have been missing something really simple? Can anybody suggest? Thank you.</p>\n"}, {"tags": ["haskell", "ffi"], "comments": [{"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 1, "creation_date": 1483213274, "post_id": 41410805, "comment_id": 70025940, "body": "Is it possible that the buffer is being overrun in <i>both</i> situations, and it&#39;s just that <code>mallocBytes</code> and <code>free</code> catch the error while the other leads to silent corruption?  It appears that <code>allocaBytes</code> ultimately uses the GHC primitive <code>newPinnedByteArray#</code>, so it doesn&#39;t seem to be a simple <code>malloc</code> call."}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "reply_to_user": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1483213569, "post_id": 41410805, "comment_id": 70026002, "body": "I don&#39;t think the buffer is being overrun at all. I have tests now that confirm via encoding/decoding and comparing of WAVE data blocks that encoder and decoder bindings work correctly and decoded back data matches the original. If the buffer were overrun, it would likely lead to data corruption."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1483213947, "post_id": 41410805, "comment_id": 70026066, "body": "Not necessarily. &quot;Undefined behaviour&quot; is, well, undefined. It might work, it might also set your cat on fire. Note that a double use of <code>free</code> usually shows memory corruption, not necessarily a real second use of <code>free</code> at that memory location."}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1483214352, "post_id": 41410805, "comment_id": 70026147, "body": "@Zeta, I thought of this possibility when I began investigation of issue. Certainly max_frame_size * block_align should be enough to hold one frame. It&#39;s a bit trickier with assigning 24 bit samples, but the issue was there even for 16 bit samples and even when I allocated much more memory than needed to test if buffer overrun is taking place. Even with extra memory the issue was there."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1483214502, "post_id": 41410805, "comment_id": 70026172, "body": "Do you have a way to duplicate the problem?  If I grab your current head at commit <code>0bac08</code>, replace the <code>allocaBytes bufferSize</code> call with <code>bracket (mallocBytes bufferSize) free</code> in <code>StreamDecoder.hs</code> and run <code>stack test</code>, the test suite runs fine.  (I am running on an Ubuntu Xenial distribution with libflac 1.3.1-4.)"}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "reply_to_user": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1483214901, "post_id": 41410805, "comment_id": 70026235, "body": "@K.A.Buhr Sure thing, you need <code>encoder-decoder-tests</code> branch, it has the tests that cause the crash. Just checkout that branch, replace <code>allocaBytes</code> like you did and run the tests."}], "answers": [{"comments": [{"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 1, "creation_date": 1483219947, "post_id": 41411441, "comment_id": 70027344, "body": "You were right, I mixed up frame sizes and block sizes, and since block size is often greater than frame size there was quite a few bytes written over the boundary of the buffer."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 12, "last_activity_date": 1483215908, "last_edit_date": 1483215908, "creation_date": 1483215520, "answer_id": 41411441, "question_id": 41410805, "link": "https://stackoverflow.com/questions/41410805/what-is-the-difference-between-bracket-mallocbytes-n-free-and-allocabytes/41411441#41411441", "title": "What is the difference between &quot;bracket (mallocBytes n) free&quot; and &quot;allocaBytes&quot;?", "body": "<p><code>bracket (mallocBytes size) free</code> will use C's <code>malloc</code> and <code>free</code>, whereas <code>allocaBytes size</code> will use memory that's managed by GHCs garbage collection. That in itself is a huge difference already, since the <code>Ptr</code> of <code>allocaBytes</code> might be surrounded by unused (but allocated) memory:</p>\n\n<pre><code>import Control.Exception\nimport Control.Monad (forM_)\nimport Foreign.Marshal.Alloc\nimport Foreign.Ptr\nimport Foreign.Storable\n\n-- Write a value at an invalid pointer location\nhammer :: Ptr Int -&gt; IO ()\nhammer ptr = pokeElemOff ptr (-1) 0 &gt;&gt; putStrLn \"hammered\"\n\nmain :: IO ()\nmain = do\n  putStrLn \"Hammer time! Alloca!\"\n  forM_ [1..10] $ \\n -&gt;\n    print n &gt;&gt; allocaBytes 10 hammer\n\n  putStrLn \"Hammer time! Bracket\"\n  forM_ [1..10] $ \\n -&gt;\n    print n &gt;&gt; bracket (mallocBytes 10) free hammer\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>Hammer time! Alloca!\n1\nhammered\n2\nhammered\n3\nhammered\n4\nhammered\n5\nhammered\n6\nhammered\n7\nhammered\n8\nhammered\n9\nhammered\n10\nhammered\nHammer time! Bracket\n1\nhammered\n&lt;program crashes&gt;\n</code></pre>\n\n<p>As you can see, although we've used <code>arr[-1] = 0</code>, <code>allocaBytes</code> happily ignored that error. However, <code>free</code> will (often) blow up in your face if you write to position <code>-1</code>. It will also blow up in your face if there has been a memory corruption on another allocated memory region*.</p>\n\n<p>Also, with <code>allocaBytes</code>, it's likely that the pointer points somewhere into already allocated memory, not to the start of one, e.g.</p>\n\n<pre><code>nursery = malloc(NURSERY_SIZE);\n\n// ...\n\npointer_for_user = nursery + 180;\n\n// pointer_for_user[-1] = 0 is not as \n// much as a problem, since it doesn't yield undefined behaviour\n</code></pre>\n\n<p>What does that mean? Well, <code>allocaBytes</code> is less likely to blow up in your face, but at the cost that you don't notice if your C-code variant would lead to memory corruption. Even worse, as soon as you write outside of the bounds returned by <code>allocaBytes</code>, your possibly corrupting other <em>Haskell</em> values silently.</p>\n\n<p>However, we're talking here about undefined behaviour. The code above may or may not crash on your system. It may also crash in the <code>allocaBytes</code> part.</p>\n\n<p>If I were you, I would <a href=\"http://man7.org/linux/man-pages/man3/mtrace.3.html\" rel=\"nofollow noreferrer\">trace the <code>malloc</code> and <code>free</code> calls</a>.</p>\n\n<hr>\n\n<p><sup>* I once had a \"double use of free\" error in the middle of my program. Debugged everything, rewrote most of the \"bad\" routine. Unfortunately, the error vanished in debug builds, but recurred in release builds. It turned out that in the first ten lines of <code>main</code>, I accidentally wrote to <code>b[i - 1]</code> with <code>i = 0</code>.</sup></p>\n"}, {"comments": [{"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1483218968, "post_id": 41411701, "comment_id": 70027132, "body": "Thanks for your help, I think I know where to look now ;-)"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1483223296, "post_id": 41411701, "comment_id": 70027895, "body": "Ah, a good old canary. By the way, I would change the wording, since your code doesn&#39;t &quot;add a page&quot; (the additional memory might not start at the page alignment). Also, you can simplify <code>hexline</code> to <code>hexline bytes off = unwords . map hex . take 16 . drop off $ bytes</code>."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 5, "last_activity_date": 1483223780, "last_edit_date": 1483223780, "creation_date": 1483218089, "answer_id": 41411701, "question_id": 41410805, "link": "https://stackoverflow.com/questions/41410805/what-is-the-difference-between-bracket-mallocbytes-n-free-and-allocabytes/41411701#41411701", "title": "What is the difference between &quot;bracket (mallocBytes n) free&quot; and &quot;allocaBytes&quot;?", "body": "<p>I was able to duplicate the problem, and I can confirm that there is substantial buffer overrun going on.  If you use the following allocator (please excuse the quick and dirty code) which adds a page's worth of <code>0xa5</code>s after the buffer and dumps it out if it's modified, you can see overrun of several hundred bytes in several tests:</p>\n\n<pre><code>withBuffer :: Int -&gt; (Ptr a -&gt; IO b) -&gt; IO b\nwithBuffer n = bracket begin end\n  where begin = do\n          a &lt;- mallocBytes (n + 4096)\n          mapM_ (\\i -&gt; pokeByteOff (a `plusPtr` n) i (0xa5 :: Word8)) [0..4095]\n          return a\n        end = \\a -&gt; do\n          page &lt;- mapM (\\i -&gt; peekByteOff (a `plusPtr` n) i) [0..4095]\n          when (any (/= (0xa5 :: Word8)) page) $ do\n            putStrLn $ unlines $ map (hexline page) [0,16..4095]\n            error \"corruption detected\"\n          free a\n        hexline bytes off = unwords . map hex . take 16 . drop off $ bytes\n        hex = printf \"%02x\"\n</code></pre>\n"}], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 321, "favorite_count": 0, "accepted_answer_id": 41411441, "answer_count": 2, "score": 8, "last_activity_date": 1483223780, "creation_date": 1483208946, "question_id": 41410805, "link": "https://stackoverflow.com/questions/41410805/what-is-the-difference-between-bracket-mallocbytes-n-free-and-allocabytes", "title": "What is the difference between &quot;bracket (mallocBytes n) free&quot; and &quot;allocaBytes&quot;?", "body": "<p>If you want background, see <a href=\"https://github.com/xiph/flac/issues/24\">here</a>. In short, the question is: \u201cWhat's actual difference between <code>bracket (mallocBytes n) free</code> and <code>allocaBytes</code> from <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Foreign-Marshal-Alloc.html\"><code>Foreign.Marshall.Alloc</code></a>\u201d.</p>\n\n<p>Normally in C, <code>alloca</code> allocates on stack and <code>malloc</code> allocates on heap. I'm not sure what's going on with it in Haskell, but I would not expect a difference between the above-mentioned equations other than speed. If you clicked the background link though, you know that with compiled code <code>bracket (mallocBytes n) free</code> was resulting in \u201cdouble free or corruption\u201d while <code>allocaBytes</code> works fine (the problem is not visible when in GHCi at all, everything works fine in both cases).</p>\n\n<p>By now I've spent two days in painful debugging and I'm pretty confident that <code>bracket (mallocBytes n) free</code> was unstable somehow and the rest of the code is reliable. I'd like to find out what's the deal with <code>bracket (mallocBytes n) free</code>.</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 3, "creation_date": 1483193143, "post_id": 41408922, "comment_id": 70020789, "body": "The children can be stored. In a list. They are sometimes called &quot;rose trees&quot;: <a href=\"http://hackage.haskell.org/package/containers-0.5.9.1/docs/Data-Tree.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/containers-0.5.9.1/docs/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 6, "last_activity_date": 1483233317, "last_edit_date": 1483233317, "creation_date": 1483195290, "answer_id": 41409209, "question_id": 41408922, "link": "https://stackoverflow.com/questions/41408922/data-type-for-tree-in-haskell/41409209#41409209", "title": "Data type for Tree in Haskell", "body": "<p>You can either have a <em>fixed</em> branching factor:</p>\n\n<pre><code>data BinaryTree a  = BTNil \n                   | BTNode a (BinaryTree a) (BinaryTree a)\n\ndata TernaryTree a = TTNil\n                   | TTNode a (TernaryTree a) (TernaryTree a) (TernaryTree a)\n\ndata QuadTree a    = QTNil\n                   | QTNode a (QuadTree a) (QuadTree a) (QuadTree a) (QuadTree a)\n\n-- etc\n</code></pre>\n\n<p>(Note that <code>QuadTree</code> isn't a great name for a general tree with a branching factor of 4, since there is a <a href=\"https://en.wikipedia.org/wiki/Quadtree\" rel=\"nofollow noreferrer\">specific data structure with that name</a>.)</p>\n\n<p>or you can simply use a <em>rose tree</em>, which stores an arbitrary list of children at each node.</p>\n\n<pre><code>data RoseTree a = RTNil | RTNode a [RoseTree a]\n</code></pre>\n\n<p>There is some duplication here, as <code>RTNil</code> is <em>only</em> needed to store an explicit empty tree. Leaf nodes are just <code>RTNode a []</code>. (Consider what difference, if any, you would assign to the values <code>RTNode 3 []</code>, <code>RTNode 3 [RTNil]</code>, <code>RTNode 3 [RTNil, RTNil]</code>, etc.)</p>\n"}, {"tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": false, "score": 14, "last_activity_date": 1483200098, "creation_date": 1483200098, "answer_id": 41409851, "question_id": 41408922, "link": "https://stackoverflow.com/questions/41408922/data-type-for-tree-in-haskell/41409851#41409851", "title": "Data type for Tree in Haskell", "body": "<p>A lesser known technique is <a href=\"https://en.wikipedia.org/wiki/Left-child_right-sibling_binary_tree\" rel=\"noreferrer\"><strong>Left-child right-sibling</strong></a> where you can use the <em>exact same</em> type to encode trees with more than two children per node:</p>\n\n<p><a href=\"https://i.stack.imgur.com/QzTYH.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/QzTYH.png\" alt=\"left-child-right-sibiling\"></a></p>\n\n<pre><code>data Tree a\n  = Nil\n  | Node a (Tree a) (Tree a) -- value, left child, right sibling\n</code></pre>\n\n<p>The alternative <code>[Tree a]</code> does <em>not</em> have a performance advantage, since Haskell lists are linked lists.</p>\n"}], "owner": {"reputation": 99, "user_id": 6414566, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5ed1971c96d5d73a8d964ea4c8a99799?s=128&d=identicon&r=PG&f=1", "display_name": "SOAP", "link": "https://stackoverflow.com/users/6414566/soap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5150, "favorite_count": 0, "accepted_answer_id": 41409209, "answer_count": 2, "score": 4, "last_activity_date": 1483233317, "creation_date": 1483192643, "last_edit_date": 1483206896, "question_id": 41408922, "link": "https://stackoverflow.com/questions/41408922/data-type-for-tree-in-haskell", "title": "Data type for Tree in Haskell", "body": "<p>For a  data type of a binary tree you can write something like this:</p>\n\n<pre><code>data Tree a = Nil | Node a (Tree a) (Tree a)\n</code></pre>\n\n<p>So if I do want to include trees, with Nodes having more than just two children, how could the data type possibly look like?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 1, "creation_date": 1483187926, "post_id": 41408334, "comment_id": 70019586, "body": "How many times did you try to evaluate it? Probably you just messed up some calculation. Maybe write down why you think it should be 42, so we can point out your mistake."}], "answers": [{"tags": [], "owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "is_accepted": true, "score": 8, "last_activity_date": 1483668072, "last_edit_date": 1483668072, "creation_date": 1483188242, "answer_id": 41408397, "question_id": 41408334, "link": "https://stackoverflow.com/questions/41408334/evaluating-recursive-function-in-haskell/41408397#41408397", "title": "Evaluating recursive function in Haskell", "body": "<p>You just need to think it out step by step:</p>\n\n<pre><code>(g 5) = 2 * (g 4) + 1\n(g 4) = 2 * (g 3) + 1\n(g 3) = 2 * (g 2) + 1\n(g 2) = 2 * (g 1) + 1\n(g 1) = 2 * (g 0) + 1\n(g 0) = 1\n</code></pre>\n\n<p>Then, plug in the values from the bottom-up:</p>\n\n<pre><code>2 * 1 + 1 = 3\n2 * 3 + 1 = 7\n2 * 7 + 1 = 15\n2 * 15 + 1 = 31\n2 * 31 + 1 = 63\n</code></pre>\n\n<p>Your problem is that you were using the raw value of <code>n</code>, instead of what <code>(g n)</code> returned at the end of the recursion.</p>\n"}, {"tags": [], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "is_accepted": false, "score": 2, "last_activity_date": 1483189016, "last_edit_date": 1483189016, "creation_date": 1483188598, "answer_id": 41408438, "question_id": 41408334, "link": "https://stackoverflow.com/questions/41408334/evaluating-recursive-function-in-haskell/41408438#41408438", "title": "Evaluating recursive function in Haskell", "body": "<p>In your calculation you messed up with the nesting of the terms. They should be nested and not summed up separately.</p>\n\n<p>The way to evaluate such functions is to replace function applications with the body of the function with its parameters replaced by the given arguments. I will do the first few steps and then you can take over:</p>\n\n<pre><code>g 5\nif 5 == 0 then 1 else 2 * g (5-1) + 1\n2 * g (5-1) + 1\n2 * (if (5 - 1) == 0 then 1 else 2 * g ((5-1) - 1) + 1) + 1\n2 * (if 4 == 0 then 1 else 2 * g (4-1) + 1) + 1\n2 * (2 * g (4-1) + 1) + 1\n...\n63\n</code></pre>\n\n<p>@Carcigenicate's answer is of course easier to calculate, but this technique is more universal and more inline with how the code actually works.</p>\n"}, {"tags": [], "owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "is_accepted": false, "score": 0, "last_activity_date": 1483226409, "creation_date": 1483226409, "answer_id": 41412327, "question_id": 41408334, "link": "https://stackoverflow.com/questions/41408334/evaluating-recursive-function-in-haskell/41412327#41412327", "title": "Evaluating recursive function in Haskell", "body": "<p>Although this isn't your question, it's fairly easy to show by induction that</p>\n\n<pre><code>g n = 2^(n+1)-1\n</code></pre>\n\n<p>So </p>\n\n<pre><code>g 5 = 2^6 - 1 --&gt; 63\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "is_accepted": false, "score": 0, "last_activity_date": 1483382176, "creation_date": 1483382176, "answer_id": 41431774, "question_id": 41408334, "link": "https://stackoverflow.com/questions/41408334/evaluating-recursive-function-in-haskell/41431774#41431774", "title": "Evaluating recursive function in Haskell", "body": "<p>Your parenthesization is wrong.  Not doing any reductions (other than expanding <code>g</code>), we get</p>\n\n<pre><code>g 5\n= 2 * g 4 + 1\n= 2 * (2 * g 3 + 1) + 1\n= 2 * (2 * (2 * g 2 + 1) + 1) + 1\n= 2 * (2 * (2 * (2 * g 1 + 1) + 1) + 1) + 1\n= 2 * (2 * (2 * (2 * (2 * g 0 + 1) + 1) + 1) + 1) + 1\n= 2 * (2 * (2 * (2 * (2 * 1 + 1) + 1) + 1) + 1) + 1\n</code></pre>\n"}], "owner": {"reputation": 148, "user_id": 6357057, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a0320816e0566f6c49d885db4e40d089?s=128&d=identicon&r=PG&f=1", "display_name": "Pete", "link": "https://stackoverflow.com/users/6357057/pete"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 262, "favorite_count": 0, "accepted_answer_id": 41408397, "answer_count": 4, "score": 1, "last_activity_date": 1483668072, "creation_date": 1483187673, "last_edit_date": 1483188069, "question_id": 41408334, "link": "https://stackoverflow.com/questions/41408334/evaluating-recursive-function-in-haskell", "title": "Evaluating recursive function in Haskell", "body": "<p>I am given this function and asked to manually evaluate <code>g 5</code>. I found the answer to be 25, but this is incorrect. The correct answer is 63. Would anyone help me understand why? Thanks</p>\n\n<pre><code>g :: Int -&gt; Int\ng n \n  | n==0      = 1\n  | otherwise = 2 * g (n-1) + 1\n</code></pre>\n\n<p>My answer: (2*4+1) + (2*3+1) + (2*2+1) + (2*1+1) + 1 = 25</p>\n"}, {"tags": ["haskell", "inline-c"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user933161"}, "edited": false, "score": 0, "creation_date": 1483183909, "post_id": 41407845, "comment_id": 70018657, "body": "Is it safe to assume that the data is copied and allocated memory can be freed?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1483184087, "post_id": 41407845, "comment_id": 70018710, "body": "@Igor With <code>peekArray</code>, yes. With <code>unsafeFromForeignPtr</code>, no."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1483184157, "post_id": 41407845, "comment_id": 70018729, "body": "@Igor PS, <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Foreign-Marshal-Array.html#v:callocArray\" rel=\"nofollow noreferrer\">Haskell bindings to <code>malloc</code> and friends already exist</a>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user933161"}, "edited": false, "score": 0, "creation_date": 1483184740, "post_id": 41407845, "comment_id": 70018883, "body": "Thank you Benjamin!"}, {"owner": {"user_type": "does_not_exist", "display_name": "user933161"}, "edited": false, "score": 0, "creation_date": 1483185094, "post_id": 41407845, "comment_id": 70018959, "body": "Ah, I&#39;m not writing binding :) I have a C code yielding structured data. Probably with <code>callocArray</code> I should consider allocating the array in Haskell and pass it to C."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1483191153, "post_id": 41407845, "comment_id": 70020277, "body": "Doesn&#39;t the code above leak the allocated pointer? After the peek we need to call <code>free</code>, right?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1483195892, "post_id": 41407845, "comment_id": 70021469, "body": "@chi That&#39;s right. I left it out of my example to keep the code short but in the real world you would of course need to clean up after yourself"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 3, "last_activity_date": 1483183649, "last_edit_date": 1483183649, "creation_date": 1483183227, "answer_id": 41407845, "question_id": 41407363, "link": "https://stackoverflow.com/questions/41407363/how-to-return-a-list-or-array-from-c-block-in-haskells-inline-c/41407845#41407845", "title": "How to return a list or array from C block in Haskell&#39;s inline-c?", "body": "<p>Return a pointer to the array from your C code and use <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Foreign-Marshal-Array.html#v:peekArray\" rel=\"nofollow noreferrer\"><code>peekArray</code></a> to marshal it to a list.</p>\n\n<pre><code>import Foreign.Marshal.Array\nimport Language.C.Inline\n\nfoo :: Int -&gt; IO [Int]\nfoo size = [exp| int* { calloc($(int size), sizeof(int)) }] &gt;&gt;= peekArray size\n</code></pre>\n\n<p><code>peekArray</code> accepts a pointer argument and a number of elements to read. It iteratively increments the pointer <code>size</code> times, pulling elements off the array using the type's <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Foreign-Storable.html\" rel=\"nofollow noreferrer\"><code>Storable</code></a> instance (in this case, <code>Int</code>).</p>\n\n<p>It may be more efficient to <a href=\"https://hackage.haskell.org/package/vector-0.11.0.0/docs/Data-Vector-Storable.html#v:unsafeFromForeignPtr\" rel=\"nofollow noreferrer\">turn your array into an unboxed <code>Vector</code></a>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user933161"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 284, "favorite_count": 0, "accepted_answer_id": 41407845, "answer_count": 1, "score": 4, "last_activity_date": 1483183649, "creation_date": 1483179107, "last_edit_date": 1483181685, "question_id": 41407363, "link": "https://stackoverflow.com/questions/41407363/how-to-return-a-list-or-array-from-c-block-in-haskells-inline-c", "title": "How to return a list or array from C block in Haskell&#39;s inline-c?", "body": "<p>How can I get a list or array from C block in Haskell's <a href=\"https://hackage.haskell.org/package/inline-c\" rel=\"nofollow noreferrer\">inline-c</a>? In other words, how to construct complex data in C and work with it in Haskell.\nSomething like this:</p>\n\n<pre><code>foo :: IO [Int]\nfoo = do\n what? &lt;- [C.block| &lt;what?&gt; {\n    ints = calloc(10, sizeof(int));\n    // ...\n    return &lt;what?&gt;;\n  } |]\n  return &lt;what?&gt;\n</code></pre>\n\n<p>I could wrap a pointer and a size in some Haskell type, but I'd like to work with the list in Haskell, print it, encode in JSON, etc.</p>\n"}, {"tags": ["haskell", "concurrency"], "answers": [{"comments": [{"owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "edited": false, "score": 0, "creation_date": 1483988925, "post_id": 41406533, "comment_id": 70315476, "body": "Hey! What if I&#39;d like to print results as they are available? With this It version it will only print the whole list at the end (faster than with find actually, which is good, but still). I can probably create a solution using channels, but maybe there is easier way?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "edited": false, "score": 0, "creation_date": 1484017111, "post_id": 41406533, "comment_id": 70325720, "body": "@user1685095 I guess a channel is probably the way to go... Alternately, you could use something prebuilt for this. A quick search yields <a href=\"https://hackage.haskell.org/package/concurrent-output-1.7.8/docs/System-Console-Concurrent.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/concurrent-output-1.7.8/docs/&hellip;</a>"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 2, "last_activity_date": 1483170812, "creation_date": 1483170812, "answer_id": 41406533, "question_id": 41404647, "link": "https://stackoverflow.com/questions/41404647/how-to-implement-search-in-file-system-in-haskell/41406533#41406533", "title": "How to implement search in file system in haskell?", "body": "<blockquote>\n  <p>Which got me thinking that what I need is to produce lazy Tree data structure that would reflect folders structure.</p>\n</blockquote>\n\n<p>I'm not sure you need a tree structure for this. You <em>could</em> make an intermediate such structure, but you could just as well manage without one. The key thing is you need to have <code>O(1)</code> appending (to combine your results). A difference list (like <a href=\"https://hackage.haskell.org/package/dlist\" rel=\"nofollow noreferrer\"><code>dlist</code></a>) does this.</p>\n\n<blockquote>\n  <p>How to produce it concurrently?</p>\n</blockquote>\n\n<p>You already got that: using <code>mapConcurrently</code>!</p>\n\n<blockquote>\n  <p>How to produce absolute path while traversing the tree?</p>\n</blockquote>\n\n<p><a href=\"http://hackage.haskell.org/package/directory-1.3.0.0/docs/System-Directory.html#v:listDirectory\" rel=\"nofollow noreferrer\"><code>listDirectory</code></a> lets you get the next possible segments in the path. You can get the next paths by appending each of these segments to the existing path (they won't be absolute paths unless the existing path was though).</p>\n\n<hr>\n\n<p>Here is a working function:</p>\n\n<pre><code>import System.Directory (doesDirectoryExist, listDirectory)\nimport System.FilePath ((&lt;/&gt;), combine)\nimport System.IO (FilePath)\nimport Control.Concurrent.Async (mapConcurrently)\nimport qualified Data.DList as DL\n\n-- | tries to find all git repos in the subtree rooted at the path\nfindGitRepos :: FilePath -&gt; IO (DL.DList FilePath)\nfindGitRepos p = do\n  isNotDir &lt;- not &lt;$&gt; doesDirectoryExist p\n  if isNotDir\n    then pure DL.empty             -- the path 'p' isn't a directory\n    else do\n      isGitDir &lt;- doesDirectoryExist (p &lt;/&gt; \".git\")\n      if isGitDir\n        then pure (DL.singleton p) -- the folder is a git repo\n        else do                    -- recurse to subfolders\n          subdirs &lt;- listDirectory p\n          repos &lt;- mapConcurrently findGitRepos (combine p `map` subdirs)\n          pure (DL.concat repos)\n</code></pre>\n"}], "owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 0, "accepted_answer_id": 41406533, "answer_count": 1, "score": 2, "last_activity_date": 1483170812, "creation_date": 1483147687, "question_id": 41404647, "link": "https://stackoverflow.com/questions/41404647/how-to-implement-search-in-file-system-in-haskell", "title": "How to implement search in file system in haskell?", "body": "<p>I'm not exactly new to haskell, but haven't used it much in real world.</p>\n\n<p>So what I want to do is to find all git repositories starting from some folders. Basically I'm trying to do this <code>find . -type d -exec test -e '{}/.git' ';' -print -prune</code> only faster via using haskell concurrency features.</p>\n\n<p>This is what I got so far.</p>\n\n<pre><code>import Control.Concurrent.Async\nimport System.Directory (doesDirectoryExist)\nimport System.FilePath ((&lt;/&gt;))\nimport System.IO (FilePath)\n\n\nisGitRepo :: FilePath -&gt; IO Bool\nisGitRepo p = doesDirectoryExist $ p &lt;/&gt; \".git\"\n\n\nmain :: IO ()\nmain = putStrLn \"hello\"\n</code></pre>\n\n<p>I've found this <a href=\"https://www.stackage.org/haddock/lts-7.14/async-2.1.1/Control-Concurrent-Async.html#v:mapConcurrently\" rel=\"nofollow noreferrer\">lib</a> which has this function <code>mapConcurrently :: Traversable t =&gt; (a -&gt; IO b) -&gt; t a -&gt; IO (t b)</code>\nWhich got me thinking that what I need is to produce lazy Tree data structure that would reflect folders structure. Then filter it concurrently with <code>isGitRepo</code> and that fold it into list and print it.\nWell, of course I know how to make <code>data FTree = Node String [FTree]</code> or something like that, but I have questions.\nHow to produce it concurrently? How to produce absolute path while traversing the tree? Questions like that and so on.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "edited": false, "score": 0, "creation_date": 1483141055, "post_id": 41403983, "comment_id": 70010650, "body": "ok thank you - so I didn&#39;t write any sort of blasphemy :) or &quot;bad practice&quot; for that specific case, right?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "edited": false, "score": 0, "creation_date": 1483141151, "post_id": 41403983, "comment_id": 70010672, "body": "@Randomize No, I don&#39;t see a problem with your code."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "edited": false, "score": 0, "creation_date": 1483191518, "post_id": 41403983, "comment_id": 70020355, "body": "@Randomize No, using top-level bindings for things which should be computed only once is fairly idiomatic."}, {"owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "edited": false, "score": 0, "creation_date": 1483228607, "post_id": 41403983, "comment_id": 70028670, "body": "To be clear, these statements are about how GHC works now (and even then they aren&#39;t absolute).  Nothing in the Haskell Report says anything about how often any expression is evaluated."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 6, "last_activity_date": 1483140690, "creation_date": 1483140690, "answer_id": 41403983, "question_id": 41403910, "link": "https://stackoverflow.com/questions/41403910/building-data-with-logic/41403983#41403983", "title": "Building data with logic", "body": "<p>This will work. By binding the value to a name, you ensure that it is only evaluated (at most) once and then shared, no matter how often you use it.</p>\n\n<p>(There is an exception, though:</p>\n\n<pre><code>foo :: (Num a) =&gt; a\nfoo = 42\n</code></pre>\n\n<p>This apparent constant is polymorphic and will be recomputed at each use (it's really <code>fromInteger (42 :: Integer)</code>). But that doesn't apply to your code, which is all monomorphic.)</p>\n"}], "owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 41403983, "answer_count": 1, "score": 2, "last_activity_date": 1483140690, "creation_date": 1483140034, "last_edit_date": 1483140403, "question_id": 41403910, "link": "https://stackoverflow.com/questions/41403910/building-data-with-logic", "title": "Building data with logic", "body": "<p>I have a data type like this:</p>\n\n<pre><code>data FooBar =\n  FooBar { foo :: Double\n         , bar :: Double\n         , ter :: Double\n         }\n\n-- hypothetical builder with some random logic\nmkFooBar :: Double -&gt; Double -&gt; FooBar\nmkFooBar a b\n  | a &lt; 5     = FooBar a b (a + b)\n  | a &gt; 100   = FooBar a b (a * b)\n  | otherwise = FooBar (a ^ 2) (b ^ 2) ((a + b) ^2)\n</code></pre>\n\n<p>and some predefined values used around the program like:</p>\n\n<pre><code>fBLess5 = mkFooBar 1 200\nfBMore100 = mkFooBar 200 200\nfBSquared = mkFooBar 50 200\n-- and so on\n</code></pre>\n\n<p>Is it ok building predefined values like that in Haskell? If <code>fBLess5</code> is used N-times around the program, it will be built N-times if it is written in that way? </p>\n"}, {"tags": ["haskell", "dictionary", "recursion"], "comments": [{"owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "edited": false, "score": 1, "creation_date": 1483139979, "post_id": 41403835, "comment_id": 70010389, "body": "You shouldn&#39;t use function calls that look like this: <code>fst(k1)</code>. You should instead use just <code>fst k1</code>, like <code>2*fst k1 - fst k</code>."}, {"owner": {"reputation": 71, "user_id": 7346297, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10209290974621035/picture?type=large", "display_name": "Daniel", "link": "https://stackoverflow.com/users/7346297/daniel"}, "reply_to_user": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "edited": false, "score": 0, "creation_date": 1483140472, "post_id": 41403835, "comment_id": 70010510, "body": "Edited. Thanks for the feedback."}, {"owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "edited": false, "score": 0, "creation_date": 1483142930, "post_id": 41403835, "comment_id": 70011143, "body": "Judging by the spelling of its name, <code>ChangeKey</code> can&#39;t be a function."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 1, "creation_date": 1483154532, "post_id": 41403835, "comment_id": 70013249, "body": "Edited to fix <code>changeKey</code> capitalization."}], "answers": [{"comments": [{"owner": {"reputation": 71, "user_id": 7346297, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10209290974621035/picture?type=large", "display_name": "Daniel", "link": "https://stackoverflow.com/users/7346297/daniel"}, "edited": false, "score": 0, "creation_date": 1483150280, "post_id": 41404223, "comment_id": 70012550, "body": "It is getting there. One problem is, that the new k is not being used for the rest of the list, but the old one is. To clarify, whenever changeKey gets called, cMove is supposed to use the new vertex k instead of the original one."}, {"owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "reply_to_user": {"reputation": 71, "user_id": 7346297, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10209290974621035/picture?type=large", "display_name": "Daniel", "link": "https://stackoverflow.com/users/7346297/daniel"}, "edited": false, "score": 0, "creation_date": 1483151250, "post_id": 41404223, "comment_id": 70012741, "body": "So if the list is <code>[a, b, c, d, e]</code>, it should use <code>k</code> and <code>a</code> the first time, <code>a</code> and <code>b</code> the second time, <code>b</code> and <code>c</code> the third time, and so on?"}], "tags": [], "owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "is_accepted": true, "score": 2, "last_activity_date": 1483142522, "creation_date": 1483142522, "answer_id": 41404223, "question_id": 41403835, "link": "https://stackoverflow.com/questions/41403835/looping-over-dictionary-recursively-and-remove-keys/41404223#41404223", "title": "Looping over dictionary recursively and remove keys", "body": "<p>First thing is that <a href=\"https://hackage.haskell.org/package/containers/docs/Data-Map.html\" rel=\"nofollow noreferrer\">the documentation for <code>Data.Map</code></a> recommends that you use <code>Data.Map.Strict</code> instead of <code>Data.Map</code> in circumstances like you have.</p>\n\n<p>Also, function names should generally start with a lower-case letter.</p>\n\n<hr>\n\n<p>With that out of the way, a simple way to do iteration here is to <a href=\"https://wiki.haskell.org/Fold\" rel=\"nofollow noreferrer\">fold the elements of a list</a> into a final result <code>Map</code>. You write a function to deal with one iteration (see <code>cMove'</code> below), then you use something like <code>foldr</code> or <code>foldl'</code> to have it do all the iterations for you.</p>\n\n<p>I'm not sure if the following gives you the behavior you want, but here's a first draft using <code>foldr</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.Map.Strict (Map(..))\nimport qualified Data.Map.Strict as M\n\nchangeKey :: (Integer, Integer) -&gt; (Integer, Integer) -&gt; Map (Integer, Integer) Bool -&gt; Map (Integer, Integer) Bool\nchangeKey k0 k1 myMap = case M.updateLookupWithKey (\\_ _ -&gt; Nothing) k0 myMap of\n         (Nothing, _    ) -&gt; myMap\n         (Just e, myMap) -&gt; M.insert k1 e myMap\n\ncMove :: (Integer, Integer) -&gt; [(Integer, Integer)] -&gt; Map (Integer, Integer) Bool -&gt; Map (Integer, Integer) Bool\ncMove k ks myMap = foldr (cMove' k) myMap ks\n  where\n    cMove' :: (Integer, Integer) -&gt; (Integer, Integer) -&gt; Map (Integer, Integer) Bool -&gt; Map (Integer, Integer) Bool\n    cMove' k k1 myMap = if M.notMember (2*fst k1 - fst k, 2*snd k1 - snd k) myMap\n                              then changeKey k (2*fst k1 - fst k, 2*snd k1 - snd k) myMap\n                              else myMap\n</code></pre>\n"}], "owner": {"reputation": 71, "user_id": 7346297, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10209290974621035/picture?type=large", "display_name": "Daniel", "link": "https://stackoverflow.com/users/7346297/daniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 234, "favorite_count": 0, "accepted_answer_id": 41404223, "answer_count": 1, "score": 1, "last_activity_date": 1483618079, "creation_date": 1483139464, "last_edit_date": 1483618079, "question_id": 41403835, "link": "https://stackoverflow.com/questions/41403835/looping-over-dictionary-recursively-and-remove-keys", "title": "Looping over dictionary recursively and remove keys", "body": "<p>I'm using vertices and a <code>Data.Map</code> to try and make capture moves for the game of Checkers. I'm using a function <code>changeKey</code> to update a current key in the map and a function <code>cMove</code> to make the capture moves. Right now, <code>cMove</code> takes a vertex, a list of vertices (with the opponents pieces) and a map containing vertices and a bool value to indicate which player the piece belongs to. <code>cMove</code> checks if the first vertex tuple is in the map (to know if the position on the board is empty or not, as the calculation finds a position of a valid move). If it is, <code>changeKey</code> will be called.</p>\n\n<pre><code>changeKey :: (Integer, Integer) -&gt; (Integer, Integer) -&gt; Map (Integer, Integer) Bool -&gt; Map (Integer, Integer) Bool\nchangeKey k0 k1 myMap = case M.updateLookupWithKey (\\_ _ -&gt; Nothing) k0 myMap of\n         (Nothing, _    ) -&gt; myMap\n         (Just e, myMap) -&gt; M.insert k1 e myMap\n\ncMove :: (Integer, Integer) -&gt; [(Integer, Integer)] -&gt; Map (Integer, Integer) Bool -&gt; Map (Integer, Integer) Bool\ncMove k [k1] myMap = if M.notMember (2*fst k1 - fst k, 2*snd k1 - snd k) myMap\n                          then\n                          changeKey k (2*fst k1 - fst k, 2*snd k1 - snd k) myMap\n                          else myMap\n</code></pre>\n\n<p>My problem here lies in the fact that I'm in the dark with how I can loop through the list of vertices, if the list contains more than one tuple (as a player can do unlimited amount of captures per turn). Furthermore, how can I make sure each of the keys representing the opponent's pieces will be deleted from the map.</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1483135834, "post_id": 41403208, "comment_id": 70009107, "body": "Couldn&#39;t you define a Typeclass that defines the requirements for the function, then include the Typeclass requirement in the function signature?"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1483136501, "post_id": 41403208, "comment_id": 70009329, "body": "In <code>runOneTest&#39;</code>, can you move the <code>forall st pin . (SysState st, PortIn pin) =&gt;</code>  inside the <code>(st -&gt; Signal pin -&gt; Signal st)</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1483136557, "creation_date": 1483136557, "answer_id": 41403415, "question_id": 41403208, "link": "https://stackoverflow.com/questions/41403208/haskell-assert-that-a-type-will-match-another/41403415#41403415", "title": "Haskell assert that a type will match another", "body": "<p>Your analysis is right on the spot: the caller can pass a <code>Config</code> value which carries different types of those required by <code>topEntity'</code>.</p>\n\n<p>One option is to avoid the existential <code>Config</code> type and turn it into an explicit one</p>\n\n<pre><code>data Config p s = ...\n\nrunOneTest' :: forall st pin . (SysState st, PortIn pin)\n        =&gt; Config pin st\n        -&gt; (st -&gt; Signal pin -&gt; Signal st)\n        -&gt; Signal TestResult\n...\n</code></pre>\n\n<p>Another option is to perform a runtime type check using <code>Data.Typeable</code>. Something like:</p>\n\n<pre><code>import Data.Typeable\n\ndata Config = forall p s . (PortIn p, SysState s, Show p, Show s, Typeable s) =&gt;\n          Config { input   :: p\n                 , startSt :: s\n                 }\n\nrunOneTest' :: forall st pin . (SysState st, PortIn pin)\n        =&gt; Config\n        -&gt; (st -&gt; Signal pin -&gt; Signal st)\n        -&gt; Signal TestResult\nrunOneTest' config@Config{..} topEntity' = TestResult config &lt;$&gt; result\n  where\n    result = topEntity' startingState inputSignal\n    startingState = startSt\n    inputSignal   = signal input2\n    input2        = case cast input :: st of\n                       Just i  -&gt; i\n                       Nothing -&gt; error \"wrong runtime type!\"\n</code></pre>\n"}], "owner": {"reputation": 435, "user_id": 7287132, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7330188252bcb217a107b1250ec120d?s=128&d=identicon&r=PG&f=1", "display_name": "LambdaScientist", "link": "https://stackoverflow.com/users/7287132/lambdascientist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 265, "favorite_count": 0, "accepted_answer_id": 41403415, "answer_count": 1, "score": 3, "last_activity_date": 1483155949, "creation_date": 1483135349, "last_edit_date": 1483155949, "question_id": 41403208, "link": "https://stackoverflow.com/questions/41403208/haskell-assert-that-a-type-will-match-another", "title": "Haskell assert that a type will match another", "body": "<p>I need to let GHC know that the value being use inside of a type will be the same as a functions inputs. </p>\n\n<p><strong>Config is defined as :</strong></p>\n\n<pre><code>data Config = forall p s . (PortIn p, SysState s, Show p, Show s) =&gt;\n              Config { input   :: p\n                     , startSt :: s\n                     }\n</code></pre>\n\n<p><strong>Its class is:</strong></p>\n\n<pre><code>class Show t =&gt; Transition t where\n  runOneTest :: forall st pin . (SysState st, PortIn pin)\n             =&gt; t\n             -&gt; (st -&gt; Signal pin -&gt; Signal st)\n             -&gt; Signal TestResult\n</code></pre>\n\n<p><strong>The instance is:</strong></p>\n\n<pre><code>instance Transition Config where\n  runOneTest = runOneTest'\n\nrunOneTest' :: forall st pin . (SysState st, PortIn pin)\n            =&gt; Config\n            -&gt; (st -&gt; Signal pin -&gt; Signal st)\n            -&gt; Signal TestResult\nrunOneTest' config@Config{..} topEntity' = TestResult config &lt;$&gt; result\n  where\n    result = topEntity' startingState inputSignal\n    startingState = startSt\n    inputSignal   = signal input\n</code></pre>\n\n<p><strong>I am getting the errors:</strong></p>\n\n<pre><code>Couldn't match expected type `st' with actual type `s'\n`s' is a rigid type variable bound by\n      a pattern with constructor\n        Config :: forall p s.\n                  (PortIn p, SysState s, Show p, Show s) =&gt;\n                  p -&gt; s -&gt; Config,\n      in an equation for runOneTest'\n      at ConvertedClashExamples\\TestProc.hs:61:20   \n`st' is a rigid type variable bound by\n       the type signature for\n         runOneTest' :: (SysState st, PortIn pin) =&gt;\n                        Config -&gt; (st -&gt; Signal pin -&gt; Signal st) -&gt; Signal TestResult\n       at ConvertedClashExamples\\TestProc.hs:57:23 \nRelevant bindings include\n  result :: Signal st (bound at ConvertedClashExamples\\TestProc.hs:63:5)\n  startingState :: s (bound at ConvertedClashExamples\\TestProc.hs:64:5)\n  topEntity' :: st -&gt; Signal pin -&gt; Signal st (bound at ConvertedClashExamples\\TestProc.hs:61:31)\n  startSt :: s (bound at ConvertedClashExamples\\TestProc.hs:61:20)\n  runOneTest' :: Config\n                 -&gt; (st -&gt; Signal pin -&gt; Signal st) -&gt; Signal TestResult\n    (bound at ConvertedClashExamples\\TestProc.hs:61:1)\nIn the first argument of topEntity', namely `startingState'\nIn the expression: topEntity' startingState inputSignal\n</code></pre>\n\n<p><strong>What I think the problem is:</strong>\nGHC has no way of knowing that the startSt and input are going to be compatible with the topEntity function I will be passing in. It just knows that they use some of the same classes. </p>\n"}, {"tags": ["haskell", "optimization", "runtime", "compile-time", "dependent-type"], "comments": [{"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 8, "creation_date": 1483133488, "post_id": 41402885, "comment_id": 70008375, "body": "This is the cost of not using a total language. Type safety rests on evaluating proofs to canonical form. In total languages, proofs can be trusted without evaluation and thus erased at runtime. You could take the trust hit and use <code>unsafeCoerce</code>, once you&#39;ve checked your program gets past the typechecker."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 3, "creation_date": 1483133989, "post_id": 41402885, "comment_id": 70008533, "body": "See section 4.4.4 &quot;Running proofs&quot; of Richard A. Eisenberg&#39;s thesis <a href=\"https://arxiv.org/abs/1610.07978\" rel=\"nofollow noreferrer\">arxiv.org/abs/1610.07978</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1483134691, "post_id": 41402885, "comment_id": 70008771, "body": "I dream of GHC integrating a termination (abstract) checker, and automatically optimize/rewrite &quot;proofs&quot; using zero-cost coercions. That would be <i>really</i> nice."}, {"owner": {"reputation": 273, "user_id": 5374074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/24e06dbaa357b25b6d0946f988dc223d?s=128&d=identicon&r=PG&f=1", "display_name": "denormal", "link": "https://stackoverflow.com/users/5374074/denormal"}, "reply_to_user": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1483170043, "post_id": 41402885, "comment_id": 70015823, "body": "@pigworker I thought partial recursiveness was necessary for Turing completeness?"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1483175754, "post_id": 41402885, "comment_id": 70016935, "body": "@denormal Well, consider that Turing-completeness may not be <i>that</i> important... most programs can be written in non-Turing-complete languages. Also, according to <a href=\"http://cs.stackexchange.com/a/23916/7246\">this answer</a> you can somehow model partial functions in languages like Idris: my guess is that this is due to the fact that such languages also have codata and productive definitions (i.e. coinduction) which is often not considered, so it seems like termination+coinduction may be Turing-complete (but don&#39;t quote me on this)."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1483202836, "post_id": 41402885, "comment_id": 70023382, "body": "@denormal Partiality is not necessary for Turing-completeness, despite popular misconception. Total languages can express infinite processes: they just can&#39;t promise the finiteness of infinite processes."}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1483172934, "post_id": 41403206, "comment_id": 70016377, "body": "Hmmm... I guess demand for that termination analysis is going to be a lot bigger after Richard Eisenberg implements dependent types."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1483184752, "post_id": 41403206, "comment_id": 70018888, "body": "FWIW, the idiom I see more often in <code>base</code> and other libraries (<a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/Data.Typeable.html#eqT\" rel=\"nofollow noreferrer\">example</a>) is <code>unsafeCoerce Refl</code>, not <code>unsafeCoerce ()</code>. I suppose it&#39;s more resilient to a change of representation of <code>:~:</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1483190605, "post_id": 41403206, "comment_id": 70020157, "body": "@BenjaminHodgson It clarifies the intent better, yes. For the general case, though, <code>unsafeProof :: proof -&gt; proof</code> there is no &quot;best&quot; constructor we can use, so I used <code>()</code> as the canonical element of the final type."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1483137350, "last_edit_date": 1483137350, "creation_date": 1483135328, "answer_id": 41403206, "question_id": 41402885, "link": "https://stackoverflow.com/questions/41402885/run-time-cost-of-dependently-typed-programming-with-ghc/41403206#41403206", "title": "Run-time cost of dependently-typed programming with GHC", "body": "<p>If you are <em>very</em> sure the proof term terminates you can use something like</p>\n\n<pre><code>unsafeProof :: proof -&gt; proof\nunsafeProof _ = unsafeCoerce ()\n\nsomeFunction :: forall n m.  ...\nsomeFunction = case unsafeProof myProof :: Plus (S n) m :~: Plus n (S m) of\n   Refl -&gt; ...\n</code></pre>\n\n<p>This must be used only on types having a single no parameters constructor, e.g. <code>Refl</code> for <code>a :~: b</code>. Otherwise, your program will likely crash or behave weirdly. Caveat emptor!</p>\n\n<p>A safer (but still unsafe!) variant could be</p>\n\n<pre><code>unsafeProof :: a :~: b -&gt; a :~: b\nunsafeProof _ = unsafeCoerce ()\n</code></pre>\n\n<p>Note that you can still crash the program with that, if you pass bottom to it.</p>\n\n<p>I hope one day GHC will perform this optimization safely and automatically, ensuring termination through static analysis.</p>\n"}], "owner": {"reputation": 273, "user_id": 5374074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/24e06dbaa357b25b6d0946f988dc223d?s=128&d=identicon&r=PG&f=1", "display_name": "denormal", "link": "https://stackoverflow.com/users/5374074/denormal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 1, "accepted_answer_id": 41403206, "answer_count": 1, "score": 4, "last_activity_date": 1483281048, "creation_date": 1483133115, "last_edit_date": 1483281048, "question_id": 41402885, "link": "https://stackoverflow.com/questions/41402885/run-time-cost-of-dependently-typed-programming-with-ghc", "title": "Run-time cost of dependently-typed programming with GHC", "body": "<p>I am programming a dependently-typed library in Haskell. Using profiling on my test executable I see something like:</p>\n\n<pre><code>commutativity' Math 1189 4022787186 29.1 27.2 29.1 27.2\n</code></pre>\n\n<p><code>commutativity'</code> is basically (recursive) proof of the integer addition commutativity property for type-level integers. It is defined this:</p>\n\n<pre><code>commutativity' :: SNat n -&gt; SNat m -&gt; Plus (S n) m :~: Plus n (S m)\ncommutativity' SZ m = Refl\ncommutativity' (SS n) m = gcastWith (commutativity' n m) Refl\n</code></pre>\n\n<p>And then used in my library with <code>gcastWith</code> to prove the equivalence of various types.</p>\n\n<p>So... 29% of my runtime is spent on something completely useless, since type-checking happens at compile-time.</p>\n\n<p>I had naively assumed that this wouldn't happen.</p>\n\n<p>Is there something I can do to optimize away these useless calls?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 5, "creation_date": 1483129337, "post_id": 41401528, "comment_id": 70006810, "body": "Why not just make the function top-level but don&#39;t export it from the module?"}, {"owner": {"reputation": 447, "user_id": 1075783, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7f02c799d087a8fa2cc3d4b25bf0d2e3?s=128&d=identicon&r=PG", "display_name": "wereHamster", "link": "https://stackoverflow.com/users/1075783/werehamster"}, "reply_to_user": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 0, "creation_date": 1483206758, "post_id": 41401528, "comment_id": 70024403, "body": "@user2297560 I explained why I want to avoid that."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1483213450, "post_id": 41401528, "comment_id": 70025988, "body": "This doesn&#39;t happen automatically?"}], "answers": [{"comments": [{"owner": {"reputation": 447, "user_id": 1075783, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7f02c799d087a8fa2cc3d4b25bf0d2e3?s=128&d=identicon&r=PG", "display_name": "wereHamster", "link": "https://stackoverflow.com/users/1075783/werehamster"}, "edited": false, "score": 0, "creation_date": 1483207252, "post_id": 41410250, "comment_id": 70024505, "body": "I used a similar workaround (eta-abstraction) in a PureScript codebase (but for different reasons, to work around strictness of the language). Though linters and other tools may suggest to remove it, because it serves seemingly no useful purpose. I was hoping for something more explicit. While this works, it appears to leak implementation details which are not that obvious for a casual reader of the code."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 447, "user_id": 1075783, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7f02c799d087a8fa2cc3d4b25bf0d2e3?s=128&d=identicon&r=PG", "display_name": "wereHamster", "link": "https://stackoverflow.com/users/1075783/werehamster"}, "edited": false, "score": 0, "creation_date": 1483210658, "post_id": 41410250, "comment_id": 70025306, "body": "Well, in Haskell this pattern is not so unusual. And <i>because</i> it serves no other purpose but making a function&#39;s closure CAF, I&#39;d say it should be obvious enough to an experiences Haskeller what&#39;s the point."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1483203524, "creation_date": 1483203524, "answer_id": 41410250, "question_id": 41401528, "link": "https://stackoverflow.com/questions/41401528/how-can-i-force-bindings-in-a-where-clause-to-be-cafs/41410250#41410250", "title": "How can I force bindings in a where clause to be CAFs?", "body": "<p>If I've understood your intent correct, this is actually easy: just move any function arguments into a lambda, so the entire function (including the <code>where</code> block) is a CAF:</p>\n\n<pre><code>foo :: Int -&gt; Int\nfoo = \\x -&gt; x * nFermat\n where nFermat = length [() | a&lt;-[1..m], b&lt;-[1..m], c&lt;-[1..m], a^3+b^3==c^3]\n       m = 200\n\nmain = interact $ show . foos . read\n where foos n = foo &lt;$&gt; [0..n]\n</code></pre>\n\n<p>This way, whatever <code>x</code> arguments you use, the same <code>nFermat</code> will be reused.</p>\n\n<pre><code>sagemuej@sagemuej-X302LA:/tmp$ time runhaskell fermata.hs &lt;&lt;&lt; 1\n[0,0]\nreal    0m23.199s\nuser    0m23.177s\nsys 0m0.045s\nsagemuej@sagemuej-X302LA:/tmp$ time runhaskell fermata.hs &lt;&lt;&lt; 100\n[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]\nreal    0m22.629s\nuser    0m22.601s\nsys 0m0.052s\n</code></pre>\n"}], "owner": {"reputation": 447, "user_id": 1075783, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7f02c799d087a8fa2cc3d4b25bf0d2e3?s=128&d=identicon&r=PG", "display_name": "wereHamster", "link": "https://stackoverflow.com/users/1075783/werehamster"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 41410250, "answer_count": 1, "score": 5, "last_activity_date": 1483203524, "creation_date": 1483125379, "question_id": 41401528, "link": "https://stackoverflow.com/questions/41401528/how-can-i-force-bindings-in-a-where-clause-to-be-cafs", "title": "How can I force bindings in a where clause to be CAFs?", "body": "<p>I have some bindings which I want to keep private to a function (so, not declared in the top-level module namespace), but which are expensive to compute so I'd prefer them to be CAFs. Is there a pragma or some other trick I could use to force GHC to allocate a CAF for those bindings?</p>\n\n<p>example code:</p>\n\n<pre><code>header :: HeaderProps -&gt; Element\nheader = div_ [style_ headerStyle] [str_ \"Here be headerz\"]\n  where\n    -- Creating the 'headerStyle' is expensive! Do it only once\n    -- regardless of how many times the 'header' function is used.\n    headerStyle = mkStyle $ do\n        display flex\n        flexDirection column\n        padding (px 20) (px 40)\n</code></pre>\n\n<p>If that is not possible, I see a few options, but each has its own drawbacks:</p>\n\n<ol>\n<li>Move each function into its own module so I can move the expensive bindings to top-level module namespace without having to worry about other functions accessing them. Since I expect there to be many such functions, the number of modules would explode (hundreds in a large project). And I'm not a fan of the <em>only a single function per module</em> religion like it is preached in the node.js community.</li>\n<li>Move the bindings to the top-level module namespace and give each a sufficiently unique name to avoid conflicts and make it abundantly clear that those are private (eg. <code>headerStyle</code> -> <code>header__headerStyle</code>).</li>\n<li>Use <code>TemplateHaskell</code> to offload the expensive computations to compile-time.</li>\n</ol>\n"}, {"tags": ["haskell", "applicative"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 6, "creation_date": 1483122856, "post_id": 41400846, "comment_id": 70004092, "body": "The <code>(&lt;*&gt;)</code> presentation tends to be more convenient in day-to-day programming, even though the <code>mult</code> one is indeed neater in some aspects (e.g. the applicative laws look nicer when expressed in its terms). This scenario is similar to the relationship betweeen <code>(&gt;&gt;=)</code> and <code>join</code>. Relevant blog post: <a href=\"http://blog.ezyang.com/2012/08/applicative-functors/\" rel=\"nofollow noreferrer\">blog.ezyang.com/2012/08/applicative-functors</a>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 4, "creation_date": 1483123083, "post_id": 41400846, "comment_id": 70004199, "body": "Note: the monoidal presentation usually has <code>unit :: f ()</code>. <code>pure</code>, then, can be recovered through <code>pure x = fmap (const x) unit</code>."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 2, "creation_date": 1483123196, "post_id": 41400846, "comment_id": 70004246, "body": "See <a href=\"http://stackoverflow.com/a/27262462/414413\">stackoverflow.com/a/27262462/414413</a>"}, {"owner": {"reputation": 365, "user_id": 3117573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TEuTH.jpg?s=128&g=1", "display_name": "mnish", "link": "https://stackoverflow.com/users/3117573/mnish"}, "edited": false, "score": 0, "creation_date": 1483171679, "post_id": 41400846, "comment_id": 70016102, "body": "Almost always the standard mathematical notation/convention is better (that is, more efficient) for proving things, but not necessarily so for programming."}], "answers": [{"comments": [{"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1483187183, "post_id": 41408088, "comment_id": 70019428, "body": "But in the case of Monad <code>join</code> was actually supposed to be added to Monad with the AMP. It wasn&#39;t due to technical difficulties: <a href=\"http://stackoverflow.com/questions/31552064/why-isnt-join-part-of-the-monad-class/31552223\" title=\"why isnt join part of the monad class\">stackoverflow.com/questions/31552064/&hellip;</a>"}, {"owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "edited": false, "score": 0, "creation_date": 1483189715, "post_id": 41408088, "comment_id": 70019950, "body": "So is it just a performance concern ? Then why not declare both <code>mult</code> and <code>&lt;*&gt;</code> in Applicative, each one calling the other, so that instances can choose which one to override (or both) ? Also, almost all calls I&#39;ve seen to <code>&lt;*&gt;</code> are fully evaluated, giving as many values as the function has variables. For example with a 3-variable function, I prefer <code>liftA3 f x y z</code> to <code>f &lt;$&gt; x &lt;*&gt; y &lt;*&gt; z</code>. Then the performance expectations are on <code>liftA3</code> rather than <code>&lt;*&gt;</code>."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 1, "creation_date": 1483199265, "post_id": 41408088, "comment_id": 70022415, "body": "<code>liftA3 f x y z = f &lt;$&gt; x &lt;*&gt; y &lt;*&gt; z</code>, this function is not faster than <code>&lt;*&gt;</code>. And it can easily not fully evaluate something. Example: sum of two maybe&#39;s. <code>liftA2 (+) Nothing (Just $ 2^(2^100))</code> evaluates instantly while <code>liftA2 (+) (Just 3) (Just $ 2^(2^100))</code> will kill your machine. Very legit case. Why define both when <code>mult = liftA2 (,)</code> and such implementation is lazy enough? Allowing multiple functions inside one type class is error-prone approach. You can see another explanations here: <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Proposal/MonadOfNoReturn\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/wiki/Proposal/MonadOfNoReturn</a>"}, {"owner": {"reputation": 365, "user_id": 3117573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TEuTH.jpg?s=128&g=1", "display_name": "mnish", "link": "https://stackoverflow.com/users/3117573/mnish"}, "edited": false, "score": 1, "creation_date": 1483230897, "post_id": 41408088, "comment_id": 70028970, "body": "There is a delicate issue here. If you allow unrestricted recursions and non-strictness, then Hask is not a category and  Applicatives are not even functors. See for example <a href=\"http://ttic.uchicago.edu/~dreyer/course/papers/wadler.pdf\" rel=\"nofollow noreferrer\">Wader&#39;s remark</a> for a sufficient condition under which &#39;parametricity&#39; holds in System-F like calculus, without which you can easily construct a &#39;counterexample&#39; to (say) the Yoneda lemma."}, {"owner": {"reputation": 365, "user_id": 3117573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TEuTH.jpg?s=128&g=1", "display_name": "mnish", "link": "https://stackoverflow.com/users/3117573/mnish"}, "edited": false, "score": 2, "creation_date": 1483231495, "post_id": 41408088, "comment_id": 70029041, "body": "So this is not only a performance concern, but also about correctness. In a sense Haskell&#39;s categorical definitions are a  declaration that &#39;this is a programming language, and may not be correct in a strictly mathematical sense&#39;."}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": true, "score": 6, "last_activity_date": 1555685676, "last_edit_date": 1555685676, "creation_date": 1483185392, "answer_id": 41408088, "question_id": 41400846, "link": "https://stackoverflow.com/questions/41400846/applicative-functors-as-monoidal-functors/41408088#41408088", "title": "Applicative functors as monoidal functors", "body": "<p>As it was mentioned in comments to your answer, there is similar story with <code>join</code> and <code>&gt;&gt;=</code>. When there're several semantically equivalent ways to define something it's better always to choose most efficient &amp; pragmatic way. Haskell was designed to write code, not to prove things (though, somehow <em>Haskell</em> haven't still become very popular programming language unfortunately).</p>\n\n<p>If <code>starAp</code> had default implementation almost nobody would implement it (just as it happens now with <code>&gt;&gt;</code> in <code>Monad</code> type class). But <code>&lt;*&gt;</code> is extremely useful operation. It is used in applicate &amp; monadic parsers a lot (<code>megaparsec</code>, <code>attoparsec</code>, <code>optparse-applicative</code>) and I can't imagine my life w/o <code>liftA*</code> for joining things. And it is very important for this operation to be as efficient as possible. Implementing <code>starAp</code> as <code>fmap (uncurry ($)) (mult h x)</code> may bring hard times to inlining and optimizing things for compiler. </p>\n\n<p>Moreover, representation of <code>Applicative</code> using <code>mult</code> and <code>unit</code> operations doesn't really solves any problems. Obviously, <code>mult = liftA2 (,)</code>. But your implementation with </p>\n\n<p><code>mult (Just x) (Just y) = Just (x,y)</code></p>\n\n<p>not fully correct. Because your implementation is not lazy enough. You will evaluate both cases when it may be enough to evaluate only one. So you still can mess up even with this simple function. Thus this representation is strictly worse.</p>\n"}], "owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1067, "favorite_count": 1, "accepted_answer_id": 41408088, "answer_count": 1, "score": 4, "last_activity_date": 1555685676, "creation_date": 1483122120, "last_edit_date": 1483122810, "question_id": 41400846, "link": "https://stackoverflow.com/questions/41400846/applicative-functors-as-monoidal-functors", "title": "Applicative functors as monoidal functors", "body": "<p>As mentioned in Hackage for <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Applicative.html\" rel=\"nofollow noreferrer\">Applicative Functors</a>, they are strong lax monoidal functors. So why doesn't their definition in Haskell show it like so :</p>\n\n<pre><code>class Functor f =&gt; MonoidalApplicative f where\n  mult :: f a -&gt; f b -&gt; f (a,b)\n  unit :: a -&gt; f a \n\n  starAp :: f (a -&gt; b) -&gt; f a -&gt; f b\n  starAp h x = fmap (uncurry ($)) (mult h x)\n</code></pre>\n\n<p><code>&lt;*&gt;</code> (starAp) is easily reconstructed in terms of the multiplication and this definition looks simpler to me. For exemple, here is the Maybe instance :</p>\n\n<pre><code>instance MonoidalApplicative Maybe where\n  mult (Just x) (Just y) = Just (x,y)\n  mult _ _ = Nothing\n\n  unit x = Just x\n</code></pre>\n"}, {"tags": ["haskell", "abstraction"], "comments": [{"owner": {"reputation": 1020, "user_id": 500060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c122862374667042520953c02df7d7ed?s=128&d=identicon&r=PG", "display_name": "glguy", "link": "https://stackoverflow.com/users/500060/glguy"}, "edited": false, "score": 0, "creation_date": 1483122383, "post_id": 41400132, "comment_id": 70003912, "body": "If you want more help you&#39;ll include code that can be loaded by other people including the imports required to load it. It looks like you&#39;re missing the quantifiers on your TestResult type: <code>data TestResult = forall t s. TestResult { initConfig :: (Transition t) =&gt; t                              , endSt      :: (SysState s) =&gt; s                              }</code>"}, {"owner": {"reputation": 1020, "user_id": 500060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c122862374667042520953c02df7d7ed?s=128&d=identicon&r=PG", "display_name": "glguy", "link": "https://stackoverflow.com/users/500060/glguy"}, "edited": false, "score": 0, "creation_date": 1483122460, "post_id": 41400132, "comment_id": 70003944, "body": "<code>class Transition t where   runOneTest :: (Transition t) =&gt; t -&gt; Signal TestResult</code> should not duplicate the Transition constraint. Use <code>runOneTest :: t -&gt; Signal TestResult</code>"}, {"owner": {"reputation": 435, "user_id": 7287132, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7330188252bcb217a107b1250ec120d?s=128&d=identicon&r=PG&f=1", "display_name": "LambdaScientist", "link": "https://stackoverflow.com/users/7287132/lambdascientist"}, "reply_to_user": {"reputation": 1020, "user_id": 500060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c122862374667042520953c02df7d7ed?s=128&d=identicon&r=PG", "display_name": "glguy", "link": "https://stackoverflow.com/users/500060/glguy"}, "edited": false, "score": 0, "creation_date": 1483123525, "post_id": 41400132, "comment_id": 70004429, "body": "Each file in the ClashByExample_Converted folder should be runable by itself in GHCI. I forgot to mention that. Thanks!"}, {"owner": {"reputation": 435, "user_id": 7287132, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7330188252bcb217a107b1250ec120d?s=128&d=identicon&r=PG&f=1", "display_name": "LambdaScientist", "link": "https://stackoverflow.com/users/7287132/lambdascientist"}, "reply_to_user": {"reputation": 1020, "user_id": 500060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c122862374667042520953c02df7d7ed?s=128&d=identicon&r=PG", "display_name": "glguy", "link": "https://stackoverflow.com/users/500060/glguy"}, "edited": false, "score": 0, "creation_date": 1483123633, "post_id": 41400132, "comment_id": 70004476, "body": "@glguy may have solved it. I will know for sure is a few."}, {"owner": {"reputation": 435, "user_id": 7287132, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7330188252bcb217a107b1250ec120d?s=128&d=identicon&r=PG&f=1", "display_name": "LambdaScientist", "link": "https://stackoverflow.com/users/7287132/lambdascientist"}, "reply_to_user": {"reputation": 1020, "user_id": 500060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c122862374667042520953c02df7d7ed?s=128&d=identicon&r=PG", "display_name": "glguy", "link": "https://stackoverflow.com/users/500060/glguy"}, "edited": false, "score": 0, "creation_date": 1483234344, "post_id": 41400132, "comment_id": 70029382, "body": "@glguy If you want to add you comment as an answer I will mark it as correct."}], "owner": {"reputation": 435, "user_id": 7287132, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7330188252bcb217a107b1250ec120d?s=128&d=identicon&r=PG&f=1", "display_name": "LambdaScientist", "link": "https://stackoverflow.com/users/7287132/lambdascientist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1483119070, "creation_date": 1483118654, "question_id": 41400132, "link": "https://stackoverflow.com/questions/41400132/haskell-implementing-different-behavior-for-types-to-increase-code-resue", "title": "Haskell implementing different behavior for types to increase code resue", "body": "<p>I am updating some code I have. I noticed a lot of repeated code, so I took that as a good sign that some abstraction was needed. </p>\n\n<p>I have several functions that transition a State from one to another. The code to execute the transition is identical for every file. </p>\n\n<p><strong>This:</strong></p>\n\n<pre><code>runOneTest :: Config -&gt; Signal TestResult\nrunOneTest config = TestResult config &lt;$&gt; result\n  where\n    result = topEntity startingState inputSignal\n    startingState = startS config\n    inputSignal   = signal $ input config\n</code></pre>\n\n<p>What is not identical are the values in the Config Type or the TestResult.</p>\n\n<pre><code>data TestResult = TestResult { initConfig  :: Config\n                             , endSt        :: St\n                             }deriving (Eq)\n\ndata Config = Config { input  :: PIn\n                     , startS :: St\n                     }deriving (Eq)\n</code></pre>\n\n<p>More specifically the values that are different are the St(State) and the PIn(PortsIn). Those types can have different values attached.</p>\n\n<p><strong>Example:</strong>  </p>\n\n<pre><code>data PIn = PIn { _clk   :: Bit\n               , _reset :: Bool\n               , _start :: Bool\n               , _stop  :: Bool\n               }\n</code></pre>\n\n<p>vs </p>\n\n<pre><code>data PIn = PIn { _in_1 :: Bit\n               , _clk  :: Bit\n               , _reset :: Bool\n               } \n</code></pre>\n\n<p>I was trying to do that with classes but I am running into problems. </p>\n\n<p><strong>Current:</strong></p>\n\n<pre><code>--------------------------------------------------------------------------------\n-- Abstract Area\n--------------------------------------------------------------------------------\ndata TestResult = TestResult { initConfig :: (Transition t) =&gt; t\n                             , endSt      :: (SysState s) =&gt; s\n                             }\n\ndata Config = Config { input   :: (PortIn p) =&gt; p\n                     , startSt :: (SysState s) =&gt; s\n                     }\n\nclass (Eq s, Show s) =&gt; SysState s\n\nclass Transition t where\n  runOneTest :: (Transition t) =&gt; t -&gt; Signal TestResult\n\nclass Result r\n\nclass (Eq p, Show p) =&gt; PortIn p\n\n\n\n--------------------------------------------------------------------------------\n-- Stuff to define in each file\n--------------------------------------------------------------------------------\n\nrunOneTest' :: (Transition t) =&gt; t -&gt; Signal TestResult\nrunOneTest' config = signal $ TestResult config st\n\ndata PIn = PIn { _clk   :: Bit\n               , _reset :: Bool\n               , _start :: Bool\n               , _stop  :: Bool\n               } deriving (Eq, Show)\ninstance PortIn PIn\n\ndata St = St { _cnt_en   :: Bool\n             , _count_us :: BitVector 4\n             , _stop_d1  :: Bool\n             , _stop_d2  :: Bool\n             , _count    :: BitVector 4\n             } deriving (Eq, Show)\ninstance SysState St\n\nst :: St\nst = St False 0 False False 0\n\ninstance Result TestResult\n\ninstance Transition Config where\n  runOneTest = runOneTest'\n</code></pre>\n\n<p><strong>The type of errors I am getting are:</strong></p>\n\n<pre><code>Couldn't match expected type `t1' with actual type `t'\n  `t' is a rigid type variable bound by\n      the type signature for\n        runOneTest' :: Transition t =&gt; t -&gt; Signal TestResult\n      at ConvertedClashExamples\\ClassExample.hs:50:16\n  `t1' is a rigid type variable bound by\n       a type expected by the context: Transition t1 =&gt; t1\n       at ConvertedClashExamples\\ClassExample.hs:51:31\nRelevant bindings include\n  config :: t (bound at ConvertedClashExamples\\ClassExample.hs:51:13)\n  runOneTest' :: t -&gt; Signal TestResult\n    (bound at ConvertedClashExamples\\ClassExample.hs:51:1)\nIn the first argument of `TestResult', namely `config'\nIn the second argument of `($)', namely `TestResult config st'\n</code></pre>\n\n<p><strong>Original Full Source:</strong> <a href=\"https://github.com/LambdaScientist/CLaSH-by-example/tree/master\" rel=\"nofollow noreferrer\">https://github.com/LambdaScientist/CLaSH-by-example/tree/master</a></p>\n\n<p><strong>Note:</strong> I looked answers to this question, but I did not find a good enough answer. </p>\n"}, {"tags": ["rest", "haskell", "request", "cors", "yesod"], "answers": [{"comments": [{"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1483122533, "post_id": 41400465, "comment_id": 70003978, "body": "Actually I was in the right path, I did the same you did, by comparing with the simpleCors implementation, but instead of <code>corsRequestHeaders = [&quot;Authorization&quot;, &quot;Content-Type&quot;]</code> I used  <code>corsRequestHeaders = []</code>. What does this part do? Another thing, what IDE/Editor do you use to code in Haskell :) ?"}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1483122562, "post_id": 41400465, "comment_id": 70003990, "body": "Another thing, I had to add  <code>import Prelude</code>"}, {"owner": {"reputation": 605, "user_id": 1793740, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45a57f612171efd0a50c8a99f99cdd2e?s=128&d=identicon&r=PG", "display_name": "Mario", "link": "https://stackoverflow.com/users/1793740/mario"}, "reply_to_user": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 1, "creation_date": 1483122823, "post_id": 41400465, "comment_id": 70004080, "body": "Documentation is your friend! Check out <a href=\"https://hackage.haskell.org/package/wai-cors-0.2.5/docs/src/Network.Wai.Middleware.Cors.html#corsMethods\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/wai-cors-0.2.5/docs/src/&hellip;</a>  Your project must exclude the Prelude globally perhaps? I just use Sublime Text or Vim, but these are probably more general questions suited for off-question discussion!"}], "tags": [], "owner": {"reputation": 605, "user_id": 1793740, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45a57f612171efd0a50c8a99f99cdd2e?s=128&d=identicon&r=PG", "display_name": "Mario", "link": "https://stackoverflow.com/users/1793740/mario"}, "is_accepted": true, "score": 3, "last_activity_date": 1501189641, "last_edit_date": 1501189641, "creation_date": 1483120225, "answer_id": 41400465, "question_id": 41399055, "link": "https://stackoverflow.com/questions/41399055/haskell-yesod-cors-problems-with-browsers-options-requests-when-doing-post-req/41400465#41400465", "title": "Haskell Yesod - CORS problems with browsers OPTIONS requests when doing POST requests", "body": "<p>I believe the issue is that <a href=\"https://hackage.haskell.org/package/wai-cors-0.2.5/docs/src/Network.Wai.Middleware.Cors.html#simpleCors\" rel=\"nofollow noreferrer\">simpleCors</a> is built off <a href=\"https://hackage.haskell.org/package/wai-cors-0.2.5/docs/src/Network.Wai.Middleware.Cors.html#simpleCorsResourcePolicy\" rel=\"nofollow noreferrer\">simpleCorsResourcePolicy</a>, which only covers <a href=\"https://hackage.haskell.org/package/wai-cors-0.2.5/docs/src/Network.Wai.Middleware.Cors.html#simpleMethods\" rel=\"nofollow noreferrer\">simpleMethods</a>, which doesn't cover <code>OPTIONS</code>.</p>\n\n<p>You can fix this issue by using the same methods to roll whatever middleware you need.</p>\n\n<p>Here's the one I use for the <code>OPTIONS</code> problem you've described:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Middlewares where\n\nimport Network.Wai                       (Middleware)\nimport Network.Wai.Middleware.AddHeaders (addHeaders)\nimport Network.Wai.Middleware.Cors       (CorsResourcePolicy(..), cors)\n\n-- | @x-csrf-token@ allowance.\n-- The following header will be set: @Access-Control-Allow-Headers: x-csrf-token@.\nallowCsrf :: Middleware\nallowCsrf = addHeaders [(\"Access-Control-Allow-Headers\", \"x-csrf-token,authorization\")]\n\n-- | CORS middleware configured with 'appCorsResourcePolicy'.\ncorsified :: Middleware\ncorsified = cors (const $ Just appCorsResourcePolicy)\n\n-- | Cors resource policy to be used with 'corsified' middleware.\n--\n-- This policy will set the following:\n--\n-- * RequestHeaders: @Content-Type@\n-- * MethodsAllowed: @OPTIONS, GET, PUT, POST@\nappCorsResourcePolicy :: CorsResourcePolicy\nappCorsResourcePolicy = CorsResourcePolicy {\n    corsOrigins        = Nothing\n  , corsMethods        = [\"OPTIONS\", \"GET\", \"PUT\", \"POST\"]\n  , corsRequestHeaders = [\"Authorization\", \"Content-Type\"]\n  , corsExposedHeaders = Nothing\n  , corsMaxAge         = Nothing\n  , corsVaryOrigin     = False\n  , corsRequireOrigin  = False\n  , corsIgnoreFailures = False\n}\n</code></pre>\n\n<p>And then just compose the middlewares you need like you're already doing:</p>\n\n<pre><code>run port $ logger . allowCsrf . corsified $ app cfg\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 642, "user_id": 6244464, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0302fb471429b870d56e2e953381ceab?s=128&d=identicon&r=PG&f=1", "display_name": "vozman", "link": "https://stackoverflow.com/users/6244464/vozman"}, "is_accepted": false, "score": 2, "last_activity_date": 1558527064, "creation_date": 1558527064, "answer_id": 56256513, "question_id": 41399055, "link": "https://stackoverflow.com/questions/41399055/haskell-yesod-cors-problems-with-browsers-options-requests-when-doing-post-req/56256513#56256513", "title": "Haskell Yesod - CORS problems with browsers OPTIONS requests when doing POST requests", "body": "<p>Simplifying the answer of Mario we can use simplePolicy</p>\n\n<pre><code>import Network.Wai.Middleware.Cors \n\nallowCors :: Middleware\nallowCors = cors (const $ Just appCorsResourcePolicy)\n\nappCorsResourcePolicy :: CorsResourcePolicy\nappCorsResourcePolicy =\n    simpleCorsResourcePolicy\n        { corsMethods = [\"OPTIONS\", \"GET\", \"PUT\", \"POST\"]\n        , corsRequestHeaders = [\"Authorization\", \"Content-Type\"]\n        }\n</code></pre>\n\n<p>And to use it: </p>\n\n<pre><code>main = scotty 8080 $ do\n    middleware allowCors\n    matchAny  \"/\" $ text \"Success\"\n</code></pre>\n"}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 703, "favorite_count": 0, "accepted_answer_id": 41400465, "answer_count": 2, "score": 3, "last_activity_date": 1558527064, "creation_date": 1483113522, "last_edit_date": 1483113919, "question_id": 41399055, "link": "https://stackoverflow.com/questions/41399055/haskell-yesod-cors-problems-with-browsers-options-requests-when-doing-post-req", "title": "Haskell Yesod - CORS problems with browsers OPTIONS requests when doing POST requests", "body": "<p>I have used <code>Network.Wai.Middleware.Cors</code>'s <code>simpleCors</code>, it worked properly for <code>GET</code> requests, but when I try to make a <code>POST</code> request I get the following problem</p>\n\n<pre><code>OPTIONS /users\n  Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\n  Status: 400 Bad Request 0.032443s\n</code></pre>\n\n<p>The only way I was able to make it work was by removing the <code>simpleCors</code> from the following part in <code>Application.hs</code></p>\n\n<pre><code>-- | Convert our foundation to a WAI Application by calling @toWaiAppPlain@ and\n-- applying some additional middlewares.\nmakeApplication :: App -&gt; IO Application\nmakeApplication foundation = do\n    logWare &lt;- makeLogWare foundation\n    -- Create the WAI application and apply middlewares\n    appPlain &lt;- toWaiAppPlain foundation\n    return $ logWare $ defaultMiddlewaresNoLogging $ simpleCors $ appPlain\n</code></pre>\n\n<p>and adding a OPTIONS method response</p>\n\n<pre><code>optionsNewUserR :: Handler RepPlain\noptionsNewUserR = do\n  return $ RepPlain $ toContent (\"\" :: Text)\n</code></pre>\n\n<p>and adding CORS headers... But it is a dirty solution, because I would need to change ALL my API handlers! Any help is highly appreciated!</p>\n"}, {"tags": ["haskell", "emacs"], "answers": [{"comments": [{"owner": {"reputation": 2051, "user_id": 4887726, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/381a9c57be405fa215c388f62ed7ddf7?s=128&d=identicon&r=PG&f=1", "display_name": "LoranceChen", "link": "https://stackoverflow.com/users/4887726/lorancechen"}, "edited": false, "score": 0, "creation_date": 1483151080, "post_id": 41402574, "comment_id": 70012713, "body": "thanks your advice but intero also has the trouble. I can&#39;t get the changed tag. Should I do a further config?"}, {"owner": {"reputation": 313, "user_id": 5953321, "user_type": "registered", "profile_image": "https://graph.facebook.com/886468944803810/picture?type=large", "display_name": "Junyoung Clare Jang", "link": "https://stackoverflow.com/users/5953321/junyoung-clare-jang"}, "reply_to_user": {"reputation": 2051, "user_id": 4887726, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/381a9c57be405fa215c388f62ed7ddf7?s=128&d=identicon&r=PG&f=1", "display_name": "LoranceChen", "link": "https://stackoverflow.com/users/4887726/lorancechen"}, "edited": false, "score": 0, "creation_date": 1483153053, "post_id": 41402574, "comment_id": 70013045, "body": "With intero, you can move through tags by tagging system of intero itself, there is no such problem"}, {"owner": {"reputation": 313, "user_id": 5953321, "user_type": "registered", "profile_image": "https://graph.facebook.com/886468944803810/picture?type=large", "display_name": "Junyoung Clare Jang", "link": "https://stackoverflow.com/users/5953321/junyoung-clare-jang"}, "reply_to_user": {"reputation": 2051, "user_id": 4887726, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/381a9c57be405fa215c388f62ed7ddf7?s=128&d=identicon&r=PG&f=1", "display_name": "LoranceChen", "link": "https://stackoverflow.com/users/4887726/lorancechen"}, "edited": false, "score": 0, "creation_date": 1483153164, "post_id": 41402574, "comment_id": 70013062, "body": "I.e. if you experience any such problem  , it is not from intero, but from other plugin you installed for haskell."}], "tags": [], "owner": {"reputation": 313, "user_id": 5953321, "user_type": "registered", "profile_image": "https://graph.facebook.com/886468944803810/picture?type=large", "display_name": "Junyoung Clare Jang", "link": "https://stackoverflow.com/users/5953321/junyoung-clare-jang"}, "is_accepted": false, "score": 0, "last_activity_date": 1483131263, "creation_date": 1483131263, "answer_id": 41402574, "question_id": 41397060, "link": "https://stackoverflow.com/questions/41397060/emacs-haskell-mode-cant-remember-change-tag/41402574#41402574", "title": "emacs haskell mode can&#39;t remember change tag", "body": "<p>Use intero. It's designed for emacs, and for stack.</p>\n"}], "owner": {"reputation": 2051, "user_id": 4887726, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/381a9c57be405fa215c388f62ed7ddf7?s=128&d=identicon&r=PG&f=1", "display_name": "LoranceChen", "link": "https://stackoverflow.com/users/4887726/lorancechen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 40, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1483131263, "creation_date": 1483104397, "question_id": 41397060, "link": "https://stackoverflow.com/questions/41397060/emacs-haskell-mode-cant-remember-change-tag", "title": "emacs haskell mode can&#39;t remember change tag", "body": "<p>I'm fresh to emacs haskell, and struggle the problem for a week ago.<br>\nFor detail, another file can't see the changed tag when I change a tag in new file.The config process is mainly by <a href=\"https://github.com/serras/emacs-haskell-tutorial/blob/master/tutorial.md\" rel=\"nofollow noreferrer\">serras/emacs-haskell-tutorial</a> on github.<br>\nthe gif as below:<br>\n1) Main.hs: ref <code>mac</code> function in Lib.hs<br>\n2) Lib.hs: will change <code>mad</code> function to <code>mac</code><br>\n<strong>result</strong>:<br>\nMain.hs can't get the changed tag <code>mac</code> in Lib.hs  </p>\n\n<p><a href=\"https://i.stack.imgur.com/Wusfh.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Wusfh.gif\" alt=\"enter image description here\"></a></p>\n\n<p>thanks any advice!</p>\n"}, {"tags": ["haskell", "gloss"], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 7049147, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/d1b2c8bc723cd06e915c0cd670f8bf69?s=128&d=identicon&r=PG&f=1", "display_name": "Dost", "link": "https://stackoverflow.com/users/7049147/dost"}, "edited": false, "score": 0, "creation_date": 1483085176, "post_id": 41391455, "comment_id": 69987452, "body": "Thank you, will try this and tell how it goes."}], "tags": [], "owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "is_accepted": false, "score": 2, "last_activity_date": 1483078051, "creation_date": 1483078051, "answer_id": 41391455, "question_id": 41390771, "link": "https://stackoverflow.com/questions/41390771/haskell-gloss-loading-bmp/41391455#41391455", "title": "Haskell gloss loading .bmp", "body": "<p>When you define <code>main</code>, the variables you create there aren't accessible outside of the definition of <code>main</code>. <code>initialState</code> is outside the definition of <code>main</code>.</p>\n\n<p>You need to pass <code>wall</code> into <code>initialState</code> by changing <code>main</code> and <code>initialState</code> like this:</p>\n\n<pre><code>main :: IO ()\nmain = do \n          wall &lt;- loadBMP \"wall.bmp\" -- loads wall image\n          play (initialState wall) drawState reactEvent reactTime\n</code></pre>\n\n<p>&nbsp;</p>\n\n<pre><code>initialState :: Picture -&gt; State\ninitialState wall = ((map 13 0),wall)\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 7049147, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/d1b2c8bc723cd06e915c0cd670f8bf69?s=128&d=identicon&r=PG&f=1", "display_name": "Dost", "link": "https://stackoverflow.com/users/7049147/dost"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1164, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1483078051, "creation_date": 1483073151, "question_id": 41390771, "link": "https://stackoverflow.com/questions/41390771/haskell-gloss-loading-bmp", "title": "Haskell gloss loading .bmp", "body": "<pre><code>-- | Main function\nmain :: IO ()\nmain = do \n          wall &lt;- loadBMP \"wall.bmp\" -- loads wall image\n          play initialState drawState reactEvent reactTime\n\n\n-- | Function that creates the game\nplay :: State -&gt; (State -&gt; Picture) -&gt; (Event -&gt; State -&gt; State) -&gt; (Float -&gt; State -&gt; State) -&gt; IO ()\nplay initialState drawState reactEvent reactTime = play\n            (InWindow \"Game\" (900, 900) (0, 0))      -- Window ize\n            (greyN 0.5)                              -- background coloer\n            1                                        -- refresh rate\n            initialState                             -- initial state\n            drawState                                -- draws game state\n            reactEvent                               -- teacts to evente\n            reactTime                                -- reacts to time\n\n-- | One game represenction\ntype State = (Map,Picture)\n\n-- | Initial game state\ninitialState :: State\ninitialState = ((map 13 0),wall)\n</code></pre>\n\n<p>The function map creates my map.\nMy game is already running fine, but I need to replace the representations i used (circles from gloss) with some BMP images, but i can't load even one cause when i try to load this wall it appears an error in the last line I shared here:\nnot in scope 'wall'</p>\n\n<p>Can someone see why this is happening?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1483076612, "post_id": 41389887, "comment_id": 69984476, "body": "I&#39;d get rid of the <code>otherwise</code> clause, and add <code>parseMessage _ = Error 1</code> at the end."}, {"owner": {"reputation": 242, "user_id": 6421957, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4E3Qq.jpg?s=128&g=1", "display_name": "Robert Stefanic", "link": "https://stackoverflow.com/users/6421957/robert-stefanic"}, "edited": false, "score": 4, "creation_date": 1483076720, "post_id": 41389887, "comment_id": 69984501, "body": "Ahhh, I see. An empty string wouldn&#39;t be caught by the guards because of the initial pattern that I set up to check the first element of a list."}], "tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": true, "score": 12, "last_activity_date": 1483065399, "creation_date": 1483065399, "answer_id": 41389887, "question_id": 41389848, "link": "https://stackoverflow.com/questions/41389848/pattern-matches-are-non-exaustive-how-come-my-otherwise-in-the-final-guar/41389887#41389887", "title": "Pattern match(es) are non-exaustive -- How come my &quot;otherwise&quot; in the final guard fails to deal with an empty list?", "body": "<p>Guards are specific to a single pattern case in a function\u2019s definition, so when you write this:</p>\n\n<pre><code>parseMessage (x:_)\n  | x == 'I'      = Info\n  | x == 'W'      = Warning\n  | otherwise     = Error 1\n</code></pre>\n\n<p>\u2026your guards won\u2019t even be consulted if you run <code>parseMessage \"\"</code>. The <code>(x:_)</code> pattern would fail, so all of its guards are ignored. This needs to be the case in order for <code>x</code> to be bound within the guard conditions.</p>\n\n<p>To fix this, you just need to add a case that handles the empty string:</p>\n\n<pre><code>parseMessage :: String -&gt; MessageType\nparseMessage \"\"   = Error 1\nparseMessage (x:_)\n  | x == 'I'      = Info\n  | x == 'W'      = Warning\n  | otherwise     = Error 1\n</code></pre>\n\n<p>Now you\u2019ve handled all possible cases.</p>\n"}, {"tags": [], "owner": {"reputation": 52258, "user_id": 375232, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/h3OwD.png?s=128&g=1", "display_name": "Landei", "link": "https://stackoverflow.com/users/375232/landei"}, "is_accepted": false, "score": 8, "last_activity_date": 1483100067, "creation_date": 1483100067, "answer_id": 41396101, "question_id": 41389848, "link": "https://stackoverflow.com/questions/41389848/pattern-matches-are-non-exaustive-how-come-my-otherwise-in-the-final-guar/41396101#41396101", "title": "Pattern match(es) are non-exaustive -- How come my &quot;otherwise&quot; in the final guard fails to deal with an empty list?", "body": "<p>Why not write directly...</p>\n\n<pre><code>parseMessage ('I':_) = Info\nparseMessage ('W':_) = Warning\nparseMessage _       = Error 1\n</code></pre>\n"}], "owner": {"reputation": 242, "user_id": 6421957, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4E3Qq.jpg?s=128&g=1", "display_name": "Robert Stefanic", "link": "https://stackoverflow.com/users/6421957/robert-stefanic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 0, "accepted_answer_id": 41389887, "answer_count": 2, "score": 2, "last_activity_date": 1483100067, "creation_date": 1483065067, "question_id": 41389848, "link": "https://stackoverflow.com/questions/41389848/pattern-matches-are-non-exaustive-how-come-my-otherwise-in-the-final-guar", "title": "Pattern match(es) are non-exaustive -- How come my &quot;otherwise&quot; in the final guard fails to deal with an empty list?", "body": "<p>So I'm trying to match this pattern. MessageType is a type that I've created. This function takes in a string, and then depending on the first character of that string, it outputs a MessageType. Whenever I compile though, I get a warning saying: </p>\n\n<pre><code> Pattern match(es) are non-exhaustive\n    In an equation for \u2018parseMessage\u2019: Patterns not matched: []\n</code></pre>\n\n<p>Here's my code:</p>\n\n<pre><code>parseMessage :: String -&gt; MessageType\nparseMessage (x:_)\n  | x == 'I'      = Info\n  | x == 'W'      = Warning\n  | otherwise     = Error 1\n</code></pre>\n\n<p>How is it that my pattern matches aren't exhaustive? Wouldn't the <code>otherwise</code> guard catch anything else? I don't see how my function fails to catch all strings.</p>\n\n<p>When I write the function like this, I do not get the warning.</p>\n\n<pre><code>parseMessage []     = error \"Empty String\"\nparseMessage (x:_) = if x == 'I'\n                        then Info\n                        else if x == 'W'\n                        then Warning\n                        else Error 1\n</code></pre>\n\n<p>I rewrote my function this way because I saw that the warning says \"Patterns not matched: []\", so I explicitly handled it. But why is it that in the first version of my function, it says that the pattern is not handled. How does <code>otherwise</code> not catch everything besides the first two guards?</p>\n"}, {"tags": ["haskell", "gloss"], "comments": [{"owner": {"reputation": 33, "user_id": 7049147, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/d1b2c8bc723cd06e915c0cd670f8bf69?s=128&d=identicon&r=PG&f=1", "display_name": "Dost", "link": "https://stackoverflow.com/users/7049147/dost"}, "edited": false, "score": 0, "creation_date": 1483072373, "post_id": 41389823, "comment_id": 69983421, "body": "The game only works if I have fr equal to 1. Dont know why, but it solves the problem."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1483087495, "post_id": 41389823, "comment_id": 69988275, "body": "As long as we cannot reproduce the behaviour, we cannot help you. Make sure that you include enough (example) code to reproduce your problem. Best case scenario? You actually find the problem yourself why you try to simplify your program."}], "owner": {"reputation": 33, "user_id": 7049147, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/d1b2c8bc723cd06e915c0cd670f8bf69?s=128&d=identicon&r=PG&f=1", "display_name": "Dost", "link": "https://stackoverflow.com/users/7049147/dost"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 32, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1483064778, "creation_date": 1483064778, "question_id": 41389823, "link": "https://stackoverflow.com/questions/41389823/reactime-function-crashing-game", "title": "ReacTime function crashing game", "body": "<p>My problem is that i made a game, i have initialState, drawState and reactEvent running well, but my reactTime function when i activate it crash's the programm</p>\n\n<pre><code>-- | Main function that invoques the game\nmain :: IO ()\nmain = do \n      play dm           -- display mode\n        (greyN 0.5)     \n        fr              -- frame rate\n        initialState    -- initial game state\n        drawState       -- draws game state\n        reactEvent      -- reacts to event\n        reactTime       -- reacts to time\n</code></pre>\n\n<p>So i have the advance funtion definined well(for sure) doing what is suppose to happen when a second pass but I don't really know how to do the reactTime function, can someone help?</p>\n\n<pre><code>-- | Function that alters the game state when time advances\nreactTime :: Float -&gt; State -&gt; State\nreactTime f s =  advance s (exponent f)\n</code></pre>\n\n<p>Importante notes:\nMy time is suppose to start at x(value I have to decide yet) and end at 0</p>\n\n<p>So I need to make that f decrease the value 1 for second, how is this reactTime function suppose to be anyone has any idea?</p>\n\n<p>If I make this function equal to </p>\n\n<pre><code>-- | Function that alters the game state when time advances\nreactTime :: Float -&gt; State -&gt; State\nreactTime f s = s\n</code></pre>\n\n<p>the game runs perfectly, but without time passing its impossible to play.</p>\n"}, {"tags": ["haskell"], "owner": {"reputation": 133, "user_id": 4841072, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d2ced6c99273e990b4c9b38f403244f5?s=128&d=identicon&r=PG&f=1", "display_name": "Zale", "link": "https://stackoverflow.com/users/4841072/zale"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 26, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1483063334, "creation_date": 1483063334, "question_id": 41389668, "link": "https://stackoverflow.com/questions/41389668/how-to-find-a-value-with-local-alias-qualified-package-name-in-haskell-template", "title": "how to find a value with local alias qualified package name in haskell template", "body": "<p>If a package is imported as</p>\n\n<pre><code>import qualified Database.HDBC as H\n</code></pre>\n\n<p>How to get the <a href=\"https://hackage.haskell.org/package/template-haskell-2.11.0.0/docs/Language-Haskell-TH.html#t:Name\" rel=\"nofollow noreferrer\"><code>Name</code> </a>value of variable <code>Database.HDBC.fromSql</code>? </p>\n\n<pre><code>lookupValueName \"Database.HDBC.lookup\" -- Q Nothing\nlookupValueName \"H.fromSql\"            -- Q (Just \"Database.HDBC.SqlValue.fromSql\")\n</code></pre>\n\n<p>The second line works, but it assumes that the local alias is <code>H</code>. Is there any way to get the variable name under qualified local alias?</p>\n"}, {"tags": ["haskell", "recursion", "functional-programming"], "comments": [{"owner": {"reputation": 44000, "user_id": 535275, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/Ft2Mw.jpg?s=128&g=1", "display_name": "Scott Hunter", "link": "https://stackoverflow.com/users/535275/scott-hunter"}, "edited": false, "score": 1, "creation_date": 1483060225, "post_id": 41389306, "comment_id": 69980972, "body": "Why should it give you 6, and what is it giving you instead?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1483060324, "post_id": 41389306, "comment_id": 69980998, "body": "I think I get the spec: it&#39;s the length of the longest contiguous series of elements that all satisfy the predicate."}, {"owner": {"reputation": 1152, "user_id": 1952956, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/4d108adaa243fa6c556d4325194ae437?s=128&d=identicon&r=PG", "display_name": "Oni1", "link": "https://stackoverflow.com/users/1952956/oni1"}, "edited": false, "score": 0, "creation_date": 1483060352, "post_id": 41389306, "comment_id": 69981004, "body": "With my solution i get 9, because i&#39;m counting all items if the predicate is true"}, {"owner": {"reputation": 1152, "user_id": 1952956, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/4d108adaa243fa6c556d4325194ae437?s=128&d=identicon&r=PG", "display_name": "Oni1", "link": "https://stackoverflow.com/users/1952956/oni1"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1483060490, "post_id": 41389306, "comment_id": 69981032, "body": "Sorry for the misleading topic of the question. @luqui spec is correct."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1483060608, "post_id": 41389306, "comment_id": 69981054, "body": "As you just want the length of the longest sequence, not the longest sequence itself, it might help to <code>map</code> the predicate across the list, then find the longest sequence of <code>True</code>."}], "answers": [{"comments": [{"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 1, "creation_date": 1483060871, "post_id": 41389402, "comment_id": 69981104, "body": "need to filter out the <code>False</code> groups, in case one of them is jolly long"}, {"owner": {"reputation": 1152, "user_id": 1952956, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/4d108adaa243fa6c556d4325194ae437?s=128&d=identicon&r=PG", "display_name": "Oni1", "link": "https://stackoverflow.com/users/1952956/oni1"}, "edited": false, "score": 1, "creation_date": 1483061660, "post_id": 41389402, "comment_id": 69981293, "body": "This was very good explanation to solve my problem :) Thank you very much @jpath !"}, {"owner": {"reputation": 1152, "user_id": 1952956, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/4d108adaa243fa6c556d4325194ae437?s=128&d=identicon&r=PG", "display_name": "Oni1", "link": "https://stackoverflow.com/users/1952956/oni1"}, "edited": false, "score": 0, "creation_date": 1483062208, "post_id": 41389402, "comment_id": 69981414, "body": "A Last question to you @jpath: Takes the solution of your explanation linear time -&gt; O(n)?"}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "reply_to_user": {"reputation": 1152, "user_id": 1952956, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/4d108adaa243fa6c556d4325194ae437?s=128&d=identicon&r=PG", "display_name": "Oni1", "link": "https://stackoverflow.com/users/1952956/oni1"}, "edited": false, "score": 0, "creation_date": 1483063925, "post_id": 41389402, "comment_id": 69981775, "body": "@Oni1 Yes, if you implement it correctly. Conceptually if you check all the steps 1 to 5 you can implement them with a single traversal over the list each, so they all take O(n) unless you do silly stuff in the implementation."}], "tags": [], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "is_accepted": true, "score": 5, "last_activity_date": 1483062398, "last_edit_date": 1483062398, "creation_date": 1483060771, "answer_id": 41389402, "question_id": 41389306, "link": "https://stackoverflow.com/questions/41389306/haskell-longest-contiguous-series-of-elements-in-a-list/41389402#41389402", "title": "Haskell longest contiguous series of elements in a list", "body": "<p>Try to factor out smaller sub-problems. For this example the general strategy might be like this:</p>\n\n<ol>\n<li>Convert the given list into a <code>[Bool]</code> list where an entry is <code>True</code> if the corresponding entry satisfies the predicate. That is write a function <code>(Int -&gt; Bool) -&gt; [Int] -&gt; [Bool]</code></li>\n<li>Group consecutive <code>True</code> and <code>False</code> values. That is write a function <code>[Bool] -&gt; [[Bool]]</code>. You might want to look at <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-List.html#v:group\" rel=\"nofollow noreferrer\"><code>Data.List.group</code></a>.</li>\n<li>Filter out the <code>False</code> groups: <code>[[Bool]] -&gt; [[Bool]]</code></li>\n<li>For each of the inner lists count their length. <code>[[Bool]] -&gt; [Int]</code></li>\n<li>Find the maximum of those lengths: <code>[Int] -&gt; Int</code></li>\n</ol>\n\n<p>Then you just have to compose those functions and you are done. For 1. and 4. you will want to use the function <code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]</code>. If you already know <code>map</code>, just use it. If you don't I would suggest writing that yourself as well.</p>\n\n<p>Some of the type signatures for the functions that I gave are overly specific. Maybe try to generalise them a bit where you can.</p>\n"}, {"comments": [{"owner": {"reputation": 3633, "user_id": 675154, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/23da6806cab4830b5d1b15ef2a410541?s=128&d=identicon&r=PG", "display_name": "delta", "link": "https://stackoverflow.com/users/675154/delta"}, "reply_to_user": {"reputation": 1152, "user_id": 1952956, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/4d108adaa243fa6c556d4325194ae437?s=128&d=identicon&r=PG", "display_name": "Oni1", "link": "https://stackoverflow.com/users/1952956/oni1"}, "edited": false, "score": 0, "creation_date": 1483062436, "post_id": 41389425, "comment_id": 69981454, "body": "@Oni1 really sorry, copy&amp;paste error, fixed in the otherwise part"}], "tags": [], "owner": {"reputation": 3633, "user_id": 675154, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/23da6806cab4830b5d1b15ef2a410541?s=128&d=identicon&r=PG", "display_name": "delta", "link": "https://stackoverflow.com/users/675154/delta"}, "is_accepted": false, "score": 3, "last_activity_date": 1483062401, "last_edit_date": 1483062401, "creation_date": 1483060977, "answer_id": 41389425, "question_id": 41389306, "link": "https://stackoverflow.com/questions/41389306/haskell-longest-contiguous-series-of-elements-in-a-list/41389425#41389425", "title": "Haskell longest contiguous series of elements in a list", "body": "<p>In the guards, <code>p x</code> and <code>otherwise</code> part both has problems.</p>\n\n<p><code>(p x) = 1 + (longestSequence p xs)</code> is not always true, if the next element of x does not hold predict <code>p</code>, it can not be added 1</p>\n\n<p><code>otherwise = longestSequence p xs</code> is not true if the current longest sequence is longer than the remained one</p>\n\n<p>A possible fix is to maintain the max length and the current length</p>\n\n<pre><code>longestSequence :: (a -&gt; Bool) -&gt; [a] -&gt; Int\nlongestSequence p x = ls x 0 0\n  where\n    ls [] mx cur = max mx cur\n    ls (x:xs) mx cur\n        | p x = ls xs mx (cur+1)\n        | otherwise = ls xs (max mx cur) 0\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 42360, "user_id": 389146, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/zGYUq.jpg?s=128&g=1", "display_name": "Karl Bielefeldt", "link": "https://stackoverflow.com/users/389146/karl-bielefeldt"}, "is_accepted": false, "score": 1, "last_activity_date": 1483073457, "creation_date": 1483073457, "answer_id": 41390804, "question_id": 41389306, "link": "https://stackoverflow.com/questions/41389306/haskell-longest-contiguous-series-of-elements-in-a-list/41390804#41390804", "title": "Haskell longest contiguous series of elements in a list", "body": "<p>You can often use <code>fold</code> which is simpler than recursion, and in this case, we want to use <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:scanl\" rel=\"nofollow noreferrer\">scanl</a>, which is just like <code>foldl</code>, except it keeps the entire list.</p>\n\n<p>The following iterates through the list, incrementing the count for every item that matches the predicate.  If it finds one that doesn't match, it resets the count back to zero.  At the end, it finds the maximum of the resulting list.</p>\n\n<pre><code>longestSequence p = maximum . scanl (\\count x -&gt; if (p x) then count + 1 else 0) 0\n</code></pre>\n\n<p>For your example input of <code>[1,44,33,22,2,3,55,66,66,77,88,99]</code> and predicate of <code>(\\x -&gt; x &gt;= 10)</code>, the <code>scanl</code> will produce an output of <code>[0,0,1,2,3,0,0,1,2,3,4,5,6]</code>.  Taking the maximum of this list gives <code>6</code>, and you can see that the maximum occurs at the end of the input, and also the zeroes in the list where the predicate didn't match.</p>\n\n<p>Incidentally, I wholeheartedly agree with jpath about breaking down the problem into small parts.  I've seen people solve similar problems with a <code>fold</code> by cramming the <code>max</code> calculation inside the <code>\\count</code> parameter with a tuple, but that makes it much harder to read.  That's also what makes single-function recursive solutions like yours difficult to wrap your head around, by the way.  Too much to keep track of at once, so it's hard to see where and how to fit in the reset-to-zero part.</p>\n"}], "owner": {"reputation": 1152, "user_id": 1952956, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/4d108adaa243fa6c556d4325194ae437?s=128&d=identicon&r=PG", "display_name": "Oni1", "link": "https://stackoverflow.com/users/1952956/oni1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 905, "favorite_count": 2, "accepted_answer_id": 41389402, "answer_count": 3, "score": 2, "last_activity_date": 1483073457, "creation_date": 1483059977, "last_edit_date": 1483061854, "question_id": 41389306, "link": "https://stackoverflow.com/questions/41389306/haskell-longest-contiguous-series-of-elements-in-a-list", "title": "Haskell longest contiguous series of elements in a list", "body": "<p>I'm new to functional programming and the language haskell. I'm trying to determine the length of the longest contiguous series of elements in a list depending on a predicate function. The function is looks like this:</p>\n\n<pre><code> longestSequence :: (a -&gt; Bool) -&gt; [Int] -&gt; Int\n</code></pre>\n\n<p>When i call it like this:</p>\n\n<pre><code> longestSequence (\\x -&gt; x &gt;= 10) [1,44,33,22,2,3,55,66,66,77,88,99]\n</code></pre>\n\n<p>It should give me as solution <code>6</code>.</p>\n\n<p>My solution until yet is:</p>\n\n<pre><code>longestSequence :: (a -&gt; Bool) -&gt; [a] -&gt; Int\nlongestSequence p [] = 0\nlongestSequence p (x:xs) \n  | (p x) = 1 + (longestSequence p xs)\n  | otherwise = longestSequence p xs\n</code></pre>\n\n<p>Any hints or ideas of how i can solve this problem?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1483088880, "post_id": 41388795, "comment_id": 69988850, "body": "Lists are linked lists (not arrays), so accessing the last is an expensive operation, which can not be performed through pattern matching. One can use the <code>last</code> library function for that, but it will be slow. It&#39;s much more efficient, and simpler,  to reverse the list and check for equality as suggested below."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 4, "creation_date": 1483076864, "post_id": 41388906, "comment_id": 69984545, "body": "It would have been nice if you had said &quot;yes&quot; to OP&#39;s stated strategy, helping them along, instead of replacing their ideas with your own"}], "tags": [], "owner": {"reputation": 513, "user_id": 1125434, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/82b90125633760405d3f95b1a2ab95a0?s=128&d=identicon&r=PG", "display_name": "taktoa", "link": "https://stackoverflow.com/users/1125434/taktoa"}, "is_accepted": false, "score": 1, "last_activity_date": 1483056331, "creation_date": 1483056331, "answer_id": 41388906, "question_id": 41388795, "link": "https://stackoverflow.com/questions/41388795/how-to-destructure-a-string-into-first-middle-and-last/41388906#41388906", "title": "How to destructure a string into first, middle, and last?", "body": "<p>The definition you probably want is</p>\n\n<pre><code>numberIsPalindrome :: Int -&gt; Bool\nnumberIsPalindrome num = let str = show num\n                         in (str == reverse str)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 513, "user_id": 1125434, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/82b90125633760405d3f95b1a2ab95a0?s=128&d=identicon&r=PG", "display_name": "taktoa", "link": "https://stackoverflow.com/users/1125434/taktoa"}, "edited": false, "score": 0, "creation_date": 1483092616, "post_id": 41389332, "comment_id": 69990443, "body": "Note that if you call <code>last</code> in each iteration, the algorithm will be O(n^2) rather than O(n), because <code>last</code> is O(n)."}], "tags": [], "owner": {"reputation": 533, "user_id": 3847023, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/mUqNl.jpg?s=128&g=1", "display_name": "Nick Tchayka", "link": "https://stackoverflow.com/users/3847023/nick-tchayka"}, "is_accepted": false, "score": 1, "last_activity_date": 1483060196, "last_edit_date": 1495540462, "creation_date": 1483060196, "answer_id": 41389332, "question_id": 41388795, "link": "https://stackoverflow.com/questions/41388795/how-to-destructure-a-string-into-first-middle-and-last/41389332#41389332", "title": "How to destructure a string into first, middle, and last?", "body": "<p>The <code>(:)</code> operator is known as <code>cons</code>, it prepends items to lists:\n<code>1:2:[]</code> results in <code>[1,2]</code></p>\n\n<p>You are getting a type error because you are trying to compare the first argument, a <code>Char</code>, with the last one, a <code>[a]</code>.</p>\n\n<p>If you really would like to compare the first with the last you would use <code>head</code> and <code>last</code>.</p>\n\n<p>But you are better using the solution that <a href=\"https://stackoverflow.com/a/41388906/3847023\">taktoa</a> proposed:</p>\n\n<pre><code>numberIsPalindrome :: Int -&gt; Bool\nnumberIsPalindrome num = \n    numberString == reverse numberString\n  where numberString = show num\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1483404459, "post_id": 41396394, "comment_id": 70075973, "body": "Some possible improvements: 1. Track the length of the list as you build it so you know when to stop comparing. 2. Use <code>quotRem</code> instead of <code>div</code> and <code>mod</code>. 3. Return false immediately if the argument is not zero but the least significant digit is zero. 4. Switch from lists to vectors to reduce allocation and pointer chasing."}], "tags": [], "owner": {"reputation": 52258, "user_id": 375232, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/h3OwD.png?s=128&g=1", "display_name": "Landei", "link": "https://stackoverflow.com/users/375232/landei"}, "is_accepted": true, "score": 3, "last_activity_date": 1483400751, "last_edit_date": 1483400751, "creation_date": 1483101425, "answer_id": 41396394, "question_id": 41388795, "link": "https://stackoverflow.com/questions/41388795/how-to-destructure-a-string-into-first-middle-and-last/41396394#41396394", "title": "How to destructure a string into first, middle, and last?", "body": "<p>Using the <code>String</code> representation is cheating...</p>\n\n<p>Not really, but this is more fun:</p>\n\n<pre><code>import Data.List\n\npalindrome n = list == reverse list where\n    list = unfoldr f n   \n    f 0 = Nothing\n    f k = Just (k `mod` 10, k `div` 10)\n</code></pre>\n\n<p>What it does is creating a list of digits of the number (<code>unfoldr</code> is really useful for such tasks), and then comparing whether the list stays the same when reversed.</p>\n\n<p>What you try has several problems, e.g. you miss a conversion from the number to a <code>String</code> (which is just a list of <code>Char</code> in Haskell), and lists work completely different from what you try: Think of them more as stacks, where you usually operate only on one end. </p>\n\n<p>That said, there is an <code>init</code> and a <code>last</code> function for lists, which allow to work your way from the \"outer\" elements of the list to the inner ones. A naive (and inefficient) implementation could look like this:</p>\n\n<pre><code>palindrome n = f (show n) where\n    f [] = True\n    f [_] = True\n    f (x : xs) = (x == last xs) &amp;&amp; (f (init xs))\n</code></pre>\n\n<p>But this is only for demonstration purposes, don't use such code in real live... </p>\n"}], "owner": {"reputation": 411, "user_id": 1541138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67b8f63b8132ce94dbdff783e71e8060?s=128&d=identicon&r=PG", "display_name": "Brett Jackson", "link": "https://stackoverflow.com/users/1541138/brett-jackson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 613, "favorite_count": 0, "accepted_answer_id": 41396394, "answer_count": 3, "score": 1, "last_activity_date": 1483400751, "creation_date": 1483055407, "question_id": 41388795, "link": "https://stackoverflow.com/questions/41388795/how-to-destructure-a-string-into-first-middle-and-last", "title": "How to destructure a string into first, middle, and last?", "body": "<p>I'm writing a function to determine whether a number is a palindrome.</p>\n\n<p>What I would like to do in the first case is to destructure the string into the first character, all the characters in the middle, and the last character. What I do is check if the first character is equal to the last, and then if so, proceed to check the middle characters.</p>\n\n<p>What I have is below, but it generates type errors upon compilation. </p>\n\n<pre><code>numberIsPalindrome :: Int -&gt; Bool\nnumberIsPalindrome n =\n  case nString of\n    (x:xs:y) -&gt; (x == y) &amp;&amp; numberIsPalindrome xs\n    (x:y) -&gt; x == y\n    x -&gt; True\n  where nString = show n\n</code></pre>\n"}, {"tags": ["linux", "haskell", "cabal", "archlinux", "haskell-stack"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1483093880, "post_id": 41388746, "comment_id": 69991083, "body": "How did you create your yesod project ?"}, {"owner": {"reputation": 107, "user_id": 2804809, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/41830f7758621f29c2a35629943a0ebe?s=128&d=identicon&r=PG&f=1", "display_name": "Romano", "link": "https://stackoverflow.com/users/2804809/romano"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1483194837, "post_id": 41388746, "comment_id": 70021229, "body": "I followed this guide <a href=\"http://www.yesodweb.com/page/quickstart\" rel=\"nofollow noreferrer\">yesodweb.com/page/quickstart</a>"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1483198116, "post_id": 41388746, "comment_id": 70022080, "body": "You have to run devel command like this: <code>stack exec -- yesod devel</code>"}, {"owner": {"reputation": 107, "user_id": 2804809, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/41830f7758621f29c2a35629943a0ebe?s=128&d=identicon&r=PG&f=1", "display_name": "Romano", "link": "https://stackoverflow.com/users/2804809/romano"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1483201842, "post_id": 41388746, "comment_id": 70023092, "body": "Same sort of error     /usr/bin/ld: /home/romano/.stack/programs/x86_64-linux/ghc-7.10.3/lib/ghc&zwnj;&#8203;-7.10.3/rts/libCffi.&zwnj;&#8203;a(ffi64.o): relocation R_X86_64_32S against `.rodata&#39; can not be used when making a shared object; recompile with -fPIC /usr/bin/ld: final link failed: Nonrepresentable section on output collect2: error: ld returned 1 exit status"}, {"owner": {"reputation": 107, "user_id": 2804809, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/41830f7758621f29c2a35629943a0ebe?s=128&d=identicon&r=PG&f=1", "display_name": "Romano", "link": "https://stackoverflow.com/users/2804809/romano"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1483201857, "post_id": 41388746, "comment_id": 70023096, "body": "and     Exit code ExitFailure 1 while running [&quot;ghc&quot;,&quot;-rtsopts&quot;,&quot;-threaded&quot;,&quot;-clear-package-db&quot;,&quot;-global-p&zwnj;&#8203;ackage-db&quot;,&quot;-hide-al&zwnj;&#8203;l-packages&quot;,&quot;-packag&zwnj;&#8203;e&quot;,&quot;base&quot;,&quot;-main-is&quot;&zwnj;&#8203;,&quot;StackSetupShim.mai&zwnj;&#8203;nOverride&quot;,&quot;-package&zwnj;&#8203;&quot;,&quot;Cabal-1.22.5.0&quot;,&quot;&zwnj;&#8203;/home/romano/.stack/&zwnj;&#8203;setup-exe-src/setup-&zwnj;&#8203;mPHDZzAJ.hs&quot;,&quot;/home/&zwnj;&#8203;romano/.stack/setup-&zwnj;&#8203;exe-src/setup-shim-m&zwnj;&#8203;PHDZzAJ.hs&quot;,&quot;-o&quot;,&quot;/h&zwnj;&#8203;ome/romano/.stack/se&zwnj;&#8203;tup-exe-cache/x86_64&zwnj;&#8203;-linux/tmp-Cabal-sim&zwnj;&#8203;ple_mPHDZzAJ_1.22.5.&zwnj;&#8203;0_ghc-7.10.3&quot;] in /tmp/stack22219/ ExitFailure 1"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1483203553, "post_id": 41388746, "comment_id": 70023591, "body": "What is the output of <code>stack build -v3</code> ?"}, {"owner": {"reputation": 107, "user_id": 2804809, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/41830f7758621f29c2a35629943a0ebe?s=128&d=identicon&r=PG&f=1", "display_name": "Romano", "link": "https://stackoverflow.com/users/2804809/romano"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1483208100, "post_id": 41388746, "comment_id": 70024697, "body": "stack build -v3 Invalid option `-3&#39;"}, {"owner": {"reputation": 107, "user_id": 2804809, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/41830f7758621f29c2a35629943a0ebe?s=128&d=identicon&r=PG&f=1", "display_name": "Romano", "link": "https://stackoverflow.com/users/2804809/romano"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1483208184, "post_id": 41388746, "comment_id": 70024714, "body": "stack --numeric-version                                                                 :( 1.3.2"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1483209721, "post_id": 41388746, "comment_id": 70025077, "body": "My bad. It&#39;s just <code>stack build -v</code>."}, {"owner": {"reputation": 107, "user_id": 2804809, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/41830f7758621f29c2a35629943a0ebe?s=128&d=identicon&r=PG&f=1", "display_name": "Romano", "link": "https://stackoverflow.com/users/2804809/romano"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1483367713, "post_id": 41388746, "comment_id": 70063002, "body": "Too much to put it on here. I hope a pastebin link is ok: <a href=\"http://pastebin.com/W19s8wKj\" rel=\"nofollow noreferrer\">pastebin.com/W19s8wKj</a>"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1483371079, "post_id": 41388746, "comment_id": 70064677, "body": "You need to run <code>stack setup</code> inside your project first and then do the <code>stack build</code>."}, {"owner": {"reputation": 107, "user_id": 2804809, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/41830f7758621f29c2a35629943a0ebe?s=128&d=identicon&r=PG&f=1", "display_name": "Romano", "link": "https://stackoverflow.com/users/2804809/romano"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1483384785, "post_id": 41388746, "comment_id": 70070132, "body": "Again all erors when stack setup /usr/bin/ld: /home/romano/.stack/programs/x86_64-linux/ghc-7.10.3/lib/ghc&zwnj;&#8203;-7.10.3/rts/libCffi.&zwnj;&#8203;a(closures.o): relocation R_X86_64_32 against <code>.rodata&#39; can not be used when making a shared object; recompile with -fPIC &#47;usr&#47;bin&#47;ld: &#47;home&#47;romano&#47;.stack&#47;programs&#47;x86_64-linux&#47;ghc-7.10.3&#47;lib&#47;ghc&zwnj;&#8203;-7.10.3&#47;rts&#47;libCffi.&zwnj;&#8203;a(ffi64.o): relocation R_X86_64_32S against </code>.rodata&#39; can not be used when making a shared object; recompile with -fPIC /usr/bin/ld: final link failed: Nonrepresentable section on output collect2: error: ld returned 1 exit status"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1483437370, "post_id": 41388746, "comment_id": 70087479, "body": "That&#39;s weird. The last thing to do is to nuke <code>~&#47;.stack</code> and try again. If that doesn&#39;t work, post this as issue in Stack bug tracker."}, {"owner": {"reputation": 107, "user_id": 2804809, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/41830f7758621f29c2a35629943a0ebe?s=128&d=identicon&r=PG&f=1", "display_name": "Romano", "link": "https://stackoverflow.com/users/2804809/romano"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1483523810, "post_id": 41388746, "comment_id": 70127257, "body": "nuked ~/.stack and tried again. Error --&gt; / Exit code ExitFailure 1 while running [&quot;ghc&quot;,&quot;-rtsopts&quot;,&quot;-threaded&quot;,&quot;-clear-package-db&quot;,&quot;-global-p&zwnj;&#8203;ackage-db&quot;,&quot;-hide-al&zwnj;&#8203;l-packages&quot;,&quot;-packag&zwnj;&#8203;e&quot;,&quot;base&quot;,&quot;-main-is&quot;&zwnj;&#8203;,&quot;StackSetupShim.mai&zwnj;&#8203;nOverride&quot;,&quot;-package&zwnj;&#8203;&quot;,&quot;Cabal-1.22.5.0&quot;,&quot;&zwnj;&#8203;/home/romano/.stack/&zwnj;&#8203;setup-exe-src/setup-&zwnj;&#8203;mPHDZzAJ.hs&quot;,&quot;/home/&zwnj;&#8203;romano/.stack/setup-&zwnj;&#8203;exe-src/setup-shim-m&zwnj;&#8203;PHDZzAJ.hs&quot;,&quot;-o&quot;,&quot;/h&zwnj;&#8203;ome/romano/.stack/se&zwnj;&#8203;tup-exe-cache/x86_64&zwnj;&#8203;-linux/tmp-Cabal-sim&zwnj;&#8203;ple_mPHDZzAJ_1.22.5.&zwnj;&#8203;0_ghc-7.10.3&quot;] in /tmp/stack6678/"}], "answers": [{"tags": [], "owner": {"reputation": 107, "user_id": 2804809, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/41830f7758621f29c2a35629943a0ebe?s=128&d=identicon&r=PG&f=1", "display_name": "Romano", "link": "https://stackoverflow.com/users/2804809/romano"}, "is_accepted": true, "score": 0, "last_activity_date": 1483884501, "creation_date": 1483884501, "answer_id": 41533557, "question_id": 41388746, "link": "https://stackoverflow.com/questions/41388746/yesod-haskell-stack-installing-fpic/41533557#41533557", "title": "Yesod haskell-stack installing -fPIC", "body": "<p>Some users have come across a linker errors that seem to be dependent on the local environment, i.e. the package may compile on a different machine. The issue has been reported to be non-deterministic in some cases.</p>\n\n<p>The issue may be related to the use of hardening flags in some cases, specifically those related to producing position independent executables (PIE). </p>\n\n<p>In Arch Linux, the support for this is provided by the <strong>hardening-wrapper package</strong>. Possible workaround:</p>\n\n<pre><code>sudo vim /etc/hardening-wrapper.conf\n</code></pre>\n\n<p>* vim, nan, emacs or whatever editor you prefer.</p>\n\n<p>Change <code>HARDENING_PIE=1</code> to <code>HARDENING_PIE=0</code><br>\nsave it.</p>\n\n<p>That's it. </p>\n"}], "owner": {"reputation": 107, "user_id": 2804809, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/41830f7758621f29c2a35629943a0ebe?s=128&d=identicon&r=PG&f=1", "display_name": "Romano", "link": "https://stackoverflow.com/users/2804809/romano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 259, "favorite_count": 0, "accepted_answer_id": 41533557, "answer_count": 1, "score": 0, "last_activity_date": 1483884501, "creation_date": 1483054962, "last_edit_date": 1483884167, "question_id": 41388746, "link": "https://stackoverflow.com/questions/41388746/yesod-haskell-stack-installing-fpic", "title": "Yesod haskell-stack installing -fPIC", "body": "<p>This is the first time I try to install Haskell yesod but I run through some problems when I use these commands on Arch Linux</p>\n\n<pre><code>yesod devel \n</code></pre>\n\n<p>or<br></p>\n\n<pre><code>stack exec -- yesod devel\n</code></pre>\n\n<p><br></p>\n\n<pre><code>/usr/bin/ld: /home/romano/.stack/programs/x86_64-linux/ghc-tinfo6-7.10.3/lib/ghc-7.10.3/rts/libHSrts.a(Scav.o): relocation R_X86_64_32S against `.rodata' can not be used when making a shared object; recompile with -fPIC\n/usr/bin/ld: /home/romano/.stack/programs/x86_64-linux/ghc-tinfo6-7.10.3/lib/ghc-7.10.3/rts/libHSrts.a(Compact.o): relocation R_X86_64_32S against symbol `mblock_cache' can not be used when making a shared object; recompile with -fPIC\n/usr/bin/ld: /home/romano/.stack/programs/x86_64-linux/ghc-tinfo6-7.10.3/lib/ghc-7.10.3/rts/libHSrts.a(GCAux.o): relocation R_X86_64_32S against symbol `mblock_cache' can not be used when making a shared object; recompile with -fPIC\n/usr/bin/ld: /home/romano/.stack/programs/x86_64-linux/ghc-tinfo6-7.10.3/lib/ghc-7.10.3/rts/libHSrts.a(MarkWeak.o): relocation R_X86_64_32S against symbol `stg_DEAD_WEAK_info' can not be used when making a shared object; recompile with -fPIC\n/usr/bin/ld: /home/romano/.stack/programs/x86_64-linux/ghc-tinfo6-7.10.3/lib/ghc-7.10.3/rts/libCffi.a(closures.o): relocation R_X86_64_32 against `.rodata' can not be used when making a shared object; recompile with -fPIC\n/usr/bin/ld: /home/romano/.stack/programs/x86_64-linux/ghc-tinfo6-7.10.3/lib/ghc-7.10.3/rts/libCffi.a(ffi64.o): relocation R_X86_64_32S against `.rodata' can not be used when making a shared object; recompile with -fPIC\n/usr/bin/ld: final link failed: Nonrepresentable section on output\ncollect2: error: ld returned 1 exit status\nExit code ExitFailure 1 while running [\"ghc\",\"-clear-package-db\",\"-global-package-db\",\"-hide-all-packages\",\"-package\",\"base\",\"-package\",\"Cabal-1.22.5.0\",\"/tmp/stack16245/Setup.hs\",\"-o\",\"/home/romano/.stack/setup-exe-cache/x86_64-linux-tinfo6/tmp-setup-Simple-Cabal-1.22.5.0-ghc-7.10.3\",\"-rtsopts\"] in /tmp/stack16245/\nExitFailure 1\nType help for available commands. Press enter to force a rebuild.\n</code></pre>\n\n<p>Now I am not sure why this happens but I think my database settings are wrong</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1483045605, "post_id": 41386250, "comment_id": 69976692, "body": "Does the file have executable permissions?"}, {"owner": {"reputation": 1180, "user_id": 6302962, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/efdfc3bfc2651aebff7bcf20170edae6?s=128&d=identicon&r=PG&f=1", "display_name": "clo_jur", "link": "https://stackoverflow.com/users/6302962/clo-jur"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1483048507, "post_id": 41386250, "comment_id": 69977748, "body": "@jberryman yes it does. :("}, {"owner": {"reputation": 111, "user_id": 372966, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f06acfc479d437f318cc049e7e5bc2?s=128&d=identicon&r=PG", "display_name": "Jamin", "link": "https://stackoverflow.com/users/372966/jamin"}, "edited": false, "score": 0, "creation_date": 1493257423, "post_id": 41386250, "comment_id": 74342725, "body": "Hmm I have seen this same issue just now too on a fresh ubuntu VM install.  <code>stack exec mytest</code> gives      Executable named mytest not found on path: [...]  but <code>stack exec .stack-work&#47;dist&#47;x86_64-linux&#47;Cabal-1.24.2.0&#47;build&#47;mytest-ex&zwnj;&#8203;e&#47;mytest-exe</code> runs the executable fine. Also I seemed to have no trouble with running &#39;stack exec simpletest&#39; stack build of a project created with <code>stack new simpletest simple</code>. I am new to stack so not sure if I am doing something obviously wrong."}], "answers": [{"comments": [{"owner": {"reputation": 1180, "user_id": 6302962, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/efdfc3bfc2651aebff7bcf20170edae6?s=128&d=identicon&r=PG&f=1", "display_name": "clo_jur", "link": "https://stackoverflow.com/users/6302962/clo-jur"}, "edited": false, "score": 0, "creation_date": 1483076924, "post_id": 41389673, "comment_id": 69984554, "body": "Unfortunately, this doesn&#39;t work. If I call <code>stack exec full&#47;path&#47;to&#47;bin&#47;project-exec</code> it works. This is a bit frustrating. It was working yesterday. I&#39;m not sure what changed :/"}], "tags": [], "owner": {"reputation": 145, "user_id": 6840642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e5097e226bafec8ac922e683f1ad195?s=128&d=identicon&r=PG&f=1", "display_name": "Hapal", "link": "https://stackoverflow.com/users/6840642/hapal"}, "is_accepted": false, "score": 1, "last_activity_date": 1483063404, "creation_date": 1483063404, "answer_id": 41389673, "question_id": 41386250, "link": "https://stackoverflow.com/questions/41386250/haskell-stack-exec-executable-not-found-despite-path-being-searched/41389673#41389673", "title": "Haskell Stack `exec` executable not found despite path being searched", "body": "<p><code>Stack</code> replaces dashes <code>-</code> with underscores <code>_</code>. Try <code>stack exec project_exec</code> see if it works.</p>\n\n<p>This should have been a comment actually, but I don't have enough reputation to write a comment, while I have enough to post an answer!</p>\n"}, {"tags": [], "owner": {"reputation": 1180, "user_id": 6302962, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/efdfc3bfc2651aebff7bcf20170edae6?s=128&d=identicon&r=PG&f=1", "display_name": "clo_jur", "link": "https://stackoverflow.com/users/6302962/clo-jur"}, "is_accepted": true, "score": 9, "last_activity_date": 1483077783, "creation_date": 1483077783, "answer_id": 41391401, "question_id": 41386250, "link": "https://stackoverflow.com/questions/41386250/haskell-stack-exec-executable-not-found-despite-path-being-searched/41391401#41391401", "title": "Haskell Stack `exec` executable not found despite path being searched", "body": "<p>Apologies for the lack of attention showed here. This question should probably just be deleted.</p>\n\n<p>Stack creates a file named <code>&lt;project&gt;-exe</code> <em>not</em> <code>&lt;project&gt;-exec</code>.</p>\n"}], "owner": {"reputation": 1180, "user_id": 6302962, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/efdfc3bfc2651aebff7bcf20170edae6?s=128&d=identicon&r=PG&f=1", "display_name": "clo_jur", "link": "https://stackoverflow.com/users/6302962/clo-jur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3073, "favorite_count": 0, "accepted_answer_id": 41391401, "answer_count": 2, "score": 6, "last_activity_date": 1483077783, "creation_date": 1483040732, "question_id": 41386250, "link": "https://stackoverflow.com/questions/41386250/haskell-stack-exec-executable-not-found-despite-path-being-searched", "title": "Haskell Stack `exec` executable not found despite path being searched", "body": "<p>Creating a fresh <code>haskell-stack</code> project fails to find the <code>project-exec</code> executable, despite searching the appropriate path. I'm not sure why. In particular,</p>\n\n<p><code>stack build</code> creates the <code>project-exec</code> inside <code>$PROJECT_DIR/.stack-work/install/x86_64-linux-ncurses6/.../bin/project-exe</code></p>\n\n<p>However, <code>stack exec project-exec</code> fails with:</p>\n\n<blockquote>\n  <p>Executable named rse8-exec not found on path: [\"$PROJECT_DIR/.stack-work/install/x86_64-linux-ncurses6/lts-7.14/8.0.1/bin\", ]</p>\n</blockquote>\n\n<p>(to clarify, <code>$PROJECT_DIR</code> references and <code>...</code> are (hopefully) obvious placeholders for paths. the actual error contains the full path)</p>\n"}, {"tags": ["haskell", "lambda-calculus"], "comments": [{"owner": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1483037548, "post_id": 41385477, "comment_id": 69973307, "body": "@Carcigenicate Yep. That was it. I&#39;m embarrassed. Sorry about that."}], "answers": [{"comments": [{"owner": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "edited": false, "score": 0, "creation_date": 1483037708, "post_id": 41385628, "comment_id": 69973393, "body": "Perfect answer! Accept is coming in 4 minutes."}], "tags": [], "owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "is_accepted": true, "score": 6, "last_activity_date": 1483037673, "creation_date": 1483037673, "answer_id": 41385628, "question_id": 41385477, "link": "https://stackoverflow.com/questions/41385477/why-is-this-an-invalid-eta-conversion/41385628#41385628", "title": "Why is this an invalid eta conversion?", "body": "<p>You need to use function composition instead of application. Because you're only partially applying <code>filter</code>, it results in a function. </p>\n\n<p>You need to compose it into <code>length</code> instead of applying it:</p>\n\n<pre><code>lowercaseCount = length . filter isLower\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1483047915, "post_id": 41386930, "comment_id": 69977554, "body": "This is a great way of breaking it down."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 9, "last_activity_date": 1483044275, "creation_date": 1483044275, "answer_id": 41386930, "question_id": 41385477, "link": "https://stackoverflow.com/questions/41385477/why-is-this-an-invalid-eta-conversion/41386930#41386930", "title": "Why is this an invalid eta conversion?", "body": "<pre><code>lowercaseCount x = length $ filter isLower x\n</code></pre>\n\n<p>means</p>\n\n<pre><code>lowercaseCount x = length (filter isLower x)    -- (1)\n</code></pre>\n\n<p>while</p>\n\n<pre><code>lowercaseCount = length $ filter isLower\n</code></pre>\n\n<p>means</p>\n\n<pre><code>lowercaseCount = length (filter isLower)\n</code></pre>\n\n<p>which after eta-expansion becomes</p>\n\n<pre><code>lowercaseCount x = length (filter isLower) x  -- (2)\n</code></pre>\n\n<p>It should now be evident that (1) and (2) are not equivalent. The latter passes two arguments to <code>length</code>, triggering a type error.</p>\n"}], "owner": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "accepted_answer_id": 41385628, "answer_count": 2, "score": 2, "last_activity_date": 1483044275, "creation_date": 1483037084, "question_id": 41385477, "link": "https://stackoverflow.com/questions/41385477/why-is-this-an-invalid-eta-conversion", "title": "Why is this an invalid eta conversion?", "body": "<p>I am working on a pretty basic problem in haskell. I was trying to count the number of lower case letters in a String. My solution is this</p>\n\n<pre><code>import Data.Char\n\nlowercaseCount :: String -&gt; Int\nlowercaseCount x = length $ filter isLower x\n</code></pre>\n\n<p>I was looking at the actual implementation of <code>lowercaseCount</code> and saw that it seemed like it should have been able to under-go an eta reduction. I tried this</p>\n\n<pre><code>lowercaseCount = length $ filter isLower\n</code></pre>\n\n<p>but GHC yelled at me saying </p>\n\n<blockquote>\n  <p>Couldn't match expected type <code>[Char] -&gt; Int</code>\n                    with actual type <code>Int</code></p>\n</blockquote>\n\n<p>I was wondering why this eta reduction is illegal, and if there was a way to make this function able to be in an eta-reduced form. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1483037262, "post_id": 41385445, "comment_id": 69973171, "body": "What do you mean with \u201cto bytes\u201d? A string <i>is</i> already a list of characters which, if they&#39;re all ASCII, corresponds to the sequence of bytes in e.g. UTF-8."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1483039633, "post_id": 41385445, "comment_id": 69974278, "body": "Also, haskell strings are not C-strings - there&#39;s no <code>&#39;\\0&#39;</code> character at the end."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1483040188, "post_id": 41385445, "comment_id": 69974522, "body": "@rampion: Possibly FFI? As long as OP doesn&#39;t <a href=\"https://stackoverflow.com/posts/41385445/edit\">edit</a> the question to add some details, I think it should get closed as &quot;unclear&quot;."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user7311580"}, "edited": false, "score": 0, "creation_date": 1483046684, "post_id": 41386111, "comment_id": 69977070, "body": "I meant convert string (each character) to hex. For example:  <code>&quot;cc&quot; -&gt; &quot;\\63\\63&quot;</code>"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1483049410, "post_id": 41386111, "comment_id": 69978112, "body": "JavaNewbie: See for yourself in ghci, <code>&quot;c&quot; == &quot;\\x63&quot;</code>. Do you want to print the hex values of each unicode codepoint?"}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 3, "last_activity_date": 1483050089, "last_edit_date": 1483050089, "creation_date": 1483040026, "answer_id": 41386111, "question_id": 41385445, "link": "https://stackoverflow.com/questions/41385445/translating-string-to-bytes/41386111#41386111", "title": "Translating string to bytes", "body": "<p><code>String</code> in haskell, is just a synonym for <code>[Char]</code>, and <code>Char</code> is an instance of <code>Enum</code>, so there's <code>fromEnum :: Char -&gt; Int</code>, which will transform an individual <code>Char</code> into the index of the corresponding unicode codepoint:</p>\n\n<pre><code>\u03bb let toUnicodeCodepoints = map fromEnum\n\u03bb toUnicodeCodepoints \"\\0\\1\\2abc\\955\u03bb\\9731\u2603\"\n[0,1,2,97,98,99,955,955,9731,9731]\n</code></pre>\n\n<p>If you want bytes, then it's a question of encoding. Do you want the bytes from the ASCII encoding of the string? The Latin-1? The UTF-8? The UTF-16 little-endian? (and so on and so forth)</p>\n\n<p><code>Data.Text.Encoding</code> has some facilities for transforming <code>Text</code> to various byte encodings:</p>\n\n<ul>\n<li>encodeUtf16BE</li>\n<li>encodeUtf32BE</li>\n<li>encodeUtf8</li>\n<li>encodeUtf16LE</li>\n<li>encodeUtf32LE</li>\n</ul>\n\n<p>Which, when combined with <code>Data.Text.pack :: String -&gt; Text</code> and <code>Data.ByteString.unpack :: ByteString -&gt; [Word8]</code> can give you a list of bytes for a given encoding:</p>\n\n<pre><code>\u03bb let toUTF8Bytes = Data.ByteString.unpack . encodeUtf8 . Data.Text.pack\n\u03bb toUTF8Bytes \"\\0\\1\\2abc\\955\u03bb\\9731\u2603\"\n[0,1,2,97,98,99,206,187,206,187,226,152,131,226,152,131]\n</code></pre>\n\n<p><strong>UPDATE</strong>: Per the comment, if you want to escape all the characters in a string into their hex-escape represenatations, you can use <code>Numeric.showHex</code> to get the hex strings:</p>\n\n<pre><code>\u03bb let escapeAsHex = showString \"\\\"\" . foldr ((showString \"\\\\x\" .) . Numeric.showHex . fromEnum) \"\\\"\"\n\u03bb escapeAsHex \"\\0\\1\\2abc\\955\u03bb\\9731\u2603\"\n\"\\\"\\\\x0\\\\x1\\\\x2\\\\x61\\\\x62\\\\x63\\\\x3bb\\\\x3bb\\\\x2603\\\\x2603\\\"\"\n\u03bb putStrLn $ escapeAsHex \"\\0\\1\\2abc\\955\u03bb\\9731\u2603\"\n\"\\x0\\x1\\x2\\x61\\x62\\x63\\x3bb\\x3bb\\x2603\\x2603\"\n\u03bb read $ escapeAsHex \"\\0\\1\\2abc\\955\u03bb\\9731\u2603\" :: String\n\"\\NUL\\SOH\\STXabc\\955\\955\\9731\\9731\"\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user7311580"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 516, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1483050089, "creation_date": 1483036951, "question_id": 41385445, "link": "https://stackoverflow.com/questions/41385445/translating-string-to-bytes", "title": "Translating string to bytes", "body": "<p>Is there exists some prebuilt fuction in haskell to translate string to bytes?   If not, can you propose me some way to do it in elegant way ?<br>\nFor example:<br>\n<code>foo \"cz\" = \"\\63\\7a\\00\"</code></p>\n"}, {"tags": ["parsing", "haskell", "parsec"], "answers": [{"tags": [], "owner": {"reputation": 399, "user_id": 3608068, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1db7bfad7cf00ce607f6f385923e6dc9?s=128&d=identicon&r=PG&f=1", "display_name": "user3608068", "link": "https://stackoverflow.com/users/3608068/user3608068"}, "is_accepted": true, "score": 2, "last_activity_date": 1483017074, "creation_date": 1483017074, "answer_id": 41380458, "question_id": 41380158, "link": "https://stackoverflow.com/questions/41380158/parsing-whitespace-before-or-else-with-parsec/41380458#41380458", "title": "Parsing whitespace before or-else with Parsec", "body": "<p>You could use <a href=\"https://hackage.haskell.org/package/parsec-3.1.11/docs/Text-Parsec.html#v:try\" rel=\"nofollow noreferrer\">try</a></p>\n\n<pre><code>symbol s = try (spaces &gt;&gt; string s)\n</code></pre>\n\n<blockquote>\n  <p>The parser try p behaves like parser p, except that it pretends that it hasn't consumed any input when an error occurs.</p>\n</blockquote>\n"}], "owner": {"reputation": 8222, "user_id": 1833854, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b744b12985ddcf7cad8574ebdd49e33b?s=128&d=identicon&r=PG", "display_name": "JNevens", "link": "https://stackoverflow.com/users/1833854/jnevens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 751, "favorite_count": 0, "accepted_answer_id": 41380458, "answer_count": 1, "score": 1, "last_activity_date": 1483017074, "creation_date": 1483015997, "question_id": 41380158, "link": "https://stackoverflow.com/questions/41380158/parsing-whitespace-before-or-else-with-parsec", "title": "Parsing whitespace before or-else with Parsec", "body": "<p>I am using the <code>Parsec</code> module in Haskell to parse files. One of the components of these files are colors. I have created a type for colors like this:</p>\n\n<pre><code>data Color = Yellow | Red | Blue | Green deriving (Show)\n</code></pre>\n\n<p>My initial attempt at parsing colors looks like this:</p>\n\n<pre><code>symbol :: String -&gt; Parsec String () String\nsymbol s = spaces &gt;&gt; string s\n\ncolorP :: Parsec String () Color\ncolorP = \n   liftM mkColor $ symbol \"Yellow\" &lt;|&gt; symbol \"Red\" &lt;|&gt; symbol \"Blue\" &lt;|&gt; symbol \"Green\"\n  where\n   mkColor :: String -&gt; Color\n   mkColor \"Yellow\" = Yellow\n   mkColor \"Red\" = Red\n   mkColor \"Blue\" = Blue\n   mkColor \"Green\" = Green\n</code></pre>\n\n<p>I created the <code>symbol</code> parser which basically eats as much whitespace as possible and then eats the given string <code>s</code>. However, this does not seem to work. I test this code with the following call:</p>\n\n<pre><code>parse colorP \"\" \"        Red\"\n</code></pre>\n\n<p>This gave me the following error:</p>\n\n<pre><code>unexpected \"R\"\nexpecting space or \"Yellow\"\n</code></pre>\n\n<p>However, I went looking on Hoogle for the documentation that goes with the <code>&lt;|&gt;</code> operator and there I found the following: </p>\n\n<blockquote>\n  <p>This combinator implements choice. The parser p &lt;|> q first applies p. If it succeeds, the value of p is returned. If p fails <strong>without consuming any input,</strong> parser q is tried.</p>\n</blockquote>\n\n<p>So, I think the problem with the above example is that parser <code>p</code> (in this case <code>symbol \"Yellow\"</code>) already did consume some input, namely the blanks! So, I refactored my <code>colorP</code> like this:</p>\n\n<pre><code>colorP =\n  liftM mkColor $ spaces &gt;&gt; (string \"Yellow\" &lt;|&gt; string \"Red\" &lt;|&gt; string \"Blue\" &lt;|&gt; string \"Green\")\n where\n   -- mkColor same as before\n</code></pre>\n\n<p>which gives the result I want. </p>\n\n<p>Now, I am wondering if there is no parser like the <code>symbol</code> parser that I wrote, but that puts back the input in case of a failure. Or is the second implementation of <code>colorP</code> the one that is most Haskell-ish?</p>\n"}, {"tags": ["haskell", "memory-leaks", "attoparsec"], "answers": [{"tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 4, "last_activity_date": 1483021361, "creation_date": 1483021361, "answer_id": 41381544, "question_id": 41378676, "link": "https://stackoverflow.com/questions/41378676/simple-parser-running-out-of-memory/41381544#41381544", "title": "Simple parser running out of memory", "body": "<p>If you look at <a href=\"https://hackage.haskell.org/package/attoparsec-0.13.1.0/docs/Data-Attoparsec-ByteString.html#v:manyTill-39-\" rel=\"nofollow noreferrer\">the documentation of attoparsec</a> you'll notice that there is a similar example and it is accompanied by the following comment:</p>\n\n<blockquote>\n  <p>Note the overlapping parsers <code>anyChar</code> and <code>string \"--&gt;\"</code>. While this will work, it is not very efficient, as it will cause a lot of backtracking.</p>\n</blockquote>\n\n<p>Using an alternative to <code>anyChar</code> which rejects the characters accepted by <code>endOfLine</code> should fix the issue. E.g.</p>\n\n<pre><code>satisfy (\\c -&gt; c `notElem` ['\\n', '\\r'])\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 399, "user_id": 3608068, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1db7bfad7cf00ce607f6f385923e6dc9?s=128&d=identicon&r=PG&f=1", "display_name": "user3608068", "link": "https://stackoverflow.com/users/3608068/user3608068"}, "edited": false, "score": 0, "creation_date": 1483085866, "post_id": 41385964, "comment_id": 69987689, "body": "This answers my question better as I wanted to understand the issue rather than to fix it."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 3, "last_activity_date": 1483039379, "creation_date": 1483039379, "answer_id": 41385964, "question_id": 41378676, "link": "https://stackoverflow.com/questions/41378676/simple-parser-running-out-of-memory/41385964#41385964", "title": "Simple parser running out of memory", "body": "<p>I'm not that familiar with Attoparsec, but I think you might have a difficult time using it, alone, to parse a huge file in constant memory.  If you replace your top-level parser <code>parseAll</code> with:</p>\n\n<pre><code>parseAll :: Parser ()\nparseAll = skipMany anyChar\n</code></pre>\n\n<p>and profile it, you'll find that memory usage <em>still</em> grows without bound.  (And when I converted your code to use incremental reading with strict <code>ByteString</code>s, it didn't make any difference.)</p>\n\n<p>I believe the problem is this:  because Attoparsec does automatic backtracking, it has to be prepared for <code>parseAll</code> (your version or mine -- it doesn't matter) to be used like this:</p>\n\n<pre><code>(parseAll &lt;* somethingThatDoesntMatch) &lt;|&gt; parseDifferently\n</code></pre>\n\n<p>If <code>parseAll</code> has parsed half a million lines and reaches the end, <code>somethingThatDoesntMatch</code> will cause it to backtrack all the way back to the beginning and then reparse everything with <code>parseDifferently</code>.  So, the meta information for backtracking and the ByteStrings themselves can't be freed until the parse is completely finished.</p>\n\n<p>Now, your parser (and my example above), \"obviously\" won't need to backtrack this way, but Attoparsec doesn't deduce this.</p>\n\n<p>I can think of a couple of ways to proceed:</p>\n\n<ol>\n<li>If you are parsing megabytes instead of gigabytes, consider using Parsec, which only backtracks when it's made explicit (e.g., using <code>try</code>).</li>\n<li>Break up your log file into lines (or blocks of lines) using a hand-crafted, non-backtracking parser, and run your Attoparsec parser to completion on each line/block.</li>\n</ol>\n"}], "owner": {"reputation": 399, "user_id": 3608068, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1db7bfad7cf00ce607f6f385923e6dc9?s=128&d=identicon&r=PG&f=1", "display_name": "user3608068", "link": "https://stackoverflow.com/users/3608068/user3608068"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 209, "favorite_count": 0, "accepted_answer_id": 41385964, "answer_count": 2, "score": 7, "last_activity_date": 1483039379, "creation_date": 1483010425, "question_id": 41378676, "link": "https://stackoverflow.com/questions/41378676/simple-parser-running-out-of-memory", "title": "Simple parser running out of memory", "body": "<p>I'd like to understand why this simple parser runs out of memory for large files. I'm really clueless what am I doing wrong. </p>\n\n<pre><code>import Data.Attoparsec.ByteString.Char8\nimport qualified Data.Attoparsec.ByteString.Lazy as Lazy\nimport System.Environment\nimport qualified Data.ByteString.Lazy as B\nimport Control.Applicative\n\nparseLine :: Parser String\nparseLine = manyTill' anyChar (endOfLine &lt;|&gt; endOfInput)\n\nparseAll :: Parser [Int]\nparseAll = manyTill' \n        (parseLine &gt;&gt; (return 0)) -- discarding what's been read\n        endOfInput\n\nmain :: IO()\nmain = do \n        [fn] &lt;- getArgs\n        text &lt;- B.readFile fn\n\n        case Lazy.parse parseAll text of\n                Lazy.Fail _ _ _ -&gt; putStrLn \"bad\"\n                Lazy.Done _ _ -&gt; putStrLn \"ok\" \n</code></pre>\n\n<p>I'm running the program with:</p>\n\n<pre><code> runhaskell.exe test.hs x.log\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>test.hs: Out of memory\n</code></pre>\n\n<p>x.log is about 500MB in size. My machine has 16GB of RAM. </p>\n"}, {"tags": ["haskell", "ghci", "applicative"], "comments": [{"owner": {"reputation": 399, "user_id": 3608068, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1db7bfad7cf00ce607f6f385923e6dc9?s=128&d=identicon&r=PG&f=1", "display_name": "user3608068", "link": "https://stackoverflow.com/users/3608068/user3608068"}, "edited": false, "score": 1, "creation_date": 1483016002, "post_id": 41378354, "comment_id": 69961984, "body": "<a href=\"http://stackoverflow.com/a/28979021/3608068\">stackoverflow.com/a/28979021/3608068</a>"}, {"owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "reply_to_user": {"reputation": 399, "user_id": 3608068, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1db7bfad7cf00ce607f6f385923e6dc9?s=128&d=identicon&r=PG&f=1", "display_name": "user3608068", "link": "https://stackoverflow.com/users/3608068/user3608068"}, "edited": false, "score": 0, "creation_date": 1483164109, "post_id": 41378354, "comment_id": 70014794, "body": "thank you @user3608068. The link you provided exactly answers my question but I was not able to find it when I searched for it."}], "answers": [{"comments": [{"owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "edited": false, "score": 0, "creation_date": 1483163938, "post_id": 41380287, "comment_id": 70014765, "body": "Thank you Mr chi, I feel enlightened now :)"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1483016462, "creation_date": 1483016462, "answer_id": 41380287, "question_id": 41378354, "link": "https://stackoverflow.com/questions/41378354/understanding-how-the-pure-function-is-resolved-in-haskell/41380287#41380287", "title": "Understanding how the pure function is resolved in Haskell", "body": "<p>GHCi performs some magic to be user-friendly.</p>\n\n<p>When entering an expression whose type is of the form <code>... =&gt; f a</code>, it tries to instantiate <code>f</code> to <code>IO</code>. In your case, this is possible since <code>IO</code> is an applicative (and a monad).</p>\n\n<p>Secondly, when an expression having a type of the form <code>... =&gt; IO a</code> is entered, it is run as an IO action.</p>\n\n<p>Finally, if <code>a</code> is of class <code>Show</code>, the result is printed. In your case <code>\"aa\"</code> is the result (and the type <code>a</code> is <code>String</code>), so GHCi prints that.</p>\n"}], "owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 41380287, "answer_count": 1, "score": 1, "last_activity_date": 1483016462, "creation_date": 1483009259, "question_id": 41378354, "link": "https://stackoverflow.com/questions/41378354/understanding-how-the-pure-function-is-resolved-in-haskell", "title": "Understanding how the pure function is resolved in Haskell", "body": "<p>In GHCi when I type <code>pure 2</code> it returns <code>2</code>; or <code>pure \"aa\"</code> returns <code>\"aa\"</code>. I wonder how this applicative instance is resolved for 2 or \"aa\" by GHCi.</p>\n"}, {"tags": ["haskell", "version", "cabal", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 1, "last_activity_date": 1483033073, "creation_date": 1483033073, "answer_id": 41384615, "question_id": 41378023, "link": "https://stackoverflow.com/questions/41378023/dependencies-of-a-haskell-project/41384615#41384615", "title": "dependencies of a haskell project", "body": "<p>In Stack, the resolver value fully specifies which packages are available. Changing flags does not in any way affect which package versions can be used.</p>\n"}], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 41384615, "answer_count": 1, "score": 0, "last_activity_date": 1483462615, "creation_date": 1483008102, "last_edit_date": 1483462615, "question_id": 41378023, "link": "https://stackoverflow.com/questions/41378023/dependencies-of-a-haskell-project", "title": "dependencies of a haskell project", "body": "<p>If I <code>stack unpack hakyll-4.9.2.0</code> I see in the cabal file</p>\n\n<pre><code>Build-Depends:\n    base                 &gt;= 4.8    &amp;&amp; &lt; 5,\n    ...\n  If flag(checkExternal)\n    Build-depends:\n      http-conduit &gt;= 2.2    &amp;&amp; &lt; 2.3,\n</code></pre>\n\n<p>After doing <code>stack init</code> the resolver selected is <code>lts-7.14</code> which only contains <code>http-conduit</code> version <code>2.1.11</code> (cf <a href=\"https://www.stackage.org/lts-7.14/package/http-conduit-2.1.11\" rel=\"nofollow noreferrer\">https://www.stackage.org/lts-7.14/package/http-conduit-2.1.11</a>)</p>\n\n<p>However it does compile, and doing <code>stack  list-dependencies --flag hakyll:checkExternal | grep -i http</code> yields </p>\n\n<pre><code>...\nhttp-conduit 2.1.11\n</code></pre>\n\n<p>which is surprising.</p>\n\n<p>When I change the resolver to <code>nightly-2016-12-28</code>in stack.yaml, it shows a dependency on </p>\n\n<pre><code>$ stack  list-dependencies --flag hakyll:checkExternal | grep -i http\nhttp-conduit 2.2.3\n</code></pre>\n\n<p>Is there an explanation of whats could go on here ?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1482975705, "post_id": 41371997, "comment_id": 69945900, "body": "what is the output of <code>ghc-pkg list</code> and did you install haskell from a system package or with stack. Are you maybe using a debian based linux distribution and have installed the <code>haskell-platform</code> and/or <code>random</code> without <code>random-prof</code>"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1482976173, "post_id": 41371997, "comment_id": 69945985, "body": "if you answered the last question with yes - try <code>apt-get install libghc-random-prof</code>."}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1482985121, "post_id": 41371997, "comment_id": 69947813, "body": "@epsilonhalbe: I&#39;m running Arch Linux. I posted the output of <code>ghc-pkg list</code> above. I also installed some Arch Linux packages having keywords like <code>random</code> in them, but am getting similar errors."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1483110065, "post_id": 41371997, "comment_id": 69998347, "body": "i am no expert on arch linux, but when using stack I try to install as little packages as possible with my system - in my case only cabal, alex, happy and ghc is installled - everything else is done by stack. either install the relevant profiling packages as well or - remove them."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 1, "creation_date": 1483468460, "post_id": 41371997, "comment_id": 70106678, "body": "When GHC complains about missing profiling libraries, it often helps to use a stack-managed GHC via <code>--no-system-ghc</code>. <code>--no-system-ghc</code> was made the default setting in <a href=\"https://github.com/commercialhaskell/stack/releases/tag/v1.3.0\" rel=\"nofollow noreferrer\">v1.3.0</a>."}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 164, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1483461457, "creation_date": 1482974622, "last_edit_date": 1483461457, "question_id": 41371997, "link": "https://stackoverflow.com/questions/41371997/stack-build-profiling-fails-due-to-tf-random-error", "title": "Stack Build Profiling Fails Due to tf-random Error", "body": "<p>Running <code>stack build --profile</code> on my project yields the following error:</p>\n\n<pre><code>tf-random-0.5: configure\ntf-random-0.5: build\nProgress: 1/5\n--  While building package tf-random-0.5 using:\n      /home/user/.stack/setup-exe-cache/x86_64-linux/setup-Simple-Cabal-1.24.0.0-ghc-8.0.1 --builddir=.stack-work/dist/x86_64-linux/Cabal-1.24.0.0 build --ghc-options \" -ddump-hi -ddump-to-file\"\n    Process exited with code: ExitFailure 1\n    Logs have been written to: /home/user/myProject/.stack-work/logs/tf-random-0.5.log\n\n    Configuring tf-random-0.5...\n    Building tf-random-0.5...\n    Preprocessing library tf-random-0.5...\n    [1 of 4] Compiling System.Random.TF.Gen ( src/System/Random/TF/Gen.hs, .stack-work/dist/x86_64-linux/Cabal-1.24.0.0/build/System/Random/TF/Gen.o )\n    [2 of 4] Compiling System.Random.TF.Init ( src/System/Random/TF/Init.hs, .stack-work/dist/x86_64-linux/Cabal-1.24.0.0/build/System/Random/TF/Init.o )\n\n    /tmp/stack27695/tf-random-0.5/src/System/Random/TF/Init.hs:94:5: warning: [-Wdeprecations]\n        In the use of \u2018bitSize\u2019 (imported from Data.Bits):\n        Deprecated: \"Use 'bitSizeMaybe' or 'finiteBitSize' instead\"\n    [3 of 4] Compiling System.Random.TF.Instances ( src/System/Random/TF/Instances.hs, .stack-work/dist/x86_64-linux/Cabal-1.24.0.0/build/System/Random/TF/Instances.o )\n    [4 of 4] Compiling System.Random.TF ( src/System/Random/TF.hs, .stack-work/dist/x86_64-linux/Cabal-1.24.0.0/build/System/Random/TF.o )\n    [1 of 4] Compiling System.Random.TF.Gen ( src/System/Random/TF/Gen.hs, .stack-work/dist/x86_64-linux/Cabal-1.24.0.0/build/System/Random/TF/Gen.p_o )\n\n    /tmp/stack27695/tf-random-0.5/src/System/Random/TF/Gen.hs:18:1: error:\n        Failed to load interface for \u2018System.Random\u2019\n        Perhaps you haven't installed the profiling libraries for package \u2018random-1.1\u2019?\n        Use -v to see a list of the files searched for.\n</code></pre>\n\n<p>Note that I have other stack projects on my system which do not yield this error. The only difference between those projects and this one, that I can think of, is that this one makes heavy use of C/C++ FFI.</p>\n\n<p>Finally, I tried adding dependencies on <code>tf-random</code> and <code>random</code> to my cabal file, but to no avail. Note also I'm not using <code>random</code> libraries in my project, and running <code>stack build</code> works just fine (I only see these errors when I add the <code>--profile</code> tag).</p>\n\n<p><strong>EDIT:</strong> The output of <code>ghc-pkg list</code>.</p>\n\n<pre><code>/usr/lib/ghc-8.0.1/package.conf.d\n    Cabal-1.24.0.0\n    HUnit-1.5.0.0\n    QuickCheck-2.9.2\n    X11-1.6.1.2\n    X11-xft-0.3.1\n    array-0.5.1.1\n    base-4.9.0.0\n    binary-0.8.3.0\n    bytestring-0.10.8.1\n    call-stack-0.1.0\n    containers-0.5.7.1\n    data-default-0.7.1.1\n    data-default-class-0.1.2.0\n    data-default-instances-containers-0.0.1\n    data-default-instances-dlist-0.0.1\n    data-default-instances-old-locale-0.0.1\n    deepseq-1.4.2.0\n    directory-1.2.6.2\n    dlist-0.8.0.2\n    extensible-exceptions-0.1.1.4\n    filepath-1.4.1.0\n    ghc-8.0.1\n    ghc-boot-8.0.1\n    ghc-boot-th-8.0.1\n    ghc-prim-0.5.0.0\n    ghci-8.0.1\n    haskeline-0.7.2.3\n    hoopl-3.10.2.1\n    hpc-0.6.0.3\n    integer-gmp-1.0.0.1\n    mtl-2.2.1\n    old-locale-1.0.0.7\n    old-time-1.1.0.3\n    pretty-1.1.3.3\n    primitive-0.6.1.0\n    process-1.4.2.0\n    quickcheck-io-0.1.4\n    random-1.1\n    rts-1.0\n    setlocale-1.0.0.3\n    template-haskell-2.11.0.0\n    terminfo-0.4.0.2\n    tf-random-0.5\n    time-1.6.0.1\n    transformers-0.5.2.0\n    unix-2.7.2.0\n    utf8-string-1.0.1.1\n    xhtml-3000.2.1\n    xmonad-0.12\n    xmonad-contrib-0.12\n/home/user/.ghc/x86_64-linux-8.0.1/package.conf.d\n    HUnit-1.5.0.0\n    ListLike-4.5\n    QuickCheck-2.9.2\n    Unixutils-1.54.1\n    bzlib-0.5.0.5\n    call-stack-0.1.0\n    cereal-0.5.4.0\n    crypto-api-0.13.2\n    entropy-0.3.7\n    exceptions-0.8.3\n    fmlist-0.9\n    generic-deriving-1.11.1\n    hscolour-1.24.1\n    network-uri-2.6.1.0\n    parsec-3.1.11\n    primitive-0.6.1.0\n    process-extras-0.4.1.4\n    pureMD5-2.1.3\n    regex-base-0.93.2\n    regex-compat-0.95.1\n    regex-posix-0.95.2\n    regex-tdfa-1.2.2\n    sr-extra-1.46.3.2\n    stm-2.4.4.1\n    syb-0.6\n    tagged-0.8.5\n    text-1.2.2.1\n    tf-random-0.5\n    transformers-compat-0.5.1.4\n    vector-0.11.0.0\n    zlib-0.6.1.2\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1482971228, "post_id": 41371547, "comment_id": 69944992, "body": "I don&#39;t know of any pre-existing functions that would do this for you. For what it&#39;s worth, if you need it to be efficient I&#39;d probably approach it much as you would in C: preallocate a <code>Vector</code> of the correct length, <code>traverse</code> the characters of the <code>Text</code> and write them into the <code>Vector</code>, in the <code>ST</code> monad"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1482974157, "post_id": 41371547, "comment_id": 69945608, "body": "Complicated? This program is equivalent to <code>T.foldr (flip V.snoc) V.empty</code> which contains only four identifiers - if you call this a complicated program, please give an example of a &#39;simple&#39; one. Computationally inefficient? Have you profiled this program and determined it is too slow for your needs? Otherwise, do not worry about prematurely optimizing your program. The designers of these libraries put great effort into making such programs efficient. (As an aside, your program reverses the string - <code>T.foldr V.cons V.empty</code> gets you the original order)"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1482976408, "post_id": 41371547, "comment_id": 69946031, "body": "&#39;V.unfoldr T.uncons&#39; is the simplest, I think. The result should fuse with suitable Vector functions, though the text will be constructed."}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 4, "creation_date": 1482979291, "post_id": 41371547, "comment_id": 69946605, "body": "<code>V.fromList . T.unpack</code>? maybe it doesn&#39;t make that big a difference after fusion"}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1483016710, "post_id": 41378682, "comment_id": 69962396, "body": "Nice experiments. (Isn&#39;t <code>~e</code> equivalent to <code>e</code>, though? Is there any reason for the lazy pattern?)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1483022816, "post_id": 41378682, "comment_id": 69965745, "body": "having explicit values for <a href=\"https://en.wikipedia.org/wiki/Analysis_of_algorithms#Empirical_orders_of_growth\" rel=\"nofollow noreferrer\">empirical orders of growth</a> or even a log-log plot of run times vs sizes would be extremely nice :) (as seen e.g. <a href=\"http://stackoverflow.com/a/30116605/849891\">here</a> and <a href=\"http://stackoverflow.com/a/30181351/849891\">here</a>)."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1483029169, "post_id": 41378682, "comment_id": 69969268, "body": "@chi: It&#39;s recommended by the Criterion documentation"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1483029206, "post_id": 41378682, "comment_id": 69969287, "body": "@WillNess: as soon as I&#39;m not stuck on a mobile Core2DuoT6500 (and an almost broken Win8.1 development). So... early next week?"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1483031048, "post_id": 41378682, "comment_id": 69970293, "body": "Here&#39;s the obvious conversion via the underlying Stream types <a href=\"http://sprunge.us/JZFf\" rel=\"nofollow noreferrer\">sprunge.us/JZFf</a> It&#39;s a little faster but not too much it seems."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1483031951, "post_id": 41378682, "comment_id": 69970784, "body": "It might be worth noting that since <code>Char</code> has an <code>Unbox</code> instance you can import <code>Data.Vector.Unboxed</code> instead of <code>Data.Vector</code>, which here is about 4x faster, as usual."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1483034975, "post_id": 41378682, "comment_id": 69972195, "body": "@Michael: If and only if OP actually wants to use <code>Data.Vector.Unboxed.Vector</code> instead of <code>Data.Vector.Vector</code>. But yeah, I should probably add that too."}, {"owner": {"reputation": 6779, "user_id": 1342941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a77b35477fab1e681d7e14f7ea78b178?s=128&d=identicon&r=PG", "display_name": "happydave", "link": "https://stackoverflow.com/users/1342941/happydave"}, "edited": false, "score": 0, "creation_date": 1483035568, "post_id": 41378682, "comment_id": 69972473, "body": "Wow, great analysis.  I learned a lot from the answer and all the comments.  I had actually looked at unfoldr when I was trying to get this to work, but couldn&#39;t easily figure out a function to pass into it.  Is unfoldr/uncons a well known pattern?  It seems like they were made for each other, but I don&#39;t see any hint of that in the documentation.  In any case, both options seem much nicer than mine, so thanks!"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1483042988, "post_id": 41378682, "comment_id": 69975658, "body": "@Zeta don&#39;t mind me, I&#39;m just preaching this technique every chance I get. :)"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 8, "last_activity_date": 1483010449, "creation_date": 1483010449, "answer_id": 41378682, "question_id": 41371547, "link": "https://stackoverflow.com/questions/41371547/map-from-one-data-structure-to-another/41378682#41378682", "title": "Map from one data structure to another", "body": "<p><em>Better</em> is kind of subjective. What makes something better? Less code? Less memory consumption? Less time needed?</p>\n\n<p>That being said, yes, your algorithm is computationally inefficient, since <code>snoc</code> has O(n), where <code>n</code> is the length of your (intermediate) vector. Therefore, you have created an O(n*n) algorithm (n <code>snoc</code> operations, with increasing length, therefore 1 + 2 + 3 + ... + (n-1) = n*(n-1)/2).</p>\n\n<p>Depending on the constants hidden away in the big-O notation, one would expect your function to work slow on large lists. But before we benchmark it, let's think about the alternatives:</p>\n\n<ul>\n<li>we can go over an intermediate data structure which provides conversions for both data structures, e.g. <code>[Char]</code> via <code>V.fromList</code> and <code>T.pack</code></li>\n<li>we can use unfold the vector with <code>V.unfoldr</code> by splitting single chars from the <code>T.Text</code> with <code>T.uncons</code>.</li>\n</ul>\n\n<p>So let's use Criterion to create some benchmarks:</p>\n\n<pre><code>module Main where\n\nimport Criterion\nimport Criterion.Main\nimport Control.Monad (replicateM)\nimport qualified Data.Text as T\nimport qualified Data.Vector as V\nimport System.Random (randomRIO)\n\nsetupEnv n = fmap T.pack $ replicateM n (randomRIO (' ','~'))\n\ntextToVec :: T.Text -&gt; V.Vector Char\ntextToVec t = T.foldr append V.empty t where\n   append c vec = V.snoc vec c\n\nexample :: T.Text\nexample = T.pack \"Hello, World\"\n\nbenchOn :: T.Text -&gt; [Benchmark]\nbenchOn ~e = map (\\(s,f) -&gt; bench s $ whnf f e)\n     [(\"textToVec\", textToVec)\n     ,(\"T.foldr (flip V.snoc) V.empty\", T.foldr (flip V.snoc) V.empty)\n     ,(\"V.fromList . T.unpack\", V.fromList . T.unpack)\n     ,(\"V.unfoldr T.uncons\", V.unfoldr T.uncons)\n     ]\n\nmain = defaultMain [\n    bgroup \"example\" $ benchOn example\n  , env (setupEnv $  1000) $ \\ ~small -&gt; bgroup  \"1000\" $ benchOn small \n  , env (setupEnv $ 10000) $ \\ ~small -&gt; bgroup \"10000\" $ benchOn small \n  ]\n</code></pre>\n\n<p>I've used lts-5 to compile it:</p>\n\n<pre><code>stack exec --package random\\\n           --package vector\\\n           --package text\\\n           --resolver=lts-5\\\n      -- ghc -O2 Benchmark.hs\n</code></pre>\n\n<h1>Benchmarking results</h1>\n\n<p>We first run all variants on \"Hello, world\", then on a randomly generated string of length 1000, and then one of length 10000.</p>\n\n<h2>\"Hello, world\"</h2>\n\n<pre><code>benchmarking example/textToVec\ntime                 1.106 us   (1.098 us .. 1.117 us)\n                     1.000 R\u00b2   (0.999 R\u00b2 .. 1.000 R\u00b2)\nmean                 1.102 us   (1.099 us .. 1.107 us)\nstd dev              12.67 ns   (6.277 ns .. 21.00 ns)\n\nbenchmarking example/T.foldr (flip V.snoc) V.empty\ntime                 1.225 us   (1.222 us .. 1.229 us)\n                     1.000 R\u00b2   (1.000 R\u00b2 .. 1.000 R\u00b2)\nmean                 1.229 us   (1.226 us .. 1.232 us)\nstd dev              10.48 ns   (7.634 ns .. 16.00 ns)\n\nbenchmarking example/V.fromList . T.unpack\ntime                 643.6 ns   (640.9 ns .. 646.4 ns)\n                     1.000 R\u00b2   (1.000 R\u00b2 .. 1.000 R\u00b2)\nmean                 643.6 ns   (641.7 ns .. 645.7 ns)\nstd dev              6.525 ns   (5.573 ns .. 7.860 ns)\n\nbenchmarking example/V.unfoldr T.uncons\ntime                 518.1 ns   (516.1 ns .. 520.4 ns)\n                     1.000 R\u00b2   (1.000 R\u00b2 .. 1.000 R\u00b2)\nmean                 518.0 ns   (516.1 ns .. 520.1 ns)\nstd dev              6.541 ns   (4.943 ns .. 8.479 ns)\nvariance introduced by outliers: 11% (moderately inflated)\n</code></pre>\n\n<p>As you can see, at this point, unfolding or going via list takes about half the time compared to your function. Both the unfolding approach as well the <code>fromList . unpack</code> take half a microsecond.</p>\n\n<h2>Random text with 1000 characters</h2>\n\n<pre><code>benchmarking 1000/textToVec\ntime                 1.311 ms   (1.302 ms .. 1.320 ms)\n                     0.999 R\u00b2   (0.999 R\u00b2 .. 1.000 R\u00b2)\nmean                 1.342 ms   (1.331 ms .. 1.366 ms)\nstd dev              55.31 us   (27.75 us .. 96.80 us)\nvariance introduced by outliers: 29% (moderately inflated)\n\nbenchmarking 1000/T.foldr (flip V.snoc) V.empty\ntime                 6.013 ms   (5.953 ms .. 6.081 ms)\n                     0.999 R\u00b2   (0.997 R\u00b2 .. 1.000 R\u00b2)\nmean                 6.054 ms   (6.028 ms .. 6.097 ms)\nstd dev              100.8 us   (62.45 us .. 180.7 us)\n\nbenchmarking 1000/V.fromList . T.unpack\ntime                 26.83 us   (26.77 us .. 26.92 us)\n                     1.000 R\u00b2   (1.000 R\u00b2 .. 1.000 R\u00b2)\nmean                 26.90 us   (26.83 us .. 27.00 us)\nstd dev              264.1 ns   (209.7 ns .. 348.2 ns)\n\nbenchmarking 1000/V.unfoldr T.uncons\ntime                 15.05 us   (14.93 us .. 15.19 us)\n                     0.999 R\u00b2   (0.999 R\u00b2 .. 1.000 R\u00b2)\nmean                 15.02 us   (14.95 us .. 15.15 us)\nstd dev              303.0 ns   (206.6 ns .. 428.3 ns)\nvariance introduced by outliers: 19% (moderately inflated)\n</code></pre>\n\n<p>This is where it gets interesting. Your function is better than the point-free one. One would have to look into GHCs core to see where the bottleneck is.</p>\n\n<p>That being said, for a string that's about 100 times longer than our original one (<code>length \"Hello, World\" == 12</code>), our two contestants <code>V.unfoldr T.uncons</code> and <code>V.fromList . T.unpack</code> take about 30/45 times longer on that data compared to the example one.</p>\n\n<p>Your function, on the other hand is needs 1ms compared to the previous 1\u00b5s. For 100 times the data 1000 times the time. Oh oh\u2026</p>\n\n<h2>Random text with 10000 characters</h2>\n\n<pre><code>benchmarking 10000/textToVec\ntime                 190.9 ms   (188.7 ms .. 192.8 ms)\n                     1.000 R\u00b2   (1.000 R\u00b2 .. 1.000 R\u00b2)\nmean                 192.5 ms   (191.8 ms .. 193.6 ms)\nstd dev              1.096 ms   (684.4 us .. 1.426 ms)\nvariance introduced by outliers: 14% (moderately inflated)\n\nbenchmarking 10000/T.foldr (flip V.snoc) V.empty For a \ntime                 859.3 ms   (856.5 ms .. 860.9 ms)\n                     1.000 R\u00b2   (1.000 R\u00b2 .. 1.000 R\u00b2)\nmean                 861.9 ms   (860.7 ms .. 862.6 ms)\nstd dev              1.042 ms   (0.0 s .. 1.173 ms)\nvariance introduced by outliers: 19% (moderately inflated)\n\nbenchmarking 10000/V.fromList . T.unpack\ntime                 567.8 us   (565.5 us .. 570.6 us)\n                     1.000 R\u00b2   (1.000 R\u00b2 .. 1.000 R\u00b2)\nmean                 571.7 us   (569.8 us .. 574.0 us)\nstd dev              7.132 us   (5.674 us .. 9.545 us)\n\nbenchmarking 10000/V.unfoldr T.uncons\ntime                 200.6 us   (199.4 us .. 201.8 us)\n                     1.000 R\u00b2   (1.000 R\u00b2 .. 1.000 R\u00b2)\nmean                 200.2 us   (199.4 us .. 201.2 us)\nstd dev              2.948 us   (2.240 us .. 3.837 us)\n</code></pre>\n\n<p>We increased the data size by factor 10. Your function takes 200 times the time, compared to the previous run, whereas both unfoldr and <code>fromList</code> take only 20 times the time.</p>\n\n<h1>The winner</h1>\n\n<p>According to the benchmarks, <code>V.unfoldr T.uncons</code> takes the cake. So how would you, as a Haskell newbie, find that function?</p>\n\n<p>Well, it's not that obvious at first. The \"obvious\" approach is usually to use a list, since they're everywhere in Haskell, and to be honest, <code>V.fromList . T.unpack</code> seems to work quite well. Also, that trick works for every data structure that provides a <code>fromList</code> (as target) or <code>toList (as source). Therefore, it works for any</code>Foldable<code>instance (</code>Text` isn't one).</p>\n\n<p>You <em>could</em> have found that if you looked into the documentation and saw the type of both <code>V.unfoldr</code> and <code>T.uncons</code> at the same time:</p>\n\n<pre><code>V.unfoldr :: (b      -&gt; Maybe (a   , b     )) -&gt; b      -&gt; V.Vector a\nT.uncons  ::  T.Text -&gt; Maybe (Char, T.Text)\nV.unfoldr T.uncons ::                            T.Text -&gt; V.Vector Char\n</code></pre>\n\n<p>But now you know that there's the unfoldr/uncons pattern, so you know how to use it in the future.</p>\n"}], "owner": {"reputation": 6779, "user_id": 1342941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a77b35477fab1e681d7e14f7ea78b178?s=128&d=identicon&r=PG", "display_name": "happydave", "link": "https://stackoverflow.com/users/1342941/happydave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 41378682, "answer_count": 1, "score": 5, "last_activity_date": 1483010449, "creation_date": 1482970686, "question_id": 41371547, "link": "https://stackoverflow.com/questions/41371547/map-from-one-data-structure-to-another", "title": "Map from one data structure to another", "body": "<p>Apologies for what seems like a basic question.  I'm trying to figure out how to convert a Data.Text into a vector of Char.  The best I could come up with is this:</p>\n\n<pre><code>textToVec :: T.Text -&gt; V.Vector Char\ntextToVec t = T.foldr append V.empty t where\n   append c vec = V.snoc vec c\n</code></pre>\n\n<p>This seems somewhat complicated (and computationally inefficient?)  Is there a better way?</p>\n\n<p>More generally, as a Haskell newbie, I'd appreciate any advice on how to go about figuring out this sort of thing for myself.  I wasn't able to make much progress from either Google or searching through the documentation.</p>\n"}]