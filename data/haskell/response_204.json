[{"tags": ["haskell", "tree", "hashmap"], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 5, "creation_date": 1544057723, "post_id": 53641708, "comment_id": 94145363, "body": "Good educational answer.  I&#39;d also like to mention there are more natural prefix tree (trie) implementations available in Haskell if you look around.  They&#39;re  handy for direct use as well as education."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 10, "last_activity_date": 1544087650, "last_edit_date": 1544087650, "creation_date": 1544048739, "answer_id": 53641708, "question_id": 53641558, "link": "https://stackoverflow.com/questions/53641558/haskell-recursive-hashmap-data-structure-of-arbitrary-depth/53641708#53641708", "title": "Haskell Recursive HashMap data structure of arbitrary depth", "body": "<p>This is basically an infinite type. <code>Map Char (Int, Map Char (Int, Map Char (... \u00bf()?)...)))</code> is what the type synonym would have to unroll, to allow the stuff you're doing in Python.</p>\n\n<p>Haskell doesn't allow infinite types per se, but it does allow you to create the <em>structure</em> of such a type. For this, it's not sufficient to make a type synonym, you need a <em>newtype</em>, which in this case means to the compiler \u201cI shouldn't bother recursing this, it's a known, distinguishable type that has already been checked\u201d.</p>\n\n<pre><code>newtype NestedHashMap k v = NestedHashMap  -- N.B. the `v` argument is unused\n   { getNestedHashMap :: HashMap k (Int, NestedHashMap k v) }\n\ntoNestedHashMap :: String -&gt; NestedHashMap Char ()\ntoNestedHashMap [] = NestedHashMap $ fromList []\ntoNestedHashMap (x:xs) = NestedHashMap $ fromList [(x, (1, toNestedHashMap xs))]\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 7550776, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-49UH8_rzfPw/AAAAAAAAAAI/AAAAAAAACmI/-8or_tW48Pw/photo.jpg?sz=128", "display_name": "Eirik Narjord", "link": "https://stackoverflow.com/users/7550776/eirik-narjord"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 1, "accepted_answer_id": 53641708, "answer_count": 1, "score": 5, "last_activity_date": 1544087650, "creation_date": 1544048009, "last_edit_date": 1544051166, "question_id": 53641558, "link": "https://stackoverflow.com/questions/53641558/haskell-recursive-hashmap-data-structure-of-arbitrary-depth", "title": "Haskell Recursive HashMap data structure of arbitrary depth", "body": "<p>With this Python function:</p>\n\n<pre><code>def mut_add_to_tree(text, tree):\n    tree_ = tree\n    for i, c in enumerate(text):\n        if c in tree_:\n            tree_[c][0] += 1\n            tree_ = tree_[c][1]\n        else:\n            for c_ in text[i:]:\n                tree_[c_] = [1, {}]\n                tree_ = tree_[c_][1]\n            break\n</code></pre>\n\n<p>is created a data structure of nested dicts like this:</p>\n\n<pre><code>In [15]: tree = {}                                                                             \n\nIn [16]: mut_add_to_tree(\"cat\", tree)                                                          \n\nIn [17]: tree                                                                                  \nOut[17]: {'c': [1, {'a': [1, {'t': [1, {}]}]}]}\n\nIn [18]: mut_add_to_tree(\"car\", tree)                                                          \n\nIn [19]: tree                                                                                  \nOut[19]: {'c': [2, {'a': [2, {'t': [1, {}], 'r': [1, {}]}]}]}\n\nIn [20]: mut_add_to_tree(\"bat\", tree)                                                          \n\nIn [21]: tree                                                                                  \nOut[21]: \n{'c': [2, {'a': [2, {'t': [1, {}], 'r': [1, {}]}]}],\n 'b': [1, {'a': [1, {'t': [1, {}]}]}]}\n\nIn [22]: mut_add_to_tree(\"bar\", tree)                                                          \n\nIn [23]: tree                                                                                  \nOut[23]: \n{'c': [2, {'a': [2, {'t': [1, {}], 'r': [1, {}]}]}],\n 'b': [2, {'a': [2, {'t': [1, {}], 'r': [1, {}]}]}]}\n</code></pre>\n\n<p>How can this behaviour be replicated in Haskell?\nMore generally, how are nested HashMaps of arbitrary depth created and inserted into?</p>\n\n<p>I've experimented with the following:</p>\n\n<pre><code>type NestedHashMap k v = HashMap Char (Int,(HashMap Char v))\n\ntoNestedHashMap :: String -&gt; HashMap Char (Int, HashMap Char v)\ntoNestedHashMap [] = fromList []\ntoNestedHashMap (x:xs) = fromList [(x, (1, toNestedHashMap xs))]\n</code></pre>\n\n<p>but already here the compiler tells me</p>\n\n<pre><code>Couldn't match type \u2018v\u2019 with \u2018(Int, HashMap Char v0)\u2019\n      \u2018v\u2019 is a rigid type variable bound by\n        the type signature for:\n          toNestedHashMap :: forall v.\n                             String -&gt; HashMap Char (Int, HashMap Char v)\n        at WordFuncs.hs:48:1-63\n      Expected type: HashMap Char (Int, HashMap Char v)\n        Actual type: HashMap\n                       Char (Int, HashMap Char (Int, HashMap Char v0))\n</code></pre>\n\n<p>Any help appreciated. Thanks.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1544032823, "post_id": 53638120, "comment_id": 94135985, "body": "What&#39;s the error message?"}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 1, "creation_date": 1544034731, "post_id": 53638120, "comment_id": 94136898, "body": "FYI: <code>import Data.List (partition)</code> then <code>partition even [1..10]</code> does the same."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1544038270, "post_id": 53638120, "comment_id": 94138410, "body": "Note that the <code>otherwise</code> is only necessary to avoid a warning with <code>-Wall</code>; <code>x `mod` 2</code> is either 0 or it isn&#39;t, so the <code>otherwise</code> guard will never be used."}], "answers": [{"tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": true, "score": 4, "last_activity_date": 1544032999, "creation_date": 1544032999, "answer_id": 53638215, "question_id": 53638120, "link": "https://stackoverflow.com/questions/53638120/separate-even-and-odd-elements-of-list-haskell/53638215#53638215", "title": "separate even and odd elements of list haskell", "body": "<p>The operator<code>++</code> is used to concatenate 2 lists and neither of your arguments to <code>++</code> is a list,</p>\n\n<pre><code>([x],[]) ++ sepList xs\n</code></pre>\n\n<p>both <code>([x],[])</code> and <code>sepList xs</code> are pairs of lists. So what you want is to pattern match on <code>sepList xs</code> e.g. using a <code>let</code> binding, </p>\n\n<pre><code>let (ys,zs) = sepList xs in\n</code></pre>\n\n<p>and then return,</p>\n\n<pre><code>(x:ys,zs)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 4, "last_activity_date": 1544033016, "creation_date": 1544033016, "answer_id": 53638219, "question_id": 53638120, "link": "https://stackoverflow.com/questions/53638120/separate-even-and-odd-elements-of-list-haskell/53638219#53638219", "title": "separate even and odd elements of list haskell", "body": "<p>You aren't concatenating two lists; you want to add a single element <em>to</em> a list, selected from the tuple output of the recursive call. Don't use <code>(++)</code>; use <code>(:)</code>.</p>\n\n<pre><code>sepList (x:xs) = let (evens, odds) = sepList xs\n                 in if even x \n                    then (x:evens, odds)\n                    else (evens, x:odds)\n</code></pre>\n\n<p>More simply, though, <code>sepList = partition even</code>. (<code>partition</code> can be found in <code>Data.List</code>.)</p>\n"}, {"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1544037842, "post_id": 53639074, "comment_id": 94138233, "body": "Isn&#39;t there a slight issue with thunks piling up by using <code>[x] &lt;&gt; stuff</code> instead of <code>x:stuff</code>?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1544045492, "post_id": 53639074, "comment_id": 94141654, "body": "We&#39;re building it like  <code>([x] &lt;&gt; ([y] &lt;&gt; ([z] &lt;&gt; [])))</code>, right? When the left list is short, that immediately resolves into <code>(x : ([] &lt;&gt; (...)))</code>, so I think it should be basically the same, besides the one wasted pattern-match to handle <code>[]</code>. Am I missing something?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1544045530, "post_id": 53639074, "comment_id": 94141670, "body": "@chepner, I don&#39;t think that should be a significant problem. But I think the strictness of <code>&lt;&gt;</code> for pairs will be problematic if the list is very long. You could patch that up with <code>(a,b) &lt;&gt; (fst cd, snd cd)</code>, but by then you have a mess."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1544046643, "post_id": 53639074, "comment_id": 94142116, "body": "@amalloy No, I just don&#39;t have a good feel for what is and is not a space leak. @dfeuer Why would it be problematic? (I&#39;m not being rhetorical; I&#39;m just missing the subtleties involved here.) Where did <code>cd</code> come from, are you assuming <code>(a,b) &lt;&gt; cd</code>, so you want to delay <code>a&lt;&gt;c</code> (or rather, <code>a &lt;&gt; fst cd</code>) until you actually traverse the list of tuples?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1544047278, "post_id": 53639074, "comment_id": 94142323, "body": "@chepner, <code>cd</code> is the result of the recursive call. We don&#39;t want to perform it until we need to. <code>partition even (repeat 0) = (repeat 0, _|_)</code>, <code>partition even (repeat 1) = (_|_, repeat 1)</code>, and <code>partition even [1..] = ([0,2..], [1,3..])</code>."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1544116601, "post_id": 53639074, "comment_id": 94171469, "body": "@dfeuer why was <code>&lt;&gt;</code> made strict in the instance for tuples? it seems like a pretty bad  idea... there&#39;s strict tuples if people want to use them."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1544121171, "post_id": 53639074, "comment_id": 94173627, "body": "@JorgeAdriano, it&#39;s not strict in their contents; only in their structure. I think the definition is pretty natural as it is, but there&#39;s often tension like this in tuple instances. For example, <code>fmap</code> is strict (obeying <code>fmap id = id</code>) while <code>bimap</code> is lazy (obeying the weaker <code>bimap id id &gt;= id</code>)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1544122018, "post_id": 53639074, "comment_id": 94173972, "body": "@JorgeAdriano, for whatever it&#39;s worth, I tend to prefer the stricter instances for tuples while Ed Kmett tends to prefer the lazier ones. I stand on the laws, and the fact that I generally want to be explicit about where I&#39;m relying on laziness. Ed goes by the fact that it&#39;s easier and more convenient to strictify these particular things than to lazify them. There&#39;s no one right answer that will satisfy everyone, which is a bit sad."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1544122049, "post_id": 53639074, "comment_id": 94173986, "body": "@dfeuer I understand it&#39;s just HNF.  But not only will  <code>p &lt;&gt; \u22a5</code> fail needlessly, for any  <code>p &lt;&gt; q</code> reducing <code>q</code> to HNF means performing some computation that may not be needed. Now consider a <code>foldr (&lt;&gt;)</code>. Regarding the definition being natural, difference would just be the <code>~</code> in the pattern matching..."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1544122323, "post_id": 53639074, "comment_id": 94174100, "body": "@JorgeAdriano, for <code>&lt;&gt;</code>, you may be right, specifically <i>because</i> it&#39;s only HNF anyway. For non-degenerate underlying <code>Semigroup</code> instances you likely only lose a constant factor in space complexity. But hidden laziness tends to put me off."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1544122370, "post_id": 53639074, "comment_id": 94174120, "body": "@dfeuer nevermind what I said about &quot;strict tuples&quot; before though, indeed that is irrelevant here. But yes the point is, you can easily indicate when you want strictness. But if the operators are strict the reverse is much more complicated. Furthermore the language is lazy by default, it seems to be swimming against the tide and adding needless confusion."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1544122736, "post_id": 53639074, "comment_id": 94174287, "body": "As JorgeAdriano, the language has lazy bindings and lazy function application, but strict pattern matching (except for <i>outermost</i> patterns in pattern bindings, which I consider a design flaw). On this spectrum, you follow ekmett and I follow tibbe; there are plenty of heavyweights to agree with each of us."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1544123254, "post_id": 53639074, "comment_id": 94174506, "body": "That is a fair point, those design choices are inconsistent. This just reminded me of the the strictness &quot;bug&quot; that has <a href=\"https://wiki.haskell.org/Maintaining_laziness#Strict_pattern_matching_in_a_recursion\" rel=\"nofollow noreferrer\">affected <code>partition</code> in ghc`</a> before. The accidental strictness here has the same effect (makes it fail for streams). But you do raise a good point. There should be some convention in libraries though..."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 2, "last_activity_date": 1544036509, "creation_date": 1544036509, "answer_id": 53639074, "question_id": 53638120, "link": "https://stackoverflow.com/questions/53638120/separate-even-and-odd-elements-of-list-haskell/53639074#53639074", "title": "separate even and odd elements of list haskell", "body": "<p>There are two answers so far which suggest basically doing this by hand (by pattern-matching on the result of the recursive call), but there is actually an operator already defined for the types that you're working with that does exactly what you want! Lists form a monoid with <code>(&lt;&gt;) = (++)</code>, but you don't have two lists: you have two <em>pairs</em> of lists. Happily, the type of pairs are also a monoid if each element of the pair is a monoid: <code>(a,b) &lt;&gt; (c,d) = (a &lt;&gt; c, b &lt;&gt; d)</code>. So, you can simply replace your <code>++</code> call with <code>&lt;&gt;</code>, which will result in concatenating the corresponding lists in your pairs.</p>\n"}, {"tags": [], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1544047017, "last_edit_date": 1544047017, "creation_date": 1544046711, "answer_id": 53641301, "question_id": 53638120, "link": "https://stackoverflow.com/questions/53638120/separate-even-and-odd-elements-of-list-haskell/53641301#53641301", "title": "separate even and odd elements of list haskell", "body": "<p>In this case i would use an <code>accumulator</code> to create the tuple containing the two lists.In our case the <code>accumulator</code> is <code>([],[])</code>.</p>\n\n<pre><code>split::[Int]-&gt;([Int],[Int])\nsplit ls= go  ([],[]) ls where \n   go accu [] = accu\n   go (odd,even) (x:xs) | x `mod` 2==0 = go (x:odd,even) xs\n                        | otherwise = go (odd, x:even) xs\n</code></pre>\n\n<p>As you can see the elements need to be reversed since we are pushing on top of our lists with the <code>:</code> operator.</p>\n\n<p>I do not know if this is optimal but i would write it like this with <code>reverse</code>:</p>\n\n<pre><code>module Split where\nsplit::[Int]-&gt;([Int],[Int])\nsplit ls=let rev tupl=(reverse . fst $ tupl ,reverse .snd $ tupl) in \n             rev $  go ([],[]) ls where \n                    go accu [] = accu\n                    go (odd,even) (x:xs) | x `mod` 2==0 = go (x:odd,even) xs\n                                         | otherwise = go (odd, x:even) xs \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3063, "user_id": 439578, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e032fbe640b2234c8dce244907b99eab?s=128&d=identicon&r=PG", "display_name": "Manoj R", "link": "https://stackoverflow.com/users/439578/manoj-r"}, "is_accepted": false, "score": 1, "last_activity_date": 1544101814, "creation_date": 1544101814, "answer_id": 53652227, "question_id": 53638120, "link": "https://stackoverflow.com/questions/53638120/separate-even-and-odd-elements-of-list-haskell/53652227#53652227", "title": "separate even and odd elements of list haskell", "body": "<p>For enthusiasts, following one line will also work for separating list in even and odd.</p>\n\n<pre><code>sepList xs = (filter even xs , filter odd xs)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 321, "user_id": 10205083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1889fbfa86aa1d996e51f465b5f6ca4d?s=128&d=identicon&r=PG&f=1", "display_name": "steve", "link": "https://stackoverflow.com/users/10205083/steve"}, "is_accepted": false, "score": 1, "last_activity_date": 1544231507, "creation_date": 1544231507, "answer_id": 53678624, "question_id": 53638120, "link": "https://stackoverflow.com/questions/53638120/separate-even-and-odd-elements-of-list-haskell/53678624#53678624", "title": "separate even and odd elements of list haskell", "body": "<pre><code>  import Data.List\n\n  sepList :: [Int]-&gt;([Int],[Int])\n  sepList = partition even\n\n  sepList [1,2,3,4,10]\n</code></pre>\n"}], "owner": {"reputation": 123, "user_id": 7182154, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1116360391792657/picture?type=large", "display_name": "Muhammad Usman", "link": "https://stackoverflow.com/users/7182154/muhammad-usman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1075, "favorite_count": 0, "accepted_answer_id": 53638215, "answer_count": 6, "score": 0, "last_activity_date": 1544231507, "creation_date": 1544032621, "question_id": 53638120, "link": "https://stackoverflow.com/questions/53638120/separate-even-and-odd-elements-of-list-haskell", "title": "separate even and odd elements of list haskell", "body": "<p>I am trying to separate elements of a list into to further lists, one for the odd and one for even numbers.</p>\n\n<p>For Example,</p>\n\n<pre><code>input: [1,2,3,4,10]\noutput: ([2,4,10],[1,3])\n\nsepList :: [Int]-&gt;([Int],[Int])\nsepList [] = ([],[])\nsepList (x:xs) | (x mod 2) ==0 = (([x],[]) ++ sepList xs) \n               | (x mod 2) /=0 = (([],[x]) ++ sepList xs)\n               | otherwise = ([],[])\n</code></pre>\n\n<p>It gives error on <code>...++ sepList xs</code>\nanyone could guide me here?</p>\n"}, {"tags": ["haskell", "wxwidgets", "cabal"], "answers": [{"comments": [{"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1544079189, "post_id": 53640795, "comment_id": 94150557, "body": "Thanks Bob.. That is a useful answer. I figured as much. I do hope Haskell evolves into a professionally maintained platform. Ever since I started learning it, I started liking it more and more, but the libraries can be a frustrating bunch. It already led me to eg. create a new one for html output as a part of training myself, but driven by the in my opinion lack of a useful library."}, {"owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "reply_to_user": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1544104487, "post_id": 53640795, "comment_id": 94164208, "body": "I have made similar comments to those willing to listen to me about Haskell. Before that it was Python, Scala, Java, and even Perl. I am currently struggling through a Python nightmare, trying to get a mix of Python library versions that work together. All have gone through growing pains."}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1544118810, "post_id": 53640795, "comment_id": 94172629, "body": "Agree. Had it too with changing from ObjectiveC to Swift. All cool for apps, nightmare for OSX imo. Think it is a matter of time. I will abandon Wx and Gtk for now until something sensible comes along and concentrate on the browser as main UI. Still; got much to learn in terms of Haskell, so guess I will stumble upon better implementations eventually, or learn to build me own. Thanks Bob!"}, {"owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "reply_to_user": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1544120692, "post_id": 53640795, "comment_id": 94173419, "body": "I see an implementation of gtk-haskell that works on Mac OS X. I think I will try that soon."}], "tags": [], "owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "is_accepted": true, "score": 0, "last_activity_date": 1544044254, "creation_date": 1544044254, "answer_id": 53640795, "question_id": 53637475, "link": "https://stackoverflow.com/questions/53637475/cabal-install-wx-for-mac-os-failure/53640795#53640795", "title": "Cabal install Wx for mac-os failure", "body": "<p>Haskell grew out of the needs of a diverse group of researchers that needed a common functional language definition and implementation. Many of the researchers are actively involved in theory of programming languages and theory of functional programming, so they will extend or re-define the language to meet their needs. The ecosystem has a diverse set of libraries, many of which were not developed to the level of professionally-maintained software.</p>\n\n<p>That being said, with Haskell starting to reach acceptance with large corporations, there is a substantial push to get real with providing a language and a set of libraries that work together.</p>\n\n<p>The most concerted effort that I have seen is <a href=\"https://www.stackage.org/\" rel=\"nofollow noreferrer\">Haskell Stack</a>. They start with the <strong>stack</strong> tool, which is a package manager and build tool; it uses <strong>cabal</strong> for download and installation and (usually) <strong>ghc</strong> for compilation, as well as whatever build tools you have on your computer. Stack uses an <strong>lts</strong> (long-term support, I think) profile that identifies a set of package versions that are known to work with each other. You can tell stack to use a particular <em>lts</em> profile for your project, and it will maintain that as part of your build profile, even when you add specific packages.</p>\n\n<p>From your build output, you are trying to use the latest packages from hackage.haskell.org. Each package gets updated in its own time frame, quite separately from any other package. The stack approach is identify the packages that work together, which often means that older versions of the compiler might be required.</p>\n\n<p>As I remember, the latest Wx Haskell doesn't work on Mac OS X. There may be a stack lts profile that can be used to get Wx Haskell working on Mac OS X.</p>\n"}, {"comments": [{"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1564421413, "post_id": 57207521, "comment_id": 101016890, "body": "Thanks... I will give that a try somewhere soon."}], "tags": [], "owner": {"reputation": 31, "user_id": 11837676, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-O9T-g_RolSE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re04BQIUmBotE6Zyu32QfIj2KEp2w/photo.jpg?sz=128", "display_name": "Ivan Perez", "link": "https://stackoverflow.com/users/11837676/ivan-perez"}, "is_accepted": false, "score": 1, "last_activity_date": 1564128192, "last_edit_date": 1564128192, "creation_date": 1564076467, "answer_id": 57207521, "question_id": 53637475, "link": "https://stackoverflow.com/questions/53637475/cabal-install-wx-for-mac-os-failure/57207521#57207521", "title": "Cabal install Wx for mac-os failure", "body": "<p>Your installation is picking a very old version of wxcore (0.11), for reasons unknown to me.</p>\n\n<p>You have more modern versions on hackage, and also on the github repo:\n<a href=\"https://github.com/wxHaskell/wxHaskell/\" rel=\"nofollow noreferrer\">https://github.com/wxHaskell/wxHaskell/</a></p>\n\n<p>The version of github is the most up-to-date (0.93), which works well, for the most part, but you need to change the cc flags for darwin in wxcore:</p>\n\n<pre><code>-      cc-options: \"-stdlib=libstdc++\"\n+      cc-options: \"-stdlib=libc++\"\n</code></pre>\n\n<p>(I've sent an email to the mailing list to document this change, and asking that the version on hackage be updated.)</p>\n\n<p>Otherwise, I can confirm that wxHaskell compiles fine on a new mac and works. </p>\n"}], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 53640795, "answer_count": 2, "score": 1, "last_activity_date": 1564128192, "creation_date": 1544029998, "question_id": 53637475, "link": "https://stackoverflow.com/questions/53637475/cabal-install-wx-for-mac-os-failure", "title": "Cabal install Wx for mac-os failure", "body": "<p>I am developing a love/hate relationship with Haskell libraries. Really want to learn Haskell in depth no matter what, but the libraries are trying to discourage me most of the time (or encourage me to write me own, but I am not quite there yet). Wanted to try Wx for UI. Cabal starts all cheerful but ends with a message from hell. At least I think it is.</p>\n\n<pre><code>Downloading the latest package list from hackage.haskell.org\nclang: warning: argument unused during compilation: '-nopie' [-Wunused-command-line-argument]\nResolving dependencies...\nDownloading fgl-5.7.0.1...\nDownloading old-locale-1.0.0.7...\nConfiguring old-locale-1.0.0.7...\nDownloading stm-2.5.0.0...\nConfiguring fgl-5.7.0.1...\nConfiguring stm-2.5.0.0...\nBuilding old-locale-1.0.0.7...\nBuilding fgl-5.7.0.1...\nBuilding stm-2.5.0.0...\nInstalled old-locale-1.0.0.7\nDownloading old-time-1.1.0.3...\nConfiguring old-time-1.1.0.3...\nBuilding old-time-1.1.0.3...\nInstalled stm-2.5.0.0\nInstalled old-time-1.1.0.3\nDownloading wxcore-0.11.1.2...\nConfiguring wxcore-0.11.1.2...\nFailed to install wxcore-0.11.1.2\nBuild log ( /Users/administrator/.cabal/logs/ghc-8.4.3/wxcore-0.11.1.2-7WkQ04B76zVGNKKljmrN1g.log ):\ncabal: Entering directory '/var/folders/81/50s00bl11pv7fn8dw4n0w03m0000gn/T/cabal-tmp-1098/wxcore-0.11.1.2'\nerror: Unknown option \"--sysconfdir=/Users/administrator/Library/Haskell/etc\". Use \"--help\" to show valid options.\n\ncabal: Leaving directory '/var/folders/81/50s00bl11pv7fn8dw4n0w03m0000gn/T/cabal-tmp-1098/wxcore-0.11.1.2'\nInstalled fgl-5.7.0.1\nUpdating documentation index\n/Users/administrator/Library/Haskell/share/doc/x86_64-osx-ghc-8.4.3/index.html\ncabal: Error: some packages failed to install:\nwx-0.11.1.2-3RIijI82LEqAoB6cQuvIlr depends on wx-0.11.1.2 which failed to\ninstall.\nwxcore-0.11.1.2-7WkQ04B76zVGNKKljmrN1g failed during the configure step. The\nexception was:\nExitFailure 2\n</code></pre>\n\n<p>Any advise? Please don't say 'use Gtk' because that's even worse. Would be great if someone can help me out. Although the terminal is a safe place to reside, I want to eventually break out of it and discover the world. \"Hello world!\"</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1544006445, "post_id": 53629528, "comment_id": 94120164, "body": "I don&#39;t think the way you use <code>once</code> makes sense: you should not pass around the <code>IO (IO (Connection))</code> (that wouldn&#39;t actually memoise anything but always open a new connection), but rather evaluate it once and then pass around the <code>IO (Connection)</code>. But even that does, I think, not buy you anything over simply calling <code>connect</code> once and passing around the <code>Connection</code>. But I could be wrong here."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 2, "creation_date": 1544015716, "post_id": 53629528, "comment_id": 94125768, "body": "Your app needs state. The <code>Connection</code> should be part of that state."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1544017141, "post_id": 53629528, "comment_id": 94126618, "body": "<a href=\"https://www.fpcomplete.com/blog/2017/06/readert-design-pattern\" rel=\"nofollow noreferrer\">fpcomplete.com/blog/2017/06/readert-design-pattern</a> may be of use."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1544034021, "post_id": 53629528, "comment_id": 94136545, "body": "@leftaroundabout What <code>once</code> buys you is this: if you never actually need to use the <code>Connection</code>, it isn&#39;t even opened, so a run of your app that doesn&#39;t use the database never actually calls <code>connect</code>."}], "answers": [{"comments": [{"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1544091780, "post_id": 53638645, "comment_id": 94156702, "body": "the issue I have is that I&#39;m trying to to give the ability in my project to change the database (EventStore here) by using Interface segregation. This getCachedConnection is something specific only this database not for another one... I see how I can deal with it if I do an eDSL (which is hard so far because I&#39;m streaming things and the lib I&#39;m using has some missing features...) but this is something I can&#39;t express in an Interface because this connection data type is an EventStore data type..."}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1544091785, "post_id": 53638645, "comment_id": 94156708, "body": "In OOP I would have done a PersistedStreamSettings parameter (Map Key Object and use some subtyping polymorphism) but in Haskell I don&#39;t know what to do with this complex data type like this EventStore Connection one... I hope you can follow ... it&#39;s hard to explain my issue in a stackoverflow question..."}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1544095701, "post_id": 53638645, "comment_id": 94158965, "body": "and to make a confession, I knew that, what I was asking sounds fishy, like storing something in shared memory under the hood... but it is a tempting shortcut in my context... haskell is here to keep me in the right path lol \u2013"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 1, "creation_date": 1544103736, "post_id": 53638645, "comment_id": 94163742, "body": "@NicolasHenin If you can put in enough details to make the question answerable, I&#39;ll be happy to take a shot at it. Haskell program design is indeed a different beast than design in other languages in some ways."}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1544348294, "post_id": 53638645, "comment_id": 94238044, "body": "I&#39;ve found a solution by using type variables and it works perfectly, haskell is a beautiful beast :-)"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1544034766, "creation_date": 1544034766, "answer_id": 53638645, "question_id": 53629528, "link": "https://stackoverflow.com/questions/53629528/looking-for-a-cached-function-call-mechanism/53638645#53638645", "title": "looking for a cached function call mechanism", "body": "<blockquote>\n  <p>otherwise I'm obliged to keep that IO (IO (Connection)) as a \"global fct\" that I'm passing everywhere which is bad for modularity.</p>\n</blockquote>\n\n<p>Unfortunately, caching calls doesn't help eliminate function arguments: instead of passing around the result of a cached call, you must pass around the cache instead. There's no getting around it; part of the hair shirt you wear when choosing Haskell is that <em>all</em> the data a function wants to use must be made explicit in its type, so if part of your application needs a database <code>Connection</code>, there's nothing for it but to pass a <code>Connection</code> to that part of your application (and, by extension, all its callers).</p>\n\n<p>There is some sugar like <code>ReaderT</code> you can sprinkle around to make things a bit more convenient, making it appear as though you're not passing around function arguments, but at the end of the day that's exactly what they're doing under the hood.</p>\n\n<p>However, I reject your claim that this is bad for modularity. If you <em>did</em> have an implicit cache, this would <em>break</em> modularity: you would not be able to lift that function out of this application into a library and use it in many applications without <em>also</em> lifting the cache out. That is, the cache and any operations that use it become coupled -- one must lift them all or none, the exact opposite of modularity.* If the database connection is a function argument instead of an implicit cache, it can be lifted independently of lifting the chunk of code that creates the connection once at app startup.</p>\n\n<p>* And suppose you do lift out all the operations and the implicit cache into a library. Now two downstream libraries depend on and use yours; do you get two caches, that must be separately initialized and therefore is maybe less efficient, or do you get one shared cache which therefore bleeds effects from the one library into the other and therefore is maybe less correct? A difficult choice -- one that should have to be made carefully and explicitly by the downstream users, not by the library with the cache in it.</p>\n"}], "owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 53638645, "answer_count": 1, "score": 2, "last_activity_date": 1544034766, "creation_date": 1544003816, "question_id": 53629528, "link": "https://stackoverflow.com/questions/53629528/looking-for-a-cached-function-call-mechanism", "title": "looking for a cached function call mechanism", "body": "<p>I'm calling a database (<a href=\"http://hackage.haskell.org/package/eventstore\" rel=\"nofollow noreferrer\">EventStore</a>) that recommend using the same connection for the entire life span of your app. I want to implement a cached call for that, but the only thing I'm finding is memoization caching in that way (lib <a href=\"http://hackage.haskell.org/package/io-memoize\" rel=\"nofollow noreferrer\">io-memoize</a>) : </p>\n\n<pre><code>import Database.EventStore\nimport System.IO.Memoize\n\ngetCachedEventStoreConnection :: Settings -&gt; ConnectionType -&gt; IO (IO (Connection))\ngetCachedEventStoreConnection settings connectionType = once $ connect settings connectionType\n</code></pre>\n\n<p>What I would like is more a signature like that : </p>\n\n<p>getCachedEventStoreConnection :: Settings -> ConnectionType -> IO Connection</p>\n\n<p>otherwise I'm obliged to keep that IO (IO (Connection)) as a \"global fct\" that I'm passing everywhere which is bad for modularity...   </p>\n"}, {"tags": ["debugging", "haskell"], "comments": [{"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "edited": false, "score": 1, "creation_date": 1544000273, "post_id": 53628429, "comment_id": 94116621, "body": "Please share the relevant code"}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 2, "creation_date": 1544001180, "post_id": 53628429, "comment_id": 94117057, "body": "You could try using <code>Debug.Trace</code> for printf like debugging without needing to <code>IO</code> everything."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1544001255, "post_id": 53628429, "comment_id": 94117102, "body": "I have added the code..but i don&#39;t think it helps ."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 1, "creation_date": 1544001825, "post_id": 53628429, "comment_id": 94117392, "body": "Your code is difficult to read because the formatting is difficult and inconsistent; you have lots of functions that don\u2019t seem to make sense; incomplete instances; and it is so disorganised that it is not clear what is supposed to happen. I don\u2019t see an obvious place where you get the error. Another thing you could try is running/testing small parts in ghci."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1544001961, "post_id": 53628429, "comment_id": 94117480, "body": "I have mentioned just a mehtod of the instance , the one that matters.Sorry for the indentation i will clean it."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1544016908, "post_id": 53628429, "comment_id": 94126473, "body": "You don&#39;t need to define <code>&gt;&gt;?</code>; you can use <code>&gt;&gt;=</code> directly."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1544021828, "post_id": 53628429, "comment_id": 94129688, "body": "To debug this kind of thing, other than staring at the code, one thing you can do is compile with <code>-prof -fprof-auto -rtsopts</code>, and run your program with the cmd line options <code>+RTS -xc</code>. This should print a trace when the <code>&lt;&lt;loop&gt;&gt;</code> exception is raised (or if the program loops instead, when you kill it (Ctrl+C)). See the GHC manual <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/runtime_control.html#rts-flag--xc\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/latest/docs/html/users_guide/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 8, "last_activity_date": 1544021912, "last_edit_date": 1544021912, "creation_date": 1544012628, "answer_id": 53632257, "question_id": 53628429, "link": "https://stackoverflow.com/questions/53628429/debugging-loop-error-message-in-haskell/53632257#53632257", "title": "Debugging &lt;&lt;loop&gt;&gt; error message in haskell", "body": "<p>In the <code>TextEncode Readme</code> instance, <code>len</code> and <code>dat</code> depend on each other:</p>\n\n<pre><code>instance TextEncode Readme where\n    fromText txt =let len= length dat\n                      dat= case len of \n</code></pre>\n\n<hr>\n\n<p>To debug this kind of thing, other than staring at the code, one thing you can do is compile with <code>-prof -fprof-auto -rtsopts</code>, and run your program with the cmd line options <code>+RTS -xc</code>. This should print a trace when the <code>&lt;&lt;loop&gt;&gt;</code> exception is raised (or if the program loops instead, when you kill it (Ctrl+C)). See the GHC manual <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/runtime_control.html#rts-flag--xc\" rel=\"noreferrer\">https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/runtime_control.html#rts-flag--xc</a></p>\n"}, {"tags": [], "owner": {"reputation": 1141, "user_id": 1367497, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c1ab83696683e53a9940cd2a8c480894?s=128&d=identicon&r=PG", "display_name": "peeyush singh", "link": "https://stackoverflow.com/users/1367497/peeyush-singh"}, "is_accepted": false, "score": 2, "last_activity_date": 1544249646, "last_edit_date": 1544249646, "creation_date": 1544247913, "answer_id": 53679903, "question_id": 53628429, "link": "https://stackoverflow.com/questions/53628429/debugging-loop-error-message-in-haskell/53679903#53679903", "title": "Debugging &lt;&lt;loop&gt;&gt; error message in haskell", "body": "<p>As Li-yao Xia  said part of the problem is the infinite recursion, but if you tried the following code, then the problem still remains.</p>\n\n<pre><code>instance TextEncode Readme where\n    fromText txt =let len= length [1,2,3,4,5,6] --dat\n                      dat= case len of \n</code></pre>\n\n<p>The second issue is that the file contains decimal numbers but all the conversion function are expecting <code>Maybe Int</code>, changing the definitions of the following functions should give the expected results, on the other hand probably the correct fix is that the file should have integers and not decimal numbers.</p>\n\n<pre><code>readData::Text-&gt;[Double]\n--readData xs = [1,2,3,4,5,6,6]\nreadData =catMaybes . maybeValues where\n    maybeValues = mvalues . split . filterText \"{}\"\n\n--all the methods under this line  are used in the above method\n\nmvalues::[Text]-&gt;[Maybe Double]\nmvalues arr=map (\\x-&gt;(readMaybe::String-&gt;Maybe Double).unpack $ x) arr\n\ndata Readme=Readme{ maxClients::Double, minClients::Double,stepClients::Double,maxDelay::Double,minDelay::Double,stepDelay::Double}deriving(Show)\n</code></pre>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 244, "favorite_count": 0, "accepted_answer_id": 53632257, "answer_count": 2, "score": 0, "last_activity_date": 1544249646, "creation_date": 1544000061, "last_edit_date": 1544002709, "question_id": 53628429, "link": "https://stackoverflow.com/questions/53628429/debugging-loop-error-message-in-haskell", "title": "Debugging &lt;&lt;loop&gt;&gt; error message in haskell", "body": "<p>Hello i am encountering this error message in a Haskell program and i do not know where is the loop coming from.There are almost no <code>IO</code> methods so that i can hook myself to them and print the partial result in the terminal.</p>\n\n<p>I start with a file , i read it and then there are only pure methods.How can i debug this ?</p>\n\n<p>Is there a way to attach to methods or create a helper that can do the following:</p>\n\n<p>Having a method <code>method::a-&gt;b</code> how can i somehow wrap it in a <code>iomethod::(a-&gt;b)-&gt;IO (a-&gt;b)</code> to be able to test in in <code>GHCI</code> (i want to insert some <code>putStrLn</code>-s etc ?</p>\n\n<p><strong>P.S</strong> My data suffer transformations <code>IO a(-&gt;b-&gt;c-&gt;d-&gt;......)-&gt;IO x</code> and i do not know how to debug the part that is in the parathesis (that is the code that contains the pure methods)</p>\n\n<p><strong>Types and typeclass definitions and implementations</strong></p>\n\n<pre><code>data TCPFile=Rfile (Maybe Readme) | Dfile  Samples | Empty\ndata Header=Header { ftype::Char}\n\nnewtype Samples=Samples{values::[Maybe Double]}deriving(Show)\n\ndata Readme=Readme{ maxClients::Int, minClients::Int,stepClients::Int,maxDelay::Int,minDelay::Int,stepDelay::Int}deriving(Show)\n\ndata FileData=FileData{ header::Header,rawContent::Text}\n\n(&gt;&gt;?)::Maybe a-&gt;(a-&gt;Maybe b)-&gt;Maybe b\n(Just t) &gt;&gt;? f=f t\nNothing &gt;&gt;? _=Nothing\n\nclass TextEncode a where\nfromText::Text-&gt; a\n\n\ngetHeader::TCPFile-&gt;Header\ngetHeader (Rfile _ ) = Header { ftype='r'}\ngetHeader (Dfile _ )= Header{ftype='d'}\ngetHeader _ = Header {ftype='e'}\n\n\ninstance Show TCPFile where\nshow (Rfile t)=\"Rfile \" ++\"{\"++content++\"}\" where\n    content=case t of\n        Nothing-&gt;\"\"\n        Just c -&gt; show c\nshow (Dfile c)=\"Dfile \" ++\"{\"++show c ++ \"}\"\n\ninstance TextEncode Samples where\n    fromText text=Samples  (map (readMaybe.unpack) cols) where\n             cols=splitOn (pack \",\") text\n\n\n\ninstance TextEncode Readme where\n    fromText txt =let len= length dat\n                      dat= case len of \n                            6 -&gt;Prelude.take 6 .readData $ txt\n                            _ -&gt;[0,0,0,0,0,0] in \n            Readme{maxClients=Prelude.head dat,minClients=dat!!1,stepClients=dat!!2,maxDelay=dat!!3,minDelay=dat!!4,stepDelay=dat!!5} where\n\n\n\n\ninstance TextEncode TCPFile where\n    fromText  = textToFile\n</code></pre>\n\n<p><strong>Main</strong></p>\n\n<pre><code>module Main where \nimport Data.Text(Text,pack,unpack)\nimport Data.Text.IO(readFile,writeFile)\nimport TCPFile(TCPFile)\n\nmain::IO()\nmain=do\n    dat&lt;-readTcpFile \"test.txt\"\n    print dat\n\nreadTcpFile::FilePath-&gt;IO TCPFile\nreadTcpFile path =fromText &lt;$&gt; Data.Text.IO.readFile path  \n\ntextToFile::Text-&gt;TCPFile\ntextToFile input=case readHeader input &gt;&gt;? (\\h -&gt; Just (FileData h input)) &gt;&gt;?  makeFile of\n    Just r -&gt; r\n    Nothing -&gt;Empty\n\n\n\nreadHeader::Text-&gt;Maybe Header\nreadHeader txt=case Data.Text.head txt of \n    'r' -&gt;Just (Header{ ftype='r'})\n    'd' -&gt;Just (Header {ftype ='d'})\n    _  -&gt; Nothing\n\nmakeFile::FileData-&gt;Maybe TCPFile\nmakeFile fd= case ftype.header $ fd of\n        'r'-&gt;Just (Rfile (Just (fromText . rawContent $ fd)))\n        'd'-&gt;Just (Dfile (fromText . rawContent $ fd))\n        _  -&gt;Nothing \n\n\nreadData::Text-&gt;[Int]\nreadData =catMaybes . maybeValues where\n    maybeValues=mvalues.split.filterText \"{}\"\n\n#all the methods under this line  are used in the above method\n\nmvalues::[Text]-&gt;[Maybe Int]\nmvalues arr=map (\\x-&gt;(readMaybe::String-&gt;Maybe Int).unpack $ x) arr\n\nsplit::Text-&gt;[Text]\nsplit =splitOn (pack \",\")\n\nfilterText::[Char]-&gt;Text-&gt;Text\nfilterText chars tx=Data.Text.filter (\\x -&gt; not (x `elem` chars)) tx\n</code></pre>\n\n<p>I want first to clean the <code>Text</code> from given characters , in our case <code>}{</code> then split it by <code>,</code>.After the text is split by commas i want to parse them, and create either a <code>Rfile</code> which contains <code>6</code> integers , either a <code>Dfile</code> (datafile) which contains any given number of integers.</p>\n\n<p><strong>Input</strong>\nI have a file with the following content: <code>r,1.22,3.45,6.66,5.55,6.33,2.32}</code> and i am running <code>runghc main 2&gt;err.hs</code></p>\n\n<p><strong>Expected Output</strong> : <code>Rfile (Just (Readme 1.22 3.45 6.66 5.55 6.33 2.32))</code></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1543974121, "post_id": 53623869, "comment_id": 94108210, "body": "Okay, cool, you&#39;ve told us what you want to do. What&#39;s stopping you from doing it that we can help with?"}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1543974217, "post_id": 53623869, "comment_id": 94108230, "body": "<code>listitem n ls = if n == 1 then head ls else listitem (n-1) (tail ls)</code> will produce any item from a list, like <code>listitem 2 [3,6,9,12]</code> yields 6"}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1543975144, "post_id": 53623869, "comment_id": 94108434, "body": "Create a function to get only the second item <code>get2nd = listitem 2</code> then <code>get2nd &quot;abcdef&quot;</code> yields <code>&#39;b&#39;</code>"}], "answers": [{"comments": [{"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1543974610, "post_id": 53623952, "comment_id": 94108315, "body": "<code>first [] = first [0,0]; first [x] = first [x,x]; first [x,y] = y; first (x:y:z:xs) = first (x:y:xs)</code>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 1, "creation_date": 1544018599, "post_id": 53623952, "comment_id": 94127454, "body": "@JorgeAdriano Perhaps it goes without saying, but that would be pretty slow on a long list, as you need <code>n-2</code> recursive calls before you finally get to a list of size 2."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1544021559, "post_id": 53623952, "comment_id": 94129484, "body": "@chepner I know :) just kidding, I mean there&#39;s no point in making this recursive in the first place, so at least making it O(n) on list length feels more like &quot;true recursion&quot; than O(1). Doesn&#39;t work for infinite lists though."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1544021830, "post_id": 53623952, "comment_id": 94129693, "body": "bradm&#39;s answer is a perfectly fine recursive (ok, corecursive, but it could be made recursive) function."}, {"owner": {"reputation": 1205, "user_id": 3933052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8hg4k.jpg?s=128&g=1", "display_name": "godot", "link": "https://stackoverflow.com/users/3933052/godot"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1544021974, "post_id": 53623952, "comment_id": 94129781, "body": "@chepner: depends what you mean by &quot;perfectly fine&quot;, as an exercice yes, but would you ever implement such a procedure recursively for a real case? NB : at JorgeAdriano: yes that&#39;s a good one!"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1544022621, "post_id": 53623952, "comment_id": 94130214, "body": "@godot No, but it does generalize to arbitrary <code>n</code> other than 2 with minimal effort."}], "tags": [], "owner": {"reputation": 1205, "user_id": 3933052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8hg4k.jpg?s=128&g=1", "display_name": "godot", "link": "https://stackoverflow.com/users/3933052/godot"}, "is_accepted": true, "score": 1, "last_activity_date": 1543974107, "creation_date": 1543974107, "answer_id": 53623952, "question_id": 53623869, "link": "https://stackoverflow.com/questions/53623869/find-second-element-of-array-through-recursion-haskell/53623952#53623952", "title": "find second element of array through recursion Haskell", "body": "<p>Not really a \u00ab\u00a0natural\u00a0\u00bb case for recursion but you could write this if you absolutely want recursion...</p>\n\n<pre><code>first :: [Int] -&gt; Int\nfirst []= 0                                                                                                                                        \nfirst [x] =x\nfirst (x:x1:xs) = first [x1]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1544018940, "post_id": 53623981, "comment_id": 94127638, "body": "Those should have <code>go _ [] = Nothing</code>, not <code>go 2 [] = Nothing</code>; I think that makes the case analysis exhaustive."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1544019288, "post_id": 53623981, "comment_id": 94127885, "body": "Also, <code>go 1 (x:_) = Just x</code>."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1544046643, "post_id": 53623981, "comment_id": 94142115, "body": "@chepner Good point about the exhaustive case analysis - I&#39;ll edit it in. Also, as for <code>go 1 (x:_)</code>, usually I would do that, but the question specifically asked about recursion, so I thought I would do it in a recursive way - note that <code>i</code> increases until it reaches <code>2</code>, at which point it returns the current element."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1544046797, "post_id": 53623981, "comment_id": 94142164, "body": "But since you&#39;re starting at 0, by the time you get to <code>go 2</code>, you&#39;ll have already discarded two elements, and <code>x</code> will bind to the third. <code>go 0 &quot;abc&quot; == go 1 &quot;bc&quot; == go 2 &quot;c&quot; == &quot;c&quot;</code>."}], "tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": false, "score": 3, "last_activity_date": 1544054758, "last_edit_date": 1544054758, "creation_date": 1543974291, "answer_id": 53623981, "question_id": 53623869, "link": "https://stackoverflow.com/questions/53623869/find-second-element-of-array-through-recursion-haskell/53623981#53623981", "title": "find second element of array through recursion Haskell", "body": "<p>Good question! The typical way to do this through recursion is to use turn your function into a thin wrapper around a recursive function with an extra argument (typically called <code>go</code>):</p>\n\n<pre><code>first :: [Int] -&gt; Int\nfirst list = go 0 list\n  where\n    go        1 (x:_)  = x\n    go curIndex (x:xs) = go (curIndex+1) xs\n    go        _ []     = 0\n</code></pre>\n\n<p>However, Haskell uses currying, so the definition of <code>first</code> can be slightly simplified to <code>first = go 0</code>.</p>\n\n<p>Another change I would recommend is to use the <code>Maybe</code> type from the Prelude:</p>\n\n<pre><code>data Maybe a = Just a | Nothing\n</code></pre>\n\n<p>That is, a value of type <code>Maybe Int</code> can be either a <code>Just</code> value containing an <code>Int</code>, or it can be a <code>Nothing</code> value containing no <code>Int</code>. Typically this type is used in situations where a computation can either succeed or fail - such as this function! So it can be changed now to the following:</p>\n\n<pre><code>first :: [Int] -&gt; Maybe Int\nfirst = go 0\n  where\n    go        1 (x:_)  = Just x     -- returning the second value\n    go curIndex (x:xs) = go (curIndex+1) xs\n    go        _ []     = Nothing    -- returning Nothing if it doesn't exist\n</code></pre>\n\n<p>And now we can change the type to make it more generic (and also shorten the name <code>curIndex</code> a bit) to give a final recursive answer. I've also changed the name to <code>second</code>, because that name reflects the function's purpose better (you're getting the <em>second</em> element, after all):</p>\n\n<pre><code>second :: [a] -&gt; Maybe a\nsecond = go 0\n  where\n    go 1 (x:_)  = Just x\n    go i (x:xs) = go (i+1) xs\n    go _ []     = Nothing\n</code></pre>\n"}], "owner": {"reputation": 123, "user_id": 7182154, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1116360391792657/picture?type=large", "display_name": "Muhammad Usman", "link": "https://stackoverflow.com/users/7182154/muhammad-usman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 311, "favorite_count": 0, "accepted_answer_id": 53623952, "answer_count": 2, "score": 0, "last_activity_date": 1544054758, "creation_date": 1543973367, "question_id": 53623869, "link": "https://stackoverflow.com/questions/53623869/find-second-element-of-array-through-recursion-haskell", "title": "find second element of array through recursion Haskell", "body": "<p>I have written the following code which returns the second element of the list.</p>\n\n<pre><code>first :: [Int] -&gt; Int\nfirst []= 0                                                                                                                                        \nfirst [x] =x\nfirst (x:x1:xs) = x1\n</code></pre>\n\n<p>It is working fine, but I want it to go through recursion, For Example, I keep on recursing the list as soon as it reaches the second number it gives our second number.</p>\n\n<p>Thank you very much.</p>\n"}, {"tags": ["function", "haskell", "average"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1543966505, "post_id": 53622803, "comment_id": 94106354, "body": "So, what did you find that looked close but not a perfect match? Why do you think it won&#39;t work for you? Many people here could just write a solution for you, but to help you learn it&#39;s important to see what you&#39;re thinking and what you&#39;ve tried."}, {"owner": {"reputation": 31, "user_id": 10703793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0ebf6120b8f1b8649b6778f122699fa?s=128&d=identicon&r=PG&f=1", "display_name": "MadeleineG", "link": "https://stackoverflow.com/users/10703793/madeleineg"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1543966550, "post_id": 53622803, "comment_id": 94106366, "body": "I have tried the following:  <a href=\"https://stackoverflow.com/questions/27199004/finding-mean-of-list-in-haskell\" title=\"finding mean of list in haskell\">stackoverflow.com/questions/27199004/&hellip;</a> <a href=\"http://haskellsolutions.blogspot.com/2009/02/finding-average-of-three-numbers-in.html\" rel=\"nofollow noreferrer\">haskellsolutions.blogspot.com/2009/02/&hellip;</a> -- However dont know how to use that for up to 100 numbers that could be inputted"}, {"owner": {"reputation": 31, "user_id": 10703793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0ebf6120b8f1b8649b6778f122699fa?s=128&d=identicon&r=PG&f=1", "display_name": "MadeleineG", "link": "https://stackoverflow.com/users/10703793/madeleineg"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1543966950, "post_id": 53622803, "comment_id": 94106489, "body": "I have looked at just about all of the Haskell average related posts on here and none seem to have the length based on user input.. so I cant hard code the length."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1543967608, "post_id": 53622803, "comment_id": 94106663, "body": "That first link would work just fine for a list of any size, whether given by the user or not."}, {"owner": {"reputation": 31, "user_id": 10703793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0ebf6120b8f1b8649b6778f122699fa?s=128&d=identicon&r=PG&f=1", "display_name": "MadeleineG", "link": "https://stackoverflow.com/users/10703793/madeleineg"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1543967949, "post_id": 53622803, "comment_id": 94106759, "body": "Oh, I must be super confused then. So after re working the code is this more on the right track now?"}, {"owner": {"reputation": 4118, "user_id": 10316640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/989bf10b54e525330bc9631e0be9e620?s=128&d=identicon&r=PG&f=1", "display_name": "Strom", "link": "https://stackoverflow.com/users/10316640/strom"}, "edited": false, "score": 4, "creation_date": 1543973119, "post_id": 53622803, "comment_id": 94107942, "body": "This looks like a homework problem. It might be more appropriate to ask your professor or TA for help."}, {"owner": {"reputation": 31, "user_id": 10703793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0ebf6120b8f1b8649b6778f122699fa?s=128&d=identicon&r=PG&f=1", "display_name": "MadeleineG", "link": "https://stackoverflow.com/users/10703793/madeleineg"}, "reply_to_user": {"reputation": 4118, "user_id": 10316640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/989bf10b54e525330bc9631e0be9e620?s=128&d=identicon&r=PG&f=1", "display_name": "Strom", "link": "https://stackoverflow.com/users/10316640/strom"}, "edited": false, "score": 0, "creation_date": 1544001924, "post_id": 53622803, "comment_id": 94117460, "body": "@Strom Thats why I am here.. my professor has tried to help and he doesnt know. He assigned all of us a different language to learn and only 2 of us got Haskell along with the professor not knowing it we dont have a TA."}], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1543977089, "post_id": 53623203, "comment_id": 94108863, "body": "Sure, you&#39;re on the right track. There are valid ways to fill in those blanks that will answer your question (you&#39;ll have to fix the types, though). Also, be careful about plagiarism: while Stack Overflow doesn&#39;t mind if you use code from its answers, both Stack Overflow&#39;s licensing and your professor will require you to cite any code you use that is not your own. Plus, you already think you know the length of the list, so you don&#39;t necessarily need to compute it."}], "tags": [], "owner": {"reputation": 31, "user_id": 10703793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0ebf6120b8f1b8649b6778f122699fa?s=128&d=identicon&r=PG&f=1", "display_name": "MadeleineG", "link": "https://stackoverflow.com/users/10703793/madeleineg"}, "is_accepted": false, "score": -1, "last_activity_date": 1543967977, "creation_date": 1543967977, "answer_id": 53623203, "question_id": 53622803, "link": "https://stackoverflow.com/questions/53622803/average-of-user-input/53623203#53623203", "title": "Average of user input", "body": "<pre><code>listlen :: [a] -&gt; Int\nlistlen xs = go 0 xs                 -- 0 = initial value of accumulator\n  where go s [] = s                  -- return accumulator\n        go s (a:as) = go (s+1) as    -- compute the next value of the accumulator\nsumx :: [a] -&gt; Int\nsumx xs = go 0 xs\n  where go s [] = s\n        go s (a:as) = go ... as      -- flll in the blank ...                                     -- and recurse\nlenAndSum :: [a] -&gt; (Int,Int)\nlenAndSum xs = go (0,0) xs             -- (0,0) = initial values of both accumulators\n  where go (s1,s2) [] = (s1,s2)        -- return both accumulators at the end\n        go (s1,s2) (a:as) = go ... as  -- left as an exercise                                    \n\nmain = do\n\n  putStrLn \"Enter how many numbers:\"\n  listlen &lt;- getLine \n  if ((read listlen) &lt;= 100) -- read converts a string to a number\n  then do  \n\n  putStrLn \"Enter a String of numbers:\"\n  --numberString &lt;- getLine\n\n  numberString&lt;- getLine\n  let ints = map read (words numberString)  :: [Int]\n  putStrLn(\"The List: \" ++(numberString))\n\n\n\n  putStrLn(\"The average: \")\n  putStrLn(\"Number of values greater than average: \")\n\n  else do\n    putStrLn \" Error: listlen must be less than or = to 100\"\n    main`enter code here`\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6367, "user_id": 6914441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbc12c764b93fa915b8e5384f521fe12?s=128&d=identicon&r=PG&f=1", "display_name": "jferard", "link": "https://stackoverflow.com/users/6914441/jferard"}, "is_accepted": false, "score": 0, "last_activity_date": 1545520215, "creation_date": 1545520215, "answer_id": 53899975, "question_id": 53622803, "link": "https://stackoverflow.com/questions/53622803/average-of-user-input/53899975#53899975", "title": "Average of user input", "body": "<p>Ok, this is homework, but homework can be really tough when you have to do it in Haskell. I'll try to explain step by step how you can do.</p>\n\n<h1>Good to know</h1>\n\n<p>First, Haskell is functional. You can find different defintions of \"functional\", but basically you can think of it as a property of the language: everything is constant (no side effect).</p>\n\n<p>Second, you can start a <a href=\"https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop\" rel=\"nofollow noreferrer\">REPL</a> by typing <code>ghci</code> in a terminal:</p>\n\n<pre><code>jferard@jferard-Z170XP-SLI:~$ ghci\nGHCi, version 8.0.2: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; :set +m -- enable parsing of multiline commands\nPrelude&gt; -- type the expression you want to evaluate here\n</code></pre>\n\n<h1>Recursion</h1>\n\n<p>How do you compute the sum of the elements of a list? In an imperative language, you will do something like that (Python like):</p>\n\n<pre><code>s = 0\nfor every x in xs:\n    s &lt;- s + x\n</code></pre>\n\n<p>But <code>s</code> is not constant. It's updated on every iteration until we get the sum. Can we reformulate the algorithm to avoid this mutation? Fortunately yes. Here's the key idea:</p>\n\n<pre><code>sum [x] = x\nsum [x1, ..., xn] = x1 + sum [x2, ..., xn]\n</code></pre>\n\n<p>With a little imagination, you can say that <code>sum [] = 0</code>. So we can write it in Haskell:</p>\n\n<pre><code>sum [] = 0\nsum (x:xs) = x + sum xs\n\n-- sum [1, 2, 3, 5] == 11\n</code></pre>\n\n<p><code>(x:xs)</code> means: <code>x</code> (the <code>head</code>) followed by the list <code>xs</code> (the <code>tail</code>). If you have understood that, you know how we can avoid side effects in many situations: just call another function to do the rest of the job. (Note: if you know about the stack, you can imagine what happens under the hood.)</p>\n\n<p>Now, how do you compute the length of a list? In a Python-like language, you'd do something like (forget <code>len(..)</code>):</p>\n\n<pre><code>l = 0\nfor every x in xs:\n    l &lt;- l + 1\n</code></pre>\n\n<p>Again, with a recursive definition, you have:</p>\n\n<pre><code>length [] = 0\nlength (x:xs) = 1 + length xs\n\n-- len [1, 2, 3, 5] == 4\n</code></pre>\n\n<h1>Folds</h1>\n\n<p>Computing sum and length is so common that they are built-in functions in Haskell. But there is something more important: if you examine the two functions carefully, you'll notice this pattern:</p>\n\n<pre><code>f [] = &lt;initial value&gt;\nf (x:xs) = g(f xs, x)\n</code></pre>\n\n<p>For <code>sum</code>, initial value is <code>0</code> and <code>g(f xs, x) = x + f xs</code>. For <code>length</code>,  initial value is <code>0</code> and <code>g(f xs, x) = 1 + f xs</code>. This pattern is so common that Haskell has a built-in function (actually several built-in functions) for it: <code>foldl</code>. <code>foldl</code> takes a function, an initial value and a list and returns the function repeatedly applied to the previous result and the current element, until the list is consumed. You can think of the function as the the body of the loop:</p>\n\n<pre><code>sum xs = foldl (+) 0 xs\n</code></pre>\n\n<p>(Note on curryfication: 1. You will maybe learn some day that Haskell functions always take one argument, but that's not the point here. 2. You can remove xs on both sides: <code>sum = foldl (+) 0</code>)</p>\n\n<pre><code>Prelude&gt; foldl (+) 0 [1,2,3,5]\n11 -- (((0+1)+2)+3)+5\n</code></pre>\n\n<p>With <code>scanl</code>, you can in some way \"debug\" the <code>foldl</code>:</p>\n\n<pre><code>Prelude&gt; scanl (+) 0 [1,2,3,5]\n[0,1,3,6,11]\n</code></pre>\n\n<p><code>length</code> is more tricky, since you don't have a built-in function <code>g(f xs, x) = 1 + f xs</code>. You can use a <a href=\"https://en.wikipedia.org/wiki/Anonymous_function#Haskell\" rel=\"nofollow noreferrer\">lambda function</a>: <code>\\acc x -&gt; 1 + acc</code> where <code>acc</code> is the current value:</p>\n\n<pre><code>length xs = foldl (\\acc x -&gt; 1 + acc) 0 xs\n</code></pre>\n\n<h1>Your question</h1>\n\n<h2>Average</h2>\n\n<p>Let's try to write <code>average</code> with the built-in <code>sum</code> and <code>length</code> functions:</p>\n\n<pre><code>Prelude&gt; average xs = sum xs / length xs\n\n&lt;interactive&gt;:1:14: error:\n    \u2022 Could not deduce (Fractional Int) arising from a use of \u2018/\u2019\n    ...\n</code></pre>\n\n<p>What does that mean? I won't get into details, but you have to know that Haskell is very strict with numbers. You can't divide two integers and expect a float result without a little work.</p>\n\n<pre><code>Prelude&gt; :t (/)\n(/) :: Fractional a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>This means that <code>/</code> will take <code>Fractional</code>s. Thus, the work is: cast integers into <code>Fractional</code>s.</p>\n\n<pre><code>average xs = fromIntegral (sum xs) / fromIntegral (length xs)\n\n-- average [1, 2, 3, 5] == 2.75\n</code></pre>\n\n<h2>Number of values greater than average</h2>\n\n<p>Now, the number of values greater than the mean. In a Python-like langage, you'll write:</p>\n\n<pre><code>c = 0\nfor every x in xs:\n    if x &gt; avg:\n        c &lt;- c + 1\n</code></pre>\n\n<p>Let's try the recursive method:</p>\n\n<pre><code>gtAvg [] = 0\ngtAvg (x:xs) = (if x&gt;avg then 1) + sum xs -- WRONG\n</code></pre>\n\n<p>You see that there is something missing. In the imperative version, if <code>x &lt;= avg</code>, we simply do nothing (and thus do not update the value). Here, we must return something:</p>\n\n<pre><code>gtAvg [] = 0\ngtAvg (x:xs) = (if x&gt;avg then 1 else 0) + gtAvg xs\n</code></pre>\n\n<p>But where does the <code>avg</code> value come from? We need to precompute it. Let's define a function that takes <code>avg</code> as an argument:</p>\n\n<pre><code>gtAvg' [] _ = 0\ngtAvg' (x:xs) avg = (if fromIntegral x&gt;avg then 1 else 0) + gtAvg' xs avg\n\n-- gtAvg' [1, 2, 3, 5] (average [1, 2, 3, 5]) == 2\n</code></pre>\n\n<p>And then:</p>\n\n<pre><code>gtAvg xs = gtAvg' xs (average xs)\n\n-- gtAvg [1, 2, 3, 5] == 2\n</code></pre>\n\n<p>Obviously, this is more simple with a <code>foldl</code>:</p>\n\n<pre><code>gtAvg xs = foldl (\\acc x -&gt; if fromIntegral x&gt;average xs then acc+1 else acc) 0 xs\n</code></pre>\n\n<h1>More (map, filter and list comprehension)</h1>\n\n<p>When we are on the basics of Haskell, you may need three more constructs.</p>\n\n<h2>Filter</h2>\n\n<p>First, a <code>filter</code>:</p>\n\n<pre><code>Prelude&gt; filter (&gt;2.75) [1, 2, 3, 5]\n[3.0,5.0]\n</code></pre>\n\n<p>If you take the length of that list, you get the number of elements greater than the average:</p>\n\n<pre><code>gtAvg xs = length $ filter (\\x -&gt; fromIntegral x &gt;average xs) xs\n</code></pre>\n\n<p>(Or with a composition of functions: <code>length $ filter ((&gt; average xs).fromIntegral) xs</code>) Don't be disturbed by the <code>$</code> sign: it means that the right side of the expression (<code>filter...</code>) is one block, like if it were in parenthesis.</p>\n\n<h2>Map</h2>\n\n<p>Second, <code>map</code> applies a function to every element of a list and returns the list of mapped elements. For instance, if you want to some squares of elements of a list:</p>\n\n<pre><code>Prelude&gt; sum $ map (**2)  [1, 2, 3, 5]\n39.0\n</code></pre>\n\n<p>You can use it like that:</p>\n\n<pre><code>gtAvg xs = length $ filter (&gt;average xs) $ map fromIntegral xs\n</code></pre>\n\n<p>It converts elements to <code>Fractional</code>, then it applies the filter.</p>\n\n<h2>List comprehension</h2>\n\n<p>Third, you can have <code>filter</code> and a <code>map</code> with a list comprehension:</p>\n\n<pre><code>gtAvg xs = length [x | x&lt;-xs, fromIntegral x&gt;average xs]\n</code></pre>\n\n<p>I left a lot of things aside and made probably approximations, but now you should have the basic knowledge to answer your question.</p>\n"}], "owner": {"reputation": 31, "user_id": 10703793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0ebf6120b8f1b8649b6778f122699fa?s=128&d=identicon&r=PG&f=1", "display_name": "MadeleineG", "link": "https://stackoverflow.com/users/10703793/madeleineg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 142, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1545520215, "creation_date": 1543965150, "last_edit_date": 1543966198, "question_id": 53622803, "link": "https://stackoverflow.com/questions/53622803/average-of-user-input", "title": "Average of user input", "body": "<p>I want to take the user input of a list of numbers and find the average. However, after looking for examples I have not found any that seems to match what I am doing because I can have from 2 - 100 numbers in a list. Any help/advice is appreciated.</p>\n\n<p>Below is my working code as is. </p>\n\n<pre><code>main = do\n  putStrLn \"Enter how many numbers:\"\n  listlen &lt;- getLine \n  if ((read listlen) &lt;= 100) -- read converts a string to a number\n  then do  \n\n  putStrLn \"Enter a String of numbers:\"\n  --numberString &lt;- getLine\n\n  numberString&lt;- getLine\n  let ints = map read (words numberString)  :: [Int]\n  putStrLn(\"The List: \" ++(numberString))\n\n  putStrLn(\"The average: \")\n  putStrLn(\"Number of values greater than average: \")\n\n  else do\n    putStrLn \" Error: listlen must be less than or = to 100\"\n    main\n</code></pre>\n"}, {"tags": ["haskell", "monoids"], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 30, "last_activity_date": 1543962831, "creation_date": 1543962831, "answer_id": 53622459, "question_id": 53622428, "link": "https://stackoverflow.com/questions/53622428/a-basic-monoid-definition-gives-no-instance-for-semigroup-mymonoid-arising-fr/53622459#53622459", "title": "A basic Monoid definition gives &quot;No instance for (Semigroup MyMonoid) arising from the superclasses of an instance declaration&quot;", "body": "<p>Since that tour was written, <code>(&lt;&gt;)</code> has been moved from Monoid to Semigroup, and all Monoid instances are required to also be Semigroup. <code>mappend</code> is just a synonym for <code>(&lt;&gt;)</code>. So, you need two instances:</p>\n\n<pre><code>instance Semigroup MyMonoid where\n  MyMonoid m1 &lt;&gt; MyMonoid m2 = MyMonoid (S.union m1 m2)\n\ninstance Monoid MyMonoid where\n  mempty = MyMonoid S.empty\n</code></pre>\n"}], "owner": {"reputation": 13667, "user_id": 1120370, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8c82898ff7f2247a7fc0c1e224b4b3de?s=128&d=identicon&r=PG", "display_name": "W.P. McNeill", "link": "https://stackoverflow.com/users/1120370/w-p-mcneill"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2325, "favorite_count": 1, "accepted_answer_id": 53622459, "answer_count": 1, "score": 21, "last_activity_date": 1543962831, "creation_date": 1543962645, "question_id": 53622428, "link": "https://stackoverflow.com/questions/53622428/a-basic-monoid-definition-gives-no-instance-for-semigroup-mymonoid-arising-fr", "title": "A basic Monoid definition gives &quot;No instance for (Semigroup MyMonoid) arising from the superclasses of an instance declaration&quot;", "body": "<p>I am attempting to define Haskell integer sets with the union operation as a <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Monoid.html\" rel=\"noreferrer\">Monoid</a>.</p>\n\n<pre><code>module MyMonoid where\n\nimport qualified Data.IntSet as S\n\ndata MyMonoid = MyMonoid S.IntSet\n\ninstance Monoid MyMonoid where\n  mempty = MyMonoid S.empty\n  MyMonoid m1 `mappend` MyMonoid m2 = MyMonoid (S.union m1 m2)\n</code></pre>\n\n<p>I get the error</p>\n\n<pre><code>\u2022 No instance for (Semigroup Markup)\n    arising from the superclasses of an instance declaration\n\u2022 In the instance declaration for \u2018Monoid MyMonoid\u2019\n</code></pre>\n\n<p>What am I doing wrong? This seems so simple, and I'm copying the syntax I see in examples like <a href=\"https://www.schoolofhaskell.com/user/mgsloan/monoids-tour\" rel=\"noreferrer\">this</a>, but I can't see why this error is occurring.</p>\n"}, {"tags": ["haskell", "fold"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1543982119, "post_id": 53620606, "comment_id": 94109973, "body": "The best function for doing that particular task efficiently is <code>foldl&#39;</code>. It&#39;s <i>possible</i> to do it efficiently using <code>foldr</code>, but only in a somewhat twisted fashion: <code>foldr (\\x r acc -&gt; r $! x + acc) id (take ...) 1</code>."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1543954128, "creation_date": 1543954128, "answer_id": 53620657, "question_id": 53620606, "link": "https://stackoverflow.com/questions/53620606/foldl-vs-foldr-memory-usage/53620657#53620657", "title": "Foldl vs Foldr memory usage", "body": "<p><code>foldr f z xs</code> is inefficient when <code>f</code> is strict on its second argument (like <code>(+)</code>), since it evaluates to</p>\n\n<pre><code>f1 x1 (f x2 (f x3 ...\n</code></pre>\n\n<p>and this can not start to evaluate until the very end of the list. If <code>f</code> were not strict on the second argument, evaluation could instead start sooner.</p>\n"}], "owner": {"reputation": 85, "user_id": 10534434, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe7670087f8c29244d73f48a079a5955?s=128&d=identicon&r=PG&f=1", "display_name": "lpraat", "link": "https://stackoverflow.com/users/10534434/lpraat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 209, "favorite_count": 1, "accepted_answer_id": 53620657, "answer_count": 1, "score": 3, "last_activity_date": 1543954128, "creation_date": 1543953857, "question_id": 53620606, "link": "https://stackoverflow.com/questions/53620606/foldl-vs-foldr-memory-usage", "title": "Foldl vs Foldr memory usage", "body": "<p>Given the Fibonacci infinite list</p>\n\n<pre><code>fibo a b = a : fibo b (a+b)\n</code></pre>\n\n<p>And given the two following calls:</p>\n\n<ul>\n<li><code>foldl (+) 1 (take 1000000 $ fibo 1 1)</code></li>\n<li><code>foldr (+) 1 (take 1000000 $ fibo 1 1)</code></li>\n</ul>\n\n<p>I expected the first one (foldl) to allocate a huge amount of memory because of thunks and in fact that's what happens.</p>\n\n<p>However, I didn't expect the same for the second one. Because of how the foldr is defined I thought a usual stack like evaluation would have been performed for the right argument of (+) (because of its strictness).</p>\n\n<p>Actually even in this case I have a huge amount of memory that is allocated.</p>\n\n<p>What is happening?</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 6, "creation_date": 1543951509, "post_id": 53620057, "comment_id": 94100468, "body": "<code>even (Succ Zero)</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 5, "creation_date": 1543951970, "post_id": 53620057, "comment_id": 94100682, "body": "There&#39;s no need to convert to an <code>Int</code>. Hint: write mutually recursive <code>even</code> and <code>odd</code> functions."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1543963583, "post_id": 53620057, "comment_id": 94105586, "body": "Well if <code>Nat</code> is going to be a data type that you are going to stick with for a whiile then i guess you best write an <code>Enum</code> instance first."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 7, "last_activity_date": 1543954175, "last_edit_date": 1543954175, "creation_date": 1543952513, "answer_id": 53620303, "question_id": 53620057, "link": "https://stackoverflow.com/questions/53620057/haskell-check-if-custom-data-type-is-even/53620303#53620303", "title": "Haskell Check if custom data type is even", "body": "<p>The problem is <em>not</em> the function itself, but you call the function like:</p>\n\n<pre><code> even Succ  Zero\n</code></pre>\n\n<p>or more verbose:</p>\n\n<pre><code>(even Succ) Zero\n</code></pre>\n\n<p>So you here call <code>even</code> with <code>Succ</code> as parameter, <code>Succ</code> is a function of type <code>Nat -&gt; Nat</code>, not a <code>Nat</code> itself. In order to pass <code>Succ Zero</code> to even, you need to use brackets, like:</p>\n\n<pre><code>even (Succ Zero)\n</code></pre>\n\n<p>That being said, one does <em>not</em> need to first convert the Peano number to an <code>Int</code> in order to check if it is even or not. One can define such function inductively as:</p>\n\n<ol>\n<li><code>Zero</code> is even;</li>\n<li><code>(Succ Zero)</code> is <em>not</em> even; and</li>\n<li><code>(Succ (Succ x))</code> is even, if and only if <code>x</code> is even.</li>\n</ol>\n\n<p>So we can implement this like:</p>\n\n<pre><code>even' :: Nat -&gt; Bool\neven' Zero = True\neven' (Succ Zero) = False\neven' (Succ (Succ x)) = even' x\n</code></pre>\n\n<p>or we can introducing a \"helper\" function <code>odd' :: Nat -&gt; Bool</code>, and use mutual recursion:</p>\n\n<pre><code>even' :: Nat -&gt; Bool\neven' Zero = True\neven' (Succ x) = odd' x\n\nodd' :: Nat -&gt; Bool\nodd' Zero = False\nodd' (Succ x) = even' x\n</code></pre>\n"}], "owner": {"reputation": 179, "user_id": 5212963, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ed528b30d0e62b0420358528e7d03f11?s=128&d=identicon&r=PG&f=1", "display_name": "Never Mind", "link": "https://stackoverflow.com/users/5212963/never-mind"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 880, "favorite_count": 0, "accepted_answer_id": 53620303, "answer_count": 1, "score": 1, "last_activity_date": 1543954175, "creation_date": 1543951412, "question_id": 53620057, "link": "https://stackoverflow.com/questions/53620057/haskell-check-if-custom-data-type-is-even", "title": "Haskell Check if custom data type is even", "body": "<p>So I have this exercise with the following data type </p>\n\n<pre><code>data Nat = Zero | Succ Nat deriving (Eq,Ord,Show,Read)\n</code></pre>\n\n<p>This can be used to represent a natural number, for example 2 = Succ (Succ Zero).\nI implemented a function that checks if the number is even.</p>\n\n<pre><code>even :: Nat -&gt; Bool\neven x = count x `mod` 2 == 0\n\ncount :: Nat -&gt; Int\ncount Zero = 0\ncount (Succ x) = 1 + count x\n</code></pre>\n\n<p>It works fine for Zero, but whenever I try for something different, such as count Succ Zero or count Succ (Succ Zero)</p>\n\n<pre><code>*Main&gt; even Succ Zero\n\n&lt;interactive&gt;:6:1: error:\n    * Couldn't match expected type `Nat -&gt; t' with actual type `Bool'\n    * The function `evenN' is applied to two arguments,\n      but its type `Nat -&gt; Bool' has only one\n      In the expression: evenN Succ Zero\n      In an equation for `it': it = evenN Succ Zero\n    * Relevant bindings include it :: t (bound at &lt;interactive&gt;:6:1)\n\n&lt;interactive&gt;:6:7: error:\n    * Couldn't match expected type `Nat' with actual type `Nat -&gt; Nat'\n    * Probable cause: `Succ' is applied to too few arguments\n      In the first argument of `evenN', namely `Succ'\n      In the expression: evenN Succ Zero\n      In an equation for `it': it = evenN Succ Zero\n</code></pre>\n"}, {"tags": ["json", "sqlite", "haskell"], "comments": [{"owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 1, "creation_date": 1543952588, "post_id": 53620038, "comment_id": 94100981, "body": "Do you have code to read the SQLite database? When you have that, you can simply translate from the SQLite structure to <code>Movie</code> and write out the list of <code>Movie</code>s that you created."}, {"owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 1, "creation_date": 1543953481, "post_id": 53620038, "comment_id": 94101422, "body": "Was the sqlite library you&#39;re using compiled with the JSON1 module enabled? That would make it easy to do purely in SQL."}, {"owner": {"reputation": 45, "user_id": 4325408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/265b1be4ece7a1d4a19985dd0b7f49b2?s=128&d=identicon&r=PG&f=1", "display_name": "user2023", "link": "https://stackoverflow.com/users/4325408/user2023"}, "edited": false, "score": 0, "creation_date": 1543956926, "post_id": 53620038, "comment_id": 94102924, "body": "Thank you 4castle I will edit my responses now."}, {"owner": {"reputation": 45, "user_id": 4325408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/265b1be4ece7a1d4a19985dd0b7f49b2?s=128&d=identicon&r=PG&f=1", "display_name": "user2023", "link": "https://stackoverflow.com/users/4325408/user2023"}, "reply_to_user": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 0, "creation_date": 1543956980, "post_id": 53620038, "comment_id": 94102940, "body": "Hi @Bob Dalgleish, I&#39;m making use of simple SQL statements to query the database and display the results e.g. display movie by year."}, {"owner": {"reputation": 45, "user_id": 4325408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/265b1be4ece7a1d4a19985dd0b7f49b2?s=128&d=identicon&r=PG&f=1", "display_name": "user2023", "link": "https://stackoverflow.com/users/4325408/user2023"}, "reply_to_user": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 0, "creation_date": 1543956992, "post_id": 53620038, "comment_id": 94102947, "body": "Hi @Shawn, Iam using Database.HDBC.Sqlite3."}, {"owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "edited": false, "score": 0, "creation_date": 1543957837, "post_id": 53620038, "comment_id": 94103346, "body": "It&#39;s not clear what the question is.  You show code to write JSON, and say you have code to read <code>Movie</code> from the database.  What else is required?"}, {"owner": {"reputation": 45, "user_id": 4325408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/265b1be4ece7a1d4a19985dd0b7f49b2?s=128&d=identicon&r=PG&f=1", "display_name": "user2023", "link": "https://stackoverflow.com/users/4325408/user2023"}, "reply_to_user": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "edited": false, "score": 0, "creation_date": 1543958840, "post_id": 53620038, "comment_id": 94103775, "body": "@bergey Hi, I would like to convert my SQLite database table to JSON using a haskell function."}, {"owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 0, "creation_date": 1543958863, "post_id": 53620038, "comment_id": 94103789, "body": "Does the <b>sqlite</b> library it&#39;s using come with the JSON1 extension compiled into it? The easy way to check is to see if <code>SELECT json(&#39;0&#39;)</code> works."}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1544064399, "post_id": 53620038, "comment_id": 94146776, "body": "@user2023 your example already converts the record to JSON using a haskell function, so it&#39;s still not clear what you&#39;re asking."}, {"owner": {"reputation": 45, "user_id": 4325408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/265b1be4ece7a1d4a19985dd0b7f49b2?s=128&d=identicon&r=PG&f=1", "display_name": "user2023", "link": "https://stackoverflow.com/users/4325408/user2023"}, "reply_to_user": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1544106040, "post_id": 53620038, "comment_id": 94165208, "body": "@JeremyList Hi, I would like to be able to dump the database into JSON not just a single record."}], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 4325408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/265b1be4ece7a1d4a19985dd0b7f49b2?s=128&d=identicon&r=PG&f=1", "display_name": "user2023", "link": "https://stackoverflow.com/users/4325408/user2023"}, "edited": false, "score": 0, "creation_date": 1544105168, "post_id": 53647634, "comment_id": 94164640, "body": "Hi @Shawn, Im really sorry I forgot to answer your question. Thank you for taking the time for looking into this. Where do I check if JSON1 is supported? Do I need to write SELECT json(&#39;0&#39;) as part of a sql query?"}, {"owner": {"reputation": 45, "user_id": 4325408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/265b1be4ece7a1d4a19985dd0b7f49b2?s=128&d=identicon&r=PG&f=1", "display_name": "user2023", "link": "https://stackoverflow.com/users/4325408/user2023"}, "edited": false, "score": 0, "creation_date": 1544106791, "post_id": 53647634, "comment_id": 94165742, "body": "could you please elaborate on where I place &quot;json_group_array&quot; statement within the context of my code above? Cheers"}], "tags": [], "owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "is_accepted": false, "score": 1, "last_activity_date": 1544086156, "creation_date": 1544086156, "answer_id": 53647634, "question_id": 53620038, "link": "https://stackoverflow.com/questions/53620038/convert-sqlite-database-to-json-in-haskell/53647634#53647634", "title": "Convert SQLite database to JSON in Haskell", "body": "<p>You never did answer my question about if the version of sqlite you're using has support for the JSON1 extension, so this pure-sql solution might not work for you, but if it does...</p>\n\n<pre><code>SELECT json_group_array(json_object('rank', rank\n                                  , 'name', name\n                                  , 'director', director\n                                  , 'year', year\n                                  , 'rating', rating\n                                  , 'starring', starring))\nFROM movies;\n</code></pre>\n\n<p>will return a string that is a JSON array with one JSON object per row of the table.</p>\n"}, {"comments": [{"owner": {"reputation": 45, "user_id": 4325408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/265b1be4ece7a1d4a19985dd0b7f49b2?s=128&d=identicon&r=PG&f=1", "display_name": "user2023", "link": "https://stackoverflow.com/users/4325408/user2023"}, "edited": false, "score": 0, "creation_date": 1544192904, "post_id": 53660628, "comment_id": 94200331, "body": "Hi @Jeremy List   do I have to write out the list of movies manually? Can I not write a sql query to get all the data from the table and then pass it to encodeToLazyText?"}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "reply_to_user": {"reputation": 45, "user_id": 4325408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/265b1be4ece7a1d4a19985dd0b7f49b2?s=128&d=identicon&r=PG&f=1", "display_name": "user2023", "link": "https://stackoverflow.com/users/4325408/user2023"}, "edited": false, "score": 0, "creation_date": 1544730619, "post_id": 53660628, "comment_id": 94389998, "body": "No, you just pass the list to <code>encodeToLazyText</code> and it will create a JSON array."}], "tags": [], "owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "is_accepted": false, "score": 1, "last_activity_date": 1544730817, "last_edit_date": 1544730817, "creation_date": 1544135173, "answer_id": 53660628, "question_id": 53620038, "link": "https://stackoverflow.com/questions/53620038/convert-sqlite-database-to-json-in-haskell/53660628#53660628", "title": "Convert SQLite database to JSON in Haskell", "body": "<p>In Aeson you have this instance:</p>\n\n<pre><code>instance ToJSON a =&gt; ToJSON [a]\n</code></pre>\n\n<p>So you can just pass the entire list to <code>encodeToLazyText</code> and it will lazily create a JSON array.</p>\n\n<p>For example:</p>\n\n<pre><code>main = I.writeFile \"DB.json\" (encodeToLazyText [convertToJson,convertToJson])\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 4325408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/265b1be4ece7a1d4a19985dd0b7f49b2?s=128&d=identicon&r=PG&f=1", "display_name": "user2023", "link": "https://stackoverflow.com/users/4325408/user2023"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 391, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1544730817, "creation_date": 1543951348, "question_id": 53620038, "link": "https://stackoverflow.com/questions/53620038/convert-sqlite-database-to-json-in-haskell", "title": "Convert SQLite database to JSON in Haskell", "body": "<p>Is there any way to dump a SQLite database into a JSON file in Haskell? All other questions are parsing json and saving to sqlite. I can't seem to find any reference on this, please help me.</p>\n\n<p>I created a simple haskell app using stack that pulls details about movies from a HTML web source by applying haskell functions and then save the data into a SQLite database file. The purpose of the app is to allow users to query the database. The database consists of 1 table called \"movies\". </p>\n\n<p>I want to write a module that generates a JSON representation of my Haskell data to dump the SQLite database into a JSON file. </p>\n\n<p>SQLite table:</p>\n\n<hr>\n\n<p>rank | name | director | year | rating | starring |</p>\n\n<hr>\n\n<p>This is what I have managed to come up with so far. This creates a JSON file with a single record.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings, DeriveGeneric, DeriveAnyClass #-}\n\nimport GHC.Generics\nimport Data.Text.Lazy (Text)\nimport Data.Text.Lazy.IO as I\nimport Data.Aeson.Text (encodeToLazyText)\nimport Data.Aeson (ToJSON)\n-- Custom Datatype\ndata Movie = Movie {\n      rank :: Int,          \n      name :: String,       \n      director :: String,   \n      year :: Int,          \n      rating :: Double,     \n      starring :: String    \n      } deriving (Show, Generic, ToJSON) \n\nconvertToJson = Movie { rank = 125, name = \"Puzzle\", director = \"Marc Turtletaub\", year = 2018 , rating = 83, starring = \"Kelly Macdonald\" }\n\nmain = I.writeFile \"DB.json\" (encodeToLazyText convertToJson)\n</code></pre>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1543945851, "post_id": 53615602, "comment_id": 94097847, "body": "There is a subtle difference: <code>let</code> performs lazy (irrefutable) pattern matching, while <code>case</code> does strict pattern matching. For a writer-like monad like this, probably it does not matter much (and the strict variant seems more appropriate, anyway)."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1543935221, "creation_date": 1543935221, "answer_id": 53615602, "question_id": 53615508, "link": "https://stackoverflow.com/questions/53615508/haskell-book-let-syntax-confusion-parameter-reassignment/53615602#53615602", "title": "Haskell book Let syntax confusion (parameter reassignment)", "body": "<p>It's probably easier to understand if written this way:</p>\n\n<pre><code>instance Monad CountMe where\n  return = pure\n  CountMe n a &gt;&gt;= f = case f a of\n      CountMe n' b -&gt; CountMe (n + n') b\n</code></pre>\n\n<p>This pattern matching of <code>f a</code> to the pattern <code>CountMe n' b</code>, giving values to the variables <code>n'</code> and <code>b</code>, can also be done in a <code>let</code> or <code>where</code> clause, with the same result. The main difference to a <code>case</code> is that the latter can also have, well, multiple different cases, but in this case there's only one constructor so only one case needs to be matched.</p>\n"}, {"tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": false, "score": 3, "last_activity_date": 1543940505, "creation_date": 1543940505, "answer_id": 53617297, "question_id": 53615508, "link": "https://stackoverflow.com/questions/53615508/haskell-book-let-syntax-confusion-parameter-reassignment/53617297#53617297", "title": "Haskell book Let syntax confusion (parameter reassignment)", "body": "<p>If you refers the definition of <code>&gt;&gt;=</code> in <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Control-Monad.html#v:-62--62--61-\" rel=\"nofollow noreferrer\">Control.Monad</a>. You will find that the type of <code>f</code> is:</p>\n\n<pre><code>(a -&gt; CountMe b)\n</code></pre>\n\n<p>So, the hypothesis: </p>\n\n<blockquote>\n  <p>The result of <code>f a</code> is being stored in the b argument to CountMe.</p>\n</blockquote>\n\n<p>is <strong>Wrong</strong>. the result of <code>f a</code> is <code>CountMe n' b</code>.</p>\n\n<p>and the next hypothesis:</p>\n\n<blockquote>\n  <p>n' I assume is a copy of the value of n in the initial bind definition.</p>\n</blockquote>\n\n<p>is also <strong>Wrong</strong>. The value of <code>n'</code> is not a copy of <code>n</code>, what is the value of <code>n'</code> depending on the what the function <code>f</code> do.</p>\n\n<p>As you may have known, the common using of let clause is to store Intermediate result which attempt to apply repeatly in <code>in</code> clause. Here is a example:</p>\n\n<pre><code>let m = mean xs in (m^2, m*2)\n</code></pre>\n\n<p>The confusing thing here is due to can't get the value of <code>n'</code> and <code>b</code> from <code>CountMe</code> data type directly. it need to use <strong>pattern matching</strong> feature to extract such values. If you have defined functions to get such values, say, </p>\n\n<pre><code>getCountMe_N (CountMe n b) = n\ngetCountMe_B (CountMe n b) = b\n</code></pre>\n\n<p>The let clause can be rewritten as:</p>\n\n<pre><code>let cntMe = f a in CountMe (n + getCountMe_N cntMe) (getCountMe_B cntMe)\n</code></pre>\n\n<p>The pattern matching is not restricted using in <code>let</code> clause only, actually, it is common used in argument of function, <code>where</code> clause and <code>case</code> expression, for more information, see: <a href=\"https://en.wikibooks.org/wiki/Haskell/Pattern_matching\" rel=\"nofollow noreferrer\">Pattern matching</a> </p>\n"}], "owner": {"reputation": 309, "user_id": 7571000, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155043356444224/picture?type=large", "display_name": "Shane Unger", "link": "https://stackoverflow.com/users/7571000/shane-unger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 53615602, "answer_count": 2, "score": 1, "last_activity_date": 1543940505, "creation_date": 1543934914, "question_id": 53615508, "link": "https://stackoverflow.com/questions/53615508/haskell-book-let-syntax-confusion-parameter-reassignment", "title": "Haskell book Let syntax confusion (parameter reassignment)", "body": "<p>While going through the Haskell book I came across the following example where it appears in the 4th line of the example here that the result of <code>f a</code> is being stored in the <code>b</code> argument to <code>CountMe</code>, and <code>n'</code> I assume is a copy of the value of <code>n</code> in the initial bind definition. I haven't seen this type of let clause before, am I correct in my hypothesis above or is something else happening. Also, is this a common use of a let clause, it seems rather confusing? </p>\n\n<pre><code>instance Monad CountMe where\n    return = pure\n    CountMe n a &gt;&gt;= f = \n      let CountMe n' b  = f a\n      in CountMe (n + n') b\n</code></pre>\n"}, {"tags": ["docker", "haskell", "dockerfile", "haskell-stack"], "comments": [{"owner": {"reputation": 754, "user_id": 533919, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/622782b08cf5ee216199bdd5a7d68783?s=128&d=identicon&r=PG", "display_name": "cdupont", "link": "https://stackoverflow.com/users/533919/cdupont"}, "edited": false, "score": 0, "creation_date": 1543931670, "post_id": 53614488, "comment_id": 94089637, "body": "Complementary question: It seems that docker is not very used in the Haskell world (I find only few resources on the Internet on the topic), why is that?"}, {"owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "edited": false, "score": 0, "creation_date": 1543944871, "post_id": 53614488, "comment_id": 94097370, "body": "Typically this error means that some file is corrupt.  Interactively you can delete just that package, but in a Dockerfile it&#39;s likely easier to rebuild.  Can you: 1. make sure that <code>.stack-work</code> is in your <code>.dockerignore</code> 2. <code>docker build --no-cache .</code> 3. let us know whether that fixes it."}], "owner": {"reputation": 754, "user_id": 533919, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/622782b08cf5ee216199bdd5a7d68783?s=128&d=identicon&r=PG", "display_name": "cdupont", "link": "https://stackoverflow.com/users/533919/cdupont"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 175, "favorite_count": 1, "answer_count": 0, "score": 4, "last_activity_date": 1543931574, "creation_date": 1543931574, "question_id": 53614488, "link": "https://stackoverflow.com/questions/53614488/haskell-stack-in-docker-extra-deps-not-working", "title": "Haskell Stack in Docker: extra-deps not working", "body": "<p>I try to compile my program in a docker container with this Dockerfile:</p>\n\n<pre><code>FROM haskell:8.4\n\nCOPY stack.yaml   /opt/waziup/stack.yaml\nCOPY foo.cabal /opt/waziup/foo.cabal\n\nWORKDIR /opt/waziup\nRUN stack setup\nRUN stack install --only-dependencies\n\nCOPY .  /opt/waziup\nRUN stack install\n</code></pre>\n\n<p>My stack.yaml file is like this:</p>\n\n<pre><code>resolver: lts-12.20\nextra-deps:\n - servant-flatten-0.2\npackages:\n - '.'\n</code></pre>\n\n<p>This works when I type <code>stack install</code>. However when I try to compile the docker:</p>\n\n<pre><code>$ docker build .\n\nservant-flatten-0.2: download\nservant-flatten-0.2: configure\nservant-flatten-0.2: build\nservant-flatten-0.2: copy/register\n\n...\n    /opt/waziup/src/Foo.hs:37:1: error:\n        Could not find module \u2018Servant.API.Flatten\u2019\n        There are files missing in the \u2018servant-flatten-0.2\u2019 package,\n        try running 'ghc-pkg check'.\n        Use -v to see a list of the files searched for.\n</code></pre>\n\n<p>Any idea? What happens with the extra-deps package?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 2, "creation_date": 1543931677, "post_id": 53614403, "comment_id": 94089641, "body": "Have you imported it from <code>Data.List</code>? Could you add your code to the question?"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1543932910, "last_edit_date": 1543932910, "creation_date": 1543932537, "answer_id": 53614775, "question_id": 53614403, "link": "https://stackoverflow.com/questions/53614403/haskell-sort-a-list-of-int/53614775#53614775", "title": "Haskell, sort a list of Int", "body": "<p>If you're searching for a function of which you know (or guess) the name, but don't know where it is defined, <a href=\"https://hayoo.fh-wedel.de/\" rel=\"nofollow noreferrer\">Hayoo</a> is your best<sup>\u2020</sup> friend. Asked for <code>sort</code>, <a href=\"https://hayoo.fh-wedel.de/?query=sort\" rel=\"nofollow noreferrer\">it'll give</a></p>\n\n<pre><a href=\"http://hackage.haskell.org/package/base/docs/Data-List.html#v:sort\" rel=\"nofollow noreferrer\">sort</a> :: Ord a => [a] -> [a]\n<sup><a href=\"http://hackage.haskell.org/package/base\" rel=\"nofollow noreferrer\">base</a> -<a href=\"http://hackage.haskell.org/package/base/docs/Data-List.html\" rel=\"nofollow noreferrer\">Data.List</a>  </sup>\n> The <a href=\"http://hackage.haskell.org/package/base/docs/Data-List.html#v:sort\" rel=\"nofollow noreferrer\">sort</a> function implements a stable sorting algorithm. It is a special case of <a href=\"https://hayoo.fh-wedel.de/?query=%28%28name%3A%28%21sortBy%29%20package%3A%28%21base%29%20module%3A%28%21Data.List%29%29%5E100.0%29%20OR%20%28%28name%3A%28%21sortBy%29%20package%3A%28%21base%29%29%5E10.0%29%20OR%20name%3A%28%21sortBy%29\" rel=\"nofollow noreferrer\">sortBy</a>, which allows the programmer to supply their own comparison function.\n\n<a href=\"http://hackage.haskell.org/package/base/docs/GHC-OldList.html#v:sort\" rel=\"nofollow noreferrer\">sort</a> :: Ord a => [a] -> [a]\n<sup><a href=\"http://hackage.haskell.org/package/base\" rel=\"nofollow noreferrer\">base</a> -<a href=\"http://hackage.haskell.org/package/base/docs/GHC-OldList.html\" rel=\"nofollow noreferrer\">GHC.OldList</a>  </sup>\n> The <a href=\"http://hackage.haskell.org/package/base/docs/GHC-OldList.html#v:sort\" rel=\"nofollow noreferrer\">sort</a> function implements a stable sorting algorithm. It is a special case of <a href=\"https://hayoo.fh-wedel.de/?query=%28%28name%3A%28%21sortBy%29%20package%3A%28%21base%29%20module%3A%28%21Data.List%29%29%5E100.0%29%20OR%20%28%28name%3A%28%21sortBy%29%20package%3A%28%21base%29%29%5E10.0%29%20OR%20name%3A%28%21sortBy%29\" rel=\"nofollow noreferrer\">sortBy</a>, which allows the programmer to supply their own comparison function.\n\n<a href=\"http://hackage.haskell.org/package/bytestring/docs/Data-ByteString-Char8.html#v:sort\" rel=\"nofollow noreferrer\">sort</a> :: ByteString -> ByteString\n<sup><a href=\"http://hackage.haskell.org/package/bytestring\" rel=\"nofollow noreferrer\">bytestring</a> -<a href=\"http://hackage.haskell.org/package/bytestring/docs/Data-ByteString-Char8.html\" rel=\"nofollow noreferrer\">Data.ByteString.Char8</a>  <a href=\"http://hackage.haskell.org/package/bytestring/docs/Data-ByteString-Char8.html\" rel=\"nofollow noreferrer\">Data.ByteString</a>  </sup>\n> O(n) Sort a ByteString efficiently, using counting sort.\n\n...\n</pre>\n\n<p>Well, you don't need anything about byte strings (or <code>Seq</code>s or other more advanced types), nor do you want to touch a module called <code>GHC.OldList</code> (this is some legacy stuff that may be used to quickly make old code compatible with new GHC versions); the <code>Data.List</code> version is apparently fine. So import that:</p>\n\n<pre><code>import Data.List (sort)\n\nmain :: IO ()\nmain = print $ sort [3,1,2]\n</code></pre>\n\n<hr>\n\n<p><sup>\u2020</sup><sub>Hayoo is one of two popular Haskell search engines and works IMO better for searching by name. The alternative, <a href=\"https://www.haskell.org/hoogle\" rel=\"nofollow noreferrer\">Hoogle</a>, is a bit more fiddly but can additionally search also <em>by type signature</em>. I recommend <a href=\"https://www.stackage.org/lts-12.21/hoogle\" rel=\"nofollow noreferrer\">the Stackage version</a>.</sub></p>\n"}], "owner": {"reputation": 71, "user_id": 8658248, "user_type": "registered", "profile_image": "https://graph.facebook.com/1512880645455403/picture?type=large", "display_name": "Erik H Nguyen", "link": "https://stackoverflow.com/users/8658248/erik-h-nguyen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1794, "favorite_count": 0, "closed_date": 1543933203, "answer_count": 1, "score": -4, "last_activity_date": 1543933195, "creation_date": 1543931342, "last_edit_date": 1543933195, "question_id": 53614403, "link": "https://stackoverflow.com/questions/53614403/haskell-sort-a-list-of-int", "closed_reason": "Duplicate", "title": "Haskell, sort a list of Int", "body": "<p>I need to sort a list of Ints, [Int]. However when I use sort it gives me error message:Variable not in scope: sort :: [Int] -> [a0] how do I get around this problem?</p>\n\n<p>my code simplified:</p>\n\n<pre><code>     data Point= P Shape Int\n     getInt (P _ i)=i\n     sorted::[Point]-&gt;[Int]\n     sorted ps= sort(map getInt ps)\n</code></pre>\n"}, {"tags": ["haskell", "monads", "lazy-sequences"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1543945381, "post_id": 53613776, "comment_id": 94097619, "body": "Your <code>frequencies</code> doesn&#39;t look right either: doesn&#39;t it always return <code>M.empty</code>? I think you want something more like <code>M.insertWith</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1543949377, "post_id": 53613776, "comment_id": 94099506, "body": "I don&#39;t know of anything inherently wrong with <code>Data.Text.Lazy</code>. Using it for lazy I/O leads to the same general problems as other lazy I/O, but just using it as a data structure shouldn&#39;t be a problem."}], "answers": [{"comments": [{"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 0, "creation_date": 1543932048, "post_id": 53614092, "comment_id": 94089880, "body": "Wow, thanks. I didn&#39;t know this existed. So for my problem in question, since I was converting a <code>[Char]</code> into an <code>Either String [Int]</code> with <code>mapM toDigit</code>, and <code>omapM</code> produces an <code>Applicative m =&gt; m Text</code>, would you recommend using <a href=\"https://hackage.haskell.org/package/mono-traversable-1.0.9.0/docs/Data-MonoTraversable.html#v:otoList\" rel=\"nofollow noreferrer\"><code>otoList</code></a> to achieve an intermediate list or stream of integers before incrementing the appropriate key-value pair in the <code>Data.Map</code> that I&#39;m producing?"}, {"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 0, "creation_date": 1543932130, "post_id": 53614092, "comment_id": 94089942, "body": "Never mind! I see <a href=\"https://hackage.haskell.org/package/mono-traversable-1.0.9.0/docs/Data-MonoTraversable.html#v:ofoldM\" rel=\"nofollow noreferrer\"><code>ofoldM</code></a>, too."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 0, "creation_date": 1543932373, "post_id": 53614092, "comment_id": 94090100, "body": "@SimonShine Yes, a fold is probably what you need. I think all standard functor/foldable/traversable functions are also available in their &quot;mono&quot; variants."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 1, "creation_date": 1543950248, "post_id": 53614092, "comment_id": 94099897, "body": "@SimonShine, you should definitely prefer a fold (either from <code>MonoFoldable</code> or just the (lazy) <code>Data.Text.Strict.foldr</code>) to a traversal when you can get away with it. <code>otraverse</code> for <code>Text</code> converts to a string and back by simple unpacking and packing; it&#39;s really quite inefficient. Traversing in <code>Maybe</code> (if that was what you were actually after) could almost certainly be done better with a low-level custom function (roughly speaking, traversing in <code>MaybeT (ST s)</code> instead). But it&#39;s better to skirt the complication altogether in this case."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1543930233, "creation_date": 1543930233, "answer_id": 53614092, "question_id": 53613776, "link": "https://stackoverflow.com/questions/53613776/monadic-folding-of-data-text/53614092#53614092", "title": "Monadic folding of Data.Text", "body": "<p><code>Text</code> can not be a <code>Traversable</code> since it is not parametrized with the type of its elements -- it always contains <code>Char</code>s, and nothing else. In other words, it is a \"monomorphic container\" instead of a polymorphic one.</p>\n\n<p>For \"monomorphic containers\" we have <a href=\"https://hackage.haskell.org/package/mono-traversable-1.0.9.0/docs/Data-MonoTraversable.html\" rel=\"nofollow noreferrer\"><code>MonoTraversable</code></a> which provides <code>omapM</code>:</p>\n\n<pre><code>omapM :: Applicative m =&gt; (Element mono -&gt; m (Element mono)) -&gt; mono -&gt; m mono \n</code></pre>\n\n<p>which means, in the case of <code>Text</code>,</p>\n\n<pre><code>omapM :: Applicative m =&gt; (Char -&gt; m Char) -&gt; Text -&gt; m Text\n</code></pre>\n"}], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 0, "accepted_answer_id": 53614092, "answer_count": 1, "score": 1, "last_activity_date": 1570351422, "creation_date": 1543929127, "last_edit_date": 1570351422, "question_id": 53613776, "link": "https://stackoverflow.com/questions/53613776/monadic-folding-of-data-text", "title": "Monadic folding of Data.Text", "body": "<p>I would like to write a function</p>\n\n<pre><code>countDigits :: Text -&gt; Either Text (Map Int Int)\n</code></pre>\n\n<p>that builds a histogram of digit characters and fails if there are non-digit characters with a message that indicates the first or all non-digit characters. If this were with <code>String</code> I could write something like</p>\n\n<pre><code>countDigits = fmap frequencies . mapM toDigit\n  where\n    frequencies :: Ord a =&gt; [a] -&gt; Map a Int\n    frequencies = M.fromListWith (+) . (`zip` [0..9])\n\n    toDigit :: Char -&gt; Either String Int\n    toDigit c = readEither [c] &lt;&gt; Left (\"Invalid digit \" ++ show c)\n</code></pre>\n\n<p>but since <code>Data.Text</code> is not <code>Foldable</code>, I cannot use <code>mapM</code>.</p>\n\n<p>In fact, it seems a little difficult to convert a <code>Data.Text</code> value into any lazy stream value. (The <a href=\"https://hackage.haskell.org/package/text-1.2.3.1/docs/Data-Text.html#g:11\" rel=\"nofollow noreferrer\">folds of <code>Data.Text.Strict</code></a> are all eager and non-monadic, and <code>Data.Text.Lazy</code> has been warned against. Is this where one pulls out <code>conduit</code> or <code>pipes</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1543925568, "post_id": 53612628, "comment_id": 94086172, "body": "I&#39;m not much above beginner at Haskell myself, so I don&#39;t offer this as an answer - but my understanding is that there is no constructor function in the standard libraries called <code>IO</code> - so <code>IO &quot;test&quot;</code> only makes sense in your code because you&#39;ve defined <code>IO</code> as a constructor of your <code>IO&#39;</code> type. So your definition of <code>fail</code> is going to cause a type error. (Expects IO String but actually gets IO&#39; String.) It seems to be that all Haskell&#39;s IO functions are constructed by &quot;magic&quot; behind the scenes (well, in C, I suspect), you can&#39;t implement them in pure Haskell."}], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 3, "last_activity_date": 1543927303, "last_edit_date": 1543927303, "creation_date": 1543926013, "answer_id": 53612857, "question_id": 53612628, "link": "https://stackoverflow.com/questions/53612628/does-haskell-hide-types-if-the-same-name-is-used-in-a-different-module/53612857#53612857", "title": "Does haskell hide types if the same name is used in a different module?", "body": "<p>You're defining two things: A type named <code>IO'</code> and a constructor named <code>IO</code>. Neither of them hide anything because the standard library defines neither a type named <code>IO'</code> (only <code>IO</code>) nor a constructor named <code>IO</code> (the standard <code>IO</code> type doesn't have any constructors). So since constructors and types live in different name spaces (meaning you can have a constructor and a type with the same name without any problems), nothing is being hidden.</p>\n\n<p>So with your definitions, you now have the types <code>IO</code> (referring to <code>Prelude.IO</code>) and <code>IO'</code> (referring to your type) and the constructor <code>IO :: a -&gt; IO' a</code>.</p>\n\n<p>Your definition of <code>fail</code> does not work because <code>IO</code> constructs a value of type <code>IO'</code>, not <code>IO</code>. There is no connection between your <code>IO</code> constructor and the <code>IO</code> type, so there is no reason this should work.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 4, "last_activity_date": 1543926909, "last_edit_date": 1543926909, "creation_date": 1543926057, "answer_id": 53612870, "question_id": 53612628, "link": "https://stackoverflow.com/questions/53612628/does-haskell-hide-types-if-the-same-name-is-used-in-a-different-module/53612870#53612870", "title": "Does haskell hide types if the same name is used in a different module?", "body": "<p>Nothing is hidden in your code.</p>\n\n<p>In Haskell, the type- and value-languages are strictly separated. Broadly speaking, everything to the right of a <code>::</code> or <code>data</code>/<code>newtype</code>/<code>type</code> keyword (except the name-declaration for value constructors) lives in the type-level language, everything else lives in the value-level language.</p>\n\n<pre><code>     \u250c\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2510        \u250c\u2500\u2510\ndata \u2502IO' a\u2502 = \u2502IO\u2502        \u2502a\u2502\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2524   \u2514value-level\u2514\u252c\u2518\n           \u2514\u2500type-level\u2500\u2500\u2500\u2500\u2500\u2518\n\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\nfail :: \u2502 IO String \u2502\n        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500type-level\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\nfail = IO \"test\" \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500value-level</code></pre>\n\n<p>The type-level <code>IO</code> is unambiguously <code>Prelude.IO</code> (because you named your type <code>IO'</code> instead), whereas the value-level <code>IO</code> is unambiguously the data constructor to <code>IO'</code> that you defined yourself (because <code>Prelude.IO</code> does not export any constructors called either <code>IO</code> or otherwise).</p>\n\n<p>Hiding would only become relevant if you actually used the same name <code>IO</code> again for the <em>type constructor</em>:</p>\n\n<pre><code>import Prelude hiding (IO)\n\ndata IO a = IO a\n\ntest :: String -&gt; IO String\ntest x = IO x \n\nconvert :: IO String -&gt; String\nconvert (IO x) =  x\n\nfail' :: IO String\nfail' = IO \"test\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": true, "score": 4, "last_activity_date": 1543926293, "creation_date": 1543926293, "answer_id": 53612959, "question_id": 53612628, "link": "https://stackoverflow.com/questions/53612628/does-haskell-hide-types-if-the-same-name-is-used-in-a-different-module/53612959#53612959", "title": "Does haskell hide types if the same name is used in a different module?", "body": "<blockquote>\n  <p>I am trying to implement a wrapper type for IO,</p>\n</blockquote>\n\n<p>You did not though. There's no reference to the <code>IO</code> type anywhere in your data declaration. </p>\n\n<blockquote>\n<pre><code>data IO' a = IO a\n</code></pre>\n</blockquote>\n\n<p>That <code>IO</code> on the right-hand side is not the type <code>IO</code>. It's not even a type. That is just the name you chose for the value constructor of your data type <code>IO'</code>. </p>\n\n<p>If you ask ghc the type of <code>IO</code> you'll get, </p>\n\n<pre><code>&gt; :t IO\nIO :: a -&gt; IO' a\n</code></pre>\n\n<p>You could have chosen any other name for it, e.g.</p>\n\n<blockquote>\n<pre><code>data IO' a = C a\n</code></pre>\n</blockquote>\n\n<p>It's just a constructor for values of type <code>IO'</code></p>\n"}], "owner": {"reputation": 1141, "user_id": 1367497, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c1ab83696683e53a9940cd2a8c480894?s=128&d=identicon&r=PG", "display_name": "peeyush singh", "link": "https://stackoverflow.com/users/1367497/peeyush-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "accepted_answer_id": 53612959, "answer_count": 3, "score": 0, "last_activity_date": 1543927303, "creation_date": 1543925201, "last_edit_date": 1543927194, "question_id": 53612628, "link": "https://stackoverflow.com/questions/53612628/does-haskell-hide-types-if-the-same-name-is-used-in-a-different-module", "title": "Does haskell hide types if the same name is used in a different module?", "body": "<p><strong>EDIT</strong></p>\n\n<p>All thee answers did explain it well enough, just one final thing, can anyone point me to the documentation about the types, so I can understand how the types are handled internally</p>\n\n<p>I am trying to implement a wrapper type for IO, to understand types. I have created a IO' type which is actually using the IO to construct.</p>\n\n<pre><code>data IO' a = IO a\n\ntest :: String -&gt; IO' String\ntest x = IO x \n\nconvert :: IO' String -&gt; String\nconvert (IO x) =  x\n\nmain = do\n        a &lt;- getLine\n        return $ convert.test $ a\n</code></pre>\n\n<p>However now if I try to use IO to return an IO action then it fails, example the following function fails giving the expected vs actual type error:</p>\n\n<pre><code>fail :: IO String\nfail = IO \"test\"\n</code></pre>\n\n<p>So in Haskell are types using same names get hidden? Also how do I understand whether I am using data constructor or type constructor when I call IO.</p>\n\n<p>Finally, seems like a silly question but I tried to find the documentation for System.IO and later for List type as well, and am not able to find it.</p>\n"}, {"tags": ["haskell", "response", "haskell-wai", "haskell-warp"], "answers": [{"tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": false, "score": 2, "last_activity_date": 1545916473, "last_edit_date": 1545916473, "creation_date": 1543942797, "answer_id": 53618012, "question_id": 53612336, "link": "https://stackoverflow.com/questions/53612336/wai-tutorial-no-instance-for-show-response/53618012#53618012", "title": "WAI tutorial - no instance for (Show Response)", "body": "<p>Running <code>plainIndex</code> in GHCi, GHCi tries to compute the <code>Response</code> and then print it in the terminal.  A <code>Show</code> instance defines how a given type should be represented as a <code>String</code>.  The library authors have chosen not to provide a <code>Show</code> instance for <code>Response</code>, probably to separate its representation from its interface.</p>\n\n<p>Various parts of a response have <code>Show</code> instances, so you can use <a href=\"http://hackage.haskell.org/package/wai-3.2.1.2/docs/Network-Wai.html#g:6\" rel=\"nofollow noreferrer\">accessors provided by Wai</a>:</p>\n\n<pre><code>&gt; responseStatus plainIndex\n&gt; responseHeaders plainIndex\n</code></pre>\n\n<p>More <a href=\"http://hackage.haskell.org/package/wai-3.2.1.2/docs/Network-Wai.html#g:4\" rel=\"nofollow noreferrer\">documentation for Response</a>.</p>\n"}], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1545916473, "creation_date": 1543924207, "last_edit_date": 1545916016, "question_id": 53612336, "link": "https://stackoverflow.com/questions/53612336/wai-tutorial-no-instance-for-show-response", "title": "WAI tutorial - no instance for (Show Response)", "body": "<p>Again the n00b here: trying Warp and WAI with the following code as in the documentation. </p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings, DeriveGeneric #-}\nimport Network.Wai\nimport Network.HTTP.Types\nimport Network.Wai.Handler.Warp (run)\napp3 :: Application\napp3 request respond = respond $ case rawPathInfo request of\n    \"/\"     -&gt; index\n    \"/raw/\" -&gt; plainIndex\n    _       -&gt; notFound\n\nplainIndex :: Response\nplainIndex = responseFile\n    status200\n    [(\"Content-Type\", \"text/plain\")]\n    \"index.html\"\n    Nothing\n\nnotFound :: Response\nnotFound = responseLBS\n    status404\n    [(\"Content-Type\", \"text/plain\")]\n    \"404 - Not Found\"\n</code></pre>\n\n<p>Running plainIndex in GHCi returns: </p>\n\n<pre><code>&lt;interactive&gt;:12:1: error:\n    \u2022 No instance for (Show Response) arising from a use of \u2018print\u2019\n    \u2022 In a stmt of an interactive GHCi command: print it\n*Main&gt; :r\n[1 of 1] Compiling Main             ( WAI.hs, interpreted )\n</code></pre>\n\n<p>Two questions in one: can you help me out fixing this, and in exension to that: I am the only one frequently encountering issues like this when following documentation examples? </p>\n"}, {"tags": ["haskell", "functional-programming", "boolean"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1543955082, "post_id": 53600930, "comment_id": 94102090, "body": "You might also like <a href=\"https://stackoverflow.com/q/45486842/791604\">Cleaner Alternative to Extensive Pattern Matching</a>."}], "answers": [{"tags": [], "owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "is_accepted": false, "score": 1, "last_activity_date": 1543867439, "creation_date": 1543867439, "answer_id": 53601064, "question_id": 53600930, "link": "https://stackoverflow.com/questions/53600930/a-function-which-simplifying-boolean-expressions/53601064#53601064", "title": "A Function which Simplifying Boolean Expressions", "body": "<p>The fundamental issue is that you're doing your <code>simplify(tt \u2227 b)</code> test on unsimplified expressions.</p>\n\n<p>The logic you're looking for would be more like:</p>\n\n<pre><code>simplify(a ^ b) | simplify(a) == tt = simplify b\n</code></pre>\n\n<p>which can be efficiently implemented by simplifying both <em>before</em> the simplifying pattern match:</p>\n\n<pre><code>simplify(b\u2081 \u2227 b\u2082) =\n  case (simplify(b\u2081), simplify(b\u2082)) of\n    (tt, x) -&gt; x\n    (x, tt) -&gt; x\n    ...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": true, "score": 3, "last_activity_date": 1543925040, "last_edit_date": 1592644375, "creation_date": 1543868124, "answer_id": 53601196, "question_id": 53600930, "link": "https://stackoverflow.com/questions/53600930/a-function-which-simplifying-boolean-expressions/53601196#53601196", "title": "A Function which Simplifying Boolean Expressions", "body": "<blockquote>\n<pre><code>simplify(b\u2081 \u2227 b\u2082) = simplify(simplify(b\u2081) \u2227 simplify(b\u2082))\n</code></pre>\n<p>will solve the problem, since it simplifies the results of conjunctions, which does actually work! But then it breaks when we have variables (it goes into an infinite loop in fact):</p>\n</blockquote>\n<p>Do you really want to recurse over <code>simplify(b\u2081) \u2227 simplify(b\u2082)</code>? Maybe you want to <code>simplify(b\u2081)</code> and <code>simplify(b\u2082)</code> and then simply operate them. As in,</p>\n<pre><code>data B = T | F | V | B :&amp;: B deriving Show\n\ns :: B -&gt; B\ns T = T\ns F = F\ns V = V\ns (b1 :&amp;: b2) = opAND (s b1) (s b2) \n\nopAND F _ = F\nopAND _ F = F \nopAND T b = b\nopAND b T = b\nopAND a b = a :&amp;: b\n</code></pre>\n<p>The simplify function <code>s</code> essentially folds your syntax tree, at each step guaranteeing that you preserve the property that the simplified expression is either atomic, or contains no occurrences of neither <code>F</code> nor <code>T</code>.</p>\n"}], "owner": {"reputation": 1306, "user_id": 5664775, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/QqQGd.jpg?s=128&g=1", "display_name": "Luke Collins", "link": "https://stackoverflow.com/users/5664775/luke-collins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 279, "favorite_count": 0, "accepted_answer_id": 53601196, "answer_count": 2, "score": 3, "last_activity_date": 1543925040, "creation_date": 1543866774, "question_id": 53600930, "link": "https://stackoverflow.com/questions/53600930/a-function-which-simplifying-boolean-expressions", "title": "A Function which Simplifying Boolean Expressions", "body": "<p>I am dealing with the following grammar, which I have implemented in the form of a Haskell <code>data</code> type.</p>\n\n<pre><code>    bool ::=   tt   |   ff   |   bool \u2227 bool   |   var        \n    var  ::=   letter{letter|digit}*\n</code></pre>\n\n<p>My question is, I would like to write a function <code>simplify :: bool \u2192 bool</code> which simplifies boolean expressions in the usual way (while doing nothing to variables). For example, I would like</p>\n\n<pre><code>    simplify(tt \u2227 ff) = ff\n    simplify(tt \u2227 x) =  x\n    simplify(x \u2227 (y \u2227 z)) = x \u2227 y \u2227 z\n</code></pre>\n\n<p>where the letters <em>x</em>, <em>y</em> and <em>z</em> are denoting variables (<code>var</code>).</p>\n\n<p>I feel that the natural definition is the following (pseudocode with pattern matching)</p>\n\n<pre><code>    simplify(tt) = tt\n    simplify(ff) = ff\n    simplify(x)  = x\n    simplify(tt \u2227 b) = simplify(b)\n    simplify(b \u2227 tt) = simplify(b)\n    simplify(b\u2081 \u2227 b\u2082) = simplify(b\u2081) \u2227 simplify(b\u2082)                (\u2020)\n</code></pre>\n\n<p>where <em>b</em>, <em>b\u2081</em> and <em>b\u2082</em> denote <em>bool</em>s, and <em>x</em> denotes a <em>var</em>.</p>\n\n<p>This definition works fine for all the given examples above. The problem is with expressions such as <code>(tt \u2227 tt) \u2227 (tt \u2227 tt)</code>. Indeed, applying the definition, we have</p>\n\n<pre><code>    simplify((tt \u2227 tt) \u2227 (tt \u2227 tt)) = simplify(tt \u2227 tt) \u2227 simplify(tt \u2227 tt) \n                                    = simplify(tt) \u2227 simplify(tt) \n                                    = tt \u2227 tt\n</code></pre>\n\n<p>which we should be able to further simplify as simply <code>tt</code>.  </p>\n\n<p>Thus maybe changing the definition line <code>(\u2020)</code> to</p>\n\n<pre><code>    simplify(b\u2081 \u2227 b\u2082) = simplify(simplify(b\u2081) \u2227 simplify(b\u2082))\n</code></pre>\n\n<p>will solve the problem, since it simplifies the results of conjunctions, which does actually work! But then it breaks when we have variables (it goes into an infinite loop in fact):</p>\n\n<pre><code>    simplify(x \u2227 y) = simplify(simplify(x) \u2227 simplify(y))   \n                    = simplify(x \u2227 y)       \n                    = ...\n</code></pre>\n\n<p>Thus my idea was to retain the old definition, but then actually simplify by finding fixed points. Indeed, the function <code>simplify' :: bool \u2192 bool</code> written in Haskell below, behaves as desired:      </p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>simplify' :: BoolExpr -&gt; BoolExpr\nsimplify' f \n    | (simplify f) == f   = f\n    | otherwise           = simplify' (simplify f)\n</code></pre>\n\n<p>It just feels like an inelegant solution to the problem, since it keeps repeatedly running a function which <em>feels like</em>, if defined correctly, needs to be run only once. I appreciate any feedback.</p>\n"}, {"tags": ["haskell", "higher-order-functions"], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 8, "last_activity_date": 1543868547, "last_edit_date": 1543868547, "creation_date": 1543867574, "answer_id": 53601090, "question_id": 53600390, "link": "https://stackoverflow.com/questions/53600390/higher-order-functions-riddle-solving-function-in-haskell/53601090#53601090", "title": "higher order functions riddle solving function in haskell", "body": "<p>I'd simplify this a little. A layer is a list of numbers:</p>\n\n<pre><code>type Layer = [Int]\n-- e.g. [4,3,1,2]\n</code></pre>\n\n<p>A rule is a list of fixed assignments to some elements.</p>\n\n<pre><code>data Must = Any | Only Int  -- Yes, it's just Maybe with different labels\n\ntype Rule = [Must]\n-- e.g. [Any,Only 3,Any,Any]\n</code></pre>\n\n<p>You'll need a function that can generate a layer from the one below it:</p>\n\n<pre><code>nextLayer :: Layer -&gt; Layer\nnextLayer = undefined\n-- nextLayer [4,3,1,2] == [7,4,3]\n</code></pre>\n\n<p>and a function to check a layer against a valid rule</p>\n\n<pre><code>isLayerValid :: Rule -&gt; Layer -&gt; Bool\nisLayerValid = undefined\n-- isLayerValid [Any,Any,Only 3] [1,2,3] == True\n-- isLayerValid [Any,Any,Only 3] [1,3,2] == False\n</code></pre>\n\n<p>A riddle is just a list of rules:</p>\n\n<pre><code>type Riddle = [Rule]\nriddle :: Riddle\nriddle = [[Any, Only 3, Any, Any], [Any, Any, Only 3], [Any, Any], [Any]]\n</code></pre>\n\n<p>and a solution is a list of layers starting from some base.</p>\n\n<pre><code>type Pyramid = [Layer]\npyramid :: Layer -&gt; Pyramid\npyramid [] = []\npyramid base = base : pyramid (nextLayer base)\n-- pyramid [4,3,1,2] == [[4,3,1,2],[7,4,3],[11,7],[18]]\n</code></pre>\n\n<p>A <em>correct</em> solution is one that validates against a given riddle:</p>\n\n<pre><code>isValidFor :: Riddle -&gt; Pyramid -&gt; Bool\nisValidFor [] [] = True\nisValidFor (r:rs) (x:xs) = isLayerValid r x &amp;&amp; isValidFor rs xs\n-- isValidFor riddle (pyramid [4,3,1,2]) == True\n-- isValidFor riddle (pyramid [1,3,4,2]) == False\n</code></pre>\n\n<p>The trick now is to generate all potential solutions</p>\n\n<pre><code>permutations :: [Int] -&gt; [[Int]]\npermutations ns = undefined\n\n-- e.g. allSolutions = map pyramid (permutations [1..n])\n</code></pre>\n\n<p>and filter them using your solution test:</p>\n\n<pre><code>solutions :: Riddle -&gt; [Pyramid]\nsolutions r = filter (isValidFor r) (map pyramid (permutations [1..length r]))\n-- solutions riddle == [pyramid [4,3,1,2], pyramid [4,3,2,1]]\n</code></pre>\n"}], "owner": {"reputation": 996, "user_id": 7907300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e028848530c7b0b75a1142879de5a48?s=128&d=identicon&r=PG&f=1", "display_name": "cheshire", "link": "https://stackoverflow.com/users/7907300/cheshire"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 188, "favorite_count": 0, "accepted_answer_id": 53601090, "answer_count": 1, "score": 4, "last_activity_date": 1543868581, "creation_date": 1543864530, "last_edit_date": 1543868581, "question_id": 53600390, "link": "https://stackoverflow.com/questions/53600390/higher-order-functions-riddle-solving-function-in-haskell", "title": "higher order functions riddle solving function in haskell", "body": "<p>I am trying to recreate a riddle with pyramid:</p>\n\n<p><a href=\"https://i.stack.imgur.com/s9UKl.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/s9UKl.png\" alt=\"Illustration 1\"></a></p>\n\n<p>The last layer of the pyramid is the permutation of the numbers from 1 to n, where n is the number of fields.  Then every other field that is not in the lowest layer is the sum of the numbers diagonally under that number. </p>\n\n<p>So I want to make a function that when given the riddle on the left returns solutions on the right.  I was planning to do that by enumerating layers like this: </p>\n\n<p><a href=\"https://i.stack.imgur.com/x6cQd.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/x6cQd.png\" alt=\"Enumerating Pyramid\"></a></p>\n\n<p>for the layers I made a custom data type: </p>\n\n<pre><code>data Layer = One | Two | Three | Four | Five | Six\nderiving (Eq,Ord,Enum,Show)\n</code></pre>\n\n<p>and other types: </p>\n\n<pre><code>type LayerDepth = Layer\ntype FieldNumber = Int\ntype FieldContent = Int\ntype FieldAssignment = (FieldNumber -&gt; FieldContent)\ntype PyramidRiddle = FieldAssignment\ntype PyramidSolution = FieldAssignment\ntype PyramidSolutions = [PyramidSolution]\n</code></pre>\n\n<p>and the function: </p>\n\n<pre><code>solveRiddle :: LayerDepth -&gt; PyramidRiddle -&gt; Pyramidsolutions\n</code></pre>\n\n<p>for the illustrated example I would make anonymous function of type (FieldNumber -> FieldContent): </p>\n\n<pre><code>fieldAssignment1 = \\n -&gt; if (n==6) || n==8) then 3 else 0\n</code></pre>\n\n<p>This function will mark 6th and 8th field with number 3</p>\n\n<p>Then calling: \n<code>solveRiddle Four fieldAssignment1 -&gt;&gt; [pyramidSolution1, pyramidSolution2]</code></p>\n\n<p>Four means four layers, and PyramidSolutions is the list of FieldAssignments that has a solutions of the riddle</p>\n\n<p><strong>My problem:</strong> </p>\n\n<p>I would somehow need to return a function that will given the field assignment calculate the permutations in the last layer and based on that assign the numbers to the rest of fields. </p>\n\n<p>Somehow like this:</p>\n\n<pre><code>pyramidSolution1 = \\n -&gt; case n of 1 -&gt; 18\n                                   2 -&gt; 11 \n                                   3 -&gt; 7\n                                   4 -&gt; 7 \n                                   5 -&gt; 4 \n                                   6 -&gt; 3 \n                                   7 -&gt; 4 \n                                   8 -&gt; 3 \n                                   9 -&gt; 1 \n                                  10 -&gt; 2\n                                   _ -&gt; 0 \n</code></pre>\n\n<p>and </p>\n\n<pre><code>pyramidSolution2 = \\n -&gt; case n of 1 -&gt; 20\n                                   2 -&gt; 12 \n                                   3 -&gt; 8\n                                   4 -&gt; 7 \n                                   5 -&gt; 5 \n                                   6 -&gt; 3 \n                                   7 -&gt; 4 \n                                   8 -&gt; 3 \n                                   9 -&gt; 2 \n                                  10 -&gt; 1\n                                   _ -&gt; 0 \n</code></pre>\n\n<p><strong>But what is the best way to approach this?</strong></p>\n\n<p>How do I assign a permutation of the numbers and know how to place them that the number up is the sum of the numbers bellow?</p>\n\n<p>What is the best way to implement the anonymous function pyramidSolution1 and pyramidSolution2 into the code above?</p>\n"}, {"tags": ["haskell", "gadt"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1543858599, "post_id": 53598813, "comment_id": 94060332, "body": "Indeed, without any connection between <code>b</code> and <code>as</code>, it is not very useful. It is similar to <code>Call :: String -&gt; [SomeExpr] -&gt; Expr b</code> where <code>SomeExpr</code> is an existential wrapper which hides the <code>a</code> index (essentially rebuilding the non-GADT original type). Still, without much more information on function names, this is the best we can do."}, {"owner": {"reputation": 87, "user_id": 1393858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ccb10f4226a60fcfc2360d6452a8ae4?s=128&d=identicon&r=PG", "display_name": "CT075", "link": "https://stackoverflow.com/users/1393858/ct075"}, "edited": false, "score": 0, "creation_date": 1543863156, "post_id": 53598813, "comment_id": 94062469, "body": "Thanks, I think this is the solution I was looking for. By the nature of the project, I don&#39;t think we can really get more information about the functions at compile-time (this DSL is meant to model an intermediate form of a language like Java)."}], "tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": true, "score": 2, "last_activity_date": 1543858001, "creation_date": 1543858001, "answer_id": 53598813, "question_id": 53598473, "link": "https://stackoverflow.com/questions/53598473/how-to-represent-a-variable-typed-constructor-list-with-gadts/53598813#53598813", "title": "How to represent a variable-typed constructor list with GADTs?", "body": "<p>You can make another GADT with represent argument lists using type-level lists like this:</p>\n\n<pre><code>{-# LANGUAGE GADTs           #-}\n{-# LANGUAGE KindSignatures  #-}\n{-# LANGUAGE DataKinds       #-}\n{-# LANGUAGE TypeOperators   #-}\n{-# LANGUAGE PatternSynonyms #-}\n\ndata ArgList (as :: [*]) where\n  NilArgList :: ArgList '[]\n  ConsArg    :: Expr a -&gt; ArgList as -&gt; ArgList (a ': as)\n\ndata Expr a where\n  IntConst  :: Int -&gt; Expr Int\n  BoolConst :: Bool -&gt; Expr Bool\n  Plus      :: Expr Int -&gt; Expr Int -&gt; Expr Int\n  Times     :: Expr Int -&gt; Expr Int -&gt; Expr Int\n  AndAlso   :: Expr Bool -&gt; Expr Bool -&gt; Expr Bool\n  Call      :: String -&gt; ArgList as -&gt; Expr b\n\npattern x :^ y = ConsArg x y\ninfixr :^\n\nexample :: Expr Int\nexample =\n  Call \"exampleFn\" (IntConst 1 :^ BoolConst True :^ NilArgList\n                        :: ArgList [Int, Bool])\n</code></pre>\n\n<p>You will need to give some explicit type signatures for argument lists (like in <code>example</code>). Also, the result type of <code>Call</code> (<code>forall b. Expr b</code>) is a bit awkward, but I'm not sure that can be avoided unless you have more type information than <code>String</code> for the function it takes in. If you had more information there, you could also potentially relate the argument types (<code>as</code>) to the expected argument types for the function. I think we need more details about the specific situation you have to go any further with that part though.</p>\n"}, {"tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": false, "score": 3, "last_activity_date": 1543861197, "last_edit_date": 1543861197, "creation_date": 1543859338, "answer_id": 53599133, "question_id": 53598473, "link": "https://stackoverflow.com/questions/53598473/how-to-represent-a-variable-typed-constructor-list-with-gadts/53599133#53599133", "title": "How to represent a variable-typed constructor list with GADTs?", "body": "<p>Perhaps you don't need to go the dependent route for what you want. How about a solution where you separate both building and calling functions. This allows you to type your functions when building them, so you can have type-checked calls.</p>\n\n<pre><code>data Expr a where\n     IntConst  :: Int -&gt; Expr Int\n     BoolConst :: Bool -&gt; Expr Bool\n     Plus      :: Expr Int -&gt; Expr Int -&gt; Expr Int\n     Times     :: Expr Int -&gt; Expr Int -&gt; Expr Int\n     AndAlso   :: Expr Bool -&gt; Expr Bool -&gt; Expr Bool\n     Fun       :: String -&gt; Expr (a-&gt;b)\n     Call      :: Expr (a-&gt;b) -&gt; Expr a -&gt; Expr b\n\n-- type checks\ntest = Call (Fun \"f\" :: Expr (Int -&gt; Int)) (IntConst 1)\n\n-- doesn't type check\ntest' = Call (Fun \"f\" :: Expr (Int -&gt; Int)) (BoolConst False) \n</code></pre>\n\n<p>For functions with multiple arguments you can either work in a curried fashion with multiple calls, i.e. </p>\n\n<pre><code> Call (Call (Fun \"f\" :: Expr (Int-&gt;Int-&gt;Int)) (IntConst 1)) (IntConst 1) \n</code></pre>\n\n<p>Or you could implement tuples in your language.</p>\n"}], "owner": {"reputation": 87, "user_id": 1393858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ccb10f4226a60fcfc2360d6452a8ae4?s=128&d=identicon&r=PG", "display_name": "CT075", "link": "https://stackoverflow.com/users/1393858/ct075"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 2, "accepted_answer_id": 53598813, "answer_count": 2, "score": 4, "last_activity_date": 1543862324, "creation_date": 1543856686, "last_edit_date": 1543862324, "question_id": 53598473, "link": "https://stackoverflow.com/questions/53598473/how-to-represent-a-variable-typed-constructor-list-with-gadts", "title": "How to represent a variable-typed constructor list with GADTs?", "body": "<p>I'm implementing a small DSL for a research project I'm involved with. Since this is the example for almost literally every explanation of GADTs out there, I decided that this would be a good time to really get started on using them. The obvious expressions (arithmetic, etc) worked out fine, but my DSL needs to support user-defined functions, which is where I ran into an issue.</p>\n\n<p>With no GADTs, the structure of my expression type looked somewhat like this (condensed to a minimal example):</p>\n\n<pre><code>data Expr = IntConst Int\n          | BoolConst Bool\n          | Plus Expr Expr\n          | Times Expr Expr -- etc\n          | AndAlso Expr Expr -- etc\n          | Call String [Expr] -- function call!\n</code></pre>\n\n<p>Converted to GADTs, how can I express the <code>Call</code> rule?</p>\n\n<pre><code>data Expr a where\n     IntConst :: Int -&gt; Expr Int\n     BoolConst :: Bool -&gt; Expr Bool\n     Plus :: Expr Int -&gt; Expr Int -&gt; Expr Int\n     Times :: Expr Int -&gt; Expr Int -&gt; Expr Int\n     AndAlso :: Expr Bool -&gt; Expr Bool -&gt; Expr Bool\n     Call :: ???\n</code></pre>\n\n<p>My first thought was that this is impossible without some super fancy dependent types, because there's no way to know what types a given user function will accept (also the return type, but I can fix that by making <code>Call</code> return <code>Expr a</code> and specializing at the construction site). I can force it to typecheck by \"erasing\" the type, by adding rules</p>\n\n<pre><code>     EraseInt :: Expr Int -&gt; Expr a\n     EraseBool :: Expr Bool -&gt; Expr a\n</code></pre>\n\n<p>but then it seems that I lose the benefit of having GADTs in the first place. I was also thinking there might be some other <code>rankN</code> polymorphism I could use in <code>Call</code> (something something existential types?), but nothing I came up with seemed to work.</p>\n\n<p>Help?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 1, "creation_date": 1543856809, "post_id": 53598472, "comment_id": 94059504, "body": "<code>ands</code> all comparisons <code>x &lt;= y</code> for all consecutive values, so it checks whether the list is sorted or not."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1543857337, "post_id": 53598536, "comment_id": 94059731, "body": "I always found the <code>and</code> and <code>or</code> functions kind of unfortunately named. Usually, the formulation with <code>all</code> / <code>any</code> reads nicer, as in: <code>sorted = all (uncurry (&lt;=)) . pairs</code>."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 7, "last_activity_date": 1543856914, "last_edit_date": 1592644375, "creation_date": 1543856914, "answer_id": 53598536, "question_id": 53598472, "link": "https://stackoverflow.com/questions/53598472/what-does-and-do-in-this-function/53598536#53598536", "title": "What does &quot;and&quot; do in this function?", "body": "<p>It calls the <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:and\" rel=\"noreferrer\"><code>and</code> function from the standard library</a>:</p>\n<blockquote>\n<pre><code>and :: Foldable t =&gt; t Bool -&gt; Bool\n</code></pre>\n<p><code>and</code> returns the conjunction of a container of Bools. For the result to be <code>True</code>, the container must be finite; <code>False</code>, however, results from a <code>False</code> value finitely far from the left end.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 10701406, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--MRaG7-x9mE/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-i6GhCXoOo14bQ72mVkBWsq42pMPg/mo/photo.jpg?sz=128", "display_name": "Chiu", "link": "https://stackoverflow.com/users/10701406/chiu"}, "is_accepted": false, "score": 0, "last_activity_date": 1543943991, "creation_date": 1543943991, "answer_id": 53618340, "question_id": 53598472, "link": "https://stackoverflow.com/questions/53598472/what-does-and-do-in-this-function/53618340#53618340", "title": "What does &quot;and&quot; do in this function?", "body": "<pre><code>[x &lt;= y | (x,y) &lt;- pairs xs]\n</code></pre>\n\n<p>For the above snippet, it actually is a list of bool values (note that this is surrounded by \"[ ]\")</p>\n\n<p>What <code>and</code> does is it takes in the list of bool values, simply apply the logic of \"and\" to all the values, then return a bool value.</p>\n\n<p>So, for example, if we supply a list [True, True, True] to <code>and</code>, then True will be returned. If any one of the elements in the list is False, then False will be returned.</p>\n"}], "owner": {"reputation": 113, "user_id": 5169594, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9b4f9deed7c1533d605bc3efb42e3604?s=128&d=identicon&r=PG&f=1", "display_name": "Kemal", "link": "https://stackoverflow.com/users/5169594/kemal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 53598536, "answer_count": 2, "score": -2, "last_activity_date": 1543943991, "creation_date": 1543856685, "question_id": 53598472, "link": "https://stackoverflow.com/questions/53598472/what-does-and-do-in-this-function", "title": "What does &quot;and&quot; do in this function?", "body": "<p>\"sorted\" is a function to check if a list in sorted in ascending order.</p>\n\n<pre><code>pairs :: [a] -&gt; [(a,a)]\npairs xs = zip xs (tail xs)\n\nsorted :: Ord a =&gt; [a] -&gt; Bool\nsorted xs = and [x &lt;= y | (x,y) &lt;- pairs xs]\n</code></pre>\n\n<p>I am wondering what does \"and\" do in sorted xs?</p>\n"}, {"tags": ["json", "haskell", "serialization", "bytestring", "aeson"], "answers": [{"comments": [{"owner": {"reputation": 932, "user_id": 6629874, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/3SUbo.jpg?s=128&g=1", "display_name": "5ndG", "link": "https://stackoverflow.com/users/6629874/5ndg"}, "edited": false, "score": 0, "creation_date": 1543861939, "post_id": 53598941, "comment_id": 94061888, "body": "Thanks, it works! Why is it better to use a newtype wrapper for ByteString?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 932, "user_id": 6629874, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/3SUbo.jpg?s=128&g=1", "display_name": "5ndG", "link": "https://stackoverflow.com/users/6629874/5ndg"}, "edited": false, "score": 2, "creation_date": 1543862157, "post_id": 53598941, "comment_id": 94061986, "body": "Mosty for the same reason you don&#39;t define <code>Monoid</code> for <code>Int</code>, as there are <i>lots</i> of ways you can define a monoid over the integers (<code>+</code> with 0, <code>*</code> with 1<code>, etc). Likewise, this is *a* way you could encode a </code>ByteString` value, but it&#39;s not the <i>only</i> way, so you &quot;localize&quot; the instances to your data type."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 3, "last_activity_date": 1543876056, "last_edit_date": 1543876056, "creation_date": 1543858569, "answer_id": 53598941, "question_id": 53597364, "link": "https://stackoverflow.com/questions/53597364/haskell-aeson-json-encoding-bytestrings/53598941#53598941", "title": "Haskell Aeson json encoding bytestrings", "body": "<p><code>parseJson</code> needs to return a value of type <code>Parser B.ByteString</code>, so you just need to call <code>pure</code> on the return value of <code>B64.decode</code>.</p>\n\n<pre><code>import Control.Monad\n\n-- Generalized to any MonadPlus instance, not just Either String\ntextToByteString :: MonadPlus m =&gt;  T.Text -&gt; m B.ByteString\ntextToByteString = case B64.decode (E.encodeUtf8 x) of\n                     Left _ -&gt; mzero\n                     Right bs -&gt; pure bs\n\ninstance J.FromJSON B.ByteString where\n  parseJSON (J.String x) = textToByteString x\n  parseJSON _ = mzero\n</code></pre>\n\n<p>Here, I've chosen to return <code>mzero</code> both if you try to decode anything other than a JSON string and if there is a problem with the base-64 decoding.</p>\n\n<p>Likewise, <code>toJSON</code> needs just needs to encode the <code>Text</code> value you create from the base64-encoded ByteString.</p>\n\n<pre><code>instance J.ToJSON B.ByteString where\n  toJSON = J.toJSON . byteStringToText\n</code></pre>\n\n<hr>\n\n<p>You might want to consider using a newtype wrapper instead of defining the <code>ToJSON</code> and <code>FromJSON</code> instances on <code>B.ByteString</code> directly.</p>\n"}], "owner": {"reputation": 932, "user_id": 6629874, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/3SUbo.jpg?s=128&g=1", "display_name": "5ndG", "link": "https://stackoverflow.com/users/6629874/5ndg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 443, "favorite_count": 1, "accepted_answer_id": 53598941, "answer_count": 1, "score": -1, "last_activity_date": 1543876056, "creation_date": 1543852704, "question_id": 53597364, "link": "https://stackoverflow.com/questions/53597364/haskell-aeson-json-encoding-bytestrings", "title": "Haskell Aeson json encoding bytestrings", "body": "<p>I need to serialize a record in Haskell, and am trying to do it with <a href=\"http://hackage.haskell.org/package/aeson-1.4.2.0/docs/Data-Aeson.html#v:parseJSON\" rel=\"nofollow noreferrer\">Aeson</a>.  The problem is that some of the fields are ByteStrings, and I can't work out from the examples how to encode them.  My idea is to first convert them to text via base64.  Here is what I have so far (I put 'undefined' where I didn't know what to do):</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\n\nimport qualified Data.Aeson as J\nimport qualified Data.ByteString as B\nimport qualified Data.ByteString.Base64 as B64\nimport qualified Data.Text as T\nimport qualified Data.Text.Encoding as E\nimport qualified GHC.Generics as G\n\ndata Data = Data\n  { number :: Int\n  , bytestring :: B.ByteString\n  } deriving (G.Generic, Show)\n\ninstance J.ToJSON Data where\n  toEncoding = J.genericToEncoding J.defaultOptions\n\ninstance J.FromJSON Data\n\ninstance J.FromJSON B.ByteString where\n  parseJSON = undefined\n\ninstance J.ToJSON B.ByteString where\n  toJSON = undefined\n\nbyteStringToText :: B.ByteString -&gt; T.Text\nbyteStringToText = E.decodeUtf8 . B64.encode\n\ntextToByteString :: T.Text -&gt; B.ByteString\ntextToByteString txt =\n  case B64.decode . E.encodeUtf8 $ txt of\n    Left err -&gt; error err\n    Right bs -&gt; bs\n\nencodeDecode :: Data -&gt; Maybe Data\nencodeDecode = J.decode . J.encode\n\nmain :: IO ()\nmain = print $ encodeDecode $ Data 1 \"A bytestring\"\n</code></pre>\n\n<p>It would be good if it was not necessary to manually define new instances of ToJSON and FromJSON for every record, because I have quite a few different records with bytestrings in them.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 2, "creation_date": 1543851818, "post_id": 53596801, "comment_id": 94056793, "body": "That sounds like a GHC bug."}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 0, "creation_date": 1543924816, "post_id": 53596801, "comment_id": 94085775, "body": "<code>Could not deduce: Embed t ~ t</code>: Do you want that to hold? You don&#39;t have any instances for <code>Embeddable</code>, nor any constraints to require it to hold. Also in your proposed instance for <code>Embeddable Bool</code>, it doesn&#39;t hold. <code>(Coercible (Fam (MyNewtype t)) (Fam t))</code> constraint on <code>myfunDef</code> I think will need an infinite type  <code>MyNewtype t ~ t</code>. Data families are injective."}, {"owner": {"reputation": 85, "user_id": 4106574, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b8bef30d5feb5acfe810f90ced7ccd?s=128&d=identicon&r=PG", "display_name": "tailcalled", "link": "https://stackoverflow.com/users/4106574/tailcalled"}, "edited": false, "score": 0, "creation_date": 1543929657, "post_id": 53596801, "comment_id": 94088474, "body": "I don&#39;t want <code>Embed t ~ t</code> to hold, but I don&#39;t understand why it requires it to hold. In my proposed instance for <code>MyClass Bool</code>, <code>Fam Bool</code> should be represented as <code>Fam (Embed Bool)</code>, i.e. <code>Fam Int</code>; while <code>Fam (MyNewtype Bool)</code> should also be represented as <code>Fam (Embed Bool)</code>; so I&#39;d think they would be coercible to each other."}], "owner": {"reputation": 85, "user_id": 4106574, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b8bef30d5feb5acfe810f90ced7ccd?s=128&d=identicon&r=PG", "display_name": "tailcalled", "link": "https://stackoverflow.com/users/4106574/tailcalled"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 73, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1543850847, "creation_date": 1543850847, "question_id": 53596801, "link": "https://stackoverflow.com/questions/53596801/coercing-function-using-type-families-leads-to-constraint-error", "title": "Coercing function using type families leads to constraint error", "body": "<p>Suppose I have some type class with a type family:</p>\n\n<pre><code>class MyClass t where\n    data Fam t :: *\n    myfun :: t -&gt; Fam t\ninstance MyClass Int where\n    newtype Fam Int = Triv Int\n    myfun = Triv\n</code></pre>\n\n<p>(Simplified a lot compared to my actual use-case to avoid clutter.)</p>\n\n<p>Now suppose I want to provide a default implementation for any type that can be embedded into something that is already an instance of the type class. I would think I could write something like this:</p>\n\n<pre><code>class (MyClass (Embed t)) =&gt; Embeddable t where\n    type Embed t :: *\n    embed :: t -&gt; Embed t\nnewtype MyNewtype t = MyConstructor t\ninstance (Embeddable t) =&gt; MyClass (MyNewtype t) where\n    newtype Fam (MyNewtype t) = MyFam (Fam (Embed t))\n    myfun (MyConstructor x) = MyFam (myfun . embed $ x)\nmyfunDef :: forall t. (Coercible (Fam (MyNewtype t)) (Fam t)) =&gt; t -&gt; Fam t\nmyfunDef = coerce (myfun :: MyNewtype t -&gt; Fam (MyNewtype t))\n</code></pre>\n\n<p>The problem is that this doesn't compile:</p>\n\n<pre><code> \u2022 Could not deduce: Embed t ~ t arising from a use of \u2018coerce\u2019\n      from the context: Coercible (Fam (MyNewtype t)) (Fam t)\n        bound by the type signature for:\n                   myfunDef :: forall t.\n                               Coercible (Fam (MyNewtype t)) (Fam t) =&gt;\n                               t -&gt; Fam t\n        at src/Lib.hs:22:1-75\n      \u2018t\u2019 is a rigid type variable bound by\n        the type signature for:\n          myfunDef :: forall t.\n                      Coercible (Fam (MyNewtype t)) (Fam t) =&gt;\n                      t -&gt; Fam t\n        at src/Lib.hs:22:1-75\n    \u2022 In the expression:\n        coerce (myfun :: MyNewtype t -&gt; Fam (MyNewtype t))\n      In an equation for \u2018myfunDef\u2019:\n          myfunDef = coerce (myfun :: MyNewtype t -&gt; Fam (MyNewtype t))\n    \u2022 Relevant bindings include\n        myfunDef :: t -&gt; Fam t (bound at src/Lib.hs:23:1)\n   |\n23 | myfunDef = coerce (myfun :: MyNewtype t -&gt; Fam (MyNewtype t))\n   |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>I can't figure out why this error is there or how to solve it.</p>\n\n<p>If it had compiled, I had intended to use it like so:</p>\n\n<pre><code>instance Embeddable Bool where\n    type Embed Bool = Int\n    embed False = 0\n    embed True = 1\ninstance MyClass Bool where\n    newtype Fam Bool = BoolFam (Fam (Embed Bool))\n    myfun = myfunDef\n</code></pre>\n\n<p>Obviously in this case <code>MyClass Bool</code> would have been relatively simple to implement directly, but imagine a case where it had been more complicated.</p>\n"}, {"tags": ["algorithm", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1543856970, "post_id": 53596232, "comment_id": 94059578, "body": "Can we assume that <code>myPredicate x y</code> = <code>myPredicate y x</code> (asking since you say &quot;this could be an arbitrary function that takes two integers and returns a boolean&quot;)?"}, {"owner": {"reputation": 373, "user_id": 8399495, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d4dcf7abc7d47d4c9e4f563f4964d0c?s=128&d=identicon&r=PG&f=1", "display_name": "Sarp Ba\u015faraner", "link": "https://stackoverflow.com/users/8399495/sarp-ba%c5%9faraner"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1543909834, "post_id": 53596232, "comment_id": 94077463, "body": "@DavidYoung yes, in my case"}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1543849894, "post_id": 53596316, "comment_id": 94055611, "body": "This will include reversals (<code>(2312, 8000)</code> and <code>(8000, 2312)</code>) as well as duplicates (<code>(8000, 8000)</code>), which the question seems to preclude."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543851525, "post_id": 53596316, "comment_id": 94056593, "body": "@chepner the question seems to say nothing about this. What result would one expect if the input list is <code>[3000, 3000]</code> and why?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543851769, "post_id": 53596316, "comment_id": 94056763, "body": "I&#39;m simply going by the OP&#39;s example output."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543852223, "post_id": 53596316, "comment_id": 94057004, "body": "@chepner I ignored the example and went with the question as worded. The example is inadequate because if doesn&#39;t explain what to do with <code>[3000, 3000]</code>. I should have mentioned this in the answer though."}], "tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": false, "score": 5, "last_activity_date": 1543862315, "last_edit_date": 1543862315, "creation_date": 1543849024, "answer_id": 53596316, "question_id": 53596232, "link": "https://stackoverflow.com/questions/53596232/filtering-with-a-predicate-that-takes-2-arguments/53596316#53596316", "title": "Filtering with a predicate that takes 2 arguments", "body": "<p>This is supported by Haskell syntax directly.</p>\n\n<pre><code>[(x, y) | x &lt;- myList, y &lt;- myList, x + y &gt; 20000]\n</code></pre>\n\n<p>This will return reversed and repeated pairs. If that's not what you need, consider these list comprehensions:</p>\n\n<pre><code>[(x, y) | x &lt;- myList, y &lt;- myList, x &lt; y, x + y &gt; 20000] -- no reversed pairs, no repeats\n\n[(x, y) | x &lt;- myList, y &lt;- myList, x &lt;= y, x + y &gt; 20000] -- repeats, no reversed pairs\n</code></pre>\n\n<p>If for some reason unknown to science you have a list with duplicate elements, say <code>[30000,30000]</code> <em>and you want only elements at different positions to form valid pairs</em>, then this simple list comprehension won't work. I have no idea what kind of real life problem would require this, but here you are:</p>\n\n<pre><code>[(y,z) | (y:ys) &lt;- tails xs, z &lt;- ys, y + z &gt; 20000]\n</code></pre>\n\n<p>(idea stolen from the other answer)</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 3, "creation_date": 1543849864, "post_id": 53596483, "comment_id": 94055591, "body": "... or <code>[ [y,z] | (y:ys) &lt;- tails xs, z &lt;- ys, myPredicate&#39; y z]</code>. :)"}], "tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": true, "score": 5, "last_activity_date": 1543849725, "creation_date": 1543849725, "answer_id": 53596483, "question_id": 53596232, "link": "https://stackoverflow.com/questions/53596232/filtering-with-a-predicate-that-takes-2-arguments/53596483#53596483", "title": "Filtering with a predicate that takes 2 arguments", "body": "<p>If I understood you correctly you want to construct the list of pairs, </p>\n\n<pre><code>pairs xs = [(y,z) | (y:ys) &lt;- tails xs, z &lt;- ys]\n</code></pre>\n\n<p>and then filter it out using your predicate which needs to be in uncurried form, </p>\n\n<pre><code>myPredicate' :: (Int,Int) -&gt; Bool\nmyPredicate' x y = x + y &gt; 10000\n</code></pre>\n\n<p>so, </p>\n\n<pre><code>filter myPredicate' (pairs list)\n</code></pre>\n\n<p>or equivalently</p>\n\n<pre><code>filter (uncurry myPredicate) (pairs list)\n</code></pre>\n"}], "owner": {"reputation": 373, "user_id": 8399495, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d4dcf7abc7d47d4c9e4f563f4964d0c?s=128&d=identicon&r=PG&f=1", "display_name": "Sarp Ba\u015faraner", "link": "https://stackoverflow.com/users/8399495/sarp-ba%c5%9faraner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 0, "accepted_answer_id": 53596483, "answer_count": 2, "score": 3, "last_activity_date": 1543862315, "creation_date": 1543848760, "last_edit_date": 1543849160, "question_id": 53596232, "link": "https://stackoverflow.com/questions/53596232/filtering-with-a-predicate-that-takes-2-arguments", "title": "Filtering with a predicate that takes 2 arguments", "body": "<p>What I want would basically be a O(n^2) iteration over a list. Let's say I have a list of two integers,</p>\n\n<pre><code>let list = [2312, 8000, 3456, 7000, 1234]\n</code></pre>\n\n<p>and a function to check if adding two integers together would produce a result higher than 20000 (this could be an arbitrary function that takes two integers and returns a boolean).</p>\n\n<pre><code>myPredicate :: Int -&gt; Int -&gt; Bool\nmyPredicate x y = x + y &gt; 10000\n</code></pre>\n\n<p>Is there a way to apply this predicate to the above list to get a list of lists that include valid pairs, like this:</p>\n\n<pre><code>&gt;&gt; filter myPredicate list\n&gt;&gt; [[2312, 8000], [3456, 8000], [3456, 7000], [8000, 7000]]\n</code></pre>\n"}, {"tags": ["git", "haskell"], "comments": [{"owner": {"reputation": 91788, "user_id": 354577, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/dI6cA.jpg?s=128&g=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/354577/chris"}, "edited": false, "score": 0, "creation_date": 1543845184, "post_id": 53594760, "comment_id": 94052833, "body": "What do you mean by &quot;where I could really extract these libs but locally on the same git repository&quot;?"}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1543845279, "post_id": 53594760, "comment_id": 94052893, "body": "So you want them in the same repository but in a different repository."}], "answers": [{"tags": [], "owner": {"reputation": 605, "user_id": 7179161, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh6.googleusercontent.com/-okC4oO7pOyk/AAAAAAAAAAI/AAAAAAAACVU/NjHIR2HSwCQ/photo.jpg?sz=128", "display_name": "Tom", "link": "https://stackoverflow.com/users/7179161/tom"}, "is_accepted": false, "score": 0, "last_activity_date": 1543852265, "creation_date": 1543852265, "answer_id": 53597247, "question_id": 53594760, "link": "https://stackoverflow.com/questions/53594760/working-with-multiple-projects-on-the-same-stack-git-ide-environnement/53597247#53597247", "title": "Working with multiple projects on the same stack/git/IDE environnement", "body": "<p>You can create a new repo for the libraries with this technique: <a href=\"https://help.github.com/articles/splitting-a-subfolder-out-into-a-new-repository/\" rel=\"nofollow noreferrer\">https://help.github.com/articles/splitting-a-subfolder-out-into-a-new-repository/</a></p>\n\n<p>Then you can import this repo in the original one as a submodule: <a href=\"https://chrisjean.com/git-submodules-adding-using-removing-and-updating/\" rel=\"nofollow noreferrer\">https://chrisjean.com/git-submodules-adding-using-removing-and-updating/</a></p>\n"}, {"tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": false, "score": 0, "last_activity_date": 1543856722, "creation_date": 1543856722, "answer_id": 53598484, "question_id": 53594760, "link": "https://stackoverflow.com/questions/53594760/working-with-multiple-projects-on-the-same-stack-git-ide-environnement/53598484#53598484", "title": "Working with multiple projects on the same stack/git/IDE environnement", "body": "<p>There are several different notions of \"project\" here:</p>\n\n<ul>\n<li>git repo</li>\n<li>stack project (defined by a <code>stack.yaml</code>)</li>\n<li>cabal project (defined by a <code>project-name.cabal</code>)</li>\n<li>library / executable</li>\n</ul>\n\n<p>It is quite reasonable to start with the simple one-to-one structure where you have exactly one of each of these, and later break things up.</p>\n\n<ul>\n<li>One git repo makes it easy to keep changes in sync; multiple repos make it easy to give different people commit access, or reflect looser coupling between teams</li>\n<li>one stack project makes it easy to use the same versions of dependencies for all your code; multiple projects make it easy to update different programs / libraries at different times</li>\n<li>If you're using <code>stack</code>, I don't think it makes much difference whether you keep executables in separate cabal projects or all together.  If you want to publish libraries on Hackage, you'll want each in its own cabal project.</li>\n</ul>\n\n<p>The <a href=\"https://docs.haskellstack.org/en/stable/yaml_configuration/\" rel=\"nofollow noreferrer\">stack docs</a> explain how to include multiple cabal projects in one stack project.  These can be beneath the directory containing <code>stack.yaml</code>, or not.  So if you want, you can move in steps:</p>\n\n<ul>\n<li>from one cabal project to several</li>\n<li>from one git repo to several, using a path to the local checkout in <code>stack.yaml</code> to build against whatever you currently have checked out</li>\n<li>to a git repo &amp; commit hash in the <code>stack.yaml</code>, so anyone building will get the same version of the library repo</li>\n</ul>\n"}], "owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 76, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1543856722, "creation_date": 1543843268, "question_id": 53594760, "link": "https://stackoverflow.com/questions/53594760/working-with-multiple-projects-on-the-same-stack-git-ide-environnement", "title": "Working with multiple projects on the same stack/git/IDE environnement", "body": "<p>I'm building a project in Haskell and as this project is growing, some libs emerge and could be extracted in different git repository. So far, these libs are at the root of my project, Is there a way (like an intermediate step) where I could really extract these libs but locally on the same git repository ?</p>\n"}, {"tags": ["haskell", "overloading"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1543841781, "post_id": 53594076, "comment_id": 94051007, "body": "You need to indent your functions more. You defined <i>empty</i> instances <code>instance .. where</code> followed by top-level functions <code>show,(+),...</code> which are unrelated to the instance. The functions inside the instances must be more indented than the <code>i</code> of <code>instance ...</code>. If you do that, you can remove the <code>Prelude.</code> qualifiers, which were needed only because you defined an unrelated function with the same same."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1543847341, "post_id": 53594076, "comment_id": 94053991, "body": "I\u2019m voting to close this as a simple typographical fix, but please don\u2019t take that to mean it was a bad question! Glad you got a simple answer."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543848245, "post_id": 53594076, "comment_id": 94054527, "body": "There isn&#39;t really a good <code>Num</code> instance for <code>Nat</code>, because you can&#39;t define <code>negate</code>."}], "answers": [{"tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": false, "score": 3, "last_activity_date": 1543843246, "creation_date": 1543843246, "answer_id": 53594754, "question_id": 53594076, "link": "https://stackoverflow.com/questions/53594076/overload-in-haskell-show-and-num/53594754#53594754", "title": "Overload in Haskell (show and num)", "body": "<p>Those warnings are primarily a result of bad indentation in the definition of your instances. Instead of, </p>\n\n<pre><code>instance Show Nat where\nshow Zero = \"0\"\nshow (Suc x) = Prelude.show (nat2int (Suc x))\n</code></pre>\n\n<p>you should write,</p>\n\n<pre><code>instance Show Nat where\n  show Zero = \"0\"\n  show (Suc x) = Prelude.show (nat2int (Suc x))\n</code></pre>\n\n<p>and similarly for your <code>Num</code> instance. Then your <code>Num</code> instance is also missing quite a few methods, </p>\n\n<pre><code>instance Num Nat where\n (+) a b = suma a b\n (*) a b = producto a b\n\n abs         = ?    \n signum      = ?\n fromInteger = ?\n negate      = ?\n</code></pre>\n\n<p>You need to implement all those. Some further observations. </p>\n\n<pre><code>--Suc (Suc zero) = 1\n--suc (suc(suc zero)) = 2 \n</code></pre>\n\n<p>I know this is commented out, but keep in mind Haskell is case-sensitive. So <code>Suc</code> and <code>Zero</code> must be capitalised. </p>\n\n<pre><code>nat2int Zero = 0\nnat2int (Suc x) = 1 Prelude.+ nat2int x\n</code></pre>\n\n<p>It's a good idea to write down your type signature, furthermore you do not need that <code>Prelude.</code>. </p>\n\n<pre><code>show Zero = \"0\"\nshow (Suc x) = Prelude.show (nat2int (Suc x))\n</code></pre>\n\n<p>Same here, get rid of <code>Prelude.</code>, also there's no point in considering the case for zero and non-zero. It's enough to do, </p>\n\n<pre><code>show nat = show (nat2int nat)\n</code></pre>\n\n<p>or alternatively using composition,</p>\n\n<pre><code>show = show . nat2int\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 10738796, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-VXBeVbWITqw/AAAAAAAAAAI/AAAAAAAADI4/XhPhpZeNnWc/photo.jpg?sz=128", "display_name": "Sammy Jonathan Claes", "link": "https://stackoverflow.com/users/10738796/sammy-jonathan-claes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 420, "favorite_count": 1, "closed_date": 1543848053, "answer_count": 1, "score": 1, "last_activity_date": 1543848130, "creation_date": 1543840856, "last_edit_date": 1543841901, "question_id": 53594076, "link": "https://stackoverflow.com/questions/53594076/overload-in-haskell-show-and-num", "closed_reason": "Duplicate", "title": "Overload in Haskell (show and num)", "body": "<p>I'm learning Overloading in haskell and I have a few problems trying to overload show and num clases. I work with a new recursive data and I have this functions:</p>\n\n<pre><code>    module Nat where\ndata Nat = Zero | Suc Nat\n--Zero = 0\n--Suc (Suc zero) = 1\n--suc (suc(suc zero)) = 2 \n--nat2int:: Nat -&gt; Int\n\nnat2int Zero = 0\nnat2int (Suc x) = 1 Prelude.+ nat2int x\n\n--suma: Nat -&gt; Nat -&gt; Nat\nsuma Zero b = b --addition\nsuma (Suc a) b = Suc (suma a b)\n\n--producto: Nat -&gt; Nat -&gt; Nat\nproducto Zero _ = Zero --product\nproducto (Suc m) n = suma n (producto m n)\n</code></pre>\n\n<p>The functions work correctly, but when i try to create 2 instances:</p>\n\n<pre><code>module Sobrecarga where \nimport Nat\ninstance Show Nat where\nshow Zero = \"0\"\nshow (Suc x) = Prelude.show (nat2int (Suc x))\ninstance Num Nat where\n(+) a b = suma a b\n(*) a b = producto a b\n</code></pre>\n\n<p>i got this 2 warnings and if y try to use show, sumar o producto, the ghci compiler give me an error:</p>\n\n<pre><code>Sobrecarga.hs:3:10: warning: [-Wmissing-methods]\n    * No explicit implementation for\n        either `showsPrec' or `Prelude.show'\n    * In the instance declaration for `Show Nat'\n  |\n3 | instance Show Nat where\n  |          ^^^^^^^^\n\nSobrecarga.hs:8:10: warning: [-Wmissing-methods]\n    * No explicit implementation for\n        `Prelude.+', `Prelude.*', `abs', `signum',\n        `fromInteger', and (either `negate' or `-')\n    * In the instance declaration for `Num Nat'\n\n\n*Sobrecarga&gt; Zero + Zero\n&lt;interactive&gt;:65:6: error:\n    Ambiguous occurrence `+'\n    It could refer to either `Prelude.+',\n                             imported from `Prelude' at Sobrecarga.hs:1:8-17\n                             (and originally defined in `GHC.Num')\n                          or `Sobrecarga.+', defined at Sobrecarga.hs:7:1\n</code></pre>\n\n<p>Have you any solution to fix the amibiguity?</p>\n"}, {"tags": ["haskell", "template-haskell", "hsc2hs"], "owner": {"reputation": 362, "user_id": 2890057, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57ce508983a0e0cff147c3c2c06f756f?s=128&d=identicon&r=PG", "display_name": "artem", "link": "https://stackoverflow.com/users/2890057/artem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1543843027, "creation_date": 1543831985, "last_edit_date": 1543843027, "question_id": 53591544, "link": "https://stackoverflow.com/questions/53591544/sizeof-offsetof-and-alignment-via-templatehaskell", "title": "sizeof, offsetof, and alignment via TemplateHaskell", "body": "<p>I wonder if someone has implemented analogues of <code>hsc2hs</code> pragmas via <code>TemplateHaskell</code>? It feels like it should be doable, since TH runs on target platform at compile time, and GHC always has a C compiler lying around. This could be useful as another way of generating haskell wrappers for C structs and deriving stuff for them.</p>\n\n<p>The question is: if there is such a library, point me please. Otherwise, tell me if I miss something and this is impossible or does not make sense.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1543831599, "post_id": 53590825, "comment_id": 94045774, "body": "Maye you could try <code>createProcess (proc &quot;command&quot; []){ std_out = UseHandle h }</code>, if you manage to open <code>h</code> at file descriptor 3. There should be a way to do that."}, {"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1543845019, "post_id": 53590825, "comment_id": 94052731, "body": "stdout is always file descriptor 1 so that doesn&#39;t help. But it shows, that there must already be some remapping of file descriptors somewhere."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543848773, "post_id": 53590825, "comment_id": 94054870, "body": "The trick is opening the file on file descriptor 3 in the first place; if you do that, the child inherits the file descriptor automatically."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 4, "creation_date": 1543849482, "post_id": 53590825, "comment_id": 94055341, "body": "Roughly speaking, import <code>System.IO.POSIX</code>, then 1) use <code>dup</code> to make a copy of your current file descriptor 3, 2) use <code>dupTo</code> to copy your opened file to fd 3, 3) start the new process, then 4) use <code>dupTo</code> again to restore your saved descriptor to 3 if you did step 1."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543849551, "post_id": 53590825, "comment_id": 94055380, "body": "(Shells make this easy, but I realize now that I&#39;ve never cared about specific file descriptors <i>except</i> in shell.)"}, {"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1543870607, "post_id": 53590825, "comment_id": 94065987, "body": "Yes, as I wrote, I know I can do my own remapping."}, {"owner": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "edited": false, "score": 0, "creation_date": 1543917779, "post_id": 53590825, "comment_id": 94081785, "body": "You could search through reverse <a href=\"https://www.stackage.org/lts-10.4/package/unix-2.7.2.2/revdeps\" rel=\"nofollow noreferrer\">dependencies of unix</a> for a packet which does it but snap clicking on words &quot;shell&quot; &quot;exec&quot; &quot;run&quot; did not give anything"}], "owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 76, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1543829434, "creation_date": 1543829434, "question_id": 53590825, "link": "https://stackoverflow.com/questions/53590825/how-to-inherit-open-files-in-a-sub-process-on-certain-file-descriptors", "title": "How to inherit open files in a sub process on certain file descriptors?", "body": "<p>I want to open some file descriptor (file, socket, pipe, whatever) and start a process for example with <a href=\"https://hackage.haskell.org/package/process-1.6.4.0/docs/System-Process.html#v:createProcess\" rel=\"nofollow noreferrer\">createProcess</a> so that the file descriptor opened above is available as file descriptor 3 to the sub process?</p>\n\n<p>Is there a package or module, that provides such behaviour out of the box?</p>\n\n<p>I know, I could do my own forking and remapping of file descriptors in the child.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1543800660, "post_id": 53586287, "comment_id": 94036096, "body": "Please don&#39;t post images of code. <a href=\"https://stackoverflow.com/posts/53586287/edit\">Edit</a> your question to add it as text instead."}, {"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 1, "creation_date": 1543801849, "post_id": 53586287, "comment_id": 94036312, "body": "The line that matches against an empty list needs an <code>=</code> and not a <code>:</code>.  (But I&#39;d always use a pattern match here.)"}, {"owner": {"reputation": 1141, "user_id": 1367497, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c1ab83696683e53a9940cd2a8c480894?s=128&d=identicon&r=PG", "display_name": "peeyush singh", "link": "https://stackoverflow.com/users/1367497/peeyush-singh"}, "edited": false, "score": 0, "creation_date": 1543802889, "post_id": 53586287, "comment_id": 94036511, "body": "also since your method returns as list, it should return [x] , so if xs == [], then return [x]."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1543822671, "post_id": 53586287, "comment_id": 94041789, "body": "What do you mean by &quot;without pattern matching&quot;? Your current code uses pattern matching!"}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1543825393, "post_id": 53586287, "comment_id": 94042837, "body": "You may do like <code>let last = head . reverse</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1543835843, "post_id": 53586287, "comment_id": 94047933, "body": "How exactly is this not pattern matching? Your <code>mylast []</code> is pattern matching."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 7, "last_activity_date": 1543806853, "creation_date": 1543806853, "answer_id": 53586990, "question_id": 53586287, "link": "https://stackoverflow.com/questions/53586287/getting-the-last-element-in-list-without-using-pattern-matching/53586990#53586990", "title": "getting the last element in list without using pattern matching", "body": "<p>The minimal change needed to fix that exact error is just to fix what is probably a typo: you wrote <code>xs == [] : x</code>, and probably meant <code>xs == [] = x</code> instead. So:</p>\n\n<pre><code>mylast :: (Eq a) =&gt; [a] -&gt; [a]\nmylast [] = []\nmylast (x:xs)\n  | xs == [] = x\n  | otherwise = mylast xs\n</code></pre>\n\n<p>This will give you a type error, because <code>x</code> is a list element, and you say <code>mylast</code> returns a list. You can fix this by making it a singleton list <code>[x]</code>, as in:</p>\n\n<pre><code>mylast :: (Eq a) =&gt; [a] -&gt; [a]\nmylast [] = []\nmylast (x:xs)\n  | xs == [] = [x]\n  | otherwise = mylast xs\n</code></pre>\n\n<p>From there, I have some stylistic comments.</p>\n\n<ol>\n<li>I like your idea to return a list so that you don't need to throw an error if the input is empty. But since we're definitely returning at most one element, you might consider using <code>Maybe</code> for this role instead of <code>[]</code>; it gives a type-level guarantee of at most one element.</li>\n<li>The <code>Eq a</code> constraint is unfortunate: it arises because you write <code>xs == []</code>, which doesn't actually need to call <code>(==)</code> on any elements, but nevertheless requires the user to provide an implementation of <code>(==)</code> on elements. The standard way to check if a list is empty is either to call <code>null</code> or to directly use pattern matching, neither of which require <code>Eq</code>.</li>\n</ol>\n\n<p>Combining these two ideas, we get:</p>\n\n<pre><code>mylast :: [a] -&gt; Maybe a\nmylast [] = Nothing\nmylast [x] = Just x -- convenient syntax sugar for mylast (x:[]) = Just x\nmylast (x:xs) = mylast xs\n</code></pre>\n\n<p>This looks very idiomatic to me.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1543869529, "creation_date": 1543869529, "answer_id": 53601523, "question_id": 53586287, "link": "https://stackoverflow.com/questions/53586287/getting-the-last-element-in-list-without-using-pattern-matching/53601523#53601523", "title": "getting the last element in list without using pattern matching", "body": "<p>If you really want to avoid writing any patterns, the simplest way is probably <code>foldl'</code>:</p>\n\n<pre><code>mylast :: [a] -&gt; Maybe a\nmylast = foldl' (\\_ x -&gt; Just x) Nothing\n</code></pre>\n\n<p>If you prefer, you can reach down to the primitive catamorphism on lists, <code>foldr</code>:</p>\n\n<pre><code>mylast :: [a] -&gt; Maybe a\nmylast xs = foldr (\\x r _ -&gt; r (Just x)) id xs Nothing\n</code></pre>\n\n<p>but that's a bit trickier to understand.</p>\n\n<p><code>foldl'</code> and <code>foldr</code> are ultimately implemented using pattern matching, because that is the fundamental low-level way to inspect a list in Haskell. So there isn't any way to <em>really</em> avoid it altogether.</p>\n"}], "owner": {"reputation": 19, "user_id": 10736686, "user_type": "registered", "profile_image": "https://graph.facebook.com/2318952754783912/picture?type=large", "display_name": "Raul Paredes", "link": "https://stackoverflow.com/users/10736686/raul-paredes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1543869529, "creation_date": 1543800054, "last_edit_date": 1543832563, "question_id": 53586287, "link": "https://stackoverflow.com/questions/53586287/getting-the-last-element-in-list-without-using-pattern-matching", "title": "getting the last element in list without using pattern matching", "body": "<p>I keep getting \"error: parse error on input \u2018|\u2019 \" can someone tell me why? I already rewrote it to make sure all spaces where correct\nhere is my code:  </p>\n\n<pre><code> mylast :: (Eq a) =&gt; [a] -&gt; [a]  \n mylast [] = []  \n mylast (x:xs)  \n   | xs == [] : x  \n   | otherwise = mylast xs   \n</code></pre>\n"}, {"tags": ["arrays", "sorting", "haskell", "multidimensional-array", "massiv"], "answers": [{"tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": true, "score": 2, "last_activity_date": 1543862417, "creation_date": 1543862417, "answer_id": 53599879, "question_id": 53585992, "link": "https://stackoverflow.com/questions/53585992/how-to-sort-a-massiv-array-along-innermost-dimension/53599879#53599879", "title": "How to sort a massiv array along innermost dimension?", "body": "<p>Of course, it would be better to roll out your own sorting and submit a PR to <code>massiv</code> library ;) But there is a way to fall back onto <code>vector-algorithms</code> package. I was curious how I'd do it efficiently and here it is, along with automatic parallelization of sorting each row:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts    #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeFamilies        #-}\nmodule Examples.SortRows where\n\nimport           Data.Massiv.Array                 as A\nimport           Data.Massiv.Array.Manifest.Vector as A\nimport           Data.Massiv.Core.Scheduler\nimport           Data.Typeable\nimport           Data.Vector.Algorithms.Merge\nimport           Data.Vector.Generic               as VG\nimport           Data.Vector.Generic.Mutable       as VGM\nimport           System.IO.Unsafe\n\nsortRows ::\n     forall r e v.\n     (Ord e, Typeable v, A.Mutable r Ix2 e, VG.Vector v e, ARepr v ~ r, VRepr r ~ v)\n  =&gt; Array r Ix2 e\n  -&gt; Array r Ix2 e\nsortRows arr = unsafePerformIO $ do\n  mv :: VG.Mutable v RealWorld e &lt;- VG.thaw (A.toVector arr :: v e)\n  let comp = getComp arr\n      sz@(m :. n) = size arr\n  case comp of\n    Seq -&gt; do\n      loopM_ 0 (&lt; m) (+ 1) $ \\i -&gt; sort $ VGM.slice (toLinearIndex sz (i :. 0)) n mv\n    ParOn wIds -&gt;\n      withScheduler_ wIds $ \\scheduler -&gt; do\n        loopM_ 0 (&lt; m) (+ 1) $ \\i -&gt;\n          scheduleWork scheduler $ sort $ VGM.slice (toLinearIndex sz (i :. 0)) n mv\n  v :: v e &lt;- VG.unsafeFreeze mv\n  return $ A.fromVector comp sz v\n</code></pre>\n\n<p>I did add this to examples in massiv in this <a href=\"https://github.com/lehins/massiv/commit/0bd14a1749315fadf30222cf4bc7d08f7c63e1fa\" rel=\"nofollow noreferrer\">commit</a> together with a simple property test.</p>\n"}], "owner": {"reputation": 2704, "user_id": 2629787, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/HApc9.jpg?s=128&g=1", "display_name": "Koz Ross", "link": "https://stackoverflow.com/users/2629787/koz-ross"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 1, "accepted_answer_id": 53599879, "answer_count": 1, "score": 1, "last_activity_date": 1543862451, "creation_date": 1543796957, "last_edit_date": 1543862451, "question_id": 53585992, "link": "https://stackoverflow.com/questions/53585992/how-to-sort-a-massiv-array-along-innermost-dimension", "title": "How to sort a massiv array along innermost dimension?", "body": "<p>I have an <code>Array r Ix2 a</code> such that <code>(Manifest r Ix2 a, Ord a)</code>. I'd like to sort this array on its innermost dimension - that is, sort each row internally, but not across rows. According to <a href=\"https://github.com/lehins/massiv/issues/48#issuecomment-429843803\" rel=\"nofollow noreferrer\">this</a>, massiv doesn't have any sorting implemented at all. Would I have to roll my own, or can I re-use something that already exists for <code>Vector</code>s (such as <code>vector-algorithms</code> for example)?</p>\n"}, {"tags": ["haskell", "functional-programming", "monads"], "comments": [{"owner": {"reputation": 14830, "user_id": 3757232, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/kLzML.jpg?s=128&g=1", "display_name": "Jared Smith", "link": "https://stackoverflow.com/users/3757232/jared-smith"}, "edited": false, "score": 0, "creation_date": 1543795767, "post_id": 53585830, "comment_id": 94035210, "body": "No. No it isn&#39;t safe to say that. Join is for un-nesting monadic structures. Your logic is flawed. Equivalent to saying 1. crowns are a property of princesses. 2. All princesses are female. 3. Therefor crowns are properties of females. While every monad is a functor, not every functor is a monad in the same way not every female is a princess."}, {"owner": {"reputation": 11, "user_id": 10734253, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W9ejr5TWGy0/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-i6hZkBZ_SiIOaUWr3bmynJmlmR2Q/mo/photo.jpg?sz=128", "display_name": "fsme", "link": "https://stackoverflow.com/users/10734253/fsme"}, "reply_to_user": {"reputation": 14830, "user_id": 3757232, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/kLzML.jpg?s=128&g=1", "display_name": "Jared Smith", "link": "https://stackoverflow.com/users/3757232/jared-smith"}, "edited": false, "score": 0, "creation_date": 1543796686, "post_id": 53585830, "comment_id": 94035387, "body": "Oh, sure. I find myself terribly wrong. join does not even take a parameter of Function..."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1543861577, "creation_date": 1543861577, "answer_id": 53599672, "question_id": 53585830, "link": "https://stackoverflow.com/questions/53585830/join-is-also-a-function-of-endofunctor/53599672#53599672", "title": "`join` is also a function of endofunctor?", "body": "<p>An endofunctor is a pair of mappings: one that maps a type to another type, and one that maps a function to another function. In this sense, the endofunctor \"has\" <code>fmap</code>, as <code>fmap</code> is the function-to-function mapping.</p>\n\n<p>A monad is a triplet consisting of an endofunctor and two natural transformations. One of the natural transformations is <code>return :: a -&gt; m a</code>. The other, in Haskell, is <code>(&gt;&gt;=) :: m a -&gt; (a -&gt; m b) -&gt; m b</code>. <code>join ms = ms &gt;&gt;= id</code>, but we could just as easily say that <code>join :: m (m a) -&gt; m a</code> is the natural transformation associated with the monad and that <code>m &gt;&gt;= f = join (fmap f m)</code>. In that case, the <em>monad</em> (not the endofunctor) \"has\" <code>join</code> as a function.</p>\n"}], "owner": {"reputation": 11, "user_id": 10734253, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W9ejr5TWGy0/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-i6hZkBZ_SiIOaUWr3bmynJmlmR2Q/mo/photo.jpg?sz=128", "display_name": "fsme", "link": "https://stackoverflow.com/users/10734253/fsme"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1543861577, "creation_date": 1543795228, "question_id": 53585830, "link": "https://stackoverflow.com/questions/53585830/join-is-also-a-function-of-endofunctor", "title": "`join` is also a function of endofunctor?", "body": "<p>Every monad is a endofunctor.</p>\n\n<p><code>bind</code> of monad is a composition of <code>fmap</code> and <code>join</code>.</p>\n\n<p><code>fmap</code> is a function of endofunctor.</p>\n\n<p>Then, is it safe to say <code>join</code> is also a function of endofunctor?</p>\n"}, {"tags": ["haskell", "hakyll"], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 6, "last_activity_date": 1543802821, "creation_date": 1543802821, "answer_id": 53586539, "question_id": 53585452, "link": "https://stackoverflow.com/questions/53585452/how-to-filter-hakyll-posts-with-a-custom-metadata/53586539#53586539", "title": "How to filter Hakyll posts with a custom metadata", "body": "<p>You are probably looking for <a href=\"http://hackage.haskell.org/package/hakyll-4.12.4.0/docs/Hakyll-Core-Rules.html#v:matchMetadata\" rel=\"noreferrer\"><code>matchMetadata</code></a>:</p>\n\n<pre><code>matchMetadata :: Pattern -&gt; (Metadata -&gt; Bool) -&gt; Rules () -&gt; Rules ()\n</code></pre>\n\n<p>With it, instead of, say...</p>\n\n<pre><code>match \"posts/*.md\" $ do -- etc.\n</code></pre>\n\n<p>... you might have:</p>\n\n<pre><code>matchMetadata \"posts/*.md\" (\\m -&gt; lookupString \"status\" m == Just \"published\") $ do -- etc.\n</code></pre>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 1, "accepted_answer_id": 53586539, "answer_count": 1, "score": 4, "last_activity_date": 1543802821, "creation_date": 1543791677, "last_edit_date": 1543793482, "question_id": 53585452, "link": "https://stackoverflow.com/questions/53585452/how-to-filter-hakyll-posts-with-a-custom-metadata", "title": "How to filter Hakyll posts with a custom metadata", "body": "<p>I would like to filter some posts of my website based on a metadata value. I would like to create a specific metadata called <code>status</code> (like <code>title</code> or <code>date</code>) which could take several values (draft, published, archive) : </p>\n\n<pre><code>---\ntitle: The title\nauthor: Myself\ndate: 2016-11-29\ntags: tag1, tag2\nstatus: draft\n---\n</code></pre>\n\n<p>According to the value of the <code>status</code> metadata, the post should be published or not.</p>\n\n<p>I have a look in the hackage  <a href=\"http://hackage.haskell.org/package/hakyll-4.12.4.0/docs/Hakyll-Core-Metadata.html\" rel=\"nofollow noreferrer\">documentation</a> but I'm not sure of the functions to use.</p>\n\n<p><strong>Do you know how to make that with Hakyll ?</strong></p>\n"}, {"tags": ["parsing", "haskell", "pretty-print"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 3, "creation_date": 1543789225, "post_id": 53585115, "comment_id": 94033808, "body": "See <code>showsPrec</code>, which <code>shows</code> something with a given operator <code>Prec</code>edence."}, {"owner": {"reputation": 1306, "user_id": 5664775, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/QqQGd.jpg?s=128&g=1", "display_name": "Luke Collins", "link": "https://stackoverflow.com/users/5664775/luke-collins"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1543789642, "post_id": 53585115, "comment_id": 94033892, "body": "@AJFarmar Can you recommend any tutorials on how to use <code>showsPrec</code>? The documentation I&#39;m finding on it is quite minimal."}, {"owner": {"reputation": 1306, "user_id": 5664775, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/QqQGd.jpg?s=128&g=1", "display_name": "Luke Collins", "link": "https://stackoverflow.com/users/5664775/luke-collins"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1543790173, "post_id": 53585115, "comment_id": 94034025, "body": "@AJFarmar Or perhaps provide an answer :)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1543792166, "post_id": 53585115, "comment_id": 94034423, "body": "It&#39;s also a matter of taste. In my own preferred convention, <code>\u2200 X</code> has the lowest precedence, so that <code>\u2200 X . A &amp; B</code> means <code>\u2200 X . (A &amp; B)</code>, and not <code>(\u2200 X . A) &amp; B</code>. (Sometimes the other precedence is used, instead.) Haskell also makes <code>\\ x -&gt;</code> to extend as to the right as possible. You have to choose the precedence."}, {"owner": {"reputation": 1306, "user_id": 5664775, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/QqQGd.jpg?s=128&g=1", "display_name": "Luke Collins", "link": "https://stackoverflow.com/users/5664775/luke-collins"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1543792314, "post_id": 53585115, "comment_id": 94034455, "body": "@chi Normally I would agree with you, but given what I&#39;m using this grammar for, it turns out that giving lower precedence to conjunction is more convenient. My question is not about choosing the precedence, but rather about how to actually implement the <code>show</code> function so that parentheses are printed minimally."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1543792852, "post_id": 53585115, "comment_id": 94034580, "body": "There&#39;s plenty of information on <code>showsPrec</code> already available. A quick google search reveals <a href=\"https://stackoverflow.com/questions/27471937/showsprec-and-operator-precedences\">this SO question</a>, which I think is very helpful."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1543793083, "post_id": 53585115, "comment_id": 94034626, "body": "Note that, in order to implement <code>showPrec</code>, you have to choose a precedence for your symbols. Essentially, you do have to choose which one between <code>\u2200 X . (A &amp; B)</code> and <code>(\u2200 X . A) &amp; B</code> can/should be written without parentheses. You want the latter, so the first will have parentheses -- that&#39;s OK. You need to assign a &quot;precedence level&quot; for your operators, and implement <code>showPrec</code> to add parentheses when you are in a context with a too high (I think) precedence."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1543795255, "post_id": 53585115, "comment_id": 94035098, "body": "I would suggest not using <code>Show</code>. <code>Show</code> is meant to output Haskell code, such that copy-pasting that code can (roughly) rebuild the original data. This should go into its own function. @chi&#39;s answer is still correct, and you can use all the <code>ShowS</code> stuff to implement your new function, but it should not be called <code>show</code>."}], "answers": [{"comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1543795086, "post_id": 53585681, "comment_id": 94035068, "body": "<a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Show.html#showString\" rel=\"nofollow noreferrer\">I think you&#39;re fine without <code>showString</code> :P</a>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1543796967, "post_id": 53585681, "comment_id": 94035429, "body": "@HTNW It&#39;s only a matter of &quot;style&quot;, indeed. :)"}, {"owner": {"reputation": 1306, "user_id": 5664775, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/QqQGd.jpg?s=128&g=1", "display_name": "Luke Collins", "link": "https://stackoverflow.com/users/5664775/luke-collins"}, "edited": false, "score": 0, "creation_date": 1543871957, "post_id": 53585681, "comment_id": 94066537, "body": "I understand that you chose them randomly, but could you clarify what the integers 5 and 8 are actually doing here? Why not 1 and 2?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1306, "user_id": 5664775, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/QqQGd.jpg?s=128&g=1", "display_name": "Luke Collins", "link": "https://stackoverflow.com/users/5664775/luke-collins"}, "edited": false, "score": 1, "creation_date": 1543875546, "post_id": 53585681, "comment_id": 94068068, "body": "@LukeCollins In principle, their value does not really matter, only their ordering does. However, one should try to choose the right ordering wrt the levels already used by the standard libraries. Otherwise, a formula will be printed correctly on its own, but incorrectly if e.g. inside a <code>Just</code> as the last example I wrote shows. In my experiments <code>Just x</code> gives level 11 to <code>x</code>, so to trigger parentheses. Instead <code>[x]</code> gives level 0 to <code>x</code> -- no parentheses needed here. Probably choosing your levels between 1 and 10 should be OK."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1543797009, "last_edit_date": 1543797009, "creation_date": 1543793827, "answer_id": 53585681, "question_id": 53585115, "link": "https://stackoverflow.com/questions/53585115/how-to-tell-whether-parentheses-are-necessary-or-not/53585681#53585681", "title": "How to tell whether parentheses are necessary or not?", "body": "<p>Untested pseudocode:</p>\n\n<pre><code>instance Show Formula where\n   showsPrec _p True  = \"True\"\n   showsPrec _p False = \"False\"\n   showsPrec p (And f1 f2) = showParen (p &gt; 5) $\n      showsPrec 5 f1 . (\" &amp; \" ++) . showsPrec 5 f2\n   showsPrec p (Forall x f) = showParen (p &gt; 8) $\n      (\"forall \" ++ x ++) . showsPrec 8 f\n   ...\n</code></pre>\n\n<p>(I should probably use <code>showString</code> instead of those <code>++</code> above. It should work anyway, I think.)</p>\n\n<p>Above, the integer <code>p</code> represents the precedence of the context where we are showing the current formula. For example, if we are showing <code>f</code> inside <code>f &amp; ...</code> then <code>p</code> will have the precedence level of <code>&amp;</code>.</p>\n\n<p>If we need to print a symbol in a context which has higher precedence, we need to add parentheses. E.g. if <code>f</code> is <code>a | b</code> we can't write <code>a | b &amp; ...</code>, otherwise it is interpreted as <code>a | (b &amp; ...)</code>. We need to put parentheses around <code>a | b</code>. This is done by the <code>showParen (p &gt; ...)</code>.</p>\n\n<p>When we recurse, we pass the precedence level of the symbol at hand to the subterms.</p>\n\n<p>Above, I chose the precedence levels randomly. You need to adjust them to your tastes. You should also check that the levels you choose play along the standard libraries. E.g. printing <code>Just someFormula</code> should not generate things like <code>Just a &amp; b</code>, but add parentheses.</p>\n"}], "owner": {"reputation": 1306, "user_id": 5664775, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/QqQGd.jpg?s=128&g=1", "display_name": "Luke Collins", "link": "https://stackoverflow.com/users/5664775/luke-collins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "answer_count": 1, "score": 7, "last_activity_date": 1543797009, "creation_date": 1543788913, "last_edit_date": 1543792748, "question_id": 53585115, "link": "https://stackoverflow.com/questions/53585115/how-to-tell-whether-parentheses-are-necessary-or-not", "title": "How to tell whether parentheses are necessary or not?", "body": "<p>I have written a parser in Haskell, which parses formulas in the form of string inputs and produces a Haskell <code>data</code> type defined by the BNF below.</p>\n\n<pre><code>formula ::=  true  \n         |  false  \n         |  var  \n         |  formula &amp; formula  \n         |  \u2200 var . formula\n         |  (formula)\n\n    var ::=  letter { letter | digit }*\n</code></pre>\n\n<p>Now I would like to create an instance of <code>Show</code> so that I can nicely print the formulas defined by my types (I don't want to use <code>deriving (Show)</code>). My question is: How do I define my function so that it can tell when parentheses are necessary?  I don't want too many, nor too little parentheses.</p>\n\n<p>For example, given the formula <code>\u2200 X . (X &amp; Y) &amp; (\u2200 Y . Y) &amp; false</code> which, when parsed, produces the data structure </p>\n\n<pre><code>And (And (Forall \"X\" (And (Var \"X\") (Var \"Y\"))) (Forall \"Y\" (Var \"Y\"))) False\n</code></pre>\n\n<p>we have</p>\n\n<pre><code>   Too little parentheses:    \u2200 X . X &amp; Y &amp; \u2200 Y . Y &amp; false\n   Too much parentheses:      (\u2200 X . (((X) &amp; (Y)))) &amp; (\u2200 Y . (Y)) &amp; (false)\n   Just right:                \u2200 X . (X &amp; Y) &amp; (\u2200 Y . Y) &amp; false\n</code></pre>\n\n<p>Is there a way to gauge how many parenthesis are necessary so that the semantics is never ambiguous?  I appreciate any feedback. </p>\n"}, {"tags": ["haskell", "ghci", "type-level-computation"], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 48, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1543787681, "creation_date": 1543787681, "question_id": 53584975, "link": "https://stackoverflow.com/questions/53584975/datatype-promotion-for-constructors-whose-type-could-be-fed-literals", "title": "Datatype promotion for constructors whose type could be fed literals", "body": "<p>I have a simple data type </p>\n\n<pre><code>data Label  = LabelK String \n</code></pre>\n\n<p>declaring :</p>\n\n<ul>\n<li>a type <code>Label</code> of kind <code>Type</code></li>\n<li>a data constructor <code>LabelK</code> of type <code>String -&gt; Label</code> </li>\n</ul>\n\n<p>which I imagined would be type promoted to :</p>\n\n<ul>\n<li>a kind <code>'Label</code> </li>\n<li>a type constructor <code>'LabelK</code> of kind <code>forall {l :: Symbol}. Label l</code></li>\n</ul>\n\n<p>However, this does not seem to be the case, and I get instead </p>\n\n<pre><code>:kind 'LabelK :: String -&gt; Label \n</code></pre>\n\n<p>So that promoted <code>'LabelK</code> is a function (?) taking a <code>String</code> as input and giving a type of kind <code>'Label</code>. I am afraid Haskell can't do that.</p>\n\n<p>We can verify with</p>\n\n<pre><code>data Proxy (i :: k) where  \n  ProxyK :: Proxy i      \n</code></pre>\n\n<p>if we want to build a witness at type <code>'LabelK \"titi\"</code> </p>\n\n<pre><code>v3 = ProxyK :: Proxy ('LabelK \"titi\") -- fails\n</code></pre>\n\n<p><code>\"titi\"</code> gets promoted to a <code>Symbol</code>, as part of <a href=\"https://downloads.haskell.org/~ghc/7.6.3/docs/html/users_guide/promotion.html\" rel=\"nofollow noreferrer\">promotion of Literals</a>, and we have a type error. </p>\n\n<hr>\n\n<p>So, <strong>is the only way</strong> to have a named type parameterized by a type-level string, aka a <code>Symbol</code>, to write it ourselve, as in the documentation ? :</p>\n\n<pre><code>data Labl (l :: Symbol) = \n   Get \n</code></pre>\n\n<p><code>Get</code> is akin to <code>ProxyK</code> and gives us a value of type <code>Labl l</code></p>\n\n<pre><code>:t Get :: forall {l :: Symbol}. Labl l \n</code></pre>\n\n<p>Then </p>\n\n<pre><code>Get :: Labl \"x\"\n</code></pre>\n\n<p>obliviates the need to build a proxy at the type index <code>LabelK \"titi\"</code> which we could not </p>\n\n<hr>\n\n<p>PS : in <code>ghci</code>, one can use </p>\n\n<pre><code>:set -fprint-explicit-kinds\n:set -fprint-explicit-foralls\n</code></pre>\n\n<p>(but we can't write <code>v6 = Get :: forall {l :: Symbol}. Labl l</code> for some reason ?)</p>\n"}, {"tags": ["haskell", "typeclass", "functor"], "comments": [{"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 1, "creation_date": 1543787210, "post_id": 53584881, "comment_id": 94033310, "body": "Remove the <code>Ord</code> constraint from your data declaration?"}, {"owner": {"reputation": 5272, "user_id": 4154262, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh3.googleusercontent.com/-XocrYzpWLmU/AAAAAAAAAAI/AAAAAAAAANA/G77IjxB84J8/photo.jpg?sz=128", "display_name": "TaoPR", "link": "https://stackoverflow.com/users/4154262/taopr"}, "reply_to_user": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1543787257, "post_id": 53584881, "comment_id": 94033320, "body": "For some other reasons, I do need <code>v</code> to be an <code>Ord</code>. So I can&#39;t remove this constraint though."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1543787418, "post_id": 53584881, "comment_id": 94033355, "body": "Sure, I understand that, but do you need the constraint on the data declaration itself?"}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 2, "creation_date": 1543787511, "post_id": 53584881, "comment_id": 94033378, "body": "Also see this wiki entry: <a href=\"https://wiki.haskell.org/Data_declaration_with_constraint\" rel=\"nofollow noreferrer\">Data declaration with constraint</a>"}, {"owner": {"reputation": 5272, "user_id": 4154262, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh3.googleusercontent.com/-XocrYzpWLmU/AAAAAAAAAAI/AAAAAAAAANA/G77IjxB84J8/photo.jpg?sz=128", "display_name": "TaoPR", "link": "https://stackoverflow.com/users/4154262/taopr"}, "reply_to_user": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1543787872, "post_id": 53584881, "comment_id": 94033475, "body": "However <code>mapG</code> needs the constraint as its implementation needs <code>Ord v</code>. So the instance using <code>mapG</code> needs to comply with the constraint. This is a bit tangled scenario"}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1543788118, "post_id": 53584881, "comment_id": 94033554, "body": "It isn&#39;t tangled. All you&#39;re saying is you need that constraint to be on <code>mapG</code>. So keep it there. Note constraints on data declarations have been deprecated, your declaration isn&#39;t even legal on current ghc."}, {"owner": {"reputation": 5272, "user_id": 4154262, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh3.googleusercontent.com/-XocrYzpWLmU/AAAAAAAAAAI/AAAAAAAAANA/G77IjxB84J8/photo.jpg?sz=128", "display_name": "TaoPR", "link": "https://stackoverflow.com/users/4154262/taopr"}, "reply_to_user": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1543788430, "post_id": 53584881, "comment_id": 94033634, "body": "yeah, then I need to find a way to properly constrain the instance so <code>mapG</code> can be used there. In which I don&#39;t know how."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 2, "creation_date": 1543788743, "post_id": 53584881, "comment_id": 94033703, "body": "Sorry my bad, <code>mapG</code> is your mapping function. Indeed if you require <code>Ord</code> to implement your map you have a problem. I don&#39;t think there&#39;s a workaround. It just isn&#39;t a functor. Someone correct me if I&#39;m wrong."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 1, "creation_date": 1543789057, "post_id": 53584881, "comment_id": 94033763, "body": "The <code>containers</code> library also has this problem - the types there require an <code>Ord</code> constraint on values, but this causes problems with instances. <code>containers</code> solves this by ignoring the constraint on the type, and applying it to every function instead e.g. <a href=\"https://www.stackage.org/haddock/lts-12.21/containers-0.5.11.0/Data-Map-Lazy.html\" rel=\"nofollow noreferrer\"><code>Map k v</code></a> does not have an <code>Ord</code> constraint, but all the  functions have type <code>Ord k =&gt; (something)</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1543789598, "post_id": 53584881, "comment_id": 94033877, "body": "JorgeAdriano is right: this type cannot possibly be a functor."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1543794202, "post_id": 53584881, "comment_id": 94034870, "body": "This is a well known limitation, so to speak, of the functor class. To be a functor, we need to be able to <code>fmap</code> any function -- with no constraints. If we are only able to do that only on some functions, we do not have a functor. There are variants of &quot;constrained&quot; functor typeclasses that allow adding constraints like <code>Ord</code>, but these typeclasses are not the standard <code>Functor</code> typeclass."}, {"owner": {"reputation": 5272, "user_id": 4154262, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh3.googleusercontent.com/-XocrYzpWLmU/AAAAAAAAAAI/AAAAAAAAANA/G77IjxB84J8/photo.jpg?sz=128", "display_name": "TaoPR", "link": "https://stackoverflow.com/users/4154262/taopr"}, "edited": false, "score": 0, "creation_date": 1543827246, "post_id": 53584881, "comment_id": 94043657, "body": "That sounds unfortunate to know for me. Thank you everyone for clarifications."}], "owner": {"reputation": 5272, "user_id": 4154262, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh3.googleusercontent.com/-XocrYzpWLmU/AAAAAAAAAAI/AAAAAAAAANA/G77IjxB84J8/photo.jpg?sz=128", "display_name": "TaoPR", "link": "https://stackoverflow.com/users/4154262/taopr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 76, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1543792982, "creation_date": 1543786909, "last_edit_date": 1543792982, "question_id": 53584881, "link": "https://stackoverflow.com/questions/53584881/implement-an-instance-from-a-type-constrained-data-type", "title": "Implement an instance from a type-constrained data type", "body": "<p>If I have a data type <code>G</code> implemented with a type constraint as follows:</p>\n\n<pre><code>data Ord v =&gt; G v = G [v] (M.Map v v)\n</code></pre>\n\n<p>And I have a mapping function of the following signature also with the type constraint (implementation omitted)</p>\n\n<pre><code>mapG :: (Ord v, Ord v') =&gt; (v -&gt; v') -&gt; G v -&gt; G v'\n</code></pre>\n\n<p>Then I want to implement <code>G</code> as a Functor so I do the following</p>\n\n<pre><code>instance Functor G where\n   fmap = mapG\n</code></pre>\n\n<p>This won't compile as it complains</p>\n\n<blockquote>\n<pre><code>\u2022 No instance for (Ord a) arising from a use of \u2018mapG\u2019\n  Possible fix:\n    add (Ord a) to the context of\n      the type signature for:\n        fmap :: (a -&gt; b) -&gt; G a -&gt; G b\n</code></pre>\n</blockquote>\n\n<p>So I tried bounding the type constraint to the instance as follows:</p>\n\n<pre><code>instance Ord v =&gt; Functor (G v) where\n   fmap = mapG\n</code></pre>\n\n<p>But even worse, the compiler complains:</p>\n\n<blockquote>\n<pre><code>\u2022 Expecting one fewer argument to \u2018G v\u2019\n  Expected kind \u2018* -&gt; *\u2019, but \u2018G v\u2019 has kind \u2018*\u2019\n\u2022 In the first argument of \u2018Functor\u2019, namely \u2018G v\u2019\n  In the instance declaration for \u2018Functor (G v)\u2019\n</code></pre>\n</blockquote>\n\n<p>I now run out of an idea how to make this work. Can someone explain and suggest how should I turn this around?</p>\n\n<p>Remarks:</p>\n\n<ul>\n<li>I do need to implement this as even more instances, not only a Functor as an example here in the question.</li>\n<li>The type constraint of <code>Ord</code> is required (for reasons not related to the question) so I cannot remove it.</li>\n</ul>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1543786011, "post_id": 53584518, "comment_id": 94032988, "body": "Don&#39;t repeat function names when you carry on with the guards. So just remove <code>toEnum n</code>  in it&#39;s third appearance. Also same with <code>toPostNat n</code>  in the last line."}], "answers": [{"tags": [], "owner": {"reputation": 29209, "user_id": 495796, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/86637c99f25d60157aa0f2e7eab90148?s=128&d=identicon&r=PG", "display_name": "Robin Green", "link": "https://stackoverflow.com/users/495796/robin-green"}, "is_accepted": true, "score": 2, "last_activity_date": 1543784328, "creation_date": 1543784328, "answer_id": 53584550, "question_id": 53584518, "link": "https://stackoverflow.com/questions/53584518/error-not-in-scope-why-this-is-happening/53584550#53584550", "title": "Error: not in scope. Why this is happening?", "body": "<p>You need to promote <code>toPosNat</code> to a top-level function, like this:</p>\n\n<pre><code> instance Enum Int' where\n  toEnum 0 = Zero'\n  toEnum n | n&gt;0 = Plus (toPosNat n )\n  toEnum n | n&lt;0 = undefined -- Minus (toPosNat n) \n\n toPosNat :: a -&gt; PosNat\n toPosNat 1 = One \n toPosNat n | n&gt;1 = (Succ' (toPosNat (n-1)) )\n toPosNat n | n&lt;1 = (Succ' (toPosNat (n+1)) )\n</code></pre>\n\n<p>The <code>where</code> clause that you have in your code is only visible in the third case, not in the second case.</p>\n"}, {"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 4, "last_activity_date": 1543784754, "creation_date": 1543784754, "answer_id": 53584615, "question_id": 53584518, "link": "https://stackoverflow.com/questions/53584518/error-not-in-scope-why-this-is-happening/53584615#53584615", "title": "Error: not in scope. Why this is happening?", "body": "<p>A <code>where</code> clause attaches to all of the guards of a single pattern. You've defined your function using three separate patterns, so the <code>where</code> clause only attaches to the last of them. To fix this, simply roll the last two patterns (which are the same, minus the guards) together:</p>\n\n<pre><code> instance Enum Int' where\n   toEnum 0 = Zero'\n   toEnum n | n&gt;0 = Plus (toPosNat n )\n            | n&lt;0 = Minus (toPosNat n) \n     where\n       toPosNat :: a -&gt; PosNat\n       toPosNat 1 = One \n       toPosNat n | n&gt;1 = (Succ' (toPosNat (n-1)))\n                  | n&lt;1 = (Succ' (toPosNat (n+1)))\n</code></pre>\n\n<p>I've made the same change to <code>toPosNat</code> because this is better style, but it has no semantic impact in this case.</p>\n"}], "owner": {"reputation": 1, "user_id": 10736106, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-5UBk4vIRL_c/AAAAAAAAAAI/AAAAAAAAywI/9rlBdz70vtk/photo.jpg?sz=128", "display_name": "MR.ROBOT", "link": "https://stackoverflow.com/users/10736106/mr-robot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 53584550, "answer_count": 2, "score": -1, "last_activity_date": 1543784754, "creation_date": 1543784085, "last_edit_date": 1543784368, "question_id": 53584518, "link": "https://stackoverflow.com/questions/53584518/error-not-in-scope-why-this-is-happening", "title": "Error: not in scope. Why this is happening?", "body": "<p>i need to define an <em>instance</em> for the class <em>Enum</em> based on the datatype <em>Int'</em>. I just need to define the functions <em>toEnum</em> and <em>fromEnum</em>. \nFor example: map fromEnum [Minus One .. Plus (Succ\u2019 One)]  ->  [-1,0,1,2]</p>\n\n<pre><code>data PosNat = One | Succ' PosNat \ndata Int' = Zero' | Plus PosNat | Minus PosNat \n\n instance Enum Int' where\n  toEnum 0 = Zero'\n  toEnum n | n&gt;0 = Plus (toPosNat n )\n  toEnum n | n&lt;0 = undefined -- Minus (toPosNat n) \n    where\n      toPosNat :: a -&gt; PosNat\n      toPosNat 1 = One \n      toPosNat n | n&gt;1 = (Succ' (toPosNat (n-1)) )\n      toPosNat n | n&lt;1 = (Succ' (toPosNat (n+1)) )\n</code></pre>\n\n<p>The problem is, i get following error:</p>\n\n<pre><code>Variable not in scope: toPosNat :: Int -&gt; PosNat\n   |\n62 |   toEnum n | n&gt;0 = Plus (toPosNat n )\n   |  \n</code></pre>\n\n<p>Thanks for your help! :)</p>\n"}, {"tags": ["haskell", "fixpoint-combinators"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1543776727, "post_id": 53583488, "comment_id": 94030424, "body": "Can you share your attempt?"}, {"owner": {"reputation": 119, "user_id": 8012467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b671c5fcf115067e21acb9fcd967cc68?s=128&d=identicon&r=PG&f=1", "display_name": "Alaa Alsayed", "link": "https://stackoverflow.com/users/8012467/alaa-alsayed"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1543776880, "post_id": 53583488, "comment_id": 94030461, "body": "fix f x         | f x == x = x         | otherwise = fix f x         where x = f x"}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 0, "creation_date": 1543777279, "post_id": 53583488, "comment_id": 94030583, "body": "The type of your function is wrong. The fixed point combinator has the type <code>fix :: (a -&gt; a) -&gt; a</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 4, "creation_date": 1543777328, "post_id": 53583488, "comment_id": 94030600, "body": "@AaditMShah It&#39;s a fine signature, it&#39;s just a different <code>fix</code> than the one PL folks like so much."}, {"owner": {"reputation": 119, "user_id": 8012467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b671c5fcf115067e21acb9fcd967cc68?s=128&d=identicon&r=PG&f=1", "display_name": "Alaa Alsayed", "link": "https://stackoverflow.com/users/8012467/alaa-alsayed"}, "edited": false, "score": 1, "creation_date": 1543777375, "post_id": 53583488, "comment_id": 94030612, "body": "no it&#39;s not wrong . it&#39;s a homework !!"}, {"owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "edited": false, "score": 0, "creation_date": 1543877130, "post_id": 53583488, "comment_id": 94068640, "body": "This doesn&#39;t answer your question, but maybe you&#39;re interested in a one-liner: <code>fix = until=&lt;&lt;((==)=&lt;&lt;)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 119, "user_id": 8012467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b671c5fcf115067e21acb9fcd967cc68?s=128&d=identicon&r=PG&f=1", "display_name": "Alaa Alsayed", "link": "https://stackoverflow.com/users/8012467/alaa-alsayed"}, "edited": false, "score": 0, "creation_date": 1543778151, "post_id": 53583584, "comment_id": 94030826, "body": "it doesn&#39;t work either returns an wrong answer or it returns nothing :\\\\     Ihave typed fix (*2)3 it should return 12 but it returns nothing ."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 119, "user_id": 8012467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b671c5fcf115067e21acb9fcd967cc68?s=128&d=identicon&r=PG&f=1", "display_name": "Alaa Alsayed", "link": "https://stackoverflow.com/users/8012467/alaa-alsayed"}, "edited": false, "score": 1, "creation_date": 1543778180, "post_id": 53583584, "comment_id": 94030836, "body": "@Amerov: why is the fixed point of <code>(*2)</code> <code>3</code>? The idea of a fixed point is <code>f x == x</code>, but <code>(*2) 12 == 24</code>, not <code>12</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 119, "user_id": 8012467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b671c5fcf115067e21acb9fcd967cc68?s=128&d=identicon&r=PG&f=1", "display_name": "Alaa Alsayed", "link": "https://stackoverflow.com/users/8012467/alaa-alsayed"}, "edited": false, "score": 1, "creation_date": 1543779653, "post_id": 53583584, "comment_id": 94031288, "body": "@Amerov the fixed point of (*2) is 0, and it&#39;s not attractive, so it won&#39;t be reached for any argument that&#39;s not 0 to begin with."}, {"owner": {"reputation": 119, "user_id": 8012467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b671c5fcf115067e21acb9fcd967cc68?s=128&d=identicon&r=PG&f=1", "display_name": "Alaa Alsayed", "link": "https://stackoverflow.com/users/8012467/alaa-alsayed"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1543779960, "post_id": 53583584, "comment_id": 94031379, "body": "@WillNess can you give me an example please   just to know how to use it or how it works"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 119, "user_id": 8012467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b671c5fcf115067e21acb9fcd967cc68?s=128&d=identicon&r=PG&f=1", "display_name": "Alaa Alsayed", "link": "https://stackoverflow.com/users/8012467/alaa-alsayed"}, "edited": false, "score": 2, "creation_date": 1543780288, "post_id": 53583584, "comment_id": 94031483, "body": "@Amerov <code>fix (*2) 0</code> would work. or e.g. <code>fix (`div` 2) 100</code>. Or <code>let collatz x | even x = div x 2 | x &lt;= 1 = 1 | otherwise = (3*x+1)</code> and then <code>fix collatz 99</code>."}, {"owner": {"reputation": 119, "user_id": 8012467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b671c5fcf115067e21acb9fcd967cc68?s=128&d=identicon&r=PG&f=1", "display_name": "Alaa Alsayed", "link": "https://stackoverflow.com/users/8012467/alaa-alsayed"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1543781589, "post_id": 53583584, "comment_id": 94031837, "body": "@WillNess does it work on String if the argument is a string"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 119, "user_id": 8012467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b671c5fcf115067e21acb9fcd967cc68?s=128&d=identicon&r=PG&f=1", "display_name": "Alaa Alsayed", "link": "https://stackoverflow.com/users/8012467/alaa-alsayed"}, "edited": false, "score": 1, "creation_date": 1543782065, "post_id": 53583584, "comment_id": 94031956, "body": "@Amerov yes, why not? <code>String</code> is an instance of <code>Eq</code> alright. You just need to devise a function of String to String which has an (attractive) fixed point."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1543782566, "post_id": 53583584, "comment_id": 94032090, "body": "<code>fix reverse &quot;&quot;</code> does work. <code>&quot;&quot;</code> is a non-attractive fixed point of reverse. also, <code>fix reverse &quot;12321&quot;</code> works."}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 3, "creation_date": 1543783956, "post_id": 53583584, "comment_id": 94032499, "body": "try <code>fix cos 1</code> to find the Dottie number."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 7, "last_activity_date": 1543777381, "creation_date": 1543777381, "answer_id": 53583584, "question_id": 53583488, "link": "https://stackoverflow.com/questions/53583488/a-fixed-point-for-fix-eq-a-a-a-a-a/53583584#53583584", "title": "a fixed point for fix :: Eq a =&gt; (a -&gt; a) -&gt; a -&gt; a", "body": "<p>A common misconception is that when you write <code>x = ...</code>, you <em>assign</em> a value in Haskell. In Haskell one does <em>not</em> assign a value, one <em>declares</em> one.</p>\n\n<p>This thus means that basically you constructed a variable <code>x</code> in the <code>where</code> clause that is <em>not</em> the <code>x</code> in the head of the function, so something like:</p>\n\n<pre><code>fix :: Eq a =&gt; (a -&gt; a) -&gt; a -&gt; a\nfix f _ | f x == x = x\n        | otherwise = fix f x\n    where x = f x</code></pre>\n\n<p>Here you thus defined <code>x</code> in terms of itself: <code>x = f x</code>, so that means if Haskell aims to evaluate that, it will start calculating <code>f(f(f(f(f(f(...))))))</code>, but without any checks if the <em>fixed point</em> has been reached.</p>\n\n<p>The solution is thus to introduce a new variable, for example <code>x2</code>, and thus use this like:</p>\n\n<pre><code>fix :: Eq a =&gt; (a -&gt; a) -&gt; a -&gt; a\nfix f x | x == <b>x2</b> = x\n        | otherwise = fix f <b>x2</b>\n    where <b>x2</b> = f x</code></pre>\n\n<p>So here <code>x2</code> is the next <code>x</code>. Given <code>x == x2</code>, we return <code>x</code> (or <code>x2</code>), if not, we calculate the fixed point of <code>f</code> and <code>x2</code>, so we advanced one step in the \"<em>Quest for the fixed point</em>\".</p>\n"}, {"comments": [{"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 0, "creation_date": 1543777717, "post_id": 53583592, "comment_id": 94030704, "body": "Shouldn&#39;t it be <code>where x&#39; = f x&#39;</code>?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 3, "creation_date": 1543778230, "post_id": 53583592, "comment_id": 94030849, "body": "@AaditMShah: no, since then you recursively call the fix point, without doing a proper equality check."}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1543778331, "post_id": 53583592, "comment_id": 94030881, "body": "@WillemVanOnsem No you don&#39;t. Haskell is lazy."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 0, "creation_date": 1543778404, "post_id": 53583592, "comment_id": 94030901, "body": "@AaditMShah: I know that, but again, the fixed point, like the one defined in the library is related to this one, but not the same one. The <code>fix</code> in the library, is more if you have <code>f</code>s that emit something, for example <code>f = (1:)</code>, in order to generate an infinite list of <code>1</code>s."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1543778451, "post_id": 53583592, "comment_id": 94030921, "body": "It is not because Haskell is lazy, that <code>x&#39; = f x</code>, is just equivalent to <code>x&#39; = f x</code>."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 4, "last_activity_date": 1543777413, "creation_date": 1543777413, "answer_id": 53583592, "question_id": 53583488, "link": "https://stackoverflow.com/questions/53583488/a-fixed-point-for-fix-eq-a-a-a-a-a/53583592#53583592", "title": "a fixed point for fix :: Eq a =&gt; (a -&gt; a) -&gt; a -&gt; a", "body": "<p>Give a different name to the next step of iteration, like this:</p>\n\n<pre><code>where x' = f x\n</code></pre>\n\n<p>(instead of <code>where x = f x</code>). Now review the rest of your existing code, and for each occurrence of <code>x</code>, ask yourself: did I mean <code>x</code> here, or <code>x'</code>?</p>\n"}, {"tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": false, "score": 4, "last_activity_date": 1543781154, "creation_date": 1543781154, "answer_id": 53584125, "question_id": 53583488, "link": "https://stackoverflow.com/questions/53583488/a-fixed-point-for-fix-eq-a-a-a-a-a/53584125#53584125", "title": "a fixed point for fix :: Eq a =&gt; (a -&gt; a) -&gt; a -&gt; a", "body": "<p>You already have answers on how to write<code>fix</code> from scratch. If you'd like to try it using some standard Haskell functions, I suggest you look at the function <code>until</code>.  </p>\n\n<pre><code>until :: (a -&gt; Bool) -&gt; (a -&gt; a) -&gt; a -&gt; a\n</code></pre>\n\n<p>Note the type of <code>until</code> is rather similar to the one you want. It just takes one extra argument of the form <code>a -&gt; Bool</code>. The expression <code>until p f x</code> iteratively applies <code>f</code> starting with the initial point <code>x</code>, until some condition <code>p</code> is satisfied. And you should easily be able to write <code>fix</code> in the form, </p>\n\n<pre><code>fix = until p \n</code></pre>\n\n<p>for some function <code>p :: a -&gt; Bool</code>. Now you just need to implement this stopping condition <code>p</code>, which checks if a point <code>y</code> you've calculated is a fixed point of <code>f</code>, that is if <code>f y == y</code>.  </p>\n"}], "owner": {"reputation": 119, "user_id": 8012467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b671c5fcf115067e21acb9fcd967cc68?s=128&d=identicon&r=PG&f=1", "display_name": "Alaa Alsayed", "link": "https://stackoverflow.com/users/8012467/alaa-alsayed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 236, "favorite_count": 0, "accepted_answer_id": 53583584, "answer_count": 3, "score": 1, "last_activity_date": 1563167312, "creation_date": 1543776688, "last_edit_date": 1563167312, "question_id": 53583488, "link": "https://stackoverflow.com/questions/53583488/a-fixed-point-for-fix-eq-a-a-a-a-a", "title": "a fixed point for fix :: Eq a =&gt; (a -&gt; a) -&gt; a -&gt; a", "body": "<p>Hello  everyone I'm trying to implement the higher-order function fix, which computes an <a href=\"https://en.wikipedia.org/wiki/Fixed_point_(mathematics)#Attractive_fixed_points\" rel=\"nofollow noreferrer\">attractive fixed point</a> of an arbitrary function <code>f :: a -&gt; a</code> from an initial point <code>x</code>. That is, a fixed point of the form <code>f\u1d37(x)</code> for a given <code>f</code> and <code>x</code>. </p>\n\n<pre><code>-- CONTRACT\nfix :: Eq a =&gt; (a -&gt; a) -&gt; a -&gt; a\n-- DEFINITION [TODO: Implement fix]\nfix f x  = ?\n</code></pre>\n\n<p>My current attempt is:</p>\n\n<pre><code>fix f x | f x == x = x\n        | otherwise = fix f x\n    where x = f x\n</code></pre>\n\n<p><strong>Note: Your\nfunction will not terminate if the function does not converge from the starting\npoint</strong>.\ncan someone help me please ? I tried but it didn't return anything </p>\n"}, {"tags": ["list", "performance", "haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1543774027, "post_id": 53583073, "comment_id": 94029577, "body": "Yes, if you use <code>foldl1</code>, you make concatenating <i>O(n^2)</i>, instead of <i>O(n)</i>, in order to boost performance, you should use <code>foldr</code>."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1543775312, "post_id": 53583073, "comment_id": 94029982, "body": "Appending to the end of a list requires tho whole list to be reconstructed from scratch. You you better avoid that by means of some logic (append a long list to the end of a small list like @Willem Van Onsem suggested or use <a href=\"https://wiki.haskell.org/Difference_list\" rel=\"nofollow noreferrer\">Difference List</a>."}], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1543781150, "post_id": 53583623, "comment_id": 94031702, "body": "(++) by itself is O(1), it depends on how it&#39;s used. e.g. <code>head $ foldl1 (++) (map show [1..n])</code> <a href=\"https://stackoverflow.com/a/14942678/849891\">is linear in <code>n</code></a>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1543781590, "post_id": 53583623, "comment_id": 94031838, "body": "@WillNess, that&#39;s true, but very sensitive to context. In many cases (such as this one), we are quite interested in the total amortized cost of an operation (the amount of work it does plus the amount of work it suspends for later). Sometimes we need to use a more detailed analysis, such as when mapping a function over an infinite list."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1543781972, "post_id": 53583623, "comment_id": 94031934, "body": "@dfeuer what I&#39;m saying is, we can&#39;t say <i>anything</i> about a piece of code&#39;s cost by itself; must specify how it is used: as an argument to <code>head</code>, or <code>last</code>, or <code>flip const</code> is three very different use cases."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1543782646, "post_id": 53583623, "comment_id": 94032109, "body": "@WillNess, I was being a bit sloppy in my last message. Potentially infinite lists are a bit of a weird case, but consider something like sequences. You can get a nice upper bound on the cost of a sequence of <code>Seq</code> operations using the advertised amortized bounds of each operation. If you&#39;re doing something a bit weird, you may indeed be able to obtain a tighter bound by considering the detailed incremental behavior of functions like <code>fmap</code>, <code>liftA2</code>, <code>zipWith</code>, <code>&lt;&gt;</code>, <code>inits</code>, and <code>tails</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1543783020, "post_id": 53583623, "comment_id": 94032224, "body": "@dfeuer I&#39;m unfamiliar with <code>Seq</code> apart from its surface API. I guess the more strictness there is to a type, the more we can say about its performance upfront. seems logical."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1543795732, "post_id": 53583623, "comment_id": 94035200, "body": "@WillNess, well then, you should probably read some of the source! Some parts (Louis Wasserman&#39;s <code>replicateA</code>, <code>inits</code>, and <code>tails</code> and my <code>liftA2</code>, <code>*&gt;</code>, <code>zipWith</code>, and <code>chunksOf</code> in particular) are rather interesting. I challenge you to come up with an incrementally optimal <code>&lt;* </code> to fill out the <code>Applicative</code> implementation."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1543818197, "post_id": 53583623, "comment_id": 94040066, "body": "@dfeuer thanks for the suggestions and for the challenge. :) Maybe after the New Years. :)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1543862162, "post_id": 53583623, "comment_id": 94061989, "body": "@WillNess, when you try it: <code>xs &lt;* ys</code> should have a time and space complexity of <code>O (length xs * log (length ys))</code>, I believe, and it should be incremental just like <code>&lt;*&gt;</code>. Really it should be possible to adapt the ideas of <code>&lt;*&gt;</code> and <code>replicate</code> fairly directly, but the details twist my brain up in knots"}], "tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": true, "score": 3, "last_activity_date": 1543777669, "creation_date": 1543777669, "answer_id": 53583623, "question_id": 53583073, "link": "https://stackoverflow.com/questions/53583073/haskell-list-creation-and-concatenation-performance/53583623#53583623", "title": "Haskell list creation and concatenation performance", "body": "<p>As already mentioned in the comments, your lists are associating in the worst possible way. If we look at the usual (and most sensible) definition of <code>(++)</code>, we see</p>\n\n<pre><code>(++) :: [a] -&gt; [a] -&gt; [a]\n[] ++ ys = ys\n(x:xs) ++ ys = x : (xs ++ ys)\n</code></pre>\n\n<p>(<a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Base.html#%2B%2B\" rel=\"nofollow noreferrer\">Source</a>)</p>\n\n<p>So <code>(++)</code> is <code>O(n)</code> where <code>n</code> is the length of the <em>first list only</em>. It doesn't depend on the length of the second. When you do <code>foldl1</code> (or any of the other <code>foldl</code> variants), the derivation looks something like...</p>\n\n<pre><code>foldl1 (++) [a, b, c, d]\n==&gt; ((a ++ b) ++ c) ++ d\n</code></pre>\n\n<p>Since we only look at the first argument to determine the complexity, if we let <code>n</code> be the sum of the lengths of <code>a</code>, <code>b</code>, <code>c</code>, <code>d</code>, then we're iterating over the elements of <code>a</code> three times, those of <code>b</code> twice, and <code>c</code> once. So we're doing, ostensibly, <code>n</code> operations <code>n</code> times, for a total of <code>O(n^2)</code> operations. (You can do the math of this rigorously. You'll end up with a sum resulting in a triangular number, and the triangular number formula is quadratic, which is where the <code>n^2</code> comes from. Proof is left as an exercise to the reader.)</p>\n\n<p>On the other hand, if we use <code>foldr</code>, then</p>\n\n<pre><code>foldlr (++) [] [a, b, c, d]\n==&gt; a ++ (b ++ (c ++ (d ++ [])))\n</code></pre>\n\n<p>Again, we only look at the left-hand argument every time. In this case, the arguments are organized nicely, so we only iterate over each element once, resulting in <code>O(n)</code> recursive steps.</p>\n\n<p><a href=\"https://wiki.haskell.org/Difference_list\" rel=\"nofollow noreferrer\">Difference lists</a> solve this in a different way, by \"magically\" reassociating your parentheses to be better placed. You can read more about those in the linked article.</p>\n\n<p>The reason <code>concat</code> works better is that the people who wrote Haskell knew about these problems and knew to use <code>foldr</code> (or equivalent) to get the better performance.</p>\n"}], "owner": {"reputation": 21, "user_id": 10735677, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-d8F-KLVPhQQ/AAAAAAAAAAI/AAAAAAAAACo/RP8pA351fjw/photo.jpg?sz=128", "display_name": "hamza B", "link": "https://stackoverflow.com/users/10735677/hamza-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 380, "favorite_count": 0, "closed_date": 1543782445, "accepted_answer_id": 53583623, "answer_count": 1, "score": 0, "last_activity_date": 1543777669, "creation_date": 1543773694, "question_id": 53583073, "link": "https://stackoverflow.com/questions/53583073/haskell-list-creation-and-concatenation-performance", "closed_reason": "Duplicate", "title": "Haskell list creation and concatenation performance", "body": "<p>In the process of playing with haskell and finding solution for project euler n\u00b040 i found that this code is very fast:</p>\n\n<pre><code> p = concat [show n | n &lt;- [1..]]\ndl x = p !! x\n\ny = [10^a - 1| a&lt;-[0..6]]\ns = [digitToInt (dl b)::Int | b &lt;-y]\n</code></pre>\n\n<p>but this one is extremly slow like a millions time slower</p>\n\n<pre><code>p = foldl1 (++) (map show [1..1000000])\ndl x = p !! x\n\ny = [10^a - 1| a&lt;-[0..6]]\ns = [digitToInt (dl b)::Int | b &lt;-y]\n</code></pre>\n\n<p>can anybody explain to me why? thanks</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1543765060, "post_id": 53581673, "comment_id": 94026957, "body": "But here the type of objects is not <code>[Integer]</code>, but <code>[[Integer]]</code>."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1543774556, "post_id": 53581673, "comment_id": 94029743, "body": "May be a function like <code>sequence $ [0..] &gt;&gt;= pure . (flip vectorOf) arbitrary</code> with type signature <code>Gen [[Integer]]</code> does what you need. The sub arrays are increasing though but in length not as ascending."}], "answers": [{"comments": [{"owner": {"reputation": 71, "user_id": 8658248, "user_type": "registered", "profile_image": "https://graph.facebook.com/1512880645455403/picture?type=large", "display_name": "Erik H Nguyen", "link": "https://stackoverflow.com/users/8658248/erik-h-nguyen"}, "edited": false, "score": 1, "creation_date": 1543767756, "post_id": 53581873, "comment_id": 94027747, "body": "Hi thanks for your answer, excuse me if I&#39;m wrong but dont you change the type of  incList this way? I need it according to the assignmment to be exactly of the type incList:: Gen [Integer], also that one should use do-notation but that wasnt mandatory."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 71, "user_id": 8658248, "user_type": "registered", "profile_image": "https://graph.facebook.com/1512880645455403/picture?type=large", "display_name": "Erik H Nguyen", "link": "https://stackoverflow.com/users/8658248/erik-h-nguyen"}, "edited": false, "score": 0, "creation_date": 1543767816, "post_id": 53581873, "comment_id": 94027760, "body": "@ErikHNguyen: well a <code>sample&#39;</code> generate an list of items (11 iirc), so that means you have no control over constraints (like incrementing the size of the list) each step."}, {"owner": {"reputation": 71, "user_id": 8658248, "user_type": "registered", "profile_image": "https://graph.facebook.com/1512880645455403/picture?type=large", "display_name": "Erik H Nguyen", "link": "https://stackoverflow.com/users/8658248/erik-h-nguyen"}, "edited": false, "score": 0, "creation_date": 1543768081, "post_id": 53581873, "comment_id": 94027833, "body": "&quot;give def for a generator for lists of Integers, where for every list generated, the length of the list increments by one&quot;.Maybe I phrased it wrong in my question? sorry eng is not my mother tongue."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 71, "user_id": 8658248, "user_type": "registered", "profile_image": "https://graph.facebook.com/1512880645455403/picture?type=large", "display_name": "Erik H Nguyen", "link": "https://stackoverflow.com/users/8658248/erik-h-nguyen"}, "edited": false, "score": 0, "creation_date": 1543768141, "post_id": 53581873, "comment_id": 94027853, "body": "@ErikHNguyen: no, that was correct. But a <code>sample&#39;</code> can definitely not do that, since <code>sample&#39;</code> always generates a list of 11 elements. So it would, regardless of the argument, stop after generating 11 elements."}, {"owner": {"reputation": 71, "user_id": 8658248, "user_type": "registered", "profile_image": "https://graph.facebook.com/1512880645455403/picture?type=large", "display_name": "Erik H Nguyen", "link": "https://stackoverflow.com/users/8658248/erik-h-nguyen"}, "edited": false, "score": 0, "creation_date": 1543768325, "post_id": 53581873, "comment_id": 94027904, "body": "so it would be a list of eleven elements which each have elements ranging from 0 to 10? I think that is how they want it to be"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 71, "user_id": 8658248, "user_type": "registered", "profile_image": "https://graph.facebook.com/1512880645455403/picture?type=large", "display_name": "Erik H Nguyen", "link": "https://stackoverflow.com/users/8658248/erik-h-nguyen"}, "edited": false, "score": 0, "creation_date": 1543768385, "post_id": 53581873, "comment_id": 94027922, "body": "@ErikHNguyen: but the idea of <code>sample&#39;</code> is typically that a programmer itself is <i>not</i> supposed to add such constraints to the <i>sequence</i> of elements. Typically the idea of <code>Arbitrary</code> is to make a sample with some sort of distribution, but not with <i>transitive dependencies</i>."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1543765685, "creation_date": 1543765685, "answer_id": 53581873, "question_id": 53581673, "link": "https://stackoverflow.com/questions/53581673/beginner-haskell-quickcheck-generator/53581873#53581873", "title": "Beginner Haskell, quickcheck generator", "body": "<p>I think you here aim to do too much at once. Let us first construct a generator for a random list of <code>Ord</code>ered objects with a given length in ascending order:</p>\n\n<pre><code>import Data.List(sort)\n\nincList :: (Arbitrary a, Ord a) =&gt; Int -&gt; Gen [a]\nincList n = fmap sort (vectorOf n arbitrary)\n</code></pre>\n\n<p>Now we can construct a <code>Gen</code>erator that generates an endless list of lists by each time incrementing the size with one:</p>\n\n<pre><code>incLists :: (Arbitrary a, Ord a) =&gt; Gen [[a]]\nincLists = mapM incList [0..]\n</code></pre>\n\n<p>We can then generate values from this <code>Gen</code>erator with <a href=\"http://hackage.haskell.org/package/QuickCheck-2.12.6.1/docs/Test-QuickCheck.html#v:generate\" rel=\"nofollow noreferrer\"><strong><code>generate :: Gen a -&gt; IO [a]</code></strong></a>:</p>\n\n<pre><code>Prelude File&gt; generate incLists :: IO [[Int]]\n[[],[-19],[6,25],[-19,-14,15],[-4,6,20,28],[-23,-19,-6,-1,22],[-29,-21,-13,-9,-9,15],[-23,-15,-4,3,3,27,27],[-29,-29,-26,-25,18,19,23,27],[-24,-23,-16,-14,0,13,17,17,23],[-29,-15,-12,-4,-1,1,2,20,22,26],[-26,-24,-22,-16,-12,5,5,10,11,25,29],[-29,-28,-20,-14,-9,-7,-3,14,15,20,26,28],...]\n</code></pre>\n"}], "owner": {"reputation": 71, "user_id": 8658248, "user_type": "registered", "profile_image": "https://graph.facebook.com/1512880645455403/picture?type=large", "display_name": "Erik H Nguyen", "link": "https://stackoverflow.com/users/8658248/erik-h-nguyen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 211, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1543765685, "creation_date": 1543764254, "question_id": 53581673, "link": "https://stackoverflow.com/questions/53581673/beginner-haskell-quickcheck-generator", "title": "Beginner Haskell, quickcheck generator", "body": "<p>I want to generate an increasing number of lists i.e.</p>\n\n<pre><code> prelude&gt;sample' incList\n [[],[19],[6,110],[24,67,81]....]\n</code></pre>\n\n<p>How should I use vectorOf?</p>\n\n<pre><code> incList:: Gen [Integer]\n incList=   \n do x&lt;-vectorOf [0..] arbitrary\n    return x\n</code></pre>\n\n<p>I cant think of a way to just take out the first number from the list one at a time :/ Maybe something with fmap take 1, I dunno..</p>\n"}, {"tags": ["c", "haskell", "ffi", "libsodium"], "answers": [{"comments": [{"owner": {"reputation": 932, "user_id": 6629874, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/3SUbo.jpg?s=128&g=1", "display_name": "5ndG", "link": "https://stackoverflow.com/users/6629874/5ndg"}, "edited": false, "score": 0, "creation_date": 1543774803, "post_id": 53583190, "comment_id": 94029822, "body": "I have just run the Haskell code again, but the signature is the same as the one in the question."}, {"owner": {"reputation": 932, "user_id": 6629874, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/3SUbo.jpg?s=128&g=1", "display_name": "5ndG", "link": "https://stackoverflow.com/users/6629874/5ndg"}, "edited": false, "score": 0, "creation_date": 1543775265, "post_id": 53583190, "comment_id": 94029964, "body": "But it does come out differently each time for the C code."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 932, "user_id": 6629874, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/3SUbo.jpg?s=128&g=1", "display_name": "5ndG", "link": "https://stackoverflow.com/users/6629874/5ndg"}, "edited": false, "score": 0, "creation_date": 1543775343, "post_id": 53583190, "comment_id": 94029996, "body": "@5ndG Hm. Okay. There are also some comments in the documentation that call my answer into question: &quot;The Ed25519 system was designed to compute deterministic signatures. Non-deterministic (but also non-standard) signatures can be produced by compiling libsodium with the <code>ED25519_NONDETERMINISTIC</code> macro defined.&quot; Is it possible the libsodium your C code is linking against and the libsodium your Haskell code is linking against were built differently?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 932, "user_id": 6629874, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/3SUbo.jpg?s=128&g=1", "display_name": "5ndG", "link": "https://stackoverflow.com/users/6629874/5ndg"}, "edited": false, "score": 0, "creation_date": 1543775750, "post_id": 53583190, "comment_id": 94030106, "body": "@5ndG Got it. I was barking up a completely wrong tree. I&#39;ve corrected my answer... and this time I tested it before spouting off. ;-)"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1543785597, "post_id": 53583190, "comment_id": 94032883, "body": "Consider using the saltine library&#39;s bindings if this is for more than play."}, {"owner": {"reputation": 932, "user_id": 6629874, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/3SUbo.jpg?s=128&g=1", "display_name": "5ndG", "link": "https://stackoverflow.com/users/6629874/5ndg"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1543829371, "post_id": 53583190, "comment_id": 94044664, "body": "@ThomasM Why? Is it risky to do it myself?"}, {"owner": {"reputation": 932, "user_id": 6629874, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/3SUbo.jpg?s=128&g=1", "display_name": "5ndG", "link": "https://stackoverflow.com/users/6629874/5ndg"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1543834368, "post_id": 53583190, "comment_id": 94047144, "body": "@ThomasM I am a bit wary of Saltine, because of the &quot;Please try it out, but don&#39;t just yet stake your life or job on it.&quot; at the top of the README on its Github page. I&#39;m finding it difficult to find a crypto library in Haskell that I can trust, and that doesn&#39;t require me to make decisions that I&#39;m not qualified to make."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1543846606, "post_id": 53583190, "comment_id": 94053626, "body": "I&#39;d say it is more risky to do it yourself, yes. Having put saltine through the paces, and fixed a security-critical bug I&#39;d say the warning was justified.  Perhaps oddly, I came away from the experience with slightly more faith in saltine (the internals aren&#39;t scary).  If I were putting live on the line then I&#39;d probably invest in Liquid Haskell + Saltine instead of building a new &quot;saltine&quot; (and assuming Haskell to start with)."}, {"owner": {"reputation": 932, "user_id": 6629874, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/3SUbo.jpg?s=128&g=1", "display_name": "5ndG", "link": "https://stackoverflow.com/users/6629874/5ndg"}, "edited": false, "score": 0, "creation_date": 1543850970, "post_id": 53583190, "comment_id": 94056234, "body": "Thanks for the advice.  Yes I&#39;ll try LH + Saltine.  I also thought of generating a load of test data from C, and using it to test Saltine with, to check that Saltine always produces the same results."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1543775728, "last_edit_date": 1543775728, "creation_date": 1543774541, "answer_id": 53583190, "question_id": 53581664, "link": "https://stackoverflow.com/questions/53581664/haskell-foreign-function-interface-binding-to-libsodium-bad-signature/53583190#53583190", "title": "Haskell Foreign function interface binding to libsodium - bad signature", "body": "<p><code>crypto_sign_SECRETKEYBYTES</code> is 64, not 32. Make your secret key this long, and the C and Haskell code will agree with each other.</p>\n"}], "owner": {"reputation": 932, "user_id": 6629874, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/3SUbo.jpg?s=128&g=1", "display_name": "5ndG", "link": "https://stackoverflow.com/users/6629874/5ndg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 53583190, "answer_count": 1, "score": 0, "last_activity_date": 1543775728, "creation_date": 1543764219, "last_edit_date": 1592644375, "question_id": 53581664, "link": "https://stackoverflow.com/questions/53581664/haskell-foreign-function-interface-binding-to-libsodium-bad-signature", "title": "Haskell Foreign function interface binding to libsodium - bad signature", "body": "<p>I am making a binding to <a href=\"https://libsodium.gitbook.io/doc/\" rel=\"nofollow noreferrer\">libsodium</a> so I can sign bytestrings in Haskell, but the signature does not match the one created by C for the same message and secret key.</p>\n<p>I am binding to this function in libsodium:</p>\n<pre><code>int crypto_sign_detached(unsigned char *sig, unsigned long long *siglen,\n                         const unsigned char *m, unsigned long long mlen,\n                         const unsigned char *sk);\n</code></pre>\n<p>The docs say:</p>\n<blockquote>\n<p>The crypto_sign_detached() function signs the message m whose length is mlen bytes, using the secret key sk, and puts the signature into sig, which can be up to crypto_sign_BYTES long.</p>\n<p>The actual length of the signature is put into siglen if siglen is not NULL.</p>\n<p>It is safe to ignore siglen and always consider a signature as crypto_sign_BYTES bytes long: shorter signatures will be transparently padded with zeros if necessary.</p>\n</blockquote>\n<p>crypto_sign_BYTES is 64.</p>\n<p>Here is the Haskell code (sorry about the length, but it is as short as possible):</p>\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\n\nimport qualified Data.ByteString as B\nimport qualified Data.ByteString.Base16 as B16\nimport qualified Data.ByteString.Internal as Bi\nimport qualified Foreign as F\nimport qualified Foreign.C.Types as T\nimport System.IO.Unsafe (unsafePerformIO)\n\nsecretkey :: B.ByteString\nsecretkey = B.pack [0x34, 0xEB, 0xA3, 0x9F, 0xC5, 0xA1, 0xB4, 0x1D,\n                    0x64, 0x12, 0xCE, 0xC3, 0xD2, 0x0A, 0x7F, 0xA8,\n                    0x24, 0x24, 0x2A, 0xDC, 0x1E, 0x6C, 0x04, 0x48,\n                    0xCE, 0x91, 0xB3, 0xC4, 0x84, 0xCC, 0x7A, 0xC6]\n\nmain :: IO ()\nmain = do\n    status &lt;- c_sodium_init\n    case status of\n      0 -&gt;\n        case sign &quot;test&quot; secretkey of\n          Right sig -&gt; do\n            print $ B16.encode sig\n          Left err -&gt; print err\n      _ -&gt; putStrLn &quot;Could not initialize.&quot;\n\ncrypto_sign_BYTES :: Int\ncrypto_sign_BYTES = 64\n\npackCString :: Int -&gt; F.Ptr F.Word8 -&gt; IO B.ByteString\npackCString len cstr = create len $ \\p -&gt; Bi.memcpy p cstr len\n\ncreate :: Int -&gt; (F.Ptr F.Word8 -&gt; IO ()) -&gt; IO B.ByteString\ncreate l f = do\n  fp &lt;- Bi.mallocByteString l\n  F.withForeignPtr fp f\n  return $! Bi.PS fp 0 l\n\nforeign import ccall unsafe &quot;sodium.h crypto_sign_detached&quot;\n  c_crypto_sign_detached\n    :: CUString\n    -&gt; F.Ptr T.CULLong\n    -&gt; CUString\n    -&gt; T.CULLong\n    -&gt; CUString\n    -&gt; IO T.CInt\n\nsign :: B.ByteString -&gt; B.ByteString -&gt; Either Int B.ByteString\nsign message secretKey = unsafePerformIO $\n  useAsCString message $ \\messagePtr -&gt;\n  useAsCString secretKey $ \\secretKeyPtr -&gt;\n  F.allocaBytes crypto_sign_BYTES $ \\sig -&gt; do\n    status &lt;- c_crypto_sign_detached\n                  sig\n                  F.nullPtr\n                  messagePtr\n                  (fromIntegral $ B.length message)\n                  secretKeyPtr\n    case status of\n      0 -&gt; do\n        packed &lt;- packCString crypto_sign_BYTES $ F.castPtr sig\n        return $ Right packed\n      errCode -&gt; return $ Left $ fromIntegral errCode\n\nforeign import ccall unsafe &quot;sodium.h sodium_init&quot;\n  c_sodium_init :: IO T.CInt\n\ntype CUString = F.Ptr T.CUChar\n\nuseAsCString :: B.ByteString -&gt; (CUString -&gt; IO a) -&gt; IO a\nuseAsCString (Bi.PS fp o l) action =\n  F.allocaBytes (l+1) $ \\buf -&gt;\n    F.withForeignPtr fp $ \\p -&gt; do\n      Bi.memcpy buf (p `F.plusPtr` o) (fromIntegral l)\n      F.pokeByteOff buf l (0::F.Word8)\n      action (F.castPtr buf)\n</code></pre>\n<p>Here is the C code:</p>\n<pre><code>#include &lt;sodium.h&gt;\n#include &lt;stdio.h&gt;\n\nint main (void)\n{\n    if (sodium_init() &lt; 0) {\n        printf(&quot;could not initialize&quot;);\n    }\n\n    unsigned char message[4] = &quot;test&quot;;\n    unsigned char sk[32] = {0x34, 0xEB, 0xA3, 0x9F, 0xC5, 0xA1, 0xB4, \n                            0x1D, 0x64, 0x12, 0xCE, 0xC3, 0xD2, 0x0A,\n                            0x7F, 0xA8, 0x24, 0x24, 0x2A, 0xDC, 0x1E,\n                            0x6C, 0x04, 0x48, 0xCE, 0x91, 0xB3, 0xC4, \n                            0x84, 0xCC, 0x7A, 0xC6};\n\n    unsigned char sig[crypto_sign_BYTES];\n    \n    crypto_sign_detached(sig, NULL, message, 4, sk);\n\n    int i;\n    for (i=0; i&lt;64; i++)\n    {\n        printf(&quot;%02X&quot;, sig[i]);\n    }\n    printf(&quot;\\n&quot;);\n}\n</code></pre>\n<p>The Haskell output is:</p>\n<pre><code>&quot;17aa8f20476a8e70f860707b8fd7f8f78ffd778690a755ddf3a432a81786ea3dea9efa2028d8896efaf1efe428781b3af83ab0450fc94a2ae6ec2c1a34ca830e&quot;\n</code></pre>\n<p>The C output is:</p>\n<pre><code>17AA8F20476A8E70F860707B8FD7F8F78FFD778690A755DDF3A432A81786EA3D4B54ECDA53E7774C43BE7098A96C39A59664953E40AFFB54ACB84E09CBFF4E07\n</code></pre>\n<p>Why do these signatures only match for the first 32 bytes of the 64?  If it helps, I have put the code on <a href=\"https://github.com/8n8/libsodiumIssue\" rel=\"nofollow noreferrer\">Github</a>.</p>\n"}, {"tags": ["json", "parsing", "haskell", "aeson"], "answers": [{"comments": [{"owner": {"reputation": 98, "user_id": 3938382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4775dd53b1b7b5f5514da9154057efd?s=128&d=identicon&r=PG", "display_name": "bruteforcecat", "link": "https://stackoverflow.com/users/3938382/bruteforcecat"}, "edited": false, "score": 0, "creation_date": 1543756827, "post_id": 53579747, "comment_id": 94024680, "body": "Thank you so much Willem. This is so helpful. The key takeaway for me is to use <code>AE.encode</code> to serialize Object in Aeson :) Can&#39;t believe I get stuck here for several hours. Thanks"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 0, "last_activity_date": 1543750010, "creation_date": 1543750010, "answer_id": 53579747, "question_id": 53579583, "link": "https://stackoverflow.com/questions/53579583/parsing-json-to-map-string-string-with-aeson/53579747#53579747", "title": "Parsing JSON to Map String String with Aeson", "body": "<p>We can decode the <code>ByteString</code> with:</p>\n\n<pre><code>Prelude Data.Aeson Bs Hm Mp Tx&gt; decode text :: Maybe Object\nJust (fromList [(\"jp\",Object (fromList [(\"translation\",Object (fromList [(\"name\",String \"JP Name\"),(\"description\",Array [String \"I am a\",String \"jp person\"])]))])),(\"en\",Object (fromList [(\"translation\",Object (fromList [(\"name\",String \"Name\"),(\"description\",Array [String \"I am a\",String \"en person\"])]))]))])\n</code></pre>\n\n<p>So then we only need to perform a mapping on the <code>HashMap Text Object</code> wrapped in the `Object constructor:</p>\n\n<pre><code>import Data.Aeson\nimport qualified Data.ByteString.Lazy.Char8 as Bs\nimport qualified Data.HashMap.Lazy as Hm\nimport qualified Data.Map as Mp\nimport qualified Data.Text as Tx\n\nprocess :: Value -&gt; Maybe (Mp.Map String String)\nprocess (Object m) = Just ((Mp.fromList . map f) (Hm.toList m))\n    where f (x, y) = (Tx.unpack x, Bs.unpack (encode y))\nprocess _ = Nothing\n</code></pre>\n\n<p>We then obtain a <code>Map String String</code> wrapped in a <code>Maybe</code> (since both decoding, and the processing can go wrong, it is probably better to use a <code>Maybe</code>), that maps <code>String</code>s on <code>String</code>s:</p>\n\n<pre><code>Prelude Data.Aeson Bs Hm Mp Tx&gt; decode text &gt;&gt;= process\nJust (fromList [(\"en\",\"{\\\"translation\\\":{\\\"name\\\":\\\"Name\\\",\\\"description\\\":[\\\"I am a\\\",\\\"en person\\\"]}}\"),(\"jp\",\"{\\\"translation\\\":{\\\"name\\\":\\\"JP Name\\\",\\\"description\\\":[\\\"I am a\\\",\\\"jp person\\\"]}}\")])\n</code></pre>\n\n<p>That being said, I'm not sure that a JSON blob as value is here what you want, since now one can not \"look into\" the value and inspect what is inside that element. Furthermore if you want to do a lot of lookups, <code>Text</code> is typically an order of magnitude faster when you want to check if two <code>Text</code>s are the same.</p>\n"}], "owner": {"reputation": 98, "user_id": 3938382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4775dd53b1b7b5f5514da9154057efd?s=128&d=identicon&r=PG", "display_name": "bruteforcecat", "link": "https://stackoverflow.com/users/3938382/bruteforcecat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 243, "favorite_count": 0, "accepted_answer_id": 53579747, "answer_count": 1, "score": 1, "last_activity_date": 1543750010, "creation_date": 1543748493, "last_edit_date": 1543749007, "question_id": 53579583, "link": "https://stackoverflow.com/questions/53579583/parsing-json-to-map-string-string-with-aeson", "title": "Parsing JSON to Map String String with Aeson", "body": "<p>I am trying to parse a JSON from API with a data structure like</p>\n\n<pre><code>{\n  \"en\": {\n    \"translation\": {\n      \"name\": \"Name\",\n      \"description\": [\"I am a\", \"en person\"]\n    }\n  },\n  \"jp\": {\n    \"translation\": {\n      \"name\": \"JP Name\",\n      \"description\": [\"I am a\", \"jp person\"]\n    }\n  }\n}\n</code></pre>\n\n<p>So I will just want to parse them to something like <code>newtype Translations = Map String String</code>. locale will be key name and the value will be just the string of JSON translation like <code>{\"name\": \"Name\", \"description\": [\"I am a\", en person\"]}</code> because the value could be arbitrarily complex and I dun care/need to convert it to other Haskell data structure.</p>\n\n<p>I tried so many way to write a proper <code>parseJSON</code> for <code>Translation</code> but still can't make it. </p>\n\n<p>Any help would be appreciated!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1543742844, "post_id": 53578734, "comment_id": 94021444, "body": "Aeson can be <a href=\"http://hackage.haskell.org/package/aeson-1.4.1.0/docs/Data-Aeson.html#v:decode\" rel=\"nofollow noreferrer\">decode</a> from ByteString, the first thing to do may be replace <code>&quot;\\\\\\&quot;&quot;</code> to <code>&quot;\\&quot;&quot;</code>."}, {"owner": {"reputation": 10216, "user_id": 854207, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/R6DhK.jpg?s=128&g=1", "display_name": "paul", "link": "https://stackoverflow.com/users/854207/paul"}, "reply_to_user": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1543743762, "post_id": 53578734, "comment_id": 94021608, "body": "Mmmm weird Json $ decode response does not compile"}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1543746568, "post_id": 53578734, "comment_id": 94022183, "body": "The JSON string seems ill-format, the correct format should be: <code>&quot;{\\&quot;Title\\&quot;:...}&quot;</code>, not <code>&quot;\\&quot;{\\\\\\&quot;Title\\\\\\&quot;:...}\\&quot;&quot;</code>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 1, "creation_date": 1543748023, "post_id": 53578734, "comment_id": 94022511, "body": "@assembly.jc: that is probably due to the <code>show</code> part, which thus wraps it in a &quot;representation layer&quot;."}, {"owner": {"reputation": 10216, "user_id": 854207, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/R6DhK.jpg?s=128&g=1", "display_name": "paul", "link": "https://stackoverflow.com/users/854207/paul"}, "edited": false, "score": 0, "creation_date": 1543748599, "post_id": 53578734, "comment_id": 94022645, "body": "Yeah that\u2019s why as I mentioned I was trying Json $ decode response, but it seems decore with byteString is not compiling"}, {"owner": {"reputation": 29209, "user_id": 495796, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/86637c99f25d60157aa0f2e7eab90148?s=128&d=identicon&r=PG", "display_name": "Robin Green", "link": "https://stackoverflow.com/users/495796/robin-green"}, "edited": false, "score": 0, "creation_date": 1543749122, "post_id": 53578734, "comment_id": 94022765, "body": "This question is very unclear. What do you mean by &quot;connector&quot;? Why have you pasted some string at the end of the question?"}, {"owner": {"reputation": 10216, "user_id": 854207, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/R6DhK.jpg?s=128&g=1", "display_name": "paul", "link": "https://stackoverflow.com/users/854207/paul"}, "edited": false, "score": 0, "creation_date": 1543749700, "post_id": 53578734, "comment_id": 94022903, "body": "I mean is a Rest connector, and I paste the data to show the format that is being sent"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1543749973, "post_id": 53578734, "comment_id": 94022967, "body": "Related: <a href=\"https://stackoverflow.com/a/53295993/1651941\">stackoverflow.com/a/53295993/1651941</a>"}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 1, "creation_date": 1543758108, "post_id": 53578734, "comment_id": 94025026, "body": "I try in GHCi: <code>jsonStr = &quot;{\\&quot;Title\\&quot;:\\&quot;Mad Max\\&quot;,\\&quot;Year\\&quot;:\\&quot;1979\\&quot;,\\&quot;R...</code>,  <code>decode (pack jsonStr)::Maybe Value</code>, can successfully decode. What is the error meesage in your case?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543761140, "post_id": 53578734, "comment_id": 94025771, "body": "You start with a <code>ByteString</code>, then use <code>show</code> to get a <code>String</code> representation of the byte string, then use <code>json</code> to <i>encode</i> that string in JSON. Depending on what you really want to do, you can probably just use <code>response</code> as is."}, {"owner": {"reputation": 10216, "user_id": 854207, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/R6DhK.jpg?s=128&g=1", "display_name": "paul", "link": "https://stackoverflow.com/users/854207/paul"}, "reply_to_user": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1543781703, "post_id": 53578734, "comment_id": 94031865, "body": "@assembly.jc I update my question, I cannot make it works with decode"}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1543807901, "post_id": 53578734, "comment_id": 94037519, "body": "You may need just decode <code>ByteString</code> to <code>Text</code>. see: <a href=\"http://hackage.haskell.org/package/text-1.2.3.1/docs/Data-Text-Encoding.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/text-1.2.3.1/docs/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 10216, "user_id": 854207, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/R6DhK.jpg?s=128&g=1", "display_name": "paul", "link": "https://stackoverflow.com/users/854207/paul"}, "edited": false, "score": 0, "creation_date": 1543878404, "post_id": 53598192, "comment_id": 94069040, "body": "raw function is just what I need, thank you so much for!"}], "tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": true, "score": 2, "last_activity_date": 1543855676, "creation_date": 1543855676, "answer_id": 53598192, "question_id": 53578734, "link": "https://stackoverflow.com/questions/53578734/bytestring-to-json-format/53598192#53598192", "title": "ByteString to Json format", "body": "<p>If I understand your question correctly:</p>\n\n<ul>\n<li>you know that the <code>ByteString</code> returned from <code>simpleGetRequest</code> contains JSON</li>\n<li>you don't care about the specific contents of that JSON</li>\n<li>you want to pass the <code>ByteString</code> to <a href=\"https://hackage.haskell.org/package/scotty-0.11.2/docs/Web-Scotty.html#v:json\" rel=\"nofollow noreferrer\"><code>json</code> from Scotty</a></li>\n</ul>\n\n<p><code>aeson</code> provides a type <a href=\"https://hackage.haskell.org/package/aeson-1.4.2.0/docs/Data-Aeson-Types.html#t:Value\" rel=\"nofollow noreferrer\"><code>Value</code></a> to represent JSON in general, without any details of what fields are present.  So one option is:</p>\n\n<pre><code>let response = case decode bsResponse of\n    Nothing -&gt; Null\n    Just value -&gt; value\njson response\n</code></pre>\n\n<p>where <code>Null</code> is one of the constructors of <a href=\"https://hackage.haskell.org/package/aeson-1.4.2.0/docs/Data-Aeson-Types.html#t:Value\" rel=\"nofollow noreferrer\"><code>Value</code></a>.  Of course you can make other choices of what to do in the <code>Nothing</code> case.</p>\n\n<p>Another option, which saves the round-trip of parsing JSON &amp; then re-encoding it, is to use <a href=\"https://hackage.haskell.org/package/scotty-0.11.2/docs/Web-Scotty.html#v:raw\" rel=\"nofollow noreferrer\"><code>raw :: ByteString -&gt; ActionM ()</code> from Scotty</a></p>\n\n<p>The <code>Generic</code> way of defining <code>ToJSON</code> and <code>FromJSON</code>, which you mention at the top of your post, works for user-defined types, when each field of the type already has <code>ToJSON</code> / <code>FromJSON</code> defined.  <code>ByteString</code> isn't like that.  In general, <code>ByteString</code> can contain any bytes.  It is often used in different parts of the same program to represent different types of value, which should be represented differently in JSON.  So we have to be explicit about what we're expecting &amp; how we want to encode it.</p>\n"}], "owner": {"reputation": 10216, "user_id": 854207, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/R6DhK.jpg?s=128&g=1", "display_name": "paul", "link": "https://stackoverflow.com/users/854207/paul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 913, "favorite_count": 0, "accepted_answer_id": 53598192, "answer_count": 1, "score": -2, "last_activity_date": 1543855676, "creation_date": 1543740142, "last_edit_date": 1543781666, "question_id": 53578734, "link": "https://stackoverflow.com/questions/53578734/bytestring-to-json-format", "title": "ByteString to Json format", "body": "<p>I\u00b4m building a connector that call an API and return some data in <code>json</code> format. The data type when I receive the rest response is <code>ByteString</code>, so \nonce I render with Scotty http server I use <code>aeson</code>. Looking the aeson documentation I see the use of:</p>\n\n<pre><code>instance ToJSON ByteString\ninstance FromJSON ByteString\n</code></pre>\n\n<p>But it's not compiling since <code>not instance for (Generic ByteString)</code> </p>\n\n<pre><code>responseMovie :: ActionM ()\nresponseMovie = do movie &lt;- extractUriParam \"movie\"\n                   response &lt;- liftAndCatchIO $ simpleGetRequest $ searchMovieQuery movie\n                   json (show response)\n</code></pre>\n\n<p>But the format I render is Strings.</p>\n\n<p>Any idea what I\u00b4m doing wrong?</p>\n\n<pre><code>\"\\\"{\\\\\\\"Title\\\\\\\":\\\\\\\"Mad Max\\\\\\\",\\\\\\\"Year\\\\\\\":\\\\\\\"1979\\\\\\\",\\\\\\\"Rated\\\\\\\":\\\\\\\"R\\\\\\\",\\\\\\\"Released\\\\\\\":\\\\\\\"21 Mar 1980\\\\\\\",\\\\\\\"Runtime\\\\\\\":\\\\\\\"88 min\\\\\\\",\\\\\\\"Genre\\\\\\\":\\\\\\\"Action, Adventure, Sci-Fi, Thriller\\\\\\\",\\\\\\\"Director\\\\\\\":\\\\\\\"George Miller\\\\\\\",\\\\\\\"Writer\\\\\\\":\\\\\\\"James McCausland (screenplay), George Miller (screenplay), George Miller (original story), Byron Kennedy (original story)\\\\\\\",\\\\\\\"Actors\\\\\\\":\\\\\\\"Mel Gibson, Joanne Samuel, Hugh Keays-Byrne, Steve Bisley\\\\\\\",\\\\\\\"Plot\\\\\\\":\\\\\\\"In a self-destructing world, a vengeful Australian policeman sets out to stop a violent motorcycle gang.\\\\\\\",\\\\\\\"Language\\\\\\\":\\\\\\\"English\\\\\\\",\\\\\\\"Country\\\\\\\":\\\\\\\"Australia\\\\\\\",\\\\\\\"Awards\\\\\\\":\\\\\\\"4 wins &amp; 7 nominations.\\\\\\\",\\\\\\\"Poster\\\\\\\":\\\\\\\"https://m.media-amazon.com/images/M/MV5BMTM4Mjg5ODEzMV5BMl5BanBnXkFtZTcwMDc3NDk0NA@@._V1_SX300.jpg\\\\\\\",\\\\\\\"Ratings\\\\\\\":[{\\\\\\\"Source\\\\\\\":\\\\\\\"Internet Movie Database\\\\\\\",\\\\\\\"Value\\\\\\\":\\\\\\\"7.0/10\\\\\\\"},{\\\\\\\"Source\\\\\\\":\\\\\\\"Rotten Tomatoes\\\\\\\",\\\\\\\"Value\\\\\\\":\\\\\\\"90%\\\\\\\"},{\\\\\\\"Source\\\\\\\":\\\\\\\"Metacritic\\\\\\\",\\\\\\\"Value\\\\\\\":\\\\\\\"73/100\\\\\\\"}],\\\\\\\"Metascore\\\\\\\":\\\\\\\"73\\\\\\\",\\\\\\\"imdbRating\\\\\\\":\\\\\\\"7.0\\\\\\\",\\\\\\\"imdbVotes\\\\\\\":\\\\\\\"172,382\\\\\\\",\\\\\\\"imdbID\\\\\\\":\\\\\\\"tt0079501\\\\\\\",\\\\\\\"Type\\\\\\\":\\\\\\\"movie\\\\\\\",\\\\\\\"DVD\\\\\\\":\\\\\\\"19 Nov 1997\\\\\\\",\\\\\\\"BoxOffice\\\\\\\":\\\\\\\"N/A\\\\\\\",\\\\\\\"Production\\\\\\\":\\\\\\\"s\\\\\\\",\\\\\\\"Website\\\\\\\":\\\\\\\"N/A\\\\\\\",\\\\\\\"Response\\\\\\\":\\\\\\\"True\\\\\\\"}\\\"\"\n</code></pre>\n\n<p>In case it was unclear here I paste my program</p>\n\n<pre><code>searchMovieQuery :: String -&gt; String\nsearchMovieQuery movie = \"http://www.omdbapi.com/?apikey=\"++ omdbKey ++ \"&amp;t=\" ++ movie\n\nstartServer :: IO ()\nstartServer = do\n              print (\"Starting Omdb server at port: \" ++ show port)\n              scotty port routes\n\nroutes ::  ScottyM()\nroutes = do get \"/movie/:movie\" responseMovie\n\nresponseMovie :: ActionM ()\nresponseMovie = do movie &lt;- extractUriParam \"movie\"\n                   liftAndCatchIO $ print (\"Finding movie\" ++ movie)\n                   bsResponse &lt;- liftAndCatchIO $ simpleGetRequest $ searchMovieQuery movie\n                   liftAndCatchIO $ print (\"Response:\" ++ (show bsResponse))\n                   txtResponse &lt;- liftAndCatchIO $ transform bsResponse\n                   json txtResponse\n\nextractUriParam :: LazyText.Text -&gt; ActionM String\nextractUriParam param = Web.Scotty.param param\n\n\ntransform :: Inter.ByteString -&gt; IO LazyText.Text\ntransform bs = do txtResponse &lt;- case (decode bs) of\n                                      Just value -&gt; return value\n                                      Nothing -&gt; return (LazyText.pack $ \"Nothing to share:\" ++ (show bs))\n                  return txtResponse\n\n\nsimpleGetRequest :: String -&gt; IO ByteString\nsimpleGetRequest uri = do\n                    manager &lt;- newManager defaultManagerSettings\n                    request &lt;- parseRequest uri\n                    response &lt;- makeRequest manager request\n                    return $ responseBody response\n\nmakeRequest :: Manager -&gt; Request -&gt; IO (Response ByteString)\nmakeRequest manager request =  httpLbs request manager\n</code></pre>\n\n<p>I use decode as you mention once that I transform ByteString to Text.\nBut now in the decode B<code>yteString -&gt; Text</code>, in the <code>Maybe</code> is going always in the <code>Nothing</code>, even having data.</p>\n"}, {"tags": ["haskell", "higher-order-functions"], "comments": [{"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1543738578, "post_id": 53573671, "comment_id": 94020671, "body": "You just looking for the <b>inverse function</b> of <code>function</code>. but it is impossible, since <code>function 4 = function 6 = 9</code>, not one to one or injective function."}], "answers": [{"comments": [{"owner": {"reputation": 996, "user_id": 7907300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e028848530c7b0b75a1142879de5a48?s=128&d=identicon&r=PG&f=1", "display_name": "cheshire", "link": "https://stackoverflow.com/users/7907300/cheshire"}, "edited": false, "score": 0, "creation_date": 1543695857, "post_id": 53573833, "comment_id": 94013644, "body": "Thanks for the answer, I edited the question to explain better what I actually mean"}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 996, "user_id": 7907300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e028848530c7b0b75a1142879de5a48?s=128&d=identicon&r=PG&f=1", "display_name": "cheshire", "link": "https://stackoverflow.com/users/7907300/cheshire"}, "edited": false, "score": 1, "creation_date": 1543697631, "post_id": 53573833, "comment_id": 94014129, "body": "I understood what you want, but in your edit <code>function_to_list</code> assumes the the list of points <code>[0..6]</code>. Of course that works for that specific <code>function</code> but not for others. Also to revert and obtain the original <code>function</code> you need to assume you know that all other points  return <code>0</code>. It&#39;d be <code>list_to_function xs = \\n -&gt; if (n &gt;=0) &amp;&amp; (n&lt;=6) then xs!!n else  0</code>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1543703328, "post_id": 53573833, "comment_id": 94015524, "body": "Note that <code>snd x : graph_to_list xs</code> is preferable to <code>[snd x] ++ graph_to_list x</code>, as it doesn&#39;t create an unnecessary singleton list before merging it into the recursive result."}], "tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": false, "score": 3, "last_activity_date": 1543691575, "last_edit_date": 1592644375, "creation_date": 1543689019, "answer_id": 53573833, "question_id": 53573671, "link": "https://stackoverflow.com/questions/53573671/passing-a-function-as-a-parameter-and-returning-a-function-haskell/53573833#53573833", "title": "Passing a function as a parameter and returning a function - Haskell", "body": "<blockquote>\n<pre><code>list_to_graph' :: [Int] -&gt; List -&gt; Graph\nlist_to_graph' (x:xs) (y:ys) = [(x, y)] ++ list_to_graph' (xs) (ys)\nlist_to_graph' [] [] = []\n</code></pre>\n</blockquote>\n<p>This function exists and is called <code>zip</code>.</p>\n<p><em>Note: zip also works for lists of different length, ignoring the the extra bit of the longer list, whereas yours fails if both are not of the same length</em></p>\n<blockquote>\n<pre><code>graph_to_list :: Graph -&gt; List\ngraph_to_list (x:xs) = [snd (x)] ++ graph_to_list(xs)\ngraph_to_list []= []\n</code></pre>\n</blockquote>\n<p>You could write this function as,</p>\n<blockquote>\n<pre><code>graph_to_list = map snd\n</code></pre>\n</blockquote>\n<p>or</p>\n<blockquote>\n<pre><code>graph_to_list xs = [snd x | x &lt;- xs]\n</code></pre>\n</blockquote>\n<p>or</p>\n<blockquote>\n<pre><code>graph_to_list xs = [a | (a,b) &lt;- xs]\n</code></pre>\n</blockquote>\n<p>Regarding this,</p>\n<blockquote>\n<p>What I dont understand is how to write something like this:</p>\n<pre><code>type Function = (Nat0 -&gt; Z) \n\nfunction_to_list :: Function -&gt; List\n</code></pre>\n</blockquote>\n<p>If I understand you correctly you would like to be able to build the &quot;image of <code>f</code>&quot;, that is a list all values <code>f x</code> for all <code>x</code> in the domain of <code>f</code>. Something that in theory could look like,</p>\n<blockquote>\n<pre><code>[f(x) | x &lt;- DOMAIN f]\n</code></pre>\n</blockquote>\n<p>However in general there is no way to know the domain of a given function (much less a way to traverse it). Same goes for the translation of a function into a graph. To implement such &quot;transformations&quot; you have to provide as argument both your function <code>f :: A -&gt; B</code> and a list <code>xs :: A</code> with the points of its domain which you want to consider.</p>\n"}, {"comments": [{"owner": {"reputation": 996, "user_id": 7907300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e028848530c7b0b75a1142879de5a48?s=128&d=identicon&r=PG&f=1", "display_name": "cheshire", "link": "https://stackoverflow.com/users/7907300/cheshire"}, "edited": false, "score": 0, "creation_date": 1543895680, "post_id": 53575417, "comment_id": 94073067, "body": "Thank you that is clear to me now. The thing that is not clear to me is how to write function_to_list or function_to_graph as answer above mentioned that we cant do it without adding the argument."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 996, "user_id": 7907300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e028848530c7b0b75a1142879de5a48?s=128&d=identicon&r=PG&f=1", "display_name": "cheshire", "link": "https://stackoverflow.com/users/7907300/cheshire"}, "edited": false, "score": 0, "creation_date": 1543896693, "post_id": 53575417, "comment_id": 94073293, "body": "@cheshire, does <code>function_to_list f = map f [0..]</code> do what you want?"}, {"owner": {"reputation": 996, "user_id": 7907300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e028848530c7b0b75a1142879de5a48?s=128&d=identicon&r=PG&f=1", "display_name": "cheshire", "link": "https://stackoverflow.com/users/7907300/cheshire"}, "edited": false, "score": 0, "creation_date": 1548246377, "post_id": 53575417, "comment_id": 95472546, "body": "a little bit late, but that with <code>[0..]</code> actually worked! Thanks"}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 2, "last_activity_date": 1543701584, "creation_date": 1543701584, "answer_id": 53575417, "question_id": 53573671, "link": "https://stackoverflow.com/questions/53573671/passing-a-function-as-a-parameter-and-returning-a-function-haskell/53575417#53575417", "title": "Passing a function as a parameter and returning a function - Haskell", "body": "<p>So you are trying to get </p>\n\n<pre><code>list_to_function :: List -&gt; Function\n</code></pre>\n\n<p>correct?  Let's do <code>Graph</code> instead, it will get closer to the essence. Let's start writing it.</p>\n\n<pre><code>graph_to_function gph = _ -- something of type Function\n</code></pre>\n\n<p>So we want to construct something of type <code>Function</code>, that is, <code>Nat0 -&gt; Z</code>. The most boring way to do that is with a lambda:</p>\n\n<pre><code>graph_to_function gph = \\n -&gt; _ -- something of type Z\n</code></pre>\n\n<p>Great, now we have a <code>Graph</code> called <code>gph</code> and a <code>Nat0</code> called <code>n</code>, and we want to make a <code>Z</code>.  Here we can just search the list for <code>n</code>.  There are a few ways to do this, here's one:</p>\n\n<pre><code>graph_to_function gph = \\n -&gt; head ([ y | (x,y) &lt;- gph, x == n ] ++ [0])\n</code></pre>\n\n<p>I put <code>++ [0]</code> on the end just in case the list comprehension ends up empty, that is, we didn't find <code>n</code> in the domain of the graph.  Done!</p>\n\n<p>Fun fact, functions in Haskell are curried by default, so</p>\n\n<pre><code>f x y z = ...\nf = \\x -&gt; \\y -&gt; \\z -&gt; ...\n</code></pre>\n\n<p>are equivalent.  That is, <code>graph_to_function</code> is really just the same thing as a two-argument function. So we can move the <code>n</code> over to the left side of the definition:</p>\n\n<pre><code>graph_to_function :: Graph -&gt; Function\ngraph_to_function gph n = head ([ y | (x,y) &lt;- gph, x == n ] ++ [0])\n</code></pre>\n\n<p>It's looks a bit weird to have only one argument in the signature are two arguments in the equation, but it is something that you see in the wild, once you get used to it.</p>\n\n<p>Hope this helps!</p>\n"}], "owner": {"reputation": 996, "user_id": 7907300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e028848530c7b0b75a1142879de5a48?s=128&d=identicon&r=PG&f=1", "display_name": "cheshire", "link": "https://stackoverflow.com/users/7907300/cheshire"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4305, "favorite_count": 0, "accepted_answer_id": 53575417, "answer_count": 2, "score": 8, "last_activity_date": 1543701584, "creation_date": 1543687922, "last_edit_date": 1543695787, "question_id": 53573671, "link": "https://stackoverflow.com/questions/53573671/passing-a-function-as-a-parameter-and-returning-a-function-haskell", "title": "Passing a function as a parameter and returning a function - Haskell", "body": "<p>I have a graph of Function <code>f(n)</code> where it returns </p>\n\n<pre><code>5  if n = 0 \n2  if n = 1 \n-4 if n = 2 \n1  if n = 3 \n9  if n = 4 \n8  if n = 5 \n9  if n = 6 \n0  otherwise \n</code></pre>\n\n<p>and I wanted to write a function that will represent a graph with one List with pairs:</p>\n\n<pre><code>type Nat0 = Int \ntype Z = Int\ntype List = [Z] \ntype Graph = [(Nat0,Z)] \n\nlist_to_graph :: List -&gt; Graph\nlist_to_graph x = list_to_graph' ([0..(length x)-1 ]) (x)\n\nlist_to_graph' :: [Int] -&gt; List -&gt; Graph\nlist_to_graph' (x:xs) (y:ys) = [(x, y)] ++ list_to_graph' (xs) (ys)\nlist_to_graph' [] [] = []\n</code></pre>\n\n<p>And thats what I did here. Passing a list <code>[5,2,-4,1,9,8,9]</code> returns </p>\n\n<pre><code>*Main&gt; list_to_graph [5,2,-4,1,9,8,9]\n[(0,5),(1,2),(2,-4),(3,1),(4,9),(5,8),(6,9)]\n</code></pre>\n\n<p>and here is the function that does oposite:</p>\n\n<pre><code>graph_to_list :: Graph -&gt; List\ngraph_to_list (x:xs) = [snd (x)] ++ graph_to_list(xs)\ngraph_to_list []= [] \n</code></pre>\n\n<p>where passing the graph <code>[(0,5),(1,2),(2,-4),(3,1),(4,9),(5,8),(6,9)]</code></p>\n\n<pre><code>*Main&gt; graph_to_list [(0,5),(1,2),(2,-4),(3,1),(4,9),(5,8),(6,9)]\n[5,2,-4,1,9,8,9]\n</code></pre>\n\n<p><strong>Question:</strong></p>\n\n<p>What I dont understand is how to write something like this: </p>\n\n<pre><code>type Function = (Nat0 -&gt; Z) \n\nfunction_to_list :: Function -&gt; List\n</code></pre>\n\n<p>or </p>\n\n<pre><code>list_to_function :: List -&gt; Function\n</code></pre>\n\n<p>or the same for graph </p>\n\n<pre><code>function_to_graph :: Function -&gt; Graph\ngraph_to_function :: Graph -&gt; Function\n</code></pre>\n\n<p>I have read <a href=\"http://learnyouahaskell.com/higher-order-functions\" rel=\"nofollow noreferrer\">Higher order functions</a> on this link but I cant seem to grasp how this actually works.</p>\n\n<p>I suppose in <code>function_to_list</code> I would have to pass a function that has  this notation <code>(Nat0 -&gt; Z)</code>(which is actually <code>Int -&gt; Int</code> ) and it should return a <code>List</code> with <code>[Z]</code> (which is <code>[Int]</code> ). But how do I do that? That is like passing same function to itself? </p>\n\n<p>Even more confusing is the <code>list_to_function</code> what should here be the result?</p>\n\n<p>If somebody can explain me higher order Functions on some of my examples I would really be thankful!</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>To be more clear here is what I want to achieve: </p>\n\n<pre><code>(list_to_graph . graph_to_list) = \u03bb x. x\n(graph_to_list . list_to_graph) = \u03bb x. x\n</code></pre>\n\n<p>As I showed above if I pass a list to <code>list_to_graph</code> it return a graph and <code>graph_to_list</code> does oposite</p>\n\n<pre><code>(list_to_function . function_to_list) = \u03bb x. x\n(function_to_list . list_to_function) = \u03bb x. x\n</code></pre>\n\n<p>its the same that I want to do with the other two functions. If I apply <code>function_to_list</code> to <code>list_to_function</code> as <code>function_to_list</code> returns a <code>List</code> and <code>list_to_function</code> accepts a <code>List</code> it should return a function that will take a elements out of the list and apply it to <code>Function</code> which will return a <code>Z</code>. </p>\n\n<p>What I figured out by now: </p>\n\n<pre><code>function_to_list :: Function-&gt; List\nfunction_to_list f = [f(x) | x &lt;- [0..6]]\n\nfunction :: Function\nfunction n\n         | n == 0 = 5\n         | n == 1 = 2 \n         | n == 2 = (-4)\n         | n == 3 = 1\n         | n == 4 = 9\n         | n == 5 = 8\n         | n == 6 = 9\n         | otherwise = 0\n</code></pre>\n\n<p>As the answer bellow suggested.</p>\n\n<pre><code>*Main&gt; function_to_list function \n[5,2,-4,1,9,8,9]\n</code></pre>\n\n<p>What I want to do is to make this <code>function :: Function</code> in my <code>list_to_function</code></p>\n"}, {"tags": ["performance", "haskell", "text"], "answers": [{"comments": [{"owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "edited": false, "score": 2, "creation_date": 1608287168, "post_id": 53575250, "comment_id": 115542739, "body": "I confirm everything said :) The benchmarks that the source code of &quot;text-builder&quot; package comes with show that it is faster at least in the covered cases. There also are success story user reports, e.g., <a href=\"https://twitter.com/thumphriees/status/924882781406035968\" rel=\"nofollow noreferrer\">this one</a>."}], "tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": true, "score": 3, "last_activity_date": 1543699902, "creation_date": 1543699902, "answer_id": 53575250, "question_id": 53573086, "link": "https://stackoverflow.com/questions/53573086/data-text-lazy-builder-vs-text-builder/53575250#53575250", "title": "Data.Text.Lazy.Builder vs Text.Builder", "body": "<p>I have not used <code>text-builder</code> but it purports to be an \"An efficient <em>strict text</em> builder\" (emphasis mine), while the standard <code>Data.Text.Lazy.Builder</code> builds lazy <code>Text</code> (essentially a linked list of UTF-16 array chunks). The point of both libraries (the idea of a <code>Builder</code>), is to avoid a bunch of allocation and copying as you accumulate a string by appending.</p>\n\n<p>It looks to me like the <code>text-builder</code> library mostly restricts itself to types with a statically known size. I suppose its reason for existing is this could be made more efficient than the normal builder in <code>text</code>; in <code>run</code> you can allocate just once and then serialize into the array, where in <code>Data.Text.Lazy.Builder</code> you might need to grow or allocate new chunks as you go. And if what you really need is a strict <code>Text</code> then you'll probably need to pay for copying all those chunks anyway (and that might also involve additional copying of intermediate strict <code>Text</code> too, I'm not sure).</p>\n\n<p>But this is mostly speculation. Maybe Nikita Volkov will chime in.</p>\n"}], "owner": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 53575250, "answer_count": 1, "score": 2, "last_activity_date": 1543711089, "creation_date": 1543683583, "last_edit_date": 1543711089, "question_id": 53573086, "link": "https://stackoverflow.com/questions/53573086/data-text-lazy-builder-vs-text-builder", "title": "Data.Text.Lazy.Builder vs Text.Builder", "body": "<p>What is a difference between module <code>Data.Text.Lazy.Builder</code> (<a href=\"http://hackage.haskell.org/package/text-1.2.3.1/docs/Data-Text-Lazy-Builder.html\" rel=\"nofollow noreferrer\">text package</a>) and module <code>Text.Builder</code> (<a href=\"http://hackage.haskell.org/package/text-builder-0.6.4/docs/Text-Builder.html\" rel=\"nofollow noreferrer\">text-builder</a>)? I mean the goals, efficiency and possibilities? </p>\n"}, {"tags": ["haskell", "xmonad"], "answers": [{"tags": [], "owner": {"reputation": 2934, "user_id": 367316, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f09837eb8a4cfaac44c1e08b43f72091?s=128&d=identicon&r=PG", "display_name": "Konrad Eisele", "link": "https://stackoverflow.com/users/367316/konrad-eisele"}, "is_accepted": true, "score": 4, "last_activity_date": 1543680328, "creation_date": 1543680328, "answer_id": 53572621, "question_id": 53572465, "link": "https://stackoverflow.com/questions/53572465/xmonad-how-can-i-again-re-insert-a-window-back-into-the-tiling-layout-after-hav/53572621#53572621", "title": "XMonad: How can I again re-insert a window back into the tiling layout after having it made floating?", "body": "<p>The standard config already had this binding:</p>\n\n<pre><code>((modMask, xK_t), withFocused $ windows . W.sink) \n</code></pre>\n"}], "owner": {"reputation": 2934, "user_id": 367316, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f09837eb8a4cfaac44c1e08b43f72091?s=128&d=identicon&r=PG", "display_name": "Konrad Eisele", "link": "https://stackoverflow.com/users/367316/konrad-eisele"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 349, "favorite_count": 0, "accepted_answer_id": 53572621, "answer_count": 1, "score": 0, "last_activity_date": 1543680328, "creation_date": 1543679292, "question_id": 53572465, "link": "https://stackoverflow.com/questions/53572465/xmonad-how-can-i-again-re-insert-a-window-back-into-the-tiling-layout-after-hav", "title": "XMonad: How can I again re-insert a window back into the tiling layout after having it made floating?", "body": "<p>I use the below binding to make a window floating and draggable: </p>\n\n<pre><code>myMouseBindings (XConfig {XMonad.modMask = modMask}) = M.fromList $\n  [\n    -- mod-button1, Set the window to floating mode and move by dragging\n    ((modMask, button1),\n     (\\w -&gt; focus w &gt;&gt; mouseMoveWindow w))\n\n    -- mod-button2, Raise the window to the top of the stack\n    , ((modMask, button2),\n       (\\w -&gt; focus w &gt;&gt; windows W.swapMaster))\n\n    -- mod-button3, Set the window to floating mode and resize by dragging\n    , ((modMask, button3),\n       (\\w -&gt; focus w &gt;&gt; mouseResizeWindow w))\n\n    -- you may also bind events to the mouse scroll wheel (button4 and button5)\n  ]\n</code></pre>\n\n<p>This is very useful, however sometimes I want to <strong><em>reinsert the window back into the tiling layout</em></strong>. Is there a mechanism in XMonad to do this? Some function <em>funcThatInsertWindowBack</em>:</p>\n\n<pre><code>((modMask .|. shiftMask, button1),\n     (\\w -&gt; focus w &gt;&gt; funcThatInsertWindowBack w))\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 2, "creation_date": 1543675360, "post_id": 53571841, "comment_id": 94008155, "body": "Both cases are perfectly well suited for the <code>Maybe</code> type. The empty list could also mean that the solution <i>is</i> the empty list."}, {"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 2, "creation_date": 1543675424, "post_id": 53571841, "comment_id": 94008172, "body": "It does not sound like a bad idea to me, though for the first case in Haskell they also use the type <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Either.html\" rel=\"nofollow noreferrer\"><code>Either</code></a> for values that may contain errors. It is a monad, as well. For the second case, I&#39;d personally prefer the empty list (not found -&gt; <code>[]</code>)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 5, "creation_date": 1543675513, "post_id": 53571841, "comment_id": 94008191, "body": "I would <code>solve :: X -&gt; [X]</code> and return <i>all</i> solutions. Then an empty list serves well as the &quot;found no solutions&quot; marker; if your consumer only needs one solution, it can only look at one (and only pay the price of finding one)."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1543676358, "post_id": 53571841, "comment_id": 94008416, "body": "And since <code>[]</code> is <i>also</i> a monad, you can chain several solution steps together, if the solution to one problem is the input for the next (as when evaluating a game board, for instance). <code>solve initialBoard &gt;&gt;= solve &gt;&gt;= solve &gt;&gt;= solve ...</code>, which build up longer and longer lists of boards reachable from the original board."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1543679470, "post_id": 53571841, "comment_id": 94009305, "body": "The suggestion by @DanielWagner is a good one. In the special case where there can be only zero or one solutions, then <code>solve :: X -&gt; Maybe X</code> would be better."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1543681327, "post_id": 53571841, "comment_id": 94009867, "body": "@MarkSeemann I think I object to the edit changing <code>[[Char]]</code> to <code>[String]</code>. At least if <i>I</i> wrote <code>[[Char]]</code> in my code, I would be communicating (or attempting to communicate) something different to the reader than if I wrote <code>[String]</code>. Since we can&#39;t see into Yuon&#39;s mind, it seems premature to change the communication in that way without checking in first."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1543681883, "post_id": 53571841, "comment_id": 94010017, "body": "@DanielWagner I&#39;m curious; I can understand <code>[[a]]</code>, but when would you ever use <code>[[Char]]</code>? Doesn&#39;t <i>hlint</i> suggest changing <code>[Char]</code> to <code>String</code>?"}, {"owner": {"reputation": 13, "user_id": 10731897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84556562031b15ad18ab0aebaaa1d612?s=128&d=identicon&r=PG&f=1", "display_name": "Yuon", "link": "https://stackoverflow.com/users/10731897/yuon"}, "edited": false, "score": 0, "creation_date": 1543682434, "post_id": 53571841, "comment_id": 94010135, "body": "This is just a constraint given by the assignment I am working on. We are being given a maze from a file, and we have to find the shortest path. &quot;Mazes are initially encoded as a list of lists of characters (\u2013 i.e.[[Char]]) in which every character denotes a cell.&quot; I just chose to keep the same type throughout the project, and conceptually it makes more sense that we are dealing with single characters that have specific meanings instead of considering a whole row as a String."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1543684844, "post_id": 53571841, "comment_id": 94010820, "body": "@Yuon Should I roll back my edits?"}, {"owner": {"reputation": 13, "user_id": 10731897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84556562031b15ad18ab0aebaaa1d612?s=128&d=identicon&r=PG&f=1", "display_name": "Yuon", "link": "https://stackoverflow.com/users/10731897/yuon"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1543685380, "post_id": 53571841, "comment_id": 94010963, "body": "@MarkSeemann I don&#39;t mind either way, I don&#39;t think it changes the question that I asked. We could just change it to [a]."}, {"owner": {"reputation": 13, "user_id": 10731897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84556562031b15ad18ab0aebaaa1d612?s=128&d=identicon&r=PG&f=1", "display_name": "Yuon", "link": "https://stackoverflow.com/users/10731897/yuon"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1543685979, "post_id": 53571841, "comment_id": 94011125, "body": "@DanielWagner in the context of the project we want to find the shortest path, which doesn&#39;t guarantee a single solution since multiple paths can have the same length. If I were to use a function  <code>solve X -&gt;[X]</code>, i.e generating all the paths,is there a way to guarantee that <code>take 1 $ solve maze</code> would return the shortest path ?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1543688041, "post_id": 53571841, "comment_id": 94011688, "body": "@Yuon Of course. With your proposed type, you return at most one solution, so you must have an idea about how to choose that solution; whatever tricks you would use to choose that solution can be used to choose the order of results in the list if you return many solutions instead."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 10731897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84556562031b15ad18ab0aebaaa1d612?s=128&d=identicon&r=PG&f=1", "display_name": "Yuon", "link": "https://stackoverflow.com/users/10731897/yuon"}, "edited": false, "score": 0, "creation_date": 1543685618, "post_id": 53572466, "comment_id": 94011033, "body": "When you say a function invocation can fail, are we talking about run time failure or conceptual failure, as in, unable to find the value due to the lack of a key ?  Should I use Maybe strictly as a &quot;catch exception&quot; mechanism ? Could you also provide a simple example of when you would prefer to return a Maybe [] instead of simply [] ?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 13, "user_id": 10731897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84556562031b15ad18ab0aebaaa1d612?s=128&d=identicon&r=PG&f=1", "display_name": "Yuon", "link": "https://stackoverflow.com/users/10731897/yuon"}, "edited": false, "score": 0, "creation_date": 1543699356, "post_id": 53572466, "comment_id": 94014574, "body": "@Yuon I can&#39;t think of an example where I would return <code>Maybe [a]</code>. Usually, <code>[]</code> carries the same meaning as <code>Nothing</code>."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 2, "creation_date": 1543721651, "post_id": 53572466, "comment_id": 94018329, "body": "@MarkSeemann Say I have a database storing my customers and orders. I may have a function <code>ordersFor ::  SomeMonad m =&gt; m (Maybe [Order])</code>, where <code>Nothing</code> means &quot;What customer? I&#39;ve never heard of this person!&quot;, but <code>Just []</code> means &quot;I found the customer, but no associated orders&quot;. This is nice, because e.g. I can say <code>fmap (sum . fmap orderProfit) &lt;$&gt; ordersFor someone :: SomeMonad m =&gt; m (Maybe Profit)</code>. The <code>SomeMonad</code> layer handles database errors. The <code>Maybe</code> tracks whether the the customer was found. It would be very weird to use just <code>[]</code> and get <code>0</code> when the answer is &quot;Not found&quot;."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 13, "user_id": 10731897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84556562031b15ad18ab0aebaaa1d612?s=128&d=identicon&r=PG&f=1", "display_name": "Yuon", "link": "https://stackoverflow.com/users/10731897/yuon"}, "edited": false, "score": 0, "creation_date": 1543732060, "post_id": 53572466, "comment_id": 94019671, "body": "@Yuon Use <code>Maybe [a]</code> when you expect exactly 0 or 1 list; use <code>[[a]]</code> if you expect 0 or more lists."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 1, "last_activity_date": 1543679306, "creation_date": 1543679306, "answer_id": 53572466, "question_id": 53571841, "link": "https://stackoverflow.com/questions/53571841/maybe-monad-usage/53572466#53572466", "title": "Maybe Monad usage", "body": "<p>One of the reasons I like Haskell is that the type system is so expressive. When functions are well-designed, the type of a function takes the place of much (although not all!) documentation.</p>\n\n<p>Often, <code>Maybe</code> is used to indicate that a function invocation can fail. A typical example is <code>lookup</code>:</p>\n\n<pre><code>Prelude&gt; :t lookup\nlookup :: Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b\n</code></pre>\n\n<p>Here, you're trying to find a value in an association list, and it's fairly obvious that the operation could fail if the key isn't in the list. In this case, there's only one thing that can go wrong, so you don't need any other information than the presence or lack of a return value.</p>\n\n<p>Sometimes, however, an operation can fail in more than one way, and you want to give callers a chance to distinguish between various different causes. In that case, <code>Either</code> is a better option, since you can let the <em>left</em> case carry information about the type of error.</p>\n\n<p>Finally, when returning lists, you can sometimes use the empty list to indicate that no other result could be found.</p>\n\n<p>Wrapping a list in a <code>Maybe</code>, then, is only useful if the empty list <code>[]</code> is fundamentally different than <code>Nothing</code>. If I see a function that returns <code>Maybe []</code>, I know that I, as a caller, will have to deal both with <code>Nothing</code>, but also with any list value, including the empty list.</p>\n\n<p>Just by looking at the type signatures in the OP, it's not clear to me how <code>Nothing</code> is different from <code>[]</code>, but this could just be my lack of in-depth knowledge of the particular domain being modelled. It <em>does</em>, however, seem a bit odd.</p>\n"}], "owner": {"reputation": 13, "user_id": 10731897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84556562031b15ad18ab0aebaaa1d612?s=128&d=identicon&r=PG&f=1", "display_name": "Yuon", "link": "https://stackoverflow.com/users/10731897/yuon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 0, "accepted_answer_id": 53572466, "answer_count": 1, "score": 1, "last_activity_date": 1543679336, "creation_date": 1543675063, "last_edit_date": 1543679336, "question_id": 53571841, "link": "https://stackoverflow.com/questions/53571841/maybe-monad-usage", "title": "Maybe Monad usage", "body": "<p>Is it good practice to use the Maybe monad only when a function can result in an error in order to preserve type safety ?</p>\n\n<p>In my current project I am doing operations on lists, for my get/set functions I have used the Maybe monad in order to prevent out of bound errors :</p>\n\n<pre><code>getCell :: [String] -&gt; Int -&gt; Int -&gt; Maybe [String]\nsetCell :: [String] -&gt; Int -&gt; Int -&gt; Maybe [String]\n</code></pre>\n\n<p>This to me, feels like the correct way to use this Monad.</p>\n\n<p>Without going into details about the project, I have another function that manipulates the lists and returns a list if there is a solution.\nThe question is, should this function always return a <code>[String]</code> since there is nothing that can create a computation error, or should I use <code>Maybe [String]</code> to signify that the computation has found no solutions ?</p>\n\n<pre><code>solve :: [String] -&gt; [String]\n-- Found -&gt; [String], Not found -&gt; []\nsolve :: [String] -&gt; Maybe [String]\n-- Found -&gt; Just [String], Not found -&gt; Nothing\n</code></pre>\n"}, {"tags": ["debugging", "haskell", "io", "lazy-evaluation", "trace"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 1, "last_activity_date": 1543679253, "creation_date": 1543679253, "answer_id": 53572456, "question_id": 53571168, "link": "https://stackoverflow.com/questions/53571168/how-can-i-force-debug-trace-statements-to-evaluate-in-order/53572456#53572456", "title": "How can I force debug trace statements to evaluate in order?", "body": "<p><code>Debug.Trace</code> functions print to <code>stderr</code> so interleaving is to be expected.</p>\n\n<p>At the very least, you could put <code>x</code> and the string before it together to distinguish it from other <code>print</code> output.</p>\n\n<pre><code>ff :: Int -&gt; Int\nff x = trace (\"x is: \" ++ show x) x\n</code></pre>\n\n<p>You can also use <code>unsafePerformIO</code> to redefine trace functions that print to <code>stdout</code> to enforce some ordering.</p>\n"}, {"comments": [{"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1543751457, "post_id": 53573302, "comment_id": 94023354, "body": "Thanks for the suggestion - does not seem to work though."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 1, "last_activity_date": 1543685250, "creation_date": 1543685250, "answer_id": 53573302, "question_id": 53571168, "link": "https://stackoverflow.com/questions/53571168/how-can-i-force-debug-trace-statements-to-evaluate-in-order/53573302#53573302", "title": "How can I force debug trace statements to evaluate in order?", "body": "<p>It sounds like you're dealing with buffering issues. You can use <code>hFlush</code> or just set the buffering:</p>\n\n<pre><code>hSetBuffering stderr NoBuffering\nhSetBuffering stdout NoBuffering\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": false, "score": 1, "last_activity_date": 1543752291, "creation_date": 1543752291, "answer_id": 53580045, "question_id": 53571168, "link": "https://stackoverflow.com/questions/53571168/how-can-i-force-debug-trace-statements-to-evaluate-in-order/53580045#53580045", "title": "How can I force debug trace statements to evaluate in order?", "body": "<pre><code>myTrace :: Show a =&gt; a -&gt; a\nmyTrace x = unsafePerformIO $ do\n  print x\n  pure x\n</code></pre>\n\n<p>The above seems to work well. Thanks to <a href=\"https://stackoverflow.com/users/6863749/li-yao-xia\">https://stackoverflow.com/users/6863749/li-yao-xia</a></p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 187, "favorite_count": 0, "accepted_answer_id": 53572456, "answer_count": 3, "score": 1, "last_activity_date": 1543754027, "creation_date": 1543670310, "last_edit_date": 1543754027, "question_id": 53571168, "link": "https://stackoverflow.com/questions/53571168/how-can-i-force-debug-trace-statements-to-evaluate-in-order", "title": "How can I force debug trace statements to evaluate in order?", "body": "<pre><code>import Debug.Trace\n\nmain  :: IO ()\nmain = do\n  let b = (fff 2 10)\n  print b\n  let c = (fff 3 10)\n  print c\n  print \"---\"\n\n\nff :: (-&gt;) Int Int\nff = do\n  x &lt;- traceShow \"x is: \" . traceShowId\n  pure $ (x)\n\nfff :: Int -&gt; Int -&gt; Int\nfff = do\n  (-) . ff\n</code></pre>\n\n<p>The trace functions seem to be lazily evaluated or something which means the output can vary from:</p>\n\n<pre><code>\"x is: \"\n2\n-8\n\"x is: \"\n-7\n3\n\"---\"\n</code></pre>\n\n<p>And in another run:</p>\n\n<pre><code>\"x is: \"\n2\n\"x is: \"\n3\n-8\n-7\n\"---\"\n</code></pre>\n\n<p>I've tried the suggestions from here: <a href=\"https://stackoverflow.com/questions/48977455/how-do-i-force-evaluation-of-an-io-action-within-unsafeperformio\">How do I force evaluation of an IO action within `unsafePerformIO`?</a> (BangPatterns Pragma + <code>$!</code>) as well as adding the <code>Strict</code> and <code>StrictData</code> pragmas, however I still get the inconsistent behavior. </p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\n{-# LANGUAGE Strict #-}\n{-# LANGUAGE StrictData #-}\n\nimport Debug.Trace\n\nmain  :: IO ()\nmain = do\n  let !b = (fff 2 10)\n  print b\n  let !c = (fff 3 10)\n  print c\n  print \"---\"\n\nff :: (-&gt;) Int Int\nff = do\n  x &lt;- id $! (traceShow \"x is: \" . traceShowId)\n  pure $ (x)\n\nfff :: Int -&gt; Int -&gt; Int\nfff = do\n  (-) . ff\n</code></pre>\n\n<hr>\n\n<p>I've also tried using <code>unsafePerformIo</code> but this has similar behavior:</p>\n\n<pre><code>hmm :: a -&gt; a\nhmm x = unsafePerformIO $! do\n  pure x\n\nff :: Int -&gt; Int\nff z = do\n  hmm (trace \"x is: \" . traceShowId) $ z \n</code></pre>\n\n<hr>\n\n<p>Is there a solution without having to have knowledge about strictness / Haskell's evaluation?</p>\n"}, {"tags": ["haskell", "megaparsec"], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 1, "last_activity_date": 1543670922, "last_edit_date": 1543670922, "creation_date": 1543667326, "answer_id": 53570772, "question_id": 53570636, "link": "https://stackoverflow.com/questions/53570636/using-parsetest-in-megaparsec-7-0-4/53570772#53570772", "title": "Using parseTest in megaparsec 7.0.4", "body": "<p>The latest versions of \"megaparsec\" support <a href=\"http://hackage.haskell.org/package/megaparsec-7.0.4/docs/Text-Megaparsec.html#v:fancyFailure\" rel=\"nofollow noreferrer\">custom error types</a> defined by the user. The <a href=\"http://hackage.haskell.org/package/megaparsec-7.0.4/docs/Text-Megaparsec.html#t:ParsecT\" rel=\"nofollow noreferrer\"><code>ParsecT</code></a> type is parameterized by the type of the custom errors. To support pretty-printing (like in <a href=\"http://hackage.haskell.org/package/megaparsec-7.0.4/docs/Text-Megaparsec.html#v:parseTest\" rel=\"nofollow noreferrer\"><code>parseTest</code></a>) such custom errors must be instances of the <code>Ord</code> and <a href=\"http://hackage.haskell.org/package/megaparsec-7.0.4/docs/Text-Megaparsec-Error.html#t:ShowErrorComponent\" rel=\"nofollow noreferrer\"><code>ShowErrorComponent</code></a> typeclasses.</p>\n\n<p>If we never throw any custom errors, the error type remains polymorphic. But at the end, when printing the results, we must provide a concrete type. We can use the uninhabited type <code>Void</code> from the \"void\" package, and inform the type checker by using an explicit type signature.</p>\n\n<p>The documentation <a href=\"http://hackage.haskell.org/package/megaparsec-7.0.4/docs/Text-Megaparsec.html\" rel=\"nofollow noreferrer\">recommends</a> defining a type synonym like <code>type Parser = Parsec Void Text</code> and using it in your signatures.</p>\n\n<p>Another way of avoiding the ambiguity is by using <a href=\"https://kseo.github.io/posts/2017-01-08-visible-type-application-ghc8.html\" rel=\"nofollow noreferrer\">visible type application</a>:</p>\n\n<pre><code>Prelude Text.Megaparsec Data.Void&gt; :t parseTest\nparseTest\n  :: (ShowErrorComponent e, Show a, Stream s) =&gt;\n     Parsec e s a -&gt; s -&gt; IO ()\nPrelude Text.Megaparsec Data.Void&gt; :set -XTypeApplications\nPrelude Text.Megaparsec Data.Void&gt; :t parseTest @Void\nparseTest @Void\n  :: (Show a, Stream s) =&gt; Parsec Void s a -&gt; s -&gt; IO ()\n</code></pre>\n"}], "owner": {"reputation": 2244, "user_id": 29408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f7af9c8034d5070fb2e8565c79c604b7?s=128&d=identicon&r=PG", "display_name": "Julian Birch", "link": "https://stackoverflow.com/users/29408/julian-birch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "accepted_answer_id": 53570772, "answer_count": 1, "score": 0, "last_activity_date": 1543670922, "creation_date": 1543666372, "question_id": 53570636, "link": "https://stackoverflow.com/questions/53570636/using-parsetest-in-megaparsec-7-0-4", "title": "Using parseTest in megaparsec 7.0.4", "body": "<p>Advent of Code means I'm using megaparsec for the first time in a while. And things have changed around a fair bit since last time. Assuming</p>\n\n<pre><code>import qualified Text.Megaparsec as MP\nimport qualified Text.Megaparsec.Char as C\n</code></pre>\n\n<p>I tried </p>\n\n<pre><code>MP.parseTest (C.char '+') \"+\"\n</code></pre>\n\n<p>in GHCI, which gives the following rather unhelpful error message:</p>\n\n<pre><code>interactive&gt;:121:1: error:\n* Ambiguous type variable `e0' arising from a use of `MP.parseTest'\n  prevents the constraint `(MP.ShowErrorComponent\n                              e0)' from being solved.\n  Probable fix: use a type annotation to specify what `e0' should be.\n  These potential instance exist:\n    one instance involving out-of-scope types\n    (use -fprint-potential-instances to see them all)\n* In the expression: MP.parseTest (C.char '+') \"+\"\n  In an equation for `it': it = MP.parseTest (C.char '+') \"+\"\n\n&lt;interactive&gt;:121:15: error:\n* Ambiguous type variable `e0' arising from a use of `C.char'\n  prevents the constraint `(Ord e0)' from being solved.\n  Probable fix: use a type annotation to specify what `e0' should be.\n  These potential instances exist:\n    instance (Ord a, Ord b) =&gt; Ord (Either a b)\n      -- Defined in `Data.Either'\n    instance Ord Ordering -- Defined in `ghc-prim-0.5.3:GHC.Classes'\n    instance Ord Integer\n      -- Defined in `integer-gmp-1.0.2.0:GHC.Integer.Type'\n    ...plus 25 others\n    ...plus 131 instances involving out-of-scope types\n    (use -fprint-potential-instances to see them all)\n* In the first argument of `MP.parseTest', namely `(C.char '+')'\n  In the expression: MP.parseTest (C.char '+') \"+\"\n  In an equation for `it': it = MP.parseTest (C.char '+') \"+\"\n</code></pre>\n\n<p>Am I using this correctly? What do I need to do to fix this?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 1, "creation_date": 1543671430, "post_id": 53570385, "comment_id": 94007076, "body": "You may define an <code>infixr 9</code> operator as <code>flip (.)</code>."}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1543672363, "post_id": 53570385, "comment_id": 94007332, "body": "this is what I usually do, baring some standard operator. it&#39;s too bad there are not a blessed prelude, which I imagine would have a syntax for this operator. The many styles of haskell make it unnecessary hard to read. I can imagine newcomers being turned away by simple syntactic things like this"}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 1, "creation_date": 1543673478, "post_id": 53570385, "comment_id": 94007641, "body": "You can hide Prelude <code>(.)</code> then define an overloaded <code>(.) :: a -&gt; b -&gt; c</code> that looks at the types of its arguments to decide which way round it works: instance <code>a -&gt; (a -&gt; b) -&gt; b</code>; instance <code>(a -&gt; b) -&gt; (b -&gt; c) -&gt; (a -&gt; c)</code>; instance <code>(b -&gt; c) -&gt; (a -&gt; b) -&gt; (a -&gt; c)</code>. Needs Overlapping instances and Closed Type Families for the result type (or Functional Dependencies). Also needs a strong stomach for perplexing error messages ;-)"}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1543673866, "post_id": 53570385, "comment_id": 94007742, "body": "Well, the way the composition operator works is not about Haskell but <a href=\"http://www.wikizeroo.net/index.php?q=aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ29tcG9zaXRpb25fb3BlcmF0b3I\" rel=\"nofollow noreferrer\">Math</a> or more preciselly Category Theory. So it is <b>NOT</b> a good idea to <b>NOT</b> have it. You may always use <code>f &gt;&gt;= pure . g</code> for the desired effect (see how we needed <code>(.)</code> there). I understand your frustration, as it resembles the property accessor operator in some object oriented languages like JavaScript, which gets operated from left to right. So in Haskell you better use <code>(.)</code> with white spaces around."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 3, "creation_date": 1543673959, "post_id": 53570385, "comment_id": 94007770, "body": "Please don&#39;t do what @AntC suggests, though. Aside from the fact that no one will expect <code>f . g</code> to have two possible interpretations, it won&#39;t be able to decide which order is correct for <code>f, g :: a -&gt; a</code>, since both <code>f (g x)</code> and <code>g (f x)</code> would type-check."}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1543674542, "post_id": 53570385, "comment_id": 94007940, "body": "The two notions of composition are equally valid (and need to have 2 distinct syntax of course). In the early days of category, a few authors tried to use the &quot;natural&quot; way, but the mathematic convention won (I&#39;d say say unfortunately). The best is to have both and use the one which suits the best where it is used."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1543678292, "post_id": 53570385, "comment_id": 94008954, "body": "@Redu <a href=\"https://arxiv.org/abs/1803.05316\" rel=\"nofollow noreferrer\"><i>Seven Sketches in Compositionality</i></a>, a recent category theory book, uses left-to-right composition all along, with <code>;</code> as the chosen operator symbol. As nicolas suggests above, it is not such a big deal."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 2, "creation_date": 1543678575, "post_id": 53570385, "comment_id": 94009030, "body": "Note that in Haskell in particular, <code>f (g x)</code> actually runs <code>f</code> first and only runs <code>g</code> if <code>f</code> actually looks at its input.  So <code>f . g</code> is actually in the correct order."}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1543679761, "post_id": 53570385, "comment_id": 94009401, "body": "@Carl it&#39;s the correct order if you &quot;pull the evaluation thread&quot; from the left. if you pull from the right, then <code>x &amp; (g ; f)</code> would be the correct order."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1543683727, "post_id": 53570385, "comment_id": 94010485, "body": "@Carl True but that&#39;s just an outcome of Haskell evaluating <code>(.)</code> lazily not the reason why it&#39;s expression is defined the way it is. You are still expected to reason it&#39;s outcome by evaluating first <code>g</code> and then <code>f</code> in your mind. In such cases where <code>f</code> should neglect the result of  <code>g</code> then instead of composition you may do like <code>g &gt;&gt; f</code>."}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1543765844, "post_id": 53570385, "comment_id": 94027169, "body": "Note that we write types on the right of expressions, so we already use the &quot;natural&quot; convention for types, but, strangely, not for composition. That makes <code>(f (g (x::TypeX) :: TypeGX ) :: Type FGX)</code> so applying  <code>f</code> on the left ends up with its resulting type on the right. very odd...  If we insist on writing right to left, type should go on the left of expression too. mixing convention makes for needlessly hard to read code, which matters a lot since Type are part of the code in haskell !!"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 8, "last_activity_date": 1543664769, "creation_date": 1543664769, "answer_id": 53570449, "question_id": 53570385, "link": "https://stackoverflow.com/questions/53570385/function-composition-in-natural-order-in-haskell/53570449#53570449", "title": "function composition in natural order in haskell", "body": "<pre><code>import Control.Arrow\n(&gt;&gt;&gt;) :: (a -&gt; b) -&gt; (b -&gt; c) -&gt; a -&gt; c\n</code></pre>\n\n<p>Actually, <code>(&gt;&gt;&gt;)</code> is more general than that, since it works on any category, not just <code>(-&gt;)</code> functions. It is frequently used for forward function composition, though.</p>\n"}, {"comments": [{"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1543749920, "post_id": 53576540, "comment_id": 94022958, "body": "Thank you. this might be a simpler answer. I actually used it before, and felt like it should have been handy. To clarify, we have <code>(&lt;$&gt;) :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b</code> and <code>x-&gt;a</code> is, for a fixed x, a functor in <code>a</code>, giving <code>(&lt;$&gt;) @ (f = x-&gt;_) (a -&gt; b) -&gt; (x-&gt; a) -&gt; (x -&gt; b)</code>. In Cat-speak the functorial action of <i>a</i> representable functor is, up to iso, post-composition (and for <i>the</i> representable (x-&gt;_) that iso is the identity). likewise for <code>(&lt;&amp;&gt;) :: Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b </code> which is specialized to likewise for <code>(&lt;&amp;&gt;) @ (f = x-&gt;_) :: (x-&gt; a) -&gt; (a -&gt; b) -&gt; (x-&gt;b) </code>"}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1543750473, "post_id": 53576540, "comment_id": 94023085, "body": "On the downside, I think we should use non-polymorphic code when we are &quot;clients&quot;. The &quot;implementer&quot; might rely on general polymorphic, categorical structure, but since we as a client dont require it, those implementation detail should not pollute our usage, ideally. Conversely, when we do use it, it should be meaningful, broadcasting that our code is indeed polymorphic over all functor instances."}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 2, "last_activity_date": 1543714185, "creation_date": 1543714185, "answer_id": 53576540, "question_id": 53570385, "link": "https://stackoverflow.com/questions/53570385/function-composition-in-natural-order-in-haskell/53576540#53576540", "title": "function composition in natural order in haskell", "body": "<p>Function composition is a form of function application. <code>(.) = (&lt;$&gt;)</code>, and <code>(&lt;$&gt;)</code> is so named because it represents function application (<code>($)</code>) through a functor. Similarly, we have reverse function application, <code>(Data.Function.&amp;)</code>, and we also have reverse function application through a functor, <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Functor.html#v:-60--38--62-\" rel=\"nofollow noreferrer\"><code>(Data.Functor.&lt;&amp;&gt;)</code></a>. Compared to <code>(&gt;&gt;&gt;)</code>, <code>(&lt;&amp;&gt;)</code> avoids invoking <code>Category</code>, just <code>Functor</code>, but, on the other hand, it is a relatively new addition to <code>base</code>.</p>\n"}], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 0, "accepted_answer_id": 53570449, "answer_count": 2, "score": 2, "last_activity_date": 1543714185, "creation_date": 1543664127, "question_id": 53570385, "link": "https://stackoverflow.com/questions/53570385/function-composition-in-natural-order-in-haskell", "title": "function composition in natural order in haskell", "body": "<p>We all know and love/hate composition from right to left :</p>\n\n<pre><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c \n</code></pre>\n\n<p>What is the \"most standard\" operator (as in some sort of common library) for natural/left to right composition :</p>\n\n<pre><code>(???) :: (a -&gt; b) -&gt; (b -&gt; c) -&gt; a -&gt; c\n</code></pre>\n\n<p>which generalizes the common sense operator for values, seen as functions from <code>()</code> :</p>\n\n<pre><code>(&amp;) :: a -&gt; (a -&gt; b) -&gt; b \n</code></pre>\n\n<p>available in a few librairies</p>\n\n<p>PS : if there are none, any side for the name of such operator ? in math, natural composition is very often written \";\" but what would be the second best name ? <code>(&amp;.)</code> maybe ?</p>\n"}, {"tags": ["list", "sorting", "haskell", "filter"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1543663764, "post_id": 53570306, "comment_id": 94005325, "body": "Sounds good so far. Do you have any questions?"}, {"owner": {"reputation": 153, "user_id": 10576445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81b94a92f173bb81e959362daf0424d3?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Joe", "link": "https://stackoverflow.com/users/10576445/tyler-joe"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1543664070, "post_id": 53570306, "comment_id": 94005381, "body": "I don&#39;t know how to filter the list of list, I always get an error. I was thinking to use this: <code>filter (\\x -&gt; length x &gt; 1) </code> or something like this."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1543664372, "post_id": 53570306, "comment_id": 94005447, "body": "That&#39;s step 1. There&#39;s still something you need to do afterwards (and you can see what you&#39;ve got so far if you remove the (incorrect, by the way) type signature from <code>repeated</code>)."}], "answers": [{"comments": [{"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 0, "creation_date": 1543672193, "post_id": 53570416, "comment_id": 94007283, "body": "Good answer, but it seems overkill to <code>group</code>: the q only cares if an element is repeated, not how many repeats. Then it also seems overkill to <code>sort</code> the whole list: it could sort after getting the elements wanted (and that would be much fewer). Would something similar to <code>nub</code> require less traversing of the list?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543674388, "post_id": 53570416, "comment_id": 94007894, "body": "While it&#39;s true that sorting is O(n lg n), a linear traversal of an unsorted list will require some other data structure to keep track of all possible duplicates, and lookups in each will add to the space complexity at the very least. While carefully chosen data structures could be used to maintain an overall O(n) running time, the constant would probably make the algorithm slower in practice than the O(n lg n) solution, while greatly complicating the implementation."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543677390, "post_id": 53570416, "comment_id": 94008685, "body": "@chepner I don&#39;t understand: <code>map head . filter p . group</code> should always be safe, for any <code>p</code>, since <code>group</code> never generates empty lists. The (non)presence of duplicates should not affect the safety of <code>map head</code> in this code. Have I overlooked some case?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543698055, "post_id": 53570416, "comment_id": 94014238, "body": "Nope, I was just confusing empty lists with lists containing empty lists."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1543664470, "creation_date": 1543664470, "answer_id": 53570416, "question_id": 53570306, "link": "https://stackoverflow.com/questions/53570306/haskell-function-to-keep-the-repeating-elements-of-a-list/53570416#53570416", "title": "Haskell function to keep the repeating elements of a list", "body": "<p>Your code already does half of the job</p>\n\n<pre><code>&gt; group $ sort \"Mississippi\"\n[\"M\",\"iiii\",\"pp\",\"ssss\"]\n</code></pre>\n\n<p>You said you want to filter out the non-duplicates. Let's define a predicate which identifies the lists having at least two elements:</p>\n\n<pre><code>atLeastTwo :: [a] -&gt; Bool\natLeastTwo (_:_:_) = True\natLeastTwo _       = False\n</code></pre>\n\n<p>Using this:</p>\n\n<pre><code>&gt; filter atLeastTwo . group $ sort \"Mississippi\"\n[\"iiii\",\"pp\",\"ssss\"]\n</code></pre>\n\n<p>Good. Now, we need to take only the first element from such lists. Since the lists are non-empty, we can use <code>head</code> safely:</p>\n\n<pre><code>&gt; map head . filter atLeastTwo . group $ sort \"Mississippi\"\n\"ips\"\n</code></pre>\n\n<p>Alternatively, we could replace the filter with <code>filter (\\xs -&gt; length xs &gt;= 2)</code> but this would be less efficient.</p>\n\n<p>Yet another option is to use a list comprehension</p>\n\n<pre><code>&gt; [ x | (x:_y:_) &lt;- group $ sort \"Mississippi\" ]\n\"ips\"\n</code></pre>\n\n<p>This pattern matches on the lists starting with <code>x</code> and having at least another element <code>_y</code>, combining the filter with taking the head.</p>\n"}, {"tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": true, "score": 2, "last_activity_date": 1543666394, "last_edit_date": 1543666394, "creation_date": 1543665125, "answer_id": 53570489, "question_id": 53570306, "link": "https://stackoverflow.com/questions/53570306/haskell-function-to-keep-the-repeating-elements-of-a-list/53570489#53570489", "title": "Haskell function to keep the repeating elements of a list", "body": "<p>Okay, good start.  One immediate problem is that the specification requires the function to work on lists of numbers, but you define it for strings.  The list must be sorted, so its elements must have the typeclass <code>Ord</code>.  Therefore, let\u2019s fix the type signature:</p>\n\n<pre><code>repeated :: Ord a =&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>After calling <code>sort</code> and <code>group</code>, you will have a list of lists, <code>[[a]]</code>.  Let\u2019s take your idea of using <code>filter</code>.  That works.  Your predicate should, as you said, check the <code>length</code> of each list in the list, then compare that <code>length</code> to 1.</p>\n\n<p>Filtering a list of lists gives you a subset, which is another list of lists, of type <code>[[a]]</code>.  You need to flatten this list.  What you want to do is <code>map</code> each entry in the list of lists to one of its elements.  For example, the first.  There\u2019s a function in the <code>Prelude</code> to do that.</p>\n\n<p>So, you might fill in the following skeleton:</p>\n\n<pre><code>module Repeated (repeated) where\n\nimport Data.List (group, sort)\n\nrepeated :: Ord a =&gt; [a] -&gt; [a]\nrepeated = map _\n         . filter (\\x -&gt; _)\n         . group\n         . sort \n</code></pre>\n\n<p>I\u2019ve written this in point-free style with the filtering predicate as a lambda expression, but many other ways to write this are equally good.  Find one that you like!  (For example, you could also write the <code>filter</code> predicate in point-free style, as a composition of two functions: a comparison on the result of <code>length</code>.)</p>\n\n<p>When you try to compile this, the compiler will tell you that there are two <em>typed holes</em>, the <code>_</code> entries to the right of the equal signs.  It will also tell you the type of the holes.  The first hole needs a function that takes a list and gives you back a single element.  The second hole needs a Boolean expression using <code>x</code>.  Fill these in correctly, and your program will work.</p>\n"}, {"tags": [], "owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "is_accepted": false, "score": 0, "last_activity_date": 1543753208, "creation_date": 1543753208, "answer_id": 53580167, "question_id": 53570306, "link": "https://stackoverflow.com/questions/53570306/haskell-function-to-keep-the-repeating-elements-of-a-list/53580167#53580167", "title": "Haskell function to keep the repeating elements of a list", "body": "<p>Here's some other approaches, to evaluate @chepner's comment on the solution using <code>group $ sort</code>. (Those solutions look simpler, because some of the complexity is hidden in the library routines.)</p>\n\n<blockquote>\n  <p>While it's true that sorting is O(n lg n), ...</p>\n</blockquote>\n\n<p>It's not just the sorting but especially the <code>group</code>: that uses <code>span</code>, and both of them build and destroy temporary lists. I.e. they do this:</p>\n\n<blockquote>\n  <p>a linear traversal of an unsorted list will require some other data structure to keep track of all possible duplicates, and lookups in each will add to the space complexity at the very least. While carefully chosen data structures could be used to maintain an overall O(n) running time, the constant would probably make the algorithm slower in practice than the O(n lg n) solution, ...</p>\n</blockquote>\n\n<p><code>group/span</code> adds considerably to that complexity, so O(n lg n) is not a correct measure.</p>\n\n<blockquote>\n  <p>while greatly complicating the implementation.</p>\n</blockquote>\n\n<p>The following all traverse the input list just once. Yes they build auxiliary lists. (Probably a <code>Set</code> would give better performance/quicker lookup.) They maybe look more complex, but to compare apples with apples look also at the code for <code>group/span</code>.</p>\n\n<pre><code>repeated2, repeated3, repeated4 :: Ord a =&gt; [a] -&gt; [a]\n</code></pre>\n\n<ul>\n<li><p><code>repeated2/inserter2</code> builds an auxiliary list of pairs <code>[(a, Bool)]</code>, in which the <code>Bool</code> is <code>True</code> if the <code>a</code> appears more than once, <code>False</code> if only once so far.</p>\n\n<pre><code>repeated2 xs = sort $ map fst $ filter snd $ foldr inserter2 [] xs\n\ninserter2 :: Ord a =&gt; a -&gt; [(a, Bool)] -&gt; [(a, Bool)]\ninserter2 x [] = [(x, False)]\ninserter2 x (xb@(x', _): xs)\n    | x == x'   = (x', True): xs\n    | otherwise = xb: inserter2 x xs\n</code></pre></li>\n<li><p><code>repeated3/inserter3</code> builds an auxiliary list of pairs <code>[(a, Int)]</code>, in which the <code>Int</code> counts how many of the <code>a</code> appear. The aux list is sorted anyway, just for the heck of it.</p>\n\n<pre><code>repeated3 xs = map fst $ filter ((&gt; 1).snd) $ foldr inserter3 [] xs\n\ninserter3 :: Ord a =&gt; a -&gt; [(a, Int)] -&gt; [(a, Int)]\ninserter3 x [] = [(x, 1)]\ninserter3 x xss@(xc@(x', c): xs) = case x `compare` x' of\n    { LT -&gt; ((x, 1): xss)\n    ; EQ -&gt; ((x', c+1): xs)\n    ; GT -&gt; (xc: inserter3 x xs)\n    }\n</code></pre></li>\n<li><p><code>repeated4/go4</code> builds an output list of elements known to repeat. It maintains an intermediate list of elements met once (so far) as it traverses the input list. If it meets a repeat: it adds that element to the output list; deletes it from  the intermediate list; filters that element out of the tail of the input list.</p>\n\n<pre><code>repeated4 xs = sort $ go4 [] [] xs\n\ngo4 :: Ord a =&gt; [a] -&gt; [a] -&gt; [a] -&gt; [a]\ngo4 repeats _ [] = repeats\ngo4 repeats onces (x: xs) = case findUpd x onces of\n    { (True, oncesU) -&gt; go4 (x: repeats) oncesU (filter (/= x) xs)\n    ; (False, oncesU) -&gt; go4 repeats oncesU xs\n    }\n\nfindUpd :: Ord a =&gt; a -&gt; [a] -&gt; (Bool, [a])\nfindUpd x [] = (False, [x])\nfindUpd x (x': os) | x == x' = (True, os)      -- i.e. x' removed\n                   | otherwise =\n                     let (b, os') = findUpd x os in (b, x': os')\n</code></pre>\n\n<p>(That last bit of list-fiddling in <code>findUpd</code> is very similar to <code>span</code>.)</p></li>\n</ul>\n"}], "owner": {"reputation": 153, "user_id": 10576445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81b94a92f173bb81e959362daf0424d3?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Joe", "link": "https://stackoverflow.com/users/10576445/tyler-joe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 601, "favorite_count": 0, "accepted_answer_id": 53570489, "answer_count": 3, "score": -1, "last_activity_date": 1543753208, "creation_date": 1543663455, "last_edit_date": 1592644375, "question_id": 53570306, "link": "https://stackoverflow.com/questions/53570306/haskell-function-to-keep-the-repeating-elements-of-a-list", "title": "Haskell function to keep the repeating elements of a list", "body": "<p>Here is the expected input/output:</p>\n<blockquote>\n<p>repeated &quot;Mississippi&quot; == &quot;ips&quot;</p>\n<p>repeated [1,2,3,4,2,5,6,7,1] == [1,2]</p>\n<p>repeated &quot; &quot;  ==  &quot; &quot;</p>\n</blockquote>\n<p>And here is my code so far:</p>\n<pre><code>repeated :: String -&gt; String\nrepeated &quot;&quot; = &quot;&quot; \nrepeated x = group $ sort x \n</code></pre>\n<p>I know that the last part of the code doesn't work. I was thinking to sort the list then group it, then I wanted to make a filter on the list of list which are greater than 1, or something like that.</p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 2501, "user_id": 598892, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a22954b638ce69b9994c9e3623953a5?s=128&d=identicon&r=PG", "display_name": "Chris Smith", "link": "https://stackoverflow.com/users/598892/chris-smith"}, "edited": false, "score": 0, "creation_date": 1543762572, "post_id": 53569080, "comment_id": 94026180, "body": "Can you clarify why you need to keep the imports exactly the same in all of these files?  The usual answer would be to split things into multiple modules, with each module having only the imports needed for its own code.  You wouldn&#39;t need to modify imports in all 10 places unless you need the new import everywhere (but then are modifying all those files anyway)."}], "answers": [{"comments": [{"owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "edited": false, "score": 1, "creation_date": 1543673101, "post_id": 53569081, "comment_id": 94007544, "body": "I would like qualified module exports.  I know of prior discussion <a href=\"https://ghc.haskell.org/trac/ghc/ticket/8043#no1\" rel=\"nofollow noreferrer\">on trac</a>, and on mailing lists from <a href=\"https://mail.haskell.org/pipermail/libraries/2005-March/003390.html\" rel=\"nofollow noreferrer\">2005</a> and <a href=\"https://mail.haskell.org/pipermail/ghc-devs/2013-July/001637.html\" rel=\"nofollow noreferrer\">2013</a>.  Lacking that, I use a common imports file with lots of selective imports &amp; a couple of renames to keep the conflicts down.  That keeps my qualified imports list to a manageable size."}], "tags": [], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "is_accepted": false, "score": 0, "last_activity_date": 1543653053, "creation_date": 1543653053, "answer_id": 53569081, "question_id": 53569080, "link": "https://stackoverflow.com/questions/53569080/how-to-most-easily-break-up-a-large-haskell-file-with-lots-of-imports-many-qual/53569081#53569081", "title": "How to most easily break up a large Haskell file with lots of imports (many qualified) into smaller files?", "body": "<p>Some ideas how we could handle situations like this moving forward: </p>\n\n<ol>\n<li><p>Maybe go with the CPP option. Reloading won't work, and this can lead to frustration and confusion down the line, but seems to be the best option available to us that we can actually use currently. No repetition and duplication of 150 odd lines across 10 files, lesser maintenance burden. GHCi(d) can be re-launched manually which hopefully pulls in the changed <code>#include</code> file. Finicky, but maybe it also works to manually remember to <code>touch</code> an importing file after changing the <code>#include</code>d file.</p></li>\n<li><p>Maybe It's not difficult to merge the patch in issue #4900 granted we are okay with hs-boot support missing. I am totally okay with that as it seems like a strictly additive improvement without giving up anything.</p></li>\n<li><p>One potential long-term solution to this would be for GHC to support importing already-qualified stuff, and potentially supporting re-qualifying it too. E.g. <code>Foo.hs</code> imports qualified then re-exports <code>Bar.func1</code>. When I <code>import Foo</code> I have <code>Bar.func1</code> available. If I <code>import qualified Foo as F</code> then I could have <code>F.Bar.func1</code> available. Could be interesting to put this forward as a GHC Proposal. This feature could make option #2 in the question the clearly superior, natively-supported choice.</p></li>\n</ol>\n\n<p>Any other ideas?</p>\n"}], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 99, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1543653053, "creation_date": 1543653053, "question_id": 53569080, "link": "https://stackoverflow.com/questions/53569080/how-to-most-easily-break-up-a-large-haskell-file-with-lots-of-imports-many-qual", "title": "How to most easily break up a large Haskell file with lots of imports (many qualified) into smaller files?", "body": "<p>I have a large Haskell file (around 3000 lines) with many imports (around 150). I'm trying to break it up to smaller files to -- among other things -- improve build parallelism and therefore build times.</p>\n\n<ol>\n<li><p>The simplest and most naive way of doing this could be to duplicate the whole import header among all the new broken-up files. Everything would be working, except there would be <strong>a lot</strong> of repetition in those (maybe 5-10) new files and maintenance burden would become considerably worse, i.e. when one of the imports need to be changed it is now in 10 places instead of one.</p></li>\n<li><p>The more advanced option would be to create a CommonImports.hs file, where I import everything needed, then re-export ala <code>module CommonImports (module X) where import Foo as X</code>. This would work for the most part, except there is about 50 imports that are qualified. As far as I'm aware currently there is no way to re-export/re-import keeping the original qualifications in place. This could be done with a lot of refactoring where I remove all qualifications and resolve any name conflicts.</p></li>\n<li><p>There is a 3rd option: use the C preprocessor's <code>#include</code> feature. I've already used this before, and it works, even keeping qualified imports as-is. But there are some unfortunate caveats: ghci and consequently ghcid don't notice when the <code>#include</code>d file changes. I've tried overcoming it with a bit of TH help:</p>\n\n<pre><code>import qualified  Language.Haskell.TH.Syntax as TH\n\n#include \"./relative/../path/to/File.cpp.hs\"\n$(TH.addDependentFile \"/absolute/path/to/File.cpp.hs\" &gt;&gt; pure [])\n</code></pre>\n\n<p>To no avail. It turns out this is a missing feature from GHCi: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/4900#comment:81\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/4900#comment:81</a></p>\n\n<p>GHCid is quite central to my workflow so this is unfortunate.</p></li>\n</ol>\n\n<p>Did I miss any other approaches that some of you may be using? Maybe some that have lesser downsides or different trade-offs?</p>\n"}, {"tags": ["haskell", "state-monad"], "comments": [{"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1543653733, "post_id": 53569002, "comment_id": 94003271, "body": "what is your question?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user7084228"}, "reply_to_user": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1543654055, "post_id": 53569002, "comment_id": 94003333, "body": "Thanks for the comment, I rewrote it as a question."}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1543654379, "post_id": 53569002, "comment_id": 94003393, "body": "You can give an example to show what you want. by the way, your code has syntax error at  <code>(p) -&gt; (if p == Odd then x + 5 else ...</code>, it should be <code>\\p-&gt;(if...)</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user7084228"}, "reply_to_user": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1543654684, "post_id": 53569002, "comment_id": 94003430, "body": "I fixed it now."}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 1, "creation_date": 1543655681, "post_id": 53569002, "comment_id": 94003600, "body": "You cannot keep the state after <code>runState</code> has been called. That means that you can put all the code need state tranformer within a function, say, <code>stateFoo</code> and do the computation, for example, <code>do n1 &lt;- g n; n2 &lt;- g n1; .. ; return nk</code>  and then <code>runState stateFoo</code>  to get the result."}, {"owner": {"user_type": "does_not_exist", "display_name": "user7084228"}, "reply_to_user": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1543656358, "post_id": 53569002, "comment_id": 94003746, "body": "statefoo x= runstate (do n &lt;- g x return n) doesn&#39;t work, no instace show..."}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1543658211, "post_id": 53569002, "comment_id": 94004118, "body": "Try <code>statefoo = do n1&lt;-g 5; n2 &lt;-g 7; n3&lt;-g 4; n4&lt;-g 2; return [n1, n2, n3, n4]</code> and then <code>runState statefoo Odd</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user7084228"}, "reply_to_user": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1543658350, "post_id": 53569002, "comment_id": 94004143, "body": "So you cannot run the function on an arbitrary input but have to predefine n1 n2 etc?"}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1543659476, "post_id": 53569002, "comment_id": 94004392, "body": "No, you can arbitrary design the <code>statefoo</code> function with arbitrary augument, here is an example: <code>statefoo x = do n1&lt;-g x; n2&lt;-g n1; n3&lt;-g n2; n4&lt;-g n3; return [n1, n2, n3, n4]</code>; <code>runState (statefoo 5) Odd</code>. Just a demo, comment cannot show complex coding. you can do this with recurrsive function instead."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user7084228"}, "edited": false, "score": 0, "creation_date": 1543858282, "post_id": 53570851, "comment_id": 94060197, "body": "Thanks a lot for the an answer, how can you print the result of f n?"}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1543860704, "post_id": 53570851, "comment_id": 94061292, "body": "You don&#39;t :) Note the type of <code>f n</code> is the same as that of <code>isOdd</code>, i.e. <code>State Parity Int</code>. You don&#39;t print <code>f n</code>, instead you run it with an initial state, <code>runState (f n) Even</code>"}], "tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": true, "score": 2, "last_activity_date": 1543669447, "last_edit_date": 1543669447, "creation_date": 1543667932, "answer_id": 53570851, "question_id": 53569002, "link": "https://stackoverflow.com/questions/53569002/haskell-state-monad-different-behaviour-on-even-and-odd-function-calls/53570851#53570851", "title": "Haskell state monad different behaviour on even and odd function calls", "body": "<p>This <a href=\"https://stackoverflow.com/questions/53447330/haskell-how-to-make-side-effects-in-pure-functions/53448409#53448409\">answer</a> I wrote a few days ago may be helpful. \nKeeping it short, <code>State s</code> is just a convenient way of simulating \"stateful functions\" <code>f :: a -&gt; b</code> as pure functions <code>f :: (a,s) -&gt; (b,s)</code>. To fit the monad framework though these are curried, so (roughly) of the form <code>f :: a -&gt; s -&gt; (b,s)</code>. </p>\n\n<p>The type <code>State s b</code> is roughly <code>s -&gt; (b,s)</code>, which can be read as \"a computation that returns a value <code>b</code> and a final state <code>s</code> and that requires an initial state <code>s</code> to be run\". A monadic function <code>a -&gt; State s b</code> is therefore a function that takes an input <code>a</code>, and that can be run given an initial state <code>s</code>, to produce a value <code>b</code> and a final state <code>s</code>. </p>\n\n<p>Your function <code>isOdd</code> is,</p>\n\n<pre><code>isOdd x :: Int -&gt; State Parity Int\nisOdd x = state $ \\p -&gt; (if p == Odd then x + 5 else x - 6, not' p)\n</code></pre>\n\n<p>which is roughly,</p>\n\n<pre><code>isOdd' x :: Int -&gt; Parity -&gt; (Int,Parity)\nisOdd' x p = (if p == Odd then x + 5 else x - 6, not' p)\n</code></pre>\n\n<p>And your call, </p>\n\n<pre><code> apply n = runState (isOdd n) Even \n</code></pre>\n\n<p>is roughly, </p>\n\n<pre><code> apply' n = isOdd' x Even\n</code></pre>\n\n<p>That's all. You are essentially calculating </p>\n\n<pre><code> apply' n = --definition of apply'\n            isOdd' n Even\n            -- definition of isOdd'\n            (\\x p -&gt; (if p == Odd then x + 5 else x - 6, not' p)) n Even\n            -- application to the arguments `n` and `Even` \n            = (if Even == Odd then n + 5 else n - 6, not' Even)\n            -- simplifying\n            = (n - 6, Odd)\n</code></pre>\n\n<p>so, </p>\n\n<pre><code>apply' n = (n - 6, Odd)\n</code></pre>\n\n<p>Here is an example of how to sequence your function properly, </p>\n\n<pre><code>f :: Int -&gt; State Parity Int\nf n = isOdd n &gt;&gt;= (\\x -&gt; isOdd x) \n</code></pre>\n\n<p>or equivalently</p>\n\n<pre><code>f :: Int -&gt; State Parity Int\nf n = do x &lt;- isOdd n\n         isOdd x\n</code></pre>\n\n<p>When you run it via e.g. <code>apply n = runState (f n) Even</code> you are first running <code>isOdd n Even</code>, to obtain a result <code>m</code> and a new final state which will be <code>False</code>, and then running <code>isOdd m False</code>.  </p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user7084228"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "accepted_answer_id": 53570851, "answer_count": 1, "score": 2, "last_activity_date": 1543669447, "creation_date": 1543651879, "last_edit_date": 1543654397, "question_id": 53569002, "link": "https://stackoverflow.com/questions/53569002/haskell-state-monad-different-behaviour-on-even-and-odd-function-calls", "title": "Haskell state monad different behaviour on even and odd function calls", "body": "<p>I want to make a funciton that adds 5 on odd calls and subtracts 6 on even calls using state monads.</p>\n\n<pre><code>f 5 =  10\nf 7 = 1\nf 4 = 9\nf 2 = -4\n</code></pre>\n\n<p>0 is even so f 5 adds 5.\n1 is odd so f 7 subtracts 6 and so on.</p>\n\n<p>What I have now:</p>\n\n<pre><code>data Parity = Even | Odd deriving (Show, Eq)\n\nnot' :: Parity -&gt; Parity\nnot' Even = Odd\nnot' Odd = Even\n\nisOdd :: Int -&gt; State Parity Int\nisOdd x = state $ \\(p) -&gt; (if p == Odd then x + 5 else x - 6, not' p)\n\ng n = do isOdd n\n\napply n = runState (g n) Even\n</code></pre>\n\n<p>I tried writing it like that, but everytime 'apply' is used the state is not saved.\nIt only add 5 because of the even at the end.\nHow do I make it save the state and only initalize it once and not every time ?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 4614, "user_id": 1378868, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84a42920594ee2a0cc33012c407fd9d5?s=128&d=identicon&r=PG", "display_name": "snak", "link": "https://stackoverflow.com/users/1378868/snak"}, "is_accepted": false, "score": 1, "last_activity_date": 1543647102, "creation_date": 1543647102, "answer_id": 53568502, "question_id": 53568206, "link": "https://stackoverflow.com/questions/53568206/why-does-these-three-examples-give-different-results-they-seem-to-be-equivalent/53568502#53568502", "title": "Why does these three examples give different results? They seem to be equivalent", "body": "<p>When you write <code>let content = scanl (+) 0 content</code>, the second <code>content</code> is <strong>not</strong> the <code>content</code> declared in the previous line, but <code>content</code> declared in this line using <code>let</code>.</p>\n\n<p>So the first code just ignores <code>content</code> gotten from <code>day1</code>, but the second code uses it. That's why these two behave differently.</p>\n"}, {"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 1, "last_activity_date": 1543647247, "creation_date": 1543647247, "answer_id": 53568520, "question_id": 53568206, "link": "https://stackoverflow.com/questions/53568206/why-does-these-three-examples-give-different-results-they-seem-to-be-equivalent/53568520#53568520", "title": "Why does these three examples give different results? They seem to be equivalent", "body": "<p>Your original code is broken.</p>\n\n<pre><code>do content &lt;- day1\n   let content = scanl (+) 0 content\n   _etc\n</code></pre>\n\n<p>Does not mean \"bind the result of <code>day1</code> to <code>content</code>, apply <code>scanl (+) 0</code> to that, and bind that to <code>content</code>\". Actually, what you've written is the same as this:</p>\n\n<pre><code>do day1\n   let content = scanl (+) 0 content\n   _etc\n</code></pre>\n\n<p>Which has you executing <code>day1</code>, discarding its result, and then binding to <code>content</code> a recursively defined list. You're correct that <code>content</code> is being shadowed, but you didn't realize that the second <code>content</code> shadowed the first one in its own definition. If you type <code>let content = scanl (+) 0 content in content</code>, you'll actually see you have an infinite list of <code>0</code>s. It should be obvious why you then get <code>Just 0</code> as an \"answer.\"</p>\n\n<p>The \"correct\" solution is actually the final one.</p>\n\n<pre><code>day1_2 = do content &lt;- day1\n            let smth = scanl (+) 0 content\n            return $ dup smth\n-- don't need do notation; just functor-function-application\nday1_2 = dup &lt;$&gt; scanl (+) 0 &lt;$&gt; day1\n</code></pre>\n\n<p>But you are missing one crucial piece of the <a href=\"https://adventofcode.com/2018/day/1#part2\" rel=\"nofollow noreferrer\">question</a>:</p>\n\n<blockquote>\n  <p>Note that your device might need to repeat its list of frequency changes many times before a duplicate frequency is found</p>\n</blockquote>\n\n<p>You need just one call to a single standard library function to make this work. See if you can find it :). (Fair warning: once you find the function and use it, this solution takes a good few minutes to finish running, but it does work.)</p>\n\n<pre><code>day1_2 = dup &lt;$&gt; scanl (+) 0 &lt;$&gt; _libfunction &lt;$&gt; day1\n</code></pre>\n"}], "owner": {"reputation": 189, "user_id": 3350284, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1185f07087c9dfaf2af07c8c1db25d8d?s=128&d=identicon&r=PG&f=1", "display_name": "Herbstein", "link": "https://stackoverflow.com/users/3350284/herbstein"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 53568520, "answer_count": 2, "score": 0, "last_activity_date": 1543647247, "creation_date": 1543644101, "question_id": 53568206, "link": "https://stackoverflow.com/questions/53568206/why-does-these-three-examples-give-different-results-they-seem-to-be-equivalent", "title": "Why does these three examples give different results? They seem to be equivalent", "body": "<p>During my solving of AdventOfCode 2018 day 1 question 2 I ran into some weird behavior. The following code works as intended, and prints out the correct solution.</p>\n\n<pre><code>day1_2 = do\n    content &lt;- day1\n    let content = scanl (+) 0 content\n    return $ dup content\n  where\n    dup xs = dup' xs []\n      where\n        dup' [] _ = Nothing\n        dup' (x : xs) seen =\n            if x `elem` seen then Just x else dup' xs (x : seen)\n</code></pre>\n\n<p>It works, but I wanted to clean it up a little. As soon as I removed the second binding of <code>content</code>, and inlined the function call, the code stopped working. Since the <code>dup</code> function doesn't change I've omitted it from the rest of the snippets.</p>\n\n<pre><code>day1_2 = do\n    content &lt;- day1\n    return $ dup $ scanl (+) 0 content\n</code></pre>\n\n<p>My understanding of Haskell tells me those two functions should give identical results, but they don't. On the input I've been given the first function returns <code>Just 0</code> while the second returns <code>Nothing</code>. Is this a bug, or am I missing something?</p>\n\n<p>Reducing the code even more still keeps the behavior from the second function.</p>\n\n<pre><code>day1_2 = dup . scanl (+) 0 &lt;$&gt; day1\n</code></pre>\n\n<p>Here <code>day1</code> just reads the input given for day 1, and makes it parsable to Haskell.</p>\n\n<pre><code>day1 =\n    map (read . (\\n -&gt; if head n == '+' then tail n else n))\n        .   words\n        &lt;$&gt; readFile \"input/day1.txt\"\n</code></pre>\n\n<p>Further weirdness:</p>\n\n<pre><code>day1_2 = do\n    content &lt;- day1\n    let content' = scanl (+) 0 content\n    return $ dup content\n</code></pre>\n\n<p>The above gives me <code>Just 6</code>. (Not the desired result, but that is expected)</p>\n\n<pre><code>day1_2 = do\n    content &lt;- day1\n    let smth = scanl (+) 0 content\n    return $ dup smth\n</code></pre>\n\n<p>The above, however, gives me <code>Nothing</code> even though it's functionally equivalent to the first snippet, save for some naming differences. From these last tests it's obvious that the <code>content</code> binding in the original is shadowed. However, if no shadowing is involved then the wrong output is given.</p>\n\n<p><a href=\"https://pastebin.com/v8TqZkjE\" rel=\"nofollow noreferrer\">My specific input for day1.</a></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1227, "user_id": 5053374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe57f0998df065470ff42c938f781cf?s=128&d=identicon&r=PG", "display_name": "Libby", "link": "https://stackoverflow.com/users/5053374/libby"}, "edited": false, "score": 0, "creation_date": 1543628459, "post_id": 53567020, "comment_id": 93999769, "body": "What is the line number for which you get the error?"}, {"owner": {"reputation": 31, "user_id": 10703793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0ebf6120b8f1b8649b6778f122699fa?s=128&d=identicon&r=PG&f=1", "display_name": "MadeleineG", "link": "https://stackoverflow.com/users/10703793/madeleineg"}, "reply_to_user": {"reputation": 1227, "user_id": 5053374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe57f0998df065470ff42c938f781cf?s=128&d=identicon&r=PG", "display_name": "Libby", "link": "https://stackoverflow.com/users/5053374/libby"}, "edited": false, "score": 0, "creation_date": 1543628745, "post_id": 53567020, "comment_id": 93999797, "body": "it says. test3.hs:4:23 error:"}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 10703793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0ebf6120b8f1b8649b6778f122699fa?s=128&d=identicon&r=PG&f=1", "display_name": "MadeleineG", "link": "https://stackoverflow.com/users/10703793/madeleineg"}, "edited": false, "score": 0, "creation_date": 1543630383, "post_id": 53567131, "comment_id": 94000032, "body": "thank you so much! that cleared up my confusion on that. I now have the following error: test3.hs.4:17: error: * no instant for Num String arising from the literal &#39;100&#39;"}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 0, "creation_date": 1543632051, "post_id": 53567131, "comment_id": 94000237, "body": "<code>getLine</code> is type <code>IO String</code>, that is: returns the line as a <code>String</code> (within the IO monad). So it doesn&#39;t return a number. So you can&#39;t compare <code>listlen &lt; 100</code>. you need to convert the <code>String</code> to a number: use <code>read</code>."}], "tags": [], "owner": {"reputation": 1227, "user_id": 5053374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe57f0998df065470ff42c938f781cf?s=128&d=identicon&r=PG", "display_name": "Libby", "link": "https://stackoverflow.com/users/5053374/libby"}, "is_accepted": false, "score": 1, "last_activity_date": 1543629463, "creation_date": 1543629463, "answer_id": 53567131, "question_id": 53567020, "link": "https://stackoverflow.com/questions/53567020/output-putstrln-throws-error-when-running-in-the-command-line/53567131#53567131", "title": "Output putStrLn throws Error when running in the command line", "body": "<p>When I pasted your example into my editor, the line that failed was the one after \"then\". If you add a \"do\" after \"then\", that error goes away.</p>\n\n<p>So:</p>\n\n<pre><code>then do\nputStrLn \"Enter a number: \"\n</code></pre>\n\n<p>...etc.</p>\n"}, {"tags": [], "owner": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "is_accepted": false, "score": 1, "last_activity_date": 1544502208, "creation_date": 1544502208, "answer_id": 53717354, "question_id": 53567020, "link": "https://stackoverflow.com/questions/53567020/output-putstrln-throws-error-when-running-in-the-command-line/53717354#53717354", "title": "Output putStrLn throws Error when running in the command line", "body": "<p>The <code>listlen</code> is <code>String</code> type that cannot compare to <code>100</code>. It need use <code>read</code> to convert it to number:</p>\n\n<pre><code>if (read listlen &lt; 100)\n... \n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 10703793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0ebf6120b8f1b8649b6778f122699fa?s=128&d=identicon&r=PG&f=1", "display_name": "MadeleineG", "link": "https://stackoverflow.com/users/10703793/madeleineg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1544502208, "creation_date": 1543628027, "question_id": 53567020, "link": "https://stackoverflow.com/questions/53567020/output-putstrln-throws-error-when-running-in-the-command-line", "title": "Output putStrLn throws Error when running in the command line", "body": "<p>I am not understanding why this code is not outputting. I keep getting errors that say: parse error (possibly incorrect indentation or mismatched brackets) \n                  putStrLn \"Enter how many numbers:\"</p>\n\n<pre><code> main = do\n    putStrLn \"Enter how many numbers:\" -- clearer\n    listlen &lt;- getLine \n    if (listlen &lt; 100)\n    then \n    putStrLn \"Enter a number: \"\n    numberString &lt;- getLine\n    let numberInt =(read numberString :: Int)\n    print (numberInt)\n    else \n        putStrLn \" Error: listlen must be less than 100\"\n</code></pre>\n"}, {"tags": ["haskell", "command-line-arguments", "shake-build-system"], "answers": [{"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 3, "last_activity_date": 1543718804, "creation_date": 1543718804, "answer_id": 53576890, "question_id": 53566429, "link": "https://stackoverflow.com/questions/53566429/shake-how-to-set-an-environment-variable-upon-invocation/53576890#53576890", "title": "Shake: How to set an environment variable upon invocation?", "body": "\n\n<p>When you say</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>make subsample subsample_size=0.1\n</code></pre>\n\n<p>You invoke <code>make</code> with two arguments: <code>subsample</code> and <code>subsample_size=0.1</code>, and with the same environment the rest of your shell is in. <code>make</code> recognizes that <code>subsample_size=0.1</code> has the form <code>var=value</code>, and it interprets this as a macro definition. Doing so happens to have the same effect as setting an environment variable. Shake does not support taking definitions on the command line, so you must <em>actually</em> set an environment variable.</p>\n\n<p>The way you set the environment variable for Shake will depend on what program you are using to execute Shake. You are invoking Shake through a <code>build.sh</code>. Assuming this doesn't do anything too interesting, the script will pass its own environment to Shake unchanged. You are invoking <code>build.sh</code> through <code>stack exec</code>, which will pass your variable from its own environment unchanged as well (but it does change certain other variables). You are invoking <code>stack exec</code> through your own shell. Assuming that it is a POSIX shell, you can write</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>ev=\"Hello World!\" stack exec ./build.sh echoEnvVar\n</code></pre>\n\n<p>to set the <code>ev</code> environment variable during the call to <code>stack</code>. You can also use the <a href=\"http://pubs.opengroup.org/onlinepubs/009695399/utilities/export.html\" rel=\"nofollow noreferrer\"><code>export</code> builtin</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "is_accepted": false, "score": 1, "last_activity_date": 1543765752, "creation_date": 1543765752, "answer_id": 53581884, "question_id": 53566429, "link": "https://stackoverflow.com/questions/53566429/shake-how-to-set-an-environment-variable-upon-invocation/53581884#53581884", "title": "Shake: How to set an environment variable upon invocation?", "body": "<p>If what you want is an environment variable then @HTNW's answer is spot on.</p>\n\n<p>If what you really want is configuration options that are available in the program then you can use <a href=\"https://hackage.haskell.org/package/shake/docs/Development-Shake.html#v:shakeArgsWith\" rel=\"nofollow noreferrer\"><code>shakeArgsWith</code></a>. As an example:</p>\n\n<pre><code>import System.Console.GetOpt\n\nflags = [Option \"\" [\"subsample_size\"] (ReqArg readEither) \"Set the subsample size (in %).\"]\n\nmain = shakeArgsWith shakeOptions flags $ \\flags targets -&gt; return $ Just $ do\n    -- now flags will contain a list of the passed subsample_size values\n    ...\n</code></pre>\n"}], "owner": {"reputation": 2588, "user_id": 916142, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/cf88a560a7f987712350b7d629ed2bc7?s=128&d=identicon&r=PG", "display_name": "Jeffrey Benjamin Brown", "link": "https://stackoverflow.com/users/916142/jeffrey-benjamin-brown"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1543765752, "creation_date": 1543621707, "question_id": 53566429, "link": "https://stackoverflow.com/questions/53566429/shake-how-to-set-an-environment-variable-upon-invocation", "title": "Shake: How to set an environment variable upon invocation?", "body": "<p>In a Makefile, one can refer to arguments set at the command line at the time one invokes <code>make</code>. For instance, the recipe in a rule might include the command <code>python/subsample.py $(subsample_size)</code>, which one invokes at the command line by typing something like <code>make subsample subsample_size=0.1</code>.</p>\n\n<p>I would like to do the same thing with <code>shake</code>. I've written the following rule:</p>\n\n<pre><code>phony \"echoEnvVar\" $ do\n    ev &lt;- fromMaybe \"undefined\" &lt;$&gt; getEnv \"ev\"\n    liftIO $ putStrLn ev\n</code></pre>\n\n<p>The problem is that <code>shake</code> is treating the command-line definition of the <code>ev</code> variable as another target:</p>\n\n<pre><code>jeff@jeff-ThinkCentre-M700:~/shake-studies$ stack exec  ./build.sh echoEnvVar ev=whatever\nError when running Shake build system:\n* ev=whatever\nError, file does not exist and no rule available:\n  ev=whatever\nCallStack (from HasCallStack):\n  error, called at src/Development/Shake/Internal/Rules/File.hs:180:58 in shake-0.16.4-7UipAYwzJlKKX7fQ0hMQ1b:Development.Shake.Internal.Rules.File\n</code></pre>\n\n<p>If I instead call that rule with no command-line arguments, it behaves as expected:</p>\n\n<pre><code>jeff@jeff-ThinkCentre-M700:~/shake-studies$ stack exec  ./build.sh echoEnvVar\nundefined\nBuild completed in 0:01m\njeff@jeff-ThinkCentre-M700:~/shake-studies$\n</code></pre>\n"}, {"tags": ["haskell", "monad-transformers"], "answers": [{"comments": [{"owner": {"reputation": 4048, "user_id": 417166, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d335ffc02805c8c5deb38bdaabfa3e73?s=128&d=identicon&r=PG", "display_name": "blaze", "link": "https://stackoverflow.com/users/417166/blaze"}, "edited": false, "score": 0, "creation_date": 1543704766, "post_id": 53566359, "comment_id": 94015804, "body": "GeneralizedNewtypeDeriving doesn&#39;t work here, unfortunately. This is the first thing I tried.  <code>&#47;home&#47;blaze&#47;dev&#47;haskell-dbus&#47;lib&#47;DBus&#47;Introspection&#47;Render.h&zwnj;&#8203;s:27:24: error:     \u2022 Can&#39;t make a derived instance of \u2018Applicative (Render s)\u2019         (even with cunning GeneralizedNewtypeDeriving):         cannot eta-reduce the representation type enough     \u2022 In the newtype declaration for \u2018Render\u2019    | 27 |     deriving (Functor, Applicative, Monad) </code>"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 4048, "user_id": 417166, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d335ffc02805c8c5deb38bdaabfa3e73?s=128&d=identicon&r=PG", "display_name": "blaze", "link": "https://stackoverflow.com/users/417166/blaze"}, "edited": false, "score": 0, "creation_date": 1543720649, "post_id": 53566359, "comment_id": 94018181, "body": "@blaze Oops!  There was a superfluous <code>forall</code> in my version of <code>Render</code>.  Corrected; now GND should work..."}, {"owner": {"reputation": 4048, "user_id": 417166, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d335ffc02805c8c5deb38bdaabfa3e73?s=128&d=identicon&r=PG", "display_name": "blaze", "link": "https://stackoverflow.com/users/417166/blaze"}, "edited": false, "score": 0, "creation_date": 1543764247, "post_id": 53566359, "comment_id": 94026715, "body": "Yes, I found that without <code>forall</code> deriving works for Functor/Applicative/Monad, with some tricks. Had to write instances for MonadThrow and PrimMonad, though: without UndecideableInstances compiler can&#39;t reduce them enough.  Thanks for pointing out the need to expose <code>s</code>!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 4048, "user_id": 417166, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d335ffc02805c8c5deb38bdaabfa3e73?s=128&d=identicon&r=PG", "display_name": "blaze", "link": "https://stackoverflow.com/users/417166/blaze"}, "edited": false, "score": 0, "creation_date": 1543778921, "post_id": 53566359, "comment_id": 94031056, "body": "@blaze, what do you have against <code>UndecidableInstances</code>?"}, {"owner": {"reputation": 4048, "user_id": 417166, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d335ffc02805c8c5deb38bdaabfa3e73?s=128&d=identicon&r=PG", "display_name": "blaze", "link": "https://stackoverflow.com/users/417166/blaze"}, "edited": false, "score": 0, "creation_date": 1543792369, "post_id": 53566359, "comment_id": 94034471, "body": "They require me to be sure about something, instead of putting the burden on the compiler. In short, I&#39;m too lazy."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 2, "last_activity_date": 1543720584, "last_edit_date": 1543720584, "creation_date": 1543621171, "answer_id": 53566359, "question_id": 53565931, "link": "https://stackoverflow.com/questions/53565931/implementing-primmonad-for-newtype-d-catcht-st-s-stack/53566359#53566359", "title": "Implementing PrimMonad for newtype-d CatchT (ST s) stack", "body": "<p>You will need to expose the <code>s</code> parameter:</p>\n\n<pre><code>newtype Render s a = Render { runRender :: MaybeT (ST s) a }\n</code></pre>\n\n<p>A <code>forall s. ST s a</code> monad looks appealing, but it is pretty useless, since (for example) <code>newSTRef</code> can't let the ref it created escape.   (Try making <code>STRef</code>s work with your monad to see the problem)</p>\n\n<p>Once you expose <code>s</code> the <code>PrimMonad</code> instance should be straightforward.</p>\n\n<p>Also you know about <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#extension-GeneralizedNewtypeDeriving\" rel=\"nofollow noreferrer\"><code>GeneralizedNewtypeDeriving</code></a>, right?  You don't have to do all this work to make a newtype wrapper.</p>\n"}], "owner": {"reputation": 4048, "user_id": 417166, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d335ffc02805c8c5deb38bdaabfa3e73?s=128&d=identicon&r=PG", "display_name": "blaze", "link": "https://stackoverflow.com/users/417166/blaze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 1, "accepted_answer_id": 53566359, "answer_count": 1, "score": 3, "last_activity_date": 1543764468, "creation_date": 1543618071, "last_edit_date": 1543764468, "question_id": 53565931, "link": "https://stackoverflow.com/questions/53565931/implementing-primmonad-for-newtype-d-catcht-st-s-stack", "title": "Implementing PrimMonad for newtype-d CatchT (ST s) stack", "body": "<p>I'm trying to get <code>renderText</code> from <code>xml-conduit</code> working with <code>ST</code> monad. Unfortunately, unlike <code>renderBytes</code>, it requires monad to be both <code>PrimMonad</code> and <code>MonadThrow</code>. <code>IO</code> satisfies this, but <code>ST</code> doesn't.</p>\n\n<pre><code>renderText :: (PrimMonad m, MonadThrow m) =&gt; RenderSettings -&gt; ConduitT Event Text m ()\n</code></pre>\n\n<p>I managed to get it working with the <code>CatchT (ST s) a</code> stack, by defining PrimMonad instance:</p>\n\n<p><code>instance PrimMonad m =&gt; PrimMonad (CatchT m) where\n    type PrimState (CatchT m) = PrimState m\n    primitive = lift . primitive\n</code></p>\n\n<p>This is unhealthy orphan instance. I tried to wrap it into newtype, but got stuck on <code>PrimMonad</code>.</p>\n\n<pre><code>newtype Render a = Render { runRender :: forall s. MaybeT (ST s) a }\n\ninstance Functor Render where\n    fmap f (Render m) = Render (fmap f m)\n\ninstance Applicative Render where\n    pure a = Render (pure a)\n    (Render f) &lt;*&gt; (Render v) = Render (f &lt;*&gt; v)\n\ninstance Monad Render where\n    a &gt;&gt;= f = Render $ do\n        v &lt;- runRender a\n        runRender (f v)\n\ninstance MonadThrow Render where\n    throwM _ = Render $ MaybeT $ pure Nothing\n\ninstance PrimMonad Render where\n   [???]\n</code></pre>\n\n<p>How could I define <code>PrimMonad</code> for this stack?</p>\n\n<p><strong>Update</strong>: for the record, here is the answer based on @luqui's idea.</p>\n\n<pre><code>newtype Render s a = Render { runRender :: MaybeT (ST s) a }\n\nderiving instance Functor (Render s)\nderiving instance Applicative (Render s)\nderiving instance Monad (Render s)\n\ninstance MonadThrow (Render s) where\n    throwM _ = Render $ MaybeT $ pure Nothing\n\ninstance PrimMonad (Render s) where\n    type PrimState (Render s) = s\n    primitive f = Render $ lift $ primitive f\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "postfix-notation"], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543621800, "post_id": 53566007, "comment_id": 93998631, "body": "Note, too, that you don&#39;t have to use one or the other exclusively: for example, <code>step (x:y:ys) op | op == &quot;*&quot; = (x*y):ys; | op == &quot;+&quot; = ...</code> is valid."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543627338, "post_id": 53566007, "comment_id": 93999597, "body": "Good point @chepner - can I edit it into my answer for completeness?"}, {"owner": {"reputation": 153, "user_id": 10724515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/275cb88602df18b9496c19c422973d86?s=128&d=identicon&r=PG&f=1", "display_name": "CertainlyNotAdrian", "link": "https://stackoverflow.com/users/10724515/certainlynotadrian"}, "edited": false, "score": 0, "creation_date": 1543668856, "post_id": 53566007, "comment_id": 94006459, "body": "@bradrn please do :)"}], "tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": true, "score": 3, "last_activity_date": 1543669604, "last_edit_date": 1543669604, "creation_date": 1543618482, "answer_id": 53566007, "question_id": 53565866, "link": "https://stackoverflow.com/questions/53565866/haskell-reverse-polish-notation/53566007#53566007", "title": "haskell reverse polish notation", "body": "<p>You've implemented the function correctly, but your syntax is slightly wrong - you've used guards when you want to use pattern matching:</p>\n\n<ul>\n<li><em>Pattern matching</em> is used when you want to decompose a parameter into smaller parts or treat it in several cases; whereas</li>\n<li><em>Guards</em> are used when you want to select one branch of a function based on a boolean condition, similarly to an if/then/else expression. (So the condition of a guard has to be a valid expression of type <code>Bool</code>.)</li>\n</ul>\n\n<p>In your code, you've used guards, but you really want pattern matching, like this:</p>\n\n<pre><code>step :: [Int] -&gt; String -&gt; [Int]\nstep (x:y:ys) \"*\" = (x * y):ys\nstep (x:y:ys) \"+\" = (x + y):ys\nstep (x:y:ys) \"-\" = (x - y):ys\nstep (x:y:ys) \"/\" = (x / y):ys\n</code></pre>\n\n<p>However, this will still give an error:</p>\n\n<pre><code>* No instance for (Fractional Int) arising from a use of `/'\n* In the first argument of `(:)', namely `(x / y)'\n  In the expression: (x / y) : ys\n  In an equation for `step': step (x : y : ys) \"/\" = (x / y) : ys\n</code></pre>\n\n<p>This error is fairly clear: you're trying to <code>/</code> an integer, but integers are not <code>Fractional</code>, so you can't do that. If you want integer division, you can replace it with <code>div x y</code>, otherwise you can change <code>Int</code> to <code>Float</code> in the type signature to allow non-integer values.</p>\n\n<p>However, even after this change, there is still a subtle bug: what happens if your list has less than two elements, or an unsupported operator is used? The correct thing to do here is to pattern match at the end by using <code>step _ _ = (something)</code>, where <code>_</code> is a special syntax which matches anything. (Or you can also use <code>step stack operator = (something)</code>, if you want to refer back to <code>stack</code> and <code>operator</code> for something like an error message.</p>\n\n<p><strong>EDIT:</strong> In the comments below @chepner suggested another way to do this using both pattern matching and guards:</p>\n\n<pre><code>step :: [Int] -&gt; String -&gt; [Int]\nstep (x:y:ys) op\n    | op == \"*\" = (x * y):ys\n    | op == \"+\" = (x + y):ys\n    -- etc.\n    | otherwise = (some error case)\n</code></pre>\n\n<p>This again illustrates the difference between the two: pattern matching is used to decompose the first argument into <code>x</code>, <code>y</code> and <code>ys</code>, while guards are used with boolean conditions (with <code>otherwise</code> actually being defined in the Prelude as being equal to <code>True</code>).</p>\n"}], "owner": {"reputation": 153, "user_id": 10724515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/275cb88602df18b9496c19c422973d86?s=128&d=identicon&r=PG&f=1", "display_name": "CertainlyNotAdrian", "link": "https://stackoverflow.com/users/10724515/certainlynotadrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 875, "favorite_count": 0, "accepted_answer_id": 53566007, "answer_count": 1, "score": 2, "last_activity_date": 1543669604, "creation_date": 1543617610, "question_id": 53565866, "link": "https://stackoverflow.com/questions/53565866/haskell-reverse-polish-notation", "title": "haskell reverse polish notation", "body": "<p>being new to haskell I decied to try and implement a mini reverse polish notation function:</p>\n\n<p>Takes in a <code>list</code> of type <code>int</code> and a string operator (<code>'*','+','/','-'</code>) </p>\n\n<p>apply the operator to the <code>tail</code> element and the <code>tail-1</code> element</p>\n\n<p>return the resultant <code>list</code> with the two elements involved in the operation popped off and the resultant element appended to the tail as such:</p>\n\n<pre><code>Where e0 = original element at index 0\n\nr = result of the operation:\n\nresult = [e0,e1,e2...r] (elements popped off: eN, eN-1)\n</code></pre>\n\n<p>This is the code I have so far:</p>\n\n<pre><code>import Data.List\nimport System.IO\n\nstep :: [Int] -&gt; String -&gt; [Int]\nstep stack operator\n    | (x:y:ys) \"*\" = (x * y):ys\n    | (x:y:ys) \"+\" = (x + y):ys\n    | (x:y:ys) \"-\" = (x - y):ys\n    | (x:y:ys) \"/\" = (x / y):ys\n</code></pre>\n\n<p>And it gives me the following compile error:</p>\n\n<pre><code>\u2022 Couldn't match expected type \u2018[Char] -&gt; Bool\u2019\n                  with actual type \u2018[a3]\u2019\n    \u2022 The function \u2018x : y : ys\u2019 is applied to one argument,\n      but its type \u2018[a3]\u2019 has none\n      In the expression: (x : y : ys) \"/\"\n      In a stmt of a pattern guard for\n                     an equation for \u2018step\u2019:\n        (x : y : ys) \"/\"\n</code></pre>\n\n<p>I believe this is the result of an error in my syntax,\nany help is welcome!</p>\n"}, {"tags": ["haskell", "functional-programming", "pattern-matching", "parse-error"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1543617784, "post_id": 53565650, "comment_id": 93997610, "body": "Please paste the code as text in your question. Images are less accessible"}], "answers": [{"tags": [], "owner": {"reputation": 479, "user_id": 1050182, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/bfgX0.jpg?s=128&g=1", "display_name": "Yuan Wang", "link": "https://stackoverflow.com/users/1050182/yuan-wang"}, "is_accepted": false, "score": 0, "last_activity_date": 1543618261, "creation_date": 1543618261, "answer_id": 53565965, "question_id": 53565650, "link": "https://stackoverflow.com/questions/53565650/haskell-parse-error-pattern-using-valtypes/53565965#53565965", "title": "Haskell: Parse error pattern using ValTypes", "body": "<p>In this case, you don't have to use pattern matching, if else should be enough. Your syntax for function and pattern matching is slightly off. (That happens to any new haskell beginner quite often) </p>\n\n<pre><code>import Data.Ord\n\n\nminCompare :: Ord a =&gt; a -&gt; a -&gt; a\nminCompare left right = if left &gt;= right then left else right\n\nminCompare' :: Ord a =&gt; a -&gt; a -&gt; a\nminCompare' left right = case (compare left right) of\n                            LT -&gt; right\n                            EQ -&gt; left\n                            GT -&gt; left\n\nminCompare'' :: Ord a =&gt; a -&gt; a -&gt; a\nminCompare'' left right = case (compare left right) of\n                            LT -&gt; right\n                            _ -&gt; left\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 1, "last_activity_date": 1543637643, "creation_date": 1543637643, "answer_id": 53567715, "question_id": 53565650, "link": "https://stackoverflow.com/questions/53565650/haskell-parse-error-pattern-using-valtypes/53567715#53567715", "title": "Haskell: Parse error pattern using ValTypes", "body": "<p>You are so close!  You are just missing the guard symbol <code>|</code> before the conditions.</p>\n\n<pre><code>minCompare :: ValType -&gt; ValType -&gt; ValType\nminCompare leftSide rightSide\n    | leftSide == rightSide = leftSide\n    | leftSide &lt; rightSide = leftSide\n    | otherwise = rightSide\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 10729877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74a6e8b705d87d7eff425bb2921b3d90?s=128&d=identicon&r=PG&f=1", "display_name": "T. Hand", "link": "https://stackoverflow.com/users/10729877/t-hand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 53567715, "answer_count": 2, "score": -1, "last_activity_date": 1543639213, "creation_date": 1543616204, "last_edit_date": 1543639213, "question_id": 53565650, "link": "https://stackoverflow.com/questions/53565650/haskell-parse-error-pattern-using-valtypes", "title": "Haskell: Parse error pattern using ValTypes", "body": "<p>Can someone please explain why I keep getting this error? Especially when a different module, on the same laptop, can run the same expression and it be fine?</p>\n\n<pre><code>minCompare :: ValType -&gt; ValType -&gt; ValType\nminCompare leftSide rightSide\n     leftSide == rightSide = leftSide\n     leftSide &lt; rightSide = leftSide\n     otherwise = rightSide\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/mAUlB.png\" rel=\"nofollow noreferrer\">Haskell code screenshot</a></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 853, "user_id": 3645112, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/QFHGj.jpg?s=128&g=1", "display_name": "Rainbacon", "link": "https://stackoverflow.com/users/3645112/rainbacon"}, "edited": false, "score": 5, "creation_date": 1543610898, "post_id": 53564567, "comment_id": 93995201, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/53563414/how-to-read-add-print-a-number-string-in-haskell\">How to read/ add/ print a number string in Haskell</a>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 853, "user_id": 3645112, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/QFHGj.jpg?s=128&g=1", "display_name": "Rainbacon", "link": "https://stackoverflow.com/users/3645112/rainbacon"}, "edited": false, "score": 0, "creation_date": 1543610952, "post_id": 53564567, "comment_id": 93995224, "body": "@Rainbacon That was the OP&#39;s earlier question."}, {"owner": {"reputation": 853, "user_id": 3645112, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/QFHGj.jpg?s=128&g=1", "display_name": "Rainbacon", "link": "https://stackoverflow.com/users/3645112/rainbacon"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543611040, "post_id": 53564567, "comment_id": 93995257, "body": "@chepner yes, and this is the exact same question. If the OP doesn&#39;t understand the answers they got on the other question, they should comment on the answers they received asking for clarification rather than asking a new question"}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1543611616, "last_edit_date": 1543611616, "creation_date": 1543610920, "answer_id": 53564705, "question_id": 53564567, "link": "https://stackoverflow.com/questions/53564567/haskell-read-in-user-input-number-string-and-add-them/53564705#53564705", "title": "Haskell- Read in user input number string and add them", "body": "<p>If you want a single line of input, it doesn't need to include the number of numbers, because you'll just split the line on whitespace to get your list.</p>\n\n<pre><code>foo :: IO [Int]\nfoo = do\n   putStr \"Enter your numbers, separated by whitespace (e.g. 4 5 3 2): \"\n   line &lt;- getLine\n   return $ map read (words line)\n</code></pre>\n\n<p><code>words</code> splits an input like <code>2 3 4 5</code> into the list <code>[\"2\", \"3\", \"4\", \"5\"]</code>.</p>\n\n<p>If you want to control how many numbers are entered, with a separate prompt for each number, then you need <code>replicateM</code>:</p>\n\n<pre><code>-- No error handling or line editing, for simplicity\nfoo' :: IO [Int]\nfoo' = do\n    putStr \"How many numbers?: \"\n    n &lt;- readLn\n    replicateM n $ do\n      putStr \"Enter a number: \"\n      readLn\n</code></pre>\n\n<p><code>readLn</code> is equivalent to <code>fmap read getLine</code>; you get a line of input, calling <code>read</code> on the resulting string.</p>\n\n<p><code>replicateM</code> takes an <code>IO</code> action, defined by the nested <code>do</code> block, as its second argument. You were passing an undefined variable <code>action</code>. That action produces an <code>IO Int</code> value, which <code>replicateM</code> repeats <code>n</code> times an combines the resulting <code>IO Int</code> values into a single <code>IO [Int]</code> value. (Which is the difference between <code>replicateM</code> and <code>replicate</code>, which would have produced a list of actions, <code>[IO Int]</code>.)</p>\n\n<hr>\n\n<p>Because <code>foo</code> and <code>foo'</code> are both declared to have type <code>IO [Int]</code>, the compiler can infer the proper specific types for the uses of <code>read</code> and <code>readLn</code>.</p>\n"}], "owner": {"reputation": 31, "user_id": 10703793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0ebf6120b8f1b8649b6778f122699fa?s=128&d=identicon&r=PG&f=1", "display_name": "MadeleineG", "link": "https://stackoverflow.com/users/10703793/madeleineg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 200, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1543612695, "creation_date": 1543610158, "last_edit_date": 1543612695, "question_id": 53564567, "link": "https://stackoverflow.com/questions/53564567/haskell-read-in-user-input-number-string-and-add-them", "title": "Haskell- Read in user input number string and add them", "body": "<p>I asked a question earlier and was left with more questions than answers. </p>\n\n<p>I want to be able to do the following:Enter number of integers in a list followed by the number list. </p>\n\n<p><strong>Examples</strong> </p>\n\n<pre><code>4 1 2 3 4\n</code></pre>\n\n<p>OR</p>\n\n<pre><code>8 1 2 3 4 5 6 7 8\n</code></pre>\n\n<p>Right now I have the following code that is not working. </p>\n\n<pre><code>import Control.Monad\n\n\nreadLn = do\n    putStrLn \"Enter how many numbers:\" -- clearer\n    num&lt;-getLine\n    numbers&lt;- replicateM num action\n    putStrLn(\"Enter a number: \")\n    numberString &lt;- getLine\n    return (read numberString :: Int)\n    -- here we have numbers :: [Int]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 720, "user_id": 10696884, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-TZLhm3qAv5U/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gTJ8AUH3mkzlYyEQgF0K4AqDVXLw/mo/photo.jpg?sz=128", "display_name": "Thomas Lang", "link": "https://stackoverflow.com/users/10696884/thomas-lang"}, "edited": false, "score": 4, "creation_date": 1543606412, "post_id": 53563768, "comment_id": 93993261, "body": "Your condition should be <code>mod x 4 == 0</code>"}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 2, "creation_date": 1543609050, "post_id": 53563768, "comment_id": 93994468, "body": "<code>[4,8..20]</code> Hahaha but it works to any higher value."}], "answers": [{"tags": [], "owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "is_accepted": true, "score": -1, "last_activity_date": 1543606768, "last_edit_date": 1543606768, "creation_date": 1543606689, "answer_id": 53563844, "question_id": 53563768, "link": "https://stackoverflow.com/questions/53563768/how-to-show-the-numbers-that-is-divisible-by-4-in-haskell-language/53563844#53563844", "title": "How to show the numbers that is divisible by 4 in Haskell Language?", "body": "<pre><code>filter (\\x -&gt; (x `mod` 4) == 0) [1..20]\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 10729334, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-26rj7TTkCrY/AAAAAAAAAAI/AAAAAAAAAFM/9IyADfMMDaY/photo.jpg?sz=128", "display_name": "shawn steve", "link": "https://stackoverflow.com/users/10729334/shawn-steve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 53563844, "answer_count": 1, "score": -2, "last_activity_date": 1543606768, "creation_date": 1543606309, "question_id": 53563768, "link": "https://stackoverflow.com/questions/53563768/how-to-show-the-numbers-that-is-divisible-by-4-in-haskell-language", "title": "How to show the numbers that is divisible by 4 in Haskell Language?", "body": "<p>The target is to use filter statemate to show the numbers in [1..20] that is divisible by 4. Return a list only with the number that is divisible by 4. </p>\n\n<p>I'm using <code>mod</code> as </p>\n\n<pre><code>  filter (\\x -&gt; (x `mod` 4 == x))[1..20] \n</code></pre>\n\n<p>but this only returns [1,2,3]\nWhat do I suppose to do with this?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 720, "user_id": 10696884, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-TZLhm3qAv5U/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gTJ8AUH3mkzlYyEQgF0K4AqDVXLw/mo/photo.jpg?sz=128", "display_name": "Thomas Lang", "link": "https://stackoverflow.com/users/10696884/thomas-lang"}, "is_accepted": false, "score": 1, "last_activity_date": 1543606303, "creation_date": 1543606303, "answer_id": 53563767, "question_id": 53563414, "link": "https://stackoverflow.com/questions/53563414/how-to-read-add-print-a-number-string-in-haskell/53563767#53563767", "title": "How to read/ add/ print a number string in Haskell", "body": "<p>Construct a list of integers using</p>\n\n<pre><code>let l = map (\\x -&gt; read x::Int) (words \"6 1 2 3 4 5 6\")\nin (numNumbers, numbers)\n</code></pre>\n\n<p>You tried to read the whole string into a single number.</p>\n"}, {"comments": [{"owner": {"reputation": 31, "user_id": 10703793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0ebf6120b8f1b8649b6778f122699fa?s=128&d=identicon&r=PG&f=1", "display_name": "MadeleineG", "link": "https://stackoverflow.com/users/10703793/madeleineg"}, "edited": false, "score": 0, "creation_date": 1543607569, "post_id": 53563780, "comment_id": 93993795, "body": "I am showing an error with the &quot;numbers &lt;- replicateM num $ do&quot; line. ANy suggestions?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 31, "user_id": 10703793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0ebf6120b8f1b8649b6778f122699fa?s=128&d=identicon&r=PG&f=1", "display_name": "MadeleineG", "link": "https://stackoverflow.com/users/10703793/madeleineg"}, "edited": false, "score": 0, "creation_date": 1543608589, "post_id": 53563780, "comment_id": 93994272, "body": "@MadeleineG You probably need to <code>import Control.Monad</code>"}, {"owner": {"reputation": 31, "user_id": 10703793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0ebf6120b8f1b8649b6778f122699fa?s=128&d=identicon&r=PG&f=1", "display_name": "MadeleineG", "link": "https://stackoverflow.com/users/10703793/madeleineg"}, "edited": false, "score": 0, "creation_date": 1543609363, "post_id": 53563780, "comment_id": 93994598, "body": "that did not help. error:test3.hs:0:53: error:     * Variable not in scope: main :: IO a0     * Perhaps you meant `min&#39; (imported from Prelude)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 31, "user_id": 10703793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0ebf6120b8f1b8649b6778f122699fa?s=128&d=identicon&r=PG&f=1", "display_name": "MadeleineG", "link": "https://stackoverflow.com/users/10703793/madeleineg"}, "edited": false, "score": 0, "creation_date": 1543625531, "post_id": 53563780, "comment_id": 93999291, "body": "@MadeleineG I don&#39;t understand that error: above I define main, so it should be defined. (?)"}, {"owner": {"reputation": 31, "user_id": 10703793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0ebf6120b8f1b8649b6778f122699fa?s=128&d=identicon&r=PG&f=1", "display_name": "MadeleineG", "link": "https://stackoverflow.com/users/10703793/madeleineg"}, "edited": false, "score": 0, "creation_date": 1543626837, "post_id": 53563780, "comment_id": 93999506, "body": "yeah Im confused on it too. Thanks for your help."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1543606358, "creation_date": 1543606358, "answer_id": 53563780, "question_id": 53563414, "link": "https://stackoverflow.com/questions/53563414/how-to-read-add-print-a-number-string-in-haskell/53563780#53563780", "title": "How to read/ add/ print a number string in Haskell", "body": "<p>It seems you either need an auxiliary recursive function for reading <code>num</code> integers, or some helper like <code>replicateM</code>, which makes writing the code a little easier.</p>\n\n<p><code>replicateM num action</code> runs <code>action</code> exactly <code>num</code> times, and collects all the action results in a list.</p>\n\n<pre><code>main = do\n    putStrLn \"Enter how many numbers:\" -- clearer\n    num&lt;-getLine\n    numbers &lt;- replicateM num $ do\n       putStrLn(\"Enter a number: \")\n       numberString &lt;- getLine\n       return (read numberString :: Int)\n    -- here we have numbers :: [Int]\n    ...\n</code></pre>\n\n<p>You can then continue from there.</p>\n\n<hr>\n\n<p>If instead you want to use an auxiliary function, you can write</p>\n\n<pre><code>readInts :: Int -&gt; IO [Int]\nreadInts 0 = return []\nreadInts n = do\n    putStrLn(\"Enter a number: \")\n    numberString &lt;- getLine\n    otherNumbers &lt;- readInts (n-1)   -- read the rest\n    return (read numberString : otherNumbers)\n</code></pre>\n\n<hr>\n\n<p>Finally, instead of using <code>getLine</code> and then <code>read</code>, we could directly use <code>readLn</code> which combines both.</p>\n"}], "owner": {"reputation": 31, "user_id": 10703793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0ebf6120b8f1b8649b6778f122699fa?s=128&d=identicon&r=PG&f=1", "display_name": "MadeleineG", "link": "https://stackoverflow.com/users/10703793/madeleineg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 53563780, "answer_count": 2, "score": -1, "last_activity_date": 1543606358, "creation_date": 1543604711, "last_edit_date": 1543604772, "question_id": 53563414, "link": "https://stackoverflow.com/questions/53563414/how-to-read-add-print-a-number-string-in-haskell", "title": "How to read/ add/ print a number string in Haskell", "body": "<p>Below if my code right now. I want to be able to take in user input like the following: \"6 1 2 3 4 5 6\" and the get the sum and print.  it would also be cool to understand how to use the first number entered as the total numbers. SO here the first number is 6 and the total numbers inputted is 6. </p>\n\n<p>Thank you in advance for helping me with this. I have been researching for weeks and cannot figure this out. </p>\n\n<pre><code>main = do\n    putStrLn \"Enter how many numbers:\" -- clearer\n    num&lt;-getLine\n    putStrLn(\"Enter a number: \")\n    numberString &lt;- getLine \n    let numberInt =(read numberString :: Int)\n    print (numberInt*4)\n    main\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 75, "user_id": 10686157, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-IQBCPjl5qzM/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jyBParm2NeUyniKNHAokFIdty--g/mo/photo.jpg?sz=128", "display_name": "oddi", "link": "https://stackoverflow.com/users/10686157/oddi"}, "edited": false, "score": 0, "creation_date": 1543603728, "post_id": 53563167, "comment_id": 93992205, "body": "@Carcigenicate Oh I did&#180;t suspect that its that simple, thank you!"}, {"owner": {"reputation": 75, "user_id": 10686157, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-IQBCPjl5qzM/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jyBParm2NeUyniKNHAokFIdty--g/mo/photo.jpg?sz=128", "display_name": "oddi", "link": "https://stackoverflow.com/users/10686157/oddi"}, "edited": false, "score": 0, "creation_date": 1543603942, "post_id": 53563167, "comment_id": 93992298, "body": "when its foldl instead of foldr it works:) <code>subtractNums&#39; xs = foldl (-) 0 </code>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543604445, "post_id": 53563167, "comment_id": 93992507, "body": "Addition is associative; subtraction is not."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1543610110, "post_id": 53563167, "comment_id": 93994932, "body": "Basically you have to keep in mind that if the result of the folding function is of the same type with the items of the list that you are feeding with, then you might use <code>foldl1</code> or <code>foldlr1</code> instead. So no need for an accumulator here. But yes... when the function is <code>(-)</code> the result changes according to from which end you start with."}], "answers": [{"comments": [{"owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "edited": false, "score": 0, "creation_date": 1543623584, "post_id": 53563356, "comment_id": 93998961, "body": "Shouldn&#39;t <code>foldl&#39;</code> be used instead of <code>foldl</code>? <code>foldl</code> is too much viable of memory exhaustion."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "edited": false, "score": 1, "creation_date": 1543677173, "post_id": 53563356, "comment_id": 94008626, "body": "Probably, but that&#39;s beyond the scope of the question. I&#39;m not advocating the use of either function, just explaining the differences between them."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 6, "last_activity_date": 1543604730, "last_edit_date": 1543604730, "creation_date": 1543604409, "answer_id": 53563356, "question_id": 53563167, "link": "https://stackoverflow.com/questions/53563167/haskell-how-to-subtract-numbers-in-a-list-with-foldr/53563356#53563356", "title": "Haskell: How to subtract numbers in a list with foldr?", "body": "<p>Addition is associative (and commutative, meaning it doesn't matter if the identity gets added first on the right, or last on the left), so both <code>foldr</code> and <code>foldl</code> compute the same sum:</p>\n\n<pre><code>foldr (+) 0 [1,2,3] == 1 + (2 + (3 + 0)) == 1 + 2 + 3 == 6\nfoldl (+) 0 [1,2,3] == ((0 + 1) + 2) + 3 == 1 + 2 + 3 == 6\n</code></pre>\n\n<p>However, subtraction is <em>not</em> associative; <code>(x - y) - z</code> does not, in general, equal <code>x - (y - z)</code>, so <code>foldr</code> and <code>foldl</code> compute two different results:</p>\n\n<pre><code>foldl (-) 0 [1,2,3] == ((0 - 1) - 2) - 3 \n                    == (-1 - 2) - 3 \n                    == -3 - 3\n                    == -6\nfoldr (-) 0 [1,2,3] == 1 - (2 - (3 - 0)) \n                    == 1 - (2 - 3)\n                    == 1 - -1\n                    == 2\n</code></pre>\n\n<p>Which function you choose depends on which running difference you actually want to compute.</p>\n"}], "owner": {"reputation": 75, "user_id": 10686157, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-IQBCPjl5qzM/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jyBParm2NeUyniKNHAokFIdty--g/mo/photo.jpg?sz=128", "display_name": "oddi", "link": "https://stackoverflow.com/users/10686157/oddi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 916, "favorite_count": 0, "accepted_answer_id": 53563356, "answer_count": 1, "score": 1, "last_activity_date": 1543604730, "creation_date": 1543603430, "last_edit_date": 1543603517, "question_id": 53563167, "link": "https://stackoverflow.com/questions/53563167/haskell-how-to-subtract-numbers-in-a-list-with-foldr", "title": "Haskell: How to subtract numbers in a list with foldr?", "body": "<p>when you add numbers in a list with foldr it works:</p>\n\n<pre><code>sumIntegers :: [Integer] -&gt; Integer\nsumIntegers xs = foldr (+) 0 xs\n</code></pre>\n\n<p>but to substract doesn't work the same way because \nminus minus = plus. [2,3,4,5] is like: 2-3+4-5.</p>\n\n<pre><code>subtractNums' :: Num a =&gt; [a] -&gt; a\nsubtractNums' xs = foldr (-) 0 xs\n\nsubtractNums :: Num a =&gt; [a] -&gt; a\nsubtractNums []     = 0\nsubtractNums (x:xs) = x - subtractNums xs\n</code></pre>\n\n<p>What has to be changed?\nthank you in advance</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "is_accepted": false, "score": 4, "last_activity_date": 1543604247, "last_edit_date": 1543604247, "creation_date": 1543602465, "answer_id": 53562960, "question_id": 53562893, "link": "https://stackoverflow.com/questions/53562893/unknown-parse-error-from-haskell-code-for-formating-text/53562960#53562960", "title": "Unknown parse error from Haskell code for formating Text", "body": "<p>As it is stated in the error message the indentation is not correct. You need pattern guards to be indented relative to function declaration (see <a href=\"https://en.wikibooks.org/wiki/Haskell/Control_structures\" rel=\"nofollow noreferrer\">Control structures</a>).</p>\n\n<p>So your code should be like this:</p>\n\n<pre><code>chunks :: Int-&gt; [String]-&gt; [[String]]\nchunks i s = chunk' i (oneChunk s) where\n    chunk' i [[]] = [[]]\n    chunk' i (fi:se:ls)\n         | (length fi) + (length se) &lt; i = [fi ++ se] \n                                            ++ chunk' i (se:ls)\n         | otherwise = [fi] ++ [se] ++ chunk' i (se:ls)\n</code></pre>\n\n<hr>\n\n<p>I don't understand what problem you are trying to solve but seems like you can simplify your code a bit.</p>\n\n<p><code>oneChunk</code> applies <code>words</code> to each element of its argument and adds <code>[]</code> to the end. This can be stated as (read a bit on <a href=\"https://en.wikibooks.org/wiki/Haskell/Lists_II\" rel=\"nofollow noreferrer\"><code>map</code>s</a> and <a href=\"https://wiki.haskell.org/Pointfree\" rel=\"nofollow noreferrer\">pointfree style</a> for more info).</p>\n\n<pre><code>oneChunk = (++[]) . map words\n</code></pre>\n\n<p><code>chunk'</code> uses variable <code>i</code> from <code>chunks</code> so you can just drop it. Also some parentheses are unneeded and you can replace <code>[x] ++ y</code> with <code>x:y</code>):</p>\n\n<pre><code>chunks :: Int-&gt; [String]-&gt; [[String]]\nchunks i = chunk' . map words where\n    chunk' [] = []\n    chunk' (fi:se:ls)\n         | length fi + length se &lt; i = (fi ++ se) : chunk' (se:ls)\n         | otherwise = fi : se : chunk' (se:ls)\n</code></pre>\n"}], "owner": {"reputation": 29, "user_id": 8875909, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c73b4e2fd07ad9c4e9d8063f46975192?s=128&d=identicon&r=PG&f=1", "display_name": "Anzer Erkin", "link": "https://stackoverflow.com/users/8875909/anzer-erkin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1543604360, "creation_date": 1543602053, "last_edit_date": 1543604360, "question_id": 53562893, "link": "https://stackoverflow.com/questions/53562893/unknown-parse-error-from-haskell-code-for-formating-text", "title": "Unknown parse error from Haskell code for formating Text", "body": "<p>I want to use Haskell to format Text with giving Strings and length of the line. But keep getting a same unknown error at \"chunks\" function for no reason!! Here is the code:</p>\n\n<pre><code>module Format where\ndata Format = Flushleft | Justify | Flushright\n\n-- Help-function for chunks\noneChunk :: [String] -&gt; [[String]]\noneChunk [] = [[]]\noneChunk (s:ls) = [words s] ++ oneChunk ls\n\nchunks :: Int-&gt; [String]-&gt; [[String]]\nchunks i s = chunk' i (oneChunk s) where\n         chunk' i [[]] = [[]]\n         chunk' i (fi:se:ls)\n         | (length fi) + (length se) &lt; i = [fi ++ se] \n                                            ++ chunk' i (se:ls)\n         | otherwise = [fi] ++ [se] ++ chunk' i (se:ls)\n</code></pre>\n\n<p>Here is the error message: </p>\n\n<pre><code>Format.hs:13:14: error:\nparse error (possibly incorrect indentation or mismatched brackets)\n|\n13 |              | (length fi) + (length se) &lt; i = [fi ++ se] ++ \nchunk' i (se:ls)\n|  \n</code></pre>\n"}, {"tags": ["haskell", "liquid-haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1543605997, "post_id": 53562584, "comment_id": 93993103, "body": "I&#39;m no LH expert but, the type of <code>makeBs</code> promises that if we have a <code>ForeignPtr Word8</code> we can make a bytestring out of it having any nonnegative length. Don&#39;t we need to require that the pointer indeed points to that many bytes? Just a guess."}, {"owner": {"reputation": 932, "user_id": 6629874, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/3SUbo.jpg?s=128&g=1", "display_name": "5ndG", "link": "https://stackoverflow.com/users/6629874/5ndg"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1543610098, "post_id": 53562584, "comment_id": 93994928, "body": "Thanks, it sounds like a good idea.  I&#39;m thinking maybe something like {-@ type LHForeignPtr L = {f:ForeignPtr | len f == L} @-}.  But how do you get the number of bytes that the pointer points to? (I&#39;m no LH expert either)"}], "answers": [{"comments": [{"owner": {"reputation": 932, "user_id": 6629874, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/3SUbo.jpg?s=128&g=1", "display_name": "5ndG", "link": "https://stackoverflow.com/users/6629874/5ndg"}, "edited": false, "score": 0, "creation_date": 1559240271, "post_id": 56381659, "comment_id": 99367390, "body": "Wow, thanks. I&#39;d forgotten about this question, but when I get time I will have another look at this."}], "tags": [], "owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "is_accepted": false, "score": 1, "last_activity_date": 1559231813, "creation_date": 1559231813, "answer_id": 56381659, "question_id": 53562584, "link": "https://stackoverflow.com/questions/53562584/liquid-haskell-creating-a-new-bytestring-with-ps/56381659#56381659", "title": "Liquid haskell creating a new bytestring with PS", "body": "<p>LiquidHaskell doesn't know that the <code>ByteString</code> returned by <code>makeBs</code> has length <code>l</code>, and it can't prove that from the information available to it.</p>\n\n<p>You know it will because you know that the third argument to the <code>PS</code> constructor is the length. So at this point you have two (or possibly one) options:</p>\n\n<ol>\n<li>You can try to tell LH what you know about the <code>PS</code> constructor, and give it an annotation like \n<code>{-@ Bi.PS :: _ -&gt; _ -&gt; l:NonNeg -&gt; ByteString l @-}</code>. I tried this and it didn't quite work because there are internal GHC types in the signature of <code>PS</code> that LH doesn't seem so good at handling. YMMV. Or, you can:</li>\n<li>Forget about annotating <code>PS</code> and mark your own function with <code>assume</code>: <code>{-@ assume makeBs :: ForeignPtr Word8 -&gt; l:NonNeg -&gt; ByteString l @-}</code>. Of course, this gets riskier if the function marked with <code>assume</code> gets any bigger\u2014silly though it may seem, you might want to keep <code>makeBs</code> around if you go this route.</li>\n</ol>\n"}], "owner": {"reputation": 932, "user_id": 6629874, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/3SUbo.jpg?s=128&g=1", "display_name": "5ndG", "link": "https://stackoverflow.com/users/6629874/5ndg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1559231813, "creation_date": 1543600693, "question_id": 53562584, "link": "https://stackoverflow.com/questions/53562584/liquid-haskell-creating-a-new-bytestring-with-ps", "title": "Liquid haskell creating a new bytestring with PS", "body": "<p>I'm making some bindings to C from Haskell, and trying to make it safer with LiquidHaskell. I'm having some trouble with specifying the length of a bytestring in the LH type annotation.</p>\n\n<p>I have an enhanced ByteString type in LiquidHaskell that includes its length:</p>\n\n<pre><code>{-@ type ByteString Blen = {v:B.ByteString | bslen v == Blen} @-}\n</code></pre>\n\n<p>I am getting the following error when I run Liquidhaskell:</p>\n\n<pre><code>**** RESULT: UNSAFE ************************************************************\n\n\n /home/t/liquidproblem/Main.hs:47:3-22: Error: Liquid Type Mismatch\n\n 47 |   Bi.PS foreignPtr 0 l\n        ^^^^^^^^^^^^^^^^^^^^\n\n   Inferred type\n     VV : {v : Data.ByteString.Internal.ByteString | 0 &lt;= bslen v\n                                                     &amp;&amp; bslen v == stringlen v}\n\n   not a subtype of Required type\n     VV : {VV : Data.ByteString.Internal.ByteString | bslen VV == l}\n\n   In Context\n     l : {l : GHC.Types.Int | l &gt;= 0}\n</code></pre>\n\n<p>Line 47 is:</p>\n\n<pre><code>44 {-@ makeBs :: ForeignPtr Word8 -&gt; l:NonNeg -&gt; ByteString l @-}\n45 makeBs :: F.ForeignPtr F.Word8 -&gt; Int -&gt; B.ByteString\n46 makeBs foreignPtr l =\n47   Bi.PS foreignPtr 0 l\n</code></pre>\n\n<p>(I know this seems a bit of a silly function, but it got put in because the debugging process was to factor out bits and put LH annotations on them till I found the problem.)</p>\n\n<p>The relevant imports are:</p>\n\n<pre><code>import qualified Data.ByteString.Internal as Bi\nimport qualified Data.ByteString as B\nimport qualified Foreign as F\n</code></pre>\n\n<p>The LH NonNeg type is</p>\n\n<pre><code>{-@ type NonNeg = {i:Int | i &gt;= 0} @-}\n</code></pre>\n"}, {"tags": ["haskell", "aeson"], "answers": [{"comments": [{"owner": {"reputation": 2331, "user_id": 2072459, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/JBWNH.jpg?s=128&g=1", "display_name": "Nicolas Heimann", "link": "https://stackoverflow.com/users/2072459/nicolas-heimann"}, "edited": false, "score": 0, "creation_date": 1543597427, "post_id": 53560646, "comment_id": 93989381, "body": "I need some more help here: I get an error <code>Data constructor not in scope: String :: T.Text -&gt; aeson-1.3.1.1:Data.Aeson.Types.Internal.Value</code> It recommends me to add <code>String</code> to the import of <code>Data.Aeson</code> which does not work"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 2331, "user_id": 2072459, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/JBWNH.jpg?s=128&g=1", "display_name": "Nicolas Heimann", "link": "https://stackoverflow.com/users/2072459/nicolas-heimann"}, "edited": false, "score": 1, "creation_date": 1543597540, "post_id": 53560646, "comment_id": 93989427, "body": "If you are doing explicit imports, you need something like <code>import Data.Aeson (ToJSON, toJSON, (.=), object, Value(String))</code>; the data constructor <code>String</code> isn&#39;t imported &quot;directly&quot; from <code>Data.Aeson</code>. This allows a module to export a type without exposing its constructors; it only works because Aeson explicitly exports <code>Value(..)</code>, rather than just <code>Value</code>."}, {"owner": {"reputation": 2331, "user_id": 2072459, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/JBWNH.jpg?s=128&g=1", "display_name": "Nicolas Heimann", "link": "https://stackoverflow.com/users/2072459/nicolas-heimann"}, "edited": false, "score": 0, "creation_date": 1543597832, "post_id": 53560646, "comment_id": 93989527, "body": "Aah thank you very much for explaining me how to import data constructors explicitly. Now it works, very cool!!"}, {"owner": {"reputation": 2331, "user_id": 2072459, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/JBWNH.jpg?s=128&g=1", "display_name": "Nicolas Heimann", "link": "https://stackoverflow.com/users/2072459/nicolas-heimann"}, "edited": false, "score": 0, "creation_date": 1543598064, "post_id": 53560646, "comment_id": 93989641, "body": "I refactored it a bit so that I use the following data <code>ReadServiceResponse String</code>. This avoids the pack/unpack into lazy text and looks more clean. <code>toJSON (ReadServiceResponse text) = String . T.pack $ text</code>."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 2, "last_activity_date": 1543592619, "creation_date": 1543592619, "answer_id": 53560646, "question_id": 53560104, "link": "https://stackoverflow.com/questions/53560104/tojson-instance-single-value/53560646#53560646", "title": "toJson instance single value", "body": "<p>Since <code>toJSON</code> must return a value of type <code>Value</code>, you can't return <code>text</code> by itself; it has to be wrapped with the <code>String</code> data constructor.</p>\n\n<pre><code>toJSON (ReadServiceResponse text) = String text\n</code></pre>\n\n<p>Note that since <code>String :: T.Text -&gt; Value</code>, this requires you to use the strict implementation of <code>Text</code> in the definition of <code>ReadServiceResopnse</code>:</p>\n\n<pre><code>data ServiceResponse = ReadServiceResponse  T.Text -- not L.Text\n                     | GenericServiceError  Int L.Text\n</code></pre>\n\n<p>or doing a conversion in <code>toJSON</code>:</p>\n\n<pre><code>toJSON (ReadServiceResponse text) = String . T.pack . L.unpack $ text\n</code></pre>\n"}], "owner": {"reputation": 2331, "user_id": 2072459, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/JBWNH.jpg?s=128&g=1", "display_name": "Nicolas Heimann", "link": "https://stackoverflow.com/users/2072459/nicolas-heimann"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 53560646, "answer_count": 1, "score": 0, "last_activity_date": 1543592619, "creation_date": 1543590650, "question_id": 53560104, "link": "https://stackoverflow.com/questions/53560104/tojson-instance-single-value", "title": "toJson instance single value", "body": "<p>I am able to json-encode my data</p>\n\n<pre><code>import Data.Aeson                       (ToJSON, toJSON, (.=), object)\nimport qualified Data.Text      as T\nimport qualified Data.Text.Lazy as L\n\ndata ServiceResponse = ReadServiceResponse  L.Text\n                     | GenericServiceError  Int L.Text\n\ninstance ToJSON ServiceResponse where\n    toJSON (ReadServiceResponse text)      = object [\"text\" .= text]\n    toJSON (GenericServiceError code text) =\n        object [\"code\" .= code, \"message\" .= text]\n</code></pre>\n\n<p>For data having only one \"scalar\" value (e.g. String, Int, L.Text, ...) I would like to get a scalar representation instead of an object. For example the <code>ReadServiceResponse</code> should be encoded into a json string instead of an object like</p>\n\n<pre><code>{\n    text: \"hi I'm some text.\"\n}\n</code></pre>\n\n<p>I tried</p>\n\n<pre><code>instance ToJSON ServiceResponse where\n    toJSON (ReadServiceResponse text) = text\n</code></pre>\n\n<p>which does not compile</p>\n\n<pre><code>\u2022 Couldn't match expected type \u2018aeson-1.3.1.1:Data.Aeson.Types.Internal.Value\u2019 with actual type \u2018L.Text\u2019\n</code></pre>\n\n<p>Should I transform <code>text</code> into a <code>Data.Aeson.Types.Internal.Value</code> (How can i do that)? Thanks in advance for any help </p>\n"}, {"tags": ["haskell", "rabbitmq", "amqp"], "answers": [{"comments": [{"owner": {"reputation": 993, "user_id": 4541287, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/64f22664ee95fd0770558a2d2daeb879?s=128&d=identicon&r=PG&f=1", "display_name": "Bogdan Ruzhitskiy", "link": "https://stackoverflow.com/users/4541287/bogdan-ruzhitskiy"}, "edited": false, "score": 0, "creation_date": 1543665735, "post_id": 53560230, "comment_id": 94005720, "body": "Thank you for a response. MVar sounds a good fit for a parallel processing but in case of a single processing, what is the options to share mutable context between callbacks?"}, {"owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "reply_to_user": {"reputation": 993, "user_id": 4541287, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/64f22664ee95fd0770558a2d2daeb879?s=128&d=identicon&r=PG&f=1", "display_name": "Bogdan Ruzhitskiy", "link": "https://stackoverflow.com/users/4541287/bogdan-ruzhitskiy"}, "edited": false, "score": 1, "creation_date": 1543673779, "post_id": 53560230, "comment_id": 94007720, "body": "Since the type of <code>consumeMsgs</code> requires your callback to operate in IO, I&#39;d stick to <code>MVar</code> even in the sequential case.  <code>IORef</code> would also be fine since you don&#39;t need a lock.  There&#39;s not much point to <code>StateT s IO</code> since that type doesn&#39;t provide any assurance that there are no mutable variables outside of s.  Building a more flexible / effect-save interface is possible but probably a bigger project than you are looking for."}], "tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": false, "score": 3, "last_activity_date": 1543591094, "creation_date": 1543591094, "answer_id": 53560230, "question_id": 53556761, "link": "https://stackoverflow.com/questions/53556761/sharing-a-context-between-amqp-callbacks/53560230#53560230", "title": "Sharing a context between AMQP callbacks", "body": "<p>If you are planning to process multiple messages in parallel (in the same Haskell process) I would start with an <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Concurrent-MVar.html\" rel=\"nofollow noreferrer\">MVar</a> to hold the shared state.</p>\n\n<p>MVar is basically a shared variable with a lock, and a reasonable interface.  In simple cases (like a counter) that is enough to prevent data races.  It's a middle ground between lower-level (IORef) and higher-level (STM) abstractions over shared memory.  I think it's the easiest to understand, and I use it for all initial prototyping.</p>\n\n<p>I don't know the RabbitMQ library, so can't answer your second question, about whether messages are processed in parallel.</p>\n"}, {"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 2, "last_activity_date": 1543605400, "creation_date": 1543605400, "answer_id": 53563567, "question_id": 53556761, "link": "https://stackoverflow.com/questions/53556761/sharing-a-context-between-amqp-callbacks/53563567#53563567", "title": "Sharing a context between AMQP callbacks", "body": "<p>Building on @bergey's answer - you can create a mutable reference such as an IORef or MVar.  These references can be passed to your handler using partial function application.  Typed but not tested code follows.</p>\n\n<pre><code>main :: IO ()\nmain = do\n     conn &lt;- openConnection \"127.0.0.1\" \"/\" \"guest\" \"guest\"\n     ch   &lt;- openChannel conn\n     ref  &lt;- newMVar 0\n</code></pre>\n\n<p>Notice the <code>ref</code> in the above and the generating function <code>newMVar</code> from <code>Control.Concurrent.MVar</code>.</p>\n\n<pre><code>     declareQueue ch newQueue {queueName       = \"hello\",\n                               queueAutoDelete = False,\n                               queueDurable    = False}\n\n     putStrLn \" [*] Waiting for messages. To exit press CTRL+C\"\n     consumeMsgs ch \"hello\" NoAck (deliveryHandler ref)\n</code></pre>\n\n<p>See how we pass the ref to <code>deliveryHandler</code> by function application.</p>\n\n<pre><code>     -- waits for keypresses\n     getLine\n     closeConnection conn\n\ndeliveryHandler :: MVar Int -&gt; (Message, Envelope) -&gt; IO ()\ndeliveryHandler ref (msg, metadata) =\n  BL.putStrLn $ \" [x] Received \" &lt;&gt; msgBody msg\n  withMVar' ref $ \\val -&gt;\n       do print val\n          pure (val + 1)\n</code></pre>\n\n<p>And finally we can work with ref using function from <code>Control.Concurrent.MVar</code>, getting the old value and replacing it with a new value as desired.</p>\n"}], "owner": {"reputation": 993, "user_id": 4541287, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/64f22664ee95fd0770558a2d2daeb879?s=128&d=identicon&r=PG&f=1", "display_name": "Bogdan Ruzhitskiy", "link": "https://stackoverflow.com/users/4541287/bogdan-ruzhitskiy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 53563567, "answer_count": 2, "score": 2, "last_activity_date": 1543605400, "creation_date": 1543577685, "last_edit_date": 1543580223, "question_id": 53556761, "link": "https://stackoverflow.com/questions/53556761/sharing-a-context-between-amqp-callbacks", "title": "Sharing a context between AMQP callbacks", "body": "<p>There is a simple tutorial about RabbitMQ usage for Haskell where I took this piece of code</p>\n\n<pre><code>main :: IO ()\nmain = do\n     conn &lt;- openConnection \"127.0.0.1\" \"/\" \"guest\" \"guest\"\n     ch   &lt;- openChannel conn\n\n     declareQueue ch newQueue {queueName       = \"hello\",\n                               queueAutoDelete = False,\n                               queueDurable    = False}\n\n     putStrLn \" [*] Waiting for messages. To exit press CTRL+C\"\n     consumeMsgs ch \"hello\" NoAck deliveryHandler\n\n     -- waits for keypresses\n     getLine\n     closeConnection conn\n\ndeliveryHandler :: (Message, Envelope) -&gt; IO ()\ndeliveryHandler (msg, metadata) =\n  BL.putStrLn $ \" [x] Received \" &lt;&gt; msgBody msg\n</code></pre>\n\n<p>It simply explains how to get a message from the queue and process it with the callback. </p>\n\n<p>The one thing might be simple to solve, but I'm struggling to understand how to add some mutable context inside the callback, so each time a function runs it can change it. Simply, how to calculate the message number in the queue order. I found that a possible solution is a State monad, is it?</p>\n\n<p>And the second question - all these callbacks are processed in a parallel or not? If not, how to process them in parallel and keep the mutable context without a data race?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1961, "user_id": 3114765, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KrkYp.jpg?s=128&g=1", "display_name": "Novak", "link": "https://stackoverflow.com/users/3114765/novak"}, "edited": false, "score": 0, "creation_date": 1543572215, "post_id": 53555140, "comment_id": 93975876, "body": "This is correct, thanks :) But Can you explain why this happens? Why do I have to give it the type?"}, {"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "reply_to_user": {"reputation": 1961, "user_id": 3114765, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KrkYp.jpg?s=128&g=1", "display_name": "Novak", "link": "https://stackoverflow.com/users/3114765/novak"}, "edited": false, "score": 0, "creation_date": 1543572318, "post_id": 53555140, "comment_id": 93975930, "body": "You can find explanation here  <a href=\"https://stackoverflow.com/questions/32496864/what-is-the-monomorphism-restriction\" title=\"what is the monomorphism restriction\">stackoverflow.com/questions/32496864/&hellip;</a>"}], "tags": [], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "is_accepted": true, "score": 3, "last_activity_date": 1543571830, "creation_date": 1543571830, "answer_id": 53555140, "question_id": 53555009, "link": "https://stackoverflow.com/questions/53555009/haskell-throws-error-on-if-then-else-statement/53555140#53555140", "title": "Haskell throws error on if then else statement", "body": "<p>Just give it the type:</p>\n\n<pre><code>ex112 :: (Show a) =&gt; a -&gt; Integer -&gt; String        \nex112 = showSalary'\n</code></pre>\n"}], "owner": {"reputation": 1961, "user_id": 3114765, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KrkYp.jpg?s=128&g=1", "display_name": "Novak", "link": "https://stackoverflow.com/users/3114765/novak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "closed_date": 1543582648, "accepted_answer_id": 53555140, "answer_count": 1, "score": -1, "last_activity_date": 1543582658, "creation_date": 1543571330, "last_edit_date": 1543582658, "question_id": 53555009, "link": "https://stackoverflow.com/questions/53555009/haskell-throws-error-on-if-then-else-statement", "closed_reason": "Duplicate", "title": "Haskell throws error on if then else statement", "body": "<p>I have just started learning Haskell and I have a problem with loading a file in <code>ghci</code>. In a file called <code>Exercises.hs</code> I have some predefined exercises I should solve and this one is giving me an error:</p>\n\n<pre><code>showSalary amount bonus\n   | bonus /= 0 = \"Salary is \" ++ show amount ++ \", and a bonus \" ++ \n                  show bonus \n   | otherwise  = \"Salary is \" ++ show amount\n\n-- 1.2. Give a simpler definition of 'showSalary', using only one if-then-else construct. \n\nex112 = showSalary'\nshowSalary' amount bonus = \"Salary is \" ++ show amount ++ \n          (if bonus /= 0 then \", and a bonus \" ++ show bonus else \"\") \n</code></pre>\n\n<p>Now, the problem arises when I try to load this file into <code>ghci</code> like <code>ghci Exercises.hs</code>. The error message is following:</p>\n\n<pre><code>$ ghci Exercises\nGHCi, version 8.4.3: http://www.haskell.org/ghc/  :? for help\n[1 of 1] Compiling Exercises        ( Exercises.hs, interpreted )\n\nExercises.hs:31:9: error:\n    \u2022 Ambiguous type variable \u2018a0\u2019 arising from a use of \u2018showSalary'\u2019\n      prevents the constraint \u2018(Show a0)\u2019 from being solved.\n      Relevant bindings include\n        ex112 :: a0 -&gt; Integer -&gt; [Char] (bound at Exercises.hs:31:1)\n      Probable fix: use a type annotation to specify what \u2018a0\u2019 should be.\n      These potential instances exist:\n        instance (Show a, Show b) =&gt; Show (Either a b)\n          -- Defined in \u2018Data.Either\u2019\n        instance Show GeneralCategory -- Defined in \u2018GHC.Unicode\u2019\n        instance Show Ordering -- Defined in \u2018GHC.Show\u2019\n        ...plus 24 others\n        ...plus 49 instances involving out-of-scope types\n        (use -fprint-potential-instances to see them all)\n    \u2022 In the expression: showSalary'\n      In an equation for \u2018ex112\u2019: ex112 = showSalary'\n   |\n31 | ex112 = showSalary'\n   |         ^^^^^^^^^^^\nFailed, no modules loaded.\n</code></pre>\n\n<p>I don't know what is wrong with my code? When I comment out the first line <code>ex112 = showSalary'</code> the module is loaded and it runs without problem. Why is this error arising?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1543574249, "post_id": 53554687, "comment_id": 93976974, "body": "Can you not make like <code>type Dict k v = [(k,v)]</code> and then <code>instance Dictionary Dict where...</code>?"}, {"owner": {"reputation": 80, "user_id": 901918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5e23195ec352b69ba9e9065b83e862?s=128&d=identicon&r=PG", "display_name": "Andrew Cowie", "link": "https://stackoverflow.com/users/901918/andrew-cowie"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1543580673, "post_id": 53554687, "comment_id": 93980310, "body": "@Redu I did try that but the compiler saw right through my naive attempt at being cunning. A newtype is of course something you can make new instances for, but here I&#39;m trying to get the behaviour applied to lists."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543596828, "post_id": 53554687, "comment_id": 93989096, "body": "You need some sort of type-level composition, since what you really want is (abusing notation a bit) is an instance for <code>([] .) . (,)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 80, "user_id": 901918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5e23195ec352b69ba9e9065b83e862?s=128&d=identicon&r=PG", "display_name": "Andrew Cowie", "link": "https://stackoverflow.com/users/901918/andrew-cowie"}, "edited": false, "score": 0, "creation_date": 1543580886, "post_id": 53556313, "comment_id": 93980426, "body": "that&#39;s a <i>really</i> clever use of type famliies! In the typeclass declaration do the types have to be an actual <code>:: Type</code> or could they be <code>:: a</code>?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 80, "user_id": 901918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5e23195ec352b69ba9e9065b83e862?s=128&d=identicon&r=PG", "display_name": "Andrew Cowie", "link": "https://stackoverflow.com/users/901918/andrew-cowie"}, "edited": false, "score": 0, "creation_date": 1543581413, "post_id": 53556313, "comment_id": 93980723, "body": "If <code>Thing</code> expects things other than types that would be a fine thing to do. Any kind can go to the right of <code>::</code> in a type family declaration."}, {"owner": {"reputation": 80, "user_id": 901918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5e23195ec352b69ba9e9065b83e862?s=128&d=identicon&r=PG", "display_name": "Andrew Cowie", "link": "https://stackoverflow.com/users/901918/andrew-cowie"}, "edited": false, "score": 0, "creation_date": 1543655602, "post_id": 53556313, "comment_id": 94003582, "body": "Took me a bit of doing to adapt your suggestion to my code (mostly consisting of just doing what you said), but once I stopped faffing about it worked like a charm. Thanks!"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 5, "last_activity_date": 1543575947, "creation_date": 1543575947, "answer_id": 53556313, "question_id": 53554687, "link": "https://stackoverflow.com/questions/53554687/list-instances-for-higher-kinded-types/53556313#53556313", "title": "List Instances for higher-kinded types", "body": "<p>Maybe you can change your type class to be indexed by the fully applied dictionary type, instead of a type constructor <code>* -&gt; * -&gt;  *</code>:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, FlexibleInstances #-}\n\nclass Dictionary d where\n  type Key d :: Type\n  type Value d :: Type\n  f :: Thing (Key d) (Value d) -&gt; d\n\ninstance Dictionary [(k, v)] where\n  type Key [(k, v)] = k\n  type Value [(k, v)] = v\n  f = ...\n\ninstance Dictionary (Map k v) where\n  type Key (Map k v) = k\n  type Value (Map k v) = v\n  f = ...\n</code></pre>\n"}], "owner": {"reputation": 80, "user_id": 901918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5e23195ec352b69ba9e9065b83e862?s=128&d=identicon&r=PG", "display_name": "Andrew Cowie", "link": "https://stackoverflow.com/users/901918/andrew-cowie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 53556313, "answer_count": 1, "score": 0, "last_activity_date": 1543575947, "creation_date": 1543570109, "question_id": 53554687, "link": "https://stackoverflow.com/questions/53554687/list-instances-for-higher-kinded-types", "title": "List Instances for higher-kinded types", "body": "<p>If I have a MultiParamTypeClass, say <code>Dictionary a k v</code> (whatever, it's kind is <code>* -&gt; * -&gt; *</code>) and I would like to make an instance for lists (ie <code>[(k,v)]</code>), is that possible?</p>\n\n<p>I get that the compiler is complaining that that <code>[(k,v)]</code> is only kind <code>*</code> but is is possible to make this list (in this example an association list) behave like <code>Pair k v</code> but still being able to use Haskell's list type?</p>\n\n<p>In code,</p>\n\n<pre><code>class Dictionary a where\n    method :: Thing k v -&gt; a k v\n</code></pre>\n\n<p>I'd like to form</p>\n\n<pre><code>instance Dictionary [(k,v)] where\n    method = ...\n</code></pre>\n\n<p>Can that be done? I realize there is the OverloadedLists extension but I would like something that works on things more than literals.</p>\n"}, {"tags": ["haskell", "swagger", "servant"], "comments": [{"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1543578142, "post_id": 53554396, "comment_id": 93979002, "body": "what error messages do you get?"}, {"owner": {"reputation": 1575, "user_id": 56432, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/545172dff6374e4b8616aa9b56311ef5?s=128&d=identicon&r=PG", "display_name": "js.", "link": "https://stackoverflow.com/users/56432/js"}, "reply_to_user": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1543586779, "post_id": 53554396, "comment_id": 93983553, "body": "It does compile, but doesn&#39;t add a description."}], "answers": [{"tags": [], "owner": {"reputation": 1575, "user_id": 56432, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/545172dff6374e4b8616aa9b56311ef5?s=128&d=identicon&r=PG", "display_name": "js.", "link": "https://stackoverflow.com/users/56432/js"}, "is_accepted": true, "score": 1, "last_activity_date": 1543914641, "creation_date": 1543914641, "answer_id": 53609270, "question_id": 53554396, "link": "https://stackoverflow.com/questions/53554396/haskell-servant-swagger-description-for-multipart-upload/53609270#53609270", "title": "Haskell servant: Swagger description for MultiPart upload", "body": "<p>Went with this:</p>\n\n<pre><code>instance HasSwagger api =&gt;\n         HasSwagger (Files b :&gt; api) where\n  toSwagger _ = toSwagger (Proxy :: Proxy api)\n    &amp; addParam param\n    where\n      param = mempty\n        &amp; name .~ \"file\"\n        &amp; required ?~ True\n        &amp; description ?~ \"File to upload\"\n        &amp; schema .~ ParamOther (mempty\n            &amp; in_ .~ ParamFormData\n            &amp; paramSchema .~ (mempty &amp; type_ .~ SwaggerFile))\n</code></pre>\n"}], "owner": {"reputation": 1575, "user_id": 56432, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/545172dff6374e4b8616aa9b56311ef5?s=128&d=identicon&r=PG", "display_name": "js.", "link": "https://stackoverflow.com/users/56432/js"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 2, "accepted_answer_id": 53609270, "answer_count": 1, "score": 0, "last_activity_date": 1543914641, "creation_date": 1543568940, "last_edit_date": 1543586756, "question_id": 53554396, "link": "https://stackoverflow.com/questions/53554396/haskell-servant-swagger-description-for-multipart-upload", "title": "Haskell servant: Swagger description for MultiPart upload", "body": "<p>I am using servant-swagger to define a REST service and to generate a Swagger file from it. It uses an extended version of the <a href=\"https://github.com/haskell-servant/servant/issues/133\" rel=\"nofollow noreferrer\">File upload combinator</a> to define a client for an endpoint to add a file. I'd like to add a Swagger description to the upload API. I would be happy if I could add a parameter like</p>\n\n<pre><code>{\n  \"in\": \"formData\",\n  \"name\": \"file\",\n  \"type\": \"file\",\n  \"description\": \"File to upload\"\n}\n</code></pre>\n\n<p>to Swagger. Any idea how to do that? I was trying</p>\n\n<pre><code>instance HasSwagger api =&gt; HasSwagger (Files b :&gt; api) where\n  toSwagger _ = toSwagger (Proxy :: Proxy api)\n    &amp; allOperations.description .~ Just (Text.pack \"Files description\")\n</code></pre>\n\n<p>but that doesn't generate a description in the Swagger file (although it compiles).</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 1, "creation_date": 1543567544, "post_id": 53553855, "comment_id": 93973452, "body": "Also you can give <code>(ar,a,b,c,d,e,f,g,h,i,j,k,l,m)</code> alias like this <code>someIdentifier@(ar,a,b,c,d,e,f,g,h,i,j,k,l,m)</code> and use it instead of typing all the names again."}], "tags": [], "owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "is_accepted": true, "score": 4, "last_activity_date": 1543566536, "creation_date": 1543566536, "answer_id": 53553855, "question_id": 53553733, "link": "https://stackoverflow.com/questions/53553733/error-while-creating-a-custom-max-function-haskell/53553855#53553855", "title": "error while creating a custom max function haskell", "body": "<p>A couple of things to fix it:</p>\n\n<ol>\n<li>In your case for multi-item list, surround the argument with brackets i.e.</li>\n</ol>\n\n<p><code>max ((ar,a,b,c,d,e,f,g,h,i,j,k,l,m):ar1,a1,b1,c1,d1,e1,f1,g1,h1,i1,j1,k1,l1,m1):tail)</code></p>\n\n<ol start=\"2\">\n<li>When you make the recursive call, qualify your function name. Else, you will end up with ambiguity between <code>Prelude.max</code> and your own function. I'd recommend changing the function name as the easy solution.</li>\n</ol>\n\n<p>Taken together, you should see something like this:</p>\n\n<pre><code>max2 :: [(Int,Int,Int,Int,Int,Int,Int,Int,Int,Int,Int,Int,Int,Int)] -&gt; (Int,Int,Int,Int,Int,Int,Int,Int,Int,Int,Int,Int,Int,Int)\nmax2 []                               = (0,0,0,0,0,0,0,0,0,0,0,0,0,0)\nmax2 [(ar,a,b,c,d,e,f,g,h,i,j,k,l,m)] = (ar,a,b,c,d,e,f,g,h,i,j,k,l,m)\nmax2 ((ar,a,b,c,d,e,f,g,h,i,j,k,l,m):(ar1,a1,b1,c1,d1,e1,f1,g1,h1,i1,j1,k1,l1,m1):tail)\n    | ar &gt; ar1                       = max2 $ (ar,a,b,c,d,e,f,g,h,i,j,k,l,m):tail\n    | otherwise                      = max2 $ (ar1,a1,b1,c1,d1,e1,f1,g1,h1,i1,j1,k1,l1,m1):tail\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1543587223, "post_id": 53554410, "comment_id": 93983812, "body": "That type screams out for an alias as well :)  <code>type FourteenInts = (Int,Int,Int,Int,Int,Int,Int,Int,Int,Int,Int,Int,Int,Int)</code>."}, {"owner": {"reputation": 53, "user_id": 6943898, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-HEFwrWi0GYQ/AAAAAAAAAAI/AAAAAAAAACE/nzUQP2G9f5Y/photo.jpg?sz=128", "display_name": "Tamil Selvan", "link": "https://stackoverflow.com/users/6943898/tamil-selvan"}, "edited": false, "score": 0, "creation_date": 1543632661, "post_id": 53554410, "comment_id": 94000302, "body": "well this is used only once and there are 12ints , 10ints, 8ints and 6ints so thought of writing it directly :P"}], "tags": [], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "is_accepted": false, "score": 2, "last_activity_date": 1543569004, "creation_date": 1543569004, "answer_id": 53554410, "question_id": 53553733, "link": "https://stackoverflow.com/questions/53553733/error-while-creating-a-custom-max-function-haskell/53554410#53554410", "title": "error while creating a custom max function haskell", "body": "<p>You can use this code</p>\n\n<pre><code>import Data.List(maximumBy)\nimport Data.Ord(comparing)\n\nmax2 :: [(Int,Int,Int,Int,Int,Int,Int,Int,Int,Int,Int,Int,Int,Int)] -&gt; (Int,Int,Int,Int,Int,Int,Int,Int,Int,Int,Int,Int,Int,Int)\nmax2 [] = (0,0,0,0,0,0,0,0,0,0,0,0,0,0) \nmax2 x  = maximumBy cmp x   \n    where \n       cmp = comparing first\n       first (v,_,_,_,_,_,_,_,_,_,_,_,_,_) = v\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 6943898, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-HEFwrWi0GYQ/AAAAAAAAAAI/AAAAAAAAACE/nzUQP2G9f5Y/photo.jpg?sz=128", "display_name": "Tamil Selvan", "link": "https://stackoverflow.com/users/6943898/tamil-selvan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 53553855, "answer_count": 2, "score": -1, "last_activity_date": 1543569004, "creation_date": 1543565935, "question_id": 53553733, "link": "https://stackoverflow.com/questions/53553733/error-while-creating-a-custom-max-function-haskell", "title": "error while creating a custom max function haskell", "body": "<p>I was trying to create max function to compare a list of n dimensional coordinates based on the values of 1st coordinate</p>\n\n<pre><code>max :: [(Int,Int,Int,Int,Int,Int,Int,Int,Int,Int,Int,Int,Int,Int)] -&gt; (Int,Int,Int,Int,Int,Int,Int,Int,Int,Int,Int,Int,Int,Int)\nmax []                               = (0,0,0,0,0,0,0,0,0,0,0,0,0,0)\nmax [(ar,a,b,c,d,e,f,g,h,i,j,k,l,m)] = (ar,a,b,c,d,e,f,g,h,i,j,k,l,m)\nmax (ar,a,b,c,d,e,f,g,h,i,j,k,l,m):(ar1,a1,b1,c1,d1,e1,f1,g1,h1,i1,j1,k1,l1,m1):tail\n    | ar &gt; ar1                       = max (ar,a,b,c,d,e,f,g,h,i,j,k,l,m):tail\n    | otherwise                      = max (ar1,a1,b1,c1,d1,e1,f1,g1,h1,i1,j1,k1,l1,m1):tail\n</code></pre>\n\n<p>But I am getting error in 4th line:</p>\n\n<pre><code>1.hs:81:1: error: Parse error in pattern: max\n    |\n81 | max (ar,a,b,c,d,e,f,g,h,i,j,k,l,m): \n(ar1,a1,b1,c1,d1,e1,f1,g1,h1,i1,j1,k1,l1,m1):tail    | \n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n"}, {"tags": ["haskell", "sequence"], "comments": [{"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "edited": false, "score": 1, "creation_date": 1543565770, "post_id": 53553602, "comment_id": 93972787, "body": "Not working how? Compile error? Wrong answer?"}, {"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1543565857, "post_id": 53553602, "comment_id": 93972815, "body": "<code>collatzSeq</code> have infinite recursion."}, {"owner": {"reputation": 27, "user_id": 10726602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55269ad9d64c1ce9d7569ad8c981820c?s=128&d=identicon&r=PG&f=1", "display_name": "Sansa Stark", "link": "https://stackoverflow.com/users/10726602/sansa-stark"}, "edited": false, "score": 0, "creation_date": 1543565932, "post_id": 53553602, "comment_id": 93972842, "body": "Sorry, I get a compile error."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1543566317, "post_id": 53553602, "comment_id": 93972972, "body": "&quot;I got a compile error&quot;. Read it. We can&#39;t"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1543566913, "post_id": 53553602, "comment_id": 93973200, "body": "I would recommend breaking the problem up into smaller subproblems. 1. Given a single number, compute its Collatz sequence. 2. Using the function created at step 1, compute the length of a single Collatz sequence. 3. Given a range of numbers, compute lengths of the Collatz sequence of each number in the range using the function defined at step 2."}], "answers": [{"tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": true, "score": 0, "last_activity_date": 1543600423, "last_edit_date": 1543600423, "creation_date": 1543573747, "answer_id": 53555682, "question_id": 53553602, "link": "https://stackoverflow.com/questions/53553602/finding-the-collatz-sequences-of-a-range-of-numbers/53555682#53555682", "title": "Finding the Collatz Sequences of a range of numbers", "body": "<p>Well, There are some mistakes from your code. They are common mistake of those who are new to Haskell. I list them as below:</p>\n\n<blockquote>\n  <ol>\n  <li>Function application always be left-associativity and the highest precedence than all operators. </li>\n  </ol>\n</blockquote>\n\n<p>So, the code:</p>\n\n<pre><code>even x = collatzLength (x / 2) (x / 2):y\n</code></pre>\n\n<p>is equivalent to</p>\n\n<pre><code>even x = (collatzLength (x / 2) (x / 2)):y\n</code></pre>\n\n<p>It is obviously wrong, because the second argument of <code>collatzLength</code> is <code>[Int]</code>, not <code>Int</code></p>\n\n<blockquote>\n  <ol start=\"2\">\n  <li>(/) function or / operator cannot apply to <code>Int</code> type or <code>Num</code> class.</li>\n  </ol>\n</blockquote>\n\n<p>see <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:-47-\" rel=\"nofollow noreferrer\">(/)</a> is applied to data type which is an instance of <code>Fractional</code> only, but <code>Int</code> is not. In your code, the division only apply to even number, so it can use <code>quot</code> instead as:</p>\n\n<pre><code>even x = collatzLength (x `quot` 2) ((x `quot` 2):y)\n</code></pre>\n\n<blockquote>\n  <ol start=\"3\">\n  <li>Missing base case of recursive function.</li>\n  </ol>\n</blockquote>\n\n<p>As talex has mentioned in comment, the recursive function <code>collatzSeq</code> never end. Since it miss the base case to indicate how the function should end its computation. In your case, it is common the check the input list whether is empty or not as:</p>\n\n<pre><code>collatzSeq xs []    = xs\ncollatzSeq xs (x:s) = collatzSeq ((collatzLength x []):xs) s\n</code></pre>\n\n<p>Finally, it is better to provide the type signature for function to make the code clear and readable.</p>\n\n<p>Put them all together, the correction look like:</p>\n\n<pre><code>collatzSeq::[Int]-&gt;[Int]-&gt;[Int]\ncollatzSeq xs []    = xs\ncollatzSeq xs (x:s) = collatzSeq ((collatzLength x []):xs) s\n\ncollatzLength::Int-&gt;[Int]-&gt;Int\ncollatzLength x y\n    | x &lt; 2 = length (x:y)\n    | even x = collatzLength (x `quot` 2) ((x `quot` 2):y)\n    | otherwise = collatzLength (3 * x + 1) ((3 * x + 1):y)\n</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 10726602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55269ad9d64c1ce9d7569ad8c981820c?s=128&d=identicon&r=PG&f=1", "display_name": "Sansa Stark", "link": "https://stackoverflow.com/users/10726602/sansa-stark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 53555682, "answer_count": 1, "score": 1, "last_activity_date": 1543600423, "creation_date": 1543565378, "last_edit_date": 1543566006, "question_id": 53553602, "link": "https://stackoverflow.com/questions/53553602/finding-the-collatz-sequences-of-a-range-of-numbers", "title": "Finding the Collatz Sequences of a range of numbers", "body": "<p>I'm new to Haskell, and I'm trying to do Project Euler problem 14. I'm not done with the program yet, but the part I have done isn't working. This piece of code is supposed to print out the lengths of the Collatz Sequences of the numbers between 2 and 100. </p>\n\n<pre><code>main = print $ collatzSeq [] [2..100]\n\ncollatzSeq xs (x:s) = collatzSeq (collatzLength x []):xs s\n\ncollatzLength x y\n    | x &lt; 2 = length (x:y)\n    | even x = collatzLength (x / 2) (x / 2):y\n    | otherwise = collatzLength (3 * x + 1) (3 * x + 1):y\n</code></pre>\n\n<p>I've tried to modify the code in  various ways, and I believe the issue lies in the collatzLength function. But from what I have learned so far about Haskell, this function should work, but it doesn't and I don't get what I'm missing. I just get a compiletime error.</p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1543558314, "post_id": 53552152, "comment_id": 93969990, "body": "Doesn&#39;t redefining it work?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1543558549, "post_id": 53552152, "comment_id": 93970052, "body": "Just define one again."}, {"owner": {"reputation": 1375, "user_id": 6780389, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e0e4a17ac5c2908e5c892f6f8f87feb2?s=128&d=identicon&r=PG&f=1", "display_name": "saga", "link": "https://stackoverflow.com/users/6780389/saga"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1543558751, "post_id": 53552152, "comment_id": 93970110, "body": "@n.m. I&#39;ve edited the post to include an example."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 5, "creation_date": 1543559190, "post_id": 53552152, "comment_id": 93970243, "body": "AFAICT that&#39;s not how GHCi works. These are not &quot;overloads&quot; or &quot;specialisations&quot;. These are <i>complete</i> definitions, all three of them. You need to use either multiline definitions (:set +m) or braces to actually define a working factorial function."}], "answers": [{"comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 2, "creation_date": 1543560646, "post_id": 53552502, "comment_id": 93970805, "body": "Or you can just surround a multiline definition by <code>:{</code> <code>:}</code> on their own lines"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1543561193, "post_id": 53552502, "comment_id": 93970989, "body": "@bradrn yes, just added this"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1543583961, "post_id": 53552502, "comment_id": 93982067, "body": "In modern GHCi one can also omit the <code>let</code>, as the OP did (I think)."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1543594777, "post_id": 53552502, "comment_id": 93988128, "body": "@chi thanks, I didn&#39;t know that! Added to the answer."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1543594943, "post_id": 53552502, "comment_id": 93988219, "body": "with proper multiline entry, each new definition indeed overrides the previous one. what <i>does</i> happen though, is when we define <i>instances</i>, I think each new definition is added to a list, not overrides them. maybe that&#39;s what the OP meant."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1543596987, "post_id": 53552502, "comment_id": 93989163, "body": "@WillNess, to fix an instance definition you can either define the type again or define the class again. But by that point, you should probably have just opened up a <code>.hs</code> file."}], "tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": false, "score": 7, "last_activity_date": 1543595807, "last_edit_date": 1543595807, "creation_date": 1543559907, "answer_id": 53552502, "question_id": 53552152, "link": "https://stackoverflow.com/questions/53552152/deleting-a-function-defined-in-ghci/53552502#53552502", "title": "Deleting a function defined in GHCI", "body": "<pre><code>Prelude&gt; fact n = n * fact (n-1)\nPrelude&gt; fact 0 = 1\nPrelude&gt; fact 3\n*** Exception: &lt;interactive&gt;:6:1-10: Non-exhaustive patterns in function fact\nPrelude&gt; :q\nLeaving GHCi.\nbash&gt; ghci\nPrelude&gt; fact 0 = 1\nPrelude&gt; fact n = n * fact (n-1)\nPrelude&gt; fact 3\n*** Exception: stack overflow\n</code></pre>\n\n<p>What's going on?</p>\n\n<p>With GHC, the <em>first</em> definition would result in a stack overflow, and the second one would be correct.</p>\n\n<p>But in GHCi each binding <em>shadows</em> the previous one with the same name. In the example above, in each of the sessions each line that contains an equation for <code>fact</code> is a complete definition. When <code>fact 3</code> is called, only the second line is in effect, and the first one is invisible.</p>\n\n<p>So you cannot define functions the same way you do in normal GHC. </p>\n\n<p>To define the factorial function correctly you can use one of these three methods.</p>\n\n<ol>\n<li><p>A braced definition with no layout.  </p>\n\n<pre><code>Prelude&gt; let { fact 0 = 1; fact n = n * fact(n-1) }\n</code></pre></li>\n<li><p>A multiline definition with special GHCi braces.  </p>\n\n<pre><code>Prelude&gt; :{\nPrelude| let fact 0 = 1\nPrelude|     fact n = n * fact (n-1)\nPrelude| :}\n</code></pre></li>\n<li><p>A multiline definition with no special braces (needs <code>:set +m</code> which can be added to your <code>~/.ghci</code>)  </p>\n\n<pre><code>Prelude&gt; let fact 0 = 1 \nPtelude|     fact n = n * fact (n-1)\nPrelude|\nPrelude&gt;\n</code></pre></li>\n</ol>\n\n<p>See the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ghci.html#interactive-evaluation-at-the-prompt\" rel=\"nofollow noreferrer\">manual</a> for more imformation.</p>\n\n<p>Note I have used <code>let</code> in these definitions, because I'm used to them, but they are in fact not necessary in newer versions of GHCi.</p>\n"}], "owner": {"reputation": 1375, "user_id": 6780389, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e0e4a17ac5c2908e5c892f6f8f87feb2?s=128&d=identicon&r=PG&f=1", "display_name": "saga", "link": "https://stackoverflow.com/users/6780389/saga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 391, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1543595807, "creation_date": 1543558010, "last_edit_date": 1543558724, "question_id": 53552152, "link": "https://stackoverflow.com/questions/53552152/deleting-a-function-defined-in-ghci", "title": "Deleting a function defined in GHCI", "body": "<p>I'm starting to learn haskell and find myself having to restart the repl again and again because I defined incorrect specialization for a function and I don't know how to delete them.</p>\n\n<p>For example, let's say I made the error of putting the base case of <code>n == 0</code> after the general case for a factorial function:</p>\n\n<pre><code>fact n = n * fact(n-1)\nfact 0 = 1\n</code></pre>\n\n<p>This is obviously wrong, now if I repeat the general case, it will be added to the current list, giving me 3 overloads for <code>fact</code>. </p>\n\n<p>How do I delete the first case that I defined, or all the definitions of <code>fact</code> if possible. Is it possible to delete a function I defined in GHCI? If yes, how?</p>\n"}, {"tags": ["list", "haskell", "primes", "poker"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1543537894, "post_id": 53549469, "comment_id": 93965691, "body": "Do you have a good resource (a book) for learning haskell yet? You&#39;ll want to get up to speed on pattern matching. Something to get you started: <code>primeMapper (Left Two) = undefined ; primeMapper (Right Diamond) = undefined ; ...etc</code> . Also read up on the Enum class"}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1543584844, "post_id": 53549597, "comment_id": 93982512, "body": "More concise way: <code>[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59] !! case x of Left s -&gt; fromEnum s; Right r -&gt; 4 + fromEnum r</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543588510, "post_id": 53549597, "comment_id": 93984478, "body": "Even more concise: <code>([2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59]  !!) . either fromEnum ((+4) . fromEnum)</code> (although now we&#39;re pushing the limits of readability)."}], "tags": [], "owner": {"reputation": 75, "user_id": 5062106, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155789568465650/picture?type=large", "display_name": "Daniel Luci", "link": "https://stackoverflow.com/users/5062106/daniel-luci"}, "is_accepted": false, "score": 2, "last_activity_date": 1543537937, "creation_date": 1543537937, "answer_id": 53549597, "question_id": 53549469, "link": "https://stackoverflow.com/questions/53549469/how-do-i-map-each-value-from-one-list-to-another-haskell/53549597#53549597", "title": "How do I map each value from one list to another? (Haskell)", "body": "<p>Ultimately I solved what I am trying to do by hand as so:</p>\n\n<pre><code>primeMapper :: Either Suit Rank -&gt; Int\nprimeMapper x = case x of\n        Left Diamond -&gt; 2\n        Left Club -&gt; 3\n        Left Heart -&gt; 5\n        Left Spade -&gt; 7\n        Right Two -&gt; 11\n        Right Three -&gt; 13\n        Right Four -&gt; 17\n        Right Five -&gt; 19\n        Right Six -&gt; 23\n        Right Seven -&gt; 29\n        Right Eight -&gt; 31\n        Right Nine -&gt; 37\n        Right Ten -&gt; 41\n        Right Jack -&gt; 43\n        Right Queen -&gt; 47\n        Right King -&gt; 53\n        Right Ace -&gt; 59\n</code></pre>\n\n<p>... was there a more concise way to do this rather than write each case out by hand?</p>\n"}, {"tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": false, "score": 2, "last_activity_date": 1543540866, "creation_date": 1543540866, "answer_id": 53549905, "question_id": 53549469, "link": "https://stackoverflow.com/questions/53549469/how-do-i-map-each-value-from-one-list-to-another-haskell/53549905#53549905", "title": "How do I map each value from one list to another? (Haskell)", "body": "<p>Your solution using pattern matching is best, though I would prefer</p>\n\n<pre><code>primeMapper :: Either Suit Rank -&gt; Int\nprimeMapper (Left Diamond) = 2\nprimeMapper (Left Club)    = 3\n...\n</code></pre>\n\n<p>rather than your long <code>case</code> expression.</p>\n\n<p>However you could also use <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:lookup\" rel=\"nofollow noreferrer\"><code>lookup :: Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b</code></a></p>\n\n<pre><code>import Data.Maybe (fromJust)\n\nprimeMapper :: Either Suit Rank -&gt; Int\nprimeMapper = fromJust . flip lookup zippedPrimes\n  where\n  zippedPrimes = zip suitranks primes\n  suitranks    = fmap Left suits ++ fmap Right ranks :: [Either Suit Rank]\n  suits        = fromEnum minBound\n  ranks        = fromEnum minBound\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1543544029, "last_edit_date": 1543544029, "creation_date": 1543543659, "answer_id": 53550226, "question_id": 53549469, "link": "https://stackoverflow.com/questions/53549469/how-do-i-map-each-value-from-one-list-to-another-haskell/53550226#53550226", "title": "How do I map each value from one list to another? (Haskell)", "body": "<p>Depending on what you plan to use this for, you may not need to use primes or prime factorizations at all; you can get fast conversion to and from plain numbers just by picking one or the other of the suit or rank for a base conversion. Here I'll pick suit -- there are four suits, so take the first digit in base 4 as the suit and the remaining digits as the rank.</p>\n\n<pre><code>encode :: (Suit, Rank) -&gt; Int\nencode (s, r) = fromEnum s + 4 * fromEnum r\n\ndecode :: Int -&gt; (Suit, Rank)\ndecode n = (toEnum s, toEnum r) where (r, s) = n `quotRem` 4\n</code></pre>\n\n<p>You can verify in ghci that this gives a unique number to each card:</p>\n\n<pre><code>&gt; [encode (s, r) | r &lt;- [minBound .. maxBound], s &lt;- [minBound .. maxBound]]\n[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51]\n</code></pre>\n\n<p>And that they decode appropriately:</p>\n\n<pre><code>&gt; map decode [0..51] == [(s, r) | r &lt;- [minBound .. maxBound], s &lt;- [minBound .. maxBound]]\nTrue\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "is_accepted": false, "score": 0, "last_activity_date": 1543805260, "last_edit_date": 1543805260, "creation_date": 1543600131, "answer_id": 53562471, "question_id": 53549469, "link": "https://stackoverflow.com/questions/53549469/how-do-i-map-each-value-from-one-list-to-another-haskell/53562471#53562471", "title": "How do I map each value from one list to another? (Haskell)", "body": "<p>You can adapt some of this I hope.</p>\n\n<pre><code>no2s3s5s = \\n -&gt; take n $ scanl (\\b a -&gt; a+b) 11 $ cycle [2,4,2,4,6,2,6,4]\nrnk = filter (/=49) $ no2s3s5s 14  \nstv = [2,3,5,7]\n_deck = [ b*v | b &lt;- stv, v &lt;- rnk]\n_Dia = take 13.drop (0*13) $ _deck\n_Clb = take 13.drop (1*13) $ _deck\n_Hrt = take 13.drop (2*13) $ _deck\n_Spd = take 13.drop (3*13) $ _deck\n</code></pre>\n\n<p><code>_Dia</code></p>\n\n<p>[22,26,34,38,46,58,62,74,82,86,94,106,118]</p>\n\n<p><code>_Clb</code></p>\n\n<p>[33,39,51,57,69,87,93,111,123,129,141,159,177]</p>\n\n<p><code>_Hrt</code></p>\n\n<p>[55,65,85,95,115,145,155,185,205,215,235,265,295]</p>\n\n<p><code>_Spd</code></p>\n\n<p>[77,91,119,133,161,203,217,259,287,301,329,371,413]</p>\n\n<p><code>_deck</code></p>\n\n<p>[22,26,34,38,46,58,62,74,82,86,94,106,118,33,39,51,57,69,87,93,111,123,129,141,159,177,55,65,85,95,115,145,155,185,205,215,235,265,295,77,91,119,133,161,203,217,259,287,301,329,371,413]</p>\n\n<p><code>length _deck</code></p>\n\n<p>52</p>\n\n<p>Your multiples (_deck) are all unique.\nI normally use <code>no2s3s5s</code> with a computed (limited) factor list and the mod function to generate a long prime list.</p>\n"}], "owner": {"reputation": 75, "user_id": 5062106, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155789568465650/picture?type=large", "display_name": "Daniel Luci", "link": "https://stackoverflow.com/users/5062106/daniel-luci"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "answer_count": 4, "score": -1, "last_activity_date": 1543805260, "creation_date": 1543536933, "question_id": 53549469, "link": "https://stackoverflow.com/questions/53549469/how-do-i-map-each-value-from-one-list-to-another-haskell", "title": "How do I map each value from one list to another? (Haskell)", "body": "<p>This is the code I have so far:</p>\n\n<pre><code>data Suit = Diamond | Club | Heart | Spade\n  deriving (Read, Enum, Eq, Bounded)\n\ndata Rank = Two | Three | Four\n     | Five | Six | Seven | Eight | Nine | Ten \n     | Jack | Queen | King | Ace\n  deriving (Read, Enum, Eq, Ord, Bounded)\n</code></pre>\n\n<p>and I am trying to map each value, either Rank or Suit to a unique prime number.</p>\n\n<pre><code>primeMapper :: Either Rank Suit -&gt; Int\n</code></pre>\n\n<p>should be the final function and I want to iterate over each Suit and set it to the first four primes:</p>\n\n<pre><code>primeMapper [Diamond .. Spade] = [2,3,5,7]\n</code></pre>\n\n<p>and each Rank equal to the rest of the primes up until the 17th:</p>\n\n<pre><code>primeMapper [Two .. Ace] = drop 4 . take 17 $ primes\n</code></pre>\n\n<p>assuming I have a generating function called primes.</p>\n\n<p>This code, however throws errors obviously because it generates a list from a list. How can I achieve what I am trying to do? Let me know if I can explain it better. </p>\n\n<p>The ultimate goal is to have a hash table that gives unique IDs to each cards based on prime factors, and then generate prime factorization and use modulo to quickly compare poker hands.</p>\n"}, {"tags": ["haskell", "recursion-schemes"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1543536478, "post_id": 53549105, "comment_id": 93965350, "body": "What does it mean for them to be equivalent in power, if they work on different types? The only meaning I could understand would be &quot;hylo can be implemented in terms of hyloM, and vice versa, using some translation between the types involved&quot;."}, {"owner": {"reputation": 2244, "user_id": 29408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f7af9c8034d5070fb2e8565c79c604b7?s=128&d=identicon&r=PG", "display_name": "Julian Birch", "link": "https://stackoverflow.com/users/29408/julian-birch"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1543665996, "post_id": 53549105, "comment_id": 94005783, "body": "Exactly that. I think the answer given plus the comments exhibits the &quot;nearly isomorphism&quot;. It would be nice if they were exactly isomorphic, but I think hyloM needs modification for that."}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1543544271, "post_id": 53550252, "comment_id": 93966932, "body": "I think the converse is either trivial (making <code>m ~ Identity</code>, if you don&#39;t mind adding the <code>Traversable</code> constraint) or impossible (if you do mind adding the constraint)."}, {"owner": {"reputation": 2244, "user_id": 29408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f7af9c8034d5070fb2e8565c79c604b7?s=128&d=identicon&r=PG", "display_name": "Julian Birch", "link": "https://stackoverflow.com/users/29408/julian-birch"}, "edited": false, "score": 1, "creation_date": 1543665859, "post_id": 53550252, "comment_id": 94005748, "body": "Yeah, if you parameterise by the traversal function it&#39;s easy enough to swap f Identity to Identity f though, so maybe it&#39;s only equivalent to &quot;gHyloM&quot;"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 3, "last_activity_date": 1543543866, "creation_date": 1543543866, "answer_id": 53550252, "question_id": 53549105, "link": "https://stackoverflow.com/questions/53549105/exhibiting-the-relationship-between-hylo-and-hylom/53550252#53550252", "title": "Exhibiting the relationship between hylo and hyloM", "body": "<p>You can define <code>hyloM</code> using <code>hylo</code> by instantiating <code>f = Compose m g</code>. </p>\n\n<pre><code>hyloM' :: (Traversable g, Monad m) =&gt; (g b -&gt; m b) -&gt; (a -&gt; m (g a)) -&gt; a -&gt; m b\nhyloM' f g = hylo (\\(Compose mg) -&gt; mg &gt;&gt;= sequence &gt;&gt;= f) (\\a -&gt; Compose (g a))\n</code></pre>\n\n<p>I'm not sure about the converse.</p>\n"}], "owner": {"reputation": 2244, "user_id": 29408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f7af9c8034d5070fb2e8565c79c604b7?s=128&d=identicon&r=PG", "display_name": "Julian Birch", "link": "https://stackoverflow.com/users/29408/julian-birch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 53550252, "answer_count": 1, "score": 1, "last_activity_date": 1543543866, "creation_date": 1543534143, "question_id": 53549105, "link": "https://stackoverflow.com/questions/53549105/exhibiting-the-relationship-between-hylo-and-hylom", "title": "Exhibiting the relationship between hylo and hyloM", "body": "<p>I'm told the following functions are equivalent in power</p>\n\n<pre><code>hylo :: Functor f =&gt; (f b -&gt; b) -&gt; (a -&gt; f a) -&gt; a -&gt; b\nhylo f g = h where h = f . fmap h . g\n\nhyloM :: (Traversable g, Monad m) =&gt; (g b -&gt; m b) -&gt; (a -&gt; m (g a)) -&gt; a -&gt; m b\nhyloM f g = h where h = f &lt;=&lt; traverse h &lt;=&lt; g\n</code></pre>\n\n<p>For the life of me, though, I can't figure out how to demonstrate this. Setting Monad to Identity in hyloM gets pretty much the right thing, but g is <code>Traversable</code> not <code>Functor</code>, and I have tried a number of approaches to go from hylo to hyloM with no success.</p>\n\n<p>Are these isomorphic, or at least similar in power? If so, how do I evidence that?</p>\n"}, {"tags": ["haskell", "typeclass", "type-families", "constraint-kinds", "undecidable-instances"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1543524941, "post_id": 53546857, "comment_id": 93961441, "body": "Can you show us the real example? I imagine its structure is more interesting than this."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 5, "last_activity_date": 1543529978, "last_edit_date": 1543529978, "creation_date": 1543524893, "answer_id": 53547425, "question_id": 53546857, "link": "https://stackoverflow.com/questions/53546857/ghc-stuck-due-to-undecidablesuperclasses-expected-behaviour-or-bug/53547425#53547425", "title": "GHC stuck due to UndecidableSuperClasses - expected behaviour or bug?", "body": "<p><code>UndecidableSuperClasses</code> does <em>not</em> make instance resolution lazy. The compiler will still expand superclass constraints as far as possible. I believe that the fields in instance dictionaries that point to the superclass dictionaries are <em>strict</em>, and GHC actually pins them down at compile time. This is in contrast to <code>UndecidableInstances</code>, which allows <em>instance constraints</em> to be treated (a bit) lazily.</p>\n\n<pre><code>deriving instance Show (f (Fix f)) =&gt; Show (Fix f)\n</code></pre>\n\n<p>will work just fine. When resolving an instance for, e.g., <code>Show (Fix Maybe)</code>), GHC will see that it needs <code>Show (Maybe (Fix Maybe))</code>. It then sees it needs <code>Show (Fix Maybe)</code> (which it's currently resolving) and accept that thanks to <code>UndecidableInstances</code>.</p>\n\n<p>All <code>UndecidableSuperClases</code> does is disable the checks that guarantee that expansion won't loop. See the bit near the beginning of <a href=\"https://www.youtube.com/watch?time_continue=171&amp;v=ZL9ehIJhk98\" rel=\"nofollow noreferrer\">Ed Kmett's talk</a> where he describes the process \"reaching a fixed point\".</p>\n\n<p>Consider a working example (ripped from <code>Data.Constraint.Forall</code>):</p>\n\n<pre><code>type family Skolem (p :: k -&gt; Constraint) :: k\nclass p (Skolem p) =&gt; Forall (p :: k -&gt; Constraint)\n</code></pre>\n\n<p>GHC only accepts this with <code>UndecidableSuperclasses</code>. Why? Because it doesn't know anything about what that constraint might mean. As far as it knows, it could be the case that <code>p (Skolem p)</code> will reduce to <code>Forall p</code>. And that could actually happen!</p>\n\n<pre><code>class Forall P =&gt; P x\n\n-- This definition loops the type checker\nfoo :: P x =&gt; x\nfoo = undefined\n</code></pre>\n"}], "owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 2, "accepted_answer_id": 53547425, "answer_count": 1, "score": 2, "last_activity_date": 1543529978, "creation_date": 1543522449, "question_id": 53546857, "link": "https://stackoverflow.com/questions/53546857/ghc-stuck-due-to-undecidablesuperclasses-expected-behaviour-or-bug", "title": "GHC stuck due to UndecidableSuperClasses - expected behaviour or bug?", "body": "<p>The following snippet makes GHC (checked with 8.6.2 &amp; 8.4.4) stuck during compilation:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE UndecidableInstances #-}\n{-# LANGUAGE UndecidableSuperClasses #-}\n\nimport GHC.Exts (Constraint)\n\ndata T = T\n\ntype family F t (c :: * -&gt; Constraint) :: Constraint\ntype instance F T c = c T\n\nclass F t C =&gt; C t where\n\nt :: C T =&gt; t\nt = undefined\n</code></pre>\n\n<p>I think that it gets stuck because for <code>t</code> GHC tries to find <code>C T</code>, which leads to <code>F T C</code> which expands via type family <code>F</code> back to <code>C T</code>, which is what it was looking for (infinite loop).</p>\n\n<p>I suppose that theoretically GHC could tell that it reached its quest for <code>C T</code> from itself and that anything that depends on itself can work fine recursively, or am I misunderstanding something?</p>\n\n<p>Side note: in the real example where I stumbled upon this behaviour I was able to achieve what I wanted without the compiler being stuck by replacing <code>UndecidableSuperClasses</code> with <a href=\"https://hackage.haskell.org/package/constraints-0.10.1/docs/Data-Constraint.html#t:Dict\" rel=\"nofollow noreferrer\"><code>Data.Constraint.Dict</code></a> instead.</p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": true, "score": 1, "last_activity_date": 1543525939, "creation_date": 1543525939, "answer_id": 53547671, "question_id": 53546699, "link": "https://stackoverflow.com/questions/53546699/building-contravariant-using-stack-leads-to-constraint-error-about-not-being-abl/53547671#53547671", "title": "Building contravariant using Stack leads to constraint error about not being able to deduce Contravariant", "body": "<p>It's not you - released packages are not yet caught up for base-4.12.</p>\n\n<p>Now that the <code>Contravariant</code> class is in <code>base</code>, the instance for <code>Backwards</code> should move to <code>transformers</code>, where the latter is defined.  There's <a href=\"https://hub.darcs.net/ross/transformers/patch/b00658faa4578b0eb578cf158c75185c1c0ec697\" rel=\"nofollow noreferrer\">a patch that adds the instances</a> but I don't think it's been released to Hackage.</p>\n\n<p>In your shoes, I would:</p>\n\n<ol>\n<li>checkout the darcs repo locally</li>\n<li>add the local checkout as an <code>extra-dep</code></li>\n<li>bug the maintainers to release <code>transformers</code></li>\n</ol>\n"}], "owner": {"reputation": 85, "user_id": 4106574, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b8bef30d5feb5acfe810f90ced7ccd?s=128&d=identicon&r=PG", "display_name": "tailcalled", "link": "https://stackoverflow.com/users/4106574/tailcalled"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 53547671, "answer_count": 1, "score": 0, "last_activity_date": 1552597856, "creation_date": 1543521721, "question_id": 53546699, "link": "https://stackoverflow.com/questions/53546699/building-contravariant-using-stack-leads-to-constraint-error-about-not-being-abl", "title": "Building contravariant using Stack leads to constraint error about not being able to deduce Contravariant", "body": "<p>When building my project, I get errors like the following:</p>\n\n<pre><code>   /tmp/stack19408/contravariant-1.5/src/Data/Functor/Contravariant/Divisible.hs:233:10: error:\n        \u2022 Could not deduce (Contravariant (Backwards f))\n            arising from the superclasses of an instance declaration\n          from the context: Divisible f\n            bound by the instance declaration\n            at src/Data/Functor/Contravariant/Divisible.hs:233:10-47\n        \u2022 In the instance declaration for \u2018Divisible (Backwards f)\u2019\n        |\n    233 | instance Divisible f =&gt; Divisible (Backwards f) where\n        |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>I can't figure out exactly what is going on here, or whether the mistake is on my end or a problem with the libraries involved. Did I do something wrong?</p>\n\n<hr>\n\n<p>I've tried to create the smallest project possible that leads to this problem. In a blank Stack project, change the resolver to <code>ghc-8.6.2</code> and add the dependencies:</p>\n\n<pre><code>extra-deps:\n- contravariant-1.5\n- StateVar-1.1.1.1\n- base-4.12.0.0\n- array-0.5.2.0\n</code></pre>\n\n<p>Add <code>contravariant</code> to <code>dependencies</code> in <code>package.yaml</code>, and import <code>Data.Functor.Contravariant.Divisible</code> in <code>Lib.hs</code>. This led to compile errors when running <code>stack build</code>.</p>\n"}, {"tags": ["haskell", "opengl"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1543511457, "post_id": 53544157, "comment_id": 93955138, "body": "I think you need to disable the depth buffer, and draw the polygons back to front.  Blending is a pain."}, {"owner": {"reputation": 6058, "user_id": 3871028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfbe44ff5c56628e85683c8918602c96?s=128&d=identicon&r=PG&f=1", "display_name": "Ripi2", "link": "https://stackoverflow.com/users/3871028/ripi2"}, "edited": false, "score": 0, "creation_date": 1543512212, "post_id": 53544157, "comment_id": 93955494, "body": "Do you use face culling?"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1543512764, "post_id": 53544157, "comment_id": 93955758, "body": "@luqui Sorry, what do you mean by &quot;drawing back to front&quot; ?"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 6058, "user_id": 3871028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfbe44ff5c56628e85683c8918602c96?s=128&d=identicon&r=PG&f=1", "display_name": "Ripi2", "link": "https://stackoverflow.com/users/3871028/ripi2"}, "edited": false, "score": 0, "creation_date": 1543512810, "post_id": 53544157, "comment_id": 93955784, "body": "@Ripi2 I have tried the face culling, reversing the order of the vertices, negating the normals... no way :-("}, {"owner": {"reputation": 6058, "user_id": 3871028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfbe44ff5c56628e85683c8918602c96?s=128&d=identicon&r=PG&f=1", "display_name": "Ripi2", "link": "https://stackoverflow.com/users/3871028/ripi2"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1543512922, "post_id": 53544157, "comment_id": 93955840, "body": "If culling is disabled then it seems a depth issue, like @luqui said. &quot;back to front&quot; means &quot;far objects are drawn first&quot;"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1543513324, "post_id": 53544157, "comment_id": 93956028, "body": "Ah yes, this works if I draw the edges before drawing the facets! I didn&#39;t know the order has an importance :-/"}, {"owner": {"reputation": 6058, "user_id": 3871028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfbe44ff5c56628e85683c8918602c96?s=128&d=identicon&r=PG&f=1", "display_name": "Ripi2", "link": "https://stackoverflow.com/users/3871028/ripi2"}, "edited": false, "score": 0, "creation_date": 1543513912, "post_id": 53544157, "comment_id": 93956325, "body": "With depth testing enabled the new nearer fragment replaces the old further one."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1543514088, "post_id": 53544157, "comment_id": 93956430, "body": "Why the downvotes ? The question is not clear ? Or not legit ?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1543514360, "post_id": 53544157, "comment_id": 93956558, "body": "@St&#233;phaneLaurent my guess is you have not provided enough information.  E.g. the code to draw the polygons, what windowing library, etc.  But haskell tag is getting some random question hate lately though, too, I don&#39;t get it."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1543514518, "post_id": 53544157, "comment_id": 93956638, "body": "@luqui Hmm ok. But they could ask for more information instead of downvoting, the question is editable :-/ Thanks for your help !"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1543516815, "post_id": 53544157, "comment_id": 93957749, "body": "Don&#39;t worry too much for the downvotes, as long as you also have upvotes: an upvote is +10 rep and a downvote is only -2 rep. Anyway: the drawing order usually does not matter, since the z-buffer (depth buffer) handles that in hardware for us. Essentially, the color of each pixel becomes the color of the point closer to the camera, no matter what order we choose. When mixing colors of multiple surfaces (&quot;blending&quot;), it&#39;s more complicated, and the z-buffer (AFAICS) does not help so much, and order matters again."}, {"owner": {"reputation": 764, "user_id": 7598582, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-EeiMh_v63wE/AAAAAAAAAAI/AAAAAAAABSo/N4ZLgGMTlkk/photo.jpg?sz=128", "display_name": "Paritosh Kulkarni", "link": "https://stackoverflow.com/users/7598582/paritosh-kulkarni"}, "edited": false, "score": 0, "creation_date": 1543631834, "post_id": 53544157, "comment_id": 94000217, "body": "Order of drawing is only important if you are enabling depth test as blending will be applied to fragments those pass depth test. So if you draw fragment which is in front then draw fragment in behind it will lose depth test and will give wrong blending results . So if enabling depth test draw surfaces from behind to front so all surfaces pass z test and will go to blending. Else just disable blending and then use appropriate blend func and draw."}], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 77, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1543511123, "creation_date": 1543511123, "question_id": 53544157, "link": "https://stackoverflow.com/questions/53544157/transparency-not-working-as-desired-with-haskell-opengl", "title": "Transparency not working as desired with Haskell OpenGL", "body": "<p>I've done this polyhedron with Haskell OpenGL:</p>\n\n<p><a href=\"https://i.stack.imgur.com/Rm5yg.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Rm5yg.png\" alt=\"enter image description here\"></a></p>\n\n<p>The sides of the polyhedron are transparent:</p>\n\n<pre><code>renderPrimitive Quads $ do\n  materialDiffuse Front $= col\n  ......\n</code></pre>\n\n<p>where <code>col</code> is a color with \"a\" component equal to <code>0.2</code>.</p>\n\n<p>And in the <code>main</code> function, the blending is enabled:</p>\n\n<pre><code>blend $= Enabled\nblendFunc $= (SrcAlpha, OneMinusSrcAlpha)\n</code></pre>\n\n<p>One can see that the sides are indeed transparent. However the edges of the polyhedron do not appear in the interior. Why that? I have tried numerous <code>initialDisplayMode</code>, such as:</p>\n\n<pre><code>initialDisplayMode $= [RGBAMode, DoubleBuffered, WithDepthBuffer, WithAlphaComponent]\n</code></pre>\n\n<p>I have these material colors and light colors:</p>\n\n<pre><code>clearColor $= Color4 0 0 0 0\nmaterialSpecular Front $= white\nmaterialShininess Front $= 50\nlighting $= Enabled\nlight (Light 0) $= Enabled\nposition (Light 0) $= Vertex4 0 0 100 1\nambient (Light 0) $= white\ndiffuse (Light 0) $= white\nspecular (Light 0) $= white\n</code></pre>\n"}, {"tags": ["list", "haskell", "list-comprehension", "applicative"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543521726, "post_id": 53541300, "comment_id": 93959979, "body": "&quot;applicatively&quot;, not &quot;appreciatively&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "edited": false, "score": 0, "creation_date": 1543505837, "post_id": 53541374, "comment_id": 93951955, "body": "Wouldn&#39;t the final list have different types anyways? Or did you mean apply to <code>[Ct]</code> separately? Along with printing them I also want to use <code>sortBy (comparing someFunction)</code> on the final result. Would that mean I&#39;ll have to take the complicated path you mentioned in your 3rd and 4th para?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "edited": false, "score": 0, "creation_date": 1543507335, "post_id": 53541374, "comment_id": 93952868, "body": "@atis What is &quot;the final list&quot; you refer to? You absolutely do <i>not</i> have to take any complicated path; you can and should take the path described in the first paragraph. I included the other two only for completeness and somewhat under duress."}, {"owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "edited": false, "score": 0, "creation_date": 1543507912, "post_id": 53541374, "comment_id": 93953210, "body": "My thought processes was to have a list of tuples like the one in the question with all values of all sorts of types and sort the list of tuples by each tuple&#39;s second and third value, which would be <code>Double</code>. That&#39;s why I think I need the outputs connected somehow!  The <code>String</code> is sort of a name for the whole tuple of data."}, {"owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "edited": false, "score": 0, "creation_date": 1543508241, "post_id": 53541374, "comment_id": 93953355, "body": "By final list I mean the result of <code>[doubleF1, doubleF2] &lt;*&gt; [stringF1, stringF2] &lt;*&gt; [v1, v2 .. vn]</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "edited": false, "score": 0, "creation_date": 1543508893, "post_id": 53541374, "comment_id": 93953755, "body": "@atis I think you have tried to abstract your question away from the details so that it is of more general interest, which is admirable, but the abstraction is leaking. Make your question concrete enough that it shows what you actually need."}, {"owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "edited": false, "score": 0, "creation_date": 1543509737, "post_id": 53541374, "comment_id": 93954228, "body": "Alright, I&#39;ll try to work it on my own and if I&#39;m still struggling I&#39;ll make a new question thread. Thanks for the help!"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1543502400, "last_edit_date": 1543502400, "creation_date": 1543502092, "answer_id": 53541374, "question_id": 53541300, "link": "https://stackoverflow.com/questions/53541300/haskell-is-it-possible-to-define-a-datatype-that-can-encapsulate-maybe-string/53541374#53541374", "title": "Haskell: Is it possible to define a datatype that can encapsulate Maybe, String &amp; Double with ability to apply value applicatively?", "body": "<p>Make three lists, of types <code>[Ct -&gt; String]</code>, <code>[Ct -&gt; Double]</code>, and <code>[Ct -&gt; Maybe Double]</code>. Each may be applied to your <code>[Ct]</code> applicatively.</p>\n\n<p>Two alternative solutions come to mind and are immediately discarded: a fresh data type which can hold any of a <code>String</code>, a <code>Double</code>, or a <code>Maybe Double</code>; or existentials, which are essentially just a more uniform packaging of the same idea. Idea one would look like this:</p>\n\n<pre><code>data Weird\n    = It'sAString String\n    | It'sADouble Double\n    | It'sAMaybe (Maybe Double)\n</code></pre>\n\n<p>You would then use e.g. <code>[It'sAString . f1, It'sADouble . f2, It'sAMaybe . f3]</code>, which has type <code>[Ct -&gt; Weird]</code> and can be used applicatively. To me this already seems like more machinery than it's worth, especially considering that your consumers must now be prepared to handle any of these three constructors.</p>\n\n<p>The existential way would be even worse: you'd want to identify (or create) a class which covers all the things you could want to do with a <code>String</code>, a <code>Double</code>, or a <code>Maybe Double</code>, and which sensibly unifies all three types, first. Ouch. There's waaay too much stuff you could want to do for that to make sense.</p>\n"}], "owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 53541374, "answer_count": 1, "score": 0, "last_activity_date": 1543551673, "creation_date": 1543501857, "last_edit_date": 1543551673, "question_id": 53541300, "link": "https://stackoverflow.com/questions/53541300/haskell-is-it-possible-to-define-a-datatype-that-can-encapsulate-maybe-string", "title": "Haskell: Is it possible to define a datatype that can encapsulate Maybe, String &amp; Double with ability to apply value applicatively?", "body": "<p>I'm a Haskell beginner and while building a simple project I came across this odd problem.</p>\n\n<p>I have a list of functions e.g.</p>\n\n<pre><code>[f1, f2, f3 ... fn] \n</code></pre>\n\n<p>Which doesn't work because they don't have same type. Some have <code>Ct -&gt; String</code>, <code>Ct -&gt; Double</code> and <code>Ct -&gt; Maybe Double</code></p>\n\n<p>What I wanted to do was apply the functions applicatively like this</p>\n\n<pre><code>[f1, f2, f3 ... fn] &lt;*&gt; [v1, v2, v3 ... vn] \n</code></pre>\n\n<p>where all <code>v</code>s have same type <code>Ct</code></p>\n\n<p>The problem can be easily solved by just using list comprehension with tuples like</p>\n\n<p><code>[(f1 a, f2 a, f3 a ... fn a) | a &lt;- [v1, v2, v3 ... vn]]</code></p>\n\n<p>which would look something like this </p>\n\n<pre><code>[ (f1 v1, f2 v1, f3 v1, f4, v1 ... fn v1)\n\n, (f2 v1, f2 v2, f3 v2, f4 v2 ... fn v2)\n\n, ...\n\n, (fn v1, fn v2, fn v3, fn v4 ... fn vn)\n\n]\n</code></pre>\n\n<p>but <code>n</code> is quite a large number where you have to define a separate instance of show to say print them on terminal, which is one of the thing I want to do.</p>\n\n<p>I know a few ways of overcoming this problem, one is by using tuples but dividing results into smaller chunks but I was wondering, is there a way of defining a datatype that can encapsulate multiple datatypes and still retain 'idiomaticity' and readable code of applicative style?</p>\n"}, {"tags": ["haskell", "io"], "comments": [{"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 1, "creation_date": 1543496862, "post_id": 53539640, "comment_id": 93946535, "body": "use <code>mapM_ print (words x)</code> instead"}, {"owner": {"reputation": 3, "user_id": 10722646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a5ad276872bc8a0429e9a023741d12f?s=128&d=identicon&r=PG&f=1", "display_name": "Zach Snyder", "link": "https://stackoverflow.com/users/10722646/zach-snyder"}, "reply_to_user": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1543497929, "post_id": 53539640, "comment_id": 93947144, "body": "Is there a way to get rid of the quotation marks?"}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1543498191, "post_id": 53539640, "comment_id": 93947294, "body": "to remove the quotation marks, just <code>words $ filter (&#47;=&#39;&quot;&#39;) x</code>"}, {"owner": {"reputation": 3, "user_id": 10722646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a5ad276872bc8a0429e9a023741d12f?s=128&d=identicon&r=PG&f=1", "display_name": "Zach Snyder", "link": "https://stackoverflow.com/users/10722646/zach-snyder"}, "reply_to_user": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1543498612, "post_id": 53539640, "comment_id": 93947545, "body": "I tried that but it doesn&#39;t seem to remove the quotations. Since the quotations aren&#39;t part of the actual string being input, it seems to be something added on when the program is printing out the output."}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1543501100, "post_id": 53539640, "comment_id": 93948991, "body": "Yes, it is the output format of a String."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1543501850, "post_id": 53539640, "comment_id": 93949440, "body": "One question per post, please. Making fresh posts with fresh questions is not considered bad manners, don&#39;t worry; but spend a little time trying to solve it yourself first. (Half an hour doesn&#39;t seem like enough time to have made an attempt at solving each of the two followup questions yourself.)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1543501919, "post_id": 53539640, "comment_id": 93949477, "body": "<code>print</code> calls <code>show</code> to produce a string value, but you already have string values, which is why you are getting quotes. Use <code>putStrLn</code> instead of <code>print</code>."}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 10722646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a5ad276872bc8a0429e9a023741d12f?s=128&d=identicon&r=PG&f=1", "display_name": "Zach Snyder", "link": "https://stackoverflow.com/users/10722646/zach-snyder"}, "edited": false, "score": 0, "creation_date": 1543497411, "post_id": 53539740, "comment_id": 93946836, "body": "This gets rid of the error, but it doesnt help with my original problem of needing to seperate the words by spaces. This ends up printing every character in the string."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 3, "user_id": 10722646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a5ad276872bc8a0429e9a023741d12f?s=128&d=identicon&r=PG&f=1", "display_name": "Zach Snyder", "link": "https://stackoverflow.com/users/10722646/zach-snyder"}, "edited": false, "score": 0, "creation_date": 1543500347, "post_id": 53539740, "comment_id": 93948583, "body": "Explaining and fixing type errors is as far as I&#39;m willing to go for homework questions."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 0, "last_activity_date": 1543496805, "creation_date": 1543496805, "answer_id": 53539740, "question_id": 53539640, "link": "https://stackoverflow.com/questions/53539640/how-to-separate-a-user-inputted-string-by-the-spaces-n-in-haskell-io/53539740#53539740", "title": "How to separate a user inputted string by the spaces n in Haskell IO", "body": "<p>Use <code>mapM_</code>.</p>\n\n<ul>\n<li><p><code>mapM print</code> returns a list, the result of calling <code>print</code> for each element, but since <code>print</code> returns just <code>()</code> that is <code>[()]</code> not very meaningful.</p>\n\n<pre><code>-- here, b = ()\nmapM :: Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]\n</code></pre></li>\n<li><p><code>mapM_ print</code> discards the result of each call:</p>\n\n<pre><code>mapM_ :: Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m ()\n</code></pre></li>\n</ul>\n\n<p><code>displayWords</code> must be of type <code>IO ()</code>, and the type of a <code>do</code>-block is the type of its last statement, this is why <code>mapM</code> results in a type error.</p>\n\n<p>Another way would be to ignore the result of a function like <code>mapM</code> by adding a statement that does nothing.</p>\n\n<pre><code>do putStr \"...\"\n   x &lt;- getLine\n   mapM print x\n   return ()\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3, "user_id": 10722646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a5ad276872bc8a0429e9a023741d12f?s=128&d=identicon&r=PG&f=1", "display_name": "Zach Snyder", "link": "https://stackoverflow.com/users/10722646/zach-snyder"}, "edited": false, "score": 0, "creation_date": 1543499305, "post_id": 53540346, "comment_id": 93947958, "body": "Thanks, I have one more comment that is somewhat related. If I change the function from displayWords ::IO () to displayWords :: String -&gt; IO Int, (because I want to print out how many words there are, and so I don&#39;t need to ask the user the sentence after starting the code), how come putStrLn doesnt work?"}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 1, "last_activity_date": 1543498698, "creation_date": 1543498698, "answer_id": 53540346, "question_id": 53539640, "link": "https://stackoverflow.com/questions/53539640/how-to-separate-a-user-inputted-string-by-the-spaces-n-in-haskell-io/53540346#53540346", "title": "How to separate a user inputted string by the spaces n in Haskell IO", "body": "<p>You need the <code>words</code> function to split the string into separate words.</p>\n\n<p>Someone suggested <code>mapM_ print (words x)</code>, but since each word is a string, using <code>print</code> will wrap it in quote marks, which you don't want. So try</p>\n\n<pre><code>mapM_ putStrLn (words x)\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 10722646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a5ad276872bc8a0429e9a023741d12f?s=128&d=identicon&r=PG&f=1", "display_name": "Zach Snyder", "link": "https://stackoverflow.com/users/10722646/zach-snyder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 53540346, "answer_count": 2, "score": -2, "last_activity_date": 1543499737, "creation_date": 1543496436, "last_edit_date": 1543499737, "question_id": 53539640, "link": "https://stackoverflow.com/questions/53539640/how-to-separate-a-user-inputted-string-by-the-spaces-n-in-haskell-io", "title": "How to separate a user inputted string by the spaces n in Haskell IO", "body": "<p>I want to ask the user for a sentence, and then return the sentence back but with the words on separate lines. </p>\n\n<p>For example, if the user inputs <code>\"hello I am tall\"</code>, the computer returns:</p>\n\n<pre><code>hello,\nI \nam\ntall\n</code></pre>\n\n<p>I tried to start off a bit, but don't know of a function or something I can use to try and separate the sentence. My code so far:</p>\n\n<pre><code> displayWords ::IO ()\n displayWords = do putStr \"Please enter a line of text\"\n              x &lt;- getLine\n              mapM print x\n</code></pre>\n\n<p>I get the error:</p>\n\n<blockquote>\n  <p>Couldn't match type \u2018[()]\u2019 with \u2018()\u2019</p>\n</blockquote>\n\n<p>EDIT: One more side thing... using <code>mapM_ print (words x)</code> fixes what I want, but is there a way to print this without the quotation marks?</p>\n\n<p>EDIT2: One more thing... Someone in the comments helped answer the previous edit, but if I change the format of this to</p>\n\n<pre><code>displayWords:: String -&gt; IO Int()\ndisplayWords s = do\n     mapM_ putStrLn s\n     return (length s)\n</code></pre>\n\n<p>I get the error</p>\n\n<blockquote>\n  <p>Couldn't match type 'Char' With '[Char]'</p>\n</blockquote>\n\n<p>How come <code>putStrLn</code> doesn't work here?</p>\n"}, {"tags": ["haskell", "types", "type-conversion"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543496197, "post_id": 53538912, "comment_id": 93946204, "body": "You have a  list of type <code>[Note]</code>."}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 3, "creation_date": 1543497331, "post_id": 53538912, "comment_id": 93946790, "body": "why not just <code>writeFile path show [Note {noteID=1...}, Note {noteID=2...}, ]</code>?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1543501819, "post_id": 53538912, "comment_id": 93949419, "body": "The question is very broad. You should start with the question &quot;What should the resulting file look like?&quot;, then write code to accomplish that."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1543505391, "post_id": 53538912, "comment_id": 93951651, "body": "so you want an operation of type <code>FilePath -&gt; [Note] -&gt; IO ()</code> but you have <code>FilePath -&gt; String -&gt; IO ()</code>, and you have a type <code>[Note]</code> value? Seems you need to convert that value to <code>String</code> type value, thus using a function of type <code>[Note] -&gt; String</code>. <code>show</code> is one such function."}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543506910, "post_id": 53538912, "comment_id": 93952602, "body": "@Chepner. True it is broad. What the file looks like does not matter to me so much. The &#39;higher aim&#39; is to write something to the file that I can read back and use the same way I used to get it there. Show indeed is an option, but it immediately implies read and nested quotes."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1543507337, "post_id": 53538912, "comment_id": 93952869, "body": "So derive <code>Read</code> for your data type, and <code>read data :: [Note]</code> should work fine. Nested quotes should not be an issue, unless you need something other than <code>read</code> to process it, in which case we are back to &quot;What should the resulting file look like?&quot;"}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543512225, "post_id": 53538912, "comment_id": 93955501, "body": "@Chepner: that did the trick for me. I consider this an answer to the question and did not consider deriving read on my type. Don&#39;t want to post it as a completely new question, but can I read it as an &#39;Either&#39;, so I also cover the case of having read exploding?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543512639, "post_id": 53538912, "comment_id": 93955697, "body": "Use <code>readEither</code> from the <code>Text.Read</code> module. <code>readEither &quot;1.3&quot; :: Either String Int</code> will return a <code>Left</code> value (with the same generic error message that the exception raised by <code>read</code> would show), while <code>readEither &quot;1.3&quot; :: Either String Float</code> will return a <code>Right</code> value."}], "answers": [{"comments": [{"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1543506630, "post_id": 53541486, "comment_id": 93952433, "body": "Fyodor, I like to assume all I am trying, I&#39;d like to be able to use in a production file. Will Ness and @assembly.jc also mentioned &#39;Show&#39;, which is a perfect solution for getting stuff in the file, but I would assume to need &#39;read&#39; for getting it out. Another downside is then having again nested quotes in the file, which I usually dislike if the need exists to parse a file."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "reply_to_user": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 2, "creation_date": 1543508890, "post_id": 53541486, "comment_id": 93953752, "body": "If this is ultimately for production use, then you should absolutely not use any quick fixes. Come up with a format, document it, write functions to convert to and from, then use those. Trust me, long term quick fixes will come back to bit you."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543512759, "post_id": 53541486, "comment_id": 93955756, "body": "Note that <code>readEither</code> (which I mentioned in the comments) only addresses the second concern listed here."}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": false, "score": 3, "last_activity_date": 1543502463, "creation_date": 1543502463, "answer_id": 53541486, "question_id": 53538912, "link": "https://stackoverflow.com/questions/53538912/haskell-conversion-between-types/53541486#53541486", "title": "Haskell conversion between types", "body": "<p>If you're looking for a \"quick fix\", for a one-off script or something like that, you can derive <code>Read</code> in addition to <code>Show</code>, and then you'll be able to use <code>show</code> to convert to <code>String</code> and <code>read</code> to convert back, for example:</p>\n\n<pre><code>data D = D { x :: Int, y :: Bool }\n    deriving (Show, Read)\n\nd1 = D 42 True\n\ns = show d1\n-- s == \"D {x = 42, y = True}\"\n\nd2 :: D\nd2 = read s\n-- d2 == d1\n</code></pre>\n\n<p>However, please, <em>please</em> don't put this in production code. <strong>First,</strong> you're implicitly relying on how the record is coded, and there are no checks to protect from subtle changes. <strong>Second,</strong> the <code>read</code> function is <em>partial</em> - that is, it will crash if it can't parse the input. <strong>And finally,</strong> if you persist your data this way, you'll be stuck with this record format and can never change it.</p>\n\n<p>For a production-quality solution, I'm sorry, but you'll have to come up with an explicit, documented serialization format. No way around it - in any language.</p>\n"}], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1543513436, "creation_date": 1543493931, "question_id": 53538912, "link": "https://stackoverflow.com/questions/53538912/haskell-conversion-between-types", "title": "Haskell conversion between types", "body": "<p>Again stuck on something probably theoretical. There are many libraries in Haskell, i'd like to use less as possible. If I have a type like this: </p>\n\n<pre><code>data Note = Note { _noteID :: Int\n                 , _noteTitle :: String\n                 , _noteBody :: String\n                 , _noteSubmit :: String\n                 } deriving Show\n</code></pre>\n\n<p>And use that to create a list of <code>[Note {noteID=1...}, Note {noteID=2...}, ]</code> et cetera. I now have a list of type <code>Note</code>. Now I want to write it to a file using <code>writeFile</code>. Probably it ghc will not allow it considering writeFile has type <code>FilePath -&gt; String -&gt; IO ()</code>. But I also want to avoid deconstructing (writeFile) and constructing (readFile) the types all the time, assuming I will not leave the Haskell 'realm'. Is there a way to do that, without using special libs? Again: thanks a lot. Books on Haskell are good, but StackOverflow is the glue between the books and the real world. </p>\n"}, {"tags": ["haskell", "functional-programming", "generic-programming"], "comments": [{"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1543492790, "post_id": 53538092, "comment_id": 93944281, "body": "You attempt to convert a list to MyData data type?"}, {"owner": {"reputation": 438, "user_id": 6371869, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mUzus.jpg?s=128&g=1", "display_name": "Shadasviar", "link": "https://stackoverflow.com/users/6371869/shadasviar"}, "reply_to_user": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1543493145, "post_id": 53538092, "comment_id": 93944480, "body": "@assembly.jc yes, but this list is created statically in sources only for centralised data management instead of repeating same strings a lot of time in code in constructors"}], "answers": [{"tags": [], "owner": {"reputation": 438, "user_id": 6371869, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mUzus.jpg?s=128&g=1", "display_name": "Shadasviar", "link": "https://stackoverflow.com/users/6371869/shadasviar"}, "is_accepted": true, "score": 2, "last_activity_date": 1543493729, "creation_date": 1543493729, "answer_id": 53538853, "question_id": 53538092, "link": "https://stackoverflow.com/questions/53538092/record-update-for-dynamically-resolved-field-name/53538853#53538853", "title": "Record update for dynamically-resolved field name", "body": "<p>Solution was created in this way:</p>\n\n<p>List of fields has a function which updates corresponding field in record :</p>\n\n<pre><code>fields =\n  [ (\"NAME\", (\\d x -&gt; d{name=x}))\n  , (\"ADDRESS\", (\\d x -&gt; d{addr=x}))\n  , ... and for other fields\n  ]\n</code></pre>\n\n<p>Function which initializes <code>MyData</code> record looks like:</p>\n\n<pre><code> initByStrings strs = foldl (\\ d (x, y) -&gt; y d(findIn x strs)}) emptyMyData fields \n</code></pre>\n\n<p>So records fields can be updated one by one from <code>foldl</code> using some external function wich resolver string value from string name of field from list.</p>\n"}, {"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 4, "last_activity_date": 1543493954, "creation_date": 1543493954, "answer_id": 53538917, "question_id": 53538092, "link": "https://stackoverflow.com/questions/53538092/record-update-for-dynamically-resolved-field-name/53538917#53538917", "title": "Record update for dynamically-resolved field name", "body": "<p>That's a use case for generics.</p>\n\n<pre><code>import GHC.Generics\n\ndata MyData = MyData\n  { ...\n  } deriving (Generic)  -- extension: DerivingGeneric\n</code></pre>\n\n<p>The <code>Generic</code> type class has an associated type <code>Rep</code> and a method <code>to</code> (and <code>from</code>)</p>\n\n<pre><code>to :: MyData -&gt; Rep MyData p {- ignore the p -}\n</code></pre>\n\n<p><code>Rep MyData</code> unfolds to a type constructed with <code>M1</code>, <code>(:*:)</code> and <code>K1</code>:</p>\n\n<pre><code>Rep MyData =\n  M1 D _ (\n    M1 C _ (\n        ( M1 S _ (K1 _ String) )\n      :*:\n        ( M1 S _ (K1 _ String) )\n    )\n  )\n-- the things hidden by underscores carry metadata about MyData\n-- (type name, constructor name, field names, whether fields are lazy, etc.).\n</code></pre>\n\n<p>So if you can write a function that works for many combinations of <code>M1</code>, <code>(:*:)</code>, <code>K1</code>, you can then obtain a function on <code>MyData</code> by composition with <code>to</code>.</p>\n\n<pre><code>class GFromMap r where\n  gFromMap :: Map String String -&gt; Maybe (r p)  -- always ignore the p\n\n-- extension: FlexibleContexts\nfromMap :: (Generic a, GFromMap (Rep a)) =&gt; Map String String -&gt; Maybe a\nfromMap m = to &lt;$&gt; gFromMap m\n</code></pre>\n\n<p>We need four instances of <code>GFromMap</code>. Two for the <code>M1 D</code> and <code>M1 C</code> newtypes carrying information about <code>MyData</code> that we don't care about (type name, constructor names).</p>\n\n<pre><code>-- extension: FlexibleInstances\ninstance GFromMap r =&gt; GFromMap (M1 D d r) where\n  gFromMap m = M1 &lt;$&gt; gFromMap m\n\ninstance GFromMap r =&gt; GFromMap (M1 C c r) where\n  gFromMap m = M1 &lt;$&gt; gFromMap m\n</code></pre>\n\n<p>One for products <code>(:*:)</code></p>\n\n<pre><code>-- extension: TypeOperators\ninstance (GFromMap r1, GFromMap r2) =&gt; GFromMap (r1 :*: r2) where\n  gFromMap m = (:*:) &lt;$&gt; gFromMap m &lt;*&gt; gFromMap m\n</code></pre>\n\n<p>And one for fields, here we need to grab the field name from the metadata <code>s</code> associated with the <code>M1 S</code> newtype, using the <code>Selector</code> type class.</p>\n\n<pre><code>-- extension: ScopedTypeVariables, TypeFamilies\n-- the type equality (a ~ String) is for better error messages when\n-- a record has a field not of type String\ninstance (a ~ String, Selector s) =&gt; GFromMap (M1 S s (K1 i a)) where\n  gFromMap m = M1 &lt;$&gt; K1 &lt;$&gt; Map.lookup fdName m\n    where fdName = toUpper &lt;$&gt; selName (undefined :: _t s _r _a)  -- we can refer to s thanks to ScopedTypeVariables\n</code></pre>\n\n<p>Full gist: <a href=\"https://gist.github.com/Lysxia/f27c078faec11487df2828cdfb81752a\" rel=\"nofollow noreferrer\">https://gist.github.com/Lysxia/f27c078faec11487df2828cdfb81752a</a></p>\n"}], "owner": {"reputation": 438, "user_id": 6371869, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mUzus.jpg?s=128&g=1", "display_name": "Shadasviar", "link": "https://stackoverflow.com/users/6371869/shadasviar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 2, "accepted_answer_id": 53538853, "answer_count": 2, "score": 0, "last_activity_date": 1543495013, "creation_date": 1543491195, "last_edit_date": 1543495013, "question_id": 53538092, "link": "https://stackoverflow.com/questions/53538092/record-update-for-dynamically-resolved-field-name", "title": "Record update for dynamically-resolved field name", "body": "<p>I have a record defined like below:</p>\n\n<pre><code>data MyData = MyData\n    { name :: String\n    , addr :: String\n     ... a lot of other fields of String type\n    }\n</code></pre>\n\n<p>Next I want to create list of pairs <code>(String, fieldName)</code>, something like this:</p>\n\n<pre><code>fields =\n  [ (\"NAME\", name)\n  , (\"ADDRESS\", addr)\n  , ... and for other fields\n  ]\n</code></pre>\n\n<p>And finally I need a function which can get empty record of type <code>MyData</code> and fill it dynamically field by field, like this:</p>\n\n<pre><code>initByStrings strs = foldl (\\ d (x, y) -&gt; d{y=(findIn x strs)}) emptyMyData fields \n</code></pre>\n\n<p>Is a behaviour like this possible in Haskell without long monotonic constructions like below?</p>\n\n<pre><code>...\nlst = map (\\ x -&gt; findIn x strs) fields\nf lst where\n    f (name:addr:...) = MyData name addr ...\n</code></pre>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 84157, "user_id": 238978, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a633afaf19e6d4bb53ee50b62e3b5397?s=128&d=identicon&r=PG", "display_name": "Emil Vikstr&#246;m", "link": "https://stackoverflow.com/users/238978/emil-vikstr%c3%b6m"}, "edited": false, "score": 1, "creation_date": 1543479187, "post_id": 53534385, "comment_id": 93936444, "body": "Please, please, please include relevant error messages when you ask programming related questions. Never just say &quot;I get some errors&quot;. It makes everyone fumble in the dark as to what your error is, and also makes us suspect you did not read the error message yourself."}, {"owner": {"reputation": 75, "user_id": 3050696, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001034668201/picture?type=large", "display_name": "Milebril", "link": "https://stackoverflow.com/users/3050696/milebril"}, "reply_to_user": {"reputation": 84157, "user_id": 238978, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a633afaf19e6d4bb53ee50b62e3b5397?s=128&d=identicon&r=PG", "display_name": "Emil Vikstr&#246;m", "link": "https://stackoverflow.com/users/238978/emil-vikstr%c3%b6m"}, "edited": false, "score": 0, "creation_date": 1543479326, "post_id": 53534385, "comment_id": 93936514, "body": "Alright sorry, Will include them. But I&#39;m very new to haskell so dont get much out of the error messages"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1543479697, "post_id": 53534385, "comment_id": 93936695, "body": "@Milebril Do you come from an object-oriented language? Remember that function application in Haskell uses prefix notation, instead of the dot syntax used for calling a method on an object (in Java, etc.)."}, {"owner": {"reputation": 75, "user_id": 3050696, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001034668201/picture?type=large", "display_name": "Milebril", "link": "https://stackoverflow.com/users/3050696/milebril"}, "edited": false, "score": 0, "creation_date": 1543479762, "post_id": 53534385, "comment_id": 93936733, "body": "Yeah im used to programming in Java, etc"}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1543510247, "post_id": 53534385, "comment_id": 93954468, "body": "Tuples are odd. List comprehensions are cool. <code>([ x | (x,y) &lt;- ls], [y | (x,y) &lt;- ls])</code> where <code>ls</code> is your tuple list. More than one list comprehensions is not cool but tuples are odd."}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1543511030, "post_id": 53534385, "comment_id": 93954913, "body": "FYI: <code>import Data.List (transpose)</code> then <code>transpose [ [x,y] | (x,y) &lt;- ls]</code> where <code>ls</code> your tuple list. But the output is a list, not a tuple like the comprehensions before. The comprehension here converts the tuples into lists for a list of lists instead of list of tuples."}], "answers": [{"tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": false, "score": 2, "last_activity_date": 1543479794, "creation_date": 1543479794, "answer_id": 53534591, "question_id": 53534385, "link": "https://stackoverflow.com/questions/53534385/unpair-list-of-tuples/53534591#53534591", "title": "Unpair list of tuples", "body": "<p>You're almost right! You've just got some minor errors:</p>\n\n<ul>\n<li>In Haskell, you can't do <code>list.fst</code> - that is syntactically valid, but the <code>.</code> operator doesn't do the same thing in Haskell as it does in other languages. <code>fst</code> is a function and should be used as such - try applying it to a value e.g. <code>fst list</code>.</li>\n<li>More significantly, you can't apply <code>fst</code> or <code>snd</code> to a list like <code>list</code>; as Haskell is a strongly typed language, these functions must be applied to a single value, not a list. Try moving these functions to the left of the bar e.g. to get all the <code>fst</code> values in a list, use <code>[fst a | a &lt;- list]</code>, meaning 'for each value <code>a</code> in <code>list</code>, apply <code>fst</code> to <code>a</code>'.</li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 75, "user_id": 3050696, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001034668201/picture?type=large", "display_name": "Milebril", "link": "https://stackoverflow.com/users/3050696/milebril"}, "edited": false, "score": 0, "creation_date": 1543480413, "post_id": 53534639, "comment_id": 93937077, "body": "Thanks, but quick question, why do we put it like [fst a | a &lt;- list] and not [a | a &lt;- fst list]"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 75, "user_id": 3050696, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001034668201/picture?type=large", "display_name": "Milebril", "link": "https://stackoverflow.com/users/3050696/milebril"}, "edited": false, "score": 1, "creation_date": 1543480680, "post_id": 53534639, "comment_id": 93937210, "body": "@Milebril I actually explained that in my answer below"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 75, "user_id": 3050696, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001034668201/picture?type=large", "display_name": "Milebril", "link": "https://stackoverflow.com/users/3050696/milebril"}, "edited": false, "score": 3, "creation_date": 1543480975, "post_id": 53534639, "comment_id": 93937363, "body": "@Milebril if you want to apply a function to every element in a list like you are trying, you can use <code>map fst list</code>"}, {"owner": {"reputation": 84157, "user_id": 238978, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a633afaf19e6d4bb53ee50b62e3b5397?s=128&d=identicon&r=PG", "display_name": "Emil Vikstr&#246;m", "link": "https://stackoverflow.com/users/238978/emil-vikstr%c3%b6m"}, "reply_to_user": {"reputation": 75, "user_id": 3050696, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001034668201/picture?type=large", "display_name": "Milebril", "link": "https://stackoverflow.com/users/3050696/milebril"}, "edited": false, "score": 2, "creation_date": 1543481135, "post_id": 53534639, "comment_id": 93937438, "body": "@Milebril <code>fst</code> needs a tuple, <code>list</code> is not a tuple."}], "tags": [], "owner": {"reputation": 84157, "user_id": 238978, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a633afaf19e6d4bb53ee50b62e3b5397?s=128&d=identicon&r=PG", "display_name": "Emil Vikstr&#246;m", "link": "https://stackoverflow.com/users/238978/emil-vikstr%c3%b6m"}, "is_accepted": true, "score": 3, "last_activity_date": 1543480274, "last_edit_date": 1543480274, "creation_date": 1543479968, "answer_id": 53534639, "question_id": 53534385, "link": "https://stackoverflow.com/questions/53534385/unpair-list-of-tuples/53534639#53534639", "title": "Unpair list of tuples", "body": "<p>This is only slightly hinted to by your error message. The problem you have is that you are mis-using the <code>.</code> operator. You might have programmed in an object-oriented language before where <code>list.fst</code> calls a function <code>fst</code> on the <code>list</code> object. This is not the case in Haskell where <code>.</code> is an <a href=\"https://wiki.haskell.org/Infix_operator\" rel=\"nofollow noreferrer\">infix function</a> used to <a href=\"https://wiki.haskell.org/Function_composition\" rel=\"nofollow noreferrer\">compose</a> two functions.</p>\n\n<p>What you really want to do is to pick tuples from your list, and then apply <code>fst</code>/<code>snd</code> on those tuples one at a time. For example:</p>\n\n<pre><code>[fst a | a &lt;- list]\n</code></pre>\n\n<p>You can also use pattern matching and skip <code>fst</code>/<code>snd</code> altogheter, but it is a matter of opinion if this is better or worse:</p>\n\n<pre><code>[a | (a, _) &lt;- list]\n</code></pre>\n"}], "owner": {"reputation": 75, "user_id": 3050696, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001034668201/picture?type=large", "display_name": "Milebril", "link": "https://stackoverflow.com/users/3050696/milebril"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "accepted_answer_id": 53534639, "answer_count": 2, "score": 1, "last_activity_date": 1543480274, "creation_date": 1543478889, "last_edit_date": 1543479430, "question_id": 53534385, "link": "https://stackoverflow.com/questions/53534385/unpair-list-of-tuples", "title": "Unpair list of tuples", "body": "<p>I have this excercise in Haskell where we have a list of tuples and we need to unpair them and put them into different lists.</p>\n\n<p>Desired outcome: </p>\n\n<pre><code>Main&gt; unpair [(1,2),(3,4),(5,6)]\n([1,3,5],[2,4,6])\n</code></pre>\n\n<p>My code, but I get some errors:</p>\n\n<pre><code>unpair :: [(a,b)] -&gt; ([a],[b])\nunpair list = ([a|a&lt;-list.fst], [b|b&lt;-list.snd])\n</code></pre>\n\n<p>errors:</p>\n\n<pre><code>Template.hs:8:22:\nCouldn't match expected type `b0 -&gt; c0' with actual type `[(a, b)]'\nRelevant bindings include\n  list :: [(a, b)] (bound at Template.hs:8:8)\n  unpair :: [(a, b)] -&gt; ([a], [b]) (bound at Template.hs:8:1)\nIn the first argument of `(.)', namely `list'\nIn the expression: list . fst\n\nTemplate.hs:8:22:\nCouldn't match expected type `[a]'\n            with actual type `(b0, b1) -&gt; c0'\nRelevant bindings include\n  list :: [(a, b)] (bound at Template.hs:8:8)\n  unpair :: [(a, b)] -&gt; ([a], [b]) (bound at Template.hs:8:1)\nIn the expression: list . fst\nIn a stmt of a list comprehension: a &lt;- list . fst\nIn the expression: [a | a &lt;- list . fst]\n\nTemplate.hs:8:39:\nCouldn't match expected type `b2 -&gt; c1' with actual type `[(a, b)]'\nRelevant bindings include\n  list :: [(a, b)] (bound at Template.hs:8:8)\n  unpair :: [(a, b)] -&gt; ([a], [b]) (bound at Template.hs:8:1)\nIn the first argument of `(.)', namely `list'\nIn the expression: list . snd\n\nTemplate.hs:8:39:\nCouldn't match expected type `[b]'\n            with actual type `(a0, b2) -&gt; c1'\nRelevant bindings include\n  list :: [(a, b)] (bound at Template.hs:8:8)\n  unpair :: [(a, b)] -&gt; ([a], [b]) (bound at Template.hs:8:1)\nIn the expression: list . snd\nIn a stmt of a list comprehension: b &lt;- list . snd\nIn the expression: [b | b &lt;- list . snd]\n</code></pre>\n\n<p>The question also states to try to do it with list comprehensions.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["c", "haskell", "ffi", "storable", "haskell-ffi"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1543489934, "post_id": 53534340, "comment_id": 93942754, "body": "I would keep your approach, trying to remove all the magic numbers like 8 and 16, replacing them with some code which actually computes the size of a C int, and the proper offset. Maybe tools like <code>c2hs</code> can help in computing these numbers, but I don&#39;t remember. A potential alternative could be to use foreign pointers for the allocation of the buffer, and let the buffer be freed on GC. I am not that familiar with FFI to guarantee this is viable."}], "answers": [{"comments": [{"owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "edited": false, "score": 0, "creation_date": 1543489683, "post_id": 53534817, "comment_id": 93942607, "body": "One risk I see is that a user does an <code>alloca</code> and then passes the pointer to the <code>f</code> function which will then probably throw a segfault."}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "reply_to_user": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "edited": false, "score": 0, "creation_date": 1543489854, "post_id": 53534817, "comment_id": 93942692, "body": "Why would it? The memory will be freed once <code>f</code> finishes. It can happen if user will save this pointer using some <code>IORef</code> and then try to use it later, but the documentation warns about it."}, {"owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "edited": false, "score": 0, "creation_date": 1543490012, "post_id": 53534817, "comment_id": 93942809, "body": "<code>alloca</code> just allocates sufficient memory but doesn&#39;t do the pointer-bending which makes <code>str</code> point to the proper buffer. It&#39;d need some initializer function after the <code>alloca</code> before handing down the <code>Ptr</code>."}], "tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": false, "score": 0, "last_activity_date": 1543480697, "creation_date": 1543480697, "answer_id": 53534817, "question_id": 53534340, "link": "https://stackoverflow.com/questions/53534340/haskell-ffi-wrapping-a-c-struct-containing-a-separately-allocated-string-char/53534817#53534817", "title": "Haskell FFI: Wrapping a C struct containing a separately allocated string (char*)", "body": "<p>While your solution seems quite nice for me (you are hiding that memory fiddling inside <code>Storable</code> instance, so that user shouldn't bother finding a memory buffer himself), you can mimic C solution too with <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Foreign-Marshal-Alloc.html\" rel=\"nofollow noreferrer\"><code>allocaBytes</code></a>.</p>\n"}], "owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 125, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1543651399, "creation_date": 1543478660, "last_edit_date": 1543651399, "question_id": 53534340, "link": "https://stackoverflow.com/questions/53534340/haskell-ffi-wrapping-a-c-struct-containing-a-separately-allocated-string-char", "title": "Haskell FFI: Wrapping a C struct containing a separately allocated string (char*)", "body": "<p>Suppose you have a C-struct </p>\n\n<pre><code>typedef struct {\n  uint32_t num;\n  char*    str;\n} MyStruct;\n</code></pre>\n\n<p>and a function <code>f</code> that does some operation on it,</p>\n\n<pre><code>void f(MyStruct* p);\n</code></pre>\n\n<p>The C API demands that the <code>char*</code> be allocated a sufficient buffer before calling <code>f</code>:</p>\n\n<pre><code>char buf[64];   //the C API docs say 64\nMyStruct s = {1, buf};\nf(s);  // would go badly if MyStruct.str isn't alloc'ed\n</code></pre>\n\n<p>(Note that the <code>num</code> field has no purpose in this constructed example. It just prevents the trivial solution using <code>CString</code> and <code>CStringLen</code>.)</p>\n\n<p><strong>The question is how to write a Haskell FFI for this kind of C API.</strong> </p>\n\n<p>What I've come up with is this: Start with</p>\n\n<pre><code>data MyStruct = MyStruct {\n    num :: Word32,\n    str :: String\n} deriving Show\n</code></pre>\n\n<p>and write a Storable instance. My idea is to allocate 64 bytes at the end which will serve as buffer for the string:</p>\n\n<pre><code>instance Storable MyStruct where\n    sizeOf _ = 8{-alignment!-} + sizeOf (nullPtr :: CString) + 64{-buffer-}\n    alignment _ = 8\n</code></pre>\n\n<p><code>poke</code> has to change the pointer in str to point to the allocated buffer, and then the Haskell string has to be copied into it. I do this with <code>withCStringLen</code>:</p>\n\n<pre><code>poke p x = do\n    pokeByteOff p 0 (num x)\n    poke strPtr bufPtr\n    withCStringLen (str x) $ \\(p',l) -&gt; copyBytes bufPtr p' (l+1) -- not sure about the +1\n    where strPtr = castPtr $ plusPtr p 8 :: Ptr CString\n          bufPtr = castPtr $ plusPtr p 16 :: CString\n</code></pre>\n\n<p>Finally here's <code>peek</code>, which is straightforward:</p>\n\n<pre><code>peek p = MyStruct \n     &lt;$&gt; peek (castPtr p)\n     &lt;*&gt; peekCAString (castPtr $ plusPtr p 16)\n</code></pre>\n\n<p>All this works, but I find it rather ugly. <strong>Is this the way to do it, or is there a better way?</strong></p>\n\n<p>If anyone wants to play with it, the little toy problem is on <a href=\"https://github.com/mcmayer/soq-struct-string\" rel=\"nofollow noreferrer\">github</a>.</p>\n\n<p><strong>Update</strong></p>\n\n<p>As pointed out by <code>chi</code> the following caveat is in order: Using hard-coded alignments and offsets is bad practice. They are fragile and platform/compiler dependent. Instead, tools like <a href=\"https://hackage.haskell.org/package/c2hsc\" rel=\"nofollow noreferrer\">c2hsc</a>, <a href=\"https://hackage.haskell.org/package/c2hs\" rel=\"nofollow noreferrer\">c2hs</a>  or <a href=\"https://hackage.haskell.org/package/bindings-DSL\" rel=\"nofollow noreferrer\">bindings-dsl</a>, or <a href=\"https://hackage.haskell.org/package/greencard\" rel=\"nofollow noreferrer\">greencard</a>, etc., should be used.</p>\n"}, {"tags": ["haskell", "compiler-errors", "typeclass"], "comments": [{"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1543476355, "post_id": 53533481, "comment_id": 93935195, "body": "You can suppress this by adding <code>{-# LANGUAGE FlexibleInstances, UndecidableInstances #-}</code> at beginning of you file, but it leads to other problem. For example <code>Could not deduce (Num a1) arising from the literal </code>0&#39;<code>. I don&#39;t see how is </code>0` is literal with type <code>Fractional</code>."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1543490350, "post_id": 53533915, "comment_id": 93942966, "body": "That&#39;s correct. Note that, with extensions on, we can write <code>instance ... =&gt; Group a</code>. If we do, however, we can never define another instance for <code>Group</code> since any other <code>instance ... =&gt; Group (something)</code> will be overlapping with the first one. (Turning on the &quot;overlapping instances&quot; extension opens a can of worms -- not recommended). If possible, using a <code>newtype</code> as you do above is better. It also allow multiple instances for the same type e.g. <code>instance Group (Additive T)</code> and <code>instance Group (Multiplicative T)</code> which have the same underlying type <code>T</code>."}], "tags": [], "owner": {"reputation": 41, "user_id": 7090916, "user_type": "registered", "profile_image": "https://graph.facebook.com/1866268663602069/picture?type=large", "display_name": "Sergey Kumkov", "link": "https://stackoverflow.com/users/7090916/sergey-kumkov"}, "is_accepted": false, "score": 3, "last_activity_date": 1543476774, "creation_date": 1543476774, "answer_id": 53533915, "question_id": 53533481, "link": "https://stackoverflow.com/questions/53533481/illegal-instance-declaration-in-haskell/53533915#53533915", "title": "Illegal instance declaration in Haskell", "body": "<p>Ah! I have finally understood, what is wrong. In Haskell, a class can be instantiated for an ADT only. So, the only reasonable solution is to declare something as follows:</p>\n\n<pre><code>class Group a where\n  (.+.) :: a -&gt; a -&gt; a\n  (.-.) :: a -&gt; a -&gt; a\n  zero :: a\n  opposite :: a -&gt; a\n\n  x .-. y = x .+. opposite y\n  opposite x = zero .-. x\n  {-# MINIMAL (.+.), zero, (opposite | (.-.)) #-}\n\nnewtype GroupType a = GroupType a  \n\ninstance Fractional a =&gt; Group (GroupType a) where\n  GroupType x .+. GroupType y = GroupType $ x + y\n  zero = GroupType 0\n  opposite (GroupType x) = GroupType $ negate x\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "is_accepted": true, "score": 2, "last_activity_date": 1543477524, "last_edit_date": 1543477524, "creation_date": 1543477032, "answer_id": 53533972, "question_id": 53533481, "link": "https://stackoverflow.com/questions/53533481/illegal-instance-declaration-in-haskell/53533972#53533972", "title": "Illegal instance declaration in Haskell", "body": "<p>I was able to compile your example:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances, UndecidableInstances #-}\n\nclass Group a where\n  (.+.) :: a -&gt; a -&gt; a\n  (.-.) :: a -&gt; a -&gt; a\n  zero :: a\n  opposite :: a -&gt; a\n\n  x .-. y = x .+. opposite y\n  opposite x = zero .-. x\n  {-# MINIMAL (.+.), zero, (opposite | (.-.)) #-}\n\n-- data Fractional a = Fractional a a\n\ninstance (Fractional a, Num a) =&gt; Group a where\n  x .+. y = x + y\n  zero = 0\n  opposite = negate\n</code></pre>\n\n<ul>\n<li><code>FlexibleInstances</code> allow instance of unknown type with constraints. Basically allow <code>instance X a</code></li>\n<li><code>UndecidableInstances</code> we need because we declare that any <code>a</code> belong to class <code>Group</code> and it could (inevitable?) lead to <code>a</code> belong to <code>Group</code> thru several different <code>instance</code> declarations.</li>\n</ul>\n"}], "owner": {"reputation": 41, "user_id": 7090916, "user_type": "registered", "profile_image": "https://graph.facebook.com/1866268663602069/picture?type=large", "display_name": "Sergey Kumkov", "link": "https://stackoverflow.com/users/7090916/sergey-kumkov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 348, "favorite_count": 0, "accepted_answer_id": 53533972, "answer_count": 2, "score": 0, "last_activity_date": 1543505147, "creation_date": 1543474838, "last_edit_date": 1543505147, "question_id": 53533481, "link": "https://stackoverflow.com/questions/53533481/illegal-instance-declaration-in-haskell", "title": "Illegal instance declaration in Haskell", "body": "<p>I tried the following code</p>\n\n<pre><code>class Group a where\n  (.+.) :: a -&gt; a -&gt; a\n  (.-.) :: a -&gt; a -&gt; a\n  zero :: a\n  opposite :: a -&gt; a\n\n  x .-. y = x .+. opposite y\n  opposite x = zero .-. x\n  {-# MINIMAL (.+.), zero, (opposite | (.-.)) #-}\n\ninstance Fractional a =&gt; Group a where\n  x .+. y = x + y\n  zero = 0 :: a\n  opposite = negate :: a -&gt; a\n</code></pre>\n\n<p>But on loading into GHCi, I get the following error:</p>\n\n<pre><code>group1.hs:11:26: error:\n    \u2022 Illegal instance declaration for \u2018Group a\u2019\n        (All instance types must be of the form (T a1 ... an)\n         where a1 ... an are *distinct type variables*,\n         and each type variable appears at most once in the instance head.\n         Use FlexibleInstances if you want to disable this.)\n    \u2022 In the instance declaration for \u2018Group a\u2019\n   |\n11 | instance Fractional a =&gt; Group a where\n   |    \n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["haskell", "polymorphism", "impredicativetypes"], "answers": [{"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1543466578, "post_id": 53531939, "comment_id": 93931867, "body": "I think you mean <code>newtype Wrap =</code>? Worth noting that your example is using <code>ExistentialQuantification</code> syntax, which can also be written as <code>data Wrap where Wrap :: forall a. X a =&gt; Y a -&gt; Wrap</code> using <code>GADTs</code> (the <code>forall a.</code> being optional)."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1543466888, "post_id": 53531939, "comment_id": 93931938, "body": "@JonPurdy Fixed <code>newtype</code>, thank you for the catch. The OP was already using <code>forall</code>, so I assumed that <code>ExistentialQuantification</code> was already enabled. But <code>GADTs</code> is still necessary for this to work (if memory serves), regardless of the syntax used."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1543467321, "post_id": 53531939, "comment_id": 93932055, "body": "I think you actually don\u2019t mean <code>newtype Wrap =</code> but rather mean <code>data Wrap =</code>! A newtype is, by definition, representationally equivalent to its underlying type, but an existentially quantified type with a dictionary packed inside it is not, since it also has to store the dictionary. Therefore, you can\u2019t use existential quantification over constraints with newtypes."}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 4, "last_activity_date": 1543467655, "last_edit_date": 1543467655, "creation_date": 1543466419, "answer_id": 53531939, "question_id": 53531786, "link": "https://stackoverflow.com/questions/53531786/ways-around-impredictive-polymorphism/53531939#53531939", "title": "Ways around impredictive polymorphism", "body": "<p>The fact that <code>v :: forall a. X a =&gt; Y a</code> is exactly why applying <code>z</code> doesn't work.</p>\n\n<p>That <code>forall</code> in there means that <code>v</code> can be of any type, you choose which one. To illustrate, compare to this:</p>\n\n<pre><code>empty :: forall a. [a]\nempty = []\n</code></pre>\n\n<p>There value <code>empty</code> can be of any type, the consumer chooses which type. That's what <code>forall</code> means here. I hope this much is obvious.</p>\n\n<p>And so it is with your value <code>v</code>: it can be of any type, you choose which. But in your code you don't choose a type: you're applying <code>z</code>, which itself can work with any type, and so the type of <code>v</code> remains unchosen. This is exactly what the compiler is telling you when it complains about the \"ambiguous type variable a0\".</p>\n\n<p>To make this work, you should put the <code>forall</code> <em>on the other side of <code>Wrap</code></em>:</p>\n\n<pre><code>data Wrap = forall a. X a =&gt; Wrap (Y a)\n</code></pre>\n\n<p>(you'll need to enable the <code>GADTs</code> extension for this to be allowed)</p>\n\n<p>This way, whoever constructs a <code>Wrap</code> has to choose the specific type <code>a</code>. And on the other side, when you do pattern matching, you get the type <code>a</code> that was chosen by whoever constructed the value.</p>\n"}], "owner": {"reputation": 3706, "user_id": 2018455, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e75a41fc224930ef1fa9ddcc9c714174?s=128&d=identicon&r=PG", "display_name": "Neil Locketz", "link": "https://stackoverflow.com/users/2018455/neil-locketz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "accepted_answer_id": 53531939, "answer_count": 1, "score": 2, "last_activity_date": 1543467655, "creation_date": 1543465258, "last_edit_date": 1543466198, "question_id": 53531786, "link": "https://stackoverflow.com/questions/53531786/ways-around-impredictive-polymorphism", "title": "Ways around impredictive polymorphism", "body": "<p>I'm new to some of the more complicated type constructs in Haskell, and have been messing around. I'm currently stuck trying to get a function that I think should work to type check.</p>\n\n<p>Take the following code as an example: </p>\n\n<pre><code>{-# LANGUAGE RankNTypes   #-}\n{-# LANGUAGE TypeFamilies #-}\n\nclass X a where\n  data Y a\n  z :: Y a -&gt; Int\n\ndata D1 = D1\ninstance X D1 where\n  data Y D1 = YD1\n  z _ = 1\n\ndata D2 = D2\ninstance X D2 where\n  data Y D2 = YD2\n  z _ = 2\n\nsumZ :: X a =&gt; [Y a] -&gt; Int\nsumZ = foldl' sumFn 0\n  where sumFn = flip ((+) . z)\n</code></pre>\n\n<p>I want <code>a = sumZ [YD1, YD2]</code> to type check. This (obviously) doesn't work since the <code>a</code> type variable gets fixed with the first <code>YD1</code>.</p>\n\n<p>I understand enough to know that I should probably use higher ranked types here, so I tried this:</p>\n\n<pre><code>sumZ' :: [(forall a. X a =&gt; Y a)] -&gt; Int\nsumZ' = foldl' sumFn 0\n  where sumFn = flip ((+) . z)\n</code></pre>\n\n<p>But, when I try and compile it I run into \"impredicative polymorphism\":</p>\n\n<pre><code>     \u2022 Illegal polymorphic type: forall a. X a =&gt; Y a\n       GHC doesn't yet support impredicative polymorphism\n     \u2022 In the type signature: sumZ' :: [(forall a. X a =&gt; Y a)] -&gt; Int\n    |\n 48 | sumZ' :: [(forall a. X a =&gt; Y a)] -&gt; Int\n    |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>After doing a bit of reading, I see that the conventional solution is to wrap the value in a <code>newtype</code> to skirt around the impredicative polymorphism.</p>\n\n<pre><code>newtype Wrap = Wrap { unWrap :: forall a. X a =&gt; Y a }\n\nsumZ'' :: [Wrap] -&gt; Int\nsumZ'' = foldl' sumFn 0\n  where\n    sumFn acc (Wrap v) = acc + (z v)\n</code></pre>\n\n<p>Unfortunately, this doesn't seem to work either. Compilation fails with this message:</p>\n\n<pre><code>     \u2022 Ambiguous type variable \u2018a0\u2019 arising from a use of \u2018z\u2019\n       prevents the constraint \u2018(X a0)\u2019 from being solved.\n       Probable fix: use a type annotation to specify what \u2018a0\u2019 should be.\n       These potential instances exist:\n         instance X D1\n           -- Defined at ...\n         instance X D2\n           -- Defined at ...\n     \u2022 In the second argument of \u2018(+)\u2019, namely \u2018(z v)\u2019\n       In the expression: acc + (z v)\n       In an equation for \u2018sumFn\u2019: sumFn acc (Wrap v) = acc + (z v)\n    |\n 64 |     sumFn acc (Wrap v) = acc + (z v)\n    |                                 ^^^\n</code></pre>\n\n<p>Finally, my question(s):</p>\n\n<ol>\n<li>Why doesn't the standard \"wrapping\" technique work in this case? When inspecting the type of <code>v</code> I see that it has the type <code>forall a. X a =&gt; Y a</code>, to me this seems like it should work.</li>\n<li>How can I get the <code>a = sumZ [YD1, YD2]</code> to work? Am I going about this wrong?</li>\n</ol>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 3, "creation_date": 1543467674, "post_id": 53531764, "comment_id": 93932158, "body": "Welcome to Stack Overflow! In a question here, you should include the exact code you have tried, and state what didn\u2019t work, including the text of any error messages you received; otherwise the question is likely to be closed as too broad or not showing your effort."}], "answers": [{"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1543467469, "post_id": 53531940, "comment_id": 93932099, "body": "Just for OP\u2019s reference: the pattern <code>do { x &lt;- m; return $ f x }</code> is commonly written like <code>f &lt;$&gt; m</code> (using <code>&lt;$&gt;</code> = <code>fmap</code>), and this kind of recursive loop is often written with a helper function to avoid repeating all the parameters, like: <code>biggerThan x = loop where loop = do { v &lt;- readLn; if v &gt; x then pure [v] else (v :) &lt;$&gt; loop }</code>"}, {"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1543468394, "post_id": 53531940, "comment_id": 93932348, "body": "@JonPurdy I&#39;m not that good :) I tried to find something <code>IO a -&gt; (a -&gt; Bool) -&gt; IO [a]</code> in hoogle, but surprisingly there nothing like it."}], "tags": [], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "is_accepted": false, "score": 2, "last_activity_date": 1543466420, "creation_date": 1543466420, "answer_id": 53531940, "question_id": 53531764, "link": "https://stackoverflow.com/questions/53531764/haskell-how-to-read-in-a-series-of-floats-and-then-write-them-into-a-list-in-h/53531940#53531940", "title": "Haskell: How to read in a series of Floats, and then write them into a list in Haskell with IO.", "body": "<p>Her is sample:</p>\n\n<pre><code>main = do\n         vs &lt;- biggerThan 10\n         print $ vs\n\n\nbiggerThan :: Int -&gt; IO [Int]\nbiggerThan x = do\n                 v &lt;- readLn\n                 if v &gt; x then return [v]\n                          else do\n                                 vx &lt;- biggerThan x  \n                                 return $ v : vx\n</code></pre>\n\n<p>It works with <code>Int</code> but you can easily fix that.</p>\n\n<p>Also it expect that each number is in separate line.</p>\n"}], "owner": {"reputation": 1, "user_id": 10720436, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-gICws56v6w0/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gEVn7F48bR-FezEbnpSOup2Bnmqw/mo/photo.jpg?sz=128", "display_name": "A HP", "link": "https://stackoverflow.com/users/10720436/a-hp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1543466420, "creation_date": 1543465077, "question_id": 53531764, "link": "https://stackoverflow.com/questions/53531764/haskell-how-to-read-in-a-series-of-floats-and-then-write-them-into-a-list-in-h", "title": "Haskell: How to read in a series of Floats, and then write them into a list in Haskell with IO.", "body": "<p>Basically what I am trying to do is have the user input a series of floats, and only stop them when the float they enter is bigger/smaller than an original float. </p>\n\n<p>For example, calling a function \"biggerThan 10\", would then let the user input values. I know how to read the values, but don't know how to add them to a list so I can compare them to 10, in this case. </p>\n\n<p>Thank you!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1543465668, "post_id": 53530616, "comment_id": 93931671, "body": "You specify whatever value your function wants to return for an empty list."}, {"owner": {"reputation": 4965, "user_id": 339167, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/34tLX.jpg?s=128&g=1", "display_name": "Rohit Sharma", "link": "https://stackoverflow.com/users/339167/rohit-sharma"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1543483936, "post_id": 53530616, "comment_id": 93939111, "body": "@n.m. sorry can you give me an example? how is empty list going to be useful when i want max from available list of numbers"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1543484985, "post_id": 53530616, "comment_id": 93939748, "body": "You are supposed to return the maximal element of a list, but empty lists do not have any maximal element. So you need to decide somehow what you want to compute if the input list is empty. I can&#39;t really help you with this decision. You might say &quot;I don&#39;t care about empty lists and I will let my function crash if the input list is empty&quot;. You might say &quot;I don&#39;t care about lists that contain negative numbers so I will return -1 for empty lists&quot;. Or you might say &quot;my maximum is not a simple integer but something smarter&quot;. Or lots of other things really. But it&#39;s <i>your</i> decision."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543503458, "post_id": 53530616, "comment_id": 93950434, "body": "If you assume that <code>maxDbNumber</code> will only be called on non-empty lists, then you can use <code>foldr1</code> instead, which doesn&#39;t require a starting value. (This is n.m.&#39;s first scenario, where you decide you don&#39;t care what happens if the input is empty.)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1543503859, "post_id": 53530616, "comment_id": 93950677, "body": "You can simplify this a bit, though, by discarding everything except <code>DbNumber</code> values before you start computing a maximum, in which case you can just use <code>maximum [z | DbNumber z &lt;- xs]</code>."}], "answers": [{"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 2, "last_activity_date": 1543467998, "last_edit_date": 1543467998, "creation_date": 1543465509, "answer_id": 53531817, "question_id": 53530616, "link": "https://stackoverflow.com/questions/53530616/how-do-i-specify-the-min-bound-of-an-integer/53531817#53531817", "title": "How do i specify the min bound of an Integer", "body": "<p>Not terribly elegant, but not complicated either\u2014you could use the fact that <code>Nothing &lt; Just x</code> for any <code>x</code>:</p>\n\n<pre><code>foldr (\\x acc -&gt; case x of\n  DbNumber z -&gt; Just z `max` acc\n  _ -&gt; acc) Nothing xs\n</code></pre>\n\n<p>This could be written a little more compactly by defining a function to extract the number if present:</p>\n\n<pre><code>fromDbNumber :: DatabaseItem -&gt; Maybe Integer\nfromDbNumber (DbNumber z) = Just z\nfromDbNumber _ = Nothing\n\nmaxDbNumber = foldr (max . fromDbNumber) Nothing\n</code></pre>\n\n<p>The point-free <code>max . fromDbNumber</code> is derived like so:</p>\n\n<pre><code>-- Original:\n\\x acc -&gt; max (fromDbNumber x) acc\n\n-- Eta-reduce:\n\\x -&gt; max (fromDbNumber x)\n\n-- Definition of \u2018(.)\u2019:\nmax . fromDbNumber\n</code></pre>\n\n<p>This changes the result to <code>Maybe Integer</code>, of course, but this is appropriate: you need to do <em>something</em> to handle the case where there is no maximum, even if it\u2019s just returning a default value.</p>\n"}], "owner": {"reputation": 4965, "user_id": 339167, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/34tLX.jpg?s=128&g=1", "display_name": "Rohit Sharma", "link": "https://stackoverflow.com/users/339167/rohit-sharma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "accepted_answer_id": 53531817, "answer_count": 1, "score": 1, "last_activity_date": 1543484044, "creation_date": 1543455379, "last_edit_date": 1543484044, "question_id": 53530616, "link": "https://stackoverflow.com/questions/53530616/how-do-i-specify-the-min-bound-of-an-integer", "title": "How do i specify the min bound of an Integer", "body": "<p>I am trying to solve an exercise question from <a href=\"http://haskellbook.com/\" rel=\"nofollow noreferrer\">the Haskell Book</a> and wondering what minimum value should I specify in the start accumulator so I can find Max of DBNumber using foldr? </p>\n\n<p>I can't specify minBound::Integer as there is no lower bound. I can probably find this by other means but wondering if i can use foldr as below?</p>\n\n<pre><code>import Data.Time\n\ndata DatabaseItem = DbString String | DbNumber Integer | DbDate UTCTime deriving (Eq, Ord, Show)\n\ntheDatabase :: [DatabaseItem]\ntheDatabase = [DbDate (UTCTime (fromGregorian 1911 5 1) \n                      (secondsToDiffTime 34123)),\n               DbNumber -9001,\n               DbString \"Hello World\",\n               DbNumber -9002,\n               DbNumber -109001,\n               DbDate (UTCTime (fromGregorian 1921 5 1) (secondsToDiffTime 34123))]\n\n\n\nmaxDbNumber xs = foldr (\\x y -&gt; case x of \n                       DbNumber z | z &gt; y -&gt; z\n                       otherwise -&gt; y) (minBound::Integer) xs\n</code></pre>\n"}, {"tags": ["haskell", "gadt", "type-families", "proxy-pattern"], "comments": [{"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "edited": false, "score": 0, "creation_date": 1543516928, "post_id": 53530560, "comment_id": 93957798, "body": "Here&#39;s an idea. Are you sure you&#39;re not writing a <code>IsEnum</code> instance for the <code>Bool</code> <i>type</i> only? In your case you want the instance for the <code>Bool</code> <i>kind</i>."}, {"owner": {"reputation": 141, "user_id": 8565175, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-5jYdIxZdMlY/AAAAAAAAAAI/AAAAAAAAACU/e_9FLrZl0Og/photo.jpg?sz=128", "display_name": "Brandon Chinn", "link": "https://stackoverflow.com/users/8565175/brandon-chinn"}, "reply_to_user": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "edited": false, "score": 0, "creation_date": 1543533751, "post_id": 53530560, "comment_id": 93964687, "body": "I don&#39;t understand how that plays a role. The first snippet alone errors, before running anything in the second snippet."}], "owner": {"reputation": 141, "user_id": 8565175, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-5jYdIxZdMlY/AAAAAAAAAAI/AAAAAAAAACU/e_9FLrZl0Og/photo.jpg?sz=128", "display_name": "Brandon Chinn", "link": "https://stackoverflow.com/users/8565175/brandon-chinn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 307, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1543454903, "creation_date": 1543454903, "question_id": 53530560, "link": "https://stackoverflow.com/questions/53530560/how-do-i-extract-type-information-from-proxy-in-a-type-family-for-a-gadt", "title": "How do I extract type information from Proxy in a type family for a GADT?", "body": "<p>I have the following snippet:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TypeInType #-}\n\nimport Data.Proxy\n\ndata Foo where\n  FooInt :: Foo\n  FooProxy :: IsEnum e ~ True =&gt; Proxy e -&gt; Foo\n\ntype family IsEnum e :: Bool\n\ntype family FromFoo (foo :: Foo) where\n  FromFoo FooInt = Int\n  FromFoo (FooProxy ('Proxy :: Proxy e)) = e\n</code></pre>\n\n<p>The general idea is that I'm trying to use <code>Foo</code> as a data kind where I could do</p>\n\n<pre><code>type MyFoo1 = FooInt :: Foo\ntype instance IsEnum Bool = True\ntype MyFoo2 = FooProxy ('Proxy :: Proxy Bool) :: Foo\n</code></pre>\n\n<p>and ensure that the proxied type being passed to <code>FooProxy</code> is a part of the <code>IsEnum</code> type family (I can't just do <code>FooProxy :: Enum e =&gt; Proxy e -&gt; Foo</code> because <a href=\"https://stackoverflow.com/a/48331898/8565175\">only equality constraints are currently supported</a>).</p>\n\n<p>But when I try to compile this, I get the error:</p>\n\n<pre><code>&lt;interactive&gt;:30:12: error:\n    \u2022 Couldn't match expected kind \u2018'True\u2019 with actual kind \u2018IsEnum e\u2019\n    \u2022 In the first argument of \u2018FromFoo\u2019, namely\n        \u2018(FooProxy ( 'Proxy :: Proxy e))\u2019\n      In the type family declaration for \u2018FromFoo\u2019\n</code></pre>\n\n<p>The problem is when I want to convert from my <code>Foo</code> type to the concrete type in <code>FromFoo</code>, I want <code>FooProxy</code> to evaluate to the proxied type. So I'm trying to pattern match on <code>Proxy</code> to return the proxied type <code>e</code>, but then it seems to be checking the <code>IsEnum e ~ True</code> constraint again. I would think that the constraint would only be checked when <em>creating</em> a <code>FooProxy</code> value, but it seems to be checking again when <em>pattern matching</em>.</p>\n"}]