[{"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1507755124, "post_id": 46697294, "comment_id": 80342429, "body": "I don&#39;t think a list is a good datastructure for this, since lookup is inefficient here."}, {"owner": {"reputation": 117, "user_id": 7212810, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/pNFqk.jpg?s=128&g=1", "display_name": "Wireless", "link": "https://stackoverflow.com/users/7212810/wireless"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1507755480, "post_id": 46697294, "comment_id": 80342584, "body": "@WillemVanOnsem inac and rInac need to be a list, now the checking I&#39;m not sure how to do it..."}], "answers": [{"comments": [{"owner": {"reputation": 117, "user_id": 7212810, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/pNFqk.jpg?s=128&g=1", "display_name": "Wireless", "link": "https://stackoverflow.com/users/7212810/wireless"}, "edited": false, "score": 0, "creation_date": 1507757297, "post_id": 46697640, "comment_id": 80343371, "body": "Hey, so I ran what you wrote there, both ways, and didn&#39;t get what I was expecting, I might have explained myself wrong, I have the inac list which has a series of numbers, and from those numbers on inac, I want to check which ones are sorta isolated, meaning, I want to check those from inac that don&#39;t have another inac number 5 numbers before and after, and get them to the rInac list. (The inac list has specific numbers and there are supposed to be 30 rInac numbers)"}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "reply_to_user": {"reputation": 117, "user_id": 7212810, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/pNFqk.jpg?s=128&g=1", "display_name": "Wireless", "link": "https://stackoverflow.com/users/7212810/wireless"}, "edited": false, "score": 0, "creation_date": 1507810167, "post_id": 46697640, "comment_id": 80364773, "body": "If you want the list to contain only isolated numbers, then you should include only those that <i>don&#39;t</i> have any close neighbors. You can use  the <code>not</code> function to negate a condition."}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": false, "score": 0, "last_activity_date": 1507756346, "creation_date": 1507756346, "answer_id": 46697640, "question_id": 46697294, "link": "https://stackoverflow.com/questions/46697294/list-number-radius-verification/46697640#46697640", "title": "List number radius verification", "body": "<p>You can use the <code>any</code> function to determine if a list contains a value that satisfies a certain predicate. For example:</p>\n\n<pre><code>any odd [1,2,3,4]   -- True\nany odd [2,4]       -- False\n</code></pre>\n\n<p>All you have to do is make a predicate function that would determine if the number lies in a radius of 5:</p>\n\n<pre><code>rAux :: Int -&gt; Bool \nrAux n = any isWithinFive inac\n    where \n        isWithinFive x = x &gt;= n-5 &amp;&amp; x &lt;= n+5\n</code></pre>\n\n<p>However, this will yield you an <em>empty</em> <code>rInac</code> list. Because every number is within radius 5 of itself, this predicate will hold for every number in the <code>inac</code> list. I suspect that what you <em>really</em> want is to check for the existence of numbers within 5 from the given number, but excluding the given number itself:</p>\n\n<pre><code>rAux :: Int -&gt; Bool \nrAux n = any isWithinFive inac\n    where \n        isWithinFive x = x /= n &amp;&amp; x &gt;= n-5 &amp;&amp; x &lt;= n+5\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 398, "user_id": 3236033, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/81b29b95c129cec714b31ee157dc47cb?s=128&d=identicon&r=PG", "display_name": "CarlEdman", "link": "https://stackoverflow.com/users/3236033/carledman"}, "is_accepted": false, "score": 0, "last_activity_date": 1507766998, "creation_date": 1507766998, "answer_id": 46699390, "question_id": 46697294, "link": "https://stackoverflow.com/questions/46697294/list-number-radius-verification/46699390#46699390", "title": "List number radius verification", "body": "<p>Assuming your list is sorted, of a Bounded type (such as Int), and you are comfortable that its values will never approach the boundaries (about +/- 2^63 on a 64 bit machine) the following code should be fairly intuitive and efficient (i.e., O(n) in constant space if the ghc optimizer is doing its job):</p>\n\n<pre><code>gapped :: Int -&gt; [Int] -&gt; [Int]\ngapped g a = map fst $ filter test $ zip a $ zip (minBound:a) (tail a ++ [maxBound])\n  where\n    test (x, (l, u)) = l+g &lt; x &amp;&amp; x &lt; u-g\n</code></pre>\n\n<p>For example, using your other code, <code>gapped 5 inac</code> yields:</p>\n\n<blockquote>\n  <p>[90,126,162,171,180,300,342,351,432,531,540,576,612,660,666,684,690,756,792,810,840,846,864,888,954,960,966,972,990,999]</p>\n</blockquote>\n\n<p>Is that the answer you were looking for?</p>\n"}], "owner": {"reputation": 117, "user_id": 7212810, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/pNFqk.jpg?s=128&g=1", "display_name": "Wireless", "link": "https://stackoverflow.com/users/7212810/wireless"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1507766998, "creation_date": 1507754921, "question_id": 46697294, "link": "https://stackoverflow.com/questions/46697294/list-number-radius-verification", "title": "List number radius verification", "body": "<p>I'm in need of your expertise once again, I find myself struggling with Haskell due to my lack of experience. I have a list (inac) and I need to check the numbers in that list so that there are none in a radius of 5 numbers, like for example, I have the number 300 in my list I check to see if there's there number 295 and 305, if there aren't then 300 goes in another list (rInac)</p>\n\n<pre><code>dig :: Int -&gt; [Int] \ndig 0 = []\ndig n = dig (n `div` 10) ++ [n `mod` 10]\n\ninac :: [Int]\ninac = [x | x &lt;- [1..999], x `mod` sum (dig x) == 0]\n\nrInac :: [Int]\nrInac = [x | x &lt;- inac, rAux x]\n\nrAux :: Int -&gt; Bool \nrAux n = n `elem` inac\n</code></pre>\n\n<p>Right now I'm only checking that the numbers (n) belong to the list, my problem is, I'm unsure of how to do the 5 radius thing...\nThanks in advance!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "edited": false, "score": 0, "creation_date": 1507754800, "post_id": 46697080, "comment_id": 80342266, "body": "Shouldn&#39;t <code>evenPlusEven ZeroEven m = n</code> be <code>evenPlusEven ZeroEven m = m</code>?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1507755946, "post_id": 46697080, "comment_id": 80342816, "body": "Writing <code>*</code> for <code>evenTimesEven</code>, <code>+</code> for <code>evenPlusEven</code>, and <code>2+</code> for <code>NextEven</code>, you have written <code>(2+n)*m = n*m + n</code>; it should be <code>(2+n)*m = n*m + m + m</code> or similar instead."}], "answers": [{"comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1507825386, "post_id": 46697284, "comment_id": 80375262, "body": "I can&#39;t get <code>evenPlusEven (evenTimesEven n m) (evenPlusEven m m)</code> to compile. Is that the solution you had in mind? <a href=\"https://ideone.com/R4gsc6\" rel=\"nofollow noreferrer\">Here&#39;s my code</a>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 2, "creation_date": 1507826093, "post_id": 46697284, "comment_id": 80375640, "body": "@4castle Associativity matters. That would make <code>(n*m)+(m+m)</code> but I guess you need <code>(((n*m)+m)+m)</code>. I don&#39;t have a solution in mind, but I would not be surprised if in such exercises some commutativity or associativity issues arise."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1507833381, "post_id": 46697284, "comment_id": 80379610, "body": "I found a typo where <code>Add (Mult n m) n</code> is supposed to be <code>Add (Mult n m) m</code>, and then I applied your fix, and now it&#39;s working!"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 7, "last_activity_date": 1507754898, "creation_date": 1507754898, "answer_id": 46697284, "question_id": 46697080, "link": "https://stackoverflow.com/questions/46697080/type-function-may-not-be-injective/46697284#46697284", "title": "Type function may not be injective", "body": "<p>Below, I'll abuse common mathematical notation.</p>\n\n<pre><code>from the context (n ~ 'S ('S n1))\n</code></pre>\n\n<p>From this, we get that <code>n = 2+n1</code>.</p>\n\n<pre><code>Expected type: Even (Mult n m)\n</code></pre>\n\n<p>We need to prove <code>n*m</code> even, i.e. <code>(2+n1)*m</code> even.</p>\n\n<pre><code>Actual type: Even (Add (Mult n1 m) n1)\n</code></pre>\n\n<p>We have proved <code>(n1*m)+n1</code> even. This is not the same. The additional term should be <code>m</code>, not <code>n1</code>, and it should be added twice.</p>\n"}], "owner": {"reputation": 853, "user_id": 3645112, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/QFHGj.jpg?s=128&g=1", "display_name": "Rainbacon", "link": "https://stackoverflow.com/users/3645112/rainbacon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 425, "favorite_count": 1, "accepted_answer_id": 46697284, "answer_count": 1, "score": 3, "last_activity_date": 1507755277, "creation_date": 1507754126, "last_edit_date": 1507755277, "question_id": 46697080, "link": "https://stackoverflow.com/questions/46697080/type-function-may-not-be-injective", "title": "Type function may not be injective", "body": "<p>I am attempting to prove some axioms about odd and even natural numbers. I am using three defined data types in my proof.</p>\n\n<pre><code>data Nat = Z | S Nat\n\ndata Even (a :: Nat) :: * where\n  ZeroEven :: Even Z\n  NextEven :: Even n -&gt; Even (S (S n))\n\ndata Odd (a :: Nat) :: * where\n  OneOdd :: Odd (S Z)\n  NextOdd :: Odd n -&gt; Odd (S (S n))\n</code></pre>\n\n<p>I also have the following type families defined for addition and multiplication.</p>\n\n<pre><code>type family   Add (n :: Nat) (m :: Nat) :: Nat\ntype instance Add Z m = m\ntype instance Add (S n) m = S (Add n m)\n\ntype family   Mult (n :: Nat) (m :: Nat) :: Nat\ntype instance Mult Z m = Z\ntype instance Mult (S n) m = Add (Mult n m) n\n</code></pre>\n\n<p>I have functions defined for proving that the sum of two evens is even and that the product of two evens is even.</p>\n\n<pre><code>evenPlusEven :: Even n -&gt; Even m -&gt; Even (Add n m)\nevenPlusEven ZeroEven m = m\nevenPlusEven (NextEven n) m = NextEven (evenPlusEven n m)\n\nevenTimesEven :: Even n -&gt; Even m -&gt; Even (Mult n m)\nevenTimesEven ZeroEven m = ZeroEven\nevenTimesEven (NextEven n) m = evenPlusEven (EvenTimesEven n m) n\n</code></pre>\n\n<p>I am using the <code>GADTs</code>, <code>DataKinds</code>, <code>TypeFamilies</code>, and <code>UndecidableInstances</code> language extension and GHC version 7.10.3. Running <code>evenPlusEven</code> gives me the results I expect, but I get an compilation error when I include <code>evenTimesEven</code>. The error is:</p>\n\n<pre><code>Could not deduce (Add (Add (Mult n1 m) n1) ('S n1)\n                  ~ Add (Mult n1 m) n1)\nfrom the context (n ~ 'S ('S n1))\n  bound by a pattern with constructor\n             NextEven :: forall (n :: Nat). Even n -&gt; Even ('S ('S n)),\n           in an equation for `evenTimesEven'\n  at OddsAndEvens.hs:71:16-25\nNB: `Add' is a type function, and may not be injective\nExpected type: Even (Mult n m)\n  Actual type: Even (Add (Mult n1 m) n1)\nRelevant bindings include\n  m :: Even m\n    (bound at OddsAndEvens.hs:71:28)\n  n :: Even n1\n    (bound at OddsAndEvens.hs:71:25)\n  evenTimesEven :: Even n -&gt; Even m -&gt; Even (Mult n m)\n    (bound at OddsAndEvens.hs:70:1)\nIn the expression: evenPlusEven (evenTimesEven n m) n\nIn an equation for `evenTimesEven':\n    evenTimesEven (NextEven n) m = evenPlusEven (evenTimesEven n m) n\n</code></pre>\n\n<p>The type family instances for <code>Mult</code> compile fine and if I replace the last line of <code>evenTimesEven</code> with an error throw I can compile the code and the function runs fine with an input of <code>ZeroEven</code> which makes me think that my instance for <code>Mult</code> is correct and my implementation of <code>evenTimesEven</code> is the problem, but I'm unsure of why.</p>\n\n<p>Shouldn't <code>Even (Mult n m)</code> and <code>Even (Add (Mult n1 m) n1)</code> have the same kind? </p>\n"}, {"tags": ["haskell", "http-conduit"], "answers": [{"comments": [{"owner": {"reputation": 660, "user_id": 3056525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ca5b6203fc7b814d6c2559be8354a0d?s=128&d=identicon&r=PG", "display_name": "TomDane", "link": "https://stackoverflow.com/users/3056525/tomdane"}, "edited": false, "score": 0, "creation_date": 1507744886, "post_id": 46694551, "comment_id": 80337243, "body": "Thank you for such an amazing answer. It works, and it helps me understand why!"}], "tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": true, "score": 13, "last_activity_date": 1507744921, "last_edit_date": 1507744921, "creation_date": 1507744102, "answer_id": 46694551, "question_id": 46694290, "link": "https://stackoverflow.com/questions/46694290/why-does-httpjson-fail-but-httplbs-succeeds/46694551#46694551", "title": "Why does httpJSON fail, but httpLBS succeeds?", "body": "<p>Compare the types of <code>httpLBS</code> and <code>httpJSON</code>:</p>\n\n<pre><code>httpLBS ::   MonadIO m              =&gt; Request -&gt; m (Response ByteString)\nhttpJSON :: (MonadIO m, FromJSON a) =&gt; Request -&gt; m (Response a         )\n</code></pre>\n\n<p>Notice that <code>httpLBS</code> <em>always</em> produces a <code>Response ByteString</code>, but <code>httpLBS</code> produces <code>Response a</code>. What does that mean?</p>\n\n<p>In this case, it means that <code>httpJSON</code> can produce a <code>Response</code> containing anything at all with a <code>FromJSON</code> instance, and it\u2019s up to the function\u2019s <em>caller</em> to decide. How does the caller decide? By specifying the type! This is one of the most interesting properties of Haskell\u2019s typeclasses: the behavior of your program is determined by its <em>types</em>.</p>\n\n<p>Of course, most of the time, you don\u2019t see those types, because they are inferred. For example, if you write the following program, you will not need to write any type annotations:</p>\n\n<pre><code>ghci&gt; id True\nTrue\n</code></pre>\n\n<p>Even though the <code>id</code> function has type <code>a -&gt; a</code>, GHC can infer that there is clearly only <em>one</em> choice for <code>a</code>, <code>Bool</code>, so it is chosen. However, consider your program\u2014how can GHC know what <code>a</code> is supposed to be? The <code>response</code> result is only used in one place, <code>getResponseStatusCode</code>, which has the following type signature:</p>\n\n<pre><code>getResponseStatusCode :: Response a -&gt; Int\n</code></pre>\n\n<p>This function also works on <em>any</em> <code>Response a</code>, so GHC still can\u2019t decide what the <code>a</code> should be: according to GHC\u2019s terminology, the <code>a</code> variable is <strong>ambiguous</strong>. The trouble is that picking a specific type for <code>a</code> is necessary, since it needs to know which <code>FromJSON</code> instance to use to parse the response body.</p>\n\n<p>In order to solve this problem, you can disambiguate the expression by supplying your own type annotation, forcing GHC to pick a particular type for <code>a</code>:</p>\n\n<pre><code>makeRequest = do\n  response &lt;- httpJSON \"http://httpbin.org/get\" :: IO (Response ())\n  putStrLn $ \"The status code was: \" ++ show (getResponseStatusCode response)\n</code></pre>\n\n<p>Of course, you should replace <code>()</code> with whatever type represents the structure of the JSON you expect the response to produce.</p>\n"}, {"tags": [], "owner": {"reputation": 2082, "user_id": 2002580, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/b2d16135241bda360d9fe3bfbfe08b0d?s=128&d=identicon&r=PG", "display_name": "BWStearns", "link": "https://stackoverflow.com/users/2002580/bwstearns"}, "is_accepted": false, "score": 0, "last_activity_date": 1552507533, "creation_date": 1552507533, "answer_id": 55150350, "question_id": 46694290, "link": "https://stackoverflow.com/questions/46694290/why-does-httpjson-fail-but-httplbs-succeeds/55150350#55150350", "title": "Why does httpJSON fail, but httpLBS succeeds?", "body": "<p>Not sure if this is helpful for anyone else but it helped me. I tried the <code>::IO (Response ())</code> annotation and I was getting back the full printed response and then <code>\"expected (), encountered Object\"</code>, and switching it to <code>:: IO (Response Object)</code> fixed it to simply output </p>\n\n<pre><code>\u03bb makeRequest\n200\nit :: ()\n</code></pre>\n"}], "owner": {"reputation": 660, "user_id": 3056525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ca5b6203fc7b814d6c2559be8354a0d?s=128&d=identicon&r=PG", "display_name": "TomDane", "link": "https://stackoverflow.com/users/3056525/tomdane"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 251, "favorite_count": 0, "accepted_answer_id": 46694551, "answer_count": 2, "score": 5, "last_activity_date": 1552507533, "creation_date": 1507743089, "last_edit_date": 1507743627, "question_id": 46694290, "link": "https://stackoverflow.com/questions/46694290/why-does-httpjson-fail-but-httplbs-succeeds", "title": "Why does httpJSON fail, but httpLBS succeeds?", "body": "<p>This function (with httpLBS) works:</p>\n\n<pre><code>makeRequest = do\n  response &lt;- httpLBS \"http://httpbin.org/get\" \n  putStrLn $ \"The status code was: \" ++ show (getResponseStatusCode response)\n</code></pre>\n\n<p>But this function (with httpJSON) does not:</p>\n\n<pre><code>makeRequest = do\n  response &lt;- httpJSON \"http://httpbin.org/get\" \n  putStrLn $ \"The status code was: \" ++ show (getResponseStatusCode response)\n</code></pre>\n\n<p>It throws the error:</p>\n\n<pre><code>Ambiguous type variable `a0' arising from a use of `httpJSON' prevents the constraint \n`(aeson-1.1.2.0:Data.Aeson.Types.FromJSON.FromJSON a0)' from being solved.\n          Probable fix: use a type annotation to specify what `a0' should be.\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 4, "creation_date": 1507740956, "post_id": 46693478, "comment_id": 80335145, "body": "Your <code>| b == 0 = &quot; &quot;</code> case fails to catch this because the <code>| l &lt; 1 = ..</code> case is checked first. You can switch their order. (It&#39;ll then fail because you try to get the head of an empty list, so you&#39;ll have to add a base case for <code>createInt [] _ = &quot;&quot;</code>)"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1507746600, "post_id": 46693478, "comment_id": 80338144, "body": "I understand that you may be new to Haskell, but please consider reading the <a href=\"https://github.com/tibbe/haskell-style-guide/blob/master/haskell-style.md\" rel=\"nofollow noreferrer\">style guide</a>. This is not good code."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 8, "creation_date": 1507748417, "post_id": 46693478, "comment_id": 80339101, "body": "@AJFarmar I don&#39;t think that is the right thing at all to worry about when you&#39;re learning a new language with lots of new concepts and writing programs just for your own education. A style guide matters for programs that need to be maintained."}], "answers": [{"tags": [], "owner": {"reputation": 202, "user_id": 6606280, "user_type": "registered", "profile_image": "https://graph.facebook.com/1773944566177231/picture?type=large", "display_name": "Mahmoud S. Marwad", "link": "https://stackoverflow.com/users/6606280/mahmoud-s-marwad"}, "is_accepted": false, "score": 0, "last_activity_date": 1583008502, "last_edit_date": 1583008502, "creation_date": 1583006970, "answer_id": 60469187, "question_id": 46693478, "link": "https://stackoverflow.com/questions/46693478/is-there-a-continue-in-haskell/60469187#60469187", "title": "Is there a &quot;continue&quot; in Haskell?", "body": "<p>I think the Algorithm you use is not correct, and you made it more complicated than it needs to be.</p>\n\n<p>Also the list was not complete, I added 90 and 900 cases.</p>\n\n<p>Have a look at this code .. I think it's very simple and you will get it easily.</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>import qualified Data.Map as M\n\n    mapInttoRoman:: M.Map Int String\n    mapInttoRoman = M.fromList\n              [(1,\"I\"),(4,\"IV\"),(5,\"V\"),(9,\"IX\"),(10,\"X\"),(40,\"XL\")\n              ,(50,\"L\"),(90,\"XC\"),(100,\"C\"),(400,\"CD\"),(500,\"D\"),(900,\"CM\"),(1000,\"M\")]\n\n    intToRoman :: Int -&gt; String\n    intToRoman 0 = \"\"\n    intToRoman n | M.member n mapInttoRoman = mapInttoRoman M.! n\n                 | otherwise = val ++ intToRoman (n-key) \n                 where\n                    keys = reverse (M.keys mapInttoRoman)\n                    key  = maxValidKey n keys\n                    val  = mapInttoRoman M.! key\n                    maxValidKey n (k:ks) \n                      | n &gt;= k = k\n                      | otherwise = maxValidKey n ks \n</code></pre>\n\n<p>Tests :</p>\n\n<p><a href=\"https://i.stack.imgur.com/2KHIA.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/2KHIA.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 137, "user_id": 8383476, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/66893da737c29fad8518f5fed5827587?s=128&d=identicon&r=PG&f=1", "display_name": "ProPall", "link": "https://stackoverflow.com/users/8383476/propall"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 927, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1583008502, "creation_date": 1507739983, "last_edit_date": 1507750188, "question_id": 46693478, "link": "https://stackoverflow.com/questions/46693478/is-there-a-continue-in-haskell", "title": "Is there a &quot;continue&quot; in Haskell?", "body": "<p>I've recently started learning Haskell and currently trying to writing basic Haskell functions.</p>\n\n<p>I've written a function called <code>intToRoman</code> which should convert Integer number to Roman number. It divides the number in list of integers ( 1400 ->[1,4,0,0])  and converts every number into the Roman number taking into the account length of list to determine whenever is a thousand or hundred.</p>\n\n<p>However, it doesn't stop and checks zeros as well. For instance, number 1400 will return:</p>\n\n<pre><code> MCD** Exception: Map.!: given key is not an element in the map\n CallStack (from HasCallStack)\n</code></pre>\n\n<p>Here is the code itself:</p>\n\n<pre><code>mapInttoRoman:: M.Map Int String\nmapInttoRoman = M.fromList\n          [(1,\"I\"),(4,\"IV\"),(5,\"V\"),(9,\"IX\"),(10,\"X\"),(40,\"XL\")\n          ,(50,\"L\"),(100,\"C\"),(400,\"CD\"),(900,\"CM\"),(500,\"D\"),(1000,\"M\")]\n\nlistOfInt :: Int -&gt; [Int]\nlistOfInt 0 = [ ]\nlistOfInt c = listOfInt(c`div`10) ++ [c`mod`10]\n\nduplicate :: String -&gt; Int -&gt; String\nduplicate string n = concat $ replicate n string\n\nintToRoman :: Int -&gt; String\nintToRoman 0 = \"\"\nintToRoman c = createInt x (len-1)\n where x = listOfInt c\n       len = length x\n       createInt y xz = findRoman (head y) xz ++ createInt(drop 1 y)(xz-1)\n        where findRoman b l\n               | l &lt; 1      = mapInttoRoman M.! b\n               | b == 0     = \" \"\n               | l == 3     = duplicate (mapInttoRoman M.! (10^l)) b\n               | b == 1     = mapInttoRoman M.! (10^l)\n               | otherwise  = mapInttoRoman M.! (b*10^l)\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "compiler-optimization"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1507734392, "post_id": 46691651, "comment_id": 80330991, "body": "Nope. Doesn&#39;t matter. The definition makes it extremely clear that nothing was missed, but for lists that really isn&#39;t a big deal."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1507734658, "post_id": 46691651, "comment_id": 80331162, "body": "Also, you could define <code>null = all (const False)</code>. Perhaps that would be clearer."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1507734746, "post_id": 46691822, "comment_id": 80331227, "body": "It is <i>not</i> less efficient. The compiler <i>always</i> optimizes this."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1507734894, "post_id": 46691822, "comment_id": 80331350, "body": "@dfeuer: this is a weird claim, since no specific compiler is mentioned. I can write a Haskell compiler the other day that does not do this. My claim is not that a good compiler does not optimizes this. The idea is only that a syntactically, the former is less efficient. :)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1507736700, "post_id": 46691822, "comment_id": 80332621, "body": "There&#39;s no such thing as &quot;syntactically less efficient&quot;. Decent compilers of statically typed languages with algebraic data types always do a good job of this. Remember that the compiler has to check that each constructor has the right type; while it&#39;s at it, it can easily check that all are present. This is much more complicated for GADTs, but those aren&#39;t relevant here."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1507737547, "post_id": 46691822, "comment_id": 80333161, "body": "If we want to be that pedantic, then &quot;Haskell will warn about incomplete patterns&quot; is also wrong-ish, since one can write a compiler which does not warn about that :-P. Worse, GHC does not warn about that by default. (I really wish non-exhaustive patterns were an error). Still, I always use <code>-Wall</code>, and the warning is very helpful, so I can understand the value of being explicit in the last pattern (even though I frequently write <code>_</code> there)."}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 0, "creation_date": 1507737660, "post_id": 46691822, "comment_id": 80333234, "body": "I agree with dfeuer. When you pattern match on <code>[]</code> you&#39;re checking whether the argument isn&#39;t cons. Hence, the second pattern match is free. You could either use a wildcard or you could write the pattern explicitly. It wouldn&#39;t matter. A good compiler like GHC would optimize it. If you think about it it&#39;s a pretty trivial thing to optimize."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 1, "creation_date": 1507737937, "post_id": 46691822, "comment_id": 80333392, "body": "@AaditMShah: yes of course. The problem is that my professor in Logic once told me that &quot;a compiler&quot; does not imply &quot;a decent compiler&quot; :) Of course this is pretty trivial. The point is that we can not say much about efficiency of matching, since as far as I know, nowhere in the specs of the language is it stated that this should be optimized that way."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1507737982, "post_id": 46691822, "comment_id": 80333419, "body": "@chi: fixed, better? :)"}, {"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 0, "creation_date": 1507977744, "post_id": 46691822, "comment_id": 80433226, "body": "@WillemVanOnsem It is indeed so, that the pattern compiler is happy when it sees all data constructors of the type in question, and they are applied to  variables only."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 5, "last_activity_date": 1507737893, "last_edit_date": 1507737893, "creation_date": 1507734660, "answer_id": 46691822, "question_id": 46691651, "link": "https://stackoverflow.com/questions/46691651/why-is-the-definition-of-null-function-in-haskell-prelude-so-strange/46691822#46691822", "title": "Why is the definition of null function in Haskell Prelude so strange?", "body": "<blockquote>\n  <p>Does it have anything to do with the compiler optimization?</p>\n</blockquote>\n\n<p>No, in fact one can say that writing <code>null (_:_)</code> is less efficient than <code>null any</code> (in case the compiler does not optimizes this), since now you ask Haskell to verify that it is indeed the \"cons\". Although if a compiler does some bookkeeping on data types, it is of course easy to optimize this away. As far as I know, most compilers like <code>ghc</code> and almost <em>all compilers not written by three year old kids</em> indeed will do this.</p>\n\n<p>First of all it is better <strong>not</strong> to write a wilcard <code>_</code> (or name it <code>any</code>) since the definition of a list (and any other datatype might change). Although for a list the odds are very unlikely, it could be possible that someone redefines a list. For instance like:</p>\n\n<pre><code>data [a] = [] | (a:[a]) | (Int///[a])\n</code></pre>\n\n<p>where for instance the latter pattern means that the list is repeated a number of times. In that case, a <em>compiler not written by a three year old kid :)</em> will warn that about <em>incomplete patterns for <code>null</code></em>: it will thus claim that the <code>(_///_)</code> pattern was not specified. Whereas if you use a wildcard, it will fallback to the <code>null any</code> case.</p>\n\n<p>In general one better uses wildcards with care: only in case you really do not care about what is given to the function, you should use wildcards.</p>\n"}], "owner": {"reputation": 619, "user_id": 7697142, "user_type": "registered", "accept_rate": 14, "profile_image": "https://graph.facebook.com/1778499455800981/picture?type=large", "display_name": "Leonard Ge", "link": "https://stackoverflow.com/users/7697142/leonard-ge"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 219, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1507737893, "creation_date": 1507734185, "question_id": 46691651, "link": "https://stackoverflow.com/questions/46691651/why-is-the-definition-of-null-function-in-haskell-prelude-so-strange", "title": "Why is the definition of null function in Haskell Prelude so strange?", "body": "<p>The definition of <code>null</code> function in <a href=\"https://www.haskell.org/onlinereport/standard-prelude.html\" rel=\"noreferrer\">Prelude</a> is the following:</p>\n\n<pre><code>null             :: [a] -&gt; Bool\nnull []          =  True\nnull (_:_)       =  False\n</code></pre>\n\n<p>What confused me is the third line of the definition, why does it write:</p>\n\n<pre><code>null(_:_)        = False\n</code></pre>\n\n<p>Instead of:</p>\n\n<pre><code>null any = False\n</code></pre>\n\n<p>Does it have anything to do with the compiler optimization?</p>\n"}, {"tags": ["haskell", "recursion"], "answers": [{"comments": [{"owner": {"reputation": 509, "user_id": 3134946, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/198952b24b7de8ec7329d3a3f46d7bc0?s=128&d=identicon&r=PG&f=1", "display_name": "Ryba", "link": "https://stackoverflow.com/users/3134946/ryba"}, "edited": false, "score": 0, "creation_date": 1507804374, "post_id": 46693697, "comment_id": 80361206, "body": "Ok, i see why it hangs, but what do you mean by generalizing <code>moeb</code> using <code>mfix</code>?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 509, "user_id": 3134946, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/198952b24b7de8ec7329d3a3f46d7bc0?s=128&d=identicon&r=PG&f=1", "display_name": "Ryba", "link": "https://stackoverflow.com/users/3134946/ryba"}, "edited": false, "score": 0, "creation_date": 1507807632, "post_id": 46693697, "comment_id": 80363172, "body": "A simple one would be <code>moebM f x = mfix $ \\g -&gt; f ($ g) x</code> . Use <code>traverse</code> as the first argument, but <code>test</code> will need to change to a different type."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 1, "last_activity_date": 1507798688, "last_edit_date": 1507798688, "creation_date": 1507740761, "answer_id": 46693697, "question_id": 46691287, "link": "https://stackoverflow.com/questions/46691287/moeb-traverse-non-termination/46693697#46693697", "title": "moeb traverse non-termination", "body": "<p><code>moeb traverse test :: State Int [Int]</code> is an <em>action</em> to produce a list of integers.</p>\n\n<p>If you unfold the definition of <code>moeb</code>, you get</p>\n\n<pre><code>moeb traverse test\n  = traverse ($ moeb traverse test) test\n</code></pre>\n\n<p>meaning that each element f the spreadsheet is passed the <em>action</em> <code>moeb traverse test</code> to be run, from scratch, instead of using the result of the action recursively.</p>\n\n<p>Generalizing <code>moeb</code> using <code>mfix</code> might help but I doubt the result will be worth the trouble.</p>\n"}], "owner": {"reputation": 509, "user_id": 3134946, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/198952b24b7de8ec7329d3a3f46d7bc0?s=128&d=identicon&r=PG&f=1", "display_name": "Ryba", "link": "https://stackoverflow.com/users/3134946/ryba"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 46693697, "answer_count": 1, "score": 2, "last_activity_date": 1507798688, "creation_date": 1507733248, "last_edit_date": 1507739663, "question_id": 46691287, "link": "https://stackoverflow.com/questions/46691287/moeb-traverse-non-termination", "title": "moeb traverse non-termination", "body": "<p>I've recently stumbled upon <code>loeb</code> and <code>moeb</code> functions <a href=\"https://github.com/quchen/articles/blob/master/loeb-moeb.md\" rel=\"nofollow noreferrer\">here</a> and I'm trying to explore what it can do.</p>\n\n<p>I'm trying to achieve spreadsheet-like behaviour with possibility to perform <code>IO</code> in some \"cells\". I was thinking that <code>moeb traverse</code> seemed like good candidate do do this, but any non-trivial (ie. other than <code>const $ return something</code>) function in list I used caused the entire call to run forever. After this I tried to test it in <code>State</code> monad:</p>\n\n<pre><code>moeb f x = fix $ \\g -&gt; f ($g) x\n\nfoo v = do\n    x &lt;- get\n    vs &lt;- v\n    put (x + 3)\n    return (x + (vs!!0))\n\ntest = [\n    const $ return 7,\n    foo,\n    fmap length\n]\n\nmain = print $ runState (moeb traverse test) 5\n</code></pre>\n\n<p>The result was this:</p>\n\n<pre><code>([7,12,3],moeb.hs: out of memory\n</code></pre>\n\n<p>Why does this happen? <code>foo</code> both gets and sets state, but it evaluates fine, while evaluation of final state hangs.\nAnd how can i achieve spreadsheet-with-IO behavior that terminates? </p>\n"}, {"tags": ["haskell", "random"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1507742385, "post_id": 46686633, "comment_id": 80335879, "body": "It&#39;s not totally clear to me what you&#39;re asking yet. Let me propose a few things you could be asking, and see what you think. You could be asking to draw uniformly at random from among the set of <a href=\"https://en.wikipedia.org/wiki/Partition_(number_theory)\" rel=\"nofollow noreferrer\">partitions</a> of a given number and of a given size. Or you could be asking to draw uniformly at random from among the set of ways to put a given number of (unlabeled) balls into a given number of (labeled) boxes. (...or the other three variations with other choices of labeled/unlabeled for boxes and balls.)"}, {"owner": {"reputation": 16237, "user_id": 2166798, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/417356917295f5176d2a3e7c21d8f9e8?s=128&d=identicon&r=PG", "display_name": "pjs", "link": "https://stackoverflow.com/users/2166798/pjs"}, "edited": false, "score": 0, "creation_date": 1507742665, "post_id": 46686633, "comment_id": 80336028, "body": "See <a href=\"https://stackoverflow.com/a/31814348/2166798\">stackoverflow.com/a/31814348/2166798</a> for a possible answer.  The implementation is Python, but the algorithm is straightforward."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1507742710, "post_id": 46686633, "comment_id": 80336053, "body": "(Come to think of it, probably selecting uniformly from among partitions is the same as selecting uniformly from among ways to put unlabeled balls into unlabeled boxes, up to some rejiggering of the parameters.)"}, {"owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "reply_to_user": {"reputation": 16237, "user_id": 2166798, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/417356917295f5176d2a3e7c21d8f9e8?s=128&d=identicon&r=PG", "display_name": "pjs", "link": "https://stackoverflow.com/users/2166798/pjs"}, "edited": false, "score": 0, "creation_date": 1507745626, "post_id": 46686633, "comment_id": 80337615, "body": "@pjs Yes, that&#39;s what I wanted. Can you explain why differences add up to <code>n</code>?"}, {"owner": {"reputation": 16237, "user_id": 2166798, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/417356917295f5176d2a3e7c21d8f9e8?s=128&d=identicon&r=PG", "display_name": "pjs", "link": "https://stackoverflow.com/users/2166798/pjs"}, "edited": false, "score": 0, "creation_date": 1507746563, "post_id": 46686633, "comment_id": 80338116, "body": "@user1685095 Because the total length of the range [0, n] is n, and the differences are like the lengths of sticks (or strings, or rulers), which span the total range when placed end-to-end."}, {"owner": {"reputation": 16237, "user_id": 2166798, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/417356917295f5176d2a3e7c21d8f9e8?s=128&d=identicon&r=PG", "display_name": "pjs", "link": "https://stackoverflow.com/users/2166798/pjs"}, "edited": false, "score": 0, "creation_date": 1507746867, "post_id": 46686633, "comment_id": 80338278, "body": "Concrete example:  I want 4 values that add to 20.  I generate 3 random numbers to split the range into 4 intervals, perhaps (18, 7, 12).  I add 0 and 20 and sort, to get (0, 7, 12, 18, 20).  The successive differences are (7, 5, 6, 2).  Voila, there are 4 of them and they sum to 20!"}, {"owner": {"reputation": 16237, "user_id": 2166798, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/417356917295f5176d2a3e7c21d8f9e8?s=128&d=identicon&r=PG", "display_name": "pjs", "link": "https://stackoverflow.com/users/2166798/pjs"}, "edited": false, "score": 0, "creation_date": 1507747326, "post_id": 46686633, "comment_id": 80338540, "body": "Another way to think of the prior example is that I&#39;m summing (7 - 0) + (12 - 7) + (18 - 12) + (20 - 18).  A moment&#39;s inspection will show that all the values other than 0 and 20 occur with both plus and minus signs, so they cancel out, leaving you with the total = (20 - 0) = 20."}, {"owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "reply_to_user": {"reputation": 16237, "user_id": 2166798, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/417356917295f5176d2a3e7c21d8f9e8?s=128&d=identicon&r=PG", "display_name": "pjs", "link": "https://stackoverflow.com/users/2166798/pjs"}, "edited": false, "score": 0, "creation_date": 1507750342, "post_id": 46686633, "comment_id": 80339982, "body": "@pjs Oh, I get it. I missed adding <code>[0, n]</code>."}, {"owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "reply_to_user": {"reputation": 16237, "user_id": 2166798, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/417356917295f5176d2a3e7c21d8f9e8?s=128&d=identicon&r=PG", "display_name": "pjs", "link": "https://stackoverflow.com/users/2166798/pjs"}, "edited": false, "score": 0, "creation_date": 1507793856, "post_id": 46686633, "comment_id": 80354759, "body": "@pjs I guess if you would make an answer with Haskell version I would accept it. Thanks for you help!"}, {"owner": {"reputation": 16237, "user_id": 2166798, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/417356917295f5176d2a3e7c21d8f9e8?s=128&d=identicon&r=PG", "display_name": "pjs", "link": "https://stackoverflow.com/users/2166798/pjs"}, "edited": false, "score": 0, "creation_date": 1507814026, "post_id": 46686633, "comment_id": 80367533, "body": "Since I don&#39;t know Haskell, that would be a challenge.  Glad if that helped though."}], "answers": [{"comments": [{"owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "edited": false, "score": 0, "creation_date": 1507721064, "post_id": 46686985, "comment_id": 80321353, "body": "What I want is the second answer to this question <a href=\"https://stackoverflow.com/questions/2640053/getting-n-random-numbers-that-the-sum-is-m\" title=\"getting n random numbers that the sum is m\">stackoverflow.com/questions/2640053/&hellip;</a> adapted to work with integers instead of floating point numbers."}, {"owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "edited": false, "score": 0, "creation_date": 1507721163, "post_id": 46686985, "comment_id": 80321422, "body": "I&#39;m not sure how can I make this clearer <code>producing list of random numbers that sums up into some number</code>. For example let&#39;s say I have number <code>10</code> and I need three integers that would sum up to this number <code>[3, 3, 4]</code>"}, {"owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "edited": false, "score": 0, "creation_date": 1507724321, "post_id": 46686985, "comment_id": 80323498, "body": "I&#39;m sorry, but this is a very bad solution. It takes a lot of time to compute even for length of capacity of <code>100</code>. The solution from my link is much better. Can you help to adapt it to haskell and Integers? I think about splitting floating points into integer and fractional part and them somehow distribute this fractional parts so that the result would sum equally to given number."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 0, "last_activity_date": 1507722205, "last_edit_date": 1507722205, "creation_date": 1507720960, "answer_id": 46686985, "question_id": 46686633, "link": "https://stackoverflow.com/questions/46686633/how-to-split-list-in-evenly-random-chunks/46686985#46686985", "title": "How to split list in evenly random chunks?", "body": "<p>It's not quite clear to me what you want to do, but if you want a uniform distribution between a minimum and a maximum, you can use <code>randomRs</code>:</p>\n\n<pre><code>Prelude&gt; :m +System.Random\nPrelude System.Random&gt; g &lt;- newStdGen\nPrelude System.Random&gt; take 10 $ randomRs (10, 100) g\n[48,93,21,50,84,57,25,80,68,18]\n</code></pre>\n\n<hr>\n\n<p>If you want these random numbers to sum to a particular number, you can basically start picking from the left until you get close enough. The <code>inits</code> function could help you with that:</p>\n\n<pre><code>Prelude System.Random&gt; :m +Data.List\nPrelude System.Random Data.List&gt; take 10 $ inits $ randomRs (10, 100) g\n[[],[48],[48,93],[48,93,21],[48,93,21,50],[48,93,21,50,84],[48,93,21,50,84,57],\n[48,93,21,50,84,57,25],[48,93,21,50,84,57,25,80],[48,93,21,50,84,57,25,80,68]]\n</code></pre>\n\n<p>Instead of <code>take 10</code>, you could start going through this list of lists until you find one that's close enough. For instance, you could calculate the sum of all of those lists:</p>\n\n<pre><code>Prelude System.Random Data.List&gt; fmap sum $ take 10 $ inits $ randomRs (10, 100) g\n[0,48,141,162,212,296,353,378,458,526]\n</code></pre>\n\n<p>So, if you're aiming for, say, 500, you can see that the ninth sum is 458, whereas the tenth sum is too high. In other words, the first nine numbers will get you to 458. How will you reach 500?</p>\n\n<p>One option is simply to to say that then the last number has to be 500 - 458 = 42, but then I'm not sure that the distribution counts as perfectly uniform any longer, because the last number is deterministic.</p>\n\n<p>Another option would be to keep generating random numbers until you have a sequence that's a perfect fit.</p>\n\n<p>Since I don't know the exact requirements, I can't advice on which way would be best.</p>\n\n<p>In the above example, I used <code>fmap sum</code> to illustrate my point. The problem with this is that by doing this, you throw away the numbers that generated the sum. As far as I understand, you actually want those numbers, so you'll probably need a more complicated left fold that both calculates the sum, while still remembering the numbers that produced it. You can use <code>foldl</code> or <code>foldl'</code> for that.</p>\n"}], "owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 231, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1507722253, "creation_date": 1507719885, "last_edit_date": 1507722253, "question_id": 46686633, "link": "https://stackoverflow.com/questions/46686633/how-to-split-list-in-evenly-random-chunks", "title": "How to split list in evenly random chunks?", "body": "<pre><code>sizes :: StdGen -&gt; Int -&gt; Int -&gt; [Int]\nsizes g c 0 = []\nsizes g c b = a : (sizes g' (c - a) (b - 1)) where\n    (a, g') = randomR (1, c - b) g   \n\nmain = do\n    g &lt;- newStdGen\n    print $ sizes g 100 10\n</code></pre>\n\n<p>I've gotten this problem down to problem of producing list of random numbers that sums up into some number.</p>\n\n<p>This code basically works, but numbers doesn't seem to be evenly distributed (for example <code>[7,46,3,4,26,8,1,2,1,1]</code>).</p>\n\n<p>They tend to be big at the start and then getting smaller in the end. The reason for it quite obvious from the code.</p>\n\n<p>What I'd like to have is something like <code>[8, 6, 10, 4, 15..]</code> where the numbers aren't that different from each other.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 2, "creation_date": 1507719847, "post_id": 46678148, "comment_id": 80320638, "body": "an equivalent definition is <code>compose g f x = g (f x)</code>. it means, wherever in your code you see the left-hand side of that equation, you can use its right-hand side, with the actual arguments substituted for the corresponding parameters. nothing more to it than that."}], "owner": {"reputation": 77, "user_id": 8453107, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0c7515e106e298934473ed3faaf3062c?s=128&d=identicon&r=PG&f=1", "display_name": "JavaDeveloper", "link": "https://stackoverflow.com/users/8453107/javadeveloper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 1, "closed_date": 1507685776, "answer_count": 0, "score": 1, "last_activity_date": 1507688315, "creation_date": 1507683723, "last_edit_date": 1507688315, "question_id": 46678148, "link": "https://stackoverflow.com/questions/46678148/difficulty-understanding-the-below-function-in-haskell", "closed_reason": "Duplicate", "title": "Difficulty understanding the below function in haskell", "body": "<pre><code>compose :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; (a -&gt; c)\ng `compose` f = \\x-&gt; g (f x)\n</code></pre>\n\n<p>I have mentioned the function with the type declaration\nCan anyone tell me how the above function would work ??\nI know compose takes two functions and gives us another function</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1507706083, "post_id": 46678083, "comment_id": 80311729, "body": "Don\u2019t use floor, use div."}], "answers": [{"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 2, "last_activity_date": 1507683723, "creation_date": 1507683723, "answer_id": 46678147, "question_id": 46678083, "link": "https://stackoverflow.com/questions/46678083/finding-gaps-in-a-list-of-numbers/46678147#46678147", "title": "Finding &quot;gaps&quot; in a list of numbers", "body": "<p>An easy, though not very efficient, way would be to make a helper function which checks whether there is an element of a list within a certain range:</p>\n\n<pre><code>hasElemInRange :: (Int,Int) -&gt; [Int] -&gt; Bool\nhasElemInRange (lo, hi) xs = -- left as exercise\n</code></pre>\n\n<p>(hint: you can use the <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Prelude.html#v:any\" rel=\"nofollow noreferrer\"><code>any</code></a> function)</p>\n\n<p>and then you can include it in your list comprehension:</p>\n\n<pre><code>let rare = [ x | x &lt;- ina, hasElemInRange (x-5,x+5) ina ]\n</code></pre>\n\n<hr>\n\n<p>Another idiom that you might consider is zipping a list with its own tail.  So you can do:</p>\n\n<pre><code>ghci&gt; let xs = [1,2,3,4,5,6,7]\nghci&gt; zip3 xs (tail xs) (tail (tail xs))\n[(1,2,3),(2,3,4),(3,4,5),(4,5,6),(5,6,7)]\n</code></pre>\n\n<p>Which will give you each element of the list with its \"context\", the element just before and after.  Maybe you can figure out how to use that for what you need.</p>\n"}], "owner": {"reputation": 57, "user_id": 8752268, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209630376667858/picture?type=large", "display_name": "Jo&#227;o Santos", "link": "https://stackoverflow.com/users/8752268/jo%c3%a3o-santos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1507683977, "creation_date": 1507683182, "last_edit_date": 1507683977, "question_id": 46678083, "link": "https://stackoverflow.com/questions/46678083/finding-gaps-in-a-list-of-numbers", "title": "Finding &quot;gaps&quot; in a list of numbers", "body": "<p>I'm having trouble with going through a list. I made this code which gives me a list of numbers which are evenly divided by the sum of their digits. For example, consider the number 123: 123/6 = 20.5, so it will not be in the list. One the other hand 280 will be on the list, because 280/10 = 28.</p>\n\n<pre><code>let inaHelper x = (floor(x)`mod`10)+ (floor(x/10)`mod`10)+(floor(x/100)`mod`10)\n\nlet ina = [x | x &lt;- [1..999] , x `mod` (inaHelper x) == 0  ]  \n</code></pre>\n\n<p><code>[1,2,3,4,5,6,7,8,9,10,12,18,20,21,24,27,30,36,40,42,45,48,50,54,60,63,70,72,80,81,84,90,100,102,108,110,111,112,114,117,120,126,132,133,135,140,144,150,152,153,156,162,171,180,190,192,195,198,200,201,204,207,209,210,216,220,222,224,225,228,230,234,240,243,247,252,261,264,266,270,280,285,288,300,306,308,312,315,320,322,324,330,333,336,342,351,360,364,370,372,375,378,392,396,399,400,402,405,407,408,410,414,420,423,432,440,441,444,448,450,460,465,468,476,480,481,486,500,504,506,510,511,512,513,516,518,522,531,540,550,552,555,558,576,588,592,594,600,603,605,612,621,624,629,630,640,644,645,648,660,666,684,690,700,702,704,711,715,720,730,732,735,736,738,756,770,774,777,780,782,792,800,801,803,804,810,820,825,828,832,840,846,864,870,874,880,882,888,900,902,910,912,915,918,935,936,954,960,966,972,990,999]</code></p>\n\n<p>But my problem now is: from the list above I only want the numbers that will not have a \"neighbour\" within a gap of 5 units. For example, the number 300 will be in the new list because it's neighbors (288 and 306) are not within the 5 unit gap.</p>\n\n<p>I came up it this code:</p>\n\n<pre><code>let rare = [ x | x &lt;- [ina]  , ((x-5) &gt;= [ina-1]) &amp;&amp; ((x+5) &lt;= [ina+1])    ]\n</code></pre>\n\n<p>I'm a beginner, can someone help?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1507686087, "post_id": 46677991, "comment_id": 80305124, "body": "I suspect you misunderstand the meaning of the type <code>(Argument -&gt; b -&gt; Predicate) -&gt; b -&gt; [Argument]</code>. As written, the caller of <code>qWho</code>, not the implementer, gets to choose <code>b</code>. If I decide I want to call <code>qWho</code> and hand it a <code>Argument -&gt; Int -&gt; Predicate</code> function and an <code>Int</code>, or decide I want to call <code>qWho</code> and hand it a <code>Argument -&gt; (forall f. Contrapunctor f =&gt; f Whoziwhatsit -&gt; Prepromorphism) -&gt; Predicate</code> and a <code>forall f. Contrapunctor f =&gt; f Whoziwhatsit -&gt; Prepromorphism</code>, well, you as the implementor of <code>qWho</code> just have to Deal With It."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1507686273, "post_id": 46677991, "comment_id": 80305178, "body": "Are you <i>sure</i> <code>qWho</code> is correct? As it stand, just <code>qWho :: (Argument -&gt; b -&gt; Predicate) -&gt; b -&gt; [Argument]</code> and <code>qWho rel arg@(Argument x y) = ...</code> are already at odds with each other. If you have a <code>b</code> without a constraint on it, it can not only be an <code>Argument</code> or a <code>Predicate</code> - it can be anything! Furthermore, the first line of the pattern match is saying that the <code>b</code> <i>has</i> to be an <code>Argument</code> (which is also what the error message is telling you)."}, {"owner": {"reputation": 999, "user_id": 6137760, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8deb9e6ab542c0dc522da27d7769d5e3?s=128&d=identicon&r=PG&f=1", "display_name": "Mike S", "link": "https://stackoverflow.com/users/6137760/mike-s"}, "edited": false, "score": 0, "creation_date": 1507686489, "post_id": 46677991, "comment_id": 80305235, "body": "I was planning on matching more patterns. Having a <code>qWho rel pred@(Predicate x y) = ...</code> for <code>b</code> as a <code>Predicate</code> and a <code>qWho _ _ = ...</code> to handle incorrect patterns. Would that not solve the problem?"}, {"owner": {"reputation": 999, "user_id": 6137760, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8deb9e6ab542c0dc522da27d7769d5e3?s=128&d=identicon&r=PG&f=1", "display_name": "Mike S", "link": "https://stackoverflow.com/users/6137760/mike-s"}, "edited": false, "score": 0, "creation_date": 1507687077, "post_id": 46677991, "comment_id": 80305372, "body": "Oh, wait, so I think I realize the issue now. I was doing something like declaring a function <code>foo :: b -&gt; Bool</code>, then writing a bunch of patterns that match specific things that <code>b</code> can be, like <code>foo 1 = ...; foo &#39;a&#39; = ...;foo etc.</code>. Which is illegal. Is that it?"}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1507688666, "post_id": 46678724, "comment_id": 80305736, "body": "This makes much more sense. Good job!"}], "tags": [], "owner": {"reputation": 999, "user_id": 6137760, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8deb9e6ab542c0dc522da27d7769d5e3?s=128&d=identicon&r=PG&f=1", "display_name": "Mike S", "link": "https://stackoverflow.com/users/6137760/mike-s"}, "is_accepted": true, "score": 2, "last_activity_date": 1507688216, "creation_date": 1507688216, "answer_id": 46678724, "question_id": 46677991, "link": "https://stackoverflow.com/questions/46677991/rigid-type-error/46678724#46678724", "title": "Rigid type error", "body": "<p>Solved it thanks to @DanielWagner and @Alec</p>\n\n<p>Instead of trying to match patterns, I declared two instances (not sure that's the right way to say it) of the type class <code>Who</code>:</p>\n\n<pre><code>class Who b where\n    qWho :: (Argument -&gt; b -&gt; Predicate) -&gt; b -&gt; [Argument]\n\ninstance Who Argument where\n    qWho rel arg = ...\n\ninstance Who Predicate where\n    qWho rel p = ...\n</code></pre>\n"}], "owner": {"reputation": 999, "user_id": 6137760, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8deb9e6ab542c0dc522da27d7769d5e3?s=128&d=identicon&r=PG&f=1", "display_name": "Mike S", "link": "https://stackoverflow.com/users/6137760/mike-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 46678724, "answer_count": 1, "score": 1, "last_activity_date": 1527878621, "creation_date": 1507682430, "last_edit_date": 1527878621, "question_id": 46677991, "link": "https://stackoverflow.com/questions/46677991/rigid-type-error", "title": "Rigid type error", "body": "<p>I have the following code:</p>\n\n<pre><code>data Argument  = Argument  { ttype :: Type, value :: String }\ndata Predicate = Predicate { lemma     :: String\n                           , arguments :: [Argument] }\n\nclass Throw a where\n    throw :: a -&gt; a -&gt; Predicate\n\ninstance Throw Argument where\n    throw x y = Predicate { lemma = \"throw\", arguments = [x, y] }\n\nqWho :: (Argument -&gt; b -&gt; Predicate) -&gt; b -&gt; [Argument]\nqWho rel arg@(Argument x y) = STUFF HAPPENS HERE\nqWho OTHER PATTERNS HAPPEN HERE\n</code></pre>\n\n<p>The idea is that <code>b</code> in the <code>qWho</code> signature can either be an <code>Argument</code> or a <code>Predicate</code> (in the case of the first pattern, an <code>Argument</code>), and will act accordingly. The problem is, when I try to compile it, I get the following error:</p>\n\n<pre><code>context.hs:162:11: error:\n    \u2022 Couldn't match expected type \u2018b\u2019 with actual type \u2018Argument\u2019\n      \u2018b\u2019 is a rigid type variable bound by\n        the type signature for:\n          qWho :: forall b. (Argument -&gt; b -&gt; Predicate) -&gt; b -&gt; [Argument]\n        at context.hs:161:1-55\n    \u2022 In the pattern: Argument x y\n      In an equation for \u2018qWho\u2019:\n          qWho rel (Argument x y)\n            = STUFF I'M LEAVING OUT FOR BREVITY'S SAKE\n    \u2022 Relevant bindings include\n        rel :: Argument -&gt; b -&gt; Predicate (bound at context.hs:162:6)\n        qWho :: (Argument -&gt; b -&gt; Predicate) -&gt; b -&gt; [Argument]\n          (bound at context.hs:162:1)\n</code></pre>\n\n<p>Any ideas why I'm getting this error? Also, FYI, I'm brand new to Haskell, and this is part of an assignment, so while I'm not looking to have the assignment done for me, I'm just looking for the reason behind the error. Finally, all the above code (except <code>qWho</code>) was provided as part of the assignment, so the solution probably shouldn't be that I have to change that part! :D</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "elm", "servant"], "comments": [{"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "edited": false, "score": 1, "creation_date": 1507683619, "post_id": 46677608, "comment_id": 80304523, "body": "The servant docs on <code>PlainText</code> use the value <code>text&#47;plain;charset=utf-8</code> as an example. Have you tried that as the MIME type?"}, {"owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "reply_to_user": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "edited": false, "score": 0, "creation_date": 1507683803, "post_id": 46677608, "comment_id": 80304562, "body": "@ChadGilbert <code>text&#47;plain;charset=utf-8</code> did it. Thank you for the comment!"}], "answers": [{"tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 2, "last_activity_date": 1507683899, "creation_date": 1507683899, "answer_id": 46678173, "question_id": 46677608, "link": "https://stackoverflow.com/questions/46677608/how-to-specify-body-media-type-for-elm-post-request/46678173#46678173", "title": "How to specify body media type for Elm post request?", "body": "<p>The servant documentation for <a href=\"http://hackage.haskell.org/package/servant-0.11/docs/Servant-API-ContentTypes.html#t:PlainText\" rel=\"nofollow noreferrer\"><code>PlainText</code></a> indicates that you should send <code>text/plain;charset=utf-8</code> as the MIME type instead of <code>text/plain</code>.</p>\n"}], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 0, "accepted_answer_id": 46678173, "answer_count": 1, "score": 2, "last_activity_date": 1507683899, "creation_date": 1507679108, "last_edit_date": 1507679480, "question_id": 46677608, "link": "https://stackoverflow.com/questions/46677608/how-to-specify-body-media-type-for-elm-post-request", "title": "How to specify body media type for Elm post request?", "body": "<p>I am trying to make a post request using <code>Elm</code> and get the following 'Unsupported Media Type' error output by my server.</p>\n\n<pre><code>POST /users/1/badges\n  Request Body: M09991\n  Accept: */*\n  Status: 415 Unsupported Media Type 0.003431047s\n</code></pre>\n\n<p>My (<a href=\"https://hackage.haskell.org/package/servant\" rel=\"nofollow noreferrer\">servant</a>) server is set to use <a href=\"http://hackage.haskell.org/package/servant-0.11/docs/Servant-API-ContentTypes.html#t:PlainText\" rel=\"nofollow noreferrer\"><code>PlainText</code></a> to receive the body and I wonder if I am specifying this content type properly in Elm. The code of my post request in Elm is as follows.</p>\n\n<pre><code>postUserBadge : ServerConfig.AdminContext -&gt; Int -&gt; String -&gt; Cmd Msg\npostUserBadge context userId licenseNumber =\n    Http.send PostUserBadge &lt;|\n        postRequest context.baseContext\n                    (\"/users/\" ++ toString userId ++ \"/badges\")\n                    (Http.stringBody \"text/plain\" licenseNumber)\n                    decodeUserBadge\n</code></pre>\n\n<p>There I use <code>Http.stringBody \"text/plain\"</code> to specify the request body's content type. The string <code>\"text/plain\"</code> I got from <a href=\"https://en.wikipedia.org/wiki/Media_type\" rel=\"nofollow noreferrer\">wikipedia's Media type page</a>; I have not found how to specify Media type in Elm's documentation.</p>\n\n<p>Is this the correct way to specify the plaintext media type in this Elm post request? Is there some other error in my code causing this Http 415 error?</p>\n"}, {"tags": ["haskell", "stream"], "answers": [{"tags": [], "owner": {"reputation": 13121, "user_id": 805266, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/eabce8cd59f72d8f9e7db06a0343bdb1?s=128&d=identicon&r=PG", "display_name": "nponeccop", "link": "https://stackoverflow.com/users/805266/nponeccop"}, "is_accepted": false, "score": 3, "last_activity_date": 1507677837, "creation_date": 1507677837, "answer_id": 46677444, "question_id": 46677144, "link": "https://stackoverflow.com/questions/46677144/io-streams-partitioneithers/46677444#46677444", "title": "io-streams partitionEithers", "body": "<p>Sometimes the right question contains the answer. So it's possible indeed:</p>\n\n<pre><code>contrapartitionEithers\n  :: OutputStream b -&gt; OutputStream c -&gt; IO (OutputStream (Either b c))\ncontrapartitionEithers b c = makeOutputStream $ maybe\n     (writeTo b Nothing &gt;&gt; writeTo c Nothing)\n     (either (writeTo b . Just) (writeTo c . Just))\n</code></pre>\n"}], "owner": {"reputation": 13121, "user_id": 805266, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/eabce8cd59f72d8f9e7db06a0343bdb1?s=128&d=identicon&r=PG", "display_name": "nponeccop", "link": "https://stackoverflow.com/users/805266/nponeccop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1507677837, "creation_date": 1507675647, "question_id": 46677144, "link": "https://stackoverflow.com/questions/46677144/io-streams-partitioneithers", "title": "io-streams partitionEithers", "body": "<p>I have a worker function</p>\n\n<pre><code>worker :: a -&gt; Either b c\n</code></pre>\n\n<p>and I want to apply it to a stream of <code>a</code> and produce 2 streams of <code>b</code> and <code>c</code> and process those streams further. For example, I want to accumulate <code>c</code> in a <code>Map</code> (essentially to fold the stream) and output <code>b</code> to <code>stderr</code>.</p>\n\n<p>How can I achieve this with <code>io-streams</code>? It seems I cannot call <code>connect</code> twice. So I have to put it before the partitioning, so the partitioning will operate on <code>OutputStream</code> in a \"contravariant\" way:</p>\n\n<pre><code>contrapartitionEithers\n  :: OutputStream b -&gt; OutputStream c -&gt; IO (OutputStream (Either b c))\n</code></pre>\n\n<p>Is it implementable? If no, how can do the task at hand? If yes, is is somehow \"dual\" to <code>System.IO.Streams.zip</code>?</p>\n\n<pre><code>System.IO.Streams.zip\n  :: InputStream a -&gt; InputStream b -&gt; IO (InputStream (a, b))\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 3, "creation_date": 1507669183, "post_id": 46675885, "comment_id": 80300145, "body": "Why are you trying to instantiate something that isn&#39;t a type class?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1507669238, "post_id": 46675885, "comment_id": 80300178, "body": "Either instantiate <code>Num Interval</code> (might not be a good idea) or define your functions outside a type class instance."}, {"owner": {"reputation": 116, "user_id": 8734249, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2a3e854c354971b3b4d5da55d267df3d?s=128&d=identicon&r=PG&f=1", "display_name": "Zhurik", "link": "https://stackoverflow.com/users/8734249/zhurik"}, "edited": false, "score": 0, "creation_date": 1507669355, "post_id": 46675885, "comment_id": 80300254, "body": "What do You mean? Sorry for dumb questions in advance, because I&#39;m pretty new to functional programming."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1507671001, "post_id": 46676214, "comment_id": 80300963, "body": "Just for fun: the way the original poster defined their <code>(+)</code> and <code>(-)</code> (that is, infix) also works once your proposed fix is implemented. That is, <code>instance Num Interval {- your fix -} where (Interval a b) + (Interval c d) {- their syntax for defining + -} = Interval (a + c) (b + d)</code> works just fine. I would even leave out the parentheses on the left, writing <code>Interval a b + Interval c d = ...</code>."}], "tags": [], "owner": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "is_accepted": true, "score": 8, "last_activity_date": 1507670363, "creation_date": 1507670363, "answer_id": 46676214, "question_id": 46675885, "link": "https://stackoverflow.com/questions/46675885/is-not-a-visible-method-of-class/46676214#46676214", "title": "&#39;+&#39; is not a visible method of class", "body": "<p>You are mixing up data type definitions and type classes.</p>\n\n<pre><code>data Interval = Interval Float Float\n</code></pre>\n\n<p>defines a new datatype <code>Interval</code>, but</p>\n\n<pre><code>instance Interval Float Float where\n</code></pre>\n\n<p>would be the attempt to create an instance of a type class <code>Interval</code>.</p>\n\n<p>I'm not sure what you intended, but if you wanted to make your type <code>Interval</code> conform to the <code>Num</code> type class which offers operators like <code>(+)</code> etc. Then you would write:</p>\n\n<pre><code>data Interval = Interval Float Float \n\ninstance Num Interval where\n  (+) (Interval a b) (Interval c d) = Interval (a + c) (b + d)\n  (-) (Interval a b) (Interval c d) = Interval (a - d) (b - c)\n</code></pre>\n\n<p>Note that you need to implement more functions for a full instance of <code>Num</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 2, "last_activity_date": 1507675765, "last_edit_date": 1507675765, "creation_date": 1507670494, "answer_id": 46676234, "question_id": 46675885, "link": "https://stackoverflow.com/questions/46675885/is-not-a-visible-method-of-class/46676234#46676234", "title": "&#39;+&#39; is not a visible method of class", "body": "<p><strong>What You Did</strong></p>\n\n<pre><code>data Interval = Interval Float Float \n</code></pre>\n\n<p>Here you are saying <code>Interval</code> is a type with one constructor (also named <code>Interval</code>) which has two unnamed fields of type <code>Float</code>.</p>\n\n<pre><code>instance Interval Float Float where\n</code></pre>\n\n<p>Here you are saying <code>Interval</code> is a type class (NOT A TYPE) that takes two type parameters which you have supplied as <code>Float</code>s.  This implies there is a line somewhere that reads <code>class Interval a b where ...</code>.</p>\n\n<pre><code>(Interval a b) + (Interval c d) = Interval (a + c) (b + d)\n(Interval a b) - (Interval c d) = Interval (a - c) (b - d)\n</code></pre>\n\n<p>Here, assuming you ment to indent, you are defining two functions that are methods of the <code>Interval</code> type class (which doesn't exist) and those methods are named <code>+</code> and <code>-</code>.</p>\n\n<p><strong>What You Might Have Intended</strong></p>\n\n<p>I think you wanted to define a type, Interval, and you did.</p>\n\n<p>I think you wanted to define addition and subtraction which are methods of the <code>Num</code> type class:</p>\n\n<pre><code>instance Num Interval where\n    (Interval a b) + (Interval x y) = Interval (a + b) (x + y)\n    ...\n</code></pre>\n"}], "owner": {"reputation": 116, "user_id": 8734249, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2a3e854c354971b3b4d5da55d267df3d?s=128&d=identicon&r=PG&f=1", "display_name": "Zhurik", "link": "https://stackoverflow.com/users/8734249/zhurik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3623, "favorite_count": 0, "accepted_answer_id": 46676214, "answer_count": 2, "score": 2, "last_activity_date": 1578352907, "creation_date": 1507668991, "last_edit_date": 1578352907, "question_id": 46675885, "link": "https://stackoverflow.com/questions/46675885/is-not-a-visible-method-of-class", "title": "&#39;+&#39; is not a visible method of class", "body": "<p>I'm trying to make custom structure in Haskell like this:</p>\n\n<pre><code>data Interval = Interval Float Float \ninstance Interval Float Float where\n(Interval a b) + (Interval c d) = Interval (a + c) (b + d)\n(Interval a b) - (Interval c d) = Interval (a - c) (b - d)\n</code></pre>\n\n<p>But everytime errors occur like: </p>\n\n<blockquote>\n  <p>'+' is not a visible method of class 'Interval' <br/></p>\n</blockquote>\n\n<p>So how should I make it properly?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 1, "last_activity_date": 1507668660, "creation_date": 1507668660, "answer_id": 46675791, "question_id": 46675716, "link": "https://stackoverflow.com/questions/46675716/retrieving-values-from-a-created-type-in-haskell/46675791#46675791", "title": "Retrieving values from a created type in Haskell", "body": "<p>Type synonyms (such as <code>SchoolClass</code>) behave <strong>exactly</strong> like the types that they represent, so it's simple:</p>\n\n<pre><code>getIntFromClass :: SchoolClass -&gt; Int\ngetIntFromClass (i, _) = i\n</code></pre>\n\n<p>This is actually the same as the <code>fst</code> function, which has type <code>(a,b) -&gt; a</code>, ie it gets the first member of a 2-tuple. So you could just write:</p>\n\n<pre><code>getIntFromClass = fst\n</code></pre>\n\n<p>If you need help with <code>data</code> and <code>type</code>, read the <a href=\"http://learnyouahaskell.com/making-our-own-types-and-typeclasses\" rel=\"nofollow noreferrer\">LYAH chapter on the subject</a>.</p>\n"}], "owner": {"reputation": 103, "user_id": 7299999, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89356d13edb456935f7f2b45ba10dc57?s=128&d=identicon&r=PG&f=1", "display_name": "s4342re41", "link": "https://stackoverflow.com/users/7299999/s4342re41"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 0, "accepted_answer_id": 46675791, "answer_count": 1, "score": 0, "last_activity_date": 1507668660, "creation_date": 1507668406, "question_id": 46675716, "link": "https://stackoverflow.com/questions/46675716/retrieving-values-from-a-created-type-in-haskell", "title": "Retrieving values from a created type in Haskell", "body": "<p>If I create a type, for example <code>type SchoolClass = (Int,Char)</code> , how can I retrieve just the Int from a SchoolClass variable? I could create a function that takes a SchoolClass variable as an argument, however, is there a simple solution to this built into Haskell already? Sorry if it's a simple question, I couldn't find the right search terms to get an answer and I am really new to Haskell.\nThanks</p>\n"}, {"tags": ["sorting", "haskell", "recursion", "tail-recursion", "anagram"], "comments": [{"owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "edited": false, "score": 0, "creation_date": 1507668742, "post_id": 46675455, "comment_id": 80299910, "body": "Try adding explicit type signatures to your functions. GHC&#39;s error messages should (hopefully) help you find the problem with your code. Also, in Haskell you can write a function with 2 arguments (<code>f :: (a, b) -&gt; c</code>) as a curried function (<code>f :: a -&gt; b -&gt; c</code>)"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1507668744, "creation_date": 1507668744, "answer_id": 46675813, "question_id": 46675455, "link": "https://stackoverflow.com/questions/46675455/creating-a-function-for-checking-anagrams-in-haskell/46675813#46675813", "title": "Creating a function for checking anagrams in Haskell", "body": "<p>Nice start!</p>\n\n<p>The minimal change needed to make this compile is to replace <code>nil</code> with <code>[]</code> everywhere, and to wrap parentheses around the argument to <code>find</code>. So:</p>\n\n<pre><code>-- change one\nfind (a,[]) = []\n\n-- change two\nlistana [] = []\n</code></pre>\n\n<p>There are many improvements available from there. I encourage you to poke through the <code>Data.List</code> module and see if any of the functions implemented there look useful. There is also a standard trick that uses <code>Data.Map</code> to group together items that makes this a one-liner; see <a href=\"https://stackoverflow.com/a/12398993/791604\">another answer of mine</a> for a hint.</p>\n"}], "owner": {"reputation": 1, "user_id": 7874499, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-_mSqmghbjnc/AAAAAAAAAAI/AAAAAAAAEpE/A1lBwnFZL30/photo.jpg?sz=128", "display_name": "Aadil Kumar", "link": "https://stackoverflow.com/users/7874499/aadil-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 642, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1507668744, "creation_date": 1507667383, "question_id": 46675455, "link": "https://stackoverflow.com/questions/46675455/creating-a-function-for-checking-anagrams-in-haskell", "title": "Creating a function for checking anagrams in Haskell", "body": "<p>So I'm trying to create a function that takes a list of words and returns the anagrams in a new list. This is what I have so far:</p>\n\n<pre><code>quicksort :: Ord a =&gt; [a] -&gt; [a]\nquicksort []     = []\nquicksort (p:xs) = (quicksort lesser) ++ [p] ++ (quicksort greater)\n    where\n        lesser  = filter (&lt; p) xs\n        greater = filter (&gt;= p) xs\n\nsub(a,[]) = []\nsub(a,b:c) = if a == b then c else b:(sub(a,c))\n\nsublist([],a) = a\nsublist(a:b,c) = sublist(b,sub(a,c))\n\nanagram a b = quicksort (a) == quicksort (b)\n\nfind a,[] = nil\nfind (a, b:c) = if anagram a b then b:(find(a,c)) else find(a,c)\n\nlistana [] = nil\nlistana (a:c) = list:(listana(sublist(list,a:c)))\n              where list = a:(find(a,c))\n</code></pre>\n\n<p>I'm pretty sure there is a problem with my find function.\nOh and I'm new to Haskell so please go easy on me. </p>\n"}, {"tags": ["haskell", "decimal", "rounding"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1507665901, "post_id": 46675016, "comment_id": 80298458, "body": "do you just want to have it printed up to the 6decimal point or do you want numbers with only 6 positions after the comma."}, {"owner": {"reputation": 475, "user_id": 6346482, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh4.googleusercontent.com/-pejxz6NLUb0/AAAAAAAAAAI/AAAAAAAAAHI/N2mNSw_SLzs/photo.jpg?sz=128", "display_name": "DORpapst", "link": "https://stackoverflow.com/users/6346482/dorpapst"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1507666347, "post_id": 46675016, "comment_id": 80298667, "body": "I want to use numbers rounded with 6 positions as x n. So no printing, it should be the internal number."}], "answers": [{"comments": [{"owner": {"reputation": 475, "user_id": 6346482, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh4.googleusercontent.com/-pejxz6NLUb0/AAAAAAAAAAI/AAAAAAAAAHI/N2mNSw_SLzs/photo.jpg?sz=128", "display_name": "DORpapst", "link": "https://stackoverflow.com/users/6346482/dorpapst"}, "edited": false, "score": 0, "creation_date": 1507667863, "post_id": 46675428, "comment_id": 80299455, "body": "Yes sure you are right. But how do I solve the problem itself? The function which you see will return just the number itself. So x 5 = 5, x 53 = 53 and so on. Normally without those binary problems."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "reply_to_user": {"reputation": 475, "user_id": 6346482, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh4.googleusercontent.com/-pejxz6NLUb0/AAAAAAAAAAI/AAAAAAAAAHI/N2mNSw_SLzs/photo.jpg?sz=128", "display_name": "DORpapst", "link": "https://stackoverflow.com/users/6346482/dorpapst"}, "edited": false, "score": 0, "creation_date": 1507668334, "post_id": 46675428, "comment_id": 80299686, "body": "Sorry, I don&#39;t understand what you are trying to do. You asked to round the number to 6dp, so I gave you a function to do that. Try adding it to your source code and then calling it from within <code>x</code>."}, {"owner": {"reputation": 475, "user_id": 6346482, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh4.googleusercontent.com/-pejxz6NLUb0/AAAAAAAAAAI/AAAAAAAAAHI/N2mNSw_SLzs/photo.jpg?sz=128", "display_name": "DORpapst", "link": "https://stackoverflow.com/users/6346482/dorpapst"}, "edited": false, "score": 0, "creation_date": 1507668804, "post_id": 46675428, "comment_id": 80299944, "body": "Sorry, I just saw half of your answer. Seems like you edited later. Thank you for your answer! :)"}], "tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": false, "score": 4, "last_activity_date": 1586547941, "last_edit_date": 1586547941, "creation_date": 1507667257, "answer_id": 46675428, "question_id": 46675016, "link": "https://stackoverflow.com/questions/46675016/haskell-round-number/46675428#46675428", "title": "Haskell Round Number", "body": "<p>Your problem is not Haskell, it's the binary representation of floating point numbers. Any language will give you similar results.</p>\n\n<p>Saying that you want to \"round\" to a certain number of decimal digits is tricky because the binary representation for many decimal values is not exact. <code>0.1</code> decimal, for instance, is <code>0.000110011001100110011...</code> recurring. For more about the details of floating point numbers and the headaches they can cause you should read <em><a href=\"http://www.itu.dk/~sestoft/bachelor/IEEE754_article.pdf\" rel=\"nofollow noreferrer\">What every computer scientist should know about floating point</a></em>.</p>\n\n<p>To see why binary fractions cause problems, consider <code>1/3 + 1/3 + 1/3</code>.  Obviously that is equal to 1. But if you round to 3 decimal places you get <code>0.333 + 0.333 + 0.333 = 0.999</code>. Look familiar?</p>\n\n<p>Now try evaluating <code>[0,0.1..1]</code></p>\n\n<p>You can get approximately what you want by multiplying by <code>1e6</code>, rounding to the nearest integer, and dividing by <code>1e6</code>. You say you don't want to \"parse\" to an Int, but it's the only way to do this. The reason I say that you only get approximately what you want is that obviously if your number rounds to <code>0.1</code> then you still only get an approximation instead of the exact value. </p>\n\n<p>A function to round to 6 decimal places in Haskell would be</p>\n\n<pre><code>round6dp :: Double -&gt; Double\nround6dp x = fromIntegral (round $ x * 1e6) / 1e6\n\n&gt; round6dp pi\n3.141593\n</code></pre>\n\n<p>Also, you might try importing <code>Data.Ratio</code> and replacing the type <code>Double</code> with <code>Rational</code> in your code. Rational numbers are expressed as a ratio between two integers, so you can represent 1/3 exactly. Haskell uses <code>%</code> as the ratio operator to distinguish it from normal division, so you can evaluate <code>1%3 / 3%2</code>.  If you do this then your code gives the right answer.</p>\n"}, {"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1507787629, "post_id": 46675628, "comment_id": 80351729, "body": "If you end up using <code>quantize</code> then you should consider if you actually want <code>round</code> vs <code>floor</code> or <code>ceiling</code> or another rounding method.  Notice <code>round</code> in Haskell is bankers rounding - it has nice properties in certain contexts but is sometimes unexpected."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1507799644, "post_id": 46675628, "comment_id": 80358146, "body": "@ThomasM.DuBuisson you almost certainly don&#39;t want <code>floor</code> or <code>ceiling</code> if this is at all a sensible floating-point application. OTOH, whether you use banker&#39;s rounding or round-to-zero for <code>.5</code> hits should make virtually no difference, because these values would turn up only neglectably seldom (in \u211d \u2013 which is what you should be modelling with the FP numbers \u2013 they&#39;re in fact a null set)."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1507669006, "last_edit_date": 1507669006, "creation_date": 1507668075, "answer_id": 46675628, "question_id": 46675016, "link": "https://stackoverflow.com/questions/46675016/haskell-round-number/46675628#46675628", "title": "Haskell Round Number", "body": "<p>First off, that function will easily go wrong. You're recursing down a floating-point number; if you miss <code>1</code> it'll just continue decreasing, down to -\u221e (or in fact, down to -9\u00d710<sup>15</sup>, because from that point, decrementing by one won't actually change the float value anymore and it'll just loop on forever). So, it should actually be</p>\n\n<pre><code>x :: Double -&gt; Double\nx n\n | n&gt;1        = ((n-1)/3 + 1/(n-1)) * ((x (n-1))^2) - (n-1)^3/3 + 1\n | otherwise  = 1\n</code></pre>\n\n<p>Next, if you're troubled by the deviations from the expected exact results... <a href=\"https://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html\" rel=\"nofollow noreferrer\">welcome to the world of floating point</a>! There are plenty of good uses for FP, but in none of them it should matter if there's a discrepancy at the 15th decimal. If this does matter for you, you should <em>not</em> use any floats, but make the signature</p>\n\n<pre><code>x :: Rational -&gt; Rational\n</code></pre>\n\n<p>and immediately the results will be exact, though they'll appear in notation that looks a bit weird:</p>\n\n<pre><code>*Main&gt; x &lt;$&gt; [1..3]\n[1 % 1,2 % 1,3 % 1]\n</code></pre>\n\n<p>Now, all that said, there are ways to just <em>suppress the symptoms</em> of floating point. What you've asked for, \u201crounding a number internally\u201d, can be achieved like thus:</p>\n\n<pre><code>quantize\u2081\u2080 :: Int -&gt; Double -&gt; Double\nquantize\u2081\u2080 n x = fromIntegral (round $ x * \u03b7) / \u03b7\n where \u03b7 = 10^n\n</code></pre>\n\n<p>then (with <code>x :: Double -&gt; Double</code> again)</p>\n\n<pre><code>*Main&gt; quantize\u2081\u2080 6 . x &lt;$&gt; [1..3]\n[1.0,2.0,3.0]\n</code></pre>\n\n<p>I would strongly recommend against this \u2013 again, if you find this kind of manipulation necessary, you probably shouldn't be using floating-point numbers at all.</p>\n\n<p>A more reasonable thing would be to just have the <em>string output</em> rounded, without doing anything about the numbers themselves. The traditional way for this is C's <code>printf</code>, which also exists in Haskell:</p>\n\n<pre><code>*Main Text.Printf&gt; printf \"%.6f\\n\" $ x 3\n3.000000\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 5, "last_activity_date": 1565284859, "last_edit_date": 1565284859, "creation_date": 1507669268, "answer_id": 46675952, "question_id": 46675016, "link": "https://stackoverflow.com/questions/46675016/haskell-round-number/46675952#46675952", "title": "Haskell Round Number", "body": "<p>You may used the <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Fixed.html#t:Fixed\" rel=\"nofollow noreferrer\"><code>Fixed</code></a> type for arithmetic with a fixed precision after the decimal point. There is even <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Fixed.html#t:Micro\" rel=\"nofollow noreferrer\">a type synonym for six decimal digits of precision</a>. For example, let's define:</p>\n\n<pre><code>x :: (Eq a, Fractional a) =&gt; a -&gt; a\nx 1 = 1\nx n = ((n-1)/3 + 1/(n-1)) * ((x (n-1))^2) - (n-1)^3/3 + 1\n</code></pre>\n\n<p>Now we can try it in <code>ghci</code> with six digits of precision:</p>\n\n<pre><code>Data.Fixed&gt; x &lt;$&gt; [1,2,3,4] :: [Micro]\n[1.000000,2.000000,2.999998,3.999981]\n</code></pre>\n\n<p>Of course, using fewer digits of precision doesn't actually help! You can't fix rounding errors by using <em>less</em> precision, only more. So, why not go for full precision? Since you are only using operations that need <code>Fractional</code>, you can use <code>Rational</code> for exact arithmetic. In ghci:</p>\n\n<pre><code>&gt; x &lt;$&gt; [1,2,3,4] :: [Rational]\n[1 % 1,2 % 1,3 % 1,4 % 1]\n</code></pre>\n\n<p>Perfect! (Read <code>%</code> as division.)</p>\n"}, {"comments": [{"owner": {"reputation": 934, "user_id": 7459445, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GBpx1.png?s=128&g=1", "display_name": "Claude", "link": "https://stackoverflow.com/users/7459445/claude"}, "edited": false, "score": 1, "creation_date": 1507670894, "post_id": 46676019, "comment_id": 80300933, "body": "note that Data.Scientific&#39;s Fractional instance diverges (crashes) when dividing yields repeating decimals - it&#39;s more for safe I/O of untrusted numbers"}], "tags": [], "owner": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "is_accepted": false, "score": 0, "last_activity_date": 1507669515, "creation_date": 1507669515, "answer_id": 46676019, "question_id": 46675016, "link": "https://stackoverflow.com/questions/46675016/haskell-round-number/46676019#46676019", "title": "Haskell Round Number", "body": "<p>As already explained, your problem is the finite precision used to represent numbers in computers. For higher precision floating point numbers you might want to have a look at the package <a href=\"https://hackage.haskell.org/package/scientific-0.3.5.2/docs/Data-Scientific.html\" rel=\"nofollow noreferrer\">Data.Scientific</a></p>\n"}, {"tags": [], "owner": {"reputation": 934, "user_id": 7459445, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GBpx1.png?s=128&g=1", "display_name": "Claude", "link": "https://stackoverflow.com/users/7459445/claude"}, "is_accepted": false, "score": 2, "last_activity_date": 1507670690, "creation_date": 1507670690, "answer_id": 46676274, "question_id": 46675016, "link": "https://stackoverflow.com/questions/46675016/haskell-round-number/46676274#46676274", "title": "Haskell Round Number", "body": "<p>As leftroundabout says, you should probably use <code>Rational</code> for your calculation to be exact.  Rounding after the fact will cause troubles.</p>\n\n<p>However, you can use <a href=\"https://hackage.haskell.org/package/numbers-3000.2.0.1/docs/Data-Number-BigFloat.html\" rel=\"nofollow noreferrer\">Data.Number.BigFloat</a> from the <code>numbers</code> package, it provides decimal floating point with a configurable precision.  This answers your question of \"how to round to 6 significant decimal figures\", as long as you remain in a type precise enough (eg <code>Rational</code> or <code>BigFloat</code> with a same or higher precision).  Converting back to <code>Double</code> (for example) will just give you problems again.</p>\n\n<p>It may be useful in some circumstances to do exact calculations with <code>Rational</code>, then convert to <code>Decimal6</code> only for rounding (and then back to <code>Rational</code> again).</p>\n\n<p>Example code:</p>\n\n<pre><code>{-# LANGUAGE NoMonomorphismRestriction #-}\nimport Data.Number.BigFloat\n\ntype Prec6 = EpsDiv10 (EpsDiv10 (EpsDiv10 (EpsDiv10 (EpsDiv10 Eps1))))\ntype Decimal6 = BigFloat Prec6\n\ndecimal6 :: Decimal6 -&gt; Decimal6\ndecimal6 = id\n\ndouble :: Double -&gt; Double\ndouble = id\n\nfixed = print . decimal6 . realToFrac\n\nbroken = print . double . realToFrac . decimal6 . realToFrac\n\nexamples :: [Double]\nexamples = [pi, exp pi, exp (exp pi), exp (negate (exp pi))]\n\nx 1 = 1\nx n = ((n-1)/3 + 1/(n-1)) * ((x (n-1))^2) - (n-1)^3/3 + 1\n\ntestx = print . x\n\nmain :: IO ()\nmain = do\n  putStrLn \"fixed:\"  &gt;&gt; mapM_ fixed examples\n  putStrLn \"broken:\" &gt;&gt; mapM_ broken examples\n  putStrLn \"Rational:\" &gt;&gt; mapM_ testx [1 .. 3 :: Rational]\n  -- no Enum instance for BigFloat, so can't use [..] syntax at that type\n  putStrLn \"Decimal6:\" &gt;&gt; mapM_ (testx . decimal6 . fromInteger) [1 .. 3]\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>fixed:\n3.14159e0\n2.31407e1\n1.12169e10\n8.91509e-11\nbroken:\n3.1415929203539825\n23.14070351758794\n1.1216931216931217e10\n8.915094339622642e-11\nRational:\n1 % 1\n2 % 1\n3 % 1\nDecimal6:\n1.00000e0\n2.00000e0\n3.00000e0\n</code></pre>\n"}], "owner": {"reputation": 475, "user_id": 6346482, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh4.googleusercontent.com/-pejxz6NLUb0/AAAAAAAAAAI/AAAAAAAAAHI/N2mNSw_SLzs/photo.jpg?sz=128", "display_name": "DORpapst", "link": "https://stackoverflow.com/users/6346482/dorpapst"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4245, "favorite_count": 1, "answer_count": 5, "score": 0, "last_activity_date": 1586547941, "creation_date": 1507665669, "last_edit_date": 1507741830, "question_id": 46675016, "link": "https://stackoverflow.com/questions/46675016/haskell-round-number", "title": "Haskell Round Number", "body": "<p>I have a haskell function which looks like that:</p>\n\n<pre><code>x 1 = 1 :: Double\nx n = ((n-1)/3 + 1/(n-1)) * ((x (n-1))^2) - (n-1)^3/3 + 1 :: Double\n</code></pre>\n\n<p>Don't think about the formula, it should just add one, so x 2 = 2; x 3 = 3 and so on.\nBut the results in Haskell are:</p>\n\n<pre><code>*Main&gt; x 2\n2.0\n*Main&gt; x 3\n2.9999999999999996\n*Main&gt; x 4\n3.9999999999999964\n*Main&gt; \n</code></pre>\n\n<p>Can someone tell me, what I need to add in line number two so it is round the number to 6 decimal digits?\nI don't want to parse to int! </p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "ghc", "ghci", "exponential"], "answers": [{"comments": [{"owner": {"reputation": 128, "user_id": 4944538, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/0mlcq.jpg?s=128&g=1", "display_name": "trunks1ace", "link": "https://stackoverflow.com/users/4944538/trunks1ace"}, "edited": false, "score": 0, "creation_date": 1507664500, "post_id": 46674563, "comment_id": 80297741, "body": "is there a way to do the same thing without changing the signature ? thanks"}, {"owner": {"reputation": 15799, "user_id": 404556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f32018ce9b9c7fb9c7587eba9e4dad4?s=128&d=identicon&r=PG", "display_name": "randomir", "link": "https://stackoverflow.com/users/404556/randomir"}, "reply_to_user": {"reputation": 128, "user_id": 4944538, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/0mlcq.jpg?s=128&g=1", "display_name": "trunks1ace", "link": "https://stackoverflow.com/users/4944538/trunks1ace"}, "edited": false, "score": 0, "creation_date": 1507664576, "post_id": 46674563, "comment_id": 80297781, "body": "No, if the return type is limited in size (64-bits), you can&#39;t return the unlimited <code>Integer</code> type.."}], "tags": [], "owner": {"reputation": 15799, "user_id": 404556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f32018ce9b9c7fb9c7587eba9e4dad4?s=128&d=identicon&r=PG", "display_name": "randomir", "link": "https://stackoverflow.com/users/404556/randomir"}, "is_accepted": false, "score": 3, "last_activity_date": 1507664027, "creation_date": 1507664027, "answer_id": 46674563, "question_id": 46674485, "link": "https://stackoverflow.com/questions/46674485/i-am-getting-different-results-when-running-my-haskell-code-interactively-using/46674563#46674563", "title": "I am getting different results when running my Haskell code interactively using ghci and when loading it as a module", "body": "<p>You define <code>modPow</code> as <code>Int -&gt; Int -&gt; Int -&gt; Int</code>, i.e. it accepts and returns <code>Int</code>s (64-bit integers), therefore all operations are modulo 64 bits.</p>\n\n<p>When you execute the expression manually, GHCI upcasts your numbers to <code>Integer</code> (which is unlimited in size), producing the correct output.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 4, "last_activity_date": 1507664209, "creation_date": 1507664209, "answer_id": 46674607, "question_id": 46674485, "link": "https://stackoverflow.com/questions/46674485/i-am-getting-different-results-when-running-my-haskell-code-interactively-using/46674607#46674607", "title": "I am getting different results when running my Haskell code interactively using ghci and when loading it as a module", "body": "<p>Look at the type of the expression you use:</p>\n\n<pre><code>&gt; :t (13481503^2 `mod` 46340)^(11237126 `div` 2)\n(13481503^2 `mod` 46340)^(11237126 `div` 2) :: Integral a =&gt; a\n</code></pre>\n\n<p><code>ghci</code> defaults to <code>Integer</code> when forced to evaluate a value of type <code>Integral a =&gt; a</code> (as happens with the implicit call to <code>show</code> by the interactive interpreter), whereas your function returns an <code>Int</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 1, "last_activity_date": 1507665209, "last_edit_date": 1507665209, "creation_date": 1507664883, "answer_id": 46674785, "question_id": 46674485, "link": "https://stackoverflow.com/questions/46674485/i-am-getting-different-results-when-running-my-haskell-code-interactively-using/46674785#46674785", "title": "I am getting different results when running my Haskell code interactively using ghci and when loading it as a module", "body": "<p>You're raising something to the power of 5,618,563. That's an <em>enormous</em> number. The biggest number you can represent with <code>Int</code> (assuming it's a signed 64 bit integer) is <code>(2 ^ 63) - 1</code>. Since 5,618,563 > 63, anything raised to the power of five million can't fit in an <code>Int</code> (unless the \"anything\" is 1, 0, or -1). So <code>modPow :: Int -&gt; Int -&gt; Int -&gt; Int</code> will be overflowing</p>\n\n<p>Entering the same operations <em>without</em> a type signature will default to <code>Integer</code>, which is not limited to 64 bits the way <code>Int</code>. So the calculation will not overflow and will give the true result. That happens whether you did it in a module or in GHCi; you've misdiagnosed what the significant difference between your two tests was.</p>\n"}], "owner": {"reputation": 128, "user_id": 4944538, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/0mlcq.jpg?s=128&g=1", "display_name": "trunks1ace", "link": "https://stackoverflow.com/users/4944538/trunks1ace"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1535350772, "creation_date": 1507663701, "last_edit_date": 1535350772, "question_id": 46674485, "link": "https://stackoverflow.com/questions/46674485/i-am-getting-different-results-when-running-my-haskell-code-interactively-using", "title": "I am getting different results when running my Haskell code interactively using ghci and when loading it as a module", "body": "<p>Code loaded from .hs file:    </p>\n\n<pre><code>modPow :: Int -&gt; Int -&gt; Int -&gt; Int\nmodPow a k m = (a^2 `mod` m)^(k `div` 2)\n</code></pre>\n\n<p>code entered interactively:</p>\n\n<pre><code>(13481503^2 `mod` 46340)^(11237126 `div` 2)\n</code></pre>\n\n<p>i.e <code>a = 13481503</code>, <code>k = 11237126</code>, <code>m = 46340</code></p>\n\n<p>The former returns a completely different number when called in ghci with the same values i.e <code>modPow 13481503 11237126 46340</code>                </p>\n"}, {"tags": ["haskell", "typeclass", "separation-of-concerns", "hindley-milner"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1507655898, "post_id": 46672275, "comment_id": 80293211, "body": "The <code>SupportsCRUD</code> class declaration involves three type variables, <code>m</code>, <code>c</code>, and <code>a</code>. Can you say what values you expect the compiler to infer for these three variables in your example, and why?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1507656066, "post_id": 46672275, "comment_id": 80293294, "body": "What did you intend by your fundep <code>m a -&gt; c</code>? What that means is &quot;the choice of <code>c</code> is uniquely determined by the specific types <code>m</code> and <code>a</code>&quot;, which has the effect that the type checker can choose an instance based on only <code>m</code> and <code>a</code> in context, and the <code>c</code> follows from whatever you&#39;ve put in the instance head."}, {"owner": {"reputation": 101, "user_id": 2956862, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a98d1070955892f73cd199b521b2ab33?s=128&d=identicon&r=PG&f=1", "display_name": "bloxx", "link": "https://stackoverflow.com/users/2956862/bloxx"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1507657224, "post_id": 46672275, "comment_id": 80293938, "body": "@jberryman It actually should tell the compiler that for the monad m and the &quot;CRUD entity&quot; a, the type checker can choose a unique monad c (this is the one supporting the CRUD operations)."}, {"owner": {"reputation": 101, "user_id": 2956862, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a98d1070955892f73cd199b521b2ab33?s=128&d=identicon&r=PG&f=1", "display_name": "bloxx", "link": "https://stackoverflow.com/users/2956862/bloxx"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1507657520, "post_id": 46672275, "comment_id": 80294078, "body": "@DanielWagner The idea is that m is not specified here at all. m is the monad we want to get back from bookAvailable. a should just be Book because this it the entity we run CRUD queries about. Because m implements SupportsCRUD, the compiler should infer the monad c to lift into. c is the monad supporting the CRUD operations. I hope this helps; I wasn&#39;t able to condense my problem into a simpler case."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1507657884, "post_id": 46672275, "comment_id": 80294292, "body": "I&#39;ve made a few obvious fixes to your code in order to reproduce the error you quote.  Noting it here so you can review, in case it&#39;s something you missed and not just a question-typo."}, {"owner": {"reputation": 101, "user_id": 2956862, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a98d1070955892f73cd199b521b2ab33?s=128&d=identicon&r=PG&f=1", "display_name": "bloxx", "link": "https://stackoverflow.com/users/2956862/bloxx"}, "edited": false, "score": 0, "creation_date": 1507658020, "post_id": 46672275, "comment_id": 80294365, "body": "Yes, thank you! I was just also about to fix it. But it seems that your (deleted) comment to use ScopedTypeVariables indeed fixed my problem..."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1507658213, "post_id": 46672970, "comment_id": 80294468, "body": "Wow! Well, that surprises me so completely that now I have a question: why was GHC willing to choose <code>a ~ Book</code> when inferring the type of <code>liftCRUD</code>? Clearly with that choice there is an appropriate instance available; but just as clearly one could come along later and add another instance that would also be a fine choice, which to me screams &quot;ambiguous&quot;."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1507658314, "post_id": 46672970, "comment_id": 80294534, "body": "Aha, and after trying to make a witness for my claim that &quot;clearly one could come along later and add another instance&quot;, I think perhaps I see the reason: there is a key <code>c -&gt; a</code> fundep on <code>CRUDSupport</code>, and all <code>SupportsCRUD</code> instances imply a corresponding <code>CRUDSupport</code> instance."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1507658389, "post_id": 46672970, "comment_id": 80294575, "body": "@DanielWagner yeah it tripped me up too.  I missed that <code>CRUDSupport</code> was a superclass of <code>SupportsCRUD</code> because it was declared afterward, and I&#39;m used to superclasses coming first."}, {"owner": {"reputation": 101, "user_id": 2956862, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a98d1070955892f73cd199b521b2ab33?s=128&d=identicon&r=PG&f=1", "display_name": "bloxx", "link": "https://stackoverflow.com/users/2956862/bloxx"}, "edited": false, "score": 0, "creation_date": 1507659388, "post_id": 46672970, "comment_id": 80295136, "body": "Good to know, I&#39;m still not familiar to Haskell best practice conventions.. :)"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 101, "user_id": 2956862, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a98d1070955892f73cd199b521b2ab33?s=128&d=identicon&r=PG&f=1", "display_name": "bloxx", "link": "https://stackoverflow.com/users/2956862/bloxx"}, "edited": false, "score": 0, "creation_date": 1507666108, "post_id": 46672970, "comment_id": 80298560, "body": "@bloxx Yeah I&#39;m not sure either. I see two styles: &quot;first here&#39;s the thing I want to define, then here is what I needed to define it&quot;, and &quot;here&#39;s some definitions, and after all that we can get to what we want&quot;.  Different styles of thought."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 3, "last_activity_date": 1507661709, "last_edit_date": 1507661709, "creation_date": 1507657988, "answer_id": 46672970, "question_id": 46672275, "link": "https://stackoverflow.com/questions/46672275/how-to-abstract-over-monads-without-fighting-the-type-system-in-haskell/46672970#46672970", "title": "How to abstract over monads without fighting the type system in Haskell?", "body": "<p>To use <code>ScopedTypeVariables</code> you also need to bind the variables you want to be in scope with <code>forall</code>.  So it should be</p>\n\n<pre><code>bookAvailable :: forall m c. (SupportsCRUD m c Book) =&gt; m Bool\n...\n</code></pre>\n\n<p>That was all that was necessary (after some trivial fixes I made which I assume were typos from entering your question) for me to get the code to compile.</p>\n"}], "owner": {"reputation": 101, "user_id": 2956862, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a98d1070955892f73cd199b521b2ab33?s=128&d=identicon&r=PG&f=1", "display_name": "bloxx", "link": "https://stackoverflow.com/users/2956862/bloxx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "accepted_answer_id": 46672970, "answer_count": 1, "score": 2, "last_activity_date": 1507661709, "creation_date": 1507655395, "last_edit_date": 1507657749, "question_id": 46672275, "link": "https://stackoverflow.com/questions/46672275/how-to-abstract-over-monads-without-fighting-the-type-system-in-haskell", "title": "How to abstract over monads without fighting the type system in Haskell?", "body": "<p>I'm currently building a server in haskell and as a newbie to the language, I'd like to try a new approach zu Monad composition. The idea is that we can write library methods like</p>\n\n<pre><code>    isGetRequest :: (SupportsRequests m r) =&gt; m Bool\n    isGetRequest = do\n        method &lt;- liftRequests $ requestMethod\n        return $ method == GET\n\n    class (Monad m, RequestSupport r) =&gt; SupportsRequests m r | m -&gt; r where\n        liftRequests :: r a -&gt; m a\n\n    class (Monad r) =&gt; RequestSupport r where\n        requestMethod :: r Method\n</code></pre>\n\n<p>which work without knowing the underlying monad. Of course in this example, it would have been sufficient to make isGetRequest operate directly on the (RequestSupport r) monad but the idea is that my library might also have more than one constraint on the monad. Yet, I do not want to implement all of those different concerns in the same module nor spread them across different modules (orphan instances!).\nThat's why the m monad only implements the <code>Supports*</code> classes, delegating the real concerns to other monads.</p>\n\n<p>The above code should work perfectly (with some language extensions to GHC). Unfortunately, I got some problems with the CRUD (Create Read Update Delete) concern:</p>\n\n<pre><code>class (Monad m, CRUDSupport c a) =&gt; SupportsCRUD m c a | m a -&gt; c where\n    liftCRUD :: c x -&gt; m x\n\nclass (Monad c) =&gt; CRUDSupport c a | c -&gt; a where\n    list :: c [a] -- List all entities of type a\n</code></pre>\n\n<p>No I get an error:</p>\n\n<pre><code>Could not deduce (SupportsCRUD m c a0) from the context [...]\nThe type variable 'a0' is ambiguous [...]\nTo defer the ambiguity check to use sites, enable AllowAmbiguousTypes\nWhen checking the class method: liftCRUD [...]\n</code></pre>\n\n<p>Seems like the type checker doesn't like that the <code>a</code> parameter does not directly arise in the signature of liftCRUD. That's understandable because <code>a</code> cannot be derived from the functional dependencies.</p>\n\n<p>The type checker in my brain tells me that it should not be a problem to infer the type <code>a</code> later on, using AllowAmbiguousTypes, when some method regarding CRUD is executed in a library method. Unfortunately, GHC seems unable to do this inference step, for example</p>\n\n<pre><code>bookAvailable :: (SupportsCRUD m c Book) =&gt; m Bool\nbookAvailable = do\n    books &lt;- liftCRUD (list :: c [Book]) -- I use ScopedTypeVariables\n    case books of\n        [] -&gt; return False\n        _ -&gt; return True\n</code></pre>\n\n<p>yields</p>\n\n<pre><code>Could not deduce (SupportsCRUD m c0 a1) arising from a use of 'liftCRUD' [...]\nThe type variables c0, a1 are ambiguous [...]\n</code></pre>\n\n<p>It seems that I am still unable to reason about the compiler. I there a way to resolve this problem? Or at least a way to understand what the compiler is able to infer?</p>\n\n<p>Best Regards,\nbloxx</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1507651453, "post_id": 46670949, "comment_id": 80290751, "body": "As you said, it &quot;<i>combines it with the identity monoid for strings (<code>&quot;&quot;</code>)</i>&quot;. <code>return (not True)</code> is indeed <code>(False, &quot;&quot;)</code>. Have you checked what the <code>m &gt;&gt;=</code> part does with that?"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1507651598, "post_id": 46670949, "comment_id": 80290834, "body": "Or another hint: <code>m &gt;&gt;= (\\x-&gt;return x)</code> is the same as <code>m</code>, not the same as <code>return x</code>. Not loosing the context is the whole point of monadic <code>&gt;&gt;=</code>."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1507652737, "post_id": 46670949, "comment_id": 80291499, "body": "<code>&gt;&gt;=</code> is going to combine the previous monoid value with the next one, so it&#39;ll be <code>&quot;chickpeas&quot; ++ &quot;&quot;</code>."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1507657927, "post_id": 46670949, "comment_id": 80294314, "body": "By the way, <code>fmap</code> is usually preferred over <code>liftM</code>, since it&#39;s more general."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 6866671, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c315b5ce7daf8e1d91ef033ca66c7c9c?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Jones", "link": "https://stackoverflow.com/users/6866671/steve-jones"}, "edited": false, "score": 1, "creation_date": 1507653949, "post_id": 46671640, "comment_id": 80292175, "body": "Right in front of me!  I suppose this is a corollary to the right identity law: <code>m &gt;&gt;= return</code> must equal <code>m</code>, which could also be written as <code>m &gt;&gt;= (\\x -&gt; return x)</code> must equal <code>m</code>.  <code>liftM</code> changes that last form to <code>m &gt;&gt;= (\\x -&gt; return (f x)</code> may change the value in <code>m</code> but not the context.  Does that sound about right?"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1507653142, "creation_date": 1507653142, "answer_id": 46671640, "question_id": 46670949, "link": "https://stackoverflow.com/questions/46670949/why-does-liftm-not-destroy-context/46671640#46671640", "title": "Why does liftM not destroy context?", "body": "<p>You've focused so hard on <code>\\x -&gt; return (f x)</code> that you completely forgot about the <code>m &gt;&gt;=</code> that precedes it!</p>\n\n<p>You are absolutely correct about what <code>return</code> does:</p>\n\n<pre><code>Control.Monad.Writer&gt; return (not True) :: Writer String Bool\nWriterT (Identity (False,\"\"))\n</code></pre>\n\n<p>The bit you've forgotten about is the bind, which is implemented like this (up to some <code>newtype</code> and transformer nonsense):</p>\n\n<pre><code>m &gt;&gt;= f = (val', monoid &lt;&gt; monoid') where\n    (val, monoid) = m\n    (val', monoid') = f val\n</code></pre>\n\n<p>That <code>monoid'</code> part will be <code>\"\"</code> in our case, but the <code>monoid</code> will be <code>\"chickpeas\"</code>, and so that will not be lost. In detail:</p>\n\n<pre><code>(True, \"chickpeas\") &gt;&gt;= (\\x -&gt; return (not x))\n= { definition of bind }\n(val', monoid &lt;&gt; monoid') where\n    (val, monoid) = (True, \"chickpeas\")\n    (val', monoid') = (\\x -&gt; return (not x)) val\n= { substitute away val and monoid everywhere }\n(val', \"chickpeas\" &lt;&gt; monoid') where\n    (val', monoid') = (\\x -&gt; return (not x)) True\n= { evaluate the lambda and not }\n(val', \"chickpeas\" &lt;&gt; monoid') where\n    (val', monoid') = return False\n= { definition of return }\n(val', \"chickpeas\" &lt;&gt; monoid') where\n    (val', monoid') = (False, \"\")\n= { substitute away val' and monoid' everywhere }\n(False, \"chickpeas\" &lt;&gt; \"\")\n= { evaluate &lt;&gt; }\n(False, \"chickpeas\")\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "is_accepted": false, "score": 3, "last_activity_date": 1507653898, "creation_date": 1507653898, "answer_id": 46671862, "question_id": 46670949, "link": "https://stackoverflow.com/questions/46670949/why-does-liftm-not-destroy-context/46671862#46671862", "title": "Why does liftM not destroy context?", "body": "<p>The key is the definition of <code>&gt;&gt;=</code> for <code>Writer</code>. The following is simplified, since <code>Writer</code> is defined in terms of <code>WriterT Identity</code>:</p>\n\n<pre><code>w &gt;&gt;= f = Writer (m &lt;&gt; n, b)\n  where (m, a) = runWriter w\n        (n, b) = runWriter (f a)\n</code></pre>\n\n<p>Now if we expand <code>liftM</code> with this definition for <code>&gt;&gt;=</code>, you can see how the monoidal writer-value is accumulated.</p>\n\n<pre><code>liftM f w = w &gt;&gt;= \\x -&gt; return (f x)\n\n          {- expand definiton of (&gt;&gt;=) -}\n          = Writer (m &lt;&gt; n, b)\n                where (m, a) = runWriter w\n                      (n, b) = runWriter ((\\x -&gt; return (f x)) a)\n\n          {- apply (\\x -&gt; return (f x)) to its argument -}\n          = Writer (m &lt;&gt; n, b)\n                where (m, a) = runWriter w\n                      (n, b) = runWriter (return (f a))\n\n          {- expand definition of (return (f a)) -}\n          = Writer (m &lt;&gt; n, b)\n                where (m, a) = runWriter w\n                      (n, b) = runWriter (Writer (\"\", f a))\n\n          {- runWriter . Writer === id -}\n          = Writer (m &lt;&gt; n, b)\n                where (m, a) = runWriter w\n                      (n, b) = (\"\", f a)\n\n          {- inline 'n' and 'b' -}\n          = Writer (m &lt;&gt; \"\", f a) where (m, a) = runWriter w\n\n          {- \"\" is the identity element -}\n          = Writer (m, f a) where (m, a) = runWriter w\n</code></pre>\n\n<p>From the final equation, you can see that <code>liftM f (Writer (m, a))</code> will apply <code>f</code> to the <code>a</code> value inside the <code>Writer</code>, while retaining the previous monoid value <code>m</code>.</p>\n"}], "owner": {"reputation": 23, "user_id": 6866671, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c315b5ce7daf8e1d91ef033ca66c7c9c?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Jones", "link": "https://stackoverflow.com/users/6866671/steve-jones"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 46671640, "answer_count": 2, "score": 2, "last_activity_date": 1507653898, "creation_date": 1507650837, "question_id": 46670949, "link": "https://stackoverflow.com/questions/46670949/why-does-liftm-not-destroy-context", "title": "Why does liftM not destroy context?", "body": "<p>I'm confused about how <code>liftM</code> preserves context, specifically in the case of the <code>Writer</code> monad.  I've been going through \"Learn You a Haskell for Great Good\" and am stuck on its explanation of <code>liftM</code>.</p>\n\n<p>Here is an example:</p>\n\n<pre><code>ghci&gt; runWriter $ liftM not $ Writer (True, \"chickpeas\")\n(False,\"chickpeas\")\n</code></pre>\n\n<p>I understand the concept that <code>liftM</code> lifts the <code>not</code> function into the monad, applies it to the value inside (<code>True</code>), and either does nothing with the monoid (\"chickpeas\") or combines it with the identity monoid for strings (\"\").</p>\n\n<p>However, the implementation of <code>liftM</code> is given as:</p>\n\n<pre><code>liftM :: (Monad m) =&gt; (a -&gt; b) -&gt; m a -&gt; m b  \nliftM f m = m &gt;&gt;= (\\x -&gt; return (f x))\n</code></pre>\n\n<p>Applying <code>f</code> to the <code>x</code> value inside of the monad being fed into the function makes sense.  However, if I execute <code>return (f x)</code>, why would I not get back whatever <code>f x</code> produces wrapped up in a <em>default</em> monad context?  In the <code>Writer</code> example above, I would expect <code>runWriter $ return (f x)</code> to produce <code>(False, \"\")</code> since the default <code>Writer string bool</code> instance has \"\" as its monoid value.</p>\n\n<p>What am I missing?</p>\n"}, {"tags": ["haskell", "tree", "ghci"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1507647378, "post_id": 46669815, "comment_id": 80288204, "body": "hint: what should be the value a <code>Node</code> stores after zipping?"}, {"owner": {"reputation": 11, "user_id": 8753132, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b362bb53d85af465862ce7ffa0753e8a?s=128&d=identicon&r=PG&f=1", "display_name": "J. Doe", "link": "https://stackoverflow.com/users/8753132/j-doe"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1507648201, "post_id": 46669815, "comment_id": 80288788, "body": "A <code>Node</code> should store an <code>Int</code> value after zipping."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1507649105, "post_id": 46669815, "comment_id": 80289335, "body": "@J.Doe Where did <code>Int</code> come from? <code>treezip</code> takes two trees that store arbitrary data, and produces a tree that contains <i>tuples</i> of data. If I have a <code>Tree Char</code> value and a <code>Tree Bool</code> value, I have to produce a <code>Tree (Char, Bool)</code> value. So, what should <code>treezip (Node &#39;c&#39; Leaf Leaf) (Node &#39;True&#39; Leaf Leaf)</code> return?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1507649217, "post_id": 46669815, "comment_id": 80289410, "body": "Worse, what should <code>treezip Leaf (Node &#39;a&#39; Leaf Leaf)</code> return? Only trees with the same shape can (apparently) be zipped, so the function type should probably be <code>Tree a -&gt; Tree b -&gt; Maybe (Tree (a, b))</code>."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 4, "last_activity_date": 1507648121, "creation_date": 1507648121, "answer_id": 46670140, "question_id": 46669815, "link": "https://stackoverflow.com/questions/46669815/haskell-problems-zipping-trees/46670140#46670140", "title": "Haskell: Problems zipping trees", "body": "<p>Don't work against the compiler, let it help you!</p>\n\n<p>To right a function like that, it's best to start out with only an \u201couter shell definition\u201d:</p>\n\n<pre><code>treeZip (Node a lSa rSa) (Node b lSb rSb) = Node _ _ _\n</code></pre>\n\n<p>The compiler will come back with this:</p>\n\n<pre><code>\u2022 Found hole: _ :: (a, b)\n  Where: \u2018a\u2019 is a rigid type variable ...(_bla, bla_)\n         \u2018b\u2019 is a rigid type variable ....\n\u2022 In the first argument of \u2018Node\u2019, namely \u2018_\u2019\n  In the expression: Node _ _ _\n  In an equation for \u2018treeZip\u2019:\n      treeZip (Node a lSa rSa) (Node b lSb rSb) = Node _ _ _\n\u2022 Relevant bindings include\n    rSb :: Tree b (bound at /tmp/wtmpf-file20584.hs:4:38)\n    lSb :: Tree b (bound at /tmp/wtmpf-file20584.hs:4:34)\n    b :: b (bound at /tmp/wtmpf-file20584.hs:4:32)\n    rSa :: Tree a (bound at /tmp/wtmpf-file20584.hs:4:21)\n    lSa :: Tree a (bound at /tmp/wtmpf-file20584.hs:4:17)\n    a :: a (bound at /tmp/wtmpf-file20584.hs:4:15)\n</code></pre>\n\n<p>So, it tells you the first of the <code>_</code> <em>typed holes</em> should be filled with something of type <code>(a,b)</code>. Do we have anything of that type? Well, we can easily build it, namely by taking <code>a</code> and <code>b</code> and putting them in a tuple!</p>\n\n<pre><code>treezip (Node a lSa rSa) (Node b lSb rSb) = Node (a,b) _ _\n</code></pre>\n\n<p>...giving</p>\n\n<pre><code>\u2022 Found hole: _ :: Tree (a, b)\n  Where: \u2018a\u2019 is a rigid type variable bound by...\n</code></pre>\n\n<p>yeah, you've already solved that one \u2013 it should be the zip of the sub-trees.</p>\n\n<pre><code>treeZip (Node a lSa rSa) (Node b lSb rSb)\n     = Node (a,b) (treeZip lSa lSb) (treeZip rSa rSb)\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 8753132, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b362bb53d85af465862ce7ffa0753e8a?s=128&d=identicon&r=PG&f=1", "display_name": "J. Doe", "link": "https://stackoverflow.com/users/8753132/j-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1507648121, "creation_date": 1507647182, "question_id": 46669815, "link": "https://stackoverflow.com/questions/46669815/haskell-problems-zipping-trees", "title": "Haskell: Problems zipping trees", "body": "<p>I'm new to Haskell and have been attempting to build a zipping function, that works with Trees that have the following data structure:</p>\n\n<pre><code>data Tree a = Leaf | Node a (Tree a) (Tree a) deriving Show\n</code></pre>\n\n<p>So far I have this:</p>\n\n<pre><code>treezip :: (Tree a) -&gt; (Tree b) -&gt; (Tree(a,b))\ntreezip (Node a leftSubtreea rightSubtreea) (Node b leftSubtreeb rightSubtreeb) =\nlet l = treezip leftSubtreea leftSubtreeb\n    r = treezip rightSubtreea rightSubtreeb\nin Node a l r\n</code></pre>\n\n<p>However whenever I try to load the module into GHCi I receive errors, pointing to the last line of code and taking issue particularly the variable <code>a</code>.</p>\n\n<p>I've been racking my brain trying to figure out why this wouldn't work. Any help would be appreciated</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 0, "creation_date": 1507639379, "post_id": 46666891, "comment_id": 80282461, "body": "<code>it</code> does not appear in the code you&#39;ve shown. What else did you type into the GHCi prompt?"}, {"owner": {"reputation": 57, "user_id": 8752268, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209630376667858/picture?type=large", "display_name": "Jo&#227;o Santos", "link": "https://stackoverflow.com/users/8752268/jo%c3%a3o-santos"}, "reply_to_user": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 0, "creation_date": 1507639524, "post_id": 46666891, "comment_id": 80282567, "body": "After inaHelper I typed inaHelper 280 to test the program and it apear the number 10. So I thought It was OK."}, {"owner": {"reputation": 57, "user_id": 8752268, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209630376667858/picture?type=large", "display_name": "Jo&#227;o Santos", "link": "https://stackoverflow.com/users/8752268/jo%c3%a3o-santos"}, "reply_to_user": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 0, "creation_date": 1507639589, "post_id": 46666891, "comment_id": 80282618, "body": "Then I wrote the code for ina as I said earlier. And next simple wrote ina in the prompt"}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1507810570, "post_id": 46666891, "comment_id": 80365078, "body": "Btw <code>inaHelper</code> can be written <code>sum . fmap (read . pure) . show</code> and will work no matter how many digits your numbers have."}], "answers": [{"comments": [{"owner": {"reputation": 57, "user_id": 8752268, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209630376667858/picture?type=large", "display_name": "Jo&#227;o Santos", "link": "https://stackoverflow.com/users/8752268/jo%c3%a3o-santos"}, "edited": false, "score": 0, "creation_date": 1507639914, "post_id": 46667135, "comment_id": 80282838, "body": "I thought It could be something similar to that. I tried but it gives other error:                                                                                                      No instance for (Integral int1) arising from a use of \u2018ina\u2019     Possible fix:       add (Integral int1) to the context of         an expression type signature: [int1]     In the expression: ina :: [int]     In an equation for \u2018it\u2019: it = ina :: [int]"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 57, "user_id": 8752268, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209630376667858/picture?type=large", "display_name": "Jo&#227;o Santos", "link": "https://stackoverflow.com/users/8752268/jo%c3%a3o-santos"}, "edited": false, "score": 0, "creation_date": 1507639957, "post_id": 46667135, "comment_id": 80282870, "body": "@Jo&#227;oSantos You need <code>Int</code>, with an uppercase <code>I</code>."}, {"owner": {"reputation": 57, "user_id": 8752268, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209630376667858/picture?type=large", "display_name": "Jo&#227;o Santos", "link": "https://stackoverflow.com/users/8752268/jo%c3%a3o-santos"}, "edited": false, "score": 0, "creation_date": 1507640260, "post_id": 46667135, "comment_id": 80283072, "body": "ina :: [Int]  &lt;interactive&gt;:57:1:     No instance for (RealFrac Int) arising from a use of \u2018ina\u2019     In the expression: ina :: [Int]     In an equation for \u2018it\u2019: it = ina :: [Int]"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 57, "user_id": 8752268, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209630376667858/picture?type=large", "display_name": "Jo&#227;o Santos", "link": "https://stackoverflow.com/users/8752268/jo%c3%a3o-santos"}, "edited": false, "score": 0, "creation_date": 1507640919, "post_id": 46667135, "comment_id": 80283572, "body": "@Jo&#227;oSantos The issue now is that you are using <code>floor</code> and <code>&#47;</code> which are for floating point types, only, and <code>mod</code> which is integral, only. Remove <code>floor</code> and use <code>div</code> for integer division e.g. <code>5 `div` 2 </code> is <code>2</code>. You might have other issues in your code, but slowly you&#39;ll be able to fix them all."}, {"owner": {"reputation": 57, "user_id": 8752268, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209630376667858/picture?type=large", "display_name": "Jo&#227;o Santos", "link": "https://stackoverflow.com/users/8752268/jo%c3%a3o-santos"}, "edited": false, "score": 0, "creation_date": 1507656833, "post_id": 46667135, "comment_id": 80293721, "body": "Sorry for the late comment. Your suggestion made it work. I now understand the problem of using floor in this situation."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 57, "user_id": 8752268, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209630376667858/picture?type=large", "display_name": "Jo&#227;o Santos", "link": "https://stackoverflow.com/users/8752268/jo%c3%a3o-santos"}, "edited": false, "score": 2, "creation_date": 1507666354, "post_id": 46667135, "comment_id": 80298672, "body": "@Jo&#227;oSantos As a general suggestion, it greatly helps if one annotates each global definition with an explicit type. Otherwise, sometimes, GHC will infer some unintended general type which does make the code compile so far, but will generate problems when later on one makes use of that definition. Detecting problems early makes them easier to fix."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1507639842, "last_edit_date": 1507639842, "creation_date": 1507639444, "answer_id": 46667135, "question_id": 46666891, "link": "https://stackoverflow.com/questions/46666891/haskell-signature-and-type-error/46667135#46667135", "title": "Haskell - Signature and Type error", "body": "<pre><code>ina = [x | x &lt;- [1..999] , x `mod` (inaHelper x) == 0   ]\n</code></pre>\n\n<p>What is the type of <code>x</code>? <code>Integer</code>? <code>Int</code>? <code>Word</code>? The code above is very generic, and will work on any integral type. If we try to print its type we\nget something like this</p>\n\n<pre><code>&gt; :t ina\nina :: (Integral t, ...) =&gt; [t]\n</code></pre>\n\n<p>meaning that the result is a list of any type <code>t</code> we want, provided <code>t</code> is an integral type (and a few other constraints). </p>\n\n<p>When we ask GHCi to print the result, GHCi needs to choose the type of <code>x</code>, but can not decide unambiguously. This is what the error message states.</p>\n\n<p>Try specifying a type when you print the result. E.g.</p>\n\n<pre><code>&gt; ina :: [Int]\n</code></pre>\n\n<p>This will make GHCi choose the type <code>t</code> to be <code>Int</code>, removing the ambiguity.</p>\n"}], "owner": {"reputation": 57, "user_id": 8752268, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209630376667858/picture?type=large", "display_name": "Jo&#227;o Santos", "link": "https://stackoverflow.com/users/8752268/jo%c3%a3o-santos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 46667135, "answer_count": 1, "score": 2, "last_activity_date": 1507639842, "creation_date": 1507638727, "last_edit_date": 1507639255, "question_id": 46666891, "link": "https://stackoverflow.com/questions/46666891/haskell-signature-and-type-error", "title": "Haskell - Signature and Type error", "body": "<p>I'm new to Haskell and I'm having some trouble with function signature and types. Here's my problem:</p>\n\n<p>I'm trying to make a list with every number between 1 and 999 that can be divided by every numeral of it's own number. For example the number 280 can be in that list because 2+8+0=10 and 280/10 = 28 ... On the other hand 123 can't because 1+2+3=6 and 123/6=20,5. When the final operation gives you a number with decimal it will never be in that list.</p>\n\n<p>Here's my code:</p>\n\n<pre><code>let inaHelper x = (floor(x)`mod`10)+ (floor(x/10)`mod`10)+(floor(x/100)`mod`10)\n</code></pre>\n\n<p>This first part will only do the sum of every numeral of a number.\nAnd this part works...</p>\n\n<p>Here's the final part:</p>\n\n<pre><code>let ina = [x | x &lt;- [1..999] , x `mod` (inaHelper x) == 0   ]\n</code></pre>\n\n<p>This final part should do the list and the verification if it could be on the list or not. But it's give this error:</p>\n\n<pre><code>No instance for (Integral t0) arising from a use of \u2018it\u2019\n    The type variable \u2018t0\u2019 is ambiguous\n    Note: there are several potential instances:\n      instance Integral Integer -- Defined in \u2018GHC.Real\u2019\n      instance Integral Int -- Defined in \u2018GHC.Real\u2019\n      instance Integral Word -- Defined in \u2018GHC.Real\u2019\n    In the first argument of \u2018print\u2019, namely \u2018it\u2019\n    In a stmt of an interactive GHCi command: print it\n\n\n...\n</code></pre>\n"}, {"tags": ["haskell", "haskell-turtle"], "answers": [{"comments": [{"owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "edited": false, "score": 0, "creation_date": 1507668183, "post_id": 46675280, "comment_id": 80299615, "body": "Immensely helpful. I actually figure it out already. Could you also give me a hint on how to generate the output file names? I want to change from mp4 to mp3. I can&#39;t figure out how to use the sed command to do the substitution."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "edited": false, "score": 1, "creation_date": 1507669399, "post_id": 46675280, "comment_id": 80300277, "body": "I wouldn&#39;t use <code>sed</code>. Just use the <code>Text</code> library&#39;s functions. <code>init filename &lt;&gt; &quot;3&quot;</code> should do it (<code>init</code> takes all but last character (all but the last <code>&#39;4&#39;</code>), <code>&lt;&gt; &quot;3&quot;</code> adds a <code>&quot;3&quot;</code> on the end)."}, {"owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "edited": false, "score": 0, "creation_date": 1507669629, "post_id": 46675280, "comment_id": 80300379, "body": "Smart!. How about if the <code>procs</code> raises an exception? How to manage that exception and throw some messages and continue the process to other files? @HTNW"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "edited": false, "score": 1, "creation_date": 1507670786, "post_id": 46675280, "comment_id": 80300898, "body": "<code>procs</code> throws the <code>ProcFailed</code> exception on failure. <code>proc</code> will give you the error code and let you deal with it. <a href=\"https://hackage.haskell.org/package/turtle-1.4.4/docs/\" rel=\"nofollow noreferrer\">See the docs</a> for details."}, {"owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "edited": false, "score": 1, "creation_date": 1507671892, "post_id": 46675280, "comment_id": 80301340, "body": "Is it possible to do parallel processing on those files? @HTNW"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "edited": false, "score": 0, "creation_date": 1507674670, "post_id": 46675280, "comment_id": 80302384, "body": "@osager I&#39;m not sure. Check the docs. You might be able to use <code>forkIO</code>, but don&#39;t quote me on that."}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 2, "last_activity_date": 1507666738, "creation_date": 1507666738, "answer_id": 46675280, "question_id": 46666185, "link": "https://stackoverflow.com/questions/46666185/haskell-turtle-script-how-to-consume-shell/46675280#46675280", "title": "Haskell Turtle Script: How to consume Shell", "body": "<p>Don't use <code>view</code> like that. You use that to <em>run</em> a <code>Shell</code>, and it prints the resulting values and makes them inaccessible to you. <code>Shell</code> itself is a monad, so you should build up a <code>Shell</code> action, then run with with <code>view</code> or <code>sh</code> (to discard the values without printing). (They're terminal functions; you use them only when you're done doing what you're doing). In fact, <code>MonadIO Shell</code>, so anything you can do in <code>IO</code> you can do in <code>Shell</code> (via <code>liftIO :: MonadIO m =&gt; IO a -&gt; m a</code>).</p>\n\n<pre><code>main = sh $ do -- You don't want to print the output of this Shell (a bunch of ()s)\n  filename &lt;- format fp &lt;$&gt; find (suffix \".mp4\") \"/Users/me/videos\"\n  let output = findOtherName filename -- Find the output arg for ffmpeg\n  procs \"ffmpeg\" [\"-vn\",\"-acodec\",\"libmp3lame\",\"-ac\",\"2\",\"-ab\"\n                 ,\"160k\",\"-ar\",\"48000\",\"-i\",filename,output  ] -- Just add them on\n</code></pre>\n\n<p>This is comparable to</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>#!/bin/sh\nfor filename in /Users/me/videos/*.mp4; do\n    output=\"`findOtherName \"$filename\"`\"\n    ffmpeg -vn -acodec libmp3lame -ac 2 -ab 160k -ar 48000 -i \"$filename\" \"$output\"\ndone\n</code></pre>\n"}], "owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "accepted_answer_id": 46675280, "answer_count": 1, "score": 1, "last_activity_date": 1555324568, "creation_date": 1507636661, "last_edit_date": 1555324568, "question_id": 46666185, "link": "https://stackoverflow.com/questions/46666185/haskell-turtle-script-how-to-consume-shell", "title": "Haskell Turtle Script: How to consume Shell", "body": "<pre><code>import Turtle\nimport Prelude hiding (FilePath)\nimport Data.Text hiding (find)\nmain = do\n  f &lt;- view $ format fp  &lt;$&gt; find (suffix \".mp4\") \"/Users/me/videos\"\n  procs \"ffmpeg\" [\"-vn\",\"-acodec\",\"libmp3lame\",\"-ac\",\"2\",\"-ab\",\"160k\",\"-ar\",\"48000\",\"-i\"] empty\n</code></pre>\n\n<p>Basically I want to feed all the video filenames to ffmpeg.\nTwo questions:</p>\n\n<ol>\n<li>How to combine the <code>procs</code> with <code>Shell</code> streams? </li>\n<li>ffmpeg takes two inputs: one for <code>-i</code> and one for the output filename. What is the best practise to implement this with Turtle?</li>\n</ol>\n\n<p>I've seen the <a href=\"https://hackage.haskell.org/package/turtle-1.4.4/docs/Turtle-Shell.html\" rel=\"nofollow noreferrer\">foldIO</a> function that looks promising. But I can't figure out how to use it.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1507617729, "post_id": 46659442, "comment_id": 80268726, "body": "Unrelated: does <code>foo</code> always take exactly two arguments? If so, why are you making it take an arbitrary list instead of two arguments? In that way, <code>foo</code> becomes a partial function, which will crash your program if the list is of any other length. Worse, the compile won&#39;t check the list length at compile time."}, {"owner": {"reputation": 61, "user_id": 7113047, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c20756957eeff77779fbfb97ccf63df1?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Flaten", "link": "https://stackoverflow.com/users/7113047/eric-flaten"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1507697588, "post_id": 46659442, "comment_id": 80307937, "body": "The foo function was written knowing I would use a 3-outcome base game so I knew that x1, x2, and x3 would be enough. The generalization comes by allowing a base game with an arbitrary number of outcomes. This is why foo&#39; uses the map function and lst."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1507709261, "post_id": 46659442, "comment_id": 80313705, "body": "I don&#39;t follow. Why isn&#39;t <code>foo :: Integer -&gt; Integer -&gt; MyTree ....</code> instead? Or <code>foo :: (Integer,Integer) -&gt; MyTree ...</code>? In this way, the program will crash when called as <code>foo []</code> or <code>foo [1]</code> or <code>foo [1,2,3]</code>."}], "answers": [{"tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": false, "score": 2, "last_activity_date": 1507615313, "creation_date": 1507615313, "answer_id": 46659592, "question_id": 46659442, "link": "https://stackoverflow.com/questions/46659442/how-do-i-use-map-to-generalize-a-function/46659592#46659592", "title": "How do I use map to generalize a function", "body": "<p>The problem is just what the compiler says:</p>\n\n<blockquote>\n  <p>The function \u2018Root\u2019 is applied to four arguments,\n        but its type \u2018[Integer] -> [MyTree [Integer]] -> MyTree [Integer]\u2019\n        has only two</p>\n</blockquote>\n\n<p>That's because compiler assumes that <code>[a]</code>, <code>map</code>, <code>(foo'.(\\y -&gt;[r-1, y]).(\\x -&gt; a+x))</code> and <code>lst</code> are four separate arguments to function <code>Root</code>.</p>\n\n<p>It can be fixed either by using <code>$</code>, which sets the priority of evaluation</p>\n\n<pre><code>foo' :: [Integer] -&gt; MyTree [Integer] \nfoo' [r, a] \n    | r == 0      = Leaf   [a] \n    | a == 0      = Root   [a] $ map (foo'.(\\y -&gt;[r-1, y]).(\\x -&gt; a+x)) lst\n    | otherwise   = Branch [a] $ map (foo'.(\\y -&gt;[r-1, y]).(\\x -&gt; a+x)) lst\n</code></pre>\n\n<p>Or, since it can be moved into a separate function (probably <code>genList</code> name is not appropriate, certainly you can make up a better one):</p>\n\n<pre><code>foo' :: [Integer] -&gt; MyTree [Integer]\nfoo' [r, a]\n    | r == 0      = Leaf   [a]\n    | a == 0      = Root   [a] genList\n    | otherwise   = Branch [a] genList\n    where genList = map (foo'.(\\y -&gt;[r-1, y]).(\\x -&gt; a+x)) lst\n</code></pre>\n"}], "owner": {"reputation": 61, "user_id": 7113047, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c20756957eeff77779fbfb97ccf63df1?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Flaten", "link": "https://stackoverflow.com/users/7113047/eric-flaten"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1507615313, "creation_date": 1507614667, "question_id": 46659442, "link": "https://stackoverflow.com/questions/46659442/how-do-i-use-map-to-generalize-a-function", "title": "How do I use map to generalize a function", "body": "<p>I am trying to design a Haskell program to build a game theory tree that creates a Game (capital G) by repeatedly playing a base game (small G) a specified number of times.</p>\n\n<p>The <em>foo</em> function below works correctly by adding the outcome (or payoff) of one round to each of the outcomes/payoffs of the base game. One major limitation is that the base game is permanently set to have three outcomes.</p>\n\n<p>The <em>foo'</em>  function (which does not work) is supposed to be a generalization of the <em>foo</em> function. That is to mimic the <em>foo</em> function by using the map function and a list of values that represent the base game. </p>\n\n<pre><code>data MyTree a = Root a [MyTree a] | Branch a [MyTree a] | Leaf a | EmptyNode deriving Show\n\nx1:: Integer\nx1 = 1\n\nx2 :: Integer\nx2 = 25\n\nx3 :: Integer\nx3 = 100\n\nfoo :: [Integer] -&gt; MyTree [Integer] \nfoo [r, a] \n    | r == 0      = Leaf   [a] \n    | a == 0      = Root   [a] [foo [r-1, a+x1], foo [r-1, a+x2], foo [r-1, a+x3]]\n    | otherwise   = Branch [a] [foo [r-1, a+x1], foo [r-1, a+x2], foo [r-1, a+x3]]\n\nlst = [x1, x2, x3]\n\nfoo' :: [Integer] -&gt; MyTree [Integer] \nfoo' [r, a] \n    | r == 0      = Leaf   [a] \n    | a == 0      = Root   [a] map (foo'.(\\y -&gt;[r-1, y]).(\\x -&gt; a+x)) lst\n    | otherwise   = Branch [a] map (foo'.(\\y -&gt;[r-1, y]).(\\x -&gt; a+x)) lst\n</code></pre>\n\n<p>The following errors show up twice (one for the <em>a</em> <em>==</em> <em>0</em> line and for the <em>otherwise</em> line). I list them only once since once I know how to fix an error, I can fix its duplicate.</p>\n\n<p>The error messages I get are (a) and (b):</p>\n\n<pre><code>Couldn't match expected type \u2018([Integer] -&gt; MyTree [Integer]) -&gt; [[Integer]] -&gt; MyTree [Integer]\u2019with actual type \u2018MyTree [Integer]\u2019\n\n\nCouldn't match expected type \u2018[MyTree [Integer]]\u2019with actual type \u2018(a0 -&gt; b0) -&gt; [a0] -&gt; [b0]\u2019\n</code></pre>\n\n<p>My question is this: How can I get the actual input to match the expected input? I've spent many days and hours working on the syntax and Google-searching for the solution.</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1507617805, "post_id": 46657501, "comment_id": 80268777, "body": "This repo may be of assistance: <a href=\"https://github.com/fpco/stack-docker-image-build\" rel=\"nofollow noreferrer\">github.com/fpco/stack-docker-image-build</a>"}, {"owner": {"reputation": 27, "user_id": 939284, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7d5ad6ccfadb6f702a6de00dbe67820?s=128&d=identicon&r=PG", "display_name": "Sandeep.C.R", "link": "https://stackoverflow.com/users/939284/sandeep-c-r"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1507642558, "post_id": 46657501, "comment_id": 80284735, "body": "@MichaelSnoyman I tried this on a small dummy project, and I was able to successfully create the image. But when I used the image to build, I get a bunch of linker errors.   You can see them here <a href=\"http://lpaste.net/359106\" rel=\"nofollow noreferrer\">lpaste.net/359106</a>  How can I fix this?"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1507651682, "post_id": 46657501, "comment_id": 80290888, "body": "Without more information on how the image was created, I can&#39;t be certain. Are you just using the <code>examples</code> directory?"}, {"owner": {"reputation": 27, "user_id": 939284, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7d5ad6ccfadb6f702a6de00dbe67820?s=128&d=identicon&r=PG", "display_name": "Sandeep.C.R", "link": "https://stackoverflow.com/users/939284/sandeep-c-r"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1507652917, "post_id": 46657501, "comment_id": 80291601, "body": "@MichaelSnoyman I created the image by running  <code>docker build -t image-name .</code> in a folder that contained the dummy project folder, the stack.yaml and the Dockerfile (<a href=\"https://github.com/fpco/stack-docker-image-build/blob/master/example/Dockerfile\" rel=\"nofollow noreferrer\">github.com/fpco/stack-docker-image-build/blob/master/exampl&zwnj;&#8203;e/&hellip;</a>).  After the image was created, I just used the image name in the project&#39;s stack.yaml&#39;s docker section.  The dummy project was created using stack new, and after that, the cabal file was edited to add a dependency (Opaleye)."}, {"owner": {"reputation": 27, "user_id": 939284, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7d5ad6ccfadb6f702a6de00dbe67820?s=128&d=identicon&r=PG", "display_name": "Sandeep.C.R", "link": "https://stackoverflow.com/users/939284/sandeep-c-r"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1507658776, "post_id": 46657501, "comment_id": 80294783, "body": "@MichaelSnoyman And update. These linker errors seems to be caused by a permission issue. This command,  /usr/local/bin/ghc-pkg --no-user-package-db --global dump | grep opaleye  prints out the location of compiled opaleye library to be <code>library-dirs: &#47;root&#47;.stack&#47;snapshots&#47;x86_64-linux&#47;lts-9.6&#47;8.0.2&#47;lib&#47;x86_64&zwnj;&#8203;-linux-ghc-8.0.2&#47;opa&zwnj;&#8203;leye-0.5.4.0-BRLCqVY&zwnj;&#8203;9AJXBFXQwXTO0hf</code>  This path is under the /root folder, which is not accessable to the <code>stack</code> user, which the build command seem to run as.  When I executed the build as root (after logging into the container), the build was successful."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1507716140, "post_id": 46657501, "comment_id": 80318229, "body": "Does it work to add an extra step to the Dockerfile to change file ownership (or perhaps even just <code>chmod</code>)?"}, {"owner": {"reputation": 27, "user_id": 939284, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7d5ad6ccfadb6f702a6de00dbe67820?s=128&d=identicon&r=PG", "display_name": "Sandeep.C.R", "link": "https://stackoverflow.com/users/939284/sandeep-c-r"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1507718605, "post_id": 46657501, "comment_id": 80319822, "body": "@MichaelSnoyman I got it working by adding a step that make the <code>&#47;root</code> world readable by doing <code>chmod -R +rx &#47;root</code>. I was not able to get it work by changing ownership, but I have probably missed something.  Anyway, it seems like it works as I want. The build using the image does not download or build any of the dependencies.  The next thing I want to do is to remove the need to download the package index and build plans. Is there any way to add this into the build_image program? Or does it not make sense to do so to include them as part of the image (because it might change frequently)?"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1507825064, "post_id": 46657501, "comment_id": 80375060, "body": "It might make sense, but I don&#39;t believe Stack will allow that to happen right now."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1507825934, "post_id": 46657501, "comment_id": 80375547, "body": "Also, would you consider sending a PR to include your changes?"}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1582987809, "post_id": 46657501, "comment_id": 106969139, "body": "<a href=\"https://stackoverflow.com/questions/54508207/how-to-pre-install-stack-dependencies-to-reduce-stack-build-time\" title=\"how to pre install stack dependencies to reduce stack build time\">stackoverflow.com/questions/54508207/&hellip;</a> might be useful"}], "answers": [{"tags": [], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "is_accepted": false, "score": -2, "last_activity_date": 1507617823, "creation_date": 1507617823, "answer_id": 46660183, "question_id": 46657501, "link": "https://stackoverflow.com/questions/46657501/how-can-i-prepare-a-docker-container-with-all-the-required-haskell-packages-and/46660183#46660183", "title": "How can I prepare a docker container with all the required haskell packages and the required compiler preinstalled?", "body": "<p>I haven't used docker with stack but ASAIU stack just pull an image from it's name. You need to build the image you need beforehand, as you would with any docker image then setup task to use it. For this, you'll need either to write a customer docker file , create an image manually or start with an existing lts image preloaded with stack package (I believe you can find them on dockerhub). This has nothing to do with stack but is standard docker use. If you are it familiar with docker I recommend you read the tutorial on docker websi.te.tete</p>\n"}], "owner": {"reputation": 27, "user_id": 939284, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7d5ad6ccfadb6f702a6de00dbe67820?s=128&d=identicon&r=PG", "display_name": "Sandeep.C.R", "link": "https://stackoverflow.com/users/939284/sandeep-c-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 341, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1507617823, "creation_date": 1507600337, "question_id": 46657501, "link": "https://stackoverflow.com/questions/46657501/how-can-i-prepare-a-docker-container-with-all-the-required-haskell-packages-and", "title": "How can I prepare a docker container with all the required haskell packages and the required compiler preinstalled?", "body": "<p>How can I prepare a docker container with all the required haskell packages and the required compiler preinstalled so that when I issue <code>stack build --docker</code> it starts the app build right away instead of downloading the dependencies and compiler?</p>\n\n<p>I tried following the 'custom image' section of the Stacks documentation's docker section where it says </p>\n\n<p>\"Create a user and group named stack, and create a ~/.stack directory for it. Any build plans and caches from it will be copied from the image by Stack, meaning they don't need to be downloaded separately.\"</p>\n\n<p>But this only seems to use build plans. It does not use the compiler or all the packages that have been made available in /home/stack/.stack path in the container.</p>\n\n<p>How can this be done?</p>\n"}, {"tags": ["haskell", "authentication", "websocket", "haskell-warp"], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 0, "last_activity_date": 1507621148, "creation_date": 1507621148, "answer_id": 46661105, "question_id": 46656859, "link": "https://stackoverflow.com/questions/46656859/only-accepting-a-wai-websocket-request-if-the-user-is-logged-in/46661105#46661105", "title": "Only accepting a WAI Websocket request if the user is logged in", "body": "<p>The following basic structure will allow you to analyze the <code>Request</code> before passing control to the websockets, and allow you to pass the <code>Request</code> value into your <code>ServerApp</code> if desired:</p>\n\n<pre><code>#!/usr/bin/env stack\n-- stack --resolver lts-9.3 script\n{-# LANGUAGE OverloadedStrings #-}\nimport Network.Wai\nimport Network.Wai.Handler.Warp\nimport Network.Wai.Handler.WebSockets\nimport Network.HTTP.Types\nimport Network.WebSockets.Connection\n\nmain :: IO ()\nmain = run 3000 $ \\req send -&gt;\ncase websocketsApp defaultConnectionOptions _serverApp req of\n    Nothing -&gt; send $ responseLBS status200 [] \"Websockets not supported\"\n    Just res -&gt; send res\n</code></pre>\n"}], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1507621148, "creation_date": 1507594796, "question_id": 46656859, "link": "https://stackoverflow.com/questions/46656859/only-accepting-a-wai-websocket-request-if-the-user-is-logged-in", "title": "Only accepting a WAI Websocket request if the user is logged in", "body": "<p>I am using <a href=\"http://hackage.haskell.org/package/wai-websockets\" rel=\"nofollow noreferrer\">the wai-websockets package</a> (version <a href=\"http://hackage.haskell.org/package/wai-websockets-3.0.1.1\" rel=\"nofollow noreferrer\">3.0.1.1</a>) and I would like to only open a socket if the user has already logged in.  I have a piece of middleware that takes care of all the authentication issues and if the user is logged in places a <code>User</code> record into the <a href=\"http://hackage.haskell.org/package/wai-3.2.1.1/docs/Network-Wai.html#v:vault\" rel=\"nofollow noreferrer\"><code>Vault</code></a> of the WAI request.</p>\n\n<p>Is there some way to access the WAI <code>Request</code> from the <a href=\"http://hackage.haskell.org/package/websockets-0.9.7.0/docs/Network-WebSockets.html#t:ServerApp\" rel=\"nofollow noreferrer\"><code>ServerApp</code></a>, or in the alternative to inspect the <code>Request</code> before the it starts and pass the <code>User</code> value in?</p>\n"}, {"tags": ["list", "haskell", "types", "syntax", "morse-code"], "comments": [{"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1507581478, "post_id": 46654394, "comment_id": 80258483, "body": "For inserting gaps, you probably want <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Data-List.html#v:intersperse\" rel=\"nofollow noreferrer\"><code>intersperse</code></a>. For the type error, you probably just want to use a <code>concat</code> to flatten your list in place. Without seeing more datatypes, that&#39;s the best I can help with!"}, {"owner": {"reputation": 47, "user_id": 4207764, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/11d54f6bc828a47f4b185f498fc5f84e?s=128&d=identicon&r=PG&f=1", "display_name": "assassinsweed1", "link": "https://stackoverflow.com/users/4207764/assassinsweed1"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1507583764, "post_id": 46654394, "comment_id": 80259391, "body": "@jkeuhlen  \t Thanks for the reply. I have been able to get rid of the [[MorseUnit]] issue by using concat. However, whereever I insert &quot;intersperse&quot;, I get an issue with matching types and scopes. Here&#39;s my code: encode :: String -&gt; [MorseUnit] encode str = codeText (words str) codeWord :: String -&gt; [MorseUnit] codeWord word = intersperse(&quot;shortGap&quot; (concat(map codeSymbol word))) codeText :: [String] -&gt; [MorseUnit] codeText list = intersperse(&quot;mediumGap&quot; (concat(map codeWord list)))"}], "answers": [{"tags": [], "owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "is_accepted": false, "score": -1, "last_activity_date": 1507614347, "last_edit_date": 1507614347, "creation_date": 1507581681, "answer_id": 46654630, "question_id": 46654394, "link": "https://stackoverflow.com/questions/46654394/haskell-morse-code-exercise-how-to-add-gaps-between-list-items/46654630#46654630", "title": "Haskell Morse Code Exercise - how to add &quot;gaps&quot; between list items", "body": "<p>As it happens, you're in need of a Monad. There are many (I mean <em>many</em>) Monad tutorials for Haskell available online and I encourage you to avail yourself of one of those.</p>\n\n<p>The list type <code>[]</code> is an instance of the <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Control-Monad.html#t:Monad\" rel=\"nofollow noreferrer\"><code>Monad</code></a> typeclass. Without going into the details, this means there is a function <code>concatMap :: (a -&gt; [b]) -&gt; [a] -&gt; [b]</code>. From the type, you can reason that it's similar to <code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]</code>, but somehow flattens (or <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Data-List.html#v:concat\" rel=\"nofollow noreferrer\"><code>concat</code></a>s) the list-of-list structure. </p>\n\n<p><code>concatMap</code> is <code>(&gt;&gt;=) :: Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b</code>, specialized to <code>m ~ []</code>.</p>\n\n<p>We can also elide the arguments to your functions, since functions in Haskell are curried.</p>\n\n<pre><code>encode :: String -&gt; [MorseUnit]\nencode = codeText . words\n\ncodeWord :: String -&gt; [MorseUnit]\ncodeWord = map codeSymbol\n\ncodeText :: [String] -&gt; [MorseUnit]\ncodeText = concatMap codeWord\n</code></pre>\n\n<p>As for your second question, try using <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Data-List.html#v:intercalate\" rel=\"nofollow noreferrer\"><code>intercalate</code></a>. As an example:</p>\n\n<pre><code>&gt; intercalate \", \" [\"hello\", \"world\"]\n\"hello, world\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 47, "user_id": 4207764, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/11d54f6bc828a47f4b185f498fc5f84e?s=128&d=identicon&r=PG&f=1", "display_name": "assassinsweed1", "link": "https://stackoverflow.com/users/4207764/assassinsweed1"}, "edited": false, "score": 0, "creation_date": 1507583416, "post_id": 46654983, "comment_id": 80259262, "body": "Thanks for the reply. I have been able to get rid of the [[MorseUnit]] issue by using concat (I will look into function calls later, but my deadline means I have to use the quickest solution). However, whereever I insert &quot;intersperse&quot;, I get an issue with matching types and scopes. If I do Here&#39;s my code:   encode :: String -&gt; [MorseUnit] encode str = codeText (words str)  codeWord :: String -&gt; [MorseUnit] codeWord word = intersperse(&quot;shortGap&quot; (concat(map codeSymbol word)))  codeText :: [String] -&gt; [MorseUnit] codeText list = intersperse(&quot;mediumGap&quot; (concat(map codeWord list)))"}, {"owner": {"reputation": 137, "user_id": 2449800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cc76023b84db451a90aec531891dd23?s=128&d=identicon&r=PG", "display_name": "Yufan Lou", "link": "https://stackoverflow.com/users/2449800/yufan-lou"}, "reply_to_user": {"reputation": 47, "user_id": 4207764, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/11d54f6bc828a47f4b185f498fc5f84e?s=128&d=identicon&r=PG&f=1", "display_name": "assassinsweed1", "link": "https://stackoverflow.com/users/4207764/assassinsweed1"}, "edited": false, "score": 1, "creation_date": 1507583569, "post_id": 46654983, "comment_id": 80259326, "body": "You may not need <code>concat</code> in <code>codeWord</code>. <code>String</code> equals <code>[Char]</code> in Haskell so you need to use <code>intercalate</code> on <code>String</code>."}, {"owner": {"reputation": 47, "user_id": 4207764, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/11d54f6bc828a47f4b185f498fc5f84e?s=128&d=identicon&r=PG&f=1", "display_name": "assassinsweed1", "link": "https://stackoverflow.com/users/4207764/assassinsweed1"}, "edited": false, "score": 0, "creation_date": 1507583688, "post_id": 46654983, "comment_id": 80259368, "body": "When I use &quot;intercalate&quot;, I get a &quot;variable not in scope&quot; error"}, {"owner": {"reputation": 137, "user_id": 2449800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cc76023b84db451a90aec531891dd23?s=128&d=identicon&r=PG", "display_name": "Yufan Lou", "link": "https://stackoverflow.com/users/2449800/yufan-lou"}, "reply_to_user": {"reputation": 47, "user_id": 4207764, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/11d54f6bc828a47f4b185f498fc5f84e?s=128&d=identicon&r=PG&f=1", "display_name": "assassinsweed1", "link": "https://stackoverflow.com/users/4207764/assassinsweed1"}, "edited": false, "score": 0, "creation_date": 1507583763, "post_id": 46654983, "comment_id": 80259390, "body": "Sorry, I didn&#39;t check. Add <code>import Data.List</code> to import it."}, {"owner": {"reputation": 47, "user_id": 4207764, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/11d54f6bc828a47f4b185f498fc5f84e?s=128&d=identicon&r=PG&f=1", "display_name": "assassinsweed1", "link": "https://stackoverflow.com/users/4207764/assassinsweed1"}, "edited": false, "score": 0, "creation_date": 1507583958, "post_id": 46654983, "comment_id": 80259457, "body": "That worked thank you! The only issue left is where to place &quot;intersperse&quot;. I get an error  about the match type regardless of whether I do it before or after concat. In this example I&#39;ve done it after concat:    codeWord :: String -&gt; [MorseUnit] codeWord word = intersperse(&quot;shortGap&quot; (intercalate(map codeSymbol word)))  codeText :: [String] -&gt; [MorseUnit] codeText list = intersperse(&quot;mediumGap&quot; (concat(map codeWord list)))"}, {"owner": {"reputation": 137, "user_id": 2449800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cc76023b84db451a90aec531891dd23?s=128&d=identicon&r=PG", "display_name": "Yufan Lou", "link": "https://stackoverflow.com/users/2449800/yufan-lou"}, "reply_to_user": {"reputation": 47, "user_id": 4207764, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/11d54f6bc828a47f4b185f498fc5f84e?s=128&d=identicon&r=PG&f=1", "display_name": "assassinsweed1", "link": "https://stackoverflow.com/users/4207764/assassinsweed1"}, "edited": false, "score": 0, "creation_date": 1507584304, "post_id": 46654983, "comment_id": 80259568, "body": "Several issues: 1) unlike other lang Haskell don&#39;t use <code>()</code> to apply functions. So use <code>intersperse shortGap list</code> no paren; 2) <code>intersperse</code> and <code>intercalate</code> only works on single-type list. You can&#39;t put a <code>String</code> in a <code>[MorseUnit]</code>. You need to define it as a variant of <code>MorseUnit</code>: <code>data MorseUnit = String | ShortGap</code> and use the type instead of the string."}, {"owner": {"reputation": 137, "user_id": 2449800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cc76023b84db451a90aec531891dd23?s=128&d=identicon&r=PG", "display_name": "Yufan Lou", "link": "https://stackoverflow.com/users/2449800/yufan-lou"}, "reply_to_user": {"reputation": 47, "user_id": 4207764, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/11d54f6bc828a47f4b185f498fc5f84e?s=128&d=identicon&r=PG&f=1", "display_name": "assassinsweed1", "link": "https://stackoverflow.com/users/4207764/assassinsweed1"}, "edited": false, "score": 0, "creation_date": 1507584407, "post_id": 46654983, "comment_id": 80259606, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/156296/discussion-between-fridsun-and-assassinsweed1\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 137, "user_id": 2449800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cc76023b84db451a90aec531891dd23?s=128&d=identicon&r=PG", "display_name": "Yufan Lou", "link": "https://stackoverflow.com/users/2449800/yufan-lou"}, "is_accepted": false, "score": 1, "last_activity_date": 1507583976, "last_edit_date": 1507583976, "creation_date": 1507583155, "answer_id": 46654983, "question_id": 46654394, "link": "https://stackoverflow.com/questions/46654394/haskell-morse-code-exercise-how-to-add-gaps-between-list-items/46654983#46654983", "title": "Haskell Morse Code Exercise - how to add &quot;gaps&quot; between list items", "body": "<h2>Issue 1</h2>\n\n<p>You are exactly correct that the error is due to two maps. But you can also see it from the type signatures:</p>\n\n<pre><code>codeText list = map codeWord list (where list :: [String])\ncodeWord :: String -&gt; [MorseUnit]\nmap :: (a -&gt; b) -&gt; [a] -&gt; [b]\n</code></pre>\n\n<p>If you replace <code>(a -&gt; b)</code> with <code>(String -&gt; [MorseUnit])</code>, then <code>[a]</code> becomes <code>[String]</code>, and <code>[b]</code> becomes <code>[[MorseUnit]]</code>.</p>\n\n<p>As in mathematics there are many ways to do it. Obviously you could just <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Prelude.html#v:concat\" rel=\"nofollow noreferrer\"><code>concat</code></a> the resulting list. Notice the straightforward <code>[[a]] -&gt; [a]</code> signature. </p>\n\n<p>Notice that immediately after that there is <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Prelude.html#v:concatMap\" rel=\"nofollow noreferrer\"><code>concatMap</code></a>. You could use it in place of <code>map</code>, and it would flatten the result for you.</p>\n\n<p>To further confuse you, in case you find your parameter appearing last in both the declaration and the definition, you could omit it:</p>\n\n<pre><code>codeText = concatMap codeWord\n</code></pre>\n\n<p>I recommend you use <a href=\"https://www.haskell.org/hoogle/?hoogle=[a]-&gt;[a]\" rel=\"nofollow noreferrer\">Hoogle</a> to search for the function signature you want.</p>\n\n<h2>Issue 2</h2>\n\n<p>First, since you need to distinguish between word and symbols, it seems to me you might not need to flatten the list so early. I am not familiar with Morse code so I don't fully understand what you want to do there. It would be much more clear if you could express your concept in types and signatures. My suggestion is to look at <code>intersperse :: a -&gt; [a] -&gt; [a]</code> or <code>intercalate :: [a] -&gt; [[a]] -&gt; [a]</code> to insert your gaps. They need to be imported with <code>import Data.List</code>.</p>\n"}], "owner": {"reputation": 47, "user_id": 4207764, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/11d54f6bc828a47f4b185f498fc5f84e?s=128&d=identicon&r=PG&f=1", "display_name": "assassinsweed1", "link": "https://stackoverflow.com/users/4207764/assassinsweed1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 294, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1507614347, "creation_date": 1507580551, "last_edit_date": 1507582879, "question_id": 46654394, "link": "https://stackoverflow.com/questions/46654394/haskell-morse-code-exercise-how-to-add-gaps-between-list-items", "title": "Haskell Morse Code Exercise - how to add &quot;gaps&quot; between list items", "body": "<p>I am currently working on a Morse code encoder in Haskell. This is my first time working in Haskell and I'm finding it difficult to think in a \"functional\" way. So far I have come up with this:</p>\n\n<pre><code>module Formative1\n    (encode, decode, toTree, toTable)\nwhere\n\nimport safe Lib\n\nencode :: String -&gt; [MorseUnit]\nencode str = codeText(words str)\n\ncodeWord :: String -&gt; [MorseUnit]\ncodeWord word = map codeSymbol word\n\ncodeText :: [String] -&gt; [MorseUnit]\ncodeText list = map codeWord list\n</code></pre>\n\n<p>To explain my code:\n<code>encode</code> is the main function. It uses <code>words</code> to break down sentences into a list of words. <code>codeText</code> is used to apply the function <code>codeWord</code> over each word in the list. <code>codeWord</code> then <code>maps</code> over each character in each word and finds the <code>MorseUnit</code> using <code>codeSymbol</code>. </p>\n\n<p>I have two issues with this solution:</p>\n\n<p>Issue 1: I get an error every time I run it due to <code>[MorseUnit]</code> not matching <code>[[MorseUnit]]</code>, I believe this is due to me using <code>map</code> twice so it's made a list within a list. But I can't think of another solution without using <code>map</code>.</p>\n\n<p>Issue2: The rules of Morse Code state, after each letter, there should be a \"shortGap\", and after each word, there should be a \"mediumGap\". I have no idea how to insert either string inbetween each element of the list (I would insert shortGap between every element in <code>map codeSymbol word</code> so the shortGaps are between each letter, and I would insert mediumGap between every element in <code>map codeWord list</code> so the mediumGaps are between each word). I also don't understand at what point would I add the gaps because I don't want to accidentally apply <code>codeSymbol</code> to any of the gaps and replace them. </p>\n\n<p>Any solutions would be helpful! Thank you.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1507565855, "post_id": 46650775, "comment_id": 80250719, "body": "But <code>Op</code> and <code>Fu</code> in your <code>Expr</code> are the <b>names of the constructors</b>."}, {"owner": {"reputation": 676, "user_id": 4165235, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f35ee4291fd7978fa3619b278d7a8c04?s=128&d=identicon&r=PG&f=1", "display_name": "Salviati", "link": "https://stackoverflow.com/users/4165235/salviati"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1507565969, "post_id": 46650775, "comment_id": 80250790, "body": "Sorry, fixed it"}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1507566205, "post_id": 46650775, "comment_id": 80250898, "body": "@Salviati You just have a typo at the beginning that should read &quot;if I have three data types <b>Expr</b>, Op, and Fu&quot;..."}], "answers": [{"comments": [{"owner": {"reputation": 676, "user_id": 4165235, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f35ee4291fd7978fa3619b278d7a8c04?s=128&d=identicon&r=PG&f=1", "display_name": "Salviati", "link": "https://stackoverflow.com/users/4165235/salviati"}, "edited": false, "score": 0, "creation_date": 1507567475, "post_id": 46650931, "comment_id": 80251523, "body": "Ty so much, really feel data types is a lot clearer now. It really is a pain in the ass before it is understood."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1507570283, "post_id": 46650931, "comment_id": 80252841, "body": "Show instances should typically print valid Haskell code that could be read back as the same value by a reasonable Read instance. When you want to print the data in a different format, as here, it&#39;s better to define a separate function for it than to repurpose Show."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1507570518, "post_id": 46650931, "comment_id": 80252981, "body": "@amalloy Good point. You can still create a custom <code>read</code> instance to satisfy that <code>read . show == id</code>, but in this case you probably don&#39;t want that for the operators. Maybe the <code>Fu</code> type is a better example here."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1507570666, "post_id": 46650931, "comment_id": 80253055, "body": "No, the strings you output with this answer cannot possibly be read back in such that <code>read . show == id</code> because they are ambiguous. What is &quot;1+1+1&quot;? It could be <code>(Operator Add 1 (Operator Add 1 1))</code> or <code>(Operator Add (Operator Add 1 1) 1)</code>."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1507570868, "post_id": 46650931, "comment_id": 80253150, "body": "@amalloy Notice that my example is not an instance of <code>show</code> for <code>Expr</code>, only <code>Op</code>. You wouldn&#39;t have a read for &quot;1+1+1&quot; you&#39;d only have an instance for &quot;+&quot;. My suggestion in the previous comment was just for a show instance for <code>Fu</code> so that instead of using <code>printFun Sin = &quot;Sin&quot;</code> you have <code>show Sin = &quot;Sin&quot;</code> or an automated deriving. These smaller datatypes make perfect sense to have shows and reads."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1507570982, "post_id": 46650931, "comment_id": 80253199, "body": "Ah, I indeed didn&#39;t notice that. I now agree this is an admissible <code>Show</code> instance, although I still don&#39;t see the value in it compared to using a different function."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1507571062, "post_id": 46650931, "comment_id": 80253237, "body": "Since the OP is new to haskell, I just wanted to through the idea of a typeclass out there, and maybe point them to <code>Show</code> if they hadn&#39;t seen it before. It&#39;s not necessarily better, just another way to skin the cat."}], "tags": [], "owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "is_accepted": false, "score": 3, "last_activity_date": 1507571214, "last_edit_date": 1507571214, "creation_date": 1507566153, "answer_id": 46650931, "question_id": 46650775, "link": "https://stackoverflow.com/questions/46650775/convert-custom-datatype-to-string/46650931#46650931", "title": "Convert Custom Datatype to String", "body": "<p>When you pattern match, you need to match on the constructor you passed in. In your example, an <code>Expr</code> can have an <code>Operator</code> constructor that contains the relevant information to print:</p>\n\n<pre><code>printOut (Num n) = show n\nprintOut X = \"x\"\nprintOut (Operator op a b) = printOut a ++ printOp op ++ printOut b\nprintOut (Function fu a) = printFun fu ++ printOut a\n</code></pre>\n\n<p>Now you just define additional pattern matches for your operators and functions:</p>\n\n<pre><code>printOp Add = \"+\"\nprintOp Mul = \"x\"\n\nprintFun Sin = \"Sin\"\nprintFun Cos = \"Cos\"\n</code></pre>\n\n<p>In addition to what @WillemVanOnsem wrote, you actually aren't printing anything to the screen with these \"print\" functions. Instead, you are converting them from your datatype to a string. There is a common typeclass that does that called <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Prelude.html#v:show\" rel=\"nofollow noreferrer\"><code>Show</code></a>. You could also just create instances of show for your types, and use that function to display them instead:</p>\n\n<pre><code>instance Show Fu where \n  show Sin = \"Sin\"\n  show Cos = \"Cos\" \n</code></pre>\n\n<p>and then use <code>show</code> instead: </p>\n\n<pre><code>printOut (Function fu a) = show fu ++ printOut a\n</code></pre>\n\n<p>When you have a simple instance of <code>show</code>, you can also just have it derived automatically for you using the same syntax as you are using for deriving <code>Eq</code>:</p>\n\n<pre><code>data Fu = Sin | Cos\n        deriving (Show, Eq)\n</code></pre>\n\n<hr>\n\n<p>To deal with creating an instance of <code>Expr</code>, again you use the various <em>constructors</em> to do so: </p>\n\n<pre><code>let anExpr = Operator Add (Num 3.0) (Num 4.0)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1507566246, "creation_date": 1507566246, "answer_id": 46650961, "question_id": 46650775, "link": "https://stackoverflow.com/questions/46650775/convert-custom-datatype-to-string/46650961#46650961", "title": "Convert Custom Datatype to String", "body": "<p>You <strong>can not write references to types as constructor name</strong>. In your code:</p>\n\n<pre><code>data Expr = Num Double\n          | X\n          | <b>Op</b> Expr Expr\n          | <b>Fu</b> Expr\n          deriving (Eq)</code></pre>\n\n<p><code>Op</code> and <code>Fu</code> are the <strong>names of the constructors</strong>. Haskell considers the fact that there is a type with the same name, just a coincidence. You have to <strong>add the type of operator/function as first argument</strong>. So:</p>\n\n<pre><code>data Expr = Num Double\n          | X\n          | Op <b>Op</b> Expr Expr\n          | Fu <b>Fu</b> Expr\n          deriving (Eq)</code></pre>\n\n<p>Now the second <code>Op</code> and <code>Fu</code> specify the types of the first parameters.</p>\n\n<p>Now you thus have to replace your:</p>\n\n<pre><code>let anExpr = Add (Num 3.0) (Num 4.0)\n</code></pre>\n\n<p>with:</p>\n\n<pre><code>let anExpr = Op Add (Num 3.0) (Num 4.0)\n</code></pre>\n\n<p>Based on that, we can define some <em>helper</em> functions:</p>\n\n<pre><code>showOp :: Op -&gt; String\nshowOp Add = \"+\"\nshowOp Mul = \"*\"\n\nshowFu :: Fu -&gt; String\nshowFu Sin = \"sin\"\nshowFu Cos = \"cos\"\n</code></pre>\n\n<p>Now we can use these helper functions when we define our <code>showExpr</code> (I would not call it <code>printOut</code>, since the function does <em>not</em> print something, it only generates a string, you can do whatever you want with that string).</p>\n\n<pre><code>showExpr :: Expr -&gt; String\nshowExpr (Num n) = show n\nshowExpr X = \"x\"\nshowExpr (Op o a b) = '(' : showExpr a ++ ')' : showOp o ++ '(' : showExpr b ++ \")\"\nshowExpr (Fu f a) = showFu f ++ '(' : showExpr a ++ \")\"\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>*Main&gt; showExpr (Op Add (Num 3.0) (Num 4.0))\n\"(3.0)+(4.0)\"\n*Main&gt; showExpr (Op Add (Num 3.0) (Fu Sin (Num 4.0)))\n\"(3.0)+(sin(4.0))\"\n</code></pre>\n"}], "owner": {"reputation": 676, "user_id": 4165235, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f35ee4291fd7978fa3619b278d7a8c04?s=128&d=identicon&r=PG&f=1", "display_name": "Salviati", "link": "https://stackoverflow.com/users/4165235/salviati"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2418, "favorite_count": 1, "accepted_answer_id": 46650961, "answer_count": 2, "score": 6, "last_activity_date": 1507571214, "creation_date": 1507565576, "last_edit_date": 1507566388, "question_id": 46650775, "link": "https://stackoverflow.com/questions/46650775/convert-custom-datatype-to-string", "title": "Convert Custom Datatype to String", "body": "<p>If I have three data types named <code>Expr</code>, <code>Op</code> and <code>Fu</code> like this. </p>\n\n<pre><code>data Expr = Num Double\n          | X\n          | Operator Op Expr Expr\n          | Function Fu Expr\n          deriving (Eq)\n\ndata Op = Add | Mul\n        deriving (Eq)\n\ndata Fu = Sin | Cos\n        deriving (Eq)\n</code></pre>\n\n<p>What I am supposed to do is later create an expression based on the datatype. For example </p>\n\n<pre><code>let anExpr = Add (Num 3.0) (Num 4.0)\n</code></pre>\n\n<p>And than print out the corresponding expression, in this case it should just be \"3.0+4.0\". </p>\n\n<p>The problem I am facing is to create another type or data type to recognize if it is an addition or multiplication symbol it is supposed to print out. What I would like to do is something like this in pseudo code</p>\n\n<pre><code>printOut (Num n) = show n\nprintOut X = \"x\"\nprintOut (Op a b) = printOut a ++ 'printOutRightOp' ++ printOut b\nprintOut (Fu a) = 'printOutRightFu' ++ printOut a\n</code></pre>\n\n<p>How am I supposed to do this?</p>\n"}, {"tags": ["javascript", "haskell", "rxjs5"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1507570781, "post_id": 46649999, "comment_id": 80253112, "body": "Commenting on the Haskell, it really should be <code>Just 3 &gt;&gt; Just 4 &gt;&gt; Just 7 &gt;&gt; Nothing &gt;&gt; ...</code> etc, since <code>&gt;&gt;</code> is defined as <code>a &gt;&gt; b = a &gt;&gt;= \\_ -&gt; b</code>."}], "answers": [{"tags": [], "owner": {"reputation": 29842, "user_id": 1641941, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Q8zet.png?s=128&g=1", "display_name": "HMR", "link": "https://stackoverflow.com/users/1641941/hmr"}, "is_accepted": false, "score": 0, "last_activity_date": 1507570020, "last_edit_date": 1507570020, "creation_date": 1507568654, "answer_id": 46651563, "question_id": 46649999, "link": "https://stackoverflow.com/questions/46649999/handle-stream-like-maybe-monad/46651563#46651563", "title": "Handle stream like maybe monad", "body": "<p>You could try to hack it like this:</p>\n\n<pre><code>const NOTHING = {};\nconst wrapMaybe = \n  fn =&gt;\n  x =&gt;\n    (x!==undefined &amp;&amp; typeof x.then === \"function\")\n      ?x.then(wrapMaybe(fn))\n      :(x === NOTHING)?NOTHING:fn(x)\n\nconst source = Rx.Observable.from([1,2,3,4,5]);\n//wrap each map function in a maybe\nconst example = source\n  .map(wrapMaybe(val =&gt; console.log(\"map:\",1,val) || val + 10))\n  .map(wrapMaybe(val =&gt; console.log(\"map:\",2,val) || Promise.resolve(NOTHING)))\n  .map(wrapMaybe(val =&gt; console.log(\"map:\",3,val) || val + 10))\n;\n//wrap the source in an object that has mm (maybe map) function\nconst wrapSource =\n  source =&gt; {\n    source.mm = \n      function(fn){\n        var ret = this.map(wrapMaybe(fn));\n        ret.mm = this.mm;\n        return ret;\n      }\n    ;\n    return source;\n  }\n;\nconst example2 = wrapSource(source)\n  .mm(val =&gt; console.log(\"mm:\",1,val) || val + 20)\n  .mm(val =&gt; console.log(\"mm:\",2,val) || NOTHING)\n  .mm(val =&gt; console.log(\"mm:\",3,val) || val + 20)\n;\nexample.subscribe(val =&gt; console.log(val));\nexample2.subscribe(val =&gt; console.log(val));\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 29842, "user_id": 1641941, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Q8zet.png?s=128&g=1", "display_name": "HMR", "link": "https://stackoverflow.com/users/1641941/hmr"}, "is_accepted": false, "score": 1, "last_activity_date": 1507606093, "last_edit_date": 1507606093, "creation_date": 1507603039, "answer_id": 46657855, "question_id": 46649999, "link": "https://stackoverflow.com/questions/46649999/handle-stream-like-maybe-monad/46657855#46657855", "title": "Handle stream like maybe monad", "body": "<p>JavaScript does not have pipe or compose operators so the syntax of composing functions could be:</p>\n\n<pre><code>compose(arrayOfFunctions);\n</code></pre>\n\n<p>Here is what compose could look like with some examples:</p>\n\n<pre><code>const NOTHING = {};\n//see if x is like a promise (has a \"then\" method)\nconst promiseLike =\n  x =&gt;\n    (x!==undefined &amp;&amp; typeof x.then === \"function\")\n;\n/**\n * \n * takes a function fn and returns a function that takes x\n * and calls fn(x) if x does not equal NOTHING\n * if x does equal NOTHING it returns NOTHING \n */\nconst wrapMaybe = \n  fn =&gt;\n  x =&gt;\n      (promiseLike(x))   \n        ?x.then(wrapMaybe(fn))\n        :(x === NOTHING)?NOTHING:fn(x)\n;\n/**\n * \n * takes 2 functions and turns it into:\n * fn2(fn1(x)) when a value x is provided\n * if x is a promse it will turn it into:\n * x.then(x =&gt; fn2(fn1(x)))\n * if fn1(x) is a promise it will turn it into:\n * fn1(x).then(x =&gt; fn2(x))\n * if both x and fn1(x) are promises:\n * x.then(x =&gt; fn1(x)).then(x =&gt; fn2(x))\n */\nconst compose2 =\n  fn1=&gt;\n  fn2=&gt;\n  x =&gt; {\n    //if the current value is a promise\n    if(promiseLike(x)){\n      return x.then(x =&gt; compose2(fn1)(fn2))\n    }\n    const res1 = fn1(x);\n    if(promiseLike(res1)){\n      //result of fn1(x) is a promise\n      //  invoke fn2 with the promise resolved value\n      return res1.then(x =&gt; fn2(x))\n    }\n    //no promise, invoke fn2 with result of fn1(x)\n    return fn2(res1);\n\n  }\n;\n/**\n * turns an array of functions [fn1,fn2,fn3] into:\n * fn3(fn2(fn3(x)))\n * both x or any of the results of the functions can be a promise\n * If it is a promse then the next function will be called with\n * the resolve value of the promise.\n * If the promse is rejected the next function is not called\n * the handler for reject is called later down the promise chain\n * for example fn2 returns a rejected promise:\n * fn1(x)\n * .then(x =&gt; fn2(x))\n * .then(notCalled =&gt; fn3(notcalled))\n * .then(undefined,called)\n */\nconst compose =\n  fns =&gt;\n    fns.reduce(\n      (acc,fn) =&gt; compose2(acc)(fn)\n      ,x=&gt;x//id function\n    )\n;\n/**\n * Turns an array of functions into compose(arrOfFunctions)\n * but maps the functions to wrapMaybe(function):\n * fn turns into wrapMaybe(fn)\n */\nconst composeWithMaybe =\n    fns =&gt;\n      compose(\n        fns.map(fn=&gt;wrapMaybe(fn))\n      )\n;\nconst source = Rx.Observable.from([1,2,3,4,5]);\nconst mapHandlers = \n  [\n    val =&gt; console.log(\"map:\",1,\"value:\",val) || val + 10\n    // you can return a promise in the function(s)\n    //  from then on all results will be promises but next\n    //  function is not called with the promise but it's resolve value\n    // ,val =&gt; console.log(\"map:\",2,\"value:\",val) || Promise.resolve(NOTHING)\n    ,val =&gt; console.log(\"map:\",2,\"value:\",val) || NOTHING\n    // instead of Some or None you could return a rejected promise\n    //  this basically gets you the same thing, none of the other\n    //  functions are called, the result is a promise value that\n    //  will invoke it's reject handler\n    // ,val =&gt; console.log(\"map:\",2,\"value:\",val) || Promise.reject(\"Rejected reason\")\n    ,val =&gt; console.error(\"map should not be executed:\",3,\"value:\",val) || val + 10\n  ]\n;\nconst example = source\n  .map(\n    composeWithMaybe(\n      mapHandlers\n    )\n  )\n;\n//synch example\nexample.subscribe(val =&gt; console.log(val));\n\n// asynch example, you need to return a promise in one of the funcitons\n// example.subscribe(\n//   val =&gt; val.then(\n//     val =&gt; console.log(val)\n//     ,reject =&gt; console.warn(reject)\n//   )\n// );\n</code></pre>\n\n<p>If you want to use custom operators you can compile your code with <a href=\"http://www.sweetjs.org/doc/tutorial.html#sweet-operators\" rel=\"nofollow noreferrer\">sweet.js</a>. These custom operators show up as syntax errors in your IDE so if you want to program functional then maybe have a look at <a href=\"http://elm-lang.org/\" rel=\"nofollow noreferrer\">ELM</a> or <a href=\"http://fable.io/\" rel=\"nofollow noreferrer\">Fable</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 4382, "user_id": 822317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca0ab6e450f894e06652ee257df9d647?s=128&d=identicon&r=PG", "display_name": "Shuhei Kagawa", "link": "https://stackoverflow.com/users/822317/shuhei-kagawa"}, "is_accepted": false, "score": -1, "last_activity_date": 1507613757, "last_edit_date": 1507613757, "creation_date": 1507613369, "answer_id": 46659187, "question_id": 46649999, "link": "https://stackoverflow.com/questions/46649999/handle-stream-like-maybe-monad/46659187#46659187", "title": "Handle stream like maybe monad", "body": "<p>Because you are using only <code>map</code> , which means all validations happen synchronously, I would just write a function to handle all validations at once.</p>\n\n<pre><code>function validate(validators) {\n  return input =&gt;\n    validators.every(validator =&gt; validator(input));\n}\n\nconst oEmailValid$ = oEmailInput$\n  .map(validate([\n    _catchInputCtrlValue,\n    _isStringNotEmpty,\n    ...\n  ]))\n  .subscribe((predicate) =&gt; console.log(predicate));\n</code></pre>\n\n<p>I believe it\u2019s nice to write pure functions as much as possible and use Stream or Monad-like things only when you really need them, like in Haskell.</p>\n"}, {"tags": [], "owner": {"reputation": 103, "user_id": 7128475, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddfa0a1a2b9aaa1785ad83bbb2ade154?s=128&d=identicon&r=PG", "display_name": "cherealnice", "link": "https://stackoverflow.com/users/7128475/cherealnice"}, "is_accepted": false, "score": 1, "last_activity_date": 1507642593, "creation_date": 1507642593, "answer_id": 46668200, "question_id": 46649999, "link": "https://stackoverflow.com/questions/46649999/handle-stream-like-maybe-monad/46668200#46668200", "title": "Handle stream like maybe monad", "body": "<p>Folktale has a good Maybe monad.\n<a href=\"https://github.com/folktale/data.maybe\" rel=\"nofollow noreferrer\">https://github.com/folktale/data.maybe</a></p>\n\n<pre><code>function find(collection, predicate) {\n\n  for (var i = 0; i &lt; collection.length; ++i) {\n    var item = collection[i]\n    if (predicate(item))  return Maybe.Just(item)\n  }\n  return Maybe.Nothing()\n}\n\nvar numbers = [-2, -1, 0, 1, 2]\nvar a = find(numbers, function(a){ return a &gt; 5 })\nvar b = find(numbers, function(a){ return a === 0 })\n\na.map(function(x){ return x + 1 })\n// =&gt; Maybe.Nothing\nb.map(function(x){ return x + 1 })\n// =&gt; Maybe.Just(1)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 33, "user_id": 5614103, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbf7cf247a2357c4ea696e5f3b77c6cb?s=128&d=identicon&r=PG", "display_name": "Eccentric J", "link": "https://stackoverflow.com/users/5614103/eccentric-j"}, "is_accepted": false, "score": 0, "last_activity_date": 1507666405, "creation_date": 1507666405, "answer_id": 46675199, "question_id": 46649999, "link": "https://stackoverflow.com/questions/46649999/handle-stream-like-maybe-monad/46675199#46675199", "title": "Handle stream like maybe monad", "body": "<p>A couple of solutions come to mind for this case. However, if you are really looking for something like Haskell's maybe then Folktale (as user7128475 suggested) or <a href=\"https://github.com/sanctuary-js/sanctuary\" rel=\"nofollow noreferrer\">Sanctuary</a> have Maybe implementations.</p>\n\n<p>The first entails using <code>.filter</code> and <code>.defaultIfEmpty</code> however this only works if <code>oEmailInput$</code> is a 0 - 1 stream. </p>\n\n<pre><code>const oEmailValid$ = oEmailInput$\n  .map(_catchInputCtrlValue)\n  .map(_isStringNotEmpty)\n  .filter(isValid =&gt; isValid) // or .filter(Boolean) \n  .map(...)\n  .map(...)\n  .map(...)\n  .map(...)\n  .defaultIfEmpty(false)\n  .subscribe((predicate) =&gt; console.log(predicate))\n</code></pre>\n\n<p>This solution could also work inside of a flatMap if you wanted to apply it to a 0 - * stream.</p>\n\n<pre><code>const oEmailValid$ = oEmailInput$\n  .map(_catchInputCtrlValue)\n  .map(_isStringNotEmpty)\n  .flatMap(isValid =&gt; Observable.of(isValid)\n    .filter(Boolean) \n    .map(...)\n    .map(...)\n    .map(...)\n    .map(...)\n    .defaultIfEmpty(isValid)\n  )\n  .subscribe((predicate) =&gt; console.log(predicate))\n</code></pre>\n\n<p>A more general kind of solution would be to use flatMap again which works for 0 - * streams as well:</p>\n\n<pre><code>const oEmailValid$ = oEmailInput$\n  .map(_catchInputCtrlValue)\n  .flatMap(input =&gt; _isStringNotEmpty(input)\n    ? Observable.of(input)\n        .map(...)\n        .map(...)\n        .map(...)\n        .map(...)\n    : Observable.of(false)\n  )\n  .subscribe((predicate) =&gt; console.log(predicate))\n</code></pre>\n\n<p>Personally though, I don't think a stream is the best representation of that kind of problem. Streams best model actions\\behavior with a single behavioral goal and right now the purpose of your original example is unclear to me and seems to have separate but equal branches. Streams should typically model how data moves through a series of desired actions to make up a single behavior. This is what I suspect Shuhei Kagawa was trying to get at. For instance I use a stream that represents a form that does the following:</p>\n\n<pre><code>onFormSubmit$\n  .map(_validateData)\n  .tap(console.log) // along the lines of your subscribe function\n  .tap(showErrors)\n  .tap(updateFormState)\n  .filter(form =&gt; form.isValid)\n  .subscribe(_postData)\n</code></pre>\n\n<p>and the result of <code>_validateData</code> would be a general shape like:</p>\n\n<pre><code>{\n  isValid: true | false,\n  fields: {\n    email: string, // original input text\n  },\n  errors: [\n    { name: \"email\", message: \"Please enter a valid email address.\" },\n  ],\n}\n</code></pre>\n\n<p>This way steps like showErrors can map over the errors array and wont break if it's empty or require conditional testing.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 308, "favorite_count": 0, "answer_count": 5, "score": 0, "last_activity_date": 1507666405, "creation_date": 1507562934, "question_id": 46649999, "link": "https://stackoverflow.com/questions/46649999/handle-stream-like-maybe-monad", "title": "Handle stream like maybe monad", "body": "<p>Consider following stream:</p>\n\n<pre><code> const oEmailValid$ = oEmailInput$\n      .map(_catchInputCtrlValue)\n      .map(_isStringNotEmpty) \n      .map(...)\n      .map(...)\n      .map(...)\n      .map(...)\n      .subscribe((predicate) =&gt; console.log(predicate))\n</code></pre>\n\n<p>Suppose <code>_isStringNotEmpty</code> returns <code>false</code>, so I wan't to continue the stream but still want to receive on the subscribe function the returned value of <code>_isStringNotEmpty</code>, in this case is <code>false</code>.   </p>\n\n<p>How to get it? </p>\n\n<p>To clarify, what I mean, consider the following <code>Haskell</code> code:</p>\n\n<pre><code>(Just 3) &gt;&gt;= (\\_ -&gt; Just 4) &gt;&gt;= (\\_ -&gt; Just 7) &gt;&gt;= (\\_ -&gt; Nothing) &gt;&gt;= (\\_ -&gt; Just 10)\n</code></pre>\n\n<p>As the result I've got <code>Nothing</code>, because the 4th computation returns <code>Nothing</code>.</p>\n"}, {"tags": ["haskell", "functional-programming", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 1, "creation_date": 1507562793, "post_id": 46649804, "comment_id": 80248901, "body": "As written, your question is rather unclear. In general &quot;How can this be improved&quot; is an ambiguous question, and will likely get closed as opinion based (those kinds of questions are typically for the code review SE). What is the &quot;unintended case&quot;? What isn&#39;t working as you expect?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1507562795, "post_id": 46649804, "comment_id": 80248902, "body": "<code>result &lt;- ...; return result</code> is equivalent to not binding result at all; Regarding your question about code review - there exists a separate se-site exactly for that purpose - <a href=\"https://codereview.stackexchange.com/\">codereview.stackexchange.com</a> - I would propose migrating this question"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1507562929, "post_id": 46649804, "comment_id": 80248973, "body": "You can create a <code>m ()</code> value for any <code>Monad m</code> (including <code>IO</code>) with <code>return ()</code>"}, {"owner": {"reputation": 3032, "user_id": 2178852, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yshPF.jpg?s=128&g=1", "display_name": "Chetan Bhasin", "link": "https://stackoverflow.com/users/2178852/chetan-bhasin"}, "edited": false, "score": 0, "creation_date": 1507575877, "post_id": 46649804, "comment_id": 80255861, "body": "Thanks all for suggestions. I do feel that this is a question for StackOverflow and not a code review request. I&#39;ll edit my question text to clarify that and make it more obvious. Sorry for not being clear about this in the first attempt."}], "answers": [{"comments": [{"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1507570171, "post_id": 46651838, "comment_id": 80252787, "body": "Also, I should mention, most people prefer alternatives to <code>MaybeT</code> that allow returning an explanation of what went wrong, i.e., an error message, whether it&#39;s a plain string or a structured exception.  Some people use <code>ExceptT</code> (formerly <code>ErrorT</code>) for this."}, {"owner": {"reputation": 3032, "user_id": 2178852, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yshPF.jpg?s=128&g=1", "display_name": "Chetan Bhasin", "link": "https://stackoverflow.com/users/2178852/chetan-bhasin"}, "edited": false, "score": 0, "creation_date": 1507620108, "post_id": 46651838, "comment_id": 80269987, "body": "Thanks for the great answer. Yes, I realise that I wasn&#39;t using any monad transformers, that&#39;s what I wanted to use though. I didn&#39;t really know that this is what a monad transformer is. Your made that clear for me in your answer."}, {"owner": {"reputation": 3032, "user_id": 2178852, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yshPF.jpg?s=128&g=1", "display_name": "Chetan Bhasin", "link": "https://stackoverflow.com/users/2178852/chetan-bhasin"}, "edited": false, "score": 0, "creation_date": 1507662292, "post_id": 46651838, "comment_id": 80296719, "body": "I have one more quick question about your answer. The <code>M ()</code> output in the <code>userSignup</code> function is what is called a Free Monad, right? Since it&#39;s not really a computation, but a set of computations that can be run?"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 5, "last_activity_date": 1507583255, "last_edit_date": 1507583255, "creation_date": 1507569737, "answer_id": 46651838, "question_id": 46649804, "link": "https://stackoverflow.com/questions/46649804/how-to-use-monad-transformers-to-combine-different-both-pure-and-impure-monads/46651838#46651838", "title": "How to use Monad Transformers to combine different (both pure and impure) monads?", "body": "<p><em>Edit:</em> updated answer to match your updated question.</p>\n\n<p>Just to be clear, you aren't actually <em>using</em> any monad transformers in your code example.  You're just nesting one monad inside another.  For an example using a real monad transformer <code>MonadT</code>, see my answer to your second question.</p>\n\n<p><strong>For your first question,</strong> as @David Young commented, you can use <code>return ()</code>:</p>\n\n<pre><code>showSuccess :: Bool -&gt; IO ()\nshowSuccess success =\n   if success then putStrLn \"I am great!\"\n              else return ()    -- fail silently\n</code></pre>\n\n<p>More generally, if a function returns <code>IO a</code> for some type <code>a</code>, then you can always return a \"pure\" value that has no associated IO action by using the <code>return</code> function.  (That's what <code>return</code> is for!)  In the case of a function returning <code>IO ()</code>, the only value of type <code>()</code> is the value <code>()</code>, so your only choice is <code>return ()</code>.  For <code>IO a</code> for some other type <code>a</code>, you'll need to <code>return</code> some value of type <code>a</code>.  If you want the <em>option</em> to return a value or not, you'll need to make the type <code>IO (Maybe a)</code> or use a <code>MaybeT</code> transformer, as below.</p>\n\n<p><strong>For your second question,</strong> you're basically asking how to neatly express nested computations in the <code>Maybe</code> monad:</p>\n\n<pre><code>let newUser = encrypted &gt;&gt;= (\\x -&gt; Just user { password = x })\n</code></pre>\n\n<p>within an outer <code>IO</code> monad.</p>\n\n<p>In general, extensive computations in nested monads are painful to write and lead to ugly, unclear code.  That's why monad transformers were invented.  They allow you to take facilities borrowed from multiple monads and bundle them up in a <em>single</em> monad.  Then, all bind (<code>&gt;&gt;=</code>) and <code>return</code> operations, and all do-syntax can refer to operations in the same, single monad, so you aren't shifting between \"IO mode\" and \"Maybe mode\" when you're reading and writing code.</p>\n\n<p>Rewriting your code to use a transformer involves importing the <code>MaybeT</code> transformer from the <code>transformers</code> package and defining your own monad.  You can call it anything you like, though you'll likely be typing it a lot, so I usually use something short, like <code>M</code>.</p>\n\n<pre><code>import Control.Monad\nimport Control.Monad.Trans\nimport Control.Monad.Trans.Maybe\n\n-- M is the IO monad supplemented with Maybe functionality\ntype M = MaybeT IO\nnothing :: M a\nnothing = mzero  -- nicer name for failing in M monad\n</code></pre>\n\n<p>Then, you can rewrite your <code>userSignUp</code> function as follows:</p>\n\n<pre><code>userSignUp :: Connection -&gt; User -&gt; M ()\nuserSignUp conn user = do\n  encrypted &lt;- encryptPassword (password user)     -- encrypted  :: String\n  let newUser = user { password = encrypted }      -- newUser    :: User\n  insertUser &lt;- createUser conn                    -- insertUser :: User -&gt; M ()\n  insertUser newUser\n</code></pre>\n\n<p>I've added some type annotations in the comments.  Note that the new <code>M</code> monad takes care of ensuring that each variable bound by the <code>&lt;-</code> operator will have already been checked for <code>Nothing</code>.  If any step returns <code>Nothing</code>, processing will be aborted.  If a step returns <code>Just x</code>, the <code>x</code> will be automatically unwrapped.  You don't typically have to deal with (or even see) the <code>Nothing</code>s or <code>Just</code>s.</p>\n\n<p>Your other functions must live in the <code>M</code> monad, too, and they can either return a value (success) or indicate failure like so:</p>\n\n<pre><code>encryptPassword :: String -&gt; M String\nencryptPassword pwd = do\n  epwd &lt;- liftIO $ do putStrLn \"Dear System Operator,\"\n                      putStrLn $ \"Plaintext password was \" ++ pwd\n                      putStr $ \"Please manually calculate encrypted version: \"\n                      getLine\n  if epwd == \"I don't know\" then nothing   -- return failure\n    else return epwd                       -- return success\n</code></pre>\n\n<p>Note that they can use <code>liftIO</code> to lift operations to the underlying IO monad, so all IO operations are available.  Otherwise, they can either return pure values (via <code>return</code>) or signal failure in the <code>MaybeT</code> layer with <code>nothing</code> (my alias for <code>mzero</code>).</p>\n\n<p>The only thing left now is to provide a facility to \"run\" your custom monad (which involves converting it from an <code>M a</code> to an <code>IO a</code>, so you could actually run it from <code>main</code>).  For this monad, the definition is trivial, but it's good practice to define a function in case your <code>M</code> monad is more complicated:</p>\n\n<pre><code>runM :: M a -&gt; IO (Maybe a)\nrunM = runMaybeT\n</code></pre>\n\n<p>A complete whole working example with stub code is included below.</p>\n\n<p><strong>For your third question,</strong> making it \"more functional\" won't necessarily make it more understandable, but the idea would be to make use of monad operators like <code>=&lt;&lt;</code> or applicative operators like <code>&lt;*&gt;</code> to mimic a functional form in a monadic context.  The following would be an equivalent \"more functional\" form of my monad transformer version of <code>userSignUp</code>.  It's not clear that this is more understandable than the imperative, \"do-notation\" version above, and it's certainly harder to write.</p>\n\n<pre><code>moreFunctionalUserSignUp :: Connection -&gt; User -&gt; M ()\nmoreFunctionalUserSignUp conn user\n  = join $ createUser conn\n           &lt;*&gt; (setPassword user &lt;$&gt; encryptPassword (password user))\n  where\n    setPassword u p = u { password = p }\n</code></pre>\n\n<p>You can imagine this as roughly equivalent to the pure functional computation:</p>\n\n<pre><code>  createUser conn (setPassword user (encryptPassword (password user)))\n</code></pre>\n\n<p>but with the right operators sprinkled in to make it type-check as a monadic computation.  (Why do you need <code>join</code>?  Don't even ask.)</p>\n\n<h2>Full MaybeT Example</h2>\n\n<pre><code>import Control.Monad\nimport Control.Monad.Trans\nimport Control.Monad.Trans.Maybe\n\n-- M is the IO monad supplemented with Maybe functionality\ntype M = MaybeT IO\nnothing :: M a\nnothing = mzero  -- nicer name for failing in M monad\n\nrunM :: M a -&gt; IO (Maybe a)\nrunM = runMaybeT\n\ndata User = User { username :: String, password :: String } deriving (Show)\ndata Connection = Connection\n\nuserSignUp :: Connection -&gt; User -&gt; M ()\nuserSignUp conn user = do\n  encrypted &lt;- encryptPassword (password user)     -- encrypted  :: String\n  let newUser = user { password = encrypted }      -- newUser    :: User\n  insertUser &lt;- createUser conn                    -- insertUser :: User -&gt; M ()\n  insertUser newUser\n\nencryptPassword :: String -&gt; M String\nencryptPassword pwd = do\n  epwd &lt;- liftIO $ do putStrLn \"Dear System Operator,\"\n                      putStrLn $ \"Plaintext password was \" ++ pwd\n                      putStr $ \"Please manually calculate encrypted version: \"\n                      getLine\n  if epwd == \"I don't know\" then nothing   -- return failure\n    else return epwd                       -- return success\n\ncreateUser :: Connection -&gt; M (User -&gt; M ())\ncreateUser conn = do\n  -- some fake storage\n  return (\\user -&gt; liftIO $ putStrLn $ \"stored user record \" ++ show user)\n\nmain :: IO ()\nmain = do username  &lt;- putStr \"Username: \" &gt;&gt; getLine\n          password  &lt;- putStr \"Password: \" &gt;&gt; getLine\n\n          let user = User username password\n          result &lt;- runM (userSignUp Connection user)\n\n          case result of\n            Nothing -&gt; putStrLn \"Something failed -- with MaybeT, we can't tell what.\"\n            Just () -&gt; putStrLn \"Success!\"\n</code></pre>\n"}], "owner": {"reputation": 3032, "user_id": 2178852, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yshPF.jpg?s=128&g=1", "display_name": "Chetan Bhasin", "link": "https://stackoverflow.com/users/2178852/chetan-bhasin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 411, "favorite_count": 0, "accepted_answer_id": 46651838, "answer_count": 1, "score": 2, "last_activity_date": 1507622558, "creation_date": 1507562284, "last_edit_date": 1507622558, "question_id": 46649804, "link": "https://stackoverflow.com/questions/46649804/how-to-use-monad-transformers-to-combine-different-both-pure-and-impure-monads", "title": "How to use Monad Transformers to combine different (both pure and impure) monads?", "body": "<p>I'm writing my first Haskell application, and I'm having a hard time understanding the use of Monad transformers.</p>\n\n<p>Example code:</p>\n\n<pre><code>-- Creates a new user in the system and encrypts their password\nuserSignup :: Connection -&gt; User -&gt; IO ()\nuserSignup conn user = do\n    -- Get the encrypted password for the user\n    encrypted &lt;- encryptPassword $ password user.     -- encryptPassword :: Text -&gt; IO (Maybe Text)\n    -- Updates the password to the encrypted password\n    -- if encryption was successful\n    let newUser = encrypted &gt;&gt;= (\\x -&gt; Just user { password = x })\n    -- Inserts the user using helper function and gets the result\n    result &lt;- insertUser (createUser conn) newUser\n    return result\n    where\n        insertUser :: (User -&gt; IO ()) -&gt; (Maybe User) -&gt; IO ()\n        insertUser insertable inuser = case inuser of\n            Just u -&gt; insertable u -- Insert if encryption was successful\n            Nothing -&gt; putStrLn \"Failed to create user\" -- Printing to get IO () in failure case\n</code></pre>\n\n<p>Problem:</p>\n\n<ul>\n<li>How to avoid actions like printing to console (as done in <code>insertUser</code> helper function), for cases where no output is produced by <code>IO</code>. More specifically, how to create a \"zero\" value for IO monad?</li>\n<li>How to combine two different kind of monads (in this case Maybe and IO) so that I can combine their contents and produce one unified result that may contain either the result, or the possible error?</li>\n<li>How to express such a problem in a functional way that's more understandable?</li>\n</ul>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2970, "user_id": 1763955, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/3a7a94d762a9d702b88404f840e31d8f?s=128&d=identicon&r=PG&f=1", "display_name": "Carbon", "link": "https://stackoverflow.com/users/1763955/carbon"}, "edited": false, "score": 0, "creation_date": 1507571730, "post_id": 46649621, "comment_id": 80253585, "body": "Building intuition: if a is a thing that can be compared, and you give a list of as to compare against, and the function name is elem (element), you can generally guess what the fn does from the type signature and name."}], "answers": [{"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 7, "last_activity_date": 1507571708, "last_edit_date": 1507571708, "creation_date": 1507561954, "answer_id": 46649691, "question_id": 46649621, "link": "https://stackoverflow.com/questions/46649621/what-does-this-mean-eq-a-a-a-bool/46649691#46649691", "title": "What does this mean? Eq a =&gt; a -&gt; [a] -&gt; Bool", "body": "<p><code>Eq a</code> is a so called class constraint. It means that the type substituted for <code>a</code> needs to implement the <code>Eq</code> typeclass. </p>\n\n<p>In a programming language like Java this would be something like implementing an interface.</p>\n\n<p>You might have already guessed that <code>Eq</code> provides the functions <code>==</code> and <code>/=</code>.\nIf you have more than one constraint the type signature looks like</p>\n\n<pre><code>fun :: (Ord a, Bounded a) =&gt; ...\n</code></pre>\n\n<p>to see what a typeclass provides you can look at the documentation on hackage or run <code>:info Ord</code> inside GHCi</p>\n"}], "owner": {"reputation": 287, "user_id": 8738033, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/1944285682265003/picture?type=large", "display_name": "Joao Parente", "link": "https://stackoverflow.com/users/8738033/joao-parente"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 197, "favorite_count": 1, "accepted_answer_id": 46649691, "answer_count": 1, "score": 2, "last_activity_date": 1507571708, "creation_date": 1507561718, "last_edit_date": 1507562190, "question_id": 46649621, "link": "https://stackoverflow.com/questions/46649621/what-does-this-mean-eq-a-a-a-bool", "title": "What does this mean? Eq a =&gt; a -&gt; [a] -&gt; Bool", "body": "<p>I was studying when I found a function <code>elem</code> of this type:</p>\n\n<pre><code>Eq a =&gt; a -&gt; [a] -&gt; Bool\n</code></pre>\n\n<p>What does the <code>Eq a =&gt;</code> mean?</p>\n"}, {"tags": ["haskell", "zeromq", "failed-installation"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 4, "creation_date": 1507561463, "post_id": 46649207, "comment_id": 80248129, "body": "What error do you get - I am fresh out of crystal balls, so I cannot check myself, what errors you get."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1507561617, "post_id": 46649207, "comment_id": 80248213, "body": "do you want to build it on a client machine or run it? - usually for building you need more dependencies which are then part of the application."}], "owner": {"reputation": 9, "user_id": 5062129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bdb80eedfc0b41e039d800e36331606?s=128&d=identicon&r=PG&f=1", "display_name": "sylwiab", "link": "https://stackoverflow.com/users/5062129/sylwiab"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 68, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1507568341, "creation_date": 1507560402, "last_edit_date": 1507568341, "question_id": 46649207, "link": "https://stackoverflow.com/questions/46649207/how-to-build-zeromq4-haskell-with-local-zmq", "title": "How to build zeromq4-haskell with local zmq?", "body": "<p>I want to be able to build <code>zeromq4-haskell</code> or build a project that depends on <code>zeromq4-haskell</code> without ZeroMQ installed in my system.</p>\n\n<p>In other words,<br>I want a command <code>stack build zeromq4-haskell</code> to succeed and compile with my local version of ZeroMQ. I have already tried setting the <strong><code>LIBRARY_PATH</code></strong> and <strong><code>LD_LIBRARY_PATH</code></strong> to a directory, which is containing <strong><code>libzmq.so</code></strong>,<br>but without any luck.</p>\n\n<p>My goal is to build a project, depending on ZeroMQ, on a client's machine that might not have ZeroMQ installed or doesn't have rights to install it with a package manager.</p>\n"}, {"tags": ["arrays", "haskell", "accelerate-haskell"], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 1, "last_activity_date": 1507580585, "creation_date": 1507580585, "answer_id": 46654399, "question_id": 46648982, "link": "https://stackoverflow.com/questions/46648982/parallel-programming-using-accelerate-data-array-accelerate/46654399#46654399", "title": "Parallel Programming using Accelerate (Data.Array.Accelerate)", "body": "<p>It's important to emphasize that <code>Accelerate</code> isn't just \u201cnormal parallelisation\u201d \u2013 it's specifically <a href=\"https://en.wikipedia.org/wiki/SIMD\" rel=\"nofollow noreferrer\">SIMD</a> parallelisation, which works by far best on a GPU. But you can't just read out arbitrary values from GPU memory, at least not without losing all the performance advantage, because that memory totally isn't optimised for random-access but only works properly in \u201cbatch mode\u201d. Hence the library's function that do the actual work always return an <code>Acc</code> / <code>Exp</code> value, so intermediate results can actually stay on the GPU (or whatever other parallel-processor).</p>\n\n<p>Now, it is also <em>possible</em> to execute Accelerate code on the CPU, in which case this issue doesn't really arise. But even here the interface is kept consistent; you should carry out the expensive calculation to the end and only in the end retrieve results back into \u201cnormal Haskell values\u201d.</p>\n\n<p>To accomplish this retrieval, each of the device-specific backends offers a <code>run</code> function, for instance <a href=\"http://hackage.haskell.org/package/accelerate-llvm-native-1.1.0.1/docs/Data-Array-Accelerate-LLVM-Native.html#v:run\" rel=\"nofollow noreferrer\"><code>Data.Array.Accelerate.LLVM.Native.run</code></a>.</p>\n"}], "owner": {"reputation": 1233, "user_id": 7970829, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/OGdYb.png?s=128&g=1", "display_name": "oRole", "link": "https://stackoverflow.com/users/7970829/orole"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 46654399, "answer_count": 1, "score": 1, "last_activity_date": 1507594632, "creation_date": 1507559809, "last_edit_date": 1507594632, "question_id": 46648982, "link": "https://stackoverflow.com/questions/46648982/parallel-programming-using-accelerate-data-array-accelerate", "title": "Parallel Programming using Accelerate (Data.Array.Accelerate)", "body": "<p><strong>Situation</strong> <br/>\nCurrently I'm working on a project which handles edge detection. Therefore I'd like to calculate the algorithms using accelerated arrays to achieve better performance. Unfortunately, I'm pretty new to functional programming, aswell as parallel programming and I don't really know whats the right way to go. <br/></p>\n\n<p><strong>Problem</strong> <br/>\nTo convert a given image into grayscale or even to perform edge detection I need access to each of the pixels / values of the array. <br/></p>\n\n<p>Using non-accelerated arrays (the Data.Array package) I could use the (!)-operator to get the desired value. <br/> </p>\n\n<p>Using accelerated arrays (the Data.Array.Accelerate package) there are similar functions like .. </p>\n\n<blockquote>\n  <p><code>(!) :: (Shape ix, Elt e) =&gt; Acc (Array ix e) -&gt; Exp ix -&gt; Exp e</code>  <br/>\n  Description: Expression form that extracts a scalar from an array</p>\n  \n  <p><code>(!!) :: (Shape ix, Elt e) =&gt; Acc (Array ix e) -&gt; Exp Int -&gt; Exp e</code> <br/>\n  Description: Expression form that extracts a scalar from an array at a linear index</p>\n</blockquote>\n\n<p>.. but they always end in returning Accelerates' expression value <code>(Exp e)</code> which leads to my question .. <br/></p>\n\n<p><strong>Question</strong> <br/>\nIs it possible to 'unpack' the value from the <code>Exp</code> data-type or what else would you recommend me to do? <br/></p>\n\n<p><strong>Example</strong> <br/></p>\n\n<p>Converting from image to accelerated array works ..</p>\n\n<pre><code>toArr :: Image PixelRGB8 -&gt; Acc (Array DIM2 (Pixel8, Pixel8, Pixel8))\ntoArr img = use $ fromFunction (Z :. width :. height) (\\(Z :. x :. y) -&gt; let (PixelRGB8 r g b) = pixelAt img x y in (r, g, b))\n            where width = imageWidth img\n                  height = imageHeight img\n</code></pre>\n\n<p>.. but I don't know to do it vice versa, because I would need to access the expressions value to generate the image from width/height/pixels.</p>\n\n<pre><code>toJuicy :: Acc (Array DIM2 (Pixel8, Pixel8, Pixel8)) -&gt; Image PixelRGB8 \ntoJuicy arr = undefined\n</code></pre>\n\n<p>Any help would be highly appreciated.</p>\n"}, {"tags": ["haskell", "typeclass", "category-theory"], "comments": [{"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 3, "creation_date": 1507554356, "post_id": 46646899, "comment_id": 80243354, "body": "I&#39;m not aware of anything standard defined. You could certainly define it yourself. I&#39;m not sure of the value since at the type level there&#39;s nothing to differentiate. I think a more appropriate solution might be <code>newtype</code> wrapper(s) and two different instances, similar to <code>Product</code> and <code>Sum</code> in <code>Data.Monoid</code>."}, {"owner": {"reputation": 533, "user_id": 3847023, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/mUqNl.jpg?s=128&g=1", "display_name": "Nick Tchayka", "link": "https://stackoverflow.com/users/3847023/nick-tchayka"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1507554492, "post_id": 46646899, "comment_id": 80243469, "body": "Yeah @ryachza I think that could be a more appropriate solution."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1507555094, "post_id": 46646899, "comment_id": 80243894, "body": "This is regularly done in an ad-hoc manner, e.g. <a href=\"http://hackage.haskell.org/package/diagrams-lib-1.4.1.2/docs/Diagrams-TwoD-Combinators.html#v:-61--61--61-\" rel=\"nofollow noreferrer\">in diagrams</a>, <a href=\"http://hackage.haskell.org/package/matrix-0.3.5.0/docs/Data-Matrix.html#g:9\" rel=\"nofollow noreferrer\">matrix</a> or <a href=\"http://hackage.haskell.org/package/hmatrix-0.18.1.0/docs/Numeric-LinearAlgebra-Data.html#g:12\" rel=\"nofollow noreferrer\">hmatrix</a>."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1507555553, "post_id": 46646899, "comment_id": 80244214, "body": "Depending on your exact requirements, you might look into <a href=\"https://en.wikipedia.org/wiki/Semiring\" rel=\"nofollow noreferrer\">semirings</a>, which are basically algebraic structures with both &quot;addition&quot; and &quot;multiplication&quot; operations. (Your <code>appendRow</code>/<code>appendColumn</code> is not an example of a semiring, but (square) matrices do form a semiring under matrix addition and matrix multiplication.)"}, {"owner": {"reputation": 9111, "user_id": 90088, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c018f213204496b4bbf481e7c8e6c15c?s=128&d=identicon&r=PG", "display_name": "Bartosz Milewski", "link": "https://stackoverflow.com/users/90088/bartosz-milewski"}, "edited": false, "score": 1, "creation_date": 1507667539, "post_id": 46646899, "comment_id": 80299314, "body": "You might also consider looking into bimodules."}], "answers": [{"comments": [{"owner": {"reputation": 533, "user_id": 3847023, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/mUqNl.jpg?s=128&g=1", "display_name": "Nick Tchayka", "link": "https://stackoverflow.com/users/3847023/nick-tchayka"}, "edited": false, "score": 0, "creation_date": 1507567457, "post_id": 46648943, "comment_id": 80251515, "body": "Really love this solution! But actually I think that this is overkill for the problem I&#39;m facing. Thank you very much :)"}], "tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 2, "last_activity_date": 1507559678, "creation_date": 1507559678, "answer_id": 46648943, "question_id": 46646899, "link": "https://stackoverflow.com/questions/46646899/is-there-a-monoid-equivalent-of-bifunctor/46648943#46648943", "title": "Is there a Monoid equivalent of Bifunctor?", "body": "<p>I guess you could do something like this with indexed Monoids:</p>\n\n\n\n<pre><code>{-# LANGUAGE PolyKinds      #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE TypeFamilies   #-}\n\nmodule IndexedMonoids where\n\nclass MonoidIx (m :: k -&gt; *) where\n  type Null m :: k\n  type Mult m (i :: k) (j :: k) :: k\n\n  nullIx :: m (Null m)\n  multIx :: m i -&gt; m j -&gt; m (Mult m i j)\n\nclass MonoidIx2 (m :: k -&gt; l -&gt; *) where\n  type Null1 m :: k\n  type Null2 m :: l\n  type Mult1 m (i :: k) (j :: k) :: k\n  type Mult2 m (p :: l) (q :: l) :: l\n\n  null1Ix :: m (Null1 m) p\n  null2Ix :: m i (Null2 m)\n  mult1Ix :: m i p -&gt; m j p -&gt; m (Mult1 m i j) p\n  mult2Ix :: m i p -&gt; m i q -&gt; m i (Mult2 m p q)\n</code></pre>\n\n<p>You'd expect a bunch of laws (identity, associativity, commutativity when you put 4 blocks together). A trivial example of an indexed Monoid: the one where the index does not matter:</p>\n\n\n\n<pre><code>newtype Dummy (m :: *) (i :: k) = Dummy { getDummy :: m }\n\ninstance Monoid m =&gt; MonoidIx (Dummy m :: * -&gt; *) where\n  type Null (Dummy m)     = ()\n  type Mult (Dummy m) i j = ()\n\n  nullIx = Dummy mempty\n  multIx (Dummy i) (Dummy j) = Dummy $ mappend i j\n</code></pre>\n\n<p>I'll let you implement the instance for matrices ;)</p>\n"}], "owner": {"reputation": 533, "user_id": 3847023, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/mUqNl.jpg?s=128&g=1", "display_name": "Nick Tchayka", "link": "https://stackoverflow.com/users/3847023/nick-tchayka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1507559678, "creation_date": 1507553301, "question_id": 46646899, "link": "https://stackoverflow.com/questions/46646899/is-there-a-monoid-equivalent-of-bifunctor", "title": "Is there a Monoid equivalent of Bifunctor?", "body": "<p>When working with a <a href=\"https://hackage.haskell.org/package/bifunctors-3.2.0.1/docs/Data-Bifunctor.html\" rel=\"nofollow noreferrer\"><code>Bifunctor</code></a>, we gain access to the <code>first</code> and <code>second</code> \"map\" functions. So basically it is a <code>Functor</code> that allows us to <code>fmap</code> in two different ways.</p>\n\n<p>Is there something like this for <code>Monoid</code>? Some concept that allows us to append in two different ways?</p>\n\n<p>For example, imagine an opaque <code>Matrix</code> type. It is not a list of lists or a vector of vectors, we have no clue how it is structured inside, but we know that we can append rows and columns to it.</p>\n\n<p>Would there be some type class that allowed to do this?</p>\n\n<pre><code>class X a where\n    firstAppend :: a -&gt; a -&gt; a\n    secondAppend :: a -&gt; a -&gt; a\n\ninstance X Matrix where\n    firstAppend = appendRow\n    secondAppend = appendColumn\n</code></pre>\n"}, {"tags": ["haskell", "aeson"], "answers": [{"tags": [], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "is_accepted": true, "score": 3, "last_activity_date": 1507550515, "creation_date": 1507550515, "answer_id": 46645990, "question_id": 46645601, "link": "https://stackoverflow.com/questions/46645601/use-datatype-name-in-json-instance/46645990#46645990", "title": "Use datatype name in JSON instance", "body": "<p>Enabling the <code>ScopedTypeVariables</code> extension I was able to compile this example. With this extension the <code>a</code> in <code>Proxy a</code> corresponds to the same <code>a</code> in the instance declaration.</p>\n"}], "owner": {"reputation": 29647, "user_id": 4999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae995fa03b218e7c27a608b5f14e68ae?s=128&d=identicon&r=PG", "display_name": "\u0141ukasz", "link": "https://stackoverflow.com/users/4999/%c5%81ukasz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "accepted_answer_id": 46645990, "answer_count": 1, "score": 1, "last_activity_date": 1507550515, "creation_date": 1507549325, "question_id": 46645601, "link": "https://stackoverflow.com/questions/46645601/use-datatype-name-in-json-instance", "title": "Use datatype name in JSON instance", "body": "<p>I'm trying to write a somehow generic instance for <code>FromJSON</code> typeclass. The idea is to use the datatype name during parsing of the JSON. I would think that's something which GHC should be able to do, but so far my attempts fail. The simplest version, using <code>Typeable</code> typeclass is below.</p>\n\n<pre><code>data GetResponse a = GetResponse { getCode :: Int, getItem :: a } deriving (Show)\n\ninstance (Typeable a, FromJSON a) =&gt; FromJSON (GetResponse a) where\n    parseJSON =\n      withObject \"GetResponse\" $ \\o -&gt; do\n          getCode &lt;- o .: \"code\"\n          getItem &lt;- o .: toLower (pack typeName)\n\n          return GetResponse {..}\n        where\n          typeName = showsTypeRep (typeRep Proxy :: Proxy a) \"\"\n</code></pre>\n\n<p>It fails to compile with the following error:</p>\n\n<pre><code>[1 of 1] Compiling Main             ( generics.hs, interpreted )\n\ngenerics.hs:74:48: error:\n    \u2022 Could not deduce (Typeable a0) arising from a use of \u2018typeRep\u2019\n      from the context: (Typeable a, FromJSON a)\n        bound by the instance declaration at generics.hs:66:10-61\n      The type variable \u2018a0\u2019 is ambiguous\n    \u2022 In the first argument of \u2018showsTypeRep\u2019, namely\n        \u2018(typeRep (Proxy :: Proxy a))\u2019\n      In the second argument of \u2018($)\u2019, namely\n        \u2018showsTypeRep (typeRep (Proxy :: Proxy a)) \"\"\u2019\n      In the second argument of \u2018($)\u2019, namely\n        \u2018pack $ showsTypeRep (typeRep (Proxy :: Proxy a)) \"\"\u2019\n</code></pre>\n\n<p>I tried doing the same thing with Generics but got the same error back.</p>\n\n<p>Full code: <a href=\"http://codepad.org/Gh3ifHkP\" rel=\"nofollow noreferrer\">http://codepad.org/Gh3ifHkP</a> </p>\n"}, {"tags": ["haskell", "haskell-platform"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1507561692, "post_id": 46644598, "comment_id": 80248265, "body": "have you tried running <code>brew update</code>?"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1507577486, "post_id": 46644598, "comment_id": 80256704, "body": "I would recommend you to get started with stack: <a href=\"https://haskell-lang.org/get-started\" rel=\"nofollow noreferrer\">haskell-lang.org/get-started</a>"}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 0, "last_activity_date": 1507594481, "creation_date": 1507594481, "answer_id": 46656825, "question_id": 46644598, "link": "https://stackoverflow.com/questions/46644598/install-haskell-platform-get-error/46656825#46656825", "title": "install haskell-platform, get error", "body": "<p>A new binary release of HP 8.2.1 was made recently, and announced on the haskell-cafe list: <a href=\"https://mail.haskell.org/pipermail/haskell-cafe/2017-October/127979.html\" rel=\"nofollow noreferrer\">https://mail.haskell.org/pipermail/haskell-cafe/2017-October/127979.html</a></p>\n\n<p>This changed the hash. As noted in the error message, a \"brew update\" should update the platform cask and pull in the new hash, which should allow things to continue properly.</p>\n"}], "owner": {"reputation": 405, "user_id": 8164113, "user_type": "registered", "accept_rate": 8, "profile_image": "https://i.stack.imgur.com/Ccd5p.jpg?s=128&g=1", "display_name": "William Song", "link": "https://stackoverflow.com/users/8164113/william-song"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 448, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1507594481, "creation_date": 1507545998, "last_edit_date": 1507561762, "question_id": 46644598, "link": "https://stackoverflow.com/questions/46644598/install-haskell-platform-get-error", "title": "install haskell-platform, get error", "body": "<p>I tried to install haskell-platform with</p>\n\n<blockquote>\n  <p>brew cask install haskell-platform</p>\n</blockquote>\n\n<p>But got the following error. How do you fix it?</p>\n\n<pre><code>==&gt; Satisfying dependencies\n==&gt; Downloading https://haskell.org/platform/download/8.2.1/Haskell%20Platform%2\n######################################################################## 100.0%\n==&gt; Verifying checksum for Cask haskell-platform\n==&gt; Note: running \"brew update\" may fix sha256 checksum errors\nError: Checksum for Cask 'haskell-platform' does not match.\n\nExpected: b0182bb721b5dff3d66794cbdcea93cec562dc254fcf23c0e7a1a7a8d680aaa7\nActual:   05fc22d2cefdf67f1da2f62a90fda73a746accd08b44ec197046972b82afee06\nFile:     /Users/william/Library/Caches/Homebrew/Cask/haskell-platform--8.2.1.pkg\n</code></pre>\n"}, {"tags": ["haskell", "webdriver"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1507548946, "post_id": 46644562, "comment_id": 80239905, "body": "you could <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Control-Exception-Base.html#v:catch\" rel=\"nofollow noreferrer\"><code>catch</code></a> the exception"}, {"owner": {"reputation": 8469, "user_id": 2504762, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/af5ca9c20dafdb1e4e1005468fdf75f7?s=128&d=identicon&r=PG", "display_name": "Gaurang Shah", "link": "https://stackoverflow.com/users/2504762/gaurang-shah"}, "edited": false, "score": 0, "creation_date": 1507632021, "post_id": 46644562, "comment_id": 80277443, "body": "I&#39;m not sure which language you using, but you could search for exception handling for that language and you will get your answer"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1507706889, "post_id": 46644562, "comment_id": 80312215, "body": "@epsilonhalbe that <code>catch</code> will work only in <code>IO</code>. The given commands work in <code>WebDriver wd =&gt; k -&gt; wd a</code>."}], "owner": {"reputation": 215, "user_id": 2035316, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b84b148152679b9172a63ebb10a64f69?s=128&d=identicon&r=PG", "display_name": "Deck Pope", "link": "https://stackoverflow.com/users/2035316/deck-pope"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 101, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1507545832, "creation_date": 1507545832, "question_id": 46644562, "link": "https://stackoverflow.com/questions/46644562/can-i-continue-in-a-form-with-exception", "title": "can i continue in a forM_ with exception?", "body": "<p>i am using webdriver for some data crawling on one of my lists with the following code:</p>\n\n<pre><code>let links = [\"xxx.com/index.html\", \"xxx.com/contact.html\", \"xxx.com/people.html\"]\nforM_ links $ \\l -&gt; do\n  waitUntil 15 $ do\n    a &lt;- findElem (ByClass \"has\")\n    liftIO $ print a\n</code></pre>\n\n<p>Now, the <code>xxx.com/contact.html</code> or any other element might not have an element with <code>has</code> class and trows the <code>NoSuchElement</code> exception that terminates the iteration.</p>\n\n<p>How can i continue after exception and print the results for all the list?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "matrix"], "comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1507541149, "post_id": 46641613, "comment_id": 80235140, "body": "<code>Data.Matrix</code> package includes nice <a href=\"https://hackage.haskell.org/package/matrix-0.3.5.0/docs/Data-Matrix.html#g:8\" rel=\"nofollow noreferrer\">Splitting Blocks</a> functionalities like <code>submatrix</code>. They are very handy tools for this job."}], "answers": [{"comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1507538614, "post_id": 46641960, "comment_id": 80233471, "body": "But the OP wants to calculate the sum of every 2x2 <b>sub</b>matrix."}, {"owner": {"reputation": 103, "user_id": 1808821, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0b2b25984c48dc3c93e157d927960ca6?s=128&d=identicon&r=PG", "display_name": "Henrik S&#246;derlund", "link": "https://stackoverflow.com/users/1808821/henrik-s%c3%b6derlund"}, "edited": false, "score": 0, "creation_date": 1507539082, "post_id": 46641960, "comment_id": 80233756, "body": "Exactly, I know that I can easily get the sum of one 2x2 submatrix from a nxm matrix where n and m are even, but how to get a list of sums for each of the 2x2 submatrices in the given matrix? How can I use splitBlocks in a way so that for a nxm matrix, I get a list of all the 2x2 submatrices within the matrix?"}, {"owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "edited": false, "score": 0, "creation_date": 1507539280, "post_id": 46641960, "comment_id": 80233895, "body": "this is the way to go, did not know about splitBlocks, and seems very handy. thanks!"}], "tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": true, "score": 5, "last_activity_date": 1507541362, "last_edit_date": 1507541362, "creation_date": 1507537890, "answer_id": 46641960, "question_id": 46641613, "link": "https://stackoverflow.com/questions/46641613/sum-of-each-element-in-all-2x2-submatrices-from-a-matrix/46641960#46641960", "title": "sum of each element in all 2x2 submatrices from a matrix", "body": "<p>What about just using the <code>sum</code> function for the matrix since it's the instance of <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Data-Foldable.html#t:Foldable\" rel=\"nofollow noreferrer\">Foldable</a>?</p>\n\n<pre><code>import Data.Matrix\n\nsum2x2 :: Matrix Double -&gt; Double\nsum2x2 m = if even (ncols m) &amp;&amp; even (nrows m)\n  then sum m\n  else error \"sum2x2 takes only even matrices\"\n\nmain :: IO ()\nmain = print $ sum2x2 (fromList 2 2 [1..])\n</code></pre>\n\n<p>This example creates a matrix <code>((1, 2), (3, 4))</code> and returns the sum <code>10</code>. I guess, the type of <code>sum2x2</code> should be <code>sum2x2 :: Matrix Double -&gt; Double</code> instead of <code>sum2x2 :: Matrix Double -&gt; [Double]</code></p>\n\n<p>You might also find <a href=\"https://hackage.haskell.org/package/matrix-0.3.5.0/docs/Data-Matrix.html#v:splitBlocks\" rel=\"nofollow noreferrer\">splitBlocks</a> functions usefull.</p>\n\n<pre><code>splitBlocks 2 2 matrix4x4\n</code></pre>\n\n<p>Creates a tuple of type <code>(Matrix a, Matrix a, Matrix a, Matrix a)</code>, which are the matrices you're looking for.</p>\n\n<p>If the problem is to convert any <code>M x N</code> (certainly with even <code>M</code>s and <code>N</code>s) matrix to a list of <code>2 x 2</code> matrices, then the following implementation might be helpful:</p>\n\n<pre><code>to2x2Martices m =\n  [submatrix x1 x2 y1 y2 m | (x1, x2) &lt;- rawPairs, (y1, y2) &lt;- columnPairs]\n  where\n    pairs [] = []\n    pairs (x:y:xs) = (x, y) : pairs xs\n\n    rawPairs = pairs [1..(nrows m)]\n    columnPairs = pairs [1..(ncols m)]\n</code></pre>\n\n<p>The logic is to iterate every pair in rows and every pair in columns and get the <code>2 x 2</code> matrix for these pairs.</p>\n\n<p>It transforms the following matrix:</p>\n\n<pre><code>(  1  2  3  4 )\n(  5  6  7  8 )\n(  9 10 11 12 )\n( 13 14 15 16 )\n</code></pre>\n\n<p>Into the following list:</p>\n\n<pre><code>[(  1  2 )\n(  5  6 )\n,(  3  4 )\n(  7  8 )\n,(  9 10 )\n( 13 14 )\n,( 11 12 )\n( 15 16 )\n]\n</code></pre>\n\n<p>Thus, you can just map over the list and get sum for every element.</p>\n\n<pre><code>map sum $ to2x2Martices (fromList 4 4 [1..])\n</code></pre>\n\n<p>evaluates to <code>[14,22,46,54]</code></p>\n"}, {"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 0, "last_activity_date": 1507720682, "creation_date": 1507720682, "answer_id": 46686880, "question_id": 46641613, "link": "https://stackoverflow.com/questions/46641613/sum-of-each-element-in-all-2x2-submatrices-from-a-matrix/46686880#46686880", "title": "sum of each element in all 2x2 submatrices from a matrix", "body": "<p>One other way of doing this job would be to use the <code>submatrix</code> function of type <code>Int -&gt; Int -&gt; Int -&gt; Int -&gt; Matrix a -&gt; Matrix a</code> where the first 4 parameters of <code>Int</code> type are starting row, ending row, starting column, ending column.</p>\n\n<pre><code>import Data.Matrix\nsubsums :: Matrix Int -&gt; [Int]\nsubsums m = let subs = map (\\(x,y) -&gt; (x,x+1,y,y+1)) $ (,) &lt;$&gt; [1,3..nrows m] &lt;*&gt; [1,3..ncols m]\n            in  map (\\(rs, re, cs, ce) -&gt; sum (submatrix rs re cs ce m)) subs\n\n*Main&gt; subsums . fromLists $ [[1,2,3,4], [5,6,7,8], [9,10,11,12], [13,14,15,16]]\n[14,22,46,54]\n</code></pre>\n"}], "owner": {"reputation": 103, "user_id": 1808821, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0b2b25984c48dc3c93e157d927960ca6?s=128&d=identicon&r=PG", "display_name": "Henrik S&#246;derlund", "link": "https://stackoverflow.com/users/1808821/henrik-s%c3%b6derlund"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 436, "favorite_count": 0, "accepted_answer_id": 46641960, "answer_count": 2, "score": 0, "last_activity_date": 1507720682, "creation_date": 1507536639, "last_edit_date": 1507539247, "question_id": 46641613, "link": "https://stackoverflow.com/questions/46641613/sum-of-each-element-in-all-2x2-submatrices-from-a-matrix", "title": "sum of each element in all 2x2 submatrices from a matrix", "body": "<p>I need to get a list if the sum of each 2x2 submatrix in a matrix with even rows and cols.</p>\n\n<p>For example, say that we have a 4x4 matrix (1); the function should compute it like the following (<strong>I would just like to note that the given matrix can be any nxm matrix where n and m are even</strong>):</p>\n\n<pre><code>(1): [ [1,  2, 3, 4],\n       [5,  6, 7, 8],\n       [9, 10,11,12],\n       [13,14,15,16] ]\n\nsum2x2 of (1):\n    1. 1+2+5+6    = 14\n    2. 3+4+7+8    = 22\n    3. 9+10+13+14 = 46\n    .\n    .\n\n\nresult: [14, 22, 46, ...]\n</code></pre>\n\n<p>I want to use <a href=\"https://hackage.haskell.org/package/matrix-0.3.5.0/docs/Data-Matrix.html\" rel=\"nofollow noreferrer\">Data.Matrix</a> and <code>submatrix</code> to create this list. And the function should have the following pattern:</p>\n\n<pre><code>sum2x2 :: Matrix Double -&gt; [Double]\n</code></pre>\n\n<p>I have begun writing this function, but I don't know how to proceed from here:</p>\n\n<pre><code>sum2x2 :: Matrix Double -&gt; [Double]\nsum2x2 m = if even (ncols m) &amp;&amp; even (nrows m)\n  then what?\n  else error \"sum2x2 takes only even matrices\"\n</code></pre>\n\n<p><code>submatrix</code> works like the following:</p>\n\n<pre><code>-- | /O(1)/. Extract a submatrix given row and column limits.\n--   Example:\n--\n-- &gt;                   ( 1 2 3 )\n-- &gt;                   ( 4 5 6 )   ( 2 3 )\n-- &gt; submatrix 1 2 2 3 ( 7 8 9 ) = ( 5 6 )\nsubmatrix :: Int    -- ^ Starting row\n          -&gt; Int -- ^ Ending row\n          -&gt; Int    -- ^ Starting column\n          -&gt; Int -- ^ Ending column\n          -&gt; Matrix a\n          -&gt; Matrix a\n</code></pre>\n\n<p>So, I have the concept. How do I implement this in Haskell using list comprehension?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1507537694, "post_id": 46641494, "comment_id": 80232959, "body": "<code>head c</code> is a character. Use <code>[head c]</code> instead. Same with <code>c !! 1</code>: should be <code>[c !! 1]</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1507548941, "post_id": 46641494, "comment_id": 80239899, "body": "Note that this programing style is both inefficient (<code>length</code> scans the whole list), dangerous (functions like <code>head, tail, !!</code> will crash the program when the list is too short), and incorrect (<code>romanToInt</code>, as written, always returns <code>0</code>). I would strongly recommend you avoid this non idiomatic style and try to exploit pattern matching instead, which is safer and more idiomatic."}], "answers": [{"comments": [{"owner": {"reputation": 137, "user_id": 8383476, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/66893da737c29fad8518f5fed5827587?s=128&d=identicon&r=PG&f=1", "display_name": "ProPall", "link": "https://stackoverflow.com/users/8383476/propall"}, "edited": false, "score": 0, "creation_date": 1507540051, "post_id": 46641959, "comment_id": 80234412, "body": "Thanks for your answer! I&#39;ve changed head c to [head c] and it worked perfectly!"}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 2, "last_activity_date": 1507537884, "creation_date": 1507537884, "answer_id": 46641959, "question_id": 46641494, "link": "https://stackoverflow.com/questions/46641494/couldnt-match-type-char-with-char-haskell/46641959#46641959", "title": "Couldn&#39;t match type Char with [Char], Haskell", "body": "<p>In Haskell, <code>String</code> is a synonym for <code>[Char]</code>.</p>\n\n<p>The <code>c</code> in <code>romanToInt</code> has the type <code>String</code>, i.e. <code>[Char]</code>.</p>\n\n<p>The type of <code>head</code> is <code>[a] -&gt; a</code>, so <code>head c</code> has the type <code>Char</code>.</p>\n\n<p>The type of <code>(!)</code> is <code>Ord k =&gt; Map k a -&gt; k -&gt; a</code>. In this case, <code>mapRomantoInt</code> has the type <code>Map String Int</code>, so the <code>k</code> in question must be <code>String</code>.</p>\n\n<p>The function call <code>mapRomantoInt ! head c</code>, however, tries to pass a <code>Char</code> instead of a <code>[Char]</code> (<code>String</code>).</p>\n\n<p>There are other problems with the code in the OP, but try to fix the compilation error(s) first.</p>\n"}], "owner": {"reputation": 137, "user_id": 8383476, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/66893da737c29fad8518f5fed5827587?s=128&d=identicon&r=PG&f=1", "display_name": "ProPall", "link": "https://stackoverflow.com/users/8383476/propall"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 608, "favorite_count": 0, "accepted_answer_id": 46641959, "answer_count": 1, "score": 1, "last_activity_date": 1507547153, "creation_date": 1507536260, "last_edit_date": 1507547153, "question_id": 46641494, "link": "https://stackoverflow.com/questions/46641494/couldnt-match-type-char-with-char-haskell", "title": "Couldn&#39;t match type Char with [Char], Haskell", "body": "<p>I have recently started learning Haskell and I have encountered a problem with dictionaries. I use a key to get the integer number from the dictionary, and GHCi prints an error \"Couldn't match type Char with [Char]\" on the line where I use a first element of the string as key for a dictionary. Here is the code:</p>\n\n<pre><code>import Data.Map\nmapRomantoInt :: Map String Int\nmapRomantoInt = fromList[(\"I\",1),(\"V\",5),(\"IX\",9),(\"X\",10),(\"L\",50),(\"C\",100),(\"D\",500),(\"M\",1000)]\n\nromanToInt :: String -&gt; Int\nromanToInt _ = 0\nromanToInt c = if length c == 1 then mapRomantoInt ! head c else\n                      let first = mapRomantoInt ! head c\n                          second = mapRomantoInt ! (c !! 1)\n                          others = romanToInt(tail c)\n                      in if first &lt; second then others - first else others + first\n</code></pre>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 1, "creation_date": 1507528366, "post_id": 46639367, "comment_id": 80228281, "body": "Another fallback option would be not to have a default definition of <code>g</code> and/or <code>f</code>, but to instead provide a standalone function that instance-writers can use to <i>explicitly</i> opt-in to the &quot;default&quot; implementation (by writing <code>g = defaultG</code>). Hopefully at least make it a little harder to <i>accidentally</i> leave both as default, since at least one was a deliberate choice."}], "answers": [{"tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": false, "score": 0, "last_activity_date": 1507804957, "creation_date": 1507804957, "answer_id": 46707590, "question_id": 46639367, "link": "https://stackoverflow.com/questions/46639367/preventing-mutually-recursive-default-methods-from-looping-at-runtime/46707590#46707590", "title": "Preventing mutually recursive default methods from looping at runtime", "body": "<p>My previous answer was nonsense, so instead here is a (hopefully) better one. This will at least give you a warning at compile time. Trick is to implement <code>f'</code> or <code>g</code> in class <code>G</code> if both <code>a</code> has instances for both <code>F</code> and <code>G</code>, but only <code>f</code> if instance of <code>G</code> is impossible.</p>\n\n<pre><code>{-# LANGUAGE DefaultSignatures #-}\n\nclass C a where\n\nclass F a where\n  f :: a -&gt; a\n  default f :: (G a) =&gt; a -&gt; a\n  f = g\n\nclass F a =&gt; G a where\n  {-# MINIMAL (f'|g) #-}\n\n  f' :: a -&gt; a\n  f' = f\n\n  g :: a -&gt; a\n  default g :: (C a) =&gt; a -&gt; a\n  g = f'\n\ninstance F Integer where\n  f = succ\n\ninstance F Int\ninstance G Int where\n  g = succ\n\ninstance C Float\ninstance F Float\ninstance G Float where\n  f' = succ\n\n-- This will give a compile time warning, but will still\n-- loop at runtime:\ninstance C Double\ninstance F Double\ninstance G Double\n</code></pre>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 84, "favorite_count": 0, "answer_count": 1, "score": 7, "last_activity_date": 1507804957, "creation_date": 1507526997, "question_id": 46639367, "link": "https://stackoverflow.com/questions/46639367/preventing-mutually-recursive-default-methods-from-looping-at-runtime", "title": "Preventing mutually recursive default methods from looping at runtime", "body": "<p>I've currently got a structure like the following:</p>\n\n<pre><code>class F a where\n   f :: ...\n   default f :: (G a...) =&gt; ...\n   f = (some definition in terms of g)\n\nclass F a =&gt; G a where\n   g :: ...\n   default g :: (C a...) =&gt; ...\n   g = (some definition in terms of f)\n</code></pre>\n\n<p>In hopefully somewhat plain English, I can write <code>f</code> in terms of <code>g</code> always. I can write <code>g</code> in terms of <code>f</code> sometimes, namely when <code>a</code> satisfies a <code>C</code> constraint.</p>\n\n<p>The issue I see here is if someone writes, for say a type <code>T</code> satisfying <code>C T</code></p>\n\n<pre><code>instance F T\ninstance G T\n</code></pre>\n\n<p>This will compile and loop at runtime. Whilst both default definitions are correct, it's important at least one is defined.</p>\n\n<p>I could solve this with a <code>MINIMAL</code> pragma if <code>f</code> and <code>g</code> were in the same class, but in this case they're not.</p>\n\n<p>Also placing both <code>f</code> and <code>g</code> in the same class doesn't seem to be possible, as whilst there is a definition of <code>f</code> for every definition of <code>g</code>, there is not a definition of <code>g</code> for every definition of <code>f</code>. One possibility is moving <code>g</code> into <code>F</code> but also putting a <code>C a</code> constraint on it, but that would stop me from defining <code>g</code> with a non-default definition for any <code>a</code> which doesn't satisfy <code>C a</code>. </p>\n\n<p>Is there any way to reorganise this to solve this dilemma I'm facing?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "edited": false, "score": 0, "creation_date": 1507528533, "post_id": 46638843, "comment_id": 80228344, "body": "You also could simply build a function that computes the aggregate value for a subtree and memoize this function. This would be less intrusive to the existing code and also avoids recomputation."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1507528885, "post_id": 46638843, "comment_id": 80228486, "body": "Two more alternatives: 1) modify your AST to use <code>Fix</code> <a href=\"https://hackage.haskell.org/package/recursion-schemes-5.0.2/docs/Data-Functor-Foldable.html#t:Fix\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/recursion-schemes-5.0.2/docs/&hellip;</a> and then change the annotation function to use <code>Cofree</code>. <a href=\"https://stackoverflow.com/questions/38462563/how-to-work-with-ast-with-cofree-annotation\" title=\"how to work with ast with cofree annotation\">stackoverflow.com/questions/38462563/&hellip;</a> 2) the Trees that Grow approach <a href=\"https://www.microsoft.com/en-us/research/wp-content/uploads/2016/11/trees-that-grow.pdf\" rel=\"nofollow noreferrer\">microsoft.com/en-us/research/wp-content/uploads/2016/11/&hellip;</a> which adds fields to your AST that can change with each phase."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1507541559, "post_id": 46638843, "comment_id": 80235414, "body": "@danidiaz I\u2019ve never understood why people seem to want to use <code>Cofree</code> for annotating a tree when <code>Product</code> does a much better job..."}, {"owner": {"reputation": 1415, "user_id": 474491, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/ba21053d650c48ca674e577b38a976aa?s=128&d=identicon&r=PG", "display_name": "Pierre Carbonnelle", "link": "https://stackoverflow.com/users/474491/pierre-carbonnelle"}, "reply_to_user": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "edited": false, "score": 0, "creation_date": 1507559027, "post_id": 46638843, "comment_id": 80246540, "body": "@mschmidt : how do you look-up the memoization table, when nodes do not have an ID ?  Eq would be costly, I would think."}, {"owner": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "edited": false, "score": 0, "creation_date": 1507567049, "post_id": 46638843, "comment_id": 80251339, "body": "@user474491 : you are right. I didn&#39;t think about the lookup."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1507575500, "post_id": 46638843, "comment_id": 80255650, "body": "@Benjamin Hodgson Do you mean using <code>Fix</code> over a <code>Product</code> of the functor and another functor?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1507575661, "post_id": 46638843, "comment_id": 80255746, "body": "@danidiaz Yes, exactly. <code>data (f :@ a) x = f x :@ a deriving Functor</code>; <code>type Annotated f a = Fix (f :@ a)</code>. No need for <code>Cofree</code> :)"}], "answers": [{"tags": [], "owner": {"reputation": 1415, "user_id": 474491, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/ba21053d650c48ca674e577b38a976aa?s=128&d=identicon&r=PG", "display_name": "Pierre Carbonnelle", "link": "https://stackoverflow.com/users/474491/pierre-carbonnelle"}, "is_accepted": false, "score": 0, "last_activity_date": 1507571731, "last_edit_date": 1507571731, "creation_date": 1507561249, "answer_id": 46649487, "question_id": 46638843, "link": "https://stackoverflow.com/questions/46638843/how-to-store-tree-aggregates/46649487#46649487", "title": "How to store tree aggregates", "body": "<p>The <a href=\"https://www.microsoft.com/en-us/research/wp-content/uploads/2016/11/trees-that-grow.pdf\" rel=\"nofollow noreferrer\">Trees that Grow</a> approach (suggested by @danidiaz) looks like what I'm looking for.</p>\n"}], "owner": {"reputation": 1415, "user_id": 474491, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/ba21053d650c48ca674e577b38a976aa?s=128&d=identicon&r=PG", "display_name": "Pierre Carbonnelle", "link": "https://stackoverflow.com/users/474491/pierre-carbonnelle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 76, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1507571731, "creation_date": 1507523048, "last_edit_date": 1507524171, "question_id": 46638843, "link": "https://stackoverflow.com/questions/46638843/how-to-store-tree-aggregates", "title": "How to store tree aggregates", "body": "<p>After parsing source code with megaparsec, I have an abstract syntax tree.  In a second stage, I compute aggregates on each subtree, e.g. the list of variables it contains, by aggregating leaf values, and I want to store them somewhere, so I don't have to recompute them later.  How should I do that ?</p>\n\n<p>I have considered these options.</p>\n\n<ul>\n<li>Add an aggregates value to each node. I would need to modify each node data type.</li>\n<li>Wrap each node data type in a generic aggregate data type.</li>\n<li>Use generics node data type, with aggregates, but I'm afraid compilation error messages won't be as clear.</li>\n<li>Build a \"shadow tree\", with the same topology as the AST, but containing the aggregates.</li>\n</ul>\n\n<p>What should I chose ?</p>\n"}, {"tags": ["haskell", "state-monad"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1507516810, "post_id": 46637968, "comment_id": 80225419, "body": "Using <a href=\"https://hackage.haskell.org/package/transformers-0.3.0.0/docs/Control-Monad-IO-Class.html#v:liftIO\" rel=\"nofollow noreferrer\"><code>liftIO</code></a> (or just <a href=\"https://hackage.haskell.org/package/transformers-0.3.0.0/docs/Control-Monad-Trans-Class.html#v:lift\" rel=\"nofollow noreferrer\"><code>lift</code></a>)"}, {"owner": {"reputation": 143, "user_id": 8612140, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3b2d33f61f0c03070723fa52000dbd78?s=128&d=identicon&r=PG&f=1", "display_name": "ErlangWannabe", "link": "https://stackoverflow.com/users/8612140/erlangwannabe"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1507516961, "post_id": 46637968, "comment_id": 80225440, "body": "Nice, it worked, thanks. <code>sessHandleCmd hdl = lift (hGetLine hdl) &gt;&gt;= \\x -&gt; lift (print (&quot;yeap, it works! &quot; ++ x)) &gt;&gt; sessHandleCmd hdl</code>"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1507517273, "post_id": 46637968, "comment_id": 80225505, "body": "Note that <code>lift</code> distributes over bind, so you could also write your demo <code>lift (hGetLine hd1 &gt;&gt;= print (&quot;yeap, it works! &quot; ++ x)) &gt;&gt; sessHandleCmd hd1</code>"}, {"owner": {"reputation": 143, "user_id": 8612140, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3b2d33f61f0c03070723fa52000dbd78?s=128&d=identicon&r=PG&f=1", "display_name": "ErlangWannabe", "link": "https://stackoverflow.com/users/8612140/erlangwannabe"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 4, "creation_date": 1507520649, "post_id": 46637968, "comment_id": 80226166, "body": "Do you want to add your answer so I can mark it as correct?"}], "owner": {"reputation": 143, "user_id": 8612140, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3b2d33f61f0c03070723fa52000dbd78?s=128&d=identicon&r=PG&f=1", "display_name": "ErlangWannabe", "link": "https://stackoverflow.com/users/8612140/erlangwannabe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 104, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1507515251, "creation_date": 1507515251, "question_id": 46637968, "link": "https://stackoverflow.com/questions/46637968/statet-and-io-monad-combination", "title": "StateT and IO Monad combination", "body": "<p>I want to use the StateT Monad to read a string from a socket handle and append it into the state and repeat. Any idea how can I make this work? </p>\n\n<p>What I have so far is something like this:</p>\n\n<pre><code>sessHandleCmd :: Handle -&gt; StateT String IO ()\nsessHandleCmd hdl = get &gt;&gt;= \\s -&gt; put s &gt;&gt; sessHandleCmd hdl\n\nrunSession :: Handle -&gt; IO ()\nrunSession hdl = \n  execStateT (sessHandleCmd hdl) \"\" &gt;&gt; return ()\n</code></pre>\n\n<p>Not quite sure how to do a <code>hGetLine hdl</code> inside <code>sessHandleCmd</code>.</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 148712, "user_id": 19750, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/13b41b2620da0b1e630715e0c91a0b03?s=128&d=identicon&r=PG", "display_name": "Josh Lee", "link": "https://stackoverflow.com/users/19750/josh-lee"}, "edited": false, "score": 0, "creation_date": 1507513804, "post_id": 46637781, "comment_id": 80224825, "body": "How are the lists produced? This works for me with a simple <code>repeat 1.0</code>."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1507514114, "post_id": 46637781, "comment_id": 80224899, "body": "The issue here would be with how you are producing the arguments you are passing to <code>dot</code>. <code>dot</code> itself uses constant space."}, {"owner": {"reputation": 9137, "user_id": 5171219, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-G5x4vEoGRJc/AAAAAAAAAAI/AAAAAAAAENA/5wwtFtwYH3Q/photo.jpg?sz=128", "display_name": "Emmanuel Rosa", "link": "https://stackoverflow.com/users/5171219/emmanuel-rosa"}, "edited": false, "score": 0, "creation_date": 1507514342, "post_id": 46637781, "comment_id": 80224939, "body": "Which of the three functions is implemented with recursive calls?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1507514357, "post_id": 46637781, "comment_id": 80224940, "body": "@Alec That doesn&#39;t jive with my tests. Are you sure that comment applies to GHC 7.6.3?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1507563036, "post_id": 46637781, "comment_id": 80249031, "body": "@DanielWagner I&#39;m ashamed to say I checked back only to 7.8.4 (that&#39;s the oldest I have installed). Sorry for the confusion OP! That said, do consider upgrading to a more recent GHC version if you can! :)"}, {"owner": {"reputation": 11, "user_id": 8743211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c60ea679aae603bf21f61fcdffafc18?s=128&d=identicon&r=PG&f=1", "display_name": "Alain", "link": "https://stackoverflow.com/users/8743211/alain"}, "edited": false, "score": 0, "creation_date": 1507575484, "post_id": 46637781, "comment_id": 80255639, "body": "I just upgraded my GHC compiler to version 7.10.3 and it works just fine (no more stack overflow)."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 8743211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c60ea679aae603bf21f61fcdffafc18?s=128&d=identicon&r=PG&f=1", "display_name": "Alain", "link": "https://stackoverflow.com/users/8743211/alain"}, "edited": false, "score": 0, "creation_date": 1507575955, "post_id": 46637857, "comment_id": 80255892, "body": "I tested <code>sum</code> as well, and it was working fine, even for larger lists with 10^8 elements. I guess the problem was coming from the implementation of <code>zipWith</code>. Anyway, I just upgraded my GHC to version 7.10.3 and there&#39;s no more stack overflow using the standard versions of <code>sum</code> and <code>zipWith</code>"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 6, "last_activity_date": 1507514229, "creation_date": 1507514229, "answer_id": 46637857, "question_id": 46637781, "link": "https://stackoverflow.com/questions/46637781/dot-product-for-lists-in-haskell/46637857#46637857", "title": "Dot product for lists in Haskell", "body": "<p><code>sum</code> is (used to be) implemented with <code>foldr</code>. That's a bit of a dumb choice for <em>most</em> instances of <code>Num</code>; a strict left fold is better. Use</p>\n\n<pre><code>import Data.List\n\nsum' :: Num a =&gt; [a] -&gt; a\nsum' = foldl' (+) 0\n</code></pre>\n\n<p>instead and your stack overflow will disappear.</p>\n"}], "owner": {"reputation": 11, "user_id": 8743211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c60ea679aae603bf21f61fcdffafc18?s=128&d=identicon&r=PG&f=1", "display_name": "Alain", "link": "https://stackoverflow.com/users/8743211/alain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2820, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1507575195, "creation_date": 1507513493, "last_edit_date": 1507575195, "question_id": 46637781, "link": "https://stackoverflow.com/questions/46637781/dot-product-for-lists-in-haskell", "title": "Dot product for lists in Haskell", "body": "<p>I'm trying to implement a dot product between two lists of numbers using only functions from the Prelude library. I've written the following function:</p>\n\n<pre><code>dot :: Num a =&gt; [a] -&gt; [a] -&gt; a\ndot x y = sum $ zipWith (*) x y\n</code></pre>\n\n<p>that I tested as follows:</p>\n\n<pre><code>main :: IO ()\nmain = do\n    let n = 10^6\n        x = (replicate n 2.0) :: [Double]\n        y = (replicate n 3.0) :: [Double]\n    print $ dot x y\n    return ()\n</code></pre>\n\n<p>Unfortunately, this code leads to a stack space overflow for lists with 1 million of elements (using ghc 7.6.3 and optimization flag -O2). </p>\n\n<p>For such a simple case, I would have expected ghc to be able to perform the necessary optimizations to avoid the cost of the recursive calls. Am I missing something? Is my implementation wrong?</p>\n"}, {"tags": ["loops", "haskell", "functional-programming", "duplicates", "iteration"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 3, "creation_date": 1507501568, "post_id": 46636356, "comment_id": 80222489, "body": "I see that you got already some answers to your questions, but make sure to show your attempts on how you tried to solve this yourself next time - this is no &quot;we solve your haskell homework for you&quot;-site but a &quot;we help you solve problems yourself&quot;-site, make sure you put at least as much effort into posting a question as you would somebody expect to answer it"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1507510635, "post_id": 46636356, "comment_id": 80224171, "body": "The loop is unnecessary, because you keep overwriting <code>foo</code>: <code>foo = (99, 99)</code> alone produces the same result."}], "answers": [{"tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": true, "score": 7, "last_activity_date": 1507511233, "last_edit_date": 1507511233, "creation_date": 1507499268, "answer_id": 46636397, "question_id": 46636356, "link": "https://stackoverflow.com/questions/46636356/haskell-version-of-double-loop/46636397#46636397", "title": "Haskell version of double loop", "body": "<p>You can use list comprehensions:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>foo :: [(Int, Int)]\nfoo = [(i, a) | i &lt;- [0..99], a &lt;- [i..99]]\n</code></pre>\n\n<p>Note that there's no mutation in Haskell. Hence, you can't change the value of <code>foo</code>. That's why I made it into a list instead.</p>\n"}, {"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1507506572, "post_id": 46636401, "comment_id": 80223462, "body": "Mind the direction of your comparisons"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 1, "last_activity_date": 1507532884, "last_edit_date": 1507532884, "creation_date": 1507499297, "answer_id": 46636401, "question_id": 46636356, "link": "https://stackoverflow.com/questions/46636356/haskell-version-of-double-loop/46636401#46636401", "title": "Haskell version of double loop", "body": "<p>Well first of all if you do not want duplicates, you can add the constraint <code>i &lt;= a</code>. Or you can thus rewrite your code like:</p>\n\n<pre><code>for (int i=0; i&lt;100; i++)\n  for (int a=<b>i</b>; a&lt;100; a++)\n     foo = (i, a);</code></pre>\n\n<p>Next we can use <em>list comprehension</em> for this:</p>\n\n<pre><code>[(i,a) | i &lt;- [0..99], a &lt;- [i..99]]\n</code></pre>\n\n<p>So we let <code>i</code> iterate over <code>0..99</code> (both inclusive), and <code>a</code> over <code>i..99</code>. If we take smaller bounds (6 instead of 99) we obtain:</p>\n\n<pre><code>Prelude&gt; [(i,a) | i &lt;- [0..6], a &lt;- [i..6]]\n[(0,0),(0,1),(0,2),(0,3),(0,4),(0,5),(0,6),(1,1),(1,2),(1,3),(1,4),(1,5),(1,6),(2,2),(2,3),(2,4),(2,5),(2,6),(3,3),(3,4),(3,5),(3,6),(4,4),(4,5),(4,6),(5,5),(5,6),(6,6)]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 1, "last_activity_date": 1507499432, "creation_date": 1507499432, "answer_id": 46636415, "question_id": 46636356, "link": "https://stackoverflow.com/questions/46636356/haskell-version-of-double-loop/46636415#46636415", "title": "Haskell version of double loop", "body": "<p>If you don't want duplicates, then the loop is really:</p>\n\n<pre class=\"lang-java prettyprint-override\"><code>for(int i = 0; i &lt; 100; i++)\n  for(int j = i; j &lt; 100; j++)\n    something(i, j);\n</code></pre>\n\n<p>Which can be made into Haskell as any of</p>\n\n<pre><code>-- raw binds\n[0..99] &gt;&gt;= \\i -&gt;\n  [i..99] &gt;&gt;= \\j -&gt;\n    return $ something i j\n\n-- do-notation\ndo i &lt;- [0..99]\n   j &lt;- [i..99]\n   return $ something i j\n\n-- list comprehension\n[ something i j | i &lt;- [0..99], j &lt;- [i..99]]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 2, "creation_date": 1507500133, "post_id": 46636502, "comment_id": 80222129, "body": "Doesn&#39;t remove duplicates. You&#39;d have to use monads instead."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1507500680, "post_id": 46636502, "comment_id": 80222282, "body": "...or repair afterwards, i.e. <code>filter (uncurry (&lt;=)) $ (,) &lt;$&gt; [0..2] &lt;*&gt; [0..3]</code>."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1507501419, "post_id": 46636502, "comment_id": 80222456, "body": "@leftaroundabout Yes that&#39;s possible but then it turns out to be a little wasteful i suppose. I guess this approach is not right for the given case. It&#39;s my oversight."}], "tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 2, "last_activity_date": 1507500087, "creation_date": 1507500087, "answer_id": 46636502, "question_id": 46636356, "link": "https://stackoverflow.com/questions/46636356/haskell-version-of-double-loop/46636502#46636502", "title": "Haskell version of double loop", "body": "<p>You may also use applicative functors and simply do like this;</p>\n\n<pre><code>Prelude&gt; (,) &lt;$&gt; [0..2] &lt;*&gt; [0..3]\n[(0,0),(0,1),(0,2),(0,3),(1,0),(1,1),(1,2),(1,3),(2,0),(2,1),(2,2),(2,3)]\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 8741507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a5237abd2c5665558df7dd293d03579?s=128&d=identicon&r=PG&f=1", "display_name": "Tom coates", "link": "https://stackoverflow.com/users/8741507/tom-coates"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 221, "favorite_count": 0, "accepted_answer_id": 46636397, "answer_count": 4, "score": 0, "last_activity_date": 1507532884, "creation_date": 1507498935, "last_edit_date": 1507528996, "question_id": 46636356, "link": "https://stackoverflow.com/questions/46636356/haskell-version-of-double-loop", "title": "Haskell version of double loop", "body": "<p>I need to do the following in Haskell and can't think of the correct method to do it:</p>\n\n<pre><code>for (int i=0; i&lt;100; i++)\n  for (int a=0; a&lt;100; a++)\n     foo = (i, a);\n</code></pre>\n\n<p>I also don't want 'duplicates' returned so there's not both (1, 50) and (50, 1). Any ideas on how to do this?  </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 697, "user_id": 5821028, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/f02b2f13bdf83954535307af466460a7?s=128&d=identicon&r=PG&f=1", "display_name": "eii0000", "link": "https://stackoverflow.com/users/5821028/eii0000"}, "edited": false, "score": 0, "creation_date": 1507494406, "post_id": 46635682, "comment_id": 80220554, "body": "After installing stack, I ran stack new proj1 and then stack setup, then stack install hlint."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 3, "creation_date": 1507498058, "post_id": 46635682, "comment_id": 80221591, "body": "Usually <code>hlint</code> is installed globally and not as part of the project (if your aim is to just have code and linting suggestions). So, I would recommend you to install it outside of the project globally. Also, since it&#39;s part of the <a href=\"https://www.stackage.org/lts-9.6/package/hlint\" rel=\"nofollow noreferrer\">resolver</a> - the installation should be smooth."}, {"owner": {"reputation": 697, "user_id": 5821028, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/f02b2f13bdf83954535307af466460a7?s=128&d=identicon&r=PG&f=1", "display_name": "eii0000", "link": "https://stackoverflow.com/users/5821028/eii0000"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1507730424, "post_id": 46635682, "comment_id": 80328150, "body": "thanks for your answer.  I had &quot;resolver: ghc-8.2.1&quot; in my stack.yaml.  I changed it to nightly-2017-10-11 then I was able to install hlint by stack globally.  Thank you!"}], "owner": {"reputation": 697, "user_id": 5821028, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/f02b2f13bdf83954535307af466460a7?s=128&d=identicon&r=PG&f=1", "display_name": "eii0000", "link": "https://stackoverflow.com/users/5821028/eii0000"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 870, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1507494265, "creation_date": 1507494265, "question_id": 46635682, "link": "https://stackoverflow.com/questions/46635682/can-i-install-hlint-by-stack-without-using-cabal", "title": "can I install hlint by stack without using cabal", "body": "<p>I am trying to install HLint. The installation document says you can use cabal install hlint. But I don't have a cabal installed in my machine (Ubuntu 16.04) and it looks possible to install hlint by only using stack.\nMy question is if I need to add many extra-deps?\nWhen I ran stack install hlint, it returns</p>\n\n<pre><code>Recommended action: try adding the following to your extra-deps in \n/home/as/proj1/stack.yaml:\n- ansi-terminal-0.7.1.1\n- cmdargs-0.10.18\n- cpphs-1.20.8\n- extra-1.6\n- haskell-src-exts-1.19.1\n- hscolour-1.24.1\n- refact-0.3.0.2\n- text-1.2.2.2\n- uniplate-1.6.12\n- unordered-containers-0.2.8.0\n- vector-0.12.0.1\n- yaml-0.8.23.3\n</code></pre>\n\n<p>Do I need to add all of them to extra-deps?  After adding some, I found I need to add more..  Am I doing something wrong ?\nThank you,\neii</p>\n"}, {"tags": ["list", "haskell", "take"], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 2, "last_activity_date": 1507493681, "creation_date": 1507493681, "answer_id": 46635593, "question_id": 46635565, "link": "https://stackoverflow.com/questions/46635565/non-exhaustive-patterns-in-function-take6-error/46635593#46635593", "title": "Non-exhaustive patterns in function take6 error?", "body": "<p>The pattern <code>b:bs</code> does not match the empty list. You need a separate case to handle the empty list.</p>\n"}, {"tags": [], "owner": {"reputation": 23130, "user_id": 8586227, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BRnwg.png?s=128&g=1", "display_name": "Davis Herring", "link": "https://stackoverflow.com/users/8586227/davis-herring"}, "is_accepted": false, "score": 2, "last_activity_date": 1507493696, "creation_date": 1507493696, "answer_id": 46635596, "question_id": 46635565, "link": "https://stackoverflow.com/questions/46635565/non-exhaustive-patterns-in-function-take6-error/46635596#46635596", "title": "Non-exhaustive patterns in function take6 error?", "body": "<p>You're destructuring the list before you check <em>n</em>, so even if it's 0 you're requiring the list be non-empty.  You could use a guard to handle that case, but that wouldn't help in this case where the list is too short.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1507507794, "post_id": 46635636, "comment_id": 80223644, "body": "Yes, its potentially more efficient. But when GHC is run with optimizations enabled, they should end up being the same. I haven&#39;t checked this example, but there are special rules for desugaring literal lists into <code>build</code> forms that should fuse with the <code>foldr</code> form in <code>(++)</code>. In this case, there&#39;s no point relying on this optimization, but I suspect it matters more when using <code>[a]</code> as the monoid target of a <code>foldMap</code>."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1507497705, "last_edit_date": 1507497705, "creation_date": 1507494029, "answer_id": 46635636, "question_id": 46635565, "link": "https://stackoverflow.com/questions/46635565/non-exhaustive-patterns-in-function-take6-error/46635636#46635636", "title": "Non-exhaustive patterns in function take6 error?", "body": "<p>In your program you write:</p>\n\n<pre><code>take6 n (b:bs) = ...\n</code></pre>\n\n<p>But here you thus use a pattern <code>(b:bs)</code> which is the \"cons\" constructor of the list. The cons constructor takes a head <code>b</code> and a tail <code>bs</code>. The list type has however two constructors: the \"cons\" we already discussed here, and the empty list <code>[]</code>. Haskell is complaining that it can not find a clause for the empty list pattern of the second argument. So your function needs to be defined with a shape:</p>\n\n<pre><code>take6 n [] = ...\ntake6 n (b:bs) = ...\n</code></pre>\n\n<p>Now the question is still what to do here. Regardless of what we take in case of an empty list, we can not emit any elements anymore, so you probably want to return the empty list, so:</p>\n\n<pre><code>take6 _ [] = []\n</code></pre>\n\n<p>furthermore you make indeed a distinction between <code>n</code> being less than or equal to zero in which case the result is an empty list:</p>\n\n<pre><code>take6 n (b:bs) | n &lt;= 0 = []\n</code></pre>\n\n<p>but there is also a case where <code>n &gt; 0</code>. In that case we want indeed prepend <code>b</code> to the <code>take6 (n-1) bs</code>. Mind however that a more efficient way to prepend, is again using the \"cons\" constructor:</p>\n\n<pre><code>               | otherwise = b : take6 (n-1) bs\n</code></pre>\n\n<p>or in full:</p>\n\n<pre><code>take6 :: Int -&gt; [a] -&gt; [a]\ntake6 _ [] = []\ntake6 n (b:bs) | n &lt;= 0 = []\n               | otherwise = b : take6 (n-1) bs\n</code></pre>\n"}], "owner": {"reputation": 287, "user_id": 8738033, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/1944285682265003/picture?type=large", "display_name": "Joao Parente", "link": "https://stackoverflow.com/users/8738033/joao-parente"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 46635636, "answer_count": 3, "score": 2, "last_activity_date": 1507584146, "creation_date": 1507493481, "last_edit_date": 1507584146, "question_id": 46635565, "link": "https://stackoverflow.com/questions/46635565/non-exhaustive-patterns-in-function-take6-error", "title": "Non-exhaustive patterns in function take6 error?", "body": "<p>So i created this function , to give me the \"n\" first elements from a list,\"(b:bs);</p>\n\n<pre><code> 1  module Sexta where  \n 2\n 3  take6::Int-&gt;[a]-&gt;[a]\n 4  take6 n (b:bs) = if n&lt;=0 then [] \n 5                 else [b] ++ (take6 (n-1) bs)\n</code></pre>\n\n<p>The problem is that when i try: <code>take6 2 []</code>, it shows:</p>\n\n<pre><code>*** Exception: sexta.hs:(4,1)-(6,15): Non-exhaustive patterns in function take6\n</code></pre>\n\n<p>I dont why, cuz when i try this by hand :</p>\n\n<pre><code>   take6 2 []\n   = [] ++take6 1 []\n   = [] ++[]++take6 0 []\n   = [] ++[]++[]\n   = []\n</code></pre>\n"}, {"tags": ["haskell", "dependent-type", "template-haskell", "singleton-type"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1507496597, "post_id": 46634706, "comment_id": 80221230, "body": "<code>n ~ (n - 1) + 1</code> only holds for <code>n</code> other than <code>0</code>. <i>You</i> know that <code>n</code> is not <code>0</code> at this point, because <code>sameNat</code> returned <code>Nothing</code>, but that doesn&#39;t give the type checker any tangible evidence to work with. You&#39;ll need to work with a richer version of <code>sameNat</code> which brings back some evidence (with which you can do some theorem proving) that <code>n</code> is not <code>0</code>, instead of <code>Nothing</code>. (Or return a GADT containing a proof that <code>n ~ (n - 1) + 1</code>, &#224; la <a href=\"https://personal.cis.strath.ac.uk/conor.mcbride/pub/hasochism.pdf\" rel=\"nofollow noreferrer\"><i>Hasochism</i></a>.)"}], "answers": [{"comments": [{"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1507671289, "post_id": 46669649, "comment_id": 80301095, "body": "I don&#39;t believe this is true: &quot;If you type-check a 1000000-element <code>replicate&#39;&#39;</code> call, the type-checker must explicitly run a million type checks for each link of the <code>::&gt;</code> chain&quot;. The code of <code>replicate&#39;&#39;</code> itself is polymorphic in <code>n</code>; the type checker processes it once without any assumptions about what <code>n</code> is. And then the call is simply checked to unify with the polymorphic type of <code>replicate&#39;&#39;</code>, which only requires that the <code>SNat n</code> and the <code>Vect n a</code> use the same n. You seem to be implying that it has to unroll the recursion at compile time and check each call with a concrete <code>n</code>?"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1507671551, "post_id": 46669649, "comment_id": 80301202, "body": "Well, since we don&#39;t have a working example of <code>replicate&#39;&#39;</code>, it&#39;s hard to know for sure.  I do know that my typeclass-based <code>replicateV</code> solution in <a href=\"https://stackoverflow.com/a/46495696/7203016\">stackoverflow.com/a/46495696/7203016</a> runs an iteration at compile time because I tested it with a 10000-element vector, and compilation required <code>-freduction-depth=0</code> and involved a noticeable delay."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1507672466, "post_id": 46669649, "comment_id": 80301560, "body": "Ah, but that&#39;s quite different. If your recursion is based on recursive type class instances, then when it tries to satisfy the <code>VC 1000000</code> constraint it finds <code>instance VC (n :- 1) a =&gt; VC n a</code>, and so has to check whether it can satisfy <code>VC (1000000 :- 1)</code> before it can use it, and so on. A replicate definition that applies to <i>all</i> <code>n :: Nat</code> doesn&#39;t have that behavior at all."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1507672574, "post_id": 46669649, "comment_id": 80301614, "body": "I have a working version of replicate for a TypeLit-based Vec, so I&#39;ll post an answer when I get to a computer. I&#39;m pretty sure the type checking time isn&#39;t linear in the size of my vectors..."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1507673003, "post_id": 46669649, "comment_id": 80301794, "body": "Maybe the type class solution even has to generate a million-element chain of nested dictionaries? Each of which containing a version of <code>replicateV</code> that calls the next one in the chain, so if that&#39;s the case it effectively <i>does</i> unroll the recursion? Not too sure on that point."}, {"owner": {"reputation": 69, "user_id": 8742124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3a39412ec132fb6c2b59778a46838af?s=128&d=identicon&r=PG&f=1", "display_name": "russoulmc", "link": "https://stackoverflow.com/users/8742124/russoulmc"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1507751249, "post_id": 46669649, "comment_id": 80340462, "body": "@Ben So based on both of your answers we can conclude that there is, unfortunately, no &#39;pretty&#39; way of writing dependent code even with the help of singletons and all released haskell extensions. Usage of coercion is inevitable. The  only thing we can do is to defer the coersion to simple prove functions that are the building blocks of more complex proofs and are guaranteed to be correct by our will :). This may be off-topic but do you have any experience with Idris ? More precise : can Idris be used to write realtime performant applications ? I feel pessimistic about this question though ."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1507751935, "post_id": 46669649, "comment_id": 80340861, "body": "I&#39;ve updated my answer, since I think @Ben must be right that the problem (long compilation) was specific to use of type classes and not a fundamental part of performing type checking inductively on <code>Nat</code>s."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 69, "user_id": 8742124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3a39412ec132fb6c2b59778a46838af?s=128&d=identicon&r=PG&f=1", "display_name": "russoulmc", "link": "https://stackoverflow.com/users/8742124/russoulmc"}, "edited": false, "score": 0, "creation_date": 1507758172, "post_id": 46669649, "comment_id": 80343740, "body": "@russoulmc There are some other packages that provide an expanded set of basic operations working with TypeLit Nats, so you could decide to trust one of them (which is after all what you&#39;re doing with singletons and indeed GHC itself). Then you wouldn&#39;t have to write the coerce yourself. :)   Idris looks very interesting, but I haven&#39;t done more than play with it a little, not built even a toy project with it."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 1, "last_activity_date": 1507751649, "last_edit_date": 1507751649, "creation_date": 1507646741, "answer_id": 46669649, "question_id": 46634706, "link": "https://stackoverflow.com/questions/46634706/haskell-singletons-typelits-package/46669649#46669649", "title": "Haskell singletons : typelits package", "body": "<p>As far as I can see, the exact approach you're taking can't work the way you want.  <code>sameNat</code> is evaluated at run-time, so its \"decision\" isn't available to the type checker, which therefore can't perform any type inference based on differentiating between the two branches of the case construct.</p>\n\n<p>You might be interested in my answer to\n<a href=\"https://stackoverflow.com/questions/45905744/how-to-deconstruct-an-snat-singletons\">How to deconstruct an SNat (singletons)</a>,\nregarding a similar question, which provides an implementation that avoids <code>unsafeCoerce</code> entirely through the use of type classes.  However, as @Ben has pointed out in the comments, because of this use of type classes, the compiler has to follow a chain of <code>n</code> instance definitions whenever you define a vector of size <code>n</code> (and the compiled code may explicitly include a structure of <code>n</code> nested instance dictionaries) making this impractical for real code.  For example, a million element vector is likely to cause the <em>compiler</em> to run for too long and/or use too much memory to be acceptable.</p>\n\n<p>For real code, I would suggest doing the type check manually (i.e., verifying that the code, as written, is type safe) and\nforcing it with <code>unsafeCoerce</code>:</p>\n\n<pre><code>replicate1 :: (KnownNat n) =&gt; SNat n -&gt; a -&gt; Vect n a\nreplicate1 n a =\n  unsafeCoerce (iterate (unsafeCoerce . (a ::&gt;)) Nil\n                !! fromInteger (fromSing n))\n</code></pre>\n\n<p>Obviously, this definition misses the point of dependent typing for this particular definition, but the hope is that you can build up a set of trusted (manually type-checked) primitives and then build non-trivial algorithms on top of them that can benefit from more rigorous type-checking.</p>\n\n<p>Note that in this particular case, you don't even really need the <code>n</code> parameter, so you can write:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\nreplicate2 :: forall a n . (KnownNat n) =&gt; a -&gt; Vect n a\nreplicate2 a =\n  unsafeCoerce (iterate (unsafeCoerce . (a ::&gt;)) Nil\n        !! fromInteger (fromSing (SNat :: SNat n)))\n</code></pre>\n\n<p>Anyway, a full working example is:</p>\n\n<pre><code>{-# LANGUAGE DataKinds           #-}\n{-# LANGUAGE GADTs               #-}\n{-# LANGUAGE KindSignatures      #-}\n{-# LANGUAGE TypeOperators       #-}\n{-# LANGUAGE FlexibleContexts    #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n\nimport Data.Singletons\nimport Data.Singletons.Prelude\nimport Data.Singletons.TypeLits\nimport Unsafe.Coerce\n\ninfixr 5 ::&gt;\ndata Vect (n :: Nat) a where\n  Nil :: Vect 0 a\n  (::&gt;) :: a -&gt; Vect (n :- 1) a -&gt; Vect n a\n\ninstance (Show a) =&gt; Show (Vect n a) where\n  showsPrec _ Nil = showString \"Nil\"\n  showsPrec d (x ::&gt; xs) = showParen (d &gt; prec) $\nshowsPrec (prec+1) x . showString \" ::&gt; \" . showsPrec prec xs\nwhere prec=5\n\nreplicate1 :: (KnownNat n) =&gt; SNat n -&gt; a -&gt; Vect n a\nreplicate1 n a =\n  unsafeCoerce (iterate (unsafeCoerce . (a ::&gt;)) Nil\n        !! fromInteger (fromSing n))\n\nreplicate2 :: forall a n . (KnownNat n) =&gt; a -&gt; Vect n a\nreplicate2 a =\n  unsafeCoerce (iterate (unsafeCoerce . (a ::&gt;)) Nil\n        !! fromInteger (fromSing (SNat :: SNat n)))\n\nhead' :: Vect (n :+ 1) a -&gt; a\nhead' (x ::&gt; _) = x\n\ntail' :: ((n :+ 1) :- 1) ~ n =&gt; Vect (n :+ 1) a -&gt; Vect n a\ntail' (_ ::&gt; v) = v\n\nmain = do print (replicate2 False   :: Vect 0 Bool)\n          print (replicate2 \"Three\" :: Vect 3 String)\n          print (head' (tail' (replicate2 \"1M\" :: Vect 1000000 String)))\n\n          print (replicate1 (SNat :: SNat 0) False   :: Vect 0 Bool)\n          print (replicate1 (SNat :: SNat 3) \"Three\" :: Vect 3 String)\n          print (head' (tail' (replicate1 (SNat :: SNat 1000000) \"1M\" :: Vect 1000000 String)))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 2, "last_activity_date": 1507720160, "last_edit_date": 1507720160, "creation_date": 1507695921, "answer_id": 46679832, "question_id": 46634706, "link": "https://stackoverflow.com/questions/46634706/haskell-singletons-typelits-package/46679832#46679832", "title": "Haskell singletons : typelits package", "body": "<p>The problem is that <code>sameNat n (sing :: Sing 0)</code> gives you a usable <code>n ~ 0</code> proof in the case that n is zero (when you pattern match on <code>Just Refl</code>), but if n is <em>not</em> zero it just gives you <code>Nothing</code>. That doesn't tell you anything at all about <code>n</code>, so as far as the type checker is aware you can call exactly the same set of things inside the <code>Nothing</code> branch as you could without calling <code>sameNat</code> in the first place (in particular, you can't use <code>sPred</code> because that requires that <code>1 &lt;= n</code>).</p>\n\n<p>So we need to pattern match on something that <em>either</em> provides evidence that <code>n ~ 0</code> <em>or</em> provides evidence that <code>1 &lt;= n</code>. Something like this:</p>\n\n<pre><code>data IsZero (n :: Nat)\n  where Zero :: (0 ~ n) =&gt; IsZero n\n        NonZero :: (1 &lt;= n) =&gt; IsZero n\nderiving instance Show (IsZero n)\n</code></pre>\n\n<p>Then we could write <code>replicate''</code> this way:</p>\n\n<pre><code>isZero :: forall n. SNat n -&gt; IsZero n\nisZero n = _\n\nreplicate'' :: SNat n -&gt; a -&gt; Vect n a\nreplicate'' n x = case isZero n\n                    of Zero -&gt; Nil\n                       NonZero -&gt; x ::&gt; replicate'' (sPred n) x\n</code></pre>\n\n<p>Of course that's just moved the problem to implementing the <code>isZero</code> function, which hasn't really bought us anything, but I'm going to stick with it because it's handy to have this as the basis of any <em>other</em> inductive definitions you want to make using <code>Nat</code>.</p>\n\n<p>So, implementing <code>isZero</code>. We could handle the zero case with <code>sameNat</code> of course, but that doesn't help the non-zero case. The singletons package also provides <code>Data.Singletons.Decide</code>, which gives you a way of getting a proof of equality <strong>or inequality</strong> of types based on their singletons. So we can do this:</p>\n\n<pre><code>isZero :: forall n. SNat n -&gt; IsZero n\nisZero n = case n %~ (SNat @0)\n             of Proved Refl -&gt; Zero\n                Disproved nonsense -&gt; NonZero\n</code></pre>\n\n<p>Sadly this doesn't work either! The <code>Proved</code> case is fine (and the same as <code>sameNat</code> giving us <code>Just Refl</code>, basically). But the \"proof of inequality\" comes in the form of <code>nonsense</code> being bound to a function of type <code>(n :~: 0) -&gt; Void</code>, and if we assume totality (without shenanigans) then the existence of such a function \"proves\" that we can't construct a <code>n :~: 0</code> value, which proves that <code>n</code> definitely isn't <code>0</code>. But this is just too far from a proof that <code>1 &lt;= n</code>; <em>we</em> can see that if <code>n</code> isn't 0 then it must be at least 1, from the properties of natural numbers, but GHC doesn't know this.</p>\n\n<p>Another way to go would be to use singleton's <code>Ord</code> support and pattern match on <code>SNat @1 :%&lt;= n</code>:</p>\n\n<pre><code>isZero :: forall n. SNat n -&gt; IsZero n\nisZero n = case (SNat @1) %:&lt;= n\n             of STrue -&gt; NonZero\n                SFalse -&gt; Zero\n</code></pre>\n\n<p>But that doesn't work either, because the <code>STrue</code> and <code>SFalse</code> are just singletons for type level <code>True</code> and <code>False</code>, disconnected from the original comparison. We don't get a proof that <code>0 ~ n</code> <strong>or</strong> <code>1 &lt;= n</code> from either side of this (and similarly can't get it to work by comparing with <code>SNat @0</code> either). This is type-checker boolean blindness, basically.</p>\n\n<p>Ultimately I was never able to satisfactorily solve this in my code. As far as I can tell we're missing a primitive; we either need to be able to compare singletons in a way that gives us <code>&lt;</code> or <code>&lt;=</code> constraints on the corresponding types, or we need a switch on whether a <code>Nat</code> is zero or nonzero.</p>\n\n<p>So I cheated:</p>\n\n<pre><code>isZero :: forall n. SNat n -&gt; IsZero n\nisZero n = case n %~ (SNat @0)\n             of Proved Refl -&gt; Zero\n                Disproved _ -&gt; unsafeCoerce (NonZero @1)\n</code></pre>\n\n<p>Since <code>NonZero</code> only contains evidence that <code>n</code> is 1 or more, but not any other information about <code>n</code>, you can just unsafely coerce a proof that 1 is 1 or more.</p>\n\n<p>Here's a full working example:</p>\n\n<pre><code>{-# LANGUAGE DataKinds\n           , GADTs\n           , KindSignatures\n           , ScopedTypeVariables\n           , StandaloneDeriving\n           , TypeApplications\n           , TypeOperators\n  #-}\n\nimport GHC.TypeLits ( type (&lt;=), type (-) )\nimport Data.Singletons.TypeLits ( Sing (SNat), SNat, Nat )\nimport Data.Singletons.Prelude.Enum ( sPred )\nimport Data.Singletons.Decide ( SDecide ((%~))\n                              , Decision (Proved, Disproved)\n                              , (:~:) (Refl)\n                              )\nimport Unsafe.Coerce ( unsafeCoerce )\n\ndata IsZero (n :: Nat)\n  where Zero :: (0 ~ n) =&gt; IsZero n\n        NonZero :: (1 &lt;= n) =&gt; IsZero n\nderiving instance Show (IsZero n)\n\nisZero :: forall n. SNat n -&gt; IsZero n\nisZero n = case n %~ (SNat @0)\n             of Proved Refl -&gt; Zero\n                Disproved _ -&gt; unsafeCoerce (NonZero @1)\n\n\ndata Vect (n :: Nat) a\n  where Nil :: Vect 0 a\n        (::&gt;) :: a -&gt; Vect (n - 1) a -&gt; Vect n a\nderiving instance Show a =&gt; Show (Vect n a)\n\nreplicate'' :: SNat n -&gt; a -&gt; Vect n a\nreplicate'' n x = case isZero n\n                    of Zero -&gt; Nil\n                       NonZero -&gt; x ::&gt; replicate'' (sPred n) x\n\nhead'' :: (1 &lt;= n) =&gt; Vect n a -&gt; a\nhead'' (x ::&gt; _) = x\n\nmain :: IO ()\nmain = putStrLn\n     . (:[])\n     . head''\n     $ replicate''\n         (SNat @1000000000000000000000000000000000000000000000000000000)\n         '\\x1f60e'\n</code></pre>\n\n<p>Note that unlike K. A. Buhr's suggested approach using <code>unsafeCoerce</code>, here the code for replicate is actually using the type checker to verify that it constructs a <code>Vect n a</code> in accordance to the <code>SNat n</code> provided, whereas their suggestion requires you to trust that the code does this (the actual meat of the work is done by <code>iterate</code> counting on <code>Int</code>) and only makes sure that the <em>callers</em> use the <code>SNat n</code> and the <code>Vect n a</code> consistently. The only bit of code you have to just trust (unchecked by the compiler) is that a <code>Refuted _ :: Decision (n :~: 0)</code> really does imply <code>1 &lt;= n</code>, inside <code>isZero</code> (which you can reuse to write lots of other functions that need to switch on whether a <code>SNat</code> is zero or not).</p>\n\n<p>As you try to implement more functionality with your <code>Vect</code>, you'll find that a lot of \"obvious\" things GHC doesn't know about the properties of <code>Nat</code> are quite painful. <code>Data.Constraint.Nat</code> from the <code>constraints</code> package has a lot of useful proofs you can use (for example, if you try to implement <code>drop :: (k &lt;= n) =&gt; SNat k -&gt; Vect n a -&gt; Vect (n - k) a</code>, you'll probably end up needing <code>leTrans</code> so that when you know that <code>1 &lt;= k</code> then also <code>1 &lt;= n</code> and you can actually pattern match to strip off another element). Avoiding this kind of hasochism is where K. A. Buhr's approach can be a great help, if you want to just implement your operation with code you trust and unsafeCoerce the types to line up.</p>\n"}], "owner": {"reputation": 69, "user_id": 8742124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3a39412ec132fb6c2b59778a46838af?s=128&d=identicon&r=PG&f=1", "display_name": "russoulmc", "link": "https://stackoverflow.com/users/8742124/russoulmc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 419, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1507751649, "creation_date": 1507487914, "question_id": 46634706, "link": "https://stackoverflow.com/questions/46634706/haskell-singletons-typelits-package", "title": "Haskell singletons : typelits package", "body": "<p>I have a hard time convincing compiler that my types are correct. With regular\n<code>Nat</code>s with <code>Zero</code> and <code>Succ</code> constructors it is pretty straightforward (the goal is to write <code>replicate</code> function for length-indexed lists (<code>Vect</code>)):</p>\n\n<pre><code>replicate' :: SNat n -&gt; a -&gt; Vect n a\nreplicate' SZero _ = Nil\nreplicate' (SSucc n) a = a :&gt; replicate' n a\n</code></pre>\n\n<p>But regular <code>Nat</code> is drastically slow.</p>\n\n<p>So there is a package that mirrors GHC.TypeLits in singletons library for faster Nats.\nBut I can't make the above example work with it:</p>\n\n<pre><code>sameNat :: forall a b. (KnownNat a, KnownNat b) =&gt; SNat a -&gt; SNat b -&gt; Maybe (a :~: b)\nsameNat x y\n  | natVal (Proxy :: Proxy a) == natVal (Proxy :: Proxy b) = Just (unsafeCoerce Refl)\n  | otherwise            = Nothing\n\nreplicate'' :: (KnownNat n) =&gt; SNat n -&gt; a -&gt; Vect n a\nreplicate'' n a =\n  case sameNat n (sing :: Sing 0) of\n    Just Refl -&gt; Nil\n    Nothing   -&gt; a ::&gt; replicate'' (sPred n) a\n</code></pre>\n\n<p>This won't typecheck on last line :</p>\n\n<pre><code>Couldn't match type \u2018n\u2019\n                     with \u2018(n GHC.TypeNats.- 1) GHC.TypeNats.+ 1\u2019\n</code></pre>\n"}, {"tags": ["haskell", "integer", "multiplication"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1507484126, "post_id": 46634006, "comment_id": 80217372, "body": "You could exploit <code>plusAbs</code>, implementing multiplication as repeated addition. You can not use <code>+</code> on your own custom integers."}, {"owner": {"reputation": 25, "user_id": 8619364, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c68eb4dd0033fc194da233b0c01193a?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/8619364/max"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1507484569, "post_id": 46634006, "comment_id": 80217513, "body": "@chi yeah it&#39;s mistake and I already fix it but it still not work"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 7, "creation_date": 1507485347, "post_id": 46634006, "comment_id": 80217785, "body": "I would encourage you to implement <code>plusAbs</code> without using <code>aiToInteger</code> to get a better feel for how your data type actually works."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1507489917, "post_id": 46634006, "comment_id": 80219310, "body": "Doing a recursive call with a larger argument often leads to a non terminating function. You should remove constructors from arguments, not adding them. You need to handle the case <code>multiplyAbs (Succ a) b = ...</code> and <code>multiplyAbs (Pred a) b = ...</code>. For the latter you would need a subtraction subroutine, or at least an &quot;opposite&quot; subroutine (which is easier to implement)."}], "answers": [{"tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": true, "score": 1, "last_activity_date": 1507496176, "creation_date": 1507496176, "answer_id": 46635984, "question_id": 46634006, "link": "https://stackoverflow.com/questions/46634006/multiplication-abstractinteger/46635984#46635984", "title": "Multiplication AbstractInteger", "body": "<p>As you've implemented <code>aiToInteger</code>, you might want to implement <code>iToAi</code>, something like:</p>\n\n<pre><code>iToAi :: Integer -&gt; AbstractInteger\niToAi a | a == 0 = Zero\n        | a &lt; 0 = Pred (iToAi (a + 1))\n        | a &gt; 0 = Succ (iToAi (a - 1))\n</code></pre>\n\n<p>Then <code>plusAbs</code> and <code>multiplyAbs</code> will come down to converting abstract integers to integers, perform the operations on them and convert them back:</p>\n\n<pre><code>plusAbs' :: AbstractInteger -&gt; AbstractInteger -&gt; AbstractInteger\nplusAbs' a b = iToAi (aiToInteger a + aiToInteger b)\n\nmultiplyAbs' :: AbstractInteger -&gt; AbstractInteger -&gt; AbstractInteger\nmultiplyAbs' a b = iToAi (aiToInteger a * aiToInteger b)\n</code></pre>\n\n<p>But I'd suggest trying to implement the functions by using pattern-match on the arguments, something like:</p>\n\n<pre><code>negative :: AbstractInteger -&gt; AbstractInteger\nnegative Zero = Zero\nnegative (Succ a) = Pred (negative a)\nnegative (Pred a) = Succ (negative a)\n\nmultiplyAbs :: AbstractInteger -&gt; AbstractInteger -&gt; AbstractInteger\nmultiplyAbs Zero a = Zero\nmultiplyAbs (Succ a) b = plusAbs (multiplyAbs a b) b\nmultiplyAbs (Pred a) b = plusAbs (multiplyAbs a b) (negative b)\n</code></pre>\n\n<p>The key point is that <code>Succ a</code> can be associated with <code>(a + 1)</code>, that's why <code>(Succ a) * b</code> can be associated with <code>a * b + b</code>. According to this logic <code>(Pred a) * b</code> is converted to <code>a * b - b</code>, that's why you need <code>negative</code> function here.</p>\n\n<p><code>plusAbs</code> is implemented similarly:</p>\n\n<ul>\n<li><code>(a + 1) + b</code> is the same as <code>1 + (a + b)</code></li>\n<li><code>(a - 1) + b</code> is the same as <code>(a + b) - 1</code></li>\n</ul>\n\n<p>The logic is just like in your example, but you can avoid using <code>aiToInteger</code> by using pattern-match.</p>\n"}], "owner": {"reputation": 25, "user_id": 8619364, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c68eb4dd0033fc194da233b0c01193a?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/8619364/max"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 46635984, "answer_count": 1, "score": 0, "last_activity_date": 1507496176, "creation_date": 1507483802, "last_edit_date": 1507484497, "question_id": 46634006, "link": "https://stackoverflow.com/questions/46634006/multiplication-abstractinteger", "title": "Multiplication AbstractInteger", "body": "<p>I have a datatype:</p>\n\n<pre><code>data AbstractInteger = Zero\n                     | Succ AbstractInteger\n                     | Pred AbstractInteger\n                     deriving (Show, Eq)\n</code></pre>\n\n<p>I already have two functions:</p>\n\n<p>1) Convert AbstractInteger into Integer:</p>\n\n<pre><code>aiToInteger :: AbstractInteger -&gt; Integer\naiToInteger (Zero) = 0\naiToInteger (Succ next) = 1 + (aiToInteger next)\naiToInteger (Pred prev) = (aiToInteger prev) - 1\n</code></pre>\n\n<p>2) Addition AbstractInteger :</p>\n\n<pre><code>plusAbs :: AbstractInteger -&gt; AbstractInteger -&gt; AbstractInteger\nplusAbs a b | aiToInteger a == 0 = b\n            | aiToInteger b == 0 = a\n            | aiToInteger a &gt; 0 = (Succ (plusAbs (Pred a) b))\n            | otherwise = (Pred (plusAbs (Succ a) b))\n</code></pre>\n\n<p>But I don't understand how to create multiply function.</p>\n\n<p>I wrote this but it's not work.</p>\n\n<pre><code>multiplyAbs :: AbstractInteger -&gt; AbstractInteger -&gt; AbstractInteger\nmultiplyAbs _ (Zero) = (Zero)\nmultiplyAbs (Zero) _ = (Zero)\nmultiplyAbs a (Succ Zero) = a\nmultiplyAbs (Succ Zero)  b = b\nmultiplyAbs a b = (plusAbs a (timesAbs a (Pred(b))))\n</code></pre>\n"}, {"tags": ["haskell", "lambda", "functional-programming", "monads"], "answers": [{"tags": [], "owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "is_accepted": false, "score": 2, "last_activity_date": 1507488083, "last_edit_date": 1507488083, "creation_date": 1507484418, "answer_id": 46634094, "question_id": 46633927, "link": "https://stackoverflow.com/questions/46633927/haskell-monad-flow-understanding/46634094#46634094", "title": "Haskell monad flow understanding", "body": "<p>I will only give you a partial answer, as I didn't understand, what exactly you are asking. Sorry for that.</p>\n\n<pre><code>do\n    a &lt;- getLine\n    b &lt;- getLine\n    putStrLn $ a ++ b\n</code></pre>\n\n<p>is equivalent to</p>\n\n<pre><code>getLine &gt;&gt;= \\a -&gt; getLine &gt;&gt;= \\b -&gt; putStrLn (a ++ b)\n</code></pre>\n\n<p>and this works, because</p>\n\n<pre><code>\\b -&gt; putStrLn (a ++ b)\n</code></pre>\n\n<p>creates a function, which captures <code>a</code> from the scope it is defined\nin. If the is no such <code>a</code> in the scope of this term, the compiler will complain about <code>a</code> not being in scope.</p>\n\n<p>Let's expand that a little and take a look at </p>\n\n<pre><code>\\a -&gt; getLine &gt;&gt;= \\b -&gt; putStrLn (a ++ b)\n</code></pre>\n\n<p>again. This defines a function, which if applied to some value <code>x</code> returns the result of the expression</p>\n\n<pre><code>getLine &gt;&gt;= \\b -&gt; putStrLn (x ++ b)\n</code></pre>\n\n<p>Here the variable <code>a</code> got replaced by the value <code>x</code>. So there is no more <code>a</code> to worry about.</p>\n"}, {"tags": [], "owner": {"reputation": 286, "user_id": 6513649, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf003438eb6ddaccfda28664114f205b?s=128&d=identicon&r=PG&f=1", "display_name": "Yarick", "link": "https://stackoverflow.com/users/6513649/yarick"}, "is_accepted": false, "score": 1, "last_activity_date": 1507484607, "creation_date": 1507484607, "answer_id": 46634128, "question_id": 46633927, "link": "https://stackoverflow.com/questions/46633927/haskell-monad-flow-understanding/46634128#46634128", "title": "Haskell monad flow understanding", "body": "<p>Unsugared <code>do block</code> will be like <code>getLine &gt;&gt;= \\a -&gt; getLine &gt;&gt;= \\b -&gt; putStrLn (a ++ b)</code> you don't need to pass all parameters from previous call because of local scopes, let's denote them:</p>\n\n<pre><code>getLine &gt;&gt;= \n(!This is first closure! \\a -&gt; getLine &gt;&gt;= \n(!This is second, all variables from the first \nclosure are available, because in haskell function closure takes outer scope in! \\b -&gt; \nputStrLn(a ++ b) !End of the second closure!) !End of the first closure!)\n</code></pre>\n\n<p>And now about type of (>>=). GHCI prints next <code>(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b</code>.\nSo <code>k</code> is just a lambda that <code>Monad m</code> will work with, all it have to do is \"implement interface\" for <code>&gt;&gt;=</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 2, "last_activity_date": 1507486721, "creation_date": 1507486721, "answer_id": 46634495, "question_id": 46633927, "link": "https://stackoverflow.com/questions/46633927/haskell-monad-flow-understanding/46634495#46634495", "title": "Haskell monad flow understanding", "body": "<p><code>do</code> notation like this:</p>\n\n<pre><code>do\n    a &lt;- getLine\n    b &lt;- getLine\n    putStrLn $ a ++ b\n</code></pre>\n\n<p>is equivalent to</p>\n\n<pre><code>getLine &gt;&gt;= \\a -&gt; getLine &gt;&gt;= \\b -&gt; putStrLn (a ++ b)\n</code></pre>\n\n<p>This, again, is equivalent to</p>\n\n<pre><code>getLine &gt;&gt;= (\\a -&gt; getLine &gt;&gt;= \\b -&gt; putStrLn (a ++ b))\n</code></pre>\n\n<p>Notice the extra brackets. The first <code>getLine</code> is composed with a lambda expression where <code>a</code> is the 'contained element'. Inside of this lambda expression, a new expression is invoked. That expression is</p>\n\n<pre><code>getLine &gt;&gt;= \\b -&gt; putStrLn (a ++ b)\n</code></pre>\n\n<p>This expression is still 'inside' the first lambda expression, which means that <code>a</code> is still in scope.</p>\n\n<p>You can put even more brackets around expressions, if it helps:</p>\n\n<pre><code>getLine &gt;&gt;= (\\a -&gt; getLine &gt;&gt;= (\\b -&gt; putStrLn (a ++ b)))\n</code></pre>\n\n<p>These brackets are entirely redundant, but they highlight how the various expressions are scoped. Notice that both <code>a</code> and <code>b</code> are still in scope when <code>putStrLn (a ++ b)</code> is invoked.</p>\n"}, {"comments": [{"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1507584937, "post_id": 46634637, "comment_id": 80259804, "body": "Note that the <code>&gt;&gt;=</code> operator is actually left associative.  It&#39;s just that the lambda syntax <code>\\x -&gt; ...</code> is a special syntactic form that gobbles up &quot;as much as it can&quot;."}], "tags": [], "owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "is_accepted": false, "score": 1, "last_activity_date": 1507585744, "last_edit_date": 1507585744, "creation_date": 1507487598, "answer_id": 46634637, "question_id": 46633927, "link": "https://stackoverflow.com/questions/46633927/haskell-monad-flow-understanding/46634637#46634637", "title": "Haskell monad flow understanding", "body": "<blockquote>\n  <p>Is the <code>do</code> equivalent to the following?</p>\n\n<pre><code>getLine &gt;&gt;= \\a -&gt; getLine &gt;&gt;= \\b -&gt; putStrLn (a ++ b)\n</code></pre>\n</blockquote>\n\n<p>Yes, this one.</p>\n\n<blockquote>\n  <p>If the first is correct, wouldn't that cause an error since a would be undefined in the monad definition?</p>\n</blockquote>\n\n<p>No. The <code>-&gt;</code> arrow syntax is right-associative:</p>\n\n<pre><code>getLine &gt;&gt;= (\\a -&gt; getLine &gt;&gt;= (\\b -&gt; putStrLn (a ++ b)))\n</code></pre>\n\n<p>It forms a closure where <code>a</code> is still in scope.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user1212854"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 0, "answer_count": 4, "score": 2, "last_activity_date": 1507585744, "creation_date": 1507483373, "last_edit_date": 1507486802, "question_id": 46633927, "link": "https://stackoverflow.com/questions/46633927/haskell-monad-flow-understanding", "title": "Haskell monad flow understanding", "body": "<p>I will restate my questions with examples at the bottom.</p>\n\n<p>When I say <code>m</code> or <code>k</code> I am referring to the left and right values in the function call, <code>m &gt;&gt;= k</code>.</p>\n\n<p>There's this blur in understanding of monads. If <code>m</code> is a computation and <code>k</code> is a lambda expression, does that mean that <code>k</code> serves two purposes where it can work with bindings in the do block using it and also be used for some other purpose in the Monad instance definition? If a value is bound right before <code>k</code> is evaluated in its do block, will values be automatically passed to it or is the Monad instance methods definition where we define the sole effect of propagation to <code>k</code>?</p>\n\n<p>I may be a bit mislead by the examples I see that always pass the directly previous bound item to the lambda expression when explaining monads. Even when the notation used is pure-do-no-lambda, is it always the last bound item that is passed to the hidden lambda, under the hood. Now, is it bad practice to use a lambda that takes more than one argument and use it as <code>k</code> in <code>m &gt;&gt;= k</code>? Or am I wrong in assuming that if we are working in a do block, under the hood, only one argument is passed to the next 'hidden' lambda expression and that this one argument is the immediate previously bound item?</p>\n\n<p>I will now restate my questions with examples.</p>\n\n<pre><code>do\n    a &lt;- getLine\n    b &lt;- getLine\n    putStrLn $ a ++ b\n</code></pre>\n\n<p><code>a</code> and <code>b</code> are bound to values in <code>IO</code> container that is returned from running <code>getLine</code>. Under the hood, which of the following is equivalent, if any?</p>\n\n<pre><code>getLine &gt;&gt;= \\a -&gt; getLine &gt;&gt;= \\b -&gt; putStrLn (a ++ b)\n</code></pre>\n\n<p><em>OR</em></p>\n\n<pre><code>getLine &gt;&gt;= \\a -&gt; getLine &gt;&gt;= \\(a, b) -&gt; putStrLn (a ++ b)\n</code></pre>\n\n<p>We see that the value in the <code>IO</code> container of <code>getLine</code> is extracted and passed onto the lambda expression.</p>\n\n<p>If the first is correct, wouldn't that cause an error since <code>a</code> would be undefined in the monad definition?</p>\n\n<p>I pulled the second out of thin air. I've seen no evidence that it could be this, but even if it isn't the correct answer, can we do something like that? Of course, we would have to make all lambda expressions used with <code>&gt;&gt;=</code> all take 2-tuples in this context. Is this behaviour not solely dictated by our <code>&gt;&gt;=</code> definition, at least when only-lambda-no-do notation is used?</p>\n\n<p>Can we use this lambda expression in the monad definition and pass something to it causing it to print screen again? Should we?</p>\n\n<p>If we wanted to work with <code>putStrLn</code> in the <code>&gt;&gt;=</code> definition, would we have to pass some arbitrary value to <code>k</code> in order to get the <code>putStrLn</code> function out?</p>\n\n<p>Thank you. Peace.</p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1507482013, "post_id": 46633608, "comment_id": 80216632, "body": "if you call <code>stack test</code> the flag is set automatically - right now there is no cabal flag to enable this CPP flag."}], "answers": [{"comments": [{"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1507536635, "post_id": 46635306, "comment_id": 80232417, "body": "This seems to only work when <code>stack ghci</code> is invoked on the <code>boxes</code> project rather then when it is included as a dependency via cabal."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 1, "creation_date": 1507536934, "post_id": 46635306, "comment_id": 80232570, "body": "you can send a pull request to boxes and provide a cabal flag, and use your github repo in the meantime, stack has built in options to use a repo as a source; for cabal i haven&#39;t used it in a while so I don&#39;t know if this is an option here."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1507540080, "post_id": 46635306, "comment_id": 80234425, "body": "if you need the <code>content</code> function for something other than testing purposes - I would ask the maintainer about the intent of hiding said function! There are plenty of things that are convenient, but increase some risk or another when used."}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 1, "last_activity_date": 1507491665, "creation_date": 1507491665, "answer_id": 46635306, "question_id": 46633608, "link": "https://stackoverflow.com/questions/46633608/how-do-i-add-a-cpp-defininition-within-cabal-stack/46635306#46635306", "title": "How do I add a CPP defininition within cabal / stack?", "body": "<p>I have to correct myself - the comment I gave is totally and utterly wrong.</p>\n\n<pre><code>&gt; git clone git://github.com/treeowl/boxes.git\n&gt; cd boxes\n&gt; stack init\n&gt; stack ghci --ghc-options=-DTESTING\nsplit-0.2.3.2: using precompiled package\nboxes-0.1.4: configure (lib)\nConfiguring boxes-0.1.4...\nboxes-0.1.4: initial-build-steps (lib)\nCompleted 2 action(s).\nConfiguring GHCi with the following packages: boxes\nGHCi, version 8.0.2: http://www.haskell.org/ghc/  :? for help\nLoaded GHCi configuration from ...\n[1 of 1] Compiling Text.PrettyPrint.Boxes ( .../boxes/Text/PrettyPrint/Boxes.hs, interpreted )\nOk, modules loaded: Text.PrettyPrint.Boxes.\nLoaded GHCi configuration from /tmp/ghci28386/ghci-script\n*Text.PrettyPrint.Boxes Text.PrettyPrint.Boxes&gt; :t content \ncontent :: Box -&gt; Content\n</code></pre>\n\n<p>just works fine.</p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 0, "accepted_answer_id": 46635306, "answer_count": 1, "score": 0, "last_activity_date": 1507491665, "creation_date": 1507481439, "question_id": 46633608, "link": "https://stackoverflow.com/questions/46633608/how-do-i-add-a-cpp-defininition-within-cabal-stack", "title": "How do I add a CPP defininition within cabal / stack?", "body": "<p>I'm looking at the following module: <a href=\"https://hackage.haskell.org/package/boxes-0.1.4/docs/src/Text-PrettyPrint-Boxes.html\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/boxes-0.1.4/docs/src/Text-PrettyPrint-Boxes.html</a></p>\n\n<p>Which has contents of:</p>\n\n<pre><code>module Text.PrettyPrint.Boxes\n    ( -- * Constructing boxes\n#ifdef TESTING\n      Box(Box, content)\n#else\n      Box\n#endif\n</code></pre>\n\n<p>How can I enable / define the <code>TESTING</code> value - for development purposes? Ideally I'd like to have this built / enabled within a GHCi session.</p>\n"}, {"tags": ["haskell", "filter", "parameters", "predicate", "partial-application"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1507477212, "post_id": 46632855, "comment_id": 80215029, "body": "It&#39;s unclear what you mean, please add some code/pseudocode explaining <i>how you would like to use this</i>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1507479294, "post_id": 46632855, "comment_id": 80215724, "body": "to your edit: the first part of my answer fully applies. that is, if you use the same int, like <code>theFunction x i = x &lt; i</code> and then <code>filter (flip theFunction 5) aList</code>, keeping in the resulting list all elements of <code>aList</code> that are smaller than 5."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1507486553, "post_id": 46632855, "comment_id": 80218175, "body": "Seems like this is not a filtering but a folding job. You may try <code>(==) &lt;$&gt; foldr1 (\\x y -&gt; bool (minBound :: Int) x (x &lt;= y)) &lt;*&gt; head</code>. Where <code>bool</code> is a ternary operator from <code>Data.Bool.bool</code> with type <code>a -&gt; a -&gt; Bool -&gt; a</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1507501698, "post_id": 46632855, "comment_id": 80222533, "body": "@Redu <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Bool.html#v:bool\" rel=\"nofollow noreferrer\">consider</a> <code>[1,2,3,1]</code>: <code>3 &lt;= 2</code> is false, so <code>minBound</code> will be produced - why?? --- besides, <code>foldr1</code>&#39;s implementation (both <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/src/GHC.List.html#foldr1\" rel=\"nofollow noreferrer\">old</a> and <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/src/Data.Foldable.html#line-205\" rel=\"nofollow noreferrer\">new</a>) guarantees the reducing function to be called only with existing values. and <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Foldable.html#v:minimum\" rel=\"nofollow noreferrer\"><code>minimum</code></a> already exists."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1507502227, "post_id": 46632855, "comment_id": 80222653, "body": "@Will Ness I think unlike <code>reduceRight</code> in JS, in <code>\\ x y -&gt;</code>,  <code>x</code> is the previous element from left. That&#39;s why <code>[1,2,3,4 ]</code> just resolves <code>True</code>. Am i missing something..?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1507502419, "post_id": 46632855, "comment_id": 80222714, "body": "@Redu I&#39;m sorry, I should&#39;ve written <code>3 &lt;= 1</code> is false. <code>foldr1 g [1,2,3,1] == g 1 (g 2 (g 3 1))</code>."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1507502813, "post_id": 46632855, "comment_id": 80222796, "body": "@Will Ness Honestly... my interpretation of the question was to check simply if the list is in ascending order. May be i am totally off."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 1, "creation_date": 1507502915, "post_id": 46632855, "comment_id": 80222809, "body": "@Redu yet for <code>[minBound, 3, 1]</code> your function will return ... <code>True</code>. --- I read the question as more about the general use patterns. --- <code>ascending = and . (zipWith (&lt;=) &lt;*&gt; drop 1)</code>."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1507503280, "post_id": 46632855, "comment_id": 80222865, "body": "@Will Ness That&#39;s indeed true as an edge case. It&#39;s better be done by <code>foldr</code> and an initial like <code>(True, maxBound)</code>. That <code>zipWith (&lt;=)</code> applicative version is beautiful."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1507503509, "post_id": 46632855, "comment_id": 80222914, "body": "@Redu any use of bounds like that is a code smell."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1507503541, "post_id": 46632855, "comment_id": 80222922, "body": "@Will Ness Totally agreed."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1507479620, "post_id": 46632958, "comment_id": 80215831, "body": "Perhaps it would be more effective, didactically, to use a lambda expression rather than <code>flip</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1507479657, "post_id": 46632958, "comment_id": 80215845, "body": "@dfeuer I like combinatory definitions more. <code>\\ -&gt;</code> look like more heavy syntax to get lost in."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1507487651, "post_id": 46632958, "comment_id": 80218509, "body": "I like neither, I would write this as <code>filter (`theFunction`i) aList</code>. (But preferrable would of course be if <code>theFunction</code> were defined in flipped form in the first place.)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1507494930, "post_id": 46632958, "comment_id": 80220730, "body": "@leftaroundabout me too (the <code>(`op` v)</code> stuff). I meant for the exposition, here, because both the other two options involve new <i>syntax</i> that needs to be explained to / processed by a learner. <code>theFunction</code> is presumably something that the OP <i>already</i> has, a.o.t. defining it especially for this use."}, {"owner": {"reputation": 398, "user_id": 3236033, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/81b29b95c129cec714b31ee157dc47cb?s=128&d=identicon&r=PG", "display_name": "CarlEdman", "link": "https://stackoverflow.com/users/3236033/carledman"}, "edited": false, "score": 0, "creation_date": 1507495450, "post_id": 46632958, "comment_id": 80220885, "body": "Good answer. Partial function application is a very powerful technique unfamiliar to many non-Haskell hackers and has a very sweet syntax in Haskell. My only additional suggestion is that if theFunction is really just as simple as suggested by the original post, it would be even clearer when not even given a name.  Just plain \u2018filter (&lt;x)\u2019 (where x is the number cutoff number) will work with fewer keystrokes and greater readability."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 398, "user_id": 3236033, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/81b29b95c129cec714b31ee157dc47cb?s=128&d=identicon&r=PG", "display_name": "CarlEdman", "link": "https://stackoverflow.com/users/3236033/carledman"}, "edited": false, "score": 0, "creation_date": 1507495530, "post_id": 46632958, "comment_id": 80220916, "body": "@CarlEdman thank you. re: your suggestion, this <i>is</i> mentioned in the end of first part (just above the divider line)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1507658043, "post_id": 46632958, "comment_id": 80294386, "body": "The combinatorial approach is perfectly fine if you just want to make a very local change, like <code>flip</code>, or if you can use something that scales fairly well, like the applicative idiom. But if you need to shuffle more arguments, or duplicate in a more controlled way, you&#39;ll surely want lambdas at some point to prevent the code from turning into spaghetti. May I ask why you prefer to start teaching the combinatorial approach?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1507660312, "post_id": 46632958, "comment_id": 80295624, "body": "@dfeuer as I said in one of the above comments, it is immediately understandable without needing to know any additional syntax like that of lambdas or sections. So seems like a good fit for the first steps in learning Haskell. Of course what you said is absolutely valid and very soon lambda expressions are found out to be saving us creating a great number of unnecessary temporary functions just for shuffling some arguments. But also, a minimalist approach has its definite appeal, i.e., less distractions to overload the mind of a reader with.  As always, it&#39;s a balancing act."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1507660507, "post_id": 46632958, "comment_id": 80295742, "body": "@dfeuer overall, combinators are more on the pointfree side, and pointfree certainly is nice when appropriate. More algebraic code is easier to follow and reshuffle, a la Bird&#39;s program derivations."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1507660644, "post_id": 46632958, "comment_id": 80295817, "body": "@WillNess, can you point to a particular Bird reference I should see?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1507660764, "post_id": 46632958, "comment_id": 80295878, "body": "@dfeuer <a href=\"https://rads.stackoverflow.com/amzn/click/com/0521513383\" rel=\"nofollow noreferrer\" rel=\"nofollow noreferrer\">amazon.com/Pearls-Functional-Algorithm-Design-Richard/dp/&hellip;</a>"}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 1, "last_activity_date": 1507480300, "last_edit_date": 1507480300, "creation_date": 1507477422, "answer_id": 46632958, "question_id": 46632855, "link": "https://stackoverflow.com/questions/46632855/haskell-filter-function-with-multiple-parameters/46632958#46632958", "title": "Haskell filter function with multiple parameters", "body": "<p>In that case you use a partially applied predicate function, like this</p>\n\n<pre><code>-- theFunction :: elementOfAList -&gt; Int -&gt; Bool       -- \"::\" means, \"is of type\"\nnewList = filter (flip theFunction i) aList\n</code></pre>\n\n<p>because</p>\n\n<pre><code>flip theFunction i x = theFunction x i\n</code></pre>\n\n<p>by the definition of <code>flip</code>, so <code>flip theFunction</code> has the type <code>Int -&gt; elementOfAList -&gt; Bool</code>:</p>\n\n<pre><code>flip ::       (a -&gt; b   -&gt; c   ) -&gt; b -&gt; a -&gt; c\ntheFunction :: a -&gt; Int -&gt; Bool\nflip theFunction ::               Int -&gt; a -&gt; Bool\nflip theFunction  (i ::  Int)         :: a -&gt; Bool\n</code></pre>\n\n<p>where <code>i</code> is some <code>Int</code> value defined elsewhere. <code>a</code> is a type variable, i.e. it can be any type, like the type of a list's elements (i.e. for a list <code>aList :: [a]</code> each element has the same type, <code>a</code>).</p>\n\n<p>For example, with <code>theFunction x i = x &lt; i</code> you could call <code>filter (flip theFunction 5) aList</code>, keeping in the resulting list all the elements of <code>aList</code> that are smaller than 5. Normally this would just be written as <code>filter (&lt; 5) aList</code>, with <a href=\"https://stackoverflow.com/a/13147064/849891\"><em>operator sections</em></a> (of which <code>(&lt; 5)</code> is one example, absolutely equivalent to the <code>flip theFunction 5</code>).</p>\n\n<hr>\n\n<p>The above <em>filtering</em> will use the same <code>Int</code> value <code>i</code> in calling <code>theFunction</code> for every element <code>x</code> of a list <code>aList</code>. If you wanted to recalculate that <code>Int</code>, it is done with another pattern (i.e., higher-order function),</p>\n\n<pre><code>mapAccumL :: (acc -&gt; x -&gt; (acc, y)) -&gt; acc -&gt; [x] -&gt; (acc, [y])\n</code></pre>\n\n<p>Suppose you wanted to keep in a list of ints all the elements as they are being found by <code>theFunction</code>. Then you could do it like</p>\n\n<pre><code>theFunction :: elementOfAList -&gt; Int -&gt; Bool\nfoo :: Int -&gt; [Int] -&gt; [Int]\nfoo i xs = concat (snd (mapAccumL g i xs))    -- normally written as\n        -- concat $ snd $ mapAccumL g i xs     -- or \n        -- concat . snd $ mapAccumL g i xs      -- or even\n        -- concat . snd . mapAccumL g i $ xs\n  where\n  g acc x   -- g :: (acc -&gt; x -&gt; (acc, y))  according to mapAccumL's signature\n    | theFunction x acc = (x, [x])   -- include `x` in output, and update the acc\n    | otherwise         = (acc, [])  -- keep the accumulated value, and skip this `x`\n</code></pre>\n\n<p>Because both <code>x</code> and <code>acc</code> are used in the same role (the first element of the tuple) they both must be of same type.</p>\n"}], "owner": {"reputation": 43, "user_id": 8741507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a5237abd2c5665558df7dd293d03579?s=128&d=identicon&r=PG&f=1", "display_name": "Tom coates", "link": "https://stackoverflow.com/users/8741507/tom-coates"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2974, "favorite_count": 0, "accepted_answer_id": 46632958, "answer_count": 1, "score": 2, "last_activity_date": 1507510881, "creation_date": 1507476873, "last_edit_date": 1507510881, "question_id": 46632855, "link": "https://stackoverflow.com/questions/46632855/haskell-filter-function-with-multiple-parameters", "title": "Haskell filter function with multiple parameters", "body": "<p>I'm trying to learn Haskell and wondered how to filter a given list, with a function that takes multiple parameters, passing each element of the list with other unchanging elements to the function, to create a new list.</p>\n\n<p>I understand that I can do this to use a bool function to filter the list:</p>\n\n<pre><code>newList = filter theFunction aList\n</code></pre>\n\n<p>but what happens when the theFunction takes other parameters like this:</p>\n\n<pre><code>theFunction -&gt; elementOfAList -&gt; Int -&gt; Bool \n</code></pre>\n\n<p>how then could I filter each element of the list, whilst parsing in another element to the function? Any help would be greatly appreciated :)</p>\n\n<p>Edit -> To provide some more information, if I wanted to have a list of integers from [1..10], that get filtered through a function that takes two integers and returns true if the first one is smaller, how could I do that?</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1507479742, "post_id": 46632787, "comment_id": 80215861, "body": "Does it have to be <i>Text.JSON</i>, or can you use other libraries? E.g. <a href=\"https://hackage.haskell.org/package/aeson\" rel=\"nofollow noreferrer\">Aeson</a>? Or, going in the other direction, if it has to be independent of structure, couldn&#39;t you do a simple string search?"}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1507481719, "post_id": 46632787, "comment_id": 80216534, "body": "<a href=\"https://en.wikibooks.org/wiki/Haskell/Understanding_monads#Motivation:_Maybe\" rel=\"nofollow noreferrer\">en.wikibooks.org/wiki/Haskell/&hellip;</a>  This might be helpful"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1507791086, "post_id": 46632787, "comment_id": 80353268, "body": "Is there anything unclear about my answer?"}], "answers": [{"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 3, "last_activity_date": 1507548645, "last_edit_date": 1507548645, "creation_date": 1507495660, "answer_id": 46635904, "question_id": 46632787, "link": "https://stackoverflow.com/questions/46632787/parsing-a-json-document-with-a-monad-to-look-for-a-specific-value/46635904#46635904", "title": "Parsing a JSON document with a Monad to look for a specific value?", "body": "<h2>Yes those <code>case</code> statements are not necessary</h2>\n\n<p>Your guesses are correct - but monads are not the correct answer in this case (no pun intended<sup>1</sup>).</p>\n\n<p>This is a great job for <code>Traversals</code>, <code>Prisms</code> and <code>Lenses</code> - and of course the great <a href=\"https://hackage.haskell.org/package/aeson\" rel=\"nofollow noreferrer\">aeson</a>-library and <a href=\"https://hackage.haskell.org/package/lens-aeson\" rel=\"nofollow noreferrer\">lens-aeson</a>.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Test where\n\nimport Control.Lens\nimport Data.Aeson\nimport Data.Aeson.Lens\nimport Data.Monoid ((&lt;&gt;))\n\njsonString = \"{\\\"root\\\":[{\\\"root1\\\":157538}\"\n           &lt;&gt;          \",{\\\"root2\\\":[{\\\"leaf21\\\":3}]}\"\n           &lt;&gt;          \",{\\\"root3\\\":[{\\\"leaf31\\\":\\\"somestring\\\"}\"\n           &lt;&gt;                      \",{\\\"index\\\":\\\"foundit\\\"}]}]}\"\n\nval :: Maybe Value\nval = decode jsonString\n\nindexMaybe :: Maybe Value\nindexMaybe = val ^? _Just . key \"root\"  . values\n                          . key \"root3\" . values\n                          . key \"index\"\n</code></pre>\n\n<h2>So what does this do?</h2>\n\n<ul>\n<li><p><code>decode</code> transforms a <code>ByteString</code> into a <code>Maybe Value</code> - <code>Maybe</code> because parsing might fail!</p></li>\n<li><p>then the <code>(^?)</code> operator previews a traversal - i.e. it goes through the JSON Object and follows the json path you give;</p></li>\n</ul>\n\n<p>For this you have at least to know the path to \"index\", if this path is unknown, you'd have to invest a bit more research into lenses/prisms/traversals or do a simple tree search on the parsed object.</p>\n\n<p>Here is a spoiler for those who lack time to implement a search for \"index\" in a json object:</p>\n\n<blockquote class=\"spoiler\">\n  <p><pre>\nsearch :: Text -> Value -> Maybe Value\nsearch txt o@(Object o') = let f y@(Just x) _ = y\n                               f _ v = search txt v\n                            in case o ^? key txt of\n                                 Nothing -> foldl' f Nothing o'\n                                 x -> x\nsearch txt a@(Array a') = let f y@(Just x) _ = y\n                              f _ v = search txt v\n                           in foldl' f Nothing a'\nsearch _ _ = Nothing\n</pre></p>\n</blockquote>\n\n<h2>Alternatives</h2>\n\n<p>As @MarkSeeman already mentioned - a simple text search, might be much more efficient.</p>\n\n<p><sup>1</sup>: okay maybe a little bit</p>\n"}], "owner": {"reputation": 463, "user_id": 3203476, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c7935bf89df5baff4e39ea43be4ce4e?s=128&d=identicon&r=PG&f=1", "display_name": "user3203476", "link": "https://stackoverflow.com/users/3203476/user3203476"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 0, "accepted_answer_id": 46635904, "answer_count": 1, "score": 0, "last_activity_date": 1507548645, "creation_date": 1507476370, "last_edit_date": 1507476712, "question_id": 46632787, "link": "https://stackoverflow.com/questions/46632787/parsing-a-json-document-with-a-monad-to-look-for-a-specific-value", "title": "Parsing a JSON document with a Monad to look for a specific value?", "body": "<p>I am a beginner at Haskell and I am trying to use <a href=\"https://hackage.haskell.org/package/json-0.9.1/docs/Text-JSON.html\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/json-0.9.1/docs/Text-JSON.html</a> to parse a JSON document.</p>\n\n<p>In my task, i am given a JSON document, and I would like to return the value corresponding to \"index\" , for example in the following case: </p>\n\n<pre><code>{\n    \"root\": [\n        {\n            \"root1\": 157538\n        },\n        {\n            \"root2\": [\n                {\n                    \"leaf21\": 3\n                }\n            ]\n        },\n        {\n            \"root3\": [\n                {\n                    \"leaf31\": \"somestring\"\n                },\n                {\n                    \"index\": \"foundit\"\n                }\n            ]\n        }\n    ]\n}\n</code></pre>\n\n<p>To be specific: if presented with a JSON document and a path like \"root\" -> \"root3\" -> \"index\" exists, I would like to return \"foundit\", else I would like to return Nothing. Everything else in the document is arbitrary: root3,root2,root1,root may or may not exist etc.</p>\n\n<p>Now I can do this using lots of case statements and patterns matches, but having read <a href=\"https://wiki.haskell.org/All_About_Monads\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/All_About_Monads</a>, I am wondering if there is a better way using something similar to the Maybe Monad and the sheep-cloning example, however i am not sure how to write the bind function ...</p>\n\n<p>[in my real case the value I seek is actually 19-deep in the document so I have lots of case statements]</p>\n\n<p>Please could you suggest how to use Monads to do this ?</p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1507474226, "post_id": 46632135, "comment_id": 80214077, "body": "what is your question?"}, {"owner": {"reputation": 1970, "user_id": 782168, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ca858ed75c3e3abbb28eadadba9ee5db?s=128&d=identicon&r=PG", "display_name": "h4ck3rm1k3", "link": "https://stackoverflow.com/users/782168/h4ck3rm1k3"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1507475389, "post_id": 46632135, "comment_id": 80214434, "body": "I have edited to include a better question."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1507479327, "post_id": 46632135, "comment_id": 80215733, "body": "What is the argument you have against - saving the structure in a file and using - read or any other simple parser? IO is not evil - IO is just someone you should have an eye on because he is behaving unexpectedly sometimes."}, {"owner": {"reputation": 1970, "user_id": 782168, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ca858ed75c3e3abbb28eadadba9ee5db?s=128&d=identicon&r=PG", "display_name": "h4ck3rm1k3", "link": "https://stackoverflow.com/users/782168/h4ck3rm1k3"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1507483384, "post_id": 46632135, "comment_id": 80217114, "body": "I read this from the rdf file using rdf4h. It is slow (1k lines per second). This data is compiler data and I want to feed it eventually as haskell source code to the compiler and have it typed checked. I want to express the types as  haskell constructures and load the data into those structures."}], "answers": [{"comments": [{"owner": {"reputation": 1970, "user_id": 782168, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ca858ed75c3e3abbb28eadadba9ee5db?s=128&d=identicon&r=PG", "display_name": "h4ck3rm1k3", "link": "https://stackoverflow.com/users/782168/h4ck3rm1k3"}, "edited": false, "score": 0, "creation_date": 1507489474, "post_id": 46634903, "comment_id": 80219144, "body": "What i did is just that , read it in, ran show and then exported that to a data load file. That was then provoking this bug."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 1970, "user_id": 782168, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ca858ed75c3e3abbb28eadadba9ee5db?s=128&d=identicon&r=PG", "display_name": "h4ck3rm1k3", "link": "https://stackoverflow.com/users/782168/h4ck3rm1k3"}, "edited": false, "score": 0, "creation_date": 1507490602, "post_id": 46634903, "comment_id": 80219527, "body": "no you put the data into the file and compiled it - what I meant add a read instance and read the data from a separate file"}, {"owner": {"reputation": 1970, "user_id": 782168, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ca858ed75c3e3abbb28eadadba9ee5db?s=128&d=identicon&r=PG", "display_name": "h4ck3rm1k3", "link": "https://stackoverflow.com/users/782168/h4ck3rm1k3"}, "edited": false, "score": 0, "creation_date": 1507498222, "post_id": 46634903, "comment_id": 80221640, "body": "What would be the difference between reading the data like you suggest and using the rdf4h lib to do so, it will still be tainted io. I am looking for basically a DSL to then use like template haskell to later evaluate the c -code contained in there in haskell  or translate the data into a new haskell program and run it."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 1970, "user_id": 782168, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ca858ed75c3e3abbb28eadadba9ee5db?s=128&d=identicon&r=PG", "display_name": "h4ck3rm1k3", "link": "https://stackoverflow.com/users/782168/h4ck3rm1k3"}, "edited": false, "score": 0, "creation_date": 1507499877, "post_id": 46634903, "comment_id": 80222046, "body": "I thought the issue is that rdf4h is so slow - I do not understand why io is such a problem."}, {"owner": {"reputation": 1970, "user_id": 782168, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ca858ed75c3e3abbb28eadadba9ee5db?s=128&d=identicon&r=PG", "display_name": "h4ck3rm1k3", "link": "https://stackoverflow.com/users/782168/h4ck3rm1k3"}, "edited": false, "score": 0, "creation_date": 1507550533, "post_id": 46634903, "comment_id": 80240895, "body": "Ok, thank you I will try out your suggestion and get back to you. I don&#39;t know why IO is a problem, I am still learning."}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 1, "last_activity_date": 1507489035, "creation_date": 1507489035, "answer_id": 46634903, "question_id": 46632135, "link": "https://stackoverflow.com/questions/46632135/how-to-best-workaround-haskell-8-03-ghci-getlabelbc-ran-out-of-labels/46634903#46634903", "title": "How to best workaround Haskell 8.03 GHCI getLabelBc: Ran out of labels?", "body": "<h2>A quick and dirty solution</h2>\n\n<p>What I meant with my comment is something like the following:</p>\n\n<p>Use the set of parsed data structures you have and simplify them a bit (e.g. with regexes)</p>\n\n<pre><code>Triple \"https://h4ck3rm1k3.github.io/gogccintro/gcc/ontology/2017/05/20/gcc_compiler.owl#4707\" \"https://h4ck3rm1k3.github.io/gogccintro/gcc/ontology/2017/05/20/gcc_compiler.owl#op_0\" \"https://h4ck3rm1k3.github.io/gogccintro/gcc/ontology/2017/05/20/gcc_compiler.owl#4777\"\nTriple \"https://h4ck3rm1k3.github.io/gogccintro/gcc/ontology/2017/05/20/gcc_compiler.owl#4707\" \"https://h4ck3rm1k3.github.io/gogccintro/gcc/ontology/2017/05/20/gcc_compiler.owl#type\" \"https://h4ck3rm1k3.github.io/gogccintro/gcc/ontology/2017/05/20/gcc_compiler.owl#4776\"\nTriple \"https://h4ck3rm1k3.github.io/gogccintro/gcc/ontology/2017/05/20/gcc_compiler.owl#4707\" \"http://www.w3.org/1999/02/22-rdf-syntax-ns#type\" \"https://h4ck3rm1k3.github.io/gogccintro/gcc/ontology/2017/05/20/gcc_compiler.owl#addr_expr\"\nTriple \"https://h4ck3rm1k3.github.io/gogccintro/gcc/ontology/2017/05/20/gcc_compiler.owl#4707\" \"http://www.w3.org/1999/02/22-rdf-syntax-ns#type\" \"http://www.w3.org/2002/07/owl#NamedIndividual\"\nTriple \"https://h4ck3rm1k3.github.io/gogccintro/gcc/ontology/2017/05/20/gcc_compiler.owl#4706\" \"https://h4ck3rm1k3.github.io/gogccintro/gcc/ontology/2017/05/20/gcc_compiler.owl#op_0\" \"https://h4ck3rm1k3.github.io/gogccintro/gcc/ontology/2017/05/20/gcc_compiler.owl#5578\"\nTriple \"https://h4ck3rm1k3.github.io/gogccintro/gcc/ontology/2017/05/20/gcc_compiler.owl#4706\" \"https://h4ck3rm1k3.github.io/gogccintro/gcc/ontology/2017/05/20/gcc_compiler.owl#type\" \"https://h4ck3rm1k3.github.io/gogccintro/gcc/ontology/2017/05/20/gcc_compiler.owl#40\"\nTriple \"https://h4ck3rm1k3.github.io/gogccintro/gcc/ontology/2017/05/20/gcc_compiler.owl#4706\" \"http://www.w3.org/1999/02/22-rdf-syntax-ns#type\" \"https://h4ck3rm1k3.github.io/gogccintro/gcc/ontology/2017/05/20/gcc_compiler.owl#nop_expr\"\nTriple \"https://h4ck3rm1k3.github.io/gogccintro/gcc/ontology/2017/05/20/gcc_compiler.owl#4706\" \"http://www.w3.org/1999/02/22-rdf-syntax-ns#type\" \"http://www.w3.org/2002/07/owl#NamedIndividual\"\nTriple \"https://h4ck3rm1k3.github.io/gogccintro/gcc/ontology/2017/05/20/gcc_compiler.owl#4705\" \"https://h4ck3rm1k3.github.io/gogccintro/gcc/ontology/2017/05/20/gcc_compiler.owl#int\" LNode plainl2 \"619\"\nTriple \"https://h4ck3rm1k3.github.io/gogccintro/gcc/ontology/2017/05/20/gcc_compiler.owl#4705\" \"https://h4ck3rm1k3.github.io/gogccintro/gcc/ontology/2017/05/20/gcc_compiler.owl#type\" \"https://h4ck3rm1k3.github.io/gogccintro/gcc/ontology/2017/05/20/gcc_compiler.owl#93\"\nTriple \"https://h4ck3rm1k3.github.io/gogccintro/gcc/ontology/2017/05/20/gcc_compiler.owl#4705\" \"http://www.w3.org/1999/02/22-rdf-syntax-ns#type\" \"https://h4ck3rm1k3.github.io/gogccintro/gcc/ontology/2017/05/20/gcc_compiler.owl#integer_cst\"\nTriple \"https://h4ck3rm1k3.github.io/gogccintro/gcc/ontology/2017/05/20/gcc_compiler.owl#4705\" \"http://www.w3.org/1999/02/22-rdf-syntax-ns#type\" \"http://www.w3.org/2002/07/owl#NamedIndividual\"\nTriple \"https://h4ck3rm1k3.github.io/gogccintro/gcc/ontology/2017/05/20/gcc_compiler.owl#4704\" \"https://h4ck3rm1k3.github.io/gogccintro/gcc/ontology/2017/05/20/gcc_compiler.owl#op_0\" \"https://h4ck3rm1k3.github.io/gogccintro/gcc/ontology/2017/05/20/gcc_compiler.owl#5577\"\n</code></pre>\n\n<p>Then write a small parser for your testdata (i know this is incomplete and you might have to tweak this code snippet)</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main  where\n\nimport Control.Monad (void)\nimport qualified Data.Text as T\nimport Data.Text (Text)\nimport Data.Attoparsec.Text as AT\nimport qualified Data.Text.IO as TIO\n\ndata Triple = Triple Text Text Text\n\ntriple :: Parser Triple\ntriple = do void $ string \"Triple\"\n            skipSpace\n            let entry = char '\"' *&gt; AT.takeWhile (/= '\"') &lt;* char '\"'\n            a &lt;- entry\n            skipSpace\n            b &lt;- entry\n            skipSpace\n            c &lt;- entry\n            return $ Triple a b c\n\n\nmain :: IO ()\nmain = do triples &lt;- map (parseOnly triple) . T.lines &lt;$&gt; TIO.readFile \"Libdata.hs\"\n          print $ length [x | Right x &lt;- triples]\n</code></pre>\n\n<p>this script runs with <code>stack runhaskell Main.hs</code> in a bit more than a second - fast enough to use it in say automated testing at each save.</p>\n\n<h2>A thorough solution</h2>\n\n<p>When reading your comments - I think this is somewhat of an XY problem - you want to put data inside your application (I guess for test purposes) because rdf4h is too slow. Taking a glance at the library - it uses parsec - whereas attoparsec would be faster. Saying this I see that you have already filed an issue at github.</p>\n\n<p>What you could also do is clone the git-repo - add a automatic read instance and <code>read</code> the data structure you have successfully parsed and <code>show</code>n.</p>\n"}, {"tags": [], "owner": {"reputation": 1970, "user_id": 782168, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ca858ed75c3e3abbb28eadadba9ee5db?s=128&d=identicon&r=PG", "display_name": "h4ck3rm1k3", "link": "https://stackoverflow.com/users/782168/h4ck3rm1k3"}, "is_accepted": true, "score": 0, "last_activity_date": 1507622179, "creation_date": 1507622179, "answer_id": 46661409, "question_id": 46632135, "link": "https://stackoverflow.com/questions/46632135/how-to-best-workaround-haskell-8-03-ghci-getlabelbc-ran-out-of-labels/46661409#46661409", "title": "How to best workaround Haskell 8.03 GHCI getLabelBc: Ran out of labels?", "body": "<p>According to the development team (see bug report <a href=\"https://ghc.haskell.org/trac/ghc/ticket/14334#comment:8\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/14334#comment:8</a>) the issue is due to 16 bit label addresses on the module level, the workaround is to split up the code into multiple modules.</p>\n"}], "owner": {"reputation": 1970, "user_id": 782168, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ca858ed75c3e3abbb28eadadba9ee5db?s=128&d=identicon&r=PG", "display_name": "h4ck3rm1k3", "link": "https://stackoverflow.com/users/782168/h4ck3rm1k3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 1, "accepted_answer_id": 46661409, "answer_count": 2, "score": -1, "last_activity_date": 1507622179, "creation_date": 1507472521, "last_edit_date": 1507477091, "question_id": 46632135, "link": "https://stackoverflow.com/questions/46632135/how-to-best-workaround-haskell-8-03-ghci-getlabelbc-ran-out-of-labels", "title": "How to best workaround Haskell 8.03 GHCI getLabelBc: Ran out of labels?", "body": "<p>What is the cause of this error and how can I get around it? I have reduced the size of the static data as a workaround but is there any way to create static data in haskell that does not run into this error? Basically I want to create large lists of objects that are compiled in and not loaded from file.</p>\n\n<p>Reported here <a href=\"https://ghc.haskell.org/trac/ghc/ticket/14334\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/14334</a></p>\n\n<p>Compiling this project file here that is basically a large data object emitted from the rdf4h lib. I wanted to put the data into static space to improve load times and remove IO.</p>\n\n<p>\u200b<a href=\"https://github.com/h4ck3rm1k3/gcc-haskell/blob/master/src/LibData.hs\" rel=\"nofollow noreferrer\">https://github.com/h4ck3rm1k3/gcc-haskell/blob/master/src/LibData.hs</a></p>\n\n<p><code>\nstack ghci\n</code></p>\n\n<pre><code>gcc-haskell Using main module: 1. Package `gcc-haskell' component exe:gcc-haskell-exe with main-is file: /home/mdupont/experiments/g\\ cc-haskell/gcc-haskell/app/Main.hs GHCi, version 8.0.2: http://www.haskell.org/ghc/ :? for help [1 of 3] Compiling LibData ( LibData.hs, interpreted ) ghc: panic! (the 'impossible' happened)\n\n(GHC version 8.0.2 for x86_64-unknown-linux):\n\ngetLabelBc: Ran out of labels\n\nPlease report this as a GHC bug: http://www.haskell.org/ghc/reportabug\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 7, "creation_date": 1507467036, "post_id": 46631242, "comment_id": 80211927, "body": "The <a href=\"http://hackage.haskell.org/package/mtl/docs/Control-Monad-Reader.html\" rel=\"nofollow noreferrer\">Reader monad</a> is basically just a newtype wrapper around <code>(-&gt;)</code>."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1507468042, "post_id": 46631242, "comment_id": 80212230, "body": "I use them all the time. Probably you do it yourself without knowing: <code>.</code> is just <code>fmap</code>."}, {"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1507468459, "post_id": 46631242, "comment_id": 80212361, "body": "@Bergi: sure, I guess the question is why use them instead of just using (.)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 2, "creation_date": 1507471933, "post_id": 46631242, "comment_id": 80213374, "body": "@Bergi Composition exists independently of the <code>Functor</code> instance; it is more accurate to say that <code>fmap</code> is just <code>.</code>."}], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 4, "last_activity_date": 1507473077, "creation_date": 1507473077, "answer_id": 46632228, "question_id": 46631242, "link": "https://stackoverflow.com/questions/46631242/use-cases-for-functor-applicative-monad-instances-for-functions/46632228#46632228", "title": "Use cases for functor/applicative/monad instances for functions", "body": "<p>Sometimes you want to treat functions of the form <code>a -&gt; m b</code> (where <code>m</code> is an <code>Applicative</code>) as <code>Applicative</code>s themselves. This often happens when writing validators, or parsers.</p>\n\n<p>One way to do this is to use <code>Data.Functor.Compose</code>, which piggybacks on the <code>Applicative</code> instances of <code>(-&gt;) a</code> and <code>m</code> to give an <code>Applicative</code> instance for the composition:</p>\n\n<pre><code>import Control.Applicative\nimport Data.Functor.Compose\n\ntype Star m a b = Compose ((-&gt;) a) m b\n\nreadPrompt :: Star IO String Int\nreadPrompt = Compose $ \\prompt -&gt; do\n    putStrLn $ prompt ++ \":\"\n    readLn\n\nmain :: IO ()\nmain = do\n    r &lt;- getCompose (liftA2 (,) readPrompt readPrompt) \"write number\"\n    print r\n</code></pre>\n\n<p>There are other ways, like creating your own newtype, or using <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Control-Applicative.html#t:WrappedArrow\" rel=\"nofollow noreferrer\">ready-made</a> <a href=\"http://hackage.haskell.org/package/profunctors-5.2.1/docs/Data-Profunctor.html#t:Star\" rel=\"nofollow noreferrer\">newtypes</a> from <em>base</em> or other libraries.</p>\n"}, {"comments": [{"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "edited": false, "score": 0, "creation_date": 1507671054, "post_id": 46633372, "comment_id": 80300994, "body": "Thanks for the input. So the 5-tuple example you posted. It can be rewritten as <code>(\\x -&gt; (x+2, x*2, x+1, x-3, x&#47;2)) 10</code> -- the advantage of the applicative here is that there&#39;s no need to repeat <code>x</code>?"}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "reply_to_user": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "edited": false, "score": 0, "creation_date": 1507671819, "post_id": 46633372, "comment_id": 80301325, "body": "@Eli Bendersky The main difference is, in the applicative form if you know how many parameters the main function takes, the whole thing is functionally decomposable (that you can dynamically compose the parameters the way you like) while in lambda form you have to have a solid lambda function at hand."}, {"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "edited": false, "score": 0, "creation_date": 1507672070, "post_id": 46633372, "comment_id": 80301402, "body": "are you saying that we already have a function, like <code>(,,,,)</code> and don&#39;t have to write the lambda by hand?"}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "reply_to_user": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "edited": false, "score": 0, "creation_date": 1507672344, "post_id": 46633372, "comment_id": 80301514, "body": "@Eli Bendersky Yes... This whole thing might be another function definition which takes the applying functions <code>(+2)</code>, (*2), (+1), (subtract 3) and (/2)` as parameters and you may replace <code>subtract 3</code> with <code>subtract 1</code> and apply it."}, {"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "edited": false, "score": 0, "creation_date": 1507672415, "post_id": 46633372, "comment_id": 80301540, "body": "I guess I can sort-of see what you are trying to say, but it&#39;s hard for me to envision without a concrete use case :)"}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "reply_to_user": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "edited": false, "score": 0, "creation_date": 1507672867, "post_id": 46633372, "comment_id": 80301749, "body": "@Eli Bendersky I mean the lambda function <code>(\\x -&gt; (x+2, x*2, x+1, x-3, x&#47;2))</code> would be hard wired while in applicative style it wouldn&#39;t. One can make up a new function with the applicative one to change the &quot;mapping&quot; functions dynamically. A concrete use case... is hard to come up with spontaneously but this is a good knowledge to have in mind."}], "tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 7, "last_activity_date": 1507504168, "last_edit_date": 1507504168, "creation_date": 1507480020, "answer_id": 46633372, "question_id": 46631242, "link": "https://stackoverflow.com/questions/46631242/use-cases-for-functor-applicative-monad-instances-for-functions/46633372#46633372", "title": "Use cases for functor/applicative/monad instances for functions", "body": "<p>A common pattern that involves Functor and Applicative instances of functions is for example <code>(+) &lt;$&gt; (*2) &lt;*&gt; (subtract 1)</code>. This is particularly useful when you have to feed a series of function with a single value. In this case the above is equivalent to <code>\\x -&gt; (x * 2) + (x - 1)</code>. While this is very close to <code>LiftA2</code> you may extend this pattern indefinitely. If you have an f function to take 5 parameters like <code>a -&gt; a -&gt; a -&gt; a -&gt; a -&gt; b</code> you may do like <code>f &lt;$&gt; (+2) &lt;*&gt; (*2) &lt;*&gt; (+1) &lt;*&gt; (subtract 3) &lt;*&gt; (/2)</code> and feed it with a single value. Just like in below case ;</p>\n\n<pre><code>Prelude&gt; (,,,,) &lt;$&gt; (+2) &lt;*&gt; (*2) &lt;*&gt; (+1) &lt;*&gt; (subtract 3) &lt;*&gt; (/2) $ 10\n(12.0,20.0,11.0,7.0,5.0)\n</code></pre>\n\n<p><strong>Edit:</strong> Credit for a re-comment of @Will Ness for a comment of mine under another topic, here comes a beautiful usage of applicative over functions;</p>\n\n<pre><code>Prelude&gt; let isAscending = and . (zipWith (&lt;=) &lt;*&gt; drop 1)\nPrelude&gt; isAscending [1,2,3,4]\nTrue\nPrelude&gt; isAscending [1,2,5,4]\nFalse\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 131, "user_id": 8772291, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6288a2cbf5628262c2977ab6b53edad6?s=128&d=identicon&r=PG&f=1", "display_name": "enolive", "link": "https://stackoverflow.com/users/8772291/enolive"}, "is_accepted": false, "score": 0, "last_activity_date": 1546441366, "creation_date": 1546441366, "answer_id": 54008580, "question_id": 46631242, "link": "https://stackoverflow.com/questions/46631242/use-cases-for-functor-applicative-monad-instances-for-functions/54008580#54008580", "title": "Use cases for functor/applicative/monad instances for functions", "body": "<p>here an application of the bind function that I used for solving the Diamond Kata. Take a simple function that mirrors its input discarding the last element</p>\n\n<pre><code>mirror :: [a] -&gt; [a]\nmirror xs = xs ++ (reverse . init) xs\n</code></pre>\n\n<p>let's rewrite it a bit</p>\n\n<pre><code>mirror xs = (++) xs ((reverse . init) xs)\nmirror xs = flip (++) ((reverse . init) xs) xs\nmirror xs = (reverse . init &gt;&gt;= flip (++)) xs\nmirror = reverse . init &gt;&gt;= flip (++)\n</code></pre>\n\n<p>Here is my complete implementation of this Kata: <a href=\"https://github.com/enolive/exercism/blob/master/haskell/diamond/src/Diamond.hs\" rel=\"nofollow noreferrer\">https://github.com/enolive/exercism/blob/master/haskell/diamond/src/Diamond.hs</a></p>\n"}], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 751, "favorite_count": 8, "answer_count": 3, "score": 18, "last_activity_date": 1546441366, "creation_date": 1507466682, "question_id": 46631242, "link": "https://stackoverflow.com/questions/46631242/use-cases-for-functor-applicative-monad-instances-for-functions", "title": "Use cases for functor/applicative/monad instances for functions", "body": "<p>Haskell has <code>Functor</code>, <code>Applicative</code> and <code>Monad</code> instances defined for functions (specifically the partially applied type <code>(-&gt;) a</code>) in the standard library, built around function composition.</p>\n\n<p>Understanding these instances is a nice mind-bender exercise, but my question here is about the practical uses of these instances. I'd be happy to hear about realistic scenarios where folks used these for some practical code.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 107, "user_id": 6733941, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6d4d63e1387ef860016b1daf45b62f20?s=128&d=identicon&r=PG&f=1", "display_name": "DoeMoeJoe", "link": "https://stackoverflow.com/users/6733941/doemoejoe"}, "edited": false, "score": 1, "creation_date": 1507466178, "post_id": 46631146, "comment_id": 80211731, "body": "Thank you! I understand what&#39;s happening in your two solutions and I see that they work. However, could you address my question about why I can&#39;t use <code>fmap</code> as I tried to? I really want to understand why it doesn&#39;t work."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 4, "last_activity_date": 1507466860, "last_edit_date": 1507466860, "creation_date": 1507466048, "answer_id": 46631146, "question_id": 46631082, "link": "https://stackoverflow.com/questions/46631082/how-to-concatenate-a-value-to-a-list-when-both-are-inside-maybes/46631146#46631146", "title": "How to concatenate a value to a list when both are inside Maybes?", "body": "<h1>Simple solution</h1>\n\n<p>I think you make things too hard/complex. You can simply consider two cases:</p>\n\n<ol>\n<li>the empty list, in which case you return a <code>Nothing</code>; and</li>\n<li>the non-empty list, in which case you can use the old init:</li>\n</ol>\n\n<p>Or putting it into code:</p>\n\n<pre><code>mySafeInit :: [a] -&gt; Maybe [a]\nmySafeInit [] = Nothing\nmySafeInit l = Just (init l)\n</code></pre>\n\n<p>Now of course we have to trust that there are only two constructors for a list; and that <code>init</code> will only error when we provide it an empty list. Both assumptions hold, but can (although very unlikely) change in the future.</p>\n\n<p>We can however use our own <code>init</code> function:</p>\n\n<pre><code>mySafeInit :: [a] -&gt; Maybe [a]\nmySafeInit [] = Nothing\nmySafeInit (l:ls) = Just (init l ls)\n    where init _ [] = []\n          init x (x2:xs) = x : init x2 xs\n</code></pre>\n\n<p>Now the Haskell compiler can verify that both functions are <em>syntactically</em> total. Note that functions can be total, but not syntactically: for instance because we can make assumptions regarding the structure of the data that the compiler can not check.</p>\n\n<h1>Working with <code>fmap</code></h1>\n\n<p>You provide a solution like:</p>\n\n<pre><code>-- ...\nmySafeInit (x:xs) =  fmap (:) (Just x) &lt;*&gt; (mySafeInit xs)\n</code></pre>\n\n<p>A first aspect we have to understand is that <code>Maybe</code> is a <code>Functor</code>. A <code>Fuctor</code> supports a function <code>fmap</code> where we map the item(s) inside the functor so to speak. For instance a list is a functor as well, and we can thus map all elements in the list with <code>fmap f somelist</code>. You can see <code>Maybe</code> as some sort of list with zero elements (the <code>Nothing</code>) or one element (the <code>Just x</code>). So in case we perform <code>fmap</code> on a <code>Nothing</code>, we get a <code>Nothing</code> back, in case we perform this on a <code>Just x</code>, we get <code>Just (f x)</code>.</p>\n\n<p>Here we see <code>fmap (:) (Just x)</code>. Since we thus apply it on a <code>Just x</code>, we have actually constructed:</p>\n\n<pre><code>   fmap (:) Just x\n-&gt; Just ((x :))\n</code></pre>\n\n<p>This is thus a <code>Just</code>, but it carries a <em>function</em> <code>(x : )</code>, not a value.</p>\n\n<p>Next we see a <code>&lt;*&gt;</code> operator. <code>(&lt;*&gt;) :: Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b</code> is some sort of \"multiplication\" over an <code>Applicative</code> (a <code>Maybe</code> is an applicative as well). On the left side we have an applicative of functions <code>a -&gt; b</code>, on the right side an applicative of <code>a</code>s. The result is an applicative of <code>b</code>s: for every tuple of functions and values.</p>\n\n<p>In case we perform this on a list, we thus obtain a list that starts with the values all applied to the first function, then all values applied to the second function, etc.</p>\n\n<p>For a <code>Maybe</code> we thus have a <code>Maybe (a -&gt; b)</code> left and a <code>Maybe a</code> on the right. In case these are of the form <code>Just f</code> and <code>Just x</code>, we obtain <code>Just (f x)</code>, in all other cases we obtain <code>Nothing</code>.</p>\n\n<p>Since we perform a recursive call on <code>mySafeInit xs</code>, we thus obtain the <code>init</code> of the remaining list wrapped in a <code>Just</code>. In that case, we thus prepend that result with <code>xs</code>.</p>\n\n<p>An equivalent code definition is thus:</p>\n\n<pre><code>mySafeInit :: [a] -&gt; Maybe [a]\nmySafeInit [] = Nothing\nmySafeInit (_:[]) = Just []\nmySafeInit (x:xs) | Just ys &lt;- mySafeInit xs = Just (x:ys)\n                  | otherwise = Nothing\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 8, "last_activity_date": 1507466567, "creation_date": 1507466567, "answer_id": 46631227, "question_id": 46631082, "link": "https://stackoverflow.com/questions/46631082/how-to-concatenate-a-value-to-a-list-when-both-are-inside-maybes/46631227#46631227", "title": "How to concatenate a value to a list when both are inside Maybes?", "body": "<p>Let's look at</p>\n\n<pre><code>fmap (:) (Just x) (mySafeInit xs)\n</code></pre>\n\n<p>For <code>Maybe</code>, <code>fmap</code> is defined as</p>\n\n<pre><code>fmap _ Nothing = Nothing\nfmap f (Just x) = Just (f x)\n</code></pre>\n\n<p>Therefore</p>\n\n<pre><code>fmap (:) (Just x)\n</code></pre>\n\n<p>is</p>\n\n<pre><code>Just ((:) x)\n</code></pre>\n\n<p>Note that this is not a function; it's a <code>Maybe</code> value of some type (in fact, it's <code>Maybe ([a] -&gt; [a])</code>). That's why</p>\n\n<pre><code>(Just ((:) x)) (mySafeInit xs)\n</code></pre>\n\n<p>is a type error (you can only apply functions).</p>\n\n<p>In the second version of your code, you did</p>\n\n<pre><code>fmap (:) (Just x) &lt;*&gt; (mySafeInit xs)\n</code></pre>\n\n<p>, which is</p>\n\n<pre><code>(Just ((:) x)) &lt;*&gt; (mySafeInit xs)\n</code></pre>\n\n<p>Looking at the type of <code>&lt;*&gt;</code>, we get:</p>\n\n<pre><code>(&lt;*&gt;) :: (Applicative f) =&gt; f (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>Here <code>f</code> is <code>Maybe</code>, and <code>a</code> and <code>b</code> are both <code>[a]</code>:</p>\n\n<pre><code>(&lt;*&gt;) :: Maybe ([a] -&gt; [a]) -&gt; Maybe [a] -&gt; Maybe [a]\n</code></pre>\n\n<p>That's why this version checks out.</p>\n\n<blockquote>\n  <p>Shouldn't I be able to use <code>fmap</code>, give it the function <code>(:)</code> and my two maybes, and get a <code>Just [a]</code> back?</p>\n</blockquote>\n\n<p>No, because <code>fmap</code> only works with functions of one argument. There is another function for two arguments, though:</p>\n\n<pre><code>liftA2 :: (Applicative f) =&gt; (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c\n</code></pre>\n\n<p>Contrast with</p>\n\n<pre><code>fmap :: (Functor f) =&gt; (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p><code>liftA2 (:) (Just x) (mySafeInit xs)</code> should indeed work.</p>\n\n<p>But it's needlessly complicated because one of your maybes is artificial: You explicitly wrapped your <code>x</code> in <code>Just</code>. You can simply do this instead:</p>\n\n<pre><code>fmap ((:) x) (mySafeInit xs)\n</code></pre>\n\n<p>By the definition of <code>fmap</code>, this is either <code>Nothing</code> (if <code>mySafeInit xs</code> is <code>Nothing</code>) or <code>Just ((:) x y)</code> (if <code>mySafeInit xs</code> is <code>Just y</code>).</p>\n"}], "owner": {"reputation": 107, "user_id": 6733941, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6d4d63e1387ef860016b1daf45b62f20?s=128&d=identicon&r=PG&f=1", "display_name": "DoeMoeJoe", "link": "https://stackoverflow.com/users/6733941/doemoejoe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1236, "favorite_count": 0, "accepted_answer_id": 46631227, "answer_count": 2, "score": 1, "last_activity_date": 1507466860, "creation_date": 1507465532, "question_id": 46631082, "link": "https://stackoverflow.com/questions/46631082/how-to-concatenate-a-value-to-a-list-when-both-are-inside-maybes", "title": "How to concatenate a value to a list when both are inside Maybes?", "body": "<p>I'm reading realworldhaskell and I've come to <a href=\"http://book.realworldhaskell.org/read/functional-programming.html\" rel=\"nofollow noreferrer\">chapter 4</a> where the book talks about \"Safely and sanely working with crashy functions\". I'm trying to write a safe version of <code>init :: [a] -&gt; [a]</code>. This is as far as I got:</p>\n\n<pre><code>mySafeInit :: [a] -&gt; Maybe [a]\nmySafeInit [] = Nothing\nmySafeInit (_:[]) = Just []\nmySafeInit (x:xs) =  ???\n</code></pre>\n\n<p>I get that I can't do something like <code>x : mySafeInit xs</code>, because that would be like doing <code>a : Just [a]</code> (right?). I've read about <code>fmap</code> though, so I tried this:</p>\n\n<pre><code>mySafeInit :: [a] -&gt; Maybe [a]\nmySafeInit [] = Nothing\nmySafeInit (_:[]) = Just []\nmySafeInit (x:xs) =  fmap (:) (Just x) (mySafeInit xs)\n</code></pre>\n\n<p>Well that's guaranteed to work, right? Well no, and I'm struggling to understand why. Here I have a <code>Just a</code> and a <code>Just [a]</code>, right? Shouldn't I be able to use <code>fmap</code>, give it the function <code>(:)</code> and my two maybes, and get a <code>Just [a]</code> back?</p>\n\n<p>After some googling I did figure out that this works:</p>\n\n<pre><code>mySafeInit :: [a] -&gt; Maybe [a]\nmySafeInit [] = Nothing\nmySafeInit (_:[]) = Just []\nmySafeInit (x:xs) =  fmap (:) (Just x) &lt;*&gt; (mySafeInit xs)\n</code></pre>\n\n<p>but I don't understand why. Could someone walk me through this? :)</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "edited": false, "score": 0, "creation_date": 1507460451, "post_id": 46630242, "comment_id": 80210224, "body": "if the <code>position</code> is less than the length of the list, it returns the element at the position, but what the function should return if the position is bigger than the length?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1507461327, "post_id": 46630242, "comment_id": 80210472, "body": "What you here want is a guard, not a <code>where</code>."}, {"owner": {"reputation": 287, "user_id": 8738033, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/1944285682265003/picture?type=large", "display_name": "Joao Parente", "link": "https://stackoverflow.com/users/8738033/joao-parente"}, "edited": false, "score": 0, "creation_date": 1507462958, "post_id": 46630242, "comment_id": 80210879, "body": "how can i use the guard? if the position is bigger than the lenght it should not be possible"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1507464848, "post_id": 46630242, "comment_id": 80211375, "body": "I would recommend 1) to avoid using <code>a</code> for both the name of a <i>type</i>, and an element of your list, and 2) to avoid using <code>[a]</code> in <code>localiza [a] 0 =...</code> unless you really mean that such equation only applies to lists of length one. In types, <code>[a]</code> is the type of a list with zero or more elements. In values, and patterns, <code>[a]</code> is a list whose length is exactly one. You likely want something like <code>localiza (x:rest) 0 = x</code>."}], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 3, "last_activity_date": 1507460653, "creation_date": 1507460653, "answer_id": 46630367, "question_id": 46630242, "link": "https://stackoverflow.com/questions/46630242/where-can-i-use-where/46630367#46630367", "title": "Where can I use where?", "body": "<p>In Haskell <code>where</code> introduces a set of local definitions. It can be attached to any definition to define variables that are local to that definition. So the problem in your code is not where you use <code>where</code>, it's what you use it for.</p>\n\n<p>You're not trying to define local variables, you're trying to add a condition to your pattern. For that you use pattern guards, which have the syntax <code>pattern | boolean-condition</code>, i.e. <code>localiza (a:as) b | b &lt; length as = ...</code>.</p>\n\n<p>That said, this isn't really a good way to do this. <code>length</code> is an O(n) operation, so checking the length at each step of the iteration wastes a lot of time. Instead you could just catch the case when the list becomes empty, which will only happen if the index was out of bounds.</p>\n"}, {"tags": [], "owner": {"reputation": 3, "user_id": 8711828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e387dcd3e63fc165247b81cfa2ade2de?s=128&d=identicon&r=PG&f=1", "display_name": "Leif Metcalf", "link": "https://stackoverflow.com/users/8711828/leif-metcalf"}, "is_accepted": false, "score": 0, "last_activity_date": 1507493052, "creation_date": 1507493052, "answer_id": 46635491, "question_id": 46630242, "link": "https://stackoverflow.com/questions/46630242/where-can-i-use-where/46635491#46635491", "title": "Where can I use where?", "body": "<p>I'm going to give this example from the Haskell wiki.</p>\n\n<pre><code>elementAt' (x:_) 1  = x\nelementAt' [] _     = error \"Index out of bounds\"\nelementAt' (_:xs) k\n  | k &lt; 1           = error \"Index out of bounds\"\n  | otherwise       = elementAt' xs (k - 1)\n</code></pre>\n\n<p>This does not check the length so often, only exiting when the list becomes empty.</p>\n"}], "owner": {"reputation": 287, "user_id": 8738033, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/1944285682265003/picture?type=large", "display_name": "Joao Parente", "link": "https://stackoverflow.com/users/8738033/joao-parente"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 46630367, "answer_count": 2, "score": 0, "last_activity_date": 1507493052, "creation_date": 1507459787, "last_edit_date": 1507464914, "question_id": 46630242, "link": "https://stackoverflow.com/questions/46630242/where-can-i-use-where", "title": "Where can I use where?", "body": "<p>Well, i had to do this function that, given a list and a number, it returns the element of the list in the position of number (being first position 0)</p>\n\n<p>basically its the function <code>(!!)</code>. The problem that I face is that I need to restrict to this function , case the position given is bigger than the positions in the list, i tried to use a        when but it doesn't work, it shows this error:</p>\n\n<pre><code>parse error on input `where'\n</code></pre>\n\n<p>Can I use a <code>where</code> here? in which situations can i use a <code>where</code>?</p>\n\n<pre><code>localiza:: [a]-&gt;Int-&gt;a\n\nlocaliza [a] 0 = a\nlocaliza (a:as) b  = localiza (as) (b-1) \n                     where b+1 &lt;= length(a)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 3, "creation_date": 1507453705, "post_id": 46629346, "comment_id": 80208452, "body": "Have you tried?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1507454112, "post_id": 46629346, "comment_id": 80208580, "body": "No lists have two forms <code>(a:[a])</code> and <code>[]</code>."}, {"owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "edited": false, "score": 2, "creation_date": 1507454759, "post_id": 46629346, "comment_id": 80208733, "body": "It&#39;s not clear to me what your aim is. It might be clearer to give some example inputs/outputs of the function(s) you are trying to write."}, {"owner": {"reputation": 287, "user_id": 8738033, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/1944285682265003/picture?type=large", "display_name": "Joao Parente", "link": "https://stackoverflow.com/users/8738033/joao-parente"}, "edited": false, "score": 0, "creation_date": 1507457462, "post_id": 46629346, "comment_id": 80209444, "body": "im recreating the function reverse"}, {"owner": {"reputation": 287, "user_id": 8738033, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/1944285682265003/picture?type=large", "display_name": "Joao Parente", "link": "https://stackoverflow.com/users/8738033/joao-parente"}, "edited": false, "score": 0, "creation_date": 1507457582, "post_id": 46629346, "comment_id": 80209482, "body": "1 thing that i dint understand, so i did  inverte::[a]-&gt;[a] inverte [] =[] inverte (a:as) = inverte(as) ++ [a], and it works but the function didint read a ? when its suposed to only read [a] , isnt the function mixing types?"}, {"owner": {"reputation": 649, "user_id": 2998746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fc15b842026d8a039ffdd1b2a528aec?s=128&d=identicon&r=PG&f=1", "display_name": "Euge", "link": "https://stackoverflow.com/users/2998746/euge"}, "edited": false, "score": 1, "creation_date": 1507487488, "post_id": 46629346, "comment_id": 80218459, "body": "(a:as) is not a type. Using the same letter for type variable and values of a given type can be confusing. When you say <code>inverte::[a]-&gt;[a]</code>, <code>a</code> is a type, you say that <code>inverte</code> takes a list of elements of any type <code>a</code> and returns a list of elements of the same given type <code>a</code>. For the next two sentences you are saying how the functions works on empty lists <code>[]</code> and on lists of at least one element <code>(a:as)</code>. In this case, <code>a</code> is an <i>element of type</i> <code>a</code>"}], "answers": [{"tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": false, "score": 0, "last_activity_date": 1507454796, "creation_date": 1507454796, "answer_id": 46629540, "question_id": 46629346, "link": "https://stackoverflow.com/questions/46629346/does-haskell-let-me-mix-types-of-lists/46629540#46629540", "title": "Does haskell let me mix types of lists?", "body": "<p>That will fail. I'm going to rewrite your last line using different variable names for clarity:</p>\n\n<pre><code>inverte (x:xs) = (xs:x)\n</code></pre>\n\n<p>The variable <code>x</code> is of type <code>a</code>, but the variable <code>xs</code> is of type <code>[a]</code> (i.e. a list of <code>a</code>. The <code>:</code> operator requires its first argument to be an element and its second to be a list of the same type. So swapping them over won't work. </p>\n\n<p>A legal (but slow) way is to say <code>xs ++ [x]</code>. You might also want to look at <a href=\"https://stackoverflow.com/questions/26847192/reverse-a-list-in-haskell\">this answer to a similar question</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 287, "user_id": 8738033, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/1944285682265003/picture?type=large", "display_name": "Joao Parente", "link": "https://stackoverflow.com/users/8738033/joao-parente"}, "edited": false, "score": 0, "creation_date": 1507457352, "post_id": 46629588, "comment_id": 80209422, "body": "1 thing that i dint understand, so i did  inverte::[a]-&gt;[a] inverte [] =[] inverte (a:as) = inverte(as) ++ [a], and it works but the function didint read a ? when its suposed to only read [a] , isnt the function mixing types?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 287, "user_id": 8738033, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/1944285682265003/picture?type=large", "display_name": "Joao Parente", "link": "https://stackoverflow.com/users/8738033/joao-parente"}, "edited": false, "score": 1, "creation_date": 1507458871, "post_id": 46629588, "comment_id": 80209807, "body": "I don&#39;t know what you mean by &quot;read [a]&quot; - if you mean the case of <code>inverte [x] = [x]</code> it is a special case because <code>[x]</code> is the same as <code>(x:[])</code>."}, {"owner": {"reputation": 287, "user_id": 8738033, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/1944285682265003/picture?type=large", "display_name": "Joao Parente", "link": "https://stackoverflow.com/users/8738033/joao-parente"}, "edited": false, "score": 0, "creation_date": 1507459361, "post_id": 46629588, "comment_id": 80209940, "body": "in inverte(a:as) = inverte(as) ++[a]  , he reads (a:as) when the type is [a]-&gt;[a]"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 287, "user_id": 8738033, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/1944285682265003/picture?type=large", "display_name": "Joao Parente", "link": "https://stackoverflow.com/users/8738033/joao-parente"}, "edited": false, "score": 2, "creation_date": 1507461393, "post_id": 46629588, "comment_id": 80210490, "body": "i think you have a bit of misunderstanding what function definition in haskell is - so I would recommend reading a chapter or more of <a href=\"http://learnyouahaskell.com/chapters\" rel=\"nofollow noreferrer\">learnyouahaskell.com/chapters</a> - you are mixing two different levels as I said - type level and value level - <code>[a]</code> is type level - whereas <code>(x:xs)</code> is value level. there is no mixing of types!"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 3, "last_activity_date": 1507455116, "creation_date": 1507455116, "answer_id": 46629588, "question_id": 46629346, "link": "https://stackoverflow.com/questions/46629346/does-haskell-let-me-mix-types-of-lists/46629588#46629588", "title": "Does haskell let me mix types of lists?", "body": "<p>No, the compiler will tell you that this is not possible!</p>\n\n<p>You are mixing up two different \"views\" of list. To make clear what I speak of let us define a different implementation of list.</p>\n\n<pre><code>data List a = Cons a (List a) | EmptyList\n\nmylist :: List Char\nmylist = Cons 'a' (Cons 'h' (Cons 'a' (Cons '!' EmptyList)))\n\noldlist :: [Char]\noldlist = 'a' : ('h' : ('a' : ('!' : [])))\n-- or\noldlist = ['a','h','a','!']\n-- alternatively you could write this as\noldlist = \"aha!\"\n-- because `String` is just a list of `Char`.\n</code></pre>\n\n<p>On the left hand side you write what new data type you define and on the right hand side there are all the operators you provide to construct such a type or to pattern match in a function definition.</p>\n\n<p>Now back to the haskell built in list type - and to make things a bit more obvious I will call the \"value level\"-variables <code>x</code>, and the type-variables <code>a</code></p>\n\n<ul>\n<li><p><code>(x:xs)</code> and <code>[]</code> are the two pattern to match on a list, here </p>\n\n<ul>\n<li><code>(x:xs)</code> corresponds to <code>Cons x xs</code>, and</li>\n<li><code>[]</code> to <code>Emptylist</code></li>\n</ul></li>\n<li><p><code>List a</code> is the type of those expressions and corresponds to <code>[a]</code>.</p></li>\n</ul>\n\n<hr>\n\n<p>Now when you try to build your function <code>inverte</code> we have to take a closer look at <code>(x:xs)</code> - and inspect the types of the components of your pattern match as well as the right hand side in that line.</p>\n\n<pre><code>x   :: a\nxs  :: [a]\n(:) :: b -&gt; [b] -&gt; [b] -- this is how you write an operator as a function\n                       -- ps: we can name the type variables however we want ;-)\n</code></pre>\n\n<p>On the right hand side you write <code>(xs:x)</code> or <code>(:) xs x</code>\n- I hope you can see that this is a problem...</p>\n\n<h2>But how to solve this ??</h2>\n\n<p>with this <code>(:)</code> operator - sadly you cannot - but fortunately enough there is another operator that will do the trick!</p>\n\n<h2>And how do we find it??</h2>\n\n<p>I can give you hints - the operator you look for has type signature - </p>\n\n<pre><code> ?? :: [a] -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>another thing we need is to make <code>x</code> into a list - this is so easy that I will spoil the fun: just take <code>[x]</code></p>\n\n<p>To find your operator you might find <a href=\"http://hoogle.haskell.org/?hoogle=%5Ba%5D+-%3E+%5Ba%5D+-%3E+%5Ba%5D\" rel=\"nofollow noreferrer\">hoogle</a> a great help </p>\n"}], "owner": {"reputation": 287, "user_id": 8738033, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/1944285682265003/picture?type=large", "display_name": "Joao Parente", "link": "https://stackoverflow.com/users/8738033/joao-parente"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 46629588, "answer_count": 2, "score": 0, "last_activity_date": 1507458972, "creation_date": 1507453446, "last_edit_date": 1507458972, "question_id": 46629346, "link": "https://stackoverflow.com/questions/46629346/does-haskell-let-me-mix-types-of-lists", "title": "Does haskell let me mix types of lists?", "body": "<p>So I was told that list have 2 forms:</p>\n\n<ol>\n<li><p><code>(a:as)</code>, where <code>a</code> is the head and <code>as</code> is the tail</p></li>\n<li><p><code>[a]</code>, where <code>a</code> is the list</p></li>\n</ol>\n\n<p>My question here is that if the function I'm working on <code>inverte :: [a]-&gt;[a]</code></p>\n\n<p>Can I use the type <code>(a:as)</code> when I'm defining the function;</p>\n\n<p>For example</p>\n\n<pre><code>inverte::[a]-&gt;[a]\ninverte [] =[]\ninverte (a:as) = (as:a)\n</code></pre>\n"}, {"tags": ["haskell", "tree", "binary-tree", "nodes"], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 3, "last_activity_date": 1507432454, "last_edit_date": 1507432454, "creation_date": 1507431274, "answer_id": 46627106, "question_id": 46626507, "link": "https://stackoverflow.com/questions/46626507/build-a-tree-with-given-number-of-nodes/46627106#46627106", "title": "build a tree with given number of nodes", "body": "<p>The most obvious problem is in your <code>NodeTwo</code> case. You arrive at that point with a \"budget\" of <code>NodeTwo</code>s and <code>NodeOne</code>s to spend. But you tell both branches of your new tree the same thing: \"feel free to spend the whole total budget\"! Of course if they both do that, you will wind up spending double your budget.</p>\n\n<p>You need some way to negotiate a budget for each branch of the tree. There are a number of ways you could do this; for example, give one branch access to the whole budget, and give whatever is left to the second branch. Or you could decide before creating either branch how to divide the budget between them, and give each branch only a portion of your total budget.</p>\n\n<p>Either of those two approaches probably introduce some bias in your randomness, which may or may not matter to you. You should think of a way to handle the budget accounting in a way that produces the kinds of random trees you want.</p>\n\n<p>Once you've fixed this, you'll run into other problems: there are constraint sets for which it is impossible to build a tree fitting them! Most notably, if <code>maxLeaf</code> is zero, you can't create any kind of tree at all, since every tree has at least one leaf node somewhere. You'll have to be careful not to build any subtrees with too few leaves available to let them terminate.</p>\n"}], "owner": {"reputation": 73, "user_id": 8702185, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca8e5108dd07336da0fde1fdb3e856f3?s=128&d=identicon&r=PG&f=1", "display_name": "Momo", "link": "https://stackoverflow.com/users/8702185/momo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 359, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1507432454, "creation_date": 1507423365, "question_id": 46626507, "link": "https://stackoverflow.com/questions/46626507/build-a-tree-with-given-number-of-nodes", "title": "build a tree with given number of nodes", "body": "<p>I have a datastructure for a tree with nodes that have either one or two childs. I can generate a random tree with a given maximum Depth. Now I want to generate these random three with a given maximum amount of nodes (/leafes). This is my structure:</p>\n\n<pre><code>import System.Random\n\ndata Tree a = Leaf \n            | NodeTwo (Tree a) (Tree a)\n            | NodeOne (Tree a)\n            deriving (Show)\n\ncreate :: RandomGen g =&gt; Int -&gt; Int -&gt; Int -&gt; Int -&gt; g -&gt; Tree a\ncreate depth maxNodeOne maxNodeTwo maxLeaf g\n    | (depth == 0) = Leaf\n    | (x &gt;= a &amp;&amp; x &lt; c &amp;&amp; (maxNodeTwo /= 0)) \n      = let (g1, g2) = split g in \n      NodeTwo (create (depth -1) maxNodeOne (maxNodeTwo-1) \n      maxLeaf g1) (create (depth -1) maxNodeOne \n      (maxNodeTwo-1) maxLeaf g2) \n    |(x &gt;= c &amp;&amp; x &lt; 2*c &amp;&amp; (maxNodeOne /= 0))\n     = NodeOne (create  (depth -1) \n    (maxNodeOne -1) maxNodeTwo maxLeaf g')\n    | otherwise = Leaf\n    where (x, g') = next g\n          (a, b) = genRange g\n          c = (b - a) `div` 3\n\ncountFnk :: Tree a -&gt; Int             \ncountFnk (Leaf) = 0\ncountFnk (NodeOne a) = countFnk a\ncountFnk (NodeTwo a b) = 1 + countFnk a + countFnk b\n\ncountLam :: Tree a -&gt; Int             \ncountLam (Leaf) = 0\ncountLam (NodeOne a) = 1 + countLam a\ncountLam (NodeTwo a b) = countLam a + countLam b\n\ncountLeaf :: Tree a -&gt; Int             \ncountLeaf (Leaf) = 1\ncountLeaf (NodeOne a) = countLeaf a\ncountLeaf (NodeTwo a b) = countLeaf a + countLeaf b\n</code></pre>\n\n<p>This attempt fails ofcourse. I don't know how to decrement the counter(s) for the node(s) in the recursion. I also have functions which can get me the amount of nodes (/leafes) but I don't know how to use these functions in my create function since they need a finished tree to scan.\nThanks for your help.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "is_accepted": false, "score": 1, "last_activity_date": 1507435142, "creation_date": 1507435142, "answer_id": 46627376, "question_id": 46626240, "link": "https://stackoverflow.com/questions/46626240/table-summarization-haskell/46627376#46627376", "title": "Table Summarization Haskell", "body": "<p>Keep track of the summed height and count (population) for each gender separately as you go along the list, then, at the end of the list, divide the summed height by the count for each gender to get the average height for each gender:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.Ratio  ((%))\n\naverages :: [(String, Integer)] -&gt; (Rational, Rational)\naverages = go 0 0 0 0\n  where\n    rat :: Integer -&gt; Integer -&gt; Rational\n    rat 0 0 = 0\n    rat n d = n % d\n\n    go :: Integer -&gt; Integer -&gt; Integer -&gt; Integer -&gt; [(String, Integer)] -&gt; (Rational, Rational)\n    go fHeight fCount mHeight mCount [] = (rat fHeight fCount, rat mHeight mCount)\n    go fHeight fCount mHeight mCount ((\"Female\", height):xs) = go (fHeight + height) (fCount + 1) mHeight mCount xs\n    go fHeight fCount mHeight mCount ((\"Male\",   height):xs) = go fHeight fCount (mHeight + height) (mCount + 1) xs\n</code></pre>\n\n<p>This gives:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>&gt; averages [(\"Female\", 120), (\"Male\", 160), (\"Female\", 180)]\n(150 % 1,160 % 1)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 1, "last_activity_date": 1507553504, "creation_date": 1507553504, "answer_id": 46646957, "question_id": 46626240, "link": "https://stackoverflow.com/questions/46626240/table-summarization-haskell/46646957#46646957", "title": "Table Summarization Haskell", "body": "<p>You can break down this problem into two parts:</p>\n\n<ul>\n<li><p>first grouping a list of pairs <code>[(a, b)]</code> into a list of pairs <code>[(a, [b])]</code> where all the <code>(a, b)</code> with the same <code>a</code> have been gathered together.</p></li>\n<li><p>then computing the average for each list of integers</p></li>\n</ul>\n\n<p>This gives us:</p>\n\n<pre><code>module Averages where\n\nimport Data.Function\nimport Data.Ratio\nimport Data.List\n\nclasses :: Ord a =&gt; [(a, b)] -&gt; [(a, [b])]\nclasses = fmap ((,) &lt;$&gt; fst . head &lt;*&gt; fmap snd)\n        . groupBy ((==) `on` fst)\n        . sortBy (compare `on` fst)\n\naverage :: [Integer] -&gt; Rational\naverage xs = sum xs % genericLength xs\n\naverages :: Ord a =&gt; [(a, Integer)] -&gt; [(a, Rational)]\naverages = fmap (fmap average) . classes\n</code></pre>\n\n<p>In <code>classes</code> you need to sort the list first because <code>groupBy</code> only groups <em>adjacent</em> values together.</p>\n"}], "owner": {"reputation": 128, "user_id": 6534893, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/1099077733496063/picture?type=large", "display_name": "Luiz Miranda", "link": "https://stackoverflow.com/users/6534893/luiz-miranda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1507553504, "creation_date": 1507420543, "last_edit_date": 1507425014, "question_id": 46626240, "link": "https://stackoverflow.com/questions/46626240/table-summarization-haskell", "title": "Table Summarization Haskell", "body": "<p>I have a question, I have to do a program to summarize a table, for example:</p>\n\n<p>Gender          Height</p>\n\n<p>Female          120</p>\n\n<p>Male            160</p>\n\n<p>Female 180</p>\n\n<p>and the result have to be , the average, like this: </p>\n\n<p>Female 150</p>\n\n<p>Male 160</p>\n\n<p>So far I got this:</p>\n\n<pre><code>altura :: [([Char], Integer)] -&gt; Integer\naltura [] = 1\naltura ((gender,height ): x) = if gender == \"Female\"\nthen height + (altura x)\nelse if gender == \"Male\"\nthen height + (altura x)\nelse 0\n</code></pre>\n\n<p>I don't know how to get the gender, and the division.\nThanks in advanced.</p>\n"}, {"tags": ["parsing", "variables", "haskell"], "comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 3, "creation_date": 1507419423, "post_id": 46626113, "comment_id": 80202796, "body": "IMHO this check should happen at a higher level, after parsing."}, {"owner": {"reputation": 77, "user_id": 5838116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/mlwk4.png?s=128&g=1", "display_name": "iIllumination", "link": "https://stackoverflow.com/users/5838116/iillumination"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1507419605, "post_id": 46626113, "comment_id": 80202827, "body": "Yeah, I guess so, I would at least make it alot easier."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1507456697, "post_id": 46626113, "comment_id": 80209255, "body": "I think your <code>Let</code> constructor is set up incorrectly. The thing on the left hand side of the <code>=</code> in <code>let x = e1 in e2</code> is a <i>name</i> (or, more generally, a _pattern), not an arbitrary expression. <code>let (if foo then bar else baz) = x in y</code> doesn&#39;t make sense!"}], "answers": [{"comments": [{"owner": {"reputation": 77, "user_id": 5838116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/mlwk4.png?s=128&g=1", "display_name": "iIllumination", "link": "https://stackoverflow.com/users/5838116/iillumination"}, "edited": false, "score": 0, "creation_date": 1507444395, "post_id": 46627219, "comment_id": 80206404, "body": "ok, I can&#39;t get this to work. I haven&#39;t worked with set before, so I kind of don&#39;t understand how I am gonna do this. I think I under stands whats going on, but I can&#39;t get it to work. (EDIT, I added abit more code in my question)"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1507456033, "post_id": 46627219, "comment_id": 80209079, "body": "@HNTW For what it\u2019s worth I find the top-down traversal more natural. If you\u2019re taking a typed approach, in which scope-checking produces an expression with a locally nameless representation, you need to <i>rewrite</i> the <code>Var</code> nodes (to replace them with de Bruijn indices), which is much easier when traversing top to bottom."}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 0, "last_activity_date": 1507434374, "last_edit_date": 1507434374, "creation_date": 1507432851, "answer_id": 46627219, "question_id": 46626113, "link": "https://stackoverflow.com/questions/46626113/haskell-state-of-variables-in-parsed-expression-is-the-variable-bound-or-not/46627219#46627219", "title": "Haskell - State of variables in parsed expression (Is the variable bound or not?)", "body": "<p>Recurse down the parsed expression, holding a set of bound variables. Every time you come across a <code>Let</code>, record it, every time you come across a <code>Var</code>, check that it's in your set, and every time you come across something else, check its subexpressions.</p>\n\n<pre><code>checkVars' :: Set String -&gt; Expr -&gt; Bool\ncheckVars' bound (Var v) = S.member v set\ncheckVars' bound (Let var val expr) = checkVars' bound val &amp;&amp; checkVars' (insert var bound) expr\ncheckVars' bound (Mul expr1 expr2) = checkVars' bound expr1 &amp;&amp; checkVars' bound expr2\n-- Similar for other ctors...\n\ncheckVars :: Expr -&gt; Bool\ncheckVars = checkVars' S.empty\n</code></pre>\n\n<p>You can also work in the opposite direction, building up a set of free variables from the bottom up, and removing variables whenever you see them bound by <code>Let</code>. (This feels more natural.)</p>\n\n<pre><code>freeVars :: Expr -&gt; Set String\nfreeVars (Var v) = S.singleton v\nfreeVars (Let var val expr) = S.union (freeVars val) $ S.delete var $ freeVars expr\nfreeVars (Add expr1 expr2) = S.union expr1 expr2\n-- etc.\n\ncheckVars :: Expr -&gt; Bool\ncheckVars = S.null . freeVars\n\n-- With recursion-schemes\ndata ExprF a = Add a a\n             | Mul a a\n             | Let String a a\n             | Var String\n             | Lit Int\n             deriving (Eq, Show, Read, Functor, Foldable, Traversable)\n\ntype Expr = Fix ExprF\n\nfreeVars :: Expr -&gt; Set String\nfreeVars = cata go -- -XLambdaCase, anyone?\n  where go :: ExprF (Set String) -&gt; Set String\n        go (Var var) = S.singleton var\n        go (Let var val expr) = S.union val $ S.delete var expr\n        go e = foldl S.union S.empty e -- Handle everything else\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 0, "last_activity_date": 1507458455, "creation_date": 1507458455, "answer_id": 46630054, "question_id": 46626113, "link": "https://stackoverflow.com/questions/46626113/haskell-state-of-variables-in-parsed-expression-is-the-variable-bound-or-not/46630054#46630054", "title": "Haskell - State of variables in parsed expression (Is the variable bound or not?)", "body": "<p>I recommend using a <em>locally nameless</em> representation for variables (such as that provided by <a href=\"https://hackage.haskell.org/package/bound\" rel=\"nofollow noreferrer\">the extraordinarily useful <code>bound</code> library</a>) in a syntax with binding. In a locally nameless representation, bound variables are represented using de Bruijn indices, and unbound variables are represented using a name. This saves you a whole lot of effort when it comes to things like alpha-equivalence and capture-avoiding substitution, and answering the question \"is this variable bound?\" becomes very straightforward.</p>\n\n<p>Typically a locally nameless representation is the output of a scope-checking operation on a surface syntax tree. We can adjust the code from <a href=\"https://stackoverflow.com/a/46627219/1523776\">@HNTW's answer</a> to produce a checked term instead of a <code>Bool</code>:</p>\n\n<pre><code>data Scoped a = SVar a\n              | SLet (Scoped a) (Scope () Scoped a)  -- The expression being let-bound, and the subexpression with the new variable in scope\n              | SLit Number\n              | SSub (Scoped a)\n              | SSum (Scoped a) (Scoped a)\n              | SMul (Scoped a) (Scoped a)\n              | SIf (Scoped a) (Scoped a) (Scoped a)\n              deriving (Functor, Foldable, Traversable)\n\ninstance Applicative Scoped where\n    pure = SVar\n    (&lt;*&gt;) = ap\n\ninstance Monad Scoped where\n    return = SVar\n    SVar a &gt;&gt;= g = g a\n    SLet expr scope &gt;&gt;= g = SLet (expr &gt;&gt;= g) (scope &gt;&gt;&gt;= g)\n    SLit x &gt;&gt;= g = SLit x\n    SSub x &gt;&gt;= g = SSub (x &gt;&gt;= g)\n    SSum x y &gt;&gt;= g = SSum (x &gt;&gt;= g) (y &gt;&gt;= g)\n    SMul x y &gt;&gt;= g = SMul (x &gt;&gt;= g) (y &gt;&gt;= g)\n    SIf cond t f &gt;&gt;= g = SIf (cond &gt;&gt;= g) (t &gt;&gt;= g) (f &gt;&gt;= g)\n\nscoped :: Expr -&gt; Scoped Char\nscoped (Var x) = SVar x\nscoped (Let name expr sub) = SLet (scope expr) (abstract1 name $ scoped sub)\nscoped (Lit x) = SLit x\nscoped (Sub s) = SSub (scoped s)\nscoped (Sum x y) = SSum (scoped x) (scoped y)\nscoped (Mul x y) = SMul (scoped x) (scoped y)\nscoped (If cond t f) = SIf (scoped cond) (scoped t) (scoped f)\n</code></pre>\n\n<p><code>bound</code> views an expression as a \"container\" of names <code>a</code>. The <code>Monad</code> instance performs substitution (<code>(&gt;&gt;=) :: Scoped a -&gt; (a -&gt; Scoped b) -&gt; Scoped b</code> takes a function mapping names <code>a</code> to terms <code>Scoped b</code> and grafts them together), and the <code>bound</code> library makes use of this substitution operation to implement tools like <a href=\"https://hackage.haskell.org/package/bound-2.0.1/docs/Bound.html#v:abstract1\" rel=\"nofollow noreferrer\"><code>abstract1</code></a>, which binds a variable in a subexpression, producing a new subexpression in a locally nameless form.</p>\n\n<p>(It wouldn't be unreasonable to do away with the separate <code>Expr</code> type, and just produce a <code>Scoped Char</code> directly as the output of your parser.)</p>\n\n<p><code>Scoped</code>'s <code>Foldable</code> and <code>Traversable</code> instances let you find all the unbound variables in an expression.</p>\n\n<pre><code>unboundVariables :: Scoped a -&gt; [a]\nunboundVariables = toList\n</code></pre>\n\n<p><code>bound</code>'s <a href=\"https://hackage.haskell.org/package/bound-2.0.1/docs/Bound.html#v:isClosed\" rel=\"nofollow noreferrer\"><code>isClosed</code></a> combinator does just what you wanted: it returns <code>False</code> if the expression has any free variables.</p>\n\n<p>If, as you walk under a scope, you need to know if a particular variable is bound or free, you can either pattern-match on <a href=\"https://hackage.haskell.org/package/bound-2.0.1/docs/Bound.html#t:Var\" rel=\"nofollow noreferrer\"><code>Var</code></a>'s <code>B</code> and <code>F</code> constructors, or use <a href=\"https://hackage.haskell.org/package/bound-2.0.1/docs/Bound-Var.html#v:_B\" rel=\"nofollow noreferrer\">the supplied <code>Prism</code>s</a>:</p>\n\n<pre><code>isBound :: Var b f -&gt; Bool\nisBound = is _B\n</code></pre>\n\n<p>For more on how <code>bound</code> works, see <a href=\"https://www.schoolofhaskell.com/user/edwardk/bound\" rel=\"nofollow noreferrer\">this blog post</a> or <a href=\"https://www.slideshare.net/ekmett/bound-making-de-bruijn-succ-less\" rel=\"nofollow noreferrer\">these slides</a>.</p>\n"}], "owner": {"reputation": 77, "user_id": 5838116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/mlwk4.png?s=128&g=1", "display_name": "iIllumination", "link": "https://stackoverflow.com/users/5838116/iillumination"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 386, "favorite_count": 0, "accepted_answer_id": 46627219, "answer_count": 2, "score": 1, "last_activity_date": 1507458455, "creation_date": 1507419178, "last_edit_date": 1507444434, "question_id": 46626113, "link": "https://stackoverflow.com/questions/46626113/haskell-state-of-variables-in-parsed-expression-is-the-variable-bound-or-not", "title": "Haskell - State of variables in parsed expression (Is the variable bound or not?)", "body": "<p>Hi so I got a function that takes a string and calculates the value, either an int or an bool. The string can be i.e.: \"<code>* let X = 3 in + X 1 2</code>\", which represent \"<code>(let X = 3 in (X + 1)) * 2</code>\". Which will give me 8 or false if I ask for a bool. Simple enough. But I also want to check the state of bound variables in the parser. I.e. if I use a string like this \"<code>* let X = 3 in + X 1 X</code>\" as input, it will represent \"<code>(let X = 3 in (X + 1)) * X</code>\" which makes the last X unbound. This will then give me an error saying that the variable A is unbound or something. \nIf someone could give me any ideas on how I could do this, I would be very much appreciated!</p>\n\n<p><em>Expample of parsed string:</em> </p>\n\n<p><code>((let X = 3 in (X + 1)) * 2)</code> </p>\n\n<p>Will give me:</p>\n\n<p><code>(Mul (Let (Vari X) (Lit (Single 3)) (Sum (Vari X) (Lit (Single 1)))) (Vari X))</code></p>\n\n<p>So my question is basiclly how I can check if the parsed string has any unbound variables.</p>\n\n<pre><code>data Number = Single Int | Many Int Number deriving (Eq, Show)\n\ndata Expr = Vari Chara | Lit Number | Sub Expr | Sum Expr Expr | Mul Expr Expr | Let Expr Expr Expr | If Expr Expr Expr deriving (Eq, Show)\n</code></pre>\n"}, {"tags": ["haskell", "hackage"], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1507414914, "creation_date": 1507414914, "answer_id": 46625678, "question_id": 46625313, "link": "https://stackoverflow.com/questions/46625313/how-to-get-updated-upper-bounds-for-a-hackage-package/46625678#46625678", "title": "How to get updated upper bounds for a Hackage package?", "body": "<p>Users can only take advantage of that exact feature by asking the package maintainer to make such a dependency-revision on Hackage. By all means do that when you're sure a dependency is unnecessarily conservative, but be prepared that it won't happen right away.</p>\n\n<p>But you don't <em>need</em> this just to install a package on your machine with newer dependencies than the \u201cofficially supported\u201d ones. Just use</p>\n\n\n\n<pre class=\"lang-sh prettyprint-override\"><code>cabal install token-bucket --allow-newer base\n</code></pre>\n\n<p>Alternatively, you can instead of installing straight from Hackage pull the source code (most typically from Github) into a local repository<sup>\u2020</sup></p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>git clone git@github.com:hvr/token-bucket.git\ncd token-bucket\n</code></pre>\n\n<p>...apply any changes to the dependencies you want</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>sed -i 's/\\(base[^&lt;]*\\)&lt;4.10/\\1&lt;4.11/' token-bucket.cabal\n</code></pre>\n\n<p>...and install from that local copy:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>cabal install\n</code></pre>\n\n<hr>\n\n<p><sup>\u2020</sup><sub>If nothing else, you can simply get the exact hackage version of the source through <code>cabal fetch</code>, but IMO one should always use the native version-control system when making changes to any codebase.</sub></p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1507414914, "creation_date": 1507411843, "question_id": 46625313, "link": "https://stackoverflow.com/questions/46625313/how-to-get-updated-upper-bounds-for-a-hackage-package", "title": "How to get updated upper bounds for a Hackage package?", "body": "<p>A common problem with upper bounds is that package authors being uncertain opt for conservative upper bounds of their dependencies (e.g. base). This tends to be an unpopular choice for users which may be prevented from using such packages in the future.</p>\n\n<p>I recently realized that this problem might have a solution where author pushes metadata changes to otherwise unchange package <a href=\"https://hackage.haskell.org/package/token-bucket-0.1.0.1/revisions/\" rel=\"nofollow noreferrer\">as seen here</a>. How can users take advantage of this new feature? Is it documented somewhere in detail or is it experimental?</p>\n"}, {"tags": ["haskell", "pattern-matching", "ghci", "winghci"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1507399896, "post_id": 46623123, "comment_id": 80197545, "body": "Briefly put, prolog does unification, Haskell only does pattern matching."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 4, "creation_date": 1507401049, "post_id": 46623123, "comment_id": 80197894, "body": "Boring practical advice: using <code>-Wall</code> will be really helpful while you&#39;re learning (as well as for catching issues in real code)"}], "answers": [{"comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1507555251, "post_id": 46623330, "comment_id": 80244016, "body": "&quot;otherwise, it would tremendously difficult to determine whether&quot; -&gt; Meh, that&#39;s just scope checking. Scope-aware syntax highlighting can deal with that just fine (cf. Agda for instance)"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 11, "last_activity_date": 1507399276, "last_edit_date": 1507399276, "creation_date": 1507398838, "answer_id": 46623330, "question_id": 46623123, "link": "https://stackoverflow.com/questions/46623123/haskell-tuple-not-matching-with-function-argument/46623330#46623330", "title": "Haskell tuple not matching with function argument", "body": "<p>Yes, Haskell pattern matching is fundamentally different from Prolog pattern matching.</p>\n\n<p>In Haskell, a variable in a pattern refers to a fresh variable that will be bound by the match, never an existing variable that must be matched.  So, the expression:</p>\n\n<pre><code>let x = 5 in case (1,2) of (x,y) -&gt; \"matched!\"   -- gives \"matched!\"\n</code></pre>\n\n<p>will always evaluate to \"matched!\".  That's because the <code>x</code> in <code>(x,y)</code> gets freshly bound to <code>1</code>, not compared with the value of the \"existing\", outer definition of <code>x</code>, as you can see here:</p>\n\n<pre><code>let x = 5 in case (1,2) of (x,y) -&gt; x     -- gives \"1\"\n</code></pre>\n\n<p>The behavior is different for numeric constants:</p>\n\n<pre><code>case (1,2) of (5,y) -&gt; \"matched!\"    -- match fails\n</code></pre>\n\n<p>and for other constructors:</p>\n\n<pre><code>case (True,2) of (False,y) -&gt; \"match!\"   -- match fails\n</code></pre>\n\n<p>which are not \"re-bound\" but rather must match for the pattern match to succeed.  This is one of many reasons that alphanumeric constructors start with capital letters: otherwise, it would tremendously difficult to determine whether a pattern involved matching to an existing constructor or rebinding to a fresh variable.</p>\n\n<p>This applies to pattern matches in any context, whether it's case expressions as above or function definitions like this:</p>\n\n<pre><code>let x = 5\nf x = \"hi\"     -- defines `f` for any `x`, not just `f 5`\n</code></pre>\n\n<p>or list comprehensions like your example.  In the expression:</p>\n\n<pre><code>[v | (k,v) &lt;- [(1,2),(3,4)]]    -- gives [(1,2),(3,4)]\n</code></pre>\n\n<p>the variables <code>k</code> and <code>v</code> will always be fresh, so will bind to any of the tuples <em>despite</em> any outer, existing definitions of <code>k</code> or <code>v</code>.  If you turn on warnings with <code>-Wall</code> (specifically <code>-Wname-shadowing</code>), this will alert you to the shadowed binding.  If you replace <code>k</code> with a constant (or other constructor), it behaves differently:</p>\n\n<pre><code>[v | (3,v) &lt;- [(1,2),(3,4)]]    -- only gives [(3,4)]\n</code></pre>\n\n<p>You may not like it, but that's just the way Haskell works.</p>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 4468169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dde99c3a8647cd7533a86e11d09b39d3?s=128&d=identicon&r=PG", "display_name": "lintense", "link": "https://stackoverflow.com/users/4468169/lintense"}, "is_accepted": false, "score": 0, "last_activity_date": 1507438299, "creation_date": 1507438299, "answer_id": 46627628, "question_id": 46623123, "link": "https://stackoverflow.com/questions/46623123/haskell-tuple-not-matching-with-function-argument/46627628#46627628", "title": "Haskell tuple not matching with function argument", "body": "<p>Thanks for your help! After some searches, I also found this answer to be helpful: <a href=\"https://stackoverflow.com/a/43560029/4468169\">How can I re-assign a variable in a function in Haskell?</a></p>\n\n<p>A new variable having the same name is created that shadows the previous one. But the first variable continues to exist and in some cases be still accessible...</p>\n\n<p>So indeed this is far from Prolog and yes the following flag is of precious help:</p>\n\n<pre><code>Prelude&gt; :set -fwarn-name-shadowing \n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 4468169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dde99c3a8647cd7533a86e11d09b39d3?s=128&d=identicon&r=PG", "display_name": "lintense", "link": "https://stackoverflow.com/users/4468169/lintense"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1507438299, "creation_date": 1507397567, "question_id": 46623123, "link": "https://stackoverflow.com/questions/46623123/haskell-tuple-not-matching-with-function-argument", "title": "Haskell tuple not matching with function argument", "body": "<p>I'm new to Haskell so it may be obvious but I did Prolog extensively so I'm perplex about this one...</p>\n\n<p>When using GHCi, I created the following function (1):</p>\n\n<pre><code>Prelude&gt; let find k t = head [v | (k',v) &lt;- t, k == k'] -- Definiton of find\nfind :: Eq a1 =&gt; a1 -&gt; [(a1, a)] -&gt; a\n\nPrelude&gt; find 2 [(1,11),(2,22)] -- Invocation of find\n22\n</code></pre>\n\n<p>Which is expected. I then tried to remove the k' from the definition:</p>\n\n<pre><code>Prelude&gt; let find2 k t = head [v | (k,v) &lt;- t]\nfind2 :: t -&gt; [(t1, a)] -&gt; a\n\nPrelude&gt; find2 2 [(1,11),(2,22)]\n11\n</code></pre>\n\n<p>I was then very surprised to see the value <code>2</code> actually matched with <code>1</code>. \nJust to be sure I was not hoping for the impossible I also try the following in order to confirms that partial matching is possible in Haskell, which looks like it is actually the case:</p>\n\n<pre><code>Prelude&gt; head [v | (2,v) &lt;- [(1,11),(2,22)]]\n22\n</code></pre>\n\n<p>I also noticed a difference in the function declarations. I added the required information so both declarations for <code>find</code> and <code>find2</code> look exactly the same. But the result is still broken <code>(2,_)</code> matchnig <code>(1,11)</code>:</p>\n\n<pre><code>Prelude&gt; let find2 :: Eq a1 =&gt; a1 -&gt; [(a1, a)] -&gt; a; find2 k t = head [v | (k,v) &lt;- t]\nfind2 :: Eq a1 =&gt; a1 -&gt; [(a1, a)] -&gt; a\n\nPrelude&gt; find2 2 [(1,11),(2,22)]\n11\n</code></pre>\n\n<p>How can <code>2</code> be matching <code>1</code> by any mean?</p>\n\n<p>(1) The above function comes from the excellent book \"Programming in Haskell\" p.93</p>\n"}, {"tags": ["haskell", "where-clause"], "answers": [{"comments": [{"owner": {"reputation": 3683, "user_id": 330242, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c9f3ffc3e30d25eb64e2e464f0a86bd7?s=128&d=identicon&r=PG", "display_name": "przemo_li", "link": "https://stackoverflow.com/users/330242/przemo-li"}, "edited": false, "score": 0, "creation_date": 1507389383, "post_id": 46621656, "comment_id": 80194258, "body": ":/ right, that&#39;s just ordinary function definition (somehow I though it&#39;s assignment), so <code>foldl</code> will first run it with <code>Nothing</code> and first element of a list, which will be caught by first branch of case, so first element of list will be returned as future accumulator, after <code>foldl</code> runs through a list, <code>mf</code> will be returning single value inside <code>Maybe</code>, so that&#39;s why we need <code>fromMaybe</code> which will extract that value, or in case of <code>Nothing</code> will execute it&#39;s first argument. Thx!"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 3683, "user_id": 330242, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c9f3ffc3e30d25eb64e2e464f0a86bd7?s=128&d=identicon&r=PG", "display_name": "przemo_li", "link": "https://stackoverflow.com/users/330242/przemo-li"}, "edited": false, "score": 1, "creation_date": 1507389619, "post_id": 46621656, "comment_id": 80194333, "body": "@przemo_li: Haskell has no <i>assignments</i>. It only has <i>declarations</i>."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 7, "last_activity_date": 1507388636, "creation_date": 1507388636, "answer_id": 46621656, "question_id": 46621625, "link": "https://stackoverflow.com/questions/46621625/trouble-explaining-haskell-code-with-where-and-pattern-match/46621656#46621656", "title": "Trouble explaining Haskell code with where and pattern match", "body": "<p>Definitions in <code>where</code> clauses follow the same syntax as global definitions, so <code>mf m y = ...</code> defines a function named <code>mf</code>, which takes parameters named <code>m</code> and <code>y</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "is_accepted": false, "score": 2, "last_activity_date": 1507388964, "creation_date": 1507388964, "answer_id": 46621713, "question_id": 46621625, "link": "https://stackoverflow.com/questions/46621625/trouble-explaining-haskell-code-with-where-and-pattern-match/46621713#46621713", "title": "Trouble explaining Haskell code with where and pattern match", "body": "<p>In the empty list case, <code>foldl mf Nothing [] ~ Nothing</code> by definition, so <code>foldl1</code> will return the <code>\"empty structure\"</code> error.</p>\n\n<p>When <code>xs</code> is not empty, then <code>foldl1'</code> is simply a left fold by <code>foldl</code>. In this case <code>foldl</code> has the type</p>\n\n<p><code>foldl :: (Maybe a -&gt; a -&gt; Maybe a) -&gt; Maybe a -&gt; [a] -&gt; Maybe a</code></p>\n\n<p>which makes use of the combining function <code>mf :: Maybe a -&gt; a -&gt; Maybe a</code> defined in the <code>where</code> clause.</p>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1507391163, "post_id": 46621825, "comment_id": 80194824, "body": "I believe that the original code defines <code>mf</code> in that way since it is lazier. (Not sure about the benefit of that, though)"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1507389591, "creation_date": 1507389591, "answer_id": 46621825, "question_id": 46621625, "link": "https://stackoverflow.com/questions/46621625/trouble-explaining-haskell-code-with-where-and-pattern-match/46621825#46621825", "title": "Trouble explaining Haskell code with where and pattern match", "body": "<blockquote>\n  <p>I have hard time parsing how mf m y are assigned values or even why there can be 3 variables.</p>\n</blockquote>\n\n<p>You do not define three variables here: you define a variable <code>mf</code> which is a function, and <code>m</code> and <code>y</code> are two <em>arguments</em> of the function <code>mf</code>.</p>\n\n<p>We can make the function more elegant, and thus omit the <code>m</code> and <code>y</code>. <code>mf</code> can be defined as:</p>\n\n<pre><code>mf Nothing = Just . id\nmf (Just x) = Just . f x\n</code></pre>\n\n<p>Mind that we can not simply make <code>mf</code> an outer function, since it uses a function <code>f</code>, with is a parameter of <code>foldl1</code>. So we put it in a <code>where</code> clause:</p>\n\n<pre><code>foldl1 :: (a -&gt; a -&gt; a) -&gt; t a -&gt; a\nfoldl1 f xs = fromMaybe (errorWithoutStackTrace \"foldl1: empty structure\")\n                (foldl mf Nothing xs)\n    where mf Nothing = Just . id\n          mf (Just x) = Just . f x\n</code></pre>\n"}], "owner": {"reputation": 3683, "user_id": 330242, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c9f3ffc3e30d25eb64e2e464f0a86bd7?s=128&d=identicon&r=PG", "display_name": "przemo_li", "link": "https://stackoverflow.com/users/330242/przemo-li"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 46621825, "answer_count": 3, "score": 2, "last_activity_date": 1507499696, "creation_date": 1507388468, "last_edit_date": 1507499696, "question_id": 46621625, "link": "https://stackoverflow.com/questions/46621625/trouble-explaining-haskell-code-with-where-and-pattern-match", "title": "Trouble explaining Haskell code with where and pattern match", "body": "<p>I have hard time parsing how <code>mf</code> <code>m</code> <code>y</code> are assigned values or even why there can be 3 variables on the left side of assignment in <code>where</code> section.</p>\n\n<p><strong>Q: Can anyone explain what happens here in both cases?</strong> (that is for empty list and a list with some elements)</p>\n\n<pre><code>-- | A variant of 'foldl' that has no base case,\n-- and thus may only be applied to non-empty structures.\n--\n-- @'foldl1' f = 'List.foldl1' f . 'toList'@\nfoldl1 :: (a -&gt; a -&gt; a) -&gt; t a -&gt; a\nfoldl1 f xs = fromMaybe (errorWithoutStackTrace \"foldl1: empty structure\")\n                (foldl mf Nothing xs)\n  where\n    mf m y = Just (case m of\n                     Nothing -&gt; y\n                     Just x  -&gt; f x y)\n</code></pre>\n\n<p>(this is the <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/src/Data.Foldable.html#line-217\" rel=\"nofollow noreferrer\">source code</a> for the <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Foldable.html#v:foldl1\" rel=\"nofollow noreferrer\"><code>foldl1</code> function</a>).</p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 1, "last_activity_date": 1507410850, "creation_date": 1507410850, "answer_id": 46625178, "question_id": 46621397, "link": "https://stackoverflow.com/questions/46621397/conditional-compilation-of-library-using-test-suite/46625178#46625178", "title": "Conditional compilation of library using test suite", "body": "<p>I would use a cabal flag: when set to true, compile the local debug version of the library and test suite; when set to false, compile the networked version of the library but disable the test suite.</p>\n\n<p>You should also put the main files for the executables in a separate directory from the library, which is the main reason behind the issue you mention about not linking against the library.</p>\n"}], "owner": {"reputation": 1287, "user_id": 8737306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3bb7d3a90fd41a59ba3e205cbbc5a3e?s=128&d=identicon&r=PG&f=1", "display_name": "Zpalmtree", "link": "https://stackoverflow.com/users/8737306/zpalmtree"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 197, "favorite_count": 0, "accepted_answer_id": 46625178, "answer_count": 1, "score": 1, "last_activity_date": 1507410850, "creation_date": 1507387081, "question_id": 46621397, "link": "https://stackoverflow.com/questions/46621397/conditional-compilation-of-library-using-test-suite", "title": "Conditional compilation of library using test suite", "body": "<p>I'm trying to correctly compile my test suite for a haskell project which uses the CPP extension to conditionally import different modules. One module will send output to the network, and the other to the terminal, for debugging.</p>\n\n<p>This works fine, but when I try and set up my test suite, it doesn't seem to respect the cpp-options set in the .cabal file, and instead always builds the networked version.</p>\n\n<p>Cabal file:</p>\n\n<pre><code>name:           server\nversion:        0.1.0.0\nbuild-type:     Simple\ncabal-version:  &gt;= 1.10\n\nlibrary\n  hs-source-dirs:\n      src\n  build-depends:\n      base &gt;=4.9 &amp;&amp; &lt;=4.11\n    , lens\n    , random\n    , transformers\n    , safe\n    , uuid-types\n    , QuickCheck\n    , network\n    , bytestring\n    , binary\n  exposed-modules:\n      Betting\n      Game\n      Input.Network.Input\n      Input.Terminal.Input\n      Lenses\n      Main\n      Output.Network.Output\n      Output.Terminal.InputMessages\n      Output.Terminal.Output\n      Output.Terminal.OutputMessages\n      RunLocal\n      RunNetwork\n      Showdown\n      Showdown.Best\n      Showdown.Ord\n      Showdown.Value\n      TestStates\n      Types\n      Utilities.Card\n      Utilities.Player\n      Utilities.Showdown\n      Utilities.Terminal.Output\n      Utilities.Types\n  other-modules:\n      Paths_server\n  default-language: Haskell2010\n\nexecutable local-server\n  main-is: Main.hs\n  hs-source-dirs:\n      src\n  cpp-options: -DDEBUG\n  build-depends:\n      base &gt;=4.9 &amp;&amp; &lt;=4.11\n    , lens\n    , random\n    , transformers\n    , safe\n    , uuid-types\n    , QuickCheck\n    , server\n  other-modules:\n      Betting\n      Game\n      Input.Network.Input\n      Input.Terminal.Input\n      Lenses\n      Output.Network.Output\n      Output.Terminal.InputMessages\n      Output.Terminal.Output\n      Output.Terminal.OutputMessages\n      RunLocal\n      RunNetwork\n      Showdown\n      Showdown.Best\n      Showdown.Ord\n      Showdown.Value\n      TestStates\n      Types\n      Utilities.Card\n      Utilities.Player\n      Utilities.Showdown\n      Utilities.Terminal.Output\n      Utilities.Types\n  default-language: Haskell2010\n\nexecutable networked-server\n  main-is: Main.hs\n  hs-source-dirs:\n      src\n  build-depends:\n      base &gt;=4.9 &amp;&amp; &lt;=4.11\n    , lens\n    , random\n    , transformers\n    , safe\n    , uuid-types\n    , QuickCheck\n    , server\n    , network\n    , bytestring\n    , binary\n  other-modules:\n      Betting\n      Game\n      Input.Network.Input\n      Input.Terminal.Input\n      Lenses\n      Output.Network.Output\n      Output.Terminal.InputMessages\n      Output.Terminal.Output\n      Output.Terminal.OutputMessages\n      RunLocal\n      RunNetwork\n      Showdown\n      Showdown.Best\n      Showdown.Ord\n      Showdown.Value\n      TestStates\n      Types\n      Utilities.Card\n      Utilities.Player\n      Utilities.Showdown\n      Utilities.Terminal.Output\n      Utilities.Types\n  default-language: Haskell2010\n\ntest-suite test-server\n  type: exitcode-stdio-1.0\n  main-is: Tests.hs\n  hs-source-dirs:\n      tests\n  cpp-options: -DDEBUG\n  build-depends:\n      base &gt;=4.9 &amp;&amp; &lt;=4.11\n    , lens\n    , random\n    , transformers\n    , safe\n    , uuid-types\n    , QuickCheck\n    , server\n    , poker-eval\n  other-modules:\n      BettingTests\n      CardTests\n      PlayerTests\n      ShowdownTests\n  default-language: Haskell2010\n</code></pre>\n\n<p>An example of one of the modules that get compiled conditionally:</p>\n\n<pre><code>{-# LANGUAGE CPP #-}\n\nmodule Utilities.Card where\n\n#ifdef DEBUG\nimport Output.Terminal.Output (outputPlayerCards)\n#else\nimport Output.Network.Output (outputPlayerCards)\n#endif\n\ndealCards :: GameStateT ()\ndealCards = do\n    updateCards =&lt;&lt; numPlayersT\n    outputPlayerCards\n</code></pre>\n\n<p>In my test suite, the network version of outputPlayerCards always gets called, despite have in the cpp-options: -DDEBUG set.</p>\n\n<p>However, the networked-server and local-server are correctly compiled, and call the appropriate functions.</p>\n\n<p>My previous method of having just one executable which was compiled for network or local with a flag worked, however I read that it's not the correct way to write a test suite, as I wasn't linking aginst it, and rather building it directly by including its source directory in the .cabal file.</p>\n\n<p>I'm using stack to build, and can include that file if needed.</p>\n"}, {"tags": ["haskell", "yesod", "haskell-persistent"], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 2, "last_activity_date": 1507443809, "creation_date": 1507443809, "answer_id": 46628138, "question_id": 46620299, "link": "https://stackoverflow.com/questions/46620299/get-persistents-field-definitions-for-my-model/46628138#46628138", "title": "get persistent&#39;s field definitions for my model", "body": "<p>A sample example showing how it is done:</p>\n\n<pre><code>#!/usr/bin/env stack\n{- stack\n     --resolver lts-9.0\n     --install-ghc\n     runghc\n     --package persistent\n     --package persistent-sqlite\n     --package persistent-template\n-}\n\n{-# LANGUAGE EmptyDataDecls             #-}\n{-# LANGUAGE FlexibleContexts           #-}\n{-# LANGUAGE GADTs                      #-}\n{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE MultiParamTypeClasses      #-}\n{-# LANGUAGE OverloadedStrings          #-}\n{-# LANGUAGE QuasiQuotes                #-}\n{-# LANGUAGE TemplateHaskell            #-}\n{-# LANGUAGE TypeFamilies               #-}\nimport           Control.Monad.IO.Class  (liftIO)\nimport           Database.Persist\nimport           Database.Persist.Sqlite\nimport           Database.Persist.TH\n\nshare [mkPersist sqlSettings, mkMigrate \"migrateAll\"] [persistLowerCase|\nPerson\n    name String\n    age Int Maybe\n    deriving Show\nBlogPost\n    title String\n    authorId PersonId\n    deriving Show\n|]\n\nmain :: IO ()\nmain = let efields = entityFields $ entityDef (undefined :: Maybe Person)\n       in print efields\n</code></pre>\n\n<p>Demo:</p>\n\n<pre><code>$ stack efield.hs\n[FieldDef {fieldHaskell = HaskellName {unHaskellName = \"name\"}, fieldDB = DBName {unDBName = \"name\"}, fieldType = FTTypeCon Nothing \"String\", fieldSqlType = SqlString, fieldAttrs = [], fieldStrict = True, fieldReference = NoReference},FieldDef {fieldHaskell = HaskellName {unHaskellName = \"age\"}, fieldDB = DBName {unDBName = \"age\"}, fieldType = FTTypeCon Nothing \"Int\", fieldSqlType = SqlInt64, fieldAttrs = [\"Maybe\"], fieldStrict = True, fieldReference = NoReference}]\n</code></pre>\n"}], "owner": {"reputation": 595, "user_id": 3334477, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6WWr4.jpg?s=128&g=1", "display_name": "maillard", "link": "https://stackoverflow.com/users/3334477/maillard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 46628138, "answer_count": 1, "score": 0, "last_activity_date": 1507443826, "creation_date": 1507380509, "last_edit_date": 1507443826, "question_id": 46620299, "link": "https://stackoverflow.com/questions/46620299/get-persistents-field-definitions-for-my-model", "title": "get persistent&#39;s field definitions for my model", "body": "<p>given a persistent model definition like this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>mkPersist sqlSettings [persistLowerCase|\nPerson\n    name String\n    age Int\n    deriving Show\n|]\n</code></pre>\n\n<p>I'm looking for a way to get the field definitions for this model. <code>FieldDef</code> looks like a promising datatype, but persistent does not generate a <code>getPersonFields :: [FieldDef]</code> function, so how can it be done? </p>\n\n<p>In case this is a XY problem - here's the background:\nI want to return some kind of metadata in case of json parse errors. If I try to POST a new person but the json is wrong, I want to respond with something like:</p>\n\n<pre><code>{\n    \"result\": \"error\",\n    \"code\": 8,\n    \"message\": \"Could not parse payload as person\",\n    \"fields\": [\n        {\n            \"name\": \"name\",\n            \"type\": \"string\"\n        },\n        {\n            \"name\": \"age\",\n            \"type\": \"int\"\n        }\n    ]\n}\n</code></pre>\n"}, {"tags": ["haskell", "category-theory"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1507396059, "post_id": 46620293, "comment_id": 80196370, "body": "If you enable the <code>TypeApplications</code> extension, you can also see more clearly that <code>fmap</code> is actually a function that returns a type-specific implementation: <code>fmap @[] :: (a -&gt; b) -&gt; [a] -&gt; [b]</code>, <code>fmap @Maybe :: (a -&gt; b) -&gt; Maybe a -&gt; Maybe b</code>, etc. Without the extension, you can only let the type argument be applied implicitly, after the compiler has used type inference to determine which argument that should be."}], "answers": [{"comments": [{"owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "edited": false, "score": 3, "creation_date": 1507387889, "post_id": 46620360, "comment_id": 80193769, "body": "A more correct answer would be &quot;any <i>type</i> that implements fmap <i>lawfully</i> is a functor&quot;. Since <code>Functor</code> is not always container-like (for example <code>Cont r</code>), and not every implementation of <code>fmap</code> is a valid <code>Functor</code>."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "edited": false, "score": 0, "creation_date": 1507402407, "post_id": 46620360, "comment_id": 80198376, "body": "In addition to what @cdk said, the &quot;No&quot; at the start of this answer, I&#39;d say, is a bit misleading because all function types are functors and <code>map</code> is a function (so <code>map</code> has essentially the same relationship to <code>Functor</code> that the list <code>[&#39;a&#39;,&#39;b&#39;,&#39;c&#39;]</code> has)."}], "tags": [], "owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "is_accepted": false, "score": 3, "last_activity_date": 1507380904, "creation_date": 1507380904, "answer_id": 46620360, "question_id": 46620293, "link": "https://stackoverflow.com/questions/46620293/in-haskell-is-the-map-function-a-functor/46620360#46620360", "title": "In Haskell, is the map function a functor?", "body": "<p>No, but any container that implements fmap is a functor. Lists implement fmap as well (give it a try!), so lists are functors. Map is just the implementation of fmap for lists.</p>\n"}, {"tags": [], "owner": {"reputation": 4763, "user_id": 1065586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qYTQe.jpg?s=128&g=1", "display_name": "tomferon", "link": "https://stackoverflow.com/users/1065586/tomferon"}, "is_accepted": true, "score": 8, "last_activity_date": 1507381698, "creation_date": 1507381698, "answer_id": 46620509, "question_id": 46620293, "link": "https://stackoverflow.com/questions/46620293/in-haskell-is-the-map-function-a-functor/46620509#46620509", "title": "In Haskell, is the map function a functor?", "body": "<p>In Haskell terms, <code>fmap</code> is a method in the typeclass <code>Functor</code>, not the functor itself. <code>[]</code>, <code>Maybe</code>, ... are type constructors which instantiates the class <code>Functor</code> and, abusing the language, you can say that \"Maybe is a functor\".</p>\n\n<p>In mathematical terms, a functor (or more specifically in this case, an endofunctor in the category Hask, the category of Haskell types) is composed of two mappings: the first one from a type to another and the second from an arrow (<code>a -&gt; b</code>) to another (<code>f a -&gt; f b</code>) which preserves the structure. In that sense, <code>Maybe</code> is the first arrow which maps a type to another, say <code>Int</code> to <code>Maybe Int</code> and the <code>fmap</code> for <code>Maybe</code> is the second arrow.</p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1507400542, "post_id": 46623236, "comment_id": 80197741, "body": "That&#39;s misleading at best; in fact I&#39;d say it&#39;s <i>wrong</i>. What&#39;s a functor here is <i>the <code>(-&gt;) (a-&gt;b)</code> type constructor</i>; <code>map</code> happens to have a type of that form, but that doesn&#39;t make it a functor any more than <code>[1,2,3]</code> is a cons operator. That&#39;s just <i>a list</i>. Which, incidentally, isn&#39;t a functor either; the <i>list functor</i> is the type-level entity <code>[] :: * -&gt; *</code>, not any concrete value-level list."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1507401247, "post_id": 46623236, "comment_id": 80197963, "body": "@leftaroundabout I have just applied a function (<code>$</code>) over <code>map</code> by <code>fmap</code>. How is not <code>map</code> a functor if this is possible..? BTW what is a cons cell.?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1507401926, "post_id": 46623236, "comment_id": 80198209, "body": "If <code>map</code> were a functor, then fmapping anything over it would give you back some kind of \u201cother flavour of <code>map</code>\u201d. But it doesn&#39;t, it just gives you back <i>another function</i>. \u2014 \u2014 <a href=\"https://en.wikipedia.org/wiki/Cons_cell\" rel=\"nofollow noreferrer\">Cons cell</a> \u2014"}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1507402587, "post_id": 46623236, "comment_id": 80198438, "body": "Then instead of <code>($)</code>, for instance one could simply do <code>(.) &lt;$&gt; map</code> and can get a fancy function back. All functions are functors. You just apply their return value to the provided mapping function to obtain a new functionality. There might be simpler ways of doing this but this doesn&#39;t change the fact that <code>map</code>  is a functor."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1507404761, "post_id": 46623236, "comment_id": 80199121, "body": "The whole point of category theory is that it makes your constructions <i>as general as possible</i>. A functor that&#39;s only a functor if you fmap some vaguely specified particular sort of function wouldn&#39;t be worth its salt."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1507404766, "post_id": 46623236, "comment_id": 80199127, "body": "Anyway that&#39;s besides the point; \u201call functions are functors\u201d is still wrong. \u201cAll types <i>T</i> generate a functor whose objects are the types of function off <i>T</i>\u201d would be the correct statement; that doesn&#39;t even say anything about <i>individual functions</i>, which are merely the members of said function-types. But category-theory wise, this kind of \u201cmembership of object\u201d is a much more specific concept (it requires a <a href=\"https://en.wikipedia.org/wiki/Well-pointed_category\" rel=\"nofollow noreferrer\">well-pointed category</a>) than functors, which you can have between any categories."}], "tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 2, "last_activity_date": 1507398222, "creation_date": 1507398222, "answer_id": 46623236, "question_id": 46620293, "link": "https://stackoverflow.com/questions/46620293/in-haskell-is-the-map-function-a-functor/46623236#46623236", "title": "In Haskell, is the map function a functor?", "body": "<p>Like all <code>(-&gt;) r</code> types <code>map</code> is also a functor.</p>\n\n<p><code>(-&gt;) r</code> is actually just a simple function type like <code>r -&gt; a</code> and all functions are functors. Like other functors you may think a function like  a container but you get the contained value when you apply a value. However as for a Functor instance we can not have a type with two type variables. That's why we partially apply it. Just like <code>Either a b</code> is done like <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/src/Data.Either.html#line-130\" rel=\"nofollow noreferrer\"><code>instance Functor (Either a)</code></a>. Since we are interested in the return value of a function the Functor instance of a function type is a partially applied <code>r -&gt; a</code> which is <code>(-&gt;) r</code>.</p>\n\n<p>So lets see a functions Functor instance.</p>\n\n<pre><code>instance Functor ((-&gt;) r) where  \n  fmap f g = (\\x -&gt; f (g x))\n</code></pre>\n\n<p>So coming back to the question, <code>map</code> is a function with type <code>(a -&gt; b) -&gt; [a] -&gt; [b]</code> and we can rewrite this  like <code>(a -&gt; b) -&gt; ([a] -&gt; [b])</code> so here <code>r</code> variable in the Functor instance stands for <code>a -&gt; b</code> and <code>a</code> variable in the Functor instance stands for <code>[a] -&gt; [b]</code>. So lets apply <code>fmap</code> on <code>map</code> like <code>fmap ($) map</code>. Which essentially means it will return us a function like <code>\\x -&gt; ($) map x</code>. Where <code>x</code> has to be a <code>(a -&gt; b)</code> type function. So lets use <code>&lt;$&gt;</code>; the infix representation of <code>fmap</code> in the below example ;</p>\n\n<pre><code>Prelude&gt; (($) &lt;$&gt; map) (+2) [1,2,3]\n[3,4,5]\n</code></pre>\n\n<p>So.. yes <code>map</code> is a functor.</p>\n"}], "owner": {"reputation": 23, "user_id": 8528262, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/976c2e54309ef7a50e17241d4a743163?s=128&d=identicon&r=PG&f=1", "display_name": "Hopeful_O", "link": "https://stackoverflow.com/users/8528262/hopeful-o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 611, "favorite_count": 0, "accepted_answer_id": 46620509, "answer_count": 3, "score": 1, "last_activity_date": 1507398222, "creation_date": 1507380460, "question_id": 46620293, "link": "https://stackoverflow.com/questions/46620293/in-haskell-is-the-map-function-a-functor", "title": "In Haskell, is the map function a functor?", "body": "<p>The type of map  is: (a->b) -> [a] -> [b]</p>\n\n<p>while the type of the functor fmap is: </p>\n\n<p>Functor f => (a+b) -> f a -> f b\nI read on wikipedia that map was a polymorphic morphism while fmap was a polytypic morphism but that doesn't really clear up things for me.</p>\n\n<p>So my question is: is the map function a functor?</p>\n"}, {"tags": ["haskell", "zipwith"], "comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 1, "creation_date": 1507379384, "post_id": 46619990, "comment_id": 80191202, "body": "Actually you may also consider looking at <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Control-Applicative.html#t:ZipList\" rel=\"nofollow noreferrer\"><code>Control.Applicative.ZipList</code></a> type for this type of operations."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 1, "creation_date": 1507380214, "post_id": 46619990, "comment_id": 80191442, "body": "BTW, you can pass the addition operator as a function: <code>(zipWith . zipWith) (+) [[1,2,3],[4,5,6]] [[7,8,9],[10,11,12]]</code>"}], "answers": [{"tags": [], "owner": {"reputation": 4763, "user_id": 1065586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qYTQe.jpg?s=128&g=1", "display_name": "tomferon", "link": "https://stackoverflow.com/users/1065586/tomferon"}, "is_accepted": true, "score": 7, "last_activity_date": 1507379488, "creation_date": 1507379488, "answer_id": 46620146, "question_id": 46619990, "link": "https://stackoverflow.com/questions/46619990/why-does-zipwith-zipwith-work/46620146#46620146", "title": "Why does zipWith.zipWith work?", "body": "<p>To infer the type of an expression such as <code>zipWith . zipWith</code>, you can simulate the unification in your head the following way.</p>\n\n<p>The first <code>zipWith</code> has type <code>(a -&gt; b -&gt; c) -&gt; ([a] -&gt; [b] -&gt; [c])</code>, the second <code>(s -&gt; t -&gt; u) -&gt; ([s] -&gt; [t] -&gt; [u])</code> and <code>(.)</code> has type <code>(m -&gt; n) -&gt; (o -&gt; m) -&gt; (o -&gt; n)</code>.</p>\n\n<p>For it to typecheck, you need:</p>\n\n<ul>\n<li><code>m</code> = <code>(a -&gt; b -&gt; c)</code></li>\n<li><code>n</code> = <code>([a] -&gt; [b] -&gt; [c])</code></li>\n<li><code>o</code> = <code>(s -&gt; t -&gt; u)</code></li>\n<li><code>m</code> = <code>([s] -&gt; [t] -&gt; [u])</code> => <code>a</code> = <code>[s]</code>, <code>b</code> = <code>[t]</code>, <code>c</code> = <code>[u]</code> because of the first constraint</li>\n</ul>\n\n<p>Then the returned type is <code>o -&gt; n</code> which is <code>(s -&gt; t -&gt; u) -&gt; ([a] -&gt; [b] -&gt; [c])</code> from the constraints and going one step further <code>(s -&gt; t -&gt; u) -&gt; ([[s]] -&gt; [[t]] -&gt; [[u]])</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 1, "last_activity_date": 1507380102, "creation_date": 1507380102, "answer_id": 46620242, "question_id": 46619990, "link": "https://stackoverflow.com/questions/46619990/why-does-zipwith-zipwith-work/46620242#46620242", "title": "Why does zipWith.zipWith work?", "body": "<p>Yes, <code>.</code> is the normal function composition operator:</p>\n\n<pre><code>Prelude&gt; :type (.)\n(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n</code></pre>\n\n<p>One way to look at it is that it takes an <code>a</code> value, first calls the <code>a -&gt; b</code> function, and then uses the return value of that function to call the <code>b -&gt; c</code> function. The result is a <code>c</code> value.</p>\n\n<p>Another way to look at <code>(zipWith . zipWith)</code>, then, is to perform an eta expansion:</p>\n\n<pre><code>Prelude&gt; :type (zipWith . zipWith)\n(zipWith . zipWith) :: (a -&gt; b -&gt; c) -&gt; [[a]] -&gt; [[b]] -&gt; [[c]]\n\nPrelude&gt; :t (\\x -&gt; zipWith $ zipWith x)\n(\\x -&gt; zipWith $ zipWith x)\n  :: (a -&gt; b -&gt; c) -&gt; [[a]] -&gt; [[b]] -&gt; [[c]]\n\nPrelude&gt; :t (\\x -&gt; zipWith (zipWith x))\n(\\x -&gt; zipWith (zipWith x))\n  :: (a -&gt; b -&gt; c) -&gt; [[a]] -&gt; [[b]] -&gt; [[c]]\n</code></pre>\n\n<p>The type of <code>zipWith</code> itself:</p>\n\n<pre><code>Prelude&gt; :type zipWith\nzipWith :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]\n</code></pre>\n\n<p>So, in the above lambda expression, <code>x</code> must be <code>(a -&gt; b -&gt; c)</code>, and hence <code>zipWith x</code> must have the type <code>[a] -&gt; [b] -&gt; [c]</code>.</p>\n\n<p>The <em>outer</em> <code>zipWith</code> also needs a function <code>(a1 -&gt; b1 -&gt; c1)</code>, which matches <code>zipWith x</code> if <code>a1</code> is <code>[a]</code>, <code>b1</code> is <code>[b]</code>, and <code>c1</code> is <code>[c]</code>.</p>\n\n<p>So, by replacement, <code>zipWith (zipWith x)</code> must have the type <code>[[a]] -&gt; [[b]] -&gt; [[c]]</code>, and therefore the type of the lambda expression is <code>(a -&gt; b -&gt; c) -&gt; [[a]] -&gt; [[b]] -&gt; [[c]]</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1507386150, "post_id": 46620379, "comment_id": 80193273, "body": "Or... <code>(&lt;*&gt;) . ((+) &lt;$&gt;) &lt;$&gt; l1 &lt;*&gt; l2</code> without <code>Data.Functor.Compose</code>."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 1, "creation_date": 1507387981, "post_id": 46620379, "comment_id": 80193804, "body": "@Redu While more compact, I find the newtype-less version more difficult to understand."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 1, "creation_date": 1507388338, "post_id": 46620379, "comment_id": 80193900, "body": "Yes i have to agree that point-free sometimes might seem confusing at first glance. Basically <code>(&lt;*&gt;) . ((+) &lt;$&gt;)</code> is ` \\x y -&gt; (+) &lt;$&gt; x &lt;*&gt; y`."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 2, "last_activity_date": 1507382765, "last_edit_date": 1507382765, "creation_date": 1507380992, "answer_id": 46620379, "question_id": 46619990, "link": "https://stackoverflow.com/questions/46619990/why-does-zipwith-zipwith-work/46620379#46620379", "title": "Why does zipWith.zipWith work?", "body": "<p>Another way of seeing it is that lists with the zipping operation form an <code>Applicative</code>, and the <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Functor-Compose.html#t:Compose\" rel=\"nofollow noreferrer\">composition</a> (nesting) of <code>Applicative</code>s is still <code>Applicative</code>:</p>\n\n<pre><code>\u03bb import Control.Applicative\n\u03bb import Data.Functor.Compose\n\u03bb let l1 = ZipList [ZipList [1,2,3], ZipList [4,5,6]]\n\u03bb let l2 = ZipList [ZipList [7,8,9], ZipList [10,11,12]]\n\u03bb getCompose $ (+) &lt;$&gt; Compose l1 &lt;*&gt; Compose l2\nZipList {getZipList = [ZipList {getZipList = [8,10,12]},\n                       ZipList {getZipList = [14,16,18]}]}\n</code></pre>\n\n<p>The <code>ZipList</code> newtype is required because \"bare\" lists have a different <code>Applicative</code> instance, which forms all combinations instead of zipping.</p>\n"}], "owner": {"reputation": 1306, "user_id": 5664775, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/QqQGd.jpg?s=128&g=1", "display_name": "Luke Collins", "link": "https://stackoverflow.com/users/5664775/luke-collins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 558, "favorite_count": 1, "accepted_answer_id": 46620146, "answer_count": 3, "score": 3, "last_activity_date": 1507382765, "creation_date": 1507378490, "last_edit_date": 1507380277, "question_id": 46619990, "link": "https://stackoverflow.com/questions/46619990/why-does-zipwith-zipwith-work", "title": "Why does zipWith.zipWith work?", "body": "<p>I am implementing a function <code>combine :: [[a]] -&gt; [[b]] -&gt; (a -&gt; b -&gt; c) -&gt; [[c]]</code> which given two 2D lists, applies a given function <code>f :: a -&gt; b -&gt; c</code> to the entries of the 2D list. In other words:</p>\n\n<pre><code>          [[a, b, c],    [[r, s, t],          [[f a r, f b s, f c t], \ncombine    [d, e, g],     [u, v, w],   f   =   [f d u, f e v, f g w],\n           [h, i, j]]     [x, y, z]]           [f h x, f i y, f j z]]\n</code></pre>\n\n<p>Now I suspect that <code>combine = zipWith . zipWith</code>, because I have tried it out and it is giving me the intended results, e.g.</p>\n\n<pre><code>(zipWith . zipWith) (\\x y -&gt; x+y) [[1,2,3],[4,5,6]] [[7,8,9],[10,11,12]]\n</code></pre>\n\n<p>gives the expected result <code>[[8,10,12],[14,16,18]]</code>, but I cannot understand why this works, because I don't understand how the type of <code>zipWith . zipWith</code> turns out to be <code>(a -&gt; b -&gt; c) -&gt; [[a]] -&gt; [[b]] -&gt; [[c]]</code>. </p>\n\n<p>Is <code>(.)</code> here still carrying out the usual function composition? If so, can you explain how this applies to <code>zipWith</code>?  </p>\n"}, {"tags": ["haskell", "atom-editor", "linter"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1507383808, "post_id": 46619290, "comment_id": 80192561, "body": "maybe you can write an hlint rule to achieve that"}], "owner": {"reputation": 7435, "user_id": 4617597, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/b1Sdw.png?s=128&g=1", "display_name": "Marcelo Lazaroni", "link": "https://stackoverflow.com/users/4617597/marcelo-lazaroni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 43, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1507373015, "creation_date": 1507373015, "question_id": 46619290, "link": "https://stackoverflow.com/questions/46619290/enforce-space-between-functions-with-haskell-linter", "title": "Enforce space between functions with Haskell linter", "body": "<p>I want to enforce a space of exactly two lines between my top-level function declarations in Haskell.</p>\n\n<p>Is there any linter for Atom (or any other editor) that allows that?</p>\n"}, {"tags": ["list", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 1306, "user_id": 5664775, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/QqQGd.jpg?s=128&g=1", "display_name": "Luke Collins", "link": "https://stackoverflow.com/users/5664775/luke-collins"}, "edited": false, "score": 0, "creation_date": 1507372964, "post_id": 46619266, "comment_id": 80189667, "body": "Wow - it sure is :)"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 7, "last_activity_date": 1507372864, "creation_date": 1507372864, "answer_id": 46619266, "question_id": 46619214, "link": "https://stackoverflow.com/questions/46619214/zip-over-a-2d-list-in-haskell/46619266#46619266", "title": "Zip over a 2D List in Haskell", "body": "<pre><code>zip' = zipWith zip\n</code></pre>\n\n<p>Nice, isn't it?</p>\n"}], "owner": {"reputation": 1306, "user_id": 5664775, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/QqQGd.jpg?s=128&g=1", "display_name": "Luke Collins", "link": "https://stackoverflow.com/users/5664775/luke-collins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 318, "favorite_count": 0, "accepted_answer_id": 46619266, "answer_count": 1, "score": 2, "last_activity_date": 1507372864, "creation_date": 1507372403, "question_id": 46619214, "link": "https://stackoverflow.com/questions/46619214/zip-over-a-2d-list-in-haskell", "title": "Zip over a 2D List in Haskell", "body": "<p>I want to combine two 2-dimensional lists in Haskell using zip, i.e. achieve something like this </p>\n\n<pre><code>[[1,2,3],           [[10, 11, 12],         [[(1, 10), (2, 11), (3, 12)],\n [4,5,6],   `zip'`   [13, 14, 15],   -&gt;     [(4, 13), (5, 14), (6, 15)],\n [7,8,9]]            [16, 17, 18]]          [(7, 16), (8, 17), (9, 18)]]\n</code></pre>\n\n<p>without using any functions outside the Prelude. Is there a way this can be done, using <code>map</code> perhaps? The problem is that one cannot <code>map</code> <code>zip</code> over two lists. </p>\n"}, {"tags": ["c", "haskell", "module", "ffi"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 0, "last_activity_date": 1507356142, "creation_date": 1507356142, "answer_id": 46617174, "question_id": 46615754, "link": "https://stackoverflow.com/questions/46615754/how-to-import-a-haskell-module-that-uses-ffi-without-refering-to-the-c-object/46617174#46617174", "title": "How to import a haskell module that uses FFI without refering to the c object?", "body": "<p>You can create a library through Cabal, and <code>cabal install</code> it.</p>\n\n<p>This would link the C code inside your Haskell library. Later on, when you load the module, you will not need to manually load the C parts.</p>\n"}], "owner": {"reputation": 201, "user_id": 3594155, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/642d093fb5b3bf87d31dc0872c27e5d2?s=128&d=identicon&r=PG&f=1", "display_name": "Shane P Kelly", "link": "https://stackoverflow.com/users/3594155/shane-p-kelly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1507356142, "creation_date": 1507338767, "question_id": 46615754, "link": "https://stackoverflow.com/questions/46615754/how-to-import-a-haskell-module-that-uses-ffi-without-refering-to-the-c-object", "title": "How to import a haskell module that uses FFI without refering to the c object?", "body": "<p>I'm trying to write a haskell module that wraps a bunch of c functions.</p>\n\n<p>I want to be able to import this module like any other haskell module without referring to the c object files.</p>\n\n<p>I can't find any examples about how to do this.</p>\n\n<p>This is what I've tried. I have a c file \"dumbCfunctions.c\":</p>\n\n<pre><code>double addThree(double x) {\n     return x+3;\n}\n</code></pre>\n\n<p>and a haskell file with a module defined in it \"Callfunctions.hs\"</p>\n\n<pre><code>module Callfunctions (\naddThree\n) where\n\nimport Foreign.C\nforeign import ccall \"addThree\" addThree :: Double -&gt; Double\n\nmain = print $ addThree 4\n</code></pre>\n\n<p>I can make an executable doing:\n    ghc --make -o cf_ex Callfunctions.hs dumbCfunctions.o</p>\n\n<p>Which correctly gives me 7.</p>\n\n<p>I can also import it into ghic by calling ghci with</p>\n\n<pre><code>shane&gt; ghci dumbCfunctions.o\nPrelude&gt; :l Callfunctions.hs\n[1 of 1] Compiling Callfunctions    ( Callfunctions.hs, interpreted )\n Ok, modules loaded: Callfunctions.\n*Callfunctions&gt; addThree 3\n6.0\n</code></pre>\n\n<p>But I want to be able to treat it like any other module with out referring to \"dumbCfunctions.o\":</p>\n\n<pre><code>shane&gt; ghci\nPrelude&gt; :l Callfunctions.hs\n[1 of 1] Compiling Callfunctions    ( Callfunctions.hs, interpreted )\n Ok, modules loaded: Callfunctions.\n*Callfunctions&gt; addThree 3\n</code></pre>\n\n<p>But now I get the error</p>\n\n<pre><code>ByteCodeLink: can't find label\nDuring interactive linking, GHCi couldn't find the following symbol:\n  addThree\nThis may be due to you not asking GHCi to load extra object files,\narchives or DLLs needed by your current session.  Restart GHCi, specifying\nthe missing library using the -L/path/to/object/dir and -lmissinglibname\nflags, or simply by naming the relevant files on the GHCi command line.\nAlternatively, this link failure might indicate a bug in GHCi.\nIf you suspect the latter, please send a bug report to:\n  glasgow-haskell-bugs@haskell.org\n</code></pre>\n\n<p>This makes sense because I haven't refereed to the object anywhere.  So I must be able to do something better by first compiling the module, but I couldn't find out how to do this. I must be looking in the wrong places.</p>\n"}, {"tags": ["haskell", "parallel-processing"], "answers": [{"tags": [], "owner": {"reputation": 934, "user_id": 7459445, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GBpx1.png?s=128&g=1", "display_name": "Claude", "link": "https://stackoverflow.com/users/7459445/claude"}, "is_accepted": true, "score": 5, "last_activity_date": 1507325619, "creation_date": 1507325619, "answer_id": 46614212, "question_id": 46613397, "link": "https://stackoverflow.com/questions/46613397/partraversable-not-creating-any-sparks/46614212#46614212", "title": "parTraversable not creating any sparks", "body": "<p>I can reproduce your behaviour (ghc-8.2.1, parallel-3.2.1.1).</p>\n\n<p>Later on down the <code>Strategies.hs</code> is a <code>RULES</code> pragma that special-cases <code>parList rseq</code>.  I guess it is a bug that it has different behaviour to <code>parTraversable</code> (I don't know enough about the internals to be sure where the bug lies).  I'd suggest filing a ticket at the <code>parallel</code> issue tracker: <a href=\"https://github.com/haskell/parallel/issues\" rel=\"noreferrer\">https://github.com/haskell/parallel/issues</a></p>\n\n<p>Here is the code in question, starting at line 505 of the file:</p>\n\n<pre><code>-- Non-compositional version of 'parList', evaluating list elements\n-- to weak head normal form.\n-- Not to be exported; used for optimisation.\n\n-- | DEPRECATED: use @'parList' 'rseq'@ instead\nparListWHNF :: Strategy [a]\nparListWHNF xs = go xs `pseq` return xs\n  where -- go :: [a] -&gt; [a]\n           go []     = []\n           go (y:ys) = y `par` go ys\n\n-- The non-compositional 'parListWHNF' might be more efficient than its\n-- more compositional counterpart; use RULES to do the specialisation.\n\n{-# NOINLINE [1] parList #-}\n{-# NOINLINE [1] rseq #-}\n{-# RULES\n \"parList/rseq\" parList rseq = parListWHNF\n #-}\n</code></pre>\n"}], "owner": {"reputation": 4681, "user_id": 1264328, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/786f8275d9fa334bc27630e0fc7f0d22?s=128&d=identicon&r=PG", "display_name": "bwroga", "link": "https://stackoverflow.com/users/1264328/bwroga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 46614212, "answer_count": 1, "score": 4, "last_activity_date": 1507325619, "creation_date": 1507321135, "question_id": 46613397, "link": "https://stackoverflow.com/questions/46613397/partraversable-not-creating-any-sparks", "title": "parTraversable not creating any sparks", "body": "<p>When I run this program with <code>-s</code>:</p>\n\n<pre><code>module Main where\n\nimport Control.Parallel.Strategies\n\nmain :: IO ()\nmain = do let xs = take 1000 $ product . take 1000 . repeat &lt;$&gt; [1..]\n              x  = product (xs `using` parList rseq)\n          putStrLn (show x)\n</code></pre>\n\n<p>Sparks are created:</p>\n\n<blockquote>\n  <p>SPARKS: 1000 (993 converted, 0 overflowed, 0 dud, 6 GC'd, 1 fizzled)</p>\n</blockquote>\n\n<p>If I change <code>parList</code> to <code>parTraversable</code> </p>\n\n<pre><code>x  = product (xs `using` parTraversable rseq)\n</code></pre>\n\n<p>no sparks are created:</p>\n\n<blockquote>\n  <p>SPARKS: 0 (0 converted, 0 overflowed, 0 dud, 0 GC'd, 0 fizzled)</p>\n</blockquote>\n\n<p>If I change <code>rseq</code> to <code>rdeepseq</code>:</p>\n\n<pre><code>main = do let xs = (take 1000 $ product . take 1000 . repeat &lt;$&gt; [1..]) :: [Integer]\n              x  = product (xs `using` parList rdeepseq)\n          putStrLn (show x)\n</code></pre>\n\n<p>No sparks are created</p>\n\n<blockquote>\n  <p>SPARKS: 0 (0 converted, 0 overflowed, 0 dud, 0 GC'd, 0 fizzled)</p>\n</blockquote>\n\n<p>I am using parallel-3.2.1.1 and in the source code, <code>parList</code> is defined using <code>parTraversable</code> !</p>\n\n<pre><code>parList :: Strategy a -&gt; Strategy [a]\nparList = parTraversable\n</code></pre>\n\n<p>What am I missing?</p>\n"}, {"tags": ["haskell", "syntax"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 2, "creation_date": 1507321179, "post_id": 46613393, "comment_id": 80178843, "body": "Please post code, errors, sample data or textual output here as plain-text, not as images that can be hard to read, can\u2019t be copy-pasted to help test code or use in answers, and are hostile to those who use screen readers. You can edit your question to add the code in the body of your question. Use the <code>{}</code> button to format any blocks of code, or indent with four spaces for the same effect. We can&#39;t run your screenshot as code."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 3, "creation_date": 1507321681, "post_id": 46613393, "comment_id": 80179052, "body": "Please post the error message, verbatim."}], "answers": [{"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 2, "last_activity_date": 1507321864, "last_edit_date": 1507321864, "creation_date": 1507321662, "answer_id": 46613489, "question_id": 46613393, "link": "https://stackoverflow.com/questions/46613393/haskell-syntax-error/46613489#46613489", "title": "Haskell - Syntax error", "body": "<p>This is how Haskell sees your code:</p>\n\n<pre><code>parseS (s:xs)\n        | all isDigit s = (xs, Lit (read s)) \n        | s == \" \" = parseS xs\n        | s == \"-\" = let (remainder, e) = parseS xs in (remainder, Sub e)\n        | s == \"+\" = (xs'', Sum e e')\n    where\n    (xs', e) = parseS xs \n    (xs'', e') = parseS xs' \n\n| s == \"*\" = (xs'', Mul e e')\n    where\n    (xs', e) = parseS xs \n    (xs'', e') = parseS xs'\n</code></pre>\n\n<p>A <code>where</code> block attaches to a declaration, which in your case is the whole <code>parseS</code> definition.</p>\n\n<p>The next line starting with <code>|</code> is seen as the start of a new declaration, which is invalid because you can't start a declaration with <code>|</code>.</p>\n\n<p>The easiest fix is to stop using <code>where</code> for local bindings and use <code>let</code> instead, like this:</p>\n\n<pre><code>          | s == \"+\" =\n              let\n                  (xs', e) = parseS xs \n                  (xs'', e') = parseS xs' \n              in\n              (xs'', Sum e e')\n\n          | s == \"*\" =\n              let\n                  (xs', e) = parseS xs \n                  (xs'', e') = parseS xs'\n              in\n              (xs'', Mul e e')\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 3, "last_activity_date": 1507321789, "creation_date": 1507321789, "answer_id": 46613515, "question_id": 46613393, "link": "https://stackoverflow.com/questions/46613393/haskell-syntax-error/46613515#46613515", "title": "Haskell - Syntax error", "body": "<p>The problem is that the first <code>where</code> clause is taken as the end of the definition for <code>parseS (s:xs)</code>.  You're trying to add another guarded case afterwards, but the parser doesn't see it as attached to the same definition.</p>\n\n<p>There's several ways you could fix this.</p>\n\n<p>You <em>could</em> fix this by using a <code>let ... in</code> instead for <code>s == \"+\"</code></p>\n\n<pre><code>      | s == \"+\" = let (xs', e) = parseS xs\n                       (xs'', e') = parseS xs\n                   in (xs'', Sum e e')\n      | s == \"*\" = (xs'', Mul e e') where\n                       (xs', e) = parseS xs \n                       (xs'', e') = parseS xs'  \n</code></pre>\n\n<p>But there's an easier way to do it - just drop that <code>where</code> clause.</p>\n\n<pre><code>      | s == \"+\" = (xs'', Sum e e')\n      | s == \"*\" = (xs'', Mul e e') where\n                       (xs', e) = parseS xs \n                       (xs'', e') = parseS xs'  \n</code></pre>\n\n<p>The variables defined in a <code>where</code> clause are in scope for the entirety of a definition (for all guard cases), so your definition of <code>xs''</code> can be reused for both cases.</p>\n"}], "owner": {"reputation": 77, "user_id": 5838116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/mlwk4.png?s=128&g=1", "display_name": "iIllumination", "link": "https://stackoverflow.com/users/5838116/iillumination"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 46613489, "answer_count": 2, "score": 2, "last_activity_date": 1507321864, "creation_date": 1507321110, "last_edit_date": 1507321717, "question_id": 46613393, "link": "https://stackoverflow.com/questions/46613393/haskell-syntax-error", "title": "Haskell - Syntax error", "body": "<p>Can someone please tell me what is wrong here? I can't figure out where the error is. I'm new to haskell, so I don't know every rule of syntax atm. </p>\n\n<pre><code>parseS (s:xs) | all isDigit s = (xs, Lit (read s)) \n          | s == \" \" = parseS xs\n          | s == \"-\" = let (remainder, e) = parseS xs in (remainder, Sub e)\n          | s == \"+\" = (xs'', Sum e e') where\n                       (xs', e) = parseS xs \n                       (xs'', e') = parseS xs' \n\n          | s == \"*\" = (xs'', Mul e e') where     &lt;- parse error on input on this line\n                       (xs', e) = parseS xs \n                       (xs'', e') = parseS xs'  \n</code></pre>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"comments": [{"owner": {"reputation": 71, "user_id": 3679331, "user_type": "registered", "profile_image": "https://graph.facebook.com/521210191/picture?type=large", "display_name": "ricardos", "link": "https://stackoverflow.com/users/3679331/ricardos"}, "edited": false, "score": 2, "creation_date": 1507364181, "post_id": 46614256, "comment_id": 80187497, "body": "Good enough for my case :)"}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 4, "last_activity_date": 1507325851, "creation_date": 1507325851, "answer_id": 46614256, "question_id": 46612655, "link": "https://stackoverflow.com/questions/46612655/how-to-disable-get-logout-in-yesod/46614256#46614256", "title": "How to disable GET Logout in Yesod?", "body": "<p>One thing (not tested) which will likely work is adding a definition for it in the <code>Yesod</code> instance. Something like this:</p>\n\n<pre><code>instance Yesod App where\n\n    isAuthorized (AuthR LogoutR) False = return $ Unauthorized \"must be admin\"\n</code></pre>\n\n<p>The <code>False</code> is to make sure that it will only operate on <code>GET</code> request.</p>\n"}], "owner": {"reputation": 71, "user_id": 3679331, "user_type": "registered", "profile_image": "https://graph.facebook.com/521210191/picture?type=large", "display_name": "ricardos", "link": "https://stackoverflow.com/users/3679331/ricardos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1507325851, "creation_date": 1507317935, "question_id": 46612655, "link": "https://stackoverflow.com/questions/46612655/how-to-disable-get-logout-in-yesod", "title": "How to disable GET Logout in Yesod?", "body": "<p>Is it possible to get rid of GET /auth/logout = getLogoutR? or change its behavior? similar to the loginHandler in the YesodAuth</p>\n\n<p>Basically, I want to prevent somebody to send a link to naive users that will logout them.</p>\n"}, {"tags": ["function", "haskell", "xor"], "comments": [{"owner": {"reputation": 54, "user_id": 4309230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d55132f900d82089522c457076207f1?s=128&d=identicon&r=PG&f=1", "display_name": "Lein Matsumaru", "link": "https://stackoverflow.com/users/4309230/lein-matsumaru"}, "edited": false, "score": 0, "creation_date": 1507331125, "post_id": 46611489, "comment_id": 80182029, "body": "Thank you guys for answering my stupid question :$"}], "answers": [{"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 7, "last_activity_date": 1507313264, "creation_date": 1507313264, "answer_id": 46611596, "question_id": 46611489, "link": "https://stackoverflow.com/questions/46611489/haskell-xor-not-work-for-mapping/46611596#46611596", "title": "Haskell xor not work for mapping", "body": "<p>If you want to use functions in infix notation you have to use backtick syntax.</p>\n\n<pre><code>xorFunc :: [Int] -&gt; [Int] -&gt; [Int]\nxorFunc xs ys = zipWith (\\x y -&gt; x `xor` y) xs ys\n</code></pre>\n\n<p>but this can be solved a bit simpler by not writing this as a lambda expression</p>\n\n<pre><code>xorFunc :: [Int] -&gt; [Int] -&gt; [Int]\nxorFunc xs ys = zipWith xor xs ys\n</code></pre>\n\n<p>and applying eta reduce (twice), i.e. omitting parameters that are occurring in the last position and can be fully derived by the type checker.</p>\n\n<pre><code>xorFunc :: [Int] -&gt; [Int] -&gt; [Int]\nxorFunc = zipWith xor\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1507313273, "creation_date": 1507313273, "answer_id": 46611599, "question_id": 46611489, "link": "https://stackoverflow.com/questions/46611489/haskell-xor-not-work-for-mapping/46611599#46611599", "title": "Haskell xor not work for mapping", "body": "<p>Infix functions are spelled with punctuation and can be made prefix with parentheses; e.g. <code>x + y</code> can also be spelled <code>(+) x y</code>. Going the other direction, prefix functions are spelled with letters and can be made infix with backticks; e.g. <code>zip xs ys</code> can also be spelled <code>xs `zip` ys</code>.</p>\n\n<p>Applying that to your case, this means you should write one of <code>xor x y</code> or <code>x `xor` y</code> instead of <code>x xor y</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 3, "last_activity_date": 1507313293, "creation_date": 1507313293, "answer_id": 46611604, "question_id": 46611489, "link": "https://stackoverflow.com/questions/46611489/haskell-xor-not-work-for-mapping/46611604#46611604", "title": "Haskell xor not work for mapping", "body": "<p><code>xor</code> is a regular function name, not an operator. You need to enclose it in backquotes to use as an infix operator.</p>\n\n<pre><code>xorFunc xs ys = zipWith (\\x y -&gt; x `xor` y) xs ys\n</code></pre>\n\n<p>That said, your lambda expressions aren't necessary; just use <code>xor</code> as argument to <code>zip</code>:</p>\n\n<pre><code>xorFunc xs ys = zipWith xor xs ys\n</code></pre>\n\n<p>or simply</p>\n\n<pre><code>xorFunc = zipWith xor\n</code></pre>\n\n<p>(Likewise, <code>andFunc = zipWith (.&amp;.)</code>; enclose the operator in parentheses to use it as a function value.)</p>\n"}], "owner": {"reputation": 54, "user_id": 4309230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d55132f900d82089522c457076207f1?s=128&d=identicon&r=PG&f=1", "display_name": "Lein Matsumaru", "link": "https://stackoverflow.com/users/4309230/lein-matsumaru"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 490, "favorite_count": 0, "accepted_answer_id": 46611596, "answer_count": 3, "score": 2, "last_activity_date": 1507313419, "creation_date": 1507312844, "last_edit_date": 1507313419, "question_id": 46611489, "link": "https://stackoverflow.com/questions/46611489/haskell-xor-not-work-for-mapping", "title": "Haskell xor not work for mapping", "body": "<p>I have a problem of using <code>xor</code> function in <code>Data.Bits</code> module\nlike a code below\n</p>\n\n<pre><code>import Data.Bits\n\nandFunc :: [Int] -&gt; [Int] -&gt; [Int]\nandFunc xs ys = zipWith (\\x y -&gt; x .&amp;. y) xs ys\n\nxorFunc :: [Int] -&gt; [Int] -&gt; [Int]\nxorFunc xs ys = zipWith (\\x y -&gt; x xor y) xs ys\n</code></pre>\n\n<p>When I try to apply <code>andFunc</code> with arguments of <code>[1..10]</code> and <code>[2..11]</code> (arguments are just arbitrary array)</p>\n\n<p>it works. (Does not write here, but <code>orFunc (.|.)</code> also works)</p>\n\n<p>but some reasons, <code>xorFunc</code> does not.... and says</p>\n\n<pre><code>&lt;interactive&gt;:74:1: error:\n    ? Non type-variable argument\n        in the constraint: Enum ((a -&gt; a -&gt; a) -&gt; t -&gt; c)\n      (Use FlexibleContexts to permit this)\n    ? When checking the inferred type\n        it :: forall a t c.\n              (Enum ((a -&gt; a -&gt; a) -&gt; t -&gt; c), Enum t,\n               Num ((a -&gt; a -&gt; a) -&gt; t -&gt; c), Num t, Bits a) =&gt;\n              [c]\n</code></pre>\n\n<p>Do you know why?</p>\n\n<p>Running Environment:\n   GHC 8.2.1 with no flags\n   Windows 10 64 bit</p>\n"}, {"tags": ["scala", "haskell", "functional-programming", "ocaml"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1507320209, "post_id": 46610791, "comment_id": 80178392, "body": "I&#39;m rather curious why you need this operation. It seems a bit surprising."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1507311134, "creation_date": 1507311134, "answer_id": 46611086, "question_id": 46610791, "link": "https://stackoverflow.com/questions/46610791/functional-way-to-split-a-map-of-lists-into-a-list-of-maps/46611086#46611086", "title": "Functional way to split a map of lists into a list of maps", "body": "<p>In Haskell:</p>\n\n<pre><code>&gt; import qualified Data.Map as M\n&gt; import Data.List\n&gt; m = M.fromList [(1,[\"a\",\"b\",\"c\"]), (2,[\"d\",\"e\"]), (3,[\"f\"])]\n&gt; map M.fromList . transpose . map (\\(i,xs) -&gt; map ((,) i) xs) . M.toList $ m\n[fromList [(1,\"a\"),(2,\"d\"),(3,\"f\")],fromList [(1,\"b\"),(2,\"e\")],fromList [(1,\"c\")]]\n</code></pre>\n\n<p><code>M.toList</code> and <code>M.fromList</code> convert a map to a list of association pairs, and back.</p>\n\n<p><code>map ((,) i) xs</code> is the same as <code>[(i,x) | x&lt;-xs]</code>, adding <code>(i,...)</code> to each element.</p>\n\n<p><code>transpose</code> exchanges the \"rows\" and \"columns\" in a list of lists, similarly to a matrix transposition.</p>\n"}, {"tags": [], "owner": {"reputation": 35368, "user_id": 5344058, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-stTbjZ7x-P8/AAAAAAAAAAI/AAAAAAAAAAo/Sd95DB3qdzQ/photo.jpg?sz=128", "display_name": "Tzach Zohar", "link": "https://stackoverflow.com/users/5344058/tzach-zohar"}, "is_accepted": false, "score": 4, "last_activity_date": 1507312249, "creation_date": 1507312249, "answer_id": 46611344, "question_id": 46610791, "link": "https://stackoverflow.com/questions/46610791/functional-way-to-split-a-map-of-lists-into-a-list-of-maps/46611344#46611344", "title": "Functional way to split a map of lists into a list of maps", "body": "<p>In Scala:</p>\n\n<pre><code>val result = x.toList\n  .flatMap { case (k, vs) =&gt; vs.zipWithIndex.map { case (v, i) =&gt; (i, k, v) } } // flatten and add indices to inner lists\n  .groupBy(_._1)                 // group by index\n  .toList.sortBy(_._1).map(_._2) // can be replaced with .values if order isn't important\n  .map(_.map { case (_, k, v) =&gt; (k, v) }.toMap) // remove indices\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 57265, "user_id": 821679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64f564c4721ee3125fa835f6c3a5283c?s=128&d=identicon&r=PG", "display_name": "Jeffrey Scofield", "link": "https://stackoverflow.com/users/821679/jeffrey-scofield"}, "is_accepted": false, "score": 2, "last_activity_date": 1507312731, "creation_date": 1507312731, "answer_id": 46611455, "question_id": 46610791, "link": "https://stackoverflow.com/questions/46610791/functional-way-to-split-a-map-of-lists-into-a-list-of-maps/46611455#46611455", "title": "Functional way to split a map of lists into a list of maps", "body": "<p>Here is my answer in OCaml (using just Standard Library):</p>\n\n<pre><code>module M = Map.Make(struct type t = int let compare = compare end)\n\nlet of_bindings b =\n    List.fold_right (fun (k, v) m -&gt; M.add k v m) b M.empty\n\nlet splitmap m =\n    let split1 (k, v) (b1, b2) =\n        match v with\n        | [] -&gt; (b1, b2)\n        | [x] -&gt; ((k, x) :: b1, b2)\n        | h :: t -&gt; ((k, h) :: b1, (k, t) :: b2)\n    in\n    let rec loop sofar m =\n        if M.cardinal m = 0 then\n            List.rev sofar\n        else\n            let (b1, b2) =\n                List.fold_right split1 (M.bindings m) ([], [])\n            in\n            let (ms, m') = (of_bindings b1, of_bindings b2) in\n            loop (ms :: sofar) m'\n    in\n    loop [] m\n</code></pre>\n\n<p>It works for me:</p>\n\n<pre><code># let m = of_bindings [(1, [\"a\"; \"b\"; \"c\"]); (2, [\"d\"; \"e\"]); (3, [\"f\"])];;\nval m : string list M.t = &lt;abstr&gt;\n# let ms = splitmap m;;\nval ms : string M.t list = [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;]\n# List.map M.bindings ms;;\n- : (M.key * string) list list =\n[[(1, \"a\"); (2, \"d\"); (3, \"f\")]; [(1, \"b\"); (2, \"e\")]; [(1, \"c\")]]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 19418, "user_id": 6316508, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e180f7687c8907b55267646b066d7898?s=128&d=identicon&r=PG&f=1", "display_name": "Leo C", "link": "https://stackoverflow.com/users/6316508/leo-c"}, "is_accepted": false, "score": 5, "last_activity_date": 1507318074, "creation_date": 1507318074, "answer_id": 46612690, "question_id": 46610791, "link": "https://stackoverflow.com/questions/46610791/functional-way-to-split-a-map-of-lists-into-a-list-of-maps/46612690#46612690", "title": "Functional way to split a map of lists into a list of maps", "body": "<p>Borrowing a neat <code>transpose</code> method from this <a href=\"https://stackoverflow.com/a/1684814/6316508\">SO answer</a>, here's another way to do it:</p>\n\n<pre><code>def transpose[A](xs: List[List[A]]): List[List[A]] = xs.filter(_.nonEmpty) match {    \n  case Nil =&gt;  Nil\n  case ys: List[List[A]] =&gt; ys.map{ _.head }::transpose(ys.map{ _.tail })\n}\n\ntranspose[(Int, String)](\n  x.toList.map{ case (k, v) =&gt; v.map( (k, _) ) }\n).map{ _.toMap }\n\n// Res1: List[scala.collection.immutable.Map[Int,String]] = List(\n//   Map(1 -&gt; a, 2 -&gt; d, 3 -&gt; f), Map(1 -&gt; b, 2 -&gt; e), Map(1 -&gt; c)\n// )\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 8733740, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cae1ee315c4f3141c800b3157c1ad189?s=128&d=identicon&r=PG&f=1", "display_name": "puzzlement", "link": "https://stackoverflow.com/users/8733740/puzzlement"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 868, "favorite_count": 2, "accepted_answer_id": 46611086, "answer_count": 4, "score": 5, "last_activity_date": 1507318074, "creation_date": 1507310033, "question_id": 46610791, "link": "https://stackoverflow.com/questions/46610791/functional-way-to-split-a-map-of-lists-into-a-list-of-maps", "title": "Functional way to split a map of lists into a list of maps", "body": "<p>I'm a bit stuck on this problem. I feel like I'm \"thinking backwards\" and it's confusing me a bit.</p>\n\n<p>I have a <code>Map[Long, Seq[String]]</code> which I would like to convert into a <code>Seq[Map[Long, String]]</code>. Going the other direction is rather simple, as we can just group elements together, however, I'm not sure how to split this apart in a functional manner.</p>\n\n<p>So,</p>\n\n<pre><code>val x = Map(1 -&gt; List(\"a\",\"b\",\"c\"), 2 -&gt; List(\"d\", \"e\"), 3 -&gt; List(\"f\"))\n</code></pre>\n\n<p>should become</p>\n\n<pre><code>List(Map(1 -&gt; \"a\", 2 -&gt; \"d\", 3 -&gt; \"f\"), Map(1 -&gt; \"b\", 2 -&gt; \"e\"), Map(1 -&gt; \"c\"))\n</code></pre>\n\n<p>I was thinking along the lines of using <code>x.partition</code> and then recursing on each resulting tuple, but I'm not really sure what I'd partition on :/</p>\n\n<p>I'm writing in scala, but any functional answer is welcome (language agnostic).</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "edited": false, "score": 3, "creation_date": 1507298044, "post_id": 46607067, "comment_id": 80166556, "body": "I&#39;d start with <code>readFile</code>, <code>splitOn</code>, and <code>read</code>, and then post what you have as a question."}], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 4, "creation_date": 1507304555, "post_id": 46607580, "comment_id": 80170659, "body": "Or with lazy IO if you&#39;d like: <code>map words . take 6  . lines &lt;$&gt; getContents :: IO [[String]]</code>.  Or with <code>Control.Monad</code> imported: <code>map words &lt;$&gt; replicateM 6 readLn</code>."}], "tags": [], "owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "is_accepted": true, "score": 6, "last_activity_date": 1507298952, "last_edit_date": 1507298952, "creation_date": 1507298608, "answer_id": 46607580, "question_id": 46607067, "link": "https://stackoverflow.com/questions/46607067/how-get-limited-number-of-input-in-haskell/46607580#46607580", "title": "How get limited number of input in Haskell", "body": "<p>There are three steps to this:</p>\n\n<ol>\n<li>Read 6 lines</li>\n<li>Break each line into the (hopefully three) parts</li>\n<li>Convert to the desired result</li>\n</ol>\n\n<p>Some sample code is below:</p>\n\n<pre><code>input = do\n  lines &lt;- sequence $ take 6 $ repeat readLn\n  let table = words &lt;$&gt; lines\n  return [(a, b, c) | [a,b,c] &lt;- table]\n</code></pre>\n\n<p>This gives <code>input :: IO [(String, String, String)]</code> but I'm sure you could modify this to give you what you want.</p>\n"}], "owner": {"reputation": 45, "user_id": 6136015, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/1196526490360559/picture?type=large", "display_name": "Sasithorn Hannarong", "link": "https://stackoverflow.com/users/6136015/sasithorn-hannarong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 46607580, "answer_count": 1, "score": 2, "last_activity_date": 1507298952, "creation_date": 1507297017, "last_edit_date": 1507297118, "question_id": 46607067, "link": "https://stackoverflow.com/questions/46607067/how-get-limited-number-of-input-in-haskell", "title": "How get limited number of input in Haskell", "body": "<p>I am a newbie in Haskell.\nLet says my program want to calculate something from this pattern of input:</p>\n\n<pre><code>a1 b1 c1\na2 b2 c2\n...\n16 b6 c6\n</code></pre>\n\n<p>The input contains 6 lines and each line has 3 numbers\nI want to get data as [(Integer, Integer, Integer)] but limit the length of the list to be only 6 before going to the calculation.</p>\n\n<p>How could I do this? Also, how could I get a length from [(Integer, Integer, Integer)]</p>\n\n<p>Thank you for your help</p>\n"}, {"tags": ["haskell", "architecture", "microservices"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 1, "creation_date": 1507295296, "post_id": 46605663, "comment_id": 80164759, "body": "If you have two services that share types, then those two types are coupled to each other. Then what&#39;s the point of making them microservices? Why not define each as a separate module, and compose them both into a single executable? In that way, the compiler will tell you whether or not the two modules can communicate with each other."}, {"owner": {"reputation": 3248, "user_id": 1262542, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7cf2d499caed8b2c28ccc311ddffaeb?s=128&d=identicon&r=PG", "display_name": "Stefan Hanke", "link": "https://stackoverflow.com/users/1262542/stefan-hanke"}, "edited": false, "score": 1, "creation_date": 1507297417, "post_id": 46605663, "comment_id": 80166133, "body": "Hmm - e.g. for communication purposes, IMO it makes sense to have one &quot;definition of truth&quot; (type definitions and their serializer/deserializer code), possibly coupling multiple services. One service creates instances, sends them over the wire, another one consumes them. In the end, coupling is inevitable, you only have to choose where it happens."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1507316648, "post_id": 46605663, "comment_id": 80176726, "body": "whether you want to run services in separate executables, or different threads in the same executable is a separate issue from whether you want to have your code in different repos (you want to structure your project so that that&#39;s a boring question, which it is). I&#39;d suggest: keeping everything in the same repo, and when you have an obvious division consider separating into separate projects (in the same repo, all managed by stack) if you have a good justification (e.g. to be able to version dependencies differently) beyond some fuzzy notion of architectural aesthetics."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 0, "last_activity_date": 1507318068, "creation_date": 1507318068, "answer_id": 46612687, "question_id": 46605663, "link": "https://stackoverflow.com/questions/46605663/best-practices-sharing-types-across-multiple-haskell-packages-microservices/46612687#46612687", "title": "Best practices sharing types across multiple Haskell packages/microservices", "body": "<p>I know I'm spitting into the wind here, but since.</p>\n\n<ol>\n<li>these are <em>your</em> types for <em>your</em> microservices in <em>your</em> project;</li>\n<li>you want to separate instances from the type definitions only as a mechanism to separate concerns and not to \"open\" the type definition to random instances defined all over the place;</li>\n<li>you presumably aren't planning to release this as a general-purpose library for others where some miscreant would define an incompatible <code>Store</code> instance on one of your types;</li>\n</ol>\n\n<p>then it seems reasonable to assume that your orphan instances -- despite being orphans -- can reasonably be taken as globally unique instances defined for those type/class combinations.  So, this would be a justified use, if ever there was one, of <code>-fno-warn-orphans</code>.</p>\n\n<p>The alternatives you mention for avoiding orphans (newtype wrappers and per-microservice type definitions) sound tiresome and error-prone, respectively, so much so that it seems preferable to keep the instances with the types despite the unnecessary dependencies.</p>\n"}], "owner": {"reputation": 1242, "user_id": 3252252, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/4V81y.jpg?s=128&g=1", "display_name": "Jesuspc", "link": "https://stackoverflow.com/users/3252252/jesuspc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 242, "favorite_count": 1, "closed_date": 1507328318, "answer_count": 1, "score": 4, "last_activity_date": 1507318068, "creation_date": 1507292560, "question_id": 46605663, "link": "https://stackoverflow.com/questions/46605663/best-practices-sharing-types-across-multiple-haskell-packages-microservices", "closed_reason": "Opinion-based", "title": "Best practices sharing types across multiple Haskell packages/microservices", "body": "<p>I am working in a Haskell project that is composed of multiple microservices. There are certain types that are needed by multiple services at the same time and therefore are defined in separate libraries that are imported by whichever needs them (each type is versioned). But there are things about it that make me uncomfortable and I was wondering which are the best practises regarding that topic. In particular:</p>\n\n<ul>\n<li>I don't know how to handle instances of shared types. In order to avoid orphans the instances must be defined in the type's module for each of the types. But then there are instances that are not needed by all the microservices that import the package and have to be included regardless, potentially adding redundant dependencies to the microservice. An example would be a datatype <strong>T</strong> that is shared by a frontend and a backend. It has an instance of <strong>Store</strong> in order to be stored in a database that is not needed by the frontend, but still makes the frontend depend of the store package.</li>\n<li>In order to avoid the previous issue I could introduce a wrapper every time the type has to \"leave\" a microservice to represent that type going through the wire. In the previous example I would have a <strong>Storable T</strong> which would have an instance for <strong>Store</strong>. This adds quite a lot of overhead to the overall development process though.</li>\n<li>Is it even a good idea to share the types or should each microservice define its own representation of each type, so nothing has to be shared? So for a type <strong>T</strong> a microservice <strong>MA</strong> would have a representation <strong>A.T</strong> and an instance to serialise it in order to send the data to a microservice <strong>B</strong> which would decode that data into a representation <strong>MB.T</strong>.</li>\n</ul>\n\n<p>And finally, regarding the logistical side of the matter,</p>\n\n<ul>\n<li>What's the most convenient way to structure the project? Would a monorepo be a better choice than having separate repos/submodules?</li>\n<li>Maybe related to the previous one, is there any way to find out automatically which microservices should be redeployed when one of the shared libraries is modified because the changes in the library affect a piece of code that is being used by the microservice?</li>\n</ul>\n"}, {"tags": ["amazon-web-services", "haskell", "amazon-s3"], "comments": [{"owner": {"reputation": 3248, "user_id": 1262542, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7cf2d499caed8b2c28ccc311ddffaeb?s=128&d=identicon&r=PG", "display_name": "Stefan Hanke", "link": "https://stackoverflow.com/users/1262542/stefan-hanke"}, "edited": false, "score": 0, "creation_date": 1507353364, "post_id": 46604523, "comment_id": 80185357, "body": "You could check the actual traffic going over the wire and ensure its correctness."}, {"owner": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "edited": false, "score": 0, "creation_date": 1507354377, "post_id": 46604523, "comment_id": 80185537, "body": "You redacted the canonical request from the error output.  This is essentially telling you what elements S3 expected you to pass into the signing algorithm."}, {"owner": {"reputation": 1791, "user_id": 550026, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/a9808a71e03d9b9602aae53622c64d70?s=128&d=identicon&r=PG", "display_name": "Will", "link": "https://stackoverflow.com/users/550026/will"}, "edited": false, "score": 0, "creation_date": 1507625454, "post_id": 46604523, "comment_id": 80273191, "body": "I just edited my question to add the canonical request (with the bucket name changed and the access key removed)"}], "answers": [{"tags": [], "owner": {"reputation": 104, "user_id": 101287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8efbcab730ad4274206c593a1a907dfb?s=128&d=identicon&r=PG", "display_name": "Moss Prescott", "link": "https://stackoverflow.com/users/101287/moss-prescott"}, "is_accepted": false, "score": 0, "last_activity_date": 1511815100, "last_edit_date": 1511815100, "creation_date": 1511814585, "answer_id": 47519301, "question_id": 46604523, "link": "https://stackoverflow.com/questions/46604523/how-to-use-amazonka-presignurl/47519301#47519301", "title": "How to use amazonka presignURL", "body": "<p>I found an issue from Feb which led me to a workround. It seems that <code>presignURL</code> is adding an extraneous header to the signed URL. When I rewrite the request to remove the <code>Expect</code> header before signing, the resulting URL works with a simple PUT.</p>\n\n<p>My workaround is included in <a href=\"https://github.com/brendanhay/amazonka/issues/363#issuecomment-347311820\" rel=\"nofollow noreferrer\">my comment on the github issue</a>.</p>\n"}], "owner": {"reputation": 1791, "user_id": 550026, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/a9808a71e03d9b9602aae53622c64d70?s=128&d=identicon&r=PG", "display_name": "Will", "link": "https://stackoverflow.com/users/550026/will"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 197, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1511815100, "creation_date": 1507288595, "last_edit_date": 1507629135, "question_id": 46604523, "link": "https://stackoverflow.com/questions/46604523/how-to-use-amazonka-presignurl", "title": "How to use amazonka presignURL", "body": "<p>I'm trying to get to grips with the <a href=\"https://github.com/brendanhay/amazonka/\" rel=\"nofollow noreferrer\">amazonka</a> library.  I want to pre-sign a PUT request for S3. Looking at the <a href=\"https://github.com/brendanhay/amazonka/blob/develop/examples/src/Example/S3.hs\" rel=\"nofollow noreferrer\">example here</a>, I put together the code below.  It doesn't work when trying to send up a JPEG image from the client side.  AWS complains that the signature is not correct.</p>\n\n<p>My client-side code works with the nodejs aws sdk, so I can only guess that I am configuring things incorrectly here.</p>\n\n<pre><code>&lt;Error&gt;\n  &lt;Code&gt;\n    SignatureDoesNotMatch\n  &lt;/Code&gt;\n  &lt;Message&gt;\n    The request signature we calculated does not match the signature you provided. Check your key and signing method.\n  &lt;/Message&gt;\n  &lt;CanonicalRequest&gt;\n    PUT\n    /my-bucket/test.jpg\n    X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-\n    Credential=[MY_AWS_ACCESS_KEY]%2F20171010%2Feu-west-\n    1%2Fs3%2Faws4_request&amp;X-Amz-Date=20171010T084724Z&amp;X-Amz-\n    Expires=100000&amp;X-Amz-SignedHeaders=expect%3Bhost\n    expect:\n    host:s3-eu-west-1.amazonaws.com\n\n    expect;host\n    UNSIGNED-PAYLOAD\n &lt;/CanonicalRequest&gt;\n...\n</code></pre>\n\n<p>Here's my code:</p>\n\n<pre><code>getS3UrlR :: Handler Value\ngetS3UrlR = do\n  y &lt;- getYesod\n  let settings = appSettings y\n\n  env &lt;- newEnv $ FromKeys (AccessKey $ encodeUtf8 $ appAwsAccessKey settings) (SecretKey $ encodeUtf8 $ appAwsSecretKey settings)\n  ts  &lt;- liftIO $ getCurrentTime\n\n  let b = BucketName $ appS3Bucket settings\n      k = ObjectKey \"profile-pic-test\"\n  url &lt;- liftIO $ runResourceT . runAWST env . within Ireland $ presignURL ts 100000 (putObject b k (toBody (\"\" :: ByteString)))\n  return $ toJSON $ decodeUtf8 url\n</code></pre>\n\n<p>How can I go about debugging this?</p>\n\n<p>Note - <code>putObject</code> requires a <code>RqBody</code> argument, but I don't have one to provide (as the client is going to supply the request body).  So I just supplied an empty string.  Could that be a problem?</p>\n\n<p>Edit - I tried signing a GET request to see if that would work.  It works fine!  But PUT does not. This is the changed line that works fine:</p>\n\n<pre><code>url &lt;- liftIO $ runResourceT . runAWST env . within Ireland $ presignURL ts 100000 (getObject b k)\n</code></pre>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1507275300, "post_id": 46600545, "comment_id": 80153029, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/20886254/yesod-redirect-to-anchor-on-page\">Yesod redirect to anchor on page</a>"}, {"owner": {"reputation": 13, "user_id": 8730810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/22cc9d09c9a30d456da5d059f2ad9053?s=128&d=identicon&r=PG&f=1", "display_name": "Montecristo", "link": "https://stackoverflow.com/users/8730810/montecristo"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1507279029, "post_id": 46600545, "comment_id": 80154966, "body": "I do not think this answers the question. I saw that new versiond of <code>Yesod</code> supply a <code>.#.</code> function for that, but <code>ArgumentR .#. x</code> renders to <code>&#47;argument#x</code> not <code>&#47;argument&#47;x</code> (and also does not type check)."}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 1, "creation_date": 1507279269, "post_id": 46600545, "comment_id": 80155096, "body": "Ah, the problem is with argument. Doesn&#39;t <code>redirect $ ArgumentR x</code> work, then?"}, {"owner": {"reputation": 13, "user_id": 8730810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/22cc9d09c9a30d456da5d059f2ad9053?s=128&d=identicon&r=PG&f=1", "display_name": "Montecristo", "link": "https://stackoverflow.com/users/8730810/montecristo"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1507284604, "post_id": 46600545, "comment_id": 80158366, "body": "No, does not type check. I also tried various other versions (of brackets, mapping via fmap,...). Unfortunately I could also not find any documentation on this use case."}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1507288479, "post_id": 46600545, "comment_id": 80160494, "body": "Post error message, please."}, {"owner": {"reputation": 13, "user_id": 8730810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/22cc9d09c9a30d456da5d059f2ad9053?s=128&d=identicon&r=PG&f=1", "display_name": "Montecristo", "link": "https://stackoverflow.com/users/8730810/montecristo"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1507364360, "post_id": 46600545, "comment_id": 80187537, "body": "Trying to reproduce the error in this minimal example failed, your answer is correct, it didn&#39;t work for me for unrelated reasons. Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 0, "last_activity_date": 1507364881, "creation_date": 1507364881, "answer_id": 46618210, "question_id": 46600545, "link": "https://stackoverflow.com/questions/46600545/redirecting-in-yesod-to-routes-with-arguments/46618210#46618210", "title": "Redirecting in Yesod to Routes with Arguments", "body": "<p>Routes like <code>ArgumentR</code> listed in <code>routes</code> file are simple data constructors. The number of arguments they take equals to the number of #-pieces in its declaration. So, in your case you need</p>\n\n<pre><code>redirect (ArgumentR x)\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 8730810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/22cc9d09c9a30d456da5d059f2ad9053?s=128&d=identicon&r=PG&f=1", "display_name": "Montecristo", "link": "https://stackoverflow.com/users/8730810/montecristo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 0, "accepted_answer_id": 46618210, "answer_count": 1, "score": 1, "last_activity_date": 1507364881, "creation_date": 1507275106, "question_id": 46600545, "link": "https://stackoverflow.com/questions/46600545/redirecting-in-yesod-to-routes-with-arguments", "title": "Redirecting in Yesod to Routes with Arguments", "body": "<p>Assume I have a route</p>\n\n<pre><code>/argument/#Int ArgumentR GET POST\n</code></pre>\n\n<p>and the corresponding handlers</p>\n\n<pre><code>getArgumentR :: Int -&gt; Handler Html\ngetArgumentR x = undefined\n\npostArgument :: Int -&gt; Handler Html\npostArgument x = do\n    ...\n    redirect (??)\n</code></pre>\n\n<p>where, after running a form, I want to redirect from the post to the get Handler (for the same <code>x</code>). How can I turn <code>ArgumentR</code> into an excepted Route, i.e. apply the argument <code>x</code> to <code>ArgumentR</code>?</p>\n"}, {"tags": ["haskell", "authentication", "yesod", "two-factor-authentication", "one-time-password"], "owner": {"reputation": 1448, "user_id": 1208816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37158dc8985a6d5ef49dbf67568ad8db?s=128&d=identicon&r=PG", "display_name": "00dani", "link": "https://stackoverflow.com/users/1208816/00dani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 190, "favorite_count": 0, "answer_count": 0, "score": 8, "last_activity_date": 1507671322, "creation_date": 1507265624, "question_id": 46598493, "link": "https://stackoverflow.com/questions/46598493/yesod-auth-how-to-require-second-factor-authentication", "title": "Yesod.Auth - how to require second-factor authentication?", "body": "<p>I'm currently building a <a href=\"https://00dani.me\" rel=\"noreferrer\">personal website</a> in <a href=\"https://www.stackage.org/lts-9.6/package/yesod-1.4.5\" rel=\"noreferrer\">Yesod 1.4.5</a>, and at the moment I'm implementing authentication. Authenticating with a username and password was easy enough - I used <a href=\"https://www.stackage.org/lts-9.6/package/yesod-auth-hashdb-1.6.2\" rel=\"noreferrer\">Yesod.Auth.HashDB</a> - but as I'm quite security-conscious I'd like to require a second factor as well.</p>\n\n<p>Does Yesod.Auth have support for multi-factor authentication? It definitely supports multiple auth plugins, but as far as I can tell these appear to be treated as <em>alternative</em> authentication methods rather than additional mandatory authentication factors. Can auth plugins be composed in some way, \"wrapping\" an MFA plugin around HashDB? There didn't seem to be functionality for this in the sources.</p>\n\n<p>If this is indeed unsupported, how best can I extend Yesod.Auth from outside to add MFA? Extending stateful Haskell packages is <em>hard</em> and I could use a few hints.</p>\n\n<p>Ideally I'd like to support both U2F security keys and TOTP codes, but just supporting the latter would still be very good.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2970, "user_id": 1763955, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/3a7a94d762a9d702b88404f840e31d8f?s=128&d=identicon&r=PG&f=1", "display_name": "Carbon", "link": "https://stackoverflow.com/users/1763955/carbon"}, "edited": false, "score": 1, "creation_date": 1507256882, "post_id": 46597318, "comment_id": 80147374, "body": "What is freqs intended to do?"}, {"owner": {"reputation": 83, "user_id": 4325709, "user_type": "registered", "profile_image": "https://graph.facebook.com/100004846143898/picture?type=large", "display_name": "Severi J&#228;&#228;skel&#228;inen", "link": "https://stackoverflow.com/users/4325709/severi-j%c3%a4%c3%a4skel%c3%a4inen"}, "edited": false, "score": 0, "creation_date": 1507286954, "post_id": 46597318, "comment_id": 80159584, "body": "Like Davislor and MathematicalOrchid I advise you to write the type declarations for every function you write in the future. It saves you a lot of time in the end, because compiler can tell where you have gone wrong early on. The type system is one of the nicest things in Haskell, so you should use it to your advantage. Writing the type declarations also help you if you have to do some type-driven programming. With <code>InstanceSigs</code> extension you can also write type declaration for your functions in any instance of type class."}], "answers": [{"tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": false, "score": 2, "last_activity_date": 1507268697, "last_edit_date": 1507268697, "creation_date": 1507257359, "answer_id": 46597442, "question_id": 46597318, "link": "https://stackoverflow.com/questions/46597318/couldnt-match-expected-type-char-with-actual-type-int-t-t1/46597442#46597442", "title": "Couldn&#39;t match expected type \u2018[Char]\u2019 with actual type \u2018Int -&gt; [t -&gt; t1]\u2019", "body": "<p>You\u2019d be well-advised to add type declarations for every top-level function.  Let\u2019s follow what the type deduction system is doing here when it tries to figure this out.</p>\n\n<p>The problem is not with <code>lowers</code>, which takes a <code>[Char]</code> as its argument and returns an <code>Int</code>.</p>\n\n<p>The <code>freqsHelper x</code> declaration has one argument, x, whose type we\u2019ll call <code>a</code> while we try to figure it out.  We\u2019ll call the return type <code>b</code>.  So, <code>freqsHelper</code> is a function of type <code>a -&gt; b</code>.</p>\n\n<p>It\u2019s also equal to <code>freqs (x (lowers x))</code>.  So, <code>x</code>, which has type <code>a</code>, must be a function which takes the result of <code>lowers</code> as its argument.  We know that <code>lowers</code> is <code>[Char] -&gt; Int</code>, so <code>a</code> must be a function of type <code>Int -&gt; t1</code>, where <code>t1</code> is some type we would need to deduce from <code>freqs</code>.  However, <code>x</code> is also passed as the argument of <code>lowers</code>.  Which expects <code>[Char]</code>, not a function with one argument.  So we already have a contradiction.</p>\n\n<p>So, there\u2019s your mismatch.  In the definition of <code>freqsHelper</code>, you\u2019re using <code>x</code> in a context where Haskell expects a string, but also in a context where <code>x</code> has to be some kind of function.  I\u2019m pretty sure there\u2019s a bug in <code>freqs</code> as well, given that it calls a function of two numeric arguments with only one argument.</p>\n"}, {"tags": [], "owner": {"reputation": 2970, "user_id": 1763955, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/3a7a94d762a9d702b88404f840e31d8f?s=128&d=identicon&r=PG&f=1", "display_name": "Carbon", "link": "https://stackoverflow.com/users/1763955/carbon"}, "is_accepted": false, "score": 0, "last_activity_date": 1507257844, "last_edit_date": 1507257844, "creation_date": 1507257517, "answer_id": 46597461, "question_id": 46597318, "link": "https://stackoverflow.com/questions/46597318/couldnt-match-expected-type-char-with-actual-type-int-t-t1/46597461#46597461", "title": "Couldn&#39;t match expected type \u2018[Char]\u2019 with actual type \u2018Int -&gt; [t -&gt; t1]\u2019", "body": "<p>Ah, I think I know what you're getting at. You're close. A couple things - if you're gonna do a division, you should do a fromIntegral to get back some kind of fractional.</p>\n\n<pre><code>percent :: (Fractional a) =&gt; Int -&gt; Int -&gt; a\npercent x y = (fromIntegral x / fromIntegral y) * 100\n</code></pre>\n\n<p>I think your frequency is trying to get the frequency of something in a list, in which case you'll need a base case:</p>\n\n<pre><code>freqs [] y = []\nfreqs (x:xs) y = percent (count x y) (length y) : freqs xs y \n</code></pre>\n\n<p>I think you can figure out the rest from here.</p>\n\n<p>A few style hints - you can use a map for freqs:</p>\n\n<pre><code>freqs' x y = map (\\a -&gt; percent (count a y) $ length y) x\n</code></pre>\n\n<p>The compiler will probably do it for you, but you can explicitly call out length y:</p>\n\n<pre><code>freqs' x y = map (\\a -&gt; percent (count a y) len) x\n    where len = length y\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 0, "last_activity_date": 1507278724, "creation_date": 1507278724, "answer_id": 46601577, "question_id": 46597318, "link": "https://stackoverflow.com/questions/46597318/couldnt-match-expected-type-char-with-actual-type-int-t-t1/46601577#46601577", "title": "Couldn&#39;t match expected type \u2018[Char]\u2019 with actual type \u2018Int -&gt; [t -&gt; t1]\u2019", "body": "<pre><code>freqsHelper x = freqs (x (lowers x))\n</code></pre>\n\n<p>Let's break this down.</p>\n\n<pre><code>lowers x\n</code></pre>\n\n<p>You call <code>lowers</code> with <code>x</code> as input, so <code>x</code> must be a string.</p>\n\n<pre><code>x (lowers x)\n</code></pre>\n\n<p>But you call <code>x</code> as a function, passing it the result of <code>lowers</code> as input. So <code>x</code> must be a function that takes an <code>Int</code> as input. (That sounds like a mistake...)</p>\n\n<pre><code>freqs (x (lowers x))\n</code></pre>\n\n<p>You call <code>freqs</code> with the output from calling the <code>x</code> function... so <code>x</code> must return a list of some kind?</p>\n\n<p>At this point, the type checker is confused as to what the heck <code>x</code> is even supposed to <em>be</em>, so it gives up.</p>\n\n<p>Perhaps you meant to pass <code>x</code> and <code>lowers x</code> as <em>two separate arguments</em>? In that case, you want</p>\n\n<pre><code>freqs x (lowers x)\n</code></pre>\n\n<p>By putting brackets around <code>x (lowers x)</code>, you make the compiler think that <code>x</code> is a <em>function</em> you want to <em>call</em>, with <code>lowers x</code> as the argument. I doubt you meant to do that.</p>\n\n<p>As a side note, if you add type signatures on each of the functions you've defined, you may get a clearer indication from the type checker as to which bit is actually wrong. (As it is, the type checker can see the types don't line up, but can't actually determine where the types deviate from what you intended &mdash; because it cannot read your mind to know what you intended...)</p>\n"}], "owner": {"reputation": 389, "user_id": 5991927, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/f1d70f641cbec039763be0a4d4536895?s=128&d=identicon&r=PG&f=1", "display_name": "humbleCoder", "link": "https://stackoverflow.com/users/5991927/humblecoder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 410, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1507278724, "creation_date": 1507256197, "last_edit_date": 1507273830, "question_id": 46597318, "link": "https://stackoverflow.com/questions/46597318/couldnt-match-expected-type-char-with-actual-type-int-t-t1", "title": "Couldn&#39;t match expected type \u2018[Char]\u2019 with actual type \u2018Int -&gt; [t -&gt; t1]\u2019", "body": "<p>So I'm trying to create a helper function that does something else, but I can't even get past the helper function because I keep getting this error:</p>\n\n<pre><code>Couldn't match expected type \u2018[Char]\u2019 with actual type \u2018Int -&gt; [t -&gt; t1]\u2019\nfreqsHelper x = freqs (x (lowers x))\n                                 ^\n</code></pre>\n\n<p>The lowers(x) is causing the issue. Here is my code:</p>\n\n<pre><code>lowers [] = 0\nlowers (x:xs) \n    | isLower x == True = 1 + lowers xs\n    | otherwise = lowers xs\n\ncount _ [] = 0\ncount x (y:ys)\n    | x == y = 1 + count x ys\n    | otherwise = count x ys\n\npercent x y = x/y*100\n\nfreqsHelper x = freqs (x (lowers x))\n\nfreqs (x:xs) y = percent ((count (x (x:xs))) y) : freqs xs y\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "monads", "monad-transformers", "typechecking"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user1212854"}, "edited": false, "score": 0, "creation_date": 1507263284, "post_id": 46597092, "comment_id": 80148608, "body": "I see why I was confused now. I kept on looking at the declaration of the <code>StateT s m a</code> type as wanting a monad that takes two arguments (whatever that means) instead of a type that wants a monad containing a 2-tuple which <code>DoneTa (((), s+1), &quot;&quot;)</code> is. When <code>incTaState</code> is evaluated to <code>StateT $ \\s -&gt; DoneTa (((), s+1), &quot;&quot;)</code>, we see that as per the  <code>StateT s m a</code> declaration, <code>a</code> is <code>((), s+1)</code>. Looking at this 2-tuple and the <code>MTa a</code> type declaration, <code>a</code> is <code>()</code> making the return type of <code>incTaState</code> <code>StateT State MTa ()</code>."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user1212854"}, "edited": false, "score": 0, "creation_date": 1507261581, "post_id": 46597397, "comment_id": 80148306, "body": "Ah. Thank you. That was a mistake. Edited the question."}, {"owner": {"user_type": "does_not_exist", "display_name": "user1212854"}, "edited": false, "score": 0, "creation_date": 1507262628, "post_id": 46597397, "comment_id": 80148512, "body": "Edited the question."}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 1, "last_activity_date": 1507256947, "creation_date": 1507256947, "answer_id": 46597397, "question_id": 46597092, "link": "https://stackoverflow.com/questions/46597092/haskell-counter-intuitive-type-checking-going-on/46597397#46597397", "title": "Haskell: Counter-intuitive type checking going on", "body": "<pre><code>incTaState :: StateT State MTa ()\nincTaState = StateT $ \\s -&gt; return ((), s+1)\n\\s -&gt; ((), s+1)          :: State -&gt; ((), State)\n-- You were correct\n\\s -&gt; return ((), s + 1) :: State -&gt; MTa ((), State)\n-- The type of that function matches up with StateT\n-- We can set s = State, m = MTa, and a = ()\nStateT s     m   a  = s     -&gt; m   (a , s    )\nStateT State MTa () = State -&gt; MTa ((), State)\n-- So:\nStateT $ \\s -&gt; return ((), s+1) :: StateT State MTa ()\n-- QED\n</code></pre>\n\n<p>When you run <code>StateT $ \\s -&gt; DoneTa ((), s+1, \"\")</code>, the issue is that <code>DoneTa :: (a, String) -&gt; MTa a</code>, with a 2-tuple, but you are passing it <code>((), s + 1, \"\") :: ((), State, String)</code>, a 3-tuple. Add more nesting: <code>StateT $ \\s -&gt; DoneTa (((), s + 1), \"\")</code> (where <code>(((), s + 1), \"\") :: (((), State), String)</code>, a 2-tuple with a 2-tuple inside it).</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user1212854"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 46597397, "answer_count": 1, "score": 0, "last_activity_date": 1507258403, "creation_date": 1507254084, "last_edit_date": 1507258403, "question_id": 46597092, "link": "https://stackoverflow.com/questions/46597092/haskell-counter-intuitive-type-checking-going-on", "title": "Haskell: Counter-intuitive type checking going on", "body": "<p>So I have these type:</p>\n\n<pre><code>newtype StateT s m a = StateT {runStateT :: s -&gt; m (a, s)}\n\ndata MTa a = FailTa Exception\n        | DoneTa {unpackDoneTa :: (a, O)}\n        deriving Show\n\ntype O = String\ntype Exception = String\ntype State = Int\n</code></pre>\n\n<p>I made <code>(State s m)</code> an instance of the <code>Functor</code>, <code>Applicative</code>, and <code>Monad</code> classes like so:</p>\n\n<pre><code>instance (Monad m) =&gt; Functor (StateT s m) where\n    fmap f t = StateT $ \\is -&gt; do\n                    ~(a, s) &lt;- runStateT t is\n                    return (f a, s)\n\ninstance (Monad m) =&gt; Applicative (StateT s m) where\n    pure = return\n    StateT f &lt;*&gt; StateT t = StateT $ \\is -&gt; do\n        ~(ta, ts) &lt;- t is\n        ~(fa, fs) &lt;- f ts\n        return (fa ta, fs)\n\ninstance (Monad m) =&gt; Monad (StateT s m) where\n    return a = StateT $ \\s -&gt; return (a, s)\n    StateT m1 &gt;&gt;= k = StateT $ \\s -&gt; do\n        ~(a, s1) &lt;- m1 s\n        let StateT m2 = k a\n        m2 s1\n</code></pre>\n\n<p>I also made <code>MTa</code> an instance of the <code>Functor</code>, <code>Applicative</code>, and <code>Monad</code> classes:</p>\n\n<pre><code>instance Functor MTa where\n    _ `fmap` (FailTa e) = FailTa e\n    f `fmap` (DoneTa (a, o)) = DoneTa (f a, o)\n\ninstance Applicative MTa where\n    pure = return\n    _ &lt;*&gt; (FailTa e) = FailTa e\n    FailTa e &lt;*&gt; _ = FailTa e\n    DoneTa (f, x) &lt;*&gt; DoneTa (a, y) = DoneTa (f a, y ++ x)\n\ninstance Monad MTa where\n    return a = DoneTa (a, \"\")\n    m &gt;&gt;= f = case m of\n        FailTa e -&gt; FailTa e\n        DoneTa (a, x) -&gt; case (f a) of\n            FailTa e1 -&gt; FailTa e1\n            DoneTa (b, y) -&gt; DoneTa (b, x ++ y)\n</code></pre>\n\n<p>I then have this function:</p>\n\n<pre><code>incTaState :: StateT State MTa ()\nincTaState = StateT $ \\s -&gt; return ((), s+1)\n</code></pre>\n\n<p>Am I right to think that <code>return ((), s+1)</code> will evaluate to <code>DoneTa (((), s+1), \"\")</code>. If so, doesn't that mean that its type is <code>MTa ((), State)</code>. Why does <code>incTaState</code> typecheck to <code>StateT State MTa ()</code>? When I run this: <code>:t DoneTa ((), \"\")</code> in a console, it evaluates to <code>DoneTa ((), \"\") :: MTa ()</code>. Am I not interpreting the return part of <code>incTaState</code> correctly?</p>\n\n<p>The question can almost be summarized like so: if <code>Done ((), \"\")</code> typechecks to <code>MTa ()</code>, how is it that <code>incTaState</code> typechecks to <code>StateT State MTa ()</code>? Doesn't <code>DoneTa (((), s+1), \"\")</code>, the resolution of <code>return ((), s+1)</code>, typecheck to <code>MTa (((), State), O)</code> making <code>incTaState</code> a type of <code>StateT State MTa ((), State)</code> not what is specified?</p>\n\n<p>Please fell free to be verbose (-vvv).</p>\n\n<p>Your consideration is much appreciated. Peace.</p>\n\n<p><strong>Below is removed as I made a mistake by entering a 3-tuple. Thanks @HTNW.</strong></p>\n\n<p>I suspect I'm not because when I run <code>:t (StateT $ \\s -&gt; DoneTa (((), s+1, \"\")))</code> I get the following error:</p>\n\n<pre><code>\u2022 Couldn't match expected type \u2018((a, b), O)\u2019\n                  with actual type \u2018((), b, [Char])\u2019\n\u2022 In the first argument of \u2018DoneTa\u2019, namely \u2018(((), s + 1, \"\"))\u2019\n  In the expression: DoneTa (((), s + 1, \"\"))\n  In the second argument of \u2018($)\u2019, namely\n    \u2018\\ s -&gt; DoneTa (((), s + 1, \"\"))\u2019\n\u2022 Relevant bindings include s :: b (bound at &lt;interactive&gt;:1:12)\n</code></pre>\n"}, {"tags": ["haskell", "set", "partition"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1507244507, "post_id": 46595950, "comment_id": 80144785, "body": "Recursively. If you can partition <code>X</code>, how can you partition <code>X \u222a {a}</code>?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1507311878, "post_id": 46595950, "comment_id": 80174505, "body": "Minor style comment: the <code>if</code>s you posted seem to be a convoluted way to write, respectively, 1) <code>x==y || isElement x ys</code> and 2) <code>isElement y xs &amp;&amp; subset ys xs</code>. There&#39;s no need of <code>do</code> here, and <code>== True</code> is always redundant."}], "answers": [{"comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 5, "creation_date": 1507257142, "post_id": 46596325, "comment_id": 80147430, "body": "You can also define <code>partitions</code> as <code>partitions = foldr expand [[]]</code>"}], "tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": true, "score": 8, "last_activity_date": 1507248632, "last_edit_date": 1507248632, "creation_date": 1507247207, "answer_id": 46596325, "question_id": 46595950, "link": "https://stackoverflow.com/questions/46595950/partition-a-set-in-haskell/46596325#46596325", "title": "Partition a set in Haskell", "body": "<p>The idea is that in order to find all partitions of set <em>X</em> \u222a {<em>x</em>},  we find parritions of <em>X</em> first. Then add <code>x</code> to each of them in every possible way (that is, add <code>x</code> to the first element of a partition, add <code>x</code> to the second element etc) and take a union of the result.</p>\n\n<p>Here's a rather straightforward implementation:</p>\n\n<pre><code>partitions :: [a] -&gt; [[[a]]]\npartitions [] = [[]]\npartitions (x:xs) = expand x $ partitions xs where\n\n    expand :: a -&gt; [[[a]]] -&gt; [[[a]]]\n    expand x ys = concatMap (extend x) ys\n\n    extend :: a -&gt; [[a]] -&gt; [[[a]]]\n    extend x [] = [[[x]]]\n    extend x (y:ys) = ((x:y):ys) : map (y:) (extend x ys)\n</code></pre>\n\n<p>Demo: \n<a href=\"https://ideone.com/ClYOoQ\" rel=\"noreferrer\">https://ideone.com/ClYOoQ</a></p>\n"}, {"comments": [{"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1507278554, "post_id": 46597072, "comment_id": 80154704, "body": "Yeah, I generally don\u2019t write complete solutions of questions that look like homework problems, but I do give hints."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1507301228, "post_id": 46597072, "comment_id": 80168645, "body": "Would you prefer if I deleted that comment? I added it since (1) this was a cool idea, (2) there is already a much simpler solution with the other posted answer and (3) it wasn&#39;t immediately clear to me what you meant."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1507313630, "post_id": 46597072, "comment_id": 80175302, "body": "@Alec It\u2019s really up to you."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1507313695, "post_id": 46597072, "comment_id": 80175336, "body": "Given that two strangers agreed with you, I&#39;ve deleted the comment. :)"}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1507314019, "post_id": 46597072, "comment_id": 80175481, "body": "@Alec Well, six strangers upvoted a different complete solution."}], "tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": false, "score": 2, "last_activity_date": 1507313582, "last_edit_date": 1507313582, "creation_date": 1507253944, "answer_id": 46597072, "question_id": 46595950, "link": "https://stackoverflow.com/questions/46595950/partition-a-set-in-haskell/46597072#46597072", "title": "Partition a set in Haskell", "body": "<p>Pseudocode for one recursive algorithm:</p>\n\n<pre><code>If |S| = 1\n  Return \u2205\nOtherwise\n  For each nonempty proper subset X \u2282 S\n    Let Y = S - X\n    Add {X, Y} to R\n    For each Z in {partitionSet(X)}\n      Add Z \u222a {Y} to R.\n  Return R\n</code></pre>\n\n<p>Since \u201cadding\u201d elements to a list isn\u2019t a very functional idiom, you would want to do those steps with a concatMap or a list comprehension.  You might also build R as an accumulating parameter to a tail-recursive function, or as a union of the return values of each step.  The proper subsets function is in the Haskell standard library as <code>Data.List.subsequences</code>.</p>\n\n<p>If you have a total ordering on all proper subsets of S, you can use symmetry-breaking to add only partitions that are unique up to permutation.  That is, if X > Y, you could add only {X,Y} and not {Y,X}, and only {X,Y,Z} and not {Y,X,Z}.  Be careful that you still sub-partition every set in your partition exactly once!</p>\n\n<p>This finds only partition sets of S, if \u22c3Z = X and X \u222a Y = S, the union of all sets in Z and Y is S, it returns only sets of nonempty proper subsets of S, and every partition and subpartition is a set difference, hence pairwise disjoint.</p>\n\n<p>Any partition set of cardinality two has the form {X, S-X}, and the algorithm finds it because it tries every possible X.  Any partition set of cardinality <em>i</em>>2 has the form {a_1, a_2, ..., a_i}, where {a_1, a_2} is a partition set of {a_1 \u22c3 a_2} and {{a_1 \u22c3 a_2}, ..., a_i} is a partition set of cardinality <em>i</em>-1, and will be found when subpartitioning the parent node of the search tree.  Therefore, by induction, the algorithm finds all partition sets of S.</p>\n"}, {"tags": [], "owner": {"reputation": 5008, "user_id": 5762796, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/b3acb5c2021f4c279f29d61481b28e15?s=128&d=identicon&r=PG&f=1", "display_name": "Aleph0", "link": "https://stackoverflow.com/users/5762796/aleph0"}, "is_accepted": false, "score": 0, "last_activity_date": 1532172429, "last_edit_date": 1532172429, "creation_date": 1532171984, "answer_id": 51455530, "question_id": 46595950, "link": "https://stackoverflow.com/questions/46595950/partition-a-set-in-haskell/51455530#51455530", "title": "Partition a set in Haskell", "body": "<p>Lately, I was playing again with set partitions and haskell. Even though it might be not the fastest and nicest solution it does the job. I found out that using Data.List and the List Monad greatly reduces the amount of code and extents the readability.</p>\n\n<p>Asking myself if there is a neat way to replace <code>foldl</code> by <code>foldr</code>?</p>\n\n<p>Anyway, here is my solution:</p>\n\n<pre><code>module Main where\n\nimport Data.List\n\nmain :: IO ()\nmain = print $ allPart 5\n\ninsertFront :: Integer -&gt; [[Integer]] -&gt; [[Integer]]\ninsertFront k (h:t) = [k:h]++t\ninsertFront k _ = [[k]]\n\nadd :: Integer -&gt; [[Integer]] -&gt; [[[Integer]]]\nadd k part=zipWith (++) (inits part) (map (insertFront k) (tails part))\n\nallPart k = foldl (&gt;&gt;=) [[]] [add i | i&lt;-[1..k]]\n</code></pre>\n\n<p>I'm also wondering if there is some very short substitute for insertFront using some of the haskell libraries.</p>\n"}], "owner": {"reputation": 299, "user_id": 8604329, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/34e9794ad93744d1fcf341dfb763b345?s=128&d=identicon&r=PG&f=1", "display_name": "Matt Robbins", "link": "https://stackoverflow.com/users/8604329/matt-robbins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1522, "favorite_count": 1, "accepted_answer_id": 46596325, "answer_count": 3, "score": 5, "last_activity_date": 1532172429, "creation_date": 1507244125, "last_edit_date": 1507244202, "question_id": 46595950, "link": "https://stackoverflow.com/questions/46595950/partition-a-set-in-haskell", "title": "Partition a set in Haskell", "body": "<p>I'm trying to write a Haskell program that could return the partition set of a user defined set. The partition of a set S is defined as a set of nonempty, pairwise disjoint subsets of S whose union is S.  So, <code>[1,2,3]</code> returns <code>[[[2],[3,1]],[[2,1],[3]],[[3,2,1]],[[1],[3,2]],[[1],[2],[3]]]</code>.  I think I can utilize a different program I wrote a while ago that finds the cartesian product from two sets. So, <code>[1,2,3] ['a', 'b']</code> returns <code>[(1,'a'),(1,'b'),(2,'a'),(2,'b'),(3,'a'),(3,'b')]</code>. However, I'm not sure quite how.  I think it would require recursion though, if this can even be adapted properly.  Here is the subset code:</p>\n\n<pre><code>type Set a = [a]\n\nisElement :: Eq a =&gt; a -&gt; [a] -&gt; Bool\nisElement x [] = False\nisElement x (y:ys) = if(x==y) then True else isElement x ys\n\nsubset :: Eq a =&gt; Set a -&gt; Set a -&gt; Bool\nsubset [] xs = True\nsubset (y:ys) xs = if(isElement y xs == True)\n                  then do subset ys xs\n                  else do False\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 6, "creation_date": 1507240357, "post_id": 46595162, "comment_id": 80143639, "body": "Oh this is a great one. Notice that if you put the incorrect <code>writeLine</code> definition <i>before</i> the other definitions the questionable error vanishes. :)"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 4, "creation_date": 1507241041, "post_id": 46595162, "comment_id": 80143869, "body": "I have opened <a href=\"https://ghc.haskell.org/trac/ghc/ticket/14327\" rel=\"nofollow noreferrer\">GHC Trac #14327</a> to track this issue."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1507241312, "post_id": 46595162, "comment_id": 80143948, "body": "The issue seems to be FD related, since specializing <code>liftF&#39; :: Functor f =&gt; f a -&gt; Free f a</code> gets rid of the extra error. Maybe I&#39;m missing something."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 8, "last_activity_date": 1507267897, "creation_date": 1507267897, "answer_id": 46598869, "question_id": 46595162, "link": "https://stackoverflow.com/questions/46595162/why-do-i-get-a-type-error-in-this-program-when-i-add-an-unrelated-definition/46598869#46598869", "title": "Why do I get a type error in this program when I add an unrelated definition?", "body": "<p>This was a GHC bug. It was fixed in commit <a href=\"https://ghc.haskell.org/trac/ghc/changeset/48daaaf0bba279b6e362ee5c632de69ed31ab65d/ghc\" rel=\"noreferrer\">48daaaf0bba279b6e362ee5c632de69ed31ab65d (Don't report fundep wanted/wanted errors)</a>, according to Ryan Scott.</p>\n"}], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 1, "accepted_answer_id": 46598869, "answer_count": 1, "score": 12, "last_activity_date": 1507267897, "creation_date": 1507239415, "question_id": 46595162, "link": "https://stackoverflow.com/questions/46595162/why-do-i-get-a-type-error-in-this-program-when-i-add-an-unrelated-definition", "title": "Why do I get a type error in this program when I add an unrelated definition?", "body": "<p>I was showing a coworker <code>Free</code> when I ran into a curious GHC behavior I don\u2019t really understand. Here is a simple, contrived program that typechecks:</p>\n\n<pre><code>import Prelude hiding (readFile, writeFile)\nimport Control.Monad.Free\nimport Data.Functor.Sum\n\ndata FileSystemF a\n  = ReadFile FilePath (String -&gt; a)\n  | WriteFile FilePath String a\n  deriving (Functor)\n\ndata ConsoleF a\n  = WriteLine String a\n  deriving (Functor)\n\ndata CloudF a\n  = GetStackInfo String (String -&gt; a)\n  deriving (Functor)\n\ntype App = Free (Sum FileSystemF (Sum ConsoleF CloudF))\n\nreadFile :: FilePath -&gt; App String\nreadFile path = liftF (InL (ReadFile path id))\n\nwriteFile :: FilePath -&gt; String -&gt; App ()\nwriteFile path contents = liftF (InL (WriteFile path contents ()))\n</code></pre>\n\n<p>I tried adding another definition, but it wasn\u2019t quite right:</p>\n\n<pre><code>writeLine :: String -&gt; App ()\nwriteLine line = liftF (InR (WriteLine line ()))\n</code></pre>\n\n<p>The problem here is that I was missing another <code>InL</code>. The correct definition should be this:</p>\n\n<pre><code>writeLine :: String -&gt; App ()\nwriteLine line = liftF (InR (InL (WriteLine line ())))\n</code></pre>\n\n<p>However, that isn\u2019t the point. What\u2019s weird to me is the type error that GHC produced when I added my first, incorrect definition of <code>writeLine</code>. Specifically, it produced <em>two</em> type errors:</p>\n\n<pre><code>/private/tmp/free-sandbox/src/FreeSandbox.hs:26:27: error:\n    \u2022 Couldn't match type \u2018ConsoleF\u2019 with \u2018Sum ConsoleF CloudF\u2019\n        arising from a functional dependency between constraints:\n          \u2018MonadFree\n             (Sum FileSystemF (Sum ConsoleF CloudF))\n             (Free (Sum FileSystemF (Sum ConsoleF CloudF)))\u2019\n            arising from a use of \u2018liftF\u2019 at src/FreeSandbox.hs:26:27-66\n          \u2018MonadFree\n             (Sum FileSystemF ConsoleF)\n             (Free (Sum FileSystemF (Sum ConsoleF CloudF)))\u2019\n            arising from a use of \u2018liftF\u2019 at src/FreeSandbox.hs:29:18-48\n    \u2022 In the expression: liftF (InL (WriteFile path contents ()))\n      In an equation for \u2018writeFile\u2019:\n          writeFile path contents = liftF (InL (WriteFile path contents ()))\n   |\n26 | writeFile path contents = liftF (InL (WriteFile path contents ()))\n   |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n/private/tmp/free-sandbox/src/FreeSandbox.hs:29:18: error:\n    \u2022 Couldn't match type \u2018Sum ConsoleF CloudF\u2019 with \u2018ConsoleF\u2019\n        arising from a functional dependency between:\n          constraint \u2018MonadFree\n                        (Sum FileSystemF ConsoleF)\n                        (Free (Sum FileSystemF (Sum ConsoleF CloudF)))\u2019\n            arising from a use of \u2018liftF\u2019\n          instance \u2018MonadFree f (Free f)\u2019 at &lt;no location info&gt;\n    \u2022 In the expression: liftF (InR (WriteLine line ()))\n      In an equation for \u2018writeLine\u2019:\n          writeLine line = liftF (InR (WriteLine line ()))\n   |\n29 | writeLine line = liftF (InR (WriteLine line ()))\n   |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>The second of the two errors (the one on line 29) makes sense. It\u2019s an error I would expect. But the error on line 26 completely baffles me. The definition of <code>writeFile</code> is correct! Adding my incorrect definition of <code>writeLine</code> shouldn\u2019t have any effect on <code>writeFile</code>, right? What\u2019s going on?</p>\n\n<p>I was able to reproduce this on GHC 8.0.2 and GHC 8.2.1. I\u2019d like to know if this is a bug in GHC (so I can report it) or if it\u2019s an issue with my code that I don\u2019t understand.</p>\n"}, {"tags": ["haskell", "tuples", "infinite-loop"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1507224533, "post_id": 46591522, "comment_id": 80136098, "body": "It has nothing to do with lazy evaluation (itself). You simply created cyclic references: <code>i</code> points to <code>j</code>, and <code>j</code> points to <code>i</code>. The first statement has no impact whatsoever, since in Haskell variables can not change, you constructed new ones."}, {"owner": {"reputation": 914, "user_id": 4135158, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ecuuA.jpg?s=128&g=1", "display_name": "Santa Claus", "link": "https://stackoverflow.com/users/4135158/santa-claus"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1507224585, "post_id": 46591522, "comment_id": 80136122, "body": "Thanks, but why is <code>i</code> and <code>j</code> not referring to 3 and 4 then ? (in the second line)"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1507224655, "post_id": 46591522, "comment_id": 80136161, "body": "Because as said before, from the moment you write something like <code>(i,j) = (j,i)</code> there are variables that occur in the head, and these are locally scoped. So you created <i>new</i> variables <code>i</code> and <code>j</code>. So the first line has no impact at all."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1507224738, "post_id": 46591522, "comment_id": 80136212, "body": "In Haskell, the <code>=</code> is <i>not</i> an assignment operator, it is a <i>declaration</i>."}, {"owner": {"reputation": 914, "user_id": 4135158, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ecuuA.jpg?s=128&g=1", "display_name": "Santa Claus", "link": "https://stackoverflow.com/users/4135158/santa-claus"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1507224904, "post_id": 46591522, "comment_id": 80136310, "body": "I never talked about assignment, I am indeed talking about declaration of new variable with same name as old ones. I did not know that variables that occur in the head are locally scoped ! thanks"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1507225333, "post_id": 46591522, "comment_id": 80136552, "body": "It doesn&#39;t. We could easily define a similar, but  strict, language with the same scoping."}, {"owner": {"reputation": 914, "user_id": 4135158, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ecuuA.jpg?s=128&g=1", "display_name": "Santa Claus", "link": "https://stackoverflow.com/users/4135158/santa-claus"}, "edited": false, "score": 0, "creation_date": 1507225373, "post_id": 46591522, "comment_id": 80136574, "body": "Ok I edited my question thanks ! Then it has to do with recursivity ?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1507225730, "post_id": 46591522, "comment_id": 80136784, "body": "If you define <code>factorial n = if n == 0 then 1 else n * (factorial (n - 1))</code>, you expect the use of <code>factorial</code> on the RHS to be the same <code>factorial</code> as the one on the LHS, right? Well in the same way, <code>(i,j) = (j,i)</code> defines <code>i</code> and <code>j</code> in terms of themselves."}, {"owner": {"reputation": 914, "user_id": 4135158, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ecuuA.jpg?s=128&g=1", "display_name": "Santa Claus", "link": "https://stackoverflow.com/users/4135158/santa-claus"}, "edited": false, "score": 0, "creation_date": 1507225795, "post_id": 46591522, "comment_id": 80136827, "body": "Thanks ! That&#39;s the answer I was looking for. If you post it as an answer, I will accept it"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1507225847, "post_id": 46591522, "comment_id": 80136858, "body": "If you really aren&#39;t looking for assignment, then you could give the new variables new names to avoid the problem: <code>(i2, j2) = (j, i)</code>. That probably isn&#39;t super useful though, so we might need more context."}, {"owner": {"reputation": 914, "user_id": 4135158, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ecuuA.jpg?s=128&g=1", "display_name": "Santa Claus", "link": "https://stackoverflow.com/users/4135158/santa-claus"}, "edited": false, "score": 0, "creation_date": 1507226091, "post_id": 46591522, "comment_id": 80136969, "body": "What if I want to keep the same variable names as the old ones ? Is there a way ?"}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1507232423, "post_id": 46591522, "comment_id": 80140190, "body": "What exactly did you expect to receive when you did <code>Prelude&gt; i</code>..?"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 1, "creation_date": 1507246212, "post_id": 46591522, "comment_id": 80145181, "body": "If you\u2019re in <code>do</code> notation, you can shadow variables with a monadic binding, because unlike <code>let</code> bindings, they\u2019re non-recursive: <code>do { let { (i, j) = (3, 4) }; (i, j) &lt;- pure (j, i); print i; print j }</code> prints <code>4</code> then <code>3</code> because this desugars to <code>let (i, j) = (3, 4) in pure (j, i) &gt;&gt;= \\ (i, j) -&gt; print i &gt;&gt; print j</code>, and the <code>i</code> and <code>j</code> parameters of the inner lambda shadow those defined by the outer <code>let</code>. (You can also get recursive bindings in <code>do</code> blocks using the <code>RecursiveDo</code> extension; writing <code>rec (j, i) &lt;- (i, j)</code> will enter an infinite loop just like <code>let (j, i) = (i, j)</code> does.)"}], "answers": [{"tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": false, "score": 3, "last_activity_date": 1507226472, "last_edit_date": 1507226472, "creation_date": 1507226359, "answer_id": 46592050, "question_id": 46591522, "link": "https://stackoverflow.com/questions/46591522/tuple-declaration-goes-to-infinite-loop/46592050#46592050", "title": "Tuple declaration goes to infinite loop", "body": "<p>The shortest sequence I can think of is this:</p>\n\n<pre><code>(i', j') = (i, j)\n(i, j) = (j', i')\n</code></pre>\n\n<p>This is of course only valid for GHCi, just like the original sequence. In a normal Haskell module such definitions cannot occur in the same lexical scope.</p>\n"}, {"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 8, "last_activity_date": 1507226530, "creation_date": 1507226530, "answer_id": 46592097, "question_id": 46591522, "link": "https://stackoverflow.com/questions/46591522/tuple-declaration-goes-to-infinite-loop/46592097#46592097", "title": "Tuple declaration goes to infinite loop", "body": "<p>If you define</p>\n\n<pre><code>ghci&gt; factorial n = if n == 0 then 1 else n * (factorial (n - 1))\n</code></pre>\n\n<p>you expect the use of <code>factorial</code> on the RHS to be the same <code>factorial</code> as the one on the LHS, right?</p>\n\n<p>Well in the same way, the following defines <code>i</code> and <code>j</code> in terms of themselves:</p>\n\n<pre><code>ghci&gt; (i,j) = (j,i)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 934, "user_id": 7459445, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GBpx1.png?s=128&g=1", "display_name": "Claude", "link": "https://stackoverflow.com/users/7459445/claude"}, "is_accepted": false, "score": 2, "last_activity_date": 1507300560, "creation_date": 1507300560, "answer_id": 46608205, "question_id": 46591522, "link": "https://stackoverflow.com/questions/46591522/tuple-declaration-goes-to-infinite-loop/46608205#46608205", "title": "Tuple declaration goes to infinite loop", "body": "<p>You can use the properties that GHCi runs in an implicit IO do block, and that variables in do binds are not in scope on their right hand side:</p>\n\n<pre><code>(i, j) &lt;- return (j, i)\n</code></pre>\n\n<p>You do however get warnings from -Wname-shadowing, if you enabled it (including via -Wall).</p>\n"}], "owner": {"reputation": 914, "user_id": 4135158, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ecuuA.jpg?s=128&g=1", "display_name": "Santa Claus", "link": "https://stackoverflow.com/users/4135158/santa-claus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 261, "favorite_count": 0, "accepted_answer_id": 46592097, "answer_count": 3, "score": 2, "last_activity_date": 1507300560, "creation_date": 1507224395, "last_edit_date": 1507234000, "question_id": 46591522, "link": "https://stackoverflow.com/questions/46591522/tuple-declaration-goes-to-infinite-loop", "title": "Tuple declaration goes to infinite loop", "body": "<p>Trying this in Prelude</p>\n\n<pre><code>Prelude&gt; (i, j) = (3, 4)\nPrelude&gt; (i, j) = (j, i)\nPrelude&gt; i\n</code></pre>\n\n<p>I was expecting <code>4</code>, but I get an infinite loop</p>\n\n<p>Why ?</p>\n\n<p>How to do this in a short elegant way ?</p>\n"}, {"tags": ["haskell", "generics", "scrap-your-boilerplate"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1507224460, "post_id": 46591459, "comment_id": 80136066, "body": "What do you need all this fancy generic stuff for when you know the type? Why not write it precisely as you have (pattern matching), and perhaps skip the <code>gmapQ</code> altogether?"}, {"owner": {"reputation": 2225, "user_id": 1282031, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b868af647ee5a2cce5d19230646aa602?s=128&d=identicon&r=PG", "display_name": "Andreas Hagen", "link": "https://stackoverflow.com/users/1282031/andreas-hagen"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1507224597, "post_id": 46591459, "comment_id": 80136128, "body": "Mostly all of the <code>NodeX</code> constructors have this repeated pattern of sub-nodes I showed above, and writing patterns for every one of them would be very redundant; which is what I&#39;m trying to avoid."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1507224741, "post_id": 46591459, "comment_id": 80136216, "body": "Well, nothing stops you from combining the approaches by dispatching &quot;manually&quot; to one or more generic helpers."}, {"owner": {"reputation": 2225, "user_id": 1282031, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b868af647ee5a2cce5d19230646aa602?s=128&d=identicon&r=PG", "display_name": "Andreas Hagen", "link": "https://stackoverflow.com/users/1282031/andreas-hagen"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1507224766, "post_id": 46591459, "comment_id": 80136230, "body": "What do you mean by that?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1507224902, "post_id": 46591459, "comment_id": 80136309, "body": "I could try to be more specific if you provide more code, like how you&#39;d write one or two of the special cases by hand."}, {"owner": {"reputation": 2225, "user_id": 1282031, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b868af647ee5a2cce5d19230646aa602?s=128&d=identicon&r=PG", "display_name": "Andreas Hagen", "link": "https://stackoverflow.com/users/1282031/andreas-hagen"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1507225136, "post_id": 46591459, "comment_id": 80136437, "body": "Added some code as an edit now =)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1507226062, "post_id": 46591459, "comment_id": 80136957, "body": "What&#39;s <code>collapse</code> about then? Is it used somewhere in the definition of <code>validate</code>? What&#39;s your AST type actually look like? All this general vagueness is rather unhelpful!"}, {"owner": {"reputation": 2225, "user_id": 1282031, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b868af647ee5a2cce5d19230646aa602?s=128&d=identicon&r=PG", "display_name": "Andreas Hagen", "link": "https://stackoverflow.com/users/1282031/andreas-hagen"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1507226412, "post_id": 46591459, "comment_id": 80137116, "body": "<code>collapse</code> was just a term I made up when I described the problem; as the <code>validate</code> function essentially collapses a tree I felt it sensible to name it <code>collapse</code> for generalities sake. For that matter the actual abstract syntax tree isn&#39;t made up of <code>Node1</code>, <code>Node2</code>, etc, but more sensibly named constructors like <code>Sum</code>, and <code>Multiply</code>, etc."}, {"owner": {"reputation": 2225, "user_id": 1282031, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b868af647ee5a2cce5d19230646aa602?s=128&d=identicon&r=PG", "display_name": "Andreas Hagen", "link": "https://stackoverflow.com/users/1282031/andreas-hagen"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1507227000, "post_id": 46591459, "comment_id": 80137446, "body": "Added the definition of the data type as well =)"}], "answers": [{"comments": [{"owner": {"reputation": 2225, "user_id": 1282031, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b868af647ee5a2cce5d19230646aa602?s=128&d=identicon&r=PG", "display_name": "Andreas Hagen", "link": "https://stackoverflow.com/users/1282031/andreas-hagen"}, "edited": false, "score": 0, "creation_date": 1507243948, "post_id": 46594494, "comment_id": 80144655, "body": "So this lens is a third party library, or what? I can only use the standard library as this is for some homework; so I guess i&#39;ll have do the <code>mkQ</code> version. And yes this seems to be exactly what I was looking for. Thanks =)"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 4, "last_activity_date": 1507237616, "last_edit_date": 1507237616, "creation_date": 1507236210, "answer_id": 46594494, "question_id": 46591459, "link": "https://stackoverflow.com/questions/46591459/how-to-fold-over-a-constructor-with-special-cases/46594494#46594494", "title": "How to fold over a constructor with special cases?", "body": "<p>The direct way to do what you want is to write your special case for <code>validate</code> as:</p>\n\n<pre><code>validate env expr = concat $ gmapQ ([] `mkQ` (validate env)) expr\n</code></pre>\n\n<p>This uses <code>mkQ</code> from <code>Data.Generics.Aliases</code>.  The whole point of <code>mkQ</code> is to create queries of type <code>forall d. Data d =&gt; d -&gt; u</code> that can operate differently on different <code>Data</code> instances.  By the way, there's no magic here.  You could have defined it manually in terms of <code>cast</code> as:</p>\n\n<pre><code>validate env expr = concat $ gmapQ myQuery expr\n  where myQuery :: Data d =&gt; d -&gt; [String]\n        myQuery d = case cast d of Just d -&gt; validate env d\n                                   _ -&gt; []\n</code></pre>\n\n<p>Still, I've generally found it clearer to use <code>uniplate</code> from the <code>lens</code> library.  The idea is to create a default <code>Plated</code> instance:</p>\n\n<pre><code>instance Plated Ast where\n  plate = uniplate   -- uniplate from Data.Data.Lens \n</code></pre>\n\n<p>which magically defines <code>children :: Ast -&gt; [Ast]</code> to return all direct descendants of a node.  You can then write your default <code>validate</code> case as:</p>\n\n<pre><code>validate env expr = concatMap (validate env) (children expr)\n</code></pre>\n\n<p>The full code w/ a test that prints [\"z\"]:</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable #-}\n\nmodule SpecialCase where\n\nimport Control.Lens.Plated\nimport Data.Data\nimport Data.Data.Lens (uniplate)\n\ndata Ast = Nr Int\n         | Sum Ast Ast\n         | Mul Ast Ast\n         | Min Ast\n         | If Ast Ast Ast\n         | Let String Ast Ast\n         | Var String\n           deriving (Show, Eq, Data)\n\ninstance Plated Ast where\n  plate = uniplate\n\nvalidate env (Let var val expr) = validate env val ++ validate (var:env) expr\nvalidate env (Var var) = if elem var env then [] else [var]\n-- either use this uniplate version:\nvalidate env expr = concatMap (validate env) (children expr)\n-- or use the alternative, lens-free version:\n-- validate env expr = concat $ gmapQ ([] `mkQ` (validate env)) expr\n\nmain = print $ validate [] (Let \"x\" (Nr 3) (Let \"y\" (Var \"x\") \n             (Sum (Mul (Var \"x\") (Var \"z\")) (Var \"y\"))))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2225, "user_id": 1282031, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b868af647ee5a2cce5d19230646aa602?s=128&d=identicon&r=PG", "display_name": "Andreas Hagen", "link": "https://stackoverflow.com/users/1282031/andreas-hagen"}, "edited": false, "score": 0, "creation_date": 1507244047, "post_id": 46595527, "comment_id": 80144681, "body": "I think this is probably as much boilerplate as the repeated code I was trying to avoid, but I&#39;ll read up on it a bit and see if this comes in handy somewhere =)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2225, "user_id": 1282031, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b868af647ee5a2cce5d19230646aa602?s=128&d=identicon&r=PG", "display_name": "Andreas Hagen", "link": "https://stackoverflow.com/users/1282031/andreas-hagen"}, "edited": false, "score": 0, "creation_date": 1507244136, "post_id": 46595527, "comment_id": 80144697, "body": "@AndreasHagen, most of the boilerplate is generated automatically by the call to <code>makeBaseFunctor &#39;&#39;Ast</code>. You don&#39;t have to write the <code>AstF</code> type or any of its instances. You also don&#39;t need the <code>Env</code> stuff I stuck in to make the code (I thought) clearer. The big advantage, I think, is that the operation is a lot less mysterious magic than what <code>Data</code> gives you."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1507242559, "last_edit_date": 1507242559, "creation_date": 1507241478, "answer_id": 46595527, "question_id": 46591459, "link": "https://stackoverflow.com/questions/46591459/how-to-fold-over-a-constructor-with-special-cases/46595527#46595527", "title": "How to fold over a constructor with special cases?", "body": "<p>I'm sorry I was too slow to get a <code>Data</code>-based answer written before K. A. Buhr jumped on it. Here's another approach, based on <code>recursion-schemes</code>.</p>\n\n<p>First, the boilerplate:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell, TypeFamilies\n           , DeriveTraversable #-}\n\nimport Data.Functor.Foldable\nimport Data.Functor.Foldable.TH\n\ndata Ast = Nr Int\n         | Sum Ast Ast\n         | Mul Ast Ast\n         | Min Ast\n         | If Ast Ast Ast\n         | Let String Ast Ast\n         | Var String\n         deriving (Show, Eq)\n\nmakeBaseFunctor ''Ast\n</code></pre>\n\n<p>This creates a type <code>AstF</code> that takes the recursion out of <code>Ast</code>. It looks like this:</p>\n\n<pre><code>data AstF ast = NrF Int\n              | SumF ast ast\n              | MulF ast ast\n              ....\n              deriving (Functor,Foldable,Traversable)\n</code></pre>\n\n<p>It then also creates several instances. We'll be using two of the auto-generated instances: the <code>Recursive</code> instance of <code>Ast</code> to recursively validate the tree, and the <code>Foldable</code> instance of <code>AstF</code> to concatenate the results from the children in the default case.</p>\n\n<p>I found it helpful to create a separate type for environments; this is quite optional.</p>\n\n<pre><code>newtype Env = Env {getEnv :: [String]}\n\nemptyEnv :: Env\nemptyEnv = Env []\n\nextendEnv :: String -&gt; Env -&gt; Env\nextendEnv a (Env as) = Env (a : as)\n\nisFree :: String -&gt; Env -&gt; Bool\nisFree a (Env as) = not (elem a as)\n</code></pre>\n\n<p>Now we can get down to business, using the <code>Recursive</code> instance of <code>Ast</code> to get <code>cata</code> for free.</p>\n\n<pre><code>validate :: Env -&gt; Ast -&gt; [String]\nvalidate env0 ast0 = cata go ast0 env0\n  where\n    go :: AstF (Env -&gt; [String]) -&gt; Env -&gt; [String]\n    go (LetF var val expr) env = val env ++ expr (extendEnv var env)\n    go (VarF var) env = [var | isFree var env]\n    go expr env = foldMap id expr env\n</code></pre>\n"}], "owner": {"reputation": 2225, "user_id": 1282031, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b868af647ee5a2cce5d19230646aa602?s=128&d=identicon&r=PG", "display_name": "Andreas Hagen", "link": "https://stackoverflow.com/users/1282031/andreas-hagen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "accepted_answer_id": 46594494, "answer_count": 2, "score": 0, "last_activity_date": 1507242559, "creation_date": 1507224158, "last_edit_date": 1507226967, "question_id": 46591459, "link": "https://stackoverflow.com/questions/46591459/how-to-fold-over-a-constructor-with-special-cases", "title": "How to fold over a constructor with special cases?", "body": "<p>So I have a tree that I want to collapse where the nodes are of type</p>\n\n<pre><code>data Node = Node1 Node | Node2 Node Node | ... deriving Data\n</code></pre>\n\n<p>except for a few special cases. I want to do something along the lines of </p>\n\n<pre><code>collapse SPECIALCASE1 = ...\ncollapse SPECIALCASE2 = ...\n...\ncollapse node = foldl (++) $ gmapQ validate node\n</code></pre>\n\n<p>where all the special cases generate lists of results that the last case just recursively collapses; but this doesn't work as the function that is the first parameter of gmapQ has to be of type <code>forall d. Data d =&gt; d -&gt; u</code> and not <code>Node -&gt; u</code>, which as far as I know just limits you to only using functions operating on the <code>Data</code> type.</p>\n\n<p>Is there any way of coercing the values in the problem to be of the correct type, or another more lenient map function perhaps?</p>\n\n<p>Extra info:</p>\n\n<p>The actual code for the function described above as <code>collapse</code> is named <code>validate</code> and is for traversing and finding unbound variables in an abstract syntax tree (for a very simple language) for which the special cases are handled like this</p>\n\n<pre><code>validate _ (Nr _) = []\nvalidate env (Let var val expr) = validate env val ++ validate (var:env) expr\nvalidate env (Var var) = if elem var env then [] else [var]\n</code></pre>\n\n<p>which is essentially the rules that literal numbers don't have variables in them, let expressions binds a variable and variables need to be checked if bound or not. Every other construct in this toy-language is just a combination of numbers and variables (e.g. summation, multiplication, etc.) and as such when I check for unbound variables I just need to traverse their sub-trees and combine the results; thus the <code>gmapQ</code>.</p>\n\n<p>Extra info 2:</p>\n\n<p>The actual data type used instead of the <code>Node</code> example above is of the form</p>\n\n<pre><code>data Ast = Nr Int\n         | Sum Ast Ast\n         | Mul Ast Ast\n         | Min Ast\n         | If Ast Ast Ast\n         | Let String Ast Ast\n         | Var String\n           deriving (Show, Eq, Data)\n</code></pre>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1507219959, "post_id": 46590242, "comment_id": 80133551, "body": "GHCi doesn&#39;t realize you are defining <i>one</i> function <code>f</code>. It proceeds line by line so <code>f x = x * f x - 1</code> is a function <code>f</code> shadowing the previous definition of <code>f</code> (<code>f 0 = 1</code>). To enter a multiline block, enter <code>:{</code>. Close that block with <code>:}</code>."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1507219978, "post_id": 46590242, "comment_id": 80133567, "body": "<a href=\"https://stackoverflow.com/questions/8443035/multi-line-commands-in-ghci\" title=\"multi line commands in ghci\">stackoverflow.com/questions/8443035/multi-line-commands-in-g&zwnj;&#8203;hci</a>"}, {"owner": {"reputation": 2531, "user_id": 6084317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4295c9b1ada748080d7a123f7263ae69?s=128&d=identicon&r=PG&f=1", "display_name": "Edward Minnix", "link": "https://stackoverflow.com/users/6084317/edward-minnix"}, "edited": false, "score": 3, "creation_date": 1507220127, "post_id": 46590242, "comment_id": 80133642, "body": "You&#39;re function definition also defines <code>f x</code> using <code>f x</code>. Your definition means that <code>f x = x * (f x) - 1</code>, not <code>x * (f (x - 1))</code>"}, {"owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1507220197, "post_id": 46590242, "comment_id": 80133684, "body": "@Alec It didn&#39;t work: Prelude&gt; :{ Prelude| f 0 = 1 Prelude| f x = x * f x - 1 Prelude| :} Prelude&gt; f 10 *** Exception: stack overflow Prelude&gt;"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1507220287, "post_id": 46590242, "comment_id": 80133739, "body": "@MarkNeu Sure it didn&#39;t, but not for the same reason. Note that <code>x * f x - 1</code> gets parsed as <code>(x * f x) - 1</code>. Did you mean <code>x * f (x - 1)</code>?"}, {"owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1507220476, "post_id": 46590242, "comment_id": 80133849, "body": "@Alec Thank you!"}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 9, "last_activity_date": 1507220825, "creation_date": 1507220825, "answer_id": 46590546, "question_id": 46590242, "link": "https://stackoverflow.com/questions/46590242/why-does-this-create-a-stackoverflow-error/46590546#46590546", "title": "Why does this create a StackOverflow Error?", "body": "<p>Your factorial seems innocent, but it isn't. It's parsed like this:</p>\n\n<pre><code>f 0 = 1\nf x = x * (f x) - 1\n</code></pre>\n\n<p>What happens if we use <code>f 1</code>?</p>\n\n<pre><code>f 1 = 1 * (f 1) - 1 = 1 * (1 * (f 1) - 1) - 1\n    = 1 * (1 * (1 * (f 1) - 1) - 1) - 1\n    = 1 * (1 * (1 * (1 * (f 1) - 1) - 1) - 1) - 1\n    = ...\n</code></pre>\n\n<p>I'm going to stop here. This will never end. It will build up a stack of parentheses, and at some the whole tower collapses and you end up with a stack overflow.</p>\n\n<p>You have to use parentheses:</p>\n\n<pre><code>f 0 = 1\nf x = x * f (x - 1)\n</code></pre>\n\n<p>Now we get the correct result:</p>\n\n<pre><code>f 1 = 1 * f (1 - 1) = 1 * f 0 = 1 * 1 = 1\n</code></pre>\n\n<p>Keep in mind that this works only in an implementation file. In GHCi you have to use multi-line mode or a semicolon:</p>\n\n<pre><code>ghci&gt; f 0 = 1; f x = x * f (x - 1)\nghci&gt; -- or\nghci&gt; :{\nghci| f 0 = 0\nghci| f x = x * f (x - 1)\nghci| :}\n</code></pre>\n\n<p>Otherwise later definitions will shadow earlier ones. Note that your prompt might differ.</p>\n"}], "owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 46590546, "answer_count": 1, "score": 2, "last_activity_date": 1507220825, "creation_date": 1507219715, "question_id": 46590242, "link": "https://stackoverflow.com/questions/46590242/why-does-this-create-a-stackoverflow-error", "title": "Why does this create a StackOverflow Error?", "body": "<p>I've started using Haskell lately, and defined this seemingly simple function:</p>\n\n<pre><code>f 0 = 1\nf x = x * f x - 1\n</code></pre>\n\n<p>However, it results in this:</p>\n\n<pre><code>GHCi, version 8.2.1: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; f 0 = 1\nPrelude&gt; f x = x * f x - 1\nPrelude&gt; f 10\n*** Exception: stack overflow\nPrelude&gt;\n</code></pre>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1507220385, "post_id": 46589538, "comment_id": 80133800, "body": "Is there a way to narrow down the problematic piece and make it short enough to post here? If it can&#39;t be narrowed down (e.g. by making enough related definitions trivial), why?"}, {"owner": {"reputation": 537, "user_id": 888445, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4381063157454f1bf8bd5effd0dd07b0?s=128&d=identicon&r=PG", "display_name": "Corey Staten", "link": "https://stackoverflow.com/users/888445/corey-staten"}, "reply_to_user": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 1, "creation_date": 1507220903, "post_id": 46589538, "comment_id": 80134114, "body": "I can&#39;t figure out a way to narrow it down; that&#39;s exactly what I&#39;m hoping to do by asking this question.  This is happening inside of a very large program, and the lazy generation of the infinite loop doesn&#39;t seem to be happening anywhere near the point of evaluation of the thunk.  I would like to know where in my program that thunk is coming from; for instance, is it a call to a certain known function with certain known parameters."}, {"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1507222439, "post_id": 46589538, "comment_id": 80135003, "body": "A related thread: <a href=\"https://stackoverflow.com/q/5337419/223424\">stackoverflow.com/q/5337419/223424</a>"}, {"owner": {"reputation": 537, "user_id": 888445, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4381063157454f1bf8bd5effd0dd07b0?s=128&d=identicon&r=PG", "display_name": "Corey Staten", "link": "https://stackoverflow.com/users/888445/corey-staten"}, "reply_to_user": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1507230009, "post_id": 46589538, "comment_id": 80138926, "body": "I&#39;ve looked at that thread; :history was not revealing, and running the program with profiling terminates quickly due to loop detection, so nothing obvious stands out as the loop location."}, {"owner": {"reputation": 2183, "user_id": 52310, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8729b9952488497d0343e8bd86afe8cb?s=128&d=identicon&r=PG", "display_name": "Alex R", "link": "https://stackoverflow.com/users/52310/alex-r"}, "edited": false, "score": 3, "creation_date": 1507410492, "post_id": 46589538, "comment_id": 80200742, "body": "Can you enable stack trace on exception and then Ctrl-C during the infinite loop?"}, {"owner": {"reputation": 537, "user_id": 888445, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4381063157454f1bf8bd5effd0dd07b0?s=128&d=identicon&r=PG", "display_name": "Corey Staten", "link": "https://stackoverflow.com/users/888445/corey-staten"}, "edited": false, "score": 0, "creation_date": 1510172183, "post_id": 46589538, "comment_id": 81327033, "body": "That doesn&#39;t seem to work; see here: <a href=\"https://stackoverflow.com/questions/47188857/ghci-hangs-when-ctrlcing-from-infinite-loop-with-fbreak-on-exception-set\" title=\"ghci hangs when ctrlcing from infinite loop with fbreak on exception set\">stackoverflow.com/questions/47188857/&hellip;</a>"}], "owner": {"reputation": 537, "user_id": 888445, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4381063157454f1bf8bd5effd0dd07b0?s=128&d=identicon&r=PG", "display_name": "Corey Staten", "link": "https://stackoverflow.com/users/888445/corey-staten"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 157, "favorite_count": 2, "answer_count": 0, "score": 10, "last_activity_date": 1509656531, "creation_date": 1507217616, "last_edit_date": 1507219371, "question_id": 46589538, "link": "https://stackoverflow.com/questions/46589538/debugging-an-unresolvable-thunk-in-ghci", "title": "Debugging an unresolvable thunk in GHCi", "body": "<p>I have an infinite loop somewhere in my program resulting in a <code>&lt;&lt;loop&gt;&gt;</code> exception when run normally.  Using GHCi, I've tracked the problem down to a thunk</p>\n\n<pre><code>f = Constructor1\n  (Constructor2 A :\n   (_t3::[DataType2]))\n</code></pre>\n\n<p>Attempting to sequence the thunk with <code>seq _t3 ()</code> results in GHCi hanging, so if I understand correctly the infinite loop is occurring in the reduction to Weak Head Normal Form.  Is there any way to investigate this thunk, for example to see step by step the reduction steps attempting to be used to evaluate it?</p>\n"}, {"tags": ["haskell", "haskell-turtle"], "answers": [{"comments": [{"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1507417726, "post_id": 46590855, "comment_id": 80202462, "body": "I&#39;ve tried that but it does not seems to work. <code>view $  traverse input [&quot;my_file.txt&quot;,&quot;my_other_file.txt&quot;]</code> yields <code>[Line &quot;foo&quot;,Line &quot;baz&quot;] [Line &quot;bar&quot;,Line &quot;baz&quot;]</code>, so the overall result when applying <code>mconcat</code> will be <code>Line &quot;foobaz&quot; Line &quot;barbaz&quot;</code>. Or am I missing something?"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 3, "last_activity_date": 1507221906, "creation_date": 1507221906, "answer_id": 46590855, "question_id": 46589445, "link": "https://stackoverflow.com/questions/46589445/turtle-how-to-read-a-list-of-files/46590855#46590855", "title": "Turtle: how to read a list of files?", "body": "<p><code>Line</code> has a <code>Monoid</code> instance. If we have a list of <code>Line</code>s, we can <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Monoid.html#v:mconcat\" rel=\"nofollow noreferrer\"><code>mconcat</code></a> them into a single one:</p>\n\n<pre><code>do\n  exampleA &lt;- input \"my_file.txt\"\n  exampleB &lt;- input \"my_other_file.txt\"\n  return $ mconcat [exampleA, exampleB]\n</code></pre>\n\n<p>Since <code>Shell</code> has an <code>Applicative</code> instance, we can use <code>traverse</code> to use <code>input</code> over a list of files:</p>\n\n<pre><code>traverse input [\"my_file.txt\",\"my_other_file.txt\"]\n</code></pre>\n\n<p>We end up with a <code>Shell [Line]</code>. Since <code>Shell</code> is a <code>Functor</code>, we can <code>fmap</code> <code>mconcat</code> (or <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Foldable.html#v:fold\" rel=\"nofollow noreferrer\"><code>fold</code></a> if you don't use a list):</p>\n\n<pre><code>mconcat &lt;$&gt; traverse input [\"my_file.txt\",\"my_other_file.txt\"]\n</code></pre>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 191, "favorite_count": 0, "accepted_answer_id": 46590855, "answer_count": 1, "score": 3, "last_activity_date": 1507417992, "creation_date": 1507217340, "last_edit_date": 1507417992, "question_id": 46589445, "link": "https://stackoverflow.com/questions/46589445/turtle-how-to-read-a-list-of-files", "title": "Turtle: how to read a list of files?", "body": "<p>Assume we have a file <code>my_file.txt</code> with contents:</p>\n\n<pre><code>foo\nbar\n</code></pre>\n\n<p>and another file <code>my_other_file.txt</code> containing:</p>\n\n<pre><code>baz\n</code></pre>\n\n<p>I would like to read the contents of these two files using <a href=\"https://hackage.haskell.org/package/turtle-1.4.4\" rel=\"nofollow noreferrer\"><code>turtle</code></a> so that I get a <a href=\"https://hackage.haskell.org/package/turtle-1.4.4/docs/Turtle-Shell.html#t:Shell\" rel=\"nofollow noreferrer\"><code>Shell</code></a> of lines which will produce:</p>\n\n<pre><code>foo\nbar\nbaz\n</code></pre>\n\n<p>In Haskell's <code>turtle</code> library one can read a list of files by using <a href=\"https://hackage.haskell.org/package/turtle-1.4.4/docs/Turtle-Prelude.html#v:input\" rel=\"nofollow noreferrer\"><code>input</code></a>, for instance:</p>\n\n<pre><code>view $ input \"my_file.txt\"\n</code></pre>\n\n<p>We have that </p>\n\n<pre><code>input :: FilePath -&gt; Shell Line\n</code></pre>\n\n<p>And <code>Shell</code> has no <code>Monoid</code> instances (which I think makes sense since we cannot associate <code>IO</code> operations), so the only operator I can think of using is <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Applicative.html#v:-60--124--62-\" rel=\"nofollow noreferrer\"><code>(&lt;|&gt;)</code></a>:</p>\n\n<pre><code>view $ foldl (&lt;|&gt;) empty $ map input [\"my_file.txt\", \"my_other_file.txt\"]\n</code></pre>\n\n<p>While this produces the desired effect, I wonder whether there is a library in the <code>turtle</code> eco-system that takes care of this, or whether there is a <code>traverse</code> like operation that can be use on <code>Alternative</code>'s.</p>\n\n<p><em>EDIT</em>: the effect above could be also achieved by using <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Foldable.html#v:asum\" rel=\"nofollow noreferrer\"><code>asum</code></a>:</p>\n\n<pre><code>asum $ input &lt;$&gt; [\"my_file.txt\", \"my_other_file.txt\"]\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming"], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 8727094, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71c1e467f0d11dc12e3ce176f1aacdaa?s=128&d=identicon&r=PG&f=1", "display_name": "Dibs", "link": "https://stackoverflow.com/users/8727094/dibs"}, "edited": false, "score": 1, "creation_date": 1507227229, "post_id": 46590471, "comment_id": 80137559, "body": "Wow thanks! I&#39;ve never worked with Either before but I&#39;m gonna try to use it in my solution."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 6, "last_activity_date": 1507227211, "last_edit_date": 1507227211, "creation_date": 1507220597, "answer_id": 46590471, "question_id": 46589051, "link": "https://stackoverflow.com/questions/46589051/haskell-finding-undeclared-variables/46590471#46590471", "title": "Haskell - Finding undeclared variables", "body": "<p>Let's start with types:</p>\n\n<blockquote>\n  <p>If there are any undeclared variables I need to give an appropriate error containing a list of ALL undeclared variables either while parsing.</p>\n</blockquote>\n\n<p>How about a function <code>eval</code> that will either give you list of the undeclared variables, or an <code>Int</code> (if there were no undeclared variables).</p>\n\n<pre><code>type Identifier = String\n\neval :: Env -&gt; AST -&gt; Either [Identifier] Int\n</code></pre>\n\n<p>We need to wrap raw numbers in a <code>Right</code> now:</p>\n\n<pre><code>eval env (Nr nr) = Right nr\n</code></pre>\n\n<p>The same for the a declared variable in the <code>Var</code> case,\nwhile an undeclared variable gets wrapped in a list and a <code>Left</code>:</p>\n\n<pre><code>eval env (Var x) = case lookup x env of\n    Just n -&gt; Right n\n    Nothing -&gt; Left [x]\n</code></pre>\n\n<p>For the <code>Min</code> case, we can't just negate the recursive call anymore, since\nnegation isn't defined for <code>Either [Identifier] Int</code>.</p>\n\n<p>We could pattern match to see what we got:</p>\n\n<pre><code>eval env (Min xs ) = case eval env xs of\n  Left err -&gt; Left err\n  Right x  -&gt; Right (-x)\n</code></pre>\n\n<p>But that's pretty wordy, and is exactly the same as using <code>fmap</code> from <code>Either e</code>'s functor instance:</p>\n\n<pre><code>eval env (Min xs ) = fmap negate (eval env xs)\n</code></pre>\n\n<p>Similarly for <code>Sum</code>, we could pattern match on both arguments:</p>\n\n<pre><code>eval env (Sum xs xss) = case (eval env xs, eval env xss) of\n  (Left err, Left err') -&gt; Left (err ++ err')\n  (Left err, Right _)   -&gt; Left err\n  (Right _, Left err')  -&gt; Left err'\n  (Right a, Right b)    -&gt; Right (a + b)\n</code></pre>\n\n<p>Note how if both subterms contain undeclared variables that we concatenate them to get the list of undeclared variables under the <code>Sum</code>. </p>\n\n<p>This is the same trick we'll need for the rest of the constructors.  However, I don't want have to type out a huge <code>case</code> statement like that every time. That's a lot of work for a little addition!  And <code>If</code> and <code>Let</code> are going to have eight cases!</p>\n\n<p>So let's make a helper function to do this for us:</p>\n\n<pre><code>apply :: Either [Identifier] (a -&gt; b) -&gt; Either [Identifier] a -&gt; Either [Identifier] b\napply (Left err) (Left err') = Left (err ++ err')\napply (Left err) (Right _)   = Left err\napply (Right _)  (Left err') = Left err'\napply (Right f)  (Right a)   = Right (f a)\n</code></pre>\n\n<p>Now defining cases for <code>Sum</code>, <code>Mul</code>, and <code>If</code> is much easier:</p>\n\n<pre><code>eval env (Sum xs xss) = fmap (+) (eval env xs) `apply` eval env xss\neval env (Mul xs xss) = fmap (*) (eval env xs) `apply` eval env xss\neval env (If x xs xss) = fmap jnz (eval env x) `apply` eval env xs `apply` eval env xss\n  where jnz i a a' = if i == 0 then a else a'\n</code></pre>\n\n<p><code>Let</code> is slightly different:</p>\n\n<pre><code>eval env (Let s xs xss) = fmap second v `apply` eval env' xss\n  where val = eval env xs\n        env' = (s,val) : env\n        getRight (Right a) = a\n        getRight (Left _) = 0\n        second _ a = a\n</code></pre>\n\n<p>Note how we \"cheat\" by providing a bogus value to the environment for the second term when the first term contains an undeclared variable. Since we're not going to be use any <code>Int</code> value the second term might yield in this case anyway, this is ok.</p>\n\n<hr>\n\n<p>Once you get a bit further in Haskell, you might notice that <code>apply</code> looks a lot like <code>&lt;*&gt;</code> from <code>Applicative</code>. The reason we didn't just use that is that <code>Either e</code>'s <code>Applicative</code> instance doesn't work how we want it to. Instead of aggregating the errors, it quits when it hits the first one:</p>\n\n<pre><code>&gt;&gt;&gt; Left [\"foo\"] `apply` Left [\"bar\", \"baz\"]\nLeft [\"foo\", \"bar\", \"baz\"]\n&gt;&gt;&gt; Left [\"foo\"] &lt;*&gt; Left [\"bar\", \"baz\"]\nLeft [\"foo\"]\n</code></pre>\n\n<p>However, there's the <a href=\"https://hackage.haskell.org/package/either-4.4.1.1/docs/Data-Either-Validation.html#t:Validation\" rel=\"nofollow noreferrer\"><code>Validation</code> type from the <code>either</code> package</a> that has an applicative instance that works exactly this way, so if you wanted, you could use that:</p>\n\n<pre><code>&gt;&gt;&gt; Failure [\"foo\"] &lt;*&gt; Failure [\"bar\", \"baz\"]\nFailure [\"foo\", \"bar\", \"baz\"]\n</code></pre>\n\n<hr>\n\n<p>One approach that might make the <code>Let</code> case less hacky would be to change the return type of <code>eval</code> from <code>Either [Identifier] Int</code> to <code>([Identifier], [(Identifier, Int)] -&gt; Int)</code> - have it return a list of all the free variables in the expression, along with a way to evaluate the expression given a binding of those variables.</p>\n\n<p>If we give that type a name:</p>\n\n<pre><code>data Result a = Result { freeVariables :: [Identifier], eval :: [(Identifier,Int)] -&gt; a }\n</code></pre>\n\n<p>We can define <code>Functor</code> and <code>Applicative</code> instances for it:</p>\n\n<pre><code>instance Functor Result where\n  fmap f (Result is g) = Result is (f . g)\ninstance Applicative Result where\n  pure a = Result [] (const a)\n  Result is ff &lt;*&gt; js fa = Result (is ++ js) (ff &lt;*&gt; js)\n</code></pre>\n\n<p>And use those to easily define a function to parse out the free variables and an eval expression:</p>\n\n<pre><code>parse :: AST -&gt; Result Int\nparse (Nr nr) = pure nr\nparse (Sum xs xss) = (+) &lt;$&gt; parse xs &lt;*&gt; parse xss\nparse (Mul xs xss) = (*) &lt;$&gt; parse xs &lt;*&gt; parse xss\nparse (Min xs ) = negate &lt;$&gt; parse xs\nparse (If x xs xss) = jnz &lt;$&gt; parse x &lt;*&gt; parse xs &lt;*&gt; parse xss\n  where jnz a b c = if a == 0 then b else c\nparse (Let s xs xss) = Result ks h\n  where Result is f = parse xs\n        Result js g = parse xss\n        ks = is ++ delete s js\n        h env = g ((s,f env):env)\nparse (Var x) = Result [x] $ \\env -&gt; case lookup x env of\n  Just n -&gt; n\n  Nothing -&gt; error (\"Variable \" ++ x ++ \" is undeclared!\")\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 8727094, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71c1e467f0d11dc12e3ce176f1aacdaa?s=128&d=identicon&r=PG&f=1", "display_name": "Dibs", "link": "https://stackoverflow.com/users/8727094/dibs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 1, "accepted_answer_id": 46590471, "answer_count": 1, "score": 2, "last_activity_date": 1507227211, "creation_date": 1507216183, "question_id": 46589051, "link": "https://stackoverflow.com/questions/46589051/haskell-finding-undeclared-variables", "title": "Haskell - Finding undeclared variables", "body": "<p><strong>AST:</strong></p>\n\n<pre><code>data AST = Nr Int | Sum AST AST | Mul AST AST | Min AST | If AST AST AST | \nLet String AST AST | Var String deriving (Eq, Show)\n</code></pre>\n\n<p>Hi! I need some help finding undeclared variables in the input. My problem is that I can't simply do it in my evaluator like so:</p>\n\n<pre><code>eval :: Env -&gt; AST -&gt; Int\neval env (Nr nr) = nr\neval env (Sum xs xss) = eval env xs + eval env xss\neval env (Mul xs xss) = eval env xs * eval env xss\neval env (Min xs ) = - eval env xs\neval env (If x xs xss) = if (eval env x == 0)\n                then eval env xs\n                else eval env xss\neval env (Let s xs xss) = eval ((s, (eval env xs)) : env) xss \neval env (Var x) = case lookup x env of\n    Just n -&gt; n\n    Nothing -&gt; error (\"Variable \" ++ x ++ \" is undeclared!\")\n</code></pre>\n\n<p>If there are any undeclared variables I need to give an appropriate error containing a list of ALL undeclared variables either while parsing, or post process my AST before evaluating. And I'm not sure where to start. Here's an example of a parsed expression:</p>\n\n<pre><code>parse \"let X = + 1 2 in * X + 2 - X\"\n    Let \"X\" (Sum (Nr 1) (Nr 2)) (Mul (Var \"X\") (Sum (Nr 2) (Min (Var \"X\"))))\n</code></pre>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1507221719, "post_id": 46589047, "comment_id": 80134595, "body": "You can think of the first version of <code>MapSnd</code> as &quot;lazier&quot; than the second one. I believe you absolutely need that laziness if you want to be polymorphic in <code>f</code> like that."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 4, "last_activity_date": 1507234705, "last_edit_date": 1507234705, "creation_date": 1507223065, "answer_id": 46591174, "question_id": 46589047, "link": "https://stackoverflow.com/questions/46589047/is-there-a-way-to-use-type-level-pattern-matching-rather-than-defining-a-type-fa/46591174#46591174", "title": "Is there a way to use type-level pattern matching rather than defining a type family", "body": "<p>The statement</p>\n\n<pre><code>exists a. x ~ '(a, b)\n</code></pre>\n\n<p>is slightly stronger than the statement</p>\n\n<pre><code>b ~ Snd x\n</code></pre>\n\n<p>For example, given</p>\n\n<pre><code>type family Any :: (*, *) where {}\n</code></pre>\n\n<p>It is valid to conclude</p>\n\n<pre><code>Snd Any ~ Snd Any\n</code></pre>\n\n<p>But it is not valid to conclude</p>\n\n<pre><code>exists a. Any ~ '(a, Snd Any)\n</code></pre>\n\n<p>because <code>Any</code> doesn't unify with anything else whatsoever.</p>\n\n<p>You have an <code>HList</code> of things indexed by types of kind <code>(*,*)</code>, but you don't know that each element actually has a type of the form <code>'(a,b)</code>, so you can't pass a proof of that to the function you're given. Now if you had a less-polymorphic list, where the element type was indexed in a known way, then you could pattern match on the elements to get what you want. But that's not what you have, and it's considerably less general and useful. With your current (working) formulation, the passed function is responsible for working out whatever information it needs to know about the structure of the index. But that's perfectly fine; it's in a much better position to know the structure of <code>f</code> than you are. Take your winnings and go!</p>\n"}], "owner": {"reputation": 2183, "user_id": 52310, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8729b9952488497d0343e8bd86afe8cb?s=128&d=identicon&r=PG", "display_name": "Alex R", "link": "https://stackoverflow.com/users/52310/alex-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 46591174, "answer_count": 1, "score": 4, "last_activity_date": 1507234705, "creation_date": 1507216164, "question_id": 46589047, "link": "https://stackoverflow.com/questions/46589047/is-there-a-way-to-use-type-level-pattern-matching-rather-than-defining-a-type-fa", "title": "Is there a way to use type-level pattern matching rather than defining a type family", "body": "<p>Consider the following 3 Haskell files</p>\n\n<p>HList.hs</p>\n\n<pre><code>{-# LANGUAGE DataKinds     #-}\n{-# LANGUAGE GADTs         #-}\n{-# LANGUAGE PolyKinds     #-}\n{-# LANGUAGE TypeOperators #-}\nmodule HList where\n\ndata HList :: (k -&gt; *) -&gt; [k] -&gt; * where\n  Nil :: HList f '[]\n  (:&amp;) :: !(f x) -&gt; HList f xr -&gt; HList f (x ': xr)\n</code></pre>\n\n<p>Snd.hs</p>\n\n<pre><code>{-# LANGUAGE DataKinds           #-}\n{-# LANGUAGE KindSignatures      #-}\n{-# LANGUAGE RankNTypes          #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeFamilies        #-}\n{-# LANGUAGE TypeOperators       #-}\nmodule Snd where\n\nimport           HList\n\nhmap :: forall f g xs. (forall x. f x -&gt; g x) -&gt; HList f xs -&gt; HList g xs\nhmap f = go\n\n  where\n    go :: HList f xs' -&gt; HList g xs'\n    go Nil       = Nil\n    go (x :&amp; xs) = f x :&amp; go xs\n\ntype family Snd x where\n  Snd '(a, b) = b\n\ntype family MapSnd xs where\n  MapSnd '[] = '[]\n  MapSnd (y ': ys) = Snd y ': MapSnd ys\n\nhmap2 :: forall f g (xs :: [(*,*)]). (forall x. f x -&gt; g (Snd x)) -&gt; HList f xs -&gt; HList g (MapSnd xs)\nhmap2 f = go\n  where\n    go :: HList f xs' -&gt; HList g (MapSnd xs')\n    go Nil       = Nil\n    go (x :&amp; xs) = f x :&amp; go xs\n</code></pre>\n\n<p>NoSnd.hs</p>\n\n<pre><code>{-# LANGUAGE DataKinds           #-}\n{-# LANGUAGE KindSignatures      #-}\n{-# LANGUAGE RankNTypes          #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeFamilies        #-}\n{-# LANGUAGE TypeOperators       #-}\nmodule NoSnd where\n\nimport           HList\n\nhmap :: forall f g xs. (forall x. f x -&gt; g x) -&gt; HList f xs -&gt; HList g xs\nhmap f = go\n  where\n    go :: HList f xs' -&gt; HList g xs'\n    go Nil       = Nil\n    go (x :&amp; xs) = f x :&amp; go xs\n\ntype family MapSnd xs where\n  MapSnd '[] = '[]\n  MapSnd ('(_, y) ': ys) = y ': MapSnd ys\n\nhmap2 :: forall f g (xs :: [(*,*)]). (forall x a b. (x ~ '(a, b)) =&gt; f x -&gt; g b) -&gt; HList f xs -&gt; HList g (MapSnd xs)\nhmap2 f = go\n  where\n    go :: HList f xs' -&gt; HList g (MapSnd xs')\n    go Nil       = Nil\n    go (x :&amp; xs) = f x :&amp; go xs\n</code></pre>\n\n<p>Compiling <code>Snd.hs</code> works, but compiling <code>NoSnd.hs</code> gives</p>\n\n<pre><code>NoSnd.hs:27:20: error:\n    \u2022 Could not deduce: x ~ '(a0, x0) arising from a use of \u2018f\u2019\n      from the context: xs' ~ (x : xr)\n        bound by a pattern with constructor:\n                   :&amp; :: forall k (a :: k -&gt; *) (x :: k) (xr :: [k]).\n                         a x -&gt; HList a xr -&gt; HList a (x : xr),\n                 in an equation for \u2018go\u2019\n        at NoSnd.hs:27:9-15\n      \u2018x\u2019 is a rigid type variable bound by\n        a pattern with constructor:\n          :&amp; :: forall k (a :: k -&gt; *) (x :: k) (xr :: [k]).\n                a x -&gt; HList a xr -&gt; HList a (x : xr),\n        in an equation for \u2018go\u2019\n        at NoSnd.hs:27:9\n    \u2022 In the first argument of \u2018(:&amp;)\u2019, namely \u2018f x\u2019\n      In the expression: f x :&amp; go xs\n      In an equation for \u2018go\u2019: go (x :&amp; xs) = f x :&amp; go xs\n    \u2022 Relevant bindings include x :: f x (bound at NoSnd.hs:27:9)\n</code></pre>\n\n<p>The difference between <code>Snd.hs</code> and <code>NoSnd.hs</code> is that, in the latter, instead of defining a type family <code>Snd</code>, I try to destructure types directly. This happens in two places: the definition of <code>MapSnd</code> and the type of (the parameter to) <code>hmap2</code>.</p>\n\n<p>The two questions are: can someone explain the type error; and is there a way to write <code>hmap2</code> without defining a <code>Snd</code> type family?</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["haskell", "documentation-generation", "haddock", "servant"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1507213973, "post_id": 46588129, "comment_id": 80129647, "body": "Can you just split the <code>type</code> into multiple <code>type</code>s? e.g. <code>type Route1 = ..; type Route2 = ..; type Public = Route1 :&lt;|&gt; Route2</code>."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1507222070, "post_id": 46588129, "comment_id": 80134786, "body": "@user2407038 yes, you can. That&#39;s an answer."}, {"owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1507275557, "post_id": 46588129, "comment_id": 80153165, "body": "@user2407038 Indeed, that would work - at the expense of added boilerplate."}, {"owner": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 0, "creation_date": 1535027005, "post_id": 46588129, "comment_id": 90920763, "body": "Yes, I&#39;m afraid this is the best solution. Then you can document each route in haddock with the usual <code>-- |</code>-style docs, since you now have one toplevel &quot;thing&quot; per endpoint."}], "answers": [{"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 2, "last_activity_date": 1551203174, "creation_date": 1551203174, "answer_id": 54891336, "question_id": 46588129, "link": "https://stackoverflow.com/questions/46588129/auto-generate-servant-api-documentation-for-haskell-developers/54891336#54891336", "title": "Auto-generate Servant-API documentation for Haskell developers", "body": "<p>Using per endpoint <code>type</code> aliases was mentioned in comments. However, newer <code>servant</code> has <code>Servant.API.Generic</code> (read more at <a href=\"https://haskell-servant.readthedocs.io/en/stable/cookbook/generic/Generic.html\" rel=\"nofollow noreferrer\">https://haskell-servant.readthedocs.io/en/stable/cookbook/generic/Generic.html</a>) which let's you write your API in more structured way:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Public route = Public\n\n  -- | create new user\n   { routeNewUser :: route :- \"new\"    :&gt; ReqBody '[JSON] UserNewRequest    :&gt; Post '[JSON] UserNewResponse\n\n  -- | check if user exists\n  , routeExists   :: route :- \"exists\" :&gt; ReqBody '[JSON] UserExistsRequest :&gt; Post '[JSON] Bool\n\n  -- | user login\n  , routeLogin    :: route :- \"login\"  :&gt; ReqBody '[JSON] LoginRequest      :&gt; Post '[JSON] LoginResponse\n  }\n</code></pre>\n\n<p>This approach is a bit more tricky with nested APIs, but it has a lot of benefits in \"linear\" apis.</p>\n"}], "owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "accepted_answer_id": 54891336, "answer_count": 1, "score": 1, "last_activity_date": 1551203174, "creation_date": 1507213585, "question_id": 46588129, "link": "https://stackoverflow.com/questions/46588129/auto-generate-servant-api-documentation-for-haskell-developers", "title": "Auto-generate Servant-API documentation for Haskell developers", "body": "<p>I build a web-API using <code>servant</code> that grows increasingly large.</p>\n\n<p>I am aware of two ways to automatically create documentation for the api.</p>\n\n<p>First, there's haddock. Haddock turns my code into hyperlinked HTML-pages. Neat! This is especially helpful, because my api endpoints tend to stretch out over several modules and now I can browse through them and find relevant type information.</p>\n\n<p>However, <code>haddock</code> doesn't exactly have a way of displaying lines like these properly:</p>\n\n<pre><code>type Public =\n       \"new\"    :&gt; ReqBody '[JSON] UserNewRequest    :&gt; Post '[JSON] UserNewResponse\n  :&lt;|&gt; \"exists\" :&gt; ReqBody '[JSON] UserExistsRequest :&gt; Post '[JSON] Bool\n  :&lt;|&gt; \"login\"  :&gt; ReqBody '[JSON] LoginRequest      :&gt; Post '[JSON] LoginResponse\n</code></pre>\n\n<p>Haddock turns it into something like this:</p>\n\n<pre><code>type Public = (\"new\" :&gt; (ReqBody '[JSON] UserNewRequest :&gt; Post '[JSON] UserNewResponse)) :&lt;|&gt; ((\"exists\" :&gt; (ReqBody '[JSON] UserExistsRequest :&gt; Post '[JSON] Bool)) :&lt;|&gt; (\"login\" :&gt; (ReqBody '[JSON] LoginRequest :&gt; Post '[JSON] LoginResponse)))\n</code></pre>\n\n<p>... even adding parentheses. Ironically, formatting is prettier in the code, simply because of the line breaks.</p>\n\n<p>Second, there ist <code>servant-docs</code>. However, <code>servant-docs</code> quite consistently builds a documentation of the endpoints, with nice hooks to add examples that are shown e.g. in JSON. <code>Servant-docs</code> doesn't aim to provide haskell type information - which is all I am after.</p>\n\n<hr>\n\n<p>So either, I find a way to have <code>haddock</code> display long types in a pretty way, OR I find a way to display haskell types with <code>servant-docs</code>.</p>\n\n<p>In both cases, it doesn't seem to fit their designs. I might need something else entirely.</p>\n\n<hr>\n\n<p>What I tried already with <code>haddock</code>:</p>\n\n<pre><code>type Public =\n\n  -- create new user\n       \"new\"    :&gt; ReqBody '[JSON] UserNewRequest    :&gt; Post '[JSON] UserNewResponse\n\n  -- check if user exists\n  :&lt;|&gt; \"exists\" :&gt; ReqBody '[JSON] UserExistsRequest :&gt; Post '[JSON] Bool\n\n  -- user login\n  :&lt;|&gt; \"login\"  :&gt; ReqBody '[JSON] LoginRequest      :&gt; Post '[JSON] LoginResponse\n</code></pre>\n\n<p>It's valid haskell, but the comments are ignored by <code>haddock</code>. Using haddock title syntax <code>--|</code> or <code>-- *</code> results in haddock compile errors.</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1507212976, "post_id": 46586941, "comment_id": 80128938, "body": "Nothing jumps out at me, but what happens if you add one/both of <code>-A200M</code> and <code>-qa</code> to your RTS options?"}, {"owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1507213762, "post_id": 46586941, "comment_id": 80129494, "body": "With <code>.&#47;parallel_compute +RTS -N4 -s -qa -A200M</code>, the results are nearly identical. Which is what I would suspect since the the program doesn&#39;t really allocate much."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1507215093, "post_id": 46586941, "comment_id": 80130468, "body": "Hm, I guess those statistics are from the criterion <code>main</code> and probably not very useful (criterion calculates statistics in parallel last time I looked, for instance). From experience I&#39;ve come to distrust the way the runtime and the way the GC interacts with parallelism/concurrency with default settings.  An observation: doing some quick math, your serial version is about as fast as we&#39;d hope. It seems <i>possible</i> that those two small chunks you&#39;re evaluating in parallel are simply suffering from bad cache behavior, but I can&#39;t make the numbers add up there"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1507215590, "post_id": 46586941, "comment_id": 80130817, "body": "For what it&#39;s worth, when I ran your code I only got 60/604 fizzled sparks the first time and 45/554 the second."}, {"owner": {"reputation": 215, "user_id": 904219, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/16b684a72bf6d9c58f534aa525253030?s=128&d=identicon&r=PG", "display_name": "Will Fancher", "link": "https://stackoverflow.com/users/904219/will-fancher"}, "edited": false, "score": 0, "creation_date": 1507224214, "post_id": 46586941, "comment_id": 80135935, "body": "Possibly related? <a href=\"https://stackoverflow.com/q/22638421\">stackoverflow.com/q/22638421</a>"}, {"owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1507226300, "post_id": 46586941, "comment_id": 80137051, "body": "@jberryman I&#39;ve updated the question to include another implementation using <code>MVar</code>. The performance it achieves should alleviate concerns that it&#39;s a cache-related issue since the <code>MVar</code>-based approach would suffer from the same problem."}, {"owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "reply_to_user": {"reputation": 215, "user_id": 904219, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/16b684a72bf6d9c58f534aa525253030?s=128&d=identicon&r=PG", "display_name": "Will Fancher", "link": "https://stackoverflow.com/users/904219/will-fancher"}, "edited": false, "score": 0, "creation_date": 1507226398, "post_id": 46586941, "comment_id": 80137103, "body": "@WillFancher In the issue you&#39;ve linked to, the problem is that the parallelism was too fine-grained. This shouldn&#39;t be an issue here since the sparks are being assigned to something that takes over a millisecond."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1507234097, "post_id": 46586941, "comment_id": 80140946, "body": "Sorry, I wasn&#39;t really clear: in your original you&#39;ve sparked only two small chunks of work which will be run in parallel with the larger chunk, so you should expect a 25% speedup at most. Your MVar example isn&#39;t comparable. The remainder of the performance difference I don&#39;t know how to account for"}, {"owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "edited": false, "score": 1, "creation_date": 1507236964, "post_id": 46586941, "comment_id": 80142274, "body": "Sorry, I should have been more clear about the motivation of the <code>MVar</code> example. I played around with the original example a bit before I posted this question. Making the chunk size more evenly distributed doesn&#39;t help, because for some reason, a huge number of the sparks always fizzle. When I divide it evenly like I do in the <code>MVar</code> example, it&#39;s about 66% of the sparks that get fizzled, and it&#39;s the same speed as the serial version. Something I&#39;ve noticed about the spark-based approach is that the order in which I multiply the subresults at the end impacts the percentage of them that fizzle."}, {"owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "edited": false, "score": 0, "creation_date": 1507237108, "post_id": 46586941, "comment_id": 80142327, "body": "Continuing my last comment, this leads me to believe that <code>rseq</code> may not actually do what I think it does. My expectation is that the main thread should block until we have completely computed the product of that slice of the vector, but I suspect that this isn&#39;t happening."}, {"owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "edited": false, "score": 0, "creation_date": 1507238807, "post_id": 46586941, "comment_id": 80143086, "body": "As I think about it more, I don&#39;t totally understand how work stealing is handled. If there is only one thread that steals work from the others, that would help explain the unsatisfactory performance I am seeing from sparks. Although, the issue related to re-ordering the final results still gives me some suspicions elsewhere."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1507240051, "post_id": 46586941, "comment_id": 80143549, "body": "I haven&#39;t worked much with pure parallelism and reviewed both the docs for the parallel-strategies lib and the intro chapter in Simon Marlow&#39;s book and came away with the same impression as you, i.e. that this should work. So I&#39;d say that this is at least a case of poor documentation which would be good to report if you can. It does seem like something like the following happens: as soon as the <code>rseq</code> computation finishes we&#39;re allowed to return, if at that point the <code>rpar</code> sparks have not completed, they fizzle and get recomputed from the thunk you return, in <code>(p1 * p2 * p3)</code>...or something?"}], "answers": [{"comments": [{"owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "edited": false, "score": 1, "creation_date": 1507293294, "post_id": 46603680, "comment_id": 80163435, "body": "This solves it. Although tweaking the scheduling interval like this seems like it might negatively affect other things. So I suppose that in the normal case, if you&#39;re going to be sparking things, you should ensure that the work done by all the sparks plus the main thread takes well over 20ms. Otherwise, nearly everything will fizzle unless scheduling happens to be coming soon. I&#39;ve always wondered about the threshold for how fine-grained sparks should be, and my understanding is now that this is roughly it. Also, where did you find documentation of <code>-C</code>? I cannot find it."}, {"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "reply_to_user": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "edited": false, "score": 0, "creation_date": 1507293694, "post_id": 46603680, "comment_id": 80163726, "body": "@AndrewThaddeusMartin I added a link to the docs. Re the threshold - yes, that is my impression too. Though I never used parallel strategies in practice."}, {"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "reply_to_user": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "edited": false, "score": 0, "creation_date": 1507293856, "post_id": 46603680, "comment_id": 80163830, "body": "@AndrewThaddeusMartin Probably it makes sense to file a bug to see what ghc devs think about spark scheduling. I wonder whether it is possible to wakeup a capability immediately."}], "tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": true, "score": 6, "last_activity_date": 1507293543, "last_edit_date": 1507293543, "creation_date": 1507285721, "answer_id": 46603680, "question_id": 46586941, "link": "https://stackoverflow.com/questions/46586941/why-are-ghc-sparks-fizzling/46603680#46603680", "title": "Why are GHC Sparks Fizzling?", "body": "<p>The problem here is that creating spark doesn't immediately wakeup idle capability, see <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Rts/Scheduler#Sparksandtheparoperator\" rel=\"noreferrer\">here</a>. By default scheduling interval is 20ms, so when you create a spark, it will take up to 20 ms to turn it to a real thread. By that time the calling thread most likely will already evaluate the thunk, and the spark will be either GC'd or fizzled.</p>\n\n<p>By contrast, <code>forkIO</code> will immediately wakeup idle capability if any. That is why explicit concurrency is more reliable then parallel strategies.</p>\n\n<p>You can workaround the issue by decreasing scheduling interval using <code>-C</code> option (<a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/using-concurrent.html#rts-flag--C\" rel=\"noreferrer\">docs</a>). E.g. <code>+RTS -C0.01</code> seems to be enough.</p>\n"}], "owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1331, "favorite_count": 3, "accepted_answer_id": 46603680, "answer_count": 1, "score": 6, "last_activity_date": 1507293543, "creation_date": 1507210288, "last_edit_date": 1507226136, "question_id": 46586941, "link": "https://stackoverflow.com/questions/46586941/why-are-ghc-sparks-fizzling", "title": "Why are GHC Sparks Fizzling?", "body": "<p>I have a simple routine that takes the product of a vector of <code>Double</code>. I am attempting to parallelize this code, but many of the sparks end up fizzling. Here is a self-contained benchmark which is also provided <a href=\"https://gist.github.com/andrewthad/8ba8b678bfc864de349b0366d10b5ac0\" rel=\"nofollow noreferrer\">as a gist</a>:</p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\n{-# LANGUAGE MagicHash #-}\n\n{-# OPTIONS_GHC -O2 -Wall -threaded -fforce-recomp #-}\n\nimport Criterion.Main\nimport Control.Monad (when)\nimport Control.Parallel.Strategies (runEval,rpar,rseq)\nimport qualified Data.Vector.Primitive as PV\n\nmain :: IO ()\nmain = do\n  let expected = PV.product numbers\n  when (not (serialProduct numbers == expected)) $ do\n    fail \"serialProduct implementation incorrect\"\n  defaultMain\n    [ bgroup \"product\"\n      [ bench \"serial\" $ whnf serialProduct numbers\n      , bench \"parallel\" $ whnf parallelProduct numbers\n      ]\n    ]\n\nnumbers :: PV.Vector Double\nnumbers = PV.replicate 10000000 1.00000001\n{-# NOINLINE numbers #-}\n\nserialProduct :: PV.Vector Double -&gt; Double\nserialProduct v =\n  let !len = PV.length v\n      go :: Double -&gt; Int -&gt; Double\n      go !d !ix = if ix &lt; len then go (d * PV.unsafeIndex v ix) (ix + 1) else d\n   in go 1.0 0\n\n-- | This only works when the vector length is a multiple of 8.\nparallelProduct :: PV.Vector Double -&gt; Double\nparallelProduct v = runEval $ do\n  let chunk = div (PV.length v) 8\n  p2 &lt;- rpar (serialProduct (PV.slice (chunk * 6) chunk v))\n  p3 &lt;- rpar (serialProduct (PV.slice (chunk * 7) chunk v))\n  p1 &lt;- rseq (serialProduct (PV.slice (chunk * 0) (chunk * 6) v))\n  return (p1 * p2 * p3)\n</code></pre>\n\n<p>This can be built and run with:</p>\n\n<pre><code>ghc -threaded parallel_compute.hs\n./parallel_compute +RTS -N4 -s\n</code></pre>\n\n<p>I have an eight-core box, so giving the runtime four capabilities should be fine. The benchmark results are not super important, but here they are:</p>\n\n<pre><code>benchmarking product/serial\ntime                 11.40 ms   (11.30 ms .. 11.53 ms)\n                     0.999 R\u00b2   (0.998 R\u00b2 .. 1.000 R\u00b2)\nmean                 11.43 ms   (11.37 ms .. 11.50 ms)\nstd dev              167.2 \u03bcs   (120.4 \u03bcs .. 210.1 \u03bcs)\n\nbenchmarking product/parallel\ntime                 10.03 ms   (9.949 ms .. 10.15 ms)\n                     0.999 R\u00b2   (0.999 R\u00b2 .. 1.000 R\u00b2)\nmean                 10.17 ms   (10.11 ms .. 10.31 ms)\nstd dev              235.7 \u03bcs   (133.4 \u03bcs .. 426.2 \u03bcs)\n</code></pre>\n\n<p>Now, the runtime statistics. This is where I'm confused:</p>\n\n<pre><code>   124,508,840 bytes allocated in the heap\n   529,843,176 bytes copied during GC\n    80,232,008 bytes maximum residency (8344 sample(s))\n       901,272 bytes maximum slop\n            83 MB total memory in use (0 MB lost due to fragmentation)\n\n                                   Tot time (elapsed)  Avg pause  Max pause\nGen  0        19 colls,    19 par    0.008s   0.001s     0.0001s    0.0003s\nGen  1      8344 colls,  8343 par    2.916s   1.388s     0.0002s    0.0008s\n\nParallel GC work balance: 76.45% (serial 0%, perfect 100%)\n\nTASKS: 13 (1 bound, 12 peak workers (12 total), using -N4)\n\nSPARKS: 1024 (502 converted, 0 overflowed, 0 dud, 28 GC'd, 494 fizzled)\n\nINIT    time    0.000s  (  0.002s elapsed)\nMUT     time   11.480s  ( 10.414s elapsed)\nGC      time    2.924s  (  1.389s elapsed)\nEXIT    time    0.004s  (  0.005s elapsed)\nTotal   time   14.408s  ( 11.811s elapsed)\n\nAlloc rate    10,845,717 bytes per MUT second\n\nProductivity  79.7% of total user, 88.2% of total elapsed\n</code></pre>\n\n<p>In the section that deals with sparks, we can see that about half of them fizzle. This seems unbelievable to me. In <code>parallelProduct</code>, we have the main thread work on a task 6 times larger than what is given to either of the sparks. However, it seems like one of these sparks always gets fizzled (or GCed). And this isn't a small job either. We're talking about a computation that takes milliseconds, so it seems implausible that the main thread could finish it before the other thunks get sparked.</p>\n\n<p>My understanding (which could be totally wrong) is that this kind of computation should be ideal for the concurrent runtime. Garbage collection seems to be the biggest problem for concurrent applications in GHC, but the task I'm doing here doesn't generate any almost garbage, since GHC turns the innards of <code>serialProduct</code> into a tight loop with everything unboxed.</p>\n\n<p>On the upside, we <strong>do</strong> see an 11% speedup for the parallel version in the benchmarks. So, the eighth portion of the work that was successfully sparked really did make a measurable impact. I'm just wondering why that other spark doesn't work like I expect it to.</p>\n\n<p>Any help on understanding this would be appreciated.</p>\n\n<p>EDIT</p>\n\n<p>I've update <a href=\"https://gist.github.com/andrewthad/8ba8b678bfc864de349b0366d10b5ac0\" rel=\"nofollow noreferrer\">the gist</a> to include another implementation:</p>\n\n<pre><code>-- | This only works when the vector length is a multiple of 4.\nparallelProductFork :: PV.Vector Double -&gt; Double\nparallelProductFork v = unsafePerformIO $ do\n  let chunk = div (PV.length v) 4\n  var &lt;- newEmptyMVar \n  _ &lt;- forkIO $ evaluate (serialProduct (PV.slice (chunk * 0) chunk v)) &gt;&gt;= putMVar var\n  _ &lt;- forkIO $ evaluate (serialProduct (PV.slice (chunk * 1) chunk v)) &gt;&gt;= putMVar var\n  _ &lt;- forkIO $ evaluate (serialProduct (PV.slice (chunk * 2) chunk v)) &gt;&gt;= putMVar var\n  _ &lt;- forkIO $ evaluate (serialProduct (PV.slice (chunk * 3) chunk v)) &gt;&gt;= putMVar var\n  a &lt;- takeMVar var\n  b &lt;- takeMVar var\n  c &lt;- takeMVar var\n  d &lt;- takeMVar var\n  return (a * b * c * d)\n</code></pre>\n\n<p>This one has excellent performance:</p>\n\n<pre><code>benchmarking product/parallel mvar\ntime                 3.814 ms   (3.669 ms .. 3.946 ms)\n                     0.986 R\u00b2   (0.977 R\u00b2 .. 0.992 R\u00b2)\nmean                 3.818 ms   (3.708 ms .. 3.964 ms)\nstd dev              385.6 \u03bcs   (317.1 \u03bcs .. 439.8 \u03bcs)\nvariance introduced by outliers: 64% (severely inflated)\n</code></pre>\n\n<p>But, it falls back on conventional concurrency primitives instead of using sparks. I do not like this solution, but I am providing it as evidence that it should be possible to achieve the same performance with a spark-based approach.</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1507206394, "post_id": 46585541, "comment_id": 80123990, "body": "Are you sure it should be <code>Let Expr Expr Expr</code> and not <code>Let Chara Expr Expr</code>? (Not that this is completely unreasonable, but it is a bit more tricky and probably not worth for an educational aspect)."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1507206477, "post_id": 46585541, "comment_id": 80124032, "body": "Are <a href=\"https://stackoverflow.com/questions/46584907/haskell-parsing-input-functions\">you guys</a> getting assignments for the same class?"}, {"owner": {"reputation": 77, "user_id": 5838116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/mlwk4.png?s=128&g=1", "display_name": "iIllumination", "link": "https://stackoverflow.com/users/5838116/iillumination"}, "edited": false, "score": 0, "creation_date": 1507206734, "post_id": 46585541, "comment_id": 80124202, "body": "I am working on an assignment. Don&#39;t know about the other guy."}, {"owner": {"reputation": 77, "user_id": 5838116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/mlwk4.png?s=128&g=1", "display_name": "iIllumination", "link": "https://stackoverflow.com/users/5838116/iillumination"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1507209553, "post_id": 46585541, "comment_id": 80126253, "body": "@leftaroundabout No, it&#39;s acutally gonna be Expr, cause Expr could be Vari which is a Chara"}], "answers": [{"comments": [{"owner": {"reputation": 77, "user_id": 5838116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/mlwk4.png?s=128&g=1", "display_name": "iIllumination", "link": "https://stackoverflow.com/users/5838116/iillumination"}, "edited": false, "score": 0, "creation_date": 1507213927, "post_id": 46585825, "comment_id": 80129610, "body": "Thanks! I think I got something that starts to work! :D"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 1, "last_activity_date": 1507207045, "creation_date": 1507207045, "answer_id": 46585825, "question_id": 46585541, "link": "https://stackoverflow.com/questions/46585541/haskell-calculate-string-let-x-3-in-x-x/46585825#46585825", "title": "Haskell - Calculate string &quot;let X = 3 in + X X&quot;", "body": "<p>You'll need to perform <em>variable substitution</em> in your AST. I.e. you need a function</p>\n\n<pre><code>substitute :: (Chara, Expr) -&gt; Expr -&gt; Expr\n</code></pre>\n\n<p>which, given a pair of <em>variable to substitute</em> and <em>expression to substitute it with</em> will traverse the tree and perform that substitution. That basically means: if you find a <code>Vari</code>, just replace it with the substitution. If you find anything with subexpressions like <code>Sum a b</code>, recurse down into those subexpressions and then rebuild the operator with the results, i.e.</p>\n\n<pre><code>        Sum (substitute s a) (substitute s b)\n</code></pre>\n\n<p>Then the <code>calculate (Let var subst expr) = ...</code> is a pretty straightforward invocation of the <code>substitute</code> function.</p>\n"}, {"tags": [], "owner": {"reputation": 77, "user_id": 5838116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/mlwk4.png?s=128&g=1", "display_name": "iIllumination", "link": "https://stackoverflow.com/users/5838116/iillumination"}, "is_accepted": false, "score": 1, "last_activity_date": 1507217414, "last_edit_date": 1507217414, "creation_date": 1507213967, "answer_id": 46588256, "question_id": 46585541, "link": "https://stackoverflow.com/questions/46585541/haskell-calculate-string-let-x-3-in-x-x/46588256#46588256", "title": "Haskell - Calculate string &quot;let X = 3 in + X X&quot;", "body": "<p>Works like a charm</p>\n\n<pre><code>calculate :: Expr -&gt; Int \ncalculate (Sub a) = let e = calculate a in (-e)\ncalculate (Sum a b) = let e = calculate a \n                          r = calculate b \n                      in (e+r)          \ncalculate (Mul a b) = let e = calculate a \n                          r = calculate b \n                      in (e*r)\ncalculate (Let a b c) = calculate (substitute (getCharaFromExpr a) b c)\ncalculate (Lit a) = a       \n\n\nsubstitute :: Chara -&gt; Expr -&gt; Expr -&gt; Expr \nsubstitute x y (Lit a) = Lit a\nsubstitute x y (Vari a) | x == a = y\n                        | otherwise = Vari a \nsubstitute x y (Sum a b) = Sum (substitute x y a) (substitute x y b)\nsubstitute x y (Mul a b) = Mul (substitute x y a) (substitute x y b)\nsubstitute x y (Sub a) = Sub (substitute x y a)\nsubstitute x y (Let a b c) = Let (substitute x y a) (substitute x y b) (substitute x y c) \n</code></pre>\n"}], "owner": {"reputation": 77, "user_id": 5838116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/mlwk4.png?s=128&g=1", "display_name": "iIllumination", "link": "https://stackoverflow.com/users/5838116/iillumination"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 46585825, "answer_count": 2, "score": 0, "last_activity_date": 1507217414, "creation_date": 1507206188, "last_edit_date": 1507210968, "question_id": 46585541, "link": "https://stackoverflow.com/questions/46585541/haskell-calculate-string-let-x-3-in-x-x", "title": "Haskell - Calculate string &quot;let X = 3 in + X X&quot;", "body": "<p>Hi I need help with calculating a type. The whole program is suppose to take a string, parse it, and at the end, calculate a value. The string I start with can be like this: \"<code>let X = + 1 2 in * X 2 - X</code>\". When I parse it, I will get this: \"<code>Let (Vari X) (Sum (Lit 1) (Lit 2)) (Mul (Vari X) (Lit 2)))</code>\". At this moment, I can parse expressions like this \"* + 2 3 * 2 + 6 - 2\" and the previous. But I can not calculate the previous expression, \"<code>let X = + 1 2 in * X 2 - X</code>\". If someone could point me in the the right direction I would be happy, cause right now, I really don't know how I would make this work. Thanks</p>\n\n<p>Code: </p>\n\n<pre><code>data Chara = A | B | C | D | E | F | G | H | I | J | K | L | M | N | O | P | Q | R | S | T | U | V | W | X | Y | Z deriving (Eq, Show)\n\ndata Number = Single Int | Many Int Number deriving (Eq, Show)\n\ndata Expr = Lit Int | Sub Expr | Sum Expr Expr | Mul Expr Expr | Vari Chara | Let Expr Expr Expr \n    deriving Show\n\n\n--Want to calculate this\n--Let (Vari X) (Sum (Lit 1) (Lit 2)) (Mul (Vari X) (Lit 2)))\n\n\ncalculate :: Expr -&gt; Int \ncalculate (Sub a) = let e = calculate a in (-e)\ncalculate (Sum a b) = let e = calculate a \n                          r = calculate b \n                      in (e+r)          \ncalculate (Mul a b) = let e = calculate a \n                          r = calculate b \n                      in (e*r)\ncalculate (Lit a) = a       \n</code></pre>\n"}, {"tags": ["function", "parsing", "haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1507204823, "post_id": 46584907, "comment_id": 80122961, "body": "Your grammar is ambiguous, how do you parse +12345?"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1507205071, "post_id": 46584907, "comment_id": 80123124, "body": "@n.m. You don&#39;t. His grammar just doesn&#39;t support unary pluses. And this grammer is not ambiguous."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1507205183, "post_id": 46584907, "comment_id": 80123194, "body": "@Shersh It supports prefix binary plus, which is what I&#39;m asking for."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1507205300, "post_id": 46584907, "comment_id": 80123276, "body": "What functions?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1507206281, "post_id": 46584907, "comment_id": 80123915, "body": "The grammar doesn&#39;t mention whitespace at all, so <code>+12345</code> could be parsed as <code>+</code>/<code>1</code>/<code>2345</code>, <code>+</code>/<code>12</code>/<code>345</code>, <code>+</code>/<code>123</code>/<code>45</code>, or <code>+</code>/<code>1234</code>/<code>5</code>."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 1, "last_activity_date": 1508079992, "creation_date": 1508079992, "answer_id": 46756487, "question_id": 46584907, "link": "https://stackoverflow.com/questions/46584907/haskell-parsing-prefix-evaluation/46756487#46756487", "title": "Haskell parsing prefix evaluation", "body": "<p>The error message says that the data constructor <code>N</code> is not in scope.  Data constructors are the things on the right-hand side of <code>data</code> statements.  In your example, <code>V</code>, <code>Neg</code>, <code>A</code>, and <code>M</code> are data constructors.  \"Not in scope\" means \"not defined where it was used\".</p>\n\n<p>It looks like you wrote <code>N</code> where you meant to write <code>Neg</code>, or vice versa.  Fixing your <code>data</code> statement to read:</p>\n\n<pre><code>data Ast = V Int | N Ast | A Ast Ast | M Ast Ast deriving (Show,Eq)\n</code></pre>\n\n<p>allows the program to compile.</p>\n\n<p>There are still a few bugs in the program.  For example, the following gets stuck in a loop:</p>\n\n<pre><code>&gt; parseE (words \"* + 1 2 * 3 + 7 - 2\")\n(M (A (V 1) (V 2)) (M (V 3) (A (V 7) (N  -- freezes\n</code></pre>\n\n<p>because of the statement:</p>\n\n<pre><code>let (a,r) = parseE r in (N a, r)\n</code></pre>\n\n<p>which introduces an unintended recursive definition -- you're defining <code>r</code> as the result of calling <code>parseE r</code>, which causes an infinite loop.  You have a similar problem in the case that tries to handle parentheses.</p>\n"}], "owner": {"reputation": 1, "user_id": 6816517, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9aa563db99bddf5c276276e4fca0863f?s=128&d=identicon&r=PG&f=1", "display_name": "user6816517", "link": "https://stackoverflow.com/users/6816517/user6816517"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 289, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1517122917, "creation_date": 1507204253, "last_edit_date": 1517122917, "question_id": 46584907, "link": "https://stackoverflow.com/questions/46584907/haskell-parsing-prefix-evaluation", "title": "Haskell parsing prefix evaluation", "body": "<p>I'm struggling with this code.</p>\n\n<pre><code>import Data.Char (isDigit)\ndata Ast = V Int | Neg Ast | A Ast Ast | M Ast Ast deriving (Show,Eq)\n\nparseE (\"+\":xs) = let (e1,r1) = parseE xs; (e2,r2) = parseE r1 in (A e1 e2, r2)\nparseE (\"*\":xs) = let (e1,r1) = parseE xs; (e2,r2) = parseE r1 in (M e1 e2, r2)\nparseE (\"-\":xs) = let (a,r) = parseE r in (N a, r)\nparseE (\"(\":xs) = let (a,\")\":r) = parseE r in (a,r)\nparseE (x:xs) = (V (read x :: Int), xs) \n\neval xs = parseE xs\n</code></pre>\n\n<p>When my input is something like: <code>* + 1 2 * 3 + 7 - 2</code></p>\n\n<p>I want the ouput to be: <code>((1+2)*3)*(3*(7-2))</code> which should show <code>45</code></p>\n\n<p>When I load my file in haskell, I get this error :</p>\n\n<pre><code>:load \"newf.hs\"\n[1 of 1] Compiling Main             ( newf.hs, interpreted )\n\nnewf.hs:6:44: error: Data constructor not in scope: N :: Ast -&gt; Ast\n  |\n6 | parseE (\"-\":xs) = let (a,r) = parseE r in (N a, r)\n\n  |                                            ^\nFailed, 0 modules loaded.\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1507195852, "post_id": 46581824, "comment_id": 80117172, "body": "I recommend <a href=\"http://hackage.haskell.org/package/thyme-0.3.5.5/docs/Data-Thyme-Format-Human.html\" rel=\"nofollow noreferrer\">the <code>thyme</code> library</a>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1540228558, "post_id": 46581824, "comment_id": 92778270, "body": "@leftaroundabout, <code>thyme</code> hasn&#39;t been updated on Hackage since 2014."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1540229494, "post_id": 46581824, "comment_id": 92778692, "body": "@dfeuer Hm yeah, pity. Probably better use some lenses on top of old <code>time</code> then."}], "answers": [{"tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": true, "score": 5, "last_activity_date": 1540220748, "last_edit_date": 1540220748, "creation_date": 1507195785, "answer_id": 46582208, "question_id": 46581824, "link": "https://stackoverflow.com/questions/46581824/how-can-i-format-utctime-nominaldifftime-into-a-human-readable-representation/46582208#46582208", "title": "How can I format UTCTime / NominalDiffTime into a human readable representation?", "body": "<p>Figured it out. I think there is some confusion because of the type alias: <code>type POSIXTime = NominalDiffTime</code> (<a href=\"https://hackage.haskell.org/package/time-1.8.0.3/docs/Data-Time-Clock-POSIX.html#t:POSIXTime\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/time-1.8.0.3/docs/Data-Time-Clock-POSIX.html#t:POSIXTime</a>).</p>\n\n<pre><code>import Data.Time.Clock\nimport Data.Time.Format\nimport Data.Time.Clock.POSIX\n\nmyFormatUtcTime :: UTCTime -&gt; String\nmyFormatUtcTime = formatTime defaultTimeLocale \"%H:%M %d/%m/%Y\"\n\nmyFormatDiffTime :: NominalDiffTime -&gt; String\nmyFormatDiffTime = formatTime defaultTimeLocale \"%H:%M\" . posixSecondsToUTCTime\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": 3, "last_activity_date": 1507204763, "creation_date": 1507204763, "answer_id": 46585068, "question_id": 46581824, "link": "https://stackoverflow.com/questions/46581824/how-can-i-format-utctime-nominaldifftime-into-a-human-readable-representation/46585068#46585068", "title": "How can I format UTCTime / NominalDiffTime into a human readable representation?", "body": "<p>I would recommend <a href=\"http://hackage.haskell.org/package/fmt\" rel=\"nofollow noreferrer\"><code>fmt</code></a> library for time formatting.</p>\n\n<ol>\n<li>Human-readable names of functions instead of some strange formatting symbols sometimes.</li>\n<li>It can format not only time.</li>\n</ol>\n\n<p>Example here:</p>\n\n<pre><code>ghci&gt; import Data.Time (getZonedTime)\nghci&gt; import Fmt.Time (dateDashF, dateSlashF)\nghci&gt; t &lt;- getZonedTime \nghci&gt; t\n2017-10-05 14:53:08.818531 MSK\nit :: ZonedTime\nghci&gt; dateDashF t\n\"2017-10-05\"\nit :: Data.Text.Internal.Builder.Builder \nghci&gt; dateSlashF t\n\"10/05/17\"\nit :: Data.Text.Internal.Builder.Builder\n</code></pre>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 252, "favorite_count": 0, "accepted_answer_id": 46582208, "answer_count": 2, "score": 4, "last_activity_date": 1540220748, "creation_date": 1507194686, "last_edit_date": 1540220605, "question_id": 46581824, "link": "https://stackoverflow.com/questions/46581824/how-can-i-format-utctime-nominaldifftime-into-a-human-readable-representation", "title": "How can I format UTCTime / NominalDiffTime into a human readable representation?", "body": "<p>I've tried googling about but struggling to find a concrete example or which libraries I should be using for this.</p>\n\n<p>I'd like to format a value of type <code>NominalDiffTime</code> (<a href=\"https://hackage.haskell.org/package/time-1.8.0.3/docs/Data-Time-Clock.html#t:NominalDiffTime\" rel=\"nofollow noreferrer\" title=\"NominalDiffTime\">NominalDiffTime</a>) for example as <code>05/10/2017 10:10AM</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1507191675, "post_id": 46580924, "comment_id": 80114755, "body": "Instead of simply altering code such that it matches your specifications, you probably better aim to understand what is going on. Can you describe in your own words how <code>split</code> works?"}, {"owner": {"reputation": 43, "user_id": 8724907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eae161aa02bfb53ba74f903a6b24bc66?s=128&d=identicon&r=PG&f=1", "display_name": "Peter.PP", "link": "https://stackoverflow.com/users/8724907/peter-pp"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1507192725, "post_id": 46580924, "comment_id": 80115333, "body": "According to my understanding, there are two parts in the example code. The first part split [] = [&quot;&quot;] is the base case which returns a list containing one empty string when we try to split an empty string. The second part is similar to a recursion, which iterates through each character in the input. If the character is the delimiter, it would combine an empty string &quot;&quot; with the split result of remaining part of the string. But I am not sure about how &quot;| otherwise = (c : head rest) : tail rest&quot; functions. Because c is character but &quot;head rest&quot; should return a string."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1507204826, "post_id": 46580924, "comment_id": 80122966, "body": "You may simply do <code>split = map pure</code> for this functionality"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1507193136, "creation_date": 1507193136, "answer_id": 46581377, "question_id": 46580924, "link": "https://stackoverflow.com/questions/46580924/haskell-splitting-a-string-by-delimiter/46581377#46581377", "title": "Haskell - Splitting a string by delimiter", "body": "<p>Instead of altering code in the hope that it matches the expecations, it is usually better to understand the code fragment first.</p>\n\n<pre><code>split :: String -&gt; [String]\nsplit [] = [\"\"]\nsplit (c:cs) | c == ','  = \"\" : rest\n             | otherwise = (c : head rest) : tail rest\n    where rest = split cs\n</code></pre>\n\n<p>First of all we better analyze what <code>split</code> does. The first statement simply says \"<em>The split of an empty string, is a list with one element, the empty string</em>\". This seems reasonable. Now the second clause states: \"<em>In case the head of the string is a comma, we produce a list where the first element is an empty string, followed by splitting up the remainings of the string.</em>\". The last guard says \"<em>In case the first character of the string is not a comma, we prepend that character to the first item of the split of the remaining string, followed by the remaining elements of the split of the remaining string</em>\". Mind that <code>split</code> returns a <em>list</em> of strings, so the <code>head rest</code> is a string.</p>\n\n<p>So if we want to add the delimiter to the output, then we need to add that as a separate string in the output of <code>split</code>. Where? In the first guard. We should not return <code>\",\" : rest</code>, since the head is - by recursion - prepended, but as a separate string. So the result is:</p>\n\n<pre><code>split :: String -&gt; [String]\nsplit [] = [\"\"]\nsplit (c:cs) | c == ','  = \"\" <b>: \",\"</b> : rest\n             | otherwise = (c : head rest) : tail rest\n    where rest = split cs</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 4, "last_activity_date": 1507204833, "creation_date": 1507204833, "answer_id": 46585093, "question_id": 46580924, "link": "https://stackoverflow.com/questions/46580924/haskell-splitting-a-string-by-delimiter/46585093#46585093", "title": "Haskell - Splitting a string by delimiter", "body": "<p>That example code is poor style. Never use <code>head</code> and <code>tail</code> unless you know exactly what you're doing (these functions are unsafe, <a href=\"https://en.wikipedia.org/wiki/Partial_function\" rel=\"nofollow noreferrer\">partial functions</a>). Also, equality comparisons are usually better written as dedicated patterns.</p>\n\n<p>With that in mind, the example becomes:</p>\n\n<pre><code>split :: String -&gt; [String]\nsplit \"\" = [\"\"]\nsplit (',':cs) = \"\" : split cs\nsplit (c:cs) = (c:cellCompletion) : otherCells\n where cellCompletion : otherCells = split cs\n</code></pre>\n\n<p>(Strictly speaking, this is still unsafe because the match <code>cellCompletion:otherCells</code> is non-exhaustive, but at least it happens in a well-defined place which will give a clear error message if anything goes wrong.)</p>\n\n<p>Now IMO, this makes it quite a bit clearer what's actually going on here: with <code>\"\" : split cs</code>, the intend is not really to <em>add an empty cell to the result</em>. Rather, it is to <em>add a cell which will be filled up by calls further up in the recursion stack</em>. This happens because those calls deconstruct the deeper result again, with the pattern match <code>cellCompletion : otherCells = split cs</code>, i.e. they pop off the first cell again and prepend the actual cell contents.</p>\n\n<p>So, if you change that to <code>\",\" : split</code>, the effect is just that all cells you build will already be pre-terminated with a <code>,</code> character. That's not what you want.</p>\n\n<p>Instead you want to add an <em>additional</em> cell that won't be touched anymore. That needs to be deeper in the result then:</p>\n\n<pre><code>split (',':cs) = \"\" : \",\" : split cs\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 5, "last_activity_date": 1507242322, "creation_date": 1507242322, "answer_id": 46595679, "question_id": 46580924, "link": "https://stackoverflow.com/questions/46580924/haskell-splitting-a-string-by-delimiter/46595679#46595679", "title": "Haskell - Splitting a string by delimiter", "body": "<p>If you're trying to write this function \"for real\" instead of writing the character-by-character recursion for practice, I think a clearer method is to use the <code>break</code> function from <code>Data.List</code>.  The following expression:</p>\n\n<pre><code>break (==',') str\n</code></pre>\n\n<p>breaks the string into a tuple <code>(a,b)</code> where the first part consists of the  initial \"comma-free\" part, and the second part is either more string starting with the comma or else empty if there's no more string.</p>\n\n<p>This makes the definition of <code>split</code> clear and straightforward:</p>\n\n<pre><code>split str = case break (==',') str of\n                (a, ',':b) -&gt; a : split b\n                (a, \"\")    -&gt; [a]\n</code></pre>\n\n<p>You can verify that this handles <code>split \"\"</code> (which returns <code>[\"\"]</code>), so there's no need to treat that as a special case.</p>\n\n<p>This version has the added benefit that the modification to include the delimiter is also easy to understand:</p>\n\n<pre><code>split2 str = case break (==',') str of\n                (a, ',':b) -&gt; a : \",\" : split2 b\n                (a, \"\")    -&gt; [a]\n</code></pre>\n\n<p>Note that I've written the patterns in these functions in more detail than is necessary to make it absolute clear what's going on, and this also means that Haskell does a duplicate check on each comma.  For this reason, some people might prefer:</p>\n\n<pre><code>split str = case break (==',') str of\n                (a, _:b) -&gt; a : split b\n                (a, _)   -&gt; [a]\n</code></pre>\n\n<p>or, if they still wanted to document exactly what they were expecting in each case branch:</p>\n\n<pre><code>split str = case break (==',') str of\n                (a, _comma:b) -&gt; a : split b\n                (a, _empty)   -&gt; [a]\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 8724907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eae161aa02bfb53ba74f903a6b24bc66?s=128&d=identicon&r=PG&f=1", "display_name": "Peter.PP", "link": "https://stackoverflow.com/users/8724907/peter-pp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6730, "favorite_count": 0, "accepted_answer_id": 46581377, "answer_count": 3, "score": 4, "last_activity_date": 1507242322, "creation_date": 1507191474, "last_edit_date": 1507198631, "question_id": 46580924, "link": "https://stackoverflow.com/questions/46580924/haskell-splitting-a-string-by-delimiter", "title": "Haskell - Splitting a string by delimiter", "body": "<p>I am trying to write a program in Haskell to split a string by delimiter.</p>\n\n<p>And I have studied different examples provided by other users. An example would the the code that is posted below.</p>\n\n<pre><code>split :: String -&gt; [String]\nsplit [] = [\"\"]\nsplit (c:cs)\n   | c == ','  = \"\" : rest\n   | otherwise = (c : head rest) : tail rest\n where\n   rest = split cs\n</code></pre>\n\n<p>Sample Input: <code>\"1,2,3\"</code>.\nSample Output: <code>[\"1\",\"2\",\"3\"]</code>.</p>\n\n<p>I have been trying to modify the code so that the output would be something like <code>[\"1\", \",\" , \"2\", \",\" , \"3\"]</code> which includes the delimiter in the output as well , but I just cannot succeed.</p>\n\n<p>For example, I changed the line:</p>\n\n<pre><code>   | c == ','  = \"\" : rest\n</code></pre>\n\n<p>into:</p>\n\n<pre><code>   | c == ','  = \",\" : rest\n</code></pre>\n\n<p>But the result becomes <code>[\"1,\",\"2,\",\"3\"]</code>.</p>\n\n<p>What is the problem and in which part I have had a misunderstanding?</p>\n"}, {"tags": ["c", "haskell", "ffi", "haskell-stack"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1507170094, "post_id": 46576861, "comment_id": 80106989, "body": "Stack is not the right component for this - Cabal is. Stack is a tool that helps figure out how to resolve your dependencies, while Cabal describes how to build your project."}, {"owner": {"reputation": 1029, "user_id": 668074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f82d3dd033cd691ad5340b9620bdcf38?s=128&d=identicon&r=PG", "display_name": "user668074", "link": "https://stackoverflow.com/users/668074/user668074"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1507171403, "post_id": 46576861, "comment_id": 80107256, "body": "I never really used cabal directly. I went directly to using stack. Can&#39;t stack do everything cabal can?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1507173203, "post_id": 46576861, "comment_id": 80107626, "body": "Not quite. Stack is meant to complement Cabal, not replace it. Internally, Stack relies a fair bit on Cabal."}, {"owner": {"reputation": 1029, "user_id": 668074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f82d3dd033cd691ad5340b9620bdcf38?s=128&d=identicon&r=PG", "display_name": "user668074", "link": "https://stackoverflow.com/users/668074/user668074"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1507173511, "post_id": 46576861, "comment_id": 80107695, "body": "So their&#39;s no way to run <code>stack build</code> and have it compile with a FFI?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1507173701, "post_id": 46576861, "comment_id": 80107747, "body": "I didn&#39;t say that. But the work to get Stack to build an FFI project occurs in the <code>.cabal</code> file, not the <code>.stack</code> one. I&#39;ve posted a sample project."}], "answers": [{"comments": [{"owner": {"reputation": 1029, "user_id": 668074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f82d3dd033cd691ad5340b9620bdcf38?s=128&d=identicon&r=PG", "display_name": "user668074", "link": "https://stackoverflow.com/users/668074/user668074"}, "edited": false, "score": 0, "creation_date": 1507174014, "post_id": 46577335, "comment_id": 80107822, "body": "Ok, this is what I was looking for. In particular the c-sources section seems to be what I was missing. Follow-up, is there a way to use an object code file instead of the c source file? (File.o instead of File.c)"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 1029, "user_id": 668074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f82d3dd033cd691ad5340b9620bdcf38?s=128&d=identicon&r=PG", "display_name": "user668074", "link": "https://stackoverflow.com/users/668074/user668074"}, "edited": false, "score": 1, "creation_date": 1507178933, "post_id": 46577335, "comment_id": 80109020, "body": "Yep, of course! Under the <code>executable main</code>, add the following entries: <code>extra-lib-dirs:  &quot;.&quot;</code> and <code>extra-libraries: File.o</code>."}, {"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 2, "creation_date": 1507184658, "post_id": 46577335, "comment_id": 80111053, "body": "Just nitpicking: You can do it even more minimal. Just add &quot;build-type: Simple&quot; to the start of c-proj.cabal and get rid of Setup.hs."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1507184824, "post_id": 46577335, "comment_id": 80111119, "body": "@Krom Hardly a nitpick! That&#39;s so handy. I can&#39;t believe I&#39;ve been polluting my projects with (almost always) pointless <code>Setup.hs</code> files!"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 6, "last_activity_date": 1507184813, "last_edit_date": 1507184813, "creation_date": 1507173652, "answer_id": 46577335, "question_id": 46576861, "link": "https://stackoverflow.com/questions/46576861/how-is-foreign-function-interface-ffi-used-with-stack/46577335#46577335", "title": "How is Foreign Function Interface (FFI) used with Stack?", "body": "<p>Here is as minimal an FFI C project as I could imagine.</p>\n\n<pre><code>$ cd c-proj\nc-proj$ ls\nMain.hs      c-proj.cabal c_file.c\n</code></pre>\n\n<p>The contents of these files:</p>\n\n<ul>\n<li><p><code>c-proj.cabal</code>: describes the </p>\n\n<pre><code>name:            c-proj\nversion:         0.1.0.0\ncabal-version:   &gt;= 1.22\nbuild-type:      Simple\n\nexecutable main\n  main-is:       Main.hs\n  build-depends: base &gt;= 4.9\n  c-sources:     c_file.c\n</code></pre></li>\n<li><p><code>Main.hs</code>: the only Haskell source file</p>\n\n<pre><code>{-# LANGUAGE ForeignFunctionInterface #-}\n\nmodule Main where\n\nforeign import ccall \"plus_ten\" plusTen :: Int -&gt; IO Int\n\nmain = do\n  n &lt;- plusTen 2\n  print n\n</code></pre></li>\n<li><p><code>c_file.c</code>: the C source file</p>\n\n<pre><code>#include&lt;stdio.h&gt;\n\nint plus_ten(int n) {\n  printf(\"%d + 10\\n\", n);\n  return n + 10;\n}\n</code></pre></li>\n</ul>\n\n<p>Then, if you want to use Stack, you can run <code>stack init</code>.</p>\n\n<pre><code>$ stack init\n&lt;&lt; Shell output snipped &gt;&gt;\n$ stack build\n&lt;&lt; Shell output snipped &gt;&gt;\n$ stack exec main\n2 + 10\n12\n</code></pre>\n"}], "owner": {"reputation": 1029, "user_id": 668074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f82d3dd033cd691ad5340b9620bdcf38?s=128&d=identicon&r=PG", "display_name": "user668074", "link": "https://stackoverflow.com/users/668074/user668074"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 639, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1507184813, "creation_date": 1507169706, "last_edit_date": 1507171767, "question_id": 46576861, "link": "https://stackoverflow.com/questions/46576861/how-is-foreign-function-interface-ffi-used-with-stack", "title": "How is Foreign Function Interface (FFI) used with Stack?", "body": "<p>I was following some FFI tutorials and examples (<a href=\"https://wiki.haskell.org/FFI_complete_examples\" rel=\"nofollow noreferrer\">here</a> and <a href=\"https://wiki.haskell.org/FFI_Introduction\" rel=\"nofollow noreferrer\">here</a>), and I was wondering what should change when using stack?</p>\n\n<p>In the examples, the source C file is compiled to an object file using <code>gcc -c -o termops.o termops.c</code> and included in the gcc compilation using <code>ghc --make -main-is FfiEx -o ffi_ex FfiEx.hs termops.o</code>. How can the equivalent be accomplished using stack?</p>\n"}, {"tags": ["haskell", "monad-transformers", "state-monad"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1507168393, "post_id": 46576150, "comment_id": 80106632, "body": "<code>gets composed &gt;&gt;= MyMonad . lift . throwingModification</code>"}, {"owner": {"reputation": 55, "user_id": 4700242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d502988b2803e3435dac33b4c6968bd?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Kuehne", "link": "https://stackoverflow.com/users/4700242/ian-kuehne"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1507169068, "post_id": 46576150, "comment_id": 80106779, "body": "That doesn&#39;t typecheck...  I suppose that&#39;s the idea though"}, {"owner": {"reputation": 55, "user_id": 4700242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d502988b2803e3435dac33b4c6968bd?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Kuehne", "link": "https://stackoverflow.com/users/4700242/ian-kuehne"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1507169308, "post_id": 46576150, "comment_id": 80106837, "body": "Ah, I see how to get from there to what I want.  I guess I still haven&#39;t incorporated MonadTrans itself into my toolbox for when I want to move around layers of the stack; I&#39;ll work on that.  Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 231, "user_id": 5824635, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c43dd400f3c9c2cbaeb8986532cd359b?s=128&d=identicon&r=PG&f=1", "display_name": "homura", "link": "https://stackoverflow.com/users/5824635/homura"}, "is_accepted": false, "score": 1, "last_activity_date": 1507171848, "creation_date": 1507171848, "answer_id": 46577125, "question_id": 46576150, "link": "https://stackoverflow.com/questions/46576150/how-to-combine-data-composition-and-monad-transformers/46577125#46577125", "title": "How to combine data composition and monad transformers", "body": "<p>The best solution would be re-write <code>throwingModification</code> as a <code>MyMonad</code>.</p>\n\n<pre><code>throwingModification :: MyMonad ()\nthrowingModification = do\n    s &lt;- get\n    if state s then\n        put $ ComposedState False\n    else\n        throwError $ MyError \"error!\"\n</code></pre>\n\n<p>If you can't re-write your function (because it is used elsewhere), you can wrap it instead.</p>\n"}, {"comments": [{"owner": {"reputation": 55, "user_id": 4700242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d502988b2803e3435dac33b4c6968bd?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Kuehne", "link": "https://stackoverflow.com/users/4700242/ian-kuehne"}, "edited": false, "score": 0, "creation_date": 1507174631, "post_id": 46577171, "comment_id": 80107938, "body": "Thanks! Your second solution is pretty much what I came up with.  Writing everything as a <code>MyMonad</code> from the beginning seems like poor design; I want to keep everything split up into a few components without circular dependencies.  I should learn how to use lenses--I&#39;ve always done my best to stay away from template haskell, but maybe it&#39;s sometimes necessary."}, {"owner": {"reputation": 55, "user_id": 4700242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d502988b2803e3435dac33b4c6968bd?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Kuehne", "link": "https://stackoverflow.com/users/4700242/ian-kuehne"}, "edited": false, "score": 0, "creation_date": 1507175053, "post_id": 46577171, "comment_id": 80108036, "body": "I&#39;ve already accepted the answer, but if you could elaborate on how lenses would ameliorate the problem I would really appreciate it."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 55, "user_id": 4700242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d502988b2803e3435dac33b4c6968bd?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Kuehne", "link": "https://stackoverflow.com/users/4700242/ian-kuehne"}, "edited": false, "score": 0, "creation_date": 1507180011, "post_id": 46577171, "comment_id": 80109360, "body": "I&#39;ve taken a similar approach In the past (tailored, minimal monad stacks wrapped in custom data types for different application components) on the basis that it seemed like better design.  However, I&#39;ve found it to be detrimental to the development process with no real tangible benefits.  At least for one-programmer projects, I now think it&#39;s better to define a single <code>type M a = ...</code> monad and get everything running.  The type checker makes it easy to go back and refactor the monads, if you really find it&#39;s necessary (and it typically isn&#39;t)."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 3, "last_activity_date": 1507179557, "last_edit_date": 1507179557, "creation_date": 1507172253, "answer_id": 46577171, "question_id": 46576150, "link": "https://stackoverflow.com/questions/46576150/how-to-combine-data-composition-and-monad-transformers/46577171#46577171", "title": "How to combine data composition and monad transformers", "body": "<p>The more natural way of doing this would be to write <code>throwingModification</code> from the start in the <code>MyMonad</code> monad, like so:</p>\n\n<pre><code>throwingModification' :: MyMonad ()\nthrowingModification' = do ComposedState flag &lt;- gets composed\n                           if not flag then throwError $ MyError \"error!\"\n                             else modify (\\s -&gt; s { composed = (composed s)\n                                                    { Main.state = False } })\n</code></pre>\n\n<p>I'm assuming here that the composed states contain other components that you want to preserve, which makes the <code>modify</code> clause ugly.  Using lenses can make this cleaner.</p>\n\n<p>However, if you're stuck with the current form of <code>throwingModification</code>, you'll probably have to write your own combinator, since the usual State combinators don't include mechanisms for switching the state type <code>s</code>, which is what you're effectively trying to do.</p>\n\n<p>The following definition of <code>usingState</code> may help.  It transforms a <code>StateT</code> operation from one state to another using a getter and setter.  (Again, a lens approach would be cleaner.)</p>\n\n<pre><code>usingState :: (Monad m) =&gt; (s -&gt; t) -&gt; (s -&gt; t -&gt; s) \n                           -&gt; StateT t m a -&gt; StateT s m a\nusingState getter setter mt = do\n  s &lt;- get\n  StateT . const $ do (a, t) &lt;- runStateT mt (getter s)\n                      return (a, setter s t)\n</code></pre>\n\n<p>I don't think there's an easy way to modify <code>usingState</code> to work between general <code>MonadState</code> monads instead of directly on a <code>StateT</code>, so you'll need to lift it manually and convert it through your <code>MyMonad</code> data type.</p>\n\n<p>With <code>usingState</code> so defined, you can write the following.  (Note <code>&gt;=&gt;</code> comes from <code>Control.Monad</code>.)</p>\n\n<pre><code>MyMonad $ usingState getComposed putComposed $\n             StateT (throwingModification &gt;=&gt; return . ((),))\n</code></pre>\n\n<p>with helpers:</p>\n\n<pre><code>getComposed = composed\nputComposed s c = s { composed = c }\n</code></pre>\n\n<p>This is still a little ugly, but that's because the type <code>t -&gt; Except e t</code> must be adapted to <code>StateT (t -&gt; Except e ((), t))</code>, then transformed to the <code>s</code> state by the combinator, and then wrapped manually in your <code>MyMonad</code>, as explained above.</p>\n\n<h2>With Lenses</h2>\n\n<p>I'm not suggesting lenses are a miracle cure or anything, but they do help clean up a few of the uglier parts of the code.</p>\n\n<p>After adding lenses:</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE TupleSections #-}\n{-# LANGUAGE TemplateHaskell #-}\n\nimport Control.Lens\nimport Control.Monad ((&gt;=&gt;))\nimport Control.Monad.Except (Except, MonadError, throwError)\nimport Control.Monad.State (get, MonadState, runStateT, StateT(..))\n\ndata MyError = MyError { _message :: String }\ndata MyState = MyState { _composed :: ComposedState }\ndata ComposedState = ComposedState { _state :: Bool }\n\nmakeLenses ''ComposedState\nmakeLenses ''MyError\nmakeLenses ''MyState\n</code></pre>\n\n<p>the definition of <code>throwingModification</code> looks a little cleaner:</p>\n\n<pre><code>throwingModification :: ComposedState -&gt; Except MyError ComposedState\nthrowingModification s =\n  if s^.state then return $ s&amp;state .~ False\n  else throwError $ MyError \"error!\"\n</code></pre>\n\n<p>and the <code>MyMonad</code> version I gave above certainly benefits:</p>\n\n<pre><code>throwingModification' :: MyMonad ()\nthrowingModification' = do\n  flag &lt;- use (composed.state)\n  if flag then composed.state .= False\n    else throwError (MyError \"error!\")\n</code></pre>\n\n<p>The definition of <code>usingStateL</code> doesn't look much different:</p>\n\n<pre><code>usingStateL :: (Monad m) =&gt; Lens' s t -&gt; StateT t m a -&gt; StateT s m a\nusingStateL tPart mt = do\n  s &lt;- get\n  StateT . const $ do (a, t) &lt;- runStateT mt (s^.tPart)\n                      return (a, s&amp;tPart .~ t)\n</code></pre>\n\n<p>but it allows the existing lens <code>composed</code> to be used in place of helper functions:</p>\n\n<pre><code>  MyMonad $ usingStateL composed $\n        StateT (throwingModification &gt;=&gt; return . ((),))\n</code></pre>\n\n<p>and it would generalize to <code>(composed.underneath.state4)</code> if you had complex nested state.</p>\n"}], "owner": {"reputation": 55, "user_id": 4700242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d502988b2803e3435dac33b4c6968bd?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Kuehne", "link": "https://stackoverflow.com/users/4700242/ian-kuehne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 46577171, "answer_count": 2, "score": 3, "last_activity_date": 1507179557, "creation_date": 1507163512, "question_id": 46576150, "link": "https://stackoverflow.com/questions/46576150/how-to-combine-data-composition-and-monad-transformers", "title": "How to combine data composition and monad transformers", "body": "<p>I'm somewhat new to monad transformers, and currently trying to use a <code>StateT/Except</code> stack in a project.  The difficulty I'm having is that I have a few layers of data composition (types with operations on them, contained within types that have other operations on them), and I can't figure out how to elegantly  use monad transformers in that design.  Concretely, I'm having trouble writing the following code (simplified example, obviously):</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n\nimport Control.Monad.Except\nimport Control.Monad.State\nimport Control.Monad.Trans.Except (Except, throwE)\nimport Control.Monad.Trans.State (StateT)\n\ndata ComposedState = ComposedState { state :: Bool }\ndata MyError = MyError { message :: String }\n\n-- If the passed in state is true, change it to false; otherwise throw.\nthrowingModification :: ComposedState -&gt; Except MyError ComposedState\nthrowingModification (ComposedState True) = return $ ComposedState False\nthrowingModification _ = throwE $ MyError \"error!\"\n\n-- A state which composes with @ComposedState@,\ndata MyState = MyState { composed :: ComposedState }\n\n-- and a monad transformer state to allow me to modify it and propagate\n-- errors.\nnewtype MyMonad a = MyMonad { contents :: StateT MyState (Except MyError) a }\n  deriving ( Functor\n           , Applicative\n           , Monad\n           , MonadState MyState\n           , MonadError MyError )\n\nanAction :: MyMonad ()\nanAction = do -- want to apply throwingModification to the `composed` member,\n              -- propogating any exception\n              undefined\n</code></pre>\n\n<p>where I have a potentially \"throwing\" operation on <code>ComposedState</code>, and I want to use that operation in a stateful, throwing operation on <code>MyState</code>.  I can obviously do that by deconstructing the whole stack and rebuilding it, but the whole point of the monadic structure is that I shouldn't have to.  Is there a terse, idiomatic solution?</p>\n\n<p>Apologies for the lengthy code snippet--I did my best to cut it down.</p>\n"}]