[{"tags": ["haskell", "lazy-evaluation"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1438211885, "post_id": 31712490, "comment_id": 51363322, "body": "Don&#39;t worry about the structure of the grid, just <a href=\"https://hackage.haskell.org/package/data-memocombinators-0.5.1/docs/Data-MemoCombinators.html\" rel=\"nofollow noreferrer\">memoize</a>!  That library (and other memo libraries) memoize functions from integral types using an infinite tree described in <a href=\"http://stackoverflow.com/questions/4980102/how-does-data-memocombinators-work\">this answer</a>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1438212378, "post_id": 31712490, "comment_id": 51363447, "body": "This sounds interesting, but I find it a bit weird. What grid are you talking about? A list is not a grid. First of all, what kind of function is this really \u2013 I suppose <code>f :: Int -&gt; Double -&gt; Double</code> and the <code>m</code> parameter really just specifies that <code>f n</code> is the <i>n</i>-th derivative of <code>f 0</code>? Or is <code>m</code> actually another continuous parameter, which you want to cover in the grid?"}, {"owner": {"reputation": 1144, "user_id": 4245823, "user_type": "registered", "accept_rate": 90, "profile_image": "https://lh3.googleusercontent.com/-czWZC6KwKYU/AAAAAAAAAAI/AAAAAAAAAYI/yBtPVyZjU4M/photo.jpg?sz=128", "display_name": "felipez", "link": "https://stackoverflow.com/users/4245823/felipez"}, "edited": false, "score": 0, "creation_date": 1438236551, "post_id": 31712490, "comment_id": 51369929, "body": "<code>f m</code> is the <i>m-th</i> derivative of the function but also another parameter because I  want to calculate the <code>f 0 x</code>,  &#39;f 1 x<code>, ... </code>f mmax` derivatives"}], "owner": {"reputation": 1144, "user_id": 4245823, "user_type": "registered", "accept_rate": 90, "profile_image": "https://lh3.googleusercontent.com/-czWZC6KwKYU/AAAAAAAAAAI/AAAAAAAAAYI/yBtPVyZjU4M/photo.jpg?sz=128", "display_name": "felipez", "link": "https://stackoverflow.com/users/4245823/felipez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 100, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1438211298, "creation_date": 1438210253, "last_edit_date": 1438211298, "question_id": 31712490, "link": "https://stackoverflow.com/questions/31712490/using-lazy-evaluation-to-compute-a-numerical-grid", "title": "Using lazy evaluation to compute a numerical grid", "body": "<p>let <code>f m x</code> be a computationally expensive function that takes two arguments and is computed using a numerical algorithm. <code>f</code> is a <a href=\"https://en.wikipedia.org/wiki/Differentiable_function\" rel=\"nofollow\">differentiable</a> function that has the property that the derivate of  <code>f m x</code> is equal to <code>f m+1 x</code>. </p>\n\n<p>In order to lower the computational cost of calling this function thousand of times, we can expand it in a 6 terms Taylor series around <code>xk</code>,</p>\n\n<pre><code>f(m,x) = f(m,xk + dx) = f(m,xk) -f(m+1,xk)*dx + 0.5*f(m+2,xk)(dx)^2 - 1/6 * f(m+3,xk)(dx)^3 + 1/24 * f(m+4,xk)(dx)^4  + 1/120 * f(m+5,xk)(dx)^5......\n</code></pre>\n\n<p>Where <code>f(m+1,xk)</code> is the first derivate of <code>f m</code>. </p>\n\n<p>Using the Taylor series we can generate a grid of <code>xk</code> points <code>[0.1, 0.2, ..xk,.. xmax]</code>  in <code>mmax + 6</code> dimesions, where <code>xmax</code> and <code>mmax</code> are the maximum value of <code>x</code> and <code>m</code>, respectively. Basically, the idea is to populate the nodes of the grid calling the expensive function <code>f</code> and the value of the function between nodes are calculated using the above Taylor series expansion.</p>\n\n<p>This grid can be generated using a lazy map,</p>\n\n<pre><code>import Control.Applicative ((&lt;$&gt;),(&lt;*&gt;))\nimport Data.Map.Lazy as M\n\ndata Fun = Fun Double Double deriving (Ord,Eq) -- data representing the point f m x \n\ngenerateGrid :: (Double -&gt; Double -&gt; Double)-&gt; Int -&gt; Int -&gt; Double -&gt; Map Fun Double\ngenerateGrid f mMax xmax delta = M.fromList $ zip keys vals\n  where keys = Fun &lt;$&gt; [fromIntegral x | x &lt;- [0..mMax]] &lt;*&gt; [delta*fromIntegral(i) | i &lt;- [0..xmax]]\n        vals = fmap (\\(Fun m x) -&gt; f m x) keys\n\nfunTaylor :: Map Fun Double -&gt; Double -&gt; Double -&gt; Double\nfunTaylor grid m x = (fun m xk) - (fun (m+1) xk)*dx + 0.5*(fun (m+2) xk)*dx^2 - \n(1/6)*(fun (m+3) xk)*dx^3 + (1/24)*(fun (m+4) xk)*dx^4 - (1/120)*(fun (m+5) xk)*dx^5\n  where delta = 0.1\n        dx    = x-xk\n        xk    = (calcClosestPoint x )* delta\n        fun   = calcutateFun grid  \n        calcClosestPoint r = fromIntegral  $ floor $ x /delta\n\ncalculateFun :: Map Fun Double -&gt; Double -&gt; Double -&gt; Double\ncalculateFun = ....\n</code></pre>\n\n<p>We have a grid where each node is a thunk of the expensive function <code>f</code>. Now every time that we need to calculate <code>f</code> we call <code>funTaylor</code> instead of <code>f</code>.</p>\n\n<p>Notice that's this is a virtual grid in the sense that every time that we call <code>funTaylor m x</code>, only the points involved in the Taylor series are evaluated while the rest of the grid remains unevaluated.</p>\n\n<p>Now suppose that I don't know <em>a priori</em> what are the number <code>xmax</code> and <code>mmax</code>, this virtual space is huge therefore guessing the limits and generating millions of thunks is not a good option.\nThe idea then is to be able to construct the grid \"<em>on the fly</em>\", every time that the funTaylor function is invocated new entries are added to the Map. The problem is that the <code>funTaylor</code> function is called from several parts in my code, from several functions that are evaluated in parallel. Then, I need to share the grid between all the functions that call <code>funTaylor</code>.</p>\n\n<p>One alternative is to create a Channel or Queue that would work like a server between the grid and the functions that call <code>funTaylor</code>, every time a new value <code>funTaylor m x</code> is required it's sent to a Queue that update the grid avoiding the problem of sharing the State-grid between several functions.</p>\n\n<p>The question is then:\nWhat is the best way to generate the grid \"<em>on the fly?</em>\"</p>\n"}, {"tags": ["c", "performance", "haskell", "ffi"], "comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 2, "creation_date": 1438208515, "post_id": 31711599, "comment_id": 51362286, "body": "There&#39;s quite a bit of work needed to make sure you can allocate memory etc. in the Haskell function."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 6, "creation_date": 1438212066, "post_id": 31711599, "comment_id": 51363376, "body": "Disassembling the <code>test</code> symbol produced by the Haskell code could be both educational and a great blog post."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1438244455, "post_id": 31711599, "comment_id": 51374184, "body": "Out of perverse curiosity... does compiling with <code>-threaded</code> make any difference either way?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1438249783, "post_id": 31711599, "comment_id": 51377646, "body": "@MathematicalOrchid: Nope. Maybe in the linked RTS variant, but not in the object code."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1438251204, "post_id": 31711599, "comment_id": 51378522, "body": "@Zeta I was just wondering if it affects the timings. I know the two RTS ways differ in how they handle foreign calls... That said, I wouldn&#39;t be massively surprised if it makes no measurable difference."}], "answers": [{"comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1438251497, "post_id": 31720445, "comment_id": 51378692, "body": "So, in summary, it&#39;s GHC&#39;s green thread scheduling that&#39;s taking up the time. (?)"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1438254759, "post_id": 31720445, "comment_id": 51380751, "body": "Kind of. It wouldn&#39;t be that bad if the CPU (aka capability) or the thread would exist beforehand, but they don&#39;t. And <a href=\"https://github.com/ghc/ghc/blob/892c3e98bcef50aa56ec818f4d001aee36e05bbc/rts/Threads.c\" rel=\"nofollow noreferrer\"><code>createThread</code></a> isn&#39;t really meant to be called for each invocation. In a regular Haskell program, there aren&#39;t that many threads, so that&#39;s not a problem. It&#39;s still better than creating a OS thread for every call, though."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1438273683, "post_id": 31720445, "comment_id": 51394156, "body": "Interesting enough, I think an asynchronous promise would mitigate this problem. The RTS can keep it&#39;s (main) capability and thread. However, this introduces other problems."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1438276685, "post_id": 31720445, "comment_id": 51395911, "body": "From my source reading I think the capability is initialized just once, on the first call into Haskell (see <a href=\"https://github.com/ghc/ghc/blob/111ba4beda4ffc48381723da12e5b237d7f9ac59/rts/Task.c#L119\" rel=\"nofollow noreferrer\">allocTask</a>; <code>myTask()</code> returns a per-OS thread global). The Haskell thread and its stack does get recreated for each foreign call, though. Looks like one could avoid this overhead at the cost of more complicated C code by reusing a single thread, using the functions in RtsAPI.c."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1438278304, "post_id": 31720445, "comment_id": 51396864, "body": "@ReidBarton: If the non-threaded RTS is used, yes. The threaded RTS should even have a little bit more overhead, due to <a href=\"https://github.com/ghc/ghc/blob/111ba4beda4ffc48381723da12e5b237d7f9ac59/rts/Capability.c#L700-L760\" rel=\"nofollow noreferrer\"><code>waitForCapability</code></a> actually performing something. I still think that the culprit is mostly <code>rts_evalIO</code>, but there are probably some other thins one has to consider. Either way, I guess one has to patch GHC/the RTS in order to remove the overhead, but OP&#39;s scenario doesn&#39;t seem too likely to be honest."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 17, "last_activity_date": 1438249774, "creation_date": 1438249774, "answer_id": 31720445, "question_id": 31711599, "link": "https://stackoverflow.com/questions/31711599/why-is-there-overhead-calling-haskell-functions-from-c/31720445#31720445", "title": "Why is there overhead calling Haskell functions from C?", "body": "<p><strong>TL;DR</strong>: Reason: RTS and STG calls. Solution: don't call trivial Haskell functions from C.</p>\n\n<hr>\n\n<blockquote>\n  <p>What is the reason for this\u2026?</p>\n</blockquote>\n\n<p>Disclaimer: I've never called Haskell from C. I'm familiar with C and Haskell, but I rarely intertwine both, unless I'm writing a wrapper. Now that I've lost my credibility, let's start this adventure of benchmarking, disassembling and other nifty horrors.</p>\n\n<h1>Benchmarking with gprof</h1>\n\n<p>One easy way to check what's eating all of your resources is to use gprof. We'll change your compile line slightly so that <code>-pg</code> is used both by the compiler and the linker (note: I've renamed test.c to main.c and test2.c to test.c):</p>\n\n<pre><code>$ ghc -no-hs-main -O2 -optc-O3 -optc-pg -optl-pg -fforce-recomp \\\n    main.c Test.hs -o test\n$ ./test\n$ gprof ./test\n</code></pre>\n\n<p>This gives us the following (flat) profile:</p>\n\n<pre>Flat profile:\n\nEach sample counts as 0.01 seconds.\n  %   cumulative   self              self     total           \n time   seconds   seconds    calls  Ts/call  Ts/call  name    \n 16.85      2.15     2.15                             scheduleWaitThread\n 11.78      3.65     1.50                             createStrictIOThread\n  7.66      4.62     0.98                             createThread\n  6.68      5.47     0.85                             allocate\n  5.66      6.19     0.72                             traverseWeakPtrList\n  5.34      6.87     0.68                             isAlive\n  4.12      7.40     0.53                             newBoundTask\n  3.06      7.79     0.39                             stg_ap_p_fast\n  2.36      8.09     0.30                             stg_ap_v_info\n  1.96      8.34     0.25                             stg_ap_0_fast\n  1.85      8.57     0.24                             rts_checkSchedStatus\n  1.81      8.80     0.23                             stg_PAP_apply\n  1.73      9.02     0.22                             rts_apply\n  1.73      9.24     0.22                             stg_enter_info\n  1.65      9.45     0.21                             stg_stop_thread_info\n  1.61      9.66     0.21                             test\n  1.49      9.85     0.19                             stg_returnToStackTop\n  1.49     10.04     0.19                             move_STACK\n  1.49     10.23     0.19                             stg_ap_v_fast\n  1.41     10.41     0.18                             rts_lock\n  1.18     10.56     0.15                             boundTaskExiting\n  1.10     10.70     0.14                             StgRun\n  0.98     10.82     0.13                             rts_evalIO\n  0.94     10.94     0.12                             stg_upd_frame_info\n  0.79     11.04     0.10                             blockedThrowTo\n  0.67     11.13     0.09                             StgReturn\n  0.63     11.21     0.08                             createIOThread\n  0.63     11.29     0.08                             stg_bh_upd_frame_info\n  0.63     11.37     0.08                             c5KU_info\n  0.55     11.44     0.07                             stg_stk_save_n\n  0.51     11.50     0.07                             threadPaused\n  0.47     11.56     0.06                             dirty_TSO\n  0.47     11.62     0.06                             ghczmprim_GHCziCString_unpackCStringzh_info\n  0.47     11.68     0.06                             stopHeapProfTimer\n  0.39     11.73     0.05                             stg_threadFinished\n  0.39     11.78     0.05                             allocGroup\n  0.39     11.83     0.05                             base_GHCziTopHandler_runNonIO1_info\n  0.39     11.88     0.05                             stg_catchzh\n  0.35     11.93     0.05                             freeMyTask\n  0.35     11.97     0.05                             rts_eval_\n  0.31     12.01     0.04                             awakenBlockedExceptionQueue\n  0.31     12.05     0.04                             stg_ap_2_upd_info\n  0.27     12.09     0.04                             s5q4_info\n  0.24     12.12     0.03                             markStableTables\n  0.24     12.15     0.03                             rts_getSchedStatus\n  0.24     12.18     0.03                             s5q3_info\n  0.24     12.21     0.03                             scavenge_stack\n  0.24     12.24     0.03                             stg_ap_7_upd_info\n  0.24     12.27     0.03                             stg_ap_n_fast\n  0.24     12.30     0.03                             stg_gc_noregs\n  0.20     12.32     0.03                             base_GHCziTopHandler_runIO1_info\n  0.20     12.35     0.03                             stat_exit\n  0.16     12.37     0.02                             GarbageCollect\n  0.16     12.39     0.02                             dirty_STACK\n  0.16     12.41     0.02                             freeGcThreads\n  0.16     12.43     0.02                             rts_mkString\n  0.16     12.45     0.02                             scavenge_capability_mut_lists\n  0.16     12.47     0.02                             startProfTimer\n  0.16     12.49     0.02                             stg_PAP_info\n  0.16     12.51     0.02                             stg_ap_stk_p\n  0.16     12.53     0.02                             stg_catch_info\n  0.16     12.55     0.02                             stg_killMyself\n  0.16     12.57     0.02                             stg_marked_upd_frame_info\n  0.12     12.58     0.02                             interruptAllCapabilities\n  0.12     12.60     0.02                             scheduleThreadOn\n  0.12     12.61     0.02                             waitForReturnCapability\n  0.08     12.62     0.01                             exitStorage\n  0.08     12.63     0.01                             freeWSDeque\n  0.08     12.64     0.01                             gcStableTables\n  0.08     12.65     0.01                             resetTerminalSettings\n  0.08     12.66     0.01                             resizeNurseriesEach\n  0.08     12.67     0.01                             scavenge_loop\n  0.08     12.68     0.01                             split_free_block\n  0.08     12.69     0.01                             startHeapProfTimer\n  0.08     12.70     0.01                             stg_MVAR_TSO_QUEUE_info\n  0.08     12.71     0.01                             stg_forceIO_info\n  0.08     12.72     0.01                             zero_static_object_list\n  0.04     12.73     0.01                             frame_dummy\n  0.04     12.73     0.01                             rts_evalLazyIO_\n  0.00     12.73     0.00        1     0.00     0.00  stginit_export_Test_zdfstableZZC0ZZCmainZZCTestZZCtest\n</pre>\n\n<p>Woah, that's a bunch of functions getting called. How does this compare to your C version?</p>\n\n<pre><code>$ ghc -no-hs-main -O2 -optc-O3 -optc-pg -optl-pg -fforce-recomp \\\n    main.c TestDummy.hs test.c -o test_c\n$ ./test_c\n$ gprof ./test_c\n</code></pre>\n\n<pre>Flat profile:\n\nEach sample counts as 0.01 seconds.\n  %   cumulative   self              self     total           \n time   seconds   seconds    calls  Ts/call  Ts/call  name    \n 75.00      0.05     0.05                             test\n 25.00      0.06     0.02                             frame_dummy\n</pre>\n\n<p>That's a <strong><em>lot</em></strong> simpler. But why?</p>\n\n<h1>What's happening behind?</h1>\n\n<p>Maybe you've wondered why <code>test</code> even showed up in the previous profile. Well, gprof itself adds some overhead, as can be seen with <code>objdump</code>:</p>\n\n<pre><code>$ objdump -D ./test_c | grep -A5 \"&lt;test&gt;:\"\n</code></pre>\n\n<pre class=\"lang-plain prettyprint-override\"><code>0000000000405630 &lt;test&gt;:\n  405630:   55                      push   %rbp\n  405631:   48 89 e5                mov    %rsp,%rbp\n  405634:   e8 f7 d4 ff ff          callq  402b30 &lt;mcount@plt&gt;\n  405639:   5d                      pop    %rbp\n  40563a:   c3                      retq   \n</code></pre>\n\n<p>The call of <code>mcount</code> is added by gcc. So for the next part you want to remove the <code>-pg</code> options. Let's check the disassembled <code>test</code> routine in C first:</p>\n\n<pre><code>$ ghc -no-hs-main -O2 -optc-O3 -fforce-recomp \\ \n    main.c TestDummy.hs test.c -o test_c\n$ objdump -D ./test_c | grep -A2 \"&lt;test&gt;:\"\n</code></pre>\n\n<pre class=\"lang-plain prettyprint-override\"><code>0000000000405510 &lt;test&gt;:\n  405510:   f3 c3                   repz retq\n</code></pre>\n\n<p>The <code>repz retq</code> is actually <a href=\"http://repzret.org/p/repzret/\">some optimisation magic</a>, but in this case you can think of it as a (mostly) no-op return. </p>\n\n<p>How does this compare to the Haskell version?</p>\n\n<pre><code>$ ghc -no-hs-main -O2 -optc-O3 -fforce-recomp \\ \n    main.c Test.hs -o test_hs    \n$ objdump -D ./Test.o | grep -A18 \"&lt;test&gt;:\"\n</code></pre>\n\n<pre class=\"lang-plain prettyprint-override\"><code>0000000000405520 &lt;test&gt;:\n  405520:   48 83 ec 18             sub    $0x18,%rsp\n  405524:   e8 f7 3a 05 00          callq  459020 &lt;rts_lock&gt;\n  405529:   ba 58 24 6b 00          mov    $0x6b2458,%edx\n  40552e:   be 80 28 6b 00          mov    $0x6b2880,%esi\n  405533:   48 89 c7                mov    %rax,%rdi\n  405536:   48 89 04 24             mov    %rax,(%rsp)\n  40553a:   e8 51 36 05 00          callq  458b90 &lt;rts_apply&gt;\n  40553f:   48 8d 54 24 08          lea    0x8(%rsp),%rdx\n  405544:   48 89 c6                mov    %rax,%rsi\n  405547:   48 89 e7                mov    %rsp,%rdi\n  40554a:   e8 01 39 05 00          callq  458e50 &lt;rts_evalIO&gt;\n  40554f:   48 8b 34 24             mov    (%rsp),%rsi\n  405553:   bf 64 57 48 00          mov    $0x485764,%edi\n  405558:   e8 23 3a 05 00          callq  458f80 &lt;rts_checkSchedStatus&gt;\n  40555d:   48 8b 3c 24             mov    (%rsp),%rdi\n  405561:   e8 0a 3b 05 00          callq  459070 &lt;rts_unlock&gt;\n  405566:   48 83 c4 18             add    $0x18,%rsp\n  40556a:   c3                      retq   \n  40556b:   0f 1f 44 00 00          nopl   0x0(%rax,%rax,1)\n  405570:   d8 ce                   fmul   %st(6),%st\n</code></pre>\n\n<p>This looks rather different. Indeed, the <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Rts\">RTS</a> functions seem suspicious. Let's have a look at them:</p>\n\n<ul>\n<li><a href=\"https://github.com/ghc/ghc/blob/111ba4beda4ffc48381723da12e5b237d7f9ac59/rts/RtsAPI.c#L514-L542\"><code>rts_checkSchedStatus</code></a> just checks whether the status is fine, and exits otherwise. The <code>Success</code> path doesn't have much overhead, so this function isn't really the culprit.</li>\n<li><a href=\"https://github.com/ghc/ghc/blob/111ba4beda4ffc48381723da12e5b237d7f9ac59/rts/RtsAPI.c#L550-L616\"><code>rts_unlock</code> and <code>rts_lock</code></a> basically claim and release a <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Rts/Scheduler#Capabilities\">capability</a> (a virtual CPU). They call <code>newBoundTask</code> and <code>boundTaskExiting</code>, which take some time (see profile above).</li>\n<li><a href=\"https://github.com/ghc/ghc/blob/111ba4beda4ffc48381723da12e5b237d7f9ac59/rts/RtsAPI.c#L195-L208\"><code>rts_apply</code></a> calls <code>allocate</code>, one of the most often used functions throughout the program (which isn't really surprising, with Haskell being garbage collected).</li>\n<li><a href=\"https://github.com/ghc/ghc/blob/111ba4beda4ffc48381723da12e5b237d7f9ac59/rts/RtsAPI.c#L448-L460\"><code>rts_evalIO</code></a>  finally creates the actual thread and waits for its completion. So we can estimate that <code>rts_evalIO</code> alone takes about 27%.</li>\n</ul>\n\n<p>So we found all the functions that are taking all the time. The STG and the RTS take all the credit for the overhead of 150ns per call.</p>\n\n<blockquote>\n  <p>\u2026and is there a way to mitigate this slowdown?</p>\n</blockquote>\n\n<p>Well, your <code>test</code> is basically a no-op. You're calling it 100000000 times, with a total runtime of 15s. Compared to the C version, that's an overhead of ~149ns per call.</p>\n\n<p>The solution is quite simple: don't use Haskell functions in your C world for trivial tasks. Use the right tool for the right situation. After all, you don't use the GMP library if you need to add two numbers that are guaranteed to be less than 10.</p>\n\n<p>Apart from this paradigmatic solution: no. The assembly shown above is what's created by GHC, and it's not possible to create a variant without RTS calls at the moment.</p>\n"}], "owner": {"reputation": 506, "user_id": 3855418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/629e64849675ac3b6fe97e3b36357854?s=128&d=identicon&r=PG", "display_name": "Evan Jenkins", "link": "https://stackoverflow.com/users/3855418/evan-jenkins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 897, "favorite_count": 3, "answer_count": 1, "score": 17, "last_activity_date": 1438272517, "creation_date": 1438205781, "last_edit_date": 1592644375, "question_id": 31711599, "link": "https://stackoverflow.com/questions/31711599/why-is-there-overhead-calling-haskell-functions-from-c", "title": "Why is there overhead calling Haskell functions from C?", "body": "<p>I've noticed a significant overhead calling Haskell functions in C, much larger than the overhead of a native C function call. To distill the issue to its essence, I wrote a program that just initializes the Haskell runtime, runs a loop that calls an empty function 100,000,000 times, and returns.</p>\n<p>With the function inlined, the program takes 0.003s. Calling an empty function written in C takes 0.18s. Calling an empty function written in Haskell takes 15.5s. (Strangely, if I compile the empty Haskell file separately before linking, it takes a few more seconds. Sub-question: why is this?)</p>\n<p>So it looks like there's about a 100-fold slowdown between calling a C function and calling a Haskell function. What is the reason for this, and is there a way to mitigate this slowdown?</p>\n<h1>Code</h1>\n<blockquote>\n<p>EDIT: I've discovered a version of this test in the <a href=\"https://github.com/ghc/nofib\" rel=\"noreferrer\">NoFib benchmark suite</a>, <code>callback002</code>. There's a <a href=\"http://blog.ezyang.com/2013/01/the-ghc-scheduler/\" rel=\"noreferrer\">nice blog post</a> by Edward Z. Yang mentioning this test in the context of the GHC scheduler. I'm still trying to grok this blog post along with Zeta's very nice answer. I'm not yet convinced that there's not a way to do this faster!</p>\n</blockquote>\n<p>To compile the &quot;slow&quot; Haskell version, run</p>\n<p><code>ghc -no-hs-main -O2 -optc-O3 test.c Test.hs -o test</code></p>\n<p>To compile the &quot;fast&quot; C version, run</p>\n<p><code>ghc -no-hs-main -O2 -optc-O3 test.c test2.c TestDummy.hs -o test</code></p>\n<p>test.c:</p>\n<pre><code>#include &quot;HsFFI.h&quot;\nextern void __stginit_Test(void);\n\nextern void test();\n\nint main(int argc, char *argv[]) {\n  hs_init(&amp;argc, &amp;argv);\n  hs_add_root(__stginit_Test);\n  int i;\n  for (i = 0; i &lt; 100000000; i++) {\n    test();\n  }\n  hs_exit();\n  return 0;\n}\n</code></pre>\n<p>test2.c:</p>\n<pre><code>void test() {\n}\n</code></pre>\n<p>Test.hs:</p>\n<pre><code>{-# LANGUAGE ForeignFunctionInterface #-}\n\nmodule Test where\n\nforeign export ccall test :: ()\n\ntest :: ()\ntest = ()\n</code></pre>\n<p>TestDummy.hs:</p>\n<pre><code>module Test where\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1438207795, "post_id": 31710824, "comment_id": 51362009, "body": "please do not edit your question to ask new questions - this is not the way stackoverflow works, just ask a new question and/or see if something like this has been answered before. - btw you are just working with a list after <code>ns &lt;- getNetworkInterfaces</code> so study the list functions in the standard library (Prelude), and if you are new search for <code>record-syntax</code> which might provide some answers."}, {"owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1438207929, "post_id": 31710824, "comment_id": 51362069, "body": "@epsilonhalbe did I not just expand on original question ? I originally asked how to access my local ip, and then in edited version I ave output of  function and ip value that I wish to extract. But I admit there are at least more than 1 questions in my post. Thanks."}], "answers": [{"comments": [{"owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "edited": false, "score": 0, "creation_date": 1438207372, "post_id": 31711386, "comment_id": 51361841, "body": "thanks for this detail, will take me a few re-reads. But I don&#39;t understand how to access the IP address of hostmachine. Should I be able to use something like &quot;ns ipv4&quot; ? I have updated question"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "edited": false, "score": 0, "creation_date": 1438207620, "post_id": 31711386, "comment_id": 51361939, "body": "it would not work this way <code>ns ipv4</code> is a list applied (whitespace = function application) to a function which is not correct - in order to get the first element of a list you would need a function called <code>head :: [a] -&gt; a</code>. So <code>ipv4 (head ns)</code> would be a correct thing. if you are new to haskell and having problems with lists I can recomment the respective chapters in learnyouahaskell.com"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "edited": false, "score": 0, "creation_date": 1438208084, "post_id": 31711386, "comment_id": 51362124, "body": "the chapter on record syntax <a href=\"http://learnyouahaskell.com/making-our-own-types-and-typeclasses#record-syntax\" rel=\"nofollow noreferrer\">learnyouahaskell.com/&hellip;</a> and for list handling <a href=\"http://learnyouahaskell.com/starting-out#an-intro-to-lists\" rel=\"nofollow noreferrer\">learnyouahaskell.com/starting-out#an-intro-to-lists</a> - PS: I like this chapter simply for the caterpillar"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 3, "last_activity_date": 1438206037, "last_edit_date": 1438206037, "creation_date": 1438204933, "answer_id": 31711386, "question_id": 31710824, "link": "https://stackoverflow.com/questions/31710824/access-ipv4-address-of-local-linux-machine/31711386#31711386", "title": "Access IPV4 address of local linux machine", "body": "<p>From the documentation you get the definition of <code>NetworkInterface</code></p>\n\n<pre><code>data NetworkInterface = NetworkInterface { name :: String\n                                         , ipv4 :: IPv4\n                                         , ipv6 :: IPv6\n                                         , mac :: MAC}\n</code></pre>\n\n<p>this tells you that if you want to access <code>name</code> etc. you have accessor function of the same name, with the type signature <code>name :: NetworkInterface -&gt; String</code> (analogously for the others) - thus if you want to extract the name from a list of network interfaces you are looking for something like <code>?? :: (NetworkInterfaces -&gt; String) -&gt; [NetworkInterfaces] -&gt; [String]</code> which is a special case of this type signature <code>?? :: (a -&gt; b) -&gt; [a] -&gt; [b]</code> put it into <a href=\"https://www.haskell.org/hoogle/?hoogle=%28a+-%3E+b%29+-%3E+%5Ba%5D+-%3E+%5Bb%5D\" rel=\"nofollow\">hoogle</a> and you see a function called <code>map</code> as the first result.</p>\n\n<p>So in order to collect the network names you only need to <code>map names ns</code>.</p>\n\n<p>But if you want to apply this functions to the result of <code>getNetworkInterfaces</code> there is this <code>IO</code> indicator that is not fitting into this type signature; but there exists a function called <code>fmap</code> - a more general version of the function <code>map</code> we already saw that can help us.</p>\n\n<p><code>fmap</code> takes a container (in this case <code>IO</code> and a function that works on containees and applies the function in a sensible way to said containees, (btw. all containers that supply such a function are called <code>Functors</code>).</p>\n\n<p>So in order to get your names from <code>getNetworkInterfaces</code> directely you need to put in your ghci: </p>\n\n<pre><code>Prelude&gt; ns &lt;- fmap (map name) getNetworkInterfaces\n</code></pre>\n\n<p>or with 'backtick-syntax'</p>\n\n<pre><code>Prelude&gt; ns &lt;- map name `fmap` getNetworkInterfaces\n</code></pre>\n\n<p>and if you <code>import Control.Applicative</code> you get this very handy infix operator <code>&lt;$&gt;</code> that lets you write it as <code>map name &lt;$&gt; getNetworkInterfaces</code></p>\n\n<h1>EDIT</h1>\n\n<p><code>showInterface</code> is actually a function - its type signature which is omitted - is <code>showInterface :: NetworkInterface -&gt; String</code> which means it takes a <code>NetworkInterface</code> and produces a <code>String</code>. So the <code>n</code> is actually a network interface which has (by the data declaration I posted) 4 accessor functions for getting <code>name</code>, <code>ipv4</code>, <code>ipv6</code>, and <code>mac</code>. Unfortunately the <code>putStr</code> function which produces output to <code>stdout</code> has type signature <code>String -&gt; IO ()</code> which would only work for <code>name</code> which is already a <code>String</code>, to get the remaining 3 to work we have to use haskell's <code>toString()</code>-method which is called <code>show</code>, the rest that <code>showInterface</code> does is stitching <code>String</code>s together with the <code>++</code> operator. (Sidenote: <code>(++)</code> stitches together two lists of the same type and <code>String</code>s are just <code>[Char]</code> = list of <code>Char</code>)</p>\n\n<p>So what does <code>mapM_</code> do at last - it works very analogous to <code>map</code> (hence the name), but it allows for side effects to happen and fortunately enough printing to stdout (with <code>putStr</code>) is such a side effect. Note that there are two functions very similar <code>mapM</code> and <code>mapM_</code> the underscore you might see from time to time in haskell-land indicates that something is thrown away/not needed, in this case the result - where in this case <code>mapM</code> would produce a <code>IO [()]</code>, <code>mapM_</code> just forgets the list and produces <code>IO ()</code> (speak IO unit - which you can think of <code>void</code> in C-like languages, my mnemonic is <code>void</code> has io in it but with something around to hide it and spelled in the wrong order).</p>\n\n<p>And incidentally the type signature for <code>main</code> which is also omitted is <code>main :: IO ()</code> which fits exactly to the <code>mapM_</code>.</p>\n"}], "owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 351, "favorite_count": 0, "accepted_answer_id": 31711386, "answer_count": 1, "score": 1, "last_activity_date": 1438207260, "creation_date": 1438202951, "last_edit_date": 1438207260, "question_id": 31710824, "link": "https://stackoverflow.com/questions/31710824/access-ipv4-address-of-local-linux-machine", "title": "Access IPV4 address of local linux machine", "body": "<p>I'm attempting to use this library to access IP : </p>\n\n<p><a href=\"http://jacob.stanley.io/2010/08/12/ip-addresses-and-mac-addresses-in-haskell/\" rel=\"nofollow\">http://jacob.stanley.io/2010/08/12/ip-addresses-and-mac-addresses-in-haskell/</a></p>\n\n<p>src : </p>\n\n<pre><code>import Network.Info\n\n    main = do\n        ns &lt;- getNetworkInterfaces\n        mapM_ (putStr . showInterface) ns\n\n    showInterface n = name n ++ \"\\n\"\n                   ++ \"  IPv4: \" ++ show (ipv4 n) ++ \"\\n\"\n                   ++ \"  IPv6: \" ++ show (ipv6 n) ++ \"\\n\"\n                   ++ \"  MAC:  \" ++ show (mac n) ++ \"\\n\"\n</code></pre>\n\n<p>How can I just access the IPv4 address via ghci in a var ?</p>\n\n<p>something like : </p>\n\n<pre><code> let ipv4 = filterIpV4Address(ns)\n</code></pre>\n\n<p><code>ns</code> is of type <code>ns :: [NetworkInterface]</code> and contains all the network interfaces. I'm new to Haskell and do not understand this code.</p>\n\n<p>How is variable \"n\" set in line <code>showInterface n = name n ++ \"\\n\"</code></p>\n\n<p>Is it somehow set at line <code>mapM_ (putStr . showInterface) ns</code> ?</p>\n\n<p>Update : </p>\n\n<pre><code>Prelude Network.Info Main&gt; ns &lt;- getNetworkInterfaces\nPrelude Network.Info Main&gt; ns\n\n    [NetworkInterface {name = \"Local Area Connection\", ipv4 = 169.254.166.181, ipv6\n    = fe80:0:0:0:94d4:87b2:7435:a6b5, mac = e8:11:32:d4:bf:04},NetworkInterface {nam\n    e = \"Wireless Network Connection\", ipv4 = 192.168.1.12, ipv6 = fe80:0:0:0:b593:3\n    47d:11d0:916f, mac = 00:1b:b1:28:a7:96},NetworkInterface {name = \"Bluetooth Netw\n    ork Connection\", ipv4 = 169.254.131.172, ipv6 = fe80:0:0:0:6cc5:4071:a29b:83ac,\n    mac = 90:a4:de:9c:a2:7a},NetworkInterface {name = \"VirtualBox Host-Only Network\"\n    , ipv4 = 192.168.56.1, ipv6 = fe80:0:0:0:91e2:7d75:e6f7:d90f, mac = 0a:00:27:00:\n    00:00},NetworkInterface {name = \"Loopback Pseudo-Interface 1\", ipv4 = 127.0.0.1,\n     ipv6 = 0:0:0:0:0:0:0:1, mac = 00:00:00:00:00:00},NetworkInterface {name = \"Loca\n    l Area Connection* 12\", ipv4 = 0.0.0.0, ipv6 = fe80:0:0:0:0:100:7f:fffe, mac = 0\n    0:00:00:00:00:00},NetworkInterface {name = \"isatap.home\", ipv4 = 64.3.66.5, ipv6\n     = fe80:0:0:0:0:5efe:c0a8:10c, mac = 00:00:00:00:00:00},NetworkInterface {name =\n     \"isatap.{7F25AE4D-EDF3-491F-ADED-642C194C94D9}\", ipv4 = 0.0.0.0, ipv6 = fe80:0:\n    0:0:0:5efe:c0a8:3801, mac = 00:00:00:00:00:00}]\n</code></pre>\n\n<p>So how to extract value : 192.168.1.12 ?</p>\n"}, {"tags": ["python", "list", "loops", "haskell"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 2, "creation_date": 1438234084, "post_id": 31710499, "comment_id": 51368932, "body": "BTW: you probably want: <code>enumerate(s, start=1)</code> for a direct equivalent. Moreover in the <code>itertools</code> module there is a <code>[n..]</code> perfect equivalent which is <code>itertools.count(n)</code> so you could translate the code to <code>zip(count(n), s)</code>."}, {"owner": {"reputation": 1492, "user_id": 985366, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/fa038012681730786baa170451a1447f?s=128&d=identicon&r=PG", "display_name": "user985366", "link": "https://stackoverflow.com/users/985366/user985366"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1438261548, "post_id": 31710499, "comment_id": 51385303, "body": "For your n, wouldn&#39;t you actually put len(s) when you don&#39;t know n?"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1438284017, "post_id": 31710499, "comment_id": 51400094, "body": "No. <code>count(n)</code> is &quot;the same&quot; as <code>[n..]</code> i.e. the infinite sequence of naturals greater or equal to <code>n</code>."}, {"owner": {"reputation": 1492, "user_id": 985366, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/fa038012681730786baa170451a1447f?s=128&d=identicon&r=PG", "display_name": "user985366", "link": "https://stackoverflow.com/users/985366/user985366"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1438285628, "post_id": 31710499, "comment_id": 51400971, "body": "Oh, so n in this case would be  0 or 1 depending on how I want to index   (1 according to the given Haskell code)"}], "answers": [{"comments": [{"owner": {"reputation": 44584, "user_id": 2617068, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/0nSBO.png?s=128&g=1", "display_name": "TigerhawkT3", "link": "https://stackoverflow.com/users/2617068/tigerhawkt3"}, "edited": false, "score": 0, "creation_date": 1438201983, "post_id": 31710520, "comment_id": 51359112, "body": "NB: This only works in Python 2, where <code>zip()</code> returns a <code>list</code>."}, {"owner": {"reputation": 44584, "user_id": 2617068, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/0nSBO.png?s=128&g=1", "display_name": "TigerhawkT3", "link": "https://stackoverflow.com/users/2617068/tigerhawkt3"}, "edited": false, "score": 0, "creation_date": 1438202267, "post_id": 31710520, "comment_id": 51359275, "body": "Since (in Python 3) <code>zip(range(len(s)) , s</code> is functionally identical to <code>enumerate(s)</code>, it looks like you&#39;ve arrived at <code>list(enumerate(s))</code>. :P"}], "tags": [], "owner": {"reputation": 5935, "user_id": 893324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b24d4de5ae7afebfee98aa85e8a960e?s=128&d=identicon&r=PG", "display_name": "Brien", "link": "https://stackoverflow.com/users/893324/brien"}, "is_accepted": false, "score": 1, "last_activity_date": 1438202107, "last_edit_date": 1438202107, "creation_date": 1438201870, "answer_id": 31710520, "question_id": 31710499, "link": "https://stackoverflow.com/questions/31710499/python-equivalent-of-haskells-1-to-index-a-list/31710520#31710520", "title": "Python equivalent of Haskell&#39;s [1..] (to index a list)", "body": "<p>You can use the <code>range</code> function with <code>zip</code>.</p>\n\n<p>For Python 2:</p>\n\n<pre><code>&gt;&gt;&gt; s = \"abcdefghijklmnop\"\n&gt;&gt;&gt; zip(range(16),s)\n[(0, 'a'), (1, 'b'), (2, 'c'), (3, 'd'), (4, 'e'), (5, 'f'), (6, 'g'), (7, 'h'), (8, 'i'), (9, 'j'), (10, 'k'), (11, 'l'), (12, 'm'), (13, 'n'), (14, 'o'), (15, 'p')]\n</code></pre>\n\n<p>For Python 3:</p>\n\n<pre><code>&gt;&gt;&gt; s = \"abcdefghijklmnop\"\n&gt;&gt;&gt; list(zip(range(16),s))\n[(0, 'a'), (1, 'b'), (2, 'c'), (3, 'd'), (4, 'e'), (5, 'f'), (6, 'g'), (7, 'h'), (8, 'i'), (9, 'j'), (10, 'k'), (11, 'l'), (12, 'm'), (13, 'n'), (14, 'o'), (15, 'p')]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1492, "user_id": 985366, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/fa038012681730786baa170451a1447f?s=128&d=identicon&r=PG", "display_name": "user985366", "link": "https://stackoverflow.com/users/985366/user985366"}, "edited": false, "score": 0, "creation_date": 1438202493, "post_id": 31710528, "comment_id": 51359427, "body": "I feel this is the far cleanest one so far, even if they all work. It also works for me on Python 2.7"}], "tags": [], "owner": {"reputation": 44584, "user_id": 2617068, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/0nSBO.png?s=128&g=1", "display_name": "TigerhawkT3", "link": "https://stackoverflow.com/users/2617068/tigerhawkt3"}, "is_accepted": true, "score": 23, "last_activity_date": 1438201890, "creation_date": 1438201890, "answer_id": 31710528, "question_id": 31710499, "link": "https://stackoverflow.com/questions/31710499/python-equivalent-of-haskells-1-to-index-a-list/31710528#31710528", "title": "Python equivalent of Haskell&#39;s [1..] (to index a list)", "body": "<p>Just do <code>list(enumerate(s))</code>. This iterates over the <code>enumerate</code> object and converts it to a <code>list</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 209335, "user_id": 661519, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1735ab1c8ba4229daa855ec6aad03065?s=128&d=identicon&r=PG", "display_name": "juanchopanza", "link": "https://stackoverflow.com/users/661519/juanchopanza"}, "is_accepted": false, "score": 5, "last_activity_date": 1438203390, "last_edit_date": 1438203390, "creation_date": 1438201908, "answer_id": 31710532, "question_id": 31710499, "link": "https://stackoverflow.com/questions/31710499/python-equivalent-of-haskells-1-to-index-a-list/31710532#31710532", "title": "Python equivalent of Haskell&#39;s [1..] (to index a list)", "body": "<p>You can simplify it with a list comprehension:</p>\n\n<pre><code>&gt;&gt;&gt; [i for i in enumerate(s)]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 280325, "user_id": 1560062, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7c5027e3046fed86e8e34b4fa0e6246c?s=128&d=identicon&r=PG", "display_name": "zero323", "link": "https://stackoverflow.com/users/1560062/zero323"}, "is_accepted": false, "score": 2, "last_activity_date": 1438202344, "creation_date": 1438202344, "answer_id": 31710639, "question_id": 31710499, "link": "https://stackoverflow.com/questions/31710499/python-equivalent-of-haskells-1-to-index-a-list/31710639#31710639", "title": "Python equivalent of Haskell&#39;s [1..] (to index a list)", "body": "<p>Using <code>enumerate</code> is definitely the way to go, but here is a little bit more functional solution with <a href=\"https://github.com/pytoolz/toolz\" rel=\"nofollow\">toolz</a>:</p>\n\n<pre><code>from toolz.itertoolz import iterate, zip\nzip(iterate(lambda x: x + 1, 0), \"abcdefghijklmnop\")\n</code></pre>\n"}], "owner": {"reputation": 1492, "user_id": 985366, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/fa038012681730786baa170451a1447f?s=128&d=identicon&r=PG", "display_name": "user985366", "link": "https://stackoverflow.com/users/985366/user985366"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1001, "favorite_count": 1, "accepted_answer_id": 31710528, "answer_count": 4, "score": 8, "last_activity_date": 1438203390, "creation_date": 1438201789, "question_id": 31710499, "link": "https://stackoverflow.com/questions/31710499/python-equivalent-of-haskells-1-to-index-a-list", "title": "Python equivalent of Haskell&#39;s [1..] (to index a list)", "body": "<p>I have a list of elements in python. I don't know the number of elements in the list. I would like to add indexes to the list.</p>\n\n<p>In Haskell, I could do the following</p>\n\n<pre><code>zip [1..] \"abcdefghijklmnop\"\n[(1,'a'),(2,'b'),(3,'c'),(4,'d'),(5,'e'),(6,'f'),(7,'g'),(8,'h'),(9,'i'),(10,'j'),(11,'k'),(12,'l'),(13,'m'),(14,'n'),(15,'o'),(16,'p')]\n</code></pre>\n\n<p>Now imagine that the string was of unknown size. This would still work in Haskell, and the integer list gives as many integers as necessary until the string runs out. </p>\n\n<p>How would one do the equivalent in Python?</p>\n\n<p>I have tried this:</p>\n\n<pre><code>s = \"abcdefghijklmnop\"\nindexedlist = []\nfor i,c in enumerate(s):\n    indexedlist.append((i,c))\n\n&gt;&gt;&gt; indexedlist\n[(0, 'a'), (1, 'b'), (2, 'c'), (3, 'd'), (4, 'e'), (5, 'f'), (6, 'g'), (7, 'h'), (8, 'i'), (9, 'j'), (10, 'k'), (11, 'l'), (12, 'm'), (13, 'n'), (14, 'o'), (15, 'p')]\n</code></pre>\n\n<p>And it works, but I'm wondering if there is a shorter/cleaner way, since it is 4 lines of code and feels much.</p>\n"}, {"tags": ["haskell", "cabal", "cabal-install"], "comments": [{"owner": {"reputation": 3667, "user_id": 3288910, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2c2b8044eca80b9a707c716c530d9f5?s=128&d=identicon&r=PG", "display_name": "Jason", "link": "https://stackoverflow.com/users/3288910/jason"}, "edited": false, "score": 0, "creation_date": 1438201189, "post_id": 31710184, "comment_id": 51358723, "body": "Have you tried manually installing HTTP?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1438202716, "post_id": 31710184, "comment_id": 51359551, "body": "I&#39;m not sure you should use cabal-install 1.22.x with the ghc version coming with the platform anyway"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1438203136, "post_id": 31710184, "comment_id": 51359760, "body": "What version of the Haskell Platform are you using?"}], "owner": {"reputation": 379, "user_id": 3261886, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/5ad2c8885a2b38ef07d28ff8949e186a?s=128&d=identicon&r=PG&f=1", "display_name": "jonesjones", "link": "https://stackoverflow.com/users/3261886/jonesjones"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 137, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1517906421, "creation_date": 1438200600, "last_edit_date": 1517906421, "question_id": 31710184, "link": "https://stackoverflow.com/questions/31710184/cabal-install-failing-to-install-cabal-install", "title": "Cabal Install failing to install cabal-install", "body": "<p>Just installed the Haskell platform. When I do</p>\n\n<pre><code>$ cabal install cabal cabal-install\n</code></pre>\n\n<p>I get</p>\n\n<pre><code>Build log ( /Users/robbiecarlton/.cabal/logs/cabal-install-1.22.6.0.log ):\nConfiguring cabal-install-1.22.6.0...\nBuilding cabal-install-1.22.6.0...\nPreprocessing executable 'cabal' for cabal-install-1.22.6.0...\n&lt;command line&gt;: cannot satisfy -package-id HTTP-4000.2.10-da371776b88c2889959897a2dc40abe7\n(use -v for more information)\ncabal: Error: some packages failed to install:\ncabal-install-1.22.6.0 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre>\n\n<p>The same thing happens trying to install manually from source.</p>\n"}, {"tags": ["algorithm", "haskell", "functional-programming", "lambda-calculus", "modular-arithmetic"], "comments": [{"owner": {"reputation": 13014, "user_id": 5113, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a6ef9f7bfccd43bc5f22bfbc2eb41855?s=128&d=identicon&r=PG", "display_name": "Jason Dagit", "link": "https://stackoverflow.com/users/5113/jason-dagit"}, "edited": false, "score": 2, "creation_date": 1438194327, "post_id": 31707614, "comment_id": 51354775, "body": "Can you tell us more about the type of optimal evaluation you use? Perhaps a paper citation? Thanks!"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 11, "creation_date": 1438194500, "post_id": 31707614, "comment_id": 51354864, "body": "I&#39;m using Lamping&#39;s abstract algorithm, as explained on the <a href=\"https://www.google.com.br/?gfe_rd=cr&amp;ei=4hq5VZjHFKqk8weG0aDYAw&amp;gws_rd=ssl#safe=active&amp;q=the+optimal+implementation+of+functional\" rel=\"nofollow noreferrer\">The Optimal Implementation of Functional Programming Languages</a> book. Notice I&#39;m not using the &quot;oracle&quot; (no croissants/brackets) since that term is EAL-typeable. Also, instead of randomly reducing fans in parallel, I&#39;m sequentially traversing the graph as to not reduce unreachable nodes, but I&#39;m afraid this isn&#39;t on literature AFAIK..."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 7, "creation_date": 1438197888, "post_id": 31707614, "comment_id": 51356819, "body": "Okay, in case anyone is curious, I&#39;ve set up a <a href=\"https://github.com/SrVictorMaia/optlam\" rel=\"nofollow noreferrer\">GitHub repository</a> with the source code for my optimal evaluator. It has many comments and you can test it running <code>node test.js</code>. Let me know if you have any questions."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1438201096, "post_id": 31707614, "comment_id": 51358658, "body": "Neat find!  I do not know enough about optimal evaluation, but I can say that this reminds me of Fermat&#39;s Little Theorem / Euler&#39;s Theorem. If you are unaware of it, it might be a good starting point."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1438208314, "post_id": 31707614, "comment_id": 51362214, "body": "Are you sure the arcane <code>expMod</code> combinator does not really exploit some &quot;specific modular arithmetic algorithm or formula&quot;? I have no idea about how that incantation really works. Can you split the algorithm more cleanly into &quot;computing exp&quot; and &quot;computing mod&quot;?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1438208461, "post_id": 31707614, "comment_id": 51362262, "body": "Or more directly, what happens if you do <code>expMod(10(10), 1, 13)</code> so that the <code>exp</code> step is clearly separated?"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1438208948, "post_id": 31707614, "comment_id": 51362453, "body": "@chi, <code>exp.mod</code> is just <code>(a b c -&gt; (nat.mod (nat.pow a b) c))</code>. <code>nat.pow</code> is just <code>(m n -&gt; (n m))</code> and <code>nat.mod</code> is <code>(n m -&gt; (tuple.rev_enum m (args.select_mod m n)))</code>. You can consult the dependencies of <code>nat.mod</code> on the <a href=\"http://lambda.wiki/nat.mod\" rel=\"nofollow noreferrer\">Lambda Wiki</a>, all is listed there."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1438209056, "post_id": 31707614, "comment_id": 51362500, "body": "@Viclib OK, then. I actually hoped that was the case, but could not see from the code."}, {"owner": {"reputation": 50650, "user_id": 3182664, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/2s35X.png?s=128&g=1", "display_name": "Marco13", "link": "https://stackoverflow.com/users/3182664/marco13"}, "edited": false, "score": 5, "creation_date": 1438357836, "post_id": 31707614, "comment_id": 51434205, "body": "This is the first time where I don&#39;t have the slightest clue what the question is all about, but nevertheless upvote the question, and particularly, the outstanding first-post-answer."}, {"owner": {"reputation": 43226, "user_id": 61342, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3e8d217e0ecf6db31de80b698726a50a?s=128&d=identicon&r=PG", "display_name": "\u0141ukasz Lew", "link": "https://stackoverflow.com/users/61342/%c5%81ukasz-lew"}, "edited": false, "score": 0, "creation_date": 1504567395, "post_id": 31707614, "comment_id": 79050048, "body": "Victor, are you by any chance currently in Oxford at ICFP ? (I could not find other way to contact  you)"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 43226, "user_id": 61342, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3e8d217e0ecf6db31de80b698726a50a?s=128&d=identicon&r=PG", "display_name": "\u0141ukasz Lew", "link": "https://stackoverflow.com/users/61342/%c5%81ukasz-lew"}, "edited": false, "score": 0, "creation_date": 1504572154, "post_id": 31707614, "comment_id": 79050959, "body": "@\u0141ukaszLew no, I&#39;m in Rio, sorry. Why? Feel free to mail me at srvictormaia@gmail.com or add me on fb.com/vhsmaia..."}], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1438206460, "post_id": 31711730, "comment_id": 51361420, "body": "Interesting. A follow-up question would be: does that mean that any church-number function that I throw at the evaluator will compute as fast as it possibly could, even if I don&#39;t specifically use those &quot;shortcut formulas&quot;?"}, {"owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1438206797, "post_id": 31711730, "comment_id": 51361587, "body": "No, that seems highly implausible!  Presumably discovering the optimal evaluation strategy for a given term can involve huge amounts of work before you even start performing the evaluation."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1438207171, "post_id": 31711730, "comment_id": 51361741, "body": "Hey, do you have suggestions of functions over natural numbers that are expensive to compute naively, but for which there is magical formula that does it quickly?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 4, "creation_date": 1438208149, "post_id": 31711730, "comment_id": 51362150, "body": "@Viclib Fibonacci as @Tom says is a good example. <code>fib</code> requires exponential time in the naive way, which can be reduced to linear with a simple memoization/dynamic programming. Even logarithmic (!) time is possible through computing the n-th matrix power of <code>[[0,1],[1,1]]</code> (as long as you count each multiplication to have a constant cost)."}, {"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 1, "creation_date": 1438211598, "post_id": 31711730, "comment_id": 51363253, "body": "Even constant time if you&#39;re daring enough to approximate :)"}, {"owner": {"reputation": 13014, "user_id": 5113, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a6ef9f7bfccd43bc5f22bfbc2eb41855?s=128&d=identicon&r=PG", "display_name": "Jason Dagit", "link": "https://stackoverflow.com/users/5113/jason-dagit"}, "edited": false, "score": 0, "creation_date": 1438213051, "post_id": 31711730, "comment_id": 51363609, "body": "Look at these references: * <a href=\"http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.90.2386\" rel=\"nofollow noreferrer\">citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.90.2386</a>  * <a href=\"http://www.lsv.ens-cachan.fr/Publis/PAPERS/PDF/sinot-wrs07.pdf\" rel=\"nofollow noreferrer\">lsv.ens-cachan.fr/Publis/PAPERS/PDF/sinot-wrs07.pdf</a>  Sometimes also known as &quot;complete laziness&quot;. call-by-need reduces recalculation but doesn&#39;t allow sharing under abstractions. Complete laziness requires substantially more bookkeeping but doesn&#39;t need to recompute anything."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1438224171, "post_id": 31711730, "comment_id": 51366196, "body": "@chi, fair enough - I&#39;ve tested and fib stays exponential. I posted the tests <a href=\"https://gist.github.com/SrVictorMaia/b735f9e06f8461585974\" rel=\"nofollow noreferrer\">as a gist</a>. No wizardry this time."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1438232150, "post_id": 31711730, "comment_id": 51368298, "body": "@Viclib, it&#39;s hardly surprising that <code>fib n</code> takes exponential time to compute when its value also grows exponentially. How about computing <code>fib n</code> modulo some small constant?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 5, "creation_date": 1438232514, "post_id": 31711730, "comment_id": 51368407, "body": "@TomEllis Why would something that only knows how to reduce arbitrary lambda calculus expressions have any idea that <code>(a * b) % n = ((a % n) * b) % n</code> though? That is the mysterious part surely."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1438234560, "post_id": 31711730, "comment_id": 51369103, "body": "@chi You <b>cannot</b> compute fibonacci numbers in less than linear time, since they have a linear number of bits. The matrix trick requires a logarithmic number of <i>multiplications</i>, but the total amount of bit operations is still <i>linear</i>. You can&#39;t simply ignore the size of the coefficients of the matrix, since they grow quite a lot. If you use that assumption, well you could simply assume a fixed integer size and compute all fibonacci numbers in constant time or build a lookup table."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1438237328, "post_id": 31711730, "comment_id": 51370266, "body": "@ReidBarton surely I tried it! Same results, though."}, {"owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1438237604, "post_id": 31711730, "comment_id": 51370395, "body": "@ReidBarton That&#39;s still a qusetion that needs answering, but I can imagine that an optimal evaluator could somehow end up performing a similar transformation, even if by accident.  For example, the modulo &quot;algorithm&quot; might well be recursive on multiplicative structure. On the other hand I <i>can&#39;t</i> imagine an optimal evaluator using Fermat&#39;s Little Theorem or Euler&#39;s theorem!"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 2, "creation_date": 1438275721, "post_id": 31711730, "comment_id": 51395326, "body": "@TomEllis and Chi, There is just a small remark, though. That all assumes that traditional recursive function is the &quot;naive&quot; fib implementation, but IMO there is an alternative way to express it that is much more natural. The normal form of that new representation has half of the size of the traditional one), and Optlam manages to compute that one linearly! So I&#39;d argue that is the &quot;naive&quot; definition of fib as far as \u03bb-calculus is concerned. I&#39;d make a blog post but I&#39;m not sure it is really worth it..."}], "tags": [], "owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "is_accepted": false, "score": 7, "last_activity_date": 1438206889, "last_edit_date": 1438206889, "creation_date": 1438206269, "answer_id": 31711730, "question_id": 31707614, "link": "https://stackoverflow.com/questions/31707614/why-are-%ce%bb-calculus-optimal-evaluators-able-to-compute-big-modular-exponentiation/31711730#31711730", "title": "Why are \u03bb-calculus optimal evaluators able to compute big modular exponentiations without formulas?", "body": "<p>This isn't an anwser but it's a suggestion of where you might start looking.</p>\n\n<p>There's a trivial way to calculate modular exponentiations in little space, specifically by rewriting</p>\n\n<pre><code>(a * x ^ y) % z\n</code></pre>\n\n<p>as</p>\n\n<pre><code>(((a * x) % z) * x ^ (y - 1)) % z\n</code></pre>\n\n<p>If an evaluator evaluates like this and keeps the accumulating parameter <code>a</code> in normal form then you will avoid using too much space.  If indeed your evaluator <em>is</em> optimal then presumably it must not do any more work than this one, so in particular can't use more space than the time this one takes to evaluate.</p>\n\n<p>I'm not really sure what an optimal evaluator really is so I'm afraid I can't make this more rigorous.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 35, "creation_date": 1438262988, "post_id": 31724886, "comment_id": 51386369, "body": "That&#39;s a most unusually thorough first post. Welcome to StackOverflow!"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 2, "creation_date": 1438300866, "post_id": 31724886, "comment_id": 51407131, "body": "Nothing less than insightful. Thank you, and welcome to the community!"}], "tags": [], "owner": {"reputation": 1266, "user_id": 5173417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbbd964c5982d18d0e14457b1cc68549?s=128&d=identicon&r=PG&f=1", "display_name": "Thibaut Balabonski", "link": "https://stackoverflow.com/users/5173417/thibaut-balabonski"}, "is_accepted": true, "score": 127, "last_activity_date": 1500745250, "last_edit_date": 1500745250, "creation_date": 1438262141, "answer_id": 31724886, "question_id": 31707614, "link": "https://stackoverflow.com/questions/31707614/why-are-%ce%bb-calculus-optimal-evaluators-able-to-compute-big-modular-exponentiation/31724886#31724886", "title": "Why are \u03bb-calculus optimal evaluators able to compute big modular exponentiations without formulas?", "body": "<p>The phenomenon comes from the amount of shared beta-reduction steps, which can be dramatically different in Haskell-style lazy evaluation (or usual call-by-value, which is not that far in this respect) and in Vuillemin-L\u00e9vy-Lamping-Kathail-Asperti-Guerrini-(et al\u2026) \"optimal\" evaluation. This is a general feature, that is completely independent from the arithmetic formulas you could use in this particular example.</p>\n\n<p>Sharing means having a representation of your lambda-term in which one \"node\" can describe several similar parts of the actual lambda-term you represent. For instance, you can represent the term </p>\n\n<pre><code>\\x. x ((\\y.y)a) ((\\y.y)a)\n</code></pre>\n\n<p>using a (directed acyclic) graph in which there is only one occurrence of the subgraph representing <code>(\\y.y)a</code>, and two edges targeting that subgraph. In Haskell terms, you have one thunk, that you evaluate only once, and two pointers to this thunk.</p>\n\n<p>Haskell-style memoization implements sharing of complete subterms. This level of sharing can be represented by directed acyclic graphs. Optimal sharing does not have this restriction: it can also share \"partial\" subterms, which may imply cycles in the graph representation.</p>\n\n<p>To see the difference between these two levels of sharing, consider the term</p>\n\n<pre><code>\\x. (\\z.z) ((\\z.z) x)\n</code></pre>\n\n<p>If your sharing is restricted to complete subterms as it is the case in Haskell, you may have only one occurrence of <code>\\z.z</code>, but the two beta-redexes here will be distinct: one is <code>(\\z.z) x</code> and the other one is <code>(\\z.z) ((\\z.z) x)</code>, and since they are not equal terms they cannot be shared.\nIf the sharing of partial subterms is allowed, then it becomes possible to share the partial term <code>(\\z.z) []</code> (that is not just the function <code>\\z.z</code>, but \"the function <code>\\z.z</code> applied to <em>something</em>), which evaluates in one step to just <em>something</em>, whatever this argument is. Hence you can have a graph in which only one node represents the two applications of <code>\\z.z</code> to two distinct arguments, and in which these two applications can be reduced in just one step. Remark that there is a cycle on this node, since the argument of the \"first occurrence\" is precisely the \"second occurrence\".\nFinally, with optimal sharing you can go from (a graph representing) <code>\\x. (\\z.z) ((\\z.z) x))</code> to (a graph representing) the result <code>\\x.x</code> in just one step of beta-reduction (plus some bookkeeping). This is basically what happens in your optimal evaluator (and the graph representation is also what prevents space explosion).</p>\n\n<p>For slightly extended explanations, you can look at the paper <a href=\"http://www.lri.fr/~blsk/Docs/Balabonski-WeakOptimality-ICFP13.pdf\" rel=\"noreferrer\">Weak Optimality, and the Meaning of Sharing</a> (what you are interested in is the introduction and the section 4.1, and maybe some of the bibliographic pointers at the end).</p>\n\n<p>Coming back at your example, the coding of arithmetic functions working on Church integers is one of the \"well-known\" mines of examples where optimal evaluators can perform better than mainstream languages (in this sentence, well-known actually means that a handful of specialists are aware of these examples).\nFor more such examples, take a look at the paper <a href=\"http://www.pps.univ-paris-diderot.fr/~jch/safebrackets.ps.gz\" rel=\"noreferrer\">Safe Operators: Brackets Closed Forever</a> by Asperti and Chroboczek (and by the way, you will find here interesting lambda-terms that are not EAL-typeable; so I\u2019m encouraging you to take a look at oracles, starting with this Asperti/Chroboczek paper).</p>\n\n<p>As you said yourself, this kind of encoding is utterly unpractical, but they still represent a nice way of understanding what is going on. And let me conclude with a challenge for further investigation: will you be able to find an example on which optimal evaluation on these supposedly bad encodings is actually on par with traditional evaluation on a reasonable data representation? (as far as I know this is a real open question).</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5424, "favorite_count": 48, "accepted_answer_id": 31724886, "answer_count": 2, "score": 138, "last_activity_date": 1500745250, "creation_date": 1438192079, "last_edit_date": 1438200372, "question_id": 31707614, "link": "https://stackoverflow.com/questions/31707614/why-are-%ce%bb-calculus-optimal-evaluators-able-to-compute-big-modular-exponentiation", "title": "Why are \u03bb-calculus optimal evaluators able to compute big modular exponentiations without formulas?", "body": "<p>Church numbers are an encoding of natural numbers as functions.</p>\n\n<pre><code>(\\ f x \u2192 (f x))             -- church number 1\n(\\ f x \u2192 (f (f (f x))))     -- church number 3\n(\\ f x \u2192 (f (f (f (f x))))) -- church number 4\n</code></pre>\n\n<p>Neatly, you can exponentiate 2 church numbers by just applying them. That is, if you apply 4 to 2, you get the church number <code>16</code>, or <code>2^4</code>. Obviously,  that is utterly unpractical. Church numbers need a linear amount of memory and are really, really slow. Computing something like <code>10^10</code> - which GHCI quickly answers correctly - would take ages and couldn't fit the memory on your computer anyway. </p>\n\n<p>I've been experimenting with optimal \u03bb evaluators lately. On my tests, I accidentally typed the following on my optimal \u03bb-calculator:</p>\n\n<pre><code>10 ^ 10 % 13\n</code></pre>\n\n<p>It was supposed to be multiplication, not exponentiation. Before I could move my fingers to abort the forever-running program in despair, it answered my request:</p>\n\n<pre><code>3\n{ iterations: 11523, applications: 5748, used_memory: 27729 }\n\nreal    0m0.104s\nuser    0m0.086s\nsys     0m0.019s\n</code></pre>\n\n<p>With my \"bug alert\" flashing, I went to Google and verified, <code>10^10%13 == 3</code> indeed. <strong>But the \u03bb-calculator wasn't supposed to find that result, it can barely store 10^10.</strong> I started stressing it, for science. It instantly answered me <code>20^20%13 == 3</code>, <code>50^50%13 == 4</code>, <code>60^60%3 == 0</code>. I had to use <a href=\"https://www.mtholyoke.edu/courses/quenell/s2003/ma139/js/powermod.html\" rel=\"noreferrer\">external tools</a> to verify those results, since <s>Haskell itself wasn't able to compute it (due to integer overflow)</s> (it is if you use Integers not Ints, of course!). Pushing it to its limits, this was the answer to <code>200^200%31</code>:</p>\n\n<pre><code>5\n{ iterations: 10351327, applications: 5175644, used_memory: 23754870 }\n\nreal    0m4.025s\nuser    0m3.686s\nsys 0m0.341s\n</code></pre>\n\n<p>If we had one copy of the universe for each atom on the universe, and we had a computer for each atom we had in total, we couldn't store the church number <code>200^200</code>. This prompted me to question if my mac was really that powerful. Maybe the optimal evaluator was able to skip the unnecessary branches and arrive right at the answer in the same fashion Haskell does with lazy evaluation. To test this, I compiled the \u03bb program to Haskell:</p>\n\n<pre><code>data Term = F !(Term -&gt; Term) | N !Double\ninstance Show Term where {\n    show (N x) = \"(N \"++(if fromIntegral (floor x) == x then show (floor x) else show x)++\")\";\n    show (F _) = \"(\u03bb...)\"}\ninfixl 0 #\n(F f) # x = f x\nchurchNum = F(\\(N n)-&gt;F(\\f-&gt;F(\\x-&gt;if n&lt;=0 then x else (f#(churchNum#(N(n-1))#f#x)))))\nexpMod    = (F(\\v0-&gt;(F(\\v1-&gt;(F(\\v2-&gt;((((((churchNum # v2) # (F(\\v3-&gt;(F(\\v4-&gt;(v3 # (F(\\v5-&gt;((v4 # (F(\\v6-&gt;(F(\\v7-&gt;(v6 # ((v5 # v6) # v7))))))) # v5))))))))) # (F(\\v3-&gt;(v3 # (F(\\v4-&gt;(F(\\v5-&gt;v5)))))))) # (F(\\v3-&gt;((((churchNum # v1) # (churchNum # v0)) # ((((churchNum # v2) # (F(\\v4-&gt;(F(\\v5-&gt;(F(\\v6-&gt;(v4 # (F(\\v7-&gt;((v5 # v7) # v6))))))))))) # (F(\\v4-&gt;v4))) # (F(\\v4-&gt;(F(\\v5-&gt;(v5 # v4))))))) # ((((churchNum # v2) # (F(\\v4-&gt;(F(\\v5-&gt;v4))))) # (F(\\v4-&gt;v4))) # (F(\\v4-&gt;v4))))))) # (F(\\v3-&gt;(((F(\\(N x)-&gt;F(\\(N y)-&gt;N(x+y)))) # v3) # (N 1))))) # (N 0))))))))\nmain = print $ (expMod # N 5 # N 5 # N 4)\n</code></pre>\n\n<p>This correctly outputs <code>1</code> (<code>5 ^ 5 % 4</code>) - but throw anything above <code>10^10</code> and it will be stuck, eliminating the hypothesis. </p>\n\n<p>The <a href=\"https://github.com/SrVictorMaia/optlam\" rel=\"noreferrer\">optimal evaluator I used</a> is a 160-lines long, unoptimized JavaScript program that didn't include any sort of exponential modulus math - and the lambda-calculus modulus function I used was equally simple:</p>\n\n<pre><code>(\u03bbab.(b(\u03bbcd.(c(\u03bbe.(d(\u03bbfg.(f(efg)))e))))(\u03bbc.(c(\u03bbde.e)))(\u03bbc.(a(b(\u03bbdef.(d(\u03bbg.(egf))))(\u03bbd.d)(\u03bbde.(ed)))(b(\u03bbde.d)(\u03bbd.d)(\u03bbd.d))))))\n</code></pre>\n\n<p>I used no specific modular arithmetic algorithm or formula. <strong>So, how is the optimal evaluator able to arrive at the right answers?</strong></p>\n"}, {"tags": ["haskell", "quickcheck", "frege"], "answers": [{"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1438187545, "post_id": 31705361, "comment_id": 51350720, "body": "Consider <code>choose (0,100)</code> instead of <code>elements [0..100]</code>. While <code>elements</code> is great if your range isn&#39;t continuous or if your type doesn&#39;t have a <code>Random</code> instance, <code>choose</code> is usually more efficient if your values are in a closed range."}], "tags": [], "owner": {"reputation": 472, "user_id": 4775652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/825c3e92706311cc7fa61d0f5b96f9d8?s=128&d=identicon&r=PG&f=1", "display_name": "lodrik", "link": "https://stackoverflow.com/users/4775652/lodrik"}, "is_accepted": true, "score": 9, "last_activity_date": 1438191656, "last_edit_date": 1438191656, "creation_date": 1438185185, "answer_id": 31705361, "question_id": 31703966, "link": "https://stackoverflow.com/questions/31703966/quickcheck-how-to-combine-two-generators/31705361#31705361", "title": "QuickCheck: How to combine two generators?", "body": "<p><strong>(i)</strong> You can use normal functorial/monadic composition to combine them:</p>\n\n<pre><code>gen_comb :: Gen (Int, [Int])\ngen_comb = (,) &lt;$&gt; gen_elem &lt;*&gt; gen_arr\n</code></pre>\n\n<p>(<code>Control.Applicative.liftA2</code> and <code>Control.Monad.liftM2</code> are also fine, of course)</p>\n\n<p><strong>(ii)</strong> don't use <code>suchThat</code> to merely constrain a range. It can be terribly inefficient, as it just generates random instances until the condition is met, discarding the rest. Instead, you could use <code>elements :: [a] -&gt; Gen a</code>:</p>\n\n<pre><code>gen_elem' :: Gen Int\ngen_elem' = elements [0..100]\n\ngen_arr' :: Gen [Int]\ngen_arr' = listOf gen_elem'\n\ngen_comb' :: Gen (Int, [Int])\ngen_comb' = (,) &lt;$&gt; elements [0..100] &lt;*&gt; listOf (elements [0..100])\n</code></pre>\n\n<p><strong>Update:</strong> As Zeta remarked below, we can do even better in this case, by using <code>choose (0,100)</code> (<code>choose :: Random a =&gt; (a, a) -&gt; Gen a</code>) instead of <code>elements [0..100]</code>. See <a href=\"https://hackage.haskell.org/package/QuickCheck-2.1.0.1/docs/Test-QuickCheck.html#3\" rel=\"noreferrer\">here</a>, or <a href=\"https://hackage.haskell.org/package/QuickCheck-2.1.0.1/docs/Test-QuickCheck-Gen.html\" rel=\"noreferrer\">here</a> for the full list of generator combinators.</p>\n\n<hr>\n\n<pre><code>*Main&gt; sample gen_arr'\n[78]\n[2,27]\n[12,39]\n[92,22,40,6,18,19,25,13,95,99]\n...\n*Main&gt; sample gen_comb'\n(9,[23,3])\n(11,[67,38,11,79])\n(5,[96,69,68,81,75,14,59,68])\n...\n</code></pre>\n\n<p><code>suchThat</code> vs. <code>elements</code>:</p>\n\n<pre><code>*Main&gt; sample (suchThat arbitrary (\\i -&gt; i &gt;= 10000 &amp;&amp; i &lt;= 10005))\n^CInterrupted.\n*Main&gt; sample (elements [10000..10005])\n10003\n10002\n10000\n10000\n...\n</code></pre>\n\n<p>The <code>suchThat</code> generator didn't output anything.</p>\n"}], "owner": {"reputation": 14545, "user_id": 42188, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/0b0abbefc6a9375882ea3cc0c6da61c8?s=128&d=identicon&r=PG", "display_name": "muhuk", "link": "https://stackoverflow.com/users/42188/muhuk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 607, "favorite_count": 0, "accepted_answer_id": 31705361, "answer_count": 1, "score": 6, "last_activity_date": 1438191656, "creation_date": 1438181485, "last_edit_date": 1438182375, "question_id": 31703966, "link": "https://stackoverflow.com/questions/31703966/quickcheck-how-to-combine-two-generators", "title": "QuickCheck: How to combine two generators?", "body": "<p>I have two generators, <code>gen_n</code> &amp; <code>gen_arr</code>:</p>\n\n<pre><code>gen_n :: Gen Int\ngen_n = suchThat arbitrary (\\i -&gt; i &gt;= 0 &amp;&amp; i &lt;= 10)\n\ngen_elem :: Gen Int\ngen_elem = suchThat arbitrary (\\i -&gt; i &gt;= 0 &amp;&amp; i &lt;= 100)\n\ngen_arr :: Gen [Int]\ngen_arr = listOf gen_elem \n</code></pre>\n\n<p>How can I combine these two into a <code>Gen (Int, [Int])</code>?</p>\n\n<pre><code>combine_two_gens :: Gen a -&gt; Gen b -&gt; Gen (a, b)\n</code></pre>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 8, "creation_date": 1438178784, "post_id": 31702663, "comment_id": 51344258, "body": "The most common (library independent) way to do this is to simply have a tokenizing step before the actual parsing, and have that discard all whitespace and comments."}], "answers": [{"comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1438202466, "post_id": 31702919, "comment_id": 51359409, "body": "Is there any example of how to use the token ?"}], "tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": false, "score": 7, "last_activity_date": 1438206796, "last_edit_date": 1438206796, "creation_date": 1438178914, "answer_id": 31702919, "question_id": 31702663, "link": "https://stackoverflow.com/questions/31702663/parsec-is-there-an-easy-way-to-allow-comments-whitespace-everywhere-in-the-gram/31702919#31702919", "title": "parsec: is there an easy way to allow comments/whitespace everywhere in the grammar?", "body": "<p>You should use parsec\u2019s abilities to define a \u201ctoken parser\u201d. The idea is that you define the characteristics of your language in a <code>LanguageDef</code>, and then use the derived parsers in the resulting <code>TokenParser</code>, e.g. <code>identifier</code>, <code>integer</code> etc. You can take the <code>lexeme</code> function from your <code>TokenParser</code> to turn any parser that you might have into one that swallows all trailing whitespace.</p>\n\n<p>See <a href=\"http://hackage.haskell.org/package/parsec-3.1.9/docs/Text-Parsec-Token.html#v:makeTokenParser\" rel=\"nofollow\">makeTokenParser</a> for more details.</p>\n\n<p>An example is <a href=\"https://bitbucket.org/nomeata/arbtt/src/d20c98bbb54b27e681bee358cc8e9eda34dcf576/src/Categorize.hs?at=master#Categorize.hs-109\" rel=\"nofollow\">this code</a> that I wrote. It\u2019s real-world-code, so maybe not as educating as a good tutorial, but you can see how I define <code>lang = makeTokenParser...</code> and then in the following parsers use parsers like <code>whiteSpace lang</code>, <code>parens lang</code>. <code>parseTime</code> is an example where I use <code>lexeme</code> around a \u201cnormal\u201d parser.</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 8, "last_activity_date": 1438179997, "creation_date": 1438179997, "answer_id": 31703379, "question_id": 31702663, "link": "https://stackoverflow.com/questions/31702663/parsec-is-there-an-easy-way-to-allow-comments-whitespace-everywhere-in-the-gram/31703379#31703379", "title": "parsec: is there an easy way to allow comments/whitespace everywhere in the grammar?", "body": "<p>The way that it is done in <code>Text.Parsec.Token</code> is to have every token consume the whitespace and comments which follow it.</p>\n\n<p>This is done through the help of the <code>lexeme</code> combinator:</p>\n\n<pre><code>lexeme p = do { x &lt;- p; whitespace; return x }\n</code></pre>\n\n<p>which runs a parser <code>p</code>, consumes the white space following it and returns whatever <code>p</code> returned.</p>\n\n<p>When you look at the source of <code>makeTokenParser</code> <a href=\"https://github.com/aslatter/parsec/blob/master/Text/Parsec/Token.hs#L346\" rel=\"noreferrer\">(link)</a> you'll see that many of the token parsers are wrapped using the <code>lexeme</code> combinator, e.g.:</p>\n\n<pre><code>symbol name\n    = lexeme (string name)\n</code></pre>\n\n<p>Using this approach, the comments for <code>lexeme</code> <a href=\"https://github.com/aslatter/parsec/blob/master/Text/Parsec/Token.hs#L215\" rel=\"noreferrer\">(link)</a> point out that the only time your parser needs to explicitly consume white space is at the beginning of the input to skip over any white space before the first token.</p>\n"}], "owner": {"reputation": 26022, "user_id": 410102, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/a70b7da5a3a712e800100e61ef8d8917?s=128&d=identicon&r=PG", "display_name": "akonsu", "link": "https://stackoverflow.com/users/410102/akonsu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 454, "favorite_count": 2, "accepted_answer_id": 31703379, "answer_count": 2, "score": 9, "last_activity_date": 1438206796, "creation_date": 1438178320, "question_id": 31702663, "link": "https://stackoverflow.com/questions/31702663/parsec-is-there-an-easy-way-to-allow-comments-whitespace-everywhere-in-the-gram", "title": "parsec: is there an easy way to allow comments/whitespace everywhere in the grammar?", "body": "<p>How do you deal with whitespace and comments? The fragments that are usually removed during syntactic analysis stage? I want to enable comments everywhere in my document that I am parsing. Is adding these in every elementary parser that I define the only option?</p>\n"}, {"tags": ["haskell", "constructor", "value-constructor"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 3, "creation_date": 1438180516, "post_id": 31702318, "comment_id": 51345651, "body": "IMHO (2) and (3) are very idiomatic."}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1438191304, "post_id": 31706438, "comment_id": 51352993, "body": "You have succinctly nailed question (1), which the other answers (mine included) do not cover."}], "tags": [], "owner": {"reputation": 188, "user_id": 1690291, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QU6tb.jpg?s=128&g=1", "display_name": "Clay Thomas", "link": "https://stackoverflow.com/users/1690291/clay-thomas"}, "is_accepted": false, "score": 2, "last_activity_date": 1438188322, "creation_date": 1438188322, "answer_id": 31706438, "question_id": 31702318, "link": "https://stackoverflow.com/questions/31702318/data-type-with-a-default-field-and-that-needs-a-function-that-works-with-it/31706438#31706438", "title": "data type with a default field and that needs a function that works with it", "body": "<p>I'll address your questions one by one.</p>\n\n<ol>\n<li><p>Default arguments do not exist in Haskell. They are simply not worth the added complexity and loss of compositionally. Being a functional language, you do a lot more function manipulation in Haskell, so funkiness like default arguments would be tough to handle. </p></li>\n<li><p>One thing I didn't realize when I started Haskell is that data constructors are functions just like everything else. In your example, </p>\n\n<pre><code>Foo :: String -&gt; Char -&gt; [a] -&gt; FooBar a\n</code></pre>\n\n<p>Thus you can write functions for filling in various arguments of other functions, and then those functions will work with Foo or Bar or whatever.</p>\n\n<pre><code>fill1 :: a -&gt; (a -&gt; b) -&gt; b\nfill1 a f = f a\n--Note that fill1 = flip ($)\n\nfill2 :: b -&gt; (a -&gt; b -&gt; c) -&gt; (a -&gt; c)\n--Equivalently, fill2 :: b -&gt; (a -&gt; b -&gt; c) -&gt; a -&gt; c\nfill2 b f = \\a -&gt; f a b\n\nfill3 :: c -&gt; (a -&gt; b -&gt; c -&gt; d) -&gt; (a -&gt; b -&gt; d)\nfill3 c f = \\a b -&gt; f a b c\n\nfill3Empty :: (a -&gt; b -&gt; [c] -&gt; d) -&gt; (a -&gt; b -&gt; d)\nfill3Empty f = fill3 [] f\n\n--Now, we can write \n&gt; fill3Empty Foo x y \n    Foo x y []\n</code></pre></li>\n<li><p>The <a href=\"https://hackage.haskell.org/package/lens\" rel=\"nofollow\">lens</a> package provides elegant solutions to questions like this. However, you can tell at a glance that this package is enormously complicated. Here is the net result of how you would call the lens package:</p>\n\n<pre><code>_list :: Lens (FooBar a) (FooBar b) [a] [b]\n_list = lens getter setter\n  where getter (Foo _ _ as) = as\n        getter (Bar _ _ as) = as\n        setter (Foo s c _) bs = Foo s c bs\n        setter (Bar s i _) bs = Bar s i bs\n</code></pre>\n\n<p>Now we can do </p>\n\n<pre><code>&gt; over _list (3:) (Foo \"ab\" 'c' [2,1]) \n    Foo \"ab\" 'c' [3,2,1]\n</code></pre>\n\n<p>Some explanation: the <code>lens</code> function produces a <code>Lens</code> type when given a getter and a setter for some type. <code>Lens s t a b</code> is a type that says \"<code>s</code> holds an <code>a</code> and <code>t</code> holds a <code>b</code>. Thus, if you give me a function <code>a -&gt; b</code>, I can give you a function <code>s -&gt; t</code>\". That is exactly what <code>over</code> does: you provide it a lens and a function (in our case, <code>(3:)</code> was a function that adds 3 to the front of a List) and it applies the function \"where the lens indicates\". This is very similar to a functor, however, we have significantly more freedom (in this example, the functor instance would be obligated to change every element of the lists, not operate on the lists themselves).</p>\n\n<p>Note that our new _list lens is very generic: it works equally well over <code>Foo</code> and <code>Bar</code> and the lens package provides many functions other than <code>over</code> for doing magical things.</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 2, "last_activity_date": 1438189176, "last_edit_date": 1438189176, "creation_date": 1438188869, "answer_id": 31706625, "question_id": 31702318, "link": "https://stackoverflow.com/questions/31702318/data-type-with-a-default-field-and-that-needs-a-function-that-works-with-it/31706625#31706625", "title": "data type with a default field and that needs a function that works with it", "body": "<p>The idiomatic thing is to take those parameters of a function or constructor that you commonly want to partially apply, and move them toward the beginning:</p>\n\n<pre><code>data FooBar a = Foo [a] String Char\n              | Bar [a] String Int\n\nfoo :: String -&gt; Char -&gt; FooBar a\nfoo = Foo []\n\nbar :: String -&gt; Int -&gt; FooBar a\nbar = Bar []\n</code></pre>\n\n<p>Similarly, reordering the parameters to <code>add</code> lets you partially apply <code>add</code> to get functions of type <code>FooBar a -&gt; FooBar a</code>, which can be easily composed:</p>\n\n<pre><code>add :: a -&gt; FooBar a -&gt; FooBar a\nadd x (Foo xs u v) = Foo (x:xs) u v\n\nadd123 :: FooBar Int -&gt; FooBar Int\nadd123 = add 1 . add 2 . add 3\n\nadd123 (foo \"bar\" 42) == Foo [1, 2, 3] \"bar\" 42\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 1, "last_activity_date": 1438190621, "last_edit_date": 1438190621, "creation_date": 1438190108, "answer_id": 31707021, "question_id": 31702318, "link": "https://stackoverflow.com/questions/31702318/data-type-with-a-default-field-and-that-needs-a-function-that-works-with-it/31707021#31707021", "title": "data type with a default field and that needs a function that works with it", "body": "<p>(2) and (3) are perfectly normal and idiomatic ways of doing such things. About (2) in particular, one expression you will occasionally hear is \"smart constructor\". That just means a function like your <code>mkFoo</code>/<code>mkBar</code> that produces a <code>FooBar a</code> (or a <code>Maybe (FooBar a)</code> etc.) with some extra logic to ensure only reasonable values can be constructed.</p>\n\n<p>Here are some additional tricks that might (or might not!) make sense, depending on what you are trying to do with <code>FooBar</code>.</p>\n\n<p>If you use <code>Foo</code> values and <code>Bar</code>values in similar ways most of the time (i.e. the difference between having the <code>Char</code> field and the <code>Int</code> one is a minor detail), it makes sense to factor out the similarities and use a single constructor:</p>\n\n<pre><code>data FooBar a = FooBar String FooBarTag [a]\ndata FooBarTag = Foo Char | Bar Int\n</code></pre>\n\n<p>Beyond avoiding case analysis when you don't care about the <code>FooBarTag</code>, that allows you to safely use record syntax (records and types with multiple constructors do not mix well).</p>\n\n<pre><code>data FooBar a = FooBar\n    { fooBarName :: String\n    , fooBarTag :: FooBarTag\n    , fooBarList :: [a]\n    }\n</code></pre>\n\n<p>Records allow you to use the fields without having to pattern match the whole thing.</p>\n\n<p>If there are sensible defaults for <em>all</em> fields in a <code>FooBar</code>, you can go one step beyond <code>mkFoo</code>-like constructors and define a default value.</p>\n\n<pre><code>defaultFooBar :: FooBar a\ndefaultFooBar = FooBar\n    { fooBarName = \"\"\n    , fooBarTag = Bar 0\n    , fooBarList = []\n    }\n</code></pre>\n\n<p>You don't need records to use a default, but they allow overriding default fields conveniently.</p>\n\n<pre><code>myFooBar = defaultFooBar\n    { fooBarTag = Foo 'x'\n    }\n</code></pre>\n\n<p>If you ever get tired of typing long names for the defaults over and over, consider the <a href=\"https://hackage.haskell.org/package/data-default\" rel=\"nofollow\"><code>data-default</code></a> package:</p>\n\n<pre><code>instance Default (FooBar a) where\n    def = defaultFooBar\n\nmyFooBar = def { fooBarTag = Foo 'x' }\n</code></pre>\n\n<p>Do note that a significant number of people <a href=\"http://phaazon.blogspot.fr/2015/07/dont-use-default.html\" rel=\"nofollow\">do not like the <code>Default</code> class</a>, and not without reason. Still, for types which are very specific to your application (e.g. configuration settings) <code>Default</code> is perfectly fine IMO.</p>\n\n<p>Finally, updating record fields can be messy. If you end up annoyed by that, you will find <a href=\"https://hackage.haskell.org/package/lens\" rel=\"nofollow\"><code>lens</code></a> very useful. Note that it is a <em>big</em> library, and it might be a little overwhelming to a beginner, so take a deep breath beforehand. Here is a small sample:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-} -- At the top of the file. Needed for makeLenses.\nimport Control.Lens\n\n-- Note the underscores.\n-- If you are going to use lenses, it is sensible not to export the field names.\ndata FooBar a = FooBar\n    { _fooBarName :: String\n    , _fooBarTag :: FooBarTag\n    , _fooBarList :: [a]\n    }\nmakeLenses ''FooBar -- Defines lenses for the fields automatically. \n\ndefaultFooBar :: FooBar a\ndefaultFooBar = FooBar\n    { _fooBarName = \"\"\n    , _fooBarTag = Bar 0\n    , _fooBarList = []\n    }\n\n-- Using a lens (fooBarTag) to set a field without record syntax.\n-- Note the lack of underscores in the name of the lens.\nmyFooBar = set fooBarTag (Foo 'x') defaultFooBar\n\n-- Using a lens to access a field.\nmyTag = view fooBarTag myFooBar -- Results in Foo 'x'\n\n-- Using a lens (fooBarList) to modify a field.\nadd :: a -&gt; FooBar a -&gt; FooBar a\nadd x fb = over fooBarList (x :) fb\n\n-- set, view and over have operator equivalents, (.~). (^.) and (%~) respectively.\n-- Note that (^.) is flipped with respect to view.\n</code></pre>\n\n<p>Here is a <a href=\"http://www.haskellforall.com/2013/05/program-imperatively-using-haskell.html\" rel=\"nofollow\">gentle introduction</a> to <code>lens</code> which focuses on aspects I have not demonstrated here, specially in how nicely lenses can be composed.  </p>\n"}], "owner": {"reputation": 26022, "user_id": 410102, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/a70b7da5a3a712e800100e61ef8d8917?s=128&d=identicon&r=PG", "display_name": "akonsu", "link": "https://stackoverflow.com/users/410102/akonsu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 31707021, "answer_count": 3, "score": 3, "last_activity_date": 1438191965, "creation_date": 1438177574, "last_edit_date": 1438191965, "question_id": 31702318, "link": "https://stackoverflow.com/questions/31702318/data-type-with-a-default-field-and-that-needs-a-function-that-works-with-it", "title": "data type with a default field and that needs a function that works with it", "body": "<p>Say, I have a data type</p>\n\n<pre><code>data FooBar a = Foo String Char [a]\n              | Bar String Int [a]\n</code></pre>\n\n<p>I need to create values of this type and give empty list as the second field:</p>\n\n<pre><code>Foo \"hello\" 'a' []\n</code></pre>\n\n<p>or</p>\n\n<pre><code>Bar \"world\" 1 []\n</code></pre>\n\n<p>1) I do this everywhere in my code and I think it would be nice if I could omit the empty list part somehow and have the empty list assigned implicitly. Is this possible? Something similar to default function arguments in other languages.</p>\n\n<p>2) Because of this <code>[]</code> \"default\" value, I often need to have a partial constructor application that results in a function that takes the first two values:</p>\n\n<pre><code>mkFoo x y = Foo x y []\nmkBar x y = Bar x y []\n</code></pre>\n\n<p>Is there a \"better\" (more idiomatic, etc) way to do it? to avoid defining new functions?</p>\n\n<p>3) I need a way to add things to the list:</p>\n\n<pre><code>add (Foo u v xs) x = Foo u v (x:xs)\nadd (Bar u v xs) x = Bar u v (x:xs)\n</code></pre>\n\n<p>Is this how it is done idiomatically? Just a general purpose function?</p>\n\n<p>As you see I am a beginner, so maybe these questions make little sense. Hope not.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 14, "last_activity_date": 1438184580, "last_edit_date": 1438184580, "creation_date": 1438177713, "answer_id": 31702383, "question_id": 31702289, "link": "https://stackoverflow.com/questions/31702289/who-can-explain-this-haskell-function/31702383#31702383", "title": "Who can explain this Haskell function?", "body": "<p>OK, so we have</p>\n\n<pre><code>foo = zipWith ($) . repeat\n</code></pre>\n\n<p>which is the same as</p>\n\n<pre><code>foo f = zipWith ($) (repeat f)\n</code></pre>\n\n<p>The <code>repeat f</code> generates an infinite list of copies of <code>f</code>. Then <code>zipWith</code> uses the <code>($)</code> operator to apply each element of the [infinite copies of <code>f</code>] list to each element of the incoming list. Which is what <code>map</code> does.</p>\n\n<p>Yes?</p>\n"}], "owner": {"reputation": 83, "user_id": 5169620, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d053beef93bc5a19cfc2317137cdc28?s=128&d=identicon&r=PG&f=1", "display_name": "s o", "link": "https://stackoverflow.com/users/5169620/s-o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 1, "accepted_answer_id": 31702383, "answer_count": 1, "score": 8, "last_activity_date": 1438184580, "creation_date": 1438177506, "question_id": 31702289, "link": "https://stackoverflow.com/questions/31702289/who-can-explain-this-haskell-function", "title": "Who can explain this Haskell function?", "body": "<p>The Haskell function </p>\n\n<pre><code>foo = zipWith ($) . repeat\n</code></pre>\n\n<p>does exactly the same as</p>\n\n<pre><code>map\n</code></pre>\n\n<p>but I cannot see why :-(\nWho can give an explanation?\nThx a lot!</p>\n"}, {"tags": ["haskell", "quickcheck"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1438184385, "post_id": 31701863, "comment_id": 51348660, "body": "Perhaps the comments in the source will be of some help: <a href=\"https://github.com/nick8325/quickcheck/blob/master/Test/QuickCheck/Monadic.hs#L118-126\" rel=\"nofollow noreferrer\">(link)</a>. Interesting that the comment for <code>assert</code> has the paper&#39;s sig, and also <code>stop</code> basically has the same sig."}], "answers": [{"comments": [{"owner": {"reputation": 4773, "user_id": 4148211, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/DiKJf.jpg?s=128&g=1", "display_name": "frasertweedale", "link": "https://stackoverflow.com/users/4148211/frasertweedale"}, "edited": false, "score": 0, "creation_date": 1439900959, "post_id": 31974478, "comment_id": 52041327, "body": "But what is the reason that the <code>quickCheck*</code> functions &quot;are very IO-centric&quot;, if it leads to giving up some of the generality in the library as proposed by the paper."}, {"owner": {"reputation": 4685, "user_id": 5180989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gxpck.jpg?s=128&g=1", "display_name": "Helder Pereira", "link": "https://stackoverflow.com/users/5180989/helder-pereira"}, "reply_to_user": {"reputation": 4773, "user_id": 4148211, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/DiKJf.jpg?s=128&g=1", "display_name": "frasertweedale", "link": "https://stackoverflow.com/users/4148211/frasertweedale"}, "edited": false, "score": 0, "creation_date": 1439905200, "post_id": 31974478, "comment_id": 52044475, "body": "@frasertweedale The problem is that QuickCheck tests <code>Testable</code> properties by randomly generating possible inputs (by default 100), trying to find a <a href=\"https://en.wikipedia.org/wiki/Counterexample\" rel=\"nofollow noreferrer\">counterexample</a> which proves the property false. If such input is not found, the property is assumed true (although that is not necessarily the truth; there may be a counterexample that was not tested). And to be able to generate random inputs in Haskell, we are stuck to the <code>IO</code> monad. Note also that even if <code>assert</code> was defined in such generic way, it is used through all the paper only with <code>Bool</code>."}, {"owner": {"reputation": 4773, "user_id": 4148211, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/DiKJf.jpg?s=128&g=1", "display_name": "frasertweedale", "link": "https://stackoverflow.com/users/4148211/frasertweedale"}, "edited": false, "score": 0, "creation_date": 1439909055, "post_id": 31974478, "comment_id": 52047560, "body": "Ok, is is starting to become a bit clearer.. the above points would be good to include in your answer."}], "tags": [], "owner": {"reputation": 4685, "user_id": 5180989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gxpck.jpg?s=128&g=1", "display_name": "Helder Pereira", "link": "https://stackoverflow.com/users/5180989/helder-pereira"}, "is_accepted": true, "score": 4, "last_activity_date": 1439980087, "last_edit_date": 1439980087, "creation_date": 1439410242, "answer_id": 31974478, "question_id": 31701863, "link": "https://stackoverflow.com/questions/31701863/test-quickcheck-monadic-why-is-assert-applied-to-bool-not-testable-a-a/31974478#31974478", "title": "Test.QuickCheck.Monadic: why is assert applied to Bool, not Testable a =&gt; a", "body": "<p>I think it was due to technical constraints, because currently to evaluate a <code>Testable</code> with the <code>Test.QuickCheck</code> library, you need to use one of the <a href=\"https://hackage.haskell.org/package/QuickCheck-2.8/docs/Test-QuickCheck.html#v:quickCheckWith\" rel=\"nofollow\"><code>quickCheck*</code></a> functions, which are very <code>IO</code>-centric. That happens because QuickCheck tests <code>Testable</code> properties by randomly generating possible inputs (by default 100), trying to find a <a href=\"https://en.wikipedia.org/wiki/Counterexample\" rel=\"nofollow\">counterexample</a> which proves the property false. If such input is not found, the property is assumed to be true (although that is not necessarily the truth; there may be a counterexample that was not tested). And to be able to generate random inputs in Haskell, we are stuck to the <code>IO</code> monad.</p>\n\n<p>Notice that even though <code>assert</code> was defined in such a generic way, it is used through all the paper only with <code>Bool</code>. So the library author (the same of the paper) preferred to sacrifice the generic <code>Testable</code> parameter for a simple <code>Bool</code>, to not force any monad at this point.</p>\n\n<p>And we can see that they have even written the original signature as a comment in the <a href=\"http://hackage.haskell.org/package/QuickCheck-2.8.1/docs/src/Test-QuickCheck-Monadic.html#line-122\" rel=\"nofollow\">source code</a>:</p>\n\n<pre><code>-- assert :: Testable prop =&gt; prop -&gt; PropertyM m ()\n</code></pre>\n\n<p>Also note that despite the fact that <code>stop</code> function has a similar signature:</p>\n\n<pre><code>stop :: (Testable prop, Monad m) =&gt; prop -&gt; PropertyM m a\n</code></pre>\n\n<p>It is <strong>not</strong> the same as the <code>assert</code> function in the paper, as the former will <strong>stop</strong> the computation in both cases either the condition is <code>True</code> or <code>False</code>. On the other hand, <code>assert</code> will only stop the computation if the condition is <code>False</code>:</p>\n\n<blockquote>\n  <p>\u27e6 assert True \u226b p \u27e7 = \u27e6 p \u27e7</p>\n  \n  <p>\u27e6 assert False \u226b p \u27e7 = { return False }</p>\n</blockquote>\n\n<p>We can though easily write a <code>IO</code> version of the <code>assert</code> function from the paper:</p>\n\n<pre><code>import Control.Monad\nimport Control.Monad.Trans\nimport Test.QuickCheck\nimport Test.QuickCheck.Monadic\nimport Test.QuickCheck.Property\nimport Test.QuickCheck.Test\n\nassertIO :: Testable prop =&gt; prop -&gt; PropertyM IO ()\nassertIO p = do r &lt;- liftIO $ quickCheckWithResult stdArgs{chatty = False} p\n                unless (isSuccess r) $ fail \"Assertion failed\"\n</code></pre>\n\n<p>And now we can make a test to see the differences between <code>assertIO</code> and <code>stop</code>:</p>\n\n<pre><code>prop_assert :: Property\nprop_assert = monadicIO $ do assertIO succeeded\n                             assertIO failed\n\nprop_stop :: Property\nprop_stop = monadicIO $ do stop succeeded\n                           stop failed\n\nmain :: IO ()\nmain = do putStrLn \"prop_assert:\"\n          quickCheck prop_assert\n          putStrLn \"prop_stop:\"\n          quickCheck prop_stop\n</code></pre>\n\n<p>The <code>succeeded</code> and <code>failed</code> could be replaced by <code>True</code> and <code>False</code>, respectively. It was just to show that now we are not limited to <code>Bool</code>, instead we can use any <code>Testable</code>.</p>\n\n<p>And the output is:</p>\n\n<blockquote>\n  <p>prop_assert:<br>\n  *** Failed! Assertion failed (after 1 test):<br>\n  prop_stop:<br>\n  +++ OK, passed 100 tests.</p>\n</blockquote>\n\n<p>As we can see, despite the fact that the first <code>assertIO</code> succeeded, <code>prop_assert</code> failed due to the second <code>assertIO</code>. On the other hand, <code>prop_stop</code> passed the test, because the first <code>stop</code> succeeded and the computation has stopped at that point, not testing the second <code>stop</code>.</p>\n"}], "owner": {"reputation": 4773, "user_id": 4148211, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/DiKJf.jpg?s=128&g=1", "display_name": "frasertweedale", "link": "https://stackoverflow.com/users/4148211/frasertweedale"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 430, "favorite_count": 1, "accepted_answer_id": 31974478, "answer_count": 1, "score": 19, "last_activity_date": 1439980087, "creation_date": 1438176547, "last_edit_date": 1438623561, "question_id": 31701863, "link": "https://stackoverflow.com/questions/31701863/test-quickcheck-monadic-why-is-assert-applied-to-bool-not-testable-a-a", "title": "Test.QuickCheck.Monadic: why is assert applied to Bool, not Testable a =&gt; a", "body": "<p>In <a href=\"http://dl.acm.org/citation.cfm?id=636527\"><em>Testing Monadic Code with QuickCheck</em> (Claessen, Hughes 2002)</a>, <code>assert</code> has the type:</p>\n\n<pre><code>assert :: (Monad m, Testable a) =&gt; a -&gt; PropertyM m ()\n</code></pre>\n\n<p>However, in <a href=\"https://hackage.haskell.org/package/QuickCheck-2.1.0.2/docs/Test-QuickCheck-Monadic.html#v:assert\"><strong><code>Test.QuickCheck.Monadic</code></strong></a>, it has the type:</p>\n\n<pre><code>assert :: (Monad m) =&gt; Bool -&gt; PropertyM m ()\n</code></pre>\n\n<p>Why does <code>assert</code> have the latter type in the library?</p>\n"}, {"tags": ["haskell", "f#", "stack", "rpn"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1438176355, "post_id": 31701594, "comment_id": 51342319, "body": "Read <a href=\"http://learnyouahaskell.com/functionally-solving-problems\" rel=\"nofollow noreferrer\">learnyouahaskell.com/functionally-solving-problems</a>"}], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 5127763, "user_type": "registered", "profile_image": "https://graph.facebook.com/808600889235341/picture?type=large", "display_name": "MatejKr", "link": "https://stackoverflow.com/users/5127763/matejkr"}, "edited": false, "score": 1, "creation_date": 1438177644, "post_id": 31702056, "comment_id": 51343305, "body": "I have edited question. I read tutorial but I still don&#39;t get it. Thanks."}], "tags": [], "owner": {"reputation": 869, "user_id": 2029548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f44dcf3e58fcd22cd857cd563402178?s=128&d=identicon&r=PG", "display_name": "obadz", "link": "https://stackoverflow.com/users/2029548/obadz"}, "is_accepted": false, "score": 0, "last_activity_date": 1438177003, "creation_date": 1438177003, "answer_id": 31702056, "question_id": 31701594, "link": "https://stackoverflow.com/questions/31701594/haskell-rpn-calculator-from-f/31702056#31702056", "title": "Haskell RPN calculator from F#", "body": "<p>This (very popular) tutorial tackles this exact problem:</p>\n\n<p><a href=\"http://learnyouahaskell.com/functionally-solving-problems#reverse-polish-notation-calculator\" rel=\"nofollow\">http://learnyouahaskell.com/functionally-solving-problems#reverse-polish-notation-calculator</a></p>\n"}, {"comments": [{"owner": {"reputation": 95, "user_id": 5127763, "user_type": "registered", "profile_image": "https://graph.facebook.com/808600889235341/picture?type=large", "display_name": "MatejKr", "link": "https://stackoverflow.com/users/5127763/matejkr"}, "edited": false, "score": 0, "creation_date": 1438178617, "post_id": 31702333, "comment_id": 51344150, "body": "Thanks. What is the meaning od stack&#39; and stack&#39;&#39;"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 95, "user_id": 5127763, "user_type": "registered", "profile_image": "https://graph.facebook.com/808600889235341/picture?type=large", "display_name": "MatejKr", "link": "https://stackoverflow.com/users/5127763/matejkr"}, "edited": false, "score": 1, "creation_date": 1438184730, "post_id": 31702333, "comment_id": 51348928, "body": "those are just <i>versions</i> of stack (it goes from <code>stack</code> to <code>stack&#39;</code> to <code>stack&#39;&#39;</code>) you will see this quite often - it&#39;s a bit like using <code>i1</code>, <code>i2</code>, ... it&#39;s not really a thing in the language - it&#39;s just a convention many people are using"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 95, "user_id": 5127763, "user_type": "registered", "profile_image": "https://graph.facebook.com/808600889235341/picture?type=large", "display_name": "MatejKr", "link": "https://stackoverflow.com/users/5127763/matejkr"}, "edited": false, "score": 1, "creation_date": 1438184800, "post_id": 31702333, "comment_id": 51348978, "body": "here <code>stack&#39;</code> is <code>stack</code> after you poped <code>a</code> and <code>stack&#39;&#39;</code> is <code>stack&#39;</code> after you poped <code>b</code> (so <code>a:b:stack&#39;&#39; == a:stack&#39; == stack</code>)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 95, "user_id": 5127763, "user_type": "registered", "profile_image": "https://graph.facebook.com/808600889235341/picture?type=large", "display_name": "MatejKr", "link": "https://stackoverflow.com/users/5127763/matejkr"}, "edited": false, "score": 0, "creation_date": 1438185716, "post_id": 31702333, "comment_id": 51349580, "body": "@MatejKr Keep in mind that this solution fulfils your request to keep code &quot;as much as similar as possible&quot; to F#. This solution is not idiomatic in Haskell, IMHO. The last alternatives are closer to idiomatic Haskell, but I&#39;d argue that using <code>pop</code> (which is a partial function) instead of pattern matching is not common, nor a good practice in Haskell. Feel free to study this code, but do not try to learn Haskell by translating from other languages. (This holds in general: learning language X by translating from Y is never a good idea)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1438186532, "post_id": 31702333, "comment_id": 51350099, "body": "@chi yes of course something like <code>calc (b:a:stack) &quot;+&quot; = (a+b):stack</code> would be more idiomatic to haskell but that <b>is</b> already covered by LYAH (the link) so I thought it would be pointless to inlcude it <i>plus</i> I think using lists is a good approximation to stack and the <code>pop</code>, <code>push</code> stuff is just what .net/fsharp would do (partiality included)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1438186692, "post_id": 31702333, "comment_id": 51350200, "body": "@Carsten I completely agree."}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 2, "last_activity_date": 1438178472, "last_edit_date": 1438178472, "creation_date": 1438177620, "answer_id": 31702333, "question_id": 31701594, "link": "https://stackoverflow.com/questions/31701594/haskell-rpn-calculator-from-f/31702333#31702333", "title": "Haskell RPN calculator from F#", "body": "<p>here is a very basic translation:</p>\n\n<pre><code>module Main where\n\ntype Stack = [Double]\n\npush :: Stack -&gt; Double -&gt; [Double]\npush s v = v:s\n\npop :: Stack -&gt; (Double, Stack)\npop []    = error \"empty stack\"\npop (v:s) = (v,s)\n\ncalc :: Stack -&gt; String -&gt; Stack\ncalc stck \"+\" = let (v1,stck') = pop stck\n                    (v2,stck'') = pop stck'\n                in push stck'' $ v1+v2\ncalc stck n = push stck $ read n\n\neval :: String -&gt; Double\neval = head . foldl calc [] . words\n\nmain :: IO ()\nmain = print $ eval \"3 5 +\"\n</code></pre>\n\n<p>as .net's <code>Stack</code> is not pure I opted to use a simple list as an alternative, this of course means that you have to thread the <em>state</em> (the stack) through your calculations (that is the job of those <code>let (v1,stck)...</code> parts)</p>\n\n<p>I think this is the easiest one for an beginner - if you advanced a bit you might come back and reimplement this in using the state-monad (indeed I used it in disguise exactly with the let's) to make it a bit more readable/beautiful</p>\n\n<p>Of course you have to add the other cases for your operators</p>\n\n<h2>remarks</h2>\n\n<p>This will fail for malformed inputs (as would your version) - if you like you can sprinkle in <code>Maybe</code> (in <code>pop</code>, <code>calc</code> and <code>eval</code>) ...</p>\n\n<h2>making it a bit nicer</h2>\n\n<p>if you implement the cases yourself you will find that the <code>let ... pop ... push</code> stuff is repeating a lot - so let's <strong>DRY</strong>:</p>\n\n<pre><code>apply :: (Double -&gt; Double -&gt; Double) -&gt; Stack -&gt; Stack\napply op stack =\n  let (a,stack')  = pop stack\n      (b,stack'') = pop stack'\n  in push stack'' (b `op` a)\n\ncalc :: Stack -&gt; String -&gt; Stack\ncalc stack \"+\" = apply (+) stack\ncalc stack \"*\" = apply (*) stack\ncalc stack \"-\" = apply (-) stack\ncalc stack \"/\" = apply (/) stack\ncalc stack n = push stack $ read n\n</code></pre>\n\n<p>also note that you have to reverse the operation because you <em>pop</em> in the wrong order</p>\n\n<h3>if you don't mind <code>flip</code>ing:</h3>\n\n<pre><code>calc :: String -&gt; Stack -&gt; Stack\ncalc \"+\" = apply (+)\ncalc \"*\" = apply (*)\ncalc \"-\" = apply (-)\ncalc \"/\" = apply (/)\ncalc n   = flip push $ read n\n\neval :: String -&gt; Double\neval = head . foldl (flip calc) [] . words\n</code></pre>\n\n<p>here is an example:</p>\n\n<pre><code>\u03bb&gt; eval \"3 5 + 2 - 3 /\"\n2.0\n</code></pre>\n"}], "owner": {"reputation": 95, "user_id": 5127763, "user_type": "registered", "profile_image": "https://graph.facebook.com/808600889235341/picture?type=large", "display_name": "MatejKr", "link": "https://stackoverflow.com/users/5127763/matejkr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 279, "favorite_count": 0, "accepted_answer_id": 31702333, "answer_count": 2, "score": 1, "last_activity_date": 1438178472, "creation_date": 1438175880, "last_edit_date": 1438177575, "question_id": 31701594, "link": "https://stackoverflow.com/questions/31701594/haskell-rpn-calculator-from-f", "title": "Haskell RPN calculator from F#", "body": "<p>I am new at Haskell, could anyone suggest me how to rewrite folowing program in F# to Haskell so it will be as much as similar as possible.</p>\n\n<p>Don't know how to define stack data type in Haskell.</p>\n\n<p>Thanks</p>\n\n<pre><code>let calc input (stck:Stack&lt;double&gt;) =\n    match input with\n        | \"*\" -&gt; stck.Push(stck.Pop() * stck.Pop())\n        | \"+\" -&gt; stck.Push(stck.Pop() + stck.Pop())\n        | \"-\" -&gt; stck.Push(stck.Pop() - stck.Pop())\n        | \"/\" -&gt; stck.Push(stck.Pop() / stck.Pop())\n        | _ -&gt; stck.Push(System.Convert.ToDouble(input))\n\nlet evalu (inputStr:string) =\n    let stk = Stack&lt;double&gt;()\n\n    let elem = inputStr.Split([|' '|])\n\n    Array.iter (fun ent -&gt; calc ent stk) elem\n    stk.Pop()\n\n//Call\nConsole.WriteLine(evalu(\"3 5 +\"))\n</code></pre>\n\n<p>Would like to have something like:</p>\n\n<pre><code>calc input stck\n    | input == '*' = stck.push(stck.pop * stck.pop)\n    | input == '+' = stck.push(stck.pop + stck.pop)\n    | input == '-' = stck.push(stck.pop - stck.pop)\n    | input == '/' = stck.push(stck.pop / stck.pop)\n    | otherwise   = stck.push(input)\n\nmain = calc \"3 5 +\" [] //Somehow do folding\n</code></pre>\n"}, {"tags": ["performance", "haskell", "io", "hashmap", "attoparsec"], "comments": [{"owner": {"reputation": 97, "user_id": 3649353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c25ebc341e08a9b69e80fcb0d7dbd52?s=128&d=identicon&r=PG&f=1", "display_name": "grwp", "link": "https://stackoverflow.com/users/3649353/grwp"}, "edited": false, "score": 3, "creation_date": 1438166410, "post_id": 31697883, "comment_id": 51335574, "body": "Did you profile your code? <a href=\"https://nikita-volkov.github.io/profiling-cabal-projects/\" rel=\"nofollow noreferrer\">nikita-volkov.github.io/profiling-cabal-projects</a> <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/prof-heap.html\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/latest/docs/html/users_guide/&hellip;</a> <a href=\"http://book.realworldhaskell.org/read/profiling-and-optimization.html\" rel=\"nofollow noreferrer\">book.realworldhaskell.org/read/profiling-and-optimization.ht&zwnj;&#8203;ml</a>"}, {"owner": {"reputation": 785, "user_id": 3087558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a43d21bfa85dc7dc360cafa7f69ba3b1?s=128&d=identicon&r=PG&f=1", "display_name": "fgv", "link": "https://stackoverflow.com/users/3087558/fgv"}, "edited": false, "score": 1, "creation_date": 1438173665, "post_id": 31697883, "comment_id": 51340398, "body": "If the file that you are reading is too big, a good option to reduce the startup time of the program is to move the contents of that file into a database (embedded or not). Once indexed in the database, random lookups can be performed directly without reading the file sequentially first."}, {"owner": {"reputation": 807, "user_id": 1278218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc600c707e4f698ad2e6d0a1b9d9f119?s=128&d=identicon&r=PG", "display_name": "erdeszt", "link": "https://stackoverflow.com/users/1278218/erdeszt"}, "edited": false, "score": 0, "creation_date": 1438176592, "post_id": 31697883, "comment_id": 51342501, "body": "In addition to profiling I suggest going through this short guide about performance considerations: <a href=\"https://hackage.haskell.org/package/attoparsec-0.13.0.1/docs/Data-Attoparsec-ByteString.html#g:3\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/attoparsec-0.13.0.1/docs/&hellip;</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1438184293, "post_id": 31697883, "comment_id": 51348585, "body": "I&#39;m just guessing here: the parser might need to scan the whole file to choose whether to return a successful value or a failure one. I.e. <code>ATL.many1</code> might not be that lazy, forcing everything in memory anyway."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 5, "last_activity_date": 1438202924, "creation_date": 1438202924, "answer_id": 31710805, "question_id": 31697883, "link": "https://stackoverflow.com/questions/31697883/efficiently-reading-a-large-file-into-a-map/31710805#31710805", "title": "efficiently reading a large file into a Map", "body": "<p>Note that the file you want to load has 6 million lines and\nthe text you are interested in storing comprises approx. 120 MB.</p>\n\n<h1>Lower Bounds</h1>\n\n<p>To establish some lower bounds I first created another .tsv file containing\nthe preprocessed contents of the etymwn.tsv file. I then timed how it\ntook for this perl program to read that file:</p>\n\n<pre><code>my %H;\nwhile (&lt;&gt;) {\n  chomp;\n  my ($a,$b) = split(\"\\t\", $_, 2);\n  $H{$a} = $b;\n}\n</code></pre>\n\n<p>This took approx. 17 secs., so I would expect any Haskell program to\ntake about that about of time.</p>\n\n<p>If this start-up time is unacceptable, consider the following options:</p>\n\n<ol>\n<li>Work in ghci and use the \"live reloading\" technique to save the map\n using the <a href=\"http://hackage.haskell.org/package/foreign-store\" rel=\"noreferrer\">Foreign.Store package</a>\n so that it persists through ghci code reloads.\n That way you only have to load the map data once as you iterate your code.</li>\n<li>Use a persistent key-value store (such as sqlite, gdbm, BerkeleyDB)</li>\n<li>Access the data through a client-server store</li>\n<li>Reduce the number of key-value pairs you store (do you need all 6 million?)</li>\n</ol>\n\n<p>Option 1 is discussed in this blog post by Chris Done:</p>\n\n<ul>\n<li><a href=\"http://chrisdone.com/posts/ghci-reload\" rel=\"noreferrer\">Reload Running Code in GHCI</a></li>\n</ul>\n\n<p>Options 2 and 3 will require you to work in the IO monad.</p>\n\n<h1>Parsing</h1>\n\n<p>First of all, check the type of your <code>tsv</code> function:</p>\n\n<pre><code>tsv :: Data.Attoparsec.Internal.Types.Parser\n          DT.Text [M.Map (DT.Text, DT.Text) (DT.Text, DT.Text)]\n</code></pre>\n\n<p>You are returning a list of maps instead of just one map. This doesn't look\nright.</p>\n\n<p>Secondly, as @chi suggested, I doubt that using <code>attoparsec</code> is lazy.\nIn partcular, it has to verify that the entire parse succeeds,\nso I can't see how it cannot avoid creating all of the parsed lines\nbefore returning.</p>\n\n<p>To truely parse the input lazily, take the following approach:</p>\n\n<pre><code>toPair :: DT.Text -&gt; (Key, Value)\ntoPair input = ...\n\nmain = do\n  all_lines &lt;- fmap DTL.lines $ DTLIO.getContent\n  let m = M.fromList $ map toPair all_lines\n  print $ M.lookup \"foobar\" m\n</code></pre>\n\n<p>You can still use <code>attoparsec</code> to implement <code>toPair</code>, but you'll be using it\non a line-by-line basis instead of on the entire input.</p>\n\n<h1>ByteString vs. Text</h1>\n\n<p>In my experience working with ByteStrings is much faster than working with Text.</p>\n\n<p>This version of <code>toPair</code> for ByteStrings is about 4 times faster than the corresponding\nversion for Text:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport qualified Data.ByteString.Lazy.Char8 as L\nimport qualified Data.Attoparsec.ByteString.Char8 as A\nimport qualified Data.Attoparsec.ByteString.Lazy as AL\n\ntoPair :: L.ByteString -&gt; (L.ByteString, L.ByteString)\ntoPair bs =\n  case AL.maybeResult (AL.parse parseLine bs) of\n    Nothing    -&gt; error \"bad line\"\n    Just (a,b) -&gt; (a,b)\n  where parseLine = do\n          A.skipWhile (/= ' ')\n          A.skipWhile (== ' ')\n          a &lt;- A.takeWhile (/= '\\t')\n          A.skipWhile (== '\\t')\n          rel &lt;- A.takeWhile (/= '\\t')\n          A.skipWhile (== '\\t')\n          A.skipWhile (/= ' ')\n          A.skipWhile (== ' ')\n          c &lt;- A.takeWhile (const True)\n          if rel == \"rel:etymological_origin_of\"\n            then return (c,a)\n            else return (a,c)\n</code></pre>\n\n<p>Or, just use plain ByteString functions:</p>\n\n<pre><code>fields :: L.ByteString -&gt; [L.ByteString]\nfields = L.splitWith (== '\\t')\n\nsnipSpace = L.ByteString -&gt; L.ByteString\nsnipSpace = L.dropWhile (== ' ') . L.dropWhile (/=' ')\n\ntoPair'' bs = \n  let fs = fields bs\n  case fields line of\n    (x:y:z:_) -&gt; let a = snipSpace x\n                     c = snipSpace z\n                 in\n                 if y == \"rel:etymological_origin_of\"\n                   then (c,a)\n                   else (a,c)\n    _         -&gt; error \"bad line\"\n</code></pre>\n\n<p>Most of the time spent loading the map is in parsing the lines.\nFor ByteStrings this is about 14 sec. to load all 6 million lines\nvs. 50 secs. for Text.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 0, "last_activity_date": 1438208857, "last_edit_date": 1495541654, "creation_date": 1438208857, "answer_id": 31712251, "question_id": 31697883, "link": "https://stackoverflow.com/questions/31697883/efficiently-reading-a-large-file-into-a-map/31712251#31712251", "title": "efficiently reading a large file into a Map", "body": "<p>To add to <a href=\"https://stackoverflow.com/a/31710805/1477667\">this answer</a>, I'd like to note that attoparsec actually has very good support for \"pull-based\" incremental parsing. You can use this directly with the convenient <code>parseWith</code> function. For even finer control, you can feed the parser by hand with <code>parse</code> and <code>feed</code>. If you don't want to worry about any of this, you should be able to use something like <code>pipes-attoparsec</code>, but personally I find pipes a bit hard to understand.</p>\n"}], "owner": {"reputation": 569, "user_id": 4430994, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d692c01775d04391f9377575d05f2e9f?s=128&d=identicon&r=PG&f=1", "display_name": "Reuben", "link": "https://stackoverflow.com/users/4430994/reuben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 221, "favorite_count": 1, "accepted_answer_id": 31710805, "answer_count": 2, "score": 7, "last_activity_date": 1438208857, "creation_date": 1438165697, "last_edit_date": 1438180800, "question_id": 31697883, "link": "https://stackoverflow.com/questions/31697883/efficiently-reading-a-large-file-into-a-map", "title": "efficiently reading a large file into a Map", "body": "<p>I'm trying to write code to perform the following simple task in Haskell: looking up the etymologies of words using this dictionary, stored as a large tsv file (<a href=\"http://www1.icsi.berkeley.edu/~demelo/etymwn/\">http://www1.icsi.berkeley.edu/~demelo/etymwn/</a>). I thought I'd parse (with attoparsec) the tsv file into a Map, which I could then use to look up etymologies efficiently, as required (and do some other stuff with). </p>\n\n<p>This was my code:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Control.Arrow\nimport qualified Data.Map as M\nimport Control.Applicative\nimport qualified Data.Text as DT\nimport qualified Data.Text.Lazy.IO as DTLIO\nimport qualified Data.Text.Lazy as DTL\nimport qualified Data.Attoparsec.Text.Lazy as ATL\nimport Data.Monoid\n\ntext = do\n    x &lt;- DTLIO.readFile \"../../../../etymwn.tsv\"\n    return $ DTL.take 10000 x\n\n--parsers\nwordpair = do\n    x &lt;- ATL.takeTill (== ':')\n    ATL.char ':' *&gt; (ATL.many' $ ATL.char ' ')\n    y &lt;- ATL.takeTill (\\x -&gt; x `elem` ['\\t','\\n'])\n    ATL.char '\\n' &lt;|&gt;   ATL.char '\\t'\n    return (x,y)\n\n--line of file\nline = do\n    a &lt;- (ATL.count 3 wordpair)\n    case (rel (a !! 2)) of \n        True -&gt; return . (\\[a,b,c] -&gt; [(a,c)]) $ a\n        False -&gt; return . (\\[a,b,c] -&gt; [(c,a)]) $ a\n    where rel x = if x == (\"rel\",\"etymological_origin_of\") then False else True\n\ntsv = do \n    x &lt;- ATL.many1 line\n    return $ fmap M.fromList x\n\nmain = (putStrLn . show . ATL.parse tsv) =&lt;&lt; text\n</code></pre>\n\n<p>It works for small amounts of input, but quickly grows too inefficient. I'm not quite clear on where the problem is, and soon realized that even trivial tasks like viewing the last character of the file were taking too long when I tried, e.g. with</p>\n\n<pre><code>foo = fmap DTL.last $ DTLIO.readFile \"../../../../etymwn.tsv\n</code></pre>\n\n<p>So my questions are: what are the main things that I'm doing wrong, in terms of approach and execution? Any tips for more Haskelly/better code?</p>\n\n<p>Thanks,</p>\n\n<p>Reuben</p>\n"}, {"tags": ["user-interface", "haskell", "drag-and-drop", "glfw"], "answers": [{"comments": [{"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "edited": false, "score": 0, "creation_date": 1459342673, "post_id": 36297065, "comment_id": 60242314, "body": "Thank you! The GLFW repo is on my watchlist so I was notified about it earlier today."}, {"owner": {"reputation": 2264, "user_id": 153269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/da3a20a76a69532fa83e790e89cb4c6c?s=128&d=identicon&r=PG", "display_name": "Peaker", "link": "https://stackoverflow.com/users/153269/peaker"}, "reply_to_user": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "edited": false, "score": 1, "creation_date": 1459416959, "post_id": 36297065, "comment_id": 60281294, "body": "@SwiftsNamesake My branches are no longer needed (deleted), the packages added internal support."}], "tags": [], "owner": {"reputation": 2264, "user_id": 153269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/da3a20a76a69532fa83e790e89cb4c6c?s=128&d=identicon&r=PG", "display_name": "Peaker", "link": "https://stackoverflow.com/users/153269/peaker"}, "is_accepted": true, "score": 2, "last_activity_date": 1460893875, "last_edit_date": 1460893875, "creation_date": 1459294848, "answer_id": 36297065, "question_id": 31696194, "link": "https://stackoverflow.com/questions/31696194/drag-drop-with-glfw-b/36297065#36297065", "title": "Drag &amp; Drop with GLFW-b", "body": "<p><s>Support for the drop callback exists in the C-side of the <code>GLFW-b</code> package, but not in the FFI/Haskell side of both <code>bindings-GLFW</code> and <code>GLFW-b</code>.</p>\n\n<p>I created branches (&amp; pull requests) for both packages, see:</p>\n\n<p><a href=\"https://github.com/lamdu/bindings-GLFW\" rel=\"nofollow\">https://github.com/lamdu/bindings-GLFW</a></p>\n\n<p><a href=\"https://github.com/lamdu/GLFW-b\" rel=\"nofollow\">https://github.com/lamdu/GLFW-b</a></s></p>\n\n<p>Support for drag&amp;drop is now inside the GLFW-b Haskell packages.</p>\n"}], "owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 334, "favorite_count": 3, "accepted_answer_id": 36297065, "answer_count": 1, "score": 3, "last_activity_date": 1460893875, "creation_date": 1438161432, "question_id": 31696194, "link": "https://stackoverflow.com/questions/31696194/drag-drop-with-glfw-b", "title": "Drag &amp; Drop with GLFW-b", "body": "<p>How do I respond to drag-and-drop events with the <a href=\"http://hackage.haskell.org/package/GLFW-b\" rel=\"nofollow\">GLFW-b</a> package? There is a <code>glfwSetDropCallback</code> function listed on the GLFW website, but it seems to have been excluded from the Haskell bindings.</p>\n\n<p>GLFW-b relies on the low-level <a href=\"https://github.com/bsl/bindings-GLFW/blob/master/Bindings/GLFW.hsc\" rel=\"nofollow\">bindings-GLFW</a> package, which <em>does</em> include the aforementioned function (defined in <em>input.c</em>) and the <a href=\"http://www.glfw.org/Version-3.1-released.html\" rel=\"nofollow\">release note</a> for version 3.1 even lists drag-and-drop among the new features.</p>\n\n<p>Is this just an accidental omission or are there issues with cross-platform drag-and-drop that I'm not aware of?</p>\n"}, {"tags": ["haskell", "happstack"], "comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1438144452, "post_id": 31690436, "comment_id": 51323781, "body": "On a hunch, are <code>happstack-server</code> and your program using the same version of <code>transformers</code>?"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1438167131, "post_id": 31690436, "comment_id": 51336006, "body": "@&#216;rjanJohansen I had that thought as well but I&#39;m not sure how to check definitively? It looks like I have both 0.3.0.0 (from the Haskell Platform) and 0.4.2.0 (from Cabal) in ghc-pkg list but I don&#39;t know how to tell which is being used for what?"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1438167817, "post_id": 31690436, "comment_id": 51336450, "body": "@&#216;rjanJohansen I tried unregistering each version, and it looks like happstack is dependent on 0.3 and I would presume my program would try to use 0.4.2 since it&#39;s newer? Would you have any advice regarding resolving the issue?"}, {"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 2, "creation_date": 1438176715, "post_id": 31690436, "comment_id": 51342580, "body": "@ZJM You can use cabal sandbox, it ensures package versions consistency. BTW there is a feature request to improve the error: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/9611\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/9611</a>"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 0, "creation_date": 1438183722, "post_id": 31690436, "comment_id": 51348101, "body": "@Yuras Using a sandbox resolved it. Unfortunately it seems like I&#39;ll need to change my development workflow to make use of it, but I think long term it&#39;s for the best anyway."}], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 109, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1438138056, "creation_date": 1438138056, "question_id": 31690436, "link": "https://stackoverflow.com/questions/31690436/happstack-serverpart-missing-monadio-instance", "title": "Happstack ServerPart missing MonadIO instance?", "body": "<p>The following code:</p>\n\n<pre><code>import Control.Monad.IO.Class\n\nimport Happstack.Server\n\ntest :: ServerPart String\ntest = liftIO (putStrLn \"Test\") &gt;&gt; ok \"Test\"\n\nmain = simpleHTTP nullConf test\n</code></pre>\n\n<p>is failing to compile with the message:</p>\n\n<pre><code>No instance for (MonadIO (ServerPartT IO))\n  arising from a use of `liftIO'\nPossible fix:\n  add an instance declaration for (MonadIO (ServerPartT IO))\nIn the first argument of `(&gt;&gt;)', namely `liftIO (putStrLn \"Test\")'\nIn the expression: liftIO (putStrLn \"Test\") &gt;&gt; ok \"Test\"\nIn an equation for `test':\n    test = liftIO (putStrLn \"Test\") &gt;&gt; ok \"Test\"\n</code></pre>\n\n<p>There appears to be a MonadIO instance here:</p>\n\n<p><a href=\"http://hackage.haskell.org/package/happstack-server-7.4.0/docs/Happstack-Server-Monads.html#t:ServerPartT\" rel=\"nofollow\">http://hackage.haskell.org/package/happstack-server-7.4.0/docs/Happstack-Server-Monads.html#t:ServerPartT</a></p>\n\n<p>but adding a <code>Happstack.Server.Monads</code> import didn't change anything so I was hoping someone might be able to indicate what I'm doing wrong?</p>\n"}, {"tags": ["haskell", "void"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1438130595, "post_id": 31689305, "comment_id": 51320536, "body": "I can&#39;t replicate this on GHCi 7.10.1 with <code>void</code> 0.7."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1438130729, "post_id": 31689305, "comment_id": 51320557, "body": "Nor can I on 7.8.3 with void 0.6.1. (Still holding out for the next HP - any day now...) Anyway, I suspect this will be <i>highly</i> dependent on exactly what versions you are invoking, with which (optimization esp.) options, and how you are running it."}, {"owner": {"reputation": 542, "user_id": 1956587, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e92d52f1c16bcf435ef24f7a474fde04?s=128&d=identicon&r=PG", "display_name": "tolUene", "link": "https://stackoverflow.com/users/1956587/toluene"}, "edited": false, "score": 0, "creation_date": 1438132075, "post_id": 31689305, "comment_id": 51320882, "body": "I am running ghci on version 7.6.3. But good to know."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1438132155, "post_id": 31689305, "comment_id": 51320916, "body": "Might be a weird <code>Show Void</code> instance?"}, {"owner": {"reputation": 542, "user_id": 1956587, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e92d52f1c16bcf435ef24f7a474fde04?s=128&d=identicon&r=PG", "display_name": "tolUene", "link": "https://stackoverflow.com/users/1956587/toluene"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1438132589, "post_id": 31689305, "comment_id": 51320999, "body": "@melpomene that shouldn&#39;t be it since <code>absurd</code> doesn&#39;t try to show a <code>Void</code>"}, {"owner": {"reputation": 542, "user_id": 1956587, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e92d52f1c16bcf435ef24f7a474fde04?s=128&d=identicon&r=PG", "display_name": "tolUene", "link": "https://stackoverflow.com/users/1956587/toluene"}, "edited": false, "score": 0, "creation_date": 1438132656, "post_id": 31689305, "comment_id": 51321015, "body": "I am also using void 0.7. by the way."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1438134238, "post_id": 31689305, "comment_id": 51321397, "body": "Oh also in very recent GHCs <code>Data.Void</code> is a <code>base</code> module, with a different definition but most of the same features."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1438139697, "post_id": 31690089, "comment_id": 51322668, "body": "This smells like a good reason to change the definition of absurd, probably to use (or reimplement) <code>pseq</code>. It&#39;s much better to get an exception than an infinite loop."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1438143524, "post_id": 31690089, "comment_id": 51323568, "body": "@dfeuer Well the <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/src/Data.Void.html#absurd\" rel=\"nofollow noreferrer\">new definition in <code>base</code></a> is entirely different, using the empty case block feature, so no infinite loop should be involved."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1438143878, "post_id": 31690089, "comment_id": 51323643, "body": "@dfeuer Oh and the <code>void</code> package has been written with a policy of being Haskell 98 compatible, so it couldn&#39;t use <code>pseq</code> or the new empty datatype features."}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 8, "last_activity_date": 1438135638, "creation_date": 1438135638, "answer_id": 31690089, "question_id": 31689305, "link": "https://stackoverflow.com/questions/31689305/haskell-data-void-undefined-turns-into-infinite-loop/31690089#31690089", "title": "Haskell Data.Void: undefined turns into infinite loop", "body": "<p>After a bit more investigation, I think I understand how this can happen, and how it depends on optimization choices by GHC.  In <code>void-0.7</code>, we have the following relevant definitions:</p>\n\n<pre><code>newtype Void = Void Void\n\nabsurd :: Void -&gt; a\nabsurd a = a `seq` spin a where\n   spin (Void b) = spin b\n\ninstance Show Void where\n  showsPrec _ = absurd\n</code></pre>\n\n<p>Note that the <code>Show</code> instance delegates to <code>absurd</code>, which explains why <code>undefined :: Void</code> in GHCi gives the same result as <code>absurd undefined</code>.</p>\n\n<p>Now looking at the definition of <code>absurd a</code>, it uses <code>seq</code> to \"ensure\" that <code>a</code> is actually evaluated, so you would think that should trigger the <code>undefined</code> exception. However, subtly <code>seq</code> doesn't actually work that way. <code>a `seq` b</code> only guarantees that <em>both</em> <code>a</code> and <code>b</code> will be evaluated before the whole expression returns, but <em>not</em> in which order.  It is entirely up to the choice of the implementation which part is evaluated first.</p>\n\n<p>This means that <code>GHC</code> is free to either evaluate the <code>a</code> first, triggering the exception; or else to evaluate <code>spin a</code> first.  If it evaluates <code>spin a</code> first, then you get an infinite loop, because the <code>Void</code> constructor is a <code>newtype</code> constructor, and by design, unwrapping those doesn't actually evaluate anything.</p>\n\n<p>So therefore, by the semantics of <code>seq</code>, both options are actually equally legal Haskell behavior.</p>\n\n<p>As a final note, the <a href=\"http://research.microsoft.com/en-us/um/people/simonpj/Papers/imprecise-exn.htm\">exception semantics in GHC</a> have been defined as explicitly nondeterministic:  If an expression could give bottom in several different ways, GHC can choose any of them.  Since the only way to <em>distinguish</em> different bottoms is in <code>IO</code>, this is considered acceptable.</p>\n"}], "owner": {"reputation": 542, "user_id": 1956587, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e92d52f1c16bcf435ef24f7a474fde04?s=128&d=identicon&r=PG", "display_name": "tolUene", "link": "https://stackoverflow.com/users/1956587/toluene"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 1, "accepted_answer_id": 31690089, "answer_count": 1, "score": 9, "last_activity_date": 1438135638, "creation_date": 1438129509, "question_id": 31689305, "link": "https://stackoverflow.com/questions/31689305/haskell-data-void-undefined-turns-into-infinite-loop", "title": "Haskell Data.Void: undefined turns into infinite loop", "body": "<p>I noticed one thing about the <code>Void</code> type in the haskell <code>Data.Void</code> module, which is weird and I'd very much like to know why it is the way it is.\nUndefined is supposed to be a value that exists for every type (in my understanding), and</p>\n\n<pre><code>undefined :: Type\n</code></pre>\n\n<p>is supposed to yield</p>\n\n<pre><code>*** Exception: Prelude.undefined\n</code></pre>\n\n<p>which works for every data type I have tried, except for <code>Void</code>.\n<code>undefined :: Void</code> does not terminate at all, same for <code>absurd undefined</code>.\nNow I don't think that's really much of an issue since <code>Void</code> represents a value that is not going to happen anyway, but I would still like to know what causes this behavior.</p>\n"}, {"tags": ["haskell", "frp", "reactive-banana"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1438128916, "post_id": 31689204, "comment_id": 51320150, "body": "I think you can use <code>withArduino :: Bool -&gt; FilePath -&gt; Arduino () -&gt; IO ()</code>."}, {"owner": {"reputation": 1764, "user_id": 2478883, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ys9QL.png?s=128&g=1", "display_name": "Ryoichiro Oka", "link": "https://stackoverflow.com/users/2478883/ryoichiro-oka"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1438129059, "post_id": 31689204, "comment_id": 51320175, "body": "Thank you @duplode for your comment, <code>withArduino</code> is a function that initializes all their components, which I&#39;d not like to run every moment in the main loop of the program."}, {"owner": {"reputation": 3291, "user_id": 1456761, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/gvNnG.png?s=128&g=1", "display_name": "Tobias Brandt", "link": "https://stackoverflow.com/users/1456761/tobias-brandt"}, "edited": false, "score": 1, "creation_date": 1438129074, "post_id": 31689204, "comment_id": 51320180, "body": "<code>MonadIO</code> only gives you <code>IO a -&gt; m a</code>. What you need is the other direction. This is (partly) given by <code>MonadBaseControl IO</code> or, if you know the specific monad, a function like <code>withArduino</code>."}, {"owner": {"reputation": 1764, "user_id": 2478883, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ys9QL.png?s=128&g=1", "display_name": "Ryoichiro Oka", "link": "https://stackoverflow.com/users/2478883/ryoichiro-oka"}, "reply_to_user": {"reputation": 3291, "user_id": 1456761, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/gvNnG.png?s=128&g=1", "display_name": "Tobias Brandt", "link": "https://stackoverflow.com/users/1456761/tobias-brandt"}, "edited": false, "score": 0, "creation_date": 1438129628, "post_id": 31689204, "comment_id": 51320294, "body": "Thank you @TobiasBrandt for your answer, but <code>withArduino</code> is not such a function that I can execute every millisecond."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1438161869, "post_id": 31689204, "comment_id": 51332608, "body": "Note that Heinrich has posted a proper solution as a comment to my answer."}], "answers": [{"comments": [{"owner": {"reputation": 3291, "user_id": 1456761, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/gvNnG.png?s=128&g=1", "display_name": "Tobias Brandt", "link": "https://stackoverflow.com/users/1456761/tobias-brandt"}, "edited": false, "score": 3, "creation_date": 1438131766, "post_id": 31689426, "comment_id": 51320813, "body": "The main problem seems to be that <code>withArduino</code> wants to execute the whole program at once, while Ryoichiro wants to feed operations bit by bit. It seems that the arduino library doesn&#39;t support that,"}, {"owner": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "edited": false, "score": 4, "creation_date": 1438160848, "post_id": 31689426, "comment_id": 51331879, "body": "Tobias is right. In these situations, there is a little trick that often helps, though: Concurrency. More specifically, you can write an event loop with <code>forever</code> and <code>readMVar</code> and supply this as argument to <code>withArduino</code>. Then, the reactive-banana side simply uses <code>putMVar</code> to communicate an action that it wants performed. (A concurrent channel may be more appropriate than an <code>MVar</code>, but the idea remains the same.) I like to call this the <a href=\"http://apfelmus.nfshost.com/blog/2012/06/07-forklift.html\" rel=\"nofollow noreferrer\">&quot;forklift pattern&quot;</a>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "edited": false, "score": 1, "creation_date": 1438162295, "post_id": 31689426, "comment_id": 51332872, "body": "Thanks @Heinrich! I am going to try that pattern as well. (Not with a real Arduino board, unfortunately...)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "edited": false, "score": 1, "creation_date": 1438163145, "post_id": 31689426, "comment_id": 51333422, "body": "@HeinrichApfelmus One detail: are there any guarantees about the order of actions sent in this way in the case of reactimates for simultaneous events? (I guess the answer is &quot;no&quot;, and that unifying simultaneous events beforehand is necessary to have peace of mind.)"}, {"owner": {"reputation": 1764, "user_id": 2478883, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ys9QL.png?s=128&g=1", "display_name": "Ryoichiro Oka", "link": "https://stackoverflow.com/users/2478883/ryoichiro-oka"}, "edited": false, "score": 0, "creation_date": 1438290835, "post_id": 31689426, "comment_id": 51403723, "body": "I chose another answer in the end, but thank you @duplode, TobiasBrandt and HeinrichApfelmus for working on my question!"}, {"owner": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "edited": false, "score": 1, "creation_date": 1438332427, "post_id": 31689426, "comment_id": 51417651, "body": "@duplode The guarantee is that <code>reactimate</code> are executed in &quot;declaration order&quot;, i.e. a <code>reactimate</code> that comes before another <code>reactimate</code> in the <code>Moment</code> monad will also have its <code>IO</code> action executed first. It&#39;s a bit tricky to specify &quot;declaration order&quot; precisely when you have to consider <code>executeE</code> as well, but I hope you get what I mean. :-)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "edited": false, "score": 0, "creation_date": 1438586365, "post_id": 31689426, "comment_id": 51492401, "body": "@HeinrichApfelmus I get it, thanks. In fact, something now tells me I may have asked you this exact question two years ago :) In any case, I added an implementation of your solution to my answer, hopefully not doing anything silly in the process..."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 4, "last_activity_date": 1438646980, "last_edit_date": 1438646980, "creation_date": 1438130383, "answer_id": 31689426, "question_id": 31689204, "link": "https://stackoverflow.com/questions/31689204/execute-monadio-action-inside-of-reactimate/31689426#31689426", "title": "Execute MonadIO action inside of reactimate", "body": "<p><em>I have no experience with Arduino or hArduino, so take what follows with a pinch of salt.</em></p>\n\n<p>Given that it is unreasonable to reinitialise the board on every <code>reactimate</code>, I don't think there is a clean option [*]. The fundamental issue is that the implementation of <code>reactimate</code> in reactive-banana doesn't know anything about the <code>Arduino</code> monad, and so all extra effects it adds must have been resolved by the time <code>reactimate</code> fires the action (thus the <code>IO</code> type). The only way out I can see is rolling your own version of <code>withArduino</code> that skips the initialisation. From a quick glance at the <a href=\"https://hackage.haskell.org/package/hArduino-0.9/docs/src/System-Hardware-Arduino-Comm.html#withArduino\" rel=\"nofollow\">source</a>, that looks feasible, if very messy.</p>\n\n<p>[*]  Or at least a clean option not involving mutable state, as in the proper answers.</p>\n\n<hr>\n\n<p>Given that Heinrich Apfelmus kindly augmented this answer by proposing an interesting way out, I couldn't help but implement his suggestion. Credit also goes to gelisam, as the scaffolding of his answer saved me quite a bit of time. Beyond the notes below the code block, see <a href=\"http://apfelmus.nfshost.com/blog/2012/06/07-forklift.html\" rel=\"nofollow\">Heinrich's blog</a> for extra commentary on the \"forklift\".</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving, ScopedTypeVariables #-}\n\nimport Control.Monad (join, (&lt;=&lt;), forever)\nimport Control.Concurrent\nimport Data.Word\nimport Text.Printf\nimport Text.Read (readMaybe)\nimport Reactive.Banana\nimport Reactive.Banana.Frameworks\n\nmain :: IO ()\nmain = do\n    let inputPin  = pin 1\n        outputPin = pin 2\n\n        readInputPin = digitalRead inputPin\n        copyPin = digitalWrite outputPin =&lt;&lt; readInputPin\n\n    ard &lt;- newForkLift withArduino\n\n    (lineAddHandler, fireLine) &lt;- newAddHandler\n\n    let networkDescription :: forall t. Frameworks t =&gt; Moment t ()\n        networkDescription = do\n            eLine &lt;- fromAddHandler lineAddHandler\n\n            let eCopyPin = copyPin &lt;$ filterE (\"c\" ==) eLine\n                eReadInputPin = readInputPin &lt;$ filterE (\"i\" ==) eLine\n\n            reactimate $ (printf \"Input pin is on? %s\\n\" . show &lt;=&lt; carry ard)\n                &lt;$&gt; eReadInputPin\n            reactimate $ carry ard\n                &lt;$&gt; eCopyPin\n\n    actuate =&lt;&lt; compile networkDescription\n\n    initialised &lt;- newQSem 0\n    carry ard $ liftIO (signalQSem initialised)\n    waitQSem initialised\n\n    forever $ do\n        putStrLn \"Enter c to copy, i to read input pin.\"\n        fireLine =&lt;&lt; getLine\n\n-- Heinrich's forklift.\n\ndata ForkLift m = ForkLift { requests :: Chan (m ()) }\n\nnewForkLift :: MonadIO m\n            =&gt; (m () -&gt; IO ()) -&gt; IO (ForkLift m)\nnewForkLift unlift = do\n    channel &lt;- newChan\n    let loop = forever . join . liftIO $ readChan channel\n    forkIO $ unlift loop\n    return $ ForkLift channel\n\ncarry :: MonadIO m =&gt; ForkLift m -&gt; m a -&gt; IO a\ncarry forklift act = do\n    ref &lt;- newEmptyMVar\n    writeChan (requests forklift) $ do\n        liftIO . putMVar ref =&lt;&lt; act\n    takeMVar ref\n\n-- Mock-up lifted from gelisam's answer.\n-- Please pretend that Arduino is abstract.\n\nnewtype Arduino a = Arduino { unArduino :: IO a }\n  deriving (Functor, Applicative, Monad, MonadIO)\n\nnewtype Pin = Pin Word8\n\npin :: Word8 -&gt; Pin\npin = Pin\n\ndigitalWrite :: Pin -&gt; Bool -&gt; Arduino ()\ndigitalWrite (Pin n) v = Arduino $ do\n    printf \"Pretend pin %d on the arduino just got turned %s.\\n\"\n           n (if v then \"on\" else \"off\")\n\ndigitalRead :: Pin -&gt; Arduino Bool\ndigitalRead p@(Pin n) = Arduino $ do\n    printf \"We need to pretend we read a value from pin %d.\\n\" n\n    putStrLn \"Should we return True or False?\"\n    line &lt;- getLine\n    case readMaybe line of\n        Just v -&gt; return v\n        Nothing -&gt; do\n            putStrLn \"Bad read, retrying...\"\n            unArduino $ digitalRead p\n\nwithArduino :: Arduino () -&gt; IO ()\nwithArduino (Arduino body) = do\n    putStrLn \"Pretend we're initializing the arduino.\"\n    body\n</code></pre>\n\n<p>Notes:</p>\n\n<ul>\n<li><p>The forklift (here, <code>ard</code>) runs an <code>Arduino</code> loop in a separate thread. <code>carry</code> allows us to send <code>Arduino</code> commands such as <code>readInputPin</code> and <code>copyPin</code> to be executed in this thread via a <code>Chan (Arduino ())</code>.</p></li>\n<li><p>It is just a name, but in any case the argument to <code>newForkLift</code> being called <code>unlift</code> nicely mirrors the discussion above.</p></li>\n<li><p>The communication is bidirectional. <code>carry</code> crafts <code>MVar</code>s that give us access to values returned by the <code>Arduino</code> commands. That allows us to use events like <code>eReadInputPin</code> in an entirely natural way.</p></li>\n<li><p>The layers are cleanly separated. On the one hand, the main loop only fires UI events like <code>eLine</code>, which are then processed by the event network. On the other hand, the <code>Arduino</code> code only communicates with the event network and the main loop through the forklift.</p></li>\n<li><p>Why did I put a <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Concurrent-QSem.html\" rel=\"nofollow\">sempahore</a> in there? I will let you guess what happens if you take it off...</p></li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 1764, "user_id": 2478883, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ys9QL.png?s=128&g=1", "display_name": "Ryoichiro Oka", "link": "https://stackoverflow.com/users/2478883/ryoichiro-oka"}, "edited": false, "score": 0, "creation_date": 1438290674, "post_id": 31715900, "comment_id": 51403658, "body": "I feel a bit wrong using <code>IORef</code> but it seems to be the only solution in this case. Thank you @gelisam!"}], "tags": [], "owner": {"reputation": 775, "user_id": 3286185, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a141681120ffb0004d8d60bb191f89b8?s=128&d=identicon&r=PG", "display_name": "gelisam", "link": "https://stackoverflow.com/users/3286185/gelisam"}, "is_accepted": true, "score": 2, "last_activity_date": 1438234850, "creation_date": 1438234850, "answer_id": 31715900, "question_id": 31689204, "link": "https://stackoverflow.com/questions/31689204/execute-monadio-action-inside-of-reactimate/31715900#31715900", "title": "Execute MonadIO action inside of reactimate", "body": "<blockquote>\n  <p>How would you execute Arduino actions in <code>reactimate</code>?</p>\n</blockquote>\n\n<p>I would cause them to be executed indirectly, by executing an IO action which has an observable side-effect. Then, inside <code>withArduino</code>, I would observe this side-effect and run the corresponding Arduino command.</p>\n\n<p>Here's some example code. First, let's get the imports out of the way.</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving, ScopedTypeVariables #-}\n\nimport Control.Monad.IO.Class\nimport Data.IORef\nimport Data.Word\nimport Reactive.Banana\nimport Reactive.Banana.Frameworks\nimport Text.Printf\n</code></pre>\n\n<p>Since I do not have an arduino, I'll have to mock up a few methods from hArduino.</p>\n\n<pre><code>newtype Arduino a = Arduino (IO a)\n  deriving (Functor, Applicative, Monad, MonadIO)\n\nnewtype Pin = Pin Word8\n\npin :: Word8 -&gt; Pin\npin = Pin\n\ndigitalWrite :: Pin -&gt; Bool -&gt; Arduino ()\ndigitalWrite (Pin n) v = Arduino $ do\n    printf \"Pretend pin %d on the arduino just got turned %s.\\n\"\n           n (if v then \"on\" else \"off\")\n\ndigitalRead :: Pin -&gt; Arduino Bool\ndigitalRead (Pin n) = Arduino $ do\n    printf \"We need to pretend we read a value from pin %d.\\n\" n\n    putStrLn \"Should we return True or False?\"\n    readLn\n\nwithArduino :: Arduino () -&gt; IO ()\nwithArduino (Arduino body) = do\n    putStrLn \"Pretend we're initializing the arduino.\"\n    body\n</code></pre>\n\n<p>In the rest of the code, I'll pretend that the Arduino and Pin types are opaque.</p>\n\n<p>We'll need an event network to transform input events representing signals received from the arduino into output events describing what we want to send to the arduino. To keep things extremely simple, let's receive data from one pin and output the exact same data on another pin.</p>\n\n<pre><code>eventNetwork :: forall t. Event t Bool -&gt; Event t Bool\neventNetwork = id\n</code></pre>\n\n<p>Next, let's connect our event network to the external world. When output events occur, I simply write the value into an IORef, which I'll be able to observe later.</p>\n\n<pre><code>main :: IO ()\nmain = do\n    (inputPinAddHandler, fireInputPin) &lt;- newAddHandler\n    outputRef &lt;- newIORef False\n\n    let networkDescription :: forall t. Frameworks t =&gt; Moment t ()\n        networkDescription = do\n            -- input\n            inputPinE &lt;- fromAddHandler inputPinAddHandler\n\n            -- output\n            let outputPinE = eventNetwork inputPinE\n\n            reactimate $ writeIORef outputRef &lt;$&gt; outputPinE\n    network &lt;- compile networkDescription\n    actuate network\n\n    withArduino $ do\n      let inputPin  = pin 1\n      let outputPin = pin 2\n\n      -- initialize pins here...\n\n      -- main loop\n      loop inputPin outputPin fireInputPin outputRef\n</code></pre>\n\n<p>Note how <code>reactimate</code> and <code>compile</code> are only called once, outside the main loop. Those functions setup your event network, you do not want to call them on every loop.</p>\n\n<p>Finally, we run the main loop.</p>\n\n<pre><code>loop :: Pin\n     -&gt; Pin\n     -&gt; (Bool -&gt; IO ())\n     -&gt; IORef Bool\n     -&gt; Arduino ()\nloop inputPin outputPin fireInputPin outputRef = do\n    -- read the input from the arduino\n    inputValue &lt;- digitalRead inputPin\n\n    -- send the input to the event network\n    liftIO $ fireInputPin inputValue\n\n    -- read the output from the event network\n    outputValue &lt;- liftIO $ readIORef outputRef\n\n    -- send the output to the arduino\n    digitalWrite outputPin outputValue\n\n    loop inputPin outputPin fireInputPin outputRef\n</code></pre>\n\n<p>Note how we use <code>liftIO</code> to interact with the event network from inside an Arduino computation. We call <code>fireInputPin</code> to trigger an input event, the event network causes an output event to be triggered in response, and the <code>writeIORef</code> we gave to <code>reactimate</code> causes the output event's value to be written to the IORef. If the event network was more complicated and the input event did not trigger any output event, the contents of the IORef would remain unchanged. Regardless, we can observe that contents, and use it to determine which Arduino computation to run. In this case, we simply send the output value to a predetermined pin.</p>\n"}], "owner": {"reputation": 1764, "user_id": 2478883, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ys9QL.png?s=128&g=1", "display_name": "Ryoichiro Oka", "link": "https://stackoverflow.com/users/2478883/ryoichiro-oka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 229, "favorite_count": 1, "accepted_answer_id": 31715900, "answer_count": 2, "score": 8, "last_activity_date": 1438646980, "creation_date": 1438128723, "question_id": 31689204, "link": "https://stackoverflow.com/questions/31689204/execute-monadio-action-inside-of-reactimate", "title": "Execute MonadIO action inside of reactimate", "body": "<p>In reactive-banana, I am trying to run <code>reactimate :: Event (IO ()) -&gt; Moment ()</code> with some actions of <code>Arduino</code> in <a href=\"https://hackage.haskell.org/package/hArduino-0.9/docs/System-Hardware-Arduino.html\">hArduino package</a>, an instance of <code>MonadIO</code>. There seems no function of <code>Arduino a -&gt; IO a</code> provided in the package. How would you execute <code>Arduino</code> actions in <code>reactimate</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 5, "creation_date": 1438122111, "post_id": 31688049, "comment_id": 51317972, "body": "N.B.: There are no implicit type conversions in Haskell. <code>String</code> is just a type synonym for <code>[Char]</code>, i.e. literally the same thing. What does happen is specialisation of polymorphic values (e.g. numeric literals), but once a concrete type is picked it won&#39;t change on its own to something else."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1438157937, "post_id": 31688088, "comment_id": 51330144, "body": "Yay for a simple answer and avoiding the temptation to talk about <code>IO</code> and its shenanigans."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 11, "last_activity_date": 1438121834, "creation_date": 1438121834, "answer_id": 31688088, "question_id": 31688049, "link": "https://stackoverflow.com/questions/31688049/putstrln-function-does-not-accept-char-parameter/31688088#31688088", "title": "putStrLn function does not accept [Char] parameter", "body": "<p>Your code doesn't pass <code>\"test\" ++ \"test\"</code> as a parameter. Function application binds tighter than any infix operator. Your code is parsed as</p>\n\n<pre><code>(putStrLn \"test\") ++ \"test\"\n</code></pre>\n\n<p>The error you get refers to the fact that <code>putStrLn</code> does not return a string.</p>\n\n<p>To solve this, write</p>\n\n<pre><code>putStrLn (\"test\" ++ \"test\")\n</code></pre>\n\n<p>Note: <code>String</code> is defined as <code>type String = [Char]</code>, i.e. it's just a different name for the same type.</p>\n"}], "owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 208, "favorite_count": 0, "accepted_answer_id": 31688088, "answer_count": 1, "score": 4, "last_activity_date": 1438121834, "creation_date": 1438121687, "question_id": 31688049, "link": "https://stackoverflow.com/questions/31688049/putstrln-function-does-not-accept-char-parameter", "title": "putStrLn function does not accept [Char] parameter", "body": "<p>Below code : </p>\n\n<pre><code>Prelude&gt; :t putStrLn\nputStrLn :: String -&gt; IO ()\nPrelude&gt; putStrLn \"test\"\ntest\nit :: ()\nPrelude&gt; putStrLn \"test\" ++ \"test\"\n\n&lt;interactive&gt;:25:1:\n    Couldn't match expected type \u2018[Char]\u2019 with actual type \u2018IO ()\u2019\n    In the first argument of \u2018(++)\u2019, namely \u2018putStrLn \"test\"\u2019\n    In the expression: putStrLn \"test\" ++ \"test\"\nPrelude&gt; :t \"test\"\n\"test\" :: [Char]\nPrelude&gt; :t \"test\" ++ \"test\" \n\"test\" ++ \"test\" :: [Char]\nPrelude&gt; \n</code></pre>\n\n<p>I do not understand error : </p>\n\n<pre><code>\" Couldn't match expected type \u2018[Char]\u2019 with actual type \u2018IO ()\u2019\n        In the first argument of \u2018(++)\u2019, namely \u2018putStrLn \"test\"\u2019\n        In the expression: putStrLn \"test\" ++ \"test\"\"\n</code></pre>\n\n<p>As <code>putStrLn</code> accepts a [Char] type as first parameter (I assume its implicitly converted to String ?). But this does not type check if <code>\"test\" ++ \"test\"</code> is passed as parameter, even though <code>\"test\" ++ \"test\"</code> is of type <code>[Char]</code> also ?</p>\n"}, {"tags": ["haskell", "palindrome", "strip"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 5, "creation_date": 1438120681, "post_id": 31687779, "comment_id": 51317384, "body": "<code>isPalindrome . normalise</code>, where you define <code>normalise</code> so that it removes all the cruft you don&#39;t want?"}, {"owner": {"reputation": 133, "user_id": 3050651, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/190a4a029e9f83b6f5a0b29e82f141c3?s=128&d=identicon&r=PG&f=1", "display_name": "jokeSlayer94", "link": "https://stackoverflow.com/users/3050651/jokeslayer94"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1438121483, "post_id": 31687779, "comment_id": 51317713, "body": "ummmmm, Im still a bit new at this. Where did the other answers go? no reason. just curious"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1438121564, "post_id": 31687779, "comment_id": 51317745, "body": "Their authors deleted them. One was clearly wrong, and the other was not as nice as melpomene&#39;s (my <code>normailse</code> is his <code>strip</code>, BTW)."}], "answers": [{"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1438125869, "post_id": 31687860, "comment_id": 51319272, "body": "As a matter of style, the pointfree version is quite idiomatic: <code>isPalindromeStripped = isPalindrome . map toLower . filter isAlphanum</code>."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 5, "last_activity_date": 1438120751, "creation_date": 1438120751, "answer_id": 31687860, "question_id": 31687779, "link": "https://stackoverflow.com/questions/31687779/grammar-stripping-ispalindrome-function-for-haskell/31687860#31687860", "title": "Grammar stripping isPalindrome function for Haskell", "body": "<pre><code>import Data.Char (isAlphaNum, toLower)\n\nisPalindromeStripped :: String -&gt; Bool\nisPalindromeStripped xs = isPalindrome (strip xs)\n\nstrip :: String -&gt; String\nstrip xs = map toLower (filter isAlphaNum xs)\n</code></pre>\n\n<p>This version uses <code>strip</code> to turn <code>\"Madam I'm Adam\"</code> into <code>\"MadamImAdam\"</code> first, then lowercasing it to <code>\"madamimadam\"</code>.</p>\n"}], "owner": {"reputation": 133, "user_id": 3050651, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/190a4a029e9f83b6f5a0b29e82f141c3?s=128&d=identicon&r=PG&f=1", "display_name": "jokeSlayer94", "link": "https://stackoverflow.com/users/3050651/jokeslayer94"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 325, "favorite_count": 1, "accepted_answer_id": 31687860, "answer_count": 1, "score": 1, "last_activity_date": 1438120751, "creation_date": 1438120358, "last_edit_date": 1438120541, "question_id": 31687779, "link": "https://stackoverflow.com/questions/31687779/grammar-stripping-ispalindrome-function-for-haskell", "title": "Grammar stripping isPalindrome function for Haskell", "body": "<p>Just to make sure there's no confusion. </p>\n\n<p><strong>I am not asking how to write a regular palindrome finder.</strong></p>\n\n<p>I know that would be a repeat question.</p>\n\n<p>I know that to find a palindrome you use</p>\n\n<pre><code>isPalindrome :: (Eq a) =&gt; [a] -&gt; Bool\nisPalindrome xs = xs == (reverse xs)\n</code></pre>\n\n<p>This would return true for \"madamimadam\".</p>\n\n<p>What I can't figure out is the function that would return true for \"Madam I'm Adam\".</p>\n"}, {"tags": ["debugging", "haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1438118848, "post_id": 31687381, "comment_id": 51316581, "body": "Can you nest an unboxed type inside another unboxed type?  So you could have a <code>Node3 Int Int Int</code> with <code>Node7 Node3 Node3 Int</code>.  I&#39;ve never used that functionality so I have no idea if this is possible."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1438118944, "post_id": 31687381, "comment_id": 51316632, "body": "The problem (it seems) is that Haskell doesn&#39;t recognize the 7-tuple as Unbox (?), so it wouldn&#39;t really help how I organize the ints on the original type."}], "answers": [{"tags": [], "owner": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "is_accepted": true, "score": 9, "last_activity_date": 1438119690, "creation_date": 1438119690, "answer_id": 31687631, "question_id": 31687381, "link": "https://stackoverflow.com/questions/31687381/derivingunbox-doesnt-work-for-types-with-more-than-6-ints/31687631#31687631", "title": "`derivingUnbox` doesn&#39;t work for types with more than 6 Ints", "body": "<p>I believe this is because under the hood the <code>vector-th-unbox</code> library converts your data type with N fields into an N-tuple and then uses the <code>Unbox</code> instance provided by the <code>vector</code> library for N-tuples.  The reason this fails for 7-tuples is that the <code>vector</code> library only provides instances up to 6-tuples.</p>\n\n<p>The fix is to either:</p>\n\n<p>(A) Update the <code>vector-th-unbox</code> library to not use the tuple intermediate workaround to derive <code>Unbox</code> instances and instead just derive the <code>Unbox</code> instance directly or:</p>\n\n<p>(B) Add <code>Unbox</code> instances for larger tuples to the <code>vector</code> library</p>\n\n<p>Solution (A) is the better solution in the long run.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "accepted_answer_id": 31687631, "answer_count": 1, "score": 6, "last_activity_date": 1438119690, "creation_date": 1438118674, "last_edit_date": 1438118969, "question_id": 31687381, "link": "https://stackoverflow.com/questions/31687381/derivingunbox-doesnt-work-for-types-with-more-than-6-ints", "title": "`derivingUnbox` doesn&#39;t work for types with more than 6 Ints", "body": "<p>This program:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses, TemplateHaskell, TypeFamilies #-}\n\nimport Data.Vector.Unboxed.Deriving\n\ndata Node = Node Int Int Int Int Int Int Int deriving (Show)\nderivingUnbox \"Node\"\n    [t| Node -&gt; (Int, Int, Int, Int, Int, Int, Int) |]\n    [| \\ (Node a b c d e f g) -&gt; (a,b,c,d,e,f,g) |]\n    [| \\ (a,b,c,d,e,f,g) -&gt; Node a b c d e f g |]\n\nmain = print 7\n</code></pre>\n\n<p>Fails to compile, with this error message:</p>\n\n<pre><code>debox_error.hs:6:1:\n    No instance for (Data.Vector.Generic.Base.Vector\n                       Data.Vector.Unboxed.Base.Vector\n                       (Int, Int, Int, Int, Int, Int, Int))\n      arising from a use of \u2018Data.Vector.Generic.Base.basicLength\u2019\n    In the expression: Data.Vector.Generic.Base.basicLength vec_a320\n    In an equation for \u2018basicLength\u2019:\n        basicLength (V_Node vec_a320)\n          = Data.Vector.Generic.Base.basicLength vec_a320\n    In the instance declaration for\n      \u2018Data.Vector.Generic.Base.Vector\n         Data.Vector.Unboxed.Base.Vector Node\u2019\n\ndebox_error.hs:6:1:\n    Could not deduce (Data.Vector.Generic.Base.Vector\n                        Data.Vector.Unboxed.Base.Vector\n                        (Int, Int, Int, Int, Int, Int, Int))\n      arising from a use of \u2018Data.Vector.Generic.Base.basicUnsafeFreeze\u2019\n    from the context (Control.Monad.Primitive.PrimMonad m)\n      bound by the type signature for\n                 basicUnsafeFreeze :: Control.Monad.Primitive.PrimMonad m =&gt;\n                                      Data.Vector.Generic.Base.Mutable\n                                        Data.Vector.Unboxed.Base.Vector\n                                        (Control.Monad.Primitive.PrimState m)\n                                        Node\n                                      -&gt; m (Data.Vector.Unboxed.Base.Vector Node)\n      at debox_error.hs:(6,1)-(9,49)\n    In the second argument of \u2018Control.Monad.liftM\u2019, namely\n      \u2018(Data.Vector.Generic.Base.basicUnsafeFreeze mvec_a31Y)\u2019\n    In the expression:\n      (V_Node\n       `Control.Monad.liftM`\n         (Data.Vector.Generic.Base.basicUnsafeFreeze mvec_a31Y))\n    In an equation for \u2018basicUnsafeFreeze\u2019:\n        basicUnsafeFreeze (MV_Node mvec_a31Y)\n          = (V_Node\n             `Control.Monad.liftM`\n               (Data.Vector.Generic.Base.basicUnsafeFreeze mvec_a31Y))\n\ndebox_error.hs:6:1:\n    Could not deduce (Data.Vector.Generic.Base.Vector\n                        Data.Vector.Unboxed.Base.Vector\n                        (Int, Int, Int, Int, Int, Int, Int))\n      arising from a use of \u2018Data.Vector.Generic.Base.basicUnsafeThaw\u2019\n    from the context (Control.Monad.Primitive.PrimMonad m)\n      bound by the type signature for\n                 basicUnsafeThaw :: Control.Monad.Primitive.PrimMonad m =&gt;\n                                    Data.Vector.Unboxed.Base.Vector Node\n                                    -&gt; m (Data.Vector.Generic.Base.Mutable\n                                            Data.Vector.Unboxed.Base.Vector\n                                            (Control.Monad.Primitive.PrimState m)\n                                            Node)\n      at debox_error.hs:(6,1)-(9,49)\n    In the second argument of \u2018Control.Monad.liftM\u2019, namely\n      \u2018(Data.Vector.Generic.Base.basicUnsafeThaw vec_a320)\u2019\n    In the expression:\n      (MV_Node\n       `Control.Monad.liftM`\n         (Data.Vector.Generic.Base.basicUnsafeThaw vec_a320))\n    In an equation for \u2018basicUnsafeThaw\u2019:\n        basicUnsafeThaw (V_Node vec_a320)\n          = (MV_Node\n             `Control.Monad.liftM`\n               (Data.Vector.Generic.Base.basicUnsafeThaw vec_a320))\n\ndebox_error.hs:6:1:\n    Could not deduce (Data.Vector.Generic.Base.Vector\n                        Data.Vector.Unboxed.Base.Vector\n                        (Int, Int, Int, Int, Int, Int, Int))\n      arising from a use of \u2018Data.Vector.Generic.Base.basicUnsafeIndexM\u2019\n    from the context (Monad m)\n      bound by the type signature for\n                 basicUnsafeIndexM :: Monad m =&gt;\n                                      Data.Vector.Unboxed.Base.Vector Node -&gt; Int -&gt; m Node\n      at debox_error.hs:(6,1)-(9,49)\n    In the second argument of \u2018Control.Monad.liftM\u2019, namely\n      \u2018(Data.Vector.Generic.Base.basicUnsafeIndexM vec_a320 idx_a31W)\u2019\n    In the expression:\n      ((\\ (a_a328, b_a329, c_a32a, d_a32b, e_a32c, f_a32d, g_a32e)\n          -&gt; Node a_a328 b_a329 c_a32a d_a32b e_a32c f_a32d g_a32e)\n       `Control.Monad.liftM`\n         (Data.Vector.Generic.Base.basicUnsafeIndexM vec_a320 idx_a31W))\n    In an equation for \u2018basicUnsafeIndexM\u2019:\n        basicUnsafeIndexM (V_Node vec_a320) idx_a31W\n          = ((\\ (a_a328, b_a329, c_a32a, d_a32b, e_a32c, f_a32d, g_a32e)\n                -&gt; Node a_a328 b_a329 c_a32a d_a32b e_a32c f_a32d g_a32e)\n             `Control.Monad.liftM`\n               (Data.Vector.Generic.Base.basicUnsafeIndexM vec_a320 idx_a31W))\n\ndebox_error.hs:6:1:\n    Could not deduce (Data.Vector.Generic.Base.Vector\n                        Data.Vector.Unboxed.Base.Vector\n                        (Int, Int, Int, Int, Int, Int, Int))\n      arising from a use of \u2018Data.Vector.Generic.Base.basicUnsafeCopy\u2019\n    from the context (Control.Monad.Primitive.PrimMonad m)\n      bound by the type signature for\n                 basicUnsafeCopy :: Control.Monad.Primitive.PrimMonad m =&gt;\n                                    Data.Vector.Generic.Base.Mutable\n                                      Data.Vector.Unboxed.Base.Vector\n                                      (Control.Monad.Primitive.PrimState m)\n                                      Node\n                                    -&gt; Data.Vector.Unboxed.Base.Vector Node -&gt; m ()\n      at debox_error.hs:(6,1)-(9,49)\n    In the expression:\n      Data.Vector.Generic.Base.basicUnsafeCopy mvec_a31Y vec_a320\n    In an equation for \u2018basicUnsafeCopy\u2019:\n        basicUnsafeCopy (MV_Node mvec_a31Y) (V_Node vec_a320)\n          = Data.Vector.Generic.Base.basicUnsafeCopy mvec_a31Y vec_a320\n    In the instance declaration for\n      \u2018Data.Vector.Generic.Base.Vector\n         Data.Vector.Unboxed.Base.Vector Node\u2019\n\ndebox_error.hs:6:1:\n    No instance for (Data.Vector.Generic.Base.Vector\n                       Data.Vector.Unboxed.Base.Vector\n                       (Int, Int, Int, Int, Int, Int, Int))\n      arising from a use of \u2018Data.Vector.Generic.Base.elemseq\u2019\n    In the expression:\n      Data.Vector.Generic.Base.elemseq\n        vec_a320\n        (\\ (Node a_a321 b_a322 c_a323 d_a324 e_a325 f_a326 g_a327)\n           -&gt; (a_a321, b_a322, c_a323, d_a324, e_a325, f_a326, g_a327)\n           val_a32f)\n    In an equation for \u2018elemseq\u2019:\n        elemseq (V_Node vec_a320) val_a32f\n          = Data.Vector.Generic.Base.elemseq\n              vec_a320\n              (\\ (Node a_a321 b_a322 c_a323 d_a324 e_a325 f_a326 g_a327)\n                 -&gt; (a_a321, b_a322, c_a323, d_a324, e_a325, f_a326, g_a327)\n                 val_a32f)\n    In the instance declaration for\n      \u2018Data.Vector.Generic.Base.Vector\n         Data.Vector.Unboxed.Base.Vector Node\u2019\n\ndebox_error.hs:6:1:\n    No instance for (Data.Vector.Generic.Mutable.MVector\n                       Data.Vector.Unboxed.Base.MVector\n                       (Int, Int, Int, Int, Int, Int, Int))\n      arising from a use of \u2018Data.Vector.Generic.Mutable.basicLength\u2019\n    In the expression:\n      Data.Vector.Generic.Mutable.basicLength mvec_a31Y\n    In an equation for \u2018basicLength\u2019:\n        basicLength (MV_Node mvec_a31Y)\n          = Data.Vector.Generic.Mutable.basicLength mvec_a31Y\n    In the instance declaration for\n      \u2018Data.Vector.Generic.Mutable.MVector\n         Data.Vector.Unboxed.Base.MVector Node\u2019\n\ndebox_error.hs:6:1:\n    No instance for (Data.Vector.Generic.Mutable.MVector\n                       Data.Vector.Unboxed.Base.MVector\n                       (Int, Int, Int, Int, Int, Int, Int))\n      arising from a use of \u2018Data.Vector.Generic.Mutable.basicUnsafeSlice\u2019\n    In the first argument of \u2018MV_Node\u2019, namely\n      \u2018Data.Vector.Generic.Mutable.basicUnsafeSlice\n         idx_a31W len_a31X mvec_a31Y\u2019\n    In the expression:\n      MV_Node\n        (Data.Vector.Generic.Mutable.basicUnsafeSlice\n           idx_a31W len_a31X mvec_a31Y)\n    In an equation for \u2018basicUnsafeSlice\u2019:\n        basicUnsafeSlice idx_a31W len_a31X (MV_Node mvec_a31Y)\n          = MV_Node\n              (Data.Vector.Generic.Mutable.basicUnsafeSlice\n                 idx_a31W len_a31X mvec_a31Y)\n\ndebox_error.hs:6:1:\n    No instance for (Data.Vector.Generic.Mutable.MVector\n                       Data.Vector.Unboxed.Base.MVector\n                       (Int, Int, Int, Int, Int, Int, Int))\n      arising from a use of \u2018Data.Vector.Generic.Mutable.basicOverlaps\u2019\n    In the expression:\n      Data.Vector.Generic.Mutable.basicOverlaps mvec_a31Y mvec'_a31Z\n    In an equation for \u2018basicOverlaps\u2019:\n        basicOverlaps (MV_Node mvec_a31Y) (MV_Node mvec'_a31Z)\n          = Data.Vector.Generic.Mutable.basicOverlaps mvec_a31Y mvec'_a31Z\n    In the instance declaration for\n      \u2018Data.Vector.Generic.Mutable.MVector\n         Data.Vector.Unboxed.Base.MVector Node\u2019\n\ndebox_error.hs:6:1:\n    Could not deduce (Data.Vector.Generic.Mutable.MVector\n                        Data.Vector.Unboxed.Base.MVector\n                        (Int, Int, Int, Int, Int, Int, Int))\n      arising from a use of \u2018Data.Vector.Generic.Mutable.basicUnsafeNew\u2019\n    from the context (Control.Monad.Primitive.PrimMonad m)\n      bound by the type signature for\n                 basicUnsafeNew :: Control.Monad.Primitive.PrimMonad m =&gt;\n                                   Int\n                                   -&gt; m (Data.Vector.Unboxed.Base.MVector\n                                           (Control.Monad.Primitive.PrimState m) Node)\n      at debox_error.hs:(6,1)-(9,49)\n    In the second argument of \u2018Control.Monad.liftM\u2019, namely\n      \u2018(Data.Vector.Generic.Mutable.basicUnsafeNew len_a31X)\u2019\n    In the expression:\n      (MV_Node\n       `Control.Monad.liftM`\n         (Data.Vector.Generic.Mutable.basicUnsafeNew len_a31X))\n    In an equation for \u2018basicUnsafeNew\u2019:\n        basicUnsafeNew len_a31X\n          = (MV_Node\n             `Control.Monad.liftM`\n               (Data.Vector.Generic.Mutable.basicUnsafeNew len_a31X))\n\ndebox_error.hs:6:1:\n    Could not deduce (Data.Vector.Generic.Mutable.MVector\n                        Data.Vector.Unboxed.Base.MVector\n                        (Int, Int, Int, Int, Int, Int, Int))\n      arising from a use of \u2018Data.Vector.Generic.Mutable.basicUnsafeReplicate\u2019\n    from the context (Control.Monad.Primitive.PrimMonad m)\n      bound by the type signature for\n                 basicUnsafeReplicate :: Control.Monad.Primitive.PrimMonad m =&gt;\n                                         Int\n                                         -&gt; Node\n                                         -&gt; m (Data.Vector.Unboxed.Base.MVector\n                                                 (Control.Monad.Primitive.PrimState m) Node)\n      at debox_error.hs:(6,1)-(9,49)\n    In the second argument of \u2018Control.Monad.liftM\u2019, namely\n      \u2018(Data.Vector.Generic.Mutable.basicUnsafeReplicate\n          len_a31X\n          (\\ (Node a_a321 b_a322 c_a323 d_a324 e_a325 f_a326 g_a327)\n             -&gt; (a_a321, b_a322, c_a323, d_a324, e_a325, f_a326, g_a327)\n             val_a32f))\u2019\n    In the expression:\n      (MV_Node\n       `Control.Monad.liftM`\n         (Data.Vector.Generic.Mutable.basicUnsafeReplicate\n            len_a31X\n            (\\ (Node a_a321 b_a322 c_a323 d_a324 e_a325 f_a326 g_a327)\n               -&gt; (a_a321, b_a322, c_a323, d_a324, e_a325, f_a326, g_a327)\n               val_a32f)))\n    In an equation for \u2018basicUnsafeReplicate\u2019:\n        basicUnsafeReplicate len_a31X val_a32f\n          = (MV_Node\n             `Control.Monad.liftM`\n               (Data.Vector.Generic.Mutable.basicUnsafeReplicate\n                  len_a31X\n                  (\\ (Node a_a321 b_a322 c_a323 d_a324 e_a325 f_a326 g_a327)\n                     -&gt; (a_a321, b_a322, c_a323, d_a324, e_a325, f_a326, g_a327)\n                     val_a32f)))\n\ndebox_error.hs:6:1:\n    Could not deduce (Data.Vector.Generic.Mutable.MVector\n                        Data.Vector.Unboxed.Base.MVector\n                        (Int, Int, Int, Int, Int, Int, Int))\n      arising from a use of \u2018Data.Vector.Generic.Mutable.basicUnsafeRead\u2019\n    from the context (Control.Monad.Primitive.PrimMonad m)\n      bound by the type signature for\n                 basicUnsafeRead :: Control.Monad.Primitive.PrimMonad m =&gt;\n                                    Data.Vector.Unboxed.Base.MVector\n                                      (Control.Monad.Primitive.PrimState m) Node\n                                    -&gt; Int -&gt; m Node\n      at debox_error.hs:(6,1)-(9,49)\n    In the second argument of \u2018Control.Monad.liftM\u2019, namely\n      \u2018(Data.Vector.Generic.Mutable.basicUnsafeRead mvec_a31Y idx_a31W)\u2019\n    In the expression:\n      ((\\ (a_a328, b_a329, c_a32a, d_a32b, e_a32c, f_a32d, g_a32e)\n          -&gt; Node a_a328 b_a329 c_a32a d_a32b e_a32c f_a32d g_a32e)\n       `Control.Monad.liftM`\n         (Data.Vector.Generic.Mutable.basicUnsafeRead mvec_a31Y idx_a31W))\n    In an equation for \u2018basicUnsafeRead\u2019:\n        basicUnsafeRead (MV_Node mvec_a31Y) idx_a31W\n          = ((\\ (a_a328, b_a329, c_a32a, d_a32b, e_a32c, f_a32d, g_a32e)\n                -&gt; Node a_a328 b_a329 c_a32a d_a32b e_a32c f_a32d g_a32e)\n             `Control.Monad.liftM`\n               (Data.Vector.Generic.Mutable.basicUnsafeRead mvec_a31Y idx_a31W))\n\ndebox_error.hs:6:1:\n    Could not deduce (Data.Vector.Generic.Mutable.MVector\n                        Data.Vector.Unboxed.Base.MVector\n                        (Int, Int, Int, Int, Int, Int, Int))\n      arising from a use of \u2018Data.Vector.Generic.Mutable.basicUnsafeWrite\u2019\n    from the context (Control.Monad.Primitive.PrimMonad m)\n      bound by the type signature for\n                 basicUnsafeWrite :: Control.Monad.Primitive.PrimMonad m =&gt;\n                                     Data.Vector.Unboxed.Base.MVector\n                                       (Control.Monad.Primitive.PrimState m) Node\n                                     -&gt; Int -&gt; Node -&gt; m ()\n      at debox_error.hs:(6,1)-(9,49)\n    In the expression:\n      Data.Vector.Generic.Mutable.basicUnsafeWrite\n        mvec_a31Y\n        idx_a31W\n        (\\ (Node a_a321 b_a322 c_a323 d_a324 e_a325 f_a326 g_a327)\n           -&gt; (a_a321, b_a322, c_a323, d_a324, e_a325, f_a326, g_a327)\n           val_a32f)\n    In an equation for \u2018basicUnsafeWrite\u2019:\n        basicUnsafeWrite (MV_Node mvec_a31Y) idx_a31W val_a32f\n          = Data.Vector.Generic.Mutable.basicUnsafeWrite\n              mvec_a31Y\n              idx_a31W\n              (\\ (Node a_a321 b_a322 c_a323 d_a324 e_a325 f_a326 g_a327)\n                 -&gt; (a_a321, b_a322, c_a323, d_a324, e_a325, f_a326, g_a327)\n                 val_a32f)\n    In the instance declaration for\n      \u2018Data.Vector.Generic.Mutable.MVector\n         Data.Vector.Unboxed.Base.MVector Node\u2019\n\ndebox_error.hs:6:1:\n    Could not deduce (Data.Vector.Generic.Mutable.MVector\n                        Data.Vector.Unboxed.Base.MVector\n                        (Int, Int, Int, Int, Int, Int, Int))\n      arising from a use of \u2018Data.Vector.Generic.Mutable.basicClear\u2019\n    from the context (Control.Monad.Primitive.PrimMonad m)\n      bound by the type signature for\n                 basicClear :: Control.Monad.Primitive.PrimMonad m =&gt;\n                               Data.Vector.Unboxed.Base.MVector\n                                 (Control.Monad.Primitive.PrimState m) Node\n                               -&gt; m ()\n      at debox_error.hs:(6,1)-(9,49)\n    In the expression: Data.Vector.Generic.Mutable.basicClear mvec_a31Y\n    In an equation for \u2018basicClear\u2019:\n        basicClear (MV_Node mvec_a31Y)\n          = Data.Vector.Generic.Mutable.basicClear mvec_a31Y\n    In the instance declaration for\n      \u2018Data.Vector.Generic.Mutable.MVector\n         Data.Vector.Unboxed.Base.MVector Node\u2019\n\ndebox_error.hs:6:1:\n    Could not deduce (Data.Vector.Generic.Mutable.MVector\n                        Data.Vector.Unboxed.Base.MVector\n                        (Int, Int, Int, Int, Int, Int, Int))\n      arising from a use of \u2018Data.Vector.Generic.Mutable.basicSet\u2019\n    from the context (Control.Monad.Primitive.PrimMonad m)\n      bound by the type signature for\n                 basicSet :: Control.Monad.Primitive.PrimMonad m =&gt;\n                             Data.Vector.Unboxed.Base.MVector\n                               (Control.Monad.Primitive.PrimState m) Node\n                             -&gt; Node -&gt; m ()\n      at debox_error.hs:(6,1)-(9,49)\n    In the expression:\n      Data.Vector.Generic.Mutable.basicSet\n        mvec_a31Y\n        (\\ (Node a_a321 b_a322 c_a323 d_a324 e_a325 f_a326 g_a327)\n           -&gt; (a_a321, b_a322, c_a323, d_a324, e_a325, f_a326, g_a327)\n           val_a32f)\n    In an equation for \u2018basicSet\u2019:\n        basicSet (MV_Node mvec_a31Y) val_a32f\n          = Data.Vector.Generic.Mutable.basicSet\n              mvec_a31Y\n              (\\ (Node a_a321 b_a322 c_a323 d_a324 e_a325 f_a326 g_a327)\n                 -&gt; (a_a321, b_a322, c_a323, d_a324, e_a325, f_a326, g_a327)\n                 val_a32f)\n    In the instance declaration for\n      \u2018Data.Vector.Generic.Mutable.MVector\n         Data.Vector.Unboxed.Base.MVector Node\u2019\n\ndebox_error.hs:6:1:\n    Could not deduce (Data.Vector.Generic.Mutable.MVector\n                        Data.Vector.Unboxed.Base.MVector\n                        (Int, Int, Int, Int, Int, Int, Int))\n      arising from a use of \u2018Data.Vector.Generic.Mutable.basicUnsafeCopy\u2019\n    from the context (Control.Monad.Primitive.PrimMonad m)\n      bound by the type signature for\n                 basicUnsafeCopy :: Control.Monad.Primitive.PrimMonad m =&gt;\n                                    Data.Vector.Unboxed.Base.MVector\n                                      (Control.Monad.Primitive.PrimState m) Node\n                                    -&gt; Data.Vector.Unboxed.Base.MVector\n                                         (Control.Monad.Primitive.PrimState m) Node\n                                    -&gt; m ()\n      at debox_error.hs:(6,1)-(9,49)\n    In the expression:\n      Data.Vector.Generic.Mutable.basicUnsafeCopy mvec_a31Y mvec'_a31Z\n    In an equation for \u2018basicUnsafeCopy\u2019:\n        basicUnsafeCopy (MV_Node mvec_a31Y) (MV_Node mvec'_a31Z)\n          = Data.Vector.Generic.Mutable.basicUnsafeCopy mvec_a31Y mvec'_a31Z\n    In the instance declaration for\n      \u2018Data.Vector.Generic.Mutable.MVector\n         Data.Vector.Unboxed.Base.MVector Node\u2019\n\ndebox_error.hs:6:1:\n    Could not deduce (Data.Vector.Generic.Mutable.MVector\n                        Data.Vector.Unboxed.Base.MVector\n                        (Int, Int, Int, Int, Int, Int, Int))\n      arising from a use of \u2018Data.Vector.Generic.Mutable.basicUnsafeMove\u2019\n    from the context (Control.Monad.Primitive.PrimMonad m)\n      bound by the type signature for\n                 basicUnsafeMove :: Control.Monad.Primitive.PrimMonad m =&gt;\n                                    Data.Vector.Unboxed.Base.MVector\n                                      (Control.Monad.Primitive.PrimState m) Node\n                                    -&gt; Data.Vector.Unboxed.Base.MVector\n                                         (Control.Monad.Primitive.PrimState m) Node\n                                    -&gt; m ()\n      at debox_error.hs:(6,1)-(9,49)\n    In the expression:\n      Data.Vector.Generic.Mutable.basicUnsafeMove mvec_a31Y mvec'_a31Z\n    In an equation for \u2018basicUnsafeMove\u2019:\n        basicUnsafeMove (MV_Node mvec_a31Y) (MV_Node mvec'_a31Z)\n          = Data.Vector.Generic.Mutable.basicUnsafeMove mvec_a31Y mvec'_a31Z\n    In the instance declaration for\n      \u2018Data.Vector.Generic.Mutable.MVector\n         Data.Vector.Unboxed.Base.MVector Node\u2019\n\ndebox_error.hs:6:1:\n    Could not deduce (Data.Vector.Generic.Mutable.MVector\n                        Data.Vector.Unboxed.Base.MVector\n                        (Int, Int, Int, Int, Int, Int, Int))\n      arising from a use of \u2018Data.Vector.Generic.Mutable.basicUnsafeGrow\u2019\n    from the context (Control.Monad.Primitive.PrimMonad m)\n      bound by the type signature for\n                 basicUnsafeGrow :: Control.Monad.Primitive.PrimMonad m =&gt;\n                                    Data.Vector.Unboxed.Base.MVector\n                                      (Control.Monad.Primitive.PrimState m) Node\n                                    -&gt; Int\n                                    -&gt; m (Data.Vector.Unboxed.Base.MVector\n                                            (Control.Monad.Primitive.PrimState m) Node)\n      at debox_error.hs:(6,1)-(9,49)\n    In the second argument of \u2018Control.Monad.liftM\u2019, namely\n      \u2018(Data.Vector.Generic.Mutable.basicUnsafeGrow mvec_a31Y len_a31X)\u2019\n    In the expression:\n      (MV_Node\n       `Control.Monad.liftM`\n         (Data.Vector.Generic.Mutable.basicUnsafeGrow mvec_a31Y len_a31X))\n    In an equation for \u2018basicUnsafeGrow\u2019:\n        basicUnsafeGrow (MV_Node mvec_a31Y) len_a31X\n          = (MV_Node\n             `Control.Monad.liftM`\n               (Data.Vector.Generic.Mutable.basicUnsafeGrow mvec_a31Y len_a31X))\n</code></pre>\n\n<p>How can I fix this problem?</p>\n"}, {"tags": ["haskell", "existential-type", "attoparsec"], "comments": [{"owner": {"reputation": 3291, "user_id": 1456761, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/gvNnG.png?s=128&g=1", "display_name": "Tobias Brandt", "link": "https://stackoverflow.com/users/1456761/tobias-brandt"}, "edited": false, "score": 4, "creation_date": 1438112958, "post_id": 31685685, "comment_id": 51313202, "body": "If you really want to use existential quantification, then you need to apply <code>KeyValue</code> immediately in the case branch. For example <code>0 -&gt; takeLine &gt;&gt;= \\val -&gt; KeyValue (key, val)</code>. But you probably just want a sum type."}, {"owner": {"reputation": 97, "user_id": 3649353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c25ebc341e08a9b69e80fcb0d7dbd52?s=128&d=identicon&r=PG&f=1", "display_name": "grwp", "link": "https://stackoverflow.com/users/3649353/grwp"}, "reply_to_user": {"reputation": 3291, "user_id": 1456761, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/gvNnG.png?s=128&g=1", "display_name": "Tobias Brandt", "link": "https://stackoverflow.com/users/1456761/tobias-brandt"}, "edited": false, "score": 0, "creation_date": 1438153629, "post_id": 31685685, "comment_id": 51327549, "body": "Thanks you very much. In fact it was more a syntax error... And by proofreading (again) my question, the file I need to parser was <i>too reduced</i>. Anyway, I need to use a sum of existentials quantifications type, right now!"}], "answers": [{"comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 5, "creation_date": 1438120358, "post_id": 31685791, "comment_id": 51317246, "body": "You can use <code>20 -&gt; Double &lt;$&gt; parseDouble</code> etc."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1440134483, "post_id": 31685791, "comment_id": 52156296, "body": "@&#216;rjanJohansen You&#39;re right; apologies. I don&#39;t know why I wrote that. I&#39;ll delete my earlier comment."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 8, "last_activity_date": 1438113023, "creation_date": 1438113023, "answer_id": 31685791, "question_id": 31685685, "link": "https://stackoverflow.com/questions/31685685/how-attoparsec-can-return-values-of-different-types/31685791#31685791", "title": "How attoparsec can return values of different types?", "body": "<p>Create a sum type and have your parser return that, e.g.:</p>\n\n<pre><code>data SumType = Str String | Int Int | Double Double\n\nkeyvalue :: Parser SumType\nkeyvalue = ...\n</code></pre>\n\n<p>Now <code>keyvalue</code> can end with <code>return (Str \"foo\")</code> to indicate that a string has been parsed or with <code>return (Int 23)</code>, etc. to indicate that an int has been parsed.</p>\n\n<p>E.g. something like:</p>\n\n<pre><code>keyValue = do\n    key &lt;- decimal &lt;* endOfLine\n    case key of\n      20 -&gt; do d &lt;- parseDouble; return (Double d)\n      70 -&gt; do i &lt;- parseInt; return (Int i)\n      ...\n</code></pre>\n"}], "owner": {"reputation": 97, "user_id": 3649353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c25ebc341e08a9b69e80fcb0d7dbd52?s=128&d=identicon&r=PG&f=1", "display_name": "grwp", "link": "https://stackoverflow.com/users/3649353/grwp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 31685791, "answer_count": 1, "score": 2, "last_activity_date": 1438113023, "creation_date": 1438112666, "question_id": 31685685, "link": "https://stackoverflow.com/questions/31685685/how-attoparsec-can-return-values-of-different-types", "title": "How attoparsec can return values of different types?", "body": "<p>I'm stuck with attoparsec where I can't return a value regarding it's \"embedded type\".</p>\n\n<p>I attempt to parse a file of kind:</p>\n\n<pre><code>type\nvalue\ntype\nvalue\n...\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>0 -- code for a string value\nhello\n70 -- code for an int value\n10\n0\nworld\n20 -- code for a double value\n5.20\n</code></pre>\n\n<p>My current data types are:</p>\n\n<pre><code>data KeyValue = forall a. (Typeable a, Show a, Eq a) =&gt; KeyValue (Int, a)\ninstance Eq KeyValue where -- as I need to test equality\n    KeyValue (code1, value1) == KeyValue (code2, value2) =\n      code1 == code2 &amp;&amp; case cast value2 of\n                               Just value2' -&gt; value1 == value2\n                               Nohing -&gt; False\n</code></pre>\n\n<p>My parser looks like:</p>\n\n<pre><code>parser :: Parser [KeyValue]\nparser = many' (keyValue &lt;* endOfLine)\n\nkeyValue :: Parser KeyValue\nkeyValue = do\n    key &lt;- decimal &lt;* endOfLine\n    value &lt;- case key of\n               0  -&gt; takeLine\n               20 -&gt; double\n               70 -&gt; decimal\n               _ -&gt; takeLine\n    return $ KeyValue (key, value)\n\ntakeLine :: Parser Text\ntakeLine = takeTill isEndOfLine\n</code></pre>\n\n<p>But GHC complains that:</p>\n\n<pre><code>Couldn't match type Double with Text\nExpected type: Parser Text Text\n  Actual type: Parser Double\nIn the expression: double\nIn a case alternative: 20 -&gt; double\n</code></pre>\n\n<p>I understand <em>why</em> but doesn't know <strong>how</strong> to fix that!</p>\n\n<p>At the moment, I use <code>ExistantialQuantification</code> pragma with <code>Data.Typeable</code>, but I'm not really sure the solution need to be <em>\"so complex\"</em> with that problem?</p>\n"}, {"tags": ["haskell", "naming"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1438109580, "post_id": 31684743, "comment_id": 51311261, "body": "I don&#39;t think it has a name but I&#39;d probably call it <code>squash</code>."}, {"owner": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "edited": false, "score": 4, "creation_date": 1438109614, "post_id": 31684743, "comment_id": 51311284, "body": "There&#39;s a POSIX tool named &quot;uniq&quot; that does this for lines of a text file.  Does that count as an &quot;established name&quot;?"}, {"owner": {"reputation": 3291, "user_id": 1456761, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/gvNnG.png?s=128&g=1", "display_name": "Tobias Brandt", "link": "https://stackoverflow.com/users/1456761/tobias-brandt"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1438109624, "post_id": 31684743, "comment_id": 51311291, "body": "@melpomene I like it :-)"}, {"owner": {"reputation": 3291, "user_id": 1456761, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/gvNnG.png?s=128&g=1", "display_name": "Tobias Brandt", "link": "https://stackoverflow.com/users/1456761/tobias-brandt"}, "reply_to_user": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "edited": false, "score": 1, "creation_date": 1438109695, "post_id": 31684743, "comment_id": 51311321, "body": "@jwodder there is a function called <code>uniq</code> in MissingH which does something slightly different. But POSIX certainly preceded it and it&#39;s nice and short."}], "answers": [{"tags": [], "owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "is_accepted": true, "score": 2, "last_activity_date": 1438122888, "creation_date": 1438122888, "answer_id": 31688275, "question_id": 31684743, "link": "https://stackoverflow.com/questions/31684743/is-there-a-name-for-map-head-group/31688275#31688275", "title": "Is there a name for &quot;map head . group&quot;?", "body": "<p>No, such a function is not available in the standard libraries. A quick <a href=\"https://www.haskell.org/hoogle/?hoogle=Eq+a+%3D%3E+%5Ba%5D-%3E%5Ba%5D\" rel=\"nofollow\">Hoogle query</a> reveals that the only other function in the core libraries with the type of <code>Eq a =&gt; [a] -&gt; [a]</code> is <code>nub</code>.</p>\n"}], "owner": {"reputation": 3291, "user_id": 1456761, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/gvNnG.png?s=128&g=1", "display_name": "Tobias Brandt", "link": "https://stackoverflow.com/users/1456761/tobias-brandt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 295, "favorite_count": 0, "accepted_answer_id": 31688275, "answer_count": 1, "score": 4, "last_activity_date": 1438122888, "creation_date": 1438109301, "question_id": 31684743, "link": "https://stackoverflow.com/questions/31684743/is-there-a-name-for-map-head-group", "title": "Is there a name for &quot;map head . group&quot;?", "body": "<p>The function <code>map head . group :: Eq a =&gt; [a] -&gt; [a]</code> collapses equal adjacent values to a single value.\nAs opposed to <code>nub</code>, it does not remove <em>all</em> following equal values.</p>\n\n<p>For example:</p>\n\n<pre><code>nub                [1,1,2,1] == [1,2]\n(map head . group) [1,1,2,1] == [1,2,1]\n</code></pre>\n\n<p>I couldn't find this function in the standard library. Is there an established name for it?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 2, "creation_date": 1438121325, "post_id": 31684508, "comment_id": 51317658, "body": "&quot;reduce&quot;? Which, I think, is used as a synonym for &quot;evaluate&quot; when talking about lambda calculus (e.g <a href=\"https://en.wikipedia.org/wiki/Lambda_calculus#Reduction_strategies\" rel=\"nofollow noreferrer\">here</a>)."}], "answers": [{"tags": [], "owner": {"reputation": 1101, "user_id": 5015957, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1e5002dacf9002752eaa9d37ad13de8?s=128&d=identicon&r=PG&f=1", "display_name": "Huang Chen", "link": "https://stackoverflow.com/users/5015957/huang-chen"}, "is_accepted": true, "score": 1, "last_activity_date": 1438109033, "creation_date": 1438109033, "answer_id": 31684647, "question_id": 31684508, "link": "https://stackoverflow.com/questions/31684508/what-does-the-r-prefix-of-sequential-evaluation-strategies-of-haskell-stand-fo/31684647#31684647", "title": "what does the &#39;r&#39; prefix of sequential evaluation strategies of Haskell stand for?", "body": "<p>I believe it stands for <strong>result</strong> from what I've read in the book <a href=\"https://books.google.com/books?id=iSoRAAAAQBAJ&amp;dq=what%20is%20rseq%20haskell\" rel=\"nofollow\">Parallel and Concurrent Programming in Haskell: Techniques for Multicore and Multithreaded Programming</a></p>\n"}, {"tags": [], "owner": {"reputation": 785, "user_id": 3087558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a43d21bfa85dc7dc360cafa7f69ba3b1?s=128&d=identicon&r=PG&f=1", "display_name": "fgv", "link": "https://stackoverflow.com/users/3087558/fgv"}, "is_accepted": false, "score": 1, "last_activity_date": 1438112882, "creation_date": 1438112882, "answer_id": 31685751, "question_id": 31684508, "link": "https://stackoverflow.com/questions/31684508/what-does-the-r-prefix-of-sequential-evaluation-strategies-of-haskell-stand-fo/31685751#31685751", "title": "what does the &#39;r&#39; prefix of sequential evaluation strategies of Haskell stand for?", "body": "<p>Perhaps it stands for \"run\" or \"runEval\", which may have to do with the fact that <em>r0</em>, <em>rpar</em>, <em>rseq</em>, <em>rdeepseq</em> and related strategies operate in the Eval monad, which uses <em>runEval</em> to extract the value (execute the strategy).</p>\n"}], "owner": {"reputation": 6043, "user_id": 793961, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/367cd54226af527423507c1f89abb25a?s=128&d=identicon&r=PG", "display_name": "muffel", "link": "https://stackoverflow.com/users/793961/muffel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 31684647, "answer_count": 2, "score": 2, "last_activity_date": 1438624891, "creation_date": 1438108566, "last_edit_date": 1438624891, "question_id": 31684508, "link": "https://stackoverflow.com/questions/31684508/what-does-the-r-prefix-of-sequential-evaluation-strategies-of-haskell-stand-fo", "title": "what does the &#39;r&#39; prefix of sequential evaluation strategies of Haskell stand for?", "body": "<p>Functions are often prefixed with <code>r</code> in the <a href=\"http://hackage.haskell.org/package/parallel-3.2.0.6/docs/Control-Seq.html#g:3\" rel=\"nofollow\">basic sequential evaluation strategies</a></p>\n\n<ul>\n<li><code>r0</code></li>\n<li><code>rseq</code></li>\n<li><code>rdeepseq</code></li>\n</ul>\n\n<p>What does the 'r' prefix of in Haskell stand for?</p>\n"}, {"tags": ["haskell", "combinatorics"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1438107601, "post_id": 31684142, "comment_id": 51310085, "body": "<a href=\"http://math.stackexchange.com/\">math.stackexchange.com</a> is a good place for questions which might be too simple for MathOveflow."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1438113956, "post_id": 31684338, "comment_id": 51313877, "body": "I guess your <code>genCoeff</code> needs a <code>sum</code> at the front. Otherwise a nice answer."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1438114907, "post_id": 31684338, "comment_id": 51314395, "body": "@DanielWagner Thanks for catching that!"}, {"owner": {"reputation": 726, "user_id": 1241445, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/sAWfj.png?s=128&g=1", "display_name": "sacheie", "link": "https://stackoverflow.com/users/1241445/sacheie"}, "edited": false, "score": 0, "creation_date": 1438117103, "post_id": 31684338, "comment_id": 51315695, "body": "Thanks so much, Eric! While I appreciate user5402&#39;s contribution without reverse below, I&#39;ll choose your answer for its enlightening &quot;Notice that the sum of the coefficient indices is constant in each term.&quot; \u2013"}], "tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": true, "score": 4, "last_activity_date": 1438114894, "last_edit_date": 1438114894, "creation_date": 1438108031, "answer_id": 31684338, "question_id": 31684142, "link": "https://stackoverflow.com/questions/31684142/how-do-you-multiply-two-generating-series/31684338#31684338", "title": "How do you multiply two generating series?", "body": "<p>Notice that the sum of the coefficient indices is constant in each term. For example <code>a0*b0 -&gt; 0+0=0</code>, while <code>a0*b1 -&gt; 0+1=1</code> and <code>a1*b0 -&gt; 1+0=1</code>.</p>\n\n<p>Recall the <a href=\"http://mathandmultimedia.com/2010/09/15/sum-first-n-positive-integers/\" rel=\"nofollow\">story of young Gauss</a>, who discovered that by summing a list of consecutive numbers with its reverse, we obtain a list of <em>constants</em>. The same trick applies here. We'll just take the first k <code>a_i</code> and <code>b_i</code> coefficients, reverse the list of <code>b_i</code> coefficients, and take the component-wise product of the lists.</p>\n\n<p>Here's some Haskell code to generate the coefficient of <code>s^i</code> for <code>i&gt;=0</code>, given <code>i</code> and the list of <code>as=[a0,a1,...]</code> and <code>bs=[b0,b1,...]</code>:</p>\n\n<pre><code>genCoeff :: [Double] -&gt; [Double] -&gt; Int -&gt; Double\ngenCoeff as bs i = sum $ zipWith (*) (take (i+1) as) (reverse (take (i+1) bs))\n</code></pre>\n\n<p>To generate all of the coefficients, we simply map the partially applied function <code>genCoeff as bs</code> onto the list <code>[0,1,...]</code>, i.e. </p>\n\n<pre><code>genAllCeoffs :: [Double] -&gt; [Double] -&gt; [Double]\ngenAllCoeffs as bs = map (genCoeff as bs) [0..]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 3, "last_activity_date": 1438109836, "last_edit_date": 1438109836, "creation_date": 1438109493, "answer_id": 31684810, "question_id": 31684142, "link": "https://stackoverflow.com/questions/31684142/how-do-you-multiply-two-generating-series/31684810#31684810", "title": "How do you multiply two generating series?", "body": "<p>Here is a solution which doesn't use <code>reverse</code>:</p>\n\n<pre><code>add [] bs = bs\nadd as [] = as\nadd (a:as) (b:bs) = (a+b) : add as bs\n\nmult :: [Int] -&gt; [Int] -&gt; [Int]\nmult [] bs = []   -- note: [] = 0\nmult as [] = []\nmult (a:as) (b:bs) = (a*b) : add (add (map (*a) bs) (map (*b) as)) (0:mult as bs)\n\ntest1 = do\n  let as = [1,2,3]\n      bs = [4,5]\n  putStrLn $ \"as      = \" ++ show as\n  putStrLn $ \"bs      = \" ++ show bs\n  putStrLn $ \"as * bs = \" ++ show (mult as bs)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>as      = [1,2,3]\nbs      = [4,5]\nas * bs = [4,13,22,15]\n</code></pre>\n\n<p>It was derived from the following identity:</p>\n\n<pre><code>(a0+a1*x) * (b0 + b1*x) = a0*b0 + a0*b1*x + b0*a1*x + a1*b1*x^2\n</code></pre>\n\n<p>The correspondences are:</p>\n\n<pre><code>a0*b0          &lt;-&gt; a*b\na0*b1*x        &lt;-&gt; map (*a) bs\nb0*a1*x        &lt;-&gt; map (*b) as\na1*b1*x^2      &lt;-&gt; (0:mult as bs)\n</code></pre>\n"}], "owner": {"reputation": 726, "user_id": 1241445, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/sAWfj.png?s=128&g=1", "display_name": "sacheie", "link": "https://stackoverflow.com/users/1241445/sacheie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "accepted_answer_id": 31684338, "answer_count": 2, "score": 2, "last_activity_date": 1438114894, "creation_date": 1438107366, "question_id": 31684142, "link": "https://stackoverflow.com/questions/31684142/how-do-you-multiply-two-generating-series", "title": "How do you multiply two generating series?", "body": "<p>Forgive me if this is better suited to MathOverflow, but my question is probably too simple to put there.</p>\n\n<p>I'm reading S.K Lando's <em>Lectures on Generating Functions</em>, which gives this definition of the product of two generating functions <strong>A</strong> and <strong>B</strong>:</p>\n\n<p><code>A(s)*B(s) = a0*b0 + (a0*b1 + a1*b0)*s + (a0*b2 + a1*b1 + a2*b0)*s^2 ...</code></p>\n\n<p>I understand that the <strong><em>s</em></strong> is just formal. But - and I know it's obtuse of me - I can't understand how the pattern of terms combining coefficients should continue. If anyone could just extend the definition to one or two more terms, it would probably help me a lot. Many thanks!</p>\n\n<p>For bonus points, an algorithm in Haskell for multiplying two series (represented as lists of coefficients) would be much appreciated too - but it'd be enough for me just to understand the above definition.</p>\n"}, {"tags": ["haskell", "quicksort"], "comments": [{"owner": {"reputation": 506, "user_id": 1843031, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/f4ddb6896be859aaee47851f7f9c13a6?s=128&d=identicon&r=PG", "display_name": "Francesco Bertolaccini", "link": "https://stackoverflow.com/users/1843031/francesco-bertolaccini"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1438101171, "post_id": 31681778, "comment_id": 51306022, "body": "Isn&#39;t the whole point of doing FP to avoid side-effects and, by extension, in-place algorithms?"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 4, "creation_date": 1438101179, "post_id": 31681778, "comment_id": 51306031, "body": "The &quot;problem&quot; seems to be that some people believe that you can&#39;t call it &quot;quicksort&quot; if it isn&#39;t an in-place algorithm. For some reason."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1438102358, "post_id": 31681778, "comment_id": 51306817, "body": "[1] <a href=\"http://stackoverflow.com/users/649287/augustss\">The author of that post</a> was just having fun implementing the in-place quicksort in a way that looks a lot like C. [2] A second inefficiency of the one-liner quicksort is using <code>(++)</code> to build the intermediate lists. [3] For an efficient implementation without mutability, you can look at the <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/src/Data-OldList.html#sort\" rel=\"nofollow noreferrer\"><code>qsort</code> commented out in <code>Data.List</code></a>, which amusingly was originally written by Lennart Augustsson as well."}, {"owner": {"reputation": 506, "user_id": 1843031, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/f4ddb6896be859aaee47851f7f9c13a6?s=128&d=identicon&r=PG", "display_name": "Francesco Bertolaccini", "link": "https://stackoverflow.com/users/1843031/francesco-bertolaccini"}, "edited": false, "score": 1, "creation_date": 1438102512, "post_id": 31681778, "comment_id": 51306908, "body": "Wait, isn&#39;t he the one behind Haskell as well? Man... I should&#39;t have let that glob of code frighten me that much..."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 4, "creation_date": 1438102727, "post_id": 31681778, "comment_id": 51307045, "body": "Note that your <code>filter&#39;</code> function already exists as <code>partition</code> in the <code>Data.List</code> module."}, {"owner": {"reputation": 506, "user_id": 1843031, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/f4ddb6896be859aaee47851f7f9c13a6?s=128&d=identicon&r=PG", "display_name": "Francesco Bertolaccini", "link": "https://stackoverflow.com/users/1843031/francesco-bertolaccini"}, "edited": false, "score": 0, "creation_date": 1438102896, "post_id": 31681778, "comment_id": 51307131, "body": "Yeah, I had the feeling I was re-doing something already implemented, but as I said, I am currently learning Haskell; I took this as an exercise of functional-thinking :)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1438105311, "post_id": 31681778, "comment_id": 51308646, "body": "For &quot;how does it compare functionally&quot;, try <a href=\"http://hackage.haskell.org/package/QuickCheck\" rel=\"nofollow noreferrer\">QuickCheck</a>. For &quot;how does it compare in speed&quot;, try <a href=\"http://hackage.haskell.org/package/criterion\" rel=\"nofollow noreferrer\">criterion</a>."}, {"owner": {"reputation": 506, "user_id": 1843031, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/f4ddb6896be859aaee47851f7f9c13a6?s=128&d=identicon&r=PG", "display_name": "Francesco Bertolaccini", "link": "https://stackoverflow.com/users/1843031/francesco-bertolaccini"}, "edited": false, "score": 0, "creation_date": 1438105417, "post_id": 31681778, "comment_id": 51308737, "body": "I shall do it as soon as I have a Haskell compiler available! Thanks for the suggestions"}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 5, "creation_date": 1438113727, "post_id": 31684949, "comment_id": 51313700, "body": "The real problem is not even <code>(++)</code>, but the fact that <code>(++)</code> doesn&#39;t freely re-associate across recursive calls to <code>qsort</code>. This problem can be fixed without defining a new data structure with the standard &quot;difference list&quot; trick. The idea is that we manipulate partially-applied <code>(++)</code> calls (of type <code>[a] -&gt; [a]</code>) rather than flat lists (of type <code>[a]</code>); thus: <code>qsort :: Ord a =&gt; [a] -&gt; ([a] -&gt; [a]); qsort [] = id; qsort (x:xs) = qsort less . (x:) . qsort more where { ... }</code>. (<code>id = ([]++)</code> and <code>(x:) = ([x]++)</code>.) This reassociates all the <code>(++)</code> operations to the right, the efficient direction."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1438115672, "post_id": 31684949, "comment_id": 51314863, "body": "Equivalently to @DanielWagner&#39;s suggestion, use <a href=\"https://hackage.haskell.org/package/dlist-0.3/docs/Data-DList.html\" rel=\"nofollow noreferrer\"><code>Data.DList</code></a> to build the intermediate lists, which provides a nice abstract interface so you don&#39;t even have to see any details of the trick."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1438117968, "post_id": 31684949, "comment_id": 51316133, "body": "Actually the time taken by <code>(++)</code> has no effect on the asymptotic complexity of even the original <code>qsort</code>. At each level the amount of time it takes to recombine the pieces with <code>(++)</code> is no more than it already took to split apart the pieces with <code>partition</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1438167197, "post_id": 31684949, "comment_id": 51336050, "body": "<a href=\"https://stackoverflow.com/questions/7641936/is-it-possible-to-do-quicksort-of-a-list-with-only-one-passing/9550430#9550430\">here&#39;s another version</a> of it that&#39;s supposed to be faster."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1438172089, "post_id": 31684949, "comment_id": 51339318, "body": "@ReidBarton yes, it adds O(n^2) ops where it&#39;s already O(n^2); but it could&#39;ve been O(n), so it&#39;s bound to affect constant factors."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1438181557, "post_id": 31684949, "comment_id": 51346458, "body": "Of course it makes a constant factor difference, but the last paragraph of this answer claims it makes an asymptotic difference. And it&#39;s a fairly popular misconception."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 0, "last_activity_date": 1438110037, "creation_date": 1438110037, "answer_id": 31684949, "question_id": 31681778, "link": "https://stackoverflow.com/questions/31681778/improving-naive-qsort-implementation/31684949#31684949", "title": "Improving naive qsort implementation", "body": "<p>Here's a solution I came up with when pondering roughly the same problem (please point out any caveats!). I haven't thought too much about the space-complexity (shouldn't be too terrible though), just the time. The thing that really kills the naive <code>qsort</code> is the <code>O(n)</code> operation <code>(++)</code>. So, lets use a new data structure (which will be foldable) that gives us fast concatenation.</p>\n\n<pre><code>{-# LANGUAGE DeriveFoldable #-}\n\nimport Data.Foldable\nimport Data.List\n\ndata Seq a = (Seq a) :++: (Seq a) | Leaf a | Empty deriving (Foldable)\n</code></pre>\n\n<p>Then, a modified <code>qsort'</code> that returns a <code>Seq a</code> would be</p>\n\n<pre><code>qsort' :: Ord a =&gt; [a] -&gt; Seq a\nqsort' []     = Empty\nqsort' (x:xs) = qsort less :++: Leaf x :++: qsort more\n    where (less, more) = partition (&lt;x)  xs\n</code></pre>\n\n<p>And <code>qsort</code> itself is then just <code>qsort = toList . qsort'</code>.</p>\n\n<p>Note: the fix involving <code>partition</code> gets you a constant factor better, but the <code>++</code> vs <code>:++:</code> means that <code>qsort</code> can now be better than <code>O(n^2)</code>. Also, most sort implementations out there are better than this. The point of this was only to try to mirror as closely as possible the \"naive\" implementation.</p>\n"}], "owner": {"reputation": 506, "user_id": 1843031, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/f4ddb6896be859aaee47851f7f9c13a6?s=128&d=identicon&r=PG", "display_name": "Francesco Bertolaccini", "link": "https://stackoverflow.com/users/1843031/francesco-bertolaccini"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "accepted_answer_id": 31684949, "answer_count": 1, "score": 5, "last_activity_date": 1438119565, "creation_date": 1438099892, "last_edit_date": 1438119565, "question_id": 31681778, "link": "https://stackoverflow.com/questions/31681778/improving-naive-qsort-implementation", "title": "Improving naive qsort implementation", "body": "<p>I am starting to learn Haskell and I've been reading <a href=\"https://wiki.haskell.org/Why_Haskell_Matters\" rel=\"nofollow\">this</a> page on Haskell's wiki, which reports this qsort implementation:</p>\n\n<pre><code> qsort :: (Ord a) =&gt; [a] -&gt; [a]\n qsort []     = []\n qsort (x:xs) = qsort less ++ [x] ++ qsort more\n     where less = filter (&lt;x)  xs\n           more = filter (&gt;=x) xs\n</code></pre>\n\n<p>followed by a warning that this is not the most efficient way to do it, and linking an <a href=\"http://augustss.blogspot.it/2007/08/quicksort-in-haskell-quicksort-is.html\" rel=\"nofollow\">article</a> which shows an incredibly verbose version of the same algorithm. Just by looking at it, I though that that was <em>not</em> what I was learning Haskell for, and I wanted to make a better version of the initial qsort without sacrificing its elegance. I mostly concentrated on eliminating the need to run <code>filter</code> twice every call, and this is what I've come up:</p>\n\n<pre><code>filter' :: (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])\nfilter' _ [] = ([], [])\nfilter' f a = filterInternal a ([], [])\n  where\n    filterInternal [] p = p\n    filterInternal (x:xs) (l, t)\n      | f x       = filterInternal xs (x:l, t)\n      | otherwise = filterInternal xs (l, x:t)\n\nqsort' :: (Ord a) =&gt; [a] -&gt; [a]\nqsort' [] = []\nqsort' (x:xs) = qsort' less ++ [x] ++ qsort' more\n  where\n    (more, less) = filter' (&gt;x) xs\n</code></pre>\n\n<p>But I am not sure this is really better. I mean, it works, but how does it compare to the initial version?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1438096946, "post_id": 31680573, "comment_id": 51302948, "body": "If <a href=\"https://www.haskell.org/platform/\" rel=\"nofollow noreferrer\"><code>ghc-7.8</code> from the Haskell Platform</a> is too old for your tastes, you can get <a href=\"https://www.haskell.org/ghc/download_ghc_7_10_1\" rel=\"nofollow noreferrer\">7.10 binaries right from the GHC page</a>."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1438097427, "post_id": 31680573, "comment_id": 51303331, "body": "If you are familiar with Stackage and comfortable with using <code>.cabal</code> files I would use <code>stack</code>. Instructions are <a href=\"https://github.com/commercialhaskell/stack/wiki/Downloads\" rel=\"nofollow noreferrer\">here</a>"}, {"owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1438098160, "post_id": 31680573, "comment_id": 51303855, "body": "@leftaroundabout, I have 7.6.3, and when I try <code>sudo apt-get install haskell-platoform</code>, it says <code>haskell-platform is already the newest version.</code>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1438098746, "post_id": 31680573, "comment_id": 51304264, "body": "@Jono: alright, Vivid15.04 still has the 2013 Haskell platform (Wily15.10 will <a href=\"http://packages.ubuntu.com/wily/haskell-platform\" rel=\"nofollow noreferrer\">change that</a>). But you can easily <a href=\"https://www.haskell.org/platform/download/2014.2.0.0/haskell-platform-2014.2.0.0-unknown-linux-x86_64.tar.gz\" rel=\"nofollow noreferrer\">install the 2014 one by hand</a>."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1438099046, "post_id": 31680573, "comment_id": 51304495, "body": "there is a ppa: <code>deb-src http:&#47;&#47;ppa.launchpad.net&#47;hvr&#47;ghc&#47;ubuntu trusty main</code> from Herbert V. Rieder for this: <a href=\"https://launchpad.net/~hvr/+archive/ubuntu/ghc\" rel=\"nofollow noreferrer\">launchpad.net/~hvr/+archive/ubuntu/ghc</a> - I think it&#39;s the easiest way if you don&#39;t want to compile it yourself ;)"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1438099970, "post_id": 31680573, "comment_id": 51305205, "body": "Another way would be to use nix-package manager. You can get built binary of compiler and nearly all of the Haskell packages."}, {"owner": {"reputation": 1424, "user_id": 756714, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a0c58c5ad07c97f187f3a9241c4d2639?s=128&d=identicon&r=PG", "display_name": "vivian", "link": "https://stackoverflow.com/users/756714/vivian"}, "edited": false, "score": 0, "creation_date": 1438146026, "post_id": 31680573, "comment_id": 51324234, "body": "<a href=\"http://stackoverflow.com/questions/18415328/how-to-install-haskell-on-linux-debian-wheezy/18415472#18415472\" title=\"how to install haskell on linux debian wheezy\">stackoverflow.com/questions/18415328/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 3291, "user_id": 1456761, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/gvNnG.png?s=128&g=1", "display_name": "Tobias Brandt", "link": "https://stackoverflow.com/users/1456761/tobias-brandt"}, "edited": false, "score": 0, "creation_date": 1438123368, "post_id": 31682051, "comment_id": 51318438, "body": "You can also download the binary distribution from here: <a href=\"https://www.haskell.org/ghc/download_ghc_7_10_1#x86_64linux\" rel=\"nofollow noreferrer\">haskell.org/ghc/download_ghc_7_10_1#x86_64linux</a>. That allows you to have multiple versions of GHC on your system."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1469090717, "post_id": 31682051, "comment_id": 64398293, "body": "does this uninstall the installed version before installing the new one ?"}, {"owner": {"reputation": 1052, "user_id": 371334, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d62591847a676f5ea4a871379a68fee6?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew", "link": "https://stackoverflow.com/users/371334/andrew"}, "edited": false, "score": 0, "creation_date": 1472428128, "post_id": 31682051, "comment_id": 65734014, "body": "PPA page with more info: <a href=\"https://launchpad.net/~hvr/+archive/ubuntu/ghc\" rel=\"nofollow noreferrer\">launchpad.net/~hvr/+archive/ubuntu/ghc</a>"}], "tags": [], "owner": {"reputation": 14562, "user_id": 71116, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/7e3643cd0195fab5a3bfa310b5ea27e7?s=128&d=identicon&r=PG", "display_name": "Michael Steele", "link": "https://stackoverflow.com/users/71116/michael-steele"}, "is_accepted": true, "score": 4, "last_activity_date": 1481879801, "last_edit_date": 1481879801, "creation_date": 1438100755, "answer_id": 31682051, "question_id": 31680573, "link": "https://stackoverflow.com/questions/31680573/how-can-i-install-a-recent-version-of-the-haskell-ghc-compiler-on-ubuntu/31682051#31682051", "title": "How can I install a recent version of the Haskell GHC compiler on Ubuntu?", "body": "<p>There is a PPA with prepackaged binaries for many recent versions of GHC.</p>\n\n<ol>\n<li><p>Add the following to your <code>/etc/apt/sources.list.d/extra-ppas.list</code> file:</p>\n\n<p><code>deb http://ppa.launchpad.net/hvr/ghc/ubuntu vivid main \ndeb-src http://ppa.launchpad.net/hvr/ghc/ubuntu vivid main</code></p></li>\n<li><p>Install one of the PPA's versions of GHC. They are named <code>tool-version</code> while the ones that come with Ubuntu are simply named <code>tool</code>. The most recent at the time of this writing is <code>ghc-7.10.2</code>, for example.</p></li>\n<li><p>GHC will be installed under <code>/opt/ghc/&lt;version&gt;/bin</code>. Add this folder to your path to use that version of GHC.</p></li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 7984, "user_id": 1398282, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/51ad9dc5224b0b292b820eeb71d17c9a?s=128&d=identicon&r=PG", "display_name": "foki", "link": "https://stackoverflow.com/users/1398282/foki"}, "edited": false, "score": 0, "creation_date": 1477161936, "post_id": 31720157, "comment_id": 67657310, "body": "Is not <code>stack setup</code> aimed to do the setup job after changing anything in <code>stack.yaml</code> including ghc version?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2913694"}, "reply_to_user": {"reputation": 7984, "user_id": 1398282, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/51ad9dc5224b0b292b820eeb71d17c9a?s=128&d=identicon&r=PG", "display_name": "foki", "link": "https://stackoverflow.com/users/1398282/foki"}, "edited": false, "score": 0, "creation_date": 1477168926, "post_id": 31720157, "comment_id": 67659520, "body": "@foki <code>stack build --install-ghc</code> will install GHC and build your project, while <code>stack setup</code> will only install GHC. So I suppose I should change my answer to be more exact. We only want the compiler in this question. EDIT: Oh wait, I&#39;ll do both ;) Thanks!"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user2913694"}, "is_accepted": false, "score": 11, "last_activity_date": 1477168972, "last_edit_date": 1477168972, "creation_date": 1438248974, "answer_id": 31720157, "question_id": 31680573, "link": "https://stackoverflow.com/questions/31680573/how-can-i-install-a-recent-version-of-the-haskell-ghc-compiler-on-ubuntu/31720157#31720157", "title": "How can I install a recent version of the Haskell GHC compiler on Ubuntu?", "body": "<p>I highly recommend using <a href=\"https://github.com/commercialhaskell/stack\" rel=\"nofollow\">Stack</a>. It has made my life 110% easier and solves your problem.</p>\n\n<p>You can get <code>GHC 7.8</code> with 1106 packages that won't break (no cabal hell, no cabal sandbox install marathons) or you can get <code>GHC 7.10</code> with 1028 packages - <a href=\"https://www.fpcomplete.com/blog/2015/04/update-ghc-7-10-stackage\" rel=\"nofollow\">source</a>. </p>\n\n<p>You can even run different versions of <code>GHC</code> in different projects! Check the <a href=\"https://github.com/commercialhaskell/stack/wiki/FAQ\" rel=\"nofollow\">FAQ</a> for details. To install if you are on an Ubuntu system, follow the <a href=\"https://github.com/commercialhaskell/stack/wiki/Downloads#ubuntu\" rel=\"nofollow\">installation docs</a>.</p>\n\n<p><strong>Edit</strong>: Just tried to create a new <code>stack</code> project with <code>GHC 7.10</code> and there was a bit more to it than first expected. After installing <code>stack</code> you will run:</p>\n\n<pre><code>stack new\n</code></pre>\n\n<p>Then, you'll need to edit your <code>stack.yaml</code>, and change the default resolver from</p>\n\n<pre><code>resolver: lts-2.19\n</code></pre>\n\n<p>to:</p>\n\n<pre><code>resolver: ghc-7.10\n</code></pre>\n\n<p>Then you can run:</p>\n\n<pre><code>stack setup\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>stack build --install-ghc  # to build as well!\n</code></pre>\n\n<p>and you will have a new <code>stack</code> project with <code>GHC 7.10</code>. Reference for <code>stack.yaml</code> is <a href=\"https://github.com/commercialhaskell/stack/wiki/stack.yaml\" rel=\"nofollow\">here</a>.</p>\n"}], "owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4081, "favorite_count": 4, "accepted_answer_id": 31682051, "answer_count": 2, "score": 10, "last_activity_date": 1481879801, "creation_date": 1438096725, "question_id": 31680573, "link": "https://stackoverflow.com/questions/31680573/how-can-i-install-a-recent-version-of-the-haskell-ghc-compiler-on-ubuntu", "title": "How can I install a recent version of the Haskell GHC compiler on Ubuntu?", "body": "<p>I noticed that I'm running an old version of GHC on Ubuntu 15.04. Can I get a newer one without having to compile it from source? </p>\n"}, {"tags": ["haskell", "arduino", "serial-port"], "comments": [{"owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "edited": false, "score": 2, "creation_date": 1438093778, "post_id": 31678873, "comment_id": 51300256, "body": "Try using <code>putStr</code> instead of <code>print</code>.  You may also need to flush stdout or change the buffering mode to <code>LineBuffering</code>"}, {"owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "edited": false, "score": 0, "creation_date": 1438094276, "post_id": 31678873, "comment_id": 51300657, "body": "Also, you are opening and closing the serial port for every 10 characters.  Is this really what you want to do?"}, {"owner": {"reputation": 6364, "user_id": 288913, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/902e8cc4ad1dab7e25d3a2dc1eac732f?s=128&d=identicon&r=PG", "display_name": "Sarah", "link": "https://stackoverflow.com/users/288913/sarah"}, "reply_to_user": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "edited": false, "score": 0, "creation_date": 1438095116, "post_id": 31678873, "comment_id": 51301408, "body": "@pat : Your second comment is the right one. &quot;\\r\\nNo Forma&quot; is indeed a ByteString of length 10.  The ByteString should probably be parsed into a String (perhaps even using the scary Data.ByteString.Char8, depending on need)"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1438095327, "post_id": 31678873, "comment_id": 51301584, "body": "It&#39;s serial without a notion of start and end of the frame. So you are just off by 1 character."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 6364, "user_id": 288913, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/902e8cc4ad1dab7e25d3a2dc1eac732f?s=128&d=identicon&r=PG", "display_name": "Sarah", "link": "https://stackoverflow.com/users/288913/sarah"}, "edited": false, "score": 1, "creation_date": 1438105061, "post_id": 31678873, "comment_id": 51308499, "body": "@Sarah Opening and closing the port so often is inefficient, but shouldn&#39;t change the meaning of the program much. pat&#39;s first comment is much more important in terms of matching the behavior he wants, in my opinion."}, {"owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "reply_to_user": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "edited": false, "score": 0, "creation_date": 1438124783, "post_id": 31678873, "comment_id": 51318937, "body": "Using <code>B.putStr</code> fixed it. Thanks @pat!"}], "answers": [{"comments": [{"owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "edited": false, "score": 0, "creation_date": 1438124802, "post_id": 31684578, "comment_id": 51318946, "body": "Thanks Elie. This is certainly a very useful answer."}], "tags": [], "owner": {"reputation": 1593, "user_id": 2287402, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Q5Rvg.png?s=128&g=1", "display_name": "Elie G&#233;nard", "link": "https://stackoverflow.com/users/2287402/elie-g%c3%a9nard"}, "is_accepted": false, "score": 2, "last_activity_date": 1438108847, "creation_date": 1438108847, "answer_id": 31684578, "question_id": 31678873, "link": "https://stackoverflow.com/questions/31678873/haskell-serial-received-data-not-printed-correctly/31684578#31684578", "title": "Haskell: Serial received data not printed correctly", "body": "<p>You could just receive characters until you receive a \"\\n\" character. Maybe something like this:</p>\n\n<pre><code>import Control.Monad (forever)\nimport Control.Applicative ((&lt;$&gt;))\nimport Data.ByteString.Char8 (unpack)\nimport System.Hardware.Serialport (SerialPort, openSerial, recv)\n\n-- Read a character from the serial port.\nreceive :: SerialPort -&gt; IO String\nreceive sp = fmap unpack (recv sp 1)\n\n-- Read a line, ending with '\\n'.\nreadLine :: SerialPort -&gt; IO String\nreadLine sp = readLineRec sp [] \n\n-- Recursive function to read a line from the serial port.\nreadLineRec :: SerialPort -&gt; String -&gt; IO String\nreadLineRec sp [] = receive sp &gt;&gt;= readLineRec sp \nreadLineRec sp chars\n    | last chars == '\\n' = return chars\n    | otherwise = (chars ++) &lt;$&gt; receive sp &gt;&gt;= readLineRec sp\n\nmain = do\n    let port = \"/dev/ttyACM0\"\n    s &lt;- openSerial port SerialPortSettings { commSpeed = CS9600,\n                                        bitsPerWord = 8,\n                                        stopb = One,\n                                        parity = NoParity,\n                                        flowControl = NoFlowControl,\n                                        timeout = 10 }\n    forever $ do\n        line &lt;- readLine s\n        print line\n</code></pre>\n\n<p>There is room for improvement, but it works!</p>\n"}, {"tags": [], "owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "is_accepted": true, "score": 0, "last_activity_date": 1438125094, "creation_date": 1438125094, "answer_id": 31688671, "question_id": 31678873, "link": "https://stackoverflow.com/questions/31678873/haskell-serial-received-data-not-printed-correctly/31688671#31688671", "title": "Haskell: Serial received data not printed correctly", "body": "<p>Using <code>B.putStr</code> instead of <code>print</code> fixed the problem.\nThanks to @pat.</p>\n"}], "owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "accepted_answer_id": 31688671, "answer_count": 2, "score": 0, "last_activity_date": 1438125094, "creation_date": 1438092725, "last_edit_date": 1438093355, "question_id": 31678873, "link": "https://stackoverflow.com/questions/31678873/haskell-serial-received-data-not-printed-correctly", "title": "Haskell: Serial received data not printed correctly", "body": "<p>I'm trying to receive data from my Arduino <code>Serial.println(\"No Format\");</code>. When I open arduino-serial-monitor I can see the output how I wanted it.</p>\n\n<pre><code>No Format\nNo Format\n...\n</code></pre>\n\n<p>I use <a href=\"https://hackage.haskell.org/package/serialport-0.4.7/docs/System-Hardware-Serialport.html\" rel=\"nofollow\"> serialport package.</a> But the output printed on ghci is:</p>\n\n<pre><code>*Main&gt; main\n\"\\r\\nNo Forma\"\n\"t\\r\\nNo Form\"\n\"at\\r\\nNo For\"\n\"mat\\r\\nNo Fo\"\n\"rmat\\r\\nNo F\"\n\"ormat\\r\\nNo \"\n\"Format\\r\\nNo\"\n\" Format\\r\\nN\"\n\"o Format\\r\\n\"\n...\n...\n\"\\nNo\"\n\" For\"\n\"mat\\r\"\n\"\\nNo \"\n\"Form\"\n\"at\\r\\n\"\n....\n</code></pre>\n\n<hr>\n\n<p><em>Haskell:</em></p>\n\n<pre><code>import qualified Data.ByteString.Char8 as B\nimport System.Hardware.Serialport\nimport System.IO\nimport Control.Monad\n\nmain :: IO ()\nmain = forever $ do\n  let port = \"/dev/ttyACM0\"\n  s &lt;- openSerial port SerialPortSettings { commSpeed = CS9600,\n                                            bitsPerWord = 8,\n                                            stopb = One,\n                                            parity = NoParity,\n                                            flowControl = NoFlowControl,\n                                            timeout = 10 }\n  recv s 10 &gt;&gt;= print\n  closeSerial s\n</code></pre>\n\n<hr>\n\n<p><em>Arduino:</em></p>\n\n<pre><code>void setup() {\n  Serial.begin(9600);\n}\n\nvoid loop() {\n  Serial.println(\"No Format\");\n}\n</code></pre>\n\n<p>Any help would be awesome. Thanks.</p>\n"}, {"tags": ["haskell", "benchmarking", "binary-search", "criterion"], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 5127763, "user_type": "registered", "profile_image": "https://graph.facebook.com/808600889235341/picture?type=large", "display_name": "MatejKr", "link": "https://stackoverflow.com/users/5127763/matejkr"}, "edited": false, "score": 0, "creation_date": 1438092695, "post_id": 31678686, "comment_id": 51299331, "body": "I yust did it like: bench &quot;1&quot; $ nf (binSear 5452700 0 9999999) arr and it works. Than you"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 95, "user_id": 5127763, "user_type": "registered", "profile_image": "https://graph.facebook.com/808600889235341/picture?type=large", "display_name": "MatejKr", "link": "https://stackoverflow.com/users/5127763/matejkr"}, "edited": false, "score": 0, "creation_date": 1438100232, "post_id": 31678686, "comment_id": 51305388, "body": "@MatejKr I don&#39;t think the reordering was actually necessary in this case. What you need to ensure is that the function cannot do any real work before being applied to the final parameter, because otherwise that work could be cached and Criterion would only really benchmark the <i>first</i> iteration. (That&#39;s also the reason why you have to provide a function and argument separately in the first place.)"}], "tags": [], "owner": {"reputation": 785, "user_id": 3087558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a43d21bfa85dc7dc360cafa7f69ba3b1?s=128&d=identicon&r=PG&f=1", "display_name": "fgv", "link": "https://stackoverflow.com/users/3087558/fgv"}, "is_accepted": true, "score": 2, "last_activity_date": 1438092321, "creation_date": 1438092321, "answer_id": 31678686, "question_id": 31678184, "link": "https://stackoverflow.com/questions/31678184/haskell-criterion-nf-is-applied-to-too-few-arguments/31678686#31678686", "title": "Haskell Criterion - &#39;nf&#39; is applied to too few arguments", "body": "<p>The type of <em>nf</em> is <em>(a->b)->a->b</em>, so it expects two parameters: a function and an input to that function. The function should produce a Benchmarkable. </p>\n\n<p>In your case, you are just passing one parameter to <em>nf</em>: the function itself, but that function is fully applied, so it's not expecting any additional parameter, nor are you passing that extra parameter. In this case, you should partially apply the function and pass that extra parameter to nf. </p>\n\n<p>You may be forced to reorder the parameters of binSear or create a helper lambda to do so, to ensure that the currying happens in the last parameter, and you should pass that parameter to <em>nf</em> outside of the parenthesis.</p>\n"}], "owner": {"reputation": 95, "user_id": 5127763, "user_type": "registered", "profile_image": "https://graph.facebook.com/808600889235341/picture?type=large", "display_name": "MatejKr", "link": "https://stackoverflow.com/users/5127763/matejkr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 269, "favorite_count": 0, "accepted_answer_id": 31678686, "answer_count": 1, "score": 1, "last_activity_date": 1438092321, "creation_date": 1438091215, "question_id": 31678184, "link": "https://stackoverflow.com/questions/31678184/haskell-criterion-nf-is-applied-to-too-few-arguments", "title": "Haskell Criterion - &#39;nf&#39; is applied to too few arguments", "body": "<p>I am a new guy to Haskell. I am working a benchmark(Criteriaon) on binary search algorithm. I keep getting error: 'nf' is applied to too few arguments what am I doing wrong.</p>\n\n<p>Thanks</p>\n\n<pre><code>binSear array serNum lowInx highInx\n   | highInx &lt; lowInx       = -1\n   | array!!sred &gt; serNum = binSear array serNum lowInx (mid-1)\n   | array!!sred &lt; serNum = binSear array serNum (mid+1) highInx\n   | otherwise            = mid\n   where\n   mid = lowInx + ((highInx - lowInx) `div` 2)\n\nmain = do\n        let arr = [1..10000000]\n        defaultMain [\n            bench \"1\" $ nf (binSear arr 54527 0 9999999)\n          ]\n</code></pre>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1438089932, "post_id": 31677603, "comment_id": 51297077, "body": "<code>return a function and two arguments as it&#39;s return values</code> &lt;- this is impossible. You can only match on data constructors, not general expressions. In your example, <code>State</code> and <code>(,)</code> are constructors."}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1438090200, "post_id": 31677603, "comment_id": 51297299, "body": "In <code>(a, newState) = h s</code>, the function <code>h</code> returns a <a href=\"https://en.wikibooks.org/wiki/Haskell/Lists_and_tuples#Tuples\" rel=\"nofollow noreferrer\">tuple</a>..."}, {"owner": {"reputation": 71, "user_id": 3621142, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3EeSP.jpg?s=128&g=1", "display_name": "shimmer", "link": "https://stackoverflow.com/users/3621142/shimmer"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 3, "creation_date": 1438090829, "post_id": 31677603, "comment_id": 51297810, "body": "@melpomene, I think this is the distinction I was looking for, if there is a data constructor on the lhs, then the pattern matching is occuring on the return values of the rhs correct?"}], "answers": [{"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 6, "last_activity_date": 1438092723, "last_edit_date": 1438092723, "creation_date": 1438091327, "answer_id": 31678236, "question_id": 31677603, "link": "https://stackoverflow.com/questions/31677603/haskell-pattern-matching-in-let-on-function-return-vs-function-arguments/31678236#31678236", "title": "Haskell Pattern matching in let on function return vs function arguments", "body": "<p>I believe you're stumbling over the difference between <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-830004.4.3\">function and pattern bindings</a>.</p>\n\n<p>In short, if you have something like \"<em>variable</em> <em>pat1</em> <em>pat2</em> ... =\" (where <em>pat1</em> <em>pat2</em> ... are one or more patterns), it's a function binding; otherwise it's a pattern binding. In the most simple case, <code>x y z = ...</code>, a function binding is just syntactic sugar for a lambda: <code>x = \\y z -&gt; ...</code>.</p>\n\n<p>If it starts with a <code>(</code>, it's not a variable, so the whole thing must be a pattern binding. But even without parens <code>State x</code> is still a pattern binding because <code>State</code> is not a variable (it starts with an uppercase letter so it must be a constructor).</p>\n"}], "owner": {"reputation": 71, "user_id": 3621142, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3EeSP.jpg?s=128&g=1", "display_name": "shimmer", "link": "https://stackoverflow.com/users/3621142/shimmer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 573, "favorite_count": 0, "accepted_answer_id": 31678236, "answer_count": 1, "score": 5, "last_activity_date": 1438092723, "creation_date": 1438089721, "question_id": 31677603, "link": "https://stackoverflow.com/questions/31677603/haskell-pattern-matching-in-let-on-function-return-vs-function-arguments", "title": "Haskell Pattern matching in let on function return vs function arguments", "body": "<p>As a beginner at Haskell I've found it difficult to visually recognize some examples of pattern matching.</p>\n\n<p>It seems that in let bindings sometimes the pattern matching occurs on the lhs when a function is called and the values are bound to variables in the equation on the rhs like in the following code example:</p>\n\n<pre><code>let boot x y z = x * y + z in boot 3 4 2\n</code></pre>\n\n<p>Sometimes however a function will be run in the rhs and the <strong>return</strong> values of that function will be bound to values in the lhs of the equation as in the definition of the State Monad from \"Learn you a Haskell\":</p>\n\n<pre><code>instance Monad (State s) where  \n    return x = State $ \\s -&gt; (x,s)  \n    (State h) &gt;&gt;= f = State $ \\s -&gt; let (a, newState) = h s  \n                                        (State g) = f a  \n                                    in  g newState \n</code></pre>\n\n<p>where the function h is run with the lambda argument s and the return values are bound to (a, newState).</p>\n\n<p>To a new Haskell programmer, this is slightly confusing.  I could imagine a scenario where you might have:</p>\n\n<pre><code>let f a b = g c d in ...\n</code></pre>\n\n<p>where the function g would return a function and two arguments as it's return values.  In this case would the \"f a b\" need to be wrapped in parenthesis for the pattern match to occur?  I'm trying to find a definitive explanation of how the pattern matching occurs.</p>\n\n<p>I have read most of \"Learn You A Haskell For Great Good\", as well as snippets from \"Real World Haskell\" and \"A Gentle Introduction to Haskell\" and I have not found a clear explanation of how to determine if the pattern matching should be occuring on arguments to a function or on the return values of a function. Any help in clearing this up would be appreciated.</p>\n"}, {"tags": ["haskell", "ghc", "cabal", "parsec"], "comments": [{"owner": {"reputation": 3669, "user_id": 4876946, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5dc4839a7e9466d54f3791122f8f5d75?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/4876946/matt"}, "edited": false, "score": 0, "creation_date": 1438092663, "post_id": 31676952, "comment_id": 51299300, "body": "Can you run <code>ghc-pkg list</code> and show the output?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1438094951, "post_id": 31676952, "comment_id": 51301257, "body": "<code>~&#47;.cabal&#47;packages&#47;</code> is just a cache of downloaded tarballs, packages aren&#39;t &quot;installed&quot; there. For example parsec might be there as a side effect of having installed it with a different version of ghc."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1438106808, "post_id": 31676952, "comment_id": 51309646, "body": "&quot;dyn libraries&quot; means dynamic (i.e. shared) libraries. cabal compiles libraries in three main flavours: default (i.e. statically linked), profiling and dynamic. It seems that the whatever procedure you used to install GHC 7.10.1 (instead of the quite old 7.6.3 Ubuntu 14.04 provides) also configured it to use dynamic libraries, but cabal is not configured in the same way."}], "owner": {"reputation": 2875, "user_id": 2299477, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/xppB7.jpg?s=128&g=1", "display_name": "Alaya", "link": "https://stackoverflow.com/users/2299477/alaya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 167, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1438625104, "creation_date": 1438088082, "last_edit_date": 1438625104, "question_id": 31676952, "link": "https://stackoverflow.com/questions/31676952/why-did-ghc-notice-me-about-missing-libraries-while-it-actually-had-been-install", "title": "Why did GHC notice me about missing libraries while it actually had been installed?", "body": "<p>I am learn <code>parsec</code>, however, when I run below code in my <strong>Ubuntu 14.04</strong> laptop with <code>ghc 7.10.1</code>:</p>\n\n<pre><code>import Control.Applicative\nimport Text.ParserCombinators.Parsec\n</code></pre>\n\n<p>I got such error message</p>\n\n<pre><code>fac.hs:2:8:\n    Could not find module \u2018Text.ParserCombinators.Parsec\u2019\n    Perhaps you haven't installed the \"dyn\" libraries for package \u2018parsec-3.1.9@parse_CtL7rSgjxYR5wAnuCckBL7\u2019?\n    Use -v to see a list of the files searched for.\n</code></pre>\n\n<p>However, I did have <code>parsec</code> installed in <code>~/.cabal/packages/hackage.haskell.org/parsec/3.1.9</code>, then why would <code>ghc</code> notify me that it couldn't find the module?</p>\n\n<p>And what does the \"dyn libraries\" mean?</p>\n"}, {"tags": ["haskell", "fixed-point"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1438088013, "post_id": 31675549, "comment_id": 51295673, "body": "You can edit the <code>base</code> version in the cabal file and install it yourself."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1438101511, "post_id": 31675549, "comment_id": 51306233, "body": "Or try the <code>--allow-newer=base</code> option."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1438103272, "post_id": 31675549, "comment_id": 51307381, "body": "If you are going to follow Sibi&#39;s suggestion, you can conveniently get the sources from Hackage with <code>cabal unpack</code>."}, {"owner": {"reputation": 1, "user_id": 5048697, "user_type": "registered", "profile_image": "https://graph.facebook.com/1657894891107457/picture?type=large", "display_name": "Dyson Wilkes", "link": "https://stackoverflow.com/users/5048697/dyson-wilkes"}, "edited": false, "score": 0, "creation_date": 1438162133, "post_id": 31675549, "comment_id": 51332781, "body": "Sibi.  Its not just a case of a cabal constraint.  The code, which I downloaded off the hackage page <a href=\"https://hackage.haskell.org/package/fixed-point-0.5.0.1\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/fixed-point-0.5.0.1</a> does not type check in ghci.  Thanks for the hint though."}], "owner": {"reputation": 1, "user_id": 5048697, "user_type": "registered", "profile_image": "https://graph.facebook.com/1657894891107457/picture?type=large", "display_name": "Dyson Wilkes", "link": "https://stackoverflow.com/users/5048697/dyson-wilkes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1438084454, "creation_date": 1438084454, "question_id": 31675549, "link": "https://stackoverflow.com/questions/31675549/haskell-data-fixed-binary-status", "title": "Haskell Data.Fixed.Binary status", "body": "<p>There is a package in Hackage called Data.Fixed.Binary that I am interested in.  The problem I have is that it appears not to work with recent releases of base. I would like to know if there is a reason against having a this package.  Did I miss a different way to work with fixed point binary values in Haskell?</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 12923, "user_id": 1530508, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fG8z0.png?s=128&g=1", "display_name": "ApproachingDarknessFish", "link": "https://stackoverflow.com/users/1530508/approachingdarknessfish"}, "edited": false, "score": 0, "creation_date": 1438080191, "post_id": 31673823, "comment_id": 51290227, "body": "<code>concatMap</code> concatenates and maps over <code>xs</code> because that&#39;s what&#39;s passed to it. I&#39;m unclear on what&#39;s confusing you here."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 12923, "user_id": 1530508, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fG8z0.png?s=128&g=1", "display_name": "ApproachingDarknessFish", "link": "https://stackoverflow.com/users/1530508/approachingdarknessfish"}, "edited": false, "score": 0, "creation_date": 1438081582, "post_id": 31673823, "comment_id": 51291072, "body": "@TuttiFruttiJacuzzi It&#39;s the recursive definition of <code>xs</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1438114726, "post_id": 31673823, "comment_id": 51314288, "body": "For the direct analogy to the one you understand, it gets evaluated like <code>[1] ++ concatMap (\\x -&gt; [x+1,x*10]) ([1] ++ concatMap (\\x -&gt; [x+1,x*10]) ([1] ++ concatMap (\\x -&gt; [x+1,x*10]) (...)))</code>."}], "answers": [{"tags": [], "owner": {"reputation": 785, "user_id": 3087558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a43d21bfa85dc7dc360cafa7f69ba3b1?s=128&d=identicon&r=PG&f=1", "display_name": "fgv", "link": "https://stackoverflow.com/users/3087558/fgv"}, "is_accepted": false, "score": 1, "last_activity_date": 1438081482, "creation_date": 1438081482, "answer_id": 31674443, "question_id": 31673823, "link": "https://stackoverflow.com/questions/31673823/understanding-concatmap-recursion/31674443#31674443", "title": "Understanding concatMap recursion", "body": "<p>Think of <em>concatMap</em> as a simple composition of <em>concat</em> and <em>map</em> (<em>concat . map</em>). </p>\n\n<p>In this particular case, you are initializing xs with 1. Once you start running your map, it will lift the lambda to operate on 1 (the first position in the list) and create a list containing two values, 2 and 10. Concat just extracts those two values from that list and puts them naked in xs, concatenating them with the existing 1. At this point, xs contains 1, 2 and 10 (<em>xs = [1,2,10]</em>).</p>\n\n<p>Now, xs contains 1, 2 and 10 and map will repeat the process (of course, starting from the second position in the list), now operating on 2 and creating a list containing 3 and 20 and a second list containing 11 and 100 when operating on 10 (third position in the list). Concat will now extract those 4 values and append them to the contents of xs. Now xs contains 1, 2, 10, 3, 20, 11 and 100 (<em>xs = [1,2,10,3,20,11,100]</em>).</p>\n\n<p>And you can rinse and repeat, this time map operating on the fourth position in the list (and every subsequent position), and concat doing its work to remove the new list containers and place the values directly into the top level list. As you can see, this process will generate that infinite list.</p>\n\n<p>Does this help?</p>\n"}, {"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 3, "last_activity_date": 1438084560, "creation_date": 1438084560, "answer_id": 31675593, "question_id": 31673823, "link": "https://stackoverflow.com/questions/31673823/understanding-concatmap-recursion/31675593#31675593", "title": "Understanding concatMap recursion", "body": "<p>Let's try a much simpler example:</p>\n\n<pre><code>let xs = 1 : xs in xs\n</code></pre>\n\n<p>OK, so <code>xs</code> points to a <code>(:)</code> node. The head-pointer from here points to <code>1</code>, and the tail-pointer points to <code>xs</code> (i.e., back to itself). So this is either a circular list, or an infinite list. (Haskell regards the two as the same thing.) So far, so good.</p>\n\n<p>Now, let's try a harder example:</p>\n\n<pre><code>let xs = 1 : map (+1) xs in xs\n</code></pre>\n\n<p>Do you know what this will do?</p>\n\n<p>So <code>xs</code> points to a <code>(:)</code> node. The head-pointer points to 1. The tail-pointer points to the expression <code>map (+1) xs</code>, with <code>xs</code> pointing back to the top again.</p>\n\n<p>If you try to \"look at\" the contents of this list, it will cause the <code>map</code> expression to start executing. The definition of <code>map</code> is</p>\n\n<pre><code>map f js =\n  case js of\n    k:ks -&gt; (f k) : (map f ks)\n    []   -&gt; []\n</code></pre>\n\n<p>So <code>map</code> looks at <code>xs</code> to see if it's <code>[]</code> or <code>(:)</code>. As we know, it's <code>(:)</code>. So the first pattern applies.</p>\n\n<p>What this means is that the entire <code>map (+1) xs</code> expression gets overwritten with <code>(:)</code>, with its head-pointer pointing to <code>(+1) 1</code> and its tail-pointer pointing to <code>map (+1) xs2</code> (with <code>xs2</code> denoting a pointer to the tail of <code>xs</code>).</p>\n\n<p>At this point, inspecting <code>(+1) 1</code> turns it into <code>2</code>. So now we basically have</p>\n\n<pre><code>xs = 1 : 2 : map (+1) xs2\n           ^           |\n           |___________|\n</code></pre>\n\n<p>This cycle repeats as you examine the list. Critically, at every moment <code>map</code> is pointing to a node just before itself. If it ever caught up to itself, you would have a problem. But <code>map</code> only ever looks at nodes we've already calculated, so it's fine.</p>\n\n<p>The net result, then, is <code>xs = 1 : 2 : 3 : 4 : ...</code></p>\n\n<p>If you can understand that, you ought to be able to understand your own more complicated example.</p>\n\n<p>If you <em>want</em> to make your head hurt, try:</p>\n\n<pre><code>fibs = 1 : 1 : zipWith (+) fibs (tail fibs)\n</code></pre>\n\n<p>This is a standard Haskell incantation for spitting out the Fibonacci numbers in O(N) time (rather than O(N*N) as the more obvious recursion would give you).</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1438262469, "last_edit_date": 1438262469, "creation_date": 1438176231, "answer_id": 31701735, "question_id": 31673823, "link": "https://stackoverflow.com/questions/31673823/understanding-concatmap-recursion/31701735#31701735", "title": "Understanding concatMap recursion", "body": "<p>First, what is <code>concat</code>? It concatenates lists, presented to it in a list:</p>\n\n<pre><code>concat [ [1], [2],    [3] ] = [ 1, 2, 3 ]\nconcat [ [1], [2,22], [3] ] = [ 1, 2, 22, 3 ]\n</code></pre>\n\n<p>and so forth. What does <code>map</code> do? It transforms each element in a list it is presented with:</p>\n\n<pre><code>map (1+)               [1, 2, 3] = [ 2, 3, 4 ]\nmap (:[])              [1, 2, 3] = [ [1], [2], [3] ]\nmap (\\x-&gt; [x+1, x*10]) [1, 2, 3] = [ [2,10], [3,20], [4,30] ]\n</code></pre>\n\n<p>But <code>concatMap f xs</code> is the same as <code>concat (map f xs)</code>:</p>\n\n<pre><code>concatMap (\\x-&gt; [x+1, x*10]) [1, 2, 3] \n = concat (map (\\x-&gt; [x+1, x*10]) [1, 2, 3])\n = concat [ [2,10], [3,20], [4,30] ]\n = [ 2,10, 3,20, 4,30 ]\n</code></pre>\n\n<p>But, it doesn't need to see the input list through to its end, in order to proceed, producing its elements one by one. This is because of Haskell's laziness. Simply,</p>\n\n<pre><code>   concat [ [2,10], [3,20], [4,30] ]\n = [ 2,10, 3,20, 4,30 ]\n = [ 2,10] ++ concat [ [3,20], [4,30] ]\n</code></pre>\n\n<p>This means that actually, </p>\n\n<pre><code>concat xs == foldr (++) [] xs\n-- concat [a,b,...,n] = a ++ (b ++ (... ++ (n++[])...))\n</code></pre>\n\n<p>and </p>\n\n<pre><code>concatMap f xs == foldr ((++).f) [] xs\n-- concatMap f [a,b,...,n] = f a ++ (f b ++ (... ++ (f n++[])...))\n</code></pre>\n\n<p>so it does work incrementally. For your example,</p>\n\n<pre><code>let xs = [1] ++ concatMap (\\x -&gt; [x+1,x*10]) xs in xs\n== let xs = [1] ++ foldr ((++).(\\x -&gt; [x+1,x*10])) [] xs in xs\n== let xs = [1] ++ foldr (\\x -&gt; ([x+1,x*10] ++)) [] xs in xs\n== let xs = [1] ++ foldr (\\x r -&gt; x+1 : x*10 : r) [] xs in xs\n</code></pre>\n\n<p>Which simply means: <code>xs</code> is a list, which contains <code>1</code>, and then <code>x+1</code> and <code>x*10</code> for each element <code>x</code> in <em><code>xs</code></em> - <em>from the start again</em>. We could write this down also as</p>\n\n<pre><code>xs = 1 : [y | x &lt;- xs, y &lt;- [x+1, x*10]]\n</code></pre>\n\n<p>So for 1, <em>2</em> and <em>10</em> will be \"appended\" <em>at list's end</em>, then for 2, <em>3</em> and <em>20</em> will be produced, for 10 - <em>11</em> and <em>100</em>, and so on:</p>\n\n<pre><code>xs =   1    a    b    c    d    e    f    g    h ....\n    [2,10]=[a,b]\n   =   1    2   10    c    d    e    f    g    h ....\n          [3,20]=[c,d]\n   =   1    2   10    3   20    e    f    g    h ....\n               [11,100]=[e,f]\n       ....\n</code></pre>\n\n<p>Of course this won't be evaluated on its own; the definition is \"dormant\" until used, e.g. to print the first 6 elements of <code>xs</code>:</p>\n\n<blockquote>\n  <p>Prelude> let xs = 1 : [y | x &lt;- xs, y &lt;- [x+1, x*10]] <br/>\n  Prelude> take 6 xs <br/>\n  [1,2,10,3,20,11]</p>\n</blockquote>\n\n<p>As we can see, what's really been defined here is not an infinite list - there are no infinite things after all - but a process of calculating as much of its elements as might be needed.</p>\n\n<p>Yet another way of writing this definition is</p>\n\n<pre><code>xs = 1 : next xs\n         where\n         next (x:xs) = x+1 : x*10 : next xs\n</code></pre>\n\n<p>where the computation's structure is seen yet clearer: <code>next</code> \"looks back\" into <code>xs</code> as it is being defined, first 1 notch back; then 2; then 3; etc. (because it produces two new list elements for each one it consumes; this definition is thus <em>productive</em>). This is characteristic of a <em>\"corecursive\"</em> definition. Its calculation proceeds as</p>\n\n<pre><code>take 6 xs\n = take 6 xs where xs=1:next xs                   -- next looks 1 element back\n = 1:take 5 xs1 where xs=1:xs1; xs1=next xs\n = 1:take 5 xs1 where xs1=2:10:next xs1                -- 2 elements back\n = 1:2:take 4 xs2 where xs1=2:xs2; xs2=10:next xs1\n = 1:2:10:take 3 xs3 where xs1=2:xs2; xs2=10:xs3; xs3=next xs1\n = 1:2:10:take 3 xs3 where xs2=10:xs3; xs3=3:20:next xs2       -- 3 elements \n = 1:2:10:3:take 2 xs4 where xs2=10:xs3; xs3=3:xs4; xs4=20:next xs2\n = 1:2:10:3:20:take 1 xs5 where xs2=10:xs3; xs3=3:xs4; xs4=20:xs5; xs5=next xs2\n = 1:2:10:3:20:take 1 xs5 where xs3=3:xs4; xs4=20:xs5; xs5=11:100:next xs3     -- 4 \n ....\n</code></pre>\n"}], "owner": {"reputation": 2017, "user_id": 4106994, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/6Y8lC.jpg?s=128&g=1", "display_name": "Afonso Matos", "link": "https://stackoverflow.com/users/4106994/afonso-matos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 557, "favorite_count": 0, "accepted_answer_id": 31675593, "answer_count": 3, "score": 3, "last_activity_date": 1438262469, "creation_date": 1438079645, "question_id": 31673823, "link": "https://stackoverflow.com/questions/31673823/understanding-concatmap-recursion", "title": "Understanding concatMap recursion", "body": "<p>I am overall confused, and looking for a very detailed and explanatory answer, of how this code works:</p>\n\n<pre><code>let xs = [1] ++ concatMap (\\x -&gt; [x+1,x*10]) xs in xs\n</code></pre>\n\n<p>How does concatMap know what to map and concat over?</p>\n\n<p>I understand more basic examples:</p>\n\n<pre><code>let x = [1] ++ x\n</code></pre>\n\n<p>Here it gets evaluated like <code>[1] ++ [1] ++ [1] ..</code></p>\n\n<p>But I don't seem to understand the first example with concatMap. It just doesn't make sense to me. I can work with recursion frequently without problems. However, that one piece of code is very confusing.</p>\n"}, {"tags": ["haskell", "reactive-banana"], "answers": [{"comments": [{"owner": {"reputation": 1764, "user_id": 2478883, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ys9QL.png?s=128&g=1", "display_name": "Ryoichiro Oka", "link": "https://stackoverflow.com/users/2478883/ryoichiro-oka"}, "edited": false, "score": 0, "creation_date": 1438073097, "post_id": 31671203, "comment_id": 51285527, "body": "Thank you @duplode again for your answer, also I really appreciate your in-depth notes. I will look up <code>Arrow</code> as I&#39;ve been interested in it."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 4, "creation_date": 1438073270, "post_id": 31671203, "comment_id": 51285645, "body": "The <code>liftA2 (,)</code> is a red herring, this is just <code>unzipEvent e = (fst &lt;$&gt; e, snd &lt;$&gt; e)</code> written point-free."}, {"owner": {"reputation": 1764, "user_id": 2478883, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ys9QL.png?s=128&g=1", "display_name": "Ryoichiro Oka", "link": "https://stackoverflow.com/users/2478883/ryoichiro-oka"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1438073655, "post_id": 31671203, "comment_id": 51285889, "body": "Thank you @Cactus for the easier looking solution! It was a good experience to follow types of the original combination tho."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1438073787, "post_id": 31671203, "comment_id": 51285986, "body": "@Cactus Quite a bit, indeed. It&#39;s just that my first impulse was doing <code>fmap fst &amp;&amp;&amp; fmap snd</code>, but as <code>Control.Arrow</code> is arguably even more of a red herring I switched to the other point-free spelling."}, {"owner": {"reputation": 1764, "user_id": 2478883, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ys9QL.png?s=128&g=1", "display_name": "Ryoichiro Oka", "link": "https://stackoverflow.com/users/2478883/ryoichiro-oka"}, "edited": false, "score": 0, "creation_date": 1438109878, "post_id": 31671203, "comment_id": 51311431, "body": "Just a relative quick question; how would you go backward, <code>(Event t a, Event t b) -&gt; Event t (a, b)</code>? I tried with <code>liftA2</code> but <code>Event t</code> is not <code>Applicative</code> @duplode"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 1764, "user_id": 2478883, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ys9QL.png?s=128&g=1", "display_name": "Ryoichiro Oka", "link": "https://stackoverflow.com/users/2478883/ryoichiro-oka"}, "edited": false, "score": 1, "creation_date": 1438114276, "post_id": 31671203, "comment_id": 51314043, "body": "@RyoichiroOka Ugly, but should work: <code>fmap (\\(Left x, Right y) -&gt; (x, y)) . uncurry (unionWith (\\(x,_) (y,_) -&gt; (x, y))) . (fmap (dup . Left) *** fmap (dup . Right))</code>, with <code>dup x = (x, x)</code>. I wrote point-free for space; you&#39;ll likely prefer a less compact version. <code>(***)</code> is from Control.Arrow, and <code>unionWith</code> is the one from reactive-banana. For the final extraction from <code>Either</code> (unsafe in principle, but here we know it will work) you can use <code>fromLeft</code> and <code>fromRight</code> from <code>Data.Either.Combinators</code> in the <code>either</code> package. If the types are equal you don&#39;t need the <code>Either</code> tricks."}, {"owner": {"reputation": 1764, "user_id": 2478883, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ys9QL.png?s=128&g=1", "display_name": "Ryoichiro Oka", "link": "https://stackoverflow.com/users/2478883/ryoichiro-oka"}, "edited": false, "score": 0, "creation_date": 1438114632, "post_id": 31671203, "comment_id": 51314227, "body": "Thank you a lot again @duplode :) I will be posting some more questions and I hope you&#39;re still around"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1438115200, "post_id": 31671203, "comment_id": 51314595, "body": "Small correction: it should be <code>fromLeft&#39;</code> and <code>fromRight&#39;</code> instead of <code>fromLeft</code> and <code>fromRight</code> in the comment just above."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 3, "last_activity_date": 1438073937, "last_edit_date": 1438073937, "creation_date": 1438072482, "answer_id": 31671203, "question_id": 31670445, "link": "https://stackoverflow.com/questions/31670445/unzip-an-event-stream-of-tuple-2-into-two-streams/31671203#31671203", "title": "Unzip an event stream of tuple 2 into two streams", "body": "<p>This should work:</p>\n\n<pre><code>import Control.Applicative\n\nunzipEvent :: Event t (a, b) -&gt; (Event t a, Event t b)\nunzipEvent = liftA2 (,) (fmap fst) (fmap snd)\n</code></pre>\n\n<p>Notes:</p>\n\n<ul>\n<li>The <code>liftA2 (,)</code> is general-purpose, as it is merely using the <code>Applicative</code> instance of functions. In this case, an equivalent alternative to it would be <code>(&amp;&amp;&amp;)</code> from <code>Control.Arrow</code>. There is also a less fancy alternative, <code>\\e -&gt; (fst &lt;$&gt; e, snd &lt;$&gt; e)</code>.</li>\n<li>Even if <code>Event t</code> was <code>Traversable</code>, <code>sequenceA</code> wouldn't help. The <code>Functor</code> and <code>Applicative</code> instances for pairs <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/src/GHC-Base.html#line-307\" rel=\"nofollow\">are parametrised only on the second component of the pair</a>. You'd end up with a <code>(a, Event t b)</code> result type, not to mention the <code>Monoid</code> constraint on <code>a</code>.</li>\n</ul>\n"}], "owner": {"reputation": 1764, "user_id": 2478883, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ys9QL.png?s=128&g=1", "display_name": "Ryoichiro Oka", "link": "https://stackoverflow.com/users/2478883/ryoichiro-oka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 31671203, "answer_count": 1, "score": 1, "last_activity_date": 1438073937, "creation_date": 1438070042, "last_edit_date": 1438072922, "question_id": 31670445, "link": "https://stackoverflow.com/questions/31670445/unzip-an-event-stream-of-tuple-2-into-two-streams", "title": "Unzip an event stream of tuple 2 into two streams", "body": "<p>In reactive-banana, given <code>Event t (a, b)</code>, how would you lead it to <code>(Event t a, Event t b)</code>?</p>\n\n<p><code>Traversable#sequence</code> seems to solve it with some instance of <code>Monad</code> for <code>(,)</code> provided, but <code>Event t</code> is only <code>Functor</code>.</p>\n"}, {"tags": ["parsing", "haskell", "parsec"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1438056232, "post_id": 31667034, "comment_id": 51278179, "body": "If <i>all</i> you want to do is separate a string that way, it&#39;s probably easier to use the <a href=\"http://hackage.haskell.org/package/split\" rel=\"nofollow noreferrer\">split</a> package. But it&#39;s likely that&#39;s not all you want to do -- e.g. the pieces between <code>SEP</code> probably have some structure of their own. And then we can&#39;t help you write a parser for that structure, because you haven&#39;t told us what it is!"}, {"owner": {"reputation": 2875, "user_id": 2299477, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/xppB7.jpg?s=128&g=1", "display_name": "Alaya", "link": "https://stackoverflow.com/users/2299477/alaya"}, "edited": false, "score": 1, "creation_date": 1438056354, "post_id": 31667034, "comment_id": 51278209, "body": "No, the purpose of trying to seperate string is to learn parsec library..."}, {"owner": {"reputation": 2875, "user_id": 2299477, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/xppB7.jpg?s=128&g=1", "display_name": "Alaya", "link": "https://stackoverflow.com/users/2299477/alaya"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1438056483, "post_id": 31667034, "comment_id": 51278247, "body": "@duplode, as I want to seperate the string  by &quot;SEP&quot;, I think the parser <code>a_parser</code> should at least succeeds only when the string contains no &quot;SEP&quot; inside"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1438057756, "post_id": 31667034, "comment_id": 51278545, "body": "You are right. I have removed the misleading comment (which I wrote way too quickly)."}, {"owner": {"reputation": 2875, "user_id": 2299477, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/xppB7.jpg?s=128&g=1", "display_name": "Alaya", "link": "https://stackoverflow.com/users/2299477/alaya"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1438260334, "post_id": 31667034, "comment_id": 51384484, "body": "@DanielWagner, I finally realized that I could incorporate <a href=\"http://hackage.haskell.org/package/split-0.2.2/docs/Data-List-Split.html\" rel=\"nofollow noreferrer\">split</a> into parsec by <code>mysep sep = getInput &gt;&gt;= return . DLS.splitOn sep</code>"}], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 4707922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2559cf63cb91a84bb48e37cf1d03fbc5?s=128&d=identicon&r=PG&f=1", "display_name": "kyagrd", "link": "https://stackoverflow.com/users/4707922/kyagrd"}, "is_accepted": false, "score": 1, "last_activity_date": 1438065649, "creation_date": 1438065649, "answer_id": 31669039, "question_id": 31667034, "link": "https://stackoverflow.com/questions/31667034/how-to-use-parsec-to-separate-a-string-by-a-specific-string/31669039#31669039", "title": "How to use Parsec to separate a string by a specific string", "body": "<p>Find a negation of \"SEP\", and let that parser be parseNonSEP.\nIt is theoretically ensured that there parseNonSEP falls under the category of a regular language, because regular languages are closed under negation, and there should be a straigforward way to implement this.</p>\n\n<p>Then,</p>\n\n<p>sepBy pareseNonSEP (string \"SEP\")</p>\n\n<p>will do the job.</p>\n\n<p>Well, what I mentioned above is a rather theoretical approach :)\nMore parsec-style way may be to look ahead the list of input tokens without actually consuming the input and/or use backtracking such as try, notFollowedBy, lookAhead.</p>\n\n<p>See</p>\n\n<p><a href=\"http://hackage.haskell.org/package/parsec-3.1.9/docs/Text-Parsec-Combinator.html\" rel=\"nofollow\">http://hackage.haskell.org/package/parsec-3.1.9/docs/Text-Parsec-Combinator.html</a></p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1438066049, "creation_date": 1438066049, "answer_id": 31669176, "question_id": 31667034, "link": "https://stackoverflow.com/questions/31667034/how-to-use-parsec-to-separate-a-string-by-a-specific-string/31669176#31669176", "title": "How to use Parsec to separate a string by a specific string", "body": "<p>Using <code>manyTill</code> a few times will work:</p>\n\n<pre><code>uptoSEP = manyTill anyChar (eof &lt;|&gt; (string \"SEP\" &gt;&gt; return ()))\n\nsplitSEP = manyTill uptoSEP eof\n</code></pre>\n\n<p>E.g.:</p>\n\n<pre><code>ghci&gt; parseTest splitSEP \"abcSEPdefSEPxyz\"\n[\"abc\",\"def\",\"xyz\"]\n</code></pre>\n\n<p>You'll want to enable the <code>{-# LANGUAGE NoMonomorphismRestriction #-}</code> pragma.</p>\n"}, {"tags": [], "owner": {"reputation": 2875, "user_id": 2299477, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/xppB7.jpg?s=128&g=1", "display_name": "Alaya", "link": "https://stackoverflow.com/users/2299477/alaya"}, "is_accepted": false, "score": 1, "last_activity_date": 1438260243, "creation_date": 1438260243, "answer_id": 31724128, "question_id": 31667034, "link": "https://stackoverflow.com/questions/31667034/how-to-use-parsec-to-separate-a-string-by-a-specific-string/31724128#31724128", "title": "How to use Parsec to separate a string by a specific string", "body": "<p>I finally find a way to incorporate <code>split</code> package into <code>parsec</code>:</p>\n\n<pre><code>module Sep where\nimport Text.ParserCombinators.Parsec\nimport qualified Data.List.Split  as DLS\nmysep :: String -&gt; Parser [String]\nmysep sep = getInput &gt;&gt;= return . DLS.splitOn sep\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2824, "user_id": 187223, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9ab705e8ee51d24c8e52192f7fde8d76?s=128&d=identicon&r=PG", "display_name": "James Brock", "link": "https://stackoverflow.com/users/187223/james-brock"}, "is_accepted": false, "score": 0, "last_activity_date": 1567241283, "creation_date": 1567241283, "answer_id": 57736497, "question_id": 31667034, "link": "https://stackoverflow.com/questions/31667034/how-to-use-parsec-to-separate-a-string-by-a-specific-string/57736497#57736497", "title": "How to use Parsec to separate a string by a specific string", "body": "<p>The <a href=\"https://hackage.haskell.org/package/replace-megaparsec/\" rel=\"nofollow noreferrer\">replace-megaparsec</a>\npackage has a\n<a href=\"https://hackage.haskell.org/package/replace-megaparsec/docs/Replace-Megaparsec.html#v:sepCap\" rel=\"nofollow noreferrer\"><code>sepCap</code></a> combinator for splitting strings and capturing the separation.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Replace.Megaparsec\nimport Text.Megaparsec\n\nparseTest (sepCap (chunk \"SEP\" :: Parsec Void String String)) \"abcSEPdef\"\n</code></pre>\n\n<pre class=\"lang-hs prettyprint-override\"><code>[Left \"abc\",Right \"SEP\",Left \"def\"]\n</code></pre>\n"}], "owner": {"reputation": 2875, "user_id": 2299477, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/xppB7.jpg?s=128&g=1", "display_name": "Alaya", "link": "https://stackoverflow.com/users/2299477/alaya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 1, "accepted_answer_id": 31669176, "answer_count": 4, "score": 2, "last_activity_date": 1567241283, "creation_date": 1438055293, "last_edit_date": 1439811261, "question_id": 31667034, "link": "https://stackoverflow.com/questions/31667034/how-to-use-parsec-to-separate-a-string-by-a-specific-string", "title": "How to use Parsec to separate a string by a specific string", "body": "<p>I am learning parsec, and just encountered the following situation. I want to separate a <code>String</code> into <code>[String]</code> by a specific <code>String</code>; for example, I get <code>\"abcSEPdef</code> , and the separator is \"SEP\", so, after being parsed, I should get a <code>[\"abc\",\"def\"]</code></p>\n\n<p>I believe the parser should look like <code>sepBy a_parser (string \"SEP\")</code>; however, I don't know how the <code>a_parser</code> should be like.</p>\n"}, {"tags": ["linux", "ubuntu", "haskell", "time-tracking", "arbtt"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1438055089, "post_id": 31666611, "comment_id": 51277940, "body": "&quot;All I&#39;ve done to this point is follow the documentation as closely as possible.&quot; Presumably, however, you have customised the <a href=\"http://arbtt.nomeata.de/doc/users_guide/configuration.html\" rel=\"nofollow noreferrer\">example configuration</a> in your tests. If that is the case, can you point out what you have changed? Perhaps there is some mistake in the file which the program does not check for, leading to the crash. (<code>!!</code> is a Haskell operator for accessing a position in a list without bounds checking, so what you see is basically an out-of-bounds error somewhere in the program.)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1438056133, "post_id": 31666611, "comment_id": 51278158, "body": "It would be very helpful to have a detailed list of instructions that could be used to reproduce this error. The shorter the better -- but the most important thing is that it starts from scratch and produces the error every time, so that we can play along at home."}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 2, "creation_date": 1438069752, "post_id": 31666611, "comment_id": 51283647, "body": "It might be a data log corruption. Users occasionally report such errors; I never had them. You can run <code>arbtt-recover</code>  and then move <code>~&#47;.arbtt&#47;capture.log.recovered</code> to <code>~&#47;.arbtt&#47;capture.log</code> and you will likely only lose one corrupt sample. But that\u2019s just fixing symptoms; the cause is still unknown..."}, {"owner": {"reputation": 1178, "user_id": 3750476, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/dIx3o.jpg?s=128&g=1", "display_name": "MMMTroy", "link": "https://stackoverflow.com/users/3750476/mmmtroy"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1438115706, "post_id": 31666611, "comment_id": 51314894, "body": "@duplode I&#39;ve added some samples from my configuration file within my question.  It&#39;s not the entire file, but the rest is just more of the same.  Let me know if this is enough, or if you need me to include the entire file."}, {"owner": {"reputation": 1178, "user_id": 3750476, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/dIx3o.jpg?s=128&g=1", "display_name": "MMMTroy", "link": "https://stackoverflow.com/users/3750476/mmmtroy"}, "reply_to_user": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1438115796, "post_id": 31666611, "comment_id": 51314953, "body": "@JoachimBreitner I have tried this a few times.  I included within my question the error I receive when I run arbtt-recover.  After it&#39;s completed, I still get the same error when I try to run arbtt-stats.  Also arbtt-dump does seem to work most times."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1438115841, "post_id": 31666611, "comment_id": 51314983, "body": "N.B.: Joachim Breitner is the author of arbtt, so his comments on this are authoritative."}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 1, "creation_date": 1438116280, "post_id": 31666611, "comment_id": 51315209, "body": "Did you copy <code>~&#47;.arbtt&#47;capture.log.recovered</code>  to <code>~&#47;.arbtt&#47;capture.log</code> after running <code>arbtt-recover</code>?"}, {"owner": {"reputation": 1178, "user_id": 3750476, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/dIx3o.jpg?s=128&g=1", "display_name": "MMMTroy", "link": "https://stackoverflow.com/users/3750476/mmmtroy"}, "reply_to_user": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1438116532, "post_id": 31666611, "comment_id": 51315364, "body": "@JoachimBreitner after reviewing your answer further I realized I wasn&#39;t actually moving the recovered file to capture.log.  This fixed it for me and arbtt-stats seems to be running again.  Does this mean that one of the entries in my configuration file might be incorrectly setup?"}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1438153965, "post_id": 31666611, "comment_id": 51327724, "body": "No, this is independent of the configuration. It might happen if <code>arbtt-capture</code> gets killed too hard in the wrong moment, for example. I\u2019d be interested in a way to reproduce the problem."}, {"owner": {"reputation": 1178, "user_id": 3750476, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/dIx3o.jpg?s=128&g=1", "display_name": "MMMTroy", "link": "https://stackoverflow.com/users/3750476/mmmtroy"}, "reply_to_user": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1438195654, "post_id": 31666611, "comment_id": 51355579, "body": "@JoachimBreitner I haven&#39;t had this issue happen in about a day now, so I have an idea how you might be able to reproduce the issue.  I forgot that I had both a cron that was running arbtt-capture, as well as another console window running the same command.  Since I killed it in the console and left it solely to the cron, I haven&#39;t had the error since.  Perhaps running two instances of arbtt-capture at once creates the issue?"}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1438206664, "post_id": 31666611, "comment_id": 51361520, "body": "\u201cPerhaps running two instances of arbtt-capture at once creates the issue?\u201d quite possible. Why do you run <code>arbtt-capture</code> from cron? It runs as a daemon, so you should simply start it with your desktop session \u2013 neither from cron nor from the console."}, {"owner": {"reputation": 1178, "user_id": 3750476, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/dIx3o.jpg?s=128&g=1", "display_name": "MMMTroy", "link": "https://stackoverflow.com/users/3750476/mmmtroy"}, "reply_to_user": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1438208727, "post_id": 31666611, "comment_id": 51362363, "body": "@JoachimBreitner I was referencing this article when I set that up.  <a href=\"http://darcs.nomeata.de/arbtt/doc/users_guide/effective-use.html\" rel=\"nofollow noreferrer\">darcs.nomeata.de/arbtt/doc/users_guide/effective-use.html</a>.  It made sense to me to set it up as a cron since in the description it was mentioned &quot;you could also wrap it in an infinite loop to restart the daemon should it ever crash, with a command like&quot;.  Is this ill-advised?"}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 1, "creation_date": 1438242206, "post_id": 31666611, "comment_id": 51372876, "body": "Ah, using it with cron and <code>@reboot</code> should be fine as well. I thought you would run it repeatedly, which should not be necessary."}], "answers": [{"tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": false, "score": 8, "last_activity_date": 1513557178, "last_edit_date": 1513557178, "creation_date": 1438154187, "answer_id": 31693694, "question_id": 31666611, "link": "https://stackoverflow.com/questions/31666611/ubuntu-14-04-arbtt-stats-index-to-large-error/31693694#31693694", "title": "Ubuntu 14.04 arbtt-stats index to large error", "body": "<p>As discussed in the comments: This is a case of a corrupt <code>~/.arbtt/capture.log</code>. You can usually fix this by </p>\n\n<ul>\n<li>running <code>arbtt-recover</code></li>\n<li>and then moving <code>~/.arbtt/capture.log.recovered</code> to <code>~/.arbtt/capture.log</code>.</li>\n</ul>\n\n<p>The second manual step is required to avoid accidentially deleting too much data. You can test that the recovered file is better by making <code>arbtt-stats</code> using the recovered file by passing <code>--logfile=~/.arbtt/capture.log.recovered</code> to it.</p>\n\n<p>Data corruption happens for example when there is an unclean shutdown, or other undetermined reasons. But the log file format is such that even after a corruption (e.g. a partial write of one sample), further samples will be written correctly and should be picked up by <code>arbtt-recover</code>, so you did not lose more than a few samples.</p>\n"}], "owner": {"reputation": 1178, "user_id": 3750476, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/dIx3o.jpg?s=128&g=1", "display_name": "MMMTroy", "link": "https://stackoverflow.com/users/3750476/mmmtroy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 304, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1513557178, "creation_date": 1438052124, "last_edit_date": 1438115533, "question_id": 31666611, "link": "https://stackoverflow.com/questions/31666611/ubuntu-14-04-arbtt-stats-index-to-large-error", "title": "Ubuntu 14.04 arbtt-stats index to large error", "body": "<p>I've recently installed arbtt which seems to be an intersting, rule based, automatic time tracker.  <a href=\"http://arbtt.nomeata.de/#what\" rel=\"nofollow\">http://arbtt.nomeata.de/#what</a></p>\n\n<p>I've got it working for the most part, but after 30 minutes or so of gathering stats, I end up with the following error.</p>\n\n<pre><code>Processing data [=&gt;......................................................................................................................................................................................]   1%\narbtt-stats: Prelude.(!!): index too large\n</code></pre>\n\n<p>Does anyone have any suggestions on ways I can troubleshoot this issue, or better yet, solve it?  I have 0 experience with the coding language used to create the rules (Haskell I believe).  All I've done to this point is follow the documentation as closely as possible.</p>\n\n<p>This error ultimately renders the tool useless since it doesn't gather data any longer than 30 minutes. To fix it, I have to delete the log and start from scratch.  I'm primarily interested in the notion of having a customizable, rule based time tracker but I'm by no means tied to using arbtt.</p>\n\n<p>Based on the comments below, I'm including some more information below.</p>\n\n<p>When I try to run arbtt-recover I get a long list of errors that look like this.  All of them seem to be related to an Unsupported TimeLogEntry.</p>\n\n<pre><code>Trying at position 1726098.\nFailed to read value at position 1726098:\n   Unsupported TimeLogEntry version tag 0\n</code></pre>\n\n<p>As for the configuration file, here is what I have so far.</p>\n\n<pre><code>$idle &gt; 30 ==&gt; tag inactive,\n\n-- A rule that matches on a list of strings\ncurrent window $program == [\"Chrome\", \"Firefox\"] ==&gt; tag Web,\n\ncurrent window $program == [\"skype\"]  ==&gt; tag Skype,\n\ncurrent window $program == [\"jetbrains-phpstorm\"] ==&gt; tag PhpStorm,\n\n( current window $title =~ m!Inbox! ||\n  current window $title =~ m!Outlook! ) ==&gt; tag Emails,\n\n( current window $title =~ m!AdWords! ||\n  current window $title =~ m!Analytics! ) ==&gt; tag Adwords,\n</code></pre>\n\n<p>It goes on further, but I'm fairly confident I've followed this same syntax for all other lines.  The rest of the lines are following the same format but are project/client specific for me.  If required, I'm happy to include the rest of the file.</p>\n"}, {"tags": ["haskell", "parsec"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 9, "last_activity_date": 1438051424, "creation_date": 1438051424, "answer_id": 31666526, "question_id": 31666503, "link": "https://stackoverflow.com/questions/31666503/parsec-combine-two-char-parsers-into-a-string/31666526#31666526", "title": "parsec: combine two char parsers into a string", "body": "<p>Another choice is:</p>\n\n<pre><code>mychar = sequence [char '\\\\', noneof \"u\"]\n</code></pre>\n"}], "owner": {"reputation": 26022, "user_id": 410102, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/a70b7da5a3a712e800100e61ef8d8917?s=128&d=identicon&r=PG", "display_name": "akonsu", "link": "https://stackoverflow.com/users/410102/akonsu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 649, "favorite_count": 1, "accepted_answer_id": 31666526, "answer_count": 1, "score": 5, "last_activity_date": 1438051424, "creation_date": 1438051208, "question_id": 31666503, "link": "https://stackoverflow.com/questions/31666503/parsec-combine-two-char-parsers-into-a-string", "title": "parsec: combine two char parsers into a string", "body": "<p>I am trying to write a parser that glues two characters into a string:</p>\n\n<pre><code>(&lt;:&gt;) = liftM2 (\\a b -&gt; [a, b])\nmychar :: Parser String\nmychar = (char '\\\\') &lt;:&gt; (noneOf \"u\")\n</code></pre>\n\n<p>is it possible to make it more elegant? I am a newbie. Please help.</p>\n"}, {"tags": ["haskell", "cabal"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "edited": false, "score": 0, "creation_date": 1438043845, "post_id": 31665604, "comment_id": 51275458, "body": "yours is the right answer... i will make it as accepted.. but still, i am getting the error - <code>Could not find module \u2018Init\u2019</code>"}, {"owner": {"reputation": 1362, "user_id": 3236557, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/p6V9b.jpg?s=128&g=1", "display_name": "Kirill Zhukov", "link": "https://stackoverflow.com/users/3236557/kirill-zhukov"}, "edited": false, "score": 0, "creation_date": 1438043972, "post_id": 31665604, "comment_id": 51275493, "body": "@MadhavanKumar, code shown above works for me. Just make sure you save changes."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1438043989, "post_id": 31665604, "comment_id": 51275501, "body": "@MadhavanKumar Unless you&#39;re on Windows, the file name&#39;s case also needs to match."}, {"owner": {"reputation": 1362, "user_id": 3236557, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/p6V9b.jpg?s=128&g=1", "display_name": "Kirill Zhukov", "link": "https://stackoverflow.com/users/3236557/kirill-zhukov"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1438044054, "post_id": 31665604, "comment_id": 51275519, "body": "@&#216;rjanJohansen, good point. I have file named <code>init.hs</code> as provided  but I am on OSX."}], "tags": [], "owner": {"reputation": 1362, "user_id": 3236557, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/p6V9b.jpg?s=128&g=1", "display_name": "Kirill Zhukov", "link": "https://stackoverflow.com/users/3236557/kirill-zhukov"}, "is_accepted": true, "score": 7, "last_activity_date": 1438044562, "last_edit_date": 1438044562, "creation_date": 1438043652, "answer_id": 31665604, "question_id": 31665573, "link": "https://stackoverflow.com/questions/31665573/import-module-from-the-current-working-directory/31665604#31665604", "title": "Import module from the current working directory", "body": "<p>Shouldn't module name start with capital letter?\nReplace <code>init</code> with <code>Init</code>:</p>\n\n<pre><code>module Init where\ndata Suite = Clubs | Diamonds | Hearts | Spades deriving (Eq,Ord,Enum,Show)\n</code></pre>\n\n<hr>\n\n<pre><code>module Main where\nimport Init\nmain = do\n  print (fromEnum Clubs)\n</code></pre>\n\n<p><strong>Edit:</strong><br>\nAs mentioned by <a href=\"https://stackoverflow.com/users/1088108/%C3%98rjan-johansen\">\u00d8rjanJohansen</a>:</p>\n\n<blockquote>\n  <p>Usually, the file should be named after the module name, replacing\n  dots in the module name by directory separators.</p>\n</blockquote>\n\n<p><a href=\"https://downloads.haskell.org/~ghc/6.12.1/docs/html/users_guide/separate-compilation.html\" rel=\"nofollow\">Quote source</a></p>\n\n<p>In your case <code>Init.hs</code> should be used.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1675, "favorite_count": 0, "accepted_answer_id": 31665604, "answer_count": 1, "score": 4, "last_activity_date": 1438044562, "creation_date": 1438043387, "question_id": 31665573, "link": "https://stackoverflow.com/questions/31665573/import-module-from-the-current-working-directory", "title": "Import module from the current working directory", "body": "<p><code>init.hs</code> library module has,</p>\n\n<pre><code>module init where\ndata Suite = Clubs | Diamonds | Hearts | Spades deriving (Eq,Ord,Enum,Show)\n</code></pre>\n\n<p>main.hs, the entry module has,</p>\n\n<pre><code>module Main where\nimport init\nmain = do\n  print (fromEnum Clubs)\n</code></pre>\n\n<p>Both the modules are in the same directory and the directory is not part of cabal path. </p>\n\n<p>On doing <code>runhaskell main.hs</code>, it throws error as <code>main.hs:2:8: parse error on input \u2018init\u2019</code>. </p>\n\n<p>What is the proper way to import module in the current working directory without polluting the global PATH/CABAL variables?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 2241, "user_id": 273853, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/cc22d49f04954a5bae58a2e5e2c579bd?s=128&d=identicon&r=PG", "display_name": "Edward Ashak", "link": "https://stackoverflow.com/users/273853/edward-ashak"}, "is_accepted": false, "score": 4, "last_activity_date": 1438038758, "creation_date": 1438038758, "answer_id": 31664865, "question_id": 31664805, "link": "https://stackoverflow.com/questions/31664805/not-in-scope-type-constructor-or-class-clientr/31664865#31664865", "title": "Not in scope: type constructor or class \u2018ClientR\u2019", "body": "<p>The issue was that <code>ClientR</code> was not exposed in the Chapter2.SimpleFunctions module: </p>\n\n<pre><code>module Chapter2.SimpleFunctions\n    (ClientR\n    ) where\n</code></pre>\n"}], "owner": {"reputation": 2241, "user_id": 273853, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/cc22d49f04954a5bae58a2e5e2c579bd?s=128&d=identicon&r=PG", "display_name": "Edward Ashak", "link": "https://stackoverflow.com/users/273853/edward-ashak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1478, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1438038774, "creation_date": 1438038441, "question_id": 31664805, "link": "https://stackoverflow.com/questions/31664805/not-in-scope-type-constructor-or-class-clientr", "title": "Not in scope: type constructor or class \u2018ClientR\u2019", "body": "<p>I'm trying to import a module with some data types into an exercise file\nas shown below:</p>\n\n<pre><code>--SimpleFunctions.hs\n{-# LANGUAGE ViewPatterns #-}\n{-# LANGUAGE RecordWildCards #-}\n\nmodule Chapter2.SimpleFunctions\n    (\n    ) where\n\ndata ClientR = GovOrgR { clientRName :: String }\n            | CompanyR { clientRName :: String,\n                        companyID :: Integer,\n                        person :: PersonR,\n                        duty :: String}\n            | IndividualR {person :: PersonR, ads :: Bool }\n            deriving(Show)\n\ndata PersonR = PersonR {  firstName :: String,\n                        lastName :: String,\n                        gender :: Gender }\n                        deriving(Show)\n\n--exercise.hs\nimport Chapter2.SimpleFunctions\n\nfilterGovOrgs :: [ClientR] -&gt; [ClientR]\nfilterGovOrgs xs = xs\n</code></pre>\n\n<p>the project tree structure looks like:</p>\n\n<pre><code>.\n\u251c\u2500\u2500 ProjectApproachBook.cabal\n\u251c\u2500\u2500 Setup.hs\n\u251c\u2500\u2500 chapter2\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 Section2\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 Example.hs\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 SimpleFunctions.hs\n\u251c\u2500\u2500 chapter3\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 exercise.hs\n\u2514\u2500\u2500 dist\n</code></pre>\n\n<p>when I load exercise.hs in ghci I'm getting the error :</p>\n\n<blockquote>\n  <p>Not in scope: type constructor or class \u2018ClientR\u2019</p>\n</blockquote>\n\n<pre><code>Prelude &gt; :l chapter3/exercise.hs \n[1 of 2] Compiling Chapter2.SimpleFunctions ( Chapter2/SimpleFunctions.hs, interpreted )\n[2 of 2] Compiling Main             ( chapter3/exercise.hs, interpreted )\n\nchapter3/exercise.hs:53:19:\n    Not in scope: type constructor or class \u2018ClientR\u2019\n\nchapter3/exercise.hs:53:32:\n    Not in scope: type constructor or class \u2018ClientR\u2019\nFailed, modules loaded: Chapter2.SimpleFunctions.\n</code></pre>\n"}, {"tags": ["haskell", "lazy-evaluation", "bytestring"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 7, "creation_date": 1438035579, "post_id": 31664274, "comment_id": 51273055, "body": "<code>Data.ByteString.Lazy.Char8</code>?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 3, "creation_date": 1438039350, "post_id": 31664274, "comment_id": 51274287, "body": "If you are sure the encoding is latin1, then you can use that lazy <code>Char8</code> modules, as @melpomene points out. Otherwise, there&#39;s <code>Data.Text.Lazy</code> which should work with other encodings as well."}], "answers": [{"tags": [], "owner": {"reputation": 401, "user_id": 4868124, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/86dc340359160250de50ea4860cb9931?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Chav", "link": "https://stackoverflow.com/users/4868124/michael-chav"}, "is_accepted": true, "score": 1, "last_activity_date": 1438043596, "creation_date": 1438043596, "answer_id": 31665595, "question_id": 31664274, "link": "https://stackoverflow.com/questions/31664274/read-a-list-of-integers-lazily-as-a-bytestring/31665595#31665595", "title": "Read a list of integers lazily as a bytestring", "body": "<p>I found a slightly length workaround to reading the file as a ByteString and then as a list of integers. Thanks to @melpomene</p>\n\n<pre><code>import Data.ByteString.Lazy.Char8 as L\nmain = do\n    contents &lt;- L.getContents\n    print (sumFile contents)\n         where sumFile x = sum $ Prelude.map tups $ Prelude.map L.readInt (L.words x)\n             where read' = tups.(L.readInt)\n\n\ntups :: (Num a) =&gt; (Maybe (a, b)) -&gt; a\ntups (Just (a,b)) = a\ntups Nothing = 0\n</code></pre>\n"}], "owner": {"reputation": 401, "user_id": 4868124, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/86dc340359160250de50ea4860cb9931?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Chav", "link": "https://stackoverflow.com/users/4868124/michael-chav"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 1, "accepted_answer_id": 31665595, "answer_count": 1, "score": 2, "last_activity_date": 1438043596, "creation_date": 1438035388, "last_edit_date": 1438035543, "question_id": 31664274, "link": "https://stackoverflow.com/questions/31664274/read-a-list-of-integers-lazily-as-a-bytestring", "title": "Read a list of integers lazily as a bytestring", "body": "<p>I'm trying to find the sum of integers in a file. The code using the normal string is:</p>\n\n<pre><code>main = do\n  contents &lt;- getContents\n  L.putStrLn (sumFile contents)\n  where sumFile = sum . map  read. words\n</code></pre>\n\n<p>I tried to change it to use the <code>Data.ByteString.Lazy</code> module like this:</p>\n\n<pre><code>import Data.ByteString.Lazy as L\n\nmain = do\n  contents &lt;- L.getContents\n  L.putStrLn (sumFile contents)\n  where sumFile = sum . L.map  read. words\n</code></pre>\n\n<p>But this refused as words was returning a string. Then I tried using <code>Data.ByteString.Char8</code> but it used a strict ByteString. </p>\n\n<p>How can I make this function completely lazy?</p>\n"}, {"tags": ["haskell", "functor", "purescript"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 2, "creation_date": 1438029950, "post_id": 31662186, "comment_id": 51270444, "body": "If you don&#39;t want to join yet, but want to change it, remember that fmap is composable: <code>fmap . fmap :: (Functor f, Functor g) =&gt; (a -&gt; b) -&gt; f (g a) -&gt; f (g b)</code>, <code>fmap . fmap . fmap :: (Functor f, Functor g, Functor h) =&gt; (a -&gt; b) -&gt; f (g (h a)) -&gt; f (g (h b))</code>"}, {"owner": {"reputation": 8452, "user_id": 621427, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/0eFAm.png?s=128&g=1", "display_name": "robkuz", "link": "https://stackoverflow.com/users/621427/robkuz"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1438031626, "post_id": 31662186, "comment_id": 51271363, "body": "hmm my question was more if there is a way to avoid this nesting in the first place"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1438033070, "post_id": 31662186, "comment_id": 51272038, "body": "With <code>Maybe</code> there is little interesting information encoded in the multiple layers, but that might not be the case with other functors (e.g. you could use <code>fmap . fmap . fmap</code> to map over a doubly nested list while preserving all of its structure)."}], "answers": [{"comments": [{"owner": {"reputation": 8452, "user_id": 621427, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/0eFAm.png?s=128&g=1", "display_name": "robkuz", "link": "https://stackoverflow.com/users/621427/robkuz"}, "edited": false, "score": 0, "creation_date": 1438031575, "post_id": 31662307, "comment_id": 51271329, "body": "so basically you are saying my <code>extract</code> function is some variant of <code>join</code> and that is the way things are being handled? duh! Isn&#39;t there a way (conceptually) to avoid that deeply nesting in the first place?"}, {"owner": {"reputation": 4039, "user_id": 1341956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbed6f201f9a0e735e5660d118c6662d?s=128&d=identicon&r=PG", "display_name": "Phil Freeman", "link": "https://stackoverflow.com/users/1341956/phil-freeman"}, "reply_to_user": {"reputation": 8452, "user_id": 621427, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/0eFAm.png?s=128&g=1", "display_name": "robkuz", "link": "https://stackoverflow.com/users/621427/robkuz"}, "edited": false, "score": 3, "creation_date": 1438032170, "post_id": 31662307, "comment_id": 51271611, "body": "One way is to notice that <code>join (map f x)</code> is the same as <code>x &gt;&gt;= f</code> by the <code>Monad</code> laws, so you could say <code>match someRegex &quot;   1&quot; &gt;&gt;= last</code> and save yourself a <code>join</code>."}, {"owner": {"reputation": 4039, "user_id": 1341956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbed6f201f9a0e735e5660d118c6662d?s=128&d=identicon&r=PG", "display_name": "Phil Freeman", "link": "https://stackoverflow.com/users/1341956/phil-freeman"}, "reply_to_user": {"reputation": 8452, "user_id": 621427, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/0eFAm.png?s=128&g=1", "display_name": "robkuz", "link": "https://stackoverflow.com/users/621427/robkuz"}, "edited": false, "score": 0, "creation_date": 1438032220, "post_id": 31662307, "comment_id": 51271633, "body": "<code>match</code> returns two layers of <code>Maybe</code> because of the multiple ways in which the JS version can fail, so at least one <code>join</code> is necessary if you care about everything being successful."}], "tags": [], "owner": {"reputation": 4039, "user_id": 1341956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbed6f201f9a0e735e5660d118c6662d?s=128&d=identicon&r=PG", "display_name": "Phil Freeman", "link": "https://stackoverflow.com/users/1341956/phil-freeman"}, "is_accepted": true, "score": 11, "last_activity_date": 1438027730, "creation_date": 1438027730, "answer_id": 31662307, "question_id": 31662186, "link": "https://stackoverflow.com/questions/31662186/whats-the-right-way-to-handle-deeply-nested-functors/31662307#31662307", "title": "Whats the right way to handle (deeply nested) functors?", "body": "<p>Perhaps you're looking for the <code>join</code> function:</p>\n\n<p><a href=\"http://pursuit.purescript.org/packages/purescript-control/0.3.0/docs/Control.Bind#d:join\">http://pursuit.purescript.org/packages/purescript-control/0.3.0/docs/Control.Bind#d:join</a></p>\n\n<p><code>join</code> collapses two layers of a structure down to a single layer, combining any effects. In the case of <code>Maybe</code>, that means that the resulting value will not be <code>Nothing</code> only if both layers were not <code>Nothing</code>.</p>\n"}], "owner": {"reputation": 8452, "user_id": 621427, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/0eFAm.png?s=128&g=1", "display_name": "robkuz", "link": "https://stackoverflow.com/users/621427/robkuz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 472, "favorite_count": 1, "accepted_answer_id": 31662307, "answer_count": 1, "score": 5, "last_activity_date": 1438029295, "creation_date": 1438027276, "last_edit_date": 1438029295, "question_id": 31662186, "link": "https://stackoverflow.com/questions/31662186/whats-the-right-way-to-handle-deeply-nested-functors", "title": "Whats the right way to handle (deeply nested) functors?", "body": "<p>I have the following simple code</p>\n\n<pre><code>import Data.String.Regex\nimport Data.Array\n\nlast &lt;$&gt; match someRegex \"   1\"\n</code></pre>\n\n<p>where </p>\n\n<pre><code>match someRegex \"   1\"\n</code></pre>\n\n<p>returns something like </p>\n\n<pre><code>Just ([Just (\"   1\"),Just (\"   \"),Just (\"1\")])\n</code></pre>\n\n<p>and     </p>\n\n<pre><code>last &lt;$&gt; match someRegex \"   1\"\n</code></pre>\n\n<p>returns something like  </p>\n\n<pre><code>Just (Just (Just (\"   1\"))) \n</code></pre>\n\n<p>Now I have a deeply nested Maybe. Which makes it sort of hard to work with (even using functors).\nI have written myself a pair of helper functions - but I am sort of unhappy with that. It somehow doesn't feel right.</p>\n\n<pre><code>extract j = do\n    case j of\n        Nothing -&gt; Nothing\n        Just a -&gt; a\nextract2 jj = extract $ extract jj\n</code></pre>\n\n<p>And then using it like this</p>\n\n<pre><code>extract2 $ last &lt;$&gt; match someRegex \"   1\"\n</code></pre>\n\n<p>Is there a better/idiomatic way to do such things in Purescript/Haskell?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1439663864, "post_id": 31659975, "comment_id": 51957583, "body": "Can you provide more information like (1) OS/architecture running on, (2) output for <code>stack --version</code> and <code>stack exec -- ghc --version</code>, <code>ghc --version</code>, and <code>cabal --version</code>?"}, {"owner": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1439725245, "post_id": 31659975, "comment_id": 51970258, "body": "stack --version: Version 0.1.2.0, Git revision 65246552936b7da4b64b38372feac903d96a8911"}, {"owner": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1439725293, "post_id": 31659975, "comment_id": 51970270, "body": "stack exec -- ghc --version : Version 0.1.2.0, Git revision 65246552936b7da4b64b38372feac903d96a8911"}, {"owner": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1439725334, "post_id": 31659975, "comment_id": 51970284, "body": "ghc --version: The Glorious Glasgow Haskell Compilation System, version 7.8.3"}, {"owner": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1439725366, "post_id": 31659975, "comment_id": 51970294, "body": "cabal --version : cabal-install version 1.18.0.5 using version 1.18.1.3 of the Cabal library"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1439728903, "post_id": 31659975, "comment_id": 51971246, "body": "This is probably going to become too difficult to debug in an SO question. Please open up a Github issue for this, and include a reproducing case. Also, please rerun <code>stack exec -- ghc --version</code>, the output given above does not have the version of GHC in it."}, {"owner": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 1, "creation_date": 1439933397, "post_id": 31659975, "comment_id": 52061950, "body": "Create Issue on Github: <a href=\"https://github.com/commercialhaskell/stack/issues/819\" rel=\"nofollow noreferrer\">github.com/commercialhaskell/stack/issues/819</a>"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1439954769, "post_id": 31659975, "comment_id": 52067856, "body": "Thanks, will follow up there"}, {"owner": {"reputation": 4452, "user_id": 562583, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7d7c259d7212f8278d89e6bc45a9b39c?s=128&d=identicon&r=PG", "display_name": "Turion", "link": "https://stackoverflow.com/users/562583/turion"}, "edited": false, "score": 0, "creation_date": 1538041339, "post_id": 31659975, "comment_id": 92007147, "body": "Another possible resolution might be <a href=\"https://stackoverflow.com/a/41588628/562583\">stackoverflow.com/a/41588628/562583</a>"}, {"owner": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "edited": false, "score": 0, "creation_date": 1538214240, "post_id": 31659975, "comment_id": 92071394, "body": "With latest stack version it isn&#39;t actual."}], "owner": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 330, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1439612774, "creation_date": 1438019649, "last_edit_date": 1439612774, "question_id": 31659975, "link": "https://stackoverflow.com/questions/31659975/building-simple-opengl-project-using-stack", "title": "Building simple opengl project using stack?", "body": "<p>I create simple haskell-opengl project. It is build successful using commands:</p>\n\n<pre><code>cabal configure\ncabal build\n</code></pre>\n\n<p>When I use stack:</p>\n\n<pre><code>stack build\n</code></pre>\n\n<p>I get error:</p>\n\n<pre><code>GLUT-2.7.0.1: configure\nProgress\n    Configuring GLUT-2.7.0.1...\n    Setup.hs: Missing dependency on a foreign library:\n    * Missing C library: glut32\n    This problem can usually be solved by installing the system package that\n    provides this library (you may need the \"-dev\" version). If the library is\n    already installed but in a non-standard location then you can use the flags\n    --extra-include-dirs= and --extra-lib-dirs= to specify where it is.\n</code></pre>\n\n<p>How to make use stack glut.dll?</p>\n\n<pre><code>module Main where\n\nimport Graphics.UI.GLUT\nimport Foreign.Marshal.Array\nimport Foreign.Ptr\nimport Foreign.Storable()\nimport Foreign.C.Types()\nimport qualified Data.ByteString as BS\nimport Control.Monad\n\ndata State = State\n    {\n        vertexBuffer :: BufferObject,\n        gpuProgram :: Program\n    }\n\ntriangleVertexes :: [GLfloat]\ntriangleVertexes = [\n     0.0,  0.5,   0.0, 1.0,\n     0.5, -0.366, 0.0, 1.0,\n    -0.5, -0.366, 0.0, 1.0,\n     1.0,  0.0,   0.0, 1.0,\n     0.0,  1.0,   0.0, 1.0,\n     0.0,  0.0,   1.0, 1.0\n    ]\n\nmain :: IO ()\nmain = do\n   (progName, _) &lt;- getArgsAndInitialize\n   initialDisplayMode $= [ DoubleBuffered, RGBAMode, WithAlphaComponent, WithDepthBuffer ]\n   _ &lt;- createWindow progName\n   state &lt;- initializeState\n   displayCallback $= display state\n   reshapeCallback $= Just (reshape state)\n   mainLoop\n\nfragmentShaderFilePath :: FilePath\nfragmentShaderFilePath = \"shader.frag\"\n\nvertexShaderFilePath :: FilePath\nvertexShaderFilePath = \"shader.vert\"\n\ncreateVertexBuffer :: [GLfloat] -&gt; IO BufferObject\ncreateVertexBuffer vertexes = do\n    bufferObject &lt;- genObjectName\n    bindBuffer ArrayBuffer $= Just bufferObject\n    withArrayLen vertexes $ \\count arr -&gt;\n        bufferData ArrayBuffer $= (fromIntegral count * 4, arr, StaticDraw)\n    enableAttribLocations [0, 1]\n    setAttribPointers\n    return bufferObject\n\nvertexNumComponents :: NumComponents\nvertexNumComponents = 4\n\ncolorNumComponents :: NumComponents\ncolorNumComponents = 4\n\ninitializeState :: IO State\ninitializeState = do\n    bufferObject &lt;- createVertexBuffer triangleVertexes\n    program &lt;- initGPUProgram\n    return State\n        {\n            vertexBuffer = bufferObject,\n            gpuProgram = program\n        }\n\nloadShader :: ShaderType -&gt; FilePath -&gt; IO Shader\nloadShader t path = do\n    shader &lt;- createShader t\n    source &lt;- BS.readFile path\n    shaderSourceBS shader $= source\n    compileShader shader\n    status &lt;- get (compileStatus shader)\n    unless status $ putStrLn . ((\"message\" ++ \" log: \") ++) =&lt;&lt; get (shaderInfoLog shader)\n    return shader\n\ninitGPUProgram :: IO Program\ninitGPUProgram = do\n    vertexShader &lt;- loadShader VertexShader vertexShaderFilePath\n    fragmentShader &lt;- loadShader FragmentShader fragmentShaderFilePath\n    let shaders = [vertexShader, fragmentShader]\n    program &lt;- createProgram\n    mapM_ (attachShader program) shaders\n    linkProgram program\n    mapM_ (detachShader program) shaders\n    return program\n\ndisplay :: State -&gt; DisplayCallback\ndisplay state = do\n    clearColor $= Color4 1.0 0.0 1.0 1.0\n    clear [ ColorBuffer ]\n    bindBuffer ArrayBuffer $= Just (vertexBuffer state)\n    enableAttribLocations [0, 1]\n    setAttribPointers\n    currentProgram $= Just (gpuProgram state)\n    drawArrays Triangles 0 3\n    disableAttribLocations [0, 1]\n    swapBuffers\n    checkError \"display\"\n\nsetCapabilityForAttribLocations :: Capability -&gt; [GLuint] -&gt; IO ()\nsetCapabilityForAttribLocations capability =\n    mapM_ (\\location -&gt; vertexAttribArray (AttribLocation location) $= capability)\n\ndisableAttribLocations :: [GLuint] -&gt; IO ()\ndisableAttribLocations = setCapabilityForAttribLocations Disabled\n\nenableAttribLocations :: [GLuint] -&gt; IO ()\nenableAttribLocations = setCapabilityForAttribLocations Enabled\n\nsetAttribPointers :: IO ()\nsetAttribPointers = do\n    vertexAttribPointer (AttribLocation 0) $= (ToFloat, VertexArrayDescriptor vertexNumComponents Float 0 nullPtr)\n    vertexAttribPointer (AttribLocation 1) $= (ToFloat, VertexArrayDescriptor colorNumComponents Float 0 (plusPtr nullPtr 48))\n\nreshape :: State -&gt; ReshapeCallback\nreshape _ size =\n     viewport $= (Position 0 0, size)\n\ncheckError :: String -&gt; IO ()\ncheckError functionName = get errors &gt;&gt;= mapM_ reportError\n    where reportError e = putStrLn (showError e ++ \" detected in \" ++ functionName)\n          showError (Error category message) = \"GL error \" ++ show category ++ \" (\" ++ message ++ \")\"\n</code></pre>\n\n<p>-- fragment shader</p>\n\n<pre><code>#version 330\n\nsmooth in vec4 theColor;\n\nout vec4 outputColor;\n\nvoid main()\n{\n    outputColor = theColor;\n}\n</code></pre>\n\n<p>-- vertex shader</p>\n\n<pre><code> #version 330\n\nlayout (location = 0) in vec4 position;\nlayout (location = 1) in vec4 color;\n\nsmooth out vec4 theColor;\n\nvoid main()\n{\n    gl_Position = position + vec4(0.5, 0.5, 0.0, 1.0);\n    theColor = color;\n}\n</code></pre>\n"}, {"tags": ["debugging", "haskell", "testing"], "answers": [{"comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 2, "creation_date": 1438016150, "post_id": 31658414, "comment_id": 51262532, "body": "<code>trace (show y) y</code> can be simplified as <code>traceShowId y</code>"}, {"owner": {"reputation": 472, "user_id": 4775652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/825c3e92706311cc7fa61d0f5b96f9d8?s=128&d=identicon&r=PG&f=1", "display_name": "lodrik", "link": "https://stackoverflow.com/users/4775652/lodrik"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1438016885, "post_id": 31658414, "comment_id": 51262988, "body": "Yes! Fixed it above."}], "tags": [], "owner": {"reputation": 472, "user_id": 4775652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/825c3e92706311cc7fa61d0f5b96f9d8?s=128&d=identicon&r=PG&f=1", "display_name": "lodrik", "link": "https://stackoverflow.com/users/4775652/lodrik"}, "is_accepted": true, "score": 6, "last_activity_date": 1438021072, "last_edit_date": 1438021072, "creation_date": 1438014391, "answer_id": 31658414, "question_id": 31658282, "link": "https://stackoverflow.com/questions/31658282/testing-functions-through-i-o-in-haskell/31658414#31658414", "title": "Testing functions through I/O in Haskell", "body": "<p>GHCi has a fancy <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ghci-debugger.html\" rel=\"nofollow\">debugger</a> that lets you step through your code and evaluate it line by line, checking it's state and intermediary results.</p>\n\n<p>But, of course, there is also the <code>printf</code>-style debugging that you are asking for, using the <code>trace</code> function from <code>Debug.Trace</code>. Nothing wrong with using that for small scripts imho, but it's generally discouraged.</p>\n\n<p><code>trace</code> has the type <code>String -&gt; a -&gt; a</code>, so you pass a string that gets printed (via <code>unsafePerformIO</code>) and any argument that gets simply returned.</p>\n\n<hr>\n\n<p>In your example we could use it as follows. This is your function translated to Haskell:</p>\n\n<pre><code>foo x = sqrt $ (x+2)**2 - 1\n</code></pre>\n\n<p>Now we can just add <code>trace</code> and the string we want to see, e.g. <code>\"Debug Me: \" ++ (show ((x+2)**2))</code>. First import <code>Debug.Trace</code>, though:</p>\n\n<pre><code>import Debug.Trace\nfoo x = sqrt $ (trace (\"Debug Me: \" ++ (show ((x+2)**2))) ((x+2)**2)) - 1\n</code></pre>\n\n<p>A bit ugly? Following David Young's comment below, we better use <code>traceShowId :: Show a =&gt; a -&gt; a</code>, if what we want to output is identical to the intermediary result (converted to <code>String</code>, of course):</p>\n\n<pre><code>import Debug.Trace\nfoo x = sqrt $ (traceShowId ((x+2)**2)) - 1 \n</code></pre>\n\n<hr>\n\n<p>See <a href=\"https://wiki.haskell.org/Debugging\" rel=\"nofollow\">here</a> for a summary of debugging options.</p>\n"}], "owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 256, "favorite_count": 0, "closed_date": 1438069845, "accepted_answer_id": 31658414, "answer_count": 1, "score": 3, "last_activity_date": 1438021072, "creation_date": 1438014033, "last_edit_date": 1438016177, "question_id": 31658282, "link": "https://stackoverflow.com/questions/31658282/testing-functions-through-i-o-in-haskell", "closed_reason": "Duplicate", "title": "Testing functions through I/O in Haskell", "body": "<p>I'm playing codewars to sharpen my Haskell skills, and running into a problem that I haven't had in imperative languages.</p>\n\n<p>Let's say I'm writing a function foo() in javascript, which takes an int, adds two, squares it, subtracts one, and returns the square root of that number.</p>\n\n<pre><code>var foo = function(n) {\n  n += 2;\n  n = n * n;\n  n -= 1;\n  n = Math.sqrt(n);\n}\n</code></pre>\n\n<p>I want to check on the state of the data being processed in the function at various points to help me troubleshoot/revise/debug code, so I will insert console.log() statements whenever I want to see where I'm at.  For example, am I, in fact, squaring the sum of n+2 correctly halfway through the function?  Let's see...</p>\n\n<pre><code>var foo = function(n) {\n  n += 2;\n  n = n * n;\n  console.log(\"n = \" + n);\n  n -= 1;\n  n = Math.sqrt(n);\n}\n</code></pre>\n\n<p>While this example should be simple enough for a Haskeller to write in one line, if you have a complex function and want to check the state at different points, how do Haskellers do it?  Is there a standard practice using the IO() monad?  Do they get around it some other way?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 3, "creation_date": 1438013335, "post_id": 31658000, "comment_id": 51260869, "body": "Not only does <code>sqrt</code> <i>return</i> a float output, it also <i>expects</i> a float input. Try adding a <code>fromIntegral</code> in there."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1438023597, "post_id": 31658000, "comment_id": 51266962, "body": "By the way, to debug type errors it&#39;s very useful to annotate eacho top-level binding (at least) with its expected type."}], "answers": [{"tags": [], "owner": {"reputation": 472, "user_id": 4775652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/825c3e92706311cc7fa61d0f5b96f9d8?s=128&d=identicon&r=PG&f=1", "display_name": "lodrik", "link": "https://stackoverflow.com/users/4775652/lodrik"}, "is_accepted": true, "score": 3, "last_activity_date": 1438013658, "creation_date": 1438013658, "answer_id": 31658164, "question_id": 31658000, "link": "https://stackoverflow.com/questions/31658000/why-do-i-get-a-type-error-here/31658164#31658164", "title": "why do I get a type error here?", "body": "<p>This works:</p>\n\n<pre><code>top = 100 :: Int\n\ncouplesToOne num\n    |num&lt;0            = error \"num&lt;0\"\n    |num==0           = 0\n    |num `mod` 2 == 0 = num `div` 2\n    |num `mod` 2 == 1 = (num+1) `div` 2\n    |otherwise        = error \"otherwise\"\n\nnumInBig n bigSide \n    |(bigSide^2 &lt;= n) = couplesToOne (n-1)  \n    |(bigSide^2 &gt;  n) = couplesToOne (n-1) - couplesToOne (floor(sqrt(fromIntegral(bigSide^2 - n))))\n    |otherwise        = error \"otherwise\"\n\nans = map (numInBig top) [3..((div top 4) + 1)]\n</code></pre>\n\n<p>You need an extra <code>fromIntegral</code> because <code>sqrt::Floating a =&gt; a -&gt; a</code> is not defined on <code>Int</code>.</p>\n\n<pre><code>&gt; ans\n[50,50,50,50,50,50,50,50,48,47,46,45,44,44,43,43,42,41,41]\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 5161405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60a28ecb073ad978da4f82024334fca0?s=128&d=identicon&r=PG&f=1", "display_name": "ib123456", "link": "https://stackoverflow.com/users/5161405/ib123456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 31658164, "answer_count": 1, "score": 0, "last_activity_date": 1438013658, "creation_date": 1438013170, "question_id": 31658000, "link": "https://stackoverflow.com/questions/31658000/why-do-i-get-a-type-error-here", "title": "why do I get a type error here?", "body": "<p>I'm sitting on this for over 4 hours and can't wrap my head aroud it.\nI try to run the following code:</p>\n\n<pre><code>top = 100 :: Int\n\ncouplesToOne num\n    |num&lt;0            = error \"num&lt;0\"\n    |num==0           = 0\n    |num `mod` 2 == 0 = num `div` 2\n    |num `mod` 2 == 1 = (num+1) `div` 2\n    |otherwise        = error \"otherwise\"\n\nnumInBig n bigSide \n    |(bigSide^2 &lt;= n) = couplesToOne (n-1)  \n    |(bigSide^2 &gt;  n) = couplesToOne (n-1) - (couplesToOne (floor(sqrt(bigSide^2 - n))))\n    |otherwise        = error \"otherwise\"\n\nans = map (numInBig top) [3..((div top 4) + 1)]\n</code></pre>\n\n<p>and I get the following error message:</p>\n\n<pre><code>No instance for (RealFrac Int) arising from a use of `numInBig'\nIn the first argument of `map', namely `(numInBig top)'\nIn the expression: map (numInBig top) [3 .. ((div top 4) + 1)]\nIn an equation for `ans':\n    ans = map (numInBig top) [3 .. ((div top 4) + 1)]\n    enter code here\n</code></pre>\n\n<p>I figured out (probably?) that this is because of the \"sqrt\" that returns a float but that's why I added the floor that's supposed to return an Integral.</p>\n\n<p>can you please help me?</p>\n"}, {"tags": ["haskell", "recursion", "declaration", "corecursion"], "comments": [{"owner": {"reputation": 4274, "user_id": 2385324, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cKNhv.jpg?s=128&g=1", "display_name": "Diego Martinoia", "link": "https://stackoverflow.com/users/2385324/diego-martinoia"}, "edited": false, "score": 0, "creation_date": 1438008579, "post_id": 31656294, "comment_id": 51257589, "body": "It&#39;s probably been asked and answered before, but searching for &quot;recursive definition&quot; brings up only questions related to recursion in the algorithmic sense"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1438009542, "post_id": 31656294, "comment_id": 51258228, "body": "<a href=\"https://hackhands.com/lazy-evaluation-works-haskell/\" rel=\"nofollow noreferrer\">this</a> might help."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1438009710, "post_id": 31656294, "comment_id": 51258332, "body": "Start with understanding <code>[1..]</code>."}, {"owner": {"reputation": 4274, "user_id": 2385324, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cKNhv.jpg?s=128&g=1", "display_name": "Diego Martinoia", "link": "https://stackoverflow.com/users/2385324/diego-martinoia"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1438010140, "post_id": 31656294, "comment_id": 51258641, "body": "@EugeneSh. I <i>think</i> I understand lazy infinite structures, but I still don&#39;t see how the self-recursive definition would help, as there is no 0 point?"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1438010336, "post_id": 31656294, "comment_id": 51258763, "body": "@DiegoMartinoia Can you define yourself something similar to <code>[1..]</code> (well it won&#39;t look that nicely, but you can call it &quot;naturals&quot;) ? It is using (or might use) self recursion as well and a little simpler than triangular numbers. Or even  an infinite list of ones will do. Of course without using any predefined infinite lists."}, {"owner": {"reputation": 4274, "user_id": 2385324, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cKNhv.jpg?s=128&g=1", "display_name": "Diego Martinoia", "link": "https://stackoverflow.com/users/2385324/diego-martinoia"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1438010485, "post_id": 31656294, "comment_id": 51258855, "body": "@EugeneSh. Coming from Java, I can see how to implement such an infinite iterator rather easy. But with an iterator you do have an internal state (i.e. the last number you +1 to). I&#39;m curious as to a) how this internal state is actually mapped in low level after haskell crunches it and b) how a more sophisticated example such as the triang numb definition I gave gets &quot;crunched&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 4274, "user_id": 2385324, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cKNhv.jpg?s=128&g=1", "display_name": "Diego Martinoia", "link": "https://stackoverflow.com/users/2385324/diego-martinoia"}, "edited": false, "score": 0, "creation_date": 1438010331, "post_id": 31656842, "comment_id": 51258759, "body": "But where is the base case in the definition I provided as an example? Does it take it from 1 from [1..] and 0 from 0:tn ?"}, {"owner": {"reputation": 472, "user_id": 4775652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/825c3e92706311cc7fa61d0f5b96f9d8?s=128&d=identicon&r=PG&f=1", "display_name": "lodrik", "link": "https://stackoverflow.com/users/4775652/lodrik"}, "reply_to_user": {"reputation": 4274, "user_id": 2385324, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cKNhv.jpg?s=128&g=1", "display_name": "Diego Martinoia", "link": "https://stackoverflow.com/users/2385324/diego-martinoia"}, "edited": false, "score": 1, "creation_date": 1438010769, "post_id": 31656842, "comment_id": 51259052, "body": "Suppose you access the first element of the <code>triag&#39;</code>: that can be computed directly, it&#39;s <code>1+0</code>, the sum of the first elements of <code>[1..]</code> and <code>0:triag&#39;</code>. Now the second: It is <code>2 + 1</code> where <code>2</code> is the second element from <code>[1..]</code> and <code>1</code> the second element of <code>0:triag&#39;</code>, i.e. is the first element of <code>triag&#39;</code>, 1. In this way any element of <code>triag&#39;</code> is defined by your solution and can be computed as needed."}], "tags": [], "owner": {"reputation": 472, "user_id": 4775652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/825c3e92706311cc7fa61d0f5b96f9d8?s=128&d=identicon&r=PG&f=1", "display_name": "lodrik", "link": "https://stackoverflow.com/users/4775652/lodrik"}, "is_accepted": true, "score": 5, "last_activity_date": 1438012070, "last_edit_date": 1495535448, "creation_date": 1438010089, "answer_id": 31656842, "question_id": 31656294, "link": "https://stackoverflow.com/questions/31656294/how-does-corecursive-definition-work-in-haskell/31656842#31656842", "title": "How does (co)recursive definition work in Haskell?", "body": "<p>Here is a simple recursive function that gives you the nth Triangular number:</p>\n\n<pre><code>triag 0 = 0\ntriag n = n + triag (n-1)\n</code></pre>\n\n<p>Your solution <code>triag' = zipWith (+) [1..] $ 0 : triag'</code> is something more fancy: It's <em>corecursive</em> (<a href=\"https://en.wikipedia.org/wiki/Corecursion\" rel=\"nofollow noreferrer\">click</a>, <a href=\"https://softwareengineering.stackexchange.com/questions/144274/whats-the-difference-between-recursion-and-corecursion\">click</a>). Instead of calculating the nth number by reducing it to the value of smaller inputs, you define the whole infinite sequence of triangular numbers by recursively specifying the next value, given an initial segment.</p>\n\n<p>How does Haskell handle such corecursion? When it encounters your definition, no calculation is actually performed, it is deferred until results are needed for further computations. When you access a particular element of your list <code>triag'</code>, Haskell starts computing the elements of the list based on the definition, up to the element that gets accessed. For more detail, I found <a href=\"https://hackhands.com/guide-lazy-evaluation-haskell/\" rel=\"nofollow noreferrer\">this</a> article on lazy evaluation helpful. In summary, lazy evaluation is great to have, unless you need to predict memory usage.</p>\n\n<p><a href=\"https://stackoverflow.com/questions/6186664/corecursion-and-codata\">Here</a> is a similar SO question, with a step-by step explanation of the evaluation of <code>fibs = 0 : 1 : zipWith (+) fibs (tail fibs)</code>, a corecursive definition of the Fibonacci sequence.</p>\n"}], "owner": {"reputation": 4274, "user_id": 2385324, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cKNhv.jpg?s=128&g=1", "display_name": "Diego Martinoia", "link": "https://stackoverflow.com/users/2385324/diego-martinoia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 474, "favorite_count": 0, "accepted_answer_id": 31656842, "answer_count": 1, "score": 7, "last_activity_date": 1438069824, "creation_date": 1438008515, "last_edit_date": 1438069824, "question_id": 31656294, "link": "https://stackoverflow.com/questions/31656294/how-does-corecursive-definition-work-in-haskell", "title": "How does (co)recursive definition work in Haskell?", "body": "<p>I'm playing around with the language to start learning and I am puzzled beyond my wits about how a recursive definition works.</p>\n\n<p>For example, let's take the sequence of the Triangular numbers (<code>TN n = sum [1..n]</code>)</p>\n\n<p>The solution provided was:</p>\n\n<pre><code>triangularNumbers = scanl1 (+) [1..]\n</code></pre>\n\n<p>So far, so good.</p>\n\n<p>But the solution I did come up with was:</p>\n\n<pre><code>triangularNumbers = zipWith (+) [1..] $ 0 : triangularNumbers\n</code></pre>\n\n<p>Which is also correct.</p>\n\n<p>Now my question is: how does this translate to a lower level implementation? What happens exactly behind the scene when such a recursive definition is met?</p>\n"}, {"tags": ["sorting", "haskell", "insertion-sort"], "comments": [{"owner": {"reputation": 1144, "user_id": 4245823, "user_type": "registered", "accept_rate": 90, "profile_image": "https://lh3.googleusercontent.com/-czWZC6KwKYU/AAAAAAAAAAI/AAAAAAAAAYI/yBtPVyZjU4M/photo.jpg?sz=128", "display_name": "felipez", "link": "https://stackoverflow.com/users/4245823/felipez"}, "edited": false, "score": 2, "creation_date": 1438002013, "post_id": 31653415, "comment_id": 51252678, "body": "The problem is the indentation of the second definition of sort3"}], "answers": [{"tags": [], "owner": {"reputation": 1144, "user_id": 4245823, "user_type": "registered", "accept_rate": 90, "profile_image": "https://lh3.googleusercontent.com/-czWZC6KwKYU/AAAAAAAAAAI/AAAAAAAAAYI/yBtPVyZjU4M/photo.jpg?sz=128", "display_name": "felipez", "link": "https://stackoverflow.com/users/4245823/felipez"}, "is_accepted": false, "score": 5, "last_activity_date": 1438007426, "last_edit_date": 1438007426, "creation_date": 1438001869, "answer_id": 31653732, "question_id": 31653415, "link": "https://stackoverflow.com/questions/31653415/let-in-statement-error/31653732#31653732", "title": "Let In Statement Error", "body": "<p>The problem is the indentation in the second line of <code>let</code>:</p>\n\n<pre><code>insertSort3 xs = \n let sort3 [] ys = ys\n     -- the next line should line up with the previous sort3\n     sort3 (x:xs) ys = sort3 xs (insert x ys)\n in sort3 xs []     \n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 4969650, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/7f06fcfe8b5508d6c4d3d3c82bb73823?s=128&d=identicon&r=PG&f=1", "display_name": "Xeriotek", "link": "https://stackoverflow.com/users/4969650/xeriotek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1438180331, "creation_date": 1438000957, "last_edit_date": 1438180331, "question_id": 31653415, "link": "https://stackoverflow.com/questions/31653415/let-in-statement-error", "title": "Let In Statement Error", "body": "<p>I have a problem with the following haskell statement:</p>\n\n<pre><code>insertSort3 xs =\n    let sort3 [] ys = ys\n         sort3 (x:xs) ys = sort3 xs (insert x ys)\n    in sort3 xs []\n</code></pre>\n\n<p>My compiler says: parse error on input \u2018=\u2019 (The error occurs in line three).</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "edited": false, "score": 3, "creation_date": 1438098379, "post_id": 31652475, "comment_id": 51304008, "body": "By the way, you might want to get used to use a capital letter for the first letter in your Haskell source files name. This is because file names should match module names which do start with a capital letter. It doesn&#39;t matter much for scripting such as in your case, of course. Best of luck!"}], "answers": [{"comments": [{"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "edited": false, "score": 0, "creation_date": 1438002166, "post_id": 31652592, "comment_id": 51252796, "body": "Being new to haskell it seems that Applicatives are generally the most generic way to do things and Monads are a bit redundant?"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "edited": false, "score": 6, "creation_date": 1438002332, "post_id": 31652592, "comment_id": 51252930, "body": "Monads let you do things that are impossible with plain Applicative alone. In particular, choosing which action to run next based on the result of the previous action."}, {"owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "edited": false, "score": 7, "creation_date": 1438005027, "post_id": 31652592, "comment_id": 51254982, "body": "Specifically, the recent version of GHC at which this becomes an error is version 7.10."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 7, "creation_date": 1438005029, "post_id": 31652592, "comment_id": 51254983, "body": "Functors are more generic than Applicatives, and Applicatives are more generic than Monads. Powerfulness (i.e. the number of different operations you can perform on them) works the other way round."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "edited": false, "score": 1, "creation_date": 1438007842, "post_id": 31652592, "comment_id": 51257034, "body": "@fakedrake A nice question about this topic: <a href=\"http://stackoverflow.com/questions/23342184/difference-between-monad-and-applicative-in-haskell\">Difference between Monad and Applicative in Haskell</a>."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 7, "creation_date": 1438009382, "post_id": 31652592, "comment_id": 51258121, "body": "This probably will be a frequent question for a while for people using new GHC with old tutorials etc. To make this answer more useful for others coming upon it, maybe you could give an <code>Applicative</code>/<code>Functor</code> definition that works generically for <i>all</i> <code>Monad</code>s? (E.g. using <code>do</code> notation, or <code>liftM</code> and <code>ap</code> (although those require an import.))"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1438012003, "post_id": 31652592, "comment_id": 51259890, "body": "@&#216;rjanJohansen Fair comment. Is this actually the first question, or is it a dup of something else already?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1438013393, "post_id": 31652592, "comment_id": 51260900, "body": "I looked a bit better and <a href=\"http://stackoverflow.com/questions/29844824/must-i-implement-applicative-and-functor-to-implement-a-monad\">found a dup</a> (although the accepted answer is a bit buggy, which makes me a little reluctant to close this one...)."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1438017611, "post_id": 31652592, "comment_id": 51263383, "body": "@&#216;rjanJohansen we might <a href=\"http://meta.stackexchange.com/questions/147643/should-i-vote-to-close-a-duplicate-question-even-though-its-much-newer-and-ha\">close the old question as a dup of this one</a>."}, {"owner": {"reputation": 767, "user_id": 1721431, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/ccd00f0739f0cad0a1b919be0694c567?s=128&d=identicon&r=PG", "display_name": "N.S.", "link": "https://stackoverflow.com/users/1721431/n-s"}, "edited": false, "score": 3, "creation_date": 1452900669, "post_id": 31652592, "comment_id": 57385700, "body": "The migration guide at <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Migration/7.10\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/wiki/Migration/7.10</a> says &quot;DO NOT USE <code>pure = return</code>&quot;. (I have no idea what any of this means at this point, I am simply pointing out something that the guide is saying)"}, {"owner": {"reputation": 17430, "user_id": 309483, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/d797538504a367f277d19bd8369e9a19?s=128&d=identicon&r=PG", "display_name": "Janus Troelsen", "link": "https://stackoverflow.com/users/309483/janus-troelsen"}, "reply_to_user": {"reputation": 767, "user_id": 1721431, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/ccd00f0739f0cad0a1b919be0694c567?s=128&d=identicon&r=PG", "display_name": "N.S.", "link": "https://stackoverflow.com/users/1721431/n-s"}, "edited": false, "score": 0, "creation_date": 1488038530, "post_id": 31652592, "comment_id": 72059025, "body": "@S.N. Is it not because it is preferable to have general code in the top-most class? That way, if it turns out not to fit in a Monad, that instance can just be removed and it would still work."}, {"owner": {"reputation": 3211, "user_id": 898649, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/63c72161fba6e27cb05c078651c5e969?s=128&d=identicon&r=PG", "display_name": "Alexey", "link": "https://stackoverflow.com/users/898649/alexey"}, "edited": false, "score": 2, "creation_date": 1498297792, "post_id": 31652592, "comment_id": 76451813, "body": "I find it strange that Haskell does not automatically derive <code>Functor</code> and <code>Applicative</code> instances from a <code>Monad</code> instance and requires the user to write that boilerplate."}, {"owner": {"reputation": 4710, "user_id": 575699, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e1a4ea4bdacac927a748c281b613ce30?s=128&d=identicon&r=PG", "display_name": "qbolec", "link": "https://stackoverflow.com/users/575699/qbolec"}, "edited": false, "score": 0, "creation_date": 1504811840, "post_id": 31652592, "comment_id": 79170001, "body": "I believe it should be &#39;fmap&#39; not &#39;famp&#39; and &#39;Wrap&#39; not &#39;wrap&#39;"}, {"owner": {"reputation": 2885, "user_id": 1360368, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/7997d33ca6f47d0e48080d6f58a72443?s=128&d=identicon&r=PG", "display_name": "Ashesh", "link": "https://stackoverflow.com/users/1360368/ashesh"}, "edited": false, "score": 1, "creation_date": 1514829452, "post_id": 31652592, "comment_id": 83075814, "body": "I must say, one of the most enlightening chapters I&#39;ve read on this topic is <a href=\"http://learnyouahaskell.com/functors-applicative-functors-and-monoids\" rel=\"nofollow noreferrer\">learnyouahaskell.com/functors-applicative-functors-and-monoi&zwnj;&#8203;ds</a> \u2013 and it also gave me a good perspective on the rationale behind this change."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 89, "last_activity_date": 1504858071, "last_edit_date": 1504858071, "creation_date": 1437998544, "answer_id": 31652592, "question_id": 31652475, "link": "https://stackoverflow.com/questions/31652475/defining-a-new-monad-in-haskell-raises-no-instance-for-applicative/31652592#31652592", "title": "Defining a new monad in haskell raises no instance for Applicative", "body": "<p>This is the Applicative Monad Proposal (AMP). Now whenever you declare something as <code>Monad</code>, you also have to declare it as <code>Applicative</code> (and therefore <code>Functor</code>). Mathematically speaking, every monad <em>is</em> an applicative functor, so this makes sense.</p>\n\n<p>You can do the following to remove the error:</p>\n\n<pre><code>instance Functor Wrap where\n  fmap f (Wrap x) = Wrap (f x)\n\ninstance Applicative Wrap where\n  pure = Wrap\n  Wrap f &lt;*&gt; Wrap x = Wrap (f x)\n</code></pre>\n\n<p><a href=\"https://wiki.haskell.org/Functor-Applicative-Monad_Proposal\" rel=\"noreferrer\">https://wiki.haskell.org/Functor-Applicative-Monad_Proposal</a></p>\n\n<p><strong>Edit:</strong> Maybe I should point out more clearly that this is a <em>recent</em> thing? The code you posted used to work before, but with <em>recent</em> versions of GHC you'll get an error. It's a breaking change.</p>\n\n<p><strong>Edit:</strong> The following declarations should work for <em>any</em> monad:</p>\n\n<pre><code>import Control.Applicative -- Otherwise you can't do the Applicative instance.\nimport Control.Monad (liftM, ap)\n\ninstance Functor ??? where\n  fmap = liftM\n\ninstance Applicative ??? where\n  pure  = return\n  (&lt;*&gt;) = ap\n</code></pre>\n\n<p>Depending on the monad in question, there may be more efficient implementations possible, but this is a simple starting point.</p>\n"}, {"tags": [], "owner": {"reputation": 71, "user_id": 2611132, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7527e0ea2fc5d55f3d27a9a8e2ce5cc?s=128&d=identicon&r=PG", "display_name": "AaronNGray", "link": "https://stackoverflow.com/users/2611132/aaronngray"}, "is_accepted": false, "score": 2, "last_activity_date": 1531243366, "creation_date": 1531243366, "answer_id": 51271027, "question_id": 31652475, "link": "https://stackoverflow.com/questions/31652475/defining-a-new-monad-in-haskell-raises-no-instance-for-applicative/51271027#51271027", "title": "Defining a new monad in haskell raises no instance for Applicative", "body": "<p>The most normalized and unobtrusive answer is :-</p>\n\n<p>as Monad is dependent upon Applicative</p>\n\n<blockquote>\n  <p>class Applicative m => Monad m where ...</p>\n</blockquote>\n\n<p>and Applicative is dependent upon Functor</p>\n\n<blockquote>\n  <p>class Functor f => Applicative f where ...</p>\n</blockquote>\n\n<p>we need the instance definitions</p>\n\n<pre><code>&gt; instance Functor Wrapped where\n&gt;     fmap = liftM\n</code></pre>\n\n<p>and</p>\n\n<pre><code>&gt; instance Applicative Wrapped where\n&gt;     pure = return\n&gt;     (&lt;*&gt;) = ap\n</code></pre>\n"}], "owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8961, "favorite_count": 11, "accepted_answer_id": 31652592, "answer_count": 2, "score": 56, "last_activity_date": 1531243366, "creation_date": 1437998231, "last_edit_date": 1438010957, "question_id": 31652475, "link": "https://stackoverflow.com/questions/31652475/defining-a-new-monad-in-haskell-raises-no-instance-for-applicative", "title": "Defining a new monad in haskell raises no instance for Applicative", "body": "<p>I am trying to define a new monad and I am getting a strange error</p>\n\n<p><strong>newmonad.hs</strong></p>\n\n<pre>\nnewtype Wrapped a = Wrap {unwrap :: a}\ninstance Monad Wrapped where\n  (>>=) (Wrap x) f =  f x\n  return x = Wrap x\n\nmain = do\n  putStrLn \"yay\"\n</pre>\n\n<pre>\n$ ghc --version\nThe Glorious Glasgow Haskell Compilation System, version 7.10.1\n\n$ ghc newmonad.hs \n[1 of 1] Compiling Main             ( newmonad.hs, newmonad.o )\n\nnewmonad.hs:2:10:\n    No instance for (Applicative Wrapped)\n      arising from the superclasses of an instance declaration\n    In the instance declaration for \u201a\u00c4\u00f2Monad Wrapped\u201a\u00c4\u00f4\n</pre>\n\n<p>Why do I need to define an instance of <code>Applicative</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 8, "creation_date": 1437985143, "post_id": 31648003, "comment_id": 51241963, "body": "There are reasonable and often useful things to do when the arguments goes out of bounds: &quot;return the entire original list&quot; or &quot;return the empty list&quot;. You cannot sensibly define <code>(!! (-1))</code> at all, there&#39;s no fallback value to give back."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 8, "creation_date": 1437986138, "post_id": 31648003, "comment_id": 51242469, "body": "Fun fact: the semantics changed between the Haskell 98 and 2010 reports. The <a href=\"https://www.haskell.org/onlinereport/list.html\" rel=\"nofollow noreferrer\">example implementation</a> in 98 used <code>error</code> if the list wasn&#39;t empty and <code>n</code> was negative, whereas the 2010 variant shows that negative values have the same effect as <code>take 0</code>."}, {"owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1437986552, "post_id": 31648003, "comment_id": 51242706, "body": "@Zeta: that&#39;s fascinating, great find!"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 2, "creation_date": 1438008065, "post_id": 31648003, "comment_id": 51257214, "body": "I believe the reason is the same as why (e.g.) python slicing works even for indices that are out of range: in <b>most</b> circumstances that is the result you actually want. Most of the times when you use slicing being a bit &quot;sloppy&quot; (i.e. avoiding thinking about special cases and things like that) simplifies the code and you later find out that this kind of thing make things work even in the special cases. Without these you&#39;d have to always check for the lengths etc. and 99% of the times you&#39;d always do the same thing (like returning <code>[]</code> or the whole list)."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1437986411, "post_id": 31648452, "comment_id": 51242615, "body": "Of course, a partial implementation would still keep the <code>(++) . (take&amp;&amp;&amp;drop) \u2261 id</code> property."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1437986543, "post_id": 31648452, "comment_id": 51242701, "body": "@leftaroundabout Wouldn&#39;t the LHS just crash? (BTW, your equation does not type check)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1437986975, "post_id": 31648452, "comment_id": 51242972, "body": "that was pseudocode. What I meant was, if <code>drop n xs</code> and <code>take n xs</code> both yielded <code>Nothing</code> when <code>n \u2209 [0 .. length xs-1]</code>, then we would always have <code>liftA2 (++) (take n xs) (drop n xs) \u2261 Just xs</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1437987066, "post_id": 31648452, "comment_id": 51243048, "body": "@leftaroundabout Ah, I see. I assumed &quot;partial implementation&quot; to return bottom, not <code>Nothing</code>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 6, "last_activity_date": 1437986253, "creation_date": 1437986253, "answer_id": 31648452, "question_id": 31648003, "link": "https://stackoverflow.com/questions/31648003/why-are-take-and-drop-defined-for-negative-arguments/31648452#31648452", "title": "Why are `take` and `drop` defined for negative arguments?", "body": "<p>I think it's a matter of design choice here.</p>\n\n<p>The current definition ensures that the property</p>\n\n<pre><code>take x list ++ drop x list == list\n</code></pre>\n\n<p>holds for any <code>x</code>, including negative ones as well as those larger than <code>length list</code>.</p>\n\n<p>I can however see the value in a variant of <code>take</code>/<code>drop</code> which errors out: sometimes a crash is preferred to a wrong result.</p>\n"}, {"comments": [{"owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "edited": false, "score": 0, "creation_date": 1437986771, "post_id": 31648475, "comment_id": 51242843, "body": "Accepting this answer, because <code>take</code> already violating this in the other direction in a <i>useful</i> way is a pretty good argument: I can&#39;t quite see why you&#39;d want to rely on how <code>take (-1)</code> behaves, but I bet making it consistent the way you describe was part of the idea."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 13, "last_activity_date": 1437987310, "last_edit_date": 1437987310, "creation_date": 1437986308, "answer_id": 31648475, "question_id": 31648003, "link": "https://stackoverflow.com/questions/31648003/why-are-take-and-drop-defined-for-negative-arguments/31648475#31648475", "title": "Why are `take` and `drop` defined for negative arguments?", "body": "<p>There would be mainly one good reason to make <code>take</code> partial: it could guarantee that the result list, if there is one, has always the requested number of elements.</p>\n\n<p>Now, <code>take</code> already violates this in the other direction: when you try to take more elements than there are in the list, is simply takes <em>as many as there are</em>, i.e. fewer than requested. Perhaps not the most elegant thing to do, but in practice this tends to work out quite usefully.</p>\n\n<p>The main invariant for <code>take</code> is combined with <code>drop</code>:</p>\n\n<pre><code>take n xs ++ drop n xs  \u2261  xs\n</code></pre>\n\n<p>and that holds true even if <code>n</code> is negative.</p>\n\n<p>A good reason not to check the length of the list is that it makes the functions perform nicely on lazy infinite lists: for instance,</p>\n\n<pre><code>take hugeNum [1..] ++ 0 : drop hugeNum [1..]\n</code></pre>\n\n<p>will immediately give <code>1</code> as the first result element. This would not be possible if <code>take</code> and <code>drop</code> first had to check whether there are enough elements in the input.</p>\n"}, {"comments": [{"owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "edited": false, "score": 2, "creation_date": 1438012294, "post_id": 31657462, "comment_id": 51260125, "body": "I understand your reasoning, and I really try to avoid total functions for the reasons you mentioned, but I still stand by the fact that I&#39;d rather have things go <i>obviously completely wrong</i> when I do something weird like <code>take (-1) [5]</code> than have them silently return a value that&#39;s &quot;close enough&quot; to what I <i>might</i> want. I see how it&#39;s better in some cases, but there are other instances where <code>length (take n xs) == n</code> being a valid law would be really nice!"}, {"owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "edited": false, "score": 2, "creation_date": 1438012455, "post_id": 31657462, "comment_id": 51260237, "body": "Compare this to the situation with <code>tail</code>: you could perfectly define <code>tail [] = []</code> (i.e. <code>tail = drop 1</code>) and it would do maybe what you want... sometimes. But there&#39;s a <a href=\"https://en.wikipedia.org/wiki/Principle_of_least_astonishment\" rel=\"nofollow noreferrer\">very good reason why it doesn&#39;t</a>. (Of course, dependent types are the &quot;nicest&quot; solution to decisions like this, but that&#39;s a whole nother story...)"}, {"owner": {"reputation": 4773, "user_id": 4148211, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/DiKJf.jpg?s=128&g=1", "display_name": "frasertweedale", "link": "https://stackoverflow.com/users/4148211/frasertweedale"}, "reply_to_user": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "edited": false, "score": 1, "creation_date": 1438013072, "post_id": 31657462, "comment_id": 51260671, "body": "I am more astonished when a function does something that the type says it shouldn&#39;t do, such as crashing :)  You don&#39;t have to choose between totality and least-astonishment - you just need functions with useful types, e.g. <code>betterTail :: [a] -&gt; Maybe [a]</code>."}], "tags": [], "owner": {"reputation": 4773, "user_id": 4148211, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/DiKJf.jpg?s=128&g=1", "display_name": "frasertweedale", "link": "https://stackoverflow.com/users/4148211/frasertweedale"}, "is_accepted": false, "score": 4, "last_activity_date": 1438013488, "last_edit_date": 1438013488, "creation_date": 1438011757, "answer_id": 31657462, "question_id": 31648003, "link": "https://stackoverflow.com/questions/31648003/why-are-take-and-drop-defined-for-negative-arguments/31657462#31657462", "title": "Why are `take` and `drop` defined for negative arguments?", "body": "<blockquote>\n  <p><code>x !! (-1)</code> does the \"safer\" thing and crashes</p>\n</blockquote>\n\n<p><strong>Crashing is not safe</strong>.  Making a function non-total destroys your ability\nto reason about the behaviour of a function based on its type.</p>\n\n<p>Let us imagine that <code>take</code> and <code>drop</code> did have \"crash on negative\" behaviour. Consider their type:</p>\n\n<pre><code>take, drop :: Int -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>One thing this type definitely <em>doesn't</em> tell you that this function could crash!  It's helpful to reason about code as though we were using a total language, even though we are not - an idea called <em><a href=\"http://www.cse.chalmers.se/~nad/publications/danielsson-et-al-popl2006.pdf\" rel=\"nofollow\">fast and loose reasoning</a></em> - but to be able to do that, you have to avoid using (and writing) non-total functions as much as possible.</p>\n\n<p>What to do, then, about operations that might fail or have no result?  Types are the answer!  A <em>truly safe</em> variant of <code>(!!)</code> would have a type that models the failure case, like:</p>\n\n<pre><code>safeIndex :: [a] -&gt; Int -&gt; Maybe a\n</code></pre>\n\n<p>This is preferable to the type of <code>(!!)</code>,</p>\n\n<pre><code>(!!) :: [a] -&gt; Int -&gt; a\n</code></pre>\n\n<p>Which, by simple observation, can have no (total) inhabitants - you cannot \"invent\" an <code>a</code> if the list is empty!</p>\n\n<p>Finally, let us return to <code>take</code> and <code>drop</code>.  Although their type doesn't fully say what the behaviour is, coupled with their names (and ideally a few QuickCheck properties) we get a pretty good idea.  As other responders have pointed out, this behaviour is appropriate in many cases.  If you <em>truly</em> have a need to reject negative length inputs, you don't have to choose between non-totality (crashing) or the possibility of surprising behaviour (negative length accepted) - model the possible outcomes responsibly with types.</p>\n\n<p>This type makes it clear that there is \"no result\"\nfor some inputs:</p>\n\n<pre><code>takePos, dropPos :: Int -&gt; [a] -&gt; Maybe [a]\n</code></pre>\n\n<p>Better still, this type uses natural numbers;\nfunctions with this type cannot even be\napplied to a negative number!</p>\n\n<pre><code>takeNat, dropNat :: Nat -&gt; [a] -&gt; [a]\n</code></pre>\n"}], "owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 712, "favorite_count": 1, "accepted_answer_id": 31648475, "answer_count": 3, "score": 15, "last_activity_date": 1440144232, "creation_date": 1437984733, "last_edit_date": 1440144232, "question_id": 31648003, "link": "https://stackoverflow.com/questions/31648003/why-are-take-and-drop-defined-for-negative-arguments", "title": "Why are `take` and `drop` defined for negative arguments?", "body": "<p>The <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:take\" rel=\"nofollow noreferrer\">Prelude</a> shows examples for <code>take</code> and <code>drop</code> with negative arguments:</p>\n\n<pre><code>take (-1) [1,2] == []\ndrop (-1) [1,2] == [1,2]\n</code></pre>\n\n<p>Why are these defined the way they are, when e.g. <code>x !! (-1)</code> does the \"safer\" thing and crashes? It seems like a hackish and very un-Haskell-like way to make these functions total, even when the argument doesn't make sense. Is there some greater design philosophy behind this that I'm not seeing? Is this behavior guaranteed by the standard, or is this just how GHC decided to implement it?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1437984803, "post_id": 31647963, "comment_id": 51241792, "body": "I think a key point is that the type is inferred/chosen statically, and does not depend on the string. Also, I believe this defaulting rule is actually standard."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1438015580, "post_id": 31647963, "comment_id": 51262188, "body": "@dfeuer The standard defaulting rule (without GHCi&#39;s <code>ExtendedDefaultRules</code> extension) leaves out <code>()</code>, and works in fewer circumstances."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1438058653, "post_id": 31647963, "comment_id": 51278770, "body": "@&#216;rjanJohansen, I know, but I believe it works in this one."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 8, "last_activity_date": 1437984975, "last_edit_date": 1437984975, "creation_date": 1437984625, "answer_id": 31647963, "question_id": 31647833, "link": "https://stackoverflow.com/questions/31647833/haskell-read-does-not-parse-floating-point-numbers-without-explicit-type/31647963#31647963", "title": "haskell: read does not parse floating point numbers without explicit type", "body": "<p>GHCi gives it type</p>\n\n<pre><code>&gt; :t add1 (read \"1.5\")\nadd1 (read \"1.5\") :: (Read a, Num a) =&gt; a\n</code></pre>\n\n<p>So, its still polymorphic. However, when evaluated in GHCi, it implicitly <code>print</code>ed, so GHCi must pick some concrete type for <code>a</code>. GHCi uses <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/interactive-evaluation.html#extended-default-rules\" rel=\"noreferrer\">the defaulting rules</a>, and statically chooses <code>a = Integer</code>. Note that this choice is done statically (during type checking, roughly), and only depends on types (e.g. <code>String</code>), not actual values (e.g. <code>\"1.5\"</code>). <code>Integer</code> is both a <code>Read</code> and a <code>Num</code>, so all static checks pass.</p>\n\n<p>More in detail, GHCi tries types <code>()</code>, <code>Integer</code>, <code>Double</code> -- in that order, unless there is a <code>default</code> declaration saying otherwise.</p>\n\n<p>Then, at run-time the code behaves as</p>\n\n<pre><code>&gt; add1 (read \"1.5\") :: Integer\n*** Exception: Prelude.read: no parse\n</code></pre>\n\n<p>since the string can not be parsed. By comparison, this would be fine:</p>\n\n<pre><code>&gt; add1 (read \"1.5\") :: Float\n2.5\n</code></pre>\n"}], "owner": {"reputation": 6043, "user_id": 793961, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/367cd54226af527423507c1f89abb25a?s=128&d=identicon&r=PG", "display_name": "muffel", "link": "https://stackoverflow.com/users/793961/muffel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "accepted_answer_id": 31647963, "answer_count": 1, "score": 4, "last_activity_date": 1437984975, "creation_date": 1437984106, "question_id": 31647833, "link": "https://stackoverflow.com/questions/31647833/haskell-read-does-not-parse-floating-point-numbers-without-explicit-type", "title": "haskell: read does not parse floating point numbers without explicit type", "body": "<p>Consider the following function</p>\n\n<pre><code>add1 :: Num a =&gt; a -&gt; a\nadd1 x = x + 1\n</code></pre>\n\n<p>and the following applications</p>\n\n<pre><code>*Main&gt; add1 2\n3\n*Main&gt; add1 2.2\n3.2\n*Main&gt; add1 (read \"1\")\n2\nadd1 (read \"1.5\"::Float)\n2.5\n*Main&gt; add1 (read \"1.5\")\n*** Exception: Prelude.read: no parse\n</code></pre>\n\n<p>Why does the last invication of <code>add1</code> fail for floating point numbers, while it works for integers? Why do I have to specify a type in that case? </p>\n"}, {"tags": ["linux", "haskell", "cross-compiling"], "comments": [{"owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 1, "creation_date": 1437982006, "post_id": 31646958, "comment_id": 51240317, "body": "You can try passing <code>-optc &quot;-m64&quot;</code> if your GHC is set up to compile through GCC..."}], "answers": [{"comments": [{"owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 1, "creation_date": 1438017609, "post_id": 31656561, "comment_id": 51263380, "body": "Or, if you prefer to do everything locally, just start a <a href=\"http://wiki.qemu.org/Main_Page\" rel=\"nofollow noreferrer\">QEMU</a> instance with a 32 bit OS. It won&#39;t be the fastest, but certainly quite easy."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 2, "creation_date": 1438018424, "post_id": 31656561, "comment_id": 51263841, "body": "@gspr you mean a 64-bit OS I think, but yes it certainly sounds easier than trying to cross-compile."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 4, "last_activity_date": 1438009280, "creation_date": 1438009280, "answer_id": 31656561, "question_id": 31646958, "link": "https://stackoverflow.com/questions/31646958/haskell-32-to-64-bit-cross-compilation/31656561#31656561", "title": "Haskell 32 to 64 bit cross compilation", "body": "<p>Borrow or rent (e.g. EC2) an x86_64 machine for long enough to compile your program. The latter would cost on the order of $0.01.</p>\n\n<p>If this is not possible, then assuming you have a C cross-compiler to x86_64, you can try following the directions at <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Building/CrossCompiling\" rel=\"nofollow\">https://ghc.haskell.org/trac/ghc/wiki/Building/CrossCompiling</a>. However, as far as I know nobody has tried this before and I would be surprised if there are no bugs lurking for the case when the compiler's <code>Int</code> size is smaller than the target platform's word size.</p>\n"}], "owner": {"reputation": 101, "user_id": 5159427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b285e1cd580026abb4bf39aabd214cc6?s=128&d=identicon&r=PG&f=1", "display_name": "gerth56", "link": "https://stackoverflow.com/users/5159427/gerth56"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 255, "favorite_count": 0, "answer_count": 1, "score": 9, "last_activity_date": 1438009280, "creation_date": 1437981128, "question_id": 31646958, "link": "https://stackoverflow.com/questions/31646958/haskell-32-to-64-bit-cross-compilation", "title": "Haskell 32 to 64 bit cross compilation", "body": "<p>I only have a x86_<strong>32</strong> machine running Linux. On this machine I coded a small Haskell program.</p>\n\n<p>Now I need to provide a x86_<strong>64</strong> Linux binary.</p>\n\n<p>Which is the easiest / less painful way to achieve that?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1438016179, "post_id": 31646814, "comment_id": 51262554, "body": "<code>typeOf</code> and its associated class <code>Typeable</code> tries to make <i>particularly</i> sure that it can only be applied when the type is completely known, because it&#39;s essential for <code>Typeable</code> conversions to be safe. Some subtle loopholes in this have been closed in recent GHCs."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 2, "last_activity_date": 1437980626, "creation_date": 1437980626, "answer_id": 31646814, "question_id": 31646633, "link": "https://stackoverflow.com/questions/31646633/understand-error-functions-return-value-type/31646814#31646814", "title": "Understand error function&#39;s return value type", "body": "<p>You can't use <code>typeOf</code> with a polymorphic expression, both because that would be impossible to type in Haskell and because there's no <code>TypeRep</code> representing type variables. Of course the latter would be easy enough to fix if it were possible to define <code>typeOf</code> in a way that could ever produce a type variable as its result, which it's not.</p>\n\n<p>Note that if <code>typeOf</code> could represent type variables and accept polymorphic arguments, <code>typeOf (error \"\")</code> would simply print something like \"a\" or \"forall a. a\", so I'm not sure that that would help you.</p>\n\n<p>In order to use <code>typeOf</code> on <code>error</code>, you'll have to give it a monomorphic type like this <code>typeOf (error \"\" :: String)</code> or <code>typeOf (error \"\" :: Int)</code>, which will print \"String\" and \"Int\" respectively.</p>\n"}, {"comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 2, "creation_date": 1437981392, "post_id": 31646826, "comment_id": 51239982, "body": "Perhaps it would be helpful to point out that <code>error &quot;add&quot;</code> can have any type in part because it never returns. The same can be said for the infinite loop <code>foo = foo</code> which is also how <code>undefined</code> is defined."}, {"owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "edited": false, "score": 2, "creation_date": 1437984232, "post_id": 31646826, "comment_id": 51241499, "body": "I think the standard allows for it to be, well, undefined, but in GHC base, <code>undefined</code> is <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/libraries/base/src/GHC-Err.html#undefined\" rel=\"nofollow noreferrer\">defined as</a> <code>undefined =  error &quot;Prelude.undefined&quot;</code>."}], "tags": [], "owner": {"reputation": 6648, "user_id": 464306, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/W8KCe.png?s=128&g=1", "display_name": "gdejohn", "link": "https://stackoverflow.com/users/464306/gdejohn"}, "is_accepted": false, "score": 4, "last_activity_date": 1437984458, "last_edit_date": 1495542611, "creation_date": 1437980673, "answer_id": 31646826, "question_id": 31646633, "link": "https://stackoverflow.com/questions/31646633/understand-error-functions-return-value-type/31646826#31646826", "title": "Understand error function&#39;s return value type", "body": "<p><code>a</code> is lower case, which means it's a type variable. It can take on any type. You can substitute the result of <code>error</code> for any expression and your code will type check. This is useful for partial functions, which aren't defined for all possible arguments. For example:</p>\n\n<pre><code>head :: [a] -&gt; a\nhead [] = error \"empty list\"\nhead (x:_) = x\n</code></pre>\n\n<p>Given an empty list, you can't actually produce the first element because it doesn't exist. <code>error</code> makes the types work out, but blows up at runtime when evaluated.</p>\n\n<p>Per <a href=\"https://stackoverflow.com/questions/31646633/understand-error-functions-return-value-type/31646826#comment51239982_31646826\">user5402's comment</a> below:</p>\n\n<blockquote>\n  <p><code>error \"add\"</code> can have any type in part because it never returns.</p>\n</blockquote>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 1, "answer_count": 2, "score": 4, "last_activity_date": 1437999395, "creation_date": 1437979993, "question_id": 31646633, "link": "https://stackoverflow.com/questions/31646633/understand-error-functions-return-value-type", "title": "Understand error function&#39;s return value type", "body": "<pre><code>:t error\n</code></pre>\n\n<p>shows,</p>\n\n<pre><code>error :: [Char] -&gt; a\n</code></pre>\n\n<p>To understand, what is the type of a, i wrote this test code,</p>\n\n<pre><code>import Data.Typeable\ncustom = error \"hello how are you\"\n\nmain = do\n  let a = custom\n  putStrLn $ show (typeOf a)\n</code></pre>\n\n<p>It gets <code>error</code> function's return value and tries to print it using <code>show</code>\nfunction.\nIt throws error as,</p>\n\n<pre><code>ab.hs:6:20:\n    No instance for (Typeable a0) arising from a use of \u2018typeOf\u2019\n    The type variable \u2018a0\u2019 is ambiguous\n    Note: there are several potential instances:\n      instance [overlap ok] Typeable ()\n        -- Defined in \u2018Data.Typeable.Internal\u2019\n      instance [overlap ok] Typeable Bool\n        -- Defined in \u2018Data.Typeable.Internal\u2019\n      instance [overlap ok] Typeable Char\n        -- Defined in \u2018Data.Typeable.Internal\u2019\n      ...plus 14 others\n</code></pre>\n\n<p>How can i do <code>typeOf</code> for a variable and print it in string form?</p>\n"}, {"tags": ["haskell", "parsec"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 4, "last_activity_date": 1437983996, "last_edit_date": 1437983996, "creation_date": 1437982932, "answer_id": 31647486, "question_id": 31646405, "link": "https://stackoverflow.com/questions/31646405/parsec-unexpected-character-parsing-nested-comments/31647486#31647486", "title": "parsec: unexpected character parsing nested comments", "body": "<p>In an expression like <code>a &lt;|&gt; b</code>, if <code>a</code> can match the empty string then <code>b</code> will never be tried, and this is happening in <code>try nested &lt;|&gt; content</code>.</p>\n\n<p>You can fix your approach by requiring at least one comment match or another character:</p>\n\n<pre><code>comment :: Parser String\ncomment = between (string \"/*\") (string \"*/\") ( flat $ many $ (try comment &lt;|&gt; liftM toString other ) )\n  where\n    toString x = [x]\n    other = try (noneOf \"*/\")\n            &lt;|&gt; try (char '*' &gt;&gt; notFollowedBy (char '/') &gt;&gt; return '*')\n            &lt;|&gt; try (char '/' &gt;&gt; notFollowedBy (char '*') &gt;&gt; return '/')\n</code></pre>\n\n<p>FWIW, here is how <code>Text.Parsec.Token</code> does it:</p>\n\n<p><a href=\"https://github.com/aslatter/parsec/blob/master/Text/Parsec/Token.hs#L698-714\" rel=\"nofollow\">https://github.com/aslatter/parsec/blob/master/Text/Parsec/Token.hs#L698-714</a></p>\n\n<p>For your specific case the equivalent code is:</p>\n\n<pre><code>import Data.List (nub)\n\ncommentStart = \"/*\"\ncommentEnd = \"*/\"\n\nmultiLineComment =\n    do { try (string commentStart)\n       ; inComment\n       }\n\ninComment = inCommentMulti\n\ninCommentMulti\n    =   do{ try (string commentEnd) ; return () }\n    &lt;|&gt; do{ multiLineComment                     ; inCommentMulti }\n    &lt;|&gt; do{ skipMany1 (noneOf startEnd)          ; inCommentMulti }\n    &lt;|&gt; do{ oneOf startEnd                       ; inCommentMulti }\n    &lt;?&gt; \"end of comment\"\n    where\n      startEnd   = nub (commentEnd ++ commentStart)\n</code></pre>\n"}], "owner": {"reputation": 26022, "user_id": 410102, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/a70b7da5a3a712e800100e61ef8d8917?s=128&d=identicon&r=PG", "display_name": "akonsu", "link": "https://stackoverflow.com/users/410102/akonsu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 320, "favorite_count": 0, "accepted_answer_id": 31647486, "answer_count": 1, "score": 2, "last_activity_date": 1437983996, "creation_date": 1437979140, "last_edit_date": 1437980398, "question_id": 31646405, "link": "https://stackoverflow.com/questions/31646405/parsec-unexpected-character-parsing-nested-comments", "title": "parsec: unexpected character parsing nested comments", "body": "<p>I am trying to parse nested C-like block comments</p>\n\n<pre><code>import Text.ParserCombinators.Parsec\nimport Control.Monad (liftM)\n\nflat :: Monad m =&gt; m [[a]] -&gt; m [a]\nflat = liftM concat\n\ncomment :: Parser String\ncomment = between (string \"/*\") (string \"*/\") (try nested &lt;|&gt; content)\n  where\n    content = many (try (noneOf \"*/\")\n                   &lt;|&gt; try (char '*' &gt;&gt; notFollowedBy (char '/') &gt;&gt; return '*')\n                   &lt;|&gt; try (char '/' &gt;&gt; notFollowedBy (char '*') &gt;&gt; return '/'))\n    nested  = flat $ many comment\n</code></pre>\n\n<p><code>\"1234567890\"</code> parses fine, but when I try</p>\n\n<pre><code>parse comment \"\" \"/*123/*456*/789*/\"\n</code></pre>\n\n<p>I get</p>\n\n<pre><code>Left (line 1, column 3):\nunexpected \"1\"\nexpecting \"/*\" or \"*/\"\n</code></pre>\n\n<p>I cannot figure out why, I have <code>try</code> everywhere I can think of. Please help.</p>\n"}, {"tags": ["haskell", "frp", "reactive-banana"], "answers": [{"comments": [{"owner": {"reputation": 1764, "user_id": 2478883, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ys9QL.png?s=128&g=1", "display_name": "Ryoichiro Oka", "link": "https://stackoverflow.com/users/2478883/ryoichiro-oka"}, "edited": false, "score": 0, "creation_date": 1438040593, "post_id": 31662084, "comment_id": 51274639, "body": "Thank you @duplode for your answer, where do you run this demo? I ran it on CMD but it printed out <code>True</code> only when I typed in a <code>y</code>, because <code>getLine</code> waits for my input and only a <code>y</code> can be input to <code>buttonState</code> because of the <code>(== &quot;y&quot;)</code> filter"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 1764, "user_id": 2478883, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ys9QL.png?s=128&g=1", "display_name": "Ryoichiro Oka", "link": "https://stackoverflow.com/users/2478883/ryoichiro-oka"}, "edited": false, "score": 1, "creation_date": 1438041188, "post_id": 31662084, "comment_id": 51274788, "body": "@RyoichiroOka As long as you are getting <code>False</code> when you enter something other than &quot;y&quot;, it is working as intended. The idea is that <code>(== &quot;y&quot;) &lt;$&gt; getLine</code> is a mock-up of your <code>readButton</code> IO action. The mock-up returns <code>True</code> when you type a &quot;y&quot; and <code>False</code> otherwise."}, {"owner": {"reputation": 1764, "user_id": 2478883, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ys9QL.png?s=128&g=1", "display_name": "Ryoichiro Oka", "link": "https://stackoverflow.com/users/2478883/ryoichiro-oka"}, "edited": false, "score": 0, "creation_date": 1438041232, "post_id": 31662084, "comment_id": 51274793, "body": "I got the idea. Thank you! Also I wonder how come <code>bButtonState &lt;@ bButtonDriver</code> works to look back the previous state. Does this mean I can look as any farther back as I want?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 1764, "user_id": 2478883, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ys9QL.png?s=128&g=1", "display_name": "Ryoichiro Oka", "link": "https://stackoverflow.com/users/2478883/ryoichiro-oka"}, "edited": false, "score": 1, "creation_date": 1438041978, "post_id": 31662084, "comment_id": 51275001, "body": "@RyoichiroOka It is not really a look back. It works because <code>stepper</code> performs the update (notionally) <a href=\"http://hackage.haskell.org/package/reactive-banana-0.8.1.2/docs/Reactive-Banana-Combinators.html#v:stepper\" rel=\"nofollow noreferrer\">&quot;slightly after&quot;</a> the triggering event, so that use cases such as this one work. As <code>eButtonDriver</code> and <code>ePreviousState</code> are simultaneous, <code>ePreviousState</code> observes the value just before the update. Perhaps it would have been clearer if I called it, instead of <code>ePreviousState</code>, <code>eCurrentState</code> (as opposed to the new state brought by <code>eButtonDriver</code>)."}, {"owner": {"reputation": 1764, "user_id": 2478883, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ys9QL.png?s=128&g=1", "display_name": "Ryoichiro Oka", "link": "https://stackoverflow.com/users/2478883/ryoichiro-oka"}, "edited": false, "score": 0, "creation_date": 1438042249, "post_id": 31662084, "comment_id": 51275066, "body": "I will look up the document. Thank you a lot :) I will be posting some more questions about reactive-banana for some days and I will appreciate if you could stick around."}, {"owner": {"reputation": 1764, "user_id": 2478883, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ys9QL.png?s=128&g=1", "display_name": "Ryoichiro Oka", "link": "https://stackoverflow.com/users/2478883/ryoichiro-oka"}, "edited": false, "score": 1, "creation_date": 1438072493, "post_id": 31662084, "comment_id": 51285137, "body": "I&#39;m trying to summarize things. Do you think this function correctly pairs up the previous and current values of a given event stream and a given initial value of the stream? <code>\\default event -&gt; (,) &lt;$&gt; stepper default event &lt;@&gt; event</code> @duplode"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 3, "last_activity_date": 1438032058, "last_edit_date": 1495541778, "creation_date": 1438026869, "answer_id": 31662084, "question_id": 31645256, "link": "https://stackoverflow.com/questions/31645256/how-to-look-back-to-the-previous-moment/31662084#31662084", "title": "How to look back to the previous moment", "body": "<p>Here is one way (this is a runnable demo):</p>\n\n<pre><code>import Reactive.Banana\nimport Reactive.Banana.Frameworks\nimport Control.Monad\nimport Control.Applicative -- Needed if you aren't on GHC 7.10.\n\ndesc addDriver = do\n    -- Refreshes the button state. Presumably fired by external IO.\n    eButtonDriver &lt;- fromAddHandler addDriver\n    let -- Canonical repersentation of the button state.\n        bButtonState = stepper False eButtonDriver\n        -- Observes the button just before changing its state.\n        ePreviousState = bButtonState &lt;@ eButtonDriver\n        -- Performs the test your f function would do.\n        newlyPressed :: Bool -&gt; Bool -&gt; Bool\n        newlyPressed previous current = not previous &amp;&amp; current\n        -- Applies the test. This works because eButtonDriver and\n        -- ePreviousState are fired simultaneously.\n        eNewlyPressed = unionWith newlyPressed\n            ePreviousState eButtonDriver\n        -- The same but more compactly, without needing ePreviousState.\n        {-\n        eNewlyPressed = newlyPressed &lt;$&gt; bButtonState &lt;@&gt; eButtonDriver\n        -}\n    reactimate (print &lt;$&gt; eNewlyPressed)\n\nmain = do\n    (addDriver, fireDriver) &lt;- newAddHandler\n    network &lt;- compile (desc addDriver)\n    actuate network\n    -- Demo: enter y to turn the button on, and any other string to\n    -- turn it off.\n    forever $ do\n        buttonState &lt;- (== \"y\") &lt;$&gt; getLine\n        fireDriver buttonState\n</code></pre>\n\n<p>Notes:</p>\n\n<ul>\n<li><em>Events are transient, behaviors are permanent</em> is a good general rule to decide whether you need a behavior or an event stream. In this case, you need to look at what the button state was before the update in order to decide whether it was newly updated. The natural thing to do, then, is to represent the button state with a behavior (<code>bButtonState</code>), which is updated by an event fired externally (<code>eButtonDriver</code>).   </li>\n<li>For details about what the combinators are doing, see <a href=\"http://hackage.haskell.org/package/reactive-banana-0.8.1.2/docs/Reactive-Banana-Combinators.html\" rel=\"nofollow noreferrer\"><code>Reactive.Banana.Combinators</code></a>.</li>\n<li>For the fine print on the timing of events and behavior updates in reactive-banana, see <a href=\"https://stackoverflow.com/questions/24149514/dealing-with-the-current-time-in-reactive-banana\">this question</a>.</li>\n<li>Depending on what you are trying to do, the <a href=\"http://hackage.haskell.org/package/reactive-banana-0.8.1.2/docs/Reactive-Banana-Frameworks.html#v:changes\" rel=\"nofollow noreferrer\"><code>changes</code></a> function might be useful. Be aware of the caveats related to it mentioned by the documentation.</li>\n</ul>\n"}], "owner": {"reputation": 1764, "user_id": 2478883, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ys9QL.png?s=128&g=1", "display_name": "Ryoichiro Oka", "link": "https://stackoverflow.com/users/2478883/ryoichiro-oka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 2, "accepted_answer_id": 31662084, "answer_count": 1, "score": 4, "last_activity_date": 1438032058, "creation_date": 1437973261, "last_edit_date": 1438027968, "question_id": 31645256, "link": "https://stackoverflow.com/questions/31645256/how-to-look-back-to-the-previous-moment", "title": "How to look back to the previous moment", "body": "<p>I am reading a button's state (whether being pressed or not) every moment:</p>\n\n<pre><code>readButton :: IO Boolean\nreadButton = ...\n\nmain = do\n    (add, fire) &lt;- newAddHandler\n    network &lt;- compile (desc add)\n    actuate network\n    forever $ do\n        buttonState &lt;- readButton\n        fire buttonState\n\ndesc addButtonEvent = do\n    eButtonState &lt;- fromAddHandler addButtonEvent\n    ...\n</code></pre>\n\n<p>All the read states are stored into <code>eButtonState</code> in the network description <code>desc</code>.</p>\n\n<p>The button is considered to be newly pressed when the current moment's state is <code>1</code> with the previous moment's being <code>0</code>. So, if the event sequence was a list, the function would be written like this:</p>\n\n<pre><code>f :: [Bool] -&gt; Bool\nf (True:False:_) = True\nf _              = False\n</code></pre>\n\n<p>I want to apply this function to <code>eButtonState</code> so I would know whether the button is newly pressed or not in the moment. </p>\n\n<p>Is it ever possible? How would you do it? I would appreciate if there is a better or more common idea or method to achieve this goal.</p>\n"}, {"tags": ["haskell", "aeson"], "answers": [{"comments": [{"owner": {"reputation": 538, "user_id": 500511, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/99duf.png?s=128&g=1", "display_name": "helpwithhaskell", "link": "https://stackoverflow.com/users/500511/helpwithhaskell"}, "edited": false, "score": 0, "creation_date": 1437994336, "post_id": 31644591, "comment_id": 51247537, "body": "Very easy. Thanks @bheklilr for the great answer."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 4, "last_activity_date": 1437968263, "creation_date": 1437968263, "answer_id": 31644591, "question_id": 31644236, "link": "https://stackoverflow.com/questions/31644236/how-can-i-allow-array-individual-elements-to-fail-parsing-while-retaining-others/31644591#31644591", "title": "How can I allow array individual elements to fail parsing while retaining others?", "body": "<p>You can't rely on the default implementation of <code>FromJSON</code> for lists, you'll have to do a bit more work yourself:</p>\n\n<pre><code>instance FromJSON Foo where\n    parseJSON (Object v) = do\n        a &lt;- v .: \"a\"\n        bList &lt;- v .: \"b\"\n        return $ Foo a $ map (parseMaybe parseJSON) bList\n</code></pre>\n\n<p>The <code>parseMaybe parseJSON</code> function has the type <code>FromJSON a =&gt; Value -&gt; Maybe a</code>, so <code>bList :: [Value]</code> meaning <code>map (parseMaybe parseJSON) bList :: [Maybe Bar]</code>.  This is probably the best way to go about it considering <a href=\"http://hackage.haskell.org/package/aeson-0.9.0.1/docs/Data-Aeson.html\" rel=\"nofollow\">the documentation</a> (see \"Decoding a mixed-type object\") uses a similar approach for parsing JSON that isn't well behaved.</p>\n"}], "owner": {"reputation": 538, "user_id": 500511, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/99duf.png?s=128&g=1", "display_name": "helpwithhaskell", "link": "https://stackoverflow.com/users/500511/helpwithhaskell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 1, "accepted_answer_id": 31644591, "answer_count": 1, "score": 3, "last_activity_date": 1437973093, "creation_date": 1437965096, "last_edit_date": 1437973093, "question_id": 31644236, "link": "https://stackoverflow.com/questions/31644236/how-can-i-allow-array-individual-elements-to-fail-parsing-while-retaining-others", "title": "How can I allow array individual elements to fail parsing while retaining others?", "body": "<p>I have a json source that is not well behaved. It too often provides unexpected JSON that contains array elements that are malformed. I would like to parse this JSON and ignore any malformed array elements.</p>\n\n<p>Here is my attempt:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\n\nimport Control.Applicative        ((&lt;$&gt;), (&lt;*&gt;))\nimport Control.Monad              (mzero)\nimport Data.Aeson\nimport Data.ByteString.Lazy.Char8 (ByteString, pack)\n\ndata Foo = Foo Integer [Maybe Bar] deriving (Show)\ndata Bar = Bar Integer Integer deriving (Show)\n\ninstance FromJSON Foo where\n    parseJSON (Object v) = Foo &lt;$&gt; (v .: \"a\") &lt;*&gt; (v .: \"b\") \n    parseJSON _          = mzero\n\ninstance FromJSON Bar where\n    parseJSON (Object v) = Bar &lt;$&gt; (v .: \"c\") &lt;*&gt; (v .: \"d\")\n    parseJSON _          = mzero\n\n-- this string is malformed - second array element has an unexpected key\ntestString = pack \"{\\\"a\\\":1, \\\"b\\\":[{\\\"c\\\":11, \\\"d\\\":12}, {\\\"C\\\":21, \\\"d\\\":22}, {\\\"c\\\":31, \\\"d\\\":32}]}\"\n\n-- want this to be: \n--\n-- Just (Foo 1 [Just (Bar 11 12),Nothing,Just (Bar 31 32)])\n--\n-- or\n--\n-- Just (Foo 1 [Just (Bar 11 12),Just (Bar 31 32)])\nmain = print $ (decode testString :: Maybe Foo)\n</code></pre>\n\n<p>When <code>teststring</code> is malformed, the whole decoding of <code>Foo</code> returns <code>Nothing</code>. I would like <code>Foo</code> to parse, but any malformed array elements of <code>b</code> to be <code>Nothing</code>.</p>\n"}, {"tags": ["haskell", "aeson"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1437961637, "post_id": 31643793, "comment_id": 51234303, "body": "Is it essential to your requirements that <code>pets</code> doesn&#39;t have cats and dogs at the same time, or is it just a simplifying assumption?"}, {"owner": {"reputation": 113, "user_id": 3067762, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/sSSpz.jpg?s=128&g=1", "display_name": "sportanova", "link": "https://stackoverflow.com/users/3067762/sportanova"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1437962475, "post_id": 31643793, "comment_id": 51234500, "body": "Maybe not essential, but it reflects my current data model. But a solution without that assumption would also be great!"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1437965674, "post_id": 31643793, "comment_id": 51235142, "body": "If you actually want to separate cats and dogs, the natural thing to do is having separate lists of different types in <code>Person</code>."}, {"owner": {"reputation": 113, "user_id": 3067762, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/sSSpz.jpg?s=128&g=1", "display_name": "sportanova", "link": "https://stackoverflow.com/users/3067762/sportanova"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1437978669, "post_id": 31643793, "comment_id": 51238745, "body": "Hmm that would work - I&#39;m serializing it to + from a postgres json field as well"}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1437964588, "post_id": 31644139, "comment_id": 51234960, "body": "@sportanova: You described your cats and dogs as &quot;one of n other data types (n is small and the types are known in advance)&quot;. In such cases you almost never need to create a class, and a sum type (that is, a type with multiple constructors) is often the easiest alternative. <code>Either</code> is a standard way of making a sum type for two possibilities."}, {"owner": {"reputation": 113, "user_id": 3067762, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/sSSpz.jpg?s=128&g=1", "display_name": "sportanova", "link": "https://stackoverflow.com/users/3067762/sportanova"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1437979322, "post_id": 31644139, "comment_id": 51239035, "body": "user5402 @duplode thanks! I ended up using a modified version of your answer to remove the &quot;content&quot; and &quot;tag&quot; fields from the Generic ToJSON / FromJSON - see below"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1437964985, "last_edit_date": 1437964985, "creation_date": 1437964287, "answer_id": 31644139, "question_id": 31643793, "link": "https://stackoverflow.com/questions/31643793/parsing-a-homogenous-polymorphic-json-array/31644139#31644139", "title": "Parsing a homogenous polymorphic json array", "body": "<p>A standard way of representing either one type or another is to use the <code>Either</code> type, e.g.:</p>\n\n<pre><code>data Person { ..., pets :: Either [Dog] [Cat] }\n</code></pre>\n\n<p>Also, you might be interested in use GHC Generics to auto-derive the To/FromJSON instances.</p>\n\n<p>An example with a data structure that uses <code>Either</code>:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n\nimport Data.Aeson\nimport GHC.Generics\n\ndata Person = Person {\n  name :: String,\n  species :: String,\n  pets :: Either [String] [Int]\n} deriving (Show,Generic)\n\ninstance ToJSON Person    -- instances are auto-derived    \ninstance FromJSON Person\n\ndoit = do\n  let me = Person \"user5402\" \"Human\" (Right [42])\n  print $ encode me\n</code></pre>\n\n<p>If you have more than two alternatives you can easily create your own sum type like this:</p>\n\n<pre><code>-- assume the possible pet types are: Dog, Cat, Rodent, Reptile\ndata Pets = Dogs [Dog] | Cats [Cat] | Rodents [Rodent] | Reptiles [Reptile]\n  deriving (Show, Generic)\n\ndata Person { ..., pets :: Pets }\n  deriving (Show, Generic)\n\ndoit = do\n  let me = Person \"user5402\" \"Human\" (Rodents [agerbil, amouse])\n  print $ encode me\n</code></pre>\n\n<p>where <code>agerbil</code> and <code>amouse</code> are <code>Rodent</code> values.</p>\n"}, {"tags": [], "owner": {"reputation": 113, "user_id": 3067762, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/sSSpz.jpg?s=128&g=1", "display_name": "sportanova", "link": "https://stackoverflow.com/users/3067762/sportanova"}, "is_accepted": false, "score": 1, "last_activity_date": 1437979203, "creation_date": 1437979203, "answer_id": 31646428, "question_id": 31643793, "link": "https://stackoverflow.com/questions/31643793/parsing-a-homogenous-polymorphic-json-array/31646428#31646428", "title": "Parsing a homogenous polymorphic json array", "body": "<p>I'm modifying @user5402's answer because I don't like the \"tag\" and \"contents\" fields that Generics added. Also accepting his answer since he gave me the key insight of how to structure the sum type</p>\n\n<pre><code>instance FromJSON Pets where\n  parseJSON (Object o) = (parsePets o \"pets\")\n  parseJSON _ = mzero\n\nparsePets :: Object -&gt; T.Text -&gt; Parser Pets\nparsePets o key = case H.lookup key o of\n               Nothing -&gt; fail $ \"key \" ++ show key ++ \" not present\"\n               Just v  -&gt; parseToCatsOrDogs (o .: \"species\") v\n{-# INLINE parsePets #-}\n\nparseToCatsOrDogs :: Parser String -&gt; Value -&gt; Parser Pets\nparseToCatsOrDogs speciesParser (Array v) = speciesParser &gt;&gt;= \\species -&gt; case species of\n  \"dog\" -&gt; (V.mapM (\\x -&gt; parseJSON $ x) v) &gt;&gt;= \\ dogVector -&gt; return $ Dogs (V.toList dogVector)\n  \"cat\" -&gt; (V.mapM (\\x -&gt; parseJSON $ x) v) &gt;&gt;= \\ catVector -&gt; return $ Cats (V.toList catVector)\n  _ -&gt; mzero\nparseToCatsOrDogs _ _ = mzero\n</code></pre>\n"}], "owner": {"reputation": 113, "user_id": 3067762, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/sSSpz.jpg?s=128&g=1", "display_name": "sportanova", "link": "https://stackoverflow.com/users/3067762/sportanova"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 209, "favorite_count": 1, "accepted_answer_id": 31644139, "answer_count": 2, "score": 1, "last_activity_date": 1437979203, "creation_date": 1437960853, "last_edit_date": 1437973190, "question_id": 31643793, "link": "https://stackoverflow.com/questions/31643793/parsing-a-homogenous-polymorphic-json-array", "title": "Parsing a homogenous polymorphic json array", "body": "<p>I have a data type where one of the fields is a list of <strong>one</strong> of <code>n</code> other data types (<code>n</code> is small and the types are known in advance). I would like to make a JSON parser but I can't quite figure it out. I've tried creating a Pet type class and making them both instances of it, but it seemed to be a dead end. Any help would be appreciated!</p>\n\n<p>As a simplified example - I have a <code>Person</code> data type who can have a list of pets, either dogs <em>or</em> cats - but not a mix of both.</p>\n\n<p>Here's the example:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Control.Applicative\nimport Data.Aeson\nimport Data.ByteString.Lazy as L\nimport Data.Aeson.Types (Parser)\nimport Control.Monad (mzero)\n\ndata Person = Person {\n  name :: String,\n  species :: String,\n  pets :: [?] -- a list of dogs OR cats\n} deriving Show\n\ninstance FromJSON (Person a) where\n  parseJSON (Object v) = ???\n\ndata Dog = Dog {\n  dogField :: String\n} deriving Show\n\n instance FromJSON Dog where\n  parseJSON (Object v) = Dog &lt;$&gt;\n    v .: \"dogField\"\n\ndata Cat = Cat {\n  catField :: String\n} deriving Show\n\ninstance FromJSON Cat where\n  parseJSON (Object v) = Cat &lt;$&gt;\n    v .: \"catField\"\n</code></pre>\n"}, {"tags": ["http", "haskell", "streaming", "haskell-pipes", "haskell-wai"], "owner": {"reputation": 1308, "user_id": 1203558, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/kb4nh.jpg?s=128&g=1", "display_name": "aemxdp", "link": "https://stackoverflow.com/users/1203558/aemxdp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 95, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1438111979, "creation_date": 1437944491, "last_edit_date": 1438111979, "question_id": 31641918, "link": "https://stackoverflow.com/questions/31641918/interleaving-wai-streaming-with-safe-pipes", "title": "Interleaving WAI streaming with safe-pipes", "body": "<p>I'm using pipes and WAI to stream audio. The problem is that I need to lookahead some data in safe-pipe, then choose response headers based on extracted information, and then continue streaming that pipe as the response body. Here is what I have now and what works fine:         </p>\n\n<pre><code>respond $ Wai.responseStream status200 headers $ \\write flush -&gt; do\n    runSafeT $ runEffect $ do\n        (mph, chunks) &lt;- lift $ Mpeg.headerFromPipe pipe\n        for chunks $ \\chunk -&gt; liftIO $ do\n            write $ BB.byteString chunk\n            flush     \n</code></pre>\n\n<p><code>respond</code> is standard <a href=\"https://hackage.haskell.org/package/wai-3.0.3.0/docs/Network-Wai.html#t:Application\" rel=\"nofollow\">Application</a>'s funarg, and <code>Mpeg.headerFromPipe</code> is my looking-ahead computation:</p>\n\n<pre><code>respond :: Response -&gt; IO ResponseReceived\n\nMpeg.headerFromPipe :: Monad m \n    =&gt; Producer ByteString m r\n    -&gt; m (Mpeg.Header, Producer ByteString m r)\n\npipe :: Producer ByteString (SafeT IO) ()\n\nWai.responseStream :: Status -&gt; ResponseHeaders -&gt; StreamingBody -&gt; Response\n\ntype StreamingBody = (Builder -&gt; IO ()) -&gt; IO () -&gt; IO ()\n</code></pre>\n\n<p>So the question: is there any way to move <code>respond</code> between <code>headerFromPipe</code> and <code>for</code> to use <code>mph</code> to choose headers to give to <a href=\"https://hackage.haskell.org/package/wai-3.0.3.0/docs/Network-Wai.html#v:responseStream\" rel=\"nofollow\"><code>responseStream</code></a>. I can't tear apart <code>headerFromPipe</code> and <code>for</code> into two different <a href=\"http://hackage.haskell.org/package/pipes-safe-2.2.3/docs/Pipes-Safe.html#t:SafeT\" rel=\"nofollow\">SafeT</a>-computation threads because then first <code>runSafeT</code> will finalize the pipe and <code>chunks</code> pipe (which is the result of performing <a href=\"http://hackage.haskell.org/package/pipes-4.1.5/docs/Pipes.html#v:next\" rel=\"nofollow\"><code>next</code></a> few times, inspecting data, yielding stuff back and chaining with the remainder) will fail.</p>\n"}, {"tags": ["haskell", "parallel-processing", "raytracing"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1440155099, "post_id": 31641464, "comment_id": 52167186, "body": "Could you provide the exact commit where you tried <code>concat $ withStrategy \u2026</code>? I can&#39;t reproduce this behaviour in  <a href=\"https://github.com/jrraymond/ray-tracer/tree/6008010\" rel=\"nofollow noreferrer\"><code>6008010</code></a>, which is the closest commit to your edit."}, {"owner": {"reputation": 3023, "user_id": 1691145, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4b6744a17b41f3b0e5c7554a43a04094?s=128&d=identicon&r=PG", "display_name": "Justin Raymond", "link": "https://stackoverflow.com/users/1691145/justin-raymond"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 3, "creation_date": 1440170119, "post_id": 31641464, "comment_id": 52177160, "body": "I made a dedicated repo so I don&#39;t accidentally mess around in it. I have also included all the profiling information."}, {"owner": {"reputation": 3023, "user_id": 1691145, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4b6744a17b41f3b0e5c7554a43a04094?s=128&d=identicon&r=PG", "display_name": "Justin Raymond", "link": "https://stackoverflow.com/users/1691145/justin-raymond"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440203363, "post_id": 31641464, "comment_id": 52191182, "body": "@dfeuer when I said define my own strategy I didn&#39;t mean <code>Strategy</code>. Should&#39;ve picked a better word. Also, the heap overflow issue occurs with <code>parListChunk</code> and <code>parBuffer</code> too."}], "answers": [{"tags": [], "owner": {"reputation": 735, "user_id": 4711098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e3cc7b6d4644ecb2b44b9344f273d79?s=128&d=identicon&r=PG&f=1", "display_name": "Thinkeye", "link": "https://stackoverflow.com/users/4711098/thinkeye"}, "is_accepted": false, "score": 2, "last_activity_date": 1447273006, "last_edit_date": 1447273006, "creation_date": 1447272573, "answer_id": 33658976, "question_id": 31641464, "link": "https://stackoverflow.com/questions/31641464/haskell-threads-heap-overflow-despite-only-22mb-total-memory-usage/33658976#33658976", "title": "Haskell threads heap overflow despite only 22Mb total memory usage?", "body": "<p>Not the solution to your problem, but a hint to the cause:</p>\n\n<p>Haskell seems to be very conservative in memory reuse and when the interpreter sees the potential to reclaim a memory block, it goes for it. Your problem description fits the minor GC behavior described here (bottom)\n<a href=\"https://wiki.haskell.org/GHC/Memory_Management\" rel=\"nofollow\">https://wiki.haskell.org/GHC/Memory_Management</a>.</p>\n\n<blockquote>\n  <p>New data are allocated in 512kb \"nursery\". Once it's exhausted, \"minor\n  GC\" occurs - it scans the nursery and frees unused values.</p>\n</blockquote>\n\n<p>So if you chop the data into smaller chunks, you enable the engine to do the cleanup earlier - GC kicks in.</p>\n"}], "owner": {"reputation": 3023, "user_id": 1691145, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4b6744a17b41f3b0e5c7554a43a04094?s=128&d=identicon&r=PG", "display_name": "Justin Raymond", "link": "https://stackoverflow.com/users/1691145/justin-raymond"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1872, "favorite_count": 10, "answer_count": 1, "score": 114, "last_activity_date": 1454138269, "creation_date": 1437941633, "last_edit_date": 1454138269, "question_id": 31641464, "link": "https://stackoverflow.com/questions/31641464/haskell-threads-heap-overflow-despite-only-22mb-total-memory-usage", "title": "Haskell threads heap overflow despite only 22Mb total memory usage?", "body": "<p>I am trying to parallelize a ray-tracer. This means I have a very long list of small computations. The vanilla program runs on a specific scene in 67.98 seconds and 13 MB of total memory use and 99.2% productivity.</p>\n\n<p>In my first attempt I used the parallel strategy <code>parBuffer</code> with a buffer size of 50. I chose <code>parBuffer</code> because it walks through the list only as fast as sparks are consumed, and does not force the spine of the list like <code>parList</code>, which would use a lot of memory since the list is very long. With <code>-N2</code>, it ran in a time of 100.46 seconds and 14 MB of total memory use and 97.8% productivity. The spark information is: <code>SPARKS: 480000 (476469 converted, 0 overflowed, 0 dud, 161 GC'd, 3370 fizzled)</code></p>\n\n<p>The large proportion of fizzled sparks indicates that the granularity of sparks was too small, so next I tried using the strategy <code>parListChunk</code>, which splits the list into chunks and creates a spark for each chunk. I got the best results with a chunk size of <code>0.25 * imageWidth</code>. The program ran in 93.43 seconds and 236 MB of total memory use and 97.3% productivity. The spark information is: <code>SPARKS: 2400 (2400 converted, 0 overflowed, 0 dud, 0 GC'd, 0 fizzled)</code>. I believe the much greater memory use is because <code>parListChunk</code> forces the spine of the list.</p>\n\n<p>Then I tried to write my own strategy that lazily divided the list into chunks and then passed the chunks to <code>parBuffer</code> and concatenated the results.</p>\n\n<pre><code> concat $ withStrategy (parBuffer 40 rdeepseq) (chunksOf 100 (map colorPixel pixels))\n</code></pre>\n\n<p>This ran in 95.99 seconds and 22MB of total memory use and 98.8% productivity. This was succesful in the sense that all the sparks are being converted and the memory usage is much lower, however the speed is not improved. Here is an image of part of the eventlog profile.<a href=\"https://i.stack.imgur.com/JoaHO.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/JoaHO.png\" alt=\"Event log profile\"></a></p>\n\n<p>As you can see the threads are being stopped due to heap overflows. I tried adding <code>+RTS -M1G</code> which increases the default heap size all the way up to 1Gb. The results did not change. I read that Haskell main thread will use memory from the heap if its stack overflows, so I also tried increasing the default stack size too with <code>+RTS -M1G -K1G</code> but this also had no impact.</p>\n\n<p>Is there anything else I can try? I can post more detailed profiling info for memory usage or eventlog if needed, I did not include it all because it is a lot of information and I did not think all of it was necessary to include.</p>\n\n<p>EDIT: I was reading about the <a href=\"http://research.microsoft.com/en-us/um/people/simonpj/papers/parallel/multicore-ghc.pdf\" rel=\"noreferrer\">Haskell RTS multicore support</a>, and it talks about there being a HEC (Haskell Execution Context) for each core. Each HEC contains, among other things, an Allocation Area (which is a part of a single shared heap). Whenever any HEC's Allocation Area is exhausted, a garbage collection must be performed. The appears to be a <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/runtime-control.html\" rel=\"noreferrer\">RTS option</a> to control it, -A. I tried -A32M but saw no difference.</p>\n\n<p>EDIT2:\n<a href=\"https://github.com/jrraymond/ray-tracer-so\" rel=\"noreferrer\">Here is a link to a github repo dedicated to this question</a>. I have included the profiling results in the profiling folder.</p>\n\n<p>EDIT3: Here is the relevant bit of code:</p>\n\n<pre><code>render :: [([(Float,Float)],[(Float,Float)])] -&gt; World -&gt; [Color]\nrender grids world = cs where \n  ps = [ (i,j) | j &lt;- reverse [0..wImgHt world - 1] , i &lt;- [0..wImgWd world - 1] ]\n  cs = map (colorPixel world) (zip ps grids)\n  --cs = withStrategy (parListChunk (round (wImgWd world)) rdeepseq) (map (colorPixel world) (zip ps grids))\n  --cs = withStrategy (parBuffer 16 rdeepseq) (map (colorPixel world) (zip ps grids))\n  --cs = concat $ withStrategy (parBuffer 40 rdeepseq) (chunksOf 100 (map (colorPixel world) (zip ps grids)))\n</code></pre>\n\n<p>The grids are random floats that are precomputed and used by colorPixel.The type of <code>colorPixel</code> is:</p>\n\n<pre><code> colorPixel :: World -&gt; ((Float,Float),([(Float,Float)],[(Float,Float)])) -&gt; Color\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1437937661, "post_id": 31640827, "comment_id": 51228279, "body": "And what should happen for the case that <code>a</code> actually contains <code>Nothing</code>?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1437938369, "post_id": 31640827, "comment_id": 51228512, "body": "yes, it is a duplicate..."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1437938512, "post_id": 31640827, "comment_id": 51228555, "body": "Not mentioned in the dupe, since the dupe was not about monadic things: <code>traverse print</code> will do."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1437939895, "post_id": 31640827, "comment_id": 51228969, "body": "@DanielWagner Or better, <code>traverse_ print</code> to avoid confusion in ghci."}, {"owner": {"reputation": 3066, "user_id": 293248, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6a15fc023b1e0a3324440cc63d7239b2?s=128&d=identicon&r=PG", "display_name": "sczizzo", "link": "https://stackoverflow.com/users/293248/sczizzo"}, "edited": false, "score": 0, "creation_date": 1437960764, "post_id": 31640827, "comment_id": 51234112, "body": "Prelude&gt; import Data.Maybe     Prelude Data.Maybe&gt; let a = Just 10     Prelude Data.Maybe&gt; print $ fromJust a     10"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1438035597, "post_id": 31640827, "comment_id": 51273065, "body": "Beware of <code>fromJust</code>: <code>Prelude&gt; import Data.Maybe; Prelude Data.Maybe&gt; let a = Nothing; Prelude Data.Maybe&gt; print $ fromJust a -- *boom*</code>"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 46, "favorite_count": 0, "closed_date": 1437937613, "answer_count": 0, "score": 0, "last_activity_date": 1437937480, "creation_date": 1437937480, "question_id": 31640827, "link": "https://stackoverflow.com/questions/31640827/get-the-value-out-of-just-constructor", "closed_reason": "Duplicate", "title": "Get the value out of Just constructor", "body": "<p>I am trying to print only the monad value and not the context information in ghci,</p>\n\n<pre><code>ghci&gt; let a = Just 10\nghci&gt; print !!!!!!\n</code></pre>\n\n<p>!!!!! must print, </p>\n\n<pre><code>10\n</code></pre>\n\n<p>and not </p>\n\n<pre><code>Just 10\n</code></pre>\n"}, {"tags": ["haskell", "cabal", "criterion"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1437927780, "post_id": 31639230, "comment_id": 51224923, "body": "I don&#39;t have specifics, but I can&#39;t imagine that this would be a good way to profile a Haskell program. Why not compile it and then benchmark running it directly?"}, {"owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1437928022, "post_id": 31639230, "comment_id": 51224995, "body": "That&#39;s what I&#39;m doing now, only that I&#39;m compiling with cabal because I can specify ghc flags per project."}, {"owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1437928264, "post_id": 31639230, "comment_id": 51225095, "body": "I guess the question boils down to &quot;how to benchmark a project within a haskell program&quot;. The criterion documentation explains how to benchmark pure function and IO action, so now I&#39;m running the project as an IO aciton"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1437937514, "post_id": 31639230, "comment_id": 51228230, "body": "It wasn&#39;t what you were doing when I commented but I see you have changed your example code since."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1437942381, "post_id": 31639230, "comment_id": 51229757, "body": "This seems like a pretty bad idea, unless it is actually <code>cabal run</code> that you want to benchmark. Why not add an executable to the package itself that depends on criterion and benchmarks the actual function you care about? Or at least add enough hooks to the other project that you can write that executable with the other package as a dependency. Down your current path lies madness."}, {"owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "edited": false, "score": 0, "creation_date": 1437962714, "post_id": 31639230, "comment_id": 51234562, "body": "I will take the advice. But I&#39;m still curious if there&#39;s any reason that the criterion library doesn&#39;t provide functionalities for benchmarking full projects?"}], "owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1437932003, "creation_date": 1437927712, "last_edit_date": 1437932003, "question_id": 31639230, "link": "https://stackoverflow.com/questions/31639230/overhead-of-cabal-run", "title": "overhead of cabal run", "body": "<p>I need to benhmark another project in my program, and right now I'm doing </p>\n\n<pre><code>    system $ \"cd \" ++ projDir ++ \"; cabal build\"\n    let runProj = system $ \"cd \" ++ projDir ++ \"; cabal run &gt; /dev/null\"\n    (m, _) &lt;- measure (whnfIO runProj) runs\n</code></pre>\n\n<p>with <code>criterion</code>. I know <code>cabal run</code> will check if the project has been built every time it's called, but other than that does it produce significant overhead? Is there a better way to benchmark other projects within a haskell program?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 3, "last_activity_date": 1437926477, "creation_date": 1437926477, "answer_id": 31639031, "question_id": 31638944, "link": "https://stackoverflow.com/questions/31638944/creating-function-for-haskell-structure-whose-constructors-are-hidden/31639031#31639031", "title": "Creating function for Haskell structure whose constructors are hidden", "body": "<p>The <a href=\"https://hackage.haskell.org/package/true-name\" rel=\"nofollow\">true-name</a> package (\"A Template Haskell hack to get unexported Names\") looks helpful for playing in this way. One of the <a href=\"https://github.com/liyang/true-name/blob/e4f971622dd09bbd357c3eef318ed6c212eec1d8/sanity.hs\" rel=\"nofollow\">examples in GitHub</a> actually involves <code>IntSet</code>.</p>\n"}], "owner": {"reputation": 366, "user_id": 661582, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/581b0d6be0953275b3cf9e5e58fe6838?s=128&d=identicon&r=PG", "display_name": "Calle", "link": "https://stackoverflow.com/users/661582/calle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1437927029, "creation_date": 1437925924, "last_edit_date": 1437927029, "question_id": 31638944, "link": "https://stackoverflow.com/questions/31638944/creating-function-for-haskell-structure-whose-constructors-are-hidden", "title": "Creating function for Haskell structure whose constructors are hidden", "body": "<p>is there any way I can create a function for a structure whose constructors are hidden by the module containing it?</p>\n\n<p>In my case, I want to add functions that operate on a <code>Data.IntSet.IntSet</code> and I need to pattern match on the constructors. It would also be nice to have access to the functions which are not in the export list of the module. Is this possible?</p>\n\n<p>Here is something illustrating the general principle of what I want to do (not what I actually want to do, but it illustrates it):</p>\n\n<pre><code>import qualified Data.IntSet as IntSet\n\nisTip :: IntSet.IntSet -&gt; Bool\nisTip (IntSet.Tip _) = True\nisTip _ = False\n</code></pre>\n\n<p>Trying to load this in GHCi gives:</p>\n\n<pre><code>Not in scope: data constructor \u2018IntSet.Tip\u2019\nFailed, modules loaded: none.\n</code></pre>\n\n<p>I do realize that this can be risky if the internal implementation changes, but I just want to try out some stuff.</p>\n"}, {"tags": ["haskell", "parallel-processing"], "answers": [{"comments": [{"owner": {"reputation": 3023, "user_id": 1691145, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4b6744a17b41f3b0e5c7554a43a04094?s=128&d=identicon&r=PG", "display_name": "Justin Raymond", "link": "https://stackoverflow.com/users/1691145/justin-raymond"}, "edited": false, "score": 0, "creation_date": 1438005427, "post_id": 31653324, "comment_id": 51255300, "body": "wait, then what does this mean? &quot;In fact, it evaluates list elements at least to weak head normal form, disregarding a strategy argument r0&quot;"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 3023, "user_id": 1691145, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4b6744a17b41f3b0e5c7554a43a04094?s=128&d=identicon&r=PG", "display_name": "Justin Raymond", "link": "https://stackoverflow.com/users/1691145/justin-raymond"}, "edited": false, "score": 0, "creation_date": 1438005533, "post_id": 31653324, "comment_id": 51255376, "body": "I somehow missed that. In that case, either the documentation is wrong, or... yeah, I&#39;m puzzled."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 3023, "user_id": 1691145, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4b6744a17b41f3b0e5c7554a43a04094?s=128&d=identicon&r=PG", "display_name": "Justin Raymond", "link": "https://stackoverflow.com/users/1691145/justin-raymond"}, "edited": false, "score": 0, "creation_date": 1438005737, "post_id": 31653324, "comment_id": 51255505, "body": "Reading the source code, it does <i>look at</i> the supplied strategy. I think what it&#39;s <i>trying</i> to say is that you can&#39;t evaluate to <i>less than</i> WHNF (but presumably <i>can</i> evaluate further than that by supplying a suitable strategy)."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 1, "last_activity_date": 1438000725, "creation_date": 1438000725, "answer_id": 31653324, "question_id": 31638491, "link": "https://stackoverflow.com/questions/31638491/how-to-determine-which-size-buffer-to-use-when-using-parbuffer-in-haskell/31653324#31653324", "title": "How to determine which size buffer to use when using parBuffer in Haskell", "body": "<p>First answer: <code>parBuffer</code> takes a <code>Strategy</code> for evaluating <em>one element</em> of a list, and gives you back a <code>Strategy</code> for evaluating the entire list. So yes, it evaluates the list in parallel. But it still needs to know how to evaluate each item. (Did you want normal form or weak head normal form or...?) So it doesn't <em>ignore</em> the first argument.</p>\n\n<p>Second... Benchmark it? I suspect the answer depends on exactly how much work each spark does, how many data dependencies you have, etc.</p>\n"}], "owner": {"reputation": 3023, "user_id": 1691145, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4b6744a17b41f3b0e5c7554a43a04094?s=128&d=identicon&r=PG", "display_name": "Justin Raymond", "link": "https://stackoverflow.com/users/1691145/justin-raymond"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1438000725, "creation_date": 1437923018, "question_id": 31638491, "link": "https://stackoverflow.com/questions/31638491/how-to-determine-which-size-buffer-to-use-when-using-parbuffer-in-haskell", "title": "How to determine which size buffer to use when using parBuffer in Haskell", "body": "<p>The <a href=\"http://hackage.haskell.org/package/parallel-3.2.0.6/docs/Control-Parallel-Strategies.html#v:parBuffer\" rel=\"nofollow\">documentaion</a> for <code>parBuffer</code> says </p>\n\n<blockquote>\n  <p><code>parBuffer :: Int -&gt; Strategy a -&gt; Strategy [a]</code><br>\n  Like evalBuffer but evaluates the list elements in parallel when pushing them into the buffer.\"</p>\n  \n  <p><code>evalBuffer :: Int -&gt; Strategy a -&gt; Strategy [a]</code><br>\n  evalBuffer is a rolling buffer strategy combinator for (lazy) lists.\n  evalBuffer is not as compositional as the type suggests. In fact, it evaluates list elements at least to weak head normal form, disregarding a strategy argument r0.\"</p>\n</blockquote>\n\n<p>The first part of my question is does this mean that <code>parBuffer</code> also disregard its strategy argument? Also why would it even provide a Strategy argument if it just disregards it?</p>\n\n<p>The second part of my question is how does one determine which size of buffer to use with <code>parBuffer</code>? If <code>parBuffer</code> always maintains a buffer size of <code>n</code>, what is the difference between <code>n=1</code> and <code>n=10</code> other than more sparks must be kept in memory? I was thinking it might be wise to pick <code>n=&lt;number of threads&gt;\"</code> but I don't know how that would improve anything because <code>parBuffer</code> will still create a spark whenever a spark is consumed, regardless of whether <code>n=1</code> or <code>n=4</code>.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 4, "last_activity_date": 1437922662, "creation_date": 1437922662, "answer_id": 31638435, "question_id": 31638381, "link": "https://stackoverflow.com/questions/31638381/treat-negation-character-as-a-function/31638435#31638435", "title": "treat negation character as a function", "body": "<p>You can use <code>\\x -&gt; x - 1</code> as you suggest, or <code>subtract 1</code>. Prefix negation is a special case: <code>(-1)</code>, unlike <code>(1-)</code>, <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-300003.5\" rel=\"nofollow\">doesn't become a section</a>.</p>\n"}], "owner": {"reputation": 26022, "user_id": 410102, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/a70b7da5a3a712e800100e61ef8d8917?s=128&d=identicon&r=PG", "display_name": "akonsu", "link": "https://stackoverflow.com/users/410102/akonsu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "closed_date": 1437923869, "accepted_answer_id": 31638435, "answer_count": 1, "score": 0, "last_activity_date": 1437922670, "creation_date": 1437922388, "question_id": 31638381, "link": "https://stackoverflow.com/questions/31638381/treat-negation-character-as-a-function", "closed_reason": "Duplicate", "title": "treat negation character as a function", "body": "<p>I am trying to figure out how to make haskell happy with the following equation:</p>\n\n<pre><code>f = either id (-1)\n</code></pre>\n\n<p>it complains:</p>\n\n<pre><code>No instance for (Num (Int -&gt; Int))\n  arising from a use of syntactic negation\nIn the second argument of \u2018either\u2019, namely \u2018(- 1)\u2019\nIn the expression: either id (- 1)\nIn an equation for \u2018f\u2019: f = either id (- 1)\n</code></pre>\n\n<p>Do I have to resort to</p>\n\n<pre><code>f = either id (\\x -&gt; x-1)\n</code></pre>\n\n<p>or maybe there is a a type signature that will make it work?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 142, "user_id": 1004795, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da5bb86f4db0d66165ae9b8005dcd2d3?s=128&d=identicon&r=PG", "display_name": "Gerrit", "link": "https://stackoverflow.com/users/1004795/gerrit"}, "edited": false, "score": 0, "creation_date": 1437919467, "post_id": 31637295, "comment_id": 51222046, "body": "Thanks a lot. Must have missed that option in the documentation."}], "tags": [], "owner": {"reputation": 785, "user_id": 3087558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a43d21bfa85dc7dc360cafa7f69ba3b1?s=128&d=identicon&r=PG&f=1", "display_name": "fgv", "link": "https://stackoverflow.com/users/3087558/fgv"}, "is_accepted": true, "score": 5, "last_activity_date": 1437915953, "creation_date": 1437915953, "answer_id": 31637295, "question_id": 31636962, "link": "https://stackoverflow.com/questions/31636962/how-to-use-int-with-the-optparse-applicative-inside-a-data-constructor/31637295#31637295", "title": "How to use Int with the optparse-applicative inside a data constructor?", "body": "<p>All you need to do is tell option to use the <em>auto</em> reader, as in this fragment of code:</p>\n\n<pre><code>configuration :: Parser Configuration\nconfiguration = Configuration\n    &lt;$&gt; strOption\n        ( long \"foo\"\n        &lt;&gt; metavar \"ARG1\"\n        )\n    &lt;*&gt; option auto\n        ( long \"bar\"\n        &lt;&gt; metavar \"ARG2\"\n        )\n</code></pre>\n\n<p>The difference between strOption and option, is that strOption assumes a String return type, while option can be configured to use custom readers. The <em>auto</em> reader assumes a <em>Read</em> instance for the return type.</p>\n\n<p>There is good documentation in the <a href=\"http://hackage.haskell.org/package/optparse-applicative\">OptParse applicative</a> Hackage page.</p>\n\n<p>I hope this helps.</p>\n"}], "owner": {"reputation": 142, "user_id": 1004795, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da5bb86f4db0d66165ae9b8005dcd2d3?s=128&d=identicon&r=PG", "display_name": "Gerrit", "link": "https://stackoverflow.com/users/1004795/gerrit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 582, "favorite_count": 0, "accepted_answer_id": 31637295, "answer_count": 1, "score": 3, "last_activity_date": 1437915953, "creation_date": 1437913735, "last_edit_date": 1495542709, "question_id": 31636962, "link": "https://stackoverflow.com/questions/31636962/how-to-use-int-with-the-optparse-applicative-inside-a-data-constructor", "title": "How to use Int with the optparse-applicative inside a data constructor?", "body": "<p>I would like to use the <a href=\"http://hackage.haskell.org/package/optparse-applicative\" rel=\"nofollow noreferrer\">optparse-applicative</a> package to add command line arguments to my program.</p>\n\n<p>The program requires different types of parameters (<code>String</code> and <code>Int</code>). To keep it simple, I would like to only have one data type to hold all my settings like this:</p>\n\n<pre><code>data Configuration = Configuration\n                    { foo :: String\n                    , bar :: Int\n                    }\n</code></pre>\n\n<p>I found one way <a href=\"https://stackoverflow.com/a/24647370/1004795\">here</a> to do this. But unfortunately it seems that the functions have changed.</p>\n\n<p>Here is a minimal (not) working example of what I would like to do:</p>\n\n<pre><code>module Main where\n\nimport Options.Applicative\nimport Control.Monad.Trans.Reader\n\ndata Configuration = Configuration\n                    { foo :: String\n                    , bar :: Int\n                    }\n\nconfiguration :: Parser Configuration\nconfiguration = Configuration\n    &lt;$&gt; strOption\n        ( long \"foo\"\n       &lt;&gt; metavar \"ARG1\"\n        )\n    &lt;*&gt; option\n        ( long \"bar\"\n       &lt;&gt; metavar \"ARG2\"\n       )\n\nmain :: IO ()\nmain = do\n    config &lt;- execParser (info configuration fullDesc)\n    putStrLn (show (bar config) ++ foo config)\n</code></pre>\n\n<p>Is there a simple way to do this or do I have to implement a <code>intOption</code> similar to the <code>strOption</code>?</p>\n"}, {"tags": ["haskell", "types", "typechecking"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1437912015, "post_id": 31636431, "comment_id": 51219963, "body": "Executable example, please."}, {"owner": {"reputation": 1308, "user_id": 1203558, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/kb4nh.jpg?s=128&g=1", "display_name": "aemxdp", "link": "https://stackoverflow.com/users/1203558/aemxdp"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1437913562, "post_id": 31636431, "comment_id": 51220385, "body": "@Andr&#225;sKov&#225;cs, the question is basically why (and in what cases) the local same-type-carrying p isn&#39;t the same as if we pass it externally as parameter. I&#39;m sorry, but as I don&#39;t understand what&#39;s going on, I don&#39;t know how to reproduce this with simpler cases without &#39; git clone <a href=\"https://github.com/haskell-servant/servant.git\" rel=\"nofollow noreferrer\">github.com/haskell-servant/servant.git</a> &#39;."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1437918352, "post_id": 31637211, "comment_id": 51221736, "body": "I&#39;ve begun to think Haskell&#39;s designers erred in capitalizing type synonyms (and therefore type families). They violate the useful law that everything that starts with a capital letter is a constructor. Their choice allows the dubious shorthand of omitting <code>forall</code> at the top level, which hardly seems worth the ambiguity."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 1, "last_activity_date": 1437915415, "creation_date": 1437915415, "answer_id": 31637211, "question_id": 31636431, "link": "https://stackoverflow.com/questions/31636431/data-proxy-in-servants-public-api-why-proxy-with-scopedtypevariables-doesnt-w/31637211#31637211", "title": "Data.Proxy in servant&#39;s public API (why Proxy with ScopedTypeVariables doesn&#39;t work)", "body": "<p><code>Server</code> isn't a type constructor, it's a type synonym for the <code>ServerT</code> associated type in the <a href=\"https://hackage.haskell.org/package/servant-server-0.4.3.1/docs/Servant-Server-Internal.html\" rel=\"nofollow\"><code>HasServer</code></a> class. Therefore <code>layout</code> occurring in <code>Server layout</code> doesn't disambiguate the <code>HasServer</code> constraint. We can only resolve the <code>Server layout</code> type if we already have a <code>HasServer layout</code> instance.</p>\n"}, {"comments": [{"owner": {"reputation": 3023, "user_id": 1691145, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4b6744a17b41f3b0e5c7554a43a04094?s=128&d=identicon&r=PG", "display_name": "Justin Raymond", "link": "https://stackoverflow.com/users/1691145/justin-raymond"}, "edited": false, "score": 0, "creation_date": 1448310750, "post_id": 31637456, "comment_id": 55524474, "body": "For a longer explanation of type families and injectivity, see <a href=\"https://wiki.haskell.org/GHC/Type_families#Injectivity.2C_type_inference.2C_and_ambiguity\" rel=\"nofollow noreferrer\">wiki.haskell.org/GHC/&hellip;</a>"}], "tags": [], "owner": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "is_accepted": true, "score": 9, "last_activity_date": 1437925450, "last_edit_date": 1437925450, "creation_date": 1437916998, "answer_id": 31637456, "question_id": 31636431, "link": "https://stackoverflow.com/questions/31636431/data-proxy-in-servants-public-api-why-proxy-with-scopedtypevariables-doesnt-w/31637456#31637456", "title": "Data.Proxy in servant&#39;s public API (why Proxy with ScopedTypeVariables doesn&#39;t work)", "body": "<p>Type families are not injective, and behind <code>Server</code> there's one. So if you pass a <code>Server MyAPI</code> to this function, GHC won't be able to conclude <code>layout = MyAPI</code>. We unfortunately really need a <code>Proxy</code> in there. Even if we had injective type families, that wouldn't help:</p>\n\n<pre><code>type API1 = Get '[JSON] User\ntype API2 = Post '[JSON] User\n</code></pre>\n\n<p>These two APIs are such that <code>Server API1 = Server API2</code> but <code>API1 /= API2</code>, which actually shows us that <code>Server</code> <strong>must not</strong> be injective. The easiest way to disambiguate the API type we want to target is the <code>Proxy</code>. On the other hand, that's quite often the only thing our APIs ask for in the various servant packages.</p>\n"}], "owner": {"reputation": 1308, "user_id": 1203558, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/kb4nh.jpg?s=128&g=1", "display_name": "aemxdp", "link": "https://stackoverflow.com/users/1203558/aemxdp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 446, "favorite_count": 0, "accepted_answer_id": 31637456, "answer_count": 2, "score": 8, "last_activity_date": 1437925450, "creation_date": 1437910014, "last_edit_date": 1437918015, "question_id": 31636431, "link": "https://stackoverflow.com/questions/31636431/data-proxy-in-servants-public-api-why-proxy-with-scopedtypevariables-doesnt-w", "title": "Data.Proxy in servant&#39;s public API (why Proxy with ScopedTypeVariables doesn&#39;t work)", "body": "<p>I'm excited about <a href=\"http://haskell-servant.github.io/\" rel=\"noreferrer\">servant</a>, and I'm ok with its internal typelevel magic as long as it doesn't gets in the way, and the only thing that confuses me is its use of a <a href=\"https://hackage.haskell.org/package/base-4.7.0.2/docs/Data-Proxy.html\" rel=\"noreferrer\">type-proxy</a> in public API. Here's the <a href=\"https://github.com/haskell-servant/servant/blob/master/servant-server/src/Servant/Server.hs#L109\" rel=\"noreferrer\">code</a>:</p>\n\n<pre><code>serve :: HasServer layout =&gt; Proxy layout -&gt; Server layout -&gt; Application\nserve p server = toApplication (runRouter (route p (return (RR (Right server)))))\n</code></pre>\n\n<p>As I understand, type-proxies are fairly simple thing and are needed to carry a type when you don't have a value with that type. So why to pass a proxy carrying layout type when there is already layout type in Server's type parameter? I've tried cloning servant's repo and changing code to this:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\nserve :: forall layout . HasServer layout =&gt; Server layout -&gt; Application\nserve server = toApplication (runRouter (route p (return (RR (Right server)))))\n  where\n    p :: Proxy layout\n    p  = Proxy\n</code></pre>\n\n<p>And surprisingly to me this fails to compile (telling something about layout type mismatch). But why, shouldn't my local p have the same layout type as server (with ScopedTypeVariables turned on)?</p>\n"}, {"tags": ["haskell", "recursion", "lazy-evaluation"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 6, "creation_date": 1437902429, "post_id": 31635350, "comment_id": 51217497, "body": "<code>map head calcBMI [(w, h) | w &lt;- [60..70], h &lt;- [1.65]]</code> is just ill-typed, so laziness isn&#39;t particularly relevant here. Also, the list resulting from <code>calcBMI</code> has type <code>[Double]</code>, so it&#39;s not possible to <code>head</code> each element, because <code>head</code> works on lists and <code>Double</code>-s aren&#39;t lists. Could you clarify what functionality you&#39;d like to achieve?"}, {"owner": {"reputation": 303, "user_id": 2369099, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/EYU6y.png?s=128&g=1", "display_name": "The one that loves FP", "link": "https://stackoverflow.com/users/2369099/the-one-that-loves-fp"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1437903723, "post_id": 31635350, "comment_id": 51217795, "body": "Hi. The result I&#39;d like to get is that I run another function, say <code>declareBMI</code> that takes the numeric value <code>calcBMI</code> computed and outputs a string saying &quot;You&#39;re OK&quot;, &quot;You&#39;re fat&quot;, etc. To the best of my understanding <code>calcBMI</code> as I defined it returns a list of Double: <code>[Double]</code>. I can see why <code>map head</code> won&#39;t work... now that I think about it, but I also tried: <code>map declareBMI head calcBMI...</code> and it failed too."}, {"owner": {"reputation": 303, "user_id": 2369099, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/EYU6y.png?s=128&g=1", "display_name": "The one that loves FP", "link": "https://stackoverflow.com/users/2369099/the-one-that-loves-fp"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1437904202, "post_id": 31635350, "comment_id": 51217912, "body": "Rethinking my code I see why <code>map</code> is <b>not</b> the right way to go, starting from the second element there&#39;s nothing to <code>head</code>, it is ill-typed as Andras Kovacs states! So, I&#39;m now at a complete loss as to how to generate the list of declarations from the list of doubles."}], "answers": [{"comments": [{"owner": {"reputation": 303, "user_id": 2369099, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/EYU6y.png?s=128&g=1", "display_name": "The one that loves FP", "link": "https://stackoverflow.com/users/2369099/the-one-that-loves-fp"}, "edited": false, "score": 0, "creation_date": 1437906899, "post_id": 31635708, "comment_id": 51218562, "body": "Excellent! Thank you very much. Thanks for walking me through it, not just putting some code and letting me figure it out. Also, comment about parenthesis -- taken to heart."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 1, "last_activity_date": 1437906945, "last_edit_date": 1437906945, "creation_date": 1437904931, "answer_id": 31635708, "question_id": 31635350, "link": "https://stackoverflow.com/questions/31635350/forcing-eager-evaluation-of-a-haskell-list/31635708#31635708", "title": "Forcing eager evaluation of a Haskell list", "body": "<p>Make sure the types line up. If you're unsure about types or get compiler errors, try to break up your code into smaller expressions and use GHCi or <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/typed-holes.html\" rel=\"nofollow\">TypedHoles</a> to inspect types.</p>\n\n<p>An example GHCi session:</p>\n\n<pre><code>&gt; let xs = [(w, h) | w &lt;- [60..70], h &lt;- [1.65]]\n&gt; :t calcBMI xs\ncalcBMI xs :: [Double]\n</code></pre>\n\n<p>Here we asked the type of <code>calcBMI xs</code>, and got <code>[Double]</code> as expected.</p>\n\n<p>Now we can take the first element of <code>calcBMI xs</code> using <code>head</code>:</p>\n\n<pre><code>&gt; head (calcBMI xs)\n22.03856749311295\n</code></pre>\n\n<p>We can use <code>head</code> because its input is a list, and <code>calcBMI xs</code> is a list.</p>\n\n<pre><code>&gt; :t head\nhead :: [a] -&gt; a\n</code></pre>\n\n<p><code>declareBMI</code> has type <code>Double -&gt; String</code>, so we can use it on plain <code>Double</code> values, but we can also use it on values inside lists with <code>map</code>.</p>\n\n<pre><code>&gt; let bmis = calcBMI xs\n&gt; declareBMI (head bmis)\n\"Norm\"\n</code></pre>\n\n<p>Here we used <code>declareBMI</code> on a <code>Double</code>. We could also first use <code>declareBMI</code> on on the list elements, and apply <code>head</code> afterwards.</p>\n\n<pre><code>&gt; :t map declareBMI bmis\nmap declareBMI bmis :: [String]\n&gt; map declareBMI bmis\n[\"Norm\",\"Norm\",\"Norm\",\"Norm\",\"Norm\",\"Norm\",\"Norm\",\"Norm\",\"Norm\",\"Overweight\",\"Overweight\"]\n&gt; head (map declareBMI bmis)\n\"Norm\"\n</code></pre>\n\n<p>Also, don't forget that in Haskell we apply functions just by whitespace. So <code>head (map declareBMI bmis)</code> is correct, because <code>map</code> takes two arguments here, and <code>head</code> takes one. We don't parenthesize function calls, but rather individual arguments to a function. </p>\n"}], "owner": {"reputation": 303, "user_id": 2369099, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/EYU6y.png?s=128&g=1", "display_name": "The one that loves FP", "link": "https://stackoverflow.com/users/2369099/the-one-that-loves-fp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 695, "favorite_count": 1, "accepted_answer_id": 31635708, "answer_count": 1, "score": 2, "last_activity_date": 1437927396, "creation_date": 1437901899, "last_edit_date": 1437927396, "question_id": 31635350, "link": "https://stackoverflow.com/questions/31635350/forcing-eager-evaluation-of-a-haskell-list", "title": "Forcing eager evaluation of a Haskell list", "body": "<p>Going over the \"Learn yourself...\" book I encountered a BMI calculator app. The app, so far, takes a list of pairs of Double and returns a list of Double:</p>\n\n<pre><code>calcBMI :: [(Double, Double)] -&gt; [Dobule]\ncalcBMI xs = [bmi w h | (w, h) &lt;- xs]\n    where bmi weight height = weight / height ^ 2\n</code></pre>\n\n<p>Trying to apply another function to each element of the returned list I tried <code>map declareBMI head calcBMI [(w, h) | w &lt;- [60..70], h &lt;- [1.65]]</code> but got an error (where <code>declareBMI</code> was defined):</p>\n\n<pre><code>declareBMI :: Double -&gt; String\ndeclareBMI bmi\n    | bmi &lt;= 18.5 = \"Skinny\"\n    | bmi &lt;= 25 = \"Norm\"\n    | bmi &lt;=30 = \"Overweight\"\n    | otherwise = \"OBESE!\"\n</code></pre>\n\n<p>After viewing the definition of <code>map</code> (i.e. <code>map f x:xs = f x : map f xs</code>) I figured out the problem: I'm trying to call <code>head</code> on the remainder of a <strong>lazy</strong> list, meaning the interpreter tries to <strong>first</strong> run <code>calcBMI</code> and only then <code>head</code>-ing the result... and this will of course fail because <code>calcBMI</code> requires a list of pairs.</p>\n\n<p>So, my question is</p>\n\n<ol>\n<li>is there a way to force an eager evaluation of the <code>calcBMI</code> function so I can run <code>head</code> on the resultant list?</li>\n<li>Is there a <strong>better way</strong> then forcing eager evaluation to allow me to <code>head</code> each element of the resultant list?</li>\n</ol>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1437850003, "post_id": 31629756, "comment_id": 51207144, "body": "What is the cabal and ghc version you are using ?"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1437850148, "post_id": 31629756, "comment_id": 51207183, "body": "Also just to be sure, can you run <code>cabal configure</code> first and paste the output here ?"}, {"owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1437850368, "post_id": 31629756, "comment_id": 51207241, "body": "@Sibi question updated"}, {"owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1437850452, "post_id": 31629756, "comment_id": 51207268, "body": "@Sibi cabal &amp; ghci version added"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1437850733, "post_id": 31629756, "comment_id": 51207349, "body": "The problem is not with <code>cabal repl</code> or <code>ghci</code>. There is a syntax error in line 19 of your <code>SparkSetup.cabal</code> file."}, {"owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1437851090, "post_id": 31629756, "comment_id": 51207424, "body": "@duplode please see update"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1437851386, "post_id": 31629756, "comment_id": 51207489, "body": "The error says <code>cabal: SparkSetup.cabal:19: Construct not supported at this position: F 19 &quot;main-is&quot; &quot;SparkSetup.hs\\nbuild-depends: base &gt;=4.7 &amp;&amp; &lt;4.8,http-conduit-downloader\\ndefault-language: Haskell2010&quot;</code>. That <code>\\n</code> looks odd - perhaps the cabal file has Unix line endings?"}, {"owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1437852280, "post_id": 31629756, "comment_id": 51207745, "body": "@duplode please see edit"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1437852647, "post_id": 31629756, "comment_id": 51207841, "body": "<code>setup.exe: The package has a &#39;.&#47;configure&#39; script. This requires a Unix compatibility toolchain such as MinGW+MSYS or Cygwin.</code>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1437852660, "post_id": 31629756, "comment_id": 51207843, "body": "On the latest edit: There are a few complications with building the <code>network</code> package in Windows. See <a href=\"http://stackoverflow.com/questions/22570952/network-2-4-2-2-error-cabal-install-on-windows\">this question</a> for suggestions, or just start over with the latest <a href=\"https://www.haskell.org/platform/windows.html\" rel=\"nofollow noreferrer\">Haskell platform for windows</a>, which includes a pre-built <code>network</code>, and then recreate your sandbox."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1437853203, "post_id": 31629756, "comment_id": 51207974, "body": "I would go with duplode&#39;s suggestion. Also you can try <code>stack</code> as an alternative to Haskell platform."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1437853847, "post_id": 31629756, "comment_id": 51208158, "body": "@Sibi Not 100% sure (I haven&#39;t tried it on Windows), but I believe the OP will run into the same issue using <code>stack</code>, as it will (try to) compile <code>network</code> anyway. (By the way, <code>stack</code> should work fine with a Haskell Platform, though that will limit your ability to use recent Stackage snapshots.)"}, {"owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1438115676, "post_id": 31629756, "comment_id": 51314869, "body": "@Sibi why delete your answer ? &quot;cabal repl&quot; is useful command and is related to question."}], "owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1007, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1437852266, "creation_date": 1437848834, "last_edit_date": 1437852266, "question_id": 31629756, "link": "https://stackoverflow.com/questions/31629756/add-dependency-to-ghci", "title": "Add dependency to GHCI", "body": "<p>Can I include a dependency in GHCI.</p>\n\n<p>If running cabal add to .cabal file</p>\n\n<pre><code>build-depends:       base &gt;=4.7 &amp;&amp; &lt;4.8,http-conduit-downloader\n</code></pre>\n\n<p>Can <code>http-conduit-downloader</code> be included in GHCI ?</p>\n\n<p>Update : </p>\n\n<p>Runnning commands : </p>\n\n<pre><code>c:\\Users\\Adrian\\Google Drive\\SparkSetup&gt;cabal sandbox init\nWriting a default package environment file to c:\\Users\\Adrian\\Google\nDrive\\SparkSetup\\cabal.sandbox.config\nUsing an existing sandbox located at C:\\Users\\Adrian\\Google\nDrive\\SparkSetup\\.cabal-sandbox\n\nc:\\Users\\Adrian\\Google Drive\\SparkSetup&gt;cabal install --only-dependencies\ncabal: SparkSetup.cabal:19: Construct not supported at this position: F 19\n\"main-is\" \"SparkSetup.hs\\nbuild-depends: base &gt;=4.7 &amp;&amp;\n&lt;4.8,http-conduit-downloader\\ndefault-language: Haskell2010\"\n\nc:\\Users\\Adrian\\Google Drive\\SparkSetup&gt;cabal repl\nPackage has never been configured. Configuring with default flags. If this\nfails, please run configure manually.\ncabal: SparkSetup.cabal:19: Construct not supported at this position: F 19\n\"main-is\" \"SparkSetup.hs\\nbuild-depends: base &gt;=4.7 &amp;&amp;\n&lt;4.8,http-conduit-downloader\\ndefault-language: Haskell2010\"\n</code></pre>\n\n<p><code>cabal repl</code> does not start the repl ?</p>\n\n<p>Update 2  :</p>\n\n<pre><code>c:\\Users\\Adrian\\Google Drive\\SparkSetup&gt;cabal configure\ncabal: SparkSetup.cabal:19: Construct not supported at this position: F 19\n\"main-is\" \"SparkSetup.hs\\nbuild-depends: base &gt;=4.7 &amp;&amp;\n&lt;4.8,http-conduit-downloader\\ndefault-language: Haskell2010\"\n</code></pre>\n\n<p>Update 3 : </p>\n\n<p>cabal and ghci versions : </p>\n\n<pre><code>C:\\Users\\Adrian\\Google Drive\\SparkSetup&gt;cabal --version\ncabal-install version 1.18.0.5\nusing version 1.18.1.3 of the Cabal library\n\nC:\\Users\\Adrian\\Google Drive\\SparkSetup&gt;ghci\nGHCi, version 7.8.3: http://www.haskell.org/ghc/  :? for help\nLoading package ghc-prim ... linking ... done.\nLoading package integer-gmp ... linking ... done.\nLoading package base ... linking ... done.\nPrelude&gt;\n</code></pre>\n\n<p>Update 4 : </p>\n\n<p>SparkSetup.cabal : </p>\n\n<pre><code>-- Initial SparkSetup.cabal generated by cabal init.  For further \n-- documentation, see http://haskell.org/cabal/users-guide/\n\nname:                SparkSetup\nversion:             0.1.0.0\n-- synopsis:            \n-- description:         \nlicense:             GPL-2\nlicense-file:        LICENSE\nauthor:              USER\nmaintainer:          USER.COM\n-- copyright:           \n-- category:            \nbuild-type:          Simple\n-- extra-source-files:  \ncabal-version:       &gt;=1.10\n\nexecutable SparkSetup\nmain-is: SparkSetup.hs             \n  -- other-modules:       \n  -- other-extensions:    \n  build-depends:       base &gt;=4.7 &amp;&amp; &lt;4.8,http-conduit-downloader\n  -- hs-source-dirs:      \n  default-language:    Haskell2010\n</code></pre>\n\n<p>Line 19 :  <code>main-is: SparkSetup.hs</code></p>\n\n<p>SparkSetup.hs exists at same dir as SparkSetup.cabal, SparkSetup.hs contents are : <code>main = putStrLn \"Hello, World!\"</code></p>\n\n<p>Is this not correct ?</p>\n\n<p>Update 5 : </p>\n\n<p>updated .cabal file : </p>\n\n<pre><code>-- Initial SparkSetup.cabal generated by cabal init.  For further \n-- documentation, see http://haskell.org/cabal/users-guide/\n\nname:                SparkSetup\nversion:             0.1.0.0\n-- synopsis:            \n-- description:         \nlicense:             GPL-2\nlicense-file:        LICENSE\nauthor:              USER\nmaintainer:          USER.COM\n-- copyright:           \n-- category:            \nbuild-type:          Simple\n-- extra-source-files:  \ncabal-version:       &gt;=1.10\n\nexecutable SparkSetup\n  main-is: SparkSetup.hs\n  -- other-modules:    \n  -- other-extensions:    \n  build-depends:       base &gt;=4.7 &amp;&amp; &lt;4.8,http-conduit-downloader\n  -- hs-source-dirs:      \n  default-language:    Haskell2010\n</code></pre>\n\n<p>Appears to have been an indentation issue (\\n may also have caused issue)</p>\n\n<p>But now when I run : </p>\n\n<pre><code>c:\\Users\\Adrian\\Google Drive\\SparkSetup&gt;cabal install\nResolving dependencies...\nNotice: installing into a sandbox located at C:\\Users\\Adrian\\Google\nDrive\\SparkSetup\\.cabal-sandbox\nConfiguring network-2.6.2.1...\nFailed to install network-2.6.2.1\nLast 10 lines of the build log ( C:\\Users\\Adrian\\Google Drive\\SparkSetup\\.cabal-\nsandbox\\logs\\network-2.6.2.1.log ):\n[1 of 1] Compiling Main             ( C:\\Users\\Adrian\\AppData\\Local\\Temp\\network\n-2.6.2.1-10212\\network-2.6.2.1\\dist\\dist-sandbox-8472864c\\setup\\setup.hs, C:\\Use\nrs\\Adrian\\AppData\\Local\\Temp\\network-2.6.2.1-10212\\network-2.6.2.1\\dist\\dist-san\ndbox-8472864c\\setup\\Main.o )\nLinking C:\\Users\\Adrian\\AppData\\Local\\Temp\\network-2.6.2.1-10212\\network-2.6.2.1\n\\dist/dist-sandbox-8472864c\\setup\\setup.exe ...\nConfiguring network-2.6.2.1...\nsetup.exe: The package has a './configure' script. This requires a Unix\ncompatibility toolchain such as MinGW+MSYS or Cygwin.\ncabal: Error: some packages failed to install:\nHsOpenSSL-0.11.1.1 depends on network-2.6.2.1 which failed to install.\nSparkSetup-0.1.0.0 depends on network-2.6.2.1 which failed to install.\nconnection-0.2.5 depends on network-2.6.2.1 which failed to install.\nhttp-client-0.4.18.1 depends on network-2.6.2.1 which failed to install.\nhttp-client-tls-0.2.2 depends on network-2.6.2.1 which failed to install.\nhttp-conduit-2.1.7.1 depends on network-2.6.2.1 which failed to install.\nhttp-conduit-downloader-1.0.25 depends on network-2.6.2.1 which failed to\ninstall.\nnetwork-2.6.2.1 failed during the configure step. The exception was:\nExitFailure 1\nsocks-0.5.4 depends on network-2.6.2.1 which failed to install.\nstreaming-commons-0.1.12.1 depends on network-2.6.2.1 which failed to install.\ntls-1.3.1 depends on network-2.6.2.1 which failed to install.\nx509-validation-1.6.0 depends on network-2.6.2.1 which failed to install.\n</code></pre>\n\n<p>Seems there is an issue with <code>http-conduit-downloader</code> package also ?</p>\n"}, {"tags": ["haskell", "monad-transformers", "state-monad"], "answers": [{"comments": [{"owner": {"reputation": 354, "user_id": 3777717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b2cf577b7fcab545f75f6e1bcc6ca72?s=128&d=identicon&r=PG&f=1", "display_name": "ByteEater", "link": "https://stackoverflow.com/users/3777717/byteeater"}, "edited": false, "score": 2, "creation_date": 1437846125, "post_id": 31629187, "comment_id": 51205973, "body": "I realize that. I&#39;m not looking for a version without a monad transformer for efficiency&#39;s sake, I just want to see what it would look like and learn something by comparing the two, hopefully attaining better appreciation of the need for monad transformers."}, {"owner": {"reputation": 354, "user_id": 3777717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b2cf577b7fcab545f75f6e1bcc6ca72?s=128&d=identicon&r=PG&f=1", "display_name": "ByteEater", "link": "https://stackoverflow.com/users/3777717/byteeater"}, "edited": false, "score": 0, "creation_date": 1437846538, "post_id": 31629187, "comment_id": 51206105, "body": "Also, running the accumulated state computation on every line is something I considered and rejected for exactly this reason: it doesn&#39;t seem the right way to use monads, a simple <code>Int</code> would be a better choice. Moreover, with incrementation it doesn&#39;t make a difference, but it would be wrong conceptually, since the <code>State</code> computation is built by prepending <code>modify (+1)</code> actions, so if I had e.g. <code>modify (+ length l)</code>, that wouldn&#39;t work as it should."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 354, "user_id": 3777717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b2cf577b7fcab545f75f6e1bcc6ca72?s=128&d=identicon&r=PG&f=1", "display_name": "ByteEater", "link": "https://stackoverflow.com/users/3777717/byteeater"}, "edited": false, "score": 0, "creation_date": 1437856300, "post_id": 31629187, "comment_id": 51208856, "body": "@ByteEater, the way to do it without a monad transformer is to just pass the <code>Int</code> around by hand (annoying) or use an <code>IORef</code> (limited to <code>IO</code>-like things and potentially inefficient, but okay if the box is unavoidable or updates are rare). I don&#39;t know what else you&#39;re looking for."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1437845146, "creation_date": 1437845146, "answer_id": 31629187, "question_id": 31628929, "link": "https://stackoverflow.com/questions/31628929/use-two-monads-without-a-transformer/31629187#31629187", "title": "Use two monads without a transformer", "body": "<p>You'd just need to run the accumulated state computation on every line. This is O(n\u00b2) time, but since your first program is already using O(n) space, that's not too terrible. Of course, the <code>StateT</code> approach is superior in pretty much every way! If you really want to do it \"by hand\" and not pay an efficiency price, just manage the state by hand instead of building a state transformer at all. You're really not getting any benefit by using <code>State</code> instead of <code>Int</code> in the first program.</p>\n"}, {"comments": [{"owner": {"reputation": 354, "user_id": 3777717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b2cf577b7fcab545f75f6e1bcc6ca72?s=128&d=identicon&r=PG&f=1", "display_name": "ByteEater", "link": "https://stackoverflow.com/users/3777717/byteeater"}, "edited": false, "score": 0, "creation_date": 1437848340, "post_id": 31629412, "comment_id": 51206648, "body": "Indeed, this allows the current value computed in <code>State Int</code> to be used, at the cost of recomputing it a linear number of times (though with a referentially transparent language and a smart compiler this cost might be avoided). I had considered it but remained unconvinced that this is the canonical equivalent with <code>State</code> and <code>IO</code> monads of my second programme which uses a transformer."}, {"owner": {"reputation": 3669, "user_id": 4876946, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5dc4839a7e9466d54f3791122f8f5d75?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/4876946/matt"}, "reply_to_user": {"reputation": 354, "user_id": 3777717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b2cf577b7fcab545f75f6e1bcc6ca72?s=128&d=identicon&r=PG&f=1", "display_name": "ByteEater", "link": "https://stackoverflow.com/users/3777717/byteeater"}, "edited": false, "score": 0, "creation_date": 1437849256, "post_id": 31629412, "comment_id": 51206945, "body": "I doubt that this is any more &quot;canonical&quot; than my first attempt, but my second edit can bound the state computation to a constant size, by throwing away the previous state computation, and immediately setting the current state to the last one&#39;s result plus 1.  Any better?"}, {"owner": {"reputation": 354, "user_id": 3777717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b2cf577b7fcab545f75f6e1bcc6ca72?s=128&d=identicon&r=PG&f=1", "display_name": "ByteEater", "link": "https://stackoverflow.com/users/3777717/byteeater"}, "edited": false, "score": 0, "creation_date": 1437868274, "post_id": 31629412, "comment_id": 51211590, "body": "Better, in the way you described. But it still doesn&#39;t compare easily with the version using StateT in order to clearly see what improvement in code (refactoring to a superior form) can actually be achieved with a monad transformer."}], "tags": [], "owner": {"reputation": 3669, "user_id": 4876946, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5dc4839a7e9466d54f3791122f8f5d75?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/4876946/matt"}, "is_accepted": false, "score": 1, "last_activity_date": 1437849878, "last_edit_date": 1437849878, "creation_date": 1437846672, "answer_id": 31629412, "question_id": 31628929, "link": "https://stackoverflow.com/questions/31628929/use-two-monads-without-a-transformer/31629412#31629412", "title": "Use two monads without a transformer", "body": "<p>Maybe this is what you are looking for?</p>\n\n<pre><code>main = print =&lt;&lt; fmap (`evalState` 0) (go get) where\n  go :: State Int Int -&gt; IO (State Int Int)\n  go st = do\n     l &lt;- getLine \n     if null l\n     then return (st &gt;&gt;= \\_ -&gt; get)\n     else do\n          let ln = evalState st 0\n          putStrLn(show ln ++ ' ' : reverse l)\n          go (st &gt;&gt;= \\_ -&gt; modify (+1) &gt;&gt;= \\_ -&gt;  get) \n</code></pre>\n\n<p>The idea here is to make <code>go</code> tail recursive, building up your state computation, which you can then evaluate at each step.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>This version will bound the size of the state computation to a constant size, although under lazy evaluation, when the previous state computation is forced, we should be able to reuse it without re-evaluating it, so I'm guessing that these are essentially the same...</p>\n\n<pre><code>main = print =&lt;&lt; fmap (`evalState` 0) (go get) where\n  go :: State Int Int -&gt; IO (State Int Int)\n  go st = do\n     l &lt;- getLine \n     if null l\n     then return st\n     else do\n          let ln = evalState st 0\n          putStrLn(show ln ++ ' ' : reverse l)\n          go (modify (\\s -&gt; s+ln+1) &gt;&gt;= \\_ -&gt;  get) \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 10, "last_activity_date": 1437871412, "creation_date": 1437871412, "answer_id": 31632500, "question_id": 31628929, "link": "https://stackoverflow.com/questions/31628929/use-two-monads-without-a-transformer/31632500#31632500", "title": "Use two monads without a transformer", "body": "<p>The problem you're having is that the hand-unrolling of <code>StateT s IO a</code> is <code>s -&gt; IO (s, a)</code>, not <code>IO (s -&gt; (s, a))</code>! Once you have this insight, it's pretty easy to see how to do it:</p>\n\n<pre><code>go :: Int -&gt; IO (Int, Int)\ngo s = do\n    l &lt;- getLine\n    if null l\n    then return (s, s)\n    else do\n        putStrLn (show s ++ ' ' : reverse l)\n        go (s+1)\n</code></pre>\n"}], "owner": {"reputation": 354, "user_id": 3777717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b2cf577b7fcab545f75f6e1bcc6ca72?s=128&d=identicon&r=PG&f=1", "display_name": "ByteEater", "link": "https://stackoverflow.com/users/3777717/byteeater"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 226, "favorite_count": 1, "answer_count": 3, "score": 6, "last_activity_date": 1437871412, "creation_date": 1437843472, "question_id": 31628929, "link": "https://stackoverflow.com/questions/31628929/use-two-monads-without-a-transformer", "title": "Use two monads without a transformer", "body": "<p>In order to understand how to use monad transformers, I wrote the following code without one. It reads standard input line by line and displays each line reversed until an empty line is encountered. It also counts the lines using <code>State</code> and in the end displays the total number.</p>\n\n<pre><code>import Control.Monad.State\n\nmain = print =&lt;&lt; fmap (`evalState` 0) go where\n    go :: IO (State Int Int)\n    go = do\n        l &lt;- getLine\n        if null l\n        then return get\n        else do\n            putStrLn (reverse l)\n            -- another possibility: fmap (modify (+1) &gt;&gt;) go\n            rest &lt;- go\n            return $ do\n                modify (+1)\n                rest\n</code></pre>\n\n<p>I wanted to add the current line number before each line. I was able to do it with <code>StateT</code>:</p>\n\n<pre><code>import Control.Monad.State\n\nmain = print =&lt;&lt; evalStateT go 0 where\n    go :: StateT Int IO Int\n    go = do\n        l &lt;- lift getLine\n        if null l\n        then get\n        else do\n            n &lt;- get\n            lift (putStrLn (show n ++ ' ' : reverse l))\n            modify (+1)\n            go\n</code></pre>\n\n<p>My question is: how to do the same in the version without monad transformers?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 10180, "user_id": 143397, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/78d44a79f724bc784792b49f78769d3a?s=128&d=identicon&r=PG", "display_name": "davidA", "link": "https://stackoverflow.com/users/143397/davida"}, "edited": false, "score": 4, "creation_date": 1575258795, "post_id": 31629081, "comment_id": 104492772, "body": "What about <code>stack.yaml.lock</code>? Should that be committed too?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 10180, "user_id": 143397, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/78d44a79f724bc784792b49f78769d3a?s=128&d=identicon&r=PG", "display_name": "davidA", "link": "https://stackoverflow.com/users/143397/davida"}, "edited": false, "score": 2, "creation_date": 1575582090, "post_id": 31629081, "comment_id": 104625241, "body": "@davidA Those files contain supplementary information for specifying how to build the package, so it makes sense to commit them. (See also <a href=\"https://docs.haskellstack.org/en/stable/lock_files/\" rel=\"nofollow noreferrer\">the introduction to the doc page on lock files</a>.)"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 10, "last_activity_date": 1437844486, "creation_date": 1437844486, "answer_id": 31629081, "question_id": 31628186, "link": "https://stackoverflow.com/questions/31628186/is-the-stack-yaml-file-supposed-to-be-checked-into-version-control/31629081#31629081", "title": "Is the stack.yaml file supposed to be checked into version control?", "body": "<p>I'd say you should commit <code>stack.yaml</code>, as that makes it much easier to build your package in a reproducible way. That is particularly relevant if your repository is public, and if you use the more exotic kinds of extra-deps in <code>stack.yaml</code> (pointers to Git repositories, secondary cabal packages within your source tree, etc.).</p>\n\n<p>A complementary observation is that we should still provide reasonable version bounds for dependencies in the .cabal file even if we are using stack, as doing otherwise would make life harder for people who don't use stack or have a set of packages different than the specified by <code>stack.yaml</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "edited": false, "score": 0, "creation_date": 1488267297, "post_id": 31629372, "comment_id": 72143479, "body": "As long as you make sure that you don&#39;t edit stack.yaml besides what you get from stack init, then are you ok?"}], "tags": [], "owner": {"reputation": 21, "user_id": 5155934, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ab113caa4de5d84fa74bdfbfd5d72ed?s=128&d=identicon&r=PG", "display_name": "crough", "link": "https://stackoverflow.com/users/5155934/crough"}, "is_accepted": false, "score": 2, "last_activity_date": 1437846363, "creation_date": 1437846363, "answer_id": 31629372, "question_id": 31628186, "link": "https://stackoverflow.com/questions/31628186/is-the-stack-yaml-file-supposed-to-be-checked-into-version-control/31629372#31629372", "title": "Is the stack.yaml file supposed to be checked into version control?", "body": "<p>Yep. stack.yaml has a whole bunch of (not always necessary) fields such as the extra dependencies that matter for consistent builds. Check it in. </p>\n"}], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 907, "favorite_count": 0, "accepted_answer_id": 31629081, "answer_count": 2, "score": 13, "last_activity_date": 1437846363, "creation_date": 1437838765, "last_edit_date": 1437843624, "question_id": 31628186, "link": "https://stackoverflow.com/questions/31628186/is-the-stack-yaml-file-supposed-to-be-checked-into-version-control", "title": "Is the stack.yaml file supposed to be checked into version control?", "body": "<p>I'm quite new to <a href=\"https://github.com/commercialhaskell/stack\" rel=\"noreferrer\">stack</a> and wondering whether to <code>git commit</code> or <code>.gitignore</code> that file.</p>\n\n<p>What are the implications of either of these choices?</p>\n"}, {"tags": ["algorithm", "haskell", "iterative-deepening"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1437927275, "post_id": 31627704, "comment_id": 51224750, "body": "If it&#39;s three moves away from being solved, you should have no trouble solving it with IDA* even with a trivial heuristic - making no cuts and putting the expansions in any order. Getting rid of the heuristic and trying that would let you eliminate or identify the heuristic as a source of the problem."}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1438220220, "post_id": 31627704, "comment_id": 51365359, "body": "@Cirdec I changed the heuristic to 0 if it is reduced, and 1 otherwise, but the program still outputs nothing... I think the code must be wrong somewhere."}], "answers": [{"comments": [{"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 0, "creation_date": 1438220328, "post_id": 31641478, "comment_id": 51365386, "body": "Thanks for the explanation. But changing the heuristic to 0 if reduced and 1 otherwise didn&#39;t help much: in this case the heuristic should be admissible, right? Maybe I should re-write the code again."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 0, "creation_date": 1438224427, "post_id": 31641478, "comment_id": 51366272, "body": "I&#39;d encourage you to refactor the code so that IDA* search is written generically for any problem and successor Rubik&#39;s cube moves are independent of the heuristic. This will let you test each part separately from the others. IDA* search can be written in terms of a <code>heuristic :: Num cost =&gt; node -&gt; cost</code> and a successors function <code>expand :: node -&gt; [(cost, node)]</code> giving the whole function the type <code>idastar :: Num cost, Alternative f =&gt; (node -&gt; cost) -&gt; (node -&gt; [(cost, node)]) -&gt; node -&gt; f node</code>."}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 0, "creation_date": 1438233338, "post_id": 31641478, "comment_id": 51368668, "body": "I am not enough experienced in Haskell to understand your proposed function: What does it have to do with Alternative here? Why the result of idastar is in f node? Should I employ of something that both forms a Monoid and is an Applicative functor? And thanks for the suggestion to separate the heuristic and expand out! Lastly, may I ask is there any problem with the stage1 I wrote? Namely, does it cause any obvious infinite loops? Or is that code too chaotic to understand properly?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 0, "creation_date": 1438239105, "post_id": 31641478, "comment_id": 51371130, "body": "@awllower You can just use <code>Maybe</code> for &quot;there might be a result&quot; instead of any <code>Alternative f =&gt; f</code>. It might still be useful to use <code>&lt;|&gt;</code> from <code>Alternative</code> since the monoid instance for <code>Maybe</code> is useless. The <code>Applicative</code>/<code>Alternative</code> instance for <code>Maybe</code> is just <code>pure = Just</code>, <code>&lt;*&gt;</code> and <code>liftA2</code> combine <code>Just</code>s, <code>empty = Nothing</code>, and <code>&lt;|&gt;</code> takes the first <code>Just</code>. Using <code>Alternative</code> you could substitute a list and get all the answers in order as well."}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 0, "creation_date": 1438242918, "post_id": 31641478, "comment_id": 51373344, "body": "You mean when it is not possible to reduce the cube then the result would be a Nothing? OK, I shall try to work out in this direction. Thanks again!"}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 1, "last_activity_date": 1437941735, "creation_date": 1437941735, "answer_id": 31641478, "question_id": 31627704, "link": "https://stackoverflow.com/questions/31627704/what-is-wrong-with-this-implementation-of-ida-algorithm-in-haskell-bad-heurist/31641478#31641478", "title": "What is wrong with this implementation of IDA* algorithm in Haskell? Bad heuristic or simply bad code?", "body": "<p>Your heuristic is inadmissible. An admissible heuristic must be a lower bound on the real cost of a solution.</p>\n\n<p>You are trying to use as a heuristic the number of side pieces of the first layer that aren't correct, or perhaps the number of <em>faces</em> of the side pieces of the first layer that aren't correct, which is what you have actually written. Either way the heuristic is inadmissible.</p>\n\n<p>The following cube is only <code>1</code> move away from being solved, but <code>4</code> of the pieces in the first layer are in incorrect positions and <code>4</code> of the faces have the wrong color. Either heuristic would say that this puzzle will take at least <code>4</code> moves to solve when it can be solved in only <code>1</code> move. The heuristics are inadmissible, because they are not lower bounds on the real cost of the solution.</p>\n\n<p><a href=\"https://i.stack.imgur.com/zLpi7.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/zLpi7.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 430, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1437941735, "creation_date": 1437835863, "last_edit_date": 1495541641, "question_id": 31627704, "link": "https://stackoverflow.com/questions/31627704/what-is-wrong-with-this-implementation-of-ida-algorithm-in-haskell-bad-heurist", "title": "What is wrong with this implementation of IDA* algorithm in Haskell? Bad heuristic or simply bad code?", "body": "<p>I am trying to write a haskell program which can solve rubiks' cube. Firstly I tried <a href=\"https://stackoverflow.com/questions/31583603/how-to-implement-the-thistlethwaites-algorithm-in-haskell\">this</a>, but did not figure a way out to avoid writing a whole lot of codes, so I tried using an IDA* search for this task.</p>\n\n<p>But I do not know which heuristic is appropriate here: I tried dividing the problem into subproblems, and measuring the distance from being in a reduced state, but the result is disappointing: the program cannot reduce a cube that is three moves from a standard cube in a reasonable amount of time. I tried measuring parts of edges, and then either summing them, or using the maximums... but none of these works, and the result is almost identical.</p>\n\n<p>So I want to know what the problem with the code is: is the heuristic I used non-admissible? Or is my code causing some infinite loops that I did not detect? Or both? And how to fix that? The code (the relevant parts) goes as follows:</p>\n\n<pre><code>--Some type declarations\ndata Colors = R | B | W | Y | G | O\ntype R3 = (Int, Int, Int)\ntype Cube = R3 -&gt; Colors\npoints :: [R3] --list of coordinates of facelets of a cube; there are 48 of them.\nmU :: Cube -&gt; Cube --and other 5 similar moves.\n\ntype Actions = [Cube -&gt; Cube]\n\nturn :: Cube -&gt; Actions -&gt; Cube --chains the actions and turns the cube.\n\nedges :: [R3] --The edges of cubes\n\ntotheu1 :: Cube -&gt; Int  -- Measures how far away the cube is from having the cross of the first layer solved.\ntotheu1 c = sum $ map (\\d -&gt; if d then 0 else 1)\n                      [c (-2, 3, 0) == c (0, 3, 0),\n                       c (2, 3, 0) == c (0, 3, 0),\n                       c (0, 3, -2) == c (0, 3, 0),\n                       c (0, 3, 2) == c (0, 3, 0),\n                       c (0, 2, -3) == c (0, 0, -3),\n                       c (-3, 2, 0) == c (-3, 0, 0),\n                       c (0, 2, 3) == c (0, 0, 3),\n                       c (3, 2, 0) == c (3, 0, 0)]\n\nexpandnr :: (Cube -&gt; Cube) -&gt; Cube -&gt; [(Cube, String)] -- Generates a list of tuples of cubes and strings, \n\n-- the result after applying a move, and the string represents that move, while avoiding moving on the same face as the last one, \n\n-- and avoiding repetitions caused by commuting moves, like U * D = D * U.\n\ntype StateSpace = (Int, [String], Cube) -- Int -&gt; f value, [String] = actions applied so far, Cube = result cube.\n\nfstst :: StateSpace -&gt; Int\nfstst s@(x, y, z) = x\n\nstst :: StateSpace -&gt; [String]\nstst s@(x, y, z) = y\n\ncbst :: StateSpace -&gt; Cube\ncbst s@(x, y, z) = z\n\nstage1 :: Cube -&gt; StateSpace\nstage1 c = (\\(x, y, z) -&gt; (x, [sconcat y], z)) t\n where\n bound = totheu1 c\n t = looping c bound\n looping c bound = do let re = search (c, [\"\"]) (\\j -&gt; j) 0 bound\n                      let found = totheu1 $ cbst re\n                      if found == 0 then re else looping c found\n sconcat [] = \"\"\n sconcat (x:xs) = x ++ (sconcat xs)\n\nstraction :: String -&gt; Actions -- Converts strings to actions\n\nsearch :: (Cube, [String]) -&gt; (Cube -&gt; Cube) -&gt; Int -&gt; Int -&gt; StateSpace\nsearch cs@(c, s) k g bound\n | f &gt; bound = (f, s, c)\n | totheu1 c == 0 = (0, s, c)\n | otherwise = ms\n where\n f = g + totheu1 c\n olis = do\n         (succs, st) &lt;- expandnr k c\n         let [newact] = straction st\n         let t = search (succs, s ++ [st]) newact (g + 1) bound\n         return t\n lis = map fstst olis\n mlis = minimum lis\n ms = olis !! (ind)\n Just ind = elemIndex mlis lis\n</code></pre>\n\n<p>I know that this heuristic is inconsistent, but am not sure if it is really admissible, maybe the problem is its non-admissibility?  </p>\n\n<p>Any ideas, hints, and suggestions are well appreciated, thanks in advance.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1437832487, "post_id": 31627124, "comment_id": 51201739, "body": "This has little to do with <code>.</code> in particular, it&#39;s just that <i>fully automatic type inference is not possible with general higher-rank types</i>."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1437837809, "post_id": 31627124, "comment_id": 51203373, "body": "@leftaroundabout, how is inference related? Bidirectional type checking + unification should cover this case. Agda is <a href=\"http://lpaste.net/137326\" rel=\"nofollow noreferrer\">happy</a> at least."}], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 11, "last_activity_date": 1437845247, "last_edit_date": 1495541676, "creation_date": 1437845247, "answer_id": 31629197, "question_id": 31627124, "link": "https://stackoverflow.com/questions/31627124/rankntypes-and-the-dot-operator/31629197#31629197", "title": "RankNTypes and the dot operator", "body": "<p>Actually, <code>f</code> doesn't have type <code>Int -&gt; (forall r. r -&gt; r)</code>, because GHC <a href=\"https://stackoverflow.com/questions/28069938/haskell-multiple-contexts-currying\">floats out</a> every <code>forall</code> and class constraint to the top of the scope. So <code>f</code>'s type is really <code>forall r. Int -&gt; r -&gt; r</code>.</p>\n\n<p>For example, the following typechecks:</p>\n\n<pre><code>f :: Int -&gt; (forall r. r -&gt; r)\nf = undefined\n\nf' :: forall r. Int -&gt; r -&gt; r\nf' = f\n</code></pre>\n\n<p>This makes the <code>g . f</code> composition ill-typed (we can see that the error message points explicitly at the discrepancy between <code>r -&gt; r</code> and <code>forall r. r -&gt; r</code>).</p>\n\n<p>It would be probably better behavior for GHC to throw errors upon finding <code>forall</code>-s in wrong places, instead of silently floating them out. </p>\n\n<p>There are several reasons why polymorphic return types (which are outlawed by floating-out <code>forall</code>-s) aren't allowed in GHC. For details you can refer to <a href=\"http://research.microsoft.com/en-us/um/people/simonpj/papers/higher-rank/putting.pdf\" rel=\"nofollow noreferrer\">this paper</a> (section 4.6 specifically). In short, they only make sense if there is solid support for impredicative instantiation, which GHC lacks. In the absence of impredicative types, floating-out allows more terms to typecheck and rarely causes inconvenience in real world code. </p>\n"}], "owner": {"reputation": 153, "user_id": 3781722, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/091f671580ceda99dc67e803d3e3bbd4?s=128&d=identicon&r=PG&f=1", "display_name": "ammoh", "link": "https://stackoverflow.com/users/3781722/ammoh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1437845247, "creation_date": 1437831994, "question_id": 31627124, "link": "https://stackoverflow.com/questions/31627124/rankntypes-and-the-dot-operator", "title": "RankNTypes and the dot operator", "body": "<p>When I use RankNTypes, it seems that (.) operator doesn't work well. Where is this limitation documented?</p>\n\n<pre><code>{-# LANGUAGE RankNTypes, ImpredicativeTypes #-}\n\nf :: Int -&gt; (forall r. r -&gt; r)\nf = undefined\n\ng :: (forall r. r -&gt; r) -&gt; Int\ng = undefined\n\nh :: Int -&gt; Int\n-- h v = g (f v) -- It works well\nh = g . f -- I can't write it in this way\n</code></pre>\n\n<p>I get following errors.</p>\n\n<pre><code>[1 of 1] Compiling Main             ( test.hs, interpreted )\n\ntest.hs:11:9:\n    Couldn't match type \u2018r0 -&gt; r0\u2019 with \u2018forall r. r -&gt; r\u2019\n    Expected type: Int -&gt; forall r. r -&gt; r\n      Actual type: Int -&gt; r0 -&gt; r0\n    In the second argument of \u2018(.)\u2019, namely \u2018f\u2019\n    In the expression: g . f\nFailed, modules loaded: none.\n</code></pre>\n"}, {"tags": ["haskell", "replication", "list-comprehension"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1437830429, "post_id": 31626851, "comment_id": 51201220, "body": "No, as it says in the error, it has to do with <code>replicate x x</code> where Haskell expects a boolean."}, {"owner": {"reputation": 606, "user_id": 3497258, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/35f880339f03352b8e66231498e25779?s=128&d=identicon&r=PG&f=1", "display_name": "eXistanCe", "link": "https://stackoverflow.com/users/3497258/existance"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1437830656, "post_id": 31626851, "comment_id": 51201278, "body": "And why does Haskell expect a boolean? Should i try adding == True in the <code>elem</code> verification?"}, {"owner": {"reputation": 606, "user_id": 3497258, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/35f880339f03352b8e66231498e25779?s=128&d=identicon&r=PG&f=1", "display_name": "eXistanCe", "link": "https://stackoverflow.com/users/3497258/existance"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1437830886, "post_id": 31626851, "comment_id": 51201334, "body": "Because that is the only place were the result is a Bool (i think), and thus maybe since I didn&#39;t have the == comparison, when it got to the replicate predicate it would give that error?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1437830935, "post_id": 31626851, "comment_id": 51201343, "body": "replicate doesn&#39;t return Bool. It&#39;s not a predicate."}], "answers": [{"comments": [{"owner": {"reputation": 606, "user_id": 3497258, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/35f880339f03352b8e66231498e25779?s=128&d=identicon&r=PG&f=1", "display_name": "eXistanCe", "link": "https://stackoverflow.com/users/3497258/existance"}, "edited": false, "score": 0, "creation_date": 1437831030, "post_id": 31626954, "comment_id": 51201367, "body": "Oh, so if I change the x at the start of the comprehension to the replicate, and remove the replicate from the right hand forms, it should solve the problem?"}, {"owner": {"reputation": 606, "user_id": 3497258, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/35f880339f03352b8e66231498e25779?s=128&d=identicon&r=PG&f=1", "display_name": "eXistanCe", "link": "https://stackoverflow.com/users/3497258/existance"}, "edited": false, "score": 0, "creation_date": 1437831462, "post_id": 31626954, "comment_id": 51201465, "body": "Is it possible to &quot;flatten&quot; the result list in the notQuiteReproduce function? Because i think this is supposed to be done in a single function."}, {"owner": {"reputation": 606, "user_id": 3497258, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/35f880339f03352b8e66231498e25779?s=128&d=identicon&r=PG&f=1", "display_name": "eXistanCe", "link": "https://stackoverflow.com/users/3497258/existance"}, "edited": false, "score": 0, "creation_date": 1437835298, "post_id": 31626954, "comment_id": 51202548, "body": "Ok, i will figure it out than, thank you very much for the assistance."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 6, "last_activity_date": 1437831106, "last_edit_date": 1437831106, "creation_date": 1437830878, "answer_id": 31626954, "question_id": 31626851, "link": "https://stackoverflow.com/questions/31626851/haskell-concat-replicate-inside-list-comprehension/31626954#31626954", "title": "Haskell concat replicate inside list comprehension", "body": "<p>A list comprehension consists of a result expression <code>L</code> and one or more comma-separated right-hand forms <code>R1</code>, <code>R2</code>, ... arranged like this:</p>\n\n<pre><code>[ L | R1, R2, ... ]\n</code></pre>\n\n<p>Every right-hand side form must be either (1) a generator:</p>\n\n<pre><code>pattern &lt;- expression\n</code></pre>\n\n<p>or (2) a <code>let</code> binding:</p>\n\n<pre><code>let pattern = expression\n</code></pre>\n\n<p>or (3) a filter condition (an expression returning a <code>Bool</code>):</p>\n\n<pre><code>expression\n</code></pre>\n\n<p>In your code we have three such forms. <code>x &lt;- [1,2..10 ]</code> is a generator (case 2), <code>x `elem` xs</code> is a filter condition (case 3), but <code>replicate x x</code> fits none of these. And that's what the error message is about: Haskell expects the expression to have type <code>Bool</code> but <code>replicate</code> returns a list.</p>\n\n<hr>\n\n<p>To actually solve the problem, you could start by doing this:</p>\n\n<pre><code>notQuiteReproduce xs = [ replicate x x | x &lt;- xs ]\n</code></pre>\n\n<p>Now <code>notQuiteReproduce [3, 5, 1]</code> yields <code>[[3,3,3],[5,5,5,5,5],[1]]</code>. All that's left is to \"flatten\" the result list. This can also be done with a list comprehension but I'm reluctant to just give the solution away.</p>\n"}], "owner": {"reputation": 606, "user_id": 3497258, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/35f880339f03352b8e66231498e25779?s=128&d=identicon&r=PG&f=1", "display_name": "eXistanCe", "link": "https://stackoverflow.com/users/3497258/existance"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 678, "favorite_count": 0, "accepted_answer_id": 31626954, "answer_count": 1, "score": 2, "last_activity_date": 1437831106, "creation_date": 1437830189, "question_id": 31626851, "link": "https://stackoverflow.com/questions/31626851/haskell-concat-replicate-inside-list-comprehension", "title": "Haskell concat replicate inside list comprehension", "body": "<p>I'm having trouble with the following exercise :</p>\n\n<p>Utilizing list comprehension, define a function with the following signature:</p>\n\n<pre><code>reproduce :: [Int] -&gt; [Int]\n</code></pre>\n\n<p>This function exchanges the every number in a list by x copies of itself.</p>\n\n<p>eg:</p>\n\n<pre><code>input: reproduce[3,5,1]\noutput: [3,3,3,5,5,5,5,5,1]\n</code></pre>\n\n<p>I have done the following:</p>\n\n<pre><code>reproduce :: [Int] -&gt; [Int]\nreproduce xs = [ x | x &lt;- [1,2..10 ] , x `elem` xs , replicate x x ]\n</code></pre>\n\n<p>My line of thought was making x belong to a small interval, x had to be an element of the original list so using <code>elem</code>x would only be added if it did belong to the original list, and replicating x , x times, to get the x copies of himself.</p>\n\n<p>When i try to load this function i get the following error message:</p>\n\n<pre><code>Couldn't match expected type `Bool' with actual type `[Int]'\nIn the return type of a call of `replicate'\nIn the expression: replicate x x\nIn a stmt of a list comprehension: replicate x x\n</code></pre>\n\n<p>I have no idea how to fix this error, I'm assuming it has something to do with the <code>elem</code> part but I don't know what.</p>\n\n<p>NOTE: This is a beginners exercise and thus should be solved in a simple manner.</p>\n"}, {"tags": ["haskell", "fold", "dependent-type", "idris"], "comments": [{"owner": {"reputation": 4376, "user_id": 1125109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cb825e085d5544406ae6f9887702e02?s=128&d=identicon&r=PG", "display_name": "Edwin Brady", "link": "https://stackoverflow.com/users/1125109/edwin-brady"}, "edited": false, "score": 2, "creation_date": 1437854542, "post_id": 31626740, "comment_id": 51208350, "body": "Current Idris master on github does a much better job of disambiguating names by type (and indeed a much better job of reporting errors when it fails). Your example works fine, without modification. There&#39;ll be a new release pretty soon."}], "answers": [{"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1437830627, "post_id": 31626897, "comment_id": 51201272, "body": "Bingo! Thanks very much. That error message doesn&#39;t make it clear at all :("}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 8, "last_activity_date": 1437830504, "creation_date": 1437830504, "answer_id": 31626897, "question_id": 31626740, "link": "https://stackoverflow.com/questions/31626740/why-wont-idris-accept-my-custom-fold/31626897#31626897", "title": "Why won&#39;t Idris accept my custom fold?", "body": "<p>Idris is mixing up your <code>foldr</code> with the already existing one. You can solve this by qualifying the recursive <code>foldr</code> occurrence, or renaming your <code>foldr</code>.</p>\n\n<pre><code>foldr : \n     {n : Nat} -&gt; {a, b : Nat -&gt; Type} \n  -&gt; ({m : Nat} -&gt; a m -&gt; b m -&gt; b (S m)) -&gt; b Z -&gt; IxVect n a -&gt; b n\nfoldr f z Nil = z\nfoldr f z (x :: xs) = f x (Main.foldr f z xs)\n</code></pre>\n"}], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 293, "favorite_count": 0, "accepted_answer_id": 31626897, "answer_count": 1, "score": 6, "last_activity_date": 1437830504, "creation_date": 1437829403, "question_id": 31626740, "link": "https://stackoverflow.com/questions/31626740/why-wont-idris-accept-my-custom-fold", "title": "Why won&#39;t Idris accept my custom fold?", "body": "<p>Here's a vector whose elements are indexed by the length of the vector.</p>\n\n<pre><code>data IxVect : (n : Nat) -&gt; (a : Nat -&gt; Type) -&gt; Type where\n    Nil : IxVect 0 a\n    (::) : a n -&gt; IxVect n a -&gt; IxVect (S n) a\n</code></pre>\n\n<p>I want to fold up an <code>IxVect</code>.</p>\n\n<pre><code>total\nfoldr : {b : Nat -&gt; Type} -&gt; ({m : Nat} -&gt; a m -&gt; b m -&gt; b (S m)) -&gt; b Z -&gt; IxVect n a -&gt; b n\nfoldr f z Nil = z\nfoldr f z (x :: xs) = f x (foldr f z xs)\n</code></pre>\n\n<p>I get the following error in the step case:</p>\n\n<pre><code>test.idr:9:25:\nWhen elaborating right hand side of Main.foldr:\nCan't convert\n        (Nat -&gt; Type) -&gt; Type\nwith\n        Type -&gt; Type\n</code></pre>\n\n<p>I'm confused about what the error is trying to tell me. My definition of <code>foldr</code> doesn't look wrong to me, and it works just fine in Haskell:</p>\n\n<pre><code>data Nat = Z | S Nat\n\ndata IxVect n a where\n    Nil :: IxVect Z a\n    Cons :: a n -&gt; IxVect n a -&gt; IxVect (S n) a\n\nfoldr :: (forall m. a m -&gt; b m -&gt; b (S m)) -&gt; b Z -&gt; IxVect n a -&gt; b n\nfoldr f z Nil = z\nfoldr f z (Cons x xs) = f x (foldr f z xs)\n</code></pre>\n\n<p>Why won't my <code>foldr</code> type check in Idris?</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1437839520, "post_id": 31624758, "comment_id": 51203919, "body": "Looks like the <code>download</code> package relies on system headers providing a <code>__BEGIN_DECLS</code> macro. I guess this has never been tested on windows."}, {"owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1437839776, "post_id": 31624758, "comment_id": 51204021, "body": "@melpomene can you advise what OS I should use for Haskell dev. Ubuntu ?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1437839832, "post_id": 31624758, "comment_id": 51204046, "body": "I would use some kind of Linux, yes. I don&#39;t know which distribution is best for Haskell, though."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1437846121, "post_id": 31624758, "comment_id": 51205968, "body": "Using Linux is probably a bit smoother, but a large majority of things work just fine on Windows (I guess you were just unlucky with this <code>download</code> package). If you can&#39;t get <code>download</code> to work, <a href=\"https://hackage.haskell.org/package/http-conduit-downloader\" rel=\"nofollow noreferrer\">http-conduit-downloader</a> looks helpful. As for Linux distros, typically it doesn&#39;t matter much as you will get packages via cabal or stack anyway. I like Arch because new GHCs reach it quickly."}], "answers": [{"comments": [{"owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "edited": false, "score": 0, "creation_date": 1437829842, "post_id": 31625354, "comment_id": 51201078, "body": "Breithner so line   build-depends:       base &gt;=4.7 &amp;&amp; &lt;4.8 should be   build-depends:       base &gt;=4.7 &amp;&amp; &lt;4.8 &amp;&amp; download ?"}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "reply_to_user": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "edited": false, "score": 0, "creation_date": 1437830533, "post_id": 31625354, "comment_id": 51201250, "body": "<code>base &gt;=4.7 &amp;&amp; &lt;4.8, download</code>"}, {"owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "edited": false, "score": 0, "creation_date": 1437838037, "post_id": 31625354, "comment_id": 51203432, "body": "please see question update, the download package is not installing ?"}], "tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": true, "score": 1, "last_activity_date": 1437818913, "creation_date": 1437818913, "answer_id": 31625354, "question_id": 31624758, "link": "https://stackoverflow.com/questions/31624758/first-time-attempting-to-use-dependency-with-cabal/31625354#31625354", "title": "First time attempting to use dependency with Cabal", "body": "<p>You usually do not touch <code>Setup.hs</code> at all.</p>\n\n<p>Instead, add <code>download</code> to the <code>build-depends</code> field in your <code>.cabal</code> files.</p>\n\n<p>Furthermore, the <code>.cabal</code> file is incomplete: Uncomment the <code>main-is</code> field and put in the filename of your main module, e.g.</p>\n\n<pre><code>main-is: SparkSetup.hs\n</code></pre>\n"}], "owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 0, "accepted_answer_id": 31625354, "answer_count": 1, "score": 0, "last_activity_date": 1437839243, "creation_date": 1437814522, "last_edit_date": 1437839243, "question_id": 31624758, "link": "https://stackoverflow.com/questions/31624758/first-time-attempting-to-use-dependency-with-cabal", "title": "First time attempting to use dependency with Cabal", "body": "<p>Run init command in local SparkSetup folder : </p>\n\n<pre><code>cabal init\n</code></pre>\n\n<p>This creates following files : </p>\n\n<p>SparkSetup.cabal : </p>\n\n<pre><code>-- Initial SparkSetup.cabal generated by cabal init.  For further \n-- documentation, see http://haskell.org/cabal/users-guide/\n\nname:                SparkSetup\nversion:             0.1.0.0\n-- synopsis:            \n-- description:         \n-- license:             \nlicense-file:        LICENSE\nauthor:              user\nmaintainer:          user\n-- copyright:           \n-- category:            \nbuild-type:          Simple\n-- extra-source-files:  \ncabal-version:       &gt;=1.10\n\nexecutable SparkSetup\n  -- main-is:             \n  -- other-modules:       \n  -- other-extensions:    \n  build-depends:       base &gt;=4.7 &amp;&amp; &lt;4.8\n  -- hs-source-dirs:      \n  default-language:    Haskell2010\n</code></pre>\n\n<p>Setup.hs : </p>\n\n<pre><code>import Distribution.Simple\nmain = defaultMain\n</code></pre>\n\n<p>I then modify my Setup.hs file to include Network.Download module from <a href=\"https://hackage.haskell.org/package/download\" rel=\"nofollow\">https://hackage.haskell.org/package/download</a></p>\n\n<p>Setup.hs : </p>\n\n<pre><code>import Network.Download\nimport Distribution.Simple\nmain = defaultMain\n</code></pre>\n\n<p>And then run commands : </p>\n\n<pre><code>cabal sandbox init\ncabal install -j\n</code></pre>\n\n<p>But receive error : </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Resolving dependencies...\nNotice: installing into a sandbox located at C:\\Users\\Users\\Google\nDrive\\SparkSetup\\.cabal-sandbox\nConfiguring SparkSetup-0.1.0.0...\nFailed to install SparkSetup-0.1.0.0\nLast 10 lines of the build log ( C:\\Users\\users\\Google Drive\\SparkSetup\\.cabal-\nsandbox\\logs\\SparkSetup-0.1.0.0.log ):\nConfiguring SparkSetup-0.1.0.0...\nsetup-Cabal-1.18.1.3-x86_64-windows-ghc-7.8.3.exe: No 'main-is' field found\nfor executable SparkSetup\ncabal: Error: some packages failed to install:\nSparkSetup-0.1.0.0 failed during the configure step. The exception was:\nExitFailure 1\n</code></pre>\n\n<p>How to include the download package (<a href=\"https://hackage.haskell.org/package/download\" rel=\"nofollow\">https://hackage.haskell.org/package/download</a>) in my project ?</p>\n\n<p>Update :</p>\n\n<p>SparkSetup.cabal : </p>\n\n<pre><code>-- Initial SparkSetup.cabal generated by cabal init.  For further \n-- documentation, see http://haskell.org/cabal/users-guide/\n\nname:                SparkSetup\nversion:             0.1.0.0\n-- synopsis:            \n-- description:         \n-- license:             \nlicense-file:        LICENSE\nauthor:              user\nmaintainer:          user\n-- copyright:           \n-- category:            \nbuild-type:          Simple\n-- extra-source-files:  \ncabal-version:       &gt;=1.10\n\nexecutable SparkSetup\n  main-is: SparkSetup.hs  \n  -- other-modules:       \n  -- other-extensions:    \n  build-depends:       base &gt;=4.7 &amp;&amp; &lt;4.8, download\n  -- hs-source-dirs:      \n  default-language:    Haskell2010\n</code></pre>\n\n<p>SparkSetup.hs : </p>\n\n<pre><code>main = putStrLn \"Hello, World!\"\n</code></pre>\n\n<p>Run <code>cabal install</code></p>\n\n<p>gives error : </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>setup-Cabal-1.18.1.3-x86_64-windows-ghc-7.8.3.exe: Bad header file: download.h\nThe header file contains a compile error. You can re-run configure with the\nverbosity flag -v3 to see the error messages from the C compiler.\ncabal: Error: some packages failed to install:\nSparkSetup-0.1.0.0 depends on download-0.3.2 which failed to install.\ndownload-0.3.2 failed during the configure step. The exception was:\nExitFailure 1\n</code></pre>\n\n<p>Update 2 : </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>C:\\Users\\Adrian\\Google Drive\\SparkSetup&gt;cabal install -v3\nUsing a sandbox located at C:\\Users\\Adrian\\Google\nDrive\\SparkSetup\\.cabal-sandbox\nSearching for ghc in path.\nFound ghc at C:\\Program Files\\Haskell Platform\\2014.2.0.0\\bin\\ghc.exe\n(\"C:\\\\Program Files\\\\Haskell Platform\\\\2014.2.0.0\\\\bin\\\\ghc.exe\",[\"--numeric-ver\nsion\"])\nC:\\Program Files\\Haskell Platform\\2014.2.0.0\\bin\\ghc.exe is version 7.8.3\nlooking for tool ghc-pkg near compiler in C:\\Program Files\\Haskell\nPlatform\\2014.2.0.0\\bin\nfound ghc-pkg in C:\\Program Files\\Haskell Platform\\2014.2.0.0\\bin\\ghc-pkg.exe\n(\"C:\\\\Program Files\\\\Haskell Platform\\\\2014.2.0.0\\\\bin\\\\ghc-pkg.exe\",[\"--version\n\"])\nC:\\Program Files\\Haskell Platform\\2014.2.0.0\\bin\\ghc-pkg.exe is version 7.8.3\n(\"C:\\\\Program Files\\\\Haskell Platform\\\\2014.2.0.0\\\\bin\\\\ghc.exe\",[\"--supported-l\nanguages\"])\n(\"C:\\\\Program Files\\\\Haskell Platform\\\\2014.2.0.0\\\\bin\\\\ghc.exe\",[\"--info\"])\nThe package database already exists: C:\\Users\\Adrian\\Google\nDrive\\SparkSetup\\.cabal-sandbox\\x86_64-windows-ghc-7.8.3-packages.conf.d\nReading available packages...\nReading available packages...\nReading installed packages...\n(\"C:\\\\Program Files\\\\Haskell Platform\\\\2014.2.0.0\\\\bin\\\\ghc-pkg.exe\",[\"dump\",\"--\npackage-db=C:\\\\Users\\\\Adrian\\\\Google Drive\\\\SparkSetup\\\\.cabal-sandbox\\\\x86_64-w\nindows-ghc-7.8.3-packages.conf.d\",\"-v0\"])\n(\"C:\\\\Program Files\\\\Haskell Platform\\\\2014.2.0.0\\\\bin\\\\ghc.exe\",[\"--print-libdi\nr\"])\nReading installed packages...\n(\"C:\\\\Program Files\\\\Haskell Platform\\\\2014.2.0.0\\\\bin\\\\ghc-pkg.exe\",[\"dump\",\"--\nglobal\",\"-v0\"])\n(\"C:\\\\Program Files\\\\Haskell Platform\\\\2014.2.0.0\\\\bin\\\\ghc-pkg.exe\",[\"dump\",\"--\npackage-db=C:\\\\Users\\\\Adrian\\\\Google Drive\\\\SparkSetup\\\\.cabal-sandbox\\\\x86_64-w\nindows-ghc-7.8.3-packages.conf.d\",\"-v0\"])\n(\"C:\\\\Program Files\\\\Haskell Platform\\\\2014.2.0.0\\\\bin\\\\ghc.exe\",[\"--print-libdi\nr\"])\nReading available packages...\nChoosing modular solver.\nResolving dependencies...\n[__0] trying: feed-0.3.9.7/installed-4ff... (user goal)\n[__1] trying: base-4.7.0.1/installed-7c4... (dependency of feed-0.3.9.7/installe\nd-4ff...)\n[__2] trying: rts-1.0/installedbuil... (dependency of base-4.7.0.1/installed-7c4\n...)\n[__3] trying: integer-gmp-0.5.1.0/installed-d42... (dependency of base-4.7.0.1/i\nnstalled-7c4...)\n[__4] trying: ghc-prim-0.3.1.0/installed-95d... (dependency of base-4.7.0.1/inst\nalled-7c4...)\n[__5] trying: time-1.4.2/installed-102... (dependency of feed-0.3.9.7/installed-\n4ff...)\n[__6] trying: deepseq-1.3.0.2/installed-7fa... (dependency of time-1.4.2/install\ned-102...)\n[__7] trying: array-0.5.0.0/installed-a62... (dependency of deepseq-1.3.0.2/inst\nalled-7fa...)\n[__8] trying: Win32-2.3.0.2/installed-698... (dependency of time-1.4.2/installed\n-102...)\n[__9] trying: bytestring-0.10.4.0/installed-016... (dependency of Win32-2.3.0.2/\ninstalled-698...)\n[_10] trying: old-time-1.1.0.2/installed-a22... (dependency of feed-0.3.9.7/inst\nalled-4ff...)\n[_11] trying: old-locale-1.0.0.6/installed-09b... (dependency of feed-0.3.9.7/in\nstalled-4ff...)\n[_12] trying: tagsoup-0.13.3/installed-d1b... (user goal)\n[_13] trying: text-1.1.0.0/installed-1ba... (dependency of tagsoup-0.13.3/instal\nled-d1b...)\n[_14] trying: containers-0.5.5.1/installed-080... (dependency of tagsoup-0.13.3/\ninstalled-d1b...)\n[_15] trying: time-locale-compat-0.1.1.0/installed-712... (user goal)\n[_16] trying: utf8-string-1/installed-8df... (user goal)\n[_17] trying: xml-1.3.14/installed-97a... (user goal)\n[_18] trying: SparkSetup-0.1.0.0 (user goal)\n[_19] next goal: download (dependency of SparkSetup-0.1.0.0)\n[_19] trying: download-0.3.2\n[_20] done\nNotice: installing into a sandbox located at C:\\Users\\Adrian\\Google\nDrive\\SparkSetup\\.cabal-sandbox\nReady to install download-0.3.2\nExtracting\nC:\\Users\\Adrian\\AppData\\Roaming\\cabal\\packages\\hackage.haskell.org\\download\\0.3.\n2\\download-0.3.2.tar.gz\nWaiting for install task to finish...\nto C:\\Users\\Adrian\\AppData\\Local\\Temp\\download-0.3.2-1540...\nUpdating download.cabal with the latest revision from the index.\nConfiguring download-0.3.2...\nUsing external setup method with build-type Simple\ncreating\nC:\\Users\\Adrian\\AppData\\Local\\Temp\\download-0.3.2-1540\\download-0.3.2\\dist\\dist-\nsandbox-8472864c\\setup\ncreating\nC:\\Users\\Adrian\\AppData\\Local\\Temp\\download-0.3.2-1540\\download-0.3.2\\dist\\dist-\nsandbox-8472864c\ncreating\nC:\\Users\\Adrian\\AppData\\Local\\Temp\\download-0.3.2-1540\\download-0.3.2\\dist\ncreating\nC:\\Users\\Adrian\\AppData\\Local\\Temp\\download-0.3.2-1540\\download-0.3.2\\dist\\dist-\nsandbox-8472864c\ncreating\nC:\\Users\\Adrian\\AppData\\Local\\Temp\\download-0.3.2-1540\\download-0.3.2\\dist\\dist-\nsandbox-8472864c\\setup\nReading installed packages...\n(\"C:\\\\Program Files\\\\Haskell Platform\\\\2014.2.0.0\\\\bin\\\\ghc-pkg.exe\",[\"dump\",\"--\nglobal\",\"-v0\"])\n(\"C:\\\\Program Files\\\\Haskell Platform\\\\2014.2.0.0\\\\bin\\\\ghc-pkg.exe\",[\"dump\",\"--\nuser\",\"-v0\"])\n(\"C:\\\\Program Files\\\\Haskell Platform\\\\2014.2.0.0\\\\bin\\\\ghc-pkg.exe\",[\"dump\",\"--\npackage-db=C:\\\\Users\\\\Adrian\\\\Google Drive\\\\SparkSetup\\\\.cabal-sandbox\\\\x86_64-w\nindows-ghc-7.8.3-packages.conf.d\",\"-v0\"])\n(\"C:\\\\Program Files\\\\Haskell Platform\\\\2014.2.0.0\\\\bin\\\\ghc.exe\",[\"--print-libdi\nr\"])\nUsing Cabal library version 1.18.1.3\nUsing\nC:\\Users\\Adrian\\AppData\\Local\\Temp\\download-0.3.2-1540\\download-0.3.2\\dist/dist-\nsandbox-8472864c\\setup\\setup.hs\nas setup script.\nFound cached setup executable:\nC:\\Users\\Adrian\\AppData\\Roaming\\cabal\\setup-exe-cache\\setup-Cabal-1.18.1.3-x86_6\n4-windows-ghc-7.8.3.exe\nC:\\Users\\Adrian\\AppData\\Roaming\\cabal\\setup-exe-cache\\setup-Cabal-1.18.1.3-x86_6\n4-windows-ghc-7.8.3.exe\nconfigure --verbose=3 --builddir=dist/dist-sandbox-8472864c --ghc\n--prefix=C:\\Users\\Adrian\\Google Drive\\SparkSetup\\.cabal-sandbox\n--bindir=C:\\Users\\Adrian\\Google Drive\\SparkSetup\\.cabal-sandbox\\bin\n--libdir=C:\\Users\\Adrian\\Google Drive\\SparkSetup\\.cabal-sandbox\n--libsubdir=x86_64-windows-ghc-7.8.3\\download-0.3.2\n--libexecdir=C:\\Users\\Adrian\\Google\nDrive\\SparkSetup\\.cabal-sandbox\\download-0.3.2\n--datadir=C:\\Users\\Adrian\\Google Drive\\SparkSetup\\.cabal-sandbox\n--datasubdir=x86_64-windows-ghc-7.8.3\\download-0.3.2\n--docdir=C:\\Users\\Adrian\\Google\nDrive\\SparkSetup\\.cabal-sandbox\\doc\\x86_64-windows-ghc-7.8.3\\download-0.3.2\n--htmldir=C:\\Users\\Adrian\\Google\nDrive\\SparkSetup\\.cabal-sandbox\\doc\\x86_64-windows-ghc-7.8.3\\download-0.3.2\\html\n\n--haddockdir=C:\\Users\\Adrian\\Google\nDrive\\SparkSetup\\.cabal-sandbox\\doc\\x86_64-windows-ghc-7.8.3\\download-0.3.2\\html\n\n--sysconfdir=C:\\Users\\Adrian\\Google Drive\\SparkSetup\\.cabal-sandbox\\etc\n--global --package-db=C:\\Users\\Adrian\\Google\nDrive\\SparkSetup\\.cabal-sandbox\\x86_64-windows-ghc-7.8.3-packages.conf.d\n--extra-prog-path=C:\\Users\\Adrian\\AppData\\Roaming\\cabal\\bin --constraint=xml\n==1.3.14 --constraint=tagsoup ==0.13.3 --constraint=feed ==0.3.9.7\n--constraint=bytestring ==0.10.4.0 --constraint=base ==4.7.0.1 --disable-tests\n--disable-benchmarks\nRedirecting build log to {handle: C:\\Users\\Adrian\\Google\nDrive\\SparkSetup\\.cabal-sandbox\\logs\\download-0.3.2.log}\nFailed to install download-0.3.2\nLast 10 lines of the build log ( C:\\Users\\Adrian\\Google Drive\\SparkSetup\\.cabal-\nsandbox\\logs\\download-0.3.2.log ):\nfunction)\ncbits/download.h:90:1: error: unknown type name '__BEGIN_DECLS'\ncbits/download.h:93:6: error: expected '=', ',', ';', 'asm' or '__attribute__'\nbefore '*' token\ncbits/download.h:124:1: error: expected '=', ',', ';', 'asm' or\n'__attribute__' before 'typedef'\ncbits/download.h:125:1: error: unknown type name 'auth_t'\nsetup-Cabal-1.18.1.3-x86_64-windows-ghc-7.8.3.exe: Bad header file: download.h\nThe header file contains a compile error. You can re-run configure with the\nverbosity flag -v3 to see the error messages from the C compiler.\ncabal: Error: some packages failed to install:\nSparkSetup-0.1.0.0 depends on download-0.3.2 which failed to install.\ndownload-0.3.2 failed during the configure step. The exception was:\nExitFailure 1\n</code></pre>\n"}, {"tags": ["haskell", "optimization", "functional-programming", "garbage-collection", "lambda-calculus"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1437811203, "post_id": 31622284, "comment_id": 51196598, "body": "Maybe you could add an example where you still have redundant nodes. Also, this may be more appropriate on CS or TCS instead of SO."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1437838848, "post_id": 31622284, "comment_id": 51203704, "body": "Perhaps TCS is more appropriate."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1437841571, "post_id": 31622284, "comment_id": 51204590, "body": "Okay. I&#39;ve posted a question there, in case you&#39;re interested... although I find it unlikely I&#39;ll get an answer any soon."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1437841747, "post_id": 31622284, "comment_id": 51204654, "body": "I am interested in this, but I&#39;m not expert enough on this topic to be able to answer."}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 102, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1437791566, "creation_date": 1437791566, "last_edit_date": 1495542700, "question_id": 31622284, "link": "https://stackoverflow.com/questions/31622284/is-it-possible-to-collect-all-redundant-fan-garbage-nodes-on-lampings-abstract", "title": "Is it possible to collect all redundant fan-garbage nodes on Lamping&#39;s abstract algorithm?", "body": "<p>Lamping's abstract algorithm is an efficient way to reduce a class of terms on the pure lambda calculus. I noticed, as asked on <a href=\"https://stackoverflow.com/questions/31599684/is-it-usual-for-interaction-nets-to-leave-piles-of-redundant-fans\">my previous question</a>, that just the abstract algorithm alone leaves piles of redundant nodes after the reduction, which is responsible for an exponential slowdown on the reduction of some terms. Marco Solieri answered by pointing that is common and suggested a technique to amend this problem by converting \"safe\" fan nodes into flat wires - i.e., garbage-collecting them.</p>\n\n<p>That solution is not perfect, though, as it still leaves many redundant nodes on the final graph. My question is: <strong>is it possible to collect all redundant fan-garbage nodes while executing Lamping's abstract algorithm</strong>?</p>\n"}, {"tags": ["haskell", "main"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1437779477, "post_id": 31619953, "comment_id": 51191275, "body": "Haskell isn&#39;t C, <code>main</code> doesn&#39;t return an <code>Int</code>, it <i>must</i> return an <code>IO t</code>."}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1438048599, "post_id": 31619953, "comment_id": 51276545, "body": "<code>foldr</code> <i>can</i> return an <code>IO t</code>, but only if the type of the first argument is <code>a -&gt; IO t -&gt; IO t</code>"}], "answers": [{"comments": [{"owner": {"reputation": 3161, "user_id": 812272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/81e24cd679d414d554df2bde26658fd4?s=128&d=identicon&r=PG", "display_name": "user3001", "link": "https://stackoverflow.com/users/812272/user3001"}, "edited": false, "score": 0, "creation_date": 1437774862, "post_id": 31620056, "comment_id": 51189901, "body": "I tried to provide more detailed explanation in my answer on why <code>IO</code> is inferred here as type. Maybe this also helps."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1437787589, "post_id": 31620056, "comment_id": 51192688, "body": "The type of <code>main</code> needs to unify with <code>IO a</code>; it need not actually be <code>IO ()</code>."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1437803524, "post_id": 31620056, "comment_id": 51195161, "body": "@DanielWagner Thank you! I&#39;ve been trying to wrap my head around code I thought shouldn&#39;t work but did - it all suddenly makes sense."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1437870198, "post_id": 31620056, "comment_id": 51211892, "body": "@Alec, I recommend giving <code>main</code> the type <code>IO ()</code> if it is intended to run and then terminate normally, to make it clear that it produces an uninteresting value. If it is only supposed to stop from an uncaught exception, I&#39;d give it the polymorphic type <code>IO a</code> to make it clear that it does not produce a value."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 5, "last_activity_date": 1437773184, "creation_date": 1437773184, "answer_id": 31620056, "question_id": 31619953, "link": "https://stackoverflow.com/questions/31619953/main-not-compiling-due-to-foldr/31620056#31620056", "title": "Main not compiling due to foldr", "body": "<p><code>main</code> has type <code>IO ()</code> while <code>foldr (+) (0) [1,2,3]</code> has type <code>Num a =&gt; a</code>. GHC tries to combine these but fails, since <code>Num</code> is not defined on <code>IO a</code>. Presumably, you want to print the result. Try this</p>\n\n<pre><code>main = print $ foldr (+) (0) [1,2,3]\n</code></pre>\n\n<p>Then, once you load into GHCi, you can call <code>main</code> to get <code>6</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1437787605, "post_id": 31620078, "comment_id": 51192695, "body": "The type of <code>main</code> needs to unify with <code>IO a</code>; it need not actually be <code>IO ()</code>."}, {"owner": {"reputation": 461, "user_id": 1523768, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bd9e3c0ab4e076c918db41ef6ef7f49d?s=128&d=identicon&r=PG", "display_name": "Wei Li", "link": "https://stackoverflow.com/users/1523768/wei-li"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1437850531, "post_id": 31620078, "comment_id": 51207293, "body": "@DanielWagner Yes, you are right. Thanks for your clarification."}], "tags": [], "owner": {"reputation": 461, "user_id": 1523768, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bd9e3c0ab4e076c918db41ef6ef7f49d?s=128&d=identicon&r=PG", "display_name": "Wei Li", "link": "https://stackoverflow.com/users/1523768/wei-li"}, "is_accepted": false, "score": 3, "last_activity_date": 1437850527, "last_edit_date": 1437850527, "creation_date": 1437773282, "answer_id": 31620078, "question_id": 31619953, "link": "https://stackoverflow.com/questions/31619953/main-not-compiling-due-to-foldr/31620078#31620078", "title": "Main not compiling due to foldr", "body": "<p>The type of main should unify with type <code>IO a</code>. But type of <code>foldr (+) (0) [1,2,3]</code> is <code>Num a =&gt; a</code>. </p>\n\n<p>You could modify your program like this:</p>\n\n<pre><code>-- Note print return a value of type IO ()\nmain :: IO ()\nmain = print $ foldr (+) 0 [1,2,3] \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3161, "user_id": 812272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/81e24cd679d414d554df2bde26658fd4?s=128&d=identicon&r=PG", "display_name": "user3001", "link": "https://stackoverflow.com/users/812272/user3001"}, "is_accepted": false, "score": 0, "last_activity_date": 1437774756, "creation_date": 1437774756, "answer_id": 31620359, "question_id": 31619953, "link": "https://stackoverflow.com/questions/31619953/main-not-compiling-due-to-foldr/31620359#31620359", "title": "Main not compiling due to foldr", "body": "<p>I could reproduce and solve the problem. I found <a href=\"http://www.quora.com/Why-cant-functions-be-defined-on-the-GHCi-repl\" rel=\"nofollow\">http://www.quora.com/Why-cant-functions-be-defined-on-the-GHCi-repl</a> which gave me the hint:\nIt seems like the REPL is \"a do block in the IO monad.\" as stated in the other answers. \nThe do notation can be used to express a series of monadic expressions executed one after another. As <a href=\"https://en.wikibooks.org/wiki/Haskell/do_notation\" rel=\"nofollow\">it can be seen at Wikibooks</a>, it can be translated into a chain of monad <code>bind</code> operations.</p>\n\n<p>Hence you have two options:</p>\n\n<p>One is to let main have the signature <code>main :: IO ()</code>, so that </p>\n\n<pre><code>main :: IO ()\nmain = print $ foldr (+) (0) [1,2,3]\n\nevaluateTwice :: IO()\nevaluateTwice = do \n              main\n              main\n-- equvalent alternative as monadic bind operations, see Wikibooks\nevaluateTwice = main &gt;&gt;= \\ x1 -&gt; main\n</code></pre>\n\n<p>would chain two calls to <code>main</code> of the <code>IO</code> monad(using bind), returning a new instance of the <code>IO</code> monad. This is what the other posters basically suggested.</p>\n\n<p>Alternatively you can use <code>let</code> </p>\n\n<pre><code>let main = foldr (+) (0) [1,2,3]\n</code></pre>\n\n<p>which defines a \"variable\".</p>\n"}], "owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 31620056, "answer_count": 3, "score": 1, "last_activity_date": 1437850527, "creation_date": 1437772772, "last_edit_date": 1437779558, "question_id": 31619953, "link": "https://stackoverflow.com/questions/31619953/main-not-compiling-due-to-foldr", "title": "Main not compiling due to foldr", "body": "<p>I've added this code to f.hs file : </p>\n\n<pre><code>main = foldr (+) (0) [1,2,3]\n</code></pre>\n\n<p>when I use : </p>\n\n<pre><code>:l f.hs\n</code></pre>\n\n<p>I receive error : </p>\n\n<pre><code>[1 of 1] Compiling Main             ( f.hs, interpreted )\n\nf.hs:1:14:\n    No instance for (Num (IO t0)) arising from a use of \u2018+\u2019\n    In the first argument of \u2018foldr\u2019, namely \u2018(+)\u2019\n    In the expression: foldr (+) (0) [1, 2, 3]\n    In an equation for \u2018main\u2019: main = foldr (+) (0) [1, 2, 3]\nFailed, modules loaded: none.\n</code></pre>\n\n<p>I want to use trace and see output of fold.</p>\n\n<p>Why is this code not compiling ?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 4, "creation_date": 1437773126, "post_id": 31619769, "comment_id": 51189356, "body": "I suspect that this technique is unsafe, given that you have used <code>unsafePerformIO</code> <i>twice</i>. Generally every invocation of <code>unsafePerformIO</code> need to be strongly justified, preferably with a mathematical proof. I would hazard to guess from reading the type-class functions of <code>IsString</code> that <code>CString</code> is <b>not</b> an instance of <code>IsString</code> because <code>IsString</code> assumes the defined functions to be pure."}], "answers": [{"tags": [], "owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "is_accepted": false, "score": 8, "last_activity_date": 1437774614, "creation_date": 1437774614, "answer_id": 31620334, "question_id": 31619769, "link": "https://stackoverflow.com/questions/31619769/can-cstring-be-an-instance-of-isstring-show/31620334#31620334", "title": "Can CString be an instance of IsString, Show?", "body": "<p>No.  Your <code>show</code> function, for example, will return different results for the same <code>CString</code> value at different times.  This is because a <code>CString</code> is really a <em>mutable</em> string under the hood, equivalent to <code>IORef String</code>.  Because when an expression is evaluated and how many times an expression is evaluated are not specified by the Haskell language, an expression <code>show cs</code> using your instance will have a non-deterministic value, so <em>most</em> Haskell programmers would say this is not a valid use of <code>unsafePerformIO</code>, and it is (intentionally) not possible to implement <code>Show CString</code> without using <code>unsafePerformIO</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 3462, "user_id": 914859, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/52bf147a3e31747586f594049359d3d1?s=128&d=identicon&r=PG", "display_name": "Michael Fox", "link": "https://stackoverflow.com/users/914859/michael-fox"}, "edited": false, "score": 0, "creation_date": 1437775843, "post_id": 31620383, "comment_id": 51190147, "body": "Thanks. I am using it for FFI. The C layer uses <code>const char *</code> so shouldn&#39;t modify the strings. I want to find a way that doesn&#39;t leak to expose a haskell API which is straightforward and doesn&#39;t require users to litter their code with <code>withCString</code>, <code>free</code> or other memory management worries."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 3462, "user_id": 914859, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/52bf147a3e31747586f594049359d3d1?s=128&d=identicon&r=PG", "display_name": "Michael Fox", "link": "https://stackoverflow.com/users/914859/michael-fox"}, "edited": false, "score": 1, "creation_date": 1437788362, "post_id": 31620383, "comment_id": 51192786, "body": "@MichaelFox, presumably you are already in the IO monad to call the C function via FFI, so you can just use <code>withCString</code>/<code>peekCString</code>/etc. in your Haskell API?"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 6, "last_activity_date": 1437774845, "creation_date": 1437774845, "answer_id": 31620383, "question_id": 31619769, "link": "https://stackoverflow.com/questions/31619769/can-cstring-be-an-instance-of-isstring-show/31620383#31620383", "title": "Can CString be an instance of IsString, Show?", "body": "<p>This may be technically safe since you never ever change the memory pointed to by the <code>CString</code> value. Hence, the values are indeed immutable, and the effect of <code>unsafePerformIO</code> just mimicks a pure value.</p>\n\n<p><em>However</em>, the above holds only because <em>you never release memory</em>, and simply leak it every time you allocate a new string with <code>newCString</code>. </p>\n\n<p>As soon as you fix the memory leak using <code>free</code>, then you lose safety: <code>unsafePerformIO</code> will read whatever is found at the old memory address. If you are lucky, this will crash the program. If you are unlucky, this will read garbage data into your strings. Good luck in debugging that.</p>\n\n<p>I would strongly recommend against that approach.</p>\n\n<p>TL;DR: </p>\n\n<ol>\n<li><code>unsafePerformIO</code> is unsafe, don't use it unless you know what you are doing. </li>\n<li>C-like pointers such as <code>CString</code> should be used as little as possible, and only to interface with foreign languages.</li>\n</ol>\n"}], "owner": {"reputation": 3462, "user_id": 914859, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/52bf147a3e31747586f594049359d3d1?s=128&d=identicon&r=PG", "display_name": "Michael Fox", "link": "https://stackoverflow.com/users/914859/michael-fox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 0, "answer_count": 2, "score": 6, "last_activity_date": 1437774845, "creation_date": 1437771902, "last_edit_date": 1437772425, "question_id": 31619769, "link": "https://stackoverflow.com/questions/31619769/can-cstring-be-an-instance-of-isstring-show", "title": "Can CString be an instance of IsString, Show?", "body": "<p>There's</p>\n\n<pre><code>newCString :: String -&gt; IO CString\npeekCString :: CString -&gt; IO String\n</code></pre>\n\n<p>And you need</p>\n\n<pre><code>fromString :: String -&gt; a\nshow :: a -&gt; String\n</code></pre>\n\n<p>My lame attempt</p>\n\n<pre><code>{-# LANGUAGE TypeSynonymInstances #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE OverlappingInstances #-}\n\nmodule Main where\n\nimport Data.String\nimport Foreign.C.String\nimport System.IO.Unsafe\n\ninstance IsString CString where\n  fromString = unsafePerformIO . newCString\n\ninstance {-# OVERLAPS #-} Show CString where\n  show = unsafePerformIO . peekCString\n\nmycs :: CString\nmycs = \"hello CString\"\n\nmain = putStrLn $ show mycs\n</code></pre>\n\n<p>It seems to work. But, having never uttered <code>unsafePerformIO</code> before I wonder what kind of disaster I'm setting up here? Did I leak memory? Is there a safe approach to this convenience?</p>\n"}, {"tags": ["haskell", "functor", "category-theory", "arrows", "category-abstractions"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1437768781, "post_id": 31618370, "comment_id": 51187406, "body": "At the very least, the <code>Arrow</code> laws are enough to <i>define</i> a law-abiding <code>Functor</code> instance by <code>instance Arrow a =&gt; Functor (a s) where fmap f v = v &gt;&gt;&gt; arr f</code>. Perhaps that together with parametricity is enough to ensure that this is also the <i>only</i> law-abiding instance, though I haven&#39;t worked out the details so I won&#39;t claim it to be true."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1437769881, "post_id": 31618370, "comment_id": 51187914, "body": "Remember that, for functions and arrows, <code>fmap</code> should equal <code>(&lt;&lt;&lt;)</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1437770430, "post_id": 31618370, "comment_id": 51188169, "body": "<a href=\"http://stackoverflow.com/questions/28395214/automatic-functor-instance#comment45136634_28395214\">This comment</a> suggests that I was correct: parametricity guarantees at most one law-abiding <code>Functor</code> instance. So the answer to your question seems to be &quot;yes&quot;."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1437775984, "post_id": 31618370, "comment_id": 51190184, "body": "Since <code>arr</code> is a method of <code>Arrow</code>, not <code>Category</code>, I am still somewhat skeptical - I doubt every <code>Category</code> that also is a <code>Functor</code> needs to be an <code>Arrow</code>. The reverse is true, however, as every <code>Arrow</code> <a href=\"https://cdsmith.wordpress.com/2011/07/30/arrow-category-applicative-part-i/\" rel=\"nofollow noreferrer\">gives not just a <code>Functor</code>, but an <code>Applicative</code></a>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1437796657, "post_id": 31618370, "comment_id": 51194004, "body": "@&#216;rjanJohansen &quot;I doubt every <code>Category</code> that also is a <code>Functor</code> needs to be an <code>Arrow</code>&quot; - indeed, though the underlying issue is that <code>arr</code> and <code>first</code> are, as leftaroundabout says below, &quot;quite separate things combined&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1437827292, "post_id": 31622147, "comment_id": 51200442, "body": "@duplode: actually not. I posted the wrong link (<code>Function</code> does the opposite thing, it&#39;s the class of specialised, rather than generalised functions). This is how it would be correct: \u201cIn terms of <code>constrained-categories</code>, every <code>Category C</code> which is also a <code>Functor C (-&gt;) (-&gt;)</code> is an <code>EnhancedCat C (-&gt;)</code> as well\u201d."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1437826625, "last_edit_date": 1437826625, "creation_date": 1437790117, "answer_id": 31622147, "question_id": 31618370, "link": "https://stackoverflow.com/questions/31618370/is-f-fmap-f-id-always-equivalent-to-arr/31622147#31622147", "title": "Is (\\f -&gt; fmap f id) always equivalent to arr?", "body": "\n\n<p>First let's be clear what <code>Arrow C</code> means. Well, it's two quite separate things combined &ndash; in my book,</p>\n\n<ul>\n<li>The class of <a href=\"http://hackage.haskell.org/package/constrained-categories-0.2.0.0/docs/Control-Arrow-Constrained.html#t:WellPointed\">well-pointed monoidal categories</a>.</li>\n<li>The class of <a href=\"http://hackage.haskell.org/package/constrained-categories-0.2.0.0/docs/Control-Arrow-Constrained.html#t:EnhancedCat\">categories which generalise <strong>Hask</strong></a>.</li>\n</ul>\n\n<p><code>arr</code> comes from the latter. &ldquo;Generalise&rdquo; <strong>Hask</strong>? What this means is just to have a mapping from the category <strong>Hask</strong> to <code>C</code>. &ndash; And mathematically, mapping from one category to another is exactly what a <a href=\"https://en.wikipedia.org/wiki/Functor\">functor</a> does! (The standard <code>Functor</code> class actually covers only a very specific sort of functors, namely endofunctors on <strong>Hask</strong>.) <code>arr</code> is the morphism-aspect of a non-endofunctor, namely the &ldquo;canonical embedding functor&rdquo; <strong>Hask</strong> &rarr; <code>C</code>.</p>\n\n<p>From this point of view, the first two arrow laws</p>\n\n<pre><code>arr id = id\narr (f &gt;&gt;&gt; g) = arr f &gt;&gt;&gt; arr g\n</code></pre>\n\n<p>are just the functor laws.</p>\n\n<p>Now, what does it mean if you're implementing a <code>Functor</code> instance for a category? Why, I daresay it simply means you're expressing that same canonical embedding functor, but via the necessary representation of <code>C</code> back in <strong>Hask</strong> (which makes it an endofunctor overall). Hence I'd argue that yes, <code>\\f -&gt; fmap f id</code> should be equivalent to <code>arr</code>, since basically they're two ways of expressing the same thing.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 3, "last_activity_date": 1437860770, "last_edit_date": 1437860770, "creation_date": 1437810067, "answer_id": 31624181, "question_id": 31618370, "link": "https://stackoverflow.com/questions/31618370/is-f-fmap-f-id-always-equivalent-to-arr/31624181#31624181", "title": "Is (\\f -&gt; fmap f id) always equivalent to arr?", "body": "<p>Here is a derivation to supplement leftaroundabout's explanation. For clarity, I will reserve <code>(.)</code> and <code>id</code> for <code>(-&gt;)</code>, and use <code>(&lt;&lt;&lt;)</code> and <code>id'</code> for the general <code>Category</code> methods.</p>\n\n<p>We begin with <code>preComp</code>, also known as <code>(&gt;&gt;&gt;)</code>:</p>\n\n<pre><code>preComp :: Category y =&gt; y a b -&gt; (y b c -&gt; y a c)\npreComp v = \\u -&gt; u &lt;&lt;&lt; v\n</code></pre>\n\n<p><code>fmap</code> commutes with natural transformations between <strong>Hask</strong> endofunctors. For a <code>Category</code> which also has a <code>Functor</code> instance, <code>preComp v</code> is a natural transformation (from <code>y b</code> to <code>y a</code>), and so it commutes with <code>fmap</code>. It follows that:</p>\n\n<pre><code>fmap f . preComp v = preComp v . fmap f\nfmap f (u &lt;&lt;&lt; v) = fmap f u &lt;&lt;&lt; v\nfmap f (id' &lt;&lt;&lt; v) = fmap f id' &lt;&lt;&lt; v\nfmap f v = fmap f id' &lt;&lt;&lt; v\n</code></pre>\n\n<p>That's our candidate <code>arr</code>! So let's define <code>arr' f = fmap f id'</code>. We can now verify that <code>arr'</code> follows the first arrow law...</p>\n\n<pre><code>-- arr id = id'\narr' id\nfmap id id'\nid'\n</code></pre>\n\n<p>... and the second one too:</p>\n\n<pre><code>-- arr (g . f) = arr g &lt;&lt;&lt; arr f\narr' (g . f)\nfmap (g . f) id'\n(fmap g . fmap f) id'\nfmap g (fmap f id')\nfmap g (arr' f)\nfmap g id' &lt;&lt;&lt; arr' f -- Using the earlier result.\narr' g &lt;&lt;&lt; arr' f\n</code></pre>\n\n<p>I suppose that is as far as we can get. The other five arrow laws involve <code>first</code>, and as leftaroundabout points out <code>arr</code> and <code>first</code> are independent.</p>\n"}], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 3, "accepted_answer_id": 31622147, "answer_count": 2, "score": 9, "last_activity_date": 1559485538, "creation_date": 1437766171, "last_edit_date": 1559485538, "question_id": 31618370, "link": "https://stackoverflow.com/questions/31618370/is-f-fmap-f-id-always-equivalent-to-arr", "title": "Is (\\f -&gt; fmap f id) always equivalent to arr?", "body": "<p>Some instances of <code>Category</code> are also instances of <code>Functor</code>. For example:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE ExistentialQuantification, TupleSections #-}\n\nimport Prelude hiding (id, (.))\nimport Control.Category\nimport Control.Arrow\n\ndata State a b = forall s. State (s -&gt; a -&gt; (s, b)) s\n\napply :: State a b -&gt; a -&gt; b\napply (State f s) = snd . f s\n\nassoc :: (a, (b, c)) -&gt; ((a, b), c)\nassoc (a, (b, c)) = ((a, b), c)\n\ninstance Category State where\n    id = State (,) ()\n    State g t . State f s = State (\\(s, t) -&gt; assoc . fmap (g t) . f s) (s, t)\n\n(.:) :: (Functor f, Functor g) =&gt; (a -&gt; b) -&gt; f (g a) -&gt; f (g b)\n(.:) = fmap . fmap\n\ninstance Functor (State a) where\n    fmap g (State f s) = State (fmap g .: f) s\n\ninstance Arrow State where\n    arr f = fmap f id\n    first (State f s) = State (\\s (x, y) -&gt; fmap (,y) (f s x)) s\n</code></pre>\n\n<p>Here <code>arr f = fmap f id</code> for <code>instance Arrow State</code>. Is this true for all instances of <code>Category</code> which are also instances of <code>Functor</code>? The type signatures are:</p>\n\n<pre><code>arr               ::                 Arrow    a  =&gt; (b -&gt; c) -&gt; a b c\n(\\f -&gt; fmap f id) :: (Functor (a t), Category a) =&gt; (b -&gt; c) -&gt; a b c\n</code></pre>\n\n<p>It seems to me that they should be equivalent.</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 0, "creation_date": 1437763895, "post_id": 31617608, "comment_id": 51184908, "body": "If you are planning to use the information in a cabal config file for your own project, I would advise omitting the dependency ranges entirely. Cabal will automatically apply the widest possible dependency limits based on the necessary packages."}, {"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "reply_to_user": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 0, "creation_date": 1437764255, "post_id": 31617608, "comment_id": 51185098, "body": "@Kwarrtz Are you reffering to the <code>cabal.sandbox.config</code> file? Because I mean the <code>&lt;package-name&gt;.cabal</code> file."}, {"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 0, "creation_date": 1437764322, "post_id": 31617608, "comment_id": 51185132, "body": "No, I am referring to the <code>.cabal</code> file."}, {"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "reply_to_user": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 0, "creation_date": 1437765201, "post_id": 31617608, "comment_id": 51185598, "body": "You mean to ommit the ranges like in <a href=\"https://hackage.haskell.org/package/dump-0.2.8/dump.cabal\" rel=\"nofollow noreferrer\">this .cabal file</a>&#39;s <code>build-depends</code> fields? Couldn&#39;t that result in failing build if for example an older version of a dependency is selected which has a different API?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 2, "creation_date": 1437769081, "post_id": 31617608, "comment_id": 51187546, "body": "@Kwarrtz That is extremely short-sighted advice. If publish a package like that to Hackage, you are announcing that your package can be built with all versions of all its dependencies. This is almost certainly untrue; and when you discover it later, you won&#39;t be able to fix it: you can release a new version with more restricted versions, but the version with the unrestricted bounds will be a &quot;poison pill&quot; that the dependency solver will always be willing to choose."}, {"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1437770586, "post_id": 31617608, "comment_id": 51188253, "body": "@DanielWagner So in your view it is better to start out with overly restrictive versions that are sure to work (compile and pass tests), and then broaden these restrictions in later releases if need be?"}, {"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1437770630, "post_id": 31617608, "comment_id": 51188270, "body": "@DanielWagner Also, couldn&#39;t outdated, too broad versions be deprecated later and hence removing the poison-pill effect?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1437778565, "post_id": 31617608, "comment_id": 51190988, "body": "@DanielWagner Hackage now supports adjusting dependency versions after the fact. In fact Hackage trustees have been going around fixing problems this way."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1437778710, "post_id": 31617608, "comment_id": 51191033, "body": "@Wizek Last I heard the actual deprecation system wasn&#39;t really working (cabal doesn&#39;t give it the final say), and for really broken packages the most reliable fix is to adjust version bounds to something impossible. (I think <code>base &lt; 0</code> has become a sort of standard for this.)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1437780180, "post_id": 31617608, "comment_id": 51191457, "body": "@Wizek Yes, I think making them restrictive and relaxing them as you discover you can is a sane alternative."}], "answers": [{"comments": [{"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "edited": false, "score": 0, "creation_date": 1437798890, "post_id": 31621152, "comment_id": 51194337, "body": "Thanks, I will try this out!"}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": false, "score": 3, "last_activity_date": 1437780129, "last_edit_date": 1437780129, "creation_date": 1437779775, "answer_id": 31621152, "question_id": 31617608, "link": "https://stackoverflow.com/questions/31617608/is-there-a-way-to-find-all-the-correct-dependency-version-ranges-for-a-cabal-fi/31621152#31621152", "title": "Is there a way to find all the correct dependency-version-ranges for a .cabal file?", "body": "<p>Although I haven't used it myself, there is a tool <a href=\"https://github.com/gelisam/cabal-rangefinder\" rel=\"nofollow\"><code>cabal-rangefinder</code></a> designed to help with this.  Note that:</p>\n\n<ul>\n<li>It essentially does this by recompiling several times to test what versions work.</li>\n<li>It's not foolproof, as it makes some \"reasonable\" assumptions that aren't always true. (And without those, it would have to do a <em>lot</em> more recompiling to test <em>every</em> version.)</li>\n<li>It's probably still experimental (the author hasn't released to Hackage yet.)</li>\n<li>It doesn't yet run package tests, but there's <a href=\"https://github.com/gelisam/cabal-rangefinder/issues/7\" rel=\"nofollow\">an issue</a> to add an option for this.</li>\n</ul>\n"}], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 190, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1437780129, "creation_date": 1437763345, "last_edit_date": 1437764168, "question_id": 31617608, "link": "https://stackoverflow.com/questions/31617608/is-there-a-way-to-find-all-the-correct-dependency-version-ranges-for-a-cabal-fi", "title": "Is there a way to find all the correct dependency-version-ranges for a .cabal file?", "body": "<p>I would like to give just the right dependency ranges for <a href=\"https://hackage.haskell.org/package/dump-0.2.8\" rel=\"nofollow\">a library published on hackage</a>.</p>\n\n<p>I would like to avoid being</p>\n\n<ul>\n<li>either too restrictive -- barring possible candidates, and possibly making the library uninstallable in certain sandboxes without manual edit to the cabal file,</li>\n<li>or too broad, resulting in build failures -- or even worse, passing build with faulty behaviour.</li>\n</ul>\n\n<p>So, is there a way (e.g. with a script) to automatically find the correct dependency-version-ranges for a cabal package with which build succeeds and all tests pass?</p>\n"}, {"tags": ["list", "haskell", "list-comprehension"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1437758932, "post_id": 31615500, "comment_id": 51182322, "body": "Probably <code>x,b..y</code> -&gt; <code>x,x+b..y</code>"}, {"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1437759115, "post_id": 31615500, "comment_id": 51182433, "body": "@chi: this makes sense, though I just fixed the syntax, not the semantics."}], "tags": [], "owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "is_accepted": false, "score": 3, "last_activity_date": 1437755379, "creation_date": 1437755379, "answer_id": 31615500, "question_id": 31615373, "link": "https://stackoverflow.com/questions/31615373/haskell-assigning-value-to-a-variable-inside-a-comprehension/31615500#31615500", "title": "Haskell assigning value to a variable inside a comprehension", "body": "<p>What variables? Everything is immutable :)</p>\n\n<p>What you want is a <code>let</code> expression:</p>\n\n<pre><code>partition x y n = [let b = (y-x)/n in a+b | a &lt;- [x,b..y]]\n</code></pre>\n\n<p>Also note the direction of the arrow: it comes from the list expression to <code>a</code>, not the other way around.</p>\n\n<p>It looks more natural to move the common sub-expression away from the comprehension:</p>\n\n<pre><code>partition x y n = let b = (y-x)/n in [a+b | a &lt;- [x,b..y]]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1437760149, "post_id": 31615857, "comment_id": 51183004, "body": "The results differ. <a href=\"http://stackoverflow.com/questions/7290438/haskell-ranges-and-floats\">Related</a>."}, {"owner": {"reputation": 606, "user_id": 3497258, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/35f880339f03352b8e66231498e25779?s=128&d=identicon&r=PG&f=1", "display_name": "eXistanCe", "link": "https://stackoverflow.com/users/3497258/existance"}, "edited": false, "score": 0, "creation_date": 1437769243, "post_id": 31615857, "comment_id": 51187604, "body": "Oh i didn&#39;t know i could use let inside a comprehension, thank you. But that way the list goes up to y+b ( 22.5) instead of going just to 20.0, how can i fix it?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 2, "creation_date": 1437769369, "post_id": 31615857, "comment_id": 51187677, "body": "@user3237465 I don&#39;t really think that&#39;s related. The bug here is using <code>a+b</code> instead of just <code>a</code>, not anything to do with Haskell&#39;s funny enumeration rules."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1437770833, "post_id": 31615857, "comment_id": 51188361, "body": "@Daniel Wagner, yep, I didn&#39;t look at the first number and the length of the list. Anyway, it&#39;s &quot;not safe&quot; to use enumerations for floats like this."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 8, "last_activity_date": 1437756760, "creation_date": 1437756760, "answer_id": 31615857, "question_id": 31615373, "link": "https://stackoverflow.com/questions/31615373/haskell-assigning-value-to-a-variable-inside-a-comprehension/31615857#31615857", "title": "Haskell assigning value to a variable inside a comprehension", "body": "<p>You just need to use the <code>let</code> keyword:</p>\n\n<pre><code>partition x y n = [a+b | let b = (y-x)/n ,  a &lt;- [x,x+b..y]]\n</code></pre>\n\n<p>Then you can use <code>b</code> as desired:</p>\n\n<pre><code>\u03bb partition 10 20 4\n[12.5,15.0,17.5,20.0,22.5]\n</code></pre>\n"}], "owner": {"reputation": 606, "user_id": 3497258, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/35f880339f03352b8e66231498e25779?s=128&d=identicon&r=PG&f=1", "display_name": "eXistanCe", "link": "https://stackoverflow.com/users/3497258/existance"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1038, "favorite_count": 1, "accepted_answer_id": 31615857, "answer_count": 2, "score": 2, "last_activity_date": 1437771005, "creation_date": 1437754894, "last_edit_date": 1437771005, "question_id": 31615373, "link": "https://stackoverflow.com/questions/31615373/haskell-assigning-value-to-a-variable-inside-a-comprehension", "title": "Haskell assigning value to a variable inside a comprehension", "body": "<p>I'm having some issues with the following exercise:</p>\n\n<p>I'm supposed to write a function that thats 3 numbers, x y n, being x and y the bottom and upper bounds of a list comprehension (respectively) and n being the number of partitions that comprehension will have.</p>\n\n<p>E.g:</p>\n\n<pre><code>\u03bb&gt; partition 10 20 4\n[10.0, 12.5, 15.0, 17.5, 20.0]\n</code></pre>\n\n<p>What I have done is the following:</p>\n\n<pre><code>partition :: Double -&gt; Double -&gt; Double -&gt; [Double]\npartition x y n = [a+b | b = (y-x) / n ,  a -&gt; [x,b..y]]\n</code></pre>\n\n<p>I don't understand why i can't define the value of the b variable inside the comprehension, since when i try to run it i get the following error message:</p>\n\n<pre><code>parse error on input `='\n</code></pre>\n\n<p>NOTE: This is supposed to be a beginners exercise and this should have a simple resolution</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1437756733, "post_id": 31615238, "comment_id": 51181203, "body": "Why are you using <code>M.map</code>? It&#39;s typed for a <code>Map</code>, not a <code>TileSet</code>!"}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1437757206, "post_id": 31615238, "comment_id": 51181438, "body": "I was trying to use the basic <code>map</code> function. my mistake haha."}], "answers": [{"comments": [{"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1437755345, "post_id": 31615353, "comment_id": 51180430, "body": "Interesting. Just out of curiosity, how would <code>convertTile</code> look using a point free notation?"}], "tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 3, "last_activity_date": 1437755514, "last_edit_date": 1437755514, "creation_date": 1437754824, "answer_id": 31615353, "question_id": 31615238, "link": "https://stackoverflow.com/questions/31615238/couldnt-match-type-map-k0/31615353#31615353", "title": "Couldn&#39;t match type \u2018Map k0&#39;", "body": "<p><code>Data.Map.map</code> has type <code>(a -&gt; b) -&gt; (Map k a) -&gt; (Map k b)</code> so you need to provide a <code>Map k Tile</code> as the second argument. You are providing a <code>[Tile]</code> list so you can just use <code>Prelude.map</code>:</p>\n\n<pre><code>convertTile ts = map complement ts\n</code></pre>\n\n<p>or</p>\n\n<pre><code>convertTile = map complement\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1437755323, "post_id": 31615362, "comment_id": 51180414, "body": "Ah, i see my mistake now. How could i express this in point free notation?"}], "tags": [], "owner": {"reputation": 550, "user_id": 3809223, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a86c2d7227577450956bbbe1ea6662d8?s=128&d=identicon&r=PG&f=1", "display_name": "ksaveljev", "link": "https://stackoverflow.com/users/3809223/ksaveljev"}, "is_accepted": false, "score": 1, "last_activity_date": 1437754856, "creation_date": 1437754856, "answer_id": 31615362, "question_id": 31615238, "link": "https://stackoverflow.com/questions/31615238/couldnt-match-type-map-k0/31615362#31615362", "title": "Couldn&#39;t match type \u2018Map k0&#39;", "body": "<p>If I understand it correctly then you are trying to convert a TileSet using <code>map</code> function. The problem is that you are trying to use <code>map</code> from Data.Map which is not what you want:</p>\n\n<pre><code>:t M.map\nM.map :: (a -&gt; b) -&gt; Map k a -&gt; Map k b\n</code></pre>\n\n<p>So, it wants a function <code>(a -&gt; b)</code> and a <code>Map k a</code> as an input and as a result you get <code>Map k b</code>. What you really want to use is a simple <code>map</code>:</p>\n\n<pre><code>:t map\nmap :: (a -&gt; b) -&gt; [a] -&gt; [b]\n</code></pre>\n\n<p>which does exactly what you want. So in order to fix your problem use <code>map</code> instead of <code>M.map</code></p>\n"}], "owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 31615353, "answer_count": 2, "score": 0, "last_activity_date": 1437755514, "creation_date": 1437754494, "question_id": 31615238, "link": "https://stackoverflow.com/questions/31615238/couldnt-match-type-map-k0", "title": "Couldn&#39;t match type \u2018Map k0&#39;", "body": "<p>Here's my code:</p>\n\n<pre><code>import Data.Map as M\n\ndata Tile = A | T | G | C\ntype TileSet = [Tile]\n\ncomplement :: Tile -&gt; Tile\ncomplement A = T\ncomplement T = A\ncomplement G = C\ncomplement C = G\ncomplement x = A\n\nconvertTile :: TileSet -&gt; TileSet\nconvertTile [] = []\nconvertTile ts = M.map complement ts\n</code></pre>\n\n<p>When I try to compile this i get the following error:</p>\n\n<pre><code>Couldn't match type \u2018Map k0 Tile\u2019 with \u2018[Tile]\u2019\nExpected type: TileSet\nActual type: Map k0 Tile\nIn the expression: M.map complement ts\nIn an equation for \u2018convertTile\u2019:\nconvertTile ts = M.map complement ts\n</code></pre>\n\n<p>My understanding is that <code>Map</code> has a <code>(a -&gt; b) -&gt; a -&gt; b</code> signature. <code>complement</code> returns a Tile and ostensibly <code>ts</code> will be a <code>TileSet</code>. So where is the error coming from?</p>\n"}, {"tags": ["list", "haskell", "reverse"], "answers": [{"comments": [{"owner": {"reputation": 606, "user_id": 3497258, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/35f880339f03352b8e66231498e25779?s=128&d=identicon&r=PG&f=1", "display_name": "eXistanCe", "link": "https://stackoverflow.com/users/3497258/existance"}, "edited": false, "score": 0, "creation_date": 1437743614, "post_id": 31611400, "comment_id": 51172446, "body": "So i should implement some guards to handle the exception right? But if i do that, how can i specify that the return can be either a list ( if its not empty) or a String (to tell the string is empty in case it is) ?"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 606, "user_id": 3497258, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/35f880339f03352b8e66231498e25779?s=128&d=identicon&r=PG&f=1", "display_name": "eXistanCe", "link": "https://stackoverflow.com/users/3497258/existance"}, "edited": false, "score": 0, "creation_date": 1437743848, "post_id": 31611400, "comment_id": 51172637, "body": "@nunocart Just think what output you want for an empty list input ? It need not be necessarily <code>String</code>."}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 4, "last_activity_date": 1437743362, "creation_date": 1437743362, "answer_id": 31611400, "question_id": 31611319, "link": "https://stackoverflow.com/questions/31611319/haskell-reversing-tail-but-leaving-first-element/31611400#31611400", "title": "Haskell reversing tail but leaving first element", "body": "<p>You are almost there. For making sure that the first element of the list stays as it is, just use pattern matching and remove the <code>tail</code> call:</p>\n\n<pre><code>rvrsTail :: [x] -&gt; [x]\nrvrsTail (x:xs) = x:(reverse xs)\n</code></pre>\n\n<p>Now, note that the above function will throw an exception when tried with empty list. You should handle that case.</p>\n"}, {"tags": [], "owner": {"reputation": 2995, "user_id": 1095506, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/07067c06a12496ca32eb400313ef4ab6?s=128&d=identicon&r=PG", "display_name": "mariop", "link": "https://stackoverflow.com/users/1095506/mariop"}, "is_accepted": true, "score": 5, "last_activity_date": 1437744044, "creation_date": 1437744044, "answer_id": 31611639, "question_id": 31611319, "link": "https://stackoverflow.com/questions/31611319/haskell-reversing-tail-but-leaving-first-element/31611639#31611639", "title": "Haskell reversing tail but leaving first element", "body": "<p>When you receive a non-empty list, you must leave the head where it is and append the tail reversed. In other words, you can deconstruct the list into the head and the tail, then reconstruct the list with that head and the reversed tail:</p>\n\n<pre><code>rvrsTail :: [x] -&gt; [x]\nrvrsTail [] = []\nrvrsTail (listHead : listTail) = listHead : reverse listTail\n</code></pre>\n"}], "owner": {"reputation": 606, "user_id": 3497258, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/35f880339f03352b8e66231498e25779?s=128&d=identicon&r=PG&f=1", "display_name": "eXistanCe", "link": "https://stackoverflow.com/users/3497258/existance"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 555, "favorite_count": 0, "accepted_answer_id": 31611639, "answer_count": 2, "score": 1, "last_activity_date": 1437753321, "creation_date": 1437743147, "last_edit_date": 1437753321, "question_id": 31611319, "link": "https://stackoverflow.com/questions/31611319/haskell-reversing-tail-but-leaving-first-element", "title": "Haskell reversing tail but leaving first element", "body": "<p>I'm having trouble with the following exercise :</p>\n\n<p>I'm supposed to reverse all elements in a list except for the first one, the first element of the list must stay in its original position.</p>\n\n<p><strong>Correct Example:</strong></p>\n\n<pre><code>input: rvrsTail [1,2,3,4,5]\noutput [1,5,4,3,2]\n</code></pre>\n\n<p>What I have done so far:</p>\n\n<pre><code>rvrsTail :: [x] -&gt; [x]\nrvrsTail xs = reverse ( tail xs)\n</code></pre>\n\n<p>This does reverse the the tail of the list but removes the first element, and since I can't store the first element in a variable I can't seem to understand how to solve this issue.</p>\n\n<p><strong>Erroneous Output:</strong></p>\n\n<pre><code>input: rvrsTail [1,2,3,4,5]\noutput [5,4,3,2]\n</code></pre>\n\n<p>Since this is supposed to be a beginner's exercise, the solution should be simple.</p>\n"}, {"tags": ["haskell", "ghci"], "answers": [{"comments": [{"owner": {"reputation": 785, "user_id": 3087558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a43d21bfa85dc7dc360cafa7f69ba3b1?s=128&d=identicon&r=PG&f=1", "display_name": "fgv", "link": "https://stackoverflow.com/users/3087558/fgv"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1437757183, "post_id": 31609176, "comment_id": 51181427, "body": "@mb14 Yes, in the past. However version 2.8.0.0 seems have problems to build cleanly on Windows due to an &quot;unknown type name &#39;uint32_t&quot; error message, in case this is the problem that you are seeing with it."}], "tags": [], "owner": {"reputation": 785, "user_id": 3087558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a43d21bfa85dc7dc360cafa7f69ba3b1?s=128&d=identicon&r=PG&f=1", "display_name": "fgv", "link": "https://stackoverflow.com/users/3087558/fgv"}, "is_accepted": true, "score": 3, "last_activity_date": 1437737109, "last_edit_date": 1437737109, "creation_date": 1437736631, "answer_id": 31609176, "question_id": 31608246, "link": "https://stackoverflow.com/questions/31608246/print-call-stack-of-recursive-loop/31609176#31609176", "title": "Print call stack of recursive loop", "body": "<p>It seems that you are looking for something like <a href=\"http://projects.haskell.org/hat/\" rel=\"nofollow\" title=\"Hat\">Hat</a>, which is a source level tracer for haskell, and possibly specifically for hat-stack, which is the stack tracer component.</p>\n\n<p>You can alternatively use the debugger/tracer built into ghci. Not as nice as hat, but doesn't require to recompile your code and it's readily available. In case you wonder, it's the <code>:trace</code> command in ghci.</p>\n"}], "owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "accepted_answer_id": 31609176, "answer_count": 1, "score": 3, "last_activity_date": 1437767205, "creation_date": 1437733910, "last_edit_date": 1437737762, "question_id": 31608246, "link": "https://stackoverflow.com/questions/31608246/print-call-stack-of-recursive-loop", "title": "Print call stack of recursive loop", "body": "<p>Is there a generic function (<code>printCallStack</code>) that will print the call stack of a recursive loop.</p>\n\n<p>For example,  </p>\n\n<pre><code>printCallStack(length ([7, 1 'quot' 0])) \n</code></pre>\n\n<p>prints call stack : </p>\n\n<p><a href=\"https://i.stack.imgur.com/xWC55.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/xWC55.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1437732780, "post_id": 31607714, "comment_id": 51165610, "body": "well as you mentioned it - the advantage of the reader monad would be that you don&#39;t have to pass <code>conf</code> around as a parameter ..."}], "answers": [{"comments": [{"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "edited": false, "score": 0, "creation_date": 1437745005, "post_id": 31610975, "comment_id": 51173524, "body": "Ok, but how do I initialise the Reader Monad getting with the path at the beginning?"}, {"owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "reply_to_user": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "edited": false, "score": 0, "creation_date": 1437751892, "post_id": 31610975, "comment_id": 51178352, "body": "Just read/create your <code>Conf</code> value as you normally would, and then call <code>runReader somethingComplex yourConf</code> to get a <code>(Foo, Bar)</code> from it, here."}, {"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "edited": false, "score": 0, "creation_date": 1437753518, "post_id": 31610975, "comment_id": 51179334, "body": "If I have to re-read/re-create my conf everytime I don&#39;t see the point using a reader monad. I wanna build the conf only once, as it might be expensive doing it (fetch info from a db, server, calculations etc)."}, {"owner": {"reputation": 681, "user_id": 1072349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/df7cee6d1e4d0768b5da914783c815ad?s=128&d=identicon&r=PG", "display_name": "ajerneck", "link": "https://stackoverflow.com/users/1072349/ajerneck"}, "edited": false, "score": 1, "creation_date": 1437755696, "post_id": 31610975, "comment_id": 51180643, "body": "It&#39;s only created once, <code>conf &lt;- ask</code> retrieves it for use in each function."}], "tags": [], "owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "is_accepted": false, "score": 1, "last_activity_date": 1437742175, "creation_date": 1437742175, "answer_id": 31610975, "question_id": 31607714, "link": "https://stackoverflow.com/questions/31607714/how-to-manage-a-simple-configuration/31610975#31610975", "title": "How to manage a simple configuration", "body": "<p>Like @Carsten said, the advantage of the Reader monad is that you can avoid having to pass <code>conf</code> around! Instead of writing:</p>\n\n<pre><code>data Conf = Conf {\n    basePath :: FilePath\n    genericValue :: Int\n}\n\nsomethingSimple :: Conf -&gt; Foo\nsomethingSimple conf = ...\n\nsomethingElse :: Conf -&gt; Bar\nsomethingElse conf = ...\n\nsomethingComplex :: Conf -&gt; (Foo, Bar)\nsomethingComplex conf = (somethingSimple conf, somethingElse conf)\n</code></pre>\n\n<p>You'd write:</p>\n\n<pre><code>somethingSimple :: Reader Conf Foo\nsomethingSimple = do\n  conf &lt;- ask\n  return ...\n\nsomethingElse :: Reader Conf Bar\nsomethingElse conf = do\n  conf &lt;- ask\n  return ...\n\nsomethingComplex :: Reader Conf (Foo, Bar)\nsomethingComplex = do\n  a &lt;- somethingSimple\n  b &lt;- somethingElse\n  return (a, b)\n</code></pre>\n\n<p>Thus eliminating the jugging-around of <code>conf</code> from the definition of <code>somethingComplex</code> entirely: you just define an action that reads <em>some</em> <code>Conf</code> value by combining other actions that read <em>some</em> <code>Conf</code> value. You only pass an actual <code>Conf</code> in once, namely to <code>runReader</code>!</p>\n\n<p>Plus, you get to write cool stuff like:</p>\n\n<pre><code>somethingComplex' :: Reader Conf (Foo, Bar)\nsomethingComplex' = liftM2 (,) somethingSimple somethingElse\n</code></pre>\n"}], "owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1437753562, "creation_date": 1437732427, "last_edit_date": 1437753562, "question_id": 31607714, "link": "https://stackoverflow.com/questions/31607714/how-to-manage-a-simple-configuration", "title": "How to manage a simple configuration", "body": "<p>My app needs a very simple configuration composed by a <code>basePath</code> initialized when the app starts, in this way:</p>\n\n<pre><code>data Conf = Conf {\n    basePath :: FilePath\n    genericValue :: Int\n}\n\nstartApp :: IO ()\nstartApp = do\n  hd &lt;- getHomeDirectory\n  let conf = conf (basePath = hd ++ \"/some_dir/\", genericValue = 10)\n  -- start to pass around conf\n</code></pre>\n\n<p>To fetch the values I just use: <code>basePath conf</code> and <code>genericValue conf</code>.</p>\n\n<p>Is there a better way to manage this and maybe avoiding to pass around this <code>conf</code> value across the functions? Around I can find suggestions like Reader Monad, but I cannot see the real advantage in it.</p>\n"}, {"tags": ["haskell", "hakyll"], "comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 3, "creation_date": 1437734469, "post_id": 31607592, "comment_id": 51166616, "body": "Have you tried using <a href=\"http://jaspervdj.be/hakyll/reference/Hakyll-Core-Compiler.html\" rel=\"nofollow noreferrer\"><code>load</code></a> or a variant of it (e.g. <code>loadBody</code>)?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 1, "creation_date": 1437857498, "post_id": 31607592, "comment_id": 51209192, "body": "@gallais That will solve it. I suggest you make an answer out of your comment."}, {"owner": {"reputation": 842, "user_id": 4737779, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/009c3f05f9273268e5d530785ef14327?s=128&d=identicon&r=PG&f=1", "display_name": "Beerend Lauwers", "link": "https://stackoverflow.com/users/4737779/beerend-lauwers"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 1, "creation_date": 1438002934, "post_id": 31607592, "comment_id": 51253330, "body": "@gallais I&#39;ll try this out this week, thanks!"}], "owner": {"reputation": 842, "user_id": 4737779, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/009c3f05f9273268e5d530785ef14327?s=128&d=identicon&r=PG&f=1", "display_name": "Beerend Lauwers", "link": "https://stackoverflow.com/users/4737779/beerend-lauwers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 388, "favorite_count": 1, "answer_count": 0, "score": 4, "last_activity_date": 1437732007, "creation_date": 1437732007, "question_id": 31607592, "link": "https://stackoverflow.com/questions/31607592/hakyll-how-can-i-use-the-contents-of-a-transformed-file-in-another-file-transf", "title": "Hakyll - How can I use the contents of a transformed file in another file transformation?", "body": "<p>Let's say I have this Hakyll template:</p>\n\n<pre><code>&lt;h2&gt;The archive&lt;/h2&gt;\n&lt;p&gt;This is an archive of all posts.&lt;/p&gt;\n\n&lt;ul id=\"archive\"&gt;\n$partial(\"templates/post-list.html\")$\n&lt;/ul&gt;\n</code></pre>\n\n<p>Now, I would like to extract the static text and put it in a MarkDown file that is rendered to HTML by Hakyll and include it in the template, like so:</p>\n\n<pre><code>$intro$\n\n&lt;ul id=\"archive\"&gt;\n$partial(\"templates/post-list.html\")$\n&lt;/ul&gt;\n</code></pre>\n\n<p><a href=\"https://groups.google.com/forum/#!topic/hakyll/vYtcOAceIks\" rel=\"nofollow\">I found a similar question online</a>, but it's for an older version of Hakyll.</p>\n\n<p>My rough idea would be to modify the part of my <code>site.hs</code> that generates <code>archive.html</code> to include another <code>constField</code> called <code>\"intro\"</code> and passing it the processed MarkDown file:</p>\n\n<pre><code>    create [\"archive.html\"] $ do\n    route idRoute\n    compile $ do\n        posts &lt;- recentFirst =&lt;&lt; loadAll \"posts/*\"\n        let archiveCtx =\n                listField \"posts\" postCtx (return posts) `mappend`\n                constField \"title\" \"Archives\"            `mappend`\n                constField \"intro\" ???                   `mappend`\n                defaultContext\n\n        makeItem \"\"\n            &gt;&gt;= loadAndApplyTemplate \"templates/archive.html\" archiveCtx\n            &gt;&gt;= loadAndApplyTemplate \"templates/default.html\" archiveCtx\n            &gt;&gt;= relativizeUrls\n</code></pre>\n\n<p>To process the MarkDown file, I'd probably have to do something like this:</p>\n\n<pre><code> match \"archive/intro.md\" $ do\n    -- route $ setExtension \"html\" -- No route necessary, we only want file contents\n    compile $ pandocCompiler\n</code></pre>\n\n<p>But how can I load the processed file into the previous snippet?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1437710302, "post_id": 31601825, "comment_id": 51154956, "body": "With GHC, things are only evaluated in parallel if you ask for it (and sometimes not even then). Other compilers may differ. Answering your other question, though, requires some care: what does &quot;evaluated correctly&quot; mean, specifically? Perhaps part of my clarification question would be answered by saying what you are afraid might go wrong. (&quot;They are evaluated in parallel&quot; doesn&#39;t appear to me to be something going wrong.)"}], "answers": [{"comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 5, "creation_date": 1437712415, "post_id": 31601918, "comment_id": 51155435, "body": "Haskell is not necessarily lazily evaluated, but whatever order the implementation picks will give the same result as lazy evaluation."}, {"owner": {"reputation": 785, "user_id": 3087558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a43d21bfa85dc7dc360cafa7f69ba3b1?s=128&d=identicon&r=PG&f=1", "display_name": "fgv", "link": "https://stackoverflow.com/users/3087558/fgv"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1437738024, "post_id": 31601918, "comment_id": 51168812, "body": "@augustss You are absolutely correct, sir. To be more specific, Haskell is non-strict, which happens to be implemented as lazy evaluation."}], "tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": true, "score": 11, "last_activity_date": 1437710144, "creation_date": 1437710144, "answer_id": 31601918, "question_id": 31601825, "link": "https://stackoverflow.com/questions/31601825/how-dependent-bindings-in-let-are-evaluated/31601918#31601918", "title": "how dependent bindings in let are evaluated?", "body": "<p>Haskell is lazy evaluated. This means that expressions are only evaluated by necessity. Let's start with your example.</p>\n\n<pre><code>let x = 1\n    y = x + 2\nin y\n</code></pre>\n\n<p>The system looks at the <code>y</code> part (the expression), and says \"Hey. I know what <code>y</code> equals. It equals <code>x + 2</code>\" But it can only evaluate <code>x + 2</code> if it has a definition for <code>x</code>, so it does the same thing and decides that <code>y</code> is <code>1 + 2</code> which is of course <code>3</code>. Now this is only a small portion of the power of lazy evaluation. The next example shows it more fully.</p>\n\n<pre><code>let x = 0 : y\n    y = 1 : x\nin take 50 x\n</code></pre>\n\n<p>This expression will evaluate correctly, yielding the first fifty elements on the list <code>x</code>, which will be <code>0</code> and <code>1</code> alternating. Both of the values <code>x</code> and <code>y</code> are infinite lists that depend on each other, and indeed in most languages this would overflow the stack. However, the evaluation rules allow the system to only see the parts it needs, which in that example is the first fifty elements.</p>\n\n<p>So to answer your question about evaluation order, the system evaluates what it sees. If the function is supposed to return <code>y</code>, it evaluates <code>y</code> and then as necessary <code>x</code>. If you had put <code>x</code> in your first example, it would have evaluated <code>x</code> and left <code>y</code> alone. For example, this code will not err.</p>\n\n<pre><code>let x = 1\n    y = error \"I'm an error message!\"\nin x\n</code></pre>\n\n<p>This is because the <code>y</code> form is never needed, so the piece of code that would crash the program is never even looked at.</p>\n"}, {"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 2, "last_activity_date": 1437710228, "creation_date": 1437710228, "answer_id": 31601926, "question_id": 31601825, "link": "https://stackoverflow.com/questions/31601825/how-dependent-bindings-in-let-are-evaluated/31601926#31601926", "title": "how dependent bindings in let are evaluated?", "body": "<p>In Haskell (regardless of whether you use a single <code>let</code>, multiple <code>let</code>s, <code>case</code>, <code>where</code> or function parameters) an expression is evaluated when the evaluation of another expression depends on its value.</p>\n\n<p>So in your case, as soon as <code>y</code>'s value is required (which of course depends on the surrounding program), <code>y</code> will be evaluated and <code>x</code> will be evaluated as part of <code>y</code>'s evaluation.</p>\n\n<p>Another way to think of it is this: whenever you use the value of a variable, it will be evaluated at that point at the latest. That is it might have been evaluated previously (if it was needed previously) or it might be evaluated now, but, as long as you do use the value, it will never not be evaluated. So, except for performance reasons, there's no need to worry about when a variable will be evaluated.</p>\n"}], "owner": {"reputation": 26022, "user_id": 410102, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/a70b7da5a3a712e800100e61ef8d8917?s=128&d=identicon&r=PG", "display_name": "akonsu", "link": "https://stackoverflow.com/users/410102/akonsu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 314, "favorite_count": 0, "accepted_answer_id": 31601918, "answer_count": 2, "score": 1, "last_activity_date": 1437710228, "creation_date": 1437709450, "question_id": 31601825, "link": "https://stackoverflow.com/questions/31601825/how-dependent-bindings-in-let-are-evaluated", "title": "how dependent bindings in let are evaluated?", "body": "<p>Is it safe to use bindings that depend on each other in <code>let</code>? For example:</p>\n\n<pre><code>let x = 1\n    y = x + 2\nin y\n</code></pre>\n\n<p>Is it possible that they are evaluated in parallel? my <code>ghci</code> shows that it is evaluated correctly, but will this be always the case?</p>\n"}, {"tags": ["haskell", "tail-recursion"], "comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1437701724, "post_id": 31600741, "comment_id": 51152976, "body": "I&#39;m interested in wether there is an obvious translation of non-tail-recursive functions with multiple recursive branches to their tail-recursive counterparts. Am I wrong in thinking that you would have to use zippers in order to keep it efficient, since the accumulating structure needs to be edited deeply on each tail call?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1437704815, "post_id": 31600741, "comment_id": 51153698, "body": "CPS essentially makes the accumulating structure a function, which is powerful enough to be &quot;edited deeply&quot;"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1437706471, "post_id": 31600741, "comment_id": 51154087, "body": "Ah, okay! That fits it, thanks guys."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1437751840, "post_id": 31600741, "comment_id": 51178321, "body": "Doesn&#39;t Haskell&#39;s <code>showsPrec</code> solve exactly this problem by getting you to provide a function <code>a -&gt; ShowS</code> given a precedence? Not sure, but that&#39;s what I thought?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1437756299, "post_id": 31600741, "comment_id": 51180965, "body": "@Alec <code>showsPrec</code> is more efficient than <code>show</code>, but it isn&#39;t tail recursive. However, that&#39;s because in Haskell, it doesn&#39;t make <i>sense</i> for <code>show</code> to be tail recursive (ref. luqui&#39;s mention of corecursivity)."}], "answers": [{"tags": [], "owner": {"reputation": 1732, "user_id": 3543182, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/f84c6d267c754e4fd440e595afc32673?s=128&d=identicon&r=PG&f=1", "display_name": "M. Shaw", "link": "https://stackoverflow.com/users/3543182/m-shaw"}, "is_accepted": false, "score": 4, "last_activity_date": 1437703466, "creation_date": 1437703466, "answer_id": 31601016, "question_id": 31600741, "link": "https://stackoverflow.com/questions/31600741/how-do-you-implement-show-tail-recursively/31601016#31601016", "title": "How do you implement &quot;show&quot; tail-recursively?", "body": "<p>You can turn this tail-recursive via <a href=\"https://en.wikipedia.org/wiki/Continuation-passing_style\" rel=\"nofollow\">Continuation passing style</a>. Have a look the examples on the wiki page.</p>\n"}, {"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 6, "last_activity_date": 1437704978, "last_edit_date": 1437704978, "creation_date": 1437704366, "answer_id": 31601155, "question_id": 31600741, "link": "https://stackoverflow.com/questions/31600741/how-do-you-implement-show-tail-recursively/31601155#31601155", "title": "How do you implement &quot;show&quot; tail-recursively?", "body": "<p>Using CPS, as mentioned by M. Shaw.</p>\n\n<pre><code>show' :: Tree -&gt; String\nshow' = \\tree -&gt; go tree id\n    where\n    go (Node left right) c = \n      go left (\\l -&gt; go right (\\r -&gt; c (\"(Node \" ++ l ++ \" \" ++ r ++ \")\")))\n    go Leaf c = c \"Leaf\"\n</code></pre>\n\n<p>It's important to keep in mind that Haskell's laziness obviates the need for tail recursion in many cases.  In this case, the tail recursive version has to traverse the entire tree before any part of the input can be returned.  Try showing an infinite tree with each version.  When returning a lazy structure such as <code>String</code> in a lazy language, it is better to be corecursive (which your original implementation is) than tail recursive.</p>\n\n<p>Most of the time of this function will be eaten up by left-nested <code>(++)</code> calls, which is <code>O(n)</code> in its left argument.  The solution is to use a <a href=\"https://wiki.haskell.org/Difference_list\">difference list</a>, which is a form of continuation-passing style itself.</p>\n\n<p>See also <a href=\"http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.83.8567\">Continuation-Based Program Transformation Strategies</a>, which talks about how to arrive at efficient algorithms by converting to CPS, then transforming the structure of the continuations into something more concrete to arrive at a tail-recursive solution.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 3, "accepted_answer_id": 31601155, "answer_count": 2, "score": 4, "last_activity_date": 1437704978, "creation_date": 1437701356, "question_id": 31600741, "link": "https://stackoverflow.com/questions/31600741/how-do-you-implement-show-tail-recursively", "title": "How do you implement &quot;show&quot; tail-recursively?", "body": "<p>Haskell's <code>show</code> is usually implemented recursively as:</p>\n\n<pre><code>data Tree = Node Tree Tree | Leaf\n\nshow' (Node left right) = \"(Node \" ++ show' left ++ \" \" ++ show' right ++ \")\"\nshow' Leaf              = \"Leaf\"\n\nmain = putStrLn $ show' (Node (Node Leaf Leaf) Leaf)\n</code></pre>\n\n<p>How can you implement <code>show</code> using tail recursion? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1437699698, "post_id": 31600470, "comment_id": 51152512, "body": "The implementation of <code>foo</code> needs to be attached to the class that <code>foo</code> is a member of. What would you expect to happen if there was a second subclass of <code>MyClass</code> that also tried to define a default implementation of <code>foo</code> like this?"}, {"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1437700153, "post_id": 31600470, "comment_id": 51152613, "body": "@ReidBarton i want to express <code>implementation of foo is unknown at the point of MyClass but given some property of SubClass, the default implementation of foo can be decided</code>."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1437700426, "post_id": 31600470, "comment_id": 51152680, "body": "Then see Daniel Wagner&#39;s answer, but note that you have to choose what the subclass <code>SubClass</code> is when you define <code>MyClass</code>."}, {"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1437700493, "post_id": 31600470, "comment_id": 51152699, "body": "@ReidBarton yeah. i&#39;ve read that. that&#39;s not the most desirable. wouldn&#39;t it be able to define an instance with constraint to deal with that?"}], "answers": [{"comments": [{"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1437700308, "post_id": 31600522, "comment_id": 51152648, "body": "this is nice, but i am expecting the default implementation appear with <code>MyClass</code>. would that be achievable by defining an instance with constraint? like <code>instance (SubClass a) =&gt; MyClass a</code> but it looks quite weird."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1437700751, "post_id": 31600522, "comment_id": 51152748, "body": "@HuStmpHrrr I&#39;m not sure I understand your objection. Can you clarify further? In particular, you say you expect the default implementation to appear in <code>MyClass</code>; but it does in fact appear there. So what&#39;s the problem?"}, {"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1437700961, "post_id": 31600522, "comment_id": 51152795, "body": "oh crap my brain. i meant <b>appear with <code>SubClass</code></b>, since the default implementation belongs to <code>SubClass</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1437701187, "post_id": 31600522, "comment_id": 51152847, "body": "@HuStmpHrrr Suppose in your proposed world I wrote <code>class MyClass a =&gt; SubClass1 a where {foo x = [x]}; class MyClass a =&gt; SubClass2 a where {foo x = [x,x]}; instance SubClass1 Integer; instance SubClass2 Integer</code>. What would be the meaning of <code>foo 3</code> in that world, <code>[3]</code> or <code>[3,3]</code>?"}, {"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1437701459, "post_id": 31600522, "comment_id": 51152908, "body": "i see your point. but wouldn&#39;t default signatures have the same problem?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1437706686, "post_id": 31600522, "comment_id": 51154128, "body": "@HuStmpHrrr Default signatures don&#39;t have this problem: the default implementation is associated with the method it is implementing, so it is easy for the compiler to only let you write one without violating the open world assumption or losing separate compilation."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1437742688, "post_id": 31600522, "comment_id": 51171783, "body": "Is it possible to use the default implementation when defining a new one ? It&#39;s a common pattern in OO to just <i>decorate</i> a parent method."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1437760908, "post_id": 31600522, "comment_id": 51183392, "body": "@mb14 You may of course give it its own name; e.g. <code>subClassDef param = [param]</code> at the top level and then write <code>foo = subClassDef</code> in the declaration of <code>MyClass</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1437761042, "post_id": 31600522, "comment_id": 51183471, "body": "@mb14 ...but it sounds to me like you are trying to use Haskell classes as if they were OO-style classes. This is bound to cause pain: Haskell classes are a collection of types, whereas OO-style classes are generally a single, distinguished type."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1437765221, "post_id": 31600522, "comment_id": 51185606, "body": "I&#39;m not doing anything, I&#39;m just asking a question ;-)"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 5, "last_activity_date": 1437699697, "creation_date": 1437699697, "answer_id": 31600522, "question_id": 31600470, "link": "https://stackoverflow.com/questions/31600470/how-to-define-default-implementation-in-subclass-definition-in-haskell/31600522#31600522", "title": "How to define default implementation in subclass definition in Haskell?", "body": "<p>This can be achieved with <code>DefaultSignatures</code>:</p>\n\n<pre><code>{-# LANGUAGE DefaultSignatures #-}\n\nclass MyClass a where\n    foo :: a -&gt; [a]\n    default foo :: SubClass a =&gt; a -&gt; [a]\n    foo param = [param]\n\nclass MyClass a =&gt; SubClass a where\n    bar :: a -&gt; a\n</code></pre>\n\n<p>Testing it in ghci:</p>\n\n<pre><code>&gt; instance MyClass Integer; instance SubClass Integer where bar = id\n&gt; foo 3\n[3]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1437701640, "post_id": 31600722, "comment_id": 51152952, "body": "thanks for your elaboration. it&#39;s very clear now. however, what about defining an instance of <code>MyClass</code> for all <code>SubClass</code>? something like <code>instance (SubClass a) =&gt; MyClass a</code>? what prevents me from doing that?"}, {"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "reply_to_user": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1437702331, "post_id": 31600722, "comment_id": 51153131, "body": "@HuStmpHrrr : A declaration like that would fail the ambiguity check. Type declarations with ambiguous type declarations (ones with types like <code>a</code>) only work when the type of the placeholder can be inferred from context. For example, if you have a function with the signature <code>[a] -&gt; Int</code>, and then call it with <code>[&#39;c&#39;,&#39;$&#39;,&#39;\\n&#39;]</code>, it can infer the type of <code>a</code> to be <code>Char</code>, so it succeeds. In your example, there is no context to speak of, and so cannot determine the type of <code>a</code>. This is the same reason that a list of type <code>[a]</code> must still be homogeneous."}], "tags": [], "owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "is_accepted": false, "score": 6, "last_activity_date": 1437701508, "last_edit_date": 1437701508, "creation_date": 1437701202, "answer_id": 31600722, "question_id": 31600470, "link": "https://stackoverflow.com/questions/31600470/how-to-define-default-implementation-in-subclass-definition-in-haskell/31600722#31600722", "title": "How to define default implementation in subclass definition in Haskell?", "body": "<p>Elaborating on Daniel's answer:</p>\n\n<p>Suppose you have a new datatype <code>MyData</code>, defined as</p>\n\n<pre><code>data MyData = D1 | D2\n</code></pre>\n\n<p>You want to make <code>MyData</code> an instance of <code>SubClass</code>. You try the obvious solution first.</p>\n\n<pre><code>instance SubClass MyData where\n    bar x = case x of { D1 -&gt; D2 ; D2 -&gt; D1 }\n</code></pre>\n\n<p>A quick examination of the type signatures, though, reveals that this won't work, because a type has to be an instance of <code>MyClass</code> before it can be an instance of <code>SubClass</code>. So you make <code>MyData</code> an instance of <code>MyClass</code>.</p>\n\n<pre><code>instance MyClass MyData\n</code></pre>\n\n<p>Again, this raises an error, because <code>foo</code> is included in the minimal complete definition of <code>MyClass</code>. For your instance to work, you would have to manually define <code>foo</code>, thus defeating the purpose of the default declaration.</p>\n\n<p>In short, there is no way to do this in basic Haskell98 (or Haskell2010, for that matter). Thankfully, however, GHC provides a useful extension called <code>DefaultSignatures</code>. So, using Daniel's example:</p>\n\n<pre><code>{-# LANGUAGE DefaultSignatures #-}\n\nclass MyClass a where\n    foo :: a -&gt; [a]\n    default foo :: SubClass a =&gt; a -&gt; [a]\n    foo param = [param]\n\nclass MyClass a =&gt; SubClass a where\n    bar :: a -&gt; a\n</code></pre>\n\n<p>And now, you can define the instances and they will work as you would expect. The downside to this solution is that the default definition has to be defined in <code>MyClass</code>, but this is necessary. The definition of <code>foo</code> belongs to the definition of <code>MyClass</code> (or one of its instance declarations), so if you were able to define the default declaration of <code>foo</code> within the definition of <code>SubClass</code>, Haskell's <em>type isolation</em> would be broken. </p>\n"}], "owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1182, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1437701508, "creation_date": 1437699189, "last_edit_date": 1495542149, "question_id": 31600470, "link": "https://stackoverflow.com/questions/31600470/how-to-define-default-implementation-in-subclass-definition-in-haskell", "title": "How to define default implementation in subclass definition in Haskell?", "body": "<p>I am new comer of Haskell and following is my question:</p>\n\n<p>given this class:</p>\n\n<pre><code>class MyClass a where\n    foo :: a -&gt; [a]\n</code></pre>\n\n<p>then I have a subclass that is more specific:</p>\n\n<pre><code>class (MyClass a) =&gt; SubClass a where\n    foo param = [bar param]\n    bar :: a -&gt; a\n</code></pre>\n\n<p>but it doesn't work as expected. I was expecting a default implementation is setup in the definition of <code>SubClass</code> but it doesn't. I will need to define the instance for <code>MyClass</code> seperately, but that sounds stupid. How can I achieve default implementation when I know some subclass satisfies some property definitely?</p>\n\n<p>More specifically, I want to express in Haskell, that <code>when a class satisfies some properties, some functions for its parent can have default implementation</code>. In my example, <code>SubClass</code> has property <code>bar</code> such that I know <code>foo</code> is definitely defined in such a way.</p>\n\n<p>A more general form of this question is, is it a good idea to reuse by using classes and instances? </p>\n\n<p>I found this post: <a href=\"https://stackoverflow.com/questions/4469615/inclusion-of-typeclasses-with-default-implementation-in-haskell\">Inclusion of typeclasses with default implementation in Haskell</a></p>\n\n<p>It's quite close, but still not answering my question totally and their forms are little bit different.</p>\n"}, {"tags": ["haskell", "int", "concatenation"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1437697021, "post_id": 31600179, "comment_id": 51151865, "body": "Look at what happens when you multiply a number by 10..."}, {"owner": {"reputation": 2111, "user_id": 1434220, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d48e2a034dc8b5a8d28840c68e71f902?s=128&d=identicon&r=PG", "display_name": "hdgarrood", "link": "https://stackoverflow.com/users/1434220/hdgarrood"}, "edited": false, "score": 1, "creation_date": 1437697325, "post_id": 31600179, "comment_id": 51151932, "body": "Just to clarify about the (++) function: it only works with lists. Strings are lists of chars, which is why it works with strings."}], "answers": [{"tags": [], "owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "is_accepted": true, "score": 8, "last_activity_date": 1437878760, "last_edit_date": 1437878760, "creation_date": 1437700030, "answer_id": 31600561, "question_id": 31600179, "link": "https://stackoverflow.com/questions/31600179/haskell-concat-int/31600561#31600561", "title": "Haskell concat Int", "body": "<p>You are trying to solve the problem graphically (thinking of the integers as strings), you want to treat it as a numerical problem. For positive values, appending a digit is accomplished by the following function.</p>\n\n<pre><code>addDigitPositive a b = 10 * a + b\n</code></pre>\n\n<p>This will unfortunately <em>not</em> work if <code>a &lt; 0</code>. Under those circumstances we would have to <em>subtract</em> <code>b</code>. We can incorporate this functionality easily with function guards.</p>\n\n<pre><code>addDigit a b | a &lt; 0     = a * 10 - b\n             | otherwise = a * 10 + b\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 2, "creation_date": 1437703311, "post_id": 31600832, "comment_id": 51153346, "body": "The asker specifically said that he did <i>not</i> want a solution that involved &quot;changing the Ints to Strings&quot;."}], "tags": [], "owner": {"reputation": 785, "user_id": 3087558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a43d21bfa85dc7dc360cafa7f69ba3b1?s=128&d=identicon&r=PG&f=1", "display_name": "fgv", "link": "https://stackoverflow.com/users/3087558/fgv"}, "is_accepted": false, "score": 0, "last_activity_date": 1437702082, "creation_date": 1437702082, "answer_id": 31600832, "question_id": 31600179, "link": "https://stackoverflow.com/questions/31600179/haskell-concat-int/31600832#31600832", "title": "Haskell concat Int", "body": "<p>Or you could solve it graphically, by converting the numbers to strings using <code>show</code> and then concatenating them with <code>(++)</code>:</p>\n\n<pre><code>addDigit :: Int -&gt; Int -&gt; String\naddDigit x y = (show x) ++ (show y)\n</code></pre>\n\n<p>Now, if you still want an Int as the output, you can convert the string to an Int using <code>read</code>:</p>\n\n<pre><code>addDigit :: Int -&gt; Int -&gt; Int\naddDigit x y = read ((show x) ++ (show y))\n</code></pre>\n\n<p>As you can see, there is more than one way to skin a cat.</p>\n\n<p>I hope this helps.</p>\n"}], "owner": {"reputation": 606, "user_id": 3497258, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/35f880339f03352b8e66231498e25779?s=128&d=identicon&r=PG&f=1", "display_name": "eXistanCe", "link": "https://stackoverflow.com/users/3497258/existance"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5318, "favorite_count": 0, "accepted_answer_id": 31600561, "answer_count": 2, "score": 2, "last_activity_date": 1437878760, "creation_date": 1437696870, "last_edit_date": 1437697083, "question_id": 31600179, "link": "https://stackoverflow.com/questions/31600179/haskell-concat-int", "title": "Haskell concat Int", "body": "<p>I am having trouble with the following exercise:</p>\n\n<p>I must make a function named addDigit, which takes two Int's, the second one being between 0 and 9, and return an Int that is the first Int followed by the second one.</p>\n\n<p>Example:</p>\n\n<p>input: <code>addDigit (-123) 4</code></p>\n\n<p>output: <code>-1234</code></p>\n\n<p>what I have tried is the following :</p>\n\n<pre><code>addDigit :: Int -&gt; Int -&gt; Int\naddDigit x y = x ++ y\n</code></pre>\n\n<p>I get it doesn't work because the ++ keyword only works with strings, chars and lists (i think), and this is supposed to be solved in a simple way without changing the Int's to Strings or any sort of other variables, but i have no clue at all on how to do it.</p>\n"}, {"tags": ["haskell", "lambda", "functional-programming", "lambda-calculus", "interaction-nets"], "comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1437713814, "post_id": 31599684, "comment_id": 51155760, "body": "(The obvious issue with this is that the readback procedure uses 99% of the runtime my application for long enough terms.)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1437723583, "post_id": 31599684, "comment_id": 51160030, "body": "I see some D-e edges that intuitively should simplify. Isn&#39;t there some rule for that you are not applying?"}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1437750609, "post_id": 31606462, "comment_id": 51177583, "body": "Thanks for the link. Quite interesting."}, {"owner": {"reputation": 43226, "user_id": 61342, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3e8d217e0ecf6db31de80b698726a50a?s=128&d=identicon&r=PG", "display_name": "\u0141ukasz Lew", "link": "https://stackoverflow.com/users/61342/%c5%81ukasz-lew"}, "edited": false, "score": 1, "creation_date": 1489965997, "post_id": 31606462, "comment_id": 72888253, "body": "You mention <a href=\"https://www.reddit.com/r/haskell/comments/2zqtfk/why_isnt_anyone_talking_about_optimal_lambda/csommh8/\" rel=\"nofollow noreferrer\">here</a> that Elementary/Light variants do not require oracle and therefore do not suffer from accumulation in control operators. This now seems weaker than I expected since there still exists accumulation of (non-oracle) operators.  You also say it is &#39;normal&#39;. Does it mean that there is an unavoidable growing overhead in typical evaluation? How big can it be?"}, {"owner": {"reputation": 76, "user_id": 778495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TX4gX.png?s=128&g=1", "display_name": "Marco Solieri", "link": "https://stackoverflow.com/users/778495/marco-solieri"}, "reply_to_user": {"reputation": 43226, "user_id": 61342, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3e8d217e0ecf6db31de80b698726a50a?s=128&d=identicon&r=PG", "display_name": "\u0141ukasz Lew", "link": "https://stackoverflow.com/users/61342/%c5%81ukasz-lew"}, "edited": false, "score": 1, "creation_date": 1490035673, "post_id": 31606462, "comment_id": 72922349, "body": "@\u0141ukaszLew The overhead of a <i>naive</i> implementation can even cause an exponential explosion of the number of interactions. But it is not unavoidable at all -- it suffices to include the set of &#39;safe rules&#39; (see above) and the mechanism to detect their applicability."}], "tags": [], "owner": {"reputation": 76, "user_id": 778495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TX4gX.png?s=128&g=1", "display_name": "Marco Solieri", "link": "https://stackoverflow.com/users/778495/marco-solieri"}, "is_accepted": true, "score": 6, "last_activity_date": 1445444506, "last_edit_date": 1495542728, "creation_date": 1437728856, "answer_id": 31606462, "question_id": 31599684, "link": "https://stackoverflow.com/questions/31599684/is-it-usual-for-interaction-nets-to-leave-piles-of-redundant-fans/31606462#31606462", "title": "Is it usual for interaction nets to leave piles of redundant fans?", "body": "<h2>Yes, it is usual (but there are techniques to lessen its presence)</h2>\n\n<p>Abstracting from some details of your implementation with Interaction Nets,\nand also from your hypothesis of soundness of the abstract algorithm for your <code>div</code>,\neverything seems just fine to me.</p>\n\n<ul>\n<li><p>No further interaction can be applied to the output you show, in spite of <a href=\"https://stackoverflow.com/users/3234959/chi\">chi</a>'s claim, because none of the pairs <code>D-e</code> can interact through their principal port.</p></li>\n<li><p>This latter kind of reduction rule (that is not allowed by IN framework) may improve efficiency and it is also sound in some particular cases.\nBasically, the involved fan must not have any \"twin\", i.e. there must exists no <code>D'</code> in the net such that eventually the annihilation <code>D-D'</code> can happen.\nFor more details, look at <a href=\"http://www.worldcat.org/title/optimal-implementation-of-functional-programming-languages/oclc/38067735\" rel=\"nofollow noreferrer\">The optimal implementation of functional programming language</a>, chapter <a href=\"http://lex104.cs.unibo.it/pub/asperti/safe.ps\" rel=\"nofollow noreferrer\">Safe nodes</a> (which is available online!), or at the original paper from which that came:</p>\n\n<blockquote>\n  <p>Asperti, Andrea, and Juliusz Chroboczek. \"Safe Operators: Brackets Closed Forever Optimizing Optimal \u03bb-Calculus Implementations.\" <em>Applicable Algebra in Engineering, Communication and Computing</em> 8.6 (1997): 437-468.</p>\n</blockquote></li>\n<li><p>Finally, the read-back procedure must be intended not as some sort of external cost for your reduction precedure, but rather as a deferred cost of computing duplication and erasure.\nAs you notice, such a cost is rarely negligible, so if you want to test efficiency in a real-world scenario, always sum up both sharing reduction and read-back reduction.</p></li>\n</ul>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 390, "favorite_count": 3, "accepted_answer_id": 31606462, "answer_count": 1, "score": 14, "last_activity_date": 1445444506, "creation_date": 1437693682, "last_edit_date": 1437694709, "question_id": 31599684, "link": "https://stackoverflow.com/questions/31599684/is-it-usual-for-interaction-nets-to-leave-piles-of-redundant-fans", "title": "Is it usual for interaction nets to leave piles of redundant fans?", "body": "<p>I'm compiling lambda calculus terms to interaction nets in order to evaluate them using Lamping's abstract algorithm. In order to test my implementation, I used this church-number division function:</p>\n\n<pre><code>div = (\u03bb a b c d . (b (\u03bb e . (e d)) (a (b (\u03bb e f g . (e (\u03bb h . (f h g)))) (\u03bb e . e) (\u03bb e f . (f (c e)))) (b (\u03bb e f . e) (\u03bb e . e) (\u03bb e . e)))))\n</code></pre>\n\n<p>Dividing 4 by 4 (that is, <code>(\u03bb k . (div k k)) (\u03bb f x . (f (f (f (f x)))))</code>), I get this net:</p>\n\n<p><a href=\"https://i.stack.imgur.com/SmPim.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/SmPim.png\" alt=\"enter image description here\"></a></p>\n\n<p>(Sorry for the awful rendering. <code>\u03bb</code> is a lambda, <code>R</code> is root, <code>D</code> is a fan, <code>e</code> is eraser.) </p>\n\n<p>Reading this term back, I get the church number 1, as expected. But this net is very inflated: it has a lot of fans and erasers that serve no obvious purpose. Dividing bigger numbers is even worse. Here is <code>div 32 32</code>:</p>\n\n<p><a href=\"https://i.stack.imgur.com/khhb8.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/khhb8.png\" alt=\"enter image description here\"></a></p>\n\n<p>This again reads back as <code>one</code>, but here we can see an even longer tail of redundant fan nodes. My question is: <strong>is this an expected behavior of interaction needs when reducing that particular term or is this a possible bug on my implementation</strong>? If this isn't a bug, is there any way around that?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 9, "creation_date": 1437688370, "post_id": 31598652, "comment_id": 51149089, "body": "A simpler definition of <code>fromEither</code> is <code>fromEither = either id id</code>."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1437705612, "post_id": 31598652, "comment_id": 51153887, "body": "This is probably too picky to even be worth mentioning, but this is not quite equivalent to the original version (imagine one or both of <code>x</code> and <code>y</code> is <code>_|_</code> and <code>compare</code> is lazy in the corresponding argument)."}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1437730668, "post_id": 31598652, "comment_id": 51164288, "body": "@ReidBarton The original version was also strict in both arguments."}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1437733614, "post_id": 31598652, "comment_id": 51166097, "body": "A simpler definition of <code>compare (fromEither x) (fromEither y)</code> is <code>(on compare fromEither) x y</code>, where <code>on</code> is imported from <code>Data.Function</code>"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1437746545, "post_id": 31598652, "comment_id": 51174689, "body": "@JeremyList, the original was strict but this new version is not necessarily strict."}], "tags": [], "owner": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "is_accepted": true, "score": 5, "last_activity_date": 1437688158, "creation_date": 1437688158, "answer_id": 31598652, "question_id": 31598608, "link": "https://stackoverflow.com/questions/31598608/compare-contents-of-either-type/31598652#31598652", "title": "compare contents of Either type", "body": "<p>You can't do that with pattern matching, but you can still simplify your code by using a helper function:</p>\n\n<pre><code>eitherCompare x y = compare (fromEither x) (fromEither y)\n where fromEither (Left a) = a\n       fromEither (Right a) = a\n</code></pre>\n"}], "owner": {"reputation": 26022, "user_id": 410102, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/a70b7da5a3a712e800100e61ef8d8917?s=128&d=identicon&r=PG", "display_name": "akonsu", "link": "https://stackoverflow.com/users/410102/akonsu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 31598652, "answer_count": 1, "score": 2, "last_activity_date": 1437688158, "creation_date": 1437687988, "question_id": 31598608, "link": "https://stackoverflow.com/questions/31598608/compare-contents-of-either-type", "title": "compare contents of Either type", "body": "<p>is there a way to use pattern wildcards for type constructors to make this ugly code shorter:</p>\n\n<pre><code>eitherCompare (Left  a) (Left  b) = compare a b\neitherCompare (Left  a) (Right b) = compare a b\neitherCompare (Right a) (Left  b) = compare a b\neitherCompare (Right a) (Right b) = compare a b\n</code></pre>\n\n<p>something like (which won't compile)</p>\n\n<pre><code>eitherCompare :: Ord a =&gt; Either a a -&gt; Either a a -&gt; Ordering\neitherCompare (_  a) (_  b) = compare a b\n</code></pre>\n\n<p>or some other method?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1437687754, "post_id": 31598479, "comment_id": 51148830, "body": "A class is not a type (at least not in the sense you are probably expecting). But also if you wanted to find out about a type, you&#39;d use <code>:k</code> or <code>:i</code>. <code>:t</code> tells you the type of a value."}], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1437688273, "post_id": 31598555, "comment_id": 51149047, "body": "@DanielWagner I think the point here was that because <code>:t</code> expects an expression, ghci has to interpret <code>Ord</code> as a data constructor: the only valid upper-case identifier to write after <code>:t</code> is a data constructor. So while I think it was poorly worded it&#39;s not totally out of place at the end of that sentence."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1437688634, "post_id": 31598555, "comment_id": 51149206, "body": "@DanielWagner good point, let me tweak my answer to shift the focus a bit."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 1, "last_activity_date": 1437688747, "last_edit_date": 1437688747, "creation_date": 1437687766, "answer_id": 31598555, "question_id": 31598479, "link": "https://stackoverflow.com/questions/31598479/what-is-ord-type/31598555#31598555", "title": "What is Ord type?", "body": "<p>Not quite. You can impose type constraints, so <code>Ord a =&gt; a</code> is a type, but <code>Ord a</code> isn't. <code>Ord a =&gt; a</code> means \"any type <code>a</code> with the constraint that it is an instance of <code>Ord</code>\".</p>\n\n<p>The error is because <code>:t</code> expects an expression. When GHCi tries to interpret <code>Ord</code> as an expression, the closest it can get to is a data constructor, since these are the only functions in Haskell that can start with capital letters.</p>\n"}, {"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 3, "last_activity_date": 1437694352, "last_edit_date": 1437694352, "creation_date": 1437687783, "answer_id": 31598557, "question_id": 31598479, "link": "https://stackoverflow.com/questions/31598479/what-is-ord-type/31598557#31598557", "title": "What is Ord type?", "body": "<p><code>Ord</code> is not a type, but a <a href=\"http://learnyouahaskell.com/types-and-typeclasses#typeclasses-101\" rel=\"nofollow\">typeclass</a>.  It does not have a type, but a <em>kind</em>:</p>\n\n<pre><code>Prelude&gt; :k Ord\nOrd :: * -&gt; Constraint\n</code></pre>\n\n<p>Typeclasses are one of the wonderful things about Haskell.  Check 'em out :-)</p>\n"}, {"tags": [], "owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "is_accepted": false, "score": 8, "last_activity_date": 1437688108, "creation_date": 1437688108, "answer_id": 31598640, "question_id": 31598479, "link": "https://stackoverflow.com/questions/31598479/what-is-ord-type/31598640#31598640", "title": "What is Ord type?", "body": "<p><code>Ord</code> isn't a type; it's a typeclass. Typeclasses allow you to associate supported operations with a given type (somewhat similar to interfaces in Java or protocols in Objective-C). A type (e.g. <code>Int</code>) being an \"instance\" of a typeclass (e.g. <code>Ord</code>) means that the type supports the functions of the <code>Ord</code> typeclass (e.g. <code>compare</code>, <code>&lt;</code>, <code>&gt;</code> etc.).</p>\n\n<p>You can get most info about a typeclass using <code>:i</code> in ghci, which shows you the functions associated with the typeclass and which types are instances of it:</p>\n\n<pre><code>ghci &gt; :i Ord\nclass Eq a =&gt; Ord a where\n  compare :: a -&gt; a -&gt; Ordering\n  (&lt;) :: a -&gt; a -&gt; Bool\n  (&gt;=) :: a -&gt; a -&gt; Bool\n  (&gt;) :: a -&gt; a -&gt; Bool\n  (&lt;=) :: a -&gt; a -&gt; Bool\n  max :: a -&gt; a -&gt; a\n  min :: a -&gt; a -&gt; a\n    -- Defined in \u2018GHC.Classes\u2019\ninstance Ord a =&gt; Ord (Maybe a) -- Defined in \u2018Data.Maybe\u2019\ninstance (Ord a, Ord b) =&gt; Ord (Either a b)\n  -- Defined in \u2018Data.Either\u2019\ninstance Ord Integer -- Defined in \u2018integer-gmp:GHC.Integer.Type\u2019\ninstance Ord a =&gt; Ord [a] -- Defined in \u2018GHC.Classes\u2019\n...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1438019878, "post_id": 31599234, "comment_id": 51264676, "body": "I wish we didn&#39;t use the word &quot;type&quot; in mutually contradictory ways such that &quot;Maybe is not a type&quot; and &quot;Maybe is a higher-kinded type&quot; can both be true statements."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1438037216, "post_id": 31599234, "comment_id": 51273636, "body": "Yes, we really need a less clunky term than &quot;type-level thing&quot; for &quot;the things we can use in type expressions, whether or not they could be the types of values&quot;. Otherwise shorthand is inevitable. The context-dependency of the word &quot;type&quot; seems to work out fine for experts, but it makes it very difficult to pick this stuff up organically."}], "tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": true, "score": 12, "last_activity_date": 1437691562, "last_edit_date": 1437691562, "creation_date": 1437691021, "answer_id": 31599234, "question_id": 31598479, "link": "https://stackoverflow.com/questions/31598479/what-is-ord-type/31599234#31599234", "title": "What is Ord type?", "body": "<p>Okay, there's a couple of things going on here.</p>\n\n<p>First when you write <code>:t Ord</code> you're looking for something called <code>Ord</code> in the <strong>value</strong> namespace; specifically it would have to be a constructor, since the name starts with a capital letter.</p>\n\n<p>Haskell keeps types and values completely separate; there is no relationship between the name of a type and the names of a type's constructors. Often when there's only one constructor, people will use the same name as the type. An example being <code>data Foo = Foo Int</code>. This declares <em>two</em> new named entities: the type <code>Foo</code> and the constructor <code>Foo :: Int -&gt; Foo</code>.</p>\n\n<p>It's not really a good idea to think of it as just making a type <code>Foo</code> that can be used both in type expressions and to construct <code>Foo</code>s. Because also common are declarations like <code>data Maybe a = Nothing | Just a</code>. Here there are 2 different constructors for <code>Maybe a</code>, and <code>Maybe</code> isn't a name of anything at all at the value level.</p>\n\n<p>So just because you've seen <code>Ord</code> in a type expression doesn't mean that there is a name <code>Ord</code> at the value level for you to ask the type of with <code>:t</code>. Even if there were, it wouldn't necessarily be related top the type-level name <code>Ord</code>.</p>\n\n<p>The second point that needs clarifying is that no, classes are not in fact types. A class is a <em>set</em> of types (which all support the interface defined in the class), but it is not a type itself.</p>\n\n<p>In vanilla Haskell type classes are just \"extra\" things. You can declare them with a <code>class</code> declaration, instantiate them with an <code>instance</code> declaration, and use them in special syntax attached to types (the stuff left of the <code>=&gt;</code> arrow) as constraints on type variables. But they don't really interact with the rest of the language, and you cannot use them in the main part of a type signature (the stuff right of the `=> arrow).</p>\n\n<p>However, with the <code>ConstraintKinds</code> extension on, type classes <em>do</em> become ordinary things that exist in the type namespace, just like <code>Maybe</code>. They are still not types in the sense that there can never be any values that have them as types, so you can't use <code>Ord</code> or <code>Ord Int</code> as an argument or return type in a function, or have a <code>[Ord a]</code> or anything like that.</p>\n\n<p>In that they are a bit like type constructors like <code>Maybe</code>. <code>Maybe</code> is a name bound in the type namespace, but it is not a <em>type</em> as such; there are no values whose type is just <code>Maybe</code>, but <code>Maybe</code> can be used as <em>part</em> of an expression defining a type, as in <code>Maybe Int</code>.</p>\n\n<p>If you're not familiar with <em>kinds</em>, probably ignore everything I've said from <code>ConstraintKinds</code> onwards; you'll probably learn about kinds eventually, but they're not a feature you need to know much about as a beginner. If you are, however, what <code>ConstraintKinds</code> does is make a special kind <code>Constraint</code> and have type class constraints (left of the <code>=&gt;</code> arrow) just be ordinary type-level things of kind <code>Constraint</code> instead of special purpose syntax. This means that <code>Ord</code> is a type-level thing, and we can ask it's kind with the <code>:k</code> command in GHCI:</p>\n\n<pre><code>Prelude&gt; :k Ord\n* -&gt; Constraint\n</code></pre>\n\n<p>Which makes sense; <code>max</code> had type <code>Ord a =&gt; a -&gt; a -&gt; a</code>, so <code>Ord a</code> must have kind <code>Constraint</code>. If <code>Ord</code> can be applied to an ordinary type to yield a constraint, it must have kind <code>* -&gt; Constraint</code>.</p>\n"}], "owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10406, "favorite_count": 0, "accepted_answer_id": 31599234, "answer_count": 4, "score": 8, "last_activity_date": 1437694352, "creation_date": 1437687461, "question_id": 31598479, "link": "https://stackoverflow.com/questions/31598479/what-is-ord-type", "title": "What is Ord type?", "body": "<p>Is every class not a type in Haskell : </p>\n\n<pre><code>Prelude&gt; :t max\nmax :: Ord a =&gt; a -&gt; a -&gt; a\nPrelude&gt; :t Ord\n\n&lt;interactive&gt;:1:1: Not in scope: data constructor \u2018Ord\u2019\nPrelude&gt; \n</code></pre>\n\n<p>Why does this not print <code>Ord</code> type signature ?</p>\n"}, {"tags": ["haskell", "vector", "data-structures", "amortized-analysis"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1437687289, "post_id": 31598273, "comment_id": 51148624, "body": "Maybe check out <code>Data.Sequence</code>? It has <code>O(1)</code> amortized for most things. What exactly do you need other than <code>push_back</code>?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1437687478, "post_id": 31598273, "comment_id": 51148708, "body": "Also, why can&#39;t you define your own <code>push_back</code> by growing the array to double its size every time it overflows?"}, {"owner": {"reputation": 713, "user_id": 3161163, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4d6be8a60e7af00bff064b8f84bcc261?s=128&d=identicon&r=PG&f=1", "display_name": "Aleksandr Pakhomov", "link": "https://stackoverflow.com/users/3161163/aleksandr-pakhomov"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1437687630, "post_id": 31598273, "comment_id": 51148777, "body": "It&#39;s good, but I use unboxed vectors for performance reasons. I need contiguous storage. Also I want random access for binary search."}, {"owner": {"reputation": 713, "user_id": 3161163, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4d6be8a60e7af00bff064b8f84bcc261?s=128&d=identicon&r=PG&f=1", "display_name": "Aleksandr Pakhomov", "link": "https://stackoverflow.com/users/3161163/aleksandr-pakhomov"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1437687740, "post_id": 31598273, "comment_id": 51148822, "body": "Alec, I can create a wrapper around Vector that grows exponentially, but I would be surprised if there is no second-useful Vector operation in Haskell."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 3, "creation_date": 1437692649, "post_id": 31598273, "comment_id": 51150562, "body": "<code>vector</code> operations are subject to fusion and won&#39;t perform the way you assume coming from c++ in any case. You should benchmark"}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1437717370, "post_id": 31598273, "comment_id": 51157016, "body": "std::vector::push_back is <code>O(n)</code> in general, it&#39;s only <code>O(1)</code> if it doesn&#39;t exceed the memory allocation size."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 6, "creation_date": 1437724791, "post_id": 31598273, "comment_id": 51160749, "body": "@JeremyList Yes, but calling push_back <code>n</code> times is also <code>O(n)</code>, and not <code>O(n^2)</code>, due to exponential growing. Hence the <i>amortized</i> complexity of one push_back is <code>O(1)</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1479580131, "post_id": 31598273, "comment_id": 68622240, "body": "You can only get amortized constant-time array doubling in a single-threaded context (e.g., with a <i>mutable</i> Haskell vector in <code>ST</code> or <code>IO</code>). In a persistent (pure) setting, I can make a vector one smaller than the threshold and add an element to that over and over, incurring the linear cost without having paid for it. See Okasaki&#39;s thesis or book to see how to deal with amortization in a persistent setting."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 13, "last_activity_date": 1479752967, "last_edit_date": 1495542715, "creation_date": 1479591816, "answer_id": 40698249, "question_id": 31598273, "link": "https://stackoverflow.com/questions/31598273/haskell-vector-c-push-back-analogue/40698249#40698249", "title": "Haskell vector C++ push_back analogue", "body": "<p>No there really is no such facility in <code>Data.Vector</code>. It isn't too difficult to implement this from scratch using <a href=\"https://hackage.haskell.org/package/primitive-0.6/docs/Data-Primitive-Array.html#t:MutableArray\" rel=\"nofollow noreferrer\"><code>MutableArray</code></a> like <code>Data.Vector.Mutable</code> does (see my implementation below), but there are some significant drawbacks. In particular, all of its operations end up happening inside some state context usually <code>ST</code> or <code>IO</code>. This has the downsides that</p>\n\n<ol>\n<li>Any code that manipulates such a data structure ends up having to be monadic</li>\n<li>The compiler is much less likely to be able to optimize. For example, libraries like <code>vector</code> use something really clever called <a href=\"https://stackoverflow.com/questions/38905369/what-is-fusion-in-haskell/38910170#38910170\">fusion</a> to optimize away intermediate allocations. This sort of thing is not possible in a state context.</li>\n<li>Parallelism is going to be a lot tougher: in <code>ST</code> I can't even have two threads and in <code>IO</code> I will have race conditions all over the place. The nasty bit here is that any sharing is going to have to happen in <code>IO</code>.</li>\n</ol>\n\n<p>As if all this wasn't enough, garbage collection also performs better inside pure code.</p>\n\n<h3>What do I do then?</h3>\n\n<p>It isn't particularly often that you have a need for <em>exactly</em> this behaviour - usually you are better off using an immutable data structure (thereby avoiding all of the aforementioned problems) which does something similar. Just limiting ourselves to <a href=\"https://hackage.haskell.org/package/containers-0.5.8.1\" rel=\"nofollow noreferrer\"><code>containers</code></a> which comes with GHC, some alternatives include:</p>\n\n<ul>\n<li>if you are almost always just using <code>push_back</code>, maybe you just want a stack (a plain old <code>[a]</code>).</li>\n<li>if you anticipate doing more <code>push_back</code> than lookups, <a href=\"https://hackage.haskell.org/package/containers-0.5.8.1/docs/Data-Sequence.html\" rel=\"nofollow noreferrer\"><code>Data.Sequence</code></a> gives you <code>O(1)</code> appending to either end and <code>O(log n)</code> lookup.</li>\n<li>if you are interested in a lot of operations especially hashmap-like, <a href=\"https://hackage.haskell.org/package/containers-0.5.8.1/docs/Data-IntMap.html\" rel=\"nofollow noreferrer\"><code>Data.IntMap</code></a> is pretty optimized. Even if the theoretical cost of those operations is <code>O(log n)</code>, you will need a pretty big <code>IntMap</code> to start feeling those costs.    </li>\n</ul>\n\n<h3>Making something like C++ <code>vector</code></h3>\n\n<p>Of course, if one doesn't care about the restrictions mentioned initially, there is no reason not to have a C++ like vector. Just for fun, I went ahead and implemented this from scratch (needs packages <code>data-default</code> and <code>primitive</code>).</p>\n\n<p>The reason this code is probably not already in some library is that it goes against much of the spirit of Haskell (I do this with the intent of conforming to a C++ style vector).</p>\n\n<ul>\n<li>The only operation that actually makes a new vector is <code>newVector</code> - everything else \"modifies\" an existing vector. Since <code>pushBack</code> doesn't return a new <code>GrowVector</code>, it has to modify the existing one (including its length and/or capacity), so <code>length</code> and <code>capacity</code> have to be \"pointers\". In turn, that means that even getting the <code>length</code> is a monadic operation.</li>\n<li>While this isn't unboxed, it would not be too difficult to replicate <code>vector</code>s <a href=\"https://hackage.haskell.org/package/vector-0.11.0.0/docs/Data-Vector-Unboxed-Mutable.html\" rel=\"nofollow noreferrer\"><code>data family</code> approach</a> - it is just tedious<sup>1</sup>.</li>\n</ul>\n\n<p>With that said:</p>\n\n<pre><code>module GrowVector (\n  GrowVector, newEmpty, size, read, write, pushBack, popBack\n) where \n\nimport Data.Primitive.Array\nimport Data.Primitive.MutVar\nimport Data.Default\nimport Control.Monad\nimport Control.Monad.Primitive (PrimState, PrimMonad)\nimport Prelude hiding (length, read)\n\ndata GrowVector s a = GrowVector\n  { underlying :: MutVar s (MutableArray s a) -- ^ underlying array\n  , length :: MutVar s Int                    -- ^ perceived length of vector\n  , capacity :: MutVar s Int                  -- ^ actual capacity\n  }\n\ntype GrowVectorIO = GrowVector (PrimState IO)\n\n-- | Make a new empty vector with the given capacity. O(n)\nnewEmpty :: (Default a, PrimMonad m) =&gt; Int -&gt; m (GrowVector (PrimState m) a)\nnewEmpty cap = do\n  arr &lt;- newArray cap def\n  GrowVector &lt;$&gt; newMutVar arr &lt;*&gt; newMutVar 0 &lt;*&gt; newMutVar cap\n\n-- | Read an element in the vector (unchecked). O(1)\nread :: PrimMonad m =&gt; GrowVector (PrimState m) a -&gt; Int -&gt; m a\ng `read` i = do arr &lt;- readMutVar (underlying g); arr `readArray` i\n\n-- | Find the size of the vector. O(1)\nsize :: PrimMonad m =&gt; GrowVector (PrimState m) a -&gt; m Int\nsize g = readMutVar (length g)\n\n-- | Double the vector capacity. O(n)\nresize :: (Default a, PrimMonad m) =&gt; GrowVector (PrimState m) a -&gt; m ()\nresize g = do\n  curCap &lt;- readMutVar (capacity g)         -- read current capacity\n  curArr &lt;- readMutVar (underlying g)       -- read current array\n  curLen &lt;- readMutVar (length g)           -- read current length\n  newArr &lt;- newArray (2 * curCap) def       -- allocate a new array twice as big\n  copyMutableArray newArr 1 curArr 1 curLen -- copy the old array over\n  underlying g `writeMutVar` newArr         -- use the new array in the vector\n  capacity g `modifyMutVar'` (*2)           -- update the capacity in the vector\n\n-- | Write an element to the array (unchecked). O(1)\nwrite :: PrimMonad m =&gt; GrowVector (PrimState m) a -&gt; Int -&gt; a  -&gt; m ()\nwrite g i x = do arr &lt;- readMutVar (underlying g); writeArray arr i x\n\n-- | Pop an element of the vector, mutating it (unchecked). O(1)\npopBack :: PrimMonad m =&gt; GrowVector (PrimState m) a -&gt; m a\npopBack g = do\n  s &lt;- size g;\n  x &lt;- g `read` (s - 1)\n  length g `modifyMutVar'` (+ negate 1)\n  pure x\n\n-- | Push an element. (Amortized) O(1)\npushBack :: (Default a, PrimMonad m) =&gt; GrowVector (PrimState m) a -&gt; a -&gt; m ()\npushBack g x = do\n  s &lt;- readMutVar (length g)                -- read current size\n  c &lt;- readMutVar (capacity g)              -- read current capacity\n  when (s+1 == c) (resize g)                -- if need be, resize\n  write g (s+1) x                           -- write to the back of the array\n  length g `modifyMutVar'` (+1)             -- increase te length\n</code></pre>\n\n<h3>Current semantics of <code>grow</code></h3>\n\n<p>I think the <a href=\"https://github.com/haskell/vector/issues/36\" rel=\"nofollow noreferrer\">github issue</a> does a pretty good job of explaining the semantics:</p>\n\n<blockquote>\n  <p>I think the intended semantics are that it may do a realloc, but not guaranteed to, and all the current implementations do the simpler copying semantics because for on heap allocations the cost should be roughly the same.</p>\n</blockquote>\n\n<p>Basically you should use <code>grow</code> when you want a new mutable vector of an increased size, starting with the elements of the old vector (and no longer care about the old vector). This is quite useful - for example one could implement <code>GrowVector</code> using <code>MVector</code> and <code>grow</code>.</p>\n\n<hr>\n\n<p><sup>1</sup> the approach is that for every new type of unboxed vector you want to have, you make a <code>data instance</code> that \"expands\" your type into a fixed number of unboxed arrays (or other unboxed vectors). This is the point of <code>data family</code> - to allow different instantiations of a type to have totally different runtime representations, and to also be extensible (you can add your own <code>data instance</code> if you want).</p>\n"}], "owner": {"reputation": 713, "user_id": 3161163, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4d6be8a60e7af00bff064b8f84bcc261?s=128&d=identicon&r=PG&f=1", "display_name": "Aleksandr Pakhomov", "link": "https://stackoverflow.com/users/3161163/aleksandr-pakhomov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 697, "favorite_count": 2, "answer_count": 1, "score": 15, "last_activity_date": 1479934758, "creation_date": 1437686656, "last_edit_date": 1479934758, "question_id": 31598273, "link": "https://stackoverflow.com/questions/31598273/haskell-vector-c-push-back-analogue", "title": "Haskell vector C++ push_back analogue", "body": "<p>I've discovered that Haskell <code>Data.Vector.*</code> miss C++ <code>std::vector::push_back</code>'s functionality. There is <code>grow</code>/<code>unsafeGrow</code>, but they seem to have <em>O(n)</em> complexity.</p>\n\n<p>Is there a way to grow vectors in <em>O(1)</em> amortized time for an element?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 14, "last_activity_date": 1440128322, "last_edit_date": 1440128322, "creation_date": 1437674642, "answer_id": 31594923, "question_id": 31593438, "link": "https://stackoverflow.com/questions/31593438/how-can-packages-be-unhidden-when-using-only-stack/31594923#31594923", "title": "How can packages be unhidden when using only stack?", "body": "<p>Edit the .cabal file <code>stack new</code> created and add <code>mtl</code> to the <code>build-depends</code> section. That part of the file should look like this:</p>\n\n<pre><code>build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5\n                   , mtl\n</code></pre>\n\n<p>Then, do a <code>stack build</code> before <code>stack ghci</code>.</p>\n\n<p>By the way, do not use <code>stack install</code> to install libraries - it is merely a shortcut to copy binaries. E.g. <code>stack install hlint</code> will first build the package and then copy the resulting binary to <em>~/.local/bin/</em>. Instead, always add the packages to the .cabal file, as shown above, and use <code>stack build</code> so that they get installed.</p>\n"}, {"tags": [], "owner": {"reputation": 5668, "user_id": 712526, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/06e3c4065e9d08da698b4f4de3959294?s=128&d=identicon&r=PG", "display_name": "jpaugh", "link": "https://stackoverflow.com/users/712526/jpaugh"}, "is_accepted": false, "score": 1, "last_activity_date": 1562831815, "creation_date": 1562831815, "answer_id": 56984265, "question_id": 31593438, "link": "https://stackoverflow.com/questions/31593438/how-can-packages-be-unhidden-when-using-only-stack/56984265#56984265", "title": "How can packages be unhidden when using only stack?", "body": "<p>Since you're working in GHCi, you can just change the command line passed to the underlying GHC. For example, I did this recently:</p>\n\n<pre><code>Prelude&gt; import qualified GI.Gtk as Gtk\n\n&lt;no location info&gt;: error:\n    Could not load module \u2018GI.Gtk\u2019\n    It is a member of the hidden package \u2018gi-gtk-3.0.31\u2019.\n    Perhaps you need to add \u2018gi-gtk\u2019 to the build-depends in your .cabal file.\n    It is a member of the hidden package \u2018gi-gtk-3.0.27\u2019.\n    Perhaps you need to add \u2018gi-gtk\u2019 to the build-depends in your .cabal file.\nPrelude&gt; :set -package gi-gtk-3.0.27\npackage flags have changed, resetting and loading new packages...\nPrelude&gt; import qualified GI.Gtk as Gtk\nPrelude Gtk&gt; \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 43, "user_id": 13954598, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d38d41166289ebe852fbd50193d8d075?s=128&d=identicon&r=PG&f=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/13954598/dan"}, "is_accepted": false, "score": 0, "last_activity_date": 1618330769, "creation_date": 1618330769, "answer_id": 67078723, "question_id": 31593438, "link": "https://stackoverflow.com/questions/31593438/how-can-packages-be-unhidden-when-using-only-stack/67078723#67078723", "title": "How can packages be unhidden when using only stack?", "body": "<p>Just to complement @Jazmit answer. Be aware that your <code>.cabal</code> file will have two <code>build-depends</code> sections. One under <code>library:</code>\nand the other under <code>executable my-project-exec</code>. In this case, you'd need to put the module under the <code>executable</code> section.</p>\n<p>Example:</p>\n<p>my-project.cabal</p>\n<pre><code>library: \n  build-depends:\n  ...\n\nexecutable my-project-exe:\n  build-depends:\n    base &gt;= 4.7 &amp;&amp; &lt; 5\n    , mtl\n</code></pre>\n<p>For further info about library and executable check the docs:\n<a href=\"https://cabal.readthedocs.io/en/latest/developing-packages.html#editing-the-cabal-file\" rel=\"nofollow noreferrer\">https://cabal.readthedocs.io/en/latest/developing-packages.html#editing-the-cabal-file</a></p>\n"}], "owner": {"reputation": 4426, "user_id": 469981, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b116107a07635c7b2015d3ffd8ddbe3a?s=128&d=identicon&r=PG", "display_name": "jazmit", "link": "https://stackoverflow.com/users/469981/jazmit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5137, "favorite_count": 0, "answer_count": 3, "score": 11, "last_activity_date": 1618330769, "creation_date": 1437669997, "question_id": 31593438, "link": "https://stackoverflow.com/questions/31593438/how-can-packages-be-unhidden-when-using-only-stack", "title": "How can packages be unhidden when using only stack?", "body": "<p>I'd like to try out the <code>Writer</code> monad in ghci.  As advised <a href=\"https://www.stackage.org/install\" rel=\"noreferrer\">here</a>, I tried to use only stack to manage GHC and packages, and avoid a global installation.</p>\n\n<p>From a fresh Ubuntu 15.04 install, after installing stack:</p>\n\n<pre><code>stack setup\nmkdir lyah &amp;&amp; cd lyah\nstack new\nstack install mtl\nstack ghci\nghci&gt; import Control.Monad.Writer\nCould not find module \u2018Control.Monad.Writer\u2019\nIt is a member of the hidden package \u2018mtl-2.1.3.1\u2019.\n</code></pre>\n\n<p>I understand that pre-stack ghc-pkg was used to show/hide packages, but I'm not sure how to proceed here to 'unhide' the mtl package.</p>\n"}, {"tags": ["haskell", "if-statement", "logic", "conditional-statements"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1437672807, "post_id": 31593351, "comment_id": 51140444, "body": "These are commonly referred to as &quot;logical connectives&quot; (in logic/maths) or &quot;boolean operators&quot; (in programming). Other names also are used, see e.g. <a href=\"https://en.wikipedia.org/wiki/Logical_connective\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Logical_connective</a>"}], "answers": [{"comments": [{"owner": {"reputation": 606, "user_id": 3497258, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/35f880339f03352b8e66231498e25779?s=128&d=identicon&r=PG&f=1", "display_name": "eXistanCe", "link": "https://stackoverflow.com/users/3497258/existance"}, "edited": false, "score": 0, "creation_date": 1437670295, "post_id": 31593396, "comment_id": 51138916, "body": "So the  &amp;&amp; || work in Haskell the same way they work in Java? And i can use the where keyword without using guards?"}, {"owner": {"reputation": 606, "user_id": 3497258, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/35f880339f03352b8e66231498e25779?s=128&d=identicon&r=PG&f=1", "display_name": "eXistanCe", "link": "https://stackoverflow.com/users/3497258/existance"}, "edited": false, "score": 0, "creation_date": 1437670375, "post_id": 31593396, "comment_id": 51138968, "body": "Thank you very much then."}], "tags": [], "owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "is_accepted": true, "score": 7, "last_activity_date": 1437669864, "creation_date": 1437669864, "answer_id": 31593396, "question_id": 31593351, "link": "https://stackoverflow.com/questions/31593351/haskell-multiple-conditions-of-if/31593396#31593396", "title": "Haskell multiple conditions of If", "body": "<p>It can be done in multiple ways.</p>\n\n<p>For example, using <code>&amp;&amp;</code>:</p>\n\n<pre><code>sum' :: Int -&gt; Int -&gt; Int -&gt; Int\nsum' x y z = if x &gt;= 0 &amp;&amp; y &gt;= 0 &amp;&amp; z &gt;= 0 then x+y+z else 0\n</code></pre>\n\n<p>Or using <code>all</code> and a list:</p>\n\n<pre><code>sum' :: Int -&gt; Int -&gt; Int -&gt; Int\nsum' x y z = if all (&gt;= 0) xs then sum xs else 0\n    where xs = [x, y, z]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 785, "user_id": 3087558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a43d21bfa85dc7dc360cafa7f69ba3b1?s=128&d=identicon&r=PG&f=1", "display_name": "fgv", "link": "https://stackoverflow.com/users/3087558/fgv"}, "is_accepted": false, "score": 3, "last_activity_date": 1437671185, "creation_date": 1437671185, "answer_id": 31593850, "question_id": 31593351, "link": "https://stackoverflow.com/questions/31593351/haskell-multiple-conditions-of-if/31593850#31593850", "title": "Haskell multiple conditions of If", "body": "<p>Or using guards, which would make it look almost exactly like the human version of the definition:</p>\n\n<pre><code>sum' :: Int -&gt; Int -&gt; Int -&gt; Int\nsum' x y z \n    | x &gt;= 0 &amp;&amp; y &gt;= 0 &amp;&amp; z &gt;= 0 = x+y+z\n    | otherwise = 0\n</code></pre>\n\n<p>On a side note, always remember that types start with a capital letter. In your case, your type signature should use \"Int\" instead of \"int\".</p>\n\n<p>I hope this helps.</p>\n"}], "owner": {"reputation": 606, "user_id": 3497258, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/35f880339f03352b8e66231498e25779?s=128&d=identicon&r=PG&f=1", "display_name": "eXistanCe", "link": "https://stackoverflow.com/users/3497258/existance"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8546, "favorite_count": 0, "accepted_answer_id": 31593396, "answer_count": 2, "score": 2, "last_activity_date": 1519393833, "creation_date": 1437669739, "last_edit_date": 1519393833, "question_id": 31593351, "link": "https://stackoverflow.com/questions/31593351/haskell-multiple-conditions-of-if", "title": "Haskell multiple conditions of If", "body": "<p>I am having problems with the following exercise:</p>\n\n<p>Write a function that receives three Ints and sums them if they are all positive and returns 0 (zero) otherwise.</p>\n\n<p>What I have done is the following:</p>\n\n<pre><code>sum' :: int -&gt; int -&gt; int -&gt; int\nsum' x y z = if x &gt;= 0, y &gt;= 0, z &gt;= 0 then x+y+z else 0\n</code></pre>\n\n<p>I don't know how to make multiple conditions on an if, not sure if this is done with logical \"connectors\" (like <code>||</code> or <code>&amp;&amp;</code> in Java) or if it is done in a similar way to the code I wrote.</p>\n"}, {"tags": ["haskell", "package", "cabal"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1437663380, "post_id": 31590866, "comment_id": 51133874, "body": "I usually go to hackage and read the documentation for each package there.  For example, if you <code>cabal install lens</code>, then just visit <a href=\"http://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/lens</a> to see the documentation for the latest version, and you can always switch the version back to whichever you installed."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1437663578, "post_id": 31590866, "comment_id": 51134058, "body": "@bheklilr Oops, didn&#39;t see your comment before posting."}], "answers": [{"comments": [{"owner": {"reputation": 501, "user_id": 4681998, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6e983411d6b657a245740031a55ed4b3?s=128&d=identicon&r=PG", "display_name": "preferred_anon", "link": "https://stackoverflow.com/users/4681998/preferred-anon"}, "edited": false, "score": 0, "creation_date": 1437667995, "post_id": 31591072, "comment_id": 51137453, "body": "The example bheklilr gave in the comments looked like a very helpful set of documentation. I&#39;ve been trying to use <a href=\"http://hackage.haskell.org/package/gloss\" rel=\"nofollow noreferrer\">gloss</a>, and there is almost no description and no links to the modules - is this just an issue of bad luck, or am I missing something?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 501, "user_id": 4681998, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6e983411d6b657a245740031a55ed4b3?s=128&d=identicon&r=PG", "display_name": "preferred_anon", "link": "https://stackoverflow.com/users/4681998/preferred-anon"}, "edited": false, "score": 0, "creation_date": 1437668456, "post_id": 31591072, "comment_id": 51137757, "body": "@DanielLittlewood Bad luck, aka a broken documentation build. <a href=\"http://hackage.haskell.org/package/gloss-1.9.2.1\" rel=\"nofollow noreferrer\">this slightly older version works</a>. I&#39;ll edit my answer a bit."}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 6, "last_activity_date": 1437668953, "last_edit_date": 1437668953, "creation_date": 1437663466, "answer_id": 31591072, "question_id": 31590866, "link": "https://stackoverflow.com/questions/31590866/learning-from-haskell-packages/31591072#31591072", "title": "Learning from Haskell Packages", "body": "<p>I usually look up the documentation for Hackage packages online, at <code>https://hackage.haskell.org/package/nameOfPackage</code>. It has (unless broken, which alas happens) links to documentation for each module, as well as links to the source code inside that.</p>\n\n<p>EDIT on broken docs:</p>\n\n<p>Unfortunately Hackage's doc building system sometimes fails for whatever reason, usually resulting in the list of modules being just plain text with no links. In that case, a good idea is to check out the list of links to older package versions: often one of them works.</p>\n\n<p>There's also the problem that some libraries aren't very well documented at all, in which case all you get is type declarations, type signatures and links to the source. (But check out if there are links to <em>other</em> docs on the package frontpage.)</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1437691983, "creation_date": 1437691983, "answer_id": 31599396, "question_id": 31590866, "link": "https://stackoverflow.com/questions/31590866/learning-from-haskell-packages/31599396#31599396", "title": "Learning from Haskell Packages", "body": "<blockquote>\n  <p>see any documentation</p>\n</blockquote>\n\n<p>The <code>cabal haddock</code> command will build documentation for you and place it in <code>dist/doc</code>. If you use <code>--enable-documentation</code> (or set <code>documentation: True</code> in <code>~/.cabal/config</code>), <code>cabal install</code> will also compile the documentation for all your packages in <code>~/.cabal/share/doc</code>. You may also want to use <code>--hyperlink-source</code> or set <code>hyperlink-source: True</code> in the <code>haddock</code> section of <code>~/.cabal/config</code>.</p>\n\n<blockquote>\n  <p>read the code in the package</p>\n</blockquote>\n\n<p>You can <code>cabal unpack</code> a package to get the source. For package <code>foo</code> version <code>x.y</code>, the source will be placed in a directory named <code>foo-x.y</code> by default.</p>\n\n<blockquote>\n  <p>play with it in GHCi</p>\n</blockquote>\n\n<p>Once you have the package source, you can navigate into the directory and run <code>cabal repl</code> to get a ghci instance with all the package modules loaded.</p>\n\n<blockquote>\n  <p>see what the module names are</p>\n</blockquote>\n\n<p>The <code>Modules:</code> section of <code>cabal info</code> will be of interest here. Once a package is installed, you can also use <code>ghc-pkg describe</code> to get similar functionality. (The primary difference here is about which packages are known; <code>cabal info</code> will know about what's on Hackage/whatever package repository you have configured <code>cabal</code> to use, even if the package isn't installed yet, while <code>ghc-pkg</code> will know about any package you have installed, even if that package didn't come from Hackage.)</p>\n"}], "owner": {"reputation": 501, "user_id": 4681998, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6e983411d6b657a245740031a55ed4b3?s=128&d=identicon&r=PG", "display_name": "preferred_anon", "link": "https://stackoverflow.com/users/4681998/preferred-anon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "accepted_answer_id": 31591072, "answer_count": 2, "score": 7, "last_activity_date": 1537005957, "creation_date": 1437662965, "question_id": 31590866, "link": "https://stackoverflow.com/questions/31590866/learning-from-haskell-packages", "title": "Learning from Haskell Packages", "body": "<p>So I've been installing packages in Haskell with Cabal. I can't see any documentation for most of these (in general), and I've been told that one of the best ways to learn haskell is just to read the code in the package, work out what it does, and play with it in GHCi or something. But how do you do this? After installing these packages into a sandbox or something, I can't even see what the module names are, let alone their source code - how do I find this information?</p>\n"}, {"tags": ["haskell", "instances"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 4, "creation_date": 1437669665, "post_id": 31590560, "comment_id": 51138544, "body": "<code>p f :: (C a) =&gt; a -&gt; a</code> is the proper response to <code>:t p f</code>, but you entered <code>p f</code>."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1437686417, "post_id": 31590560, "comment_id": 51148214, "body": "The question that GHCi is asking is, <i>&quot;I know it&#39;s an instance of <code>C</code>, but which instance is it? Otherwise, I can&#39;t determine if I can <code>show</code> it or not.&quot;</i>"}], "answers": [{"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 3, "creation_date": 1437663715, "post_id": 31591042, "comment_id": 51134200, "body": "Even disabling the monomorphism restriction with <code>:set -XNoMonomorphismRestriction</code> entering the naked expression <code>p f</code> into ghci results in the error <code>No instance for (C c0) ...</code>."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1437664034, "post_id": 31591042, "comment_id": 51134464, "body": "I think that&#39;s an artifact arising from GHCi-7.8 trying to print it. GHCi-7.10 doesn&#39;t give that error message at all (instead it throws <code>No instance for Show...</code>)."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 8, "creation_date": 1437665989, "post_id": 31591042, "comment_id": 51135989, "body": "It doesn&#39;t have anything to do with printing (<code>p f `seq` ()</code> also gives an error), and it&#39;s not really the MR either. It&#39;s something much more basic: GHC cannot <i>evaluate</i> a value with a type class context without choosing a dictionary to pass in. In particular, no matter how you slice it, it doesn&#39;t know <i>which</i> type&#39;s <code>foo</code> to use here."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 4, "last_activity_date": 1437663380, "creation_date": 1437663380, "answer_id": 31591042, "question_id": 31590560, "link": "https://stackoverflow.com/questions/31590560/typeclasses-101-ghc-too-eager-to-derive-instance/31591042#31591042", "title": "Typeclasses 101: GHC too &quot;eager&quot; to derive instance?", "body": "<p>It's the dreaded <a href=\"https://wiki.haskell.org/Monomorphism_restriction\" rel=\"nofollow\">monomorphism restriction</a> in action. By default, GHC doesn't allow us to have top-level value definitions without type annotations if the inferred type has a class constraint. You can remedy the situation by</p>\n\n<p>a.) Turning the restriction off by adding <code>{-# LANGUAGE NoMonomorphismRestriction #-}</code> to the top of your source.</p>\n\n<p>b.) Adding type annotations to affected top-level bindings:</p>\n\n<pre><code>foo :: C a =&gt; a -&gt; a\nfoo = p f\n</code></pre>\n\n<p>c.) Expanding function definitions (if possible):</p>\n\n<pre><code>foo x = p f x \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 8, "last_activity_date": 1437667964, "last_edit_date": 1437667964, "creation_date": 1437664286, "answer_id": 31591417, "question_id": 31590560, "link": "https://stackoverflow.com/questions/31590560/typeclasses-101-ghc-too-eager-to-derive-instance/31591417#31591417", "title": "Typeclasses 101: GHC too &quot;eager&quot; to derive instance?", "body": "<p>When you put a plain expression into ghci, it is basically trying to <code>print</code> it, so</p>\n\n<pre><code>&gt; p f\n</code></pre>\n\n<p>is approximately the same as having the following in a file</p>\n\n<pre><code>main :: IO ()\nmain = print $ p f\n</code></pre>\n\n<p>As you pointed out, <code>p f :: (C a) =&gt; a -&gt; a</code>. In order to <code>print $ p f</code> GHC needs to evaluate <code>p f</code>. GHC cannot evaluate a value with a type class context without choosing a dictionary to pass in. To do so, it needs to find a <code>C a</code> instance for all <code>a</code>, which doesn't exit. It also needs to find a <code>Show</code> instance for <code>a -&gt; a</code>. The inability to find either of these results in two errors</p>\n\n<pre><code>No instance for (Show (a -&gt; a)) arising from a use of `print'\nNo instance for (C a) arising from a use of `p'\n</code></pre>\n"}], "owner": {"reputation": 585, "user_id": 4190654, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/7486a064e377ff1f77a407642b80272f?s=128&d=identicon&r=PG&f=1", "display_name": "ftl", "link": "https://stackoverflow.com/users/4190654/ftl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 31591417, "answer_count": 2, "score": 4, "last_activity_date": 1437667964, "creation_date": 1437662312, "last_edit_date": 1437663028, "question_id": 31590560, "link": "https://stackoverflow.com/questions/31590560/typeclasses-101-ghc-too-eager-to-derive-instance", "title": "Typeclasses 101: GHC too &quot;eager&quot; to derive instance?", "body": "<p>Given the following code:</p>\n\n<pre><code>class C a where\n  foo :: a -&gt; a\n\nf :: (C a) =&gt; a -&gt; a\nf = id\n\np :: (C a) =&gt; (a -&gt; a) -&gt; a -&gt; a\np g = foo . g\n</code></pre>\n\n<p>Now, if I try to invoke p f, GHC complains:</p>\n\n<pre><code>&gt; p f\nNo instance for (C a0) arising from a use of `p'\nIn the expression: p f\nIn an equation for `it': it = p f\n</code></pre>\n\n<p>I find that somewhat surprising, since f only accepts an \"a\" which has to be an instance of the typeclass C. What is the reason?</p>\n\n<p>Edit: I know I did not define any instance for C but shouldn't the \"proper\" response be:</p>\n\n<pre><code>p f :: (C a) =&gt; a -&gt; a \n</code></pre>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1437654459, "post_id": 31587010, "comment_id": 51126538, "body": "I wouldn&#39;t specify the version to the bugfix release if it isn&#39;t needed. Probably something like <code>reactive-banana &gt;= 0.8</code> is more than enough most of the time."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1437654850, "post_id": 31587010, "comment_id": 51126820, "body": "You can, but the version selected will be determined by the <code>stack.yaml</code> file where you have to give a specific version."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1437655657, "post_id": 31587010, "comment_id": 51127424, "body": "This actually works very neatly - <code>stack.yaml</code> freezes the version to ensure a reproducible build, while the cabal file can be used to inform users how far they can deviate from the fixed versions (I only noticed this after reading your comments)."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 5, "last_activity_date": 1437659748, "last_edit_date": 1437659748, "creation_date": 1437653547, "answer_id": 31587010, "question_id": 31586397, "link": "https://stackoverflow.com/questions/31586397/difference-between-new-template-cabal-and-stack-yaml/31587010#31587010", "title": "Difference between new-template.cabal and stack.yaml", "body": "<p>When using <code>stack</code> I generally don't put any versions bounds in my <code>.cabal</code> file. I let the <code>resolver</code> and <code>extra-deps</code> setting in the <code>stack.yaml</code> file determine which versions of packages to select.</p>\n\n<p>Here is a <code>stack.yaml</code> file which brings in reactive-banana-0.8.1.2:</p>\n\n<pre><code>flags: {}\npackages:\n- '.'\nextra-deps:\n- reactive-banana-0.8.1.2\n- psqueues-0.2.0.2\nresolver: lts-2.17\n</code></pre>\n\n<p>In my <code>.cabal</code> file I just have:</p>\n\n<pre><code>  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5, reactive-banana\n</code></pre>\n\n<p>The reactive-banana version is pinned by the stack.yaml file.</p>\n\n<p>If you want to use GHC 7.10 change the resolver to something like <code>nightly-2015-06-17</code>.</p>\n\n<p>I determine the <code>extra-deps</code> iteratively, by just running <code>stack build</code> and adding whatever dependencies are missing to the <code>stack.yaml</code> file until all dependencies are satisfied.</p>\n\n<p>You will only need to do this with packages which are not in <a href=\"http://www.stackage.org/\" rel=\"nofollow\">Stackage</a> - like reactive-banana. A great many of commonly used packages are in Stackage and their versions will be determined by the <code>resolver</code> setting.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 2, "last_activity_date": 1437653602, "creation_date": 1437653602, "answer_id": 31587026, "question_id": 31586397, "link": "https://stackoverflow.com/questions/31586397/difference-between-new-template-cabal-and-stack-yaml/31587026#31587026", "title": "Difference between new-template.cabal and stack.yaml", "body": "<p>In the default configuration, stack works with two package databases: a centralised per-user one and a project-specific one. The centralised database only pulls packages from <a href=\"http://www.stackage.org/\" rel=\"nofollow\">Stackage</a>, a subset of Hackage with known-to-be-compatible packages, while you can put whatever you want on the project-specific database. All packages you use must be in the cabal file, but those not on Stackage (that is, the ones that will go to the project-specific database) must also be listed in the extra-deps section of <code>stack.yaml</code>. <code>reactive-banana</code> is not on Stackage, so you need to add it to <code>stack.yaml</code>, like this:</p>\n\n<pre><code># etc.\nextra-deps:\n- reactive-banana-0.8.1.2\n# etc.\n</code></pre>\n\n<p><code>stack solver</code> can fill in the extra dependencies in <code>stack.yaml</code> for you.</p>\n"}], "owner": {"reputation": 15620, "user_id": 596361, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/b7219254970581e53d3b2b162f7f50f8?s=128&d=identicon&r=PG", "display_name": "Mirzhan Irkegulov", "link": "https://stackoverflow.com/users/596361/mirzhan-irkegulov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 410, "favorite_count": 2, "accepted_answer_id": 31587010, "answer_count": 2, "score": 5, "last_activity_date": 1437659748, "creation_date": 1437651890, "question_id": 31586397, "link": "https://stackoverflow.com/questions/31586397/difference-between-new-template-cabal-and-stack-yaml", "title": "Difference between new-template.cabal and stack.yaml", "body": "<p>I want to use <a href=\"https://github.com/HeinrichApfelmus/reactive-banana/\" rel=\"noreferrer\"><code>reactive-banana</code></a> in my new Haskell project. I never used <a href=\"https://wiki.haskell.org/Cabal-Install\" rel=\"noreferrer\">cabal-install</a> or <a href=\"https://github.com/commercialhaskell/stack\" rel=\"noreferrer\"><code>stack</code></a> before. I created a directory and initialized project files in it using <code>stack new</code>. I see now 2 files in the directory: <code>new-template.cabal</code> and <code>stack.yaml</code>.</p>\n\n<p>How do I set dependencies and make sure they are downloaded and compiled?</p>\n\n<p>At first I tried to add <code>- reactive-banana-0.8.0.2</code> in <code>stack.yaml</code> under <code>extra-deps:</code>,  but both <code>stack build</code> and <code>stack solver</code> didn't download it. Then I augmented a part called <code>library</code> in <code>new-template.cabal</code> to this:</p>\n\n<pre><code>library\n  hs-source-dirs:      src\n  exposed-modules:     Lib\n  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5\n                     , reactive-banana &gt;= 0.8\n  default-language:    Haskell2010\n</code></pre>\n\n<p>Every time I tried to run <code>stack build</code>, it crashed with an error and suggestion to add some package to <code>stack.yaml</code> under <code>extra-deps:</code>, and this happened three times until finally all packages installed, and I could import them in <code>stack ghci</code> REPL.</p>\n\n<p>So my question is, what is the idiomatic way to use <code>stack</code>? Which of these 2 files should I use to specify dependencies and other project metadata? What is the sample workflow of an average Haskell developer with <code>stack</code>?</p>\n"}, {"tags": ["performance", "haskell", "vector", "bitarray", "bitvector"], "comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 2, "creation_date": 1437651651, "post_id": 31586071, "comment_id": 51124562, "body": "I would make a special purpose data type with 6 unpacked <code>Word64</code>, and then use the primitive operations word-wise on those."}, {"owner": {"reputation": 47690, "user_id": 55925, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/4d4fbbf7cbb15f7076a5bc273f7fa039?s=128&d=identicon&r=PG", "display_name": "Johannes Weiss", "link": "https://stackoverflow.com/users/55925/johannes-weiss"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1437651896, "post_id": 31586071, "comment_id": 51124716, "body": "Hi @augustss, thanks! I thought about that and didn&#39;t do it in the end since I have lots of unit &amp; QuickCheck tests which quickly solve sub-problems where the vectors are considerably shorter. Obviously, I could still always use the big vector type and only make use of the first <code>n</code> bits in the tests but I thought there might be a nice unpacked representation which works regardless of the number of bits. Also: For my program to generally solve the problem, the length of the bit vector is not restricted to 384 :(. So my program would only work if your input data is &quot;small enough&quot;."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 2, "creation_date": 1437652369, "post_id": 31586071, "comment_id": 51125048, "body": "<code>Natural</code> and <code>Integer</code> are pretty good for this, since they use the GMP primitives which are optimized to the hilt."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1437652418, "post_id": 31586071, "comment_id": 51125091, "body": "In the bitvector version, most of the time is spent in <code>soqoXOR</code>, which is implemented using <code>Data.Vector.Unboxed.Bit.zipWords</code>, which <a href=\"http://hackage.haskell.org/package/bitvec-0.1.0.1/docs/src/Data-Vector-Unboxed-Bit.html#zipWords\" rel=\"nofollow noreferrer\">converts back and forth between mutable and immutable vectors</a>. I wonder if that explains the problem, and if using the mutable version directly in <code>ST</code> would help."}, {"owner": {"reputation": 47690, "user_id": 55925, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/4d4fbbf7cbb15f7076a5bc273f7fa039?s=128&d=identicon&r=PG", "display_name": "Johannes Weiss", "link": "https://stackoverflow.com/users/55925/johannes-weiss"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1437654300, "post_id": 31586071, "comment_id": 51126420, "body": "@duplode thanks! In my real use case I need every produced vector though. So the code doesn&#39;t look too bad to me: <code>xs &lt;- V.thaw xs</code> makes one copy, <code>B.zipInPlace op xs ys</code> looks like it zips in place and <code>Unsafe.unsafeFreeze xs</code> makes it immutable in constant time. So I&#39;d expect it to make exactly one copy per iteration which is what I want. Do you agree?"}, {"owner": {"reputation": 47690, "user_id": 55925, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/4d4fbbf7cbb15f7076a5bc273f7fa039?s=128&d=identicon&r=PG", "display_name": "Johannes Weiss", "link": "https://stackoverflow.com/users/55925/johannes-weiss"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1437654453, "post_id": 31586071, "comment_id": 51126531, "body": "@Andr&#225;sKov&#225;cs ok, only on GHC 7.10 though, 7.8 is hideously slow though :). And still on 7.10 it allocates twice as much as needed :(."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1437655348, "post_id": 31586071, "comment_id": 51127203, "body": "About thaw and freeze, that sounds reasonable indeed. As for the 2x allocation, it is not unexpected given the overhead of the <code>data</code> constructor of the <code>Natural</code>s (cf. <a href=\"http://stackoverflow.com/questions/3254758/memory-footprint-of-haskell-data-types\">this question</a>)."}, {"owner": {"reputation": 47690, "user_id": 55925, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/4d4fbbf7cbb15f7076a5bc273f7fa039?s=128&d=identicon&r=PG", "display_name": "Johannes Weiss", "link": "https://stackoverflow.com/users/55925/johannes-weiss"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1437656327, "post_id": 31586071, "comment_id": 51127891, "body": "@duplode true, so that should add <code>10,000,000 * sizeof(Word)</code> which is <code>8</code> for me so add <code>80,000,000</code>. The expected figure is then <code>600,000,000</code>, however <code>1,280,306,112</code> is still a tiny little bit more than twice the figure, right?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1437657645, "post_id": 31586071, "comment_id": 51128925, "body": "According to that answer, it would be two words for a (small) <code>Integer</code>, plus two words for a (single field) constructor, so 4 words per <code>Natural</code>. If I&#39;m not messing up the calculations you show in the question, that would give <code>(10kk * 384 &#47; 8) + (10kk * 4 * 8) = 800,000,000</code>, which is halfway through."}, {"owner": {"reputation": 47690, "user_id": 55925, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/4d4fbbf7cbb15f7076a5bc273f7fa039?s=128&d=identicon&r=PG", "display_name": "Johannes Weiss", "link": "https://stackoverflow.com/users/55925/johannes-weiss"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1437660201, "post_id": 31586071, "comment_id": 51131180, "body": "@duplode thanks! You&#39;re absolutely right. So we&#39;re &quot;only&quot; missing <code>400,000,000</code> bytes, which is roughly <code>40</code> per created <code>Natural</code> (whose actual data only has <code>48</code> bytes)."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1437692794, "post_id": 31587186, "comment_id": 51150603, "body": "I wonder why <code>Crypto</code> doesn&#39;t just depend on <a href=\"http://hackage.haskell.org/package/largeword\" rel=\"nofollow noreferrer\"><code>largeword</code></a>, a package with just the <code>LargeWord</code> module and written by the same author. See also the <a href=\"http://hackage.haskell.org/package/set-cover-0.0.4/docs/Math-SetCover-Bit.html#t:Sum\" rel=\"nofollow noreferrer\"><code>Sum</code></a> type from <code>set-cover</code>, which is similar but uses strict fields. Probably if efficiency is a thing one would want to unpack them as well."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1437654003, "creation_date": 1437654003, "answer_id": 31587186, "question_id": 31586071, "link": "https://stackoverflow.com/questions/31586071/packed-large-bit-vector-with-efficient-xor-and-bit-count-in-haskell/31587186#31587186", "title": "Packed large bit vector with efficient xor and bit count in Haskell", "body": "<p>Have a look at the <code>Data.LargeWord</code> module in the <code>Crypto</code> package:</p>\n\n<p><a href=\"http://hackage.haskell.org/package/Crypto-4.2.5.1/docs/Data-LargeWord.html\" rel=\"nofollow\">http://hackage.haskell.org/package/Crypto-4.2.5.1/docs/Data-LargeWord.html</a></p>\n\n<p>It provides <code>Bits</code> instances for large words of various sizes, e.g. 96 through 256 bits.</p>\n"}], "owner": {"reputation": 47690, "user_id": 55925, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/4d4fbbf7cbb15f7076a5bc273f7fa039?s=128&d=identicon&r=PG", "display_name": "Johannes Weiss", "link": "https://stackoverflow.com/users/55925/johannes-weiss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 509, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1437687579, "creation_date": 1437650994, "last_edit_date": 1437687579, "question_id": 31586071, "link": "https://stackoverflow.com/questions/31586071/packed-large-bit-vector-with-efficient-xor-and-bit-count-in-haskell", "title": "Packed large bit vector with efficient xor and bit count in Haskell", "body": "<p>I am looking for an efficient (in both space and time) data type which can hold a 384 bit vector and supports efficient XOR and \"bit count\" (number of bits set to 1) operations.</p>\n\n<p>Below, please find my demo program. The operations I need are all in the <code>SOQuestionOps</code> type class and I have implemented it for <a href=\"https://hackage.haskell.org/package/naturals-0.2.0.2/docs/Data-Natural.html\" rel=\"nofollow\"><code>Natural</code></a> and <a href=\"http://hackage.haskell.org/package/bitvec-0.1.0.1/docs/Data-Vector-Unboxed-Bit.html\" rel=\"nofollow\"><code>Data.Vector.Unboxed.Bit</code></a>. Especially the latter seems perfect as it has a <code>zipWords</code> operation which should allow me to do operations like \"bit count\" and XOR word-by-word instead of bit-by-bit. Also it claims to store the bits packed (8 bits per byte).</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\nimport Data.Bits\nimport Data.List (foldl')\nimport Numeric.Natural\nimport qualified Data.Vector as V\nimport qualified Data.Vector.Unboxed.Bit as BV\n\nclass SOQuestionOps a where\n    soqoXOR :: a -&gt; a -&gt; a\n    soqoBitCount :: a -&gt; Int\n    soqoFromList :: [Bool] -&gt; a\n\nalternating :: Int -&gt; [Bool]\nalternating n =\n    let c = n `mod` 2 == 0\n     in if n == 0\n           then []\n           else c : alternating (n-1)\n\ninstance SOQuestionOps Natural where\n    soqoXOR = xor\n    soqoBitCount = popCount\n    soqoFromList v =\n        let oneIdxs = map snd $ filter fst (zip v [0..])\n         in foldl' (\\acc n -&gt; acc `setBit` n) 0 oneIdxs\n\ninstance SOQuestionOps (BV.Vector BV.Bit) where\n    soqoXOR = BV.zipWords xor\n    soqoBitCount = BV.countBits\n    soqoFromList v = BV.fromList (map BV.fromBool v)\n\nmain =\n    let initialVec :: BV.Vector BV.Bit\n        initialVec = soqoFromList $ alternating 384\n        lotsOfVecs = V.replicate 10000000 (soqoFromList $ take 384 $ repeat True)\n        xorFolded = V.foldl' soqoXOR initialVec lotsOfVecs\n        sumBitCounts = V.foldl' (\\n v -&gt; n + soqoBitCount v) 0 lotsOfVecs\n     in putStrLn $ \"folded bit count: \" ++ show (soqoBitCount xorFolded) ++ \", sum: \" ++ show sumBitCounts\n</code></pre>\n\n<p>So let's calculate numbers for the best case: <code>lotsOfVecs</code> shouldn't need to allocate much because it's just 10,000,000 times the same vector <code>initialVec</code>. The foldl obviously creates one of these vectors per fold operation, so it should create 10,000,000 bit vectors. The bit counting should create anything but 10,000,000 <code>Int</code>s. So in the best case, my program should use very little (and constant) memory and the total allocations should roughly be 10,000,000 * sizeof(bit vector) + 10,000,000 * sizeof(int) = 520,000,000 bytes .</p>\n\n<p>Ok, let's run the program for <code>Natural</code>:</p>\n\n<p>let's make <code>initialVec :: Natural</code>, compile with </p>\n\n<pre><code>ghc --make -rtsopts -O3 MemStuff.hs\n</code></pre>\n\n<p>result (this is with GHC 7.10.1):</p>\n\n<pre><code>$ ./MemStuff +RTS -sstderr\nfolded bit count: 192, sum: 3840000000\n1,280,306,112 bytes allocated in the heap\n201,720 bytes copied during GC\n80,106,856 bytes maximum residency (2 sample(s))\n662,168 bytes maximum slop\n78 MB total memory in use (0 MB lost due to fragmentation)\n\nTot time (elapsed)  Avg pause  Max pause\nGen  0      2321 colls,     0 par    0.056s   0.059s     0.0000s    0.0530s\nGen  1         2 colls,     0 par    0.065s   0.069s     0.0346s    0.0674s\n\nINIT    time    0.000s  (  0.000s elapsed)\nMUT     time    0.579s  (  0.608s elapsed)\nGC      time    0.122s  (  0.128s elapsed)\nEXIT    time    0.000s  (  0.002s elapsed)\nTotal   time    0.702s  (  0.738s elapsed)\n\n%GC     time      17.3%  (17.3% elapsed)\n\nAlloc rate    2,209,576,763 bytes per MUT second\n\nProductivity  82.7% of total user, 78.7% of total elapsed\n\n\nreal    0m0.754s\nuser    0m0.704s\nsys 0m0.037s\n</code></pre>\n\n<p>which has <code>1,280,306,112 bytes allocated in the heap</code>, that's in the ballpark (2x) of the expected figure. Btw on GHC 7.8 this allocates 353,480,272,096 bytes and runs for absolute ages as <code>popCount</code> isn't very efficient on GHC 7.8's <code>Natural</code>s.</p>\n\n<p><strong>EDIT</strong>: I changed the code a bit. In the original version, every other vector was <code>0</code> in the fold. Which gave a lot better allocation figures for the <code>Natural</code> version. I changed it so the vector alternates between to different representations (with many bits set) and now we see <code>2x</code> allocations of the expected. That's another downside of <code>Natural</code> (and <code>Integer</code>): The allocation rate depends on the values.</p>\n\n<p>But maybe we can do better, let's try the densely packed <code>Data.Vector.Unboxed.Bit</code>:</p>\n\n<p>That's <code>initialVec :: BV.Vector BV.Bit</code> and re-compile and re-run with the same options.</p>\n\n<pre><code>$ time ./MemStuff +RTS -sstderr\nfolded bit count: 192, sum: 1920000000\n75,120,306,536 bytes allocated in the heap\n54,914,640 bytes copied during GC\n80,107,368 bytes maximum residency (2 sample(s))\n664,128 bytes maximum slop\n78 MB total memory in use (0 MB lost due to fragmentation)\n\nTot time (elapsed)  Avg pause  Max pause\nGen  0     145985 colls,     0 par    0.543s   0.627s     0.0000s    0.0577s\nGen  1         2 colls,     0 par    0.065s   0.070s     0.0351s    0.0686s\n\nINIT    time    0.000s  (  0.000s elapsed)\nMUT     time   27.679s  ( 28.228s elapsed)\nGC      time    0.608s  (  0.698s elapsed)\nEXIT    time    0.000s  (  0.002s elapsed)\nTotal   time   28.288s  ( 28.928s elapsed)\n\n%GC     time       2.1%  (2.4% elapsed)\n\nAlloc rate    2,714,015,097 bytes per MUT second\n\nProductivity  97.8% of total user, 95.7% of total elapsed\n\n\nreal    0m28.944s\nuser    0m28.290s\nsys 0m0.456s\n</code></pre>\n\n<p>That's very slow and roughly 100 times the allocations :(.</p>\n\n<p>Ok, then lets recompile and profile both runs (<code>ghc --make -rtsopts -O3 -prof -auto-all -caf-all -fforce-recomp MemStuff.hs</code>):</p>\n\n<p>The <code>Natural</code> version:</p>\n\n<pre><code>COST CENTRE         MODULE  %time %alloc\nmain.xorFolded      Main     51.7   76.0\nmain.sumBitCounts.\\ Main     25.4   16.0\nmain.sumBitCounts   Main     12.1    0.0\nmain.lotsOfVecs     Main     10.4    8.0\n</code></pre>\n\n<p>The <code>Data.Vector.Unboxed.Bit</code> version:</p>\n\n<pre><code>COST CENTRE         MODULE  %time %alloc\nsoqoXOR             Main     96.7   99.3\nmain.sumBitCounts.\\ Main      1.9    0.2\n</code></pre>\n\n<p>Is <code>Natural</code> really the best option for a fixed size bit vector? And what about GHC 6.8? And is there anything better which can implement my <code>SOQuestionOps</code> type class?</p>\n"}, {"tags": ["algorithm", "haskell"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1437646099, "post_id": 31583603, "comment_id": 51120859, "body": "It&#39;s a little hard to follow what&#39;s going on without the corresponding type declarations."}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1437653773, "post_id": 31583603, "comment_id": 51126045, "body": "@MathematicalOrchid Is there anything I forgot to add, or anything that is unclear? Also thanks for the attention."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1437654364, "post_id": 31583603, "comment_id": 51126471, "body": "In general you should avoid using <code>==</code> with floating point arithmetic. Multiply all coordinates by 2 and use integer operations."}, {"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1437656976, "post_id": 31583603, "comment_id": 51128374, "body": "@user5402 I have changed that, thanks for pointing it out."}], "answers": [{"comments": [{"owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "edited": false, "score": 0, "creation_date": 1437659958, "post_id": 31589416, "comment_id": 51130955, "body": "Thanks for the tip. And do you think an IDA* algorithm would do the work?"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1437659497, "creation_date": 1437659497, "answer_id": 31589416, "question_id": 31583603, "link": "https://stackoverflow.com/questions/31583603/how-to-implement-the-thistlethwaites-algorithm-in-haskell/31589416#31589416", "title": "How to implement the Thistlethwaite&#39;s algorithm in Haskell?", "body": "<p>One thing - this code:</p>\n\n<pre><code>wrongs = do\n        res &lt;- [[]]\n        eg &lt;- edges\n        if criterion (c eg) eg\n          then res\n          else res ++ [eg]\n</code></pre>\n\n<p>is better written as <code>filter (\\eg -&gt; not (criterion (c eg) eg)) edges</code>.</p>\n"}], "owner": {"reputation": 571, "user_id": 3429327, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/uPy6Z.jpg?s=128&g=1", "display_name": "awllower", "link": "https://stackoverflow.com/users/3429327/awllower"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 728, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1437659497, "creation_date": 1437644405, "last_edit_date": 1437656947, "question_id": 31583603, "link": "https://stackoverflow.com/questions/31583603/how-to-implement-the-thistlethwaites-algorithm-in-haskell", "title": "How to implement the Thistlethwaite&#39;s algorithm in Haskell?", "body": "<p>I am trying to implement the Thistlethwaite's algorithm in Haskell, following the descriptions found <a href=\"http://www.jaapsch.net/puzzles/thistle.htm\" rel=\"nofollow\">here</a>, but encountered difficulties.</p>\n\n<p>So far, I have managed to represent the cube, make it move as one likes, and display it on the terminal (a 2-dimensional representation), but I got problems when trying to reduce a general cube to one which can be obtained from a standard cube by moves in the group (R, L, F, B, U2, D2) (notations as in the link), as there are too many cases to consider: how many colors on the up layer are wrongly-oriented, on the middle layer, etc. This is only the first stage in the description, but I found a mess in my codes already, so I must have missed something.</p>\n\n<p>As I am not sure if my description above is clear, I put up the relevant codes below, which are not correct, but indicate the problem.  </p>\n\n<pre><code>--To intersect lists, of which the sizes are not very large, I chose to import the Data.List\nimport Data.List\n\n--Some type declarations\ndata Colors = R | B | W | Y | G | O\ntype R3 = (Int, Int, Int)\ntype Cube = R3 -&gt; Colors\npoints :: [R3] --list of coordinates of facelets of a cube; there are 48 of them.\nmU :: Cube -&gt; Cube --and other 5 moves.\ntype Actions = [Cube -&gt; Cube]\nturn :: Cube -&gt; Actions -&gt; Cube --chains the actions and turns the cube.\nedges :: [R3] --The edges of cubes\n\ncriterion :: Colors -&gt; R3 -&gt; Bool -- determine if the edges are mis-placed.\ncriterion co p@(x, y, z) = case co of --W and Y are up and down faces respectively.\n R -&gt; not (or [abs(x) == 3, abs(y) == 3])\n B -&gt; not (or [abs(y) == 3, abs(z) == 3])\n O -&gt; not (or [abs(x) == 3, abs(y) == 3])\n G -&gt; not (or [abs(y) == 3, abs(z) == 3])\n _ -&gt; True\n\n\nstage1 :: Cube -&gt; Cube \nstage1 c = turn c opes where\n    wrongs = do\n            res &lt;- [[]]\n            eg &lt;- edges\n            if criterion (c eg) eg\n              then res\n              else res ++ [eg]\n    ups = filter (\\(x, y, z) -&gt; y == 3) points\n    downs = filter (\\(x, y, z) -&gt; y == -3) points\n    middles = filter (\\(x, y, z) -&gt; y == 0) points\n    opes = do\n         res &lt;- [[]]\n         case length (intersect middles wrongs) of\n         0 -&gt; case [length (intersect ups wrongs) == 0, length (intersect downs wrongs) == 0] of\n            [True, True] -&gt; res\n            [True, False] -&gt; [mD] --A quarter turn of the downside of the cube.\n            [False, True] -&gt; [mU]\n            _ -&gt; [mD, mU]\n         1 -&gt; let [(x, y, z)] = intersect middles wrongs in\n                if x == 3 then case [length (intersect ups wrongs) == 0, length (intersect downs wrongs) == 0] of\n                    [True, True] -&gt; if z &gt; 0 then [mR, mU] else [mR, mD]\n                    [True, False] -&gt; if z &gt; 0 then [mD, mR, mU] else [mD, mR, mD]\n                    [False, True] -&gt; if z &gt; 0 then [mU, mR, mU] else [mU, mR, mD]\n                    _ -&gt; if z &gt; 0 then [mD, mU, mR, mU] else [mD, mU, mR, mD]\n                else []\n</code></pre>\n\n<p>Then I realized that the above code is wrong as I cannot simply make a quarter turn U or D which makes the correct edges, if any, become incorrect, and I shall discuss 125 = 5 * 5 * 5 cases according to how many wrong edges are on each of the three layers of the cube, which I think of as not \"right.\"</p>\n\n<p>So my question is how to implement an algorithm that can handle so many cases, in a nice way?</p>\n\n<p>If something about the description is unclear, please tell me so that I can explain what I am doing and what my problem is.  </p>\n\n<p>Any ideas and suggestions are greatly appreciated, thanks very much in advance.</p>\n\n<p>P.S. I originally wanted to implement Korf's or Kociemba's algorithms, though it turned out that I cannot even handle the simplest case.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "edited": false, "score": 2, "creation_date": 1437641684, "post_id": 31582249, "comment_id": 51118001, "body": "You have <code>pure x :: ()</code> in an IO monad <code>do</code> block. Every action in such a block should have type <code>IO t</code>."}, {"owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "edited": false, "score": 0, "creation_date": 1437641747, "post_id": 31582249, "comment_id": 51118049, "body": "Is your problem maybe resolved by simply removing the <code>unsafePerformIO</code> call?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "reply_to_user": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "edited": false, "score": 0, "creation_date": 1437642356, "post_id": 31582249, "comment_id": 51118452, "body": "hi Mauris, updated my question after your inputs.."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 6, "creation_date": 1437642495, "post_id": 31582249, "comment_id": 51118553, "body": "Two extra remarks, even though you are probably aware of them already, and even though your code is just a test: firstly, there is a very common function called <code>pure</code>, so it is not a good name to use (in the latest GHC, you would get a name clash even without importing anything). Secondly, <i>stay away from <code>unsafePerformIO</code></i> - it really is unsafe!"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1437643373, "post_id": 31582249, "comment_id": 51119119, "body": "As for the edited question, the issue is the same than in <a href=\"http://stackoverflow.com/questions/31580302/main-function-complains-of-returning-a-non-io-monad\">your other question</a>: you are ignoring the types. <code>IO ()</code> is not the same thing than <code>()</code>."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 4, "creation_date": 1437643695, "post_id": 31582249, "comment_id": 51119313, "body": "<b>Do not change your question</b>. If you have a different (even if related question) ask a <b>new</b> question and eventually link to this one."}], "answers": [{"tags": [], "owner": {"reputation": 3116, "user_id": 353187, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfdc97f71e1b8c257ae1bbd52989785d?s=128&d=identicon&r=PG", "display_name": "xnyhps", "link": "https://stackoverflow.com/users/353187/xnyhps"}, "is_accepted": true, "score": 6, "last_activity_date": 1437641826, "creation_date": 1437641826, "answer_id": 31582628, "question_id": 31582249, "link": "https://stackoverflow.com/questions/31582249/haskell-treats-multiple-lines-of-code-as-a-single-function-call/31582628#31582628", "title": "Haskell treats multiple lines of code as a single function call", "body": "<p>Make sure you're indenting the <code>pure</code> and <code>putStrLn</code> lines identically (so don't do one using tabs and the other with spaces). If ghc thinks <code>putStrLn</code> is indented further, then it will be considered as arguments to <code>pure</code>.</p>\n\n<p>If you want, you can use semicolons in Haskell too:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>pureCall :: String -&gt; IO ()\npureCall x = do {\n  pure x ;\n      putStrLn \"inside child function\"\n  }\n</code></pre>\n\n<p>works as you'd expect.</p>\n\n<p>(Also note that your code is not well typed: <code>pure</code> is not of type <code>IO a</code>.)</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 915, "favorite_count": 0, "accepted_answer_id": 31582628, "answer_count": 1, "score": 2, "last_activity_date": 1437643664, "creation_date": 1437640750, "last_edit_date": 1437643664, "question_id": 31582249, "link": "https://stackoverflow.com/questions/31582249/haskell-treats-multiple-lines-of-code-as-a-single-function-call", "title": "Haskell treats multiple lines of code as a single function call", "body": "<pre><code>pure :: String -&gt; ()\npure x = unsafePerformIO $ do\n  print x\n  return ()\n\npureCall :: String -&gt; IO ()\npureCall x = do\n  pure x\n  putStrLn \"inside child function\"\n</code></pre>\n\n<p>This throws compilation error as,</p>\n\n<pre><code>  The function \u2018pure\u2019 is applied to three arguments,\n    but its type \u2018String -&gt; ()\u2019 has only one\n</code></pre>\n\n<p>I use semicolon as code line seperator in other languages. But not sure, how i can do it in haskell, and run the pureCall function block as two seperate statements!!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "edited": false, "score": 1, "creation_date": 1437642398, "post_id": 31582139, "comment_id": 51118480, "body": "Which result do you expect from <code>mapM_ print log&#39;</code> instead?"}, {"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "reply_to_user": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "edited": false, "score": 0, "creation_date": 1437642466, "post_id": 31582139, "comment_id": 51118527, "body": "The same thing I get from res."}, {"owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "edited": false, "score": 0, "creation_date": 1437642832, "post_id": 31582139, "comment_id": 51118810, "body": "Presumably you&#39;d have to run your writers separately, and then do something like <code>map snd (zip res log)</code>, if you want a &quot;cutoff&quot;."}, {"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "reply_to_user": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "edited": false, "score": 0, "creation_date": 1437643271, "post_id": 31582139, "comment_id": 51119064, "body": "@Mauris This does work but only because I can run the writer. It doesn&#39;t work for monads in general. If it&#39;s impossible for monads in general then make that an answer and I&#39;ll accept it."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1437644003, "post_id": 31582139, "comment_id": 51119488, "body": "On &quot;the same thing I get from res&quot;, note that it is only thanks to an arbitrary choice of yours that for every <code>n</code> in <code>res</code> there is a corresponding <code>show n</code> piece of string in the log - you could be logging anything else instead. Therefore, the only place in which you can tightly couple log and result is in <code>longComputation</code>; otherwise, the horse has already bolted. Also note that it is rigorously impossible, as a consequence of the first functor law, for <code>fmap</code> to modify the effects in a functor/applicative/monad."}, {"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1437644170, "post_id": 31582139, "comment_id": 51119600, "body": "@duplode I get that, but it doesn&#39;t matter if I log one or a thousand things per number. The point is that the logs are not truncated at all. As soon as I try using my infinite monadic computation I can only salvage the results of it. I can&#39;t do anything with the effects because they just go on forever."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1437644817, "post_id": 31582139, "comment_id": 51120000, "body": "But you can truncate the log, either in <code>longComputation</code> or in <code>main</code> (as Marius suggested). What you can&#39;t do is truncating the log (i.e. modifying the effects) just by changing the values within the functor (e.g. cutting the result list with <code>fmap</code>)."}, {"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1437645011, "post_id": 31582139, "comment_id": 51120120, "body": "@duplode Again, yes. I know I can truncate the log. I can run the Writer and do what ever I want with it&#39;s results AND it&#39;s log. That&#39;s why I tried to stick to general names like &quot;monadic effect&quot; and &quot;monadic computation&quot;. There are a ton more effects that have nothing to do with logging. What if I, for example had a state that I incremented by 1 for each value produced in the result? I can&#39;t run that by itself because the effect part would never compute, [continued]"}, {"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "edited": false, "score": 0, "creation_date": 1437645111, "post_id": 31582139, "comment_id": 51120180, "body": "yet I can write a perfectly simple function that instead of producing an infinite list, produces a list of fixed size and then use that a I wish. It feels like it should be possible to write infinite computations and still be able to actually use them WITHOUT escaping the monad in question."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1437650343, "post_id": 31582139, "comment_id": 51123719, "body": "I get we are talking about the general case. We run into the same issue with <code>fmap (take 10) $ sequence (fmap print [1..])</code>. The problem is that a chain of sequenced effects is not like a mapped-over list, that we can chop lazily at will, but closer to a fold, in which the whole depends on each part (in fact, <code>mapM_</code> is literally a fold, as <code>Data.Foldable</code> shows)."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1437650641, "post_id": 31582139, "comment_id": 51123902, "body": "BTW, I&#39;m not sure if it will clarify things or confuse them even more, but you might find streaming libraries such as <code>pipes</code> or <code>conduit</code> interesting. (Here is the <a href=\"https://hackage.haskell.org/package/pipes-4.1.5/docs/Pipes-Tutorial.html\" rel=\"nofollow noreferrer\">pipes tutorial</a>, a nice starting point). As far as I understand, something like <code>pipes</code> doesn&#39;t really affect this issue, but &quot;merely&quot; (sic!) states things in a more elegant and tractable way."}, {"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1437652374, "post_id": 31582139, "comment_id": 51125056, "body": "@duplode Thanks for the info. Again, if you&#39;d like to make this an answer, I&#39;ll accept it."}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1437656111, "post_id": 31587129, "comment_id": 51127763, "body": "This is the proper answer. I should have come up with a <code>pipes</code> example but got too entangled in the debate above to actually say something useful :)"}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 3, "last_activity_date": 1441228711, "last_edit_date": 1441228711, "creation_date": 1437653881, "answer_id": 31587129, "question_id": 31582139, "link": "https://stackoverflow.com/questions/31582139/maintaining-lazy-modularity-in-a-monadic-computation/31587129#31587129", "title": "Maintaining lazy modularity in a monadic computation", "body": "<p>If you want streams with effects that are only performed to the extent values are demanded from the stream, the you're best off with a streaming library, like <a href=\"https://hackage.haskell.org/package/pipes\" rel=\"nofollow\"><code>pipes</code></a> or <a href=\"https://hackage.haskell.org/package/conduit\" rel=\"nofollow\"><code>conduit</code></a>. For example, your code in <code>pipes</code> could look like this:</p>\n\n<pre><code>import Control.Monad.Writer\nimport Pipes\nimport qualified Pipes.Prelude as P\n\nints :: Monad m =&gt; Producer Int m r\nints = go 0 where go n = yield n &gt;&gt; go (n + 1)\n\nlongComputation :: MonadWriter [String] m =&gt; Producer Int m r\nlongComputation = for ints $ \\n -&gt; tell [show n] &gt;&gt; yield n\n\ntwoSmallComputations :: MonadWriter [String] m =&gt; Producer Int m ()\ntwoSmallComputations = do\n  longComputation &gt;-&gt; P.take 10\n  longComputation &gt;-&gt; P.take 10\n\nmain = do\n  let (res, log') = runWriter $ P.toListM twoSmallComputations\n  mapM_ print log'\n</code></pre>\n\n<p>Here, <code>ints</code> is an infinite stream that yields <code>Int</code>-s. <code>longComputation</code> iterates over the output of <code>ints</code> and adds the <code>Writer</code> effect. <code>twoSmallComputations</code> is a composite stream that first runs <code>longComputation &gt;-&gt; P.take 10</code> to exhaustion, then runs it once again.</p>\n\n<p><code>mapM_ print log'</code> now prints just the expected 20 numbers.</p>\n\n<p>See the excellent <a href=\"https://hackage.haskell.org/package/pipes-4.1.5/docs/Pipes-Tutorial.html\" rel=\"nofollow\">pipes tutorial</a> for further reference.   </p>\n"}], "owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 1, "accepted_answer_id": 31587129, "answer_count": 1, "score": 1, "last_activity_date": 1441228711, "creation_date": 1437640414, "question_id": 31582139, "link": "https://stackoverflow.com/questions/31582139/maintaining-lazy-modularity-in-a-monadic-computation", "title": "Maintaining lazy modularity in a monadic computation", "body": "<p>So an argument for laziness is that it allows a better separation of concerns. If I know how to provide data, I shouldn't just assume that the user of that data needs some finite chunk of it. Laziness allows me to produce an infinite list and then defer the processing/cutting of if to the consumer.</p>\n\n<p>I would like to extend this idea to also include monadic effects. This is the code I have</p>\n\n<pre><code>module Main where\n\nimport Control.Monad.Writer\n\nlongComputation :: Writer [String] [Int]\nlongComputation = do\n    let list = iterate (+1) 0\n    mapM (\\n -&gt; tell [show n] &gt;&gt; return n) list\n\ntwoSmallComputations :: Writer [String] [Int]\ntwoSmallComputations = do\n    first &lt;- fmap (take 10) longComputation\n    second &lt;- fmap (take 10) longComputation\n    return $ first ++ second\n\nmain :: IO ()\nmain = do\n    let (res, log') = runWriter twoSmallComputations\n    mapM_ print res\n</code></pre>\n\n<p>You can see that the logging is \"coupled\" with the production of the result. In the <code>main</code> function I'm printing the result of the two smaller computations that each just take a piece of the infinite one. This works as expected and I get two sets of numbers from 0 to 9 as output.</p>\n\n<p>Now, if I change the last line to <code>mapM_ print log'</code>, I don't get the same output. Instead I get an infinite listing of numbers.\nNow, I understand why this works how it does so I'm looking for a different approach.</p>\n\n<p>Is there any way to tie the effect tighter to the actual data produced so that it also gets cut? Because as things are at the moment I have to regress back from <code>... -&gt; m [a]</code> functions to <code>... -&gt; Int -&gt; m [a]</code> ones.</p>\n"}]