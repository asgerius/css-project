[{"tags": ["haskell", "functional-programming", "higher-order-functions"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1568236518, "post_id": 57896834, "comment_id": 102214853, "body": "A higher order function is either the one taking another function as argument or returning another function. So if we accept that <code>a</code> can only designate a non-function types (which is not necessarily true) then your professor is right."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 1, "last_activity_date": 1568236763, "creation_date": 1568236763, "answer_id": 57896938, "question_id": 57896834, "link": "https://stackoverflow.com/questions/57896834/a-haskell-function-is-higher-order-if-and-only-if-its-type-has-more-than-one-arr/57896938#57896938", "title": "A Haskell function is higher order if and only if its type has more than one arrow?", "body": "<p>Your functions are higher order. Indeed, take for example your function:</p>\n\n<pre><code>f :: a -&gt; a -&gt; a -&gt; a\nf x y z = x + y + z\n</code></pre>\n\n<p>This is a less verbose form of:</p>\n\n<pre><code>f :: a -&gt; (a -&gt; (a -&gt; a))\n</code></pre>\n\n<p>So it is a function that takes an <code>a</code> and <em>returns a function</em>. A higher order function is a function that (a) takes a function as parameter, or (b) returns a function. Both can be true at the same time. Here your function <code>f</code> returns a function.</p>\n\n<p>A function thus always has type <code>a -&gt; b</code> with <code>a</code> the input type, and <code>b</code> the return type. In case <code>a</code> has an arrow (like <code>(c -&gt; d) -&gt; b</code>), then it is a higher order function, since it takes a function as parameter.</p>\n\n<p>If <code>b</code> has an arrow, like <code>a -&gt; (c -&gt; d)</code>, then this is a higher order function as well, since it returns a function.</p>\n"}, {"comments": [{"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 3, "creation_date": 1568242727, "post_id": 57897023, "comment_id": 102216370, "body": "If <code>f :: a -&gt; b</code>, then even though <code>a</code> or <code>b</code> could be instantiated to a function type in a particular call of <code>f</code>, <code>f</code>&#39;s implementation cannot make use of the fact that it&#39;s operating on functions for that call. So I wouldn&#39;t call a polymorphic function with only one arrow higher-order, just because it could be instantiated to work on functions, any more than I would call it a string function just because it could be instantiated to work on strings. We statically know that it cannot do anything &quot;functiony&quot; or &quot;stringy&quot; with values of those types."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1568243265, "post_id": 57897023, "comment_id": 102216476, "body": "Agreed @Ben, and perhaps I misled - my use of type variables like <code>a</code> and <code>b</code> in that last section wasn&#39;t supposed to be referring to polymorphic functions, but I had in mind that <code>a</code> and <code>b</code> are more like &quot;placeholders&quot; that would be replaced by a particular type. And if that type happens to be a function type, even one that, due to a type synonym, isn&#39;t &quot;obviously&quot; a function type, then I am saying that we would still have a HOF, despite there being only one explicit arrow in the type signature."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 1, "creation_date": 1568245558, "post_id": 57897023, "comment_id": 102216935, "body": "Oh yes, I see what you&#39;re saying now, that&#39;s an important clarification. Sorry I misunderstood. I sometimes use capitalised identifiers for placeholders like that to avoid confusion with polymorphic variables, but then it&#39;s confusible that I&#39;m talking about specific types instead."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1568245690, "post_id": 57897023, "comment_id": 102216954, "body": "No problem at all, I should have been more careful, given that usually in Haskell things like <code>a -&gt; b</code> do indeed mean polymorphic types. I&#39;ll try to edit to make that clearer, but either way I think this is a useful discussion/clarification, so thanks for raising it!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1568248686, "post_id": 57897023, "comment_id": 102217520, "body": "Tiny nitpick: <code>Int -&gt; Proxy (Int -&gt; Int)</code> is a function type that has two arrows, but it is not the type of a higher-order function."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1568249806, "post_id": 57897023, "comment_id": 102217699, "body": "Fair point @DanielWagner, I guess I should clarify it to rule out a function type being applied as an argument to a higher-kinded type :)"}], "tags": [], "owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "is_accepted": false, "score": 5, "last_activity_date": 1568245869, "last_edit_date": 1568245869, "creation_date": 1568237180, "answer_id": 57897023, "question_id": 57896834, "link": "https://stackoverflow.com/questions/57896834/a-haskell-function-is-higher-order-if-and-only-if-its-type-has-more-than-one-arr/57897023#57897023", "title": "A Haskell function is higher order if and only if its type has more than one arrow?", "body": "<p>Strictly speaking, the statement is correct. This is because the usual definition of the term \"higher-order function\", taken here from <a href=\"https://en.wikipedia.org/wiki/Higher-order_function\" rel=\"nofollow noreferrer\">Wikipedia</a>, is a function that does one or both of the following:</p>\n\n<ul>\n<li>takes a function as an argument, or</li>\n<li>returns a function as its result</li>\n</ul>\n\n<p>It is clear then that no function with a single arrow in its type signature can be a higher-order function, because in a signature <code>a -&gt; b</code>, there is no \"room\" to create something of the form <code>x -&gt; y</code> on either side of an arrow - there simply aren't enough arrows.</p>\n\n<p>(This argument actually has a significant flaw, which you may have spotted, and which I'll address below. But it's probably true \"in spirit\" for what your professor meant.)</p>\n\n<p>The converse is also, strictly speaking, true in Haskell - although not in most other languages. The distinguishing feature of Haskell here is that functions are <em>curried</em>. For example, a function like <code>(+)</code>, whose signature is:</p>\n\n<pre><code>a -&gt; a -&gt; a\n</code></pre>\n\n<p>(with a <code>Num a</code> constraint that I'll ignore because it could just confuse the issue if we're supposed to be counting \"arrows\"), is usually thought of as being a function of two arguments: it takes 2 <code>a</code>s and produces another <code>a</code>. In most languages, which all of course have an analagous function/operator, this would never be described as a higher-order function. But in Haskell, because functions are curried, the above signature is really just a shorthand for the parenthesised version:</p>\n\n<pre><code>a -&gt; (a -&gt; a)\n</code></pre>\n\n<p>which clearly <em>is</em> a higher-order function. It takes an <code>a</code> and produces a function of type <code>a -&gt; a</code>. (Recall, from above, that returning a function is one of the things that characterises a HOF.) In Haskell, as I said, these two signatures are one and the same thing. <code>(+)</code> really <em>is</em> a higher-order function - we just often don't notice that because we intend to feed it two arguments, by which we really mean to feed it one argument, result in a function, then feed <em>that</em> function the second argument. Thanks to Haskell's convenient, parenthesis-free, syntax for applying functions to arguments, there isn't really any distinction. (This again contrasts from non-functional languages: the addition \"function\" there always takes exactly 2 arguments, and only giving it one will usually be an error. If the language has first-class functions, you can indeed define the curried form, for example this in Python:</p>\n\n<pre><code>def curried_add(x):\n    return lambda y: x + y\n</code></pre>\n\n<p>but this is clearly a different function from the straightforward function of two arguments that you would normally use, and usually less convenient to apply because you need to call it as <code>curried_add(x)(y)</code> rather than just say <code>add(x,y)</code>.</p>\n\n<p>So, if we take currying into account, the statement of your professor is strictly true.</p>\n\n<p>Well, with the following exception, which I alluded to above. I've been assuming that something with a signature of the form</p>\n\n<pre><code>a -&gt; b\n</code></pre>\n\n<p>is not a HOF*. That of course doesn't apply if <code>a</code> or <code>b</code> is a function. Often, that function's type will include an arrow, and we're tacitly assuming here that neither <code>a</code> or <code>b</code> contains arrows. Well, Haskell has type synonyms, so we could easily define, say:</p>\n\n<pre><code>type MyFunctionType = Int -&gt; Int\n</code></pre>\n\n<p>and then a function with signature <code>MyFunctionType -&gt; a</code> or <code>a -&gt; MyFunctionType</code> is most certainly a HOF, even though it doesn't \"look like one\" from just a glance at the signature.</p>\n\n<p>*To be clear here,<code>a</code> and <code>b</code> refer to specific types which are as yet unspecified - I am not referring to an actual signature <code>a -&gt; b</code> which would mean a polymorphic function that applies to <em>any</em> types <code>a</code> and <code>b</code>, which would not necessarily be functions.</p>\n"}, {"tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 1, "last_activity_date": 1568237466, "creation_date": 1568237466, "answer_id": 57897056, "question_id": 57896834, "link": "https://stackoverflow.com/questions/57896834/a-haskell-function-is-higher-order-if-and-only-if-its-type-has-more-than-one-arr/57897056#57897056", "title": "A Haskell function is higher order if and only if its type has more than one arrow?", "body": "<p>Yes, as Haskell functions are curried always, I can come up with minimal examples of higher order functions and examples:</p>\n\n<p>1) Functions that takes a function at least as parameter, such as:</p>\n\n<pre><code>apply :: (a -&gt; b) -&gt; a -&gt; b\napply f x = f x\n</code></pre>\n\n<p>2) at least 3 arguments:</p>\n\n<pre><code>sum3 :: Int -&gt; Int -&gt; Int\nsum3 a b c = a + b + c\n</code></pre>\n\n<p>so that can be read as:</p>\n\n<pre><code>sum3 :: Int -&gt; (Int -&gt; Int)\n</code></pre>\n"}], "owner": {"reputation": 67, "user_id": 6513302, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-xRXTUJh6Kxw/AAAAAAAAAAI/AAAAAAAAADk/e0-kuHsckiI/photo.jpg?sz=128", "display_name": "Kevin Chan", "link": "https://stackoverflow.com/users/6513302/kevin-chan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 434, "favorite_count": 0, "answer_count": 3, "score": 4, "last_activity_date": 1568277576, "creation_date": 1568236194, "last_edit_date": 1568277576, "question_id": 57896834, "link": "https://stackoverflow.com/questions/57896834/a-haskell-function-is-higher-order-if-and-only-if-its-type-has-more-than-one-arr", "title": "A Haskell function is higher order if and only if its type has more than one arrow?", "body": "<p>A professor teaching a class I am attending claimed the following.</p>\n\n<blockquote>\n  <p>A higher-order function could have only one arrow when checking its type. </p>\n</blockquote>\n\n<p>I don't agree with this statement I tried to prove it is wrong. I tried to set up some function but then I found that my functions probably aren't higher-order functions. Here is what I have:</p>\n\n<pre><code>f x y z = x + y + z\nf :: a -&gt; a-&gt;  a -&gt; a\n\ng = f 3\ng :: a -&gt; a -&gt; a\n\nh = g 5\nh :: a -&gt; a\n</code></pre>\n\n<p>At the end of the day, I think my proof was wrong, but I am still not convinced that higher-order functions can only have more than one arrow when checking the type.</p>\n\n<p>So, is there any resource or perhaps someone could prove that higher-order function may have only one arrow?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1568228587, "post_id": 57895317, "comment_id": 102211989, "body": "What is the type of <code>w</code> supposed to be?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 4, "creation_date": 1568228618, "post_id": 57895317, "comment_id": 102212008, "body": "<code>x:(isPalindrome xs)</code>  Please explain to your nearest rubber duck what this thing means, in detail."}, {"owner": {"reputation": 37, "user_id": 12054853, "user_type": "registered", "profile_image": "https://graph.facebook.com/2498491430190186/picture?type=large", "display_name": "Sean Roberts", "link": "https://stackoverflow.com/users/12054853/sean-roberts"}, "edited": false, "score": 0, "creation_date": 1568228669, "post_id": 57895317, "comment_id": 102212037, "body": "w is supposed to be the same type as the string I&#39;m taking in. So it should be [Char]"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1568228727, "post_id": 57895317, "comment_id": 102212065, "body": "<code>| otherwise = isPalindrome xs</code> says it&#39;s a <code>Bool</code> (because that&#39;s what <code>isPalindrome</code> returns)."}], "answers": [{"comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1568229006, "post_id": 57895432, "comment_id": 102212187, "body": "Or potentially <code>isAlphaNum x</code>."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 2, "last_activity_date": 1568229018, "last_edit_date": 1568229018, "creation_date": 1568228886, "answer_id": 57895432, "question_id": 57895317, "link": "https://stackoverflow.com/questions/57895317/how-to-fix-palindrome-function-in-haskell/57895432#57895432", "title": "How to fix palindrome function in Haskell", "body": "<p>You try to do too much in a single function. Your <code>w</code> is supposed to be a string. But you define <code>w</code> as:</p>\n\n<pre><code>where w | isDigit x = x:(isPalindrome xs)\n        | isAlpha (toUpper x) = x:(isPalindrome xs)\n        | otherwise = isPalindrome xs\n</code></pre>\n\n<p>You here thus write a condition, which is fine, but then you construct a list that starts with <code>x</code> (in the first two cases), and has <code>isPalindrome xs</code> as tail. But <code>isPalindrome xs</code> is not a <code>String</code>, it should be, given the function signature, be a <code>Bool</code>.</p>\n\n<p>That being said, I think you make things too complicated. We can make a <code>String</code> where we filter out the characters that are not digits or alpha characters with:</p>\n\n<pre><code>filter (\\x -&gt; isDigit x || isAlpha x)\n</code></pre>\n\n<p>or as <a href=\"https://stackoverflow.com/questions/57895317/how-to-fix-palindrome-function-in-haskell/57895432#comment102212187_57895432\">@melpomene says</a>, we can use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Char.html#v:isAlphaNum\" rel=\"nofollow noreferrer\"><strong><code>isAlphaNum :: Char -&gt; Bool</code></strong></a>:</p>\n\n<pre><code>filter isAlphaNum\n</code></pre>\n\n<p>So we can write such function as:</p>\n\n<pre><code>import Data.Char(isAlphaNum)\n\nisPalindrome :: String -&gt; Bool\nisPalindrome s = w == reverse w\n    where w = filter isAlphaNum s\n</code></pre>\n\n<p>We can use applicative style here, and work with:</p>\n\n<pre><code>import Control.Applicative(ap)\nimport Data.Char(isAlphaNum)\n\nisPalindrome :: String -&gt; Bool\nisPalindrome = ((==) &lt;*&gt; reverse) . filter isAlphaNum\n</code></pre>\n\n<p>We do not need to write cases for the empty list, or a singleton list, since these will be covered by the <code>w == reverse w</code>: the reverse of an empty list and singleton list is an empty and singleton list respectively.</p>\n\n<p>You can implement filtering yourself, but I suggest you do that in a separate function, not trying to do this in the same function. In fact it might make sense to separate the preprocessing step (removing characters that are non-digits and non-alphas from the string) in a separate function.</p>\n"}], "owner": {"reputation": 37, "user_id": 12054853, "user_type": "registered", "profile_image": "https://graph.facebook.com/2498491430190186/picture?type=large", "display_name": "Sean Roberts", "link": "https://stackoverflow.com/users/12054853/sean-roberts"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "accepted_answer_id": 57895432, "answer_count": 1, "score": 2, "last_activity_date": 1568232675, "creation_date": 1568228342, "last_edit_date": 1568232675, "question_id": 57895317, "link": "https://stackoverflow.com/questions/57895317/how-to-fix-palindrome-function-in-haskell", "title": "How to fix palindrome function in Haskell", "body": "<p>I'm trying to figure out why my palindrome function isn't working. Does it have to do with how I'm declaring 'w'? I'm attempting to take out all the letters and digits in a string, convert them to uppercase, and places it in a new string 'w'. I attempt to see if they're the same by checking if 'w' is the same as it is reverse</p>\n\n<pre><code>isPalindrome :: [Char] -&gt; Bool\nisPalindrome [] = True\nisPalindrome [a] = True\nisPalindrome (x:xs) | w == reverse w = True\n                    | otherwise = False\n                         where w        | isDigit x = x:(isPalindrome xs)  -- figured isDigit and isAlpha would be okay to use\n                                        | isAlpha (toUpper x) = x:(isPalindrome xs)  -- put this under so digits wouldn't have to do toUpper\n                                        | otherwise = isPalindrome xs\n</code></pre>\n\n<p>Obviously I expect the result to return true if it's a palindrome and false otherwise.</p>\n\n<p>The error I'm getting currently is:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>    * Couldn't match expected type `[Char]' with actual type `Bool'\n    * In the expression: isPalindrome xs\n      In an equation for `w':\n          w | isDigit x = x : (isPalindrome xs)\n            | isAlpha (toUpper x) = x : (isPalindrome xs)\n            | otherwise = isPalindrome xs\n      In an equation for `isPalindrome':\n          isPalindrome (x : xs)\n            | w == reverse w = True\n            | otherwise = False\n            where\n                w | isDigit x = x : (isPalindrome xs)\n                  | isAlpha (toUpper x) = x : (isPalindrome xs)\n                  | otherwise = isPalindrome xs\n   |\n48 |                                         | otherwise = isPalindrome xs\n   |\n</code></pre>\n"}, {"tags": ["haskell", "monads", "reader-monad"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1568225869, "post_id": 57894702, "comment_id": 102210771, "body": "What exactly is the issue you&#39;re having? &quot;No joy&quot; is not an error statement."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 4, "creation_date": 1568225911, "post_id": 57894702, "comment_id": 102210788, "body": "Try changing <code>(runReader</code> to <code>runReader (</code>."}], "answers": [{"comments": [{"owner": {"reputation": 2695, "user_id": 1924798, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1ba7bffbe41ca39353b6f8bbfd4624a8?s=128&d=identicon&r=PG", "display_name": "Marco Faustinelli", "link": "https://stackoverflow.com/users/1924798/marco-faustinelli"}, "edited": false, "score": 0, "creation_date": 1568266265, "post_id": 57895983, "comment_id": 102221067, "body": "You are a prince. Thank you! Can you further expand WHY do I need to run a transformer? I suppose that there is some monad layering hidden in the type m, but I cannot see it, yet."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 2695, "user_id": 1924798, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1ba7bffbe41ca39353b6f8bbfd4624a8?s=128&d=identicon&r=PG", "display_name": "Marco Faustinelli", "link": "https://stackoverflow.com/users/1924798/marco-faustinelli"}, "edited": false, "score": 1, "creation_date": 1568268545, "post_id": 57895983, "comment_id": 102221825, "body": "@MarcoFaustinelli To a first approximation, the <code>MonadReader Config m</code> constraint says that <code>m</code> is a monad transformer stack which contains <code>ReaderT Config</code> somewhere in the stack. The <code>MonadIO m</code> constraint says that the monad at the bottom of the stack is <code>IO</code>. So <code>ReaderT Config IO</code> is, in some sense, a sort of &quot;minimal&quot; monad transformer stack that satisfies the constraint."}, {"owner": {"reputation": 2695, "user_id": 1924798, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1ba7bffbe41ca39353b6f8bbfd4624a8?s=128&d=identicon&r=PG", "display_name": "Marco Faustinelli", "link": "https://stackoverflow.com/users/1924798/marco-faustinelli"}, "edited": false, "score": 0, "creation_date": 1568269982, "post_id": 57895983, "comment_id": 102222337, "body": "I am not familiar with naming transformers <a href=\"https://github.com/Muzietto/transformerz\" rel=\"nofollow noreferrer\">without the T at the end</a>; but if I look at <a href=\"http://hackage.haskell.org/package/mtl-2.2.2/docs/Control-Monad-Reader.html#g:1\" rel=\"nofollow noreferrer\">hackage</a> I do not see any instance of MonadReader that will fit the usage here. What am I missing?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 2695, "user_id": 1924798, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1ba7bffbe41ca39353b6f8bbfd4624a8?s=128&d=identicon&r=PG", "display_name": "Marco Faustinelli", "link": "https://stackoverflow.com/users/1924798/marco-faustinelli"}, "edited": false, "score": 2, "creation_date": 1568270171, "post_id": 57895983, "comment_id": 102222417, "body": "@MarcoFaustinelli <code>instance Monad m =&gt; MonadReader r (ReaderT r m)</code>, fourth from the bottom of the list of instances at the second link you provided, is the one being used here."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1568231748, "creation_date": 1568231748, "answer_id": 57895983, "question_id": 57894702, "link": "https://stackoverflow.com/questions/57894702/how-do-i-run-this-method-with-monadreader-and-monadio/57895983#57895983", "title": "How do I run this method with MonadReader and MonadIO?", "body": "<pre><code>runReaderT (load \"myFile.txt\") \"./\" :: IO String\n</code></pre>\n"}], "owner": {"reputation": 2695, "user_id": 1924798, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1ba7bffbe41ca39353b6f8bbfd4624a8?s=128&d=identicon&r=PG", "display_name": "Marco Faustinelli", "link": "https://stackoverflow.com/users/1924798/marco-faustinelli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "accepted_answer_id": 57895983, "answer_count": 1, "score": 1, "last_activity_date": 1568231748, "creation_date": 1568225647, "question_id": 57894702, "link": "https://stackoverflow.com/questions/57894702/how-do-i-run-this-method-with-monadreader-and-monadio", "title": "How do I run this method with MonadReader and MonadIO?", "body": "<p>I am following <a href=\"https://hackernoon.com/the-reader-monad-part-1-1e4d947983a8\" rel=\"nofollow noreferrer\">this post</a> about the reader monad in Haskell.</p>\n\n<p>It starts with the definition:</p>\n\n<pre><code>load :: Config -&gt; String -&gt; IO String\nload config x -&gt; readFile (config ++ x)\n</code></pre>\n\n<p>Where Config is a type alias for String and it represents a directory name.</p>\n\n<p>The method is meant to display on screen the content of a file, for example \"./myFile.txt\".</p>\n\n<p>I run this method from ghci with:</p>\n\n<pre><code>load \"./\" \"myFile.txt\"\n</code></pre>\n\n<p>The second example introduces the reader monad:</p>\n\n<pre><code>load :: (MonadReader Config m, MonadIO m) =&gt; String -&gt; m String\nload x = do\n    config &lt;- ask\n    liftIO $ readFile (config ++ x)\n</code></pre>\n\n<p>Question is: <strong>how do I run it from ghci</strong>?</p>\n\n<p>I have tried with things like:</p>\n\n<pre><code>(runReader load \"myFile.txt\") \"./\"\n</code></pre>\n\n<p>but no joy.</p>\n\n<p>What is the command that loads ./myFile.txt?</p>\n"}, {"tags": ["function", "haskell", "filter", "functional-programming", "tuples"], "answers": [{"tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": false, "score": 9, "last_activity_date": 1568225196, "last_edit_date": 1568225196, "creation_date": 1568224474, "answer_id": 57894432, "question_id": 57894308, "link": "https://stackoverflow.com/questions/57894308/filter-list-of-tuples-to-output-list-using-a-conditional/57894432#57894432", "title": "Filter list of tuples to output list using a conditional", "body": "<p>Think about this as a pipeline: first find the right elements, then transform them into the shape you need:</p>\n\n<pre><code>sumOfElements = map (\\(_,_,c) -&gt; c) . filter (\\(a,b,c) -&gt; a+b==c)\n</code></pre>\n\n<p>And trust that laziness and optimizations (specifically, foldr/build fusion) will make it performant.</p>\n"}, {"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1568234188, "post_id": 57896336, "comment_id": 102214043, "body": "&quot;I want to use the standard prelude (not recursion or list comprehension)&quot;"}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": false, "score": 2, "last_activity_date": 1568233507, "creation_date": 1568233507, "answer_id": 57896336, "question_id": 57894308, "link": "https://stackoverflow.com/questions/57894308/filter-list-of-tuples-to-output-list-using-a-conditional/57896336#57896336", "title": "Filter list of tuples to output list using a conditional", "body": "<p>You can do this more succinctly with a list comprehension:</p>\n\n<pre><code>sumOfElements list = [c | (a,b,c) &lt;- list, a+b==c]\n</code></pre>\n"}], "owner": {"reputation": 139, "user_id": 11091943, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db6fa21b5c90f680fe854c762e7050ac?s=128&d=identicon&r=PG&f=1", "display_name": "lex449", "link": "https://stackoverflow.com/users/11091943/lex449"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1568280477, "creation_date": 1568223835, "last_edit_date": 1568280477, "question_id": 57894308, "link": "https://stackoverflow.com/questions/57894308/filter-list-of-tuples-to-output-list-using-a-conditional", "title": "Filter list of tuples to output list using a conditional", "body": "<p>I want to use the standard Prelude in Haskell (no recursion, no list comprehension) to filter a list of tuples and then output a list of integers. It should check a list of 3-tuples that contain integers, e.g.,</p>\n\n<pre><code>[(1,2,3), (2,3,7), (4,5,20)]\n</code></pre>\n\n<p>and see if the sum of element #1 and #2 equals element #3. If it does, put element #3 in the list and then output the list. This is the output that I am looking for:</p>\n\n<pre><code>&gt;sumOfElements [(1,2,3), (2,3,7), (4,5,9)]\n[3,9]\n</code></pre>\n\n<p>This is what I have tried:</p>\n\n<pre><code>sumsOfElements :: [(Int, Int, Int)] -&gt; [Int]\nsumsOfElements list = filter (\\(a,b,c) -&gt; a+b==c) list\n</code></pre>\n\n<p>This kind of works but it outputs a list of tuples that meets the conditional.</p>\n\n<pre><code>&gt;sumOfElements [(1,2,3), (2,3,7), (4,5,9)]\n[(1,2,3), (4,5,9)]\n</code></pre>\n\n<p>I'm not sure how to take <code>c</code> from the tuple and append that element to a new list for the output.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1568225814, "post_id": 57894063, "comment_id": 102210755, "body": "What would be the result of <code>evenIncrease 7 3</code>? <code>[[7], [7,9], [7,9,11]]</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 12054406, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1046db78c7fcf4579561d3179b1fbfb3?s=128&d=identicon&r=PG&f=1", "display_name": "thebaconator", "link": "https://stackoverflow.com/users/12054406/thebaconator"}, "edited": false, "score": 0, "creation_date": 1568235812, "post_id": 57894249, "comment_id": 102214634, "body": "You are a life saver! :)"}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 6, "last_activity_date": 1568223527, "creation_date": 1568223527, "answer_id": 57894249, "question_id": 57894063, "link": "https://stackoverflow.com/questions/57894063/how-to-get-only-even-numbers-in-a-list-comprehension-of-lists-in-haskell/57894249#57894249", "title": "How to get only even numbers in a list comprehension of lists in Haskell", "body": "<p>You're correctly generating only even <em>endpoints</em>, but <code>[n..i]</code> still increments by 1, so even though both endpoints are even, you still get e.g <code>[6..8] = [6,7,8]</code>. Try <code>[n,n+2..i]</code>.</p>\n"}], "owner": {"reputation": 31, "user_id": 12054406, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1046db78c7fcf4579561d3179b1fbfb3?s=128&d=identicon&r=PG&f=1", "display_name": "thebaconator", "link": "https://stackoverflow.com/users/12054406/thebaconator"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1568223527, "creation_date": 1568222673, "last_edit_date": 1568223383, "question_id": 57894063, "link": "https://stackoverflow.com/questions/57894063/how-to-get-only-even-numbers-in-a-list-comprehension-of-lists-in-haskell", "title": "How to get only even numbers in a list comprehension of lists in Haskell", "body": "<p>I am trying to take a starting and a length and return a list of lists that gradually increases an even starting integer by 2</p>\n\n<p>For example:</p>\n\n<pre><code>evenIncrease 6 3\n</code></pre>\n\n<p>Should return:\n<code>[[6],[6,8],[6,8,10]]</code></p>\n\n<p>I am new to Haskell and so far my attempt looks like this:</p>\n\n<pre><code>evenIncrease n l = [[n..i] | i &lt;- [n..n+(l*2)-2], even i]\n</code></pre>\n\n<p>but when I attempt my example of <code>evenIncrease 6 3</code>, I get:</p>\n\n<p><code>[[6],[6,7,8],[6,7,8,9,10]]</code></p>\n\n<p>which is almost what I'm looking for but I don't understand why there are still odd numbers in the inner lists when I am using the guard \"even i\"</p>\n\n<p>any ideas?</p>\n"}, {"tags": ["haskell", "indentation"], "comments": [{"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "edited": false, "score": 0, "creation_date": 1568218317, "post_id": 57892797, "comment_id": 102207576, "body": "I cannot reproduce the error, where are you running your code?"}, {"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "edited": false, "score": 0, "creation_date": 1568218351, "post_id": 57892797, "comment_id": 102207588, "body": "Check here <a href=\"https://repl.it/repls/LightcoralInfamousMainframe\" rel=\"nofollow noreferrer\">repl.it/repls/LightcoralInfamousMainframe</a>"}, {"owner": {"reputation": 727, "user_id": 4200410, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/D59bV.jpg?s=128&g=1", "display_name": "Carsten H", "link": "https://stackoverflow.com/users/4200410/carsten-h"}, "reply_to_user": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "edited": false, "score": 0, "creation_date": 1568220655, "post_id": 57892797, "comment_id": 102208660, "body": "@Dami&#225;nRafaelLattenero Many thanks, it is actually a Bootfile for TidalCycles, not sure how to create a running example. It is executed as soon as the TidalCycles Atom Plugin is started: <a href=\"https://gist.github.com/carstenheisterkamp/1e7abdef28c8a868f8e4129aa7778196\" rel=\"nofollow noreferrer\">gist.github.com/carstenheisterkamp/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1568221375, "creation_date": 1568221375, "answer_id": 57893790, "question_id": 57892797, "link": "https://stackoverflow.com/questions/57892797/how-to-indent-osc-config-correctly/57893790#57893790", "title": "How to indent OSC config correctly", "body": "<p>I suspect whatever tool you are using is sending its output to ghci, rather than using ghc directly for some reason. ghci is designed to be interactive, and so by default, it accepts a line at a time and processes it immediately. This causes two problems: your type signature will be handled on its own, and ghci will complain that there's no accompanying binding; and the <code>unityTarget = OSCTarget {oName = \"unityTarget\",</code> line will be handled on its own, and ghci will complain that the <code>{</code> is not closed (but with the unhelpful \"parse error\" message you are probably seeing).</p>\n\n<p>The simplest fix is to enclose any multiline things with <code>:{</code> and <code>:}</code>, which are ghci's markers for beginning and ending a multiline command, as seen elsewhere in the example file you posted, so:</p>\n\n<pre><code>:{\nunityTarget :: OSCTarget\nunityTarget = OSCTarget {oName = \"unityTarget\",\n                         oAddress = \"10.0.0.3\",\n                         oPort = 7000,\n                         oPath = \"/tidal\",\n                         oShape = Nothing,\n                         oLatency = 0.02,\n                         oPreamble = [],\n                         oTimestamp = MessageStamp\n                        }\n:}\n</code></pre>\n"}], "owner": {"reputation": 727, "user_id": 4200410, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/D59bV.jpg?s=128&g=1", "display_name": "Carsten H", "link": "https://stackoverflow.com/users/4200410/carsten-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 31, "favorite_count": 0, "accepted_answer_id": 57893790, "answer_count": 1, "score": 1, "last_activity_date": 1568221375, "creation_date": 1568217227, "question_id": 57892797, "link": "https://stackoverflow.com/questions/57892797/how-to-indent-osc-config-correctly", "title": "How to indent OSC config correctly", "body": "<p>I am trying to find the right indentation for an OSC configuration in a haskell file. When I write the following in two lines it </p>\n\n<pre><code>unityTarget :: OSCTarget\nunityTarget = OSCTarget {oName = \"unityTarget\", oAddress = \"10.0.0.3\", oPort = 7000, oPath = \"/tidal\", oShape = Nothing, oLatency = 0.02, oPreamble = [], oTimestamp = MessageStamp }\n</code></pre>\n\n<p>works but if I use the following indentation, it doesn\u00b4t and gives me a parse error: possibly wrong indentation or missmatched brackets. I tried variations but none of them works. Any help appreciated.</p>\n\n<pre><code>unityTarget :: OSCTarget\nunityTarget = OSCTarget {oName = \"unityTarget\",\n                         oAddress = \"10.0.0.3\",\n                         oPort = 7000,\n                         oPath = \"/tidal\",\n                         oShape = Nothing,\n                         oLatency = 0.02,\n                         oPreamble = [],\n                         oTimestamp = MessageStamp\n                        }\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1568201972, "post_id": 57888231, "comment_id": 102198336, "body": "Why are there two underscores here?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 2, "creation_date": 1568213845, "post_id": 57888231, "comment_id": 102205128, "body": "Compile with warnings. <code>:set -Wall</code> in ghci"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1568202231, "creation_date": 1568202231, "answer_id": 57888406, "question_id": 57888231, "link": "https://stackoverflow.com/questions/57888231/non-exhaustive-patterns-in-function-checkstr-when-counting-number-of-nondigits-i/57888406#57888406", "title": "Non-exhaustive patterns in function checkStr when counting number of nondigits in string", "body": "<p>You here defined two functions <code>checkStr_</code> and <code>checkStr</code>. The last one only covers the patter <code>(str:ss)</code>. So eventually the list will be exhausted, and the it will be called with <code>[]</code>. You do not have any logic for that.</p>\n\n<p>You can implement this with:</p>\n\n<pre><code>checkStr :: String -&gt; Int\n<b>checkStr [] = 0</b>\ncheckStr (str:ss)\n   | str `elem` digits = checkStr ss\n   | otherwise = 1 + checkStr ss</code></pre>\n\n<p>That being said, we can make the above by <code>filter</code>ing on the <code>isDigit</code> function, and then calculate the length:</p>\n\n<pre><code>import Data.Char(isDigit)\n\ncheckStr :: String -> Int\ncheckStr = length . filter (not . isDigit)</code></pre>\n"}], "owner": {"reputation": 117, "user_id": 8738654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e13a61d4627532c3fd698f64a5be7504?s=128&d=identicon&r=PG&f=1", "display_name": "Jon Harper", "link": "https://stackoverflow.com/users/8738654/jon-harper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1568202231, "creation_date": 1568201568, "question_id": 57888231, "link": "https://stackoverflow.com/questions/57888231/non-exhaustive-patterns-in-function-checkstr-when-counting-number-of-nondigits-i", "title": "Non-exhaustive patterns in function checkStr when counting number of nondigits in string", "body": "<p>I made a program that is counting number of nondigits in string. It returns value based on how many nondigits were found. When I run my code Ghci says that \" Non-exhaustive patterns in function checkStr\". What's the problem?</p>\n\n<pre><code>checkStr:: String -&gt; Int\n\ndigits = ['0'..'9']\n\ncheckStr_ _ [] = 0\n\ncheckStr (str:ss)\n   | str `elem` digits = checkStr ss\n   | otherwise = 1 + checkStr ss\n</code></pre>\n"}, {"tags": ["parsing", "haskell", "trifecta"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1568221624, "post_id": 57886131, "comment_id": 102209073, "body": "What should happen with a line that says <code>Do I ignore this 2019-09-08</code>?"}, {"owner": {"reputation": 24109, "user_id": 775954, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9f5a87db35489d2958945f35b457f1ee?s=128&d=identicon&r=PG", "display_name": "Matthias Braun", "link": "https://stackoverflow.com/users/775954/matthias-braun"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1568274879, "post_id": 57886131, "comment_id": 102224534, "body": "Let&#39;s ignore those days. Only parse them if they are the only string in the line."}], "answers": [{"tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 2, "last_activity_date": 1568551290, "last_edit_date": 1568551290, "creation_date": 1568228267, "answer_id": 57895305, "question_id": 57886131, "link": "https://stackoverflow.com/questions/57886131/skip-everything-until-a-successful-parse/57895305#57895305", "title": "Skip everything until a successful parse", "body": "<p>There are three large problems here.</p>\n\n<p><strong>First</strong>, the way you're defining <code>dayParser</code>, it's always trying to parse <em>the rest of the text</em> as a date. For example, if your input text is <code>\"2019-01-01 foo bar\"</code>, then <code>dayParser</code> would first consume the whole string, so that <code>dayString == \"2019-01-01 foo bar\"</code>, and then will try to parse that string as a date. Which, of course, would fail.</p>\n\n<p>In order to have a saner behavior, you could only bite off the beginning of the string that kinda looks like a date and try to parse that, like:</p>\n\n<pre><code>dayParser =\n  parseDay =&lt;&lt; many (digit &lt;|&gt; char '-')\n</code></pre>\n\n<p>This implementation bites off the beginning of the input consisting of digits and dashes, and tries to parse that as a date. </p>\n\n<p>Note that this is a quick-n-dirty implementation. It is imprecise. For example, this implementation would accept input like <code>\"2019-01-0123456\"</code> and try to parse that as a date, and of course will fail. From your question, it is not clear whether you'd want to still parse <code>2019-01-01</code> and leave the rest, or whether you want to not consider that a proper date. If you wanted to be super-precise about this, you could specify the exact format as precisely as you want, e.g.:</p>\n\n<pre><code>dayParser = do\n  y &lt;- count 4 digit\n  void $ char '-'\n  m &lt;- try (count 2 digit) &lt;|&gt; count 1 digit\n  void $ char '-'\n  d &lt;- try (count 2 digit) &lt;|&gt; count 1 digit\n  parseDay $ y ++ \"-\" ++ m ++ \"-\" ++ d\n</code></pre>\n\n<p>This implementation expects exactly the format of the date.</p>\n\n<p><strong>Second</strong>, there is a logical problem: your <code>daysParser</code> tries to first parse some garbage, then parse many days, and then parse some garbage again. This logic does not admit a case where the many dates have some garbage <em>between</em> them.</p>\n\n<p><strong>Third</strong> problem is much more tricky. You see, the way the <code>try</code> combinator works - if the parser fails, then <code>try</code> will roll back the input position, but if the parser succeeds, then the input <em>remains consumed</em>! This means that you cannot use <code>try</code> as a zero-consumption lookahead, the way you're trying to do in <code>manyTill anyChar $ try dayParser</code>. Such a parser will parse until it finds a date, and then it will <em>consume the date</em>, leaving nothing for the next parser and causing it to fail.</p>\n\n<p>I will illustrate with a simpler example. Consider this:</p>\n\n<pre><code>&gt; parseString (many (char 'a')) mempty \"aaa\"\nSuccess \"aaa\"\n</code></pre>\n\n<p>Cool, it parses three <code>'a'</code>s. Now let's add a try at the beginning:</p>\n\n<pre><code>&gt; parseString (try (char 'b') *&gt; many (char 'a')) mempty \"aaa\"\nSuccess \"aaa\"\n</code></pre>\n\n<p>Awesome, this still works: the <code>try</code> fails, and then we parse three <code>'a'</code>s as before.</p>\n\n<p>Now let's change the try from <code>'b'</code> to <code>'a'</code>:</p>\n\n<pre><code>&gt; parseString (try (char 'a') *&gt; many (char 'a')) mempty \"aaa\"\nSuccess \"aa\"\n</code></pre>\n\n<p>Look what happened: the <code>try</code> has consumed the first <code>'a'</code>, leaving only two to be parsed by <code>many</code>.</p>\n\n<p>We can even extend it to more fully resemble your approach:</p>\n\n<pre><code>&gt; p = manyTill anyChar (try (char 'a')) *&gt; many (char 'a')\n\n&gt; parseString p mempty \"aaa\"\nSuccess \"aa\"\n\n&gt; parseString p mempty \"cccaaa\"\nSuccess \"aa\"\n</code></pre>\n\n<p>See what happens? <code>manyTill</code> correctly skips all the <code>'c'</code>s up to the first <code>'a'</code>, but then it <em>also consumes that first <code>'a'</code></em>!</p>\n\n<hr>\n\n<p>There appears to be no sane way (that I see) to have a zero-consumption lookahead like this. You always have to consume the first successful hit.</p>\n\n<p>If I had this problem, I would probably resort to recursion: parsing chars one by one, at every step looking if I can get a day, and concatenating in a list. Something like this:</p>\n\n<pre><code>data WhatsThis = AChar Char | ADay Day | EOF\n\ndaysParser = do\n  r &lt;- (ADay &lt;$&gt; dayParser) &lt;|&gt; (AChar &lt;$&gt; anyChar) &lt;|&gt; (EOF &lt;$ eof)\n  case r of\n    ADay d -&gt; do\n      rest &lt;- daysParser\n      pure $ d : rest\n    AChar _ -&gt;\n      daysParser\n    EOF -&gt;\n      pure []\n</code></pre>\n\n<p>It tries to parse a day, and if that fails, just skips a char, unless there are no more chars. If day parsing succeeded, it calls itself recursively, then prepends the day to the result of the recursive call.</p>\n\n<p>Note that this approach is not very composable: it always consumes everything till the end of the input. If you want to compose it with something else, you may want consider replacing <code>eof</code> with a parameter:</p>\n\n<pre><code>daysParser stop = do\n  r &lt;- (ADay &lt;$&gt; dayParser) &lt;|&gt; (AChar &lt;$&gt; anyChar) &lt;|&gt; (EOF &lt;$ stop)\n  ...\n</code></pre>\n"}], "owner": {"reputation": 24109, "user_id": 775954, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9f5a87db35489d2958945f35b457f1ee?s=128&d=identicon&r=PG", "display_name": "Matthias Braun", "link": "https://stackoverflow.com/users/775954/matthias-braun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 293, "favorite_count": 1, "accepted_answer_id": 57895305, "answer_count": 1, "score": 2, "last_activity_date": 1568551290, "creation_date": 1568194365, "last_edit_date": 1568196456, "question_id": 57886131, "link": "https://stackoverflow.com/questions/57886131/skip-everything-until-a-successful-parse", "title": "Skip everything until a successful parse", "body": "<p>I'd like to parse all days from a text like this:</p>\n\n<pre><code>Ignore this\nAlso this\n\n2019-09-05\n\nMore to ignore\n2019-09-06\n2019-09-07\n</code></pre>\n\n<p>Using Trifecta, I've defined a function to parse a day:</p>\n\n<pre><code>dayParser :: Parser Day\ndayParser = do\n  dayString &lt;- tillEnd\n  parseDay dayString\n\ntillEnd :: Parser String\ntillEnd = manyTill anyChar (try eof &lt;|&gt; eol)\n\nparseDay :: String -&gt; Parser Day\nparseDay s = maybe failure return dayMaybe\n where\n  dayMaybe = parseTime' dayFormat s\n  failure = unexpected $ \"Failed to parse date. Expected format: \" ++ dayFormat\n  -- %-m makes the parser accept months consisting of a single digit\n  dayFormat = \"%Y-%-m-%-d\"\n\neol :: Parser ()\neol = char '\\n' &lt;|&gt; char '\\r' &gt;&gt; return ()\n\n-- \"%Y-%-m-%-d\" for example\ntype TimeFormat = String\n\n-- Given a time format and a string, parses the string to a time.\nparseTime' :: (Monad m, ParseTime t) =&gt; TimeFormat -&gt; String -&gt; m t\n-- True means that the parser tolerates whitespace before and after the date\nparseTime' = parseTimeM True defaultTimeLocale\n</code></pre>\n\n<p>Parsing a day this way works. What I'm having trouble with is <em>ignoring</em> anything in the text that's not a day.</p>\n\n<p>The following can't work since it assumes the number of text blocks that aren't a day:</p>\n\n<pre><code>daysParser :: Parser [Day]\ndaysParser = do\n  -- Ignore everything that's not a day\n  _    &lt;- manyTill anyChar $ try dayParser\n  days &lt;- many $ token dayParser\n  _    &lt;- manyTill anyChar $ try dayParser\n  -- There might be more days after this...\n  return days\n</code></pre>\n\n<p>I reckon there's a straightforward way to express this with Trifecta but I can't seem to find it.</p>\n\n<hr>\n\n<p>Here's the whole module including an example text to parse:</p>\n\n<pre><code>{-# LANGUAGE QuasiQuotes #-}\nmodule DateParser where\nimport           Text.RawString.QQ\nimport           Data.Time\nimport           Text.Trifecta\nimport           Control.Applicative            ( (&lt;|&gt;) )\n\n-- \"%Y-%-m-%-d\" for example\ntype TimeFormat = String\n\ndayParser :: Parser Day\ndayParser = do\n  dayString &lt;- tillEnd\n  parseDay dayString\n\ntillEnd :: Parser String\ntillEnd = manyTill anyChar (try eof &lt;|&gt; eol)\n\nparseDay :: String -&gt; Parser Day\nparseDay s = maybe failure return dayMaybe\n where\n  dayMaybe = parseTime' dayFormat s\n  failure = unexpected $ \"Failed to parse date. Expected format: \" ++ dayFormat\n  -- %-m makes the parser accept months consisting of a single digit\n  dayFormat = \"%Y-%-m-%-d\"\n\neol :: Parser ()\neol = char '\\n' &lt;|&gt; char '\\r' &gt;&gt; return ()\n\n-- Given a time format and a string, parses the string to a time.\nparseTime' :: (Monad m, ParseTime t) =&gt; TimeFormat -&gt; String -&gt; m t\n-- True means that the parser tolerates whitespace before and after the date\nparseTime' = parseTimeM True defaultTimeLocale\n\ndaysParser :: Parser [Day]\ndaysParser = do\n  -- Ignore everything that's not a day\n  _    &lt;- manyTill anyChar $ try dayParser\n  days &lt;- many $ token dayParser\n  _    &lt;- manyTill anyChar $ try dayParser\n  -- There might be more days after this...\n  return days\n\ntest = parseString daysParser mempty text1\n\ntext1 = [r|\nIgnore this\nAlso this\n\n2019-09-05\n\nMore to ignore\n2019-09-06\n2019-09-07|]\n</code></pre>\n"}, {"tags": ["file", "haskell", "functional-programming", "system.io.file"], "answers": [{"tags": [], "owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "is_accepted": false, "score": 3, "last_activity_date": 1568180315, "creation_date": 1568180315, "answer_id": 57882746, "question_id": 57882652, "link": "https://stackoverflow.com/questions/57882652/how-to-read-from-a-file-using-haskell/57882746#57882746", "title": "How to read from a file using Haskell?", "body": "<p>There are two reasons why it does not compile. First, <code>let</code> is absent, to quote GHC:</p>\n\n<pre><code>Perhaps you need a 'let' in a 'do' block?\n    e.g. 'let x = 5' instead of 'x = 5'\n</code></pre>\n\n<p>The other one is:</p>\n\n<pre><code>The last statement in a 'do' block must be an expression\n  let contents1 = lines contents\n</code></pre>\n\n<p>After fixing both it compiles and runs:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  contents &lt;- readFile \"input.txt\" \n  let contents1 = lines contents\n  print contents1\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 11882183, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9065932e2b5338e2a92b2e253f6fbb64?s=128&d=identicon&r=PG&f=1", "display_name": "dvargasp", "link": "https://stackoverflow.com/users/11882183/dvargasp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "closed_date": 1568180376, "answer_count": 1, "score": -2, "last_activity_date": 1568180315, "creation_date": 1568179774, "question_id": 57882652, "link": "https://stackoverflow.com/questions/57882652/how-to-read-from-a-file-using-haskell", "closed_reason": "Duplicate", "title": "How to read from a file using Haskell?", "body": "<p>I am trying to read from a file. I want to split each line from a file into its own string. I am thinking of using the lines command in order to make a list of Strings of all the lines. I then plan to use the words command to spilt each line into a list of words. However, I am very new to functional programming/Haskell, and I don't fully understand the syntax. So, to begin, how do you read each line from a file and store it? </p>\n\n<p>I attempted the following code, but it does not compile. </p>\n\n<pre><code>main :: IO ()\nmain = do\n  contents &lt;- readFile \"input.txt\" \n  contents1 = lines contents\n</code></pre>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1568208228, "post_id": 57882337, "comment_id": 102201915, "body": "If you are using <code>fish</code>, why do you care about updating <code>.bashrc</code>? <code>fish</code> doesn&#39;t use it."}], "answers": [{"tags": [], "owner": {"reputation": 679, "user_id": 5348509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ueCIT.jpg?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/5348509/michael"}, "is_accepted": true, "score": 3, "last_activity_date": 1568177593, "creation_date": 1568177593, "answer_id": 57882338, "question_id": 57882337, "link": "https://stackoverflow.com/questions/57882337/resolving-is-not-a-valid-variable-in-fish-error-when-installing-ghc-the-h/57882338#57882338", "title": "Resolving &quot; ${ is not a valid variable in fish&quot; error when installing ghc (the Haskell compiler) on MacOs with fish", "body": "<p>The error has to do with the fish syntax for declaring variables. I was able to get it to work by simply changing the contents of <code>User/admin/.ghcup/env</code> to the following.</p>\n\n<pre><code>export PATH=\"$HOME/.cabal/bin:$HOME/.ghcup/bin:$PATH\"\n</code></pre>\n"}], "owner": {"reputation": 679, "user_id": 5348509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ueCIT.jpg?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/5348509/michael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 721, "favorite_count": 0, "accepted_answer_id": 57882338, "answer_count": 1, "score": 0, "last_activity_date": 1568177990, "creation_date": 1568177593, "last_edit_date": 1568177990, "question_id": 57882337, "link": "https://stackoverflow.com/questions/57882337/resolving-is-not-a-valid-variable-in-fish-error-when-installing-ghc-the-h", "title": "Resolving &quot; ${ is not a valid variable in fish&quot; error when installing ghc (the Haskell compiler) on MacOs with fish", "body": "<p>When following <a href=\"https://www.haskell.org/ghcup/\" rel=\"nofollow noreferrer\">these instructions</a> for installing ghc, the installer presented me with this question.</p>\n\n<pre><code>Detected ~/.bashrc on your system...\nIf you want ghcup to automatically fix your ~/.bashrc to include the required PATH variable\nanswer with YES and press ENTER (at your own risk).\n</code></pre>\n\n<p>To which I responded \"yes.\"</p>\n\n<p>This added a file at <code>Users/admin/.ghcup/env</code> which was automatically set to be sourced by my <code>.bashrc</code> file. However, after sourcing my <code>.bashrc</code> file, the compiler was still not added to my <code>PATH</code> environment variable. So I tried sourcing <code>Users/admin/.ghcup/env</code> directly and got this error.</p>\n\n<pre><code>~/.ghcup/env (line 1): ${ is not a valid variable in fish.\nexport PATH=\"$HOME/.cabal/bin:${GHCUP_INSTALL_BASE_PREFIX:=$HOME}/.ghcup/bin:$PATH\"\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 27, "user_id": 12013587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b921c97c1fb20fe3c7b241b8402d7a1?s=128&d=identicon&r=PG&f=1", "display_name": "alisemiles", "link": "https://stackoverflow.com/users/12013587/alisemiles"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1568143645, "post_id": 57877030, "comment_id": 102178936, "body": "I get : Oblig1.hs:15:1: error: parse error on input <code>ord</code> (ord:: String -&gt; [String] is on line 15"}, {"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 3, "creation_date": 1568143738, "post_id": 57877030, "comment_id": 102178979, "body": "There are several issues: 1. You need parens around <code>(x:xs)</code>, 2. you need an <code>else</code> for your last <code>if</code>, or probably to not have a second <code>if</code> since it only inverts the condition of the first, 3. there is no variable <code>s</code>, 4. you&#39;re mixing up chars, strings, and string lists. Please consider starting smaller and building out, so that you only have to solve one problem at a time"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1568146646, "post_id": 57877030, "comment_id": 102180128, "body": "Could not reproduce. With the code in your edit, I do not get a parse error. Therefore the problem is almost certainly in a part of the file you are not showing us."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 2, "creation_date": 1568156284, "post_id": 57877030, "comment_id": 102182818, "body": "If the compiler were complaining about a parse error within this code, it would normally point at somewhere in the middle, not at the initial <code>ord</code>. Probably the function (or import or whatever) <i>above</i> this contains an error. If a previous syntactic structure isn&#39;t &quot;closed&quot; properly, and the first thing that the compiler notices to be definitely wrong is your attempt to start the definition of a new function <code>ord</code>, then this is the error you&#39;d get. But that means you haven&#39;t included the code with the error."}], "answers": [{"comments": [{"owner": {"reputation": 27, "user_id": 12013587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b921c97c1fb20fe3c7b241b8402d7a1?s=128&d=identicon&r=PG&f=1", "display_name": "alisemiles", "link": "https://stackoverflow.com/users/12013587/alisemiles"}, "edited": false, "score": 0, "creation_date": 1568279061, "post_id": 57877121, "comment_id": 102226633, "body": "Thanks for the tips! I was stuck for a while, but ended up writing new code that was simpler. I did have other functions as well, but they run fine."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 5, "last_activity_date": 1568143676, "creation_date": 1568143676, "answer_id": 57877121, "question_id": 57877030, "link": "https://stackoverflow.com/questions/57877030/why-do-i-get-parse-error-on-my-function-name/57877121#57877121", "title": "Why do I get parse error on my function name?", "body": "<p>You need parentheses around the pattern matching a non-empty list:</p>\n\n<pre><code>ord (x:xs) = ...\n</code></pre>\n\n<p>Once you've fixed this, you have a number of other problems to fix as well.</p>\n"}], "owner": {"reputation": 27, "user_id": 12013587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b921c97c1fb20fe3c7b241b8402d7a1?s=128&d=identicon&r=PG&f=1", "display_name": "alisemiles", "link": "https://stackoverflow.com/users/12013587/alisemiles"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 188, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1568144302, "creation_date": 1568143262, "last_edit_date": 1568144302, "question_id": 57877030, "link": "https://stackoverflow.com/questions/57877030/why-do-i-get-parse-error-on-my-function-name", "title": "Why do I get parse error on my function name?", "body": "<p>I've written my code but when I try to compile I get this error: parse error on input `ord'</p>\n\n<p>I'm still learning Haskell, and are starting to get more comfortable with it. I've looked online for an answer, but can't find any that help me with my problem. </p>\n\n<pre><code>ord :: String -&gt; [String]\nord [] = []\nord x:xs = if x == \" \" then x:(ord s) else\n        if x /= \" \" then x ++ (ord s)\n</code></pre>\n\n<p>I'm quite stuck and can't figure out why I get this error. Can anyone help?</p>\n\n<p>EDIT:</p>\n\n<p>Thanks for the help, guys! I've altered my code, but still get the same error...</p>\n\n<pre><code>ord :: String -&gt; [String]\nord [] = []\nord (x:xs) = if x == \" \" then x:(ord xs) \n            else if x /= \" \" then x ++ (ord xs)\n                else []\n</code></pre>\n\n<p>btw: function is supposed to take in a string, and split the words by the spaces and put them into a table.\nF.ex: </p>\n\n<blockquote>\n  <p>ord \"hi my name is annack\"\n  should give : [\"hi\",\"my\",\"name\",\"is\",\"annack\"]</p>\n</blockquote>\n"}, {"tags": ["haskell", "io", "monads", "semantics", "state-monad"], "comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 1, "creation_date": 1568133908, "post_id": 57874635, "comment_id": 102175121, "body": "Your type doesn&#39;t hold any sort of state, so a <code>MonadState</code> instance would be nonsensical for it. What&#39;s the problem you&#39;re trying to solve?"}, {"owner": {"reputation": 313, "user_id": 12047827, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/465cdede6feeb53d122d87d7ccd42c5e?s=128&d=identicon&r=PG&f=1", "display_name": "arryn", "link": "https://stackoverflow.com/users/12047827/arryn"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1568134268, "post_id": 57874635, "comment_id": 102175290, "body": "@FyodorSoikin the task is: &quot;Define a MonadState instance for Teletype/IO&quot;. There was also a question after it &quot;How is the behaviour of this instance different from the usual State type?&quot;, maybe this is it."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1568134299, "post_id": 57874635, "comment_id": 102175308, "body": "Oh, so this is homework?"}, {"owner": {"reputation": 313, "user_id": 12047827, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/465cdede6feeb53d122d87d7ccd42c5e?s=128&d=identicon&r=PG&f=1", "display_name": "arryn", "link": "https://stackoverflow.com/users/12047827/arryn"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 1, "creation_date": 1568134403, "post_id": 57874635, "comment_id": 102175354, "body": "@FyodorSoikin not really, I am just learning Haskell and this is one of the tasks I found. Does it matter?"}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 1, "last_activity_date": 1568134580, "creation_date": 1568134580, "answer_id": 57875284, "question_id": 57874635, "link": "https://stackoverflow.com/questions/57874635/statemonad-instance-for-teletypeio/57875284#57875284", "title": "StateMonad instance for TeletypeIO", "body": "<p><code>MonadState</code> takes two arguments, in this order:</p>\n\n<ol>\n<li><p>the type of the state</p></li>\n<li><p>the monad</p></li>\n</ol>\n\n<p>In this case the monad is <code>IO</code>:</p>\n\n<pre><code>instance MonadState _ IO where\n  ...\n</code></pre>\n\n<p>And you need to figure out what goes in place of the underscore</p>\n"}, {"comments": [{"owner": {"reputation": 313, "user_id": 12047827, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/465cdede6feeb53d122d87d7ccd42c5e?s=128&d=identicon&r=PG&f=1", "display_name": "arryn", "link": "https://stackoverflow.com/users/12047827/arryn"}, "edited": false, "score": 0, "creation_date": 1568136092, "post_id": 57875385, "comment_id": 102176003, "body": "I understand why <code>get</code> and <code>put</code> are what they are (with <code>state</code>), I just don&#39;t understand why Haskell already knows how should <code>state</code> work, without definition."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "reply_to_user": {"reputation": 313, "user_id": 12047827, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/465cdede6feeb53d122d87d7ccd42c5e?s=128&d=identicon&r=PG&f=1", "display_name": "arryn", "link": "https://stackoverflow.com/users/12047827/arryn"}, "edited": false, "score": 0, "creation_date": 1568136242, "post_id": 57875385, "comment_id": 102176064, "body": "Haskell doesn&#39;t know. This is defined in the library. <code>get</code>/<code>put</code> are defined via <code>state</code>, and <code>state</code> is defined via <code>get</code>/<code>put</code>. Whichever part you choose to implement, the other one will come for free."}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 2, "last_activity_date": 1568136548, "last_edit_date": 1568136548, "creation_date": 1568134982, "answer_id": 57875385, "question_id": 57874635, "link": "https://stackoverflow.com/questions/57874635/statemonad-instance-for-teletypeio/57875385#57875385", "title": "StateMonad instance for TeletypeIO", "body": "<p>As I mentioned in the comments, your type doesn't really hold any state, so a <code>StateMonad</code> instance would be nonsensical for it.</p>\n\n<p>However, since this is just an exercise (also based on the comments), I guess it's ok to implement the instance technically, even if it doesn't do what you'd expect it to do.</p>\n\n<p><strong>First,</strong> the compiler error you're getting tells you that the <code>MonadState</code> class actually takes <em>two</em> arguments - the type of the state and the type of the monad, where monad has to have kind <code>* -&gt; *</code>, that is, have a type parameter, like <code>Maybe</code>, or list, or <code>Identity</code>. </p>\n\n<p>In your case, the monad in question (not really a monad, but ok) is <code>IO</code>, and the type of your \"state\" is <code>Char</code>, since that's what you're <code>get</code>ting and <code>put</code>ting. So the declaration has to look like this:</p>\n\n<pre><code>instance MonadState Char IO where\n</code></pre>\n\n<p><strong>Second,</strong> the <code>state</code> method doesn't have the signature <code>(s -&gt; s) -&gt; m s</code> as you claim, but rather <code>(s -&gt; (a, s)) -&gt; m a</code>. See <a href=\"https://www.stackage.org/haddock/lts-14.5/mtl-2.2.2/Control-Monad-State-Class.html#v:state\" rel=\"nofollow noreferrer\">its definition</a>. What it's supposed to do is create a computation in monad <code>m</code> out of a function that takes a state and returns \"result\" plus new (updated) state.</p>\n\n<p>Note also that this is the most general operation on the State monad, and both <code>get</code> and <code>put</code> can be expressed in terms of <code>state</code>:</p>\n\n<pre><code>get = state $ \\s -&gt; (s, s)\nput s = state $ \\_ -&gt; ((), s)\n</code></pre>\n\n<p>This means that you do not have to implement <code>get</code> and <code>put</code> yourself. You only need to implement the <code>state</code> function, and <code>get</code>/<code>put</code> will come from default implementations.</p>\n\n<p>Incidentally, this works the other way around as well: if you define <code>get</code> and <code>put</code>, the definition of <code>state</code> will come from the default:</p>\n\n<pre><code>state f = do\n    s &lt;- get\n    let (a, s') = f s\n    put s'\n    return a\n</code></pre>\n\n<p><strong>And now,</strong> let's see how this can actually be implemented.</p>\n\n<p>The semantics of the <code>state</code>'s parameter is this: it's a function that takes some state as input, then performs some computation based on that state, and this computation has some result <code>a</code>, and it also may modify the state in some way; so the function returns both the result and the new, modified state.</p>\n\n<p>In your case, the way to \"get\" the state from your \"monad\" is via <code>GetChar</code>, and the way in which is \"returns\" the <code>Char</code> is by calling a function that you pass to it (such function is usually referred to as \"continuation\").</p>\n\n<p>The way to \"put\" the state back into your \"monad\" is via <code>PutChar</code>, which takes the <code>Char</code> you want to \"put\" as a parameter, plus some <code>IO a</code> that represents the computation \"result\".</p>\n\n<p>So, the way to implement <code>state</code> would be to (1) first \"get\" the <code>Char</code>, then (2) apply the function to it, then (3) \"put\" the resulting new <code>Char</code>, and then (3) return the \"result\" of the function. Putting it all together:</p>\n\n<pre><code>state f = GetChar $ \\c -&gt; let (a, c') = f c in PutChar c' (Done a)\n</code></pre>\n\n<p><strong>As further exercise</strong>, I encourage you to see how <code>get</code> and <code>put</code> would unfold, starting from the definitions I gave above, and performing step-by-step substitution. Here, I'll give you a couple first steps:</p>\n\n<pre><code>get = state $ \\s -&gt; (s, s)\n    -- Substituting definition of `state`\n    = GetChar $ \\c -&gt; let (a, c') = (\\s -&gt; (s, s)) c in PutChar c' (Done a)\n    -- Substituting (\\s -&gt; (s, s)) c == (c, c)\n    = GetChar $ \\c -&gt; let (a, c') = (c, c) in PutChar c' (Done a)\n    = &lt;and so on...&gt;\n</code></pre>\n"}], "owner": {"reputation": 313, "user_id": 12047827, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/465cdede6feeb53d122d87d7ccd42c5e?s=128&d=identicon&r=PG&f=1", "display_name": "arryn", "link": "https://stackoverflow.com/users/12047827/arryn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 57875385, "answer_count": 2, "score": 3, "last_activity_date": 1568136548, "creation_date": 1568131960, "last_edit_date": 1568135537, "question_id": 57874635, "link": "https://stackoverflow.com/questions/57874635/statemonad-instance-for-teletypeio", "title": "StateMonad instance for TeletypeIO", "body": "<p>So, I have this datatype (it's from here: <a href=\"https://wiki.haskell.org/IO_Semantics\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/IO_Semantics</a>):</p>\n\n<pre><code>data IO a = Done a\n      | PutChar Char (IO a)\n      | GetChar (Char -&gt; IO a)\n</code></pre>\n\n<p>and I thought of writing a StateMonad instance for it.  I have already written Monad and Applicative instances for it. </p>\n\n<pre><code>instance MonadState (IO s) where\n  get    = GetChar (\\c -&gt; Done c)\n  put    = PutChar c (Done ())\n  state f = Done (f s)\n</code></pre>\n\n<p>I don't think I fully understand what state (it was named 'modify' before) is supposed to do here.   </p>\n\n<pre><code>state :: (s -&gt; (a, s)) -&gt; m a\n</code></pre>\n\n<p>I also have messed up with declarations. I don't really understand what is wrong, let alone how to fix it. Would appreciate your help.</p>\n\n<pre><code>Expecting one more argument to \u2018MonadState (IO s)\u2019\nExpected a constraint,\nbut \u2018MonadState (IO s)\u2019 has kind \u2018(* -&gt; *) -&gt; Constraint\u2019\nIn the instance declaration for \u2018MonadState (IO s)\u2019\n</code></pre>\n"}, {"tags": ["haskell", "monads"], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 8600572, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FfwkI.gif?s=128&g=1", "display_name": "Killimanjaro", "link": "https://stackoverflow.com/users/8600572/killimanjaro"}, "edited": false, "score": 0, "creation_date": 1568125690, "post_id": 57872861, "comment_id": 102170743, "body": "Isnt that essentially what have in join&#39; originally? Also thank you."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 45, "user_id": 8600572, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FfwkI.gif?s=128&g=1", "display_name": "Killimanjaro", "link": "https://stackoverflow.com/users/8600572/killimanjaro"}, "edited": false, "score": 0, "creation_date": 1568125975, "post_id": 57872861, "comment_id": 102170920, "body": "@Killimanjaro: In your <code>join&#39;</code> you wrapped the value in a <code>Thing</code>, instead of unwrapping. Notice the <code>concat xs</code>, and the the <code>Things xs</code> in the head. Not vice versa."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1568128272, "post_id": 57872861, "comment_id": 102172249, "body": "...but even after this fix, the monad laws are not satisfied. See my answer."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1568131253, "post_id": 57872861, "comment_id": 102173816, "body": "@DanielWagner: no indeed, I&#39;m not sure we can construct a monad here."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1568125346, "creation_date": 1568125346, "answer_id": 57872861, "question_id": 57872727, "link": "https://stackoverflow.com/questions/57872727/trouble-with-creating-join-when-making-monad-instance-of-an-object/57872861#57872861", "title": "Trouble with creating join when making monad instance of an object", "body": "<p>A <code>Thing</code> contains a list of list of <code>a</code>s. So that means that a <code>Thing (Thing a)</code> contains a list of list of <code>Thing a</code>s, and these thus contain a list of list of <code>a</code>s.</p>\n\n<p>We could thus concatenate these lists together. We can first unpack the outer <code>Thing</code>, which will give us a <code>[[ Thing a ]]</code>. By using <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:concat\" rel=\"nofollow noreferrer\"><strong><code>concat :: Foldable f =&gt; f [a] -&gt; [a]</code></strong></a>, we convert this to a <code>[Thing a]</code>. Now we can use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:concatMap\" rel=\"nofollow noreferrer\"><strong><code>concatMap :: Foldable f =&gt; (a -&gt; [b]) -&gt; f a -&gt; [b]</code></strong></a> with <code>runThing</code> as function, to transform this to a <code>[[a]]</code>, and then we can wrap that value back in a <code>Thing</code>:</p>\n\n<pre><code>join' :: Thing (Thing a) -&gt; Thing a\njoin' (Thing xs) = Thing (<b>concatMap</b> runThing (<b>concat</b> xs))</code></pre>\n"}, {"comments": [{"owner": {"reputation": 45, "user_id": 8600572, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FfwkI.gif?s=128&g=1", "display_name": "Killimanjaro", "link": "https://stackoverflow.com/users/8600572/killimanjaro"}, "edited": false, "score": 0, "creation_date": 1568128785, "post_id": 57873690, "comment_id": 102172520, "body": "Happened to see that too when i added that same exact line with bind"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 45, "user_id": 8600572, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FfwkI.gif?s=128&g=1", "display_name": "Killimanjaro", "link": "https://stackoverflow.com/users/8600572/killimanjaro"}, "edited": false, "score": 0, "creation_date": 1568129071, "post_id": 57873690, "comment_id": 102172676, "body": "@Killimanjaro Never mind, I was wrong as usual. Even the <i>swap</i> construction doesn&#39;t work properly; I should have known I would have to sit down and prove the conditions they stated instead of just guessing. The construction seems to satisfy the identity laws, but the associativity law is still not satisfied."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1568129013, "last_edit_date": 1568129013, "creation_date": 1568128254, "answer_id": 57873690, "question_id": 57872727, "link": "https://stackoverflow.com/questions/57872727/trouble-with-creating-join-when-making-monad-instance-of-an-object/57873690#57873690", "title": "Trouble with creating join when making monad instance of an object", "body": "<p>The smallest fix to your original definition of <code>join'</code> is to use <code>runThing</code> instead of <code>Thing</code>, and then add a top-level wrapper:</p>\n\n<pre><code>join' xs = Thing (concat (map runThing (concat (runThing xs))))\n</code></pre>\n\n<p>We can then define <code>(&gt;&gt;=)</code> in terms of <code>fmap</code> and <code>join'</code> in the standard way:</p>\n\n<pre><code>xss &gt;&gt;= f = join' (fmap f xss)\n</code></pre>\n\n<p>Unfortunately, this definition doesn't satisfy the monad laws:</p>\n\n<pre><code>&gt; Thing [[1,2]] &gt;&gt;= return\nThing [[1],[2]]\n</code></pre>\n\n<p>The laws require that the result of that computation be again <code>Thing [[1,2]]</code>.</p>\n\n<p><s>However, using the <em>swap</em> construction from <a href=\"http://web.cecs.pdx.edu/~mpj/pubs/RR-1004.pdf\" rel=\"nofollow noreferrer\">Composing Monads</a> with <code>swap = sequence</code>, we can construct this alternate <code>join'</code>:</p>\n\n<pre><code>join' = Thing . join . fmap (fmap join . sequence . fmap runThing) . runThing\n</code></pre>\n\n<p>I believe, though I have not proven, that the conditions required of <code>swap</code> are satisfied, so that this whole construction may be used to produce a law-abiding monad.</s></p>\n\n<p>The construction proposed above fails the associativity law. Rats! In conclusion: everything I've tried so far to give an alternate <code>join'</code> fails at least one of the monad laws.</p>\n"}], "owner": {"reputation": 45, "user_id": 8600572, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FfwkI.gif?s=128&g=1", "display_name": "Killimanjaro", "link": "https://stackoverflow.com/users/8600572/killimanjaro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 1, "accepted_answer_id": 57873690, "answer_count": 2, "score": 1, "last_activity_date": 1568129013, "creation_date": 1568124918, "last_edit_date": 1568125580, "question_id": 57872727, "link": "https://stackoverflow.com/questions/57872727/trouble-with-creating-join-when-making-monad-instance-of-an-object", "title": "Trouble with creating join when making monad instance of an object", "body": "<p>I currently have a newtype instance which I should translate into a monad. I am having trouble with defining the bind to this particular monad where the newtype is defined as:</p>\n\n<pre><code>newtype Thing xs = Thing {runThing :: [[xs]]} deriving (Show)\n</code></pre>\n\n<p>I have defined a join that takes the monad one level down. </p>\n\n<pre><code>join' :: Thing(Thing a) -&gt; Thing a\njoin' xs = (concat (map runThing (concat (Thing xs))))\n</code></pre>\n\n<p>and planned to apply the function in the bind like so</p>\n\n<pre><code>Thing xs &gt;&gt;= f = Thing(map (map f) $ (runThing (Thing xs)))\n</code></pre>\n\n<p>which doesn't compile and also tried:</p>\n\n<pre><code>join' xs =  head (concat (runThing xs))\nThing a &gt;&gt;= f =join' (fmap f (Thing a)) \n</code></pre>\n\n<p>does but I understand that it only maps to the head of a list and uses the fmap I defined in a functor like so:</p>\n\n<pre><code>instance Functor  Thing where\n    fmap f (Thing [[]]) = Thing [[]]\n    fmap f (Thing a) = Thing (nestedMap f a)\n</code></pre>\n\n<p>How would I build a join that allows me to map and create a new Thing?</p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1568158740, "post_id": 57871608, "comment_id": 102183277, "body": "If I understand correctly, you can just call the handler function you wrote, same as you would call any other function. I&#39;m assuming there&#39;s something I&#39;m missing or misunderstanding?"}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "reply_to_user": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1568186225, "post_id": 57871608, "comment_id": 102190397, "body": "The problem is actuall to find the correct handler to call. For example, given &quot;/a/1&quot; I would like to find the handler corresponding to route &quot;/a&quot; apply &quot;1&quot; to it and pass me the result. I can convert the string to a route and pattern match on the route to find the correct handler, but that&#39;s already what Yesod does each time it processes a request, so I instead of reinventing the wheel, I would like to be able to use Yesod machinery."}], "answers": [{"comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1568215735, "post_id": 57892382, "comment_id": 102206207, "body": "parseRoute does half of the job (a third in fact). The first job is to split the url into components, the second is to convert those components into a route (which is what parseRoute does) and the third is to find and call the handler corresponding to the route."}], "tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": false, "score": 0, "last_activity_date": 1568215647, "creation_date": 1568215647, "answer_id": 57892382, "question_id": 57871608, "link": "https://stackoverflow.com/questions/57871608/how-to-call-an-handler-from-an-url-in-yesod/57892382#57892382", "title": "How to call an handler from an URL in Yesod", "body": "<p>Doesn't <code>parseRoute</code> method of <a href=\"https://hackage.haskell.org/package/yesod-core-1.6.16.1/docs/Yesod-Core.html#t:ParseRoute\" rel=\"nofollow noreferrer\">ParseRoute</a> typeclass work for you?</p>\n"}], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 74, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1568215647, "creation_date": 1568121219, "question_id": 57871608, "link": "https://stackoverflow.com/questions/57871608/how-to-call-an-handler-from-an-url-in-yesod", "title": "How to call an handler from an URL in Yesod", "body": "<p>I'm writting a Yesod application and I need to be to call a handler internally from a URL or a Route.</p>\n\n<p>What I mean is when you send a request to Yesod, at some point is parses the URL to a <code>Route</code> and then call to the correct handler using a dispatch function. I would like to be able to call those functions manually so that I can create a route from a URL and the call the appropriate handler.</p>\n"}, {"tags": ["haskell", "monad-transformers"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1568106674, "post_id": 57867446, "comment_id": 102160125, "body": "It is not entirely clear what should happen in case it is a <code>Nothing</code>. Should this be treated as if it was an empty list?"}, {"owner": {"reputation": 817, "user_id": 2028789, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/87137cdab4a0807b5955761743e30a19?s=128&d=identicon&r=PG", "display_name": "xwinus", "link": "https://stackoverflow.com/users/2028789/xwinus"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1568107413, "post_id": 57867446, "comment_id": 102160527, "body": "@WillemVanOnsem good point, in this use case I think we can safely treat <code>Nothing</code> as empty list."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1568123863, "post_id": 57867446, "comment_id": 102169684, "body": "<code>f1</code> is not a function; it&#39;s an <code>IO</code> action."}], "answers": [{"comments": [{"owner": {"reputation": 817, "user_id": 2028789, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/87137cdab4a0807b5955761743e30a19?s=128&d=identicon&r=PG", "display_name": "xwinus", "link": "https://stackoverflow.com/users/2028789/xwinus"}, "edited": false, "score": 0, "creation_date": 1568123856, "post_id": 57867687, "comment_id": 102169679, "body": "This one made that for me. Thanks for explaining the source code in detail, this is extra helpful."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1568107197, "creation_date": 1568107197, "answer_id": 57867687, "question_id": 57867446, "link": "https://stackoverflow.com/questions/57867446/haskell-how-to-combine-two-monadic-maybe-functions-into-a-single-function/57867687#57867687", "title": "Haskell - How to combine two monadic Maybe functions into a single function", "body": "<p>A candidate could be:</p>\n\n<pre><code>result :: IO (Maybe [Y])\nresult = f1 &gt;&gt;= fmap sequenceA . mapM f2 . concat</code></pre>\n\n<p>Here <code>concat</code> is a function <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:concat\" rel=\"nofollow noreferrer\"><strong><code>concat :: Foldable f =&gt; f [a] -&gt; [a]</code></strong></a> that will convert a <code>Nothing</code> to an empty list, and a <code>Just xs</code> to <code>xs</code>.</p>\n\n<p>We can then make a <code>mapM f2</code> to generate an <code>IO [Maybe a]</code>, and <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:fmap\" rel=\"nofollow noreferrer\"><strong><code>fmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b</code></strong></a> with <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:sequenceA\" rel=\"nofollow noreferrer\"><strong><code>sequenceA :: (Applicative f, Traversable t) =&gt; t (f a) -&gt; f (t a)</code></strong></a> to convert an <code>IO [Maybe Y]</code> to an <code>IO (Maybe [Y])</code>.</p>\n\n<p><code>sequenceA</code> will return a <code>Nothing</code> if the list contains one or more <code>Nothing</code>s, and return a <code>Just xs</code> if the list contains only <code>Just</code>s with <code>xs</code> the values that originally have been wrapped in <code>Just</code>s.</p>\n"}, {"tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": false, "score": 6, "last_activity_date": 1568111112, "creation_date": 1568111112, "answer_id": 57868802, "question_id": 57867446, "link": "https://stackoverflow.com/questions/57867446/haskell-how-to-combine-two-monadic-maybe-functions-into-a-single-function/57868802#57868802", "title": "Haskell - How to combine two monadic Maybe functions into a single function", "body": "<p>Essentially it's using <code>fmap sequenceA . sequenceA . fmap f2</code>. </p>\n\n<p>Using <code>do</code> syntax and breaking it down one step at a time:</p>\n\n<p><code>result</code> and <code>result'</code> gives you the same result.</p>\n\n<pre><code>data X = X\ndata Y = Y\n\nf1 :: IO (Maybe [X])\nf1 = undefined\n\nf2 :: X -&gt; IO (Maybe Y)\nf2 = undefined\n\nresult :: IO (Maybe [Y])\nresult = do\n f1' &lt;- f1\n case f1' of\n   Just f1'' -&gt; do\n     let a = fmap f2 f1'' :: [IO (Maybe Y)]\n     let b = sequenceA a :: IO [Maybe Y]\n     fmap sequenceA b :: IO (Maybe [Y])\n   Nothing -&gt; pure Nothing\n\nresult' :: IO (Maybe [Y])\nresult' = do\n f1' &lt;- f1\n case f1' of\n   Just f1'' -&gt; do\n     fmap sequenceA . sequenceA . fmap f2 $ f1''\n   Nothing -&gt; pure Nothing\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 3, "last_activity_date": 1568140170, "creation_date": 1568140170, "answer_id": 57876439, "question_id": 57867446, "link": "https://stackoverflow.com/questions/57867446/haskell-how-to-combine-two-monadic-maybe-functions-into-a-single-function/57876439#57876439", "title": "Haskell - How to combine two monadic Maybe functions into a single function", "body": "<p><strong>note</strong>: this answer is not very suitable for Haskell newcomers because it involves a monad transformer.</p>\n\n<p>Once we start mixing <code>IO</code> with the processing and generation of lists, I tend to jump straight away to the <a href=\"http://hackage.haskell.org/package/streaming-0.2.2.0/docs/Streaming.html#t:Stream\" rel=\"nofollow noreferrer\"><code>Stream</code></a> monad transformer from <a href=\"http://hackage.haskell.org/package/streaming\" rel=\"nofollow noreferrer\">streaming</a>, that allows you to cleanly  interleave the execution of <code>IO</code> actions with the \"yielding\" of values to be consumed downstream. In a way, <code>Stream</code> is an \"effectful list\" that performs effects every time we \"extract\" a value from it.</p>\n\n<p>Consider this version of <code>f1</code>:</p>\n\n<pre><code>import Streaming\nimport qualified Streaming.Prelude as S\nimport Data.Foldable (fold)\n\nf1' :: Stream (Of X) IO ()\nf1' = do\n    mxs &lt;- lift f1\n    S.each (fold mxs)  \n</code></pre>\n\n<p><a href=\"http://hackage.haskell.org/package/transformers-0.5.6.2/docs/Control-Monad-Trans-Class.html#v:lift\" rel=\"nofollow noreferrer\"><code>lift</code></a> promotes an <code>IO a</code> action to a <code>Stream (Of x) a</code> that doesn\u2019t yield anything, but returns <code>a</code> as the \"final value\" of the Stream. (<code>Stream</code>s yield zero or more values when consumed, and return a final value of a different type once they are exhausted).</p>\n\n<p><a href=\"http://hackage.haskell.org/package/streaming-0.2.2.0/docs/Streaming-Prelude.html#v:each\" rel=\"nofollow noreferrer\"><code>Streaming.Prelude.each</code></a> takes anything that can be converted to a list and returns a <code>Stream</code> that yields the element of the list. Basically, it promotes pure lists to effectful lists.</p>\n\n<p>And <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Foldable.html#v:fold\" rel=\"nofollow noreferrer\"><code>Data.Foldable.fold</code></a> is working here with the type <code>fold :: Maybe [a] -&gt; [a]</code> to get rid of that <code>Maybe</code>.</p>\n\n<p>Here's the corresponding version of <code>f2</code>:</p>\n\n<pre><code>f2' :: X -&gt; Stream (Of Y) IO ()\nf2' x = do\n   ys &lt;- lift (f2 x)\n   S.each ys\n</code></pre>\n\n<p>Combining them is quite simple, thanks to <a href=\"http://hackage.haskell.org/package/streaming-0.2.2.0/docs/Streaming-Prelude.html#v:for\" rel=\"nofollow noreferrer\"><code>Streaming.Prelude.for</code></a>.</p>\n\n<pre><code>result' :: Stream (Of Y) IO ()\nresult' = S.for f1' f2'\n</code></pre>\n\n<p>With functions like <a href=\"http://hackage.haskell.org/package/streaming-0.2.2.0/docs/Streaming-Prelude.html#v:take\" rel=\"nofollow noreferrer\"><code>Streaming.Prelude.take</code></a>, we could read one <code>Y</code> from the result without having to perform the effects required by the next <code>Y</code>. (We do need to read all the <code>X</code>s in one go though, because the <code>f1</code> we are given already does that).</p>\n\n<p>If we want to get all the <code>Y</code>s, we can do it with <a href=\"http://hackage.haskell.org/package/streaming-0.2.2.0/docs/Streaming-Prelude.html#v:toList_\" rel=\"nofollow noreferrer\"><code>Streaming.Prelude.toList_</code></a>:</p>\n\n<pre><code>result :: IO [Y]\nresult = S.toList_ result'\n</code></pre>\n"}], "owner": {"reputation": 817, "user_id": 2028789, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/87137cdab4a0807b5955761743e30a19?s=128&d=identicon&r=PG", "display_name": "xwinus", "link": "https://stackoverflow.com/users/2028789/xwinus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 636, "favorite_count": 1, "accepted_answer_id": 57867687, "answer_count": 3, "score": 6, "last_activity_date": 1568140170, "creation_date": 1568106372, "last_edit_date": 1568117559, "question_id": 57867446, "link": "https://stackoverflow.com/questions/57867446/haskell-how-to-combine-two-monadic-maybe-functions-into-a-single-function", "title": "Haskell - How to combine two monadic Maybe functions into a single function", "body": "<p>Let's say I have these two data records, X and Y and following two functions:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>f1 :: IO (Maybe [X])\nf2 :: X -&gt; IO (Maybe Y)\n</code></pre>\n\n<p>I need to call the <code>f1</code> first and then, for each element of returned list (stored in <code>IO (Maybe)</code>) call the <code>f2</code>, which would result in something like <code>IO (Maybe [IO (Maybe Y)])</code>. How can I compose them to get something meaningful, such as</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>result :: Maybe (IO [Y])\n</code></pre>\n\n<p>or</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>result :: IO (Maybe [Y])\n</code></pre>\n\n<p>?</p>\n\n<p>Thanks a lot for any help :-)</p>\n"}, {"tags": ["haskell", "functor"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1568104189, "post_id": 57866812, "comment_id": 102158845, "body": "No, if you let Haskell derive the functor automatically, it raises an error: &quot;<i>Constructor \u2018In\u2019 must not use the type variable in a function argument</i>&quot;."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1568104244, "post_id": 57866812, "comment_id": 102158873, "body": "If you <code>fmap</code>, you are given a function <code>a -&gt; b</code>, not a function <code>b -&gt; a</code>, so you can not &quot;convert back&quot;. Unless of course you use a (rather) nonsensical implementation (by passing  <code>undefined</code> as parameter, etc.), but that will likely raise other problems, making it break the functor laws."}, {"owner": {"reputation": 3960, "user_id": 1556475, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dbf54fca536242c214a1f99a6b9b8931?s=128&d=identicon&r=PG", "display_name": "Cameron Ball", "link": "https://stackoverflow.com/users/1556475/cameron-ball"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1568104461, "post_id": 57866812, "comment_id": 102158991, "body": "Your second comments makes a lot of sense. I had the feeling it wasn&#39;t possible but not the reasoning."}, {"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 4, "creation_date": 1568105322, "post_id": 57866812, "comment_id": 102159417, "body": "In general, if you have a ADT like <code>data MyType a b = MyConstructor (a  -&gt; b)</code>, then <code>MyType</code> is <i>covariant</i> in argument <code>b</code>  and <i>contravariant</i> in argument <code>a</code> (depending on which side of the arrow each argument is). <i>Covariants functors</i> are regular haskell functors, whereas <i>contravariant functors</i> can be instantiate to <code>Contravariant</code> type class. If your data is both, you can make an instance of  <code>Profunctor</code> type class"}, {"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 1, "creation_date": 1568105833, "post_id": 57866812, "comment_id": 102159680, "body": "Btw, <i>profunctors</i> are defined for two paramaters types. So, AFAIK, you should modify your data type if you go in this direction"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 5, "last_activity_date": 1568139952, "last_edit_date": 1568139952, "creation_date": 1568120660, "answer_id": 57871454, "question_id": 57866812, "link": "https://stackoverflow.com/questions/57866812/is-it-possible-to-write-a-functor-instance-for-this-type/57871454#57871454", "title": "Is it possible to write a functor instance for this type?", "body": "<p>I suspect the type you <em>actually</em> want is this one (or some specialization where you have chosen a specific <code>i</code>):</p>\n\n<pre><code>data MyType i o = Done o | Out o (MyType i o) | In (i -&gt; MyType i o)\n</code></pre>\n\n<p>The primary difference here is that the <code>In</code> constructor uses separate types for the argument and result of the function it contains. You should find the <code>Functor</code> instance much easier to write once you have separated the input and output parameters like this.</p>\n"}], "owner": {"reputation": 3960, "user_id": 1556475, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dbf54fca536242c214a1f99a6b9b8931?s=128&d=identicon&r=PG", "display_name": "Cameron Ball", "link": "https://stackoverflow.com/users/1556475/cameron-ball"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1568139952, "creation_date": 1568104042, "question_id": 57866812, "link": "https://stackoverflow.com/questions/57866812/is-it-possible-to-write-a-functor-instance-for-this-type", "title": "Is it possible to write a functor instance for this type?", "body": "<p>Given:</p>\n\n<pre><code>data MyType a = Done a | Out a (MyType a) | In (a -&gt; MyType a)\n</code></pre>\n\n<p>I'm struggling to implement <code>fmap f (In x)</code>. My initial thought was <code>In $ \\y -&gt; fmap f (x y)</code> but that doesn't work since <code>x</code> operates on a <code>MyType a</code> - it's like I need someway to fmap over both the argument as well as the stuff \"inside\", if that makes sense. I guess what I'm looking for is a way to create <code>b -&gt; m b</code>  from <code>a -&gt; m a</code> given an <code>a -&gt; b</code> - is that possible?</p>\n"}, {"tags": ["list", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "edited": false, "score": 0, "creation_date": 1568237695, "post_id": 57863889, "comment_id": 102215200, "body": "Very nice answer. Covers all"}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1604435280, "post_id": 57863889, "comment_id": 114346193, "body": "This outputs your list: take 3 [ [5..n] | n &lt;- [5..] ]"}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": true, "score": 4, "last_activity_date": 1568088125, "creation_date": 1568088125, "answer_id": 57863889, "question_id": 57862965, "link": "https://stackoverflow.com/questions/57862965/create-a-list-of-lists-with-increasing-numbers-in-haskell/57863889#57863889", "title": "Create a list of lists with increasing numbers in Haskell", "body": "<p>This will work:</p>\n\n<pre><code>listIncrease :: Int -&gt; Int -&gt; [[Int]]\nlistIncrease a b = [[a..i] | i &lt;- [a..a+b-1]]\n</code></pre>\n\n<p>To understand why this works, consider evaluating the outer layers for your example of 5 and 3: <code>[[5..i] | i &lt;- [5..7]]</code>, <code>[[5..i] | i &lt;- [5,6,7]]</code>, and then <code>[[5..5], [5..6], [5..7]]</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 0, "last_activity_date": 1568135074, "last_edit_date": 1568135074, "creation_date": 1568092779, "answer_id": 57864414, "question_id": 57862965, "link": "https://stackoverflow.com/questions/57862965/create-a-list-of-lists-with-increasing-numbers-in-haskell/57864414#57864414", "title": "Create a list of lists with increasing numbers in Haskell", "body": "<p>If you want to do it with traditional pattern matching you can try:</p>\n\n<pre><code>listIncrease :: Int -&gt; Int -&gt; [[Int]]\nlistIncrease a 0 = []\nlistIncrease a 1 = [[a]]\nlistIncrease a b = reverse $ ([a..a+b-1] : [a..a+b-2] : (listIncrease a (b-2)))\n</code></pre>\n\n<p>since the number could be odd and also you are making two steps each recursion, you should add the extra patter when the number its <code>1</code> , and reverse the list to has the desire order.</p>\n\n<p>An optimized version using Sequence should be:</p>\n\n<pre><code>import Data.Sequence ((|&gt;), empty, fromList)\nimport Data.Foldable (toList)\n\nlistIncrease :: Int -&gt; Int -&gt; [[Int]]\nlistIncrease a b = toList (fromSeq a b)\n\nfromSeq a 0 = empty\nfromSeq a 1 = fromList([[a]])\nfromSeq a b = (fromSeq a (b-2)) |&gt; [a..a+b-2] |&gt; [a..a+b-1]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "is_accepted": false, "score": 1, "last_activity_date": 1568096797, "creation_date": 1568096797, "answer_id": 57865120, "question_id": 57862965, "link": "https://stackoverflow.com/questions/57862965/create-a-list-of-lists-with-increasing-numbers-in-haskell/57865120#57865120", "title": "Create a list of lists with increasing numbers in Haskell", "body": "<p>I think this is the cleanest recursive implementation:</p>\n\n<pre><code>listIncrease :: Int -&gt; Int -&gt; [[Int]]\nlistIncrease a 0 = []\nlistIncrease a b = map (a:) $ [] : listIncrease (a + 1) (b - 1)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1568099505, "post_id": 57865632, "comment_id": 102156613, "body": "Lol, we wrote nearly exact the same answer at nearly the same time :)"}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": false, "score": 3, "last_activity_date": 1568099138, "creation_date": 1568099138, "answer_id": 57865632, "question_id": 57862965, "link": "https://stackoverflow.com/questions/57862965/create-a-list-of-lists-with-increasing-numbers-in-haskell/57865632#57865632", "title": "Create a list of lists with increasing numbers in Haskell", "body": "<p>There is a standard library function just for this - <code>inits</code>. It returns all possible prefixes of a list, including the empty one:</p>\n\n<pre><code>&gt; inits ['a', 'b', 'c']\n[[], ['a'], ['a', 'b'], ['a', 'b', 'c']]\n</code></pre>\n\n<p>To get what you need, you just have to drop the first empty list, and you're done:</p>\n\n<pre><code>listIncrease a n = drop 1 $ inits [a .. (a+n-1)]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 6, "last_activity_date": 1568099460, "creation_date": 1568099460, "answer_id": 57865713, "question_id": 57862965, "link": "https://stackoverflow.com/questions/57862965/create-a-list-of-lists-with-increasing-numbers-in-haskell/57865713#57865713", "title": "Create a list of lists with increasing numbers in Haskell", "body": "<p>We can construct a range with:</p>\n\n<pre><code>[5 .. 7]\n</code></pre>\n\n<p>to create the final list we want:</p>\n\n<pre><code>Prelude&gt; [5 .. 7]\n[5,6,7]\n</code></pre>\n\n<p>We can then use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:inits\" rel=\"noreferrer\"><strong><code>inits :: [a] -&gt; [[a]]</code></strong></a> to generate all prefixes:</p>\n\n<pre><code>Prelude Data.List&gt; inits [5 .. 7]\n[[],[5],[5,6],[5,6,7]]\n</code></pre>\n\n<p>We can use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:drop\" rel=\"noreferrer\"><strong><code>drop :: Int -&gt; [a] -&gt; [a]</code></strong></a> to omit the first element.</p>\n\n<p>We can thus implement <code>listIncrease</code> as:</p>\n\n<pre><code>import Data.List(inits)\n\nlistIncrease :: (Num a, Enum a) =&gt; a -&gt; a -&gt; [[a]]\nlistIncrease lo n = drop 1 (inits [lo .. lo + n - 1])\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>Prelude Data.List&gt; listIncrease 7 0\n[]\nPrelude Data.List&gt; listIncrease 7 1\n[[7]]\nPrelude Data.List&gt; listIncrease 7 2\n[[7],[7,8]]\nPrelude Data.List&gt; listIncrease 7 3\n[[7],[7,8],[7,8,9]]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1568166355, "last_edit_date": 1568166355, "creation_date": 1568165902, "answer_id": 57880927, "question_id": 57862965, "link": "https://stackoverflow.com/questions/57862965/create-a-list-of-lists-with-increasing-numbers-in-haskell/57880927#57880927", "title": "Create a list of lists with increasing numbers in Haskell", "body": "<p>Another option involving <code>inits</code>: create an <em>infinite</em> list of ranges, drop the first (empty) range, then take the next <code>n</code> elements:</p>\n\n<pre><code>listIncrease from n = take n (tail (inits [from..]))\n</code></pre>\n\n<hr>\n\n<p>This even has a nearly readable point-free version:</p>\n\n<pre><code>listIncrease = flip take . tail . inits . enumFrom\n</code></pre>\n\n<p>A quick explanation, showing the type of each step and an example using 5 and 3 as the arguments:</p>\n\n<ul>\n<li><code>enumFrom :: Enum a =&gt; a -&gt; [a]</code> produces <code>[5..]</code></li>\n<li><code>inits . enumFrom :: Enum a =&gt; a -&gt; [[a]]</code> produces <code>[[],[5],[5,6],[5,6,7],...]</code></li>\n<li><code>tail . inits . enumFrom :: Enum a =&gt; a -&gt; [[a]]</code> produces <code>[[5],[5,6],[5,6,7],...]</code></li>\n<li><code>flip take . tail . inits . enumFrom :: Enum a =&gt; a -&gt; Int -&gt; [[a]]</code> produces a function call <code>(flip take) [[5],[5,6],[5,6,7],...] 3 == take 3 [[5],[5,6],[5,6,7],...] == [[5],[5,6],[5,6,7]]</code></li>\n</ul>\n"}], "owner": {"reputation": 139, "user_id": 11091943, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db6fa21b5c90f680fe854c762e7050ac?s=128&d=identicon&r=PG&f=1", "display_name": "lex449", "link": "https://stackoverflow.com/users/11091943/lex449"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1630, "favorite_count": 0, "accepted_answer_id": 57863889, "answer_count": 6, "score": 3, "last_activity_date": 1568166355, "creation_date": 1568079223, "question_id": 57862965, "link": "https://stackoverflow.com/questions/57862965/create-a-list-of-lists-with-increasing-numbers-in-haskell", "title": "Create a list of lists with increasing numbers in Haskell", "body": "<p>When given a starting number and an increment, I want to be able to create a lists of lists in Haskell.</p>\n\n<p>For example:</p>\n\n<pre><code>&gt;listIncrease 5 3\n[[5], [5,6], [5,6,7]]\n</code></pre>\n\n<p>I have tried using a recursive function but I haven't been able to get the function just right.</p>\n\n<p>This is what I currently have:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>listIncrease :: Int -&gt; Int -&gt; [[Int]]\nlistIncrease a 0 = []\nlistIncrease a b = [[a..a+b-1], (listIncrease a (b-2))]\n</code></pre>\n\n<p>I know this won't work because of the base case and because of the base case being incorrect, and the recursive step because you can't take an [[Int]] to be an [Int].</p>\n"}, {"tags": ["haskell", "ghc"], "answers": [{"comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1568090340, "post_id": 57862362, "comment_id": 102153766, "body": "As I understand it, the way laziness is handled is that when something in an old generation is alive and has a child evaluated, the child allocates in the same generation as its parent. I could be off, but it would make that claim true."}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1568091231, "post_id": 57862362, "comment_id": 102153950, "body": "That would make sense"}], "tags": [], "owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "is_accepted": false, "score": 2, "last_activity_date": 1568072450, "creation_date": 1568072450, "answer_id": 57862362, "question_id": 57861109, "link": "https://stackoverflow.com/questions/57861109/does-immutability-improve-gc-performance-in-lazily-evaluated-languages/57862362#57862362", "title": "Does immutability improve GC performance in lazily evaluated languages?", "body": "<p>That page in the wikibook contains a link to an accurate description of GHC's garbage collector and the logic behind it (<a href=\"http://simonmar.github.io/bib/papers/parallel-gc.pdf\" rel=\"nofollow noreferrer\">http://simonmar.github.io/bib/papers/parallel-gc.pdf</a>); by one of the people who actually wrote it.</p>\n\n<p>GHC uses a generational garbage collector. It doesn't traverse every object in every garbage collection phase, but splits the heap into 3 \"generations\" numbered 0, 1, and 2. When objects are created they are initially placed in generation 0; which is traversed every time the garbage collector is run. If an object survives a few rounds of garbage collection it's assumed to be a long-lived object and is promoted to the next generation up; which is checked less frequently. When an object A has an immutable reference to object B: this means B will need to exist at least as long as A, so the garbage collector also promotes B.</p>\n\n<p>Because of lazy evaluation: the claim in the wikibook that \"immutable data NEVER points to younger values\" is actually wrong; but immutability does help the garbage collector by helping it estimate the lifetimes of heap objects.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1568072450, "creation_date": 1568062701, "question_id": 57861109, "link": "https://stackoverflow.com/questions/57861109/does-immutability-improve-gc-performance-in-lazily-evaluated-languages", "title": "Does immutability improve GC performance in lazily evaluated languages?", "body": "<p>Intuitively, given that lazy-evaluated thunks can contain cycles and are updated concurrently with garbage collection, this doesn't look much different than GC for mutable data - except maybe that pointers need to be traversed only once, evaluated or rewritten during compaction pause.</p>\n\n<p>Does the claim in <a href=\"https://wiki.haskell.org/GHC/Memory_Management\" rel=\"nofollow noreferrer\">Haskell wiki book</a> correctly identify benefits of having immutable (lazily evaluated) data on the heap?</p>\n\n<p>Does the algorithm prevent sharing commonly reduced values (like small integers or strings) at runtime causing more data to be kept and copied around?</p>\n"}, {"tags": ["haskell", "functor", "yesod"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1568053989, "post_id": 57859077, "comment_id": 102145097, "body": "Given that you claim to be in a <code>do</code> block, you probably can&#39;t improve it much. <a href=\"https://stackoverflow.com/q/7040844/791604\">Functors compose, but monads don&#39;t.</a> But see also <a href=\"https://stackoverflow.com/q/33005903/791604\"><code>MaybeT</code></a>, depending on what you want to happen with <code>Nothing</code>s."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1568055517, "post_id": 57859077, "comment_id": 102145722, "body": "@DanielWagner There&#39;s a (slim) chance he&#39;s in <code>ApplicativeDo</code>."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 5, "creation_date": 1568056879, "post_id": 57859333, "comment_id": 102146278, "body": "Of course, <code>getCompose (fmap f (Compose x))</code> isn&#39;t a huge improvement over <code>fmap (fmap f) x</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1568056963, "post_id": 57859333, "comment_id": 102146317, "body": "(Unless you want to factor out a helper like <code>let deepMap f = getCompose . fmap f . Compose in deepMap entityKey maybeAuth</code>.)"}, {"owner": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "edited": false, "score": 0, "creation_date": 1568058217, "post_id": 57859333, "comment_id": 102146837, "body": "I found this library that looks interesting: <a href=\"https://hackage.haskell.org/package/composition-extra-2.0.0/docs/Data-Functor-Syntax.html#v:-60--36--36--62-\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/composition-extra-2.0.0/docs/&hellip;</a>"}, {"owner": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "edited": false, "score": 0, "creation_date": 1568203852, "post_id": 57859333, "comment_id": 102199332, "body": "Do you think <code>fmap f &lt;$&gt; x</code> looks better?"}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 3, "last_activity_date": 1568053405, "creation_date": 1568053405, "answer_id": 57859333, "question_id": 57859077, "link": "https://stackoverflow.com/questions/57859077/map-functor-inside-another-functor-in-haskell/57859333#57859333", "title": "Map Functor inside another Functor in Haskell", "body": "<p>As a general approach, you could use <a href=\"http://hackage.haskell.org/package/base/docs/Data-Functor-Compose.html\" rel=\"nofollow noreferrer\">Data.Functor.Compose</a>. Here's an example that composes a list of maybes:</p>\n\n<pre><code>Prelude Data.Functor.Compose&gt; ff = Compose [Just 42, Just 1337, Nothing, Just 2112]\nPrelude Data.Functor.Compose&gt; :t ff\nff :: Num a =&gt; Compose [] Maybe a\nPrelude Data.Functor.Compose&gt; fmap (show . (+1)) ff\nCompose [Just \"43\",Just \"1338\",Nothing,Just \"2113\"]\n</code></pre>\n"}], "owner": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 57859333, "answer_count": 1, "score": 1, "last_activity_date": 1568053478, "creation_date": 1568052228, "last_edit_date": 1568053478, "question_id": 57859077, "link": "https://stackoverflow.com/questions/57859077/map-functor-inside-another-functor-in-haskell", "title": "Map Functor inside another Functor in Haskell", "body": "<p>I should get <code>Maybe UserId</code> from <a href=\"https://www.stackage.org/haddock/lts-14.5/yesod-auth-1.6.8/Yesod-Auth.html#v:maybeAuth\" rel=\"nofollow noreferrer\">maybeAuth</a></p>\n\n<p>I am going to do it this way:</p>\n\n<pre><code>... = do\n  muserId &lt;- (entityKey &lt;$&gt;) &lt;$&gt; maybeAuth\n...\n</code></pre>\n\n<p>So, I am looking to map <code>Functor</code> inside another <code>Functor</code>. I heard about Functor composition, is it my case?</p>\n\n<p>Can I improve it using Functor Composition or something else?</p>\n"}, {"tags": ["haskell", "io"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1568044547, "post_id": 57856241, "comment_id": 102141068, "body": "Note that this only returns the last character, not the full string. For the latter, you need some more tricky recursion. As a hint, consider a helper function <code>go :: String -&gt; Teletype String</code>, where the first string argument represents &quot;the characters read so far&quot;."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10696742"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1568054241, "post_id": 57856241, "comment_id": 102145203, "body": "@chi do I need State to remember the characters already read? I don&#39;t yet understand how to store the data"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1568054578, "post_id": 57856241, "comment_id": 102145349, "body": "You don&#39;t need <code>State</code>. You can define <code>go oldState = ....... (go newState)</code>. Changing the argument value models the &quot;state update&quot;."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10696742"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1568056703, "post_id": 57856241, "comment_id": 102146207, "body": "@chi something like this: <code>go x:xs  = if x == &#39;\\n&#39; then End xs else Get (\\c -&gt; goUpdate (c:str))</code> ? But I don&#39;t understand how to pass and store the read characters anywhere"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1568058827, "post_id": 57856241, "comment_id": 102147048, "body": "That&#39;s close enough. My untested code is <code>go str = Get (\\c -&gt; if c == &#39;\\n&#39; then End str else go (str ++ [c]))</code> and then <code>getline = go &quot;&quot;</code>. (It&#39;s not efficient as it could be, but that&#39;s not important.) The idea is that you read <code>c</code>, and if it&#39;s not a newline you append it to <code>str</code> and recurse, reading the next char, and so on."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1568044388, "post_id": 57856282, "comment_id": 102140969, "body": "Note that, while this fixes the immediate issue, the program does not satisfy the requirement &quot;reads characters until it finds a newline character, and returns the complete string&quot;. To me, this calls for <code>Teletype String</code>, no <code>Put</code> at all, and some clever recursion. It is best if the OP does this than spoiling the answer, though, since it&#39;s a nice exercise."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1568061833, "last_edit_date": 1568061833, "creation_date": 1568040143, "answer_id": 57856282, "question_id": 57856241, "link": "https://stackoverflow.com/questions/57856241/teletype-io-getline-function/57856282#57856282", "title": "Teletype IO getLine function", "body": "<p><code>c</code> is a <code>Char</code>, indeed, the data constructor says <code>Get (Char -&gt; Teletype a)</code>. <code>\"\\n\"</code> is not a <code>Char</code>, that is a <code>String</code> (so <code>[Char]</code>).</p>\n\n<p>You can compare with a new line, by comparing with <code>'\\n'</code> (notice the single brackets):</p>\n\n<pre><code>getline :: Teletype Char\ngetline = Get (\\c -&gt; if c == <b>'\\n'</b> then Put c (End c) else getline)</code></pre>\n\n<p>As @chi says, this is not this does not is a complete solution to the exercise. This fixes a local problem, such that you can continue solving it.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10696742"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 57856282, "answer_count": 1, "score": 3, "last_activity_date": 1568061833, "creation_date": 1568040001, "last_edit_date": 1568041258, "question_id": 57856241, "link": "https://stackoverflow.com/questions/57856241/teletype-io-getline-function", "title": "Teletype IO getLine function", "body": "<p>I have this data type:</p>\n\n<pre><code>data Teletype a = End a\n            | Get (Char -&gt; Teletype a)\n            | Put Char (Teletype a)\n</code></pre>\n\n<p>A value of this type can be used to describe programs that read and write characters and return a final result of type <code>a</code>. Such a program can end immediately (<code>End</code>). If it reads a character, the rest of the program is described as a function depending on this character (<code>Get</code>). If the program writes a character (<code>Put</code>), the value to show and the rest of the program are recorded.</p>\n\n<p>I have to write a Teletype-program <code>getLine</code> which reads characters until it finds a newline character, and returns the complete string. So far, I have this: </p>\n\n<pre><code>getline = Get (\\c -&gt; if c == \"\\n\" then (Put c (End c)) else getline )\n</code></pre>\n\n<p>But it doesn't compile because</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Couldn't match expected type \u2018Char\u2019 with actual type \u2018[Char]\u2019\n\u2022 In the second argument of \u2018(==)\u2019, namely \u2018\"\\n\"\u2019\n  In the expression: c == \"\\n\"\n  In the expression: if c == \"\\n\" then (Put c (End c)) else getline\n</code></pre>\n"}, {"tags": ["haskell", "grouping"], "comments": [{"owner": {"reputation": 491, "user_id": 5567931, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/95opM.jpg?s=128&g=1", "display_name": "Jan Kreischer", "link": "https://stackoverflow.com/users/5567931/jan-kreischer"}, "edited": false, "score": 0, "creation_date": 1568031751, "post_id": 57853849, "comment_id": 102134098, "body": "Btw i found a solution to the problem - if I call <b>group (x:xs) = groupHelper xs x [[x]]</b> it returns the correct result. But I still don&#39;t exactly understand why I did the wrong thing without this modification"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1568034100, "post_id": 57853849, "comment_id": 102135376, "body": "BTW, recursively building up lists like <code>f ... = f (...) ++ (...)</code> is very bad for performance, because you append over and over to the right, and each time this requires traversing a bigger and bigger list. Better is to cons the partial result to the <i>left</i> of the recursive call."}], "answers": [{"comments": [{"owner": {"reputation": 491, "user_id": 5567931, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/95opM.jpg?s=128&g=1", "display_name": "Jan Kreischer", "link": "https://stackoverflow.com/users/5567931/jan-kreischer"}, "edited": false, "score": 0, "creation_date": 1568032797, "post_id": 57854047, "comment_id": 102134661, "body": "This was a pretty stupid mistake of me. I solved it now by writing <b>group (x:xs) = groupHelper (x:xs) x []</b> because I think it is a little bit cleaner than the previous solution. Thank you very much for your help!"}], "tags": [], "owner": {"reputation": 225, "user_id": 8363795, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-NkUCkHmpY58/AAAAAAAAAAI/AAAAAAAAAY4/Ylb34NmG0p4/photo.jpg?sz=128", "display_name": "&#193;d&#225;m R&#233;v&#233;sz", "link": "https://stackoverflow.com/users/8363795/%c3%81d%c3%a1m-r%c3%a9v%c3%a9sz"}, "is_accepted": true, "score": 3, "last_activity_date": 1568031888, "creation_date": 1568031888, "answer_id": 57854047, "question_id": 57853849, "link": "https://stackoverflow.com/questions/57853849/haskell-group-function-first-element-always-missing/57854047#57854047", "title": "Haskell group function / First element always missing", "body": "<p>When you call groupHelper the first time (from group) you\u2019re passing the prev arg, but the helper uses it only for comparison.\nSolution could be to add the fist item as the first element of the first group on first call.\nLike this:\n<code>group (x:xs) = groupHelper xs x [[x]]</code></p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 1, "last_activity_date": 1568035164, "creation_date": 1568035164, "answer_id": 57854879, "question_id": 57853849, "link": "https://stackoverflow.com/questions/57853849/haskell-group-function-first-element-always-missing/57854879#57854879", "title": "Haskell group function / First element always missing", "body": "<p>You forgot to add the first element <code>x</code> to the accumulator, so you can fix this with:</p>\n\n<pre><code>group (x:xs) = groupHelper xs x [<b>[x]</b>]</code></pre>\n\n<p>That being said, the grouping is not done very efficient: you each time add at the end of the list. This will make it an <em>O(n<sup>2</sup>)</em> algorithm. Furthermore it is not that lazy either: it will require a lot of evaluation, if you are only interested in, for example, the first group.</p>\n\n<p>We can make a more lazy and efficient implementation with:</p>\n\n<pre><code>group :: Eq a =&gt; [a] -&gt; [[a]]\ngroup [] = []\ngroup (x:xs) = let (y:ys) = go xs x in (x:y):ys\n    where go [] _ = [[]]\n          go (a:as) b | a == b = let (c:cs) = go as b in (a:c):cs\n                      | otherwise = [] : go (a:as) a\n</code></pre>\n"}], "owner": {"reputation": 491, "user_id": 5567931, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/95opM.jpg?s=128&g=1", "display_name": "Jan Kreischer", "link": "https://stackoverflow.com/users/5567931/jan-kreischer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 57854047, "answer_count": 2, "score": 3, "last_activity_date": 1568035164, "creation_date": 1568031216, "last_edit_date": 1568031409, "question_id": 57853849, "link": "https://stackoverflow.com/questions/57853849/haskell-group-function-first-element-always-missing", "title": "Haskell group function / First element always missing", "body": "<p>I want to write a function called group that takes a list of type <code>[a]</code> and returns a a list of list of type <code>[[a]]</code> containing identical characters. Here is a simple example of the expected behaviour:</p>\n\n<p><code>group [1,1,2,1,3,3,3]</code> \u21d2+ <code>[[1,1],[2],[1],[3,3,3]]</code></p>\n\n<p><code>group \"aaabbcdddd\"</code> \u21d2+ <code>[\"aaa\",\"bb\",\"c\",\"dddd\"]</code></p>\n\n<p>I wrote the following code but the problem is that this code always misses the first element from the original list</p>\n\n<pre><code>group [] = []\ngroup (x:xs) = groupHelper xs x []\n\ngroupHelper :: Eq a =&gt; [a] -&gt; a -&gt; [[a]] -&gt; [[a]]\ngroupHelper [] prev fs = fs\ngroupHelper (x:xs) prev [] = groupHelper xs prev [[x]]\ngroupHelper (x:xs) prev fs = if (x == prev) then groupHelper (xs) (x) ((init fs) ++ [(last(fs)++[x])]) \n     else groupHelper (xs) x (fs++[[x]])\n</code></pre>\n\n<p>The code would produce the following output for this input. </p>\n\n<p><code>group [1,1,2,1,3,3,3]</code> \u21d2+ <code>[[1],[2],[1],[3,3,3]]</code></p>\n\n<p>=> Here a 1 at the beginning of the first list would be missing</p>\n\n<hr>\n\n<p><code>group \"aaabbcdddd\"</code> \u21d2+ <code>[\"aa\",\"bb\",\"c\",\"dddd\"]</code></p>\n\n<p>=> Here one <code>'a'</code> at the beginning of the first list would be missing</p>\n\n<p>I hope someone can help me to solve this bug. Thank you very much</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1568004077, "post_id": 57847047, "comment_id": 102122798, "body": "I doubt it will be faster.  After all <code>sortOn fst</code> has to keep tuples <code>(a, (a,b))</code> around in order to avoid recomputing the the &quot;expensive&quot; projection <code>fst</code>...  (But in general I am super in favor of the *<code>On</code> instead of *<code>By</code> functions, also for correctness reasons)"}, {"owner": {"reputation": 461, "user_id": 1139247, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/d0be3a7c6df993ac84c5bfcbcb278db7?s=128&d=identicon&r=PG", "display_name": "r ne", "link": "https://stackoverflow.com/users/1139247/r-ne"}, "edited": false, "score": 0, "creation_date": 1568083781, "post_id": 57847047, "comment_id": 102152543, "body": "The answer by Joseph work great, although I don&#39;t know if it would be faster or not. And thanks to luqui for the comment."}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": true, "score": 7, "last_activity_date": 1567994879, "last_edit_date": 1567994879, "creation_date": 1567994317, "answer_id": 57847047, "question_id": 57847013, "link": "https://stackoverflow.com/questions/57847013/error-when-using-sortbyfst-variable-not-in-scope/57847047#57847047", "title": "Error when using sortByFst: Variable not in scope", "body": "<p>You tried to call a function named <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:sortBy\" rel=\"noreferrer\"><code>sortBy</code></a>, but GHCi wasn't aware of any such function. This happened because <code>sortBy</code> is in <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html\" rel=\"noreferrer\"><code>Data.List</code></a> and not <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html\" rel=\"noreferrer\"><code>Prelude</code></a>. To use anything from modules other than <code>Prelude</code>, you need to import them, so doing <code>import Data.List</code> will make your code work.</p>\n\n<p>Also, for what you're doing, <code>sortBy</code> is the wrong tool for the job. Your lambda is equivalent to <code><a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Ord.html#v:comparing\" rel=\"noreferrer\">comparing</a> fst</code>, and <code>sortBy (comparing fst)</code> is the same as <code><a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:sortOn\" rel=\"noreferrer\">sortOn</a> fst</code>. Thus, <code>sortByFst = sortOn fst</code> does the same thing as your code, but is much simpler and faster.</p>\n"}], "owner": {"reputation": 461, "user_id": 1139247, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/d0be3a7c6df993ac84c5bfcbcb278db7?s=128&d=identicon&r=PG", "display_name": "r ne", "link": "https://stackoverflow.com/users/1139247/r-ne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 480, "favorite_count": 0, "accepted_answer_id": 57847047, "answer_count": 1, "score": 1, "last_activity_date": 1568021118, "creation_date": 1567993735, "last_edit_date": 1568021118, "question_id": 57847013, "link": "https://stackoverflow.com/questions/57847013/error-when-using-sortbyfst-variable-not-in-scope", "title": "Error when using sortByFst: Variable not in scope", "body": "<pre><code>Prelude&gt; sortByFst = sortBy (\\x y -&gt; fst x `compare` fst y)\n\n&lt;interactive&gt;:7:13: error:\n    Variable not in scope:\n      sortBy :: (((), b0) -&gt; ((), b1) -&gt; Ordering) -&gt; t\n</code></pre>\n\n<p>What does this error mean?</p>\n"}, {"tags": ["list", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1568015300, "post_id": 57846978, "comment_id": 102126268, "body": "In Haskell, all data is <i>immutable</i>, you thus do not alter the value in a list, you create a new list with altered values. This is similar to how you do string processing in Java."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1568028651, "post_id": 57846978, "comment_id": 102132485, "body": "Functional programming can be radically different from imperative programming. A common mistake is trying to think how to solve a problem in an imperative programming language (Java, C, python, ...) and after that trying to translate it into a FP language. This will either make you stuck, or lead to ugly code. Instead, I would recommend you &quot;unlearn&quot; most of your programming habits, and learn FP and Haskell from scratch, following a tutorial like LYAH."}, {"owner": {"reputation": 5584, "user_id": 10315163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/612a6e3f2d130ac5f5672a9e474f92da?s=128&d=identicon&r=PG&f=1", "display_name": "Ynjxsjmh", "link": "https://stackoverflow.com/users/10315163/ynjxsjmh"}, "edited": false, "score": 0, "creation_date": 1568299578, "post_id": 57846978, "comment_id": 102238302, "body": "Take a look at section <code>How to think about loops</code> in <a href=\"http://book.realworldhaskell.org/read/functional-programming.html\" rel=\"nofollow noreferrer\">Real World Haskell Chapter 4. Functional programming</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1141, "user_id": 1367497, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c1ab83696683e53a9940cd2a8c480894?s=128&d=identicon&r=PG", "display_name": "peeyush singh", "link": "https://stackoverflow.com/users/1367497/peeyush-singh"}, "is_accepted": false, "score": 3, "last_activity_date": 1568006642, "last_edit_date": 1568006642, "creation_date": 1567994098, "answer_id": 57847032, "question_id": 57846978, "link": "https://stackoverflow.com/questions/57846978/how-to-write-a-for-loop-in-haskell/57847032#57847032", "title": "How to write a for loop in Haskell?", "body": "<p>Haskell uses a combination of different ways to 'sort of' loop over data (list, etc.). </p>\n\n<p>The two important things helping this is:</p>\n\n<ol>\n<li>Ease of declaring a function and passing it around similar to what we do to a variable in oops languages'</li>\n<li>Extensive pattern matching</li>\n</ol>\n\n<p>So for example I declare a function in haskell to return 2 if input is 3 else return input.</p>\n\n<pre><code>return2 x = if x == 3 then 2 else x\n</code></pre>\n\n<p>Now we want to apply this function to every element of the list. So we will use pattern matching</p>\n\n<pre><code>apply (x:xs) = return2 x : apply xs\napply [] = []\n</code></pre>\n\n<p>Here the pattern <code>x:xs</code> will break the list and take the first element in <code>x</code> while <code>xs</code> will have the remainder of the list. Inside the function you can see we have applied it recursively.</p>\n\n<p>I have not checked the above code in IDE so might have syntax errors, also there are other things you will want to validate (end of list, in above code the function would cause exception).</p>\n\n<p>The above pattern is quite common, so there is another function in the core libraries that can do this, and is called map. So you could have done:</p>\n\n<pre><code>map return2 [your list]\n</code></pre>\n\n<p>As I said in haskell there are many ways to essentially loop over things, but at the base they break down to applying the function to individual items in the data structure. There are many haskell functions built on top of it like map, fold, etc.</p>\n\n<p>I would suggest you use one of the several resources online to get more familiar with Haskell constructs. One that I liked and easy to follow is <a href=\"http://learnyouahaskell.com/chapters\" rel=\"nofollow noreferrer\">Learn you a hakell</a></p>\n"}, {"tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": false, "score": 11, "last_activity_date": 1567994105, "creation_date": 1567994105, "answer_id": 57847033, "question_id": 57846978, "link": "https://stackoverflow.com/questions/57846978/how-to-write-a-for-loop-in-haskell/57847033#57847033", "title": "How to write a for loop in Haskell?", "body": "<p>There's not a single replacement for a <code>for</code> loop in Haskell. The replacement depends on exactly what you want to do. In this case, a <code>map</code> would be appropriate:</p>\n\n<pre><code>replace_two = map go\n  where\n    go 2 = 3\n    go x = x\n</code></pre>\n\n<p>And it works like this:</p>\n\n<pre><code>Prelude&gt; replace_two [1,2,2,4,1]\n[1,3,3,4,1]\nPrelude&gt;\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 2, "creation_date": 1568031518, "post_id": 57847992, "comment_id": 102133934, "body": "Downvote for introducing a layer of monadic indirection (and <code>return</code>) for no good reason. If you really want the parameters to be backward, just use <code>&lt;&amp;&gt;</code> from <code>Data.Functor</code>."}], "tags": [], "owner": {"reputation": 1270, "user_id": 2383766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc13aeb9c9f89e097f48d815b81541d5?s=128&d=identicon&r=PG", "display_name": "Z-Y.L", "link": "https://stackoverflow.com/users/2383766/z-y-l"}, "is_accepted": false, "score": -1, "last_activity_date": 1568004333, "creation_date": 1568004333, "answer_id": 57847992, "question_id": 57846978, "link": "https://stackoverflow.com/questions/57846978/how-to-write-a-for-loop-in-haskell/57847992#57847992", "title": "How to write a for loop in Haskell?", "body": "<p>Except <code>map</code>, maybe you can use <code>forM</code> from <code>Control.Monad</code> to mimic the <code>for</code> loop in other imperative languages:</p>\n\n<pre><code>import Control.Monad\narr = [1, 2, 2, 4, 1]\nforM arr $ \\i -&gt;\n    if i == 2 then return 3 else return i\n</code></pre>\n\n<p>However, you need to understand what is <code>Monad</code>. </p>\n"}, {"tags": [], "owner": {"reputation": 3063, "user_id": 439578, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e032fbe640b2234c8dce244907b99eab?s=128&d=identicon&r=PG", "display_name": "Manoj R", "link": "https://stackoverflow.com/users/439578/manoj-r"}, "is_accepted": false, "score": 1, "last_activity_date": 1568018553, "creation_date": 1568018553, "answer_id": 57850522, "question_id": 57846978, "link": "https://stackoverflow.com/questions/57846978/how-to-write-a-for-loop-in-haskell/57850522#57850522", "title": "How to write a for loop in Haskell?", "body": "<p>Another basic approach using patterns and recursion. </p>\n\n<pre><code>replace :: [Int] -&gt; [Int]\nreplace [] = [] -- base case\nreplace (2:x)  = 3:replace(x) --if 2 then replace by 3\nreplace (y:x) = y:replace(x) -- do nothing\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 961, "user_id": 6338725, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef4feaacbcbd03edc4fb721854ad3f75?s=128&d=identicon&r=PG", "display_name": "Rodrigo de Azevedo", "link": "https://stackoverflow.com/users/6338725/rodrigo-de-azevedo"}, "is_accepted": false, "score": 1, "last_activity_date": 1568101787, "creation_date": 1568101787, "answer_id": 57866278, "question_id": 57846978, "link": "https://stackoverflow.com/questions/57846978/how-to-write-a-for-loop-in-haskell/57866278#57866278", "title": "How to write a for loop in Haskell?", "body": "<p>Using <code>map</code> with an anonymous function:</p>\n\n<pre><code>\u03bb&gt; map (\\x -&gt; if x==2 then 3 else x) [1,2,2,4,1]\n[1,3,3,4,1]\n</code></pre>\n"}], "owner": {"reputation": 57, "user_id": 11854919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e26040a2908542048c090e8e2bc843a6?s=128&d=identicon&r=PG&f=1", "display_name": "keyoshi998", "link": "https://stackoverflow.com/users/11854919/keyoshi998"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 362, "favorite_count": 0, "answer_count": 5, "score": 1, "last_activity_date": 1568251826, "creation_date": 1567993272, "last_edit_date": 1568251826, "question_id": 57846978, "link": "https://stackoverflow.com/questions/57846978/how-to-write-a-for-loop-in-haskell", "title": "How to write a for loop in Haskell?", "body": "<p>I am really new to Haskell and also really confused about how to implement for loops since I know we need to use recursion for them.</p>\n\n<p>For example, I have a list <code>[1,2,2,4,1]</code> and want to write a function to  change every <code>2</code> to a <code>3</code>. How would I go about doing this? In Java, I know I would write the following</p>\n\n<pre><code>public void replace_two(List&lt;Integer&gt; ints) {\n        int i = 0;\n        for (int x: ints) {\n            if (x == 2) {\n                ints.set(i, 3);\n            }\n            i++;\n        }\n        System.out.println(ints);\n    }\n</code></pre>\n\n<p>but I am not sure how I could reproduce something else like this with Haskell?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 2, "creation_date": 1567982298, "post_id": 57846239, "comment_id": 102119660, "body": "Please state the exact error messages, these contain a wealth of information. And I strongly recommend that you give a type signature for <code>helperToSum</code> as well, since this can help you pinpoint the source of errors like this."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1567982443, "post_id": 57846239, "comment_id": 102119681, "body": "One definite problem, which explains the &quot;infinite type&quot; error, is that <code>helperToSum</code> returns <code>acc</code> in one branch, and <code>acc:(&lt;some expression&gt;)</code> in another. Look at the type of <code>(:)</code> and you will realise these can never have the same type. And obviously all possible return values of a function must have the same type (the same as given in the type signature - which is one reason why including a type signature is helpful, then GHC will point out exactly which expression has the wrong type)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1568030215, "post_id": 57846239, "comment_id": 102133247, "body": "When you get a strange type error in Haskell, it often arises since the compiler tried to infer the type of your code, infers a type which is <i>not</i> what you expected, and then much later on fails, producing an error message based on a &quot;wrong&quot; assumption. The common solution here is adding more type annotations to the code. If you add a line <code>helperToSum :: .....</code> stating which type you expect, the compiler has more information, and will error out early, when your expectation is broken by the code, pointing out the bugs."}], "answers": [{"comments": [{"owner": {"reputation": 173, "user_id": 4789917, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3c66188d3afe7070457570133fe7395?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/4789917/alex"}, "edited": false, "score": 1, "creation_date": 1567984452, "post_id": 57846343, "comment_id": 102119967, "body": "Thanks for the detailed explanation. This if my first functional language so its a learning experience.  I am able to get the correct output once I used the reverse function when concatenating acc to the function call."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 2, "last_activity_date": 1567983326, "creation_date": 1567983326, "answer_id": 57846343, "question_id": 57846239, "link": "https://stackoverflow.com/questions/57846239/group-sum-to-n-working-with-list-of-lists/57846343#57846343", "title": "Group Sum to N: working with list of lists", "body": "<p>The base case:</p>\n\n<pre><code>helperToSum n [] acc = acc\n</code></pre>\n\n<p>Does not make much sense, since it expects a list of lists. You need to return a singleton list:</p>\n\n<pre><code>helperToSun n [] acc = [acc]\n</code></pre>\n\n<p>Another problem is that <code>(acc : x)</code> is not valid. <code>(:)</code> is a constructor of a list, and has type <code>(:) :: a -&gt; [a] -&gt; [a]</code>. You can not use it to append values. We could, for now, use <code>(x : acc)</code>. In that case, you will later need to reverse.</p>\n\n<p>It is furthermore better to use <code>otherwise</code> as second guard. Here for example it is possible that the sum is exactly <code>n</code>, and that case is not covered right now.</p>\n\n<p>With these problems in mind, we can fix the compilation errors, with the following function:</p>\n\n<pre><code>helperToSum :: (Ord a, Num a) =&gt; a -&gt; [a] -&gt; [a] -&gt; [[a]]\nhelperToSum n [] acc = [acc]\nhelperToSum n (x:xs) acc | (sum acc) + x &lt;= n = (helperToSum n xs (x : acc))\n                         | otherwise = acc:(helperToSum n xs [x])</code></pre>\n\n<p>But here the groups will be reversed, and furthermore it is not very efficient. We can make a more lazy variant that on the fly calculates how much space is left in a group, and aims to assign the items in the current, or the next group based on that condition:</p>\n\n<pre><code>groupSumtoN :: (Ord a, Num a) =&gt; a -&gt; [a] -&gt; [[a]]\ngroupSumtoN n = go n\n    where go _ [] = [[]]\n          go r (x:xs) | x &lt;= r = let (t:tl) = go (r-x) xs in (x:t) : tl\n                      | x &gt; n = error \"Item too large\"\n                      | otherwise = [] : go n (x:xs)\n</code></pre>\n\n<p>Here an empty lists, will produce a single group:</p>\n\n<pre><code>Prelude&gt; groupSumtoN 15 []\n[[]]\n</code></pre>\n\n<p>I leave it as an exercise to further improve this.</p>\n"}], "owner": {"reputation": 173, "user_id": 4789917, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3c66188d3afe7070457570133fe7395?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/4789917/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 256, "favorite_count": 0, "accepted_answer_id": 57846343, "answer_count": 1, "score": 0, "last_activity_date": 1567983326, "creation_date": 1567982098, "question_id": 57846239, "link": "https://stackoverflow.com/questions/57846239/group-sum-to-n-working-with-list-of-lists", "title": "Group Sum to N: working with list of lists", "body": "<p>I'm learning Haskell and working on a problem where you take in a number, n,  and list, iL.  With these you check what consecutive numbers would be &lt; than n and store it in a list.  You can have more than one list. I've created a function called groupSumtoN that would return this list of lists.</p>\n\n<p>I've created a helper function helperToSum to recursively create the list and return the output, which takes the number n, input , and acc ( the result).</p>\n\n<p>Here is what I have tried so far: </p>\n\n<pre><code>groupSumtoN :: (Ord a, Num a) =&gt; a -&gt; [a] -&gt; [[a]]\ngroupSumtoN n [] = []\ngroupSumtoN n iL = (helperToSum n iL [])\n\nhelperToSum n [] acc = acc\nhelperToSum n (x:xs) acc | (sum acc) + x &lt; n = (helperToSum n xs (acc : x))\n                         | (sum acc) + x &gt; n = acc:(helperToSum n xs [x])\n</code></pre>\n\n<p>I get two infinite type errors, one for calling helperToSum from groupSumtoN and another in this line.</p>\n\n<pre><code>(sum acc) + x &lt; n = (helperToSum n xs (acc : x))\n</code></pre>\n\n<p>As an example I have an example how this function should work below: </p>\n\n<pre><code>groupSumtoN 15 [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\n[[1,2,3,4,5],[6,7],[8],[9],[10]]\n</code></pre>\n\n<p>Any help would be greatly appreciated.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1568030655, "post_id": 57846224, "comment_id": 102133471, "body": "I don&#39;t understand: why do you say that firefox does not use command line options? Here on linux <code>firefox --help</code> and <code>man firefox</code> list several options, including <code>--headless</code>."}], "answers": [{"tags": [], "owner": {"reputation": 312, "user_id": 1764563, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/17ca5b4c86c78cc68d04f0cf8f7f74c7?s=128&d=identicon&r=PG", "display_name": "Dan Dart", "link": "https://stackoverflow.com/users/1764563/dan-dart"}, "is_accepted": true, "score": 1, "last_activity_date": 1604779648, "creation_date": 1604779648, "answer_id": 64731916, "question_id": 57846224, "link": "https://stackoverflow.com/questions/57846224/haskell-webdriver-selenium-firefox-headless-mode/64731916#64731916", "title": "Haskell Webdriver Selenium Firefox headless mode", "body": "<p>For now, there's no specific switch built into the Haskell library, so you'll have to use the <code>additionalCaps</code> field inside the <code>wdCapabilities</code> field of your <code>WDConfig</code>, rather than the <code>browser</code> field, and include an <code>args</code> array inside a <code>moz:firefoxOptions</code> aeson object like this:</p>\n<pre class=\"lang-hs prettyprint-override\"><code>firefoxConfig \u2237 WDConfig\nfirefoxConfig = defaultConfig {\n    wdCapabilities = defaultCaps {\n        additionalCaps = [\n            (&quot;moz:firefoxOptions&quot;, object [\n                (&quot;args&quot;, Array (fromList [String &quot;--headless&quot;]))\n            ])\n        ]\n    }\n}\n</code></pre>\n<p>Anything else undocumented in Haskell that you wish to pass to Firefox will also go there.</p>\n<p>This is explained in <a href=\"https://developer.mozilla.org/en-US/docs/Web/WebDriver/Capabilities/firefoxOptions\" rel=\"nofollow noreferrer\">Mozilla's documentation</a>.</p>\n"}], "owner": {"reputation": 639, "user_id": 10654293, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-N3y4b1ilweA/AAAAAAAAAAI/AAAAAAAAAAQ/nO5VTzQiUu0/photo.jpg?sz=128", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/10654293/mcbear-holden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 64731916, "answer_count": 1, "score": 2, "last_activity_date": 1604779648, "creation_date": 1567981968, "question_id": 57846224, "link": "https://stackoverflow.com/questions/57846224/haskell-webdriver-selenium-firefox-headless-mode", "title": "Haskell Webdriver Selenium Firefox headless mode", "body": "<p>I enjoy using the wonderful <a href=\"http://hackage.haskell.org/package/webdriver-0.9.0.1\" rel=\"nofollow noreferrer\">webdriver</a> package. But one thing that's a bit odd is that the Firefox browser type doesn't support commandline options.\nCan anyone help how I can run firefox headless mode with commandline options?\nI'm guessing I could use firefox profile but after much googling I couldn't find headless mode linked to firefox profile.</p>\n\n<pre><code>data Browser = Firefox { -- |The firefox profile to use. If Nothing,\n                         -- a default temporary profile is automatically created\n                         -- and used.\n                         ffProfile :: Maybe (PreparedProfile Firefox)\n                         -- |Firefox logging preference\n                       , ffLogPref :: LogLevel\n                         -- |Server-side path to Firefox binary. If Nothing,\n                         -- use a sensible system-based default.\n                       , ffBinary :: Maybe FilePath\n                         -- |Available after Firefox 52, and required only for Firefox\n                         -- geckodriver. Indicates whether untrusted and self-signed TLS\n                         -- certificates are implicitly trusted on navigation for the\n                         -- duration of the session.\n                       , ffAcceptInsecureCerts :: Maybe Bool\n                       }\n             | Chrome { -- |Version of the Chrome Webdriver server server to use\n                        --\n                        -- for more information on chromedriver see\n                        -- &lt;https://github.com/SeleniumHQ/selenium/wiki/ChromeDriver&gt;\n                        chromeDriverVersion :: Maybe String\n                        -- |Server-side path to Chrome binary. If Nothing,\n                        -- use a sensible system-based default.\n                      , chromeBinary :: Maybe FilePath\n                        -- |A list of command-line options to pass to the\n                        -- Chrome binary.\n                      , chromeOptions :: [String]\n                        -- |A list of extensions to use.\n                      , chromeExtensions :: [ChromeExtension]\n                        -- | Experimental options not yet exposed through a standard API.\n                      , chromeExperimentalOptions :: Object\n                      }\n</code></pre>\n"}, {"tags": ["string", "haskell", "io", "bind", "monads"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1567974554, "post_id": 57845532, "comment_id": 102118315, "body": "Because <code>return</code> has type <code>Monad m =&gt; a -&gt; m a</code>. You can not &quot;unwrap&quot; a value out of an <code>IO</code>. You could see an <code>IO</code> as a &quot;recipe&quot; to make a <code>String</code>, that is not the same as a string."}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 5, "creation_date": 1567974660, "post_id": 57845532, "comment_id": 102118340, "body": "If you&#39;re coming from a background in imperative languages, be aware that <code>return</code> in Haskell is very different to <code>return</code> in those languages. <code>return</code> is a function in Haskell, in this case one with type <code>String -&gt; IO String</code>."}, {"owner": {"reputation": 194, "user_id": 4856316, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GMUS6.jpg?s=128&g=1", "display_name": "lzbernardo", "link": "https://stackoverflow.com/users/4856316/lzbernardo"}, "edited": false, "score": 0, "creation_date": 1567975069, "post_id": 57845532, "comment_id": 102118419, "body": "I see. Thanks a lot, guys. I completely overlooked how <code>return</code> works in this case."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 2, "creation_date": 1567976067, "post_id": 57845532, "comment_id": 102118588, "body": "If you just read further into LYAH you&#39;ll find all this explained (in the chapters on Monads). IO in Haskell, and do notation, always seems a bit &quot;magical&quot; when first encountered as a &quot;this is how you do IO in Haskell&quot;, and these questions are perfectly natural. As I said, they get answered later on."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1568018330, "post_id": 57845532, "comment_id": 102127621, "body": "It&#39;s also worth noting that <code>do {x&lt;-foo; return x}</code> is, by the <a href=\"https://en.wikibooks.org/wiki/Haskell/Understanding_monads#Monad_Laws\" rel=\"nofollow noreferrer\">monad laws</a>, exactly the same as <code>foo</code> on its own. So all your code really does is define a new name <code>getName = getLine</code>."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1567975238, "creation_date": 1567975238, "answer_id": 57845606, "question_id": 57845532, "link": "https://stackoverflow.com/questions/57845532/why-is-the-output-of-this-haskell-function-an-io-string-instead-of-a-string/57845606#57845606", "title": "Why is the output of this Haskell function an IO String instead of a String", "body": "<p>The <code>return</code> <em>function</em> is not conceptually the same as what return does in languages like C++, Java and Python. <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:return\" rel=\"noreferrer\"><strong><code>return :: Monad m =&gt; a -&gt; m a</code></strong></a> takes an <code>a</code> (here a <code>String</code>), and produces an <code>m a</code> (here <code>IO a</code>).</p>\n\n<p>The <code>do</code> notation is syntacticual sugar. If we desugar the statement, you wrote:</p>\n\n<pre><code>getName = getLine &gt;&gt;= (\\name -&gt; return name)\n</code></pre>\n\n<p>or cleaner:</p>\n\n<pre><code>getName = getLine &gt;&gt;= return\n</code></pre>\n\n<p>The bind function <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:-62--62--61-\" rel=\"noreferrer\"><strong><code>(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b</code></strong></a> thus has as first operand an <code>m a</code>, and as second a function <code>a -&gt; m b</code>, and produces an <code>m b</code>. Since <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:getLine\" rel=\"noreferrer\"><strong><code>getLine :: IO String</code></strong></a> is an <code>IO String</code>, that thus means that <code>m</code> is the same as <code>IO</code>, and <code>a</code> is the same as <code>String</code>. The <code>return :: Monad m =&gt; a -&gt; m a</code>, makes it clear that here <code>b</code> is the same as <code>a</code>.</p>\n\n<p>Then what is <code>IO</code> here. A metaphor that is frequently used is the one of a <em>recipe</em>. In this metaphor an <code>IO a</code> is a set of instructions that when you follow these, you will get an <code>a</code>. But that does not mean that that recipe is an <code>a</code>.</p>\n\n<p><code>(&gt;&gt;=)</code> here basically says that, on the left hand I have a recipe to make <code>a</code>, on the right hand I have a function that converts that <code>a</code> into a recipe to make <code>b</code>, so we can construct a recipe to make <code>b</code> with these two.</p>\n\n<p>People often ask how to unwrap an <code>a</code> out of an <code>IO a</code>, but conceptually it makes not much sense. You can not \"unwrap\" the cake out of a recipe to make a cake. You can follow the instructions to make a cake. Following instructions is something the <code>main</code> will eventually do. We thus can construct a (long) recipe the main will do. But we can not unwrap the values.</p>\n\n<p>Strictly speaking there is a function <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/System-IO-Unsafe.html#v:unsafePerformIO\" rel=\"noreferrer\"><strong><code>unsafePerformIO :: IO a -&gt; a</code></strong></a> that can do that. But it is <em>strongly</em> adviced not to use that. Functions in Haskell are supposed to be <em>pure</em> that means that for the same input, we always retrieve the same output. <code>getLine</code> itself is a pure, since it always produces the same recipe (<code>IO String</code>).</p>\n"}], "owner": {"reputation": 194, "user_id": 4856316, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GMUS6.jpg?s=128&g=1", "display_name": "lzbernardo", "link": "https://stackoverflow.com/users/4856316/lzbernardo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 0, "accepted_answer_id": 57845606, "answer_count": 1, "score": 0, "last_activity_date": 1567980764, "creation_date": 1567974499, "last_edit_date": 1567980764, "question_id": 57845532, "link": "https://stackoverflow.com/questions/57845532/why-is-the-output-of-this-haskell-function-an-io-string-instead-of-a-string", "title": "Why is the output of this Haskell function an IO String instead of a String", "body": "<p>I'm learning Haskell through <a href=\"http://learnyouahaskell.com\" rel=\"nofollow noreferrer\">learnyouahaskell.com</a> and wanted to test some of the concepts before finishing the input/output module. I haven't been able to google or hoogle my way out of this question, though, even though it seems quite simple.</p>\n\n<p>When I try to run the following code</p>\n\n<pre><code>getName = do\n  name &lt;- getLine\n  return name\n</code></pre>\n\n<p>the output of <code>getName</code> becomes an element of type <code>IO String</code> instead of <code>String</code>, even though name is definitely a <code>String</code></p>\n\n<p>By reading the documentation and other StackVverflow's questions I couldn't figure out why is this happening when I declare <code>getName</code> as a function (when I use the bind &lt;- operation directly on <code>main</code> there's no problem whatsoever).</p>\n"}, {"tags": ["haskell", "dependent-type"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1567963120, "post_id": 57844099, "comment_id": 102115501, "body": "You can make a helper type <code>helper b = back b . forth b</code> and then call <code>helper</code> with the correct values (so <code>go Aaa = helper SAaa; go Bbb = helper</code>, etc.)"}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1567964605, "post_id": 57844099, "comment_id": 102115908, "body": "Not at all related to a solution, but you could make <code>Parsed</code> a <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#closed-type-families\" rel=\"nofollow noreferrer\">closed type family</a> instead of an open one."}, {"owner": {"reputation": 23, "user_id": 9125907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/921dbef0f1d43387d6b6ba99b7430714?s=128&d=identicon&r=PG&f=1", "display_name": "Nerwosolek", "link": "https://stackoverflow.com/users/9125907/nerwosolek"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1567965836, "post_id": 57844099, "comment_id": 102116197, "body": "@WillemVanOnsem Thanks for the suggestion. I edited the question and took your idea into account. Still, the problem remains - I need to list all the values when defining <code>go</code>. (The code in my question is a simplified version of a real problem, when I have 30 values rather than 4.)"}, {"owner": {"reputation": 23, "user_id": 9125907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/921dbef0f1d43387d6b6ba99b7430714?s=128&d=identicon&r=PG&f=1", "display_name": "Nerwosolek", "link": "https://stackoverflow.com/users/9125907/nerwosolek"}, "reply_to_user": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1567966374, "post_id": 57844099, "comment_id": 102116319, "body": "@AntalSpector-Zabusky Thanks! I improved the code snippet accordingly."}], "answers": [{"comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 1, "creation_date": 1567971640, "post_id": 57844513, "comment_id": 102117595, "body": "case works where let doesn\u2019t because it imposes an ordering. The scrutinee cannot recursively refer to any results of the match. You need this order because pattern matching on a GADT not only results in values, but can result in types (but the binding of those types to variables are invisible). Thus, it\u2019s OK for values to be recursive, but not for types. We expect let to be (potentially) recursive, so it\u2019s not allowed, but case is allowed."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1568842953, "post_id": 57844513, "comment_id": 102407898, "body": "@HTNW yes, this totally makes sense, thank you for the hint. I have updated the answer."}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 3, "last_activity_date": 1568842925, "last_edit_date": 1568842925, "creation_date": 1567965884, "answer_id": 57844513, "question_id": 57844099, "link": "https://stackoverflow.com/questions/57844099/how-to-avoid-repetition-when-factoring-a-haskell-function-into-two-functions-w/57844513#57844513", "title": "How to avoid repetition when &quot;factoring&quot; a Haskell function into two functions with various intermediary types?", "body": "<p>You can use <a href=\"https://www.stackage.org/haddock/lts-14.4/singletons-2.5.1/Data-Singletons.html#v:toSing\" rel=\"nofollow noreferrer\"><code>toSing</code> from <code>SingKind</code></a> to convert a value of <code>SimpelType</code> to a value of <code>SomeSing SimpleType</code>, which is an existentially quantified wrapper around <code>Sing SimpleType</code>. You can then unwrap that value to get <code>Sing SimpleType</code>, which you can then pass to <code>back</code> and <code>forth</code>:</p>\n\n<pre><code>go :: SimpleType -&gt; Int -&gt; Int\ngo val x =\n  case toSing val of\n    SomeSing s -&gt; back s $ forth s x\n</code></pre>\n\n<p>An instance of <code>SingKind</code> is generated for you (among many other things) by the <code>singletons</code> splice that you're using.</p>\n\n<p>Note that, while a single-branch <code>case</code> is asking to be a <code>let</code>, this wouldn't compile:</p>\n\n<pre><code>go val x =\n  let (SomeSing s) = toSing val\n  in back s $ forth s x\n</code></pre>\n\n<p>This is prohibited, because <code>let</code> can be recursive, and since unwrapping a GADT may bring new types into context, it may result in creating an infinite type. A <code>case</code> branch, on the other hand, cannot be recursive, so this works. (credit for this explanation to @HTNW)</p>\n\n<p>But a helper function would also work:</p>\n\n<pre><code>go val x = helper $ toSing val\n    where\n      helper (SomeSing s) = back s $ forth s x\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 9125907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/921dbef0f1d43387d6b6ba99b7430714?s=128&d=identicon&r=PG&f=1", "display_name": "Nerwosolek", "link": "https://stackoverflow.com/users/9125907/nerwosolek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 2, "accepted_answer_id": 57844513, "answer_count": 1, "score": 2, "last_activity_date": 1568842925, "creation_date": 1567962800, "last_edit_date": 1567966173, "question_id": 57844099, "link": "https://stackoverflow.com/questions/57844099/how-to-avoid-repetition-when-factoring-a-haskell-function-into-two-functions-w", "title": "How to avoid repetition when &quot;factoring&quot; a Haskell function into two functions with various intermediary types?", "body": "<p>Consider the following Haskell code:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE TemplateHaskell #-}\n\nimport Data.Singletons.TH\n\nsingletons [d| data SimpleType = Aaa | Bbb | Ccc | Ddd\n                                 deriving (Read)\n             |]\n\n-- each SimpleType value has an associated type\ntype family Parsed (t :: SimpleType) :: * where\n  Parsed Aaa = [Int]\n  Parsed Bbb = Maybe Int\n  Parsed Ccc = (Int, Int)\n  Parsed Ddd = Int\n\nforth :: SSimpleType t -&gt; Int -&gt; Parsed t\nforth SAaa x = [x,x*2,x*3]\nforth SBbb x = Just x\nforth SCcc x = (1337, x)\nforth SDdd x = x\n\nback :: SSimpleType t -&gt; Parsed t -&gt; Int\nback SAaa [_, y, _] = y + 5\nback SBbb (Just y) = y - 7\nback SCcc (y1, y2) = y1 + y2\nback SDdd y = y * 2\n\nhelper b = back b . forth b\n\ngo :: SimpleType -&gt; Int -&gt; Int\ngo Aaa = helper SAaa\ngo Bbb = helper SBbb\ngo Ccc = helper SCcc\ngo Ddd = helper SDdd\n\nmain = do\n  -- SimpleType value comes at run-time\n  val &lt;- readLn\n  putStrLn $ show $ go val 100\n</code></pre>\n\n<p>Is it possible to avoid the repetition when <code>go</code> is defined? In other words, is there a way to write something like:</p>\n\n<pre><code>go val = helper (someMagicFunction val)\n</code></pre>\n\n<ul>\n<li>singletons do not have to be a part of the solution,</li>\n<li>... but the idea that <code>go</code> is factored into <code>forth</code> and <code>back</code> with intermediary types dependent on <code>Simple</code> should be preserved.</li>\n</ul>\n"}, {"tags": ["haskell", "time", "quickcheck"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1567970999, "post_id": 57843503, "comment_id": 102117418, "body": "That is a <i>very</i> weird <code>Enum</code> instance. Of course, <code>Enum</code> is terminally broken, but that takes the cake."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1568043524, "post_id": 57843503, "comment_id": 102140586, "body": "It has no usable laws. It also involves at least two unrelated ideas mashed together."}], "tags": [], "owner": {"reputation": 24109, "user_id": 775954, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9f5a87db35489d2958945f35b457f1ee?s=128&d=identicon&r=PG", "display_name": "Matthias Braun", "link": "https://stackoverflow.com/users/775954/matthias-braun"}, "is_accepted": false, "score": 2, "last_activity_date": 1568011150, "last_edit_date": 1568011150, "creation_date": 1567958334, "answer_id": 57843503, "question_id": 57843502, "link": "https://stackoverflow.com/questions/57843502/arbitrary-instance-for-timeofday/57843503#57843503", "title": "Arbitrary instance for TimeOfDay", "body": "<p>The reason for the bug is that <code>TimeOfDay</code>'s last constructor parameter is the number of seconds with <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Fixed.html#t:Pico\" rel=\"nofollow noreferrer\">picosecond</a> resolution.</p>\n\n<p>I assume that consequently, <code>sec  &lt;- elements [0 .. 60]</code> wasn't generating one of 61 values but one of 61 * 10\u00b9\u00b2 values.</p>\n\n<p>This fixes the issue:</p>\n\n<pre><code>instance Arbitrary TimeOfDay where\n  arbitrary = do\n    hour &lt;- elements [0 .. 23]\n    min  &lt;- elements [0 .. 59]\n    -- Going till 60 accounts for leap seconds\n    picoSecond &lt;- elements [1, 2 .. 60]\n    return $ TimeOfDay hour min picoSecond\n</code></pre>\n\n<p>Now, <code>sample (arbitrary :: Gen TimeOfDay)</code> produces for example:</p>\n\n<pre><code>17:19:03\n15:49:58\n01:28:40\n13:20:07\n12:00:01\n12:35:45\n13:25:33\n12:55:20\n07:11:54\n21:10:46\n14:34:15\n</code></pre>\n\n<hr>\n\n<p>If you also want values in the subsecond range, change the step width of the list generator:</p>\n\n<pre><code>picoSecond &lt;- elements [1, 1.1 .. 60]\n</code></pre>\n\n<p>Sample values:</p>\n\n<pre><code>04:09:23.6\n10:22:50.4\n18:56:57.6\n07:12:07.8\n08:12:02.6\n14:20:40\n05:42:21.4\n14:35:42.3\n02:47:32.6\n22:02:26.2\n08:26:09.4\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1567964293, "last_edit_date": 1567964293, "creation_date": 1567959643, "answer_id": 57843670, "question_id": 57843502, "link": "https://stackoverflow.com/questions/57843502/arbitrary-instance-for-timeofday/57843670#57843670", "title": "Arbitrary instance for TimeOfDay", "body": "<p>As you found out, the <code>todSeconds</code> has as type <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Fixed.html#t:Pico\" rel=\"nofollow noreferrer\"><strong><code>Pico</code></strong></a> which is a fixed-point number with a resolution of <em>10<sup>-12</sup></em>, so that means that <code>[0 .. 60]</code> has <em>6&times;10<sup>13</sup>+1</em> values. This will easily take ~1000 seconds to iterate over the entire list.</p>\n\n<p>That being said, you do not need to use <code>elements</code> here in the first place. We can use <a href=\"https://hackage.haskell.org/package/QuickCheck-2.13.2/docs/Test-QuickCheck.html#v:choose\" rel=\"nofollow noreferrer\"><strong><code>choose :: Random a =&gt; (a, a) -&gt; Gen a</code></strong></a> that will generate a random value within bounds (both bounds inclusive).</p>\n\n<p>We can then define our <code>Arbitrary</code> as:</p>\n\n<pre><code>instance Arbitrary TimeOfDay where\n    arbitrary = TimeOfDay\n        &lt;$&gt; choose (0, 23)\n        &lt;*&gt; choose (0, 59)\n        &lt;*&gt; (fmap MkFixed (choose (0, 61*10^12-1)))\n</code></pre>\n\n<p>This then gives us:</p>\n\n<pre><code>Main&gt; sample (arbitrary :: Gen TimeOfDay)\n15:45:04.132804129488\n11:06:12.447614162981\n12:07:50.773642440667\n04:40:47.966398431784\n02:30:09.60931551059\n00:51:46.564756092467\n07:57:44.170698241052\n02:45:57.743854623407\n00:17:22.627238967351\n13:03:57.364852826473\n11:12:34.894890974241\n</code></pre>\n\n<p>If you do not want these picoseconds, we can do the multiplication in the <code>fmap</code>:</p>\n\n<pre><code>instance Arbitrary TimeOfDay where\n    arbitrary = TimeOfDay\n        &lt;$&gt; choose (0, 23)\n        &lt;*&gt; choose (0, 59)\n        &lt;*&gt; (fmap (MkFixed . (10^12 *)) (choose (0, 60)))\n</code></pre>\n\n<p>Then we obtain:</p>\n\n<pre><code>Main&gt; sample (arbitrary :: Gen TimeOfDay)\n15:00:53\n14:02:44\n14:44:40\n12:40:12\n09:55:39\n10:06:02\n15:00:51\n15:52:23\n16:59:05\n22:38:45\n20:23:15\n</code></pre>\n"}], "owner": {"reputation": 24109, "user_id": 775954, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9f5a87db35489d2958945f35b457f1ee?s=128&d=identicon&r=PG", "display_name": "Matthias Braun", "link": "https://stackoverflow.com/users/775954/matthias-braun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 57843670, "answer_count": 2, "score": 5, "last_activity_date": 1568011150, "creation_date": 1567958334, "last_edit_date": 1567964404, "question_id": 57843502, "link": "https://stackoverflow.com/questions/57843502/arbitrary-instance-for-timeofday", "title": "Arbitrary instance for TimeOfDay", "body": "<p>Using QuickCheck, I'd like to create a series of pseudorandom <a href=\"https://hackage.haskell.org/package/time-1.9.3/docs/Data-Time-LocalTime.html#t:TimeOfDay\" rel=\"nofollow noreferrer\"><code>TimeOfDay</code></a> values.</p>\n\n<p>It's easy to create a specific <code>TimeOfDay</code>:</p>\n\n<pre><code>now = TimeOfDay 17 35 22\n</code></pre>\n\n<p>Printing this with GHCi 8.6.5 yields:</p>\n\n<blockquote>\n  <p>17:35:22</p>\n</blockquote>\n\n<p>I thought that the <code>Arbitrary</code> instance necessary for creating <code>TimeOfDay</code> values with QuickCheck would thus be:</p>\n\n<pre><code>instance Arbitrary TimeOfDay where\n  arbitrary = do\n    hour &lt;- elements [0 .. 23]\n    min  &lt;- elements [0 .. 59]\n    -- Going till 60 accounts for leap seconds\n    sec  &lt;- elements [0 .. 60]\n    return $ TimeOfDay hour min sec\n</code></pre>\n\n<p>Although this typechecks, running the following line hangs GHCi and after a couple of seconds writes <code>Killed</code> to the console:</p>\n\n<pre><code>sample (arbitrary :: Gen TimeOfDay)\n</code></pre>\n\n<p>Where's the bug?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 1, "creation_date": 1567952997, "post_id": 57842802, "comment_id": 102113032, "body": "You can use Hoogle to find a function by it&#39;s type.  <a href=\"https://hoogle.haskell.org/?hoogle=%2Baeson%20ByteString%20-%3E%20Value\" rel=\"nofollow noreferrer\">hoogle.haskell.org/?hoogle=%2Baeson%20ByteString%20-%3E%20Va&zwnj;&#8203;lue</a>"}, {"owner": {"reputation": 820, "user_id": 9898465, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eZqQf.jpg?s=128&g=1", "display_name": "Luk&#225;\u0161 K\u0159ivka", "link": "https://stackoverflow.com/users/9898465/luk%c3%a1%c5%a1-k%c5%99ivka"}, "reply_to_user": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1567964487, "post_id": 57842802, "comment_id": 102115870, "body": "I have included the actual problem in the question, maybe someone has an even better approach in mind"}], "answers": [{"comments": [{"owner": {"reputation": 820, "user_id": 9898465, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eZqQf.jpg?s=128&g=1", "display_name": "Luk&#225;\u0161 K\u0159ivka", "link": "https://stackoverflow.com/users/9898465/luk%c3%a1%c5%a1-k%c5%99ivka"}, "edited": false, "score": 0, "creation_date": 1567964179, "post_id": 57842854, "comment_id": 102115777, "body": "Thanks a lot. This is where I didn&#39;t see the elephant in the room :) BTW: I have included the actual problem in the question, maybe you have an even better approach in mind"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 820, "user_id": 9898465, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eZqQf.jpg?s=128&g=1", "display_name": "Luk&#225;\u0161 K\u0159ivka", "link": "https://stackoverflow.com/users/9898465/luk%c3%a1%c5%a1-k%c5%99ivka"}, "edited": false, "score": 0, "creation_date": 1567964980, "post_id": 57842854, "comment_id": 102115998, "body": "@Luk&#225;\u0161K\u0159ivka: this actually looks like a use case to define a <code>FromJSON</code> like in the documentation: <a href=\"http://hackage.haskell.org/package/aeson-1.4.4.0/docs/Data-Aeson.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/aeson-1.4.4.0/docs/Data-Aeson.ht&zwnj;&#8203;ml</a> :) you can just specify how the JSON maps to your <code>PaginationList</code>, etc."}, {"owner": {"reputation": 820, "user_id": 9898465, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eZqQf.jpg?s=128&g=1", "display_name": "Luk&#225;\u0161 K\u0159ivka", "link": "https://stackoverflow.com/users/9898465/luk%c3%a1%c5%a1-k%c5%99ivka"}, "edited": false, "score": 0, "creation_date": 1567965668, "post_id": 57842854, "comment_id": 102116157, "body": "Yeah, I have both instances for Dataset and PaginationList (should have included Gist).  The actual problem is that in <code>parseJSON</code> of Dataset I have to unwrap that &quot;data&quot;. Then if I want to have <code>fromJSON</code> instance of Dataset to work automatically for inside PaginationList, it won&#39;t work because there is no &quot;data&quot; to unwrap. I could do <code>case of</code> but that feels dirty."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1567953126, "creation_date": 1567953126, "answer_id": 57842854, "question_id": 57842802, "link": "https://stackoverflow.com/questions/57842802/aeson-simply-decode-bytestring-value/57842854#57842854", "title": "Aeson - simply decode ByteString -&gt; Value", "body": "<p><a href=\"https://hackage.haskell.org/package/aeson-1.4.4.0/docs/Data-Aeson.html#t:Value\" rel=\"noreferrer\"><strong><code>Value</code></strong></a> <em>is</em> an instance of <a href=\"https://hackage.haskell.org/package/aeson-1.4.4.0/docs/Data-Aeson.html#t:FromJSON\" rel=\"noreferrer\"><strong><code>FromJSON</code></strong></a>, so you can make use of <a href=\"https://hackage.haskell.org/package/aeson-1.4.4.0/docs/Data-Aeson.html#v:decode\" rel=\"noreferrer\"><strong><code>decode :: FromJSON a =&gt; ByteString -&gt; Maybe a</code></strong></a>:</p>\n\n<pre><code>Prelude Data.Aeson&gt; decode \"{\\\"menu\\\": {\\\"id\\\": \\\"file\\\", \\\"value\\\": \\\"File\\\", \\\"popup\\\": {\\\"menuitem\\\": [1,4,2,5]}}}\" :: Maybe Value\nJust (Object (fromList [(\"menu\",Object (fromList [(\"popup\",Object (fromList [(\"menuitem\",Array [Number 1.0,Number 4.0,Number 2.0,Number 5.0])])),(\"value\",String \"File\"),(\"id\",String \"file\")]))]))\n</code></pre>\n\n<p>So in fact there is nothing to define at all, you can use <code>decode</code> to decode to a <code>Value</code> as well. You however probably should specify the siganture to make that clear, so <code>decode \"4\" :: Maybe Value</code> for example.</p>\n\n<p>The return type of decode is a <code>Maybe Value</code>, since it is not said that the <code>ByteString</code> you provided is a <em>valid</em> JSON stream. If you are absolutely sure it is valid JSON, you can use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Maybe.html#v:fromJust\" rel=\"noreferrer\"><strong><code>fromJust :: Maybe a -&gt; a</code></strong></a>. But it is probably better to implement some sort of fallback mechanism.</p>\n"}, {"comments": [{"owner": {"reputation": 820, "user_id": 9898465, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eZqQf.jpg?s=128&g=1", "display_name": "Luk&#225;\u0161 K\u0159ivka", "link": "https://stackoverflow.com/users/9898465/luk%c3%a1%c5%a1-k%c5%99ivka"}, "edited": false, "score": 0, "creation_date": 1567964464, "post_id": 57844009, "comment_id": 102115863, "body": "Thanks a lot.  I appreciate it."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 2, "last_activity_date": 1567962209, "creation_date": 1567962209, "answer_id": 57844009, "question_id": 57842802, "link": "https://stackoverflow.com/questions/57842802/aeson-simply-decode-bytestring-value/57844009#57844009", "title": "Aeson - simply decode ByteString -&gt; Value", "body": "<blockquote>\n  <p>Everything seems to be only speaking about converting directly ByteString into a final type.</p>\n</blockquote>\n\n<p>What makes \"a finaly type\" special?  Can <code>Value</code> be \"final type\"?</p>\n\n<p>I think you're talking about the FromJSON class, which <code>Value</code> is already an instance.</p>\n\n<p>You mention how Haskell can be frustrating and you've been searching for a function. Perhaps what you need isn't just a solution (<code>decode</code> as mentioned by @WillemVanOnsem) but also learning how to search.</p>\n\n<p><strong>How to Search</strong></p>\n\n<p>First, look at the documentation of <a href=\"https://hackage.haskell.org/package/aeson-1.4.4.0/docs/Data-Aeson.html#t:Value\" rel=\"nofollow noreferrer\">type you want and its instances</a>  If you're at all familiar with the library you should recognize the important instances of ToJSON and FromJSON, which yield what you desire.</p>\n\n<p>If the instances do not suffice then use Hoogle as Chris commented.  In this case you could tell hoogle to look just at Aeson and the type of the function you'd like: <a href=\"https://hoogle.haskell.org/?hoogle=%2Baeson%20ByteString%20-%3E%20Value\" rel=\"nofollow noreferrer\"><code>+aeson ByteString -&gt; Value</code></a>.</p>\n"}], "owner": {"reputation": 820, "user_id": 9898465, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eZqQf.jpg?s=128&g=1", "display_name": "Luk&#225;\u0161 K\u0159ivka", "link": "https://stackoverflow.com/users/9898465/luk%c3%a1%c5%a1-k%c5%99ivka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 254, "favorite_count": 0, "accepted_answer_id": 57842854, "answer_count": 2, "score": 3, "last_activity_date": 1567964061, "creation_date": 1567952762, "last_edit_date": 1567964061, "question_id": 57842802, "link": "https://stackoverflow.com/questions/57842802/aeson-simply-decode-bytestring-value", "title": "Aeson - simply decode ByteString -&gt; Value", "body": "<p>Sometimes Haskell can be really frustrating :) I'm searching for any function to simply convert ByteString into a Value. Everything seems to be only speaking about converting directly ByteString into a final type.</p>\n\n<p>My reason to do this is to convert the JSON into Value and then \"pre-extract\" part of the Value that contains the \"real data\" and only pass the \"real data\" (one of many types) for specific type decoding so this part is not repeated in every parseJSON instance.</p>\n\n<p>EDIT:\nThanks to everyone for answers, I forgot to show the real problem, maybe there is a better solution:</p>\n\n<p>So, I'm building API client and the API returns everything wrapped in \"data\" object.</p>\n\n<p>GET Dataset</p>\n\n<pre><code>{\n  \"data\": {\n    \"id\": \"WkzbQMuFYuamGv3YF\",\n    \"name\": \"d7b9MDYsbtX5L7XAj\",\n    ...\n  }\n}\n</code></pre>\n\n<p>I parse this into</p>\n\n<pre><code>data Dataset = Dataset {\n  name :: String,\n  id :: String,\n  ...\n}\n</code></pre>\n\n<p>Then there is more complicated type of response with pagination\nGET List Datasets</p>\n\n<pre><code>{\n  \"data\": {\n    \"total\": 2,\n    \"offset\": 0,\n    \"limit\": 1000,\n    \"desc\": false,\n    \"count\": 2,\n    \"items\": [\n      {\n        \"id\": \"WkzbQMuFYuamGv3YF\",\n        \"name\": \"d7b9MDYsbtX5L7XAj\",\n        ...\n      },\n      ...\n     ]\n  }\n}\n</code></pre>\n\n<p>For which I use more generic type as there is pagination of other things too</p>\n\n<pre><code>data PaginationList a = PaginationList {\n    total :: Int,\n    offset :: Int,\n    limit :: Int,\n    desc :: Bool,\n    count :: Int,\n    items :: [a]\n} deriving Show\n</code></pre>\n\n<p>Now, this composes nicely and the Dataset inside parses automatically <strong>except</strong> for that \"data\" wrapper that I have to remove in every parsing. So this naive attempt doesn't work since in items :: [a] (where a becomes Dataset) I would try to unwrap every Dataset from \"data\".</p>\n\n<p>Thus the solution I thought of is to pre-parse the JSON into Value to get rid of the \"data\" and then all the types will compose nicely.</p>\n"}, {"tags": ["haskell", "reverse-proxy", "servant"], "comments": [{"owner": {"reputation": 1518, "user_id": 439034, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/25bcd10eae437d11365ec0fb5483d354?s=128&d=identicon&r=PG", "display_name": "worldsayshi", "link": "https://stackoverflow.com/users/439034/worldsayshi"}, "edited": false, "score": 0, "creation_date": 1567947039, "post_id": 57841284, "comment_id": 102111675, "body": "I think I might need to combine <code>hoistServer</code> with <code>waiProxyTo</code> somehow..."}], "answers": [{"tags": [], "owner": {"reputation": 1518, "user_id": 439034, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/25bcd10eae437d11365ec0fb5483d354?s=128&d=identicon&r=PG", "display_name": "worldsayshi", "link": "https://stackoverflow.com/users/439034/worldsayshi"}, "is_accepted": true, "score": 0, "last_activity_date": 1567953611, "last_edit_date": 1567953611, "creation_date": 1567950721, "answer_id": 57842558, "question_id": 57841284, "link": "https://stackoverflow.com/questions/57841284/partial-reverse-proxy-with-haskell-servant/57842558#57842558", "title": "Partial reverse proxy with Haskell Servant", "body": "<p>I don't fully understand why this works but I got it working by mimicking how <a href=\"https://hackage.haskell.org/package/servant-server-0.16.2/docs/src/Servant.Server.StaticFiles.html#serveDirectoryWith\" rel=\"nofollow noreferrer\"><code>serveDirectoryWith</code></a> works:</p>\n\n<pre><code>import Servant.Server (ServerT, Tagged)\n{- ... -}\nforwardServer :: Manager -&gt; ServerT Raw m\nforwardServer manager = Tagged $ waiProxyTo forwardRequest defaultOnExc manager\n\nforwardRequest :: Request -&gt; IO WaiProxyResponse\nforwardRequest _ =\n    pure . WPRProxyDest . ProxyDest \"127.0.0.1\" $ 4567\n\napp :: Manager -&gt; Application\napp manager =\n    serve api $ server :&lt;|&gt; (forwardServer manager)\n</code></pre>\n"}], "owner": {"reputation": 1518, "user_id": 439034, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/25bcd10eae437d11365ec0fb5483d354?s=128&d=identicon&r=PG", "display_name": "worldsayshi", "link": "https://stackoverflow.com/users/439034/worldsayshi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "accepted_answer_id": 57842558, "answer_count": 1, "score": 1, "last_activity_date": 1574754483, "creation_date": 1567940107, "last_edit_date": 1567953761, "question_id": 57841284, "link": "https://stackoverflow.com/questions/57841284/partial-reverse-proxy-with-haskell-servant", "title": "Partial reverse proxy with Haskell Servant", "body": "<p>I'm trying to build a web server in Haskell with <a href=\"https://www.servant.dev/\" rel=\"nofollow noreferrer\">Servant</a> where part of the api works as a reverse proxy to another api.</p>\n\n<p><a href=\"https://github.com/parsonsmatt/incremental-servant/blob/cat-takeover/src/Api.hs\" rel=\"nofollow noreferrer\">I found an example</a> of how to achieve this. But it seems that it doesn't work: </p>\n\n<pre><code>\ntype API\n    = \"cat\" :&gt; Get '[JSON] Cat\n\nnewtype Cat = Cat { cat :: String }\n\ninstance ToJSON Cat where\n    toJSON (Cat mew) =\n        object [ \"cat\" .= mew ]\n\nserver :: Server API\nserver = pure (Cat { cat = \"mrowl\" })\n\napi :: Proxy (API :&lt;|&gt; Raw)\napi = Proxy\n\napp :: Manager -&gt; Application\napp manager =\n    serve api $ server :&lt;|&gt; waiProxyTo forwardRequest defaultOnExc manager\n\nforwardRequest :: Request -&gt; IO WaiProxyResponse\nforwardRequest _ =\n    pure . WPRProxyDest . ProxyDest \"127.0.0.1\" $ 4567\n\nstartApp :: IO ()\nstartApp = do\n    manager &lt;- newManager defaultManagerSettings\n    run 8080 (app manager)\n</code></pre>\n\n<p>It gives the following type error (when I try it in my own code base):</p>\n\n<pre><code>    \u2022 Couldn't match type \u2018Request\n                           -&gt; (Response -&gt; IO ResponseReceived) -&gt; IO ResponseReceived\u2019\n                     with \u2018Tagged Handler Application\u2019\n      Expected type: Server (API :&lt;|&gt; Raw)\n        Actual type: Handler Cat :&lt;|&gt; Application\n    \u2022 In the second argument of \u2018($)\u2019, namely\n        \u2018server :&lt;|&gt; waiProxyTo forwardRequest defaultOnExc manager\u2019\n      In the expression:\n        serve api\n          $ server :&lt;|&gt; waiProxyTo forwardRequest defaultOnExc manager\n      In an equation for \u2018app\u2019:\n          app manager\n            = serve api\n                $ server :&lt;|&gt; waiProxyTo forwardRequest defaultOnExc manager\n   |\n32 |     serve api $ server :&lt;|&gt; waiProxyTo forwardRequest defaultOnExc manager\n   |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>(My interpretation is that <code>:&lt;|&gt;</code> has changed to not accept combing Server and Application since the example was written.)</p>\n\n<p>What can I replace <code>waiProxyTo forwardRequest defaultOnExc manager</code> with to make this work?</p>\n"}, {"tags": ["haskell", "recursion", "infinite-loop", "arrows", "interpretation"], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1567956611, "post_id": 57843120, "comment_id": 102113936, "body": "IOW, <i>use <code>newtype A ...</code> instead of <code>data A ...</code></i> (?) ."}, {"owner": {"reputation": 1027, "user_id": 8201661, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ZnbSrY_hynY/AAAAAAAAAAI/AAAAAAAAAGg/DP36j8HxldM/photo.jpg?sz=128", "display_name": "Nick", "link": "https://stackoverflow.com/users/8201661/nick"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1567956887, "post_id": 57843120, "comment_id": 102113995, "body": "@Will Oh, I didn&#39;t realize that was relevant here. It might be good to add your own answer if it&#39;s simpler."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1567957869, "post_id": 57843120, "comment_id": 102114208, "body": "it&#39;s just a guess... feel free to edit it in, if it works. :) --- I&#39;m having a bit of trouble parsing your &quot;The lazy pattern defers the forcing to under the body of the lambda in your definition of first.&quot;, maybe you could copy-edit for clarity?"}, {"owner": {"reputation": 1027, "user_id": 8201661, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ZnbSrY_hynY/AAAAAAAAAAI/AAAAAAAAAGg/DP36j8HxldM/photo.jpg?sz=128", "display_name": "Nick", "link": "https://stackoverflow.com/users/8201661/nick"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1567962953, "post_id": 57843120, "comment_id": 102115456, "body": "I tried to clarify, and I incorporated your suggestion regarding <code>newtype</code>"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1568043706, "post_id": 57843120, "comment_id": 102140655, "body": "thanks; nice answer! --- so maybe the central point is that we had there <code>first (arr id &gt;&gt;&gt; eval)</code> and this must be equivalent to <code>first (id &gt;&gt;&gt; eval)</code> and that must be equivalent to just <code>first eval</code>; but it wasn&#39;t."}], "tags": [], "owner": {"reputation": 1027, "user_id": 8201661, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ZnbSrY_hynY/AAAAAAAAAAI/AAAAAAAAAGg/DP36j8HxldM/photo.jpg?sz=128", "display_name": "Nick", "link": "https://stackoverflow.com/users/8201661/nick"}, "is_accepted": true, "score": 4, "last_activity_date": 1567962761, "last_edit_date": 1567962761, "creation_date": 1567955158, "answer_id": 57843120, "question_id": 57840996, "link": "https://stackoverflow.com/questions/57840996/why-does-recursive-binding-of-arrow-function-in-haskell-loop-infinitely/57843120#57843120", "title": "Why does recursive binding of arrow function in Haskell loop infinitely?", "body": "<p>There are two ways you can fix the non-termination:</p>\n\n<ol>\n<li>Change <code>A</code> from a <code>data</code> declaration to a <code>newtype</code> declaration.</li>\n<li><p>Change the pattern matching in the definitions of <code>first</code> and <code>left</code> to be lazy, i.e.:</p>\n\n<pre><code>first ~(A f) = A $ ...same as before...\nleft ~(A f) = A $ ...same as before...\n</code></pre></li>\n</ol>\n\n<p>Both of these fixes address the same root issue. From <a href=\"https://stackoverflow.com/a/21081227/8201661\">another StackOverflow answer:</a></p>\n\n<blockquote>\n  <p>[With <code>data</code> declarations], when pattern matching against value constructors, [thunks] WILL be evaluated at least to weak head normal form (WHNF). [...] [With <code>newtype</code> declarations,] when pattern matching against value constructors, [thunks] WILL NOT be evaluated at all.</p>\n</blockquote>\n\n<p>To continue, I will explain a major difference between <code>newtype</code> and <code>data</code> declarations, and then I will explain how it applies to your case.</p>\n\n<h2>Strictness properties of <code>newtype</code> and <code>data</code></h2>\n\n<p>Most of the following is paraphrased and adapted from <a href=\"https://wiki.haskell.org/Newtype\" rel=\"nofollow noreferrer\">the HaskellWiki article on the same topic</a>.</p>\n\n<p><code>newtype</code> is intended to introduce a type that is exactly isomorphic to an existing type. Given a declaration <code>newtype T1 = T1 { unpack :: Int }</code>, we would like <code>unpack . T1</code> and <code>id</code> to be equal at the type <code>Int -&gt; Int</code>, and likewise for <code>T1 . unpack</code> and <code>id</code> to be equal at the type <code>T1 -&gt; T1</code>.</p>\n\n<p>But why does this not already hold for <code>data T2 = T2 { unpack :: Int }</code>; that is, why is <code>T2 . unpack</code> not the same as <code>id</code>? The reason is non-termination. <code>T2 (unpack _|_)</code> evaluates to <code>T2 _|_</code>, but <code>id _|_</code> evaluates to <code>_|_</code> (where I'm using <code>_|_</code> to stand for the non-terminating computation \"bottom\", as is customary). We can distiguish <code>_|_</code> and <code>T2 _|_</code> with the following expression:</p>\n\n<p><code>\\x -&gt; case x of T2 _ -&gt; ()</code></p>\n\n<p>Applying this lambda to <code>_|_</code> yields <code>_|_</code>, but applying this lambda to <code>T2 _|_</code> yields <code>()</code>. That is, because the constructor <code>T2</code> can possibly hold a non-terminating value, the language makes it possible to distinguish <code>_|_</code> and <code>T2 _|_</code>.</p>\n\n<p>The <code>newtype</code> declaration gives us a perhaps surprising property: <code>T1 (unpack _|_)</code> evaluates to <code>_|_</code>, but <code>case _|_ of T1 _ -&gt; ()</code> evaluates to <code>()</code>! That is, because <code>T1 _|_</code> is not intended to be distinguishable from <code>_|_</code>, the language does not force evaluation of values of type <code>T1</code> when pattern matching against the <code>T1</code> value constructor. And, as we'll see shortly, this property is important with recursive definitions.</p>\n\n<h2>Lazy patterns</h2>\n\n<p>There is a way to recover a newtype-like behavior for <code>data</code> declarations: use lazy pattern matching. Given a function like:</p>\n\n<pre><code>f x = case x of ~(T2 y) -&gt; \\() -&gt; y\n</code></pre>\n\n<p>you will find that both <code>f (T2 _|_)</code> and <code>f _|_</code> evaluate to a value (i.e., a function of type <code>Unit -&gt; Int</code> that would diverge as soon as it is applied to an argument). This is because the lazy pattern match is identical to the function:</p>\n\n<pre><code>f = \\x -&gt; case x of t -&gt; \\() -&gt; unpack t\n</code></pre>\n\n<p>and so the evaluation of the thunk passed as <code>x</code> is \"deferred\" in the sense that it is only evaluated when <code>unpack t</code> is evaluated, in the body of the lambda <code>\\() -&gt; unpack t</code>.</p>\n\n<h2>Newtype vs. data declarations for your example</h2>\n\n<p>I will now desugar the arrow notation in your example and then identify the source of the non-termination.</p>\n\n<p>To desugar the arrow notation, I used the <a href=\"https://github.com/pepeiborra/arrowp\" rel=\"nofollow noreferrer\"><code>arrowp</code> program</a>. This is what it yields on your program:</p>\n\n<pre><code>$ arrowp-ext interp.hs\neval :: A Expr Val\neval\n       = (arr\n       (\\ e -&gt;\n          case e of\n              Lit x -&gt; (Left) (x)\n              Var s -&gt; (Right) ((Left) (s))\n              Add e1 e2 -&gt; (Right) ((Right) ((e1, e2))))\n       &gt;&gt;&gt;\n       (((arr (\\ x -&gt; Num x)) &gt;&gt;&gt; (returnA)) |||\n          (((arr (\\ s -&gt; s)) &gt;&gt;&gt; (lookup)) |||\n             (((first ((arr (\\ e1 -&gt; e1)) &gt;&gt;&gt; (eval))) &gt;&gt;&gt;\n                 (arr (\\ (v1, e2) -&gt; (e2, v1))))\n                &gt;&gt;&gt;\n                (first ((arr (\\ e2 -&gt; e2)) &gt;&gt;&gt; (eval))) &gt;&gt;&gt;\n                  (arr\n                     (\\ (v2, v1) -&gt;\n                        case\n                          case (v1, v2) of\n                              (Num x, Num y) -&gt; (x, y)\n                          of\n                            (x, y) -&gt; Num (x + y)))\n                    &gt;&gt;&gt; (returnA)))))\n</code></pre>\n\n<p>You identified that <code>eval</code> doesn't terminate when applied to an argument, but the problem is more serious than that: <code>eval</code> diverges, period. This can be observed in ghci:</p>\n\n<pre><code>*Interp&gt; eval `seq` 0\n</code></pre>\n\n<p>The proximal cause of the non-termination is the expression <code>first ((arr (\\ e1 -&gt; e1)) &gt;&gt;&gt; (eval))</code>, which is the same as <code>first eval</code>. The first parameter in the definition of <code>first</code> involves a strict pattern match against a value constructor (<code>first (A f)</code>), and <code>A</code> originates from a data declaration, and so, re-quoting <a href=\"https://stackoverflow.com/users/506566/wonder-mice\">@wonder.mice</a>:</p>\n\n<blockquote>\n  <p>[With data declarations], when pattern matching against value constructors, [thunks] WILL be evaluated at least to weak head normal form (WHNF). </p>\n</blockquote>\n\n<p>When the expression <code>first eval</code> is encountered in the definition of <code>eval</code>, the thunk for <code>eval</code> has not yet been evaluated to WHNF, and so when <code>first eval</code> attempts to evaluate its argument to WHNF, it will not terminate.</p>\n\n<p>One way to fix this is to change <code>A</code> to a <code>newtype</code> declaration. (\"1. Change <code>A</code> from a <code>data</code> declaration to a <code>newtype</code> declaration.\") Then,</p>\n\n<blockquote>\n  <p>...when pattern matching against value constructors, [thunks] WILL NOT be evaluated at all.</p>\n</blockquote>\n\n<p>The other way to fix this is to make <code>first</code> use a lazy pattern match instead of a strict one (\"2. Change the pattern matching in the definitions of <code>first</code> and <code>left</code> to be lazy\"). This will have the net effect of making the pattern match behave the same as for a newtype declaration, where \"thunks WILL NOT be evaluated at all\".</p>\n\n<p>A similar explanation can be used for why <code>|||</code> is not behaving in a lazy manner for your example, even though it does for e.g. the Arrow instance for <code>(-&gt;)</code>. Changing <code>left</code> to use a lazy pattern match will take care of this issue, or just using a <code>newtype</code> declaration will be sufficient.</p>\n"}], "owner": {"reputation": 53, "user_id": 11624866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d011f9d79b722372dee0cc0959f4c6f?s=128&d=identicon&r=PG&f=1", "display_name": "Myuri", "link": "https://stackoverflow.com/users/11624866/myuri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 197, "favorite_count": 1, "accepted_answer_id": 57843120, "answer_count": 1, "score": 5, "last_activity_date": 1567962761, "creation_date": 1567937592, "last_edit_date": 1567956738, "question_id": 57840996, "link": "https://stackoverflow.com/questions/57840996/why-does-recursive-binding-of-arrow-function-in-haskell-loop-infinitely", "title": "Why does recursive binding of arrow function in Haskell loop infinitely?", "body": "<p>I'm learning how to use Arrows in Haskell by implementing a simple interpreter for the <a href=\"https://plzoo.andrej.com/language/comm.html\" rel=\"noreferrer\">comm</a> language.</p>\n\n<p>I have an eval function which evaluates an expression into a value, but eval loops indefinitely when feeding in any expression.</p>\n\n<pre><code>-- Interp.hs\n\neval :: A Expr Val\neval = proc e -&gt; case e of\n    Lit x -&gt; returnA -&lt; Num x\n    Var s -&gt; do\n        lookup -&lt; s\n    Add e1 e2 -&gt; do\n        v1 &lt;- eval -&lt; e1\n        v2 &lt;- eval -&lt; e2\n        case (v1, v2) of\n            (Num x, Num y) -&gt; returnA -&lt; Num (x + y)\n</code></pre>\n\n<p>Executing this in GHCI results in an infinite loop</p>\n\n<pre><code>*Interp&gt; unpack eval M.empty (Lit 1)\n</code></pre>\n\n<p>Commenting out the eval's in the case of the Add expression does result in the expression giving a result</p>\n\n<p>e.g.</p>\n\n<pre><code>-- Interp.hs\n\neval :: A Expr Val\neval = proc e -&gt; case e of\n    Lit x -&gt; returnA -&lt; Num x\n    Var s -&gt; do\n        lookup -&lt; s\n    Add e1 e2 -&gt; do\n        returnA -&lt; Num 1\n--        v1 &lt;- eval -&lt; e1\n--        v2 &lt;- eval -&lt; e2\n--        case (v1, v2) of\n--            (Num x, Num y) -&gt; returnA -&lt; Num (x + y)\n</code></pre>\n\n<pre><code>*Interp&gt; unpack eval M.empty (Lit 1)\n(Right (Num 1),fromList [])\n</code></pre>\n\n<p>Here's the code in question<br>\nThe arrow used is a sort of state function that keeps passing context after failure.</p>\n\n<pre><code>{-# LANGUAGE Arrows #-}\n{-# OPTIONS_GHC -Wall #-}\nmodule Interp where\n\nimport Prelude hiding (lookup, fail)\n\nimport qualified Data.Map as M\nimport Control.Arrow\nimport Control.Category\n\ndata Expr\n    = Lit Int\n    | Var String\n    | Add Expr Expr\n    deriving (Show, Eq)\n\ndata Val\n    = Num Int\n    deriving (Show, Eq)\n\ntype Env = M.Map String Val\n\ndata A b c = A { unpack :: (Env -&gt; b -&gt; (Either String c, Env)) }\n\ninstance Category A where\n    id = A (\\env b -&gt; (Right b, env))\n    A g . A f = A $ \\env b -&gt; case f env b of\n        (Left err, env') -&gt; (Left err, env')\n        (Right c, env') -&gt; g env' c\n\ninstance Arrow A where\n    arr f = A $ \\env b -&gt; (Right (f b), env)\n    first (A f) = A $ \\env (b, d) -&gt; case f env b of\n        (Left err, env') -&gt; (Left err, env')\n        (Right c, env') -&gt; (Right (c, d), env')\n\ninstance ArrowChoice A where\n    left (A f) = A $ \\env e -&gt; case e of\n        Left b -&gt; case f env b of\n            (Left err, env') -&gt; (Left err, env')\n            (Right c, env') -&gt; (Right (Left c), env')\n        Right d -&gt; (Right (Right d), env)\n\nlookup :: A String Val\nlookup = A $ \\env k -&gt; case M.lookup k env of\n    Nothing -&gt; (Left \"Variable not bound\", env)\n    Just v -&gt; (Right v, env)\n\neval :: A Expr Val\neval = proc e -&gt; case e of\n    Lit x -&gt; returnA -&lt; Num x\n    Var s -&gt; do\n        lookup -&lt; s\n    Add e1 e2 -&gt; do\n        v1 &lt;- eval -&lt; e1\n        v2 &lt;- eval -&lt; e2\n        case (v1, v2) of\n            (Num x, Num y) -&gt; returnA -&lt; Num (x + y)\n\n</code></pre>\n"}, {"tags": ["haskell", "random", "aeson", "io-monad"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1567894416, "post_id": 57837736, "comment_id": 102103814, "body": "You might like <a href=\"http://blog.sigfpe.com/2007/11/io-monad-for-people-who-simply-dont.html\" rel=\"nofollow noreferrer\">The IO Monad for People who Simply Don&#39;t Care</a>. Even if you don&#39;t, there are many, many tutorials lying around the web for understanding how to be productive with Haskell&#39;s IO model. Do we really need yet another one to be extemporized here on SO?"}, {"owner": {"reputation": 85, "user_id": 11514521, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-2OJcM4zNtUQ/AAAAAAAAAAI/AAAAAAAAB1c/h1tmB8tQFDs/photo.jpg?sz=128", "display_name": "Augusto Dias", "link": "https://stackoverflow.com/users/11514521/augusto-dias"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1567921346, "post_id": 57837736, "comment_id": 102107109, "body": "@DanielWagner Thanks for the tutorial. I dont know but it looks like I&#39;m missing something that is so trivial"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1567928433, "post_id": 57837736, "comment_id": 102108117, "body": "You already have a string &quot;coming back from IO&quot; in your program. <code>readFile :: String -&gt; IO String</code>. Look at how that is used."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 2, "last_activity_date": 1567962115, "creation_date": 1567962115, "answer_id": 57843996, "question_id": 57837736, "link": "https://stackoverflow.com/questions/57837736/how-to-use-randomness-in-haskell-to-produce-instances-of-a-json-model/57843996#57843996", "title": "How to use randomness in Haskell to produce instances of a JSON &quot;model&quot;?", "body": "<p>It's relatively common when writing Haskell code to find yourself needing to convert a block of pure code into an IO action (or monadic code in some other action).  It comes with practice (and, as per the comments, after reading a <em>LOT</em> of tutorials), but I can show you my thought process as I work through your code example.</p>\n\n<p>As you've discovered, trying to \"hide\" the IO using <code>unsafePerformIO</code> is a terrible idea.  The correct alternative is to rewrite the whole thing to operate in the IO monad, even though -- as you've seen -- rewriting <code>randomStr :: String</code> as <code>randomStr :: IO String</code> starts a chain of type mismatch errors that need to be resolved all the way to the top.</p>\n\n<p>So, let's resolve them.  If <code>valueMapper</code> is going to make use of <code>randomStr :: IO String</code>, it too will need to operate in the IO monad:</p>\n\n<pre><code>valueMapper :: Types.Value -&gt; IO Types.Value\n</code></pre>\n\n<p>(Note: If you make this change while using a live type-checking IDE, you'll find that the invocation of <code>valueMapper</code> in <code>read</code> is now flagged as a type error, as are the four branches in the case statement.)</p>\n\n<p>Anyway, there's no problem with the outer structure of <code>valueMapper</code>, namely case-matching on the argument:</p>\n\n<pre><code>valueMapper value =\n    case value of\n        Types.String _      -&gt; ???\n        Types.Number _      -&gt; ???\n        Types.Object object -&gt; ???\n        Types.Array  array  -&gt; ???\n</code></pre>\n\n<p>The difference is that now each of the <code>???</code> need to return an <code>IO Types.Value</code> instead of a <code>Types.Value</code>.  Let's start with an easy one.  Suppose we aren't going to generate random numbers yet, so we just want to convert the branch:</p>\n\n<pre><code>Types.Number _ -&gt; Types.Number 0   -- pure version\n</code></pre>\n\n<p>to IO.  Here, we have a pure value <code>Types.Number 0 :: Types.Value</code>, and we want a monadic version.  That's what <code>return</code> is used for:</p>\n\n<pre><code>Types.Number _ -&gt; return (Types.Number 0)   -- IO version\n</code></pre>\n\n<p>The next easiest is the string branch.  Right now, it looks like:</p>\n\n<pre><code>Types.String _ -&gt; Types.String $ Data.Text.pack randomStr\n</code></pre>\n\n<p>where <code>randomStr</code> is an <code>IO String</code>.  It's still a mess of type errors, though.  That's because <code>randomStr</code> is an <code>IO String</code>, and we want to convert it to an <code>IO Types.Value</code>, but the construct:</p>\n\n<pre><code>Types.String $ Data.Text.pack _\n</code></pre>\n\n<p>is trying to convert a <code>String</code> to a <code>Types.Value</code> directly.  This is a common problem when working with monadic values.  We have an <code>IO a</code> that we want to convert to an <code>IO b</code>, but all we have is a function (here, <code>Types.String . Data.Text.pack</code>) to perform the direct conversion <code>a -&gt; b</code>.  It would be helpful if we had some adapter function with signature:</p>\n\n<pre><code>foo :: (a -&gt; b) -&gt; IO a -&gt; IO b\n</code></pre>\n\n<p>Fortunately, because IO, like all monads, is also a functor, we <em>do</em> have such an adapter:</p>\n\n<pre><code>fmap :: (a -&gt; b) -&gt; IO a -&gt; IO b\n</code></pre>\n\n<p>so, we can write the branch as:</p>\n\n<pre><code>Types.String _ -&gt; fmap (Types.String . Data.Text.pack) randomStr\n</code></pre>\n\n<p>The last two, for objects and arrays, are tougher, though the solution is the same for each.  Taking the object branch, it's pure version looks like:</p>\n\n<pre><code>Types.Object object -&gt; Types.Object $ fmap valueMapper object\n</code></pre>\n\n<p>In the pure version, <code>fmap</code> is used to apply <code>valueMapper :: Types.Value -&gt; Types.Value</code> to each element of the list <code>object :: [Types.Value]</code> to get a new list of type <code>[Types.Value]</code> which is then converted to a <code>Types.Value</code> using the <code>Types.Object</code> constructor.</p>\n\n<p>Let's tackle the <code>fmap</code> first.  We will still have <code>object :: [Types.Value]</code> from case matching on our pure argument <code>value</code>, so that hasn't changed.  But we want to apply the function <code>valueMapper :: Types.Value -&gt; IO Types.Value</code> to each element of <code>object</code>.  The result will be a list of <code>Types.Value</code>, but in an IO monad context, so the full result type will be <code>IO [Types.Value]</code>.  That is, we want an adapter function:</p>\n\n<pre><code>bar :: (a -&gt; IO a) -&gt; [a] -&gt; IO [a]\n       ^^^^^^^^^^^    ^^^    ^^^^^^- output list in IO context\n                 |      `- input list\n                 `- element-by-element conversion\n</code></pre>\n\n<p>Such a function already exists in more general form as <code>traverse</code>.  The full signature is:</p>\n\n<pre><code>traverse :: (Traversable t, Applicative f) =&gt; (a -&gt; f b) -&gt; t a -&gt; f (t b)\n</code></pre>\n\n<p>but specialized to a list traversable and an IO applicative, it's:</p>\n\n<pre><code>traverse :: (a -&gt; IO b) -&gt; [a] -&gt; IO [b]\n</code></pre>\n\n<p>Using it in our object branch, the result will look like:</p>\n\n<pre><code>Types.Object object -&gt; Types.Object $ traverse valueMapper object\n</code></pre>\n\n<p>This still gives a type error because <code>traverse valueMapper object</code> returns an <code>IO [Types.Value]</code>, and we are trying to use the direct conversion <code>Types.Object :: [Types.Value] -&gt; Types.Value</code> where we actually need a conversion <code>IO [Types.Value] -&gt; IO Types.Value</code>.  This is the same problem we had with the string branch above, and the solution is to use <code>fmap</code>, so the following type checks:</p>\n\n<pre><code>Types.Object object -&gt; fmap Types.Object (traverse valueMapper object)\n</code></pre>\n\n<p>You might want to take a moment here to perform the equivalent conversion on the array branch.</p>\n\n<p>With those changes, <code>valueMapper</code> will type check.  Now the only issue is that it's usage in <code>read</code> won't type check.  The problem is the line:</p>\n\n<pre><code>let newJSON = fmap valueMapper parsedJSON\n</code></pre>\n\n<p>Here <code>parsedJSON</code> is of type <code>Aeson.Object</code> AKA <code>Types.Object</code> which is actually an alias for <code>HashMap Text Types.Value</code>.  The <code>fmap</code> here is used apply a pure <code>valueMapper :: Types.Value -&gt; Types.Value</code> to each hashmap element in turn.</p>\n\n<p>Now, we want to apply <code>valueMapper :: Types.Value -&gt; IO Types.Value</code> to each element in turn and get the whole result in an IO context as <code>IO Aeson.Object</code>.  Fortunately, <code>Aeson.Object</code> AKA <code>HashMap</code> is <code>Traversable</code>, so the solution here is the same as for the object and array branches before -- replace the <code>fmap</code> with <code>traverse</code>:</p>\n\n<pre><code>let newJSON = traverse valueMapper parsedJSON\n</code></pre>\n\n<p>This still won't quite work, as the next line:</p>\n\n<pre><code>print $ Aeson.encode newJSON\n</code></pre>\n\n<p>expects <code>newJSON</code> to be a pure <code>Aeson.Object</code>, but the return value of the <code>traverse</code> call is in the IO context, so it's <code>IO Aeson.Object</code>.  We could try to rewrite this <code>print</code> line to expect <code>newJSON :: IO Aeson.Object</code>.  For example, the following would work:</p>\n\n<pre><code>print =&lt;&lt; fmap Aeson.encode newJSON\n</code></pre>\n\n<p>However, there's actually a much simpler way.  In a do-block, the left arrow <code>&lt;-</code> notation can be used for this purpose.  Where:</p>\n\n<pre><code>let newJSON = traverse valueMapper parsedJSON\n</code></pre>\n\n<p>assigns <code>newJSON</code> an IO action of type <code>IO Aeson.Object</code>, the alternative:</p>\n\n<pre><code>newJSON &lt;- traverse valueMapper parsedJSON\n</code></pre>\n\n<p>\"unwraps\" the IO action to assign <code>newJSON</code> the underlying <code>Aeson.Object</code> for use in subsequent statements.  So:</p>\n\n<pre><code>newJSON &lt;- traverse valueMapper parsedJSON\nprint $ Aeson.encode newJSON\n</code></pre>\n\n<p>will type check.</p>\n\n<p>One more stylistic note.  It's common to use the infix synonym <code>&lt;$&gt;</code> in place of <code>fmap</code> to apply pure functions to IO actions.  So, the final program would look like this:</p>\n\n<pre><code>import qualified Data.ByteString.Lazy.Char8    as ByteString\nimport qualified Data.Aeson                    as Aeson\nimport qualified Data.Aeson.Types              as Types\nimport qualified Data.Text\n\nimport Control.Monad\nimport System.Random\n\nread :: String -&gt; IO ()\nread filePath = do\n    json &lt;- readFile filePath\n    let Just parsedJSON =\n            Aeson.decode $ ByteString.pack json :: Maybe Aeson.Object\n    newJSON &lt;- traverse valueMapper parsedJSON\n    print $ Aeson.encode newJSON\n\nvalueMapper :: Types.Value -&gt; IO Types.Value\nvalueMapper value =\n    case value of\n        Types.String _      -&gt; Types.String . Data.Text.pack &lt;$&gt; randomStr\n        Types.Number _      -&gt; return $ Types.Number 0\n        Types.Object object -&gt; Types.Object &lt;$&gt; traverse valueMapper object\n        Types.Array  array  -&gt; Types.Array &lt;$&gt; traverse valueMapper array\n\nrandomStr :: IO String\nrandomStr = replicateM 10 (randomRIO ('a', 'z'))\n</code></pre>\n"}], "owner": {"reputation": 85, "user_id": 11514521, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-2OJcM4zNtUQ/AAAAAAAAAAI/AAAAAAAAB1c/h1tmB8tQFDs/photo.jpg?sz=128", "display_name": "Augusto Dias", "link": "https://stackoverflow.com/users/11514521/augusto-dias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 57843996, "answer_count": 1, "score": 0, "last_activity_date": 1567962115, "creation_date": 1567893527, "question_id": 57837736, "link": "https://stackoverflow.com/questions/57837736/how-to-use-randomness-in-haskell-to-produce-instances-of-a-json-model", "title": "How to use randomness in Haskell to produce instances of a JSON &quot;model&quot;?", "body": "<p>I have this work where I have to read a JSON from a file and generate instances of it based on its model. I'm using aeson to serialize the objects, but I'm having a huge problem dealing with randomness to produce new objects.</p>\n\n<p>Produce a new JSON based on what I get from file is pretty straight forward:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE OverloadedLists #-}\n{-# LANGUAGE OverloadedStrings #-}\n\nimport qualified Data.ByteString.Lazy.Char8    as ByteString\nimport qualified Data.Aeson                    as Aeson\nimport qualified Data.Aeson.Types              as Types\nimport qualified Data.Text\n\nread :: String -&gt; IO ()\nread filePath = do\n    json &lt;- readFile filePath\n    let Just parsedJSON =\n            Data.Aeson.decode $ ByteString.pack json :: Maybe Aeson.Object\n    let newJSON = fmap valueMapper parsedJSON\n    print $ Aeson.encode newJSON\n\n\nvalueMapper :: Types.Value -&gt; Types.Value\nvalueMapper value =\n    case value of\n        Types.String _      -&gt; Types.String \"randomValue\"\n        Types.Number _      -&gt; Types.Number 0\n        Types.Object object -&gt; Types.Object $ fmap valueMapper object\n        Types.Array  array  -&gt; Types.Array $ fmap valueMapper array\n</code></pre>\n\n<p>My first attempt was to produce random values outside the IO. I used this function:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>randomStr :: String\nrandomStr = take 10 $ randomRs ('a','z') $ unsafePerformIO newStdGen\n</code></pre>\n\n<p>Putting it on <code>valueMapper</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>valueMapper :: Types.Value -&gt; Types.Value\nvalueMapper value =\n    case value of\n        Types.String _      -&gt; Types.String $ Data.Text.pack randomStr\n        Types.Number _      -&gt; Types.Number 0\n        Types.Object object -&gt; Types.Object $ fmap valueMapper object\n        Types.Array  array  -&gt; Types.Array $ fmap valueMapper array\n</code></pre>\n\n<p>This \"works\", but all generated strings are the same, for every <code>String</code> field.</p>\n\n<p>After a little research, I found out that if I want to produce different values for each <code>String</code> occurrence, I have to use the IO:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>randomStr :: IO String\nrandomStr = replicateM 10 (randomRIO ('a', 'z'))\n</code></pre>\n\n<p>Now, I know that I have different strings for each call of <code>randomStr</code>... But I also have a type mismatch. Aeson <code>String</code> constructor to <code>Value</code> takes a <code>Data.Text</code>, but what I have is an <code>IO String</code>. As far as I know, my strings can never come back from <code>IO</code>.</p>\n\n<p>I don't know if there is a way (hope so) to use the latest <code>randomStr</code> to compose my new JSON object. I also don't know if my approach is a good one. I'm open to suggestions about how can I put this to work, in my or any other way (some tips on how to write better code would be awesome too).</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 2, "creation_date": 1567887177, "post_id": 57837108, "comment_id": 102102567, "body": "I&#39;m not aware of any function that does this, and I&#39;m not sure why one should need to exist. Adding an element to a list and removing one or rather different operations, and as you&#39;ve proved, it&#39;s not at all hard to do oneself if you do want this. (Note that the result of the first case can be simplified to <code>filter (&#47;= x) xs</code>)"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1567887244, "post_id": 57837108, "comment_id": 102102577, "body": "What if <code>x</code> occurs multiple times? Do you want to remove all these items, or only the first/last one?"}, {"owner": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "edited": false, "score": 1, "creation_date": 1567887319, "post_id": 57837108, "comment_id": 102102592, "body": "Hm... I do not expect to have more that one x. So let&#39;s see it as a Set. Let me update question."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1567887644, "post_id": 57837108, "comment_id": 102102655, "body": "@mkUltra In that case, you might want to <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:nub\" rel=\"nofollow noreferrer\"><code>nub</code></a> the list on every call. Regarding the list comprehension, there&#39;s <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:delete\" rel=\"nofollow noreferrer\"><code>delete</code></a> :-)"}, {"owner": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1567888180, "post_id": 57837108, "comment_id": 102102754, "body": "@Bergi I&#39;ve got your point about <code>nub</code>, I want to preserve the list structure without <code>nub</code> it each time because It&#39;s a part of persistence record so in the trusted perimeter"}], "answers": [{"comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 2, "creation_date": 1567887749, "post_id": 57837162, "comment_id": 102102675, "body": "You might want to highlight the difference that in contrast to the OPs code you&#39;re adding the element at the end of the list. (Not that it matters when they treat the list as a set)"}, {"owner": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "edited": false, "score": 0, "creation_date": 1567888388, "post_id": 57837162, "comment_id": 102102791, "body": "Thanks, guys! The recursion optimization looks good, in my case doesn&#39;t matter the position of an item so add at the end of the list it&#39;s fine."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1567932338, "last_edit_date": 1567932338, "creation_date": 1567887399, "answer_id": 57837162, "question_id": 57837108, "link": "https://stackoverflow.com/questions/57837108/remove-or-add-an-item-to-list-in-haskell/57837162#57837162", "title": "Remove or add an item to list in Haskell", "body": "<blockquote>\n  <p>Is there any function in Haskell that already do it?</p>\n</blockquote>\n\n<p>Not as far as I know no, and a search on <a href=\"https://hoogle.haskell.org/?hoogle=Eq%20a%20%3D%3E%20a%20-%3E%20%5Ba%5D%20-%3E%20%5Ba%5D\" rel=\"nofollow noreferrer\">Hoogle</a> does not immediately lists such function. I think it is rather strange, since usually one aims to either add, or delete, but not both depending on a condition.</p>\n\n<p>We can improve the above function, by making it more lazy (such that it works on infinite lists where <code>x</code> never occurs), as well as more efficient in the sense that we do not iterate twice over the list. We can use explicit recursion for this:</p>\n\n<pre><code>removeOrAdd :: Eq a =&gt; a -&gt; [a] -&gt; [a]\nremoveOrAdd x = go\n    where go [] = [x]\n          go (y:ys) | x == y = ys\n                    | otherwise = y : go ys</code></pre>\n\n<p>We here thus iterate over the list, we keep iterating until we find an element <code>y</code> that is equal to <code>x</code>. If that is the case, we return <code>ys</code>, and we are done, since we removed that item. If not and we reach the end of the list with the recursion, we know <code>x</code> was not part of the list, and thus we return <code>[x]</code> to add that element. Here we thus add the elements at the <em>end</em> of the list.</p>\n\n<p>If the list is sorted, we can insert it at the correct place:</p>\n\n<pre><code>removeOrAdd :: <b>Ord</b> a =&gt; a -&gt; [a] -&gt; [a]\nremoveOrAdd x = go\n    where go [] = [x]\n          go (y:ys) | x == y = ys\n                    | y &gt; x = x : y : ys\n                    | otherwise = y : go ys</code></pre>\n\n<p>Here we thus keep the items in the correct order.</p>\n"}], "owner": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 0, "accepted_answer_id": 57837162, "answer_count": 1, "score": 4, "last_activity_date": 1567932338, "creation_date": 1567886972, "last_edit_date": 1567932275, "question_id": 57837108, "link": "https://stackoverflow.com/questions/57837108/remove-or-add-an-item-to-list-in-haskell", "title": "Remove or add an item to list in Haskell", "body": "<p>I have to design a function <code>removeOrAdd :: a -&gt; [a] -&gt; [a]</code>. My straightforward solution:</p>\n\n<pre><code>removeOrAdd :: Eq a =&gt; a -&gt; [a] -&gt; [a]\nremoveOrAdd x xs | x `elem` xs = [x' | x' &lt;- xs, x' /= x]\n                 | otherwise   = x : xs\n</code></pre>\n\n<p>However, I have a feeling that I am doing something that has already been done by others. Is there any function in Haskell that already does it?</p>\n\n<hr>\n\n<p><strong>UPD:</strong> Let's see list as a <code>Set</code> we don't expect to have more than one <code>x</code> in a list, otherwise we remove all of them.</p>\n"}, {"tags": ["haskell", "random"], "comments": [{"owner": {"reputation": 348226, "user_id": 267, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/1b11262da6d1cd26b1b0bc99a2620cee?s=128&d=identicon&r=PG", "display_name": "Lasse V. Karlsen", "link": "https://stackoverflow.com/users/267/lasse-v-karlsen"}, "edited": false, "score": 0, "creation_date": 1567883816, "post_id": 57836652, "comment_id": 102101881, "body": "Just a thought, and bear in mind that I don&#39;t know haskell <i>at all</i>. In .NET, if you construct a new instance of the <code>Random</code> class and ask it for a random number, if you do this quickly in a loop, you&#39;ll observe that you get the same result for quite a while. The reason for this is that the class is seeded by the clock of the computer, but this clock value has a resolution of about 16ms, which means that if you seed 2 <code>Random</code> instances during the same 16ms interval, they&#39;ll produce the same sequence of &quot;random&quot; values. Could something similar be the case here? If not, please ignore me."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 6, "creation_date": 1567885911, "post_id": 57836652, "comment_id": 102102330, "body": "<code>unsafe</code> functions are really unsafe, and can easily break the language. You should pretend these functions are not there. Beginners should never be informed of their existence."}], "answers": [{"comments": [{"owner": {"reputation": 85, "user_id": 11514521, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-2OJcM4zNtUQ/AAAAAAAAAAI/AAAAAAAAB1c/h1tmB8tQFDs/photo.jpg?sz=128", "display_name": "Augusto Dias", "link": "https://stackoverflow.com/users/11514521/augusto-dias"}, "edited": false, "score": 0, "creation_date": 1567885861, "post_id": 57836791, "comment_id": 102102318, "body": "But now I have IO [String], not [String]. Is there a way to do it and end up with [String] or [Data.Text]?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 85, "user_id": 11514521, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-2OJcM4zNtUQ/AAAAAAAAAAI/AAAAAAAAB1c/h1tmB8tQFDs/photo.jpg?sz=128", "display_name": "Augusto Dias", "link": "https://stackoverflow.com/users/11514521/augusto-dias"}, "edited": false, "score": 5, "creation_date": 1567886004, "post_id": 57836791, "comment_id": 102102343, "body": "@AugustoDias No, there is no correct way to end with a <code>[String]</code> and no other context. You may end with a <code>StdGen -&gt; (StdGen, [String])</code> or something isomorphic; that is the closest you can get to pure for this."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 85, "user_id": 11514521, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-2OJcM4zNtUQ/AAAAAAAAAAI/AAAAAAAAB1c/h1tmB8tQFDs/photo.jpg?sz=128", "display_name": "Augusto Dias", "link": "https://stackoverflow.com/users/11514521/augusto-dias"}, "edited": false, "score": 2, "creation_date": 1567886290, "post_id": 57836791, "comment_id": 102102401, "body": "@AugustoDias An <code>IO [String]</code> is allowed to generate different strings each time. A <code>[String]</code> is not -- it is a given, immutable list of strings. If you want to print your <code>x :: IO [String]</code>, you can use something like <code>x &gt;&gt;= traverse putStrLn</code> (or, even better, use <code>traverse_</code> after the right import). I would recommend reading about how IO works in Haskell, there should be many tutorials around the &#39;net."}, {"owner": {"reputation": 85, "user_id": 11514521, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-2OJcM4zNtUQ/AAAAAAAAAAI/AAAAAAAAB1c/h1tmB8tQFDs/photo.jpg?sz=128", "display_name": "Augusto Dias", "link": "https://stackoverflow.com/users/11514521/augusto-dias"}, "edited": false, "score": 0, "creation_date": 1567890613, "post_id": 57836791, "comment_id": 102103170, "body": "I&#39;m trying to learn haskell, but it seems to be quite unpratical when things can not get out from IO once it&#39;s in."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "reply_to_user": {"reputation": 85, "user_id": 11514521, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-2OJcM4zNtUQ/AAAAAAAAAAI/AAAAAAAAB1c/h1tmB8tQFDs/photo.jpg?sz=128", "display_name": "Augusto Dias", "link": "https://stackoverflow.com/users/11514521/augusto-dias"}, "edited": false, "score": 0, "creation_date": 1567891785, "post_id": 57836791, "comment_id": 102103362, "body": "@AugustoDias If you want a pure function, you should use a pseudo-random number generator, like <a href=\"http://hackage.haskell.org/package/splitmix-0.0.3/docs/System-Random-SplitMix.html\" rel=\"nofollow noreferrer\">splitmix</a>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 85, "user_id": 11514521, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-2OJcM4zNtUQ/AAAAAAAAAAI/AAAAAAAAB1c/h1tmB8tQFDs/photo.jpg?sz=128", "display_name": "Augusto Dias", "link": "https://stackoverflow.com/users/11514521/augusto-dias"}, "edited": false, "score": 3, "creation_date": 1567894141, "post_id": 57836791, "comment_id": 102103780, "body": "@AugustoDias Strong disagree: I find it very practical indeed for things to advertise clearly when their behavior depends on values I, the caller, do not control. I use it approximately daily at my job; I can think of very few things that qualify more as &quot;practice&quot; than that for the purposes of assessing practicality."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1568470763, "post_id": 57836791, "comment_id": 102288579, "body": "You don&#39;t need to get things out of IO. Functors, applicative, and monads are all ways of injecting the functions that would operate on the extracted data <i>into</i> the monad, to be used there. Ultimately, every program is just a single value of type <code>IO ()</code> which the runtime executes for you."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 8, "last_activity_date": 1567884297, "last_edit_date": 1567884297, "creation_date": 1567883828, "answer_id": 57836791, "question_id": 57836652, "link": "https://stackoverflow.com/questions/57836652/how-can-i-generate-different-random-values-in-haskell/57836791#57836791", "title": "How can I generate different random values in Haskell?", "body": "<p>There are two problems with your code:</p>\n\n<ol>\n<li>You are calling <code>unsafePerformIO</code>, but explicitly violating the contract of that function. It is on you to prove that the thing you provide to <code>unsafePerformIO</code> is actually pure, and the compiler is within its rights to act as if that's the case, and here it is definitely not.</li>\n<li>You are not carefully tracking the updated random number generator state after using it. Indeed, it is not possible to do this correctly with <code>randomRs</code>; if you use <code>randomRs</code>, then to a first approximation, that must be the <em>last</em> randomness your program needs.</li>\n</ol>\n\n<p>The simplest fix to both of these is to admit that you really, truly are doing <code>IO</code>. So:</p>\n\n<pre><code>import Control.Monad\nimport System.Random\n\nrandomize :: String -&gt; IO String\nrandomize \"random\" = replicateM 10 (randomRIO ('a', 'z'))\nrandomize other = pure other\n</code></pre>\n\n<p>Try it out in ghci:</p>\n\n<pre><code>&gt; traverse randomize [\"random\", \"foo\", \"random\", \"bar\", \"random\", \"boo\"]\n[\"xytuowzanb\",\"foo\",\"lzhasynexf\",\"bar\",\"dceuvoxkyh\",\"boo\"]\n</code></pre>\n\n<p>There is no call to <code>unsafePerformIO</code>, and so no proof burden to shirk; and <code>randomRIO</code> tracks the updated generator state for you in a hidden <code>IORef</code>, and so you correctly continue advancing it on each call.</p>\n"}, {"tags": [], "owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "is_accepted": false, "score": 2, "last_activity_date": 1567885153, "creation_date": 1567885153, "answer_id": 57836932, "question_id": 57836652, "link": "https://stackoverflow.com/questions/57836652/how-can-i-generate-different-random-values-in-haskell/57836932#57836932", "title": "How can I generate different random values in Haskell?", "body": "<p>The fundamental problem with your approach is that Haskell is a pure language, and you're trying to use it as if its not. In fact this isn't the only fundamental misunderstanding of the language that your code displays.</p>\n\n<p>In your <code>randomise</code> function:</p>\n\n<pre><code>randomize :: String -&gt; String\nrandomize str = \n  case str of\n    \"random\" -&gt; randStr\n     _        -&gt; str\n  where\n    randStr = take 10 $ randomRs ('a','z') $ unsafePerformIO newStdGen\n</code></pre>\n\n<p>you clearly intend that <code>randStr</code> takes a different value each time it is used. But in Haskell, when you use the <code>=</code> sign, you are not \"assigning a value to a variable\", as would be the case in an imperative language. You are saying that <em>these two values are equal</em>. Since all \"variables\" in Haskell are actually \"constant\" and immutable, the compiler is perfectly entitled to assume that every occurrence of <code>randStr</code> in your program can be replaced by whatever value it first calculates for it.</p>\n\n<p>Unlike an imperative language, Haskell programs are not a sequence of statements to execute, which perform side effects such as updating state. Haskell programs consist of expressions, which are evaluated more or less in whatever order the compiler deems best. (In particular there is the <code>main</code> expression, which describes what your entire program will do - this is then converted by the compiler and runtime into executable machine code.) So when you assign a complex expression to a variable, you are not saying \"at this point in the execution flow, do this calculation and assign the result to this variable\". You are saying that \"this is the value of the variable\", for \"all time\" - that value isn't allowed to change.</p>\n\n<p>Indeed the only reason that it seems to change here is because you have used <code>unsafePerformIO</code>. As the name itself says, this function is \"unsafe\" - it should basically never be used, at least unless you really know exactly what you're doing. It is not supposed to be a way of \"cheating\", as you use it here, to use IO, and thereby generate an \"impure\" result that may be different in different parts of the program, but pretend the result is pure. It's hardly surprising that this doesn't work.</p>\n\n<p>Since generating random values is inherently impure, you need to do the whole thing in the <code>IO</code> monad, as @DanielWagner has shown one approach for in his answer. </p>\n\n<p>(There is actually another way, involving taking a random generator and functions like <a href=\"http://hackage.haskell.org/package/random-1.1/docs/System-Random.html#v:randomR\" rel=\"nofollow noreferrer\">randomR</a> to generate a random value together with a new generator. This allows you to do more in pure code, which is generally preferable - but it takes more effort, likely including using the <code>State</code> monad to simplify the threading through of the generator values, and you'll still need <code>IO</code> in the end to make sure you get a new random sequence each time you run the program.)</p>\n"}, {"tags": [], "owner": {"reputation": 2485, "user_id": 11282404, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1e3829cb91cc6be3541a37381b5ff21?s=128&d=identicon&r=PG&f=1", "display_name": "jpmarinier", "link": "https://stackoverflow.com/users/11282404/jpmarinier"}, "is_accepted": false, "score": 3, "last_activity_date": 1571875507, "last_edit_date": 1571875507, "creation_date": 1568210467, "answer_id": 57890878, "question_id": 57836652, "link": "https://stackoverflow.com/questions/57836652/how-can-i-generate-different-random-values-in-haskell/57890878#57890878", "title": "How can I generate different random values in Haskell?", "body": "<h2>How not to involve IO in random number generation:</h2>\n\n<p>This question has received excellent answers. However, it might leave some readers under the impression that pseudo-random number generation (PRNG) within Haskell is necessarily linked to IO.<br></p>\n\n<p>Well, it's <strong>not</strong>. It is just that in Haskell, the default random number generator happens to be \"hosted\" in the IO type. But this is by choice, not by necessity.</p>\n\n<p>For reference, here is a <a href=\"https://arxiv.org/pdf/1811.04035\" rel=\"nofollow noreferrer\">recent review paper on the subject of PRNGs</a>.\nPRNGs are deterministic mathematical automata. They do not involve IO. Using PRNGs in Haskell does not need to involve the IO type. At the bottom of this answer, I provide code that solves the problem at hand without involving the IO type, except for printing the result.</p>\n\n<p>The Haskell libraries provide functions such as <code>mkStdGen</code> that take an integer <em>seed</em> and return a pseudo-random number generator, that is an object of the <code>RandomGen</code> class, whose state is dependent on the value of seed. Note that there is nothing magic about <code>mkStdGen</code>. If for some reason you do not like it, there are alternatives, such as <a href=\"http://hackage.haskell.org/package/tf-random-0.5/docs/System-Random-TF.html\" rel=\"nofollow noreferrer\">mkTFGen</a> which is based on the <a href=\"https://www.schneier.com/academic/skein/threefish.html\" rel=\"nofollow noreferrer\">Threefish block cipher</a>.\n<br></p>\n\n<p>Now, pseudo-random number generation is not managed in the same way in imperative languages such as C++ and in Haskell. In C++, you would extract a random value like this: <code>rval = rng.nextVal();</code>. On top of just returning the value, calling nextVal() has the <em>side effect</em> of altering the state of the <code>rng</code> object, ensuring that next time it will return a different random number.</p>\n\n<p>But in Haskell, functions have no side effects. So you need to have something like this:</p>\n\n<pre><code>(rval, rng2) = nextVal rng1\n</code></pre>\n\n<p>That is, the evaluation function needs to <em>return</em> both the pseudo-random value and the updated state of the generator. A minor consequence is that, if the state is large (such as for the common <a href=\"https://en.wikipedia.org/wiki/Mersenne_Twister\" rel=\"nofollow noreferrer\">Mersenne Twister</a>  generator), Haskell might need a bit more memory than C++.</p>\n\n<p>So, we expect that solving the problem at hand, that is randomly transforming a list of strings, will involve a function with the following type signature: <code>RandomGen tg =&gt; [String] -&gt; tg -&gt; ([String], tg)</code>.</p>\n\n<p>For illustration purposes, let's get a generator and use it to generate a couple of \"random\" integers between 0 and 100. For this, we need the <code>randomR</code> function:</p>\n\n<pre><code>$ ghci\nPrelude&gt; import System.Random\nPrelude System.Random&gt; :t randomR\nrandomR :: (RandomGen g, Random a) =&gt; (a, a) -&gt; g -&gt; (a, g)\nPrelude System.Random&gt; \nPrelude System.Random&gt; let rng1 = mkStdGen 544\nPrelude System.Random&gt; let (v, rng2) = randomR (0,100) rng1\nPrelude System.Random&gt; v\n23\nPrelude System.Random&gt; let (v, rng2) = randomR (0,100) rng1\nPrelude System.Random&gt; v\n23\nPrelude System.Random&gt; let (w, rng3) = randomR (0,100) rng2\nPrelude System.Random&gt; w\n61\nPrelude System.Random&gt; \n</code></pre>\n\n<p>Note that above, when we forget to feed the <em>updated</em> state of the generator, rng2, into the next computation, we get the same \"random\" number 23 a second time. This is a very common mistake and a very common complaint. Function <code>randomR</code> is a pure Haskell function that does not involve IO. Hence it has <em>referential transparency</em>, that is when given the same arguments, it returns the same output value.</p>\n\n<p>A possible way to deal with this situation is to pass the updated state around manually within the source code. This is cumbersome and error prone, but can be managed. That gives this style of code:</p>\n\n<pre><code>-- stateful map of randomize function for a list of strings:\nfmapRandomize :: RandomGen tg =&gt; [String] -&gt; tg -&gt; ([String], tg)\nfmapRandomize [] rng = ([], rng)\nfmapRandomize(str:rest) rng = let (str1, rng1)  = randomize str rng\n                                  (rest1, rng2) = fmapRandomize rest rng1\n                              in  (str1:rest1, rng2)\n</code></pre>\n\n<p>Thankfully, there is a better way, which involves the <code>runRand</code> function or its <code>evalRand</code> sibling. Function <code>runRand</code> takes a <em>monadic computation</em> plus (an initial state of) a generator. It returns the pseudo-random value and the updated state of the generator. It is much easier to write the code for monadic computations than to pass the generator state manually around. </p>\n\n<p>This is a possible way to solve the random string substitution problem from the question text:</p>\n\n<pre><code>import  System.Random\nimport  Control.Monad.Random\n\n\n-- generic monadic computation to get a sequence of \"count\" random items:\nmkRandSeqM :: (RandomGen tg, Random tv) =&gt; (tv,tv) -&gt; Int -&gt; Rand tg [tv]\nmkRandSeqM range count = sequence (replicate count (getRandomR range))\n\n-- monadic computation to get our sort of random string:\nmkRandStrM :: RandomGen tg =&gt; Rand tg String\nmkRandStrM = mkRandSeqM  ('a', 'z')  10\n\n-- monadic single string transformation:\nrandomizeM :: RandomGen tg =&gt; String -&gt; Rand tg String\nrandomizeM str =  if (str == \"random\")  then  mkRandStrM  else  (pure str)\n\n-- monadic list-of-strings transformation:\nmapRandomizeM :: RandomGen tg =&gt; [String] -&gt; Rand tg [String]\nmapRandomizeM = mapM randomizeM\n\n-- non-monadic function returning the altered string list and generator:\nmapRandomize :: RandomGen tg =&gt; [String] -&gt; tg -&gt; ([String], tg)\nmapRandomize lstr rng = runRand  (mapRandomizeM lstr)  rng\n\n\nmain = do\n    let inpList  = [\"random\", \"foo\", \"random\", \"bar\", \"random\", \"boo\", \"qux\"]\n    -- get a random number generator:\n    let mySeed  = 54321\n    let rng1    = mkStdGen mySeed  \n\n    -- execute the string substitutions:\n    let (outList, rng2) = mapRandomize inpList rng1\n\n    -- display results:\n    putStrLn $ \"inpList = \" ++ (show inpList)\n    putStrLn $ \"outList = \" ++ (show outList)\n</code></pre>\n\n<p><br>\nNote that above, RandomGen is the class of the generator, while Random is just the class of the generated value.</p>\n\n<h2>Program output:</h2>\n\n<pre><code>$ random1.x\ninpList = [\"random\",\"foo\",\"random\",\"bar\",\"random\",\"boo\",\"qux\"]\noutList = [\"gahuwkxant\",\"foo\",\"swuxjgapni\",\"bar\",\"zdjqwgpgqa\",\"boo\",\"qux\"]\n$ \n</code></pre>\n"}], "owner": {"reputation": 85, "user_id": 11514521, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-2OJcM4zNtUQ/AAAAAAAAAAI/AAAAAAAAB1c/h1tmB8tQFDs/photo.jpg?sz=128", "display_name": "Augusto Dias", "link": "https://stackoverflow.com/users/11514521/augusto-dias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 554, "favorite_count": 0, "accepted_answer_id": 57836791, "answer_count": 3, "score": 0, "last_activity_date": 1571875507, "creation_date": 1567882764, "question_id": 57836652, "link": "https://stackoverflow.com/questions/57836652/how-can-i-generate-different-random-values-in-haskell", "title": "How can I generate different random values in Haskell?", "body": "<p>Suppose that I have a list like this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>let list = [\"random\", \"foo\", \"random\", \"bar\", \"random\", \"boo\"]\n</code></pre>\n\n<p>I want to iterate over a list and map all \"random\" elements to different  random strings:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>let newList = fmap randomize list\nprint newList\n-- [\"dasidias\", \"foo\", \"gasekir\", \"bar\", \"nabblip\", \"boo\"]\n</code></pre>\n\n<p>My randomize function looks like this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>randomize :: String -&gt; String\nrandomize str = \n  case str of\n    \"random\" -&gt; randStr\n    _        -&gt; str\n  where\n    randStr = take 10 $ randomRs ('a','z') $ unsafePerformIO newStdGen\n</code></pre>\n\n<p>But I get the same random string for every \"random\" element:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>[\"abshasb\", \"foo\", \"abshasb\", \"bar\", \"abshasb\", \"boo\"]\n</code></pre>\n\n<p>I can't figure out why is this happening and how to get a different random value for each occurrence of \"random\".</p>\n"}, {"tags": ["haskell", "applicative"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1567882653, "post_id": 57836618, "comment_id": 102101627, "body": "Hint: start by writing out the type of <code>(&#47;)</code> and deciding what <code>a</code> and <code>b</code> are. Remember that functions are curried."}], "answers": [{"comments": [{"owner": {"reputation": 1305, "user_id": 336184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/W83fX.jpg?s=128&g=1", "display_name": "Max", "link": "https://stackoverflow.com/users/336184/max"}, "edited": false, "score": 0, "creation_date": 1567883866, "post_id": 57836698, "comment_id": 102101898, "body": "thanks. seems you need to make a little correction at: ...and therefore we know that <code>(&#47;) &lt;$&gt; Just 5 has type (&#47;) &lt;$&gt; Just 5 :: (Num m, Fractional m) =&gt; Maybe (m -&gt; m)</code>"}, {"owner": {"reputation": 1305, "user_id": 336184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/W83fX.jpg?s=128&g=1", "display_name": "Max", "link": "https://stackoverflow.com/users/336184/max"}, "edited": false, "score": 0, "creation_date": 1567885084, "post_id": 57836698, "comment_id": 102102152, "body": "Could you give me more hints on Applicative? I see similarity between usual multiparameter fn application <code>f x y z</code> and applicative <code>f &lt;$&gt; x &lt;*&gt; y &lt;*&gt; z</code>, however I can&#39;t imagine any direct analogues of &lt;*&gt; and &lt;$&gt; in usual fn application world? Also I feel partial application is somehow involved here?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 1305, "user_id": 336184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/W83fX.jpg?s=128&g=1", "display_name": "Max", "link": "https://stackoverflow.com/users/336184/max"}, "edited": false, "score": 0, "creation_date": 1567885248, "post_id": 57836698, "comment_id": 102102182, "body": "<code>(&#47;) &lt;$&gt; Just 5</code>, will result in <code>Just ((&#47;) 5)</code>, so yes you are correct taht partial application is involved here. <code>Just ((&#47;) 5) &lt;*&gt; Just 2</code>, then thus results in <code>Just ((&#47;) 5 2)</code>, and thus <code>Just 2.5</code>."}, {"owner": {"reputation": 1305, "user_id": 336184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/W83fX.jpg?s=128&g=1", "display_name": "Max", "link": "https://stackoverflow.com/users/336184/max"}, "edited": false, "score": 0, "creation_date": 1567885375, "post_id": 57836698, "comment_id": 102102216, "body": "Yet somehow to calculate <code>f x y z</code> we don&#39;t define any new functions (like we do with &lt;*&gt; and &lt;$&gt;... I still miss some element here..."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 1305, "user_id": 336184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/W83fX.jpg?s=128&g=1", "display_name": "Max", "link": "https://stackoverflow.com/users/336184/max"}, "edited": false, "score": 1, "creation_date": 1567885420, "post_id": 57836698, "comment_id": 102102228, "body": "What do you mean with &quot;we don&#39;t define any new functions&quot;?"}, {"owner": {"reputation": 1305, "user_id": 336184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/W83fX.jpg?s=128&g=1", "display_name": "Max", "link": "https://stackoverflow.com/users/336184/max"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1567885440, "post_id": 57836698, "comment_id": 102102231, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/199123/discussion-between-max-and-willem-van-onsem\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1567932515, "last_edit_date": 1567932515, "creation_date": 1567883146, "answer_id": 57836698, "question_id": 57836618, "link": "https://stackoverflow.com/questions/57836618/applicative-functors-type-signatures-of-and-in-detail/57836698#57836698", "title": "Applicative functors. Type signatures of &lt;*&gt; and &lt;$&gt; in detail", "body": "<p>It does match, but the <code>f</code>, <code>a</code> and <code>b</code> of the <code>(&lt;$&gt;)</code> and <code>(&lt;*&gt;)</code> function are variables, and the variables are different variables each time you use that function.</p>\n\n<p>It therefore makes more sense to define the functions here as:</p>\n\n<pre><code>(&lt;$&gt;) :: Functor f     =&gt; (a -&gt; b)   -&gt; f a -&gt; f b\n(&lt;*&gt;) :: Applicative g =&gt; g (c -&gt; d) -&gt; g c -&gt; g d\n</code></pre>\n\n<p>So that means that the <code>^</code> and <code>@</code> indeed match like:</p>\n\n<pre><code>((/) &lt;$&gt; Just 5) &lt;*&gt; Just 2\n^^^^^^^^^^^^^^^^     @@@@@@\n\n(&lt;$&gt;) :: Functor f     =&gt; (a -&gt; b)   -&gt; f a -&gt; f b\n                                               ^^^\n(&lt;*&gt;) :: Applicative g =&gt; g (c -&gt; d) -&gt; g c -&gt; g d\n                          ^^^^^^^^^^    @@@\n</code></pre>\n\n<p>So we know that the type of <code>(/) &lt;$&gt; Just 5</code> is <code>f b</code>, and <code>g (c -&gt; d)</code>, whereas <code>Just 2</code> has type <code>g c</code>. Since <code>Just 2</code> has type <code>Just 2 :: Num n =&gt; Maybe n</code>, that thus means that <code>g ~ Maybe</code> and <code>c ~ n</code> (here <code>x ~ y</code> means <code>x</code> and <code>y</code> are the same type). Furthermore we can derive that <code>f b ~ g (c -&gt; d)</code>, so <code>f ~ Maybe</code>, and <code>b ~ (c -&gt; d)</code>.</p>\n\n<p>We can furthermore analyze the <code>(/) &lt;$&gt; Just 5</code> expression. We know that <code>Just 5</code> has type <code>Num m =&gt; Maybe m</code>, so that means that <code>a ~ m</code>. The function <code>(/)</code> has type <code>(/) :: Fractional k =&gt; k -&gt; k -&gt; k</code>, so that means that <code>a ~ b ~ k ~ m</code>, and therefore we know that <code>(/) &lt;$&gt; Just 5</code> has type <code>(/) &lt;$&gt; Just 5 :: (Num m, Fractional m) =&gt; Maybe (m -&gt; m)</code>, or less verbose <code>(/) &lt;$&gt; Just 5 :: Fractional m =&gt; Maybe (m -&gt; m)</code> (a <code>Fractional m</code> implies <code>Num m</code>).</p>\n\n<p>As we already found out <code>b ~ (c -&gt; d)</code>, so that means that <code>m ~ c ~ d</code>, and thus the type of the expression is: <code>((/) &lt;$&gt; Just 5) &lt;*&gt; Just 2 :: Fractional m =&gt; Maybe m</code>.</p>\n"}], "owner": {"reputation": 1305, "user_id": 336184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/W83fX.jpg?s=128&g=1", "display_name": "Max", "link": "https://stackoverflow.com/users/336184/max"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 57836698, "answer_count": 1, "score": 2, "last_activity_date": 1567932544, "creation_date": 1567882450, "last_edit_date": 1567932544, "question_id": 57836618, "link": "https://stackoverflow.com/questions/57836618/applicative-functors-type-signatures-of-and-in-detail", "title": "Applicative functors. Type signatures of &lt;*&gt; and &lt;$&gt; in detail", "body": "<p>We have signatures:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>(&lt;$&gt;) :: Functor f     =&gt;   (a -&gt; b) -&gt; f a -&gt; f b\n(&lt;*&gt;) :: Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b \n</code></pre>\n\n<p>Let us play with it a bit:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>(/)  &lt;$&gt; Just 5       &lt;*&gt; Just 2\n=&gt; Just 2.5\n\n((/) &lt;$&gt; Just 5     ) &lt;*&gt; Just 2\n=&gt; Just 2.5\n\n( Just (\\x -&gt; 5/x ) ) &lt;*&gt; Just 2\n=&gt; Just 2.5\n</code></pre>\n\n<p><strong>Question:</strong></p>\n\n<pre><code>((/) &lt;$&gt; Just 5) &lt;*&gt; Just 2\n^^^^^^^^^^^^^^^^     @@@@@@\n\n(&lt;$&gt;) :: Functor f     =&gt;   (a -&gt; b) -&gt; f a -&gt; f b\n                                               ^^^\n(&lt;*&gt;) :: Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b\n                          ^^^^^^^^^^    @@@\n</code></pre>\n\n<p>I interpret that ^^^ parts should match by their type. How come return type of <code>&lt;$&gt;</code> doesn't visually match input type of <code>&lt;*&gt;</code> in signatures? </p>\n\n<p>What do I miss here? Thanks.</p>\n"}, {"tags": ["haskell", "ghc", "cabal"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1567882495, "post_id": 57836599, "comment_id": 102101587, "body": "I would be supprised if that builds, you need to indent your <code>do</code> block. Perhaps you mixed tabs and spaces?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1567882591, "post_id": 57836599, "comment_id": 102101610, "body": "Are you sure <code>ghc --make</code> does not skip the file (for example because you did not pass it to the command line)?"}, {"owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1567882758, "post_id": 57836599, "comment_id": 102101647, "body": "I used the Geany function to convert tabulations to space but it doesn&#39;t modify the file (And don&#39;t change the error)"}, {"owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1567882830, "post_id": 57836599, "comment_id": 102101669, "body": "ghc doesn&#39;t skip the file and build fine. It return [21 of 32] Compiling Text.MarkIt.Verif ( Text/MarkIt/Verif.hs, Text/MarkIt/Verif.o ) Linking Main2 ..."}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 1, "last_activity_date": 1568004105, "creation_date": 1568004105, "answer_id": 57847969, "question_id": 57836599, "link": "https://stackoverflow.com/questions/57836599/parse-error-possibly-incorrect-indentation-when-building-a-cabal-file-with/57847969#57847969", "title": "parse error (possibly incorrect indentation ...) when building a cabal file with Haskell2010", "body": "<p>By default, GHC is in Haskell 98 mode, which enables the following relaxation from the standard:</p>\n\n<blockquote>\n  <p>In Haskell 98 mode and by default (but not in Haskell 2010 mode), GHC is a little less strict about the layout rule when used in do expressions. Specifically, the restriction that \u201ca nested context must be indented further to the right than the enclosing context\u201d is relaxed to allow the nested context to be at the same level as the enclosing context, if the enclosing context is a do expression.</p>\n  \n  <p><a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/bugs.html#context-free-syntax\" rel=\"nofollow noreferrer\">https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/bugs.html#context-free-syntax</a></p>\n</blockquote>\n\n<p>A comment in the GHC source explains further:</p>\n\n<blockquote>\n  <p>strictly speaking non-standard, but we always had this on implicitly before the option was added in 7.1, and turning it off breaks code, so we're keeping it on for backwards compatibility.</p>\n  \n  <p><a href=\"https://gitlab.haskell.org/ghc/ghc/blob/d0b45ac6984f245bce9de7ffcc7dad4a0046d344/compiler/main/DynFlags.hs#L2310\" rel=\"nofollow noreferrer\">https://gitlab.haskell.org/ghc/ghc/blob/d0b45ac6984f245bce9de7ffcc7dad4a0046d344/compiler/main/DynFlags.hs#L2310</a></p>\n</blockquote>\n\n<p>When you enable the Haskell2010 mode in your cabal file, that bug gets fixed, and the syntax of your file is rejected. so <code>do</code> blocks must be indented further than the enclosing context, </p>\n\n<pre><code>    summary (MarkIt meta blocks) = do\n      summary meta\n      mapM_ summary blocks\n--  ^ indented\n</code></pre>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 57847969, "answer_count": 1, "score": 0, "last_activity_date": 1568004105, "creation_date": 1567882271, "question_id": 57836599, "link": "https://stackoverflow.com/questions/57836599/parse-error-possibly-incorrect-indentation-when-building-a-cabal-file-with", "title": "parse error (possibly incorrect indentation ...) when building a cabal file with Haskell2010", "body": "<p>I just had the following error with a Haskell project.\nI made a cabal file for a Haskell project to install it properly. This project compiled well when I build my binary with <code>ghc --make</code> but when I build my cabal file with <code>cabal build</code> , I had the following error:</p>\n\n<pre><code>src/Text/MarkIt/Verif.hs:12:3: error:\n    parse error (possibly incorrect indentation or mismatched brackets)\n</code></pre>\n\n<p>The beginning of my file is : </p>\n\n<pre><code>module Text.MarkIt.Verif where\nimport qualified Control.Monad.Trans.State.Strict as Tr\nimport Text.MarkIt.Types\nimport Data.List\n\nclass Verif a where\n  summary :: a -&gt; Tr.State StatDoc ()\n\ninstance Verif MarkIt where\n  summary (MarkIt meta blocks) = do\n  summary meta\n  mapM_ summary blocks  -- This is the boring line\n\ninstance Verif Meta where\n  summary meta = mapM_ summary (mAuthors meta)\n</code></pre>\n\n<p>I tried to rebuild my executable with ghc and it compile well. I checked if their were no hidden char, tabulation, incorrect end of line, ... nothing!\nI finally removed the following line from my cabal file : </p>\n\n<pre><code>default-language:    Haskell2010\n</code></pre>\n\n<p>Then, my cabal file was build and installed fine !</p>\n\n<p><strong>Does someone could explain me why this cabal option cause a such problem at this precise point of my file?</strong></p>\n\n<p><strong>What is different with the Haskell 2010 language specification to cause this problem ?</strong></p>\n"}, {"tags": ["haskell", "smartcontracts", "cardano", "plutus"], "answers": [{"comments": [{"owner": {"reputation": 3281, "user_id": 3574379, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/B85yX.png?s=128&g=1", "display_name": "srghma", "link": "https://stackoverflow.com/users/3574379/srghma"}, "edited": false, "score": 0, "creation_date": 1568057280, "post_id": 57855355, "comment_id": 102146450, "body": "Looking forward for it to be replaced!"}, {"owner": {"reputation": 3281, "user_id": 3574379, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/B85yX.png?s=128&g=1", "display_name": "srghma", "link": "https://stackoverflow.com/users/3574379/srghma"}, "edited": false, "score": 0, "creation_date": 1570955150, "post_id": 57855355, "comment_id": 103075240, "body": "Is there an issue re this I could track on github?"}], "tags": [], "owner": {"reputation": 208, "user_id": 1919394, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc537a770ab9eae8847c072c098a3438?s=128&d=identicon&r=PG", "display_name": "Jann M&#252;ller", "link": "https://stackoverflow.com/users/1919394/jann-m%c3%bcller"}, "is_accepted": true, "score": 2, "last_activity_date": 1568036843, "creation_date": 1568036843, "answer_id": 57855355, "question_id": 57834521, "link": "https://stackoverflow.com/questions/57834521/why-do-we-need-startwatching-function-from-walletapi/57855355#57855355", "title": "Why do we need `startWatching` function from WalletApi?", "body": "<p>As you state correctly, the reason why <code>startWatching</code> is needed has to do with the capabilities of the wallets that Plutus contracts have access to.</p>\n\n<p>In the first iteration of the emulator we went with the conservative assumption that Plutus contracts would only be able to do forward-looking queries of the blockchain state. That is, we assumed it would not be possible to scan arbitrary sections of the blockchain because of resource limitations of some of the wallets. The effect is that all contracts written against this restrictive wallet interface have to call <code>startWatching</code> before they can do anything interesting.</p>\n\n<p>When the emulator was implemented, there was no specification of the wallet capabilities that Plutus contracts can expect - in fact, one of the motivations for building the emulator was to help us write the specification. And it's quite likely that the current, restrictive interface (forward-looking queries only) will be replaced by something more powerful so that the <code>startGame</code> endpoint won't be necessary anymore.</p>\n"}], "owner": {"reputation": 3281, "user_id": 3574379, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/B85yX.png?s=128&g=1", "display_name": "srghma", "link": "https://stackoverflow.com/users/3574379/srghma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 0, "accepted_answer_id": 57855355, "answer_count": 1, "score": 0, "last_activity_date": 1568036843, "creation_date": 1567865885, "last_edit_date": 1568027275, "question_id": 57834521, "link": "https://stackoverflow.com/questions/57834521/why-do-we-need-startwatching-function-from-walletapi", "title": "Why do we need `startWatching` function from WalletApi?", "body": "<p>In plutus playground in game example there is a function</p>\n\n<pre><code>-- | The \"startGame\" contract endpoint, telling the wallet to start watching\n--   the address of the game script. See note [Contract endpoints]\nstartGame :: MonadWallet m =&gt; m ()\nstartGame =\n    -- 'startWatching' is a function of the wallet API. It instructs the wallet\n    -- to keep track of all outputs at the address. Player 2 needs to call\n    -- 'startGame' before Player 1 uses the 'lock' endpoint, to ensure that\n    -- Player 2's wallet is aware of the game address.\n    startWatching gameAddress\n</code></pre>\n\n<p>I don't like the</p>\n\n<pre><code>Player 2 needs to call\n'startGame' before Player 1 uses the 'lock' endpoint, to ensure that\nPlayer 2's wallet is aware of the game address.\n</code></pre>\n\n<p>Is there really no way to connect to game <em>after</em> game is started (<code>lock</code> function is called)?</p>\n\n<p>Do we need this function at all? Can we go only with <code>guess</code> and <code>lock</code> functions?</p>\n\n<p>I can understand how <code>startWatching</code> can make sense for light wallets/clients (that use merkle proofs to validate transactions) but don't understand how <code>startGame</code> function may be useful for full clients. (Actually I don't, light client still should be able to ask info from other need)</p>\n"}, {"tags": ["haskell", "monad-transformers"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1567856259, "post_id": 57833266, "comment_id": 102095497, "body": "Hint: take a look at some other monad transformers, like <code>StateT</code>, <code>ErrorT</code>, as well as the <code>MonadTrans</code> type class."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10696742"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1567860422, "post_id": 57833266, "comment_id": 102096380, "body": "@WillemVanOnsem so the task here is to wrap the Parser around some other monad? (Like, if I understood correctly, ErrorT helps to deal with errors in other monads, so my ParserT should help to parse inside other monads)"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1567860927, "post_id": 57833266, "comment_id": 102096503, "body": "@KadaFuite No. Basically, <code>Parser</code> is equivalent in functionality to a monad transformer stack; it is your task to find this stack. Hint: as you have defined it, a parser is something which applies a function to a <code>String</code>, while possibly failing with an <code>ErrorMsg</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10696742"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 1, "creation_date": 1567861982, "post_id": 57833266, "comment_id": 102096741, "body": "@bradrn I still don&#39;t understand. Could you please elaborate your first sentence?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1567862621, "post_id": 57833266, "comment_id": 102096891, "body": "Do you need to define a <code>ParserT</code> monad transformer, or simply define <code>Parser</code> in terms of existing monad transformers?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1567862771, "post_id": 57833266, "comment_id": 102096926, "body": "<code>ErrorT</code> is deprecated, isn&#39;t it? Look at <code>ExceptT</code> instead."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10696742"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1567862893, "post_id": 57833266, "comment_id": 102096958, "body": "@chepner define Parser in terms of existing monad transformers"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 2, "creation_date": 1567863034, "post_id": 57833266, "comment_id": 102096987, "body": "@KadaFuite Have a look at <a href=\"http://book.realworldhaskell.org/read/monad-transformers.html\" rel=\"nofollow noreferrer\">book.realworldhaskell.org/read/monad-transformers.html</a>, which also uses the example of decomposing a parser into multiple monad transformers. (But try to implement it yourself before looking at their solution!)"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1567873632, "post_id": 57834641, "comment_id": 102099461, "body": "Or better, a newtype around a monad transformer stack."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10696742"}, "edited": false, "score": 0, "creation_date": 1567888948, "post_id": 57834641, "comment_id": 102102892, "body": "@chepner should it be something like this:          newtype Parser&#39; a = Parser&#39; (StateT String Either ErrorMsg a )                     deriving ( Functor, Monad, Applicative, Alternative ) ? (Only this doesn&#39;t compile)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1567893447, "post_id": 57834641, "comment_id": 102103681, "body": "Close; <code>type Parser a = StateT String (Either ErrorMsg) a</code>; <code>Either ErrorMsg</code> (one expression) is the monad that <code>StateT</code> requires as its second argument. I&#39;m ignoring <code>newtype</code> for now because <code>StateT...</code> already has the necessary instances. I&#39;ll happily defer to an answer that provides the benefit of wrapping this in a new type, though."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10696742"}, "edited": false, "score": 0, "creation_date": 1567921887, "post_id": 57834641, "comment_id": 102107189, "body": "@chepner thank you, I think I got it! this is really better than writing all the instances. I didn&#39;t realise until now how cool monad transformers are"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 1, "last_activity_date": 1567866715, "creation_date": 1567866715, "answer_id": 57834641, "question_id": 57833266, "link": "https://stackoverflow.com/questions/57833266/describing-my-parser-type-as-a-series-of-monad-transformers/57834641#57834641", "title": "Describing my Parser type as a series of monad transformers", "body": "<p>Instead of defining a new type for <code>Parser</code>, you can simply define it as a type <em>alias</em> for a type created by one or more monad transformers. That is, you definition would look something like</p>\n\n<pre><code>type Parser a = SomeMonadT &lt;some set of monads and types&gt;\n</code></pre>\n\n<p>Your task, then, is to determine which monad transformer(s) to use, and what the arguments to the transformer(s) should be.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10696742"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 57834641, "answer_count": 1, "score": 1, "last_activity_date": 1568224823, "creation_date": 1567855896, "last_edit_date": 1568224823, "question_id": 57833266, "link": "https://stackoverflow.com/questions/57833266/describing-my-parser-type-as-a-series-of-monad-transformers", "title": "Describing my Parser type as a series of monad transformers", "body": "<p>I have to describe the Parser type as a series of monad transformers.\nAs far as I understand, monad transformers are used to wrap monads into another monad. But I don't understand what is the task here. </p>\n"}, {"tags": ["haskell", "monads", "maybe"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1567861598, "post_id": 57832027, "comment_id": 102096654, "body": "Just define <code>ugly :: ByteString -&gt; MyObj</code>; then <code>fmap ugly :: Maybe ByteString -&gt; Maybe MyObj</code>."}, {"owner": {"reputation": 43, "user_id": 11961068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52edc4a3e1c0b029a18e08ee38e946e6?s=128&d=identicon&r=PG&f=1", "display_name": "BloodySue", "link": "https://stackoverflow.com/users/11961068/bloodysue"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1567868777, "post_id": 57832027, "comment_id": 102098316, "body": "I can&#39;t, because Aeson.decode returns <code>Maybe MyObj</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1567870665, "post_id": 57832027, "comment_id": 102098844, "body": "&quot;<code>&gt;&gt;=</code> expects strange types of function and returns strange types&quot; you need to dwell on it until those stop looking strange to you. also check out the <code>&gt;=&gt;</code> Kleisli composition operator. Monad Laws are easier to grasp with it. &quot;Monad axioms: Kleisli composition forms a category&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1567845339, "creation_date": 1567845339, "answer_id": 57832055, "question_id": 57832027, "link": "https://stackoverflow.com/questions/57832027/maybe-in-a-monad/57832055#57832055", "title": "Maybe in a monad", "body": "<p>Since based on the type signature <code>decode . encodeUtf8 . fromString</code> is a function <code>Text -&gt; Maybe MyObj</code>, we can here use <code>(&gt;&gt;=)</code> or its flipped counterpart <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:-61--60--60-\" rel=\"nofollow noreferrer\"><strong><code>(=&lt;&lt;) :: Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b</code></strong></a>:</p>\n\n<pre><code>ugly :: Maybe Text -&gt; Maybe MyObj\nugly = <b>(=&lt;&lt;)</b> (decode . encodeUtf8 . fromStrict)</code></pre>\n\n<p>or shorter:</p>\n\n<pre><code>ugly :: Maybe Text -&gt; Maybe MyObj\nugly = (decode . encodeUtf8 . fromStrict =&lt;&lt;)</code></pre>\n"}, {"comments": [{"owner": {"reputation": 43, "user_id": 11961068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52edc4a3e1c0b029a18e08ee38e946e6?s=128&d=identicon&r=PG&f=1", "display_name": "BloodySue", "link": "https://stackoverflow.com/users/11961068/bloodysue"}, "edited": false, "score": 0, "creation_date": 1567848649, "post_id": 57832060, "comment_id": 102093932, "body": "Thank you for explaining each step. I couldn&#39;t make a transition to using <code>&gt;&gt;=</code> in <code>ugly</code>, but it is indeed very easy!"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1567845424, "creation_date": 1567845424, "answer_id": 57832060, "question_id": 57832027, "link": "https://stackoverflow.com/questions/57832027/maybe-in-a-monad/57832060#57832060", "title": "Maybe in a monad", "body": "<pre><code>getHelloWorldR = do\n  myObjText &lt;- lookupSession \"myobj\"  :: Handler (Maybe Text)\n  myObj &lt;- return $ ugly myObjText :: Handler (Maybe MyObj)\n  ...\n</code></pre>\n\n<p>can be rewritten as</p>\n\n<pre><code>getHelloWorldR = do\n  myObjText &lt;- lookupSession \"myobj\"  :: Handler (Maybe Text)\n  let myObj = ugly myObjText :: Maybe MyObj\n  ...\n</code></pre>\n\n<p>Then, </p>\n\n<pre><code>ugly :: Maybe Text -&gt; Maybe MyObj\nugly Nothing = Nothing\nugly (Just text) = (decode . encodeUtf8 . fromStrict) text\n</code></pre>\n\n<p>can be rewritten as</p>\n\n<pre><code>ugly :: Maybe Text -&gt; Maybe MyObj\nugly maytext = maytext &gt;&gt;= decode . encodeUtf8 . fromStrict\n</code></pre>\n\n<p>Hence,</p>\n\n<pre><code>getHelloWorldR = do\n  myObjText &lt;- lookupSession \"myobj\"  :: Handler (Maybe Text)\n  let myObj :: Maybe MyObj\n      myObj = myObjTest &gt;&gt;= decode . encodeUtf8 . fromStrict\n  ...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 43, "user_id": 11961068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52edc4a3e1c0b029a18e08ee38e946e6?s=128&d=identicon&r=PG&f=1", "display_name": "BloodySue", "link": "https://stackoverflow.com/users/11961068/bloodysue"}, "edited": false, "score": 1, "creation_date": 1567849173, "post_id": 57832286, "comment_id": 102094053, "body": "But <code>ugly</code> returns a <code>Maybe MyObj</code>, what does <code>fmap</code> do to it? Will its type become <code>Maybe Text -&gt; Maybe (Maybe MyObj)</code> ? I&#39;m also surprised to see <code>return</code> outside of the do notation. I don&#39;t understand that. What does <code>return</code> &quot;wrap&quot; in that case?"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 43, "user_id": 11961068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52edc4a3e1c0b029a18e08ee38e946e6?s=128&d=identicon&r=PG&f=1", "display_name": "BloodySue", "link": "https://stackoverflow.com/users/11961068/bloodysue"}, "edited": false, "score": 0, "creation_date": 1567849965, "post_id": 57832286, "comment_id": 102094238, "body": "@BloodySue Remember partial application and currying! <code>fmap f x</code> applies <code>f</code> to the value \u2018inside\u2019 <code>x</code>, so <code>fmap f</code> returns a function which, given a value <code>x</code>, returns <code>fmap f x</code>. As for <code>return</code>, usually it \u2018wraps\u2019 something to get it inside a monadic context, but as you noticed that doesn\u2019t make sense the way I wrote it \u2014 I made a mistake, and I\u2019ll remove it now so everything type-checks!"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 43, "user_id": 11961068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52edc4a3e1c0b029a18e08ee38e946e6?s=128&d=identicon&r=PG&f=1", "display_name": "BloodySue", "link": "https://stackoverflow.com/users/11961068/bloodysue"}, "edited": false, "score": 0, "creation_date": 1567850087, "post_id": 57832286, "comment_id": 102094262, "body": "@BloodySue I should also mention that in cases when you\u2019re applying something and then <code>return</code>ing it \u2014 like here \u2014 using <code>fmap</code> is almost more concise and understandable than using <code>&gt;&gt;=</code>, as <code>a &gt;&gt;= (\\x -&gt; return (f x))</code> is equal to <code>fmap f x</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 43, "user_id": 11961068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52edc4a3e1c0b029a18e08ee38e946e6?s=128&d=identicon&r=PG&f=1", "display_name": "BloodySue", "link": "https://stackoverflow.com/users/11961068/bloodysue"}, "edited": false, "score": 0, "creation_date": 1567871632, "post_id": 57832286, "comment_id": 102099077, "body": "@BloodySue you&#39;re right about the type  <code>Maybe (Maybe MyObj)</code>. This can be turned into <code>Maybe MyObj</code> by using <code>join :: Monad m =&gt; m (m a) -&gt; m a</code>. so we&#39;d get <code>join . fmap (decode . fromStrict)</code> -- and that is by definition the same as <code>(&gt;&gt;= (decode . fromStrict))</code> === <code>(\\ m -&gt; m &gt;&gt;= (decode . fromStrict))</code> === <code>fmap fromStrict m &gt;&gt;= decode</code> === <code>do { x &lt;- m ; decode (fromStrict x) }</code>. (<code>return :: Monad m =&gt; a -&gt; m a</code> is a function in itself, like <code>join</code> -- it&#39;s not a part of the special <code>do</code> syntax. for <code>Maybe</code>, <code>return x = Just x</code>)."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1567872529, "post_id": 57832286, "comment_id": 102099252, "body": "by Monad Laws, <code>do { x &lt;- xs ; y &lt;-  foo x ; return y }</code> === <code>do { x &lt;- xs ; foo x }</code>. this means <code>do { x &lt;- xs ; y &lt;-  return (foo x) ; return y }</code> === <code>do { x &lt;- xs ; return (foo x) }</code> (this happens to be === <code>fmap foo xs</code> === <code>foo &lt;$&gt; xs</code>). --- Indeed <code>do { x &lt;- xs ; y &lt;-  return (foo x) }</code> is invalid, incomplete. The last line in a <code>do</code> block can&#39;t be a &quot;binding&quot; syntax, must be of type <code>Monad m =&gt; m a</code>."}], "tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": false, "score": 0, "last_activity_date": 1567849996, "last_edit_date": 1567849996, "creation_date": 1567847473, "answer_id": 57832286, "question_id": 57832027, "link": "https://stackoverflow.com/questions/57832027/maybe-in-a-monad/57832286#57832286", "title": "Maybe in a monad", "body": "<p>You don\u2019t even need monads here \u2014 you can rewrite <code>ugly</code> using <code>fmap</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>ugly = fmap $ decode . fromStrict\n</code></pre>\n\n<p>At which point you can even inline it into <code>getHelloWorldR</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>getHelloWorldR :: Handler Html\ngetHelloWorldR = do\n  myObjText &lt;- lookupSessionBS \"myobj\"  :: Handler (Maybe ByteString) -- gets serialized MyObj from a session cookie, or Nothing\n  myObj &lt;- return $ fmap (decode . fromStrict) myObjText :: Handler (Maybe MyObj)\n</code></pre>\n\n<p>Or you could even use the <code>&lt;$&gt;</code> operator, which is an infix version of <code>fmap</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>getHelloWorldR :: Handler Html\ngetHelloWorldR = do\n  myObjText &lt;- lookupSessionBS \"myobj\"  :: Handler (Maybe ByteString) -- gets serialized MyObj from a session cookie, or Nothing\n  myObj &lt;- return $ (decode . fromStrict) &lt;$&gt; myObjText :: Handler (Maybe MyObj)\n</code></pre>\n\n<p>And in fact, since you\u2019re running <code>return</code> and then immediately assigning it via <code>&lt;-</code>, it can be replaced with a <code>let</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>getHelloWorldR :: Handler Html\ngetHelloWorldR = do\n  myObjText &lt;- lookupSessionBS \"myobj\"  :: Handler (Maybe ByteString) -- gets serialized MyObj from a session cookie, or Nothing\n  let myObj :: Maybe MyObj\n      myObj = (decode . fromStrict) &lt;$&gt; myObjText\n</code></pre>\n\n<hr>\n\n<p>But I would also like to present a slightly different view on monads to that in your question. Monads aren\u2019t just a tool to remove pattern matching \u2014 they\u2019re a very general abstraction over the concept of running things in sequence. For instance:</p>\n\n<ul>\n<li>When using <code>Maybe</code>, \u2018running\u2019 a computation consists of checking to see whether it\u2019s <code>Nothing</code>, aborting the computation if this happens, otherwise continuing on. (This corresponds to a computation which can fail.)</li>\n<li>When using a list, \u2018running\u2019 a computation consists of splitting the computation into multiple parts, one for each element in the list, then joining those parts back again. (This corresponds to a nondeterministic computation.)</li>\n<li>When using <code>IO</code>, \u2018running\u2019 a computation is executing it on a computer.</li>\n<li>When using <code>Handler</code>, \u2018running\u2019 a computation is interacting with the request sent and/or responding with something.</li>\n</ul>\n\n<p>So you shouldn\u2019t reach for monads every time you want to manipulate a <code>Maybe</code> \u2014 on the contrary, it\u2019s often much easier to do this without monads, as I showed above! Monads only become useful when you need to sequence things. In your example, this is the case with <code>Handler</code> \u2014 because you need to sequence multiple interactions with the request \u2014 but is not useful with <code>Maybe</code>, because you just need to apply a series of operations to a value which happens to be wrapped inside a <code>Maybe</code>.</p>\n"}], "owner": {"reputation": 43, "user_id": 11961068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52edc4a3e1c0b029a18e08ee38e946e6?s=128&d=identicon&r=PG&f=1", "display_name": "BloodySue", "link": "https://stackoverflow.com/users/11961068/bloodysue"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 57832060, "answer_count": 3, "score": 2, "last_activity_date": 1577397147, "creation_date": 1567844979, "last_edit_date": 1577397147, "question_id": 57832027, "link": "https://stackoverflow.com/questions/57832027/maybe-in-a-monad", "title": "Maybe in a monad", "body": "<p>I want to learn to use Haskell the right way.</p>\n\n<p>I still don't fully understand how to use Maybe as a monad inside another monad. <a href=\"http://learnyouahaskell.com/a-fistful-of-monads\" rel=\"nofollow noreferrer\">http://learnyouahaskell.com/a-fistful-of-monads</a> tells me that I can do wonderful things with Maybe without pattern matching Just and Nothing at every step. Please help me understand how.</p>\n\n<p>I'm writing a Yesod handler, but that doesn't matter in this case. All that matters is that Handler is a monad.</p>\n\n<pre><code>ugly :: Maybe ByteString -&gt; Maybe MyObj\nugly Nothing = Nothing\nugly (Just text) = (decode . fromStrict) text\n\ngetHelloWorldR :: Handler Html\ngetHelloWorldR = do\n  myObjText &lt;- lookupSessionBS \"myobj\"  :: Handler (Maybe ByteString) -- gets serialized MyObj from a session cookie, or Nothing\n  myObj &lt;- return $ ugly myObjText :: Handler (Maybe MyObj)\n</code></pre>\n\n<p>How can I rewrite it to avoid pattern matching on Nothing?</p>\n\n<p>I tried using <code>&gt;&gt;=</code> but it expects strange types of function and returns strange types. I just can't make it work. I looked at <code>MaybeT</code>, but that means that I need to define a function similar to <code>ugly</code> in my example, that returns a <code>MaybeT Handler MyObj</code>. Seems too complicated.</p>\n\n<p>Edit: replaced lookupSession with lookupSessionBS that returns a ByteString.</p>\n"}, {"tags": ["haskell", "reflex", "reflex-dom"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1567933174, "post_id": 57831581, "comment_id": 102108926, "body": "How about just <code>display (constDyn [Apple,Banana])</code> ?"}, {"owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1567934790, "post_id": 57831581, "comment_id": 102109216, "body": "@luqui Sorry, that not what exactly what I want, maybe my code is too minimal. The real problem is I already have complex version of display single item and I want to repeatedly apply them for each of element in the list."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1567940908, "post_id": 57831581, "comment_id": 102110420, "body": "In that case I would go look at how <code>display</code> is implemented for inspiration."}], "answers": [{"tags": [], "owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "is_accepted": false, "score": 0, "last_activity_date": 1567947546, "creation_date": 1567947546, "answer_id": 57842162, "question_id": 57831581, "link": "https://stackoverflow.com/questions/57831581/how-to-render-dynamic-of-list-dynamics-t-a/57842162#57842162", "title": "How to render Dynamic of list (`Dynamics t [a]`)?", "body": "<p>What about <code>mconcat</code>? Something like (untested):</p>\n\n<pre><code>main = mainWidget $ display itemsDyn\n  where\n    itemsDyn = mconcat $ fmap (itemElDyn . constDyn) [Apple,Banana]\n</code></pre>\n\n<p>(Have you seen <a href=\"https://github.com/reflex-frp/reflex/blob/develop/Quickref.md\" rel=\"nofollow noreferrer\">https://github.com/reflex-frp/reflex/blob/develop/Quickref.md</a>?)</p>\n"}], "owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 87, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1567947546, "creation_date": 1567840828, "last_edit_date": 1567936548, "question_id": 57831581, "link": "https://stackoverflow.com/questions/57831581/how-to-render-dynamic-of-list-dynamics-t-a", "title": "How to render Dynamic of list (`Dynamics t [a]`)?", "body": "<p>I can draw element for <code>Dynamic t Item</code> but don't know how to draw element of <code>Dynamic t [Item]</code></p>\n\n<pre><code>import Reflex.Dom\n\ndata ItemType\n  = Apple\n  | Banana\n deriving (Eq, Show)\n\n-- In the real-world, this function build complex DOM. Oversimplified here for MCVE\n-- \nitemElDyn :: MonadWidget t m =&gt; Dynamic t ItemType -&gt; m ()\nitemElDyn = display\n\ntype Items = [ItemType]\n\n-- listItemElDyn :: MonadWidget t m =&gt; Dynamic t Items -&gt; m ()\n-- listItemElDyn = mapM_ display . sequenceA\n\n-- listItemElDyn lsDyn = do\n--   let dynList = sequenceA lsDyn\n--   mapM_ display dynList\n\nmain :: IO ()\nmain = mainWidget $ itemElDyn (constDyn Apple)\n\n</code></pre>\n\n<p>Checking the type in <code>ghci</code> seem like a valid combination</p>\n\n<pre><code>\n```\u03bb&gt; :t mapM_ display . sequence $ constDyn [Apple,Banana]                       \nmapM_ display . sequence $ constDyn [Apple,Banana]\n  :: (PostBuild t m, DomBuilder t m, Traversable (Dynamic t)) =&gt; m ()\n*Main\n\u03bb&gt; :t mapM_ display . sequenceA $ constDyn [Apple,Banana]\nmapM_ display . sequenceA $ constDyn [Apple,Banana]\n  :: (PostBuild t m, DomBuilder t m, Traversable (Dynamic t)) =&gt; m ()\n</code></pre>\n\n<p>but got error when try to run</p>\n\n<pre><code>\u03bb&gt; mapM_ display . sequence $ constDyn [Apple,Banana]\n\n&lt;interactive&gt;:72:1: error:\n    \u2022 No instance for (Traversable (Dynamic t0))\n        arising from a use of \u2018it\u2019\n    \u2022 In a stmt of an interactive GHCi command: print it\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 820, "user_id": 9898465, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eZqQf.jpg?s=128&g=1", "display_name": "Luk&#225;\u0161 K\u0159ivka", "link": "https://stackoverflow.com/users/9898465/luk%c3%a1%c5%a1-k%c5%99ivka"}, "edited": false, "score": 0, "creation_date": 1567863881, "post_id": 57830498, "comment_id": 102097170, "body": "Thank you so much, it will take me some time to fully understand it :)"}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": true, "score": 3, "last_activity_date": 1567828848, "last_edit_date": 1567828848, "creation_date": 1567827782, "answer_id": 57830498, "question_id": 57830027, "link": "https://stackoverflow.com/questions/57830027/converting-data-type-into-query-string/57830498#57830498", "title": "Converting data type into query string", "body": "<p>You can do this with <a href=\"https://wiki.haskell.org/GHC.Generics\" rel=\"nofollow noreferrer\">generics</a>:</p>\n\n<pre><code>{-# LANGUAGE DefaultSignatures, DeriveGeneric, FlexibleContexts, FlexibleInstances, TypeOperators #-}\n\nimport GHC.Generics\nimport Data.ByteString (ByteString)\nimport Data.String\n\ntype Query = [QueryItem]\ntype QueryItem = (ByteString, Maybe ByteString)\n\nclass ToByteString a where\n    toByteString :: a -&gt; ByteString\n    default toByteString :: Show a =&gt; a -&gt; ByteString\n    toByteString = fromString . show\n\ninstance ToByteString Int\ninstance ToByteString Bool\ninstance ToByteString [Char] where\n    toByteString = fromString\n\nclass GToQuery f where\n    gToQuery :: f a -&gt; Query\n\ninstance (GToQuery a, GToQuery b) =&gt; GToQuery (a :*: b) where\n    gToQuery (a :*: b) = gToQuery a ++ gToQuery b\n\ninstance GToQuery a =&gt; GToQuery (M1 D c a) where\n    gToQuery (M1 x) = gToQuery x\n\ninstance GToQuery a =&gt; GToQuery (M1 C c a) where\n    gToQuery (M1 x) = gToQuery x\n\ninstance (Selector c, ToByteString a) =&gt; GToQuery (M1 S c (K1 i (Maybe a))) where\n    gToQuery s@(M1 (K1 x)) = [(toByteString (selName s), fmap toByteString x)]\n\nclass ToQuery a where\n    toQuery :: a -&gt; Query\n    default toQuery :: (Generic a, GToQuery (Rep a)) =&gt; a -&gt; Query\n    toQuery = gToQuery . from\n\ndata ListDatasetsParams = ListDatasetsParams {\n    offset :: Maybe Int,\n    limit :: Maybe Int,\n    desc :: Maybe Bool,\n    unnamed :: Maybe Bool\n} deriving(Generic)\n\ninstance ToQuery ListDatasetsParams\n</code></pre>\n\n<p>It works like this:</p>\n\n<pre><code>*Main&gt; toQuery (ListDatasetsParams (Just 1) Nothing (Just True) Nothing )\n[(\"offset\",Just \"1\"),(\"limit\",Nothing),(\"desc\",Just \"True\"),(\"unnamed\",Nothing)]\n*Main&gt;\n</code></pre>\n"}], "owner": {"reputation": 820, "user_id": 9898465, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eZqQf.jpg?s=128&g=1", "display_name": "Luk&#225;\u0161 K\u0159ivka", "link": "https://stackoverflow.com/users/9898465/luk%c3%a1%c5%a1-k%c5%99ivka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 57830498, "answer_count": 1, "score": 1, "last_activity_date": 1567828848, "creation_date": 1567819877, "question_id": 57830027, "link": "https://stackoverflow.com/questions/57830027/converting-data-type-into-query-string", "title": "Converting data type into query string", "body": "<p>I'm building an API client for one service and the main reason to use that over raw API is to present all the nice types for the user.</p>\n\n<p>One type I made is for optional query parameters which will be different for each endpoint (instead of forcing the user to provide a list of tuples of strings):</p>\n\n<pre><code>data ListDatasetsParams = ListDatasetsParams {\n    offset :: Maybe Int,\n    limit :: Maybe Int,\n    desc :: Maybe Bool,\n    unnamed :: Maybe Bool\n}\n</code></pre>\n\n<p>Now I would like to convert this type into a Query which has the signature</p>\n\n<pre><code>type Query = [QueryItem]\ntype QueryItem = (ByteString, Maybe ByteString)\n</code></pre>\n\n<p>I didn't really find a way to do it at least a bit generic. The only way I got it working is pure hardcode where I check every param and manually add a correct string.</p>\n\n<p>Can I do better? Or is there any other more idiomatic way to do this in Haskell?</p>\n"}, {"tags": ["haskell", "recursive-datastructures"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1567808114, "post_id": 57829064, "comment_id": 102088146, "body": "<code>But it does not give the precise definition of the Type I want.</code> What is the type you want then? Your first version fails because <code>Single a</code> is a value, not a type. The second one looks correct to me, if it differs from what you need then please explain what the difference is. (Well if you want it polymorphic it should be <code>data Exp a = Single a | Mult (Exp a) (Exp a)</code>)"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1567808119, "post_id": 57829064, "comment_id": 102088147, "body": "<code>Single a</code> is not a type. You can either define it as a <code>Mult a Exp</code>, or <code>Mult Expr Expr</code>."}, {"owner": {"reputation": 75, "user_id": 1374828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbb5dd90d16893990c1eb44a81a4dfa9?s=128&d=identicon&r=PG", "display_name": "Ali", "link": "https://stackoverflow.com/users/1374828/ali"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1567808873, "post_id": 57829064, "comment_id": 102088311, "body": "@WillemVanOnsem  in this case <code>Mult a Expr</code> is closest to what I want. I was thinking, How can I tell compiler that the first argument should be a specific definition, instead of <code>Mult Exp Exp</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1567813851, "post_id": 57829064, "comment_id": 102089177, "body": "What&#39;s wrong with <code>data Exp = Single Int | Mult Int Exp</code>?"}, {"owner": {"reputation": 75, "user_id": 1374828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbb5dd90d16893990c1eb44a81a4dfa9?s=128&d=identicon&r=PG", "display_name": "Ali", "link": "https://stackoverflow.com/users/1374828/ali"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1567941554, "post_id": 57829064, "comment_id": 102110572, "body": "@DanielWagner Nothing, except we do not have <code>Mult Int Exp</code> in the language, I&#39;m trying to evaluate. It has &#39;Mult Single Int Exp&#39; . The next best option is <code>Mult Exp Exp</code> , but it allows <code>Mult Exp (Single Int)</code> which is illegal."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1567943519, "post_id": 57829064, "comment_id": 102110956, "body": "@Ali What is the difference between what you want <code>Mult (Single Int) Exp</code> to mean and what <code>Mult Int Exp</code> actually means?"}], "answers": [{"comments": [{"owner": {"reputation": 75, "user_id": 1374828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbb5dd90d16893990c1eb44a81a4dfa9?s=128&d=identicon&r=PG", "display_name": "Ali", "link": "https://stackoverflow.com/users/1374828/ali"}, "edited": false, "score": 0, "creation_date": 1567809158, "post_id": 57829095, "comment_id": 102088364, "body": "You are write, but I want somthing like this: <code>data exp a = Red a | Blue a | Op (Red a) Exp</code>, How can define it?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 75, "user_id": 1374828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbb5dd90d16893990c1eb44a81a4dfa9?s=128&d=identicon&r=PG", "display_name": "Ali", "link": "https://stackoverflow.com/users/1374828/ali"}, "edited": false, "score": 1, "creation_date": 1567809474, "post_id": 57829095, "comment_id": 102088422, "body": "@Ali: You can not do that, or at least not directly, you can however define some extra types, and use <code>GADT</code>s to enforce constraints. For example <code>newtype Red = Red</code>, <code>newtype Blue = Blue</code>, <code>newtype Op = Op</code> and then <code>data Expr a b where; Red :: a -&gt; Expr a Red; Blue :: a -&gt; Expr a Blue; Op :: Expr a Red -&gt; Expr a c -&gt; Expr a Op</code> for example."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1567838431, "last_edit_date": 1567838431, "creation_date": 1567808271, "answer_id": 57829095, "question_id": 57829064, "link": "https://stackoverflow.com/questions/57829064/how-to-define-a-recursive-data-type-that-refers-to-its-definition/57829095#57829095", "title": "How to define a recursive data type that refers to its definition", "body": "<blockquote>\n  <p>But it does not give the precise definition of the Type I want.</p>\n</blockquote>\n\n<p><code>Single a</code> is <em>not</em> a type. <code>Single</code> is a <em>data constructor</em>. So <code>Single a</code> does not make much sense.</p>\n\n<p>You can use <code>Exp</code> here as first parameter, or if you want to restrict the first operand, you can use:</p>\n\n<pre><code>data Exp a = Single a | Mult <b>a</b> (Exp a)</code></pre>\n\n<p>Indeed, since <code>Single a</code> just wraps an <code>a</code>, you can use an <code>a</code> as first parameter of <code>Mult</code>. The <code>Mult</code> data constructor context, makes it clear how to interpret that <code>a</code>.</p>\n\n<p>If you want to allow multiplying two <code>Exp a</code>s, then you can define this as:</p>\n\n<pre><code>data Exp a = Single a | Mult <b>(Exp a)</b> (Exp a)</code></pre>\n\n<p>You can use <a href=\"https://en.wikibooks.org/wiki/Haskell/GADT\" rel=\"nofollow noreferrer\"><em>generic abstract data types (GADTs)</em></a> to make finer specifications when two expressions can be multiplied.</p>\n"}], "owner": {"reputation": 75, "user_id": 1374828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbb5dd90d16893990c1eb44a81a4dfa9?s=128&d=identicon&r=PG", "display_name": "Ali", "link": "https://stackoverflow.com/users/1374828/ali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 57829095, "answer_count": 1, "score": 6, "last_activity_date": 1567838431, "creation_date": 1567808012, "last_edit_date": 1567810410, "question_id": 57829064, "link": "https://stackoverflow.com/questions/57829064/how-to-define-a-recursive-data-type-that-refers-to-its-definition", "title": "How to define a recursive data type that refers to its definition", "body": "<p>I want to write a data type to evaluate the expressions like this: </p>\n\n<p><code>a</code> is evaluated to <code>a</code></p>\n\n<p><code>a + b * c / d -e</code>  is evaluated to  <code>a + (b * (c / (d - e)))</code> </p>\n\n<p>So the first argument is always a number and the second one is either a number or an expression</p>\n\n<p>I have tried to define a data type like this</p>\n\n<pre><code> data Exp  = Single Int\n          | Mult (Single Int) Exp\n</code></pre>\n\n<p>But it gives me this compilation error:  </p>\n\n<pre><code>    Not in scope: type constructor or class \u2018Single\u2019\n    A data constructor of that name is in scope; did you mean DataKinds?\n  |         \n9 |           | Mult (Single Integer ) Exp \n  |            \n</code></pre>\n\n<p>I can define it like this: </p>\n\n<pre><code>data Exp  = Single Integer\n          | Mult Exp  Exp\n</code></pre>\n\n<p>But it does not give the precise definition of the Type I want.\nHow can I define this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1567801057, "post_id": 57828084, "comment_id": 102086286, "body": "A function as the one defined here makes no sense, since you can only use patterns that use data constructors of the type in the signature. <code>(_, _)</code> is not a data constructor of <code>a</code>. Haskell is a statically typed language. After the compilation phase, all the types are known. It therfore makes not much sense to have a function <code>is2Tuple</code> in the first place."}, {"owner": {"reputation": 962, "user_id": 490815, "user_type": "registered", "accept_rate": 24, "profile_image": "https://www.gravatar.com/avatar/366f7b0d571e7811680c53984c34c966?s=128&d=identicon&r=PG", "display_name": "sinoTrinity", "link": "https://stackoverflow.com/users/490815/sinotrinity"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1567801523, "post_id": 57828084, "comment_id": 102086433, "body": "Is it possible to make a version where \u2018a\u2019 is a type variable?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1567801581, "post_id": 57828084, "comment_id": 102086458, "body": "You can not check types at runtime, that would horribly break parametricity. At best, you can if you change the type to <code>isPair :: Typeable a =&gt; a  -&gt;Bool</code> so that type information is retained at runtime, but still, that sounds as a quite bad idea in most common contexts. Don&#39;t follow this path carelessly without being sure of what you are trying to achieve. Why do you <i>need</i> to check that? This might be an XY problem."}, {"owner": {"reputation": 962, "user_id": 490815, "user_type": "registered", "accept_rate": 24, "profile_image": "https://www.gravatar.com/avatar/366f7b0d571e7811680c53984c34c966?s=128&d=identicon&r=PG", "display_name": "sinoTrinity", "link": "https://stackoverflow.com/users/490815/sinotrinity"}, "edited": false, "score": 0, "creation_date": 1567802021, "post_id": 57828084, "comment_id": 102086615, "body": "I have a type variable \u2018a\u2019 and it could be one type in production and another type in testing. And depending on which type it is, different results are returned. What\u2019s the best way to handle this?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1567804643, "post_id": 57828084, "comment_id": 102087346, "body": "<code>is2Tuple :: (a,b) -&gt; Bool; is2Tuple _ = True</code>.  (joke)"}], "answers": [{"tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 7, "last_activity_date": 1567803160, "last_edit_date": 1567803160, "creation_date": 1567802788, "answer_id": 57828387, "question_id": 57828084, "link": "https://stackoverflow.com/questions/57828084/pattern-matching-any-2-tuple/57828387#57828387", "title": "Pattern matching any 2-tuple", "body": "<p>Based on your comments, what you're really looking for is a way to define a function that works with several parameter types, and has separate implementations for each type. Quote: \"<em>one type in production and another type in testing</em>\". This is usually called \"<em>overloading</em>\".</p>\n\n<p>The way to overload functions is Haskell is <em>type classes</em>. They are somewhat like interfaces in Java or C#, except you get to define them separately from the types, and the compiler picks the one you need automatically.</p>\n\n<p>If you want your function to work with two different types, and have different implementations for those types, make this function a member of a type class:</p>\n\n<pre><code>class MyClass a where\n    f :: a -&gt; String\n</code></pre>\n\n<p>And then provide two instances of this class for the two types:</p>\n\n<pre><code>instance MyClass (a, b) where\n    f (a, b) = \"It's a tuple\"\n\ninstance MyClass Int where\n    f a = \"It's an Int\"\n</code></pre>\n\n<p>Then the compiler will be able to pick the right implementation based on paramater types at call sites:</p>\n\n<pre><code>main :: IO ()\nmain = do\n    print (f (\"foo\", \"bar\"))  -- prints \"It's a tuple\"\n    print (f (42 :: Int))     -- prints \"It's an Int\"\n</code></pre>\n\n<p>It you try to use the function with a type for which there is no implementation, the compiler will catch you:</p>\n\n<pre><code>    print (f True)  -- ERROR: no instance MyClass Bool\n</code></pre>\n"}], "owner": {"reputation": 962, "user_id": 490815, "user_type": "registered", "accept_rate": 24, "profile_image": "https://www.gravatar.com/avatar/366f7b0d571e7811680c53984c34c966?s=128&d=identicon&r=PG", "display_name": "sinoTrinity", "link": "https://stackoverflow.com/users/490815/sinotrinity"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 57828387, "answer_count": 1, "score": 0, "last_activity_date": 1567803160, "creation_date": 1567800889, "question_id": 57828084, "link": "https://stackoverflow.com/questions/57828084/pattern-matching-any-2-tuple", "title": "Pattern matching any 2-tuple", "body": "<p>I want a function deciding if the passed argument is a 2-tuple, but the following does not compile.</p>\n\n<pre><code>is2Tuple :: a -&gt; Bool\nis2Tuple (_, _) = True\nis2Tuple _      = False\n</code></pre>\n\n<p>It gives the following error:</p>\n\n<pre><code>    \u2022 Couldn't match expected type \u2018a\u2019 with actual type \u2018(a0, b0)\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n        the type signature for:\n          isPair :: forall a. a -&gt; Bool\n        at helloworld.hs:30:1-19\n    \u2022 In the pattern: (_, _)\n      In an equation for \u2018isPair\u2019: isPair (_, _) = True\n    \u2022 Relevant bindings include\n        isPair :: a -&gt; Bool (bound at helloworld.hs:31:1)\n   |\n2  | isPair (_, _) = True\n</code></pre>\n\n<p>Anyone knows why?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 1548, "user_id": 4345848, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/QpVd4.jpg?s=128&g=1", "display_name": "Sir4ur0n", "link": "https://stackoverflow.com/users/4345848/sir4ur0n"}, "edited": false, "score": 0, "creation_date": 1568149770, "post_id": 57826989, "comment_id": 102181210, "body": "I copy-pasted your configuration on a fresh new Stack project and <code>stack build</code> works fine on my machine. I think you either didn&#39;t provide enough information (maybe you have other dependencies? Or some specific piece of code?) or it&#39;s specific to your machine? Note: I&#39;m on Windows."}, {"owner": {"reputation": 2299, "user_id": 1018290, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/113bcc8f198ab8a17839aab5f4f0776f?s=128&d=identicon&r=PG", "display_name": "Will Sewell", "link": "https://stackoverflow.com/users/1018290/will-sewell"}, "reply_to_user": {"reputation": 1548, "user_id": 4345848, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/QpVd4.jpg?s=128&g=1", "display_name": "Sir4ur0n", "link": "https://stackoverflow.com/users/4345848/sir4ur0n"}, "edited": false, "score": 0, "creation_date": 1568281731, "post_id": 57826989, "comment_id": 102228093, "body": "@Sir4ur0n what version of <code>stack</code> are you using? As I said, this only seems to affect newer versions of stack."}, {"owner": {"reputation": 1548, "user_id": 4345848, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/QpVd4.jpg?s=128&g=1", "display_name": "Sir4ur0n", "link": "https://stackoverflow.com/users/4345848/sir4ur0n"}, "edited": false, "score": 0, "creation_date": 1568310249, "post_id": 57826989, "comment_id": 102243371, "body": "The latest one (2.1.3)"}], "answers": [{"comments": [{"owner": {"reputation": 2299, "user_id": 1018290, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/113bcc8f198ab8a17839aab5f4f0776f?s=128&d=identicon&r=PG", "display_name": "Will Sewell", "link": "https://stackoverflow.com/users/1018290/will-sewell"}, "edited": false, "score": 0, "creation_date": 1568281582, "post_id": 57878685, "comment_id": 102228002, "body": "Interesting. Do you know why my configuration worked in a previous version of <code>stack</code>, but not with the latest version?"}, {"owner": {"reputation": 2299, "user_id": 1018290, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/113bcc8f198ab8a17839aab5f4f0776f?s=128&d=identicon&r=PG", "display_name": "Will Sewell", "link": "https://stackoverflow.com/users/1018290/will-sewell"}, "edited": false, "score": 0, "creation_date": 1568281667, "post_id": 57878685, "comment_id": 102228060, "body": "Semi related: <code>stack</code> currently prints <code>needed due to tmphaskell-0.1.0.0 -&gt; base-compat-0.10.5</code>. Is there a way of printing the full dependency chain, e.g.: <code>tmphaskell-0.1.0.0 -&gt; aeson -&gt; base-compat-0.10.5</code>?"}, {"owner": {"reputation": 126, "user_id": 4129231, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-S2wRYUYqhp8/AAAAAAAAAAI/AAAAAAAAAIE/KEqsaIbsJ34/photo.jpg?sz=128", "display_name": "David Baynard", "link": "https://stackoverflow.com/users/4129231/david-baynard"}, "reply_to_user": {"reputation": 2299, "user_id": 1018290, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/113bcc8f198ab8a17839aab5f4f0776f?s=128&d=identicon&r=PG", "display_name": "Will Sewell", "link": "https://stackoverflow.com/users/1018290/will-sewell"}, "edited": false, "score": 1, "creation_date": 1568307780, "post_id": 57878685, "comment_id": 102242346, "body": "On the change, yes! It&#39;s new in stack 2.1. As to the full chain, I don&#39;t think there&#39;s an option. Would it be helpful?"}, {"owner": {"reputation": 2299, "user_id": 1018290, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/113bcc8f198ab8a17839aab5f4f0776f?s=128&d=identicon&r=PG", "display_name": "Will Sewell", "link": "https://stackoverflow.com/users/1018290/will-sewell"}, "edited": false, "score": 0, "creation_date": 1568384739, "post_id": 57878685, "comment_id": 102268483, "body": "Yes I think it would be useful. The example I posted here was a toy project. In reality my dependency graph was much more complex. I had to print out the whole dependency graph to figure out how I was depending on the packages listed in &quot;the following exceptions were encountered&quot;."}], "tags": [], "owner": {"reputation": 126, "user_id": 4129231, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-S2wRYUYqhp8/AAAAAAAAAAI/AAAAAAAAAIE/KEqsaIbsJ34/photo.jpg?sz=128", "display_name": "David Baynard", "link": "https://stackoverflow.com/users/4129231/david-baynard"}, "is_accepted": false, "score": 0, "last_activity_date": 1568155039, "last_edit_date": 1568155039, "creation_date": 1568152535, "answer_id": 57878685, "question_id": 57826989, "link": "https://stackoverflow.com/questions/57826989/stack-unable-to-find-package-in-snapshot-when-an-extra-dep-is-specified-that-is/57878685#57878685", "title": "Stack unable to find package in snapshot when an extra-dep is specified that is out of a dependency&#39;s version bounds", "body": "<p><code>aeson</code> (via <code>base-compat</code>) depends on <code>unix</code> and as <code>time</code> and <code>unix</code> are ghc boot packages, both need to be added as <code>extra-deps</code>.</p>\n\n<p>The reason? <a href=\"https://gitlab.haskell.org/ghc/ghc/wikis/commentary/libraries/version-history\" rel=\"nofollow noreferrer\">Boot libraries</a> don't have to match their hackage versions, so if you override a boot packages you must also explicitly override any others you use.</p>\n\n<p>Source: <a href=\"https://www.snoyman.com/blog/2019/01/mismatched-global-packages\" rel=\"nofollow noreferrer\">https://www.snoyman.com/blog/2019/01/mismatched-global-packages</a></p>\n\n<p>(edit fixed error; misread the precise error).</p>\n"}], "owner": {"reputation": 2299, "user_id": 1018290, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/113bcc8f198ab8a17839aab5f4f0776f?s=128&d=identicon&r=PG", "display_name": "Will Sewell", "link": "https://stackoverflow.com/users/1018290/will-sewell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 139, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1568155039, "creation_date": 1567794568, "last_edit_date": 1568144566, "question_id": 57826989, "link": "https://stackoverflow.com/questions/57826989/stack-unable-to-find-package-in-snapshot-when-an-extra-dep-is-specified-that-is", "title": "Stack unable to find package in snapshot when an extra-dep is specified that is out of a dependency&#39;s version bounds", "body": "<p>I have a <code>package.yaml</code> containing</p>\n\n<pre><code>dependencies:\n- aeson &gt;= 0.8 &amp;&amp; &lt; 1.5\n- base &gt;= 4.7 &amp;&amp; &lt; 5\n- time &gt;= 1.5 &amp;&amp; &lt; 1.10\n</code></pre>\n\n<p>I want to use a newer version of <code>time</code> than is in the <code>lts-14.4</code> snapshot, so I create a <code>stack.yaml</code> with:</p>\n\n<pre><code>resolver: lts-14.4\npackages:\n- .\nextra-deps:\n- time-1.9.2\n</code></pre>\n\n<p>However when I run <code>stack build</code>, I get the output</p>\n\n<pre><code>WARNING: Ignoring aeson's bounds on time (&gt;=1.4 &amp;&amp; &lt;1.9); using time-1.9.2.\nReason: trusting snapshot over cabal file dependency information.\n\nError: While constructing the build plan, the following exceptions were encountered:\n\nIn the dependencies for base-compat-0.10.5:\n    unix needed, but the stack configuration has no specified version  (latest matching version is 2.7.2.2)\nneeded due to tmphaskell-0.1.0.0 -&gt; base-compat-0.10.5\n\nSome different approaches to resolving this:\n\n  * Recommended action: try adding the following to your extra-deps in /Users/will/src/tmphaskell/stack.yaml:\n\n- unix-2.7.2.2@sha256:e69269a17b9fa26cb77f3f55e86c39d0a4940ccfa0c4bc20826919d2572076ad,3496\n\nPlan construction failed.\n</code></pre>\n\n<p>What I don't understand about this <code>unix-2.7.2.2</code> <em>does</em> exist in the <code>lts-14.4</code> snapshot so why can't stack find the specified version?</p>\n\n<p>This configuration worked for an older version of stack before I upgraded it to <code>2.1.3</code>. I'm not sure which version I was running previously.</p>\n"}, {"tags": ["json", "haskell", "random", "aeson"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1567799839, "post_id": 57826986, "comment_id": 102085873, "body": "If you have a type like <code>data Person = Person {name :: String, age :: Int, role :: String}</code>, converting to and from JSON is fairly trivial. You can focus on the question of how to generate a random value of type <code>Person</code>."}, {"owner": {"reputation": 85, "user_id": 11514521, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-2OJcM4zNtUQ/AAAAAAAAAAI/AAAAAAAAB1c/h1tmB8tQFDs/photo.jpg?sz=128", "display_name": "Augusto Dias", "link": "https://stackoverflow.com/users/11514521/augusto-dias"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1567827249, "post_id": 57826986, "comment_id": 102090643, "body": "Thanks a lot! I was focusing on the wrong side of the question"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1568034552, "post_id": 57826986, "comment_id": 102135616, "body": "If you have a type like <code>Person</code> as @chepner suggests, you can make it a <code>Random</code> instance. Here&#39;s an answer that shows how to do that for another type: <a href=\"https://stackoverflow.com/a/47166776/126014\">stackoverflow.com/a/47166776/126014</a>"}], "owner": {"reputation": 85, "user_id": 11514521, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-2OJcM4zNtUQ/AAAAAAAAAAI/AAAAAAAAB1c/h1tmB8tQFDs/photo.jpg?sz=128", "display_name": "Augusto Dias", "link": "https://stackoverflow.com/users/11514521/augusto-dias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1567795440, "creation_date": 1567794557, "last_edit_date": 1567795440, "question_id": 57826986, "link": "https://stackoverflow.com/questions/57826986/how-can-i-generate-random-values-in-haskell-for-any-value-of-an-aeson-object", "title": "How can I generate random values in Haskell for any Value of an aeson Object", "body": "<p>I've started coding Haskell few weeks ago. I'm trying to do something like a random JSON generator using aeson.</p>\n\n<p>Suppose that I have a json object like this:</p>\n\n<pre><code>{\n    name: \"bob\",\n    age: 13,\n    role: \"admin\"\n}\n</code></pre>\n\n<p>When I use aeson to decode it, I get this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>let Just json = decode str :: Maybe Object\n\n-- fromList [(\"name\",String \"bob\"),(\"age\",Number 13.0),(\"role\",String \"admin\")]\n</code></pre>\n\n<p>What I want is generate a list of JSON objects based on bob \"model\":</p>\n\n<pre><code>[\n {\n   name: &lt;any random string&gt;,\n   age: &lt;any random number&gt;,\n   role: &lt;any random string&gt;\n },\n ...\n]\n</code></pre>\n\n<p>I know that I need to <code>fmap</code> over the HashMap values, but I don't have any clue of how can I produce random values based on its types.</p>\n\n<p>I'm not worried about other complex values that can appear on JSON fields yet. I'm focusing on numbers and strings for now.</p>\n"}, {"tags": ["haskell", "compiler-errors", "haskell-stack", "pkg-config", "nixos"], "answers": [{"tags": [], "owner": {"reputation": 45723, "user_id": 18243, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/607cfd4a5b41fe6c886c978128b9c03e?s=128&d=identicon&r=PG", "display_name": "Jean-Paul Calderone", "link": "https://stackoverflow.com/users/18243/jean-paul-calderone"}, "is_accepted": true, "score": 4, "last_activity_date": 1567777328, "creation_date": 1567777328, "answer_id": 57823198, "question_id": 57822288, "link": "https://stackoverflow.com/questions/57822288/how-do-i-supply-a-c-library-to-stack-on-nixos/57823198#57823198", "title": "How do I supply a C library to stack on NixOS?", "body": "<p>Apparently a case of end-of-the-day documentation-reading-fail.  This morning, it didn't take long to find the stack documentation that explains how to use a custom shell.nix.  <a href=\"https://docs.haskellstack.org/en/stable/nix_integration/#using-a-custom-shellnix-file\" rel=\"nofollow noreferrer\">The stack docs do elaborate on how this works</a>, including an example which shows it's not at all like the shell I thought was expected:</p>\n\n<pre><code>{ghc}:\nwith (import &lt;nixpkgs&gt; {});\n\nhaskell.lib.buildStackProject {\n  inherit ghc;\n  name = \"myEnv\";\n  buildInputs = [ glpk pcre ];\n}\n</code></pre>\n\n<p>Adapting my shell to use <code>buildStackProject</code> instead of <code>mkShell</code>:</p>\n\n<pre><code>{ ghc }:\nwith (import &lt;nixpkgs&gt; { overlays = [ (import ./overlay.nix) ]; });\n\nhaskell.lib.buildStackProject {\n  inherit ghc;\n  name = \"PrivacyPass\";\n  # extra-library made available via the overlay.\n  # overlay probably not strictly necessary here, either.\n  buildInputs = [ zlib extra-library ];\n}\n</code></pre>\n\n<p>and then pointing stack at it in stack.yaml:</p>\n\n<pre><code>nix:\n  enable: true\n  shell-file: \"stack-shell.nix\"\n</code></pre>\n\n<p>results in a successful build.</p>\n"}], "owner": {"reputation": 45723, "user_id": 18243, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/607cfd4a5b41fe6c886c978128b9c03e?s=128&d=identicon&r=PG", "display_name": "Jean-Paul Calderone", "link": "https://stackoverflow.com/users/18243/jean-paul-calderone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 630, "favorite_count": 1, "accepted_answer_id": 57823198, "answer_count": 1, "score": 6, "last_activity_date": 1567777328, "creation_date": 1567773803, "question_id": 57822288, "link": "https://stackoverflow.com/questions/57822288/how-do-i-supply-a-c-library-to-stack-on-nixos", "title": "How do I supply a C library to stack on NixOS?", "body": "<p>I have a stack-based project that depends on a couple C libraries.  One of these C libraries, zlib, is available from a native NixOS package and I can put into the nix section of stack.yaml:</p>\n\n<pre><code>nix:\n  enable: true\n  packages:\n    - \"zlib\"\n</code></pre>\n\n<p>The other is <em>not</em> part of nixpkgs.  The stack documentation suggests that the alternative to using the <code>nix</code> section in <code>stack.yaml</code> is to \"write a shell.nix\" without elaborating much.</p>\n\n<p>So I wrote one, sticking to zlib as an example:</p>\n\n<pre><code>{ pkgs ? import &lt;nixpkgs&gt; { } }:\n  pkgs.mkShell {\n    buildInputs = [\n      pkgs.pkgconfig\n      pkgs.zlib\n      pkgs.stack\n    ];\n  }\n</code></pre>\n\n<p>This gives me a working pkg-config for zlib:</p>\n\n<pre><code>[nix-shell:~/Work/PrivateStorage/PaymentServer]$ pkg-config --modversion zlib\n1.2.11\n</code></pre>\n\n<p>However, it doesn't appear to make stack able to find the library:</p>\n\n<pre><code>[nix-shell:~/Work/PrivateStorage/PaymentServer]$ stack build\nzlib-0.6.2: configure\nProgress 1/7\n\n--  While building package zlib-0.6.2 using:\n      /home/exarkun/.stack/setup-exe-cache/x86_64-linux-nix/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux-nix/Cabal-2.4.0.1 configure --with-ghc=/nix/store/zfpm9bai9gj8vs09s2i2gkhvgsjkx13z-ghc-8.6.5/bin/ghc --with-ghc-pkg=/nix/store/zfpm9bai9gj8vs09s2i2gkhvgsjkx13z-ghc-8.6.5/bin/ghc-pkg --user --package-db=clear --package-db=global --package-db=/home/exarkun/.stack/snapshots/x86_64-linux-nix/lts-14.1/8.6.5/pkgdb --libdir=/home/exarkun/.stack/snapshots/x86_64-linux-nix/lts-14.1/8.6.5/lib --bindir=/home/exarkun/.stack/snapshots/x86_64-linux-nix/lts-14.1/8.6.5/bin --datadir=/home/exarkun/.stack/snapshots/x86_64-linux-nix/lts-14.1/8.6.5/share --libexecdir=/home/exarkun/.stack/snapshots/x86_64-linux-nix/lts-14.1/8.6.5/libexec --sysconfdir=/home/exarkun/.stack/snapshots/x86_64-linux-nix/lts-14.1/8.6.5/etc --docdir=/home/exarkun/.stack/snapshots/x86_64-linux-nix/lts-14.1/8.6.5/doc/zlib-0.6.2 --htmldir=/home/exarkun/.stack/snapshots/x86_64-linux-nix/lts-14.1/8.6.5/doc/zlib-0.6.2 --haddockdir=/home/exarkun/.stack/snapshots/x86_64-linux-nix/lts-14.1/8.6.5/doc/zlib-0.6.2 --dependency=base=base-4.12.0.0 --dependency=bytestring=bytestring-0.10.8.2 --extra-include-dirs=/nix/store/a54skdf3xksiqvcvr75bjpdl1jx8dgbk-gmp-6.1.2-dev/include --extra-include-dirs=/nix/store/br7kq0kvbn73rhzl17js0w3pprphhzv1-git-2.19.2/include --extra-include-dirs=/nix/store/ghzg4kg0sjif58smj2lfm2bdvjwim85y-gcc-wrapper-7.4.0/include --extra-include-dirs=/nix/store/zfpm9bai9gj8vs09s2i2gkhvgsjkx13z-ghc-8.6.5/include --extra-lib-dirs=/nix/store/br7kq0kvbn73rhzl17js0w3pprphhzv1-git-2.19.2/lib --extra-lib-dirs=/nix/store/ghzg4kg0sjif58smj2lfm2bdvjwim85y-gcc-wrapper-7.4.0/lib --extra-lib-dirs=/nix/store/kggcrzpa5hd41b7v60wa7xjkgjs43xsl-gmp-6.1.2/lib --extra-lib-dirs=/nix/store/zfpm9bai9gj8vs09s2i2gkhvgsjkx13z-ghc-8.6.5/lib\n    Process exited with code: ExitFailure 1\n    Logs have been written to: /home/exarkun/Work/PrivateStorage/PaymentServer/.stack-work/logs/zlib-0.6.2.log\n\n    Configuring zlib-0.6.2...\n    Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5: Missing dependency on a foreign\n    library:\n    * Missing (or bad) header file: zlib.h\n    * Missing (or bad) C library: z\n    This problem can usually be solved by installing the system package that\n    provides this library (you may need the \"-dev\" version). If the library is\n    already installed but in a non-standard location then you can use the flags\n    --extra-include-dirs= and --extra-lib-dirs= to specify where it is.If the\n    library file does exist, it may contain errors that are caught by the C\n    compiler at the preprocessing stage. In this case you can re-run configure\n    with the verbosity flag -v3 to see the error messages.\n    If the header file does exist, it may contain errors that are caught by the C\n    compiler at the preprocessing stage. In this case you can re-run configure\n    with the verbosity flag -v3 to see the error messages.\n</code></pre>\n\n<p>For zlib, there's no particular need to go this route, but as far as I can tell, I cannot put my non-nixpkgs package into the <code>nix.packages</code> list in stack.yaml.</p>\n\n<p>How do I get stack to find these libraries?</p>\n"}, {"tags": ["haskell", "type-inference"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1567763845, "post_id": 57819033, "comment_id": 102069826, "body": "This is not possible by design. Use <code>Either</code>."}, {"owner": {"reputation": 353, "user_id": 999007, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/07686856841387b6f7e5ff05da35f105?s=128&d=identicon&r=PG", "display_name": "schoettl", "link": "https://stackoverflow.com/users/999007/schoettl"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1567764135, "post_id": 57819033, "comment_id": 102069964, "body": "Thanks. I cannot use <code>Either</code> because 1) I have more datatypes than <code>Text</code> and <code>Integer</code> and 2) only <code>Maybe</code> is possible by design (Yesod/Persistent framework). Maybe there is a compiler extension for such cases? Otherwise I have to duplicate <code>updateFunc</code> and use different names for it."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1567764484, "post_id": 57819033, "comment_id": 102070130, "body": "Make a new datatype to encapsulate the options. E.g.: <code>data MyReturnType = ReturnText Text | ReturnInteger Integer | ...</code>. But maybe if your <code>updateFunc</code> does totally different things, you should consider seperating it or writing a typeclass."}, {"owner": {"reputation": 353, "user_id": 999007, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/07686856841387b6f7e5ff05da35f105?s=128&d=identicon&r=PG", "display_name": "schoettl", "link": "https://stackoverflow.com/users/999007/schoettl"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1567766677, "post_id": 57819033, "comment_id": 102071176, "body": "Hm, <code>updateFunc</code> does not even touch the value of type <code>a</code> inside the <code>Maybe</code>. Since  <code>updateFunc</code> is only used as a helper in one function, I think it&#39;s easiest to copy the first line and call it <code>updateFuncT</code>, <code>updateFuncI</code>, ..."}, {"owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "edited": false, "score": 1, "creation_date": 1567766766, "post_id": 57819033, "comment_id": 102071222, "body": "What&#39;s the type of targetTitle? Are you sure that this type annotation shouldn&#39;t be in a separate line?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1567774391, "post_id": 57819033, "comment_id": 102074854, "body": "Why are you defining <code>_</code> twice?"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 6, "last_activity_date": 1567771122, "creation_date": 1567771122, "answer_id": 57821617, "question_id": 57819033, "link": "https://stackoverflow.com/questions/57819033/make-function-with-maybe-a-parameter-generic/57821617#57821617", "title": "Make function with (Maybe a) parameter &quot;generic&quot;", "body": "<p>Try annotating the binding, not the expression.</p>\n\n<pre><code>let updateFunc :: (Title -&gt; Maybe a) -&gt; Maybe a\n    updateFunc = updatedMaybeProperty srcTitle targetTitle\n    _ = updateFunc (titleVersion      :: Title -&gt; Maybe Text)\n    _ = updateFunc (titleYearProduced :: Title -&gt; Maybe Integer)\n</code></pre>\n"}], "owner": {"reputation": 353, "user_id": 999007, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/07686856841387b6f7e5ff05da35f105?s=128&d=identicon&r=PG", "display_name": "schoettl", "link": "https://stackoverflow.com/users/999007/schoettl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567771122, "creation_date": 1567761080, "question_id": 57819033, "link": "https://stackoverflow.com/questions/57819033/make-function-with-maybe-a-parameter-generic", "title": "Make function with (Maybe a) parameter &quot;generic&quot;", "body": "<pre class=\"lang-hs prettyprint-override\"><code>let updateFunc = updatedMaybeProperty srcTitle targetTitle :: (Title -&gt; Maybe a) -&gt; Maybe a\n    _ = updateFunc (titleVersion      :: Title -&gt; Maybe Text)\n    _ = updateFunc (titleYearProduced :: Title -&gt; Maybe Integer)\n</code></pre>\n\n<p>I get this error in line 3:</p>\n\n<pre><code>    \u2022 Couldn't match type \u2018Text\u2019 with \u2018Integer\u2019\n      Expected type: Title -&gt; Maybe Text\n        Actual type: Title -&gt; Maybe Integer\n    \u2022 In the first argument of \u2018updateFunc\u2019, namely\n        \u2018(titleYearProduced :: Title -&gt; Maybe Integer)\u2019\n</code></pre>\n\n<p>Apparently, in line 2, the compiler infers the type for <code>Maybe a</code> and decides <code>a</code> must always be <code>Text</code>.</p>\n\n<p>How can I prevent this and make <code>updateFunc</code> \"generic\" so that it works with different types for <code>a</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1567759383, "post_id": 57818586, "comment_id": 102067637, "body": "Since that is the &quot;base&quot; case of the recursion, it will always be done once."}, {"owner": {"reputation": 117, "user_id": 8738654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e13a61d4627532c3fd698f64a5be7504?s=128&d=identicon&r=PG&f=1", "display_name": "Jon Harper", "link": "https://stackoverflow.com/users/8738654/jon-harper"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1567760272, "post_id": 57818586, "comment_id": 102068028, "body": "Maybe I asked it bit wrong but my real question is not how many times it happens in single round but how many times in total this statement goes through. For example if c1 is a, c2 is b, g is 2 and string is &quot;aaabbb&quot; it should return 2 because that statement happens twice."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1567760399, "post_id": 57818586, "comment_id": 102068084, "body": "well then I guess you should use a <code>State</code> monad (or <code>StateT</code>, etc.) and update the number of calls accordingly."}, {"owner": {"reputation": 1958, "user_id": 939108, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/055cba8d3eb565a817f6f7f20f936814?s=128&d=identicon&r=PG", "display_name": "Hjulle", "link": "https://stackoverflow.com/users/939108/hjulle"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1567767924, "post_id": 57818586, "comment_id": 102071737, "body": "@Willem-Van-Onsem No, that is needlessly complicated for a simple problem like this."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 1958, "user_id": 939108, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/055cba8d3eb565a817f6f7f20f936814?s=128&d=identicon&r=PG", "display_name": "Hjulle", "link": "https://stackoverflow.com/users/939108/hjulle"}, "edited": false, "score": 0, "creation_date": 1567768074, "post_id": 57818586, "comment_id": 102071792, "body": "@Hjulle: well based on the comment, I had the idea that it should count the total amount of evaluates where <code>gaps</code> can be called multiple times. The idea of <code>State</code> is then to at least hide the complexity of the state that will be &quot;implicitly&quot; passed :)"}], "answers": [{"comments": [{"owner": {"reputation": 1958, "user_id": 939108, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/055cba8d3eb565a817f6f7f20f936814?s=128&d=identicon&r=PG", "display_name": "Hjulle", "link": "https://stackoverflow.com/users/939108/hjulle"}, "edited": false, "score": 0, "creation_date": 1567768108, "post_id": 57820148, "comment_id": 102071809, "body": "Do you have suggestion about what to use instead of <code>!!</code> to be safer?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 1958, "user_id": 939108, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/055cba8d3eb565a817f6f7f20f936814?s=128&d=identicon&r=PG", "display_name": "Hjulle", "link": "https://stackoverflow.com/users/939108/hjulle"}, "edited": false, "score": 0, "creation_date": 1567768620, "post_id": 57820148, "comment_id": 102072035, "body": "@Hjulle: use something like <a href=\"https://hackage.haskell.org/package/safe-0.3.17/docs/Safe.html#v:atMay\" rel=\"nofollow noreferrer\"><code>atMay :: Int -&gt; [a] -&gt; Maybe a</code></a> or <a href=\"https://hackage.haskell.org/package/ShellCheck-0.7.0/docs/ShellCheck-AnalyzerLib.html#v:-33--33--33-\" rel=\"nofollow noreferrer\"><code>(!!!)</code></a>."}, {"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "reply_to_user": {"reputation": 1958, "user_id": 939108, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/055cba8d3eb565a817f6f7f20f936814?s=128&d=identicon&r=PG", "display_name": "Hjulle", "link": "https://stackoverflow.com/users/939108/hjulle"}, "edited": false, "score": 0, "creation_date": 1567774259, "post_id": 57820148, "comment_id": 102074783, "body": "@Hjulle use william&#39;s answer. I&#39;ve also seen the <code>!?</code> operator, but I can&#39;t remember if it was define only for vectors or any for index-like data structures."}, {"owner": {"reputation": 117, "user_id": 8738654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e13a61d4627532c3fd698f64a5be7504?s=128&d=identicon&r=PG&f=1", "display_name": "Jon Harper", "link": "https://stackoverflow.com/users/8738654/jon-harper"}, "edited": false, "score": 0, "creation_date": 1567779276, "post_id": 57820148, "comment_id": 102077526, "body": "Thank you. I was actually really close to answer but I didn&#39;t realise to call function recursively in that other statement as well. :)"}], "tags": [], "owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "is_accepted": true, "score": 5, "last_activity_date": 1567765134, "creation_date": 1567765134, "answer_id": 57820148, "question_id": 57818586, "link": "https://stackoverflow.com/questions/57818586/how-to-count-number-of-times-guard-statement-happens-in-recursion/57820148#57820148", "title": "How to count number of times guard statement happens in recursion?", "body": "<p>Just add <code>1</code> and call the function recursively</p>\n\n<pre><code>gaps :: (Char, Char) -&gt; Int -&gt; String -&gt; Int\ngaps _ _ [] = 0                                           -- base case \ngaps (c1,c2) g (s:xs)\n   | c1 == s &amp;&amp; c2 == (s:xs) !! g = 1 + gaps (c1,c2) g xs -- add one to final result\n   | otherwise =  gaps (c1,c2) g xs\n\n&gt; gaps ('a','b') 2 \"aaabbb\"\n2\n&gt; gaps ('a','b') 3 \"aaaabbbb\"\n3\n</code></pre>\n\n<p>Be carefull when using  <code>!!</code>. It isn't total and might fail if your input string has <code>c1</code>'s values less than <code>g</code> positions before the end of the string</p>\n\n<pre><code>&gt; gaps ('a','b') 3 \"aaaababbb\" -- doesn't fail\n3\n&gt; gaps ('a','b') 3 \"aaaabbabb\" -- does fail!!!!\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 275, "user_id": 3050617, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/38f81e87082f4721b93c2c903a5f7545?s=128&d=identicon&r=PG", "display_name": "L0neGamer", "link": "https://stackoverflow.com/users/3050617/l0negamer"}, "is_accepted": false, "score": 1, "last_activity_date": 1567847003, "creation_date": 1567847003, "answer_id": 57832235, "question_id": 57818586, "link": "https://stackoverflow.com/questions/57818586/how-to-count-number-of-times-guard-statement-happens-in-recursion/57832235#57832235", "title": "How to count number of times guard statement happens in recursion?", "body": "<p>Off the back of questions on how to make this thing safer, I have made the following code snippet, borrowing from Ismor's answer.</p>\n\n<pre><code>-- a way to safely get the nth item from a list\nget' :: [a] -&gt; Int -&gt; Maybe a\nget' [] _ = Nothing\nget' (x:xs) 0 = Just x\nget' (x:xs) n \n | n &gt; 0 = get' xs (n-1)\n | otherwise = Nothing\n\n-- takes a Maybe value. if it's Nothing, return 0. if it's Just a value, compare\n-- the value and a given param, if equal return 1, else 0\nseeEqual:: (Num b, Eq a) =&gt; Maybe a -&gt; a -&gt; b\nseeEqual Nothing _ = 0\nseeEqual (Just a) b\n | a==b = 1\n | otherwise = 0\n\n-- I have edited the first guard so that it checks c1 and s, then tries to calculate\n-- whether c2 and the specific list item are equal, and then recurses as before\ngaps :: (Char, Char) -&gt; Int -&gt; String -&gt; Int \ngaps _ _ [] = 0 -- base case \ngaps (c1,c2) g (s:xs) \n | c1 == s = (seeEqual (get' (s:xs) g) c2) + gaps (c1,c2) g xs -- add one to final result \n | otherwise = gaps (c1,c2) g xs\n\n</code></pre>\n\n<p>I do not claim that this is perfect, but I do think this is safe and shouldn't throw any exceptions or raise any errors.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>Prelude&gt; gaps ('a','b') 3 \"aaaababbb\"\n3\nPrelude&gt; gaps ('a','b') 3 \"aaaabbabb\"\n2\n</code></pre>\n"}], "owner": {"reputation": 117, "user_id": 8738654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e13a61d4627532c3fd698f64a5be7504?s=128&d=identicon&r=PG&f=1", "display_name": "Jon Harper", "link": "https://stackoverflow.com/users/8738654/jon-harper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 57820148, "answer_count": 2, "score": 2, "last_activity_date": 1567847003, "creation_date": 1567759280, "last_edit_date": 1567771518, "question_id": 57818586, "link": "https://stackoverflow.com/questions/57818586/how-to-count-number-of-times-guard-statement-happens-in-recursion", "title": "How to count number of times guard statement happens in recursion?", "body": "<p>I'm new to haskell and I got stuck in a little program I tried to make. I want to count number of times my guard statement goes through in all recursion rounds and then return that as Int. For example if <code>c1</code> is <code>'a'</code>, <code>c2</code> is <code>'b'</code>, <code>g</code> is <code>2</code> and <code>s</code> is <code>\"aaabbb\"</code> then returned int would be 2, because my guard statement is true in 2 cases.</p>\n\n<p>I tried to make variable <code>x</code> and then add <code>x + 1</code> to it every time guard statement happens. That didn't work because I learnt that in Haskell variable you set is always static so for example setting <code>x = 0</code> at start would set that <code>x</code> to 0 every recursion round.</p>\n\n<p>Here's my code:</p>\n\n<pre><code>gaps :: (Char, Char) -&gt; Int -&gt; String -&gt; Int\ngaps (c1,c2) g (s:xs)\n   | c1 == s &amp;&amp; c2 == (s:xs) !! g = --Count how many times this statement happens --\n   | otherwise =  gaps (c1,c2) g xs\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 4, "creation_date": 1567721949, "post_id": 57813570, "comment_id": 102058372, "body": "Your <code>exists</code> function only has one parameter but the type signature specifies two."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1567722090, "post_id": 57813570, "comment_id": 102058402, "body": "You also say your function &quot;takes in a tuple&quot; yet there are no tuples in sight in either the type signature or the attempted implementation. I think you are trying to find an implementation for <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:elem\" rel=\"nofollow noreferrer\">elem</a> (the function that checks if an element is in a list), which definitely doesn&#39;t involve tuples."}, {"owner": {"reputation": 173, "user_id": 4789917, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3c66188d3afe7070457570133fe7395?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/4789917/alex"}, "edited": false, "score": 0, "creation_date": 1567722611, "post_id": 57813570, "comment_id": 102058548, "body": "Thanks for pointing that out, the func definition went over my head. I made the edits above but still receiving an error &quot;cannot construct infinite type&quot;"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 5, "creation_date": 1567723076, "post_id": 57813570, "comment_id": 102058648, "body": "You call <code>existsHelper p c</code> but <code>c</code> is not a list. You are making it way more complex than you need. The helper already does all the work you want, there&#39;s no need for another function."}, {"owner": {"reputation": 173, "user_id": 4789917, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3c66188d3afe7070457570133fe7395?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/4789917/alex"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1567723786, "post_id": 57813570, "comment_id": 102058777, "body": "@chi For (c:xs), if c is a list and xs are remaining tuples, wouldn&#39;t it be needed?"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 2, "creation_date": 1567724368, "post_id": 57813570, "comment_id": 102058882, "body": "@Alex, in <code>c</code> is not (necessarily) a list there, it is just an element of type <code>t</code>. <code>xs</code> is a list, of type <code>[t]</code>. We know this because <code>(:)</code> has type signature <code>a -&gt; [a] -&gt; [a]</code> - it takes an element and a list, and returns the result of prepending that element to the list. I have no idea why you are talking about tuples again, I repeat that there are no tuples involved here at all."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1567724443, "post_id": 57813570, "comment_id": 102058895, "body": "And aside from that as @chi has already said, you&#39;ve already solved this problem because your <code>existsHelper</code> does <i>exactly</i> what you want <code>exists</code> to do - try it and you&#39;ll see."}], "answers": [{"comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1567724640, "post_id": 57813876, "comment_id": 102058933, "body": "You could also write the second line as simply <code>exists p (x:xs) = p == x || exists p xs</code>."}], "tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 4, "last_activity_date": 1567724407, "creation_date": 1567724407, "answer_id": 57813876, "question_id": 57813570, "link": "https://stackoverflow.com/questions/57813570/couldnt-match-with-expected-type/57813876#57813876", "title": "Couldn&#39;t Match with Expected Type", "body": "<p>Your exists function has type:</p>\n\n<pre><code>exists :: Eq t =&gt; t -&gt; [t] -&gt; Bool\n</code></pre>\n\n<p>this defines two arguments - an element of some type implementing the <code>Eq</code> typeclass and a list of that element (note: lists and tuples are different things. Tuples are heterogenous collections of a fixed size while lists have arbitrary length where all elements have the same type).</p>\n\n<p>Your <code>existsHelper</code> function also has this type and implements your desired behaviour so you can simply rename it:</p>\n\n<pre><code>exists :: Eq t =&gt; t -&gt; [t] -&gt; Bool\nexists p [] = False  \nexists p (x:xs) = if (p == x) then True else (exists p xs)\n</code></pre>\n"}], "owner": {"reputation": 173, "user_id": 4789917, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3c66188d3afe7070457570133fe7395?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/4789917/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 57813876, "answer_count": 1, "score": 1, "last_activity_date": 1567724592, "creation_date": 1567721716, "last_edit_date": 1567724592, "question_id": 57813570, "link": "https://stackoverflow.com/questions/57813570/couldnt-match-with-expected-type", "title": "Couldn&#39;t Match with Expected Type", "body": "<p>I am new to Haskell and learning to do some simple recursive functions.  I'm working on a function 'exists' which takes in a value and a tuple.  I'm supposed to return true if the given value is contained in the tuple. Ive looked through other problems like this but couldn't find a solution. Any help would be appreciated.</p>\n\n<p>I created a helper function <code>existsHelper</code> that takes in the value and list as parameters and recursively check if the value exists. I keep getting an error stating \"<code>Couldnt match expecting type [t] -&gt; Bool with actual type Bool</code>\".</p>\n\n<pre><code>--  exists\nexists :: Eq t =&gt; t -&gt; [t] -&gt; Bool\nexists p []     = False\nexists p (c:xs) = if existsHelper p c\n                  then True\n                  else (exists p xs) \n\n\n-- existsHelper function\nexistsHelper p []     = False  \nexistsHelper p (x:xs) = if p == x\n                        then True\n                        else existsHelper p xs\n</code></pre>\n\n<p>Some sample inputs/outputs</p>\n\n<pre><code>\u03bb&gt; exists 1 []\nfalse\n\u03bb&gt; exists 'e' \"Hello\"\ntrue\n\u03bb&gt; exists [4] [[3], [2], [4]]\ntrue\n</code></pre>\n"}, {"tags": ["haskell", "signature"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 6, "creation_date": 1567707770, "post_id": 57811060, "comment_id": 102053531, "body": "It does <code>Application</code> is a type synonym for <code>Request -&gt; (Response -&gt; IO ResponseReceived) -&gt; IO ResponseReceived</code>: <a href=\"https://hackage.haskell.org/package/wai-3.2.2.1/docs/Network-Wai.html#t:Application\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/wai-3.2.2.1/docs/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 8, "last_activity_date": 1567707951, "creation_date": 1567707951, "answer_id": 57811134, "question_id": 57811060, "link": "https://stackoverflow.com/questions/57811060/how-to-understand-haskell-function-parameters/57811134#57811134", "title": "How to understand Haskell function parameters", "body": "<p><a href=\"https://hackage.haskell.org/package/wai-3.2.2.1/docs/Network-Wai.html#t:Application\" rel=\"noreferrer\"><strong><code>Application</code></strong></a> is a type <em>synonym</em>. It is defined as:</p>\n\n<pre><code><b>type</b> Application = Request -&gt; (Response -&gt; IO ResponseReceived) -&gt; IO ResponseReceived</code></pre>\n\n<p>It is thus a function that takes a <code>Request</code>, and a function that maps an <code>Response</code> on an <code>IO ResponseReceived</code>, and then produces an <code>IO ResponseReceived</code>. Usually such functions produce a <code>Response</code> that is then post-processed by the response.</p>\n"}], "owner": {"reputation": 639, "user_id": 10654293, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-N3y4b1ilweA/AAAAAAAAAAI/AAAAAAAAAAQ/nO5VTzQiUu0/photo.jpg?sz=128", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/10654293/mcbear-holden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 57811134, "answer_count": 1, "score": 2, "last_activity_date": 1567772714, "creation_date": 1567707644, "last_edit_date": 1567772714, "question_id": 57811060, "link": "https://stackoverflow.com/questions/57811060/how-to-understand-haskell-function-parameters", "title": "How to understand Haskell function parameters", "body": "<p>In the following function definition:</p>\n\n<pre><code>app :: Application\napp _ respond = do\n    putStrLn \"I've done some IO here\"\n    respond $ responseLBS\n        status200\n        [(\"Content-Type\", \"text/plain\")]\n        \"Hello, Web!\"\n</code></pre>\n\n<p>Hello the app function doesn't seem to take arguments. Why in the above example there are two arguments?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1567699799, "post_id": 57809322, "comment_id": 102050266, "body": "That&#39;s declaration syntax, for files, not ghci."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1567701608, "post_id": 57809322, "comment_id": 102051031, "body": "You want to read the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ghci.html\" rel=\"nofollow noreferrer\">GHCi manual</a>. Also possibly upgrade your Haskell installation if it&#39;s older than version 8."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1567701658, "post_id": 57809322, "comment_id": 102051054, "body": "@melpomene isn&#39;t this supported since GHC 8 or so?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1567702122, "post_id": 57809322, "comment_id": 102051247, "body": "@n.m. not multi-line. Also, related question: <a href=\"https://stackoverflow.com/questions/18162420/cannot-enter-multiline-statements-in-ghci\" title=\"cannot enter multiline statements in ghci\">stackoverflow.com/questions/18162420/&hellip;</a>"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1567702575, "post_id": 57809322, "comment_id": 102051431, "body": "@AJFarmar <code>:set</code> +m perhaps? Note the question is from 2013."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1567703582, "post_id": 57809322, "comment_id": 102051841, "body": "Does <code>:set +m</code> let you use <code>where</code>? My (admittedly few) attempts all ended with parse errors on <code>where</code>."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1567740699, "post_id": 57809322, "comment_id": 102061739, "body": "@chepner it works but you need to put <code>where</code> on the first line: <code>foo = bar where &lt;enter&gt; bar = 42</code>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1567769512, "post_id": 57809322, "comment_id": 102072453, "body": "Ah, because you need something that a line can&#39;t otherwise end with, right?"}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1567703511, "creation_date": 1567703511, "answer_id": 57810175, "question_id": 57809322, "link": "https://stackoverflow.com/questions/57809322/how-to-fix-error-parse-error-on-input-in-haskell/57810175#57810175", "title": "How to fix &quot;error: parse error on input \u2018=\u2019&quot; in Haskell", "body": "<p>There are two intertwined issues: whether you need <code>let</code> to introduce a definition, and whether you can write a multiline definition.</p>\n\n<p>First, <code>let</code>. Prior to 8.0, GHCi required a definition be introduced with <code>let</code>:</p>\n\n<pre><code>let f (x:xs) = ...\n</code></pre>\n\n<p>Starting in 8.0, you can drop the <code>let</code>, and GHCi will figure out what you are trying to do.</p>\n\n<p>As for the multiline statement, there are two ways you can do this. One is to explicitly delimit your block with <code>:}</code> and <code>:{</code>:</p>\n\n<pre><code>Prelude&gt; :{\nPrelude| f (x:xs) = f ys ++ [x] ++ f zs\nPrelude|  where\nPrelude|  ys = [a | a &lt;- xs, a &lt;= x]\nPrelude|  zs = [b | b &lt;- xs, b &gt; x]\nPrelude| :}\n</code></pre>\n\n<p>The other, enabling multiline mode with <code>:set +m</code>, appears to be picker about what it accepts.</p>\n"}], "owner": {"reputation": 11, "user_id": 10463318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8211facc63751acf04ffefaa2351aae2?s=128&d=identicon&r=PG&f=1", "display_name": "CarryOn", "link": "https://stackoverflow.com/users/10463318/carryon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567703511, "creation_date": 1567699672, "last_edit_date": 1567699772, "question_id": 57809322, "link": "https://stackoverflow.com/questions/57809322/how-to-fix-error-parse-error-on-input-in-haskell", "title": "How to fix &quot;error: parse error on input \u2018=\u2019&quot; in Haskell", "body": "<p>I'm just trying to see if WinGHCi works for Haskell programming, and I don't know the reason why this shows the error above.</p>\n\n<p>I do not know if this is the right application to work on Haskell, if you know another one that can actually work, I would appreciate.</p>\n\n<pre><code>f (x:xs) = f ys ++ [x] ++ f zs\n where\n ys = [a | a \u2190 xs, a \u2264 x]\n zs = [b | b \u2190 xs, b &gt; x]\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>&lt;interactive&gt;:21:20: error:\n    parse error on input \u2018=\u2019\n    Perhaps you need a 'let' in a 'do' block?\n    e.g. 'let x = 5' instead of 'x = 5'\n</code></pre>\n"}, {"tags": ["haskell", "functional-dependencies", "type-families"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 11, "creation_date": 1567693242, "post_id": 57807503, "comment_id": 102046708, "body": "Yes, like you noticed, <code>I</code> and <code>J</code> are both identical to <code>Int</code> and the type system cannot, <i>should not</i> be able to distinguish them."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1567693256, "post_id": 57807503, "comment_id": 102046717, "body": "Well you do not per se need to make <i>two</i> <code>newtypes</code>. You can write <code>type I = Int</code>, <code>newtype J = J Int</code>. But you will somehow need to construct a type yes. That being said, why do you use functional dependencies in the first place if you want both <code>C Int Double</code> and <code>C Int Float</code> to exist?"}, {"owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1567693406, "post_id": 57807503, "comment_id": 102046806, "body": "@WillemVanOnsem Without the functional dependencies I get ambiguous type variables."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1567693464, "post_id": 57807503, "comment_id": 102046842, "body": "Maybe you should have only <code>b -&gt; a</code> but not <code>a -&gt; b</code>?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1567693496, "post_id": 57807503, "comment_id": 102046858, "body": "@mcmayer: well at first sight, it looks like <code>f</code> and <code>g</code> do not have much &quot;in common&quot;. So it might perhaps make more sense to define two classes <code>C1 a</code> and <code>C2 b</code>, and define <code>f</code> in <code>C1</code> and <code>g</code> in <code>C2</code>. But that might of course depend on the situation."}, {"owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1567693728, "post_id": 57807503, "comment_id": 102047009, "body": "@WillemVanOnsem I need both <code>a-&gt;b</code> and <code>b-&gt;a</code> or I get ambiguous type variables. (Just on the basis of a symmetry argument.) Splitting up the class is certainly a path forward, but in my real-world case the classes and dependencies begin to resemble a jigsaw puzzle."}, {"owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1567694054, "post_id": 57807503, "comment_id": 102047202, "body": "@leftaroundabout I need both <code>a-&gt;b</code> and <code>b-&gt;a</code> or I get ambiguous type variables. (Just on the basis of a symmetry argument.)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 4, "creation_date": 1567696859, "post_id": 57807503, "comment_id": 102048762, "body": "@mcmayer You might need to provide less of a toy class; you may have an XY problem."}], "owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1567693033, "creation_date": 1567693033, "question_id": 57807503, "link": "https://stackoverflow.com/questions/57807503/functional-dependencies-type-families-and-type-synonyms", "title": "Functional dependencies, type families, and type synonyms", "body": "<p>A simple toy class with functional dependencies, </p>\n\n<pre><code>class C a b | a -&gt; b, b -&gt; a where\n    f :: a -&gt; a\n    g :: b -&gt; b\n</code></pre>\n\n<p>is to be instantiated once with type synonym <code>I</code></p>\n\n<pre><code>type I = Int\n\ninstance C I Double where\n    f = id\n    g = id\n</code></pre>\n\n<p>and once with type synonym <code>J</code></p>\n\n<pre><code>type J = Int\n\ninstance C J Float where\n    f = id\n    g = id\n</code></pre>\n\n<p>GHC does not like this, it sees a functional dependencies conflict. <code>I</code> and <code>J</code> are considered identical, i.e. <code>Int</code>. I can sort of see why it would. On the other hand, if GHC had accepted this, I wouldn't have complained. </p>\n\n<p>Not surprisingly, the same happens with type families.</p>\n\n<p>Am I right in concluding that the only way out is to introduce wrappers like</p>\n\n<pre><code>newtype I = I Int\nnewtype J = J Int \n</code></pre>\n\n<p>or is there a way to avoid the wrapping-unwrapping?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "edited": false, "score": 0, "creation_date": 1567691276, "post_id": 57804529, "comment_id": 102045515, "body": "you could enable it in global <code>~&#47;.cabal&#47;config</code>. It seems <a href=\"https://github.com/sol/hpack\" rel=\"nofollow noreferrer\">hpack</a> doesn&#39;t support the flags yet."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "reply_to_user": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "edited": false, "score": 0, "creation_date": 1567794194, "post_id": 57804529, "comment_id": 102084065, "body": "Is it possible to do it with &quot;stack.yaml&quot; ?"}, {"owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "edited": false, "score": 0, "creation_date": 1567837468, "post_id": 57804529, "comment_id": 102091908, "body": "Probably no. Otherwise <a href=\"https://docs.haskellstack.org/en/stable/GUIDE/#dwarf\" rel=\"nofollow noreferrer\">stack&#39;s documentation</a> would mention it."}], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 39, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1567683057, "creation_date": 1567683057, "question_id": 57804529, "link": "https://stackoverflow.com/questions/57804529/how-to-include-symbolic-information-dwarf-in-binary-in-package-yaml-based-proj", "title": "How to include symbolic information (DWARF) in binary in package.yaml based project?", "body": "<p>How to enable symbolic DWARF information in binary with \"package.yaml\" file? I found <a href=\"http://docs.haskellstack.org/en/stable/GUIDE/#dwarf\" rel=\"nofollow noreferrer\">this</a> but I can not understand how to pass all those options through \"package.yaml\" file.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1567719633, "post_id": 57799777, "comment_id": 102057838, "body": "(Your <code>(&lt;+&gt;)</code> doesn&#39;t even need <code>Monoid</code>.)"}], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 12, "last_activity_date": 1567669321, "last_edit_date": 1567669321, "creation_date": 1567667245, "answer_id": 57800121, "question_id": 57799777, "link": "https://stackoverflow.com/questions/57799777/redundant-pattern-match-with-monoids/57800121#57800121", "title": "Redundant pattern match with monoids", "body": "<p><code>mempty</code> is just a variable name here. You may as well have written</p>\n\n<pre><code>x &gt;&lt; y = x\nx &gt;&lt; y = y\nx &gt;&lt; y = ...\n</code></pre>\n\n<p>Haskell does not automatically do equality tests when you introduce a new pattern with the same name as an existing binding - it just shadows the existing binding. If you want equality, you have to ask for it with <code>==</code> tests, e.g. in a guard clause.</p>\n\n<pre><code>x &gt;&lt; y\n    | x == mempty = y\n    | y == mempty = x\n    | otherwise = x &lt;&gt; \" \" &lt;&gt; y\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 4, "last_activity_date": 1567669677, "creation_date": 1567669677, "answer_id": 57800756, "question_id": 57799777, "link": "https://stackoverflow.com/questions/57799777/redundant-pattern-match-with-monoids/57800756#57800756", "title": "Redundant pattern match with monoids", "body": "<p>Your mistake is very common when you starts with pattern matching and bonded named function. When you declare functions and its equations, all things declared at the left part of the equals written in lower case are name variables, for example:</p>\n\n<pre><code> f sum x y = x (sum * y)\n</code></pre>\n\n<p>those names are confusing, because you might think that <code>sum</code> is a function, and x and y are numbers, but instead <code>x</code> is a function and <code>sum</code> and <code>y</code> are numbers, and <code>x</code> could be any function of type <code>Num a -&gt; a -&gt; a</code>. You cannot give a concrete kind of function in the left side.</p>\n\n<p>so :</p>\n\n<pre><code>(&gt;&lt;) :: (Monoid a, IsString a) =&gt; a -&gt; a -&gt; a\nx &gt;&lt; mempty = x\nmempty &gt;&lt; y = y                          -- redundant pattern match!\nx &gt;&lt; y  = x &lt;&gt; (fromString \" \") &lt;&gt; y     -- redundant pattern match!\n</code></pre>\n\n<p>there, <code>mempty</code> is just a name for you variable and not the actual <code>mempty</code> function you are trying to call. You cannot pattern match over a functions of an interface. Just over variables and data types-</p>\n"}], "owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 1, "accepted_answer_id": 57800121, "answer_count": 2, "score": 3, "last_activity_date": 1567669677, "creation_date": 1567665795, "last_edit_date": 1567666164, "question_id": 57799777, "link": "https://stackoverflow.com/questions/57799777/redundant-pattern-match-with-monoids", "title": "Redundant pattern match with monoids", "body": "<p>The following function defines a pretty-concatenation of strings., i.e. one that does not accumulate white space:</p>\n\n<pre><code>(&gt;&lt;) :: String -&gt; String -&gt; String\nx &gt;&lt; \"\" = x\n\"\" &gt;&lt; y = y\nx &gt;&lt; y  = x &lt;&gt; \" \" &lt;&gt; y\n</code></pre>\n\n<p>The following ought to be the generalisation to any <code>IsString</code> type. Type <code>a</code> needs to be in the <code>Monoid</code> class in order to concatenate with <code>mconcat</code> (= <code>&lt;&gt;</code> from <code>Semigroup</code>):</p>\n\n<pre><code>(&gt;&lt;) :: (Monoid a, IsString a) =&gt; a -&gt; a -&gt; a\nx &gt;&lt; mempty = x\nmempty &gt;&lt; y = y                          -- redundant pattern match!\nx &gt;&lt; y  = x &lt;&gt; (fromString \" \") &lt;&gt; y     -- redundant pattern match!\n</code></pre>\n\n<p>Now, strangely, GHC warns that the second and third lines are a redundant pattern match.</p>\n\n<p>This is odd. It's not even clear to me how an <code>a</code> that is <code>(Monoid a, IsString a)</code> but not <code>Eq a</code> can be used here.</p>\n\n<p>What does work, however, is this:</p>\n\n<pre><code>(&lt;+&gt;) :: (Monoid a, IsString a, Eq a) =&gt; a -&gt; a -&gt; a\nx &lt;+&gt; \"\" = x\n...\n</code></pre>\n\n<p>Can anyone shed some light on this?</p>\n"}]