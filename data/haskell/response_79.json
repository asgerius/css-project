[{"tags": ["haskell", "currying"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 2, "creation_date": 1468447069, "post_id": 38362348, "comment_id": 64137132, "body": "Applicative functors are a good example of how currying affects idiomatic Haskell. The <code>&lt;*&gt;</code> method of <code>Applicative</code> is defined on <code>f (a -&gt; b)</code>, a functor of function of one argument, but since all functions are curried, <i>all</i> functions are of one argument, so the <code>&lt;*&gt;</code> function works with functions of arbitrary arity."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 5, "creation_date": 1468447169, "post_id": 38362348, "comment_id": 64137172, "body": "What is the type of <code>flip id</code>? What does it do?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1468452547, "post_id": 38362348, "comment_id": 64138906, "body": "Perhaps the deepest understanding is required to understand crazy things like <code>printf</code>, but I would not advise you to jump straight into that sort of complexity."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1468482926, "post_id": 38362348, "comment_id": 64148164, "body": "Currying <i>looks like</i> some trivial syntax-level shortcut. But it does actually allow you to iterate over an arbitrary number of function arguments. This is how (e.g.) QuickCheck is able to test N-ary functions transparently."}], "answers": [{"comments": [{"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 0, "creation_date": 1468477522, "post_id": 38364292, "comment_id": 64145249, "body": "Great answer. The <code>map</code> example is perhaps a case where one does not really <i>need</i> to understand that currying is happening. An example where partial function application <i>does</i> require one to understand currying is e.g. <code>filter (== 5)</code> where <code>(==) :: Eq a =&gt; a -&gt; a -&gt; Bool</code>, and so <code>(==) 5 :: Eq a =&gt; a -&gt; Bool</code>, or <code>sortBy (comparing f)</code> where <code>comparing :: Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering</code>, and so <code>comparing f :: b -&gt; b -&gt; Ordering</code>, and so <code>sortBy (comparing f) :: [b] -&gt; [b]</code>."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 1, "last_activity_date": 1468461015, "creation_date": 1468461015, "answer_id": 38364292, "question_id": 38362348, "link": "https://stackoverflow.com/questions/38362348/example-of-deep-understanding-of-currying/38364292#38364292", "title": "Example of deep understanding of currying", "body": "<p>Partial function application isn't really a distinct feature of Haskell; it is just a consequence of curried functions. </p>\n\n<pre><code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]\n</code></pre>\n\n<p>In a language like Python, <code>map</code> <em>always</em> takes two arguments: a function of type <code>a -&gt; b</code> and a list of type <code>[a]</code></p>\n\n<pre><code>map(f, [x, y, z]) == [f(x), f(y), f(z)]\n</code></pre>\n\n<p>This requires you to pretend that the <code>-&gt;</code> syntax is just for show, and that the <code>-&gt;</code> between <code>(a -&gt; b)</code> and <code>[a]</code> is not really the same as the one between <code>[a] -&gt; [b]</code>. However, that is not the case; it's the <em>exact</em> same operator, and it is right-associative. The type of <code>map</code> can be explicitly parenthesized as</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; ([a] -&gt; [b])\n</code></pre>\n\n<p>and suddenly it seems much less interesting that you might give only one argument (the function) to <code>map</code> and get back a <em>new</em> function of type <code>[a] -&gt; [b]</code>. That is all partial function application is: taking advantage of the fact that all functions are curried.</p>\n\n<p>In fact, you never really give more than one argument to a function. To go along with <code>-&gt;</code> being right-associative, function <em>application</em> is <em>left</em>-associative, meaning a \"multi-argument\" call like</p>\n\n<pre><code>map f [1,2,3]\n</code></pre>\n\n<p>is really <em>two</em> function applications, which becomes clearer if we parenthesize it.</p>\n\n<pre><code>(map f) [1,2,3]\n</code></pre>\n\n<p><code>map</code> is first \"partially\" applied to one argument <code>f</code>, which returns a new function. <em>This</em> function is then applied to <code>[1,2,3]</code> to get the final result.</p>\n"}], "owner": {"reputation": 117, "user_id": 3786813, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e89832a40fc616b33de68554d4c985b8?s=128&d=identicon&r=PG&f=1", "display_name": "thepen", "link": "https://stackoverflow.com/users/3786813/thepen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 206, "favorite_count": 0, "accepted_answer_id": 38364292, "answer_count": 1, "score": 1, "last_activity_date": 1468461015, "creation_date": 1468446879, "question_id": 38362348, "link": "https://stackoverflow.com/questions/38362348/example-of-deep-understanding-of-currying", "title": "Example of deep understanding of currying", "body": "<p>Reading <a href=\"https://wiki.haskell.org/Currying\" rel=\"nofollow\">https://wiki.haskell.org/Currying</a></p>\n\n<p>it states :</p>\n\n<blockquote>\n  <p>Much of the time, currying can be ignored by the new programmer. The\n  major advantage of considering all functions as curried is\n  theoretical: formal proofs are easier when all functions are treated\n  uniformly (one argument in, one result out). Having said that, there\n  are Haskell idioms and techniques for which you need to understand\n  currying.</p>\n</blockquote>\n\n<p>What is a Haskell technique/idiom that a deeper understanding of currying is required ?</p>\n"}, {"tags": ["haskell", "tuples", "typeclass", "functor"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 4, "creation_date": 1468445522, "post_id": 38361707, "comment_id": 64136470, "body": "If you try to make an <code>instance Unzippable a1</code> you&#39;ll quickly get into overlapping instances territory which you are best off avoiding. Try making an instance for <a href=\"http://hackage.haskell.org/package/transformers-0.4.1.0/docs/Data-Functor-Identity.html\" rel=\"nofollow noreferrer\"><code>Identity</code></a> instead."}, {"owner": {"reputation": 125, "user_id": 2421116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f32a1587c6c2ee687f83d6ff29ed370f?s=128&d=identicon&r=PG", "display_name": "Iedu", "link": "https://stackoverflow.com/users/2421116/iedu"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1468447567, "post_id": 38361707, "comment_id": 64137335, "body": "@Cirdec right, are you saying that I should make <code>instance Unzippable (Identity a1)</code> with the implementation <code>unzip x = runIdentity &lt;$&gt; x</code>? In this case it seems to be working since, as you said, it does not overlap with the previous instances. Or is there another solution without the need to map <code>Identity</code> over the input?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1468452823, "post_id": 38361707, "comment_id": 64138985, "body": "Yes, I think Cirdec is saying that. It&#39;s generally unwise to try to define instances for &quot;not X&quot;, since those will overlap and behave a bit badly. If there are really only finitely many zippable types and you can describe them all in one place, you can make this work reasonably well with either overlapping instances or type family tricks, but &quot;open world&quot; overlapping is generally awful."}, {"owner": {"reputation": 125, "user_id": 2421116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f32a1587c6c2ee687f83d6ff29ed370f?s=128&d=identicon&r=PG", "display_name": "Iedu", "link": "https://stackoverflow.com/users/2421116/iedu"}, "edited": false, "score": 0, "creation_date": 1468504483, "post_id": 38361707, "comment_id": 64162578, "body": "Thank you for clearing this out for me! I guess <code>Identity</code> works as well as any other constructor available (and I have a few in my sleeve which work nicely to hide the unzipping). If you&#39;d like to write your feedback as an answer I would gratefully accept it."}], "owner": {"reputation": 125, "user_id": 2421116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f32a1587c6c2ee687f83d6ff29ed370f?s=128&d=identicon&r=PG", "display_name": "Iedu", "link": "https://stackoverflow.com/users/2421116/iedu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 88, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1468443987, "creation_date": 1468443987, "question_id": 38361707, "link": "https://stackoverflow.com/questions/38361707/instancing-tuple-and-non-tuple-under-the-same-class", "title": "Instancing tuple and non-tuple under the same class", "body": "<p>I am trying to implement an <code>Unzippable</code> class for unzipping <em>n</em>-tuples nested in <em>m</em> functors.</p>\n\n<p>This implementation behaves fine:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, FlexibleContexts #-}\n\nclass Unzippable tp where\n  unzip   :: (Functor f)\n             =&gt; f tp -&gt; Unzipped f tp\n  unzip'  :: (Functor f, Functor g, Unzippable (Unzipped g tp))\n             =&gt; f (g tp) -&gt; Unzipped f (Unzipped g tp)\n  {- unzip'' etc... -}\n  -----------------------------------\n  unzip' x = unzip (unzip &lt;$&gt; s)\n  {- implicit implementation for unzip'' etc... -}\n\n\ntype family Unzipped (f :: * -&gt; *) tp where\n  Unzipped f (a1, a2)      = (f a1, f a2)\n  Unzipped f (a1, a2, a3)  = (f a1, f a2, f a3)\n  {- ... -}\n\ninstance Unzippable (a1, a2) where\n  unzip x = (fst &lt;$&gt; x, snd &lt;$&gt; x)\n\ninstance Unzippable (a1, a2, a3) where\n  unzip x = ((\\(a,_,_) -&gt; a) &lt;$&gt; x, \n             (\\(_,a,_) -&gt; a) &lt;$&gt; x, \n             (\\(_,_,a) -&gt; a) &lt;$&gt; x)\n</code></pre>\n\n<p>Testing it does what it should:</p>\n\n<pre><code>\u03bb&gt; let x = [(1,2,3),(1,2,3)]\n\u03bb&gt; let y = [x,x,x]\n\u03bb&gt; unzip' y\n([[1,1],[1,1],[1,1]],[[2,2],[2,2],[2,2]],[[3,3],[3,3],[3,3]]) \n</code></pre>\n\n<p>My question: is it possible to implement an instance for non-tupled types for the class <code>Unzippable</code>? I am trying to hide the <em>possible</em> unzipping for some generic higher-order function interfaces, through a single function (in my case a postfix operator, e.g. <code>(-&lt;) = unzip'</code>).</p>\n\n<p>The following attempt:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, FlexibleContexts, FlexibleInstances #-}\n\ntype family Unzipped (f :: * -&gt; *) tp where\n  {- ... -}\n  Unzipped f a1 = f a1\n\ninstance Unzippable a1 where\n  unzip x = x\n</code></pre>\n\n<p>gives the error:</p>\n\n<pre><code>\u2022 Couldn't match expected type \u2018Unzipped f a1\u2019\n              with actual type \u2018f a1\u2019\n\u2022 In the expression: x\n  In an equation for \u2018unzip\u2019: unzip x = x\n  In the instance declaration for \u2018Unzippable a1\u2019\n\u2022 Relevant bindings include\n    x :: f a1 \n    unzip :: f a1 -&gt; Unzipped f a1\n</code></pre>\n"}, {"tags": ["haskell", "applicative"], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 1, "last_activity_date": 1468442892, "creation_date": 1468442892, "answer_id": 38361410, "question_id": 38361127, "link": "https://stackoverflow.com/questions/38361127/99-haskell-questions-14/38361410#38361410", "title": "99 Haskell Questions # 14", "body": "<p><code>f &lt;*&gt; v</code> isn't the same as <code>v &lt;**&gt; f</code>. We can check this with <code>Either</code>:</p>\n\n<pre><code>import Control.Applicative ((&lt;*&gt;),(&lt;**&gt;))\n\nf :: Either String (a -&gt; b)\nf = Left \"f evaluated first\"\n\nv :: Either String a\nv = Left \"v evaluated first\"\n\nshowE :: Show a =&gt; Either a b -&gt; String\nshowE (Left x)  = \"Left: \" ++ show x\nshowE (Right _) = \"Right\"\n\nprintE = putStrLn . showE\n\nmain = do\n  printE (f &lt;*&gt;  v)\n  printE (v &lt;**&gt; f)\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>Left: \"f evaluated first\"\nLeft: \"v evaluated first\"\n</code></pre>\n\n<p>Remember, <code>&lt;*&gt;</code> sequences actions.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1468447181, "last_edit_date": 1468447181, "creation_date": 1468446871, "answer_id": 38362346, "question_id": 38361127, "link": "https://stackoverflow.com/questions/38361127/99-haskell-questions-14/38362346#38362346", "title": "99 Haskell Questions # 14", "body": "<pre><code>[f, g] &lt;*&gt; [x, y]\n</code></pre>\n\n<p>is equivalent to</p>\n\n<pre><code>[ h w | h &lt;- [f, g], w &lt;- [x, y] ]\n</code></pre>\n\n<p>Hence, we get</p>\n\n<pre><code>[ f x, f y, g x, g y ]\n</code></pre>\n\n<p>By comparison</p>\n\n<pre><code>[x, y] &lt;**&gt; [f, g]\n</code></pre>\n\n<p>is equivalent to</p>\n\n<pre><code>[ h w | w &lt;- [x, y], h &lt;- [f, g] ]\n</code></pre>\n\n<p>Hence, we get</p>\n\n<pre><code>[ f x, g x, f y, g y ]\n</code></pre>\n\n<p>The posted example follows similarly.</p>\n\n<p>Remember that applicative combinators perform the effect of the first argument first. The \"effect\" here is, roughly, \"drawing an element from the list\".</p>\n"}], "owner": {"reputation": 21, "user_id": 6510445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd0c81f323e782b00f81b80695f59b96?s=128&d=identicon&r=PG", "display_name": "user348307", "link": "https://stackoverflow.com/users/6510445/user348307"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1468447181, "creation_date": 1468441682, "question_id": 38361127, "link": "https://stackoverflow.com/questions/38361127/99-haskell-questions-14", "title": "99 Haskell Questions # 14", "body": "<p>I had a question about one of the implementations of the duplicate function as described in 99 Haskell Questions (<a href=\"https://wiki.haskell.org/99_questions/Solutions/14\" rel=\"nofollow\">https://wiki.haskell.org/99_questions/Solutions/14</a>).</p>\n\n<p>One of the solutions uses the list instance of Applicative. That particular solution is</p>\n\n<pre><code>duplicate = (&lt;**&gt; [id,id])\n</code></pre>\n\n<p>I was wondering why, when I tried to implement duplicate instead as</p>\n\n<pre><code>duplicate' = ([id,id] &lt;*&gt;)\n</code></pre>\n\n<p>I get</p>\n\n<pre><code>duplicate' [1,2,3] = [1,2,3,1,2,3]\n</code></pre>\n\n<p>Instead of [1,1,2,2,3,3].</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "ghc", "haskell-src-exts"], "comments": [{"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 3, "creation_date": 1468435342, "post_id": 38359356, "comment_id": 64131262, "body": "You could pipe the preprocessor into your program."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1468440183, "post_id": 38359356, "comment_id": 64133831, "body": "What kind of result would you expect the parser to produce? The parser returns an AST, while the preprocessor works at the token level. There is no reasonable way to define an AST without running the CPP, so that e.g. only a branch in an #ifdef/#else/#endif is chosen."}, {"owner": {"reputation": 427, "user_id": 2711315, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1ffa40725d2eafd3505dbf3832ce42bf?s=128&d=identicon&r=PG", "display_name": "aesadde", "link": "https://stackoverflow.com/users/2711315/aesadde"}, "edited": false, "score": 0, "creation_date": 1468445058, "post_id": 38359356, "comment_id": 64136246, "body": "I see thanks! I added a single pass of cpphs and it seems to fix the issue!"}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 2, "last_activity_date": 1468435987, "last_edit_date": 1495535328, "creation_date": 1468435987, "answer_id": 38359591, "question_id": 38359356, "link": "https://stackoverflow.com/questions/38359356/ignore-directives-when-parsing-haskell-modules/38359591#38359591", "title": "Ignore directives when parsing haskell modules", "body": "<p>You really don't want to do that. A Haskell module written using CPP generally won't parse, let alone make any sense, if you ignore the CPP. As <a href=\"https://stackoverflow.com/questions/38359356/ignore-directives-when-parsing-haskell-modules#comment64131262_38359356\">Gurkenglas suggests</a>, the solution is to run the preprocessor before attempting to parse the file.</p>\n"}], "owner": {"reputation": 427, "user_id": 2711315, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1ffa40725d2eafd3505dbf3832ce42bf?s=128&d=identicon&r=PG", "display_name": "aesadde", "link": "https://stackoverflow.com/users/2711315/aesadde"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 38359591, "answer_count": 1, "score": -1, "last_activity_date": 1468435987, "creation_date": 1468434994, "question_id": 38359356, "link": "https://stackoverflow.com/questions/38359356/ignore-directives-when-parsing-haskell-modules", "title": "Ignore directives when parsing haskell modules", "body": "<p>I am using <code>haskell-src-exts</code> package to parse the <code>import</code> declarations inside a module, here is the code I am using</p>\n\n<pre><code>importNames :: FilePath -&gt; IO ()\nimportNames fname =  do\nlet pMode = parseMode fname\nparsed &lt;- P.parseFileWithMode pMode fname\ncase parsed of\n  P.ParseOk m -&gt; do\n    let names  = modNames m\n    putStrLn $ P.prettyPrint\n  P.ParseFailed srcLoc message -&gt; do\n    putStrLn $ unlines [P.prettyPrint srcLoc , message]\n\n-- | Extract all imports from a Module\nextractImports :: Module -&gt; [ImportDecl]\nextractImports (Module _ _ _ _ _ imports _) = imports\n\nmodNames :: Module -&gt; S.Set ModuleName\nmodNames m = foldr (\\i r -&gt; S.insert (importModule i) r) \n             S.empty $ extractImports m\n</code></pre>\n\n<p>This failes as soon as the parser hits a <code>#ifdef</code> directive.</p>\n\n<p>Is this supposed to happen, can <code>haskell-src-exts</code> ignore those and carry on?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "memory-management", "garbage-collection", "ghc"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1468422922, "post_id": 38350417, "comment_id": 64123486, "body": "The <code>ForeignPtr</code> stuff looks substantially nicer (it frees memory automatically)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1468423341, "post_id": 38350417, "comment_id": 64123801, "body": "Although I imagine that you probably can&#39;t use it for foreign pointers to foreign pointers...."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1468484944, "post_id": 38350417, "comment_id": 64149374, "body": "Indeed, <code>malloc</code> and friends require <code>Storable a</code>, so the best you can do is foreign pointers to regular pointers (for which there might be a foreign pointer floating around)."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 6, "last_activity_date": 1468434605, "last_edit_date": 1468434605, "creation_date": 1468409258, "answer_id": 38350417, "question_id": 38349273, "link": "https://stackoverflow.com/questions/38349273/where-does-ghc-allocate-foreign-memory-and-how-does-the-garbage-collector-treat/38350417#38350417", "title": "Where does GHC allocate foreign memory and how does the garbage collector treat it?", "body": "<p>The memory pointed to by <code>Ptr a</code> allocated by <code>malloc</code> lives on the heap, as in the C programming language. It is ignored by the garbage collector - you have to manually deallocate it yourself using <code>free</code>, and be careful to never use it again after that.</p>\n\n<p><code>alloca f</code> does a similar allocation, call <code>f</code> with the pointer, and free the memory after that. The pointer must not be used after <code>f</code> returns.</p>\n\n<p>These routines are not meant to be used in everyday code, but only to interface with other languages, using a C-like interface (FFI). You get precisely the same memory safety guarantees C offers -- which means practically none. As such it is quite dangerous, and should be used with great care.</p>\n\n<p>By comparison, the <code>ForeignPtr</code>-pointed memory still lives on the heap, but will be garbage collected after no more pointers (i.e. Haskell's <code>ForeignPtr a</code>) refer to the memory. Note that, even if garbage collection is used here, this kind of pointers are not risk-free. Indeed, when Haskell has no more live pointers to the memory the runtime will free it, even if that pointer is still live in the foreign language. The programmer must ensure that this will never happen.</p>\n"}, {"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 4, "last_activity_date": 1468423704, "creation_date": 1468423704, "answer_id": 38355911, "question_id": 38349273, "link": "https://stackoverflow.com/questions/38349273/where-does-ghc-allocate-foreign-memory-and-how-does-the-garbage-collector-treat/38355911#38355911", "title": "Where does GHC allocate foreign memory and how does the garbage collector treat it?", "body": "<p><code>malloc</code> calls the C <code>malloc()</code>, so it allocates memory on the C heap which you have to free manually. (You can also do that from C with <code>free()</code> if you like.)</p>\n\n<p><code>alloca</code> and <code>mallocForeignPtr</code> allocate pinned byte arrays, which live on the Haskell pinned heap. The GC will free these automatically when they're no longer needed, but will never move them (since they're pinned) so you can pass their addresses to a C function.</p>\n\n<p><code>newForeignPtr</code> doesn't seem relevant to your question.</p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user5003877"}, "is_accepted": false, "score": 1, "last_activity_date": 1468435121, "creation_date": 1468435121, "answer_id": 38359387, "question_id": 38349273, "link": "https://stackoverflow.com/questions/38349273/where-does-ghc-allocate-foreign-memory-and-how-does-the-garbage-collector-treat/38359387#38359387", "title": "Where does GHC allocate foreign memory and how does the garbage collector treat it?", "body": "<p>All allocate dynamic memory and it is on the heap. </p>\n\n<p>The odd one is <code>malloc</code>; the memory allocated by malloc needs to be EXPLICITELY deallocated.</p>\n\n<p><code>alloca</code> allocates temporary dynamic memory and passes it to a computation. the memory is automatically deallocated when computation has ended.</p>\n\n<p><code>mallocForeignPtr</code> allocates memory and returns a foreign pointer. The memory is deallocated automatically when the pointer is discarded.</p>\n\n<p><code>newForeignPtr</code> adds new reference to an existing dynamically allocated memory. The memory would be deallocated ONLY when the LAST reference to the object is being dropped.</p>\n\n<p><em>If you know C++: <code>malloc</code> is the naked <code>new</code>, <code>malloca</code> is the <code>unique_ptr/auto_ptr</code>, <code>mallocForeignPtr</code> and <code>newForeignPtr</code> are <code>shared_ptr</code>.</em></p>\n"}], "owner": {"reputation": 430, "user_id": 985170, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/98f7b1f60eb4c7ba94d1407f1104612c?s=128&d=identicon&r=PG", "display_name": "phischu", "link": "https://stackoverflow.com/users/985170/phischu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 435, "favorite_count": 1, "accepted_answer_id": 38355911, "answer_count": 3, "score": 9, "last_activity_date": 1468435121, "creation_date": 1468406197, "question_id": 38349273, "link": "https://stackoverflow.com/questions/38349273/where-does-ghc-allocate-foreign-memory-and-how-does-the-garbage-collector-treat", "title": "Where does GHC allocate foreign memory and how does the garbage collector treat it?", "body": "<p>This question is about the functions <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Foreign-Marshal-Alloc.html#v:alloca\" rel=\"noreferrer\"><code>alloca</code></a> and <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Foreign-Marshal-Alloc.html#v:malloc\" rel=\"noreferrer\"><code>malloc</code></a> from <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Foreign-Marshal-Alloc.html\" rel=\"noreferrer\"><code>Foreign.Marshal.Alloc</code></a> and <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Foreign-ForeignPtr.html#v:newForeignPtr\" rel=\"noreferrer\"><code>newForeignPtr</code></a> and <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Foreign-ForeignPtr.html#v:mallocForeignPtr\" rel=\"noreferrer\"><code>mallocForeignPtr</code></a> from <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Foreign-ForeignPtr.html\" rel=\"noreferrer\"><code>Foreign.ForeignPtr</code></a>. Where does the allocated memory live and how does the garbage collector treat it?</p>\n"}, {"tags": ["performance", "haskell", "ghc"], "comments": [{"owner": {"reputation": 2824, "user_id": 187223, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9ab705e8ee51d24c8e52192f7fde8d76?s=128&d=identicon&r=PG", "display_name": "James Brock", "link": "https://stackoverflow.com/users/187223/james-brock"}, "edited": false, "score": 0, "creation_date": 1468412666, "post_id": 38342077, "comment_id": 64115566, "body": "This may be helpful: <a href=\"http://stackoverflow.com/questions/6121146/reading-ghc-core\">stackoverflow.com/questions/6121146/reading-ghc-core</a>"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1468414081, "post_id": 38342077, "comment_id": 64116623, "body": "My <i>guess</i> is that the difference you&#39;re observing is the cost of passing the <code>Fact</code> and <code>T</code> dictionaries around"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1468430470, "post_id": 38342077, "comment_id": 64128312, "body": "@BenjaminHodgson I&#39;d really like to get specialization all the way down the stack so that there aren&#39;t any dictionaries involved once you monomorphize at the top level. Any idea how to make that happen?"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1468449217, "post_id": 38342077, "comment_id": 64137923, "body": "@Michael How do you suggest I benchmark code? Every question I&#39;ve seen on SO involving people <i>not</i> using criterion ends up with everyone talking about how it&#39;s the only way to get reliable data."}], "answers": [{"comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 1, "creation_date": 1468430199, "post_id": 38352917, "comment_id": 64128163, "body": "How is <code>bar</code> not violating the <a href=\"https://ghc.haskell.org/trac/ghc/wiki/NewtypeWrappers\" rel=\"nofollow noreferrer\">newtypes are free</a> model? I changed my GADTs to newtypes for the example precisely so that I could rule out data constructors being the issue. Since I don&#39;t have newtypes in my real code, I can&#39;t use <code>coerce</code>."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1468430307, "post_id": 38352917, "comment_id": 64128220, "body": "As for <code>INLINE</code>/<code>INLINABLE</code>, neither seem to help in my real code. It&#39;s very difficult to make an example small enough to get input on, but large enough that solutions still apply. Similarly with <code>GHC.Magic.inline</code> (which sounds great!), I only managed to slow my program down. I really do appreciate your effort though, and I&#39;ll continue to play around with the ideas."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1468435161, "post_id": 38352917, "comment_id": 64131154, "body": "I&#39;m also interested if you looked at the core for a diagnosis, or if you only looked at it as a confirmation of the solution. I really just want to understand how you approached the problem."}, {"owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 1, "creation_date": 1468439960, "post_id": 38352917, "comment_id": 64133713, "body": "Honestly I just tried out different things. I tried <code>GHC.Magic.inline</code> first so I knew it was in inlining problem. I did try to look at the core but I only understand the basics. I think by writing <code>bar (Bar v) = Bar $ t v</code> you change <code>bar</code>s airity so <code>bar</code> won&#39;t willingly inline unless it&#39;s directly applied to a <code>Bar</code> (which it isn&#39;t in the benchmark)."}], "tags": [], "owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "is_accepted": true, "score": 6, "last_activity_date": 1468415917, "creation_date": 1468415917, "answer_id": 38352917, "question_id": 38342077, "link": "https://stackoverflow.com/questions/38342077/haskell-performance-by-example/38352917#38352917", "title": "Haskell Performance by Example", "body": "<p>First, looking at <code>bar</code>:</p>\n\n<pre><code>bar :: (Fact m, T t) =&gt; Bar t m -&gt; Bar t m\nbar (Bar v) = Bar $ t v\n</code></pre>\n\n<p>we can write this without needing the argument using <code>coerce</code>:</p>\n\n<pre><code>bar :: (Fact m, T t) =&gt; Bar t m -&gt; Bar t m\nbar = (coerce :: (t m -&gt; t m) -&gt; Bar t m -&gt; Bar t m) t\n</code></pre>\n\n<p>this (as we'd hope) gets <code>bar</code> performing the same as <code>t</code>. (In fact the core for <code>TBench</code> and <code>BarBench</code> is exactly the same, excluding type signatures).</p>\n\n<p>I'm not entirely sure why, but using <code>INLINE</code> instead of <code>INLINEABLE</code> makes <code>t</code> and <code>bar</code> perform the same as <code>foo</code>. I'm not an expert but it's normally better to use <code>INLINE</code> for small functions that you're sure you want to inline.</p>\n\n<p>That said I think some of these issues are from how criterion does benchmarks to stop <code>ghc</code> cheating. For instance, writing <code>bench \"Bar\" $ nf (GHC.Magic.inline bar) x</code> on your original code has <code>bar</code> performing the same as <code>foo</code>. I suspect a \"real\" program wouldn't be so delicate.</p>\n"}], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 248, "favorite_count": 2, "accepted_answer_id": 38352917, "answer_count": 1, "score": 12, "last_activity_date": 1468415917, "creation_date": 1468379569, "last_edit_date": 1468386982, "question_id": 38342077, "link": "https://stackoverflow.com/questions/38342077/haskell-performance-by-example", "title": "Haskell Performance by Example", "body": "<p>I have these basic types in my code:</p>\n\n<pre><code>newtype Foo (m :: Factored) = Foo Int64 deriving (NFData)\n\nfoo :: forall m . (Fact m) =&gt; Foo m -&gt; Foo m\n\nclass T t where t :: (Fact m ) =&gt; t m -&gt; t m\n\ninstance T Foo where t = foo\n\nnewtype Bar t (m :: Factored) = Bar (t m) deriving (NFData)\n\nbar :: (Fact m, T t) =&gt; Bar t m -&gt; Bar t m\nbar (Bar v) = Bar $ t v\n</code></pre>\n\n<p>(ignore <code>Fact</code> and <code>Factored</code> for the moment). I'm benchmarking the code at different levels, comparing the performance of <code>foo</code>, <code>t</code>, and <code>bar</code>. In the benchmarks, <code>t = foo</code>, and <code>bar</code> just applies <code>t</code> through a <code>newtype</code>. Thus their runtime should be essentially identical, but <a href=\"https://hackage.haskell.org/package/criterion\">criterion</a> reports that <code>foo</code> takes 9.2ns, <code>t</code> takes about twice that at 17.45ns, and <code>bar</code> takes a whopping 268.1ns. </p>\n\n<p>I've experimented with adding <code>INLINABLE</code> and even a <code>SPECIALIZE</code> pragma, but they aren't helping. I want to believe that GHC has some magic syntax/optimization/etc that can be <em>consistently</em> applied to solve these types of performance issues. For example, I've seen cases where writing code in point-free style has dramatic performance implications. </p>\n\n<p>The complete code can be found <a href=\"https://github.com/crockeea/HaskellPerfTest\">here</a>. I promise it's not intimidating. The modules are:</p>\n\n<ul>\n<li>Foo: defines <code>Foo</code>, <code>foo</code>, and <code>T</code></li>\n<li>Bar: defines <code>Bar</code> and <code>bar</code></li>\n<li>FooBench: defines a benchmark for <code>foo</code></li>\n<li>TBench: defines a benchmark for <code>t</code></li>\n<li>BarBench: defines a benchmark for <code>bar</code></li>\n<li>Main: runs the three benchmarks</li>\n<li>Factored: defines <code>Fact</code> and <code>Factored</code> using <a href=\"https://hackage.haskell.org/package/singletons\">singletons</a></li>\n</ul>\n\n<p>Most of the modules are tiny; I defined the three benchmarks in separate files so that I could examine their core. I generated the core for the three <code>*Bench</code> modules and aligned them the best I could. They're only ~250 lines each, and the first ~200 lines are identical, up to renaming. The problem is that I don't know what to make of the last 50 or so lines. The (core) diff for <code>FooBench</code> vs <code>TBench</code> is <a href=\"https://www.diffchecker.com/zmemsr6n\">here</a>, the diff for <code>TBench</code> vs <code>BarBench</code> is <a href=\"https://www.diffchecker.com/lelh4hfj\">here</a>, and the diff for <code>FooBench</code> vs <code>BarBench</code> is <a href=\"https://www.diffchecker.com/hzrziczu\">here</a>.</p>\n\n<p>Just a few of the questions I have:</p>\n\n<ol>\n<li><p>At a high level, what is the essential difference between the core files? I'm looking for something like \"<em>Here</em> you can see that GHC isn't inlining the call to <code>x</code>.\" What should I be looking for?</p></li>\n<li><p>What can be done to make the three benchmarks all run in about 9.2ns? GHC optimizations? <code>INLINE</code>/<code>INLINABLE</code> pragmas? <code>SPECIALIZE</code> pragmas that I missed? (You aren't allowed to specialized for <code>F128::Factored</code>; in my real library this value may be reified at runtime.) Restricting/delaying inlining to a particular phase?</p></li>\n</ol>\n\n<p>Although I'm looking for an actual solution to make the benchmarks all fast, it's possible that tricks that work for this example won't scale to my real library. As a result, I'm also looking for the \"high-level\" explanation of why a particular technique should work.</p>\n"}, {"tags": ["haskell", "command-line-arguments", "wxwidgets", "wxhaskell"], "comments": [{"owner": {"reputation": 143, "user_id": 1349009, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a66ed646c275b138525a8bbf4476041?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/1349009/ben"}, "edited": false, "score": 0, "creation_date": 1468393259, "post_id": 38341809, "comment_id": 64102758, "body": "It looks like the function in <a href=\"http://hackage.haskell.org/package/wxcore-0.92.2.0/docs/src/Graphics-UI-WXCore-Events.html\" rel=\"nofollow noreferrer\">Graphics.UI.WXCore.Events</a> &#39;appOnInit&#39;, which is called indirectly by WX&#39;s &#39;start&#39;, passes the argv onto the C code initializing the WX process. I&#39;ve rewritten my own &#39;start&#39;, &#39;run&#39; and &#39;appOnInit&#39; to circumvent this, as per <a href=\"http://hackage.haskell.org/package/wxcore-0.92.2.0/docs/src/Graphics-UI-WXCore-Events.html\" rel=\"nofollow noreferrer\">here</a>, to control what is being passed to WX, but it still doesn&#39;t work (even passing [] to this function still results in WX incorrectly receiving my argv)"}, {"owner": {"reputation": 143, "user_id": 1349009, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a66ed646c275b138525a8bbf4476041?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/1349009/ben"}, "edited": false, "score": 0, "creation_date": 1468393573, "post_id": 38341809, "comment_id": 64102965, "body": "My intuition now tells me that what would be needed would be to somehow nullify the argv array <i>after</i> my Haskell program has extracted what data it needs from the args, but <i>before</i> any WX functions are called, though I have no idea how to do this. I assume an external C function that had access to argv[] would be able to set all of the *argv pointers to NULL, tricking WX into thinking there were no command line arguments passed, but this is a bit beyond the scope of my knowledge."}], "answers": [{"comments": [{"owner": {"reputation": 143, "user_id": 1349009, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a66ed646c275b138525a8bbf4476041?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/1349009/ben"}, "edited": false, "score": 0, "creation_date": 1468453718, "post_id": 38349419, "comment_id": 64139190, "body": "Thank, I tried this but I&#39;m still getting a popup error window complaining about the unrecognized &#39;gui&#39; parameter in the second case. As mentioned above, I&#39;ve gone as far as rewriting the WX libraries&#39; &#39;start&#39;, &#39;gui&#39;, and &#39;appOnInit&#39; to ensure that no args are passed to wxcAppInitializeC downstream in the WX initialization code, but still get this error. My guess is that whatever code is being run downstream still has access to the original argc/argv memory locations and is using them in spite of not being passed any args directly by the Haskell code."}, {"owner": {"reputation": 143, "user_id": 1349009, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a66ed646c275b138525a8bbf4476041?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/1349009/ben"}, "edited": false, "score": 0, "creation_date": 1468455073, "post_id": 38349419, "comment_id": 64139484, "body": "Could you tell me, @phischu , which version of the wx Haskell libs you were using when you had this problem? I&#39;m using 0.92.2.0 currently."}, {"owner": {"reputation": 430, "user_id": 985170, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/98f7b1f60eb4c7ba94d1407f1104612c?s=128&d=identicon&r=PG", "display_name": "phischu", "link": "https://stackoverflow.com/users/985170/phischu"}, "reply_to_user": {"reputation": 143, "user_id": 1349009, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a66ed646c275b138525a8bbf4476041?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/1349009/ben"}, "edited": false, "score": 0, "creation_date": 1468494136, "post_id": 38349419, "comment_id": 64155363, "body": "I am using wx-0.92.1.0."}], "tags": [], "owner": {"reputation": 430, "user_id": 985170, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/98f7b1f60eb4c7ba94d1407f1104612c?s=128&d=identicon&r=PG", "display_name": "phischu", "link": "https://stackoverflow.com/users/985170/phischu"}, "is_accepted": false, "score": 4, "last_activity_date": 1468406600, "creation_date": 1468406600, "answer_id": 38349419, "question_id": 38341809, "link": "https://stackoverflow.com/questions/38341809/wxhaskell-breaks-command-line-arg-functionality/38349419#38349419", "title": "WxHaskell breaks command line arg functionality", "body": "<p>I have experienced the same problem. My workaround was to use <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/System-Environment.html#v:withArgs\" rel=\"nofollow\"><code>withArgs</code></a> to start the GUI without any command line arguments like so:</p>\n\n<pre><code>main = do\n  a &lt;- getArgs\n  case a of\n    (\"terminal\"):_ -&gt; terminal\n    (\"gui\"):_ -&gt; withArgs [] (start gui)\n    _ -&gt; withArgs [] (start gui)\n</code></pre>\n"}], "owner": {"reputation": 143, "user_id": 1349009, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a66ed646c275b138525a8bbf4476041?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/1349009/ben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1468406600, "creation_date": 1468377709, "question_id": 38341809, "link": "https://stackoverflow.com/questions/38341809/wxhaskell-breaks-command-line-arg-functionality", "title": "WxHaskell breaks command line arg functionality", "body": "<p>I've written a program in WXHaskell, and verified that it works. Long story short, I planned for the program to be usable via GUI or by command line interface. I later went on to add command line argument processing with the GetOpts library and began testing that the various arguments worked as intended.</p>\n\n<p>However, once I began running the program with command line options, the program began failing: any time the program was invoked in GUI mode (i.e. running WXHaskell) the program crashed with a warning about unrecognized command line options (this warning was in the form of a WXwidgets popup window). Anytime the program was run in terminal mode, all the options were processed correctly, so my suspicion is that running WX computations causes the \"ARGV\" values to be passed to some WX function down the line, and of course since these args are intended for the main program body, they will be unrecognized.</p>\n\n<p>I've written a small test-case that reproduces this behavior (without GetOpts). </p>\n\n<pre><code>import Graphics.UI.WX\nimport System.Environment (getArgs)\n\ngui = do\n  fr &lt;- frame [text := \"GUI calculation\"]\n  t &lt;- staticText fr [text := \"Enter a number below\"]\n  n &lt;- entry fr []\n  let foo = do\n        v &lt;- read &lt;$&gt; get n text\n        set t [text := \"Your number * 3 is \" ++ show (v * 3 :: Int) ]\n  b &lt;- button fr [text := \"Calculate\", on command := foo]\n  set fr [layout := column 3 [widget t, widget n, widget b] ]\n\nterminal = do\n  putStrLn \"Enter a number\"\n  v &lt;- read &lt;$&gt; getLine\n  putStrLn $ \"Your number * 3 is \" ++ (show $ v * 3)\n\nmain = do\n  a &lt;- getArgs\n  case a of\n    (\"terminal\"):_ -&gt; terminal\n    (\"gui\"):_ -&gt; start gui\n    _ -&gt; start gui\n</code></pre>\n\n<p>Command line args are processed, and the computation (simply multiplying a user-specified Int by 3) is run either on the terminal or through a gui.</p>\n\n<p>If the user specifies \"terminal\", the program completes without problem. If the user specifies no args the computation is run in gui mode by default, and also completes normally.</p>\n\n<p>If the user specifies the \"gui\" argument, the program crashes with an error (in a popup window): \"Unexpected parameter 'gui'\".</p>\n\n<p>If anyone has any idea why my args are apparently being passed on to subsequent operations, or better yet, how to stop this from happening, I'd be very happy!</p>\n"}, {"tags": ["haskell", "google-oauth", "yesod"], "comments": [{"owner": {"reputation": 2430, "user_id": 1525842, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/95abedfeb09f68271233421d1aafb3be?s=128&d=identicon&r=PG", "display_name": "zeronone", "link": "https://stackoverflow.com/users/1525842/zeronone"}, "edited": false, "score": 0, "creation_date": 1468421417, "post_id": 38341743, "comment_id": 64122340, "body": "Looking at the source code, it seems it is not storing <code>refresh_token</code> in both cases."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 2430, "user_id": 1525842, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/95abedfeb09f68271233421d1aafb3be?s=128&d=identicon&r=PG", "display_name": "zeronone", "link": "https://stackoverflow.com/users/1525842/zeronone"}, "edited": false, "score": 0, "creation_date": 1468427263, "post_id": 38341743, "comment_id": 64126443, "body": "That was my analysis as well. However, I&#39;m not really interested in storing the tokens in the session cookie. I need to access them to store them in the DB, <b>especially</b> the <code>refresh_token</code>"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1468377128, "creation_date": 1468377128, "question_id": 38341743, "link": "https://stackoverflow.com/questions/38341743/how-to-access-google-oauth-refreshtoken-and-accesstoken-without-saving-them-in-s", "title": "How to access Google OAuth RefreshToken and AccessToken without saving them in session cookie?", "body": "<p>In Yesod, how does one get access to, both, the Google OAuth access token and refresh token without storing them in the session cookie (as it is mentioned here -- <a href=\"https://www.stackage.org/haddock/lts-6.7/yesod-auth-1.4.13.3/Yesod-Auth-GoogleEmail2.html#g:2\" rel=\"nofollow\">https://www.stackage.org/haddock/lts-6.7/yesod-auth-1.4.13.3/Yesod-Auth-GoogleEmail2.html#g:2</a> )</p>\n\n<p>If I'm using <code>authGoogleEmail</code> instead of <code>authGoogleEmailSaveToken</code>, how can I access the access AND refresh token?</p>\n"}, {"tags": ["haskell", "math", "crc"], "comments": [{"owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "edited": false, "score": 0, "creation_date": 1468373366, "post_id": 38341117, "comment_id": 64096697, "body": "<a href=\"https://wiki.haskell.org/Power_function\" rel=\"nofollow noreferrer\">wiki.haskell.org/Power_function</a>"}, {"owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "reply_to_user": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "edited": false, "score": 0, "creation_date": 1468373502, "post_id": 38341117, "comment_id": 64096734, "body": "@Mika&#39;il As I said, wouldn&#39;t <code>0^n = 0</code> ? Makes no sense."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 9, "last_activity_date": 1468379236, "creation_date": 1468379236, "answer_id": 38342024, "question_id": 38341117, "link": "https://stackoverflow.com/questions/38341117/on-this-kmett-crc-article-why-does-ab-a0n-0m-b-what-does-this-notation-m/38342024#38342024", "title": "On this Kmett CRC article, why does ab = a0^n + 0^m b? What does this notation mean?", "body": "<p>He's using a notation for bit strings. Here <em>a</em> and <em>b</em> are bit strings of length <em>m</em> and <em>n</em> respectively.</p>\n\n<pre><code>ab    =  a concatenated with b\n0^n   =  the bit string of length n consisting of all 0s\na0^n  =  a concatenated with 0^n\n0^m b = 0^m concatenated with b\na0^n + 0^m b  = sum of a0^n and 0^m b (same as the bitwise OR in this case)\n              = a concatenated with b\n</code></pre>\n"}], "owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 1, "accepted_answer_id": 38342024, "answer_count": 1, "score": 8, "last_activity_date": 1468379236, "creation_date": 1468372134, "question_id": 38341117, "link": "https://stackoverflow.com/questions/38341117/on-this-kmett-crc-article-why-does-ab-a0n-0m-b-what-does-this-notation-m", "title": "On this Kmett CRC article, why does ab = a0^n + 0^m b? What does this notation mean?", "body": "<p>In <a href=\"https://www.schoolofhaskell.com/user/edwardk/parallel-crc#exploiting-weakness\" rel=\"noreferrer\">Edward Kmett's article on CRCs</a> it has the following derivation:</p>\n\n<pre><code>CRC(ab) =                               -- definition of CRC\ncrc(INIT,ab) + FINAL =                  -- linearity\ncrc(INIT,a0^n + 0^m b) + FINAL =        -- additive homomorphism\ncrc(INIT,a0^n) + crc(0,0^nb) + FINAL =  -- zero blindness \ncrc(INIT,a0^n) + crc(0,b) + FINAL       -- definition of crc\ncrc(crc(INIT,a),0^n) + crc(0,b) + FINAL -- additive homomorphism\ncrc(crc(INIT,0^m)+crc(0,a),0^n) + crc(0,b) + FINAL\n</code></pre>\n\n<p>What in the world is <code>a0^n</code> and <code>0^m b</code>? Are these powers, like <code>a * pow(0, n)</code>? If so, wouldn't 0^n = 0? Or XOR? Something else entirely? Is the space significant? I am not understanding why, for example:</p>\n\n<pre><code>ab = a0^n + 0^m b\n</code></pre>\n\n<p>and why <code>0^m b</code> became <code>0^nb</code> between the third and fourth lines? </p>\n"}, {"tags": ["haskell", "monads", "conduit"], "comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1468370145, "post_id": 38340604, "comment_id": 64096013, "body": "This type checks for me  <a href=\"http://lpaste.net/169714\" rel=\"nofollow noreferrer\">lpaste.net/169714</a> Could it be something about the imports?"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1468370260, "post_id": 38340604, "comment_id": 64096049, "body": "Note by the way that you probably intend for the <code>log</code> pipe to continue after the first item it hits. As it is only one item can pass. So you should loop recursively, or use <code>awaitForever</code> or the like."}], "answers": [{"comments": [{"owner": {"reputation": 137, "user_id": 6347234, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1c5fa9b06d9a75bead47c20bac81cff?s=128&d=identicon&r=PG&f=1", "display_name": "And Pos", "link": "https://stackoverflow.com/users/6347234/and-pos"}, "edited": false, "score": 0, "creation_date": 1468372171, "post_id": 38341015, "comment_id": 64096494, "body": "Thanks @ErikR your answer nailed it.  I&#39;d appreciate if you could explain how to deduce the type signature from the error message."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1468378601, "last_edit_date": 1468378601, "creation_date": 1468371088, "answer_id": 38341015, "question_id": 38340604, "link": "https://stackoverflow.com/questions/38340604/using-the-writer-monad-with-conduit-in-haskell/38341015#38341015", "title": "Using the Writer monad with Conduit in Haskell", "body": "<p>Here's what works for me:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n\nimport Data.Conduit\nimport Control.Monad.Writer\nimport qualified Data.Conduit.List as CL\n\ndoit :: MonadWriter [i] m =&gt; Conduit i m i\ndoit = do\n  x &lt;- await\n  case x of\n    Nothing -&gt; return ()\n    Just v  -&gt; do tell [v]; yield v; doit\n\nfoo = runWriter $ CL.sourceList [\"a\", \"b\", \"c\"] =$= doit $$ CL.consume\n</code></pre>\n\n<p>Note I changed the name from <code>log</code> to <code>doit</code> to avoid the name clash with <code>Prelude.log</code>.</p>\n\n<p><strong>Update</strong></p>\n\n<p>If you start with:</p>\n\n<pre><code>import Data.Conduit\nimport Control.Monad.Writer\nimport qualified Data.Conduit.List as CL\n\ndoit = do\n  x &lt;- await\n  case x of\n    Nothing -&gt; return ()\n    Just v -&gt; do tell [v]; yield v; doit\n</code></pre>\n\n<p>you will get two errors:</p>\n\n<pre><code>No instance for (Monad m0) arising from a use of \u2018await\u2019\n...\n\nNo instance for (MonadWriter [o0] m0) arising from a use of \u2018tell\u2019\n...\n</code></pre>\n\n<p>Since <code>doit</code> is a top-level function, experience will tell you\nthat perhaps the monomorphism restriction is at work here.\nIndeed, after adding:</p>\n\n<pre><code>{-# LANGUAGE NoMonomorphismRestriction #-}\n</code></pre>\n\n<p>you only get one error:</p>\n\n<pre><code>Non type-variable argument in the constraint: MonadWriter [o] m\n(Use FlexibleContexts to permit this)\n...\n</code></pre>\n\n<p>And after adding <code>FlexibleContexts</code>, the code compiles.</p>\n\n<p>Now you can interrogate the type of <code>doit</code>:</p>\n\n<pre><code>ghci&gt; :t doit\ndoit :: MonadWriter [o] m =&gt; ConduitM o o m ()\n</code></pre>\n"}], "owner": {"reputation": 137, "user_id": 6347234, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1c5fa9b06d9a75bead47c20bac81cff?s=128&d=identicon&r=PG&f=1", "display_name": "And Pos", "link": "https://stackoverflow.com/users/6347234/and-pos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 38341015, "answer_count": 1, "score": 2, "last_activity_date": 1468378601, "creation_date": 1468367821, "question_id": 38340604, "link": "https://stackoverflow.com/questions/38340604/using-the-writer-monad-with-conduit-in-haskell", "title": "Using the Writer monad with Conduit in Haskell", "body": "<p>As an exercise for learning Haskell, Conduit and Monads, I want to create a conduit that <em>tells</em> the input value and passes it through.</p>\n\n<p>Code is pretty simple, but I'm getting compilation errors that are still cryptic for me:</p>\n\n<pre><code> log =\n    await &gt;&gt;= \\case\n      Nothing -&gt; return ()\n      Just value -&gt; do\n        tell [value]\n        yield value\n\n runWriter $ CL.sourceList [\"a\", \"b\"] $= log $$ CL.consume\n</code></pre>\n\n<p>And the error:</p>\n\n<pre><code> No instance for (MonadWriter [o0] m0) arising from a use of \u2018tell\u2019\n The type variables \u2018m0\u2019, \u2018o0\u2019 are ambiguous\n Relevant bindings include\n   value :: o0\n     (bound at /home/vagrant/workspace/dup/app/Main.hs:241:10)\n   logg :: ConduitM o0 o0 m0 ()\n     (bound at /home/vagrant/workspace/dup/app/Main.hs:238:1)\n Note: there are several potential instances:\n   instance MonadWriter w m =&gt; MonadWriter w (ConduitM i o m)\n     -- Defined in \u2018conduit-1.2.6.4:Data.Conduit.Internal.Conduit\u2019\n   instance MonadWriter w m =&gt;\n            MonadWriter\n              w (conduit-1.2.6.4:Data.Conduit.Internal.Pipe.Pipe l i o u m)\n     -- Defined in \u2018conduit-1.2.6.4:Data.Conduit.Internal.Pipe\u2019\n   instance [safe] MonadWriter w m =&gt;\n                   MonadWriter w  (Control.Monad.Trans.Resource.Internal.ResourceT m)\n     -- Defined in \u2018Control.Monad.Trans.Resource.Internal\u2019\n   ...plus 11 others\n In a stmt of a 'do' block: tell [value]\n In the expression:\n  do { tell [value];\n       yield value }\n In a case alternative:\n    Just value\n      -&gt; do { tell [value];\n              yield value }\n</code></pre>\n"}, {"tags": ["haskell", "haskell-lens"], "answers": [{"comments": [{"owner": {"reputation": 2588, "user_id": 298736, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb2a346fde4e2c5dc426aa702d181443?s=128&d=identicon&r=PG", "display_name": "Peter Milley", "link": "https://stackoverflow.com/users/298736/peter-milley"}, "edited": false, "score": 0, "creation_date": 1468366491, "post_id": 38340312, "comment_id": 64095222, "body": "Ah, that&#39;s what &quot;reified&quot; folds are for! Thanks!"}], "tags": [], "owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "is_accepted": true, "score": 4, "last_activity_date": 1468366709, "last_edit_date": 1468366709, "creation_date": 1468365628, "answer_id": 38340312, "question_id": 38340097, "link": "https://stackoverflow.com/questions/38340097/how-can-i-make-fold-s-a-from-control-lens-a-monoid/38340312#38340312", "title": "How can I make (Fold s a) from Control.Lens a monoid?", "body": "<p>If you look at the <code>Fold</code> signature:</p>\n\n<pre><code>type Fold s a = forall f. (Contravariant f, Applicative f)=&gt; (a -&gt; f a) -&gt; s -&gt; f s\n</code></pre>\n\n<p>it says it has to work for <strong>all</strong> <code>f</code> that are <code>Contravariant</code> and <code>Applicative</code>. When you combine two folds together using <code>&lt;&gt;</code>, the <code>Semigroup</code> instance for functions <code>instance Semigroup b =&gt; Semigroup (a -&gt; b)</code> requires that <code>f s</code> is <code>Semigroup</code>. That means it will no longer type check as a <code>Fold</code>. However, most (all?) functions that take a fold in <code>lens</code> will still accept this because they take a <code>Getting r s a = (a -&gt; Const r a) -&gt; s -&gt; Const r s</code>, which this will type check for. </p>\n\n<p>There's a couple of things you can do. You could use the <a href=\"http://hackage.haskell.org/package/lens-4.14/docs/Control-Lens-Reified.html#t:ReifiedFold\" rel=\"nofollow\"><code>Fold</code></a> newtype which has its own <code>Monoid</code> instance:</p>\n\n<pre><code>&gt; :set -XTemplateHaskell\n&gt; import Control.Lens\n&gt; import Data.Semigroup\n&gt; data Suit = Spade | Heart | Diamond | Club; makePrisms ''Suit\n&gt; let blackSuitsFold = runFold $ Fold _Spade &lt;&gt; Fold _Club :: Fold Suit ()\n</code></pre>\n\n<p>Or you could \"clone\" the fold:</p>\n\n<pre><code>&gt; let cloneFold = foldring . foldrOf\n&gt; let blackSuitsClone = cloneFold $ _Spade &lt;&gt; _Club :: Fold Suit ()\n</code></pre>\n\n<p>or, if you don't need it to be a <code>Fold</code> you can use <code>Getting</code> synonym which would work the same in most cases:</p>\n\n<pre><code>&gt; let blackSuitsGetter = _Spade `mappend` _Club :: Monoid r =&gt; Getting r Suit ()\n&gt; has blackSuitsGetter Spade\nTrue\n</code></pre>\n"}], "owner": {"reputation": 2588, "user_id": 298736, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb2a346fde4e2c5dc426aa702d181443?s=128&d=identicon&r=PG", "display_name": "Peter Milley", "link": "https://stackoverflow.com/users/298736/peter-milley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 1, "accepted_answer_id": 38340312, "answer_count": 1, "score": 2, "last_activity_date": 1468366709, "creation_date": 1468364041, "question_id": 38340097, "link": "https://stackoverflow.com/questions/38340097/how-can-i-make-fold-s-a-from-control-lens-a-monoid", "title": "How can I make (Fold s a) from Control.Lens a monoid?", "body": "<p>I'm fooling around with lenses and prisms and I've gotten into the weeds a bit. I want to write the following in template Haskell but as is it doesn't compile:</p>\n\n<pre><code>data Suit = Spade | Heart | Diamond | Club\nmakePrisms ''Suit\nblackSuits = _Spade &lt;&gt; _Club\n</code></pre>\n\n<p>Everything I know about lenses and prisms (as well as comments in the <code>Getter</code> documentation) suggests that <code>_Spade &lt;&gt; _Club</code> should be a valid <code>Fold Suit ()</code>. But ghc can't compile the above code; it complains about several ambiguous instances. ghci gives me the following type signature for <code>_Spade &lt;&gt; _Club</code>:</p>\n\n<pre><code>_Spade &lt;&gt; _Club\n  :: (Applicative f, Monoid (p Suit (f Suit)), Choice p) =&gt;\n     p () (f ()) -&gt; p Suit (f Suit)\n</code></pre>\n\n<p>And by replacing <code>p</code> with <code>(-&gt;)</code> I can relax that type to</p>\n\n<pre><code>(Applicative f, Monoid (f Suit)) =&gt; (() -&gt; f ()) -&gt; Suit -&gt; f Suit\n</code></pre>\n\n<p>The only difference between that and <code>Fold Suit ()</code> is that the latter has <code>(Applicative f, Contravariant f) =&gt; ...</code> instead of the <code>Monoid (f Suit)</code> restriction. When I read up on <code>Contravariant</code> I see assertions that <code>(Applicative f, Contravariant f)</code> together imply that <code>f</code> is actually <code>Const r</code> for some monoid <code>r</code>. That seems to suggest that the type above is actually a subset of <code>Fold Suit ()</code>. But when I try to add <code>blackSuits :: Fold Suit ()</code> to my code I get</p>\n\n<pre><code>Could not deduce (Monoid (f Suit)) arising from a use of \u2018&lt;&gt;\u2019\nfrom the context (Contravariant f, Applicative f) ...\n</code></pre>\n\n<p>I get similar errors if I just try to define monoids on folds instead of starting with prisms. Nothing I've done to try and make <code>Fold s a</code> a <code>Monoid</code> passes the compiler. Is there any way to make this work?</p>\n"}, {"tags": ["haskell", "show", "pretty-print", "ghci"], "answers": [{"tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 11, "last_activity_date": 1468359532, "creation_date": 1468359532, "answer_id": 38339303, "question_id": 38339190, "link": "https://stackoverflow.com/questions/38339190/pretty-printing-in-ghci/38339303#38339303", "title": "Pretty-printing in ghci", "body": "<p>You can specify a custom pretty-printing function using the <code>--interactive-print</code> flag and naming any function in scope with the type <code>C a =&gt; a -&gt; IO ()</code> for any constraint <code>C</code>. (See <a href=\"https://downloads.haskell.org/~ghc/7.8.4/docs/html/users_guide/interactive-evaluation.html#ghci-interactive-print\">Section 2.4.9</a> of the docs for details.)</p>\n\n<pre><code>ghci --interactive-print=MyModule.prettyPrint\n</code></pre>\n\n<p>This means you can specify your own function from your own typeclass. There's no way to do this just for a specific type, but your custom class can always include a fallback instance like</p>\n\n<pre><code>instance Show a =&gt; PrettyPrint a where prettyPrint = show\n</code></pre>\n\n<p>This will require at least <code>OverlappingInstances</code> to work.</p>\n"}], "owner": {"reputation": 437, "user_id": 6534153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/65594d05af54fa0c3797bee8aa4a811a?s=128&d=identicon&r=PG&f=1", "display_name": "lanskey", "link": "https://stackoverflow.com/users/6534153/lanskey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 796, "favorite_count": 2, "accepted_answer_id": 38339303, "answer_count": 1, "score": 11, "last_activity_date": 1468359532, "creation_date": 1468358944, "question_id": 38339190, "link": "https://stackoverflow.com/questions/38339190/pretty-printing-in-ghci", "title": "Pretty-printing in ghci", "body": "<p>Is there a way to make ghci use a custom pretty-printing function instead of show for certain types? A more general question: what are the general guidelines to make a library as usable as possible in interactive mode? Thanks.</p>\n"}, {"tags": ["haskell", "hackage"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1468355293, "post_id": 38337927, "comment_id": 64090880, "body": "File a feature request ticket on the GHC Trac. <code>Data.Bool</code> is extremely stable."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 3, "creation_date": 1468355390, "post_id": 38337927, "comment_id": 64090947, "body": "For this kind of of question I would ask <a href=\"http://reddit.com/r/haskell\" rel=\"nofollow noreferrer\">/r/haskell</a> or the <a href=\"https://groups.google.com/forum/#!forum/haskell-cafe\" rel=\"nofollow noreferrer\">haskell-cafe mailing list</a>."}, {"owner": {"reputation": 460, "user_id": 1145736, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5b40de265957a25e38814f3cb1e7eed3?s=128&d=identicon&r=PG", "display_name": "Johannes", "link": "https://stackoverflow.com/users/1145736/johannes"}, "edited": false, "score": 1, "creation_date": 1468358006, "post_id": 38337927, "comment_id": 64092302, "body": "The Haskell community is very conservative with versioning, many packages don&#39;t have a major version. A good review on the state of the Haskell ecosystem can be found <a href=\"https://github.com/Gabriel439/post-rfc/blob/master/sotu.md\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 4, "creation_date": 1468363509, "post_id": 38337927, "comment_id": 64094435, "body": "It&#39;s hard to give a definitive answer here. As far as I can tell, nobody pays attention to that particular flag; honestly, it should probably just be removed from Hackage altogether."}], "answers": [{"tags": [], "owner": {"reputation": 313, "user_id": 5953321, "user_type": "registered", "profile_image": "https://graph.facebook.com/886468944803810/picture?type=large", "display_name": "Junyoung Clare Jang", "link": "https://stackoverflow.com/users/5953321/junyoung-clare-jang"}, "is_accepted": false, "score": 1, "last_activity_date": 1468372588, "creation_date": 1468372588, "answer_id": 38341161, "question_id": 38337927, "link": "https://stackoverflow.com/questions/38337927/are-modules-expected-to-stabilize-over-time-on-hackage/38341161#38341161", "title": "Are modules expected to stabilize over time on Hackage?", "body": "<p>Cabal's Stability tags almost defunct now.</p>\n\n<p>So do not pay attention to that, and beware about package's update date and # of vote</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1468372588, "creation_date": 1468353748, "question_id": 38337927, "link": "https://stackoverflow.com/questions/38337927/are-modules-expected-to-stabilize-over-time-on-hackage", "title": "Are modules expected to stabilize over time on Hackage?", "body": "<p>To newcomers it might be surprising that many modules on <code>Hackage</code> are marked as <code>experimental</code>, even modules as basic as <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html\" rel=\"nofollow\">Data.Bool</a>.</p>\n\n<p>Is there any process or expectation for modules to become <code>stable</code> and especially <code>base</code>? Should we pay any attention to this tag?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1468331010, "post_id": 38330568, "comment_id": 64075779, "body": "Which version of the regex-posix library are you using? I can&#39;t reproduce"}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1468331247, "post_id": 38330568, "comment_id": 64075983, "body": "I&#39;m assuming it&#39;s <code>regex-posix-0.95.2</code> since that&#39;s what&#39;s <a href=\"https://www.stackage.org/lts-5.0\" rel=\"nofollow noreferrer\">listed on stackage for resolver <code>lts-5.0</code></a>"}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 1, "creation_date": 1468331416, "post_id": 38330568, "comment_id": 64076109, "body": "Same here. I&#39;m not on windows though, but FWIW I can&#39;t reproduce on Linux."}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1468331439, "post_id": 38330568, "comment_id": 64076131, "body": "I just upgraded to <code>lts-6.7</code> which uses the same <code>regex-posix-0.95.2</code> package and I&#39;m getting the same problem."}], "answers": [{"tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 8, "last_activity_date": 1468336530, "creation_date": 1468336530, "answer_id": 38332863, "question_id": 38330568, "link": "https://stackoverflow.com/questions/38330568/why-is-there-a-limit-on-the-length-of-a-regex-pattern-in-text-regex-posix/38332863#38332863", "title": "Why is there a limit on the length of a regex pattern in Text.Regex.Posix?", "body": "<p>Following <a href=\"https://github.com/haskell/haskell-platform/issues/144#issuecomment-52845706\">this discussion</a>, it seems like there are other issues with this library stemming from the underlying C code not being properly ported to 64-bit architecture.</p>\n\n<p>I have switched to the <a href=\"https://hackage.haskell.org/package/regex-tdfa\">regex-tdfa</a> package and no longer have these problems.</p>\n"}], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 0, "accepted_answer_id": 38332863, "answer_count": 1, "score": 9, "last_activity_date": 1468336530, "creation_date": 1468330771, "last_edit_date": 1468335300, "question_id": 38330568, "link": "https://stackoverflow.com/questions/38330568/why-is-there-a-limit-on-the-length-of-a-regex-pattern-in-text-regex-posix", "title": "Why is there a limit on the length of a regex pattern in Text.Regex.Posix?", "body": "<p>I'm seeing an odd arbitrary limit on the length of a regular expression pattern where, after a string of 30 characters, funny things start to happen.</p>\n\n<p>Simple GHCI example:</p>\n\n<pre><code>&gt; import Text.Regex.Posix\n&gt; \"abcdefghijklmnopqrstuvwxyz0123456789\" =~ \"abcdefghijklmnopqrstuvwxyz0123\" :: String\n\"abcdefghijklmnopqrstuvwxyz0123\"\n&gt; \"abcdefghijklmnopqrstuvwxyz0123456789\" =~ \"abcdefghijklmnopqrstuvwxyz01234\" :: String\n\"\"\n</code></pre>\n\n<p>The only difference is the addition of the <code>4</code> at the end of the last pattern. It's a valid regex and <em>should</em> match but it gives me an empty string.</p>\n\n<p>It gets even weirder if I add a few more valid characters to the pattern:</p>\n\n<pre><code>&gt; \"abcdefghijklmnopqrstuvwxyz0123456789\" =~ \"abcdefghijklmnopqrstuvwxyz01234567\" :: String\n\"ab\"\n</code></pre>\n\n<p>It tells me it only matches <code>ab</code> when clearly that's wrong.</p>\n\n<p>My environment:</p>\n\n<ul>\n<li>Stack version 1.1.2 (resolver lts-6.7)</li>\n<li>GHC version 7.10.3</li>\n<li>OS: Windows 10</li>\n<li>regex-posix-0.95.2</li>\n</ul>\n\n<p>A complete uninstall and reinstall of Stack and all packages did not solve the problem</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1468336604, "creation_date": 1468336604, "answer_id": 38332895, "question_id": 38330536, "link": "https://stackoverflow.com/questions/38330536/wreq-add-abritrary-cookie-to-the-request/38332895#38332895", "title": "WReq add abritrary cookie to the request", "body": "<p>One option is to use <a href=\"https://hackage.haskell.org/package/wreq-0.4.1.0/docs/Network-Wreq.html#v:getWith\" rel=\"nofollow\"><code>getWith</code></a> which allows you to specify a <a href=\"https://hackage.haskell.org/package/http-client-0.4.26.2/docs/Network-HTTP-Client.html#t:CookieJar\" rel=\"nofollow\">CookieJar</a>\nwith your custom <a href=\"https://hackage.haskell.org/package/http-client-0.4.26.2/docs/Network-HTTP-Client-Internal.html#t:Cookie\" rel=\"nofollow\">Cookie</a> values.</p>\n\n<pre><code> {-# LANGUAGE OverloadedStrings #-}\n\n import Network.Wreq.Lens\n import Network.Wreq\n import Control.Lens\n import Network.HTTP.Client\n import Data.Time.Clock\n\n secs n = n*10^12\n mins n = n*60\n days n = n*1440\n\n foo = do\n   now &lt;- getCurrentTime\n   let expires = addUTCTime (days 30) now\n       cookie = Cookie \"name\" \"value\" expires \"example.com\" \"/\" now now True True False False\n       jar = createCookieJar [cookie]\n       opts = defaults :: Options\n       opts' = opts &amp; cookies .~ (Just jar)\n   getWith opts' \"http://example.com/asd\"\n</code></pre>\n"}], "owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 313, "favorite_count": 0, "accepted_answer_id": 38332895, "answer_count": 1, "score": 1, "last_activity_date": 1468336604, "creation_date": 1468330705, "question_id": 38330536, "link": "https://stackoverflow.com/questions/38330536/wreq-add-abritrary-cookie-to-the-request", "title": "WReq add abritrary cookie to the request", "body": "<p>I'm trying to use the Proxmox VE json API, with wreq I can login and get the json response containing the token to be sent as a cookie with every request. My question now is how do I set a cookie with wreq ? Looks like session handling will automatically handle Set-Cookie sent by the server, but in my case that never happens.</p>\n\n<p>Is there a WReq equivalent to the simple curl -b \"Something=Value\" in shell ?\nLooks like it is possible to call the Cookie constructor by hand but it takes a lot of argument, and I don't really know what I should put in there besides the name and the value.</p>\n\n<p>thanks,</p>\n"}, {"tags": ["algorithm", "haskell", "implementation"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 2, "creation_date": 1468332658, "post_id": 38330445, "comment_id": 64077136, "body": "You&#39;re probably going to have to take apart one of the existing correct MD5 implementations to get the intermediate states and compare them to what your program produces. (For example, when I did this, I had endless trouble getting the padding to exactly match the RFC.) For example, there&#39;s a Haskell package called <code>pureMD5</code> which you might be able to take apart and compare values against."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 3, "creation_date": 1468335258, "post_id": 38330445, "comment_id": 64079166, "body": "Your length, <code>ln</code>, should be in bits not bytes .  First get the empty string working. Then one character, then two, then a full block, then a block plus one character.  After that you&#39;ll want to look for corner cases around padding."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1468349859, "post_id": 38330445, "comment_id": 64087824, "body": "The length is supposed to be 64 bits, but you used only 32.   The values are all supposed to be little endian but you are 1. Using big endian for the pad 2. using big endian in the output."}, {"owner": {"reputation": 46, "user_id": 6279481, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-95RdDLw3Y8M/AAAAAAAAAAI/AAAAAAAAASg/jmBihEOpZXk/photo.jpg?sz=128", "display_name": "MarcoXerox", "link": "https://stackoverflow.com/users/6279481/marcoxerox"}, "edited": false, "score": 0, "creation_date": 1468409577, "post_id": 38330445, "comment_id": 64113402, "body": "I thought <code>replicate (1 +</code> here accounts for 32 bits of length in integer; another 32 bits from <code>fromIntegral ln</code> makes a total of 64. Is there any libraries for endianness conversion or I need to write my own?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1468427466, "post_id": 38330445, "comment_id": 64126558, "body": "Ok let&#39;s try saying this again.  <code>0x80000000 &#47;= 0x00000080</code> which would be the little endian representation.  Also, I doubt you actually want each character expanded to 32 bits as you have done in preprocess.  When I fix the problems noted in these comments things work for my few tests."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1468517730, "post_id": 38330445, "comment_id": 64171191, "body": "Wrt libraries you can use cereal or binary."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1468772830, "post_id": 38330445, "comment_id": 64253238, "body": "Oh no?  Have you gotten bored?  If you need more real-time discussion then feel free to ask on irc.freenode.net #haskell."}, {"owner": {"reputation": 46, "user_id": 6279481, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-95RdDLw3Y8M/AAAAAAAAAAI/AAAAAAAAASg/jmBihEOpZXk/photo.jpg?sz=128", "display_name": "MarcoXerox", "link": "https://stackoverflow.com/users/6279481/marcoxerox"}, "edited": false, "score": 0, "creation_date": 1468821084, "post_id": 38330445, "comment_id": 64265002, "body": "Out of town for a while. I reworked the code a bit converting everything to Word8. Still I guess there is endianness problem for function <code>md5</code>. I&#39;d be glad to know if <code>preprocess</code> code is right though."}], "owner": {"reputation": 46, "user_id": 6279481, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-95RdDLw3Y8M/AAAAAAAAAAI/AAAAAAAAASg/jmBihEOpZXk/photo.jpg?sz=128", "display_name": "MarcoXerox", "link": "https://stackoverflow.com/users/6279481/marcoxerox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 136, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1468820956, "creation_date": 1468330481, "last_edit_date": 1468820956, "question_id": 38330445, "link": "https://stackoverflow.com/questions/38330445/error-in-implementation-of-md5-algorithm-in-haskell", "title": "Error in implementation of MD5 algorithm in Haskell", "body": "<p>I have written the following implementation of MD5 algorithm. However, the hash values do not match that from online generators.</p>\n\n<p>Correct MD5 Hash of <code>\"testing\"</code> is <code>\"ae2b1fca515949e5d54fb22b8ed95575\"</code></p>\n\n<p>But my program gives <code>\"786fc25092f719e0349ed15efcbe8460\"</code></p>\n\n<p>Where is my mistake here?</p>\n\n<h1>Code</h1>\n\n<p>Explanation: import necessary libraries and set constants</p>\n\n<pre><code>import Data.Bits\nimport Data.Word\nimport Data.Char\nimport Text.Printf  -- For pretty output of hexdigest\nimport qualified Data.Array as A\ntype Numbers = (Word32, Word32, Word32, Word32)\nroundShift = A.listArray (0, 63) [7,12,17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21]\nsines = A.listArray (0, 63) [ 0xd76aa478, 0xe8c7b756, 0x242070db, 0xc1bdceee, 0xf57c0faf, 0x4787c62a, 0xa8304613, 0xfd469501, 0x698098d8, 0x8b44f7af, 0xffff5bb1, 0x895cd7be, 0x6b901122, 0xfd987193, 0xa679438e, 0x49b40821, 0xf61e2562, 0xc040b340, 0x265e5a51, 0xe9b6c7aa, 0xd62f105d, 0x02441453, 0xd8a1e681, 0xe7d3fbc8, 0x21e1cde6, 0xc33707d6, 0xf4d50d87, 0x455a14ed, 0xa9e3e905, 0xfcefa3f8, 0x676f02d9, 0x8d2a4c8a, 0xfffa3942, 0x8771f681, 0x6d9d6122, 0xfde5380c, 0xa4beea44, 0x4bdecfa9, 0xf6bb4b60, 0xbebfbc70, 0x289b7ec6, 0xeaa127fa, 0xd4ef3085, 0x04881d05, 0xd9d4d039, 0xe6db99e5, 0x1fa27cf8, 0xc4ac5665, 0xf4292244, 0x432aff97, 0xab9423a7, 0xfc93a039, 0x655b59c3, 0x8f0ccc92, 0xffeff47d, 0x85845dd1, 0x6fa87e4f, 0xfe2ce6e0, 0xa3014314, 0x4e0811a1, 0xf7537e82, 0xbd3af235, 0x2ad7d2bb, 0xeb86d391 ]  \n-- Tables found in Wiki\n</code></pre>\n\n<p>Explanation: Conversions</p>\n\n<pre><code>convertToW32 :: (Word8, Word8, Word8, Word8) -&gt; Word32\nconvertToW32 (a,b,c,d) = (fromIntegral a) + shiftL (fromIntegral b) 8 + shiftL (fromIntegral c) 16 + shiftL (fromIntegral d) 24\nconvertToW8s :: Int -&gt; Word64 -&gt; [Word8]\nconvertToW8s 0 w = [fromIntegral w]\nconvertToW8s n w = let (p, q) = w `quotRem` (256 ^ n) in fromIntegral p : convertToW8s (n - 1) q\n</code></pre>\n\n<p>Explanation: prepare input string into chunks</p>\n\n<pre><code>preprocess :: String -&gt; [Word8] \npreprocess message = map (fromIntegral . ord) message ++ padding ++ (convertToW8s 7 . byteSwap64 $ fromIntegral ln)\n    where ln = length message\n          padding = 0x80 : replicate ((55 - ln) `mod` 64) 0x00\n\n\n-- required 512-bit input, return array (0, 15)\nchunkize :: [Word8] -&gt; [A.Array Int Word32]\nchunkize [] = []\nchunkize xs = if length xs &lt; 64 \n              then error \"Cannot form chunk!\"\n              else A.listArray (0, 15) (bulkConvert p) : chunkize q\n                where (p, q) = splitAt 64 xs\n                      bulkConvert [] = []\n                      bulkConvert (a:b:c:d:r) = convertToW32 (a,b,c,d) : bulkConvert r\n</code></pre>\n\n<p>Explanation: run the loop mentioned in Wiki, for each chunk</p>\n\n<pre><code>findABCD :: Numbers -&gt; A.Array Int Word32 -&gt; Numbers \nfindABCD tt m = foldl loop tt [0..63]\n    where loop t@(a,b,c,d) x = let (f,g,i) = fgi t x in (d, b + rotateL (a + f + sines A.! i + m A.! g) (roundShift A.! i), b, c)\n\nfgi :: Numbers -&gt; Int -&gt; (Word32, Int, Int)\nfgi (a, b, c, d) i\n    |  0 &lt;= i &amp;&amp; i &lt;= 15 = ((b .&amp;. c) .|. ((complement b) .&amp;. d), i, i)\n    | 16 &lt;= i &amp;&amp; i &lt;= 31 = ((d .&amp;. b) .|. ((complement d) .&amp;. c), (1 + 5 * i) `mod` 16, i)\n    | 32 &lt;= i &amp;&amp; i &lt;= 47 = (b `xor` c `xor` d, (5 + 3 * i) `mod` 16, i)\n    | 48 &lt;= i &amp;&amp; i &lt;= 63 = (c `xor` ((complement d) .|. b), (7 * i) `mod` 16, i)\n    | otherwise = error \"Index exceeds range!\"\n</code></pre>\n\n<p>Explanation: md5sum of string; main is just a caller function</p>\n\n<pre><code>md5 :: String -&gt; String\nmd5 message = printf \"%08x%08x%08x%08x\" a0 b0 c0 d0\n    where (a0, b0, c0, d0) = foldl addToResult (0x67452301, 0xefcdab89, 0x98badcfe, 0x10325476) (chunkize $ preprocess message)\n          addToResult t@(a, b, c, d) arr = let (a', b', c', d') = findABCD t arr in (a + a', b + b', c + c', d + d')\n\nmain = putStrLn . md5 =&lt;&lt; getLine\n</code></pre>\n"}, {"tags": ["haskell", "reflection", "parametric-polymorphism", "adhoc-polymorphism"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1468320564, "post_id": 38326420, "comment_id": 64067999, "body": "If we could pass dictionaries (e.g. as in Agda implicits), this would be trivial. However, I believe that some classes/libraries exploit the fact that we can&#39;t pass dictionaries to ensure some invariants. For instance, imagine if we could call<code>Data.Set.insert</code> using a different ordering every time ..."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 6, "creation_date": 1468320770, "post_id": 38326420, "comment_id": 64068134, "body": "Also note that your &quot;hack&quot; works in practice, but only if you never pack two distinct <code>cmp</code> functions in <code>OrdVal a</code> values. If you do, then your <code>Ord</code> instance does not satisfy the <code>Ord</code> laws."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1468419160, "post_id": 38327277, "comment_id": 64120529, "body": "<code>Given</code> is a bit evil, and you really don&#39;t need it here. Add a phantom to the newtype and then use <code>Reifies</code> instead of <code>Given</code>, <code>reify</code> instead of <code>give</code>, and <code>reflect</code> instead of <code>given</code>."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 8, "last_activity_date": 1480503757, "last_edit_date": 1480503757, "creation_date": 1468322037, "answer_id": 38327277, "question_id": 38326420, "link": "https://stackoverflow.com/questions/38326420/good-way-to-convert-between-ad-hoc-polymorphic-functions-and-parametric-polymorp/38327277#38327277", "title": "good way to convert between ad-hoc polymorphic functions and parametric polymorphic ones", "body": "<p>I'm not necessarily saying you should do this, but you <em>can</em> use <a href=\"https://hackage.haskell.org/package/reflection-2.1.2\" rel=\"nofollow noreferrer\">reflection</a> to pass around the comparison function without having to package it up with each element of the list:</p>\n\n<pre><code>{-# LANGUAGE UndecidableInstances #-}\nimport Data.Reflection\n\nnewtype O a = O a\n\ninstance Given (a -&gt; a -&gt; Ordering) =&gt; Eq (O a) where\n    x == y = compare x y == EQ\n\ninstance Given (a -&gt; a -&gt; Ordering) =&gt; Ord (O a) where\n    compare (O x) (O y) = given x y\n</code></pre>\n\n<p>Given (<em>heh</em>) the above infrastructure, you can then write <code>sortBy</code> in terms of <code>sort</code> as follows:</p>\n\n<pre><code>import Data.Coerce\nimport Data.List (sort)\n\nsortBy :: (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]\nsortBy cmp = give cmp $ from . sort . to\n  where\n    to :: [a] -&gt; [O a]\n    to = coerce\n\n    from :: [O a] -&gt; [a]\n    from = coerce\n</code></pre>\n\n<p>(note that by using <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Coerce.html\" rel=\"nofollow noreferrer\"><code>Data.Coerce</code></a>, we avoid all potential runtime cost of the <code>O</code> wrapper)</p>\n"}, {"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1468432070, "post_id": 38356726, "comment_id": 64129258, "body": "Why not use <code>coerce</code> in the <code>sortBy</code> implementation?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1468434510, "post_id": 38356726, "comment_id": 64130795, "body": "@Cirdec, there&#39;s no particular reason not to, if you&#39;re using it elsewhere. I didn&#39;t realize when I started out that it would be beneficial elsewhere. In any case, I generally prefer to use <code>#.</code> and <code>.#</code> where applicable rather than using <code>coerce</code> directly, as doing so tends to reduce the number of type signatures required and can make the code clearer. Even when <code>Data.Profunctor.Unsafe</code> is unavailable, those bits of the <code>-&gt;</code> instance can be copied easily."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1468434832, "post_id": 38356726, "comment_id": 64130975, "body": "The only type signature you need with two <code>coerce</code>s is <code>sort :: [O s a] -&gt; [O s a]</code>. If you define <code>sortBy cmp = reify cmp $ \\(_ :: Proxy s) -&gt; coerce . (sort :: [O s a] -&gt; [O s a]) . coerce</code> you don&#39;t have to worry about potential intermediate list allocation."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 6, "last_activity_date": 1468435492, "last_edit_date": 1468435492, "creation_date": 1468426072, "answer_id": 38356726, "question_id": 38326420, "link": "https://stackoverflow.com/questions/38326420/good-way-to-convert-between-ad-hoc-polymorphic-functions-and-parametric-polymorp/38356726#38356726", "title": "good way to convert between ad-hoc polymorphic functions and parametric polymorphic ones", "body": "<p>Cactus's answer relies on the somewhat shady <code>Given</code> class in <code>reflection</code>. It's possible, however, to use reflection without that.</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables, MultiParamTypeClasses, UndecidableInstances #-}\n\nmodule SortReflection where\n\nimport Data.Reflection\nimport Data.List (sort)\nimport Data.Proxy\nimport Data.Coerce\n\nnewtype O s a = O {getO :: a}\n\ninstance Reifies s (a -&gt; a -&gt; Ordering) =&gt; Eq (O s a) where\n  a == b = compare a b == EQ\n\ninstance Reifies s (a -&gt; a -&gt; Ordering) =&gt; Ord (O s a) where\n  compare = coerce (reflect (Proxy :: Proxy s))\n\nsortBy :: forall a . (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]\nsortBy cmp = reify cmp $\n  \\(_ :: Proxy s) -&gt; coerce (sort :: [O s a] -&gt; [O s a])\n</code></pre>\n\n<p>Examining the Core produced indicates that this compiles to a thin wrapper around <code>sortBy</code>. It looks even thinner using a <code>Reifies</code> class based on <code>Tagged</code> instead of <code>Proxy</code>, but Ed Kmett doesn't like the API that produces.</p>\n"}], "owner": {"reputation": 2966, "user_id": 315302, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1d57a52c98eee46fb4bc92e0b4ffe163?s=128&d=identicon&r=PG", "display_name": "Javran", "link": "https://stackoverflow.com/users/315302/javran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 315, "favorite_count": 4, "answer_count": 2, "score": 10, "last_activity_date": 1480503757, "creation_date": 1468319704, "last_edit_date": 1468331349, "question_id": 38326420, "link": "https://stackoverflow.com/questions/38326420/good-way-to-convert-between-ad-hoc-polymorphic-functions-and-parametric-polymorp", "title": "good way to convert between ad-hoc polymorphic functions and parametric polymorphic ones", "body": "<p>I'm wondering if there are general ways to convert between ad-hoc polymorphic functions and parametric polymorphic ones. In other words, given an ad-hoc polymorphic function, how to implement its parametric counterpart? and what about the other way around?</p>\n\n<p>take <code>sort</code> as an example. it's easy to write <code>sort :: Ord a =&gt; [a] -&gt; [a]</code> in terms of <code>sortBy</code>:</p>\n\n<pre><code>sort :: Ord a =&gt; [a] -&gt; [a]\nsort = sortBy compare\n</code></pre>\n\n<p>but the other way around seems tricky, so far the best I can do is to go a bit \"object-oriented\":</p>\n\n<pre><code>import qualified Data.List as L\n\ndata OrdVal a = OV (a -&gt; a -&gt; Ordering) a\n\ninstance Eq (OrdVal a) where\n    (OV cmp a) == (OV _ b) = a `cmp` b == EQ\n\ninstance Ord (OrdVal a) where\n    (OV cmp a) `compare` (OV _ b) = a `cmp` b\n\nsortBy :: (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]\nsortBy cmp = map unOV . L.sort . map (OV cmp)\n  where\n    unOV (OV _ v) = v\n</code></pre>\n\n<p>But this sounds more like a hack than proper solution.</p>\n\n<p>so I'd like to know:</p>\n\n<ol>\n<li>are there better ways for this specific example?</li>\n<li>what are the general techniques for converting between ad-hoc polymorphic functions and parametric ones?</li>\n</ol>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "edited": false, "score": 0, "creation_date": 1468323613, "post_id": 38326381, "comment_id": 64070017, "body": "The error is because of ambiguity against the function <code>:=</code>. If you specify that both name and values are <code>ByteString</code>, the code will run. I&#39;m not sure why it resolves ambiguity in GHCI but not in standalone code, though."}, {"owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "reply_to_user": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "edited": false, "score": 0, "creation_date": 1468325363, "post_id": 38326381, "comment_id": 64071305, "body": "Ha yes, thanks ! That was it"}, {"owner": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "edited": false, "score": 0, "creation_date": 1469785649, "post_id": 38326381, "comment_id": 64692504, "body": "I have the same problem, what changes did you make in the code to fix this?"}, {"owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "edited": false, "score": 0, "creation_date": 1470045236, "post_id": 38326381, "comment_id": 64770114, "body": "I used &quot;user&quot; :: ByteString := ... I think, from memory. I ended up not using := in the end, as it doesn&#39;t compose the form I want, I used the other method."}], "answers": [{"tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 1, "last_activity_date": 1468325431, "creation_date": 1468325431, "answer_id": 38328548, "question_id": 38326381, "link": "https://stackoverflow.com/questions/38326381/wreq-simple-post-request-results-in-error-of-no-instance-for-formvalue-v0-ar/38328548#38328548", "title": "WReq simple post request - results in error of No instance for (FormValue v0) arising from a use of \u2018:=\u2019", "body": "<p>The error is because of ambiguity against the function <code>:=</code>. If you specify that both name and values are <code>ByteString</code>, the code will run.</p>\n\n<p>I'm not sure why it resolves ambiguity in GHCI but not in standalone code, though.</p>\n"}], "owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 450, "favorite_count": 2, "accepted_answer_id": 38328548, "answer_count": 1, "score": 2, "last_activity_date": 1577727543, "creation_date": 1468319621, "last_edit_date": 1577727543, "question_id": 38326381, "link": "https://stackoverflow.com/questions/38326381/wreq-simple-post-request-results-in-error-of-no-instance-for-formvalue-v0-ar", "title": "WReq simple post request - results in error of No instance for (FormValue v0) arising from a use of \u2018:=\u2019", "body": "<p>I'm trying to code something to do a few requests to a json API.\nI have this function :</p>\n\n<pre><code>apiLogin = do\n  r &lt;- post \"https://url:port/somewhere\" [\"user\" := \"some_name\", \"password\" := \"test\"]\n  putStrLn $ cs $ r ^. responseBody\n</code></pre>\n\n<p>Here are the errors I'm getting :</p>\n\n<pre><code>Api.hs:12:96:\nNo instance for (FormValue v0) arising from a use of \u2018:=\u2019\nThe type variable \u2018v0\u2019 is ambiguous\nNote: there are several potential instances:\n  instance FormValue a =&gt; FormValue (Maybe a)\n    -- Defined in \u2018Network.Wreq.Types\u2019\n  instance FormValue GHC.Int.Int16 -- Defined in \u2018Network.Wreq.Types\u2019\n  instance FormValue GHC.Int.Int32 -- Defined in \u2018Network.Wreq.Types\u2019\n  ...plus 18 others\nIn the expression: \"user\" := \"some_name\"\nIn the second argument of \u2018post\u2019, namely\n  \u2018[\"user\" := \"some_name\", \"password\" := \"test\"]\u2019\nIn a stmt of a 'do' block:\n  r &lt;- post\n         \"https://url:port/somewhere/g\"\n         [\"user\" := \"some_name\", \"password\" := \"test\"]\n\nApi.hs:12:99:\nNo instance for (Data.String.IsString v0)\n  arising from the literal \u2018\"some_name\"\u2019\nThe type variable \u2018v0\u2019 is ambiguous\nNote: there are several potential instances:\n  instance Data.String.IsString\n             http-client-0.4.29:Network.HTTP.Client.Types.Request\n    -- Defined in \u2018http-client-0.4.29:Network.HTTP.Client.Request\u2019\n  instance Data.String.IsString\n             http-client-0.4.29:Network.HTTP.Client.Types.RequestBody\n    -- Defined in \u2018http-client-0.4.29:Network.HTTP.Client.Types\u2019\n  instance (a ~ Data.ByteString.Internal.ByteString) =&gt;\n           Data.String.IsString\n             (attoparsec-0.13.0.2:Data.Attoparsec.ByteString.Internal.Parser a)\n    -- Defined in \u2018Data.Attoparsec.ByteString.Char8\u2019\n  ...plus 11 others\nIn the second argument of \u2018(:=)\u2019, namely \u2018\"some_name\"\u2019\nIn the expression: \"user\" := \"some_name\"\nIn the second argument of \u2018post\u2019, namely\n  \u2018[\"user\" := \"some_name\", \"password\" := \"test\"]\u2019\n\nApi.hs:12:122:\nNo instance for (FormValue v1) arising from a use of \u2018:=\u2019\nThe type variable \u2018v1\u2019 is ambiguous\nNote: there are several potential instances:\n  instance FormValue a =&gt; FormValue (Maybe a)\n    -- Defined in \u2018Network.Wreq.Types\u2019\n  instance FormValue GHC.Int.Int16 -- Defined in \u2018Network.Wreq.Types\u2019\n  instance FormValue GHC.Int.Int32 -- Defined in \u2018Network.Wreq.Types\u2019\n  ...plus 18 others\nIn the expression: \"password\" := \"test\"\nIn the second argument of \u2018post\u2019, namely\n  \u2018[\"user\" := \"some_name\", \"password\" := \"test\"]\u2019\nIn a stmt of a 'do' block:\n  r &lt;- post\n         \"https://url:port/somewhere/g\"\n         [\"user\" := \"some_name\", \"password\" := \"test\"]\n\nApi.hs:12:125:\nNo instance for (Data.String.IsString v1)\n  arising from the literal \u2018\"test\"\u2019\nThe type variable \u2018v1\u2019 is ambiguous\nNote: there are several potential instances:\n  instance Data.String.IsString\n             http-client-0.4.29:Network.HTTP.Client.Types.Request\n    -- Defined in \u2018http-client-0.4.29:Network.HTTP.Client.Request\u2019\n  instance Data.String.IsString\n             http-client-0.4.29:Network.HTTP.Client.Types.RequestBody\n    -- Defined in \u2018http-client-0.4.29:Network.HTTP.Client.Types\u2019\n  instance (a ~ Data.ByteString.Internal.ByteString) =&gt;\n           Data.String.IsString\n             (attoparsec-0.13.0.2:Data.Attoparsec.ByteString.Internal.Parser a)\n    -- Defined in \u2018Data.Attoparsec.ByteString.Char8\u2019\n  ...plus 11 others\nIn the second argument of \u2018(:=)\u2019, namely \u2018\"test\"\u2019\nIn the expression: \"password\" := \"test\"\nIn the second argument of \u2018post\u2019, namely\n  \u2018[\"user\" := \"some_name\", \"password\" := \"test\"]\u2019\n</code></pre>\n\n<p>I have no idea what I'm doing wrong, I'm trying to do the same thing they show in the doc (<a href=\"http://www.serpentine.com/wreq/tutorial.html\" rel=\"nofollow\">http://www.serpentine.com/wreq/tutorial.html</a> uploading data via post) except not in ghci. I am using Overloaded strings.\nCould someone explain what those error means ?</p>\n"}, {"tags": ["haskell", "ubuntu-14.04", "visual-studio-code", "stackage"], "answers": [{"comments": [{"owner": {"reputation": 89, "user_id": 1900238, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/dd7d106f0b0692093aa59faa699ed837?s=128&d=identicon&r=PG", "display_name": "user1900238", "link": "https://stackoverflow.com/users/1900238/user1900238"}, "edited": false, "score": 0, "creation_date": 1468317466, "post_id": 38323153, "comment_id": 64065890, "body": "I was told not to install Haskell through Cabal on IRC and was directed to use Stackage since it keeps the system packages and Haskell Libraries separate. Hence I did install Haskell using Stack, but couldn&#39;t find Hlint  orGhc-mod documentation in Stack. How to go ahead than. I saw I could do Stack install Hlint. But not sure about GHc-mod"}, {"owner": {"reputation": 7167, "user_id": 1969543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb55c4a086297b83de4ed851292eb8b0?s=128&d=identicon&r=PG", "display_name": "Llewey", "link": "https://stackoverflow.com/users/1969543/llewey"}, "reply_to_user": {"reputation": 89, "user_id": 1900238, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/dd7d106f0b0692093aa59faa699ed837?s=128&d=identicon&r=PG", "display_name": "user1900238", "link": "https://stackoverflow.com/users/1900238/user1900238"}, "edited": false, "score": 0, "creation_date": 1468403752, "post_id": 38323153, "comment_id": 64109561, "body": "You need to make sure that <code>ghc-mod</code> and <code>hlint</code> are available to vscode. You can do this in 2 ways, both of which require you to find the paths to the executables you just installed.  1) add ghc-mod and hlint to your system &quot;path&quot;. <a href=\"http://askubuntu.com/questions/381958/add-program-to-path\">askubuntu.com/questions/381958/add-program-to-path</a> OR 2) Configure the extensions to tell them where the executable is. The README for both extensions tell you which configuration variable to set."}], "tags": [], "owner": {"reputation": 7167, "user_id": 1969543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb55c4a086297b83de4ed851292eb8b0?s=128&d=identicon&r=PG", "display_name": "Llewey", "link": "https://stackoverflow.com/users/1969543/llewey"}, "is_accepted": false, "score": 1, "last_activity_date": 1468310542, "creation_date": 1468310542, "answer_id": 38323153, "question_id": 38322699, "link": "https://stackoverflow.com/questions/38322699/vscode-editor-got-errors-while-using-haskell-installed-using-stackage/38323153#38323153", "title": "VSCode editor got errors, while using Haskell installed using Stackage", "body": "<p>It looks like you've installed 2 extensions for vscode, one for linting and one for running ghc-mod, but you don't have hlint or ghc-mod installed.</p>\n\n<p>If you are using <a href=\"https://marketplace.visualstudio.com/items?itemName=hoovercj.vscode-ghc-mod\" rel=\"nofollow\">this ghc-mod extension</a>, make sure you have ghc-mod installed through cabal or through stack.</p>\n\n<p>IF you are using <a href=\"https://marketplace.visualstudio.com/items?itemName=hoovercj.haskell-linter\" rel=\"nofollow\">this linter extension</a>, make sure you have hlint installed through cabal or through stack.</p>\n\n<p>To install with cabal, run:\n<code>cabal install hlint</code>\nand\n<code>cabal install ghc-mod</code></p>\n\n<p>To install via stack, see the stack documentation.</p>\n"}], "owner": {"reputation": 89, "user_id": 1900238, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/dd7d106f0b0692093aa59faa699ed837?s=128&d=identicon&r=PG", "display_name": "user1900238", "link": "https://stackoverflow.com/users/1900238/user1900238"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2771, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1468324632, "creation_date": 1468309085, "last_edit_date": 1468324632, "question_id": 38322699, "link": "https://stackoverflow.com/questions/38322699/vscode-editor-got-errors-while-using-haskell-installed-using-stackage", "title": "VSCode editor got errors, while using Haskell installed using Stackage", "body": "<p>Recently Installed VS Code in my Ubuntu14.04 . Installed Haskell using Stack.</p>\n\n<p>Getting these errors. Kindly help.</p>\n\n<p>Error: Couldn't start ghc-mod process Error: Command failed: ghc-mod version</p>\n\n<p>Error: Cannot hlint the haskell file. The hlint program was not found. Use the 'haskell.hlint.executablePath' setting to configure the location of 'hlint'\n<a href=\"https://i.stack.imgur.com/L3qsb.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/L3qsb.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1468307759, "creation_date": 1468307759, "answer_id": 38322302, "question_id": 38322082, "link": "https://stackoverflow.com/questions/38322082/no-instance-for-floating-integer-arising-from-a-use-of/38322302#38322302", "title": "No instance for (Floating Integer) arising from a use of &#39;**&#39;?", "body": "<p>Use <code>^</code> instead:</p>\n\n<pre><code>two i = 2 ^ i\n</code></pre>\n\n<p>And then there is no need for to cast the result back to an Integral type.</p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1468315994, "post_id": 38322309, "comment_id": 64064791, "body": "It should be noted that <code>^</code> only works for non-negative exponents. If round-off to zero is desired, like <code>floor (2 ** fromIntegral i)</code> would give for negative <code>i</code>, then this needs to be handled with an extra clause."}, {"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1468318179, "post_id": 38322309, "comment_id": 64066409, "body": "@leftaroundabout Thanks for this. Do you mind if I add it into my answer?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1468423039, "post_id": 38322309, "comment_id": 64123579, "body": "There&#39;s also <code>^^</code>, whose result can be rounded."}], "tags": [], "owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "is_accepted": false, "score": 6, "last_activity_date": 1468382180, "last_edit_date": 1468382180, "creation_date": 1468307783, "answer_id": 38322309, "question_id": 38322082, "link": "https://stackoverflow.com/questions/38322082/no-instance-for-floating-integer-arising-from-a-use-of/38322309#38322309", "title": "No instance for (Floating Integer) arising from a use of &#39;**&#39;?", "body": "<p><code>(**)</code> requires floating point input based on the function signature:</p>\n\n<pre><code>(**) :: Floating a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p><code>toInteger</code> on the other hand requires input that is integral in nature:</p>\n\n<pre><code>toInteger :: Integral a =&gt; a -&gt; Integer\n</code></pre>\n\n<p>Therefore, you cannot reconcile the two the way you use it. That said, since you seem to be expecting integer input anyway, you might consider using <code>(^)</code> instead, like so:</p>\n\n<pre><code>two :: Integer -&gt; Integer\ntwo i = 2 ^ i\n</code></pre>\n\n<p>As @leftaroundabout correctly points out in the comments, <code>(^)</code> will fail for negative values of <code>i</code>. This can be resolved by checking for value and handling in an alternate manner, something like this:</p>\n\n<pre><code>two :: Integer -&gt; Integer\ntwo i = if i &gt; 0 then 2 ^ i else floor (2 ** fromIntegral i)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7395, "user_id": 309760, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6a8c18bf11374f3580503d024623d820?s=128&d=identicon&r=PG", "display_name": "Paul S", "link": "https://stackoverflow.com/users/309760/paul-s"}, "is_accepted": false, "score": 0, "last_activity_date": 1468518653, "creation_date": 1468518653, "answer_id": 38380962, "question_id": 38322082, "link": "https://stackoverflow.com/questions/38322082/no-instance-for-floating-integer-arising-from-a-use-of/38380962#38380962", "title": "No instance for (Floating Integer) arising from a use of &#39;**&#39;?", "body": "<p>The reason this...</p>\n\n<pre><code>two :: Integer -&gt; Integer\ntwo i = toInteger(2 ** i)\n</code></pre>\n\n<p>...doesn't work is because you've declared <code>i</code> to be an integer, and if we look at the type of <code>(**)</code>...</p>\n\n<pre><code>Prelude&gt; :t (**)\n(**) :: Floating a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>... all it's arguments are of the same type, and that type has to be an instance of the <code>Floating</code> type-class. <code>Integer</code> is not an instance of <code>Floating</code>. This is what \"No instance of (Floating Integer)\" means.</p>\n\n<p>The simplest solution is to use <code>^</code> as ErikR suggests. It raises a number to an integral power.</p>\n\n<pre><code>(^) :: (Integral b, Num a) =&gt; a -&gt; b -&gt; a\n</code></pre>\n\n<p>If you want to work through using <code>**</code> to learn a bit more, keep reading.</p>\n\n<hr>\n\n<p>So we need to convert your integer into a type which is an instance of <code>Floating</code>. You can do this with <code>fromIntegral</code>. If we do this:</p>\n\n<pre><code>two :: Integer -&gt; Integer\ntwo i = toInteger(2 ** fromIntegral(i))\n</code></pre>\n\n<p>...we still get a load of error messages complaining that various types are ambiguous. These aren't as clear as the first message, but the issue is the use of <code>toInteger</code> which becomes apparent if we look at it's type.</p>\n\n<pre><code>Prelude&gt; :t toInteger\ntoInteger :: Integral a =&gt; a -&gt; Integer\n</code></pre>\n\n<p>As we're passing the result of <code>**</code> to <code>toInteger</code>, and that is a <code>Floating</code>, not an <code>Integral</code>, <code>toInteger</code> is the wrong function. <code>round</code> is a better choice.</p>\n\n<pre><code>two :: Integer -&gt; Integer\ntwo i = round(2 ** fromIntegral(i))\n</code></pre>\n\n<p>This now works.</p>\n"}], "owner": {"reputation": 747, "user_id": 4159812, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/af012235f3537ead591d7c77d89152c6?s=128&d=identicon&r=PG&f=1", "display_name": "Zhipeng YANG", "link": "https://stackoverflow.com/users/4159812/zhipeng-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 548, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1468518653, "creation_date": 1468307019, "last_edit_date": 1468516645, "question_id": 38322082, "link": "https://stackoverflow.com/questions/38322082/no-instance-for-floating-integer-arising-from-a-use-of", "title": "No instance for (Floating Integer) arising from a use of &#39;**&#39;?", "body": "<p>I have the following Haskell code:</p>\n\n<pre><code>two :: Integer -&gt; Integer\ntwo i = toInteger(2 ** i)\n</code></pre>\n\n<p>Why isn't it working?</p>\n"}, {"tags": ["windows", "haskell", "cygwin", "ghci"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1468304412, "post_id": 38320570, "comment_id": 64057965, "body": "in some cases you can use &lt;ctrl&gt;-&lt;up&gt; instead (for exmaple in emacs) - maybe it&#39;s worth a try"}, {"owner": {"reputation": 6281, "user_id": 5105383, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2YCB5.jpg?s=128&g=1", "display_name": "matzeri", "link": "https://stackoverflow.com/users/5105383/matzeri"}, "edited": false, "score": 0, "creation_date": 1468312293, "post_id": 38320570, "comment_id": 64062377, "body": "windows console or mintty ? Haskell is not a cygwin program so the interation with cygwin is not working. [link] (<a href=\"https://downloads.haskell.org/~ghc/8.0.1/docs/html/users_guide/win32-dlls.html#interacting-with-the-terminal\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/8.0.1/docs/html/users_guide/&hellip;</a>)"}, {"owner": {"reputation": 54004, "user_id": 61624, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/1e011d13433f12be7dc754180cb38ca8?s=128&d=identicon&r=PG", "display_name": "Daniel Kaplan", "link": "https://stackoverflow.com/users/61624/daniel-kaplan"}, "reply_to_user": {"reputation": 6281, "user_id": 5105383, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2YCB5.jpg?s=128&g=1", "display_name": "matzeri", "link": "https://stackoverflow.com/users/5105383/matzeri"}, "edited": false, "score": 0, "creation_date": 1468371119, "post_id": 38320570, "comment_id": 64096259, "body": "@matzeri windows console I believe, as I have not installed mintty afaik"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 7491075, "user_type": "registered", "profile_image": "https://graph.facebook.com/1330645340296347/picture?type=large", "display_name": "Doru-Mihai Muntean", "link": "https://stackoverflow.com/users/7491075/doru-mihai-muntean"}, "is_accepted": false, "score": 0, "last_activity_date": 1485797380, "creation_date": 1485797380, "answer_id": 41941905, "question_id": 38320570, "link": "https://stackoverflow.com/questions/38320570/the-up-arrow-in-ghcii-sh-does-not-scroll-through-command-history/41941905#41941905", "title": "The up arrow in ghcii.sh does not scroll through command history", "body": "<p>The issue is caused by the poor interaction between mintty and ghci. Unfortunately it is not fixed and probably will never be fixed. Your best chance is to use a console other than mintty.</p>\n"}], "owner": {"reputation": 54004, "user_id": 61624, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/1e011d13433f12be7dc754180cb38ca8?s=128&d=identicon&r=PG", "display_name": "Daniel Kaplan", "link": "https://stackoverflow.com/users/61624/daniel-kaplan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 206, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1485797380, "creation_date": 1468300799, "question_id": 38320570, "link": "https://stackoverflow.com/questions/38320570/the-up-arrow-in-ghcii-sh-does-not-scroll-through-command-history", "title": "The up arrow in ghcii.sh does not scroll through command history", "body": "<p>I'm using ghcii.sh and cygwin (windows 10).  The up arrow moves the cursor up one line instead of scrolling through command history.  How do I make it do the latter?  </p>\n"}, {"tags": ["haskell", "maybe"], "comments": [{"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1468378745, "post_id": 38318130, "comment_id": 64097909, "body": "Hi! I&#39;m the author of the package. I&#39;m sorry about the (ever widening) gap between 4.0 on GitHub and 3.2 on Hackage. I&#39;m still trying to cobble together a good-enough API for the new Web Socket API Slack put out, but maybe I&#39;ll just go ahead and publish it soon."}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1468441178, "post_id": 38318130, "comment_id": 64134345, "body": "I uploaded new docs for 4.0.0.0 here: <a href=\"http://hlian.github.io/linklater/hackage/\" rel=\"nofollow noreferrer\">hlian.github.io/linklater/hackage</a>"}], "answers": [{"comments": [{"owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "edited": false, "score": 0, "creation_date": 1468317105, "post_id": 38318159, "comment_id": 64065636, "body": "Thanks for the concise explanation. Is it possible to see what code a given version includes?"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "edited": false, "score": 0, "creation_date": 1468331151, "post_id": 38318159, "comment_id": 64075895, "body": "The links above show precisely what code is in version 3.2.0.0. If you go to the main Hackage page for <code>linklater</code>, you can change the version, and the go to the docs for that version to see the signatures. All versions on Hackage right now have the signature with <code>Maybe</code>."}, {"owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "edited": false, "score": 0, "creation_date": 1468333103, "post_id": 38318159, "comment_id": 64077464, "body": "But what about function bodies rather than signatures?"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "edited": false, "score": 0, "creation_date": 1468334731, "post_id": 38318159, "comment_id": 64078753, "body": "For <code>linklater-3.2.0.0</code>, there&#39;s a link on the right edge of the signature line for the &quot;source&quot;. This is only available on recently-built docs. The other option is to go to the top of the documentation page and click the &quot;source&quot; link in the upper right corner."}], "tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": true, "score": 7, "last_activity_date": 1468283359, "last_edit_date": 1468283359, "creation_date": 1468283057, "answer_id": 38318159, "question_id": 38318130, "link": "https://stackoverflow.com/questions/38318130/why-is-a-maybe-monad-enforced/38318159#38318159", "title": "Why is a Maybe monad enforced?", "body": "<p>Although the definition of <code>slashSimple</code> on GitHub master is as you reported, the Hackage version in <a href=\"https://hackage.haskell.org/package/linklater-3.2.0.0/docs/Network-Linklater.html#v:slashSimple\" rel=\"noreferrer\">linklater-3.2.0.0</a> is</p>\n\n<pre><code>slashSimple :: (Maybe Command -&gt; IO Text) -&gt; Application\n</code></pre>\n\n<p>If you want to use the package on Hackage, you'll need to update kittensBot to something like:</p>\n\n<pre><code>kittensBot :: Maybe Command -&gt; IO Text\nkittensBot Nothing = ...\nkittensBot (Just cmd) = do\n       putStrLn(\"+ Incoming command: \" ++ show cmd)\n       return \"ok\"\n</code></pre>\n\n<p>Alternatively, you can download the package from GitHub and manually install it.</p>\n"}], "owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 1, "accepted_answer_id": 38318159, "answer_count": 1, "score": 2, "last_activity_date": 1468283359, "creation_date": 1468282720, "question_id": 38318130, "link": "https://stackoverflow.com/questions/38318130/why-is-a-maybe-monad-enforced", "title": "Why is a Maybe monad enforced?", "body": "<p>I am attempting to implement a basic slackbot using the Network.Linklater package:</p>\n\n<p><a href=\"https://github.com/hlian/linklater\" rel=\"nofollow\">https://github.com/hlian/linklater</a></p>\n\n<p>This package defines the following function:</p>\n\n<pre><code>slashSimple :: (Command -&gt; IO Text) -&gt; Application\nslashSimple f =\n  slash (\\command _ respond -&gt; f command &gt;&gt;= (respond . responseOf status200))\n</code></pre>\n\n<p>I am attempting to consume this like so:</p>\n\n<pre><code>kittensBot :: Command -&gt; IO Text\nkittensBot cmd = do\n           putStrLn(\"+ Incoming command: \" ++ show cmd)\n           return \"ok\"\n\nmain :: IO ()\nmain = do\n     putStrLn (\"Listening on port: \" ++ show port)\n     run port (slashSimple kittensBot)\n     where\n       port = 3001\n</code></pre>\n\n<p>this produces (at compile time):</p>\n\n<pre><code>Main.hs:20:28:\n    Couldn't match type \u2018Maybe Command\u2019 with \u2018Command\u2019\n    Expected type: Maybe Command -&gt; IO Text\n      Actual type: Command -&gt; IO Text\n    In the first argument of \u2018slashSimple\u2019, namely \u2018kittensBot\u2019\n    In the second argument of \u2018run\u2019, namely \u2018(slashSimple kittensBot)\u2019\n</code></pre>\n\n<p>However the signature of <code>slashSimple</code> is <code>(Command -&gt; IO Text) -&gt; Application</code>. Shouldn't the signature of <code>kittensBot</code> fulfill that? Why doesn't it?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "edited": false, "score": 3, "creation_date": 1468273108, "post_id": 38316590, "comment_id": 64049681, "body": "No. The type of <code>(1+)</code> is <code>a -&gt; a</code>, where there must be an instance for <code>Num a</code>. So it can be <code>Int -&gt; Int</code> or <code>Integer -&gt; Integer</code>, because the instances <code>Num Int</code> and <code>Num Integer</code> are defined by the Prelude, but <code>(1+)</code> can&#39;t be <code>String -&gt; String</code> unless you define an instance <code>Num String</code>."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1468277873, "post_id": 38316590, "comment_id": 64051163, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/3742637/why-sum-x-y-is-of-type-num-a-a-a-a-in-haskell\">Why sum x y is of type (Num a) =&gt; a -&gt; a -&gt; a in Haskell?</a>"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 2, "creation_date": 1468349679, "post_id": 38316590, "comment_id": 64087718, "body": "Actually you are kinda right... Haskell has type classes (<code>Num</code> is one of them). They are implemented using so-called <i>dictionaries</i>. Basically functions that have some constraints like <code>Num a =&gt;</code> will become functions with <i>extra dictionary arguments</i> which are the dictionaries related to the classes in the constraints and they bring around the implementation of the various operations. In this case <code>(1+)</code> is equivalent to <code>\\numDict x -&gt; (+) numDict 1 x</code> (where <code>+</code> as you see takes an extra argument too). But forget about this until you have learnt more haskell."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1468402640, "post_id": 38316590, "comment_id": 64108817, "body": "Exactly. And a <code>Num</code>-dictionary is not at all a number, it&#39;s more like <i>the toolkit</i> that allows you to use values as numbers."}], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 5, "last_activity_date": 1468273140, "creation_date": 1468273140, "answer_id": 38316638, "question_id": 38316590, "link": "https://stackoverflow.com/questions/38316590/understanding-1/38316638#38316638", "title": "Understanding (1+)", "body": "<p><code>1+</code> takes an <code>a</code> and returns an <code>a</code> with the restriction that <code>a</code> must be an instance of <code>Num</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": false, "score": 4, "last_activity_date": 1468273177, "creation_date": 1468273177, "answer_id": 38316647, "question_id": 38316590, "link": "https://stackoverflow.com/questions/38316590/understanding-1/38316647#38316647", "title": "Understanding (1+)", "body": "<p>No, <code>Num a</code> is a <em>class constraint</em>, which is implied by the different arrow (<code>=&gt;</code>).</p>\n\n<p><code>+1</code> is a function from <code>a</code> to <code>a</code> where <code>a</code> must be an instance of the <code>Num</code> typeclass.</p>\n\n<p>For more information see the <a href=\"http://learnyouahaskell.com/types-and-typeclasses\" rel=\"nofollow\">part of Learn you a Haskell</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 489, "user_id": 3457759, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/dbc9ffc952d1b9de0db160785e7377e0?s=128&d=identicon&r=PG&f=1", "display_name": "Miguelme", "link": "https://stackoverflow.com/users/3457759/miguelme"}, "is_accepted": false, "score": 0, "last_activity_date": 1468378790, "creation_date": 1468378790, "answer_id": 38341959, "question_id": 38316590, "link": "https://stackoverflow.com/questions/38316590/understanding-1/38341959#38341959", "title": "Understanding (1+)", "body": "<p>No, in Haskell the part before the => means the class constraint to which a parameter has to be an instance of. So, </p>\n\n<pre><code>(1+) :: Num a =&gt; a -&gt; a \n</code></pre>\n\n<p>It means (1+) is a function that takes a parameter \"a\" and returns a parameter \"a\" where the parameter \"a\" has to be an instance of the class constraint Num.</p>\n\n<p>Here you can see the entire definition of the Num class constraint: <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#t:Num\" rel=\"nofollow\">http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#t:Num</a></p>\n"}], "owner": {"reputation": 117, "user_id": 3786813, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e89832a40fc616b33de68554d4c985b8?s=128&d=identicon&r=PG&f=1", "display_name": "thepen", "link": "https://stackoverflow.com/users/3786813/thepen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "accepted_answer_id": 38316638, "answer_count": 3, "score": 1, "last_activity_date": 1468378790, "creation_date": 1468272902, "question_id": 38316590, "link": "https://stackoverflow.com/questions/38316590/understanding-1", "title": "Understanding (1+)", "body": "<p>the type of 1+ is given as : </p>\n\n<pre><code>Prelude&gt; :t (1+)\n(1+) :: Num a =&gt; a -&gt; a\n</code></pre>\n\n<p>Is the correct way to read this function as : </p>\n\n<p>1+ takes a Num and returns a function of type <code>a -&gt; a</code> ?</p>\n"}, {"tags": ["haskell", "compilation", "llvm", "code-generation"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1468267073, "post_id": 38314767, "comment_id": 64046792, "body": "As it is the question is a bit broad. Perhaps you have some ideas for some of the instructions and only need help with a few, or...? I mean, we&#39;re not going to sit down and implement a complete compiler for you."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1468267822, "post_id": 38314767, "comment_id": 64047144, "body": "One option might be to look at the GHC LLVM code generator."}, {"owner": {"reputation": 473, "user_id": 4884986, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/19525ef8af5361c29db9b137f23dedf7?s=128&d=identicon&r=PG&f=1", "display_name": "David Anekstein", "link": "https://stackoverflow.com/users/4884986/david-anekstein"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1468272288, "post_id": 38314767, "comment_id": 64049369, "body": "@DanielWagner having you guys do all the work is not my intention. This is a similar question that may help <a href=\"http://stackoverflow.com/questions/6870483/translating-g-machine-source-to-llvm-ir\" title=\"translating g machine source to llvm ir\">stackoverflow.com/questions/6870483/&hellip;</a>"}, {"owner": {"reputation": 473, "user_id": 4884986, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/19525ef8af5361c29db9b137f23dedf7?s=128&d=identicon&r=PG&f=1", "display_name": "David Anekstein", "link": "https://stackoverflow.com/users/4884986/david-anekstein"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1468272538, "post_id": 38314767, "comment_id": 64049481, "body": "@DanielWagner I guess to be more specific, I&#39;d like to know how to simulate the same stack machine I have with a G Machine in LLVM, or at least something that can do the same thing. As I am not familiar with LLVM or the packages for it on Hackage, I was wondering if there is any functionality that will let me accomplish this. If there isn&#39;t, I&#39;m looking for a point in the right direction towards a functionality that can."}, {"owner": {"reputation": 473, "user_id": 4884986, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/19525ef8af5361c29db9b137f23dedf7?s=128&d=identicon&r=PG&f=1", "display_name": "David Anekstein", "link": "https://stackoverflow.com/users/4884986/david-anekstein"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1468273028, "post_id": 38314767, "comment_id": 64049661, "body": "One more point to add, @DanielWagner, I read in that similar link I posted that LLVM is a register machine, whereas the GMachine is a stack machine. So this is what I&#39;m trying to clear up. The top comment on that thread could use some elaboration, because as it is it does not help me much."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1468289151, "post_id": 38314767, "comment_id": 64053661, "body": "Try to get hold of some the early papers from the 80s that I (Lennart Augustsson) and Thomas Johnsson wrote.  They contain some of the information."}, {"owner": {"reputation": 9089, "user_id": 293147, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/247ce1ecd6cce2377ff3194386362392?s=128&d=identicon&r=PG", "display_name": "SK-logic", "link": "https://stackoverflow.com/users/293147/sk-logic"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1468341849, "post_id": 38314767, "comment_id": 64083603, "body": "@dfeuer, GHC is based on an STG, it&#39;s a totally different beast."}], "owner": {"reputation": 473, "user_id": 4884986, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/19525ef8af5361c29db9b137f23dedf7?s=128&d=identicon&r=PG&f=1", "display_name": "David Anekstein", "link": "https://stackoverflow.com/users/4884986/david-anekstein"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 161, "favorite_count": 0, "closed_date": 1468277010, "answer_count": 0, "score": 2, "last_activity_date": 1468331104, "creation_date": 1468265523, "last_edit_date": 1468331104, "question_id": 38314767, "link": "https://stackoverflow.com/questions/38314767/how-do-i-translate-g-code-to-llvm", "closed_reason": "Needs more focus", "title": "How do I translate G-Code to LLVM?", "body": "<p>I am following along the book <a href=\"http://research.microsoft.com/en-us/um/people/simonpj/Papers/pj-lester-book/\" rel=\"nofollow\">Implementing Functional Languages: A Tutorial</a> and have basically finished a Core compiler and interpreter using the G-Machine. In the description of the chapters, it is said that G-Code can be translated into machine code, but how? The G-Code (instructions) are meant to run a state transition machine, manipulating multiple stacks and association lists. How can something like this be done in LLVM using llvm-general/llvm-general-pure packages? At the end of it all, I'd like to make this compiler output an executable file.</p>\n\n<p>Here is how the state and the instructions look like: </p>\n\n<pre><code>type GmState = (GmOutput,   -- current output\n            GmCode,     -- current instruction stream\n            GmStack,    -- current stack\n            GmDump,     -- a stack for WHNF reductions\n            GmHeap,     -- heap of nodes\n            GmGlobals,  -- global addresses in heap\n            GmStats)    -- statistics\n\ntype GmOutput = [Char]\n\ntype GmCode = [Instruction]\n\ntype GmStack = [Addr]\n\ntype GmDump = [GmDumpItem]\ntype GmDumpItem = (GmCode, GmStack)\n\ntype GmHeap = Heap Node\n\ntype GmGlobals = ASSOC Name Addr\n\ntype GmStats = Int\n\ndata Instruction = Unwind -- unravels the spine of the evaluation tree (such as evaluating the next super combinator)\n             | Pushglobal Name -- push address of global to stack\n             | Pushint Int -- allocate node in heap, add address to stack\n             | Push Int -- pushes the nth address in the stack to the top of the stack\n             | Mkap -- takes first 2 pointers on stack and adds a new address to the top of the stack to both addresses\n             | Update Int -- updates the nth address in the stack in the heap, takes the address of the top of the stack\n             | Pop Int -- pops the first n addresses from the stack\n             | Slide Int -- like pop, but keeps the first address on top of the stack\n             | Alloc Int -- allocates n nodes in the heap and puts them on top of the stack\n             | Eval -- takes current code and puts it in the dump, evaluates the top address by unwinding\n             | Add | Sub | Mul | Div | Neg\n             | Eq | Ne | Lt | Le | Gt | Ge \n             | Cond GmCode GmCode\n             | Pack Int Int -- creates a new datatype by adding a unique name to the heap\n             | Casejump [(Int, GmCode)] -- evaluates a number of cases by matching alts with datatypes in the heap\n             | Split Int -- looks up first address of stack in heap, if exists then takes the list of addresses found and appends to stack\n             | Print -- write to GmOutput\n</code></pre>\n\n<p>What I would essentially like to know is this: is there any LLVM data structure that can mimic the GMachine, and if there is, what is it, and is a stack machine within LLVM the right approach?</p>\n"}, {"tags": ["haskell", "io"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1468262237, "post_id": 38313564, "comment_id": 64044259, "body": "Are you okay with your function consuming the separator between <code>Int</code>s? If so, it seems straightforward to cook up a loop that calls <code>getChar</code> until you see a separator, then call <code>readIO</code> on the resulting <code>String</code>."}, {"owner": {"reputation": 419, "user_id": 2552681, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S6MOJ.jpg?s=128&g=1", "display_name": "Mario Rom&#225;n", "link": "https://stackoverflow.com/users/2552681/mario-rom%c3%a1n"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1468262281, "post_id": 38313564, "comment_id": 64044284, "body": "Maybe it would work changing a &#39;\\n&#39; for a &#39; &#39; or something similar in the <code>getLine</code> implementation (?) <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.IO.Handle.Text.html#hGetLine\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.9.0.0/docs/src/&hellip;</a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1468262378, "post_id": 38313564, "comment_id": 64044340, "body": "That is essentially what I described, yes, though to begin with I would suggest skipping all the buffering-aware fanciness of the standard <code>getLine</code> implementation."}, {"owner": {"reputation": 419, "user_id": 2552681, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S6MOJ.jpg?s=128&g=1", "display_name": "Mario Rom&#225;n", "link": "https://stackoverflow.com/users/2552681/mario-rom%c3%a1n"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1468262399, "post_id": 38313564, "comment_id": 64044352, "body": "Oh, great, I have not seen that comment. I think it will work perfectly. Thanks, Daniel Wagner"}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 4, "last_activity_date": 1468262947, "creation_date": 1468262947, "answer_id": 38314075, "question_id": 38313564, "link": "https://stackoverflow.com/questions/38313564/is-there-a-getint-function-on-haskell/38314075#38314075", "title": "Is there a getInt function on Haskell?", "body": "<p>You could write such a function using <code>hLookAhead</code> and catching <code>isEOFError</code>. However, you'll be mixing your IO with your parsing.</p>\n\n<p>A more Haskellish solution is to define:</p>\n\n<pre><code>parseInts :: String -&gt; [Int]\nparseInts str = map read (words str)\n</code></pre>\n\n<p>and then use <code>parseInts</code> like this:</p>\n\n<pre><code>-- read an entire file and convert to a list of Ints\nnums &lt;- fmap parseInts getContents\n\n\n-- read just a line and convert to a list of Ints\nnums &lt;- fmap parseInts getLine\n</code></pre>\n\n<p>To parse a file which looks like:</p>\n\n<pre><code>3 4\n1 1 1 1\n2 2 2 2 \n3 3 3 3\n</code></pre>\n\n<p>(e.g. 3 = number of rows, 4 = number of columns), you have a bunch of options:</p>\n\n<pre><code>import Control.Monad (replicateM)\n\nmain = do\n  (nrows : ncols : _) &lt;- fmap parseInts getLine\n  rows &lt;- replicateM nrows $ fmap parseInts getLine\n</code></pre>\n\n<p>or</p>\n\n<pre><code>import Data.List.Split (chunksOf)\n\nmain = do\n  (nrows : ncols : rest) &lt;- fmap parseInts getContents\n  let rows = chunksOf ncols rest\n</code></pre>\n\n<p>or even:</p>\n\n<pre><code>main = do\n  (nrows : ncols : _) &lt;- fmap parseInts getLine\n  forM_ [1..nrows] $ \\i -&gt; do\n    row &lt;- fmap parseInts getLine\n    ... do something with row...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1468263126, "post_id": 38314078, "comment_id": 64044716, "body": "What happens if you encounter EOF? To do this robustly I think you need to use <code>hLookAhead</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1468263500, "post_id": 38314078, "comment_id": 64044904, "body": "@ErikR I have updated <code>getWord</code> to handle EOF gracefully."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1468270786, "post_id": 38314078, "comment_id": 64048670, "body": "Why not use <code>handleJust :: Exception e =&gt; (e -&gt; Maybe b) -&gt; (b -&gt; IO a) -&gt; IO a -&gt; IO a</code> with <code>handleJust (guard . isEOFError) (\\() -&gt; return []) $ do ...</code>?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1468270843, "post_id": 38314078, "comment_id": 64048705, "body": "@dfeuer Why is that better? The current code is simple, readable, and explicit. What advantages does your version have?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1468271037, "post_id": 38314078, "comment_id": 64048777, "body": "@DanielWagner, it just avoids explicitly re-throwing the exception. You can also do it your way using <code>handle</code> to avoid the flip."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1503264047, "last_edit_date": 1503264047, "creation_date": 1468262953, "answer_id": 38314078, "question_id": 38313564, "link": "https://stackoverflow.com/questions/38313564/is-there-a-getint-function-on-haskell/38314078#38314078", "title": "Is there a getInt function on Haskell?", "body": "<p>Here I turn my comment into an answer, since it seems the original asker is okay with consuming separators. First we will define a <code>getWord</code> analog to <code>getLine</code>; then we will <code>readIO</code> the result. We will be careful to catch EOF exceptions in case they occur.</p>\n\n<pre><code>import Control.Exception\nimport Control.Applicative\nimport Data.Char\nimport System.IO.Error\n\ngetWord :: IO String\ngetWord = handle handleEOF $ do\n  c &lt;- getChar\n  if isSpace c then return [] else (c:) &lt;$&gt; getWord\n  where\n  handleEOF e = if isEOFError e then return [] else throwIO e\n\nreadWord :: Read a =&gt; IO a\nreadWord = getWord &gt;&gt;= readIO\n</code></pre>\n\n<p>Beware: this will of course not work well for values to be read that have a space in them (like <code>Data.Map</code>s or other complex data types).</p>\n"}, {"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1468264090, "post_id": 38314155, "comment_id": 64045205, "body": "By the way, <code>withCString &quot;%d&quot; $ \\str -&gt; with 0 $ \\i -&gt; c_scanf str i &gt;&gt; peek i</code> will provide the same behaviour as <code>scanf(&quot;%d&quot;, %i)</code>. But that&#39;s just for fun and shouldn&#39;t be mixed with other Haskell functions."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1468267467, "post_id": 38314155, "comment_id": 64046963, "body": "Nice use of <code>hLookAhead</code>. Maybe we should also check for <code>isEOF</code>?"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 2, "last_activity_date": 1468263198, "creation_date": 1468263198, "answer_id": 38314155, "question_id": 38313564, "link": "https://stackoverflow.com/questions/38313564/is-there-a-getint-function-on-haskell/38314155#38314155", "title": "Is there a getInt function on Haskell?", "body": "<blockquote>\n  <p>Is there any simple/obvious way to create a getInt I am missing?</p>\n</blockquote>\n\n<p>No. There isn't one. You're looking for something along <code>scanf(\"%d\")</code>, which ignores all leading spaces and does not change the buffer if there's not a digit. You need to look ahead in this case:</p>\n\n<pre><code>import Data.Char (isSpace, isDigit, digitToInt)\nimport Data.List (foldl')\nimport Control.Monad (when)\nimport System.IO (hGetChar, hLookAhead, Handle, stdin)\n\ngetInt :: IO (Maybe Int)\ngetInt = hGetInt stdin\n\nhGetIntegral :: (Integral n) =&gt; Handle -&gt; IO (Maybe n)\nhGetIntegral h = do \n  hSkipSpace h\n  digits &lt;- hGetDigits h\n  return $ case digits of\n    [] -&gt; Nothing\n    xs -&gt; Just $ foldl' (\\x a -&gt; 10 * a + x) 0 . map digitToInt $ xs\n\nhGetDigits :: Handle -&gt; IO [Char]\nhGetDigits h = do\n  la &lt;- hLookAhead h\n  if isDigit la then hGetChar h &gt;&gt; fmap (la:) (hGetDigits h)\n                else return []\n\nhSkipSpace :: Handle -&gt; IO ()\nhSkipSpace h = do\n  la &lt;- hLookAhead h\n  when (isSpace la) $ hGetChar h &gt;&gt; hSkipSpace h\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 41, "user_id": 12671447, "user_type": "registered", "profile_image": "https://graph.facebook.com/2921208397929689/picture?type=large", "display_name": "Jonathan Layduhur", "link": "https://stackoverflow.com/users/12671447/jonathan-layduhur"}, "is_accepted": false, "score": 0, "last_activity_date": 1578440281, "creation_date": 1578440281, "answer_id": 59637600, "question_id": 38313564, "link": "https://stackoverflow.com/questions/38313564/is-there-a-getint-function-on-haskell/59637600#59637600", "title": "Is there a getInt function on Haskell?", "body": "<pre><code>readInt :: [Char] -&gt; Maybe Int\nreadInt [] = Nothing\nreadInt str = case reads str :: [(Int, String)] of\n    [(x ,\"\")] -&gt; (Just x)\n    _ -&gt; Nothing\n\ngetInt :: IO (Maybe Int)\ngetInt = do\n    nums &lt;- getLine\n    return (readInt nums)\n\n</code></pre>\n\n<p>here you go , you can take the maybe out if need to , a well place just or by modyfying it </p>\n\n<p>, aller bon courage</p>\n"}], "owner": {"reputation": 419, "user_id": 2552681, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S6MOJ.jpg?s=128&g=1", "display_name": "Mario Rom&#225;n", "link": "https://stackoverflow.com/users/2552681/mario-rom%c3%a1n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4986, "favorite_count": 2, "accepted_answer_id": 38314078, "answer_count": 4, "score": 5, "last_activity_date": 1578440281, "creation_date": 1468260924, "question_id": 38313564, "link": "https://stackoverflow.com/questions/38313564/is-there-a-getint-function-on-haskell", "title": "Is there a getInt function on Haskell?", "body": "<p>I would like to have a <code>getInt :: IO Int</code> function on Haskell. It would be a function that would take an integer from <strong>stdin</strong>, leaving the rest of the buffer intact.</p>\n\n<p>The library function with this type I have found, <code>readLn :: IO Int</code>, for example, would not work with an input like:</p>\n\n<pre><code>2\n3 4\n</code></pre>\n\n<p>Because it would take the entire line <code>3 4</code>, instead of taking <code>3</code> and leaving <code>4</code> for the next <code>getInt</code>. Although I know I could read the complete string and then split it using <code>words</code>, I would like to ask if there is a way which does not consume the buffer.</p>\n\n<p>Is there any function on the standard libraries doing this? Is there any simple/obvious way to create a <code>getInt</code> I am missing?</p>\n"}, {"tags": ["haskell", "llvm", "cabal"], "answers": [{"tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": true, "score": 1, "last_activity_date": 1468255945, "last_edit_date": 1468255945, "creation_date": 1468252105, "answer_id": 38311153, "question_id": 38309347, "link": "https://stackoverflow.com/questions/38309347/llvm-general-pure-fail-at-compilation/38311153#38311153", "title": "llvm-general-pure fail at compilation", "body": "<p>Although the <code>llvm-general-pure</code> claims to work for <code>base &lt; 5</code>, it does not support the GHC 8.0 changes to template haskell. In particular, the <code>DataD</code> constuctor <a href=\"http://hackage.haskell.org/package/template-haskell-2.10.0.0/docs/Language-Haskell-TH-Syntax.html#v:DataD\" rel=\"nofollow\">used to take 5 arguments</a>, but <a href=\"http://hackage.haskell.org/package/template-haskell-2.11.0.0/docs/Language-Haskell-TH-Syntax.html#v:DataD\" rel=\"nofollow\">now takes 6</a>. I have created a <a href=\"https://github.com/bscarlet/llvm-general/issues/171\" rel=\"nofollow\">ticket</a> on the project's GitHub page to bring this issue to the maintainer's attention.</p>\n"}], "owner": {"reputation": 3, "user_id": 6573908, "user_type": "registered", "profile_image": "https://graph.facebook.com/1737502256497559/picture?type=large", "display_name": "Antoine Ciuccoli-Favarel", "link": "https://stackoverflow.com/users/6573908/antoine-ciuccoli-favarel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 38311153, "answer_count": 1, "score": 0, "last_activity_date": 1468255945, "creation_date": 1468246931, "question_id": 38309347, "link": "https://stackoverflow.com/questions/38309347/llvm-general-pure-fail-at-compilation", "title": "llvm-general-pure fail at compilation", "body": "<p>I want to install the \"llvm-general\" package from cabal. But the \"llvm-general-pure\" (dependencies) fail at compilation :</p>\n\n<pre><code>[19 of 28] Compiling LLVM.General.Internal.PrettyPrint ( src/LLVM/General/Internal/PrettyPrint.hs, dist/build/LLVM/General/Internal/PrettyPrint.o )\n\nsrc/LLVM/General/Internal/PrettyPrint.hs:166:19: error:\n    \u2022 The constructor \u2018DataD\u2019 should have 6 arguments, but has been given 5\n    \u2022 In the pattern: DataD _ _ tvb cons _\n      In the pattern: TyConI (DataD _ _ tvb cons _)\n      In a case alternative: TyConI (DataD _ _ tvb cons _) -&gt; (tvb, cons)\n</code></pre>\n\n<p>And some other error.</p>\n\n<p>My configuration:</p>\n\n<blockquote>\n  <p>ghc -> 8.0.1</p>\n  \n  <p>cabal-install -> 1.24.0.0</p>\n</blockquote>\n\n<p>Any idea to fix it ? </p>\n"}, {"tags": ["haskell", "types", "type-signature"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 3, "creation_date": 1468242437, "post_id": 38307753, "comment_id": 64032035, "body": "That&#39;s not a type annotation, that&#39;s a pattern.  The whole thing is called an &quot;as pattern&quot;."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1468242933, "post_id": 38307753, "comment_id": 64032376, "body": "Always include all relevant code. The GitHub code might get deleted."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1468242989, "post_id": 38307753, "comment_id": 64032419, "body": "You don&#39;t &quot;save the type into a variable&quot;, that&#39;s nonsense. And what is a &quot;function that can operate within a type signature&quot;? (That would seem to speak about dependent types, but I believe you may be referring to entirely something else...)"}], "owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 72, "favorite_count": 0, "closed_date": 1468242879, "answer_count": 0, "score": 0, "last_activity_date": 1468243950, "creation_date": 1468242356, "last_edit_date": 1468243950, "question_id": 38307753, "link": "https://stackoverflow.com/questions/38307753/haskell-type-annotation", "closed_reason": "Duplicate", "title": "Haskell @ type annotation", "body": "<p>This code seems to use the <code>@</code> symbol to annotate a function signature,\n seemingly using it to save the type into a variable? </p>\n\n<p><a href=\"https://github.com/hlian/mathbot/blob/master/web/src/Main.hs#L63\" rel=\"nofollow\">https://github.com/hlian/mathbot/blob/master/web/src/Main.hs#L63</a></p>\n\n<p>mathbot cmd@(Just (Command \"math\" user channel (Just text)))</p>\n\n<p>Attempting to use a similar syntax results in <code>parse error on input \u2018@\u2019</code>.</p>\n\n<p>Does this do what I think it does? And if so where is it defined come from? And how does one define a function that can operate within a type signature?</p>\n"}, {"tags": ["haskell", "stream"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 2, "creation_date": 1468243119, "post_id": 38307729, "comment_id": 64032497, "body": "You should include your imports so we know which <code>InputStream</code> you are referring to. This type is defined is several different modules: <a href=\"http://hayoo.fh-wedel.de/?query=InputStream\" rel=\"nofollow noreferrer\">(link)</a>"}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1468246007, "post_id": 38307729, "comment_id": 64034711, "body": "One option would be to create a separate thread that&#39;d receive elements from one input <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Concurrent-Chan.html#t:Chan\" rel=\"nofollow noreferrer\"><code>Chan</code></a> and send them into two (or more) output channels. And then use <a href=\"https://hackage.haskell.org/package/io-streams-1.3.5.0/docs/System-IO-Streams-Concurrent.html\" rel=\"nofollow noreferrer\">System.IO.Streams.Concurrent</a> to bind them appropriately."}], "answers": [{"comments": [{"owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "edited": false, "score": 0, "creation_date": 1468404188, "post_id": 38311316, "comment_id": 64109846, "body": "I was not really aware that <code>inputFoldM</code> could be used that way, thanks!"}, {"owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "edited": false, "score": 0, "creation_date": 1470391234, "post_id": 38311316, "comment_id": 64943130, "body": "I noticed that the returned action actually resets the accumulator to its initial value again ... so for computations that return something each frame <i>and</i> rely on the accumulator (like running average) this does not work."}], "tags": [], "owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "is_accepted": true, "score": 2, "last_activity_date": 1468337214, "last_edit_date": 1468337214, "creation_date": 1468252644, "answer_id": 38311316, "question_id": 38307729, "link": "https://stackoverflow.com/questions/38307729/is-there-a-way-to-split-an-inputstream/38311316#38311316", "title": "Is there a way to split an InputStream?", "body": "<p>You can do this a number of ways, but since <code>countEvents</code> and <code>logEvents</code> are both folds over the stream, repeated applications of <code>outputFoldM</code> is probably the simplest. You aren't looking for a way to split the stream so much as a way to link the folds. <code>outputFoldM</code> turns a stream into a new stream associated with the result of applying a repeated fold operation to it, writing the result 'to the side' as you say.</p>\n\n<pre><code>&gt;&gt;&gt; let logger = IOS.inputFoldM (\\() x -&gt; print x &gt;&gt; putStrLn \"----\") ()\n&gt;&gt;&gt; let counter = IOS.inputFoldM (\\a _ -&gt; return $! a + 1) (0::Int)\n&gt;&gt;&gt; ls0 &lt;- IOS.fromList [1..5::Int]\n&gt;&gt;&gt; (ls1,io_count) &lt;- counter ls0\n&gt;&gt;&gt; (ls2,_) &lt;- logger ls1\n&gt;&gt;&gt; IOS.fold (+) 0 ls2\n1          -- here we see the \"logging\" happening from `logger`\n----\n2\n----\n3\n----\n4\n----\n5\n----\n15        -- this is the sum from the `fold (+) 0` that actually exhausted the stream\n&gt;&gt;&gt; io_count \n5         -- this is the result of `counter`\n</code></pre>\n\n<hr>\n\n<p>For what it's worth, I wrote a patch to make it possible to apply the <code>Fold</code>s and <code>FoldM</code>s from the <a href=\"http://hackage.haskell.org/package/foldl-1.2.1/docs/Control-Foldl.html\" rel=\"nofollow\"><code>foldl</code></a> library to <code>InputStreams</code> <a href=\"https://github.com/snapframework/io-streams/issues/53\" rel=\"nofollow\">https://github.com/snapframework/io-streams/issues/53</a> . This would permit you to apply indefinitely many simultaneous folds, discriminating elements as you please with lens, thus fitting the Arrow analogy you mention. Here's the same folds/sinks applied that way. I used <code>ApplicativeDo</code> to write the one big fold that does \"logging\" and collects statistics and formats them. The same thing can be written with the applicative operators.</p>\n\n<pre><code>{-#LANGUAGE ApplicativeDo #-}\n\nimport qualified System.IO.Streams as IOS\nimport qualified Control.Foldl as L\nimport Control.Lens (filtered)\n\nmain = do\n  ls &lt;- IOS.fromList [1..5::Int]\n  res &lt;- L.impurely IOS.foldM_ myfolds ls\n  putStrLn res\n\nmyfolds = do \n  sum_        &lt;- L.generalize L.sum     -- generalize makes an 'impure' fold\n  length_     &lt;- L.generalize L.length  -- out of a pure one like sum or length\n  odd_length_ &lt;- L.generalize (L.handles (filtered odd) L.length)\n  _           &lt;- L.sink (\\n -&gt; print n &gt;&gt; putStrLn \"-------\")\n  pure  (format sum_ length_  odd_length_)\n\n where  \n  format sum_ length_ odd_length_ = unlines\n     [ \"\"\n     , \"Results:\"\n     , \"sum:        \" ++ show sum_\n     , \"length:     \" ++ show length_\n     , \"number odd: \" ++ show odd_length_]\n</code></pre>\n\n<p>So this looks like this</p>\n\n<pre><code>&gt;&gt;&gt; main\n1\n-------\n2\n-------\n3\n-------\n4\n-------\n5\n-------\n\nResults:\nsum:        15\nlength:     5\nnumber odd: 3\n</code></pre>\n\n<p>The \"beautiful folding\" folds like the ones in <code>foldl</code> are nice since they are not special to any given framework. You can apply the <code>myfolds</code> without alteration to a list, a <code>Sequence</code>, an unboxed vector, a pipes <code>Producer</code>, conduit <code>Source</code> etc etc.. It's a separate discipline of hyper-composable folds and sinks.</p>\n"}], "owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "accepted_answer_id": 38311316, "answer_count": 1, "score": 1, "last_activity_date": 1468337214, "creation_date": 1468242293, "last_edit_date": 1468243213, "question_id": 38307729, "link": "https://stackoverflow.com/questions/38307729/is-there-a-way-to-split-an-inputstream", "title": "Is there a way to split an InputStream?", "body": "<p>I wonder if there is a way to \"split\"/\"duplicate\" an <code>System.IO.Streams.InputStream</code> from the <code>io-streams</code> package to be forwarded to two processing stages?</p>\n\n<pre><code>duplicate :: InputStream a -&gt; IO (InputStream a, InputStream a)\n</code></pre>\n\n<p>I can see that this probably doesn't work with the demand driven nature of streams, but what would be the canonical solution if you need several things to be processed? Would you build a pipeline that \"writes to the side\"? Like:</p>\n\n<pre><code>input &gt;&gt;= countEvents countIORef &gt;&gt;= logEvents loggerRef &gt;&gt;= output\n</code></pre>\n\n<p>I could probably go the <code>Arrow</code> route and store everything in tuples, but that is going to get dirty quickly and to my knowledge there is no Arrow interface to <code>io-streams</code>:</p>\n\n<pre><code>input &gt;&gt;= (countEvents *** logEvents) &gt;&gt;= output\n</code></pre>\n\n<p>Any recommendations?</p>\n"}, {"tags": ["haskell", "interpolation", "monads", "string-interpolation"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1468241580, "post_id": 38307393, "comment_id": 64031388, "body": "It&#39;s from <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Monoid.html\" rel=\"nofollow noreferrer\">Data.Monoid</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user933161"}, "edited": false, "score": 0, "creation_date": 1468265702, "post_id": 38307393, "comment_id": 64046067, "body": "Implicit import is horrible. It&#39;s a pity that haskell admits that."}], "answers": [{"comments": [{"owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "edited": false, "score": 0, "creation_date": 1468241862, "post_id": 38307497, "comment_id": 64031605, "body": "While I understand that mappend is more flexible than ++, wouldn&#39;t ++ have been completely sufficient in this case?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "edited": false, "score": 0, "creation_date": 1468242418, "post_id": 38307497, "comment_id": 64032021, "body": "It allows for easy transitioning between using Strings and using Text - you won&#39;t have to go through and change <code>++</code> to <code>Text.append</code>"}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 1, "creation_date": 1468243060, "post_id": 38307497, "comment_id": 64032461, "body": "Yes, it would have been sufficient."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1468253245, "last_edit_date": 1468253245, "creation_date": 1468241642, "answer_id": 38307497, "question_id": 38307393, "link": "https://stackoverflow.com/questions/38307393/unknown-haskell-operator/38307497#38307497", "title": "Unknown haskell operator; `&lt;&gt;`", "body": "<p>Use <a href=\"http://hayoo.fh-wedel.de/?query=%3C%3E\" rel=\"nofollow\">hayoo</a> to do a search for definitions in Hackage packages.</p>\n\n<p>In this case it appears that it is the <code>mappend</code> operator defined in <code>Data.Monoid</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 3, "last_activity_date": 1468264961, "creation_date": 1468264961, "answer_id": 38314615, "question_id": 38307393, "link": "https://stackoverflow.com/questions/38307393/unknown-haskell-operator/38314615#38314615", "title": "Unknown haskell operator; `&lt;&gt;`", "body": "<p>Traditionally, <code>&lt;&gt;</code> is primarily a function defined in <code>Data.Monoid</code>.</p>\n\n<pre><code>(&lt;&gt;) :: Monoid a =&gt; a -&gt; a -&gt; a\n(&lt;&gt;) = mappend\n</code></pre>\n\n<p>However, the <code>semigroups</code> package has long used it as a method of the <code>Semigroup</code> class in <code>Data.Semigroup</code>. As of GHC 8, <code>Data.Semigroup</code> has moved into the <code>base</code> package. There is currently a plan in place for making <code>Semigroup</code> a superclass of <code>Monoid</code>. Once this is complete, the <code>&lt;&gt;</code> function will be entirely replaced by the <code>&lt;&gt;</code> method.</p>\n"}], "owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 38314615, "answer_count": 2, "score": 0, "last_activity_date": 1468264961, "creation_date": 1468241378, "question_id": 38307393, "link": "https://stackoverflow.com/questions/38307393/unknown-haskell-operator", "title": "Unknown haskell operator; `&lt;&gt;`", "body": "<p>This code appears to use <code>&lt;&gt;</code> as an interpolation operator. \n<a href=\"https://github.com/hlian/linklater/blob/master/examples/app/JointPhotographicExpertsGroupTonga.hs\" rel=\"nofollow\">https://github.com/hlian/linklater/blob/master/examples/app/JointPhotographicExpertsGroupTonga.hs</a></p>\n\n<p>I can not find the documentation nor source for this operator. Any ideas what it does/where its from.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 3, "creation_date": 1468235037, "post_id": 38305027, "comment_id": 64027049, "body": "An obvious improvement would be to reverse the <code>changes</code> list. Lists are asymmetric, <code>last</code> and <code>init</code> are expensive, <code>head</code> and <code>tail</code> are cheap."}, {"owner": {"reputation": 235, "user_id": 2191305, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3d73f651dfaa3313c1a49471453295fd?s=128&d=identicon&r=PG", "display_name": "Mehmet &#199;a\u011fr\u0131 K&#246;se", "link": "https://stackoverflow.com/users/2191305/mehmet-%c3%87a%c4%9fr%c4%b1-k%c3%b6se"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1468236101, "post_id": 38305027, "comment_id": 64027717, "body": "Thanks for this suggestion, I totally forgot linked list structure of haskell lists."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1468239682, "post_id": 38305027, "comment_id": 64030085, "body": "My style suggestion is to forget the partial functions <code>head,tail</code> as well, and simply stick to pattern matching. I also second the n.m. suggestion of reversing the list: start with the larger coin."}], "answers": [{"comments": [{"owner": {"reputation": 235, "user_id": 2191305, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3d73f651dfaa3313c1a49471453295fd?s=128&d=identicon&r=PG", "display_name": "Mehmet &#199;a\u011fr\u0131 K&#246;se", "link": "https://stackoverflow.com/users/2191305/mehmet-%c3%87a%c4%9fr%c4%b1-k%c3%b6se"}, "edited": false, "score": 0, "creation_date": 1468236219, "post_id": 38305188, "comment_id": 64027786, "body": "As I have been working for a week(not in full day-night time) , Foldable, go and run does not ring a bell for now. But surely I will continue to study and revisit this solution."}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": false, "score": 1, "last_activity_date": 1468234668, "creation_date": 1468234668, "answer_id": 38305188, "question_id": 38305027, "link": "https://stackoverflow.com/questions/38305027/expressing-sum-of-money-in-terms-of-changes/38305188#38305188", "title": "Expressing sum of money in terms of changes", "body": "<p>A left fold solution would be:</p>\n\n<pre><code>change :: (Foldable t, Integral a) =&gt; a -&gt; t a -&gt; [(a, a)]\nchange total coin = foldl go (const []) coin total\n    where\n    go run c x = if x &lt; c then run x else (c, x `div` c): run (x `mod` c)\n</code></pre>\n\n<p>then:</p>\n\n<pre><code>\\&gt; change 126 [1, 2, 5, 10, 25, 50]\n[(50,2),(25,1),(1,1)]\n</code></pre>\n"}], "owner": {"reputation": 235, "user_id": 2191305, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3d73f651dfaa3313c1a49471453295fd?s=128&d=identicon&r=PG", "display_name": "Mehmet &#199;a\u011fr\u0131 K&#246;se", "link": "https://stackoverflow.com/users/2191305/mehmet-%c3%87a%c4%9fr%c4%b1-k%c3%b6se"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1468234668, "creation_date": 1468234066, "question_id": 38305027, "link": "https://stackoverflow.com/questions/38305027/expressing-sum-of-money-in-terms-of-changes", "title": "Expressing sum of money in terms of changes", "body": "<p>I have been studying Haskell for a week and trying to write some real world functions by myself. My aim is expressing sum of money in terms of respective coins and amount of said coins. But I am not sure if I am thinking \"functionally\" when i write functions. Example code is below;</p>\n\n<pre><code>changes = [1,2,5,10,25,50]\n\nmakechanges n cs = if n `div` (last cs) &gt; 0\n                     then (coin_amount, last cs) : makechanges (n - coin_amount * current_coin ) (init cs)\n                     else makechanges n (init cs)\n                   where coin_amount = n `div` (last cs)\n                         current_coin = last cs\n</code></pre>\n\n<p>Example output is </p>\n\n<pre><code>makechanges 126 changes\n[(50,2),(25,1),(1,1)]\n</code></pre>\n\n<p>Is there a more FP way to write intended function? I feel like this function is just conversion of imperative function, thanks in advance.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 1, "creation_date": 1468253501, "post_id": 38304962, "comment_id": 64039778, "body": "See <a href=\"http://stackoverflow.com/a/8676361/925978\">this answer</a> for the difference between <code>runhaskell</code> and <code>ghci</code>."}, {"owner": {"reputation": 198, "user_id": 4163764, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-isx3AQ2Jg_k/AAAAAAAAAAI/AAAAAAAAAIo/FZzg8_xH050/photo.jpg?sz=128", "display_name": "Prithvi Boinpally", "link": "https://stackoverflow.com/users/4163764/prithvi-boinpally"}, "edited": false, "score": 0, "creation_date": 1607096016, "post_id": 38304962, "comment_id": 115172985, "body": "Will the runhaskell command exhibit the exact same runtime program behavior as if we compiled the program and ran?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 198, "user_id": 4163764, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-isx3AQ2Jg_k/AAAAAAAAAAI/AAAAAAAAAIo/FZzg8_xH050/photo.jpg?sz=128", "display_name": "Prithvi Boinpally", "link": "https://stackoverflow.com/users/4163764/prithvi-boinpally"}, "edited": false, "score": 1, "creation_date": 1607111837, "post_id": 38304962, "comment_id": 115179496, "body": "@PrithviBoinpally no, but in most cases the main difference is performance."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1468238030, "last_edit_date": 1468238030, "creation_date": 1468233850, "answer_id": 38304962, "question_id": 38304703, "link": "https://stackoverflow.com/questions/38304703/haskellformac-why-use-runhaskell-command/38304962#38304962", "title": "haskellformac , why use &#39;runhaskell&#39; command?", "body": "<p>Yes, it will run slower, but depending on the application this may not matter at all. Many interesting tasks don't in fact require a lot of computations, so you wouldn't even notice the runtime difference between, say, Java and Ruby, though the latter is considered to have much worse performance.</p>\n\n<p>For such quick-run applications, what's rather more important is the <em>startup time</em>. With interpreted languages, this is often pretty immediate, whereas recompiling a script can take considerable time. So, interpreting can indeed be faster that compiling, in practise!</p>\n\n<p>Furthermore, just because the script is interpreted doesn't mean every single computation is. In fact, most of the critical stuff is often defined in libraries which <em>are</em> compiled and only called from the interpreted code \u2013 this is the single reason why languages like Python or Matlab can be competitive in scientifc computing: the computationally intensive routines are actually written in compiled C or Fortran, not the top-level language itself!</p>\n\n<p>Haskell gives you the advantages of both worlds (fast raw performance of a compiled language; quick usage and conciseness of an interpreted one), but without the need to actually have two different languages \u2013 you can simply choose which parts to run compiled and which to merely interpret!</p>\n\n<p>(This is not to say that this is a unique thing about Haskell \u2013 there exist in fact interpreters for pretty much all compiled languages. Only, it's normally not that common to run code interpreted except for debugging. But Haskell turns out to be well-suited even for scripting tasks that might normally be written in Python or Bash, but which nobody would bother to procure an entire Java or C++ project for.)</p>\n"}], "owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 714, "favorite_count": 0, "accepted_answer_id": 38304962, "answer_count": 1, "score": 0, "last_activity_date": 1468238030, "creation_date": 1468233010, "question_id": 38304703, "link": "https://stackoverflow.com/questions/38304703/haskellformac-why-use-runhaskell-command", "title": "haskellformac , why use &#39;runhaskell&#39; command?", "body": "<p>Reading <a href=\"http://blog.haskellformac.com/blog/running-command-line-programs\" rel=\"nofollow\">http://blog.haskellformac.com/blog/running-command-line-programs</a> : </p>\n\n<blockquote>\n  <p>This requires installing the Haskell for Mac command line tools as\n  outlined in a previous article. Those tools include a command named\n  runhaskell, it runs a Haskell program in \"script mode\" \u2014 i.e., it is\n  being interpreted, instead of compiled (much like, say, the Python\n  interpreter runs a Python script).</p>\n</blockquote>\n\n<p>Why provide a tool to run haskell in script mode ?</p>\n\n<p>As the code is being interpreted does this mean it will run slower in script mode ?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "edited": false, "score": 1, "creation_date": 1468232147, "post_id": 38303683, "comment_id": 64025274, "body": "see <a href=\"http://stackoverflow.com/questions/38271220/constructing-haskell-data-types-with-many-fields\" title=\"constructing haskell data types with many fields\">stackoverflow.com/questions/38271220/&hellip;</a>"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1468232812, "post_id": 38303683, "comment_id": 64025707, "body": "Do <code>Person</code> have fields with different types? If so there probably isn&#39;t a really simple way to fix this problem..."}], "answers": [{"tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": false, "score": 2, "last_activity_date": 1468235848, "last_edit_date": 1495535329, "creation_date": 1468233081, "answer_id": 38304728, "question_id": 38303683, "link": "https://stackoverflow.com/questions/38303683/reading-long-data-structure-in-haskell/38304728#38304728", "title": "Reading long data structure in Haskell", "body": "<p>EDIT: Simpler solution if you are reading from strings:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n\ndata Person = Person { name :: String, age :: Int, height :: Double }\n    deriving Show\n\nclass Person' a where\n    person :: a -&gt; [String] -&gt; Maybe Person\n\ninstance Person' Person where\n    person c [] = Just c\n    person _ _  = Nothing\n\ninstance (Read a, Person' b) =&gt; Person' (a -&gt; b) where\n    person f (x:xs) = person (f $ read x) xs\n    person _ _      = Nothing\n\ninstance {-# OVERLAPPING #-} Person' a =&gt; Person' (String -&gt; a) where\n    person f (x:xs) = person (f x) xs\n    person _ _      = Nothing\n</code></pre>\n\n<p>then, if the list is of the right size you get:</p>\n\n<pre><code>\\&gt; person Person $ words \"John 42 6.05\"\nJust (Person {name = \"John\", age = 42, height = 6.05})\n</code></pre>\n\n<p>and if not you get nothing:</p>\n\n<pre><code>\\&gt; person Person $ words \"John 42\"\nNothing\n</code></pre>\n\n<hr>\n\n<p><a href=\"https://stackoverflow.com/questions/38271220/constructing-haskell-data-types-with-many-fields/38272395#38272395\">Constructing Haskell data types with many fields</a> provides a solution when all the record fields are of the same type. If they are not, a slightly more polymorphic solution would be:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances, CPP #-}\n\ndata Person = Person { name :: String, age :: Int, height :: Double }\n    deriving Show\n\ndata Val = IVal Int | DVal Double | SVal String\n\nclass Person' a where\n    person :: a -&gt; [Val] -&gt; Maybe Person\n\ninstance Person' Person where\n    person c [] = Just c\n    person _ _  = Nothing\n\n#define PERSON(t, n)                                \\\ninstance (Person' a) =&gt; Person' (t -&gt; a) where {    \\\n    person f ((n i):xs) = person (f i) xs;          \\\n    person _ _ = Nothing; }                         \\\n\nPERSON(Int,    IVal)\nPERSON(Double, DVal)\nPERSON(String, SVal)\n</code></pre>\n\n<p>then,</p>\n\n<pre><code>\\&gt; person Person [SVal \"John\", IVal 42, DVal 6.05]\nJust (Person {name = \"John\", age = 42, height = 6.05})\n</code></pre>\n\n<p>In order to construct <code>Val</code> types, you may create another type-class and make the desired instances:</p>\n\n<pre><code>class Cast a where\n    cast :: a -&gt; Val\n\ninstance Cast Int    where cast = IVal\ninstance Cast Double where cast = DVal\ninstance Cast String where cast = SVal\n</code></pre>\n\n<p>then, it would be slightly simpler notation:</p>\n\n<pre><code>\\&gt; person Person [cast \"John\", cast (42 :: Int), cast 6.05]\nJust (Person {name = \"John\", age = 42, height = 6.05})\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1468242084, "post_id": 38306770, "comment_id": 64031753, "body": "I&#39;d strongly recommend considering standard approaches like cereal / binary / aeson / yaml."}], "tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 3, "last_activity_date": 1468239608, "creation_date": 1468239608, "answer_id": 38306770, "question_id": 38303683, "link": "https://stackoverflow.com/questions/38303683/reading-long-data-structure-in-haskell/38306770#38306770", "title": "Reading long data structure in Haskell", "body": "<p>First, it's always a good practice to include types for all top-level declaration. It makes code better structured and much more readable.</p>\n\n<p>One simple way how to achieve this is to take advantage of <a href=\"https://en.wikibooks.org/wiki/Haskell/Applicative_functors\" rel=\"nofollow\">applicative functors</a>. During parsing, you have an \"effectful\" computation where the effect is consuming part of the input and its result is one parsed piece. We can use the <code>State</code> monad to track the remaining input, and create a polymorphic function that consumes one element of the input and <code>read</code>s it:</p>\n\n<pre><code>import Control.Applicative\nimport Control.Monad.State\n\ndata Person = Person { name :: String, surname :: String, age :: Int }\n    deriving (Eq, Ord, Show, Read)\n\nreadField :: (Read a) =&gt; State [String] a\nreadField = state $ \\(x : xs) -&gt; (read x, xs)\n</code></pre>\n\n<p>And in order to parse many such fields we use the <code>&lt;$&gt;</code> and <code>&lt;*&gt;</code> combinators which allow to sequence operations as follows:</p>\n\n<pre><code>readPerson :: [String] -&gt; Person\nreadPerson = evalState $ Person &lt;$&gt; readField &lt;*&gt; readField &lt;*&gt; readField\n</code></pre>\n\n<p>Expression <code>Person &lt;$&gt; ...</code> is of type <code>State [String] Person</code> and we run <code>evalState</code> on given input to run the stateful computation and extract the output. We still need to have the same number of <code>readField</code> as many times as there are fields, but without having to use indices or explicit types.</p>\n\n<p>For a real program you'd probably include some error handling, as <code>read</code> fails with an exception, as well as the patterm <code>(x : xs)</code> if the input list is too short. Using a full-fledged parser such as <a href=\"https://hackage.haskell.org/package/parsec\" rel=\"nofollow\">parsec</a> or <a href=\"https://hackage.haskell.org/package/attoparsec\" rel=\"nofollow\">attoparsec</a> allows you to use the same notation and to have proper error handling, customize parsing of individual fields etc.</p>\n\n<hr>\n\n<p>Even more universal way is to automate wrapping and unwrapping fields into lists using <a href=\"https://wiki.haskell.org/Generics\" rel=\"nofollow\">generics</a>. Then you just derive <code>Generic</code>. If you're interested, I can give an example.</p>\n\n<p>Or, you could use an existing serialization package, either a binary one like <em>cereal</em> or <em>binary</em>, or a text-based one such as <em>aeson</em> or <em>yaml</em>, which usually allow you to do both (either automatically derive (de)serialization from <code>Generic</code> or provide your custom one).</p>\n"}], "owner": {"reputation": 83, "user_id": 6573742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb2efcae464e59ea2b6b4d2112bf9c5c?s=128&d=identicon&r=PG&f=1", "display_name": "Archangel", "link": "https://stackoverflow.com/users/6573742/archangel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 176, "favorite_count": 1, "answer_count": 2, "score": 6, "last_activity_date": 1468239608, "creation_date": 1468229917, "question_id": 38303683, "link": "https://stackoverflow.com/questions/38303683/reading-long-data-structure-in-haskell", "title": "Reading long data structure in Haskell", "body": "<p>I have to read a data structure from a text file (space separated), one data item per line. My first tentative would be</p>\n\n<pre><code>data Person = Person {name :: String, surname :: String, age :: Int, ... dozens of other fields} deriving (Show,...)\n\nmain = do\n  string &lt;- readFile \"filename.txt\"\n  let people = readPeople string\n  do_something people\n\nreadPeople s = map (readPerson.words) (lines s)\n\nreadPerson row = Person (read(row!!0)) (read(row!!1)) (read(row!!2)) (read(row!!3)) ... (read(row!!dozens))\n</code></pre>\n\n<p>This code works, but the code for <code>readPerson</code> is terrible: I have to copy-paste the <code>read(row!!n))</code> for all fields in my data structure!</p>\n\n<p>So, as a second attempt, I think that I might exploit Currying of the <code>Person</code> function, and pass it the arguments one at the time.</p>\n\n<p>Uhm, there must be something in Hoogle, but I cannot figure out the type signature ... Never mind, it looks simple enough and I can write it myself:</p>\n\n<pre><code>readPerson row = readFields Person row\n\nreadFields f [x] = (f x)\nreadFields f (x:xs) = readFields (f (read x)) xs\n</code></pre>\n\n<p>Ahh, looks much better coding style!</p>\n\n<p>But, it does not compile! <code>Occurs check: cannot construct the infinite type: t ~ String -&gt; t</code></p>\n\n<p>Indeed, the function <code>f</code> I am passing to <code>readFields</code> has a different type signature in each invocation; that's why I could not figure its type signature ...</p>\n\n<p>So, my question is: what is the simplest and elegant way to read a data structure with many fields?</p>\n"}, {"tags": ["sql", "haskell", "yesod", "persistent"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1468248807, "post_id": 38303674, "comment_id": 64036739, "body": "So your real question is: <i>Is there a way to see what SQL will be run from an esqueleto query?</i> The SQL generated from your <code>rawSql</code> statement should be exactly what you have there."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1468249447, "post_id": 38303674, "comment_id": 64037157, "body": "Related question: <a href=\"http://stackoverflow.com/questions/20435797/how-can-i-get-esqueleto-to-generate-an-sql-string-for-me\">How can I get esqueleto to generate an SQL string for me?</a>"}, {"owner": {"reputation": 3893, "user_id": 126128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/65a7e11b6458430a621588e449b8f36a?s=128&d=identicon&r=PG", "display_name": "Kris Jenkins", "link": "https://stackoverflow.com/users/126128/kris-jenkins"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1468415955, "post_id": 38303674, "comment_id": 64118029, "body": "Well, since Esqueleto&#39;s just using Persistent under the hood, my question is &quot;how do I turn any <code>SqlPersistM</code> into a string?&quot; I know it&#39;s possible, because eventually the DB connection will require it. The question is, is that conversion user-accessible?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1468418524, "post_id": 38303674, "comment_id": 64120065, "body": "SqlPersistM is too low-level - it is literally a fragment of code - it&#39;s not data. You can run that code against a dummy database, or a database driver with logging turned on, but otherwise there is no way to extract out a &quot;query&quot;."}, {"owner": {"reputation": 3893, "user_id": 126128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/65a7e11b6458430a621588e449b8f36a?s=128&d=identicon&r=PG", "display_name": "Kris Jenkins", "link": "https://stackoverflow.com/users/126128/kris-jenkins"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1468426984, "post_id": 38303674, "comment_id": 64126281, "body": "If that&#39;s true, how does it manage to send a query string to the database when you run it? I mean, if you enable logging, you&#39;ll see a string, so it must be involved <i>somewhere</i>."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1468429900, "post_id": 38303674, "comment_id": 64127973, "body": "Fundamentally a SqlPersistM is an IO-action. When you run it you need to provide a connection. The SqlPersistM action generates the SQL and gives it to the connection. If the connection logs it somewhere you&#39;ll see it in a log file. If you use a sqlite memory connection like in the SO answer I referenced above, perhaps you can see what the SQL is."}], "owner": {"reputation": 3893, "user_id": 126128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/65a7e11b6458430a621588e449b8f36a?s=128&d=identicon&r=PG", "display_name": "Kris Jenkins", "link": "https://stackoverflow.com/users/126128/kris-jenkins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 139, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1468230455, "creation_date": 1468229888, "last_edit_date": 1468230455, "question_id": 38303674, "link": "https://stackoverflow.com/questions/38303674/can-i-see-the-sql-that-a-sqlpersistm-block-would-run-without-running-the-quer", "title": "Can I see the SQL that a `SQLPersistM` block would run, without running the query?", "body": "<p>I've got a query like this in <code>persistent</code>:</p>\n\n<pre><code>findUserLocation userId =\n  rawSql [str|SELECT name, ST_Transform(coordinates, 4326)\n               FROM user \n                 JOIN user_location USING (user_id)\n               WHERE user.user_id = ?|]\n         [toPersistValue userId]\n</code></pre>\n\n<p>I'd like to rewrite this so it doesn't use raw strings, probably into an Esqueleto query, but I want to be sure the end result is equivalent.</p>\n\n<p>Is there a way I can check the SQL my new query will produce <em>without a database connection</em>?<br>\nIs there something like <code>SqlPersistM a -&gt; [Text]</code>? (I've searched, to no avail...)</p>\n\n<p>Or do I have to connect to the DB to verify the query?</p>\n"}, {"tags": ["regex", "sqlite", "haskell"], "comments": [{"owner": {"reputation": 157205, "user_id": 11654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/586424ca0847070dc1868aa58077003e?s=128&d=identicon&r=PG", "display_name": "CL.", "link": "https://stackoverflow.com/users/11654/cl"}, "edited": false, "score": 1, "creation_date": 1468222870, "post_id": 38301455, "comment_id": 64019583, "body": "I don&#39;t know Haskell, but this code looks as if it&#39;s preparing the statement before installing the function."}, {"owner": {"reputation": 729, "user_id": 2181977, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0b84fe9137990458c9a91dcadd10579c?s=128&d=identicon&r=PG", "display_name": "Fredrik Karlsson", "link": "https://stackoverflow.com/users/2181977/fredrik-karlsson"}, "reply_to_user": {"reputation": 157205, "user_id": 11654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/586424ca0847070dc1868aa58077003e?s=128&d=identicon&r=PG", "display_name": "CL.", "link": "https://stackoverflow.com/users/11654/cl"}, "edited": false, "score": 0, "creation_date": 1468224294, "post_id": 38301455, "comment_id": 64020385, "body": "You&#39;re right! Of course! Please forgive my stupidity! That works!"}], "answers": [{"tags": [], "owner": {"reputation": 729, "user_id": 2181977, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0b84fe9137990458c9a91dcadd10579c?s=128&d=identicon&r=PG", "display_name": "Fredrik Karlsson", "link": "https://stackoverflow.com/users/2181977/fredrik-karlsson"}, "is_accepted": true, "score": 0, "last_activity_date": 1468224370, "creation_date": 1468224370, "answer_id": 38301973, "question_id": 38301455, "link": "https://stackoverflow.com/questions/38301455/regexp-function-created-for-sqlite-using-direct-sqlite-but-the-operator-regex/38301973#38301973", "title": "&quot;regexp&quot; function created for SQLite using direct-sqlite, but the operator REGEXP is not available", "body": "<blockquote>\n  <p>I don't know Haskell, but this code looks as if it's preparing the\n  statement before installing the function. \u2013 CL. 24 mins ago</p>\n</blockquote>\n\n<p>Silly me.</p>\n"}], "owner": {"reputation": 729, "user_id": 2181977, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0b84fe9137990458c9a91dcadd10579c?s=128&d=identicon&r=PG", "display_name": "Fredrik Karlsson", "link": "https://stackoverflow.com/users/2181977/fredrik-karlsson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 258, "favorite_count": 1, "accepted_answer_id": 38301973, "answer_count": 1, "score": 0, "last_activity_date": 1468224370, "creation_date": 1468222470, "question_id": 38301455, "link": "https://stackoverflow.com/questions/38301455/regexp-function-created-for-sqlite-using-direct-sqlite-but-the-operator-regex", "title": "&quot;regexp&quot; function created for SQLite using direct-sqlite, but the operator REGEXP is not available", "body": "<p>I'm using the <code>direct-sqlite</code> package for Haskell to query an SQLite database. I need REGEXP matching, so I've constructed a Haskell function that implements the functionality, and inserted it into the database connection.</p>\n\n<pre><code>import Text.Regex.Base.RegexLike\nimport qualified Text.Regex.PCRE.ByteString as PCRE\nimport Database.SQLite3\n\ndata UmeQuery = UmeQuery Text [SQLData]  deriving Show\ndata Segment = Segment SegmentLabel SegmentStart SegmentEnd Session LabelType Checksum deriving (Show)\n\nrunUmeQuery :: UmeQuery -&gt; FilePath -&gt; IO [Segment] \nrunUmeQuery eq  dbFile = do\n    conn &lt;- open $ pack dbFile\n    res &lt;- runUmeQuery' eq conn\n    return res\n\nrunUmeQuery' :: UmeQuery -&gt; Database -&gt; IO [Segment] \nrunUmeQuery' (UmeQuery q args) conn = do\n    statement &lt;- prepare conn q\n    createFunction conn \"regexp\" (Just 2) True sqlRegexp\n    bind statement args\n    res &lt;- fmap reverse $ getRows statement []\n    Database.SQLite3.finalize statement\n    close conn\n    return res\n\ngetRows :: Statement  -&gt; [Segment] -&gt; IO [Segment]\ngetRows stmt  acc = do\n  r &lt;- step stmt\n  case r of\n    Done -&gt; return acc\n    Row -&gt; do\n      sess &lt;- columnText stmt 0\n      lt &lt;- columnText stmt 1\n      start &lt;- columnDouble stmt 3\n      end &lt;- columnDouble stmt 4\n      label &lt;- columnText stmt 5\n      checksum &lt;- columnText stmt 6\n      getRows stmt ((Segment label start end sess lt checksum):acc)\n\n\nsqlRegexp :: FuncContext -&gt; FuncArgs -&gt; IO ()\nsqlRegexp ctx args = do\n    reg &lt;- fmap encodeUtf8 $ funcArgText args 0\n    text &lt;- fmap encodeUtf8 $ funcArgText args 1\n    res &lt;- pcreRegex reg text\n    funcResultInt64 ctx res\n    where\n        pcreRegex reg b = do\n            reC &lt;- pcreCompile reg\n            re &lt;- case reC of\n                (Right r) -&gt; return r\n                (Left (_,e) ) -&gt; fail e\n            reE &lt;- PCRE.execute re b\n            case reE of\n                (Right (Just _)) -&gt; return (1 :: Int64)\n                (Right (Nothing)) -&gt; return (0 :: Int64)\n                (Left (_,e)) -&gt; fail e -- Not a good idea maybe, but I have no use for error messages.\n            where pcreCompile = PCRE.compile defaultCompOpt defaultExecOpt\n</code></pre>\n\n<p>So, basically, the query functions opens a connection, inserts a \"regexp\" function and executes a query (in a data type). This is according to the manual:</p>\n\n<blockquote>\n  <p>The REGEXP operator is a special syntax for the regexp() user\n  function. No regexp() user function is defined by default and so use\n  of the REGEXP operator will normally result in an error message. If an\n  application-defined SQL function named \"regexp\" is added at run-time,\n  then the \"X REGEXP Y\" operator will be implemented as a call to\n  \"regexp(Y,X)\".\n  <a href=\"https://www.sqlite.org/lang_expr.html#like\" rel=\"nofollow\">https://www.sqlite.org/lang_expr.html#like</a></p>\n</blockquote>\n\n<p>Now, the problem is that the function is not available in queries:</p>\n\n<pre><code>&gt; let b = UmeQuery (pack \"select * from segments where label REGEXP '.*';\") []\n*Phonetic.Database.UmeQuery\n&gt; out &lt;- runUmeQuery b \"./umecore-hs/testdata/umetest.umedb\"\n*** Exception: SQLite3 returned ErrorError while attempting to perform prepare \"select * from segments where label REGEXP '.*';\": no such function: REGEXP\n</code></pre>\n\n<p>How do I make it available??</p>\n"}, {"tags": ["haskell", "pattern-matching"], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 1, "last_activity_date": 1468230231, "last_edit_date": 1468230231, "creation_date": 1468221798, "answer_id": 38301284, "question_id": 38299660, "link": "https://stackoverflow.com/questions/38299660/how-to-do-pattern-match-in-haskell-options-applicative-for-record-type/38301284#38301284", "title": "How to do pattern match in haskell options.applicative for record type?", "body": "<p>Since <code>String</code> is just a type synonym for <code>[Char]</code>, you can match on non-empty strings with the pattern <code>_:_</code>, i.e. a non-empty list with a head element <code>_</code> (whatever) and a tail list <code>_</code> (whatever).</p>\n\n<p>So you could have three cases:</p>\n\n<ul>\n<li><code>Options {xml = _:_, eut = []}</code>: <code>xml</code> is set, <code>eut</code> is unset</li>\n<li><code>Options {xml = [], eut = _:_}</code>: <code>eut</code> is set, <code>xml</code> is unset</li>\n<li><code>_</code>: All the rest (either neither is set, or both are)</li>\n</ul>\n\n<p>Alternatively, you could go with a <a href=\"https://downloads.haskell.org/~ghc/7.6.1/docs/html/users_guide/syntax-extns.html#multi-way-if\" rel=\"nofollow\">multi-way <code>if</code></a>:</p>\n\n<pre><code>Options{..} &lt;- execParser ...\nif | not (null xml) &amp;&amp; null eot -&gt; ...\n   | not (null eot) &amp;&amp; null xml -&gt; ...\n   | otherwise -&gt; error ...\n</code></pre>\n"}], "owner": {"reputation": 431, "user_id": 2494308, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/bb275bbce79ac1fe4761d87d2c355921?s=128&d=identicon&r=PG", "display_name": "Max Li", "link": "https://stackoverflow.com/users/2494308/max-li"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1468230231, "creation_date": 1468214713, "last_edit_date": 1468230115, "question_id": 38299660, "link": "https://stackoverflow.com/questions/38299660/how-to-do-pattern-match-in-haskell-options-applicative-for-record-type", "title": "How to do pattern match in haskell options.applicative for record type?", "body": "<p>I use <code>Options.Applicative</code> to handle haskell command line, my record type for option is like:</p>\n\n<pre><code>data Options = Options {  xml :: String\n                          ,eut :: String\n                       } deriving (Show)\n\noptions :: Parser Options\noptions = Options\n              &lt;$&gt; strOption ( short 'x'\n                              &lt;&gt; long \"xml\"\n                              &lt;&gt; metavar \"XMLFILE\"\n                              &lt;&gt; value []\n                              &lt;&gt; help \"GCCXML file for parsing\" )\n              &lt;*&gt; strOption ( short 'e'\n                              &lt;&gt; long \"eut\"\n                              &lt;&gt; metavar \"PATH_2_EUT\"\n                              &lt;&gt; value []\n                              &lt;&gt; help \"EUT Json filepath for parsing\" )\n</code></pre>\n\n<p>Then in my haskell main code, I have:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  options &lt;- execParser parseOpts\n  case options of\n    Options {xml = [], eut = []} -&gt; putStrLn \"use -h to print usage info\"\n    -- xml option\n    Options {xml = _, eut = []} -&gt; parseXML $ xml options\n    -- eut option\n    Options {xml = [], eut = _} -&gt; genMeta $ eut options\n    -- no matching\n    _ -&gt; putStrLn \"use -h to print usage info\"\n  where\n    parseOpts = info (helper &lt;*&gt; options)\n      ( fullDesc\n        &lt;&gt; progDesc \"Given GCCXML file, generate EUT json and test meta files\"\n        &lt;&gt; header \"map2meta - Generate test meta files\" )\n</code></pre>\n\n<p>My intention is to do processing either for <code>\"-x\"</code> or <code>\"-e\"</code>. I achieve this by using pattern <code>Options {xml = _, eut = []}</code> to match the case that command line has <code>\"-x\"</code> but no <code>\"-e\"</code>, whereas <code>Options {xml = [], eut = _ }</code> to match the case that command line has <code>\"-e\"</code> but no <code>\"-x\"</code>. However, when I run the program without any options, it seems <code>Options {xml = _ , eut = [] }</code> get matched. So I added <code>Options {xml = [], eut = []}</code> to intercept that case. I think the placeholder '_' actually can be used to match a '[]', though I hoped it would only match to 'something' instead of an empty string. Hence, my first question is how to create a pattern to match a non-empty string?</p>\n\n<p>My second question is how to add code to print out the usage info? Right now, it only print it when I use <code>\"-h\"</code>. I want to print it when there is no options provided in the command line.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 6, "creation_date": 1468202327, "post_id": 38298119, "comment_id": 64013126, "body": "Currently, the type of <code>test</code> is implicitly <code>forall a. (a -&gt; a) -&gt; (Test -&gt; Test)</code> due to how Haskell infers universal quantification from free type variables. However, what you actually want here is <code>(forall a. a -&gt; a) -&gt; (Test -&gt; Test)</code>, which requires the <code>RankNTypes</code> language extension to be enabled."}, {"owner": {"reputation": 2484, "user_id": 105634, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/ab2425ae0425be8faaf052cce737b243?s=128&d=identicon&r=PG", "display_name": "Jasiu", "link": "https://stackoverflow.com/users/105634/jasiu"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1468204355, "post_id": 38298119, "comment_id": 64013486, "body": "That explains it, thanks!"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1468221911, "post_id": 38298119, "comment_id": 64019071, "body": "@AlexisKing: for this function, <code>Rank2Types</code> is enough. Currently, GHC implements <code>Rank2Types</code> via <code>RankNTypes</code> but theoretically there is a possibility to do more type inference if you only use rank-2 types; getting into the habit of using the right language extension should be more future-proof in case GHC gets type inference of rank-2 types at some point."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1468620327, "post_id": 38298119, "comment_id": 64219758, "body": "@Cactus The official GHC documentation considers <code>Rank2Types</code> to be nothing short of deprecated, so I see no reason to believe there is any intention to make the sort of change you suggest."}], "answers": [{"tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": true, "score": 2, "last_activity_date": 1468263357, "creation_date": 1468263357, "answer_id": 38314204, "question_id": 38298119, "link": "https://stackoverflow.com/questions/38298119/how-to-apply-polymorphic-function-to-a-concrete-type/38314204#38314204", "title": "How to apply polymorphic function to a concrete type?", "body": "<p>The basic problem here is how Haskell infers quantification from free variables in type signatures. Given the following type signature...</p>\n\n<pre><code>test :: (a -&gt; a) -&gt; (Test -&gt; Test)\n</code></pre>\n\n<p>...the type variable <code>a</code> is unbound. Haskell automatically converts unbound type variables into universal quantification constraints, so the above type is actually interpreted like this:</p>\n\n<pre><code>test :: forall a. (a -&gt; a) -&gt; (Test -&gt; Test)\n</code></pre>\n\n<p>Now the error you are getting might make a little bit more sense\u2014the type variable <code>a</code> can only unify with <em>one</em> type per invocation of <code>test</code>, which is decided by the caller. Therefore, the <code>(a -&gt; a)</code> function could be <code>String -&gt; String</code> or <code>Int -&gt; Int</code> or any other type, but it can never be a function that works on both <code>A</code> and <code>B</code>.</p>\n\n<p>Obviously, though, you had a different intent when you wrote that type signature. You wanted the <code>(a -&gt; a)</code> function to be a type signature like the one for <code>id</code>: a function that truly works for <em>any</em> value, not some particular function for some particular choice of <code>a</code>. To specify this, you must make the <code>forall</code> explicit so that the compiler knows precisely how that type variable should be quantified:</p>\n\n<pre><code>test :: (forall a. a -&gt; a) -&gt; (Test -&gt; Test)\n</code></pre>\n\n<p>However, the above type is actually not valid in standard Haskell. It <em>is</em> supported by GHC, though, by using the <code>Rank2Types</code> or <code>RankNTypes</code> extension, which permits \u201chigher rank\u201d polymorphism like the type signature above.</p>\n"}], "owner": {"reputation": 2484, "user_id": 105634, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/ab2425ae0425be8faaf052cce737b243?s=128&d=identicon&r=PG", "display_name": "Jasiu", "link": "https://stackoverflow.com/users/105634/jasiu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "accepted_answer_id": 38314204, "answer_count": 1, "score": 1, "last_activity_date": 1468263357, "creation_date": 1468202014, "question_id": 38298119, "link": "https://stackoverflow.com/questions/38298119/how-to-apply-polymorphic-function-to-a-concrete-type", "title": "How to apply polymorphic function to a concrete type?", "body": "<p>Below is a distilled version of a problem I encountered while learning Haskell:</p>\n\n<pre><code>data A = A\ndata B = B\n\ndata Test = TestA A\n          | TestB B\n\ntest :: (a -&gt; a) -&gt; (Test -&gt; Test)\ntest op t =\n  case t of\n    TestA a -&gt; TestA $ op a\n    TestB b -&gt; TestB $ op b\n\ntestA = test id (TestA A)\ntestB = test id (TestB B)\n</code></pre>\n\n<p>Trying to compile this gives the following error:</p>\n\n<blockquote>\n  <p>Couldn't match expected type \u2018B\u2019 with actual type \u2018a\u2019</p>\n  \n  <p>\u2018a\u2019 is a rigid type variable bound by\n  the type signature for test :: (a -> a) -> Test -> Test</p>\n</blockquote>\n\n<p>What's going on? I thought that when I pass in a polymorphic function, I should be able to apply it to values of different concrete types.</p>\n"}, {"tags": ["haskell", "profiling", "ghc"], "answers": [{"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 7, "last_activity_date": 1468203446, "creation_date": 1468203446, "answer_id": 38298277, "question_id": 38298095, "link": "https://stackoverflow.com/questions/38298095/ghc-profiling-file-and-chart-are-contradictory/38298277#38298277", "title": "GHC profiling file and chart are contradictory", "body": "<p>This seems to confuse many people.</p>\n\n<blockquote>\n<pre><code>total alloc = 5,128,702,952 bytes  (excludes profiling overheads)\n</code></pre>\n</blockquote>\n\n<p>This is literally the total size of all the allocations ever performed by your program, including \"temporary\" objects that become dead almost immediately after being allocated. Allocation itself is nearly free, and generally Haskell programs allocate at a rate of around 1-2 GB/s.</p>\n\n<blockquote>\n  <p>Weirdly, the profiling graph shows something completely different:</p>\n</blockquote>\n\n<p>Indeed, the profiling graph shows the total size of all the objects that are live on the heap at any particular time. This reflects the space usage of your program. If your program runs in constant space, then the number shown in this graph will stay constant.</p>\n"}], "owner": {"reputation": 4009, "user_id": 1549476, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/dxQHN.png?s=128&g=1", "display_name": "k_g", "link": "https://stackoverflow.com/users/1549476/k-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 38298277, "answer_count": 1, "score": 3, "last_activity_date": 1468203446, "creation_date": 1468201792, "question_id": 38298095, "link": "https://stackoverflow.com/questions/38298095/ghc-profiling-file-and-chart-are-contradictory", "title": "GHC profiling file and chart are contradictory", "body": "<p>I have a sieve of Eratosthenes program written in <code>ST.Strict</code>, and I was profiling it when I saw that it was taking a ridiculous amount of memory:</p>\n\n<pre><code>Sun Jul 10 18:27 2016 Time and Allocation Profiling Report  (Final)\n\n   Primes +RTS -hc -p -K1000M -RTS 10000000\n\ntotal time  =        2.32 secs   (2317 ticks @ 1000 us, 1 processor)\ntotal alloc = 5,128,702,952 bytes  (excludes profiling overheads)\n</code></pre>\n\n<p>(where 10^7) is the amount of primes I asked it to generate.</p>\n\n<p>Weirdly, the profiling graph shows something completely different:</p>\n\n<p><a href=\"https://i.stack.imgur.com/hoUau.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/hoUau.png\" alt=\"profiling graph\"></a></p>\n\n<p>Am I misreading something in one of these graphs? Or is there something wrong with one of these tools?</p>\n\n<p>For reference, my code is</p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\n\nimport Prelude hiding (replicate, read)\nimport qualified Text.Read as T\nimport Data.Vector.Unboxed.Mutable(replicate, write, read)\nimport Control.Monad.ST.Strict\nimport Data.STRef\nimport Control.Monad.Primitive\n\nimport Control.Monad\n\nimport System.Environment\n\nmain = print . length . primesUpTo . T.read . head =&lt;&lt; getArgs\n\nprimesUpTo :: Int -&gt; [Int]\nprimesUpTo n = runST $ do\n        primes &lt;- replicate n True\n        write primes 0 False\n        write primes 1 False\n        sieve 2 primes\n        return []\n        -- Removed to avoid the memory allocation of creating the list for profiling purposes\n        -- filterM (read primes) [0..n-1]\n\n    where\n    sieve !i primes | i * i &gt;= n    = return primes\n    sieve !i primes = do\n        v &lt;- read primes i\n        counter &lt;- newSTRef $ i * i\n        when v $ whileM_ ((&lt; n) &lt;$!&gt; readSTRef counter) $ do\n            curr_count &lt;- readSTRef counter\n            write primes curr_count False\n            writeSTRef counter (curr_count + i)\n        sieve (i + 1) primes\n\nwhileM_ :: (Monad m) =&gt; m Bool -&gt; m a -&gt; m ()\nwhileM_ condition body = do\n    cond &lt;- condition\n    when cond $ do\n        body\n        whileM_ condition body\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 2, "creation_date": 1468228478, "post_id": 38298084, "comment_id": 64022816, "body": "Related: <a href=\"http://stackoverflow.com/questions/7787317/list-of-different-types\" title=\"list of different types\">stackoverflow.com/questions/7787317/list-of-different-types</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1029, "user_id": 668074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f82d3dd033cd691ad5340b9620bdcf38?s=128&d=identicon&r=PG", "display_name": "user668074", "link": "https://stackoverflow.com/users/668074/user668074"}, "edited": false, "score": 0, "creation_date": 1468205113, "post_id": 38298299, "comment_id": 64013616, "body": "I suppose this is a good solution, I&#39;m just concerned about the scalability of algebraic data types if there are a lot of possible pet or animal types."}], "tags": [], "owner": {"reputation": 1859, "user_id": 463897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2a9d30a2487a924165aaaa016b54f87?s=128&d=identicon&r=PG", "display_name": "Olathe", "link": "https://stackoverflow.com/users/463897/olathe"}, "is_accepted": true, "score": 6, "last_activity_date": 1468204186, "last_edit_date": 1468204186, "creation_date": 1468203714, "answer_id": 38298299, "question_id": 38298084, "link": "https://stackoverflow.com/questions/38298084/lists-of-mixed-types-using-wrappers-in-haskell/38298299#38298299", "title": "Lists of mixed types using wrappers in Haskell", "body": "<p>Yes. You'd use something like this:</p>\n\n<pre><code>data Pet = ItsACat Cat | ItsADog Dog\n\npets = [ItsACat Cat, ItsADog Dog]\n</code></pre>\n"}], "owner": {"reputation": 1029, "user_id": 668074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f82d3dd033cd691ad5340b9620bdcf38?s=128&d=identicon&r=PG", "display_name": "user668074", "link": "https://stackoverflow.com/users/668074/user668074"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 316, "favorite_count": 1, "accepted_answer_id": 38298299, "answer_count": 1, "score": 2, "last_activity_date": 1468204186, "creation_date": 1468201706, "question_id": 38298084, "link": "https://stackoverflow.com/questions/38298084/lists-of-mixed-types-using-wrappers-in-haskell", "title": "Lists of mixed types using wrappers in Haskell", "body": "<p>Is there a way to make a list of mixed types by wrapping the types with a another type?</p>\n\n<p>As an example, if I have two data types, <code>Cat</code> and <code>Dog</code>, can I make a list of both cats and dogs using something like a <code>Pet</code> wrapper? I know that this can be done using algebraic data types, but I would also like other wrappers to be available, such as <code>Animal</code>.</p>\n\n<p>The basic way I want to use this is below:</p>\n\n<pre><code>data Cat = Cat\ndata Dog = Dog\ndata Cow = Cow\n\ndata Pet a = Pet a\ndata Animal a = Animal a\n\npets = [Pet Cat, Pet Dog]\nanimals = [Animal Cat, Animal Dog, Animal Cow]\n</code></pre>\n\n<p>Is there a way to do this? I was also considering if typeclasses could be used.</p>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1468191670, "post_id": 38296569, "comment_id": 64011291, "body": "What should happen with the rest of the input, if anything that follows <code>#o</code> except <code>[&#39;0&#39;..&#39;7&#39;]</code> causes failure?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1468207929, "post_id": 38296569, "comment_id": 64014186, "body": "This question doesn&#39;t make sense in context. I would expect you to want to use all the digits in, e.g., <code>#o17</code>, which should parse to the number <code>15</code>."}, {"owner": {"reputation": 3226, "user_id": 1058732, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/271319f2b3d45b31f2bec9f3e4e92961?s=128&d=identicon&r=PG", "display_name": "shmish111", "link": "https://stackoverflow.com/users/1058732/shmish111"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1468236215, "post_id": 38296569, "comment_id": 64027784, "body": "@leftaroundabout I think indeed I need to think about what will follow rather than what will not, I will need to keep parsing to find the next param, sexp or eof."}], "answers": [{"comments": [{"owner": {"reputation": 3226, "user_id": 1058732, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/271319f2b3d45b31f2bec9f3e4e92961?s=128&d=identicon&r=PG", "display_name": "shmish111", "link": "https://stackoverflow.com/users/1058732/shmish111"}, "edited": false, "score": 0, "creation_date": 1468236019, "post_id": 38298585, "comment_id": 64027665, "body": "I guess this is sort of what I am looking for, I think I need to explicitly state what can follow rather than what cannot (I think just &#39; &#39;, &#39;)&#39; and eof), then it simply won&#39;t match if it&#39;s followed by something else, what do you think?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 3226, "user_id": 1058732, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/271319f2b3d45b31f2bec9f3e4e92961?s=128&d=identicon&r=PG", "display_name": "shmish111", "link": "https://stackoverflow.com/users/1058732/shmish111"}, "edited": false, "score": 1, "creation_date": 1468240372, "post_id": 38298585, "comment_id": 64030569, "body": "That can be handled by how you define the structure of an s-exp. When you write the rule for &quot;an sexp is a sequence of basic terms separated by spaces surrounded by parens&quot; parsec will expect a space, right-paren or eof after parsing any basic term."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1468206449, "creation_date": 1468206449, "answer_id": 38298585, "question_id": 38296569, "link": "https://stackoverflow.com/questions/38296569/parsec-something-like-many1-but-fail-if-ends/38298585#38298585", "title": "Parsec something like many1 but fail if ends", "body": "<p>Use <code>notFollowedBy</code> to make sure no alpha-numerics follow the octal digits:</p>\n\n<pre><code>import Text.Parsec\nimport Text.Parsec.Char\nimport Text.Parsec.String\nimport Text.Parsec.Combinator\n\nparseOct' :: Parser String\nparseOct' = do \n  char '#'\n  char 'o'\n  x &lt;- many1 (oneOf \"01234567\")\n  notFollowedBy alphaNum\n  return x\n\ntest1 = parseTest parseOct' \"#o123\"\ntest2 = parseTest parseOct' \"#o1238\"\n</code></pre>\n\n<p>E.g.:</p>\n\n<pre><code>*Main&gt; test1\n\"123\"\n*Main&gt; test2\nparse error at (line 1, column 7):\nunexpected '8'\n</code></pre>\n"}], "owner": {"reputation": 3226, "user_id": 1058732, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/271319f2b3d45b31f2bec9f3e4e92961?s=128&d=identicon&r=PG", "display_name": "shmish111", "link": "https://stackoverflow.com/users/1058732/shmish111"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1468206449, "creation_date": 1468185641, "question_id": 38296569, "link": "https://stackoverflow.com/questions/38296569/parsec-something-like-many1-but-fail-if-ends", "title": "Parsec something like many1 but fail if ends", "body": "<p>I'm going through <a href=\"https://en.wikibooks.org/wiki/Write_Yourself_a_Scheme_in_48_Hours/Parsing\" rel=\"nofollow\">Write Yourself a Scheme in 48 Hours</a> and I'm stuck on getting numbers to work properly. I want the following to parse a hex number</p>\n\n<pre><code>parseOct :: Parser LispVal\nparseOct = do\n        char '#'\n        char 'o'\n        x &lt;- many1 $ oneOf \"01234567\"\n        return . Number . fst . head . readOct $ x\n</code></pre>\n\n<p>This works if I give it <code>#o7</code> for example and gives me <code>7</code> as expected however it doesn't fail if I give it <code>#o78</code> instead it gives me <code>7</code>. It seems this is because of many1 which disregards anything once it doesn't match. Is there anything in Parsec that will enable me to get all the oct numbers but fail if it ever gets a non-oct character such as 8?</p>\n"}, {"tags": ["haskell", "ghc", "ghci"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1468175211, "post_id": 38294949, "comment_id": 64007201, "body": "You installed <code>regex-posix</code> and you have checked that you have install it for the compiler you are using? It happened to me to have one <code>ghc</code> from the OS distribution, and one manually installed and mix things up when installing packages..."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1468175265, "post_id": 38294949, "comment_id": 64007228, "body": "Have you actually restarted ghci after installing <code>regex-posix</code>?"}, {"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1468176030, "post_id": 38294949, "comment_id": 64007456, "body": "@Bakuriu, how can I check it? I did verify that both ghci and ghc have the same version."}, {"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1468176041, "post_id": 38294949, "comment_id": 64007463, "body": "@leftaroundabout, yep"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 2, "creation_date": 1468178283, "post_id": 38294949, "comment_id": 64008118, "body": "run <code>ghc-pkg list</code> and check that <code>regex-posix</code> is there."}, {"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1468193163, "post_id": 38294949, "comment_id": 64011620, "body": "@eric Thanks, it wasn&#39;t listed, and I just realized that I ran <code>cabal install</code> inside a sandbox dir. So please post your comment as an answer, and I&#39;ll be glad to accept it."}], "answers": [{"tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": true, "score": 2, "last_activity_date": 1468194866, "creation_date": 1468194866, "answer_id": 38297465, "question_id": 38294949, "link": "https://stackoverflow.com/questions/38294949/was-text-regex-posix-renamed-or-replaced/38297465#38297465", "title": "Was \u2018Text.Regex.Posix\u2019 renamed or replaced?", "body": "<p>When you install a package, make sure you are installing it to the appropriate location (globally, or in a sandbox). If cabal detects a sandbox, it will automatically install the package there (and it should say something to the effect of \"detected sandbox at path/to/sandbox\".)</p>\n\n<p>You can always check which packages are installed in the global package index by running <code>ghc-pkg list</code>, or if cabal is using a sandbox, then <code>cabal sandbox hc-pkg list</code>.</p>\n\n<p>Once you find out which package index cabal is using to compile a particular program, you can verify in the Hackage documentation that the desired functionality is present in the version you have installed.</p>\n"}], "owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 238, "favorite_count": 1, "accepted_answer_id": 38297465, "answer_count": 1, "score": 3, "last_activity_date": 1468194866, "creation_date": 1468173884, "last_edit_date": 1495540733, "question_id": 38294949, "link": "https://stackoverflow.com/questions/38294949/was-text-regex-posix-renamed-or-replaced", "title": "Was \u2018Text.Regex.Posix\u2019 renamed or replaced?", "body": "<p>I have the same problem as this <a href=\"https://stackoverflow.com/questions/14187577/pattern-matching-a-regex-pattern-in-haskell\">question</a>. However, both answers rely on the module <code>Text.Regex.Posix</code>. When I try to import it, I get</p>\n\n<pre><code>&lt;no location info&gt;:\n    Could not find module \u2018Text.Regex.Posix\u2019\n    Perhaps you meant\n      Text.Regex.Base (from regex-base-0.93.2@5g5YXZiScrKLs2R8SL8lg0)\n      Text.Regex.PCRE (from regex-pcre-builtin-0.94.4.8.8.35@B6GE2pWicek5lhKiWDiitR)\n</code></pre>\n\n<p>I've tried installing <code>regex-posix</code> as suggested in this <a href=\"https://stackoverflow.com/a/29563505/165753\">answer</a>, but the module still can't be found. So I was wondering if the functionality of <code>Text.Regex.Posix</code> was moved to the suggested modules <code>Text.Regex.Base</code> and <code>Text.Regex.PCRE</code>. My GHCi version is 7.10.3.</p>\n\n<p>I'm a beginner in Haskell, so I might be missing something trivial.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 0, "creation_date": 1468168316, "post_id": 38294057, "comment_id": 64005188, "body": "Please post all the relevant code and error messages. It&#39;s hard to help you if your post does not provide a <a href=\"http://stackoverflow.com/help/mcve\">Minimal, Complete and Verifiable Example</a>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6540722"}, "reply_to_user": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 0, "creation_date": 1468171694, "post_id": 38294057, "comment_id": 64006171, "body": "@Mephy added some examples"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1468171956, "post_id": 38294057, "comment_id": 64006262, "body": "There&#39;s a typo in the question. <code>PutstLn</code> should be <code>putStrLn</code>."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6540722"}, "edited": false, "score": 0, "creation_date": 1468174840, "post_id": 38294702, "comment_id": 64007090, "body": "I can&#39;t thank you enough , very well explained ,10 out of 10"}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 1, "last_activity_date": 1468172659, "last_edit_date": 1468172659, "creation_date": 1468172241, "answer_id": 38294702, "question_id": 38294057, "link": "https://stackoverflow.com/questions/38294057/haskell-io-cli-menu-for-small-twitter-client/38294702#38294702", "title": "Haskell IO cli menu for small twitter client", "body": "<p>If your IO action returns a value, like <code>inbox :: IO(Either String [DM])</code>, but you want to use it where it needs to be an <code>IO ()</code> you can ignore the returned value and follow it with a <code>return ()</code> which has the type <code>IO ()</code>.</p>\n\n<pre><code>  if(numero == 1 ) \n      then do  \n          frase &lt;- getLine\n          tweet frase \n          return ()\n      else\n          ...\n</code></pre>\n\n<hr>\n\n<p>Aside: you can simplify the indentation for this by using a <a href=\"https://www.haskell.org/tutorial/patterns.html\" rel=\"nofollow\"><code>case</code> expression</a> instead of nested <code>if ... then ... else</code>s.</p>\n\n<pre><code>main:: IO ()\nmain = do\n  putStrLn \"1)Tweet\\n 2)Timeline\\n 3)DM\\n 4)Inbox\\n\"\n  numero &lt;- readLn\n  case numero of\n      1 -&gt; do  \n          frase &lt;- getLine\n          tweet frase \n          return ()\n      2 -&gt; do \n          frase &lt;- getLine\n          timeline frase\n          return ()\n      3 -&gt; do\n          frase &lt;- getLine \n          nome &lt;- getLine\n          dm frase nome\n          return ()\n      4 -&gt; do\n          inbox\n          return ()\n      otherwise -&gt; do\n          putStrLn \"Invalido\"\n</code></pre>\n\n<p>I've also replaced <code>getLine :: IO String</code> with <code>readLn :: Read a =&gt; IO a</code>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6540722"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 38294702, "answer_count": 1, "score": 2, "last_activity_date": 1468172659, "creation_date": 1468168072, "last_edit_date": 1468172144, "question_id": 38294057, "link": "https://stackoverflow.com/questions/38294057/haskell-io-cli-menu-for-small-twitter-client", "title": "Haskell IO cli menu for small twitter client", "body": "<p>I'm trying to make a really simple twitter client with haskell , and to make things simple i was trying to make a simple putStrLn and getLine (i dont know if this is the best solution for the problem or not, i'm fairly new to haskell). </p>\n\n<p>I wanted to do something like this but the output types are different so its gonna give a massive error : </p>\n\n<pre><code>main:: IO ()\nmain = do\n  putStrLn \"1)Tweet\\n 2)Timeline\\n 3)DM\\n 4)Inbox\\n\"\n  numero &lt;- getLine \n  if(numero == 1 ) \n      then do  \n          frase &lt;- getLine\n          tweet frase \n      else\n          if(numero == 2)\n              then do \n                  frase &lt;- getLine\n                  timeline frase\n          else \n              if(numero == 3)\n                  then do\n                        frase &lt;- getLine \n                        nome &lt;- getLine\n                        dm frase nome\n                  else \n                     if(numero == 4)\n                            then\n                                 inbox\n                            else do \n                                  PutstrLn \"Invalido\"\n\n\ntweet :: String -&gt; IO (Either String Tweet)\n\ntimeline :: String  -&gt; IO (Either String [Tweet]) \n\ndm :: String -&gt; String -&gt; IO(Either String DM)\n\ninbox :: IO(Either String [DM])\n</code></pre>\n\n<p>And like i explained above its gonna give you errors like : </p>\n\n<pre><code>  Main.hs:86:25: error:\n   Couldn't match type \u2018Either String DM\u2019 with \u2018()\u2019\n    Expected type: IO ()\n      Actual type: IO (Either String DM)\n</code></pre>\n\n<p>and :</p>\n\n<pre><code>Main.hs:75:11: error:\n\u2022 Couldn't match type \u2018Either String Tweet\u2019 with \u2018()\u2019\n  Expected type: IO ()\n    Actual type: IO (Either String Tweet)\n</code></pre>\n\n<p>If someone has an ideia out to solve this particular problem it would be very appreciated .</p>\n"}, {"tags": ["haskell", "functional-programming", "monads"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1468167980, "post_id": 38293959, "comment_id": 64005065, "body": "<code>return</code> is <code>const</code> for functions"}], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 4, "last_activity_date": 1468167880, "creation_date": 1468167880, "answer_id": 38294027, "question_id": 38293959, "link": "https://stackoverflow.com/questions/38293959/using-return-in-haskells-bind-operator/38294027#38294027", "title": "Using return in Haskell&#39;s bind operator (&gt;&gt;=)", "body": "<p>There's a monad instance for functions and its <code>return</code> is <code>return x = \\_ -&gt; x</code> (or equivalently <code>return = const</code>).</p>\n\n<p>So when you do <code>return y</code> where a function is expected, it simply picks the <code>return</code> of the function monad.</p>\n"}, {"comments": [{"owner": {"reputation": 45, "user_id": 6571584, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Jx6TfieZWmo/AAAAAAAAAAI/AAAAAAAAACQ/LiwzCvf6k0Y/photo.jpg?sz=128", "display_name": "Sean Shirazi", "link": "https://stackoverflow.com/users/6571584/sean-shirazi"}, "edited": false, "score": 0, "creation_date": 1468173643, "post_id": 38294048, "comment_id": 64006774, "body": "Thanks, I think I understand why it typechecks given that it&#39;s using the <code>Monad (-&gt;) a</code> instance. What I still don&#39;t understand is how did it choose <code>Monad (-&gt;) a</code>? What was the logic behind it? was it simply that it was literally the only instance whose <code>return</code> would type check?"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1468174576, "last_edit_date": 1468174576, "creation_date": 1468168041, "answer_id": 38294048, "question_id": 38293959, "link": "https://stackoverflow.com/questions/38293959/using-return-in-haskells-bind-operator/38294048#38294048", "title": "Using return in Haskell&#39;s bind operator (&gt;&gt;=)", "body": "<p>You're actually mixing two different monads here, that's what's happening. <code>x &gt;&gt;= return y</code> is in this case unified to</p>\n\n<pre><code>(&gt;&gt;) :: \u2200 m a b . Monad m =&gt; m a -&gt; m b -&gt; m b\nx &gt;&gt; y = x &gt;&gt;= (return :: m b -&gt; a -&gt; m b) y\n       -- aka  return :: (m b) -&gt; (a-&gt;) (m b)\n</code></pre>\n\n<p>where the <code>return</code> is implemented in the <code>Monad (a-&gt;)</code> instance:</p>\n\n<pre><code>instance Monad (-&gt;) a where\n  return x = \\_ -&gt; x\n  ...\n</code></pre>\n\n<p>It has nothing whatsoever to do with the <code>Monad m</code> instance.</p>\n\n<p>As to <em>why</em> this <code>return</code> operates in the function monad: <code>return :: m b -&gt; a -&gt; m b</code> is inferred from the environment before the compiler ever start to reason about typeclass instances. Now, the type <code>m b -&gt; a -&gt; m b</code>, i.e. <code>m b -&gt; (a-&gt;m b)</code>, has the form <code>mb -&gt; amb</code>. The signature <code>return :: Monad \u03bc =&gt; \u03b1 -&gt; \u03bc \u03b1</code> therefore makes the compiler match <code>\u03bc \u03b1 ~ amb ~ a-&gt;m b</code>. Only at this point will the compiler actually choose the monad instance for <code>return</code>, and it does so by observing that <code>a -&gt; m b</code> has indeed the form <code>\u03bc \u03b1</code>, with <code>\u03bc ~ (a-&gt;)</code> and <code>\u03b1 ~ m b</code>. Therefore, it has to be the <code>(a-&gt;)</code> monad.</p>\n"}], "owner": {"reputation": 45, "user_id": 6571584, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Jx6TfieZWmo/AAAAAAAAAAI/AAAAAAAAACQ/LiwzCvf6k0Y/photo.jpg?sz=128", "display_name": "Sean Shirazi", "link": "https://stackoverflow.com/users/6571584/sean-shirazi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 270, "favorite_count": 0, "accepted_answer_id": 38294048, "answer_count": 2, "score": 3, "last_activity_date": 1468174576, "creation_date": 1468167497, "question_id": 38293959, "link": "https://stackoverflow.com/questions/38293959/using-return-in-haskells-bind-operator", "title": "Using return in Haskell&#39;s bind operator (&gt;&gt;=)", "body": "<p>This is the type of <code>&gt;&gt;=</code>:</p>\n\n<pre><code>(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>It needs a function as the second argument.</p>\n\n<p>And here is the type of <code>return</code>:</p>\n\n<pre><code>return :: Monad m =&gt; a -&gt; m a\n</code></pre>\n\n<p>Returns <code>m a</code></p>\n\n<p>And this obviously type checks:</p>\n\n<pre><code>(&gt;&gt;) :: Monad m =&gt; m a -&gt; m b -&gt; m b\nx &gt;&gt; y = x &gt;&gt;= (\\_ -&gt; y)\n</code></pre>\n\n<p>But why does the following type check and work similarly to the above code?</p>\n\n<pre><code>(&gt;&gt;) :: Monad m =&gt; m a -&gt; m b -&gt; m b\nx &gt;&gt; y = x &gt;&gt;= return y\n</code></pre>\n\n<p>Here <code>return y</code> is supposed to be of type <code>m a</code> and not <code>a -&gt; m a</code>. So why does it work?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 4, "creation_date": 1468151432, "post_id": 38291502, "comment_id": 64000423, "body": "You&#39;re missing parenthesis in your second example. Try <code>:t fmap (+2) (Just 2)</code>"}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1468153380, "post_id": 38291502, "comment_id": 64000899, "body": "Parentheses are required because that&#39;s how haskell is parsed. It has nothing to do with the maybe type."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 4, "creation_date": 1468153591, "post_id": 38291502, "comment_id": 64000935, "body": "Note that what is happening is that <code>(+2)</code> and <code>Just</code> are functions with types <code>Num a =&gt; a -&gt; a</code> and <code>b -&gt; Maybe b</code>, the <code>fmap</code> is using the <a href=\"http://stackoverflow.com/questions/10294272/confused-about-function-as-instance-of-functor-in-haskell\"><code>Functor</code> instance of <code>-&gt;</code></a>, now by the functor instance we have <code>fmap f g = \\y -&gt; f (g y)</code> in our case <code>f = (+2)</code> and <code>g = Just</code>, so<code>fmap (+2) Just = \\y -&gt; (+2) (Just y)</code> Now you apply this to <code>2</code> and you get <code>(+2) (Just 2)</code>. Which explains the <code>Num (Maybe t)</code> constraint."}], "answers": [{"tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": true, "score": 2, "last_activity_date": 1468166354, "creation_date": 1468166354, "answer_id": 38293766, "question_id": 38291502, "link": "https://stackoverflow.com/questions/38291502/why-does-using-fmaps-infix-synonym-return-a-different-type-for-this-express/38293766#38293766", "title": "Why does using fmap&#39;s infix synonym &lt;$&gt; return a different type for this expression?", "body": "<p>Infix operators always have lower priority than function application, so <code>(+2) &lt;$&gt; Just 2</code> is the same as <code>(+2) &lt;$&gt; (Just 2)</code> and therefore <code>(&lt;$&gt;) (+2) (Just 2)</code>. If you use <code>fmap</code> as an infix operator:</p>\n\n<pre><code>(+2) `fmap` Just 2\n</code></pre>\n\n<p>you'll get the same result.</p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 191, "favorite_count": 0, "accepted_answer_id": 38293766, "answer_count": 1, "score": 0, "last_activity_date": 1468166354, "creation_date": 1468151041, "question_id": 38291502, "link": "https://stackoverflow.com/questions/38291502/why-does-using-fmaps-infix-synonym-return-a-different-type-for-this-express", "title": "Why does using fmap&#39;s infix synonym &lt;$&gt; return a different type for this expression?", "body": "<pre><code>Prelude&gt; :t (+2) &lt;$&gt; Just 2\n(+2) &lt;$&gt; Just 2 :: Num b =&gt; Maybe b\n\n\nPrelude&gt; :t fmap (+2) Just 2\nfmap (+2) Just 2 :: (Num (Maybe t), Num t) =&gt; Maybe t\n</code></pre>\n\n<p>However if I add brackets around the Maybe type I get the expected same result:</p>\n\n<pre><code>Prelude&gt; :t fmap (+2) (Just 2)\nfmap (+2) (Just 2) :: Num b =&gt; Maybe b\n</code></pre>\n\n<p>So my question is why - is it significance of the Maybe data constructor or something else?</p>\n"}, {"tags": ["haskell", "dependent-type", "singleton-type"], "comments": [{"owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "edited": false, "score": 1, "creation_date": 1468151489, "post_id": 38290067, "comment_id": 64000436, "body": "You can remove the warning in <code>from&#39;</code> by adding functions <code>storeHead :: Store e (s &#39;: ss) -&gt; e s</code> and <code>storeTail :: Store e (s &#39;: ss) -&gt; Store e ss</code> and use them on the store after you&#39;ve matched <code>AtHead</code> or <code>InTail</code>."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1468178590, "post_id": 38290067, "comment_id": 64008188, "body": "Your two <code>HasElemC</code> instances overlap. GHC will find it impossible to discharge a <code>HasElemC</code> constraint because it doesn&#39;t check preconditions when doing proof search. Fortunately there&#39;s <a href=\"https://wiki.haskell.org/GHC/AdvancedOverlap\" rel=\"nofollow noreferrer\">a well-known trick using type families and <code>UndecidableInstances</code></a>. (In fact this is one of the few good uses of Boolean type families.)"}, {"owner": {"reputation": 581, "user_id": 3394868, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/402bcd81a3d7272953e077610bc54db9?s=128&d=identicon&r=PG&f=1", "display_name": "NioBium", "link": "https://stackoverflow.com/users/3394868/niobium"}, "edited": false, "score": 0, "creation_date": 1468179834, "post_id": 38290067, "comment_id": 64008464, "body": "Thank you cchalmers, that worked.  Thanks, Benjamin. Overlaps are fine in my case: I don&#39;t need functions polymorphic in ss. Although I might need them in the future."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1468185513, "post_id": 38290067, "comment_id": 64009940, "body": "@NioBium I think you&#39;re misunderstanding me: <code>HasElemC</code> is <i>useless</i> because of the way you&#39;ve defined your instances. Try writing <code>x = HasElem &quot;a&quot; &#39;[&quot;a&quot;]; x = hasElem</code>. It won&#39;t type-check."}, {"owner": {"reputation": 581, "user_id": 3394868, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/402bcd81a3d7272953e077610bc54db9?s=128&d=identicon&r=PG&f=1", "display_name": "NioBium", "link": "https://stackoverflow.com/users/3394868/niobium"}, "edited": false, "score": 0, "creation_date": 1468186715, "post_id": 38290067, "comment_id": 64010200, "body": "No, I understand you. My code using <code>from</code> does type-check and runs correctly. You just need to mark AtHead instance OVERLAPPING/InTail instance OVERLAPPABLE. Are you saying it shouldn&#39;t?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1468208611, "post_id": 38290067, "comment_id": 64014330, "body": "NioBium, I think maybe @BenjaminHodgson may just dislike overlapping instances sufficiently that he&#39;s not tried too hard to learn how to use them; it&#39;s very often better to learn how <i>not</i> to. The type family trick will be pickier, unfortunately. For example, the type family thing will refuse to select an instance using a polymorphic inequality like <code>a &#47;~ (q &#39;: a)</code> because type families can represent infinite types. Overlapping instances will happily do so because it doesn&#39;t affect type safety."}], "answers": [{"comments": [{"owner": {"reputation": 581, "user_id": 3394868, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/402bcd81a3d7272953e077610bc54db9?s=128&d=identicon&r=PG&f=1", "display_name": "NioBium", "link": "https://stackoverflow.com/users/3394868/niobium"}, "edited": false, "score": 0, "creation_date": 1468180066, "post_id": 38293546, "comment_id": 64008522, "body": "Thank you. I was just trying not to invent the wheel. Still hoping someone would provide a solution in Haskell singletons, if one exists. What&#39;s the point in lifting all of those functions to type-level, if you can&#39;t use them in proofs?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 581, "user_id": 3394868, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/402bcd81a3d7272953e077610bc54db9?s=128&d=identicon&r=PG&f=1", "display_name": "NioBium", "link": "https://stackoverflow.com/users/3394868/niobium"}, "edited": false, "score": 0, "creation_date": 1468185097, "post_id": 38293546, "comment_id": 64009849, "body": "Well, singletons are (and <code>singletons</code> is) one particular mode of use of GADTs and data-kinds. Proof-terms like <code>Elem</code> are another. They don&#39;t naturally fit into the singleton framework because they&#39;re not singletons!"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 8, "last_activity_date": 1468799915, "last_edit_date": 1495540888, "creation_date": 1468164932, "answer_id": 38293546, "question_id": 38290067, "link": "https://stackoverflow.com/questions/38290067/idiomatic-boolean-equality-usage-singletons/38293546#38293546", "title": "Idiomatic boolean equality usage (singletons)", "body": "<p><a href=\"https://existentialtype.wordpress.com/2011/03/15/boolean-blindness/\" rel=\"nofollow noreferrer\">Don't use Booleans</a>! I seem to <a href=\"https://stackoverflow.com/a/37925725/1523776\">keep</a> <a href=\"https://stackoverflow.com/a/38221146/1523776\">repeating</a> <a href=\"https://stackoverflow.com/questions/33270639/so-whats-the-point\">myself</a> on this point: Booleans are of extremely limited usefulness in dependently-typed programming and the sooner you un-learn the habit the better.</p>\n\n<p>An <code>Elem s ss ~ True</code> context promises to you that <code>s</code> is in <code>ss</code> somewhere, but it doesn't say <em>where</em>. This leaves you in the lurch when you need to produce an <code>s</code>-value from your list of <code>ss</code>. One bit is not enough information for your purposes.</p>\n\n<p>Compare this with the computational usefulness of your original <code>HasElem</code> type, which is structured like a natural number giving the index of the element in the list. (Compare the shape of a value like <code>There (There Here)</code> with that of <code>S (S Z)</code>.) To produce an <code>s</code> from a list of <code>ss</code> you just need to dereference the index.</p>\n\n<p>That said, you should still be able to <em>recover</em> the information you threw away and extract a <code>HasElem x xs</code> value from a context of <code>Elem x xs ~ True</code>. It's tedious, though - you have to search the list for the item (<em>which you already did</em> in order to evaluate <code>Elem x xs</code>!) and eliminate the impossible cases. Working in Agda (definitions omitted):</p>\n\n<pre><code>recover : {A : Set}\n          (_=?_ : (x : A) -&gt; (y : A) -&gt; Dec (x == y))\n          (x : A) (xs : List A) -&gt;\n          (elem {{_=?_}} x xs == true) -&gt;\n          Elem x xs\nrecover _=?_ x [] ()\nrecover _=?_ x (y :: ys) prf with x =? y\nrecover _=?_ x (.x :: ys) prf | yes refl = here\nrecover _=?_ x (y :: ys) prf | no p = there (recover _=?_ x ys prf)\n</code></pre>\n\n<p>All this work is unnecessary, though. Just use the information-rich proof-term to start with.</p>\n\n<hr>\n\n<p>By the way, you should be able to stop GHC warning you about incomplete patterns by doing your <code>Elem</code> matching on the left hand side, rather than in a <code>case</code>-expression:</p>\n\n<pre><code>from' :: HasElem s ss -&gt; Store e ss -&gt; e s\nfrom' AtHead (Cons element store) = element\nfrom' (InTail i) (Cons element store) = from' i store\n</code></pre>\n\n<p>By the time you're on the right-hand side of a definition, it's too late for pattern-matching to refine the possible constructors for other terms on the left.</p>\n"}], "owner": {"reputation": 581, "user_id": 3394868, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/402bcd81a3d7272953e077610bc54db9?s=128&d=identicon&r=PG&f=1", "display_name": "NioBium", "link": "https://stackoverflow.com/users/3394868/niobium"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 285, "favorite_count": 2, "answer_count": 1, "score": 9, "last_activity_date": 1468799915, "creation_date": 1468139397, "last_edit_date": 1468697739, "question_id": 38290067, "link": "https://stackoverflow.com/questions/38290067/idiomatic-boolean-equality-usage-singletons", "title": "Idiomatic boolean equality usage (singletons)", "body": "<p>I want to create a data structure to store items tagged on type level using Symbol. This:</p>\n\n<pre><code>data Store e (ss :: [Symbol]) where\n  Nil :: Store e '[]\n  Cons :: e s -&gt; Store e ss -&gt; Store e (s ': ss)\n\ndata HasElem (a :: k) (as :: [k]) where\n  AtHead :: HasElem a (a ': as)\n  InTail :: HasElem a as -&gt; HasElem a (b ': as)\n\nclass HasElemC (a :: k) (as :: [k]) where hasElem :: HasElem a as\ninstance HasElemC {OVERLAPPING} a (a ': as) where hasElem = AtHead\ninstance HasElemC a as =&gt; HasElemC a (b ': as) where hasElem = InTail hasElem\n\nfrom :: HasElemC s ss =&gt; Store e ss -&gt; e s\nfrom = from' hasElem\n\nfrom' :: HasElem s ss -&gt; Store e ss -&gt; e s\n-- from' _ Nil = undefined\nfrom' h (Cons element store) = case h of\n  AtHead -&gt; element\n  InTail h' -&gt; from' h' store\n</code></pre>\n\n<p>kinda works, if you neglect the fact that compiler warns me for not supplying <code>from' _ Nil</code> definition (why does it, by the way? is there a way to make it stop?) But what I really wanted to do in the beginning was to use singletons library in idiomatic fashion, instead of writing my own type-level code. Something like this:</p>\n\n<pre><code>import Data.Singletons.Prelude.List\n\ndata Store e (ss :: [Symbol]) where\n  Nil :: Store e '[]\n  Cons :: Sing s -&gt; e s -&gt; Store e ss -&gt; Store e (s ': ss)\n\nfrom :: Elem s ss ~ True =&gt; Store e ss -&gt; e s\nfrom (Cons evidence element nested) = ???\n</code></pre>\n\n<p>Sadly I could not figure out how to convert the context to a propositional equality. How can you use building blocks from singletons library to do what I'm trying to do?</p>\n\n<p>ghc@7.10.3, singletons@2.1</p>\n"}, {"tags": ["haskell", "yesod", "shakespeare-text"], "comments": [{"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1468165094, "post_id": 38289927, "comment_id": 64004164, "body": "Edited my question to post new code snippets based on the <code>liftIO</code> approach. Now, the problem seems to be that <code>^{nav}</code> usage in the <code>default-layout-wrapper</code> template doesn&#39;t seem to be composing well."}], "answers": [{"comments": [{"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1468159312, "post_id": 38292271, "comment_id": 64002541, "body": "Thanks for the answer @ErikR. What would you say about <a href=\"http://www.yesodweb.com/book/yesods-monads#yesods-monads_example_database_driven_navbar\" rel=\"nofollow noreferrer\">yesodweb.com/book/&hellip;</a> ? Isn&#39;t what I&#39;m trying to do similar?"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1468163795, "post_id": 38292271, "comment_id": 64003789, "body": "Thanks, ErikR. it&#39;s still not working for me, but at least I&#39;ve made some progress. Your suggestion of using <code>handlerToWidget $ liftIO</code> has resulted in a simpler type for the <code>nav</code> function, i.e. <code>nav :: (MonadIO m) =&gt; WidgetT site m ()</code>. However, this leads me to wonder why <code>liftIO</code> needed <code>handlerToWidget</code> in the first place. Why wasn&#39;t <code>liftIO</code> unable to lift the IO action directly to the <code>WidgetT site m ()</code> transformer stack?"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1468164115, "post_id": 38292271, "comment_id": 64003900, "body": "My hunch was correct. The <code>handlerToWidget</code> is NOT actually required. Because I had not given a top-level type declaration, <code>liftIO</code> didn&#39;t know which monad to lift the IO action to. Simply added <code>nav :: Widget</code> as a top-level type declaration makes the <code>nav</code> function compile without <code>handlerToWidget</code>."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1468210637, "post_id": 38292271, "comment_id": 64014806, "body": "Thanks ErikR. I&#39;ve managed to do IO inside a Handler action, but not in the original code I was targeting. I&#39;ve reproduced the same error in your working example at <a href=\"http://lpaste.net/169497#a169504\" rel=\"nofollow noreferrer\">lpaste.net/169497#a169504</a> Please take note of the <code>defaultLayout</code> implementation (this is what the yesod-sqlite scaffold gives). As soon as the <code>defaultLayout</code> is changed to this definition, the <code>lpaste-wrapper.hamlet</code> is unable to invoke <code>^{testWidget2}</code>or <code>^{testWidget}</code>"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1468210885, "post_id": 38292271, "comment_id": 64014859, "body": "Probably the output of <code>-ddump-splices</code> can be helpful? Please take a look at my latest edit."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1468240064, "post_id": 38292271, "comment_id": 64030344, "body": "what do you think of my answer: <a href=\"http://stackoverflow.com/a/38306902/534481\">stackoverflow.com/a/38306902/534481</a>"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1468203924, "last_edit_date": 1495539850, "creation_date": 1468156541, "answer_id": 38292271, "question_id": 38289927, "link": "https://stackoverflow.com/questions/38289927/how-to-do-io-in-a-widget-hamlet-referenced-by-defaultlayout/38292271#38292271", "title": "How to do IO in a Widget/Hamlet referenced by defaultLayout?", "body": "<p>Have a look at the answer to <a href=\"https://stackoverflow.com/questions/23318426/yesods-shakespearean-templates-hamlet-and-io\">this SO question</a>. Basically you can't perform IO in a template.</p>\n\n<p>Also note that the type of <code>defaultLayout</code> is <code>GHandler ...</code> and <code>GHandler</code> is an <a href=\"https://hackage.haskell.org/package/yesod-0.4.1/docs/Yesod-Handler.html#t:GHandler\" rel=\"nofollow noreferrer\">instance of MonadIO</a>, so you can perform IO in <code>defaultLayout</code> by using <code>liftIO</code>.</p>\n\n<p>I would try:</p>\n\n<pre><code>defaultLayout = do\n  ...\n  globalStat &lt;- liftIO $ handlerToWidget $ A2.getGlobalStat NWT.ariaRPCUrl\n  uploadSpeed &lt;- liftIO $ A2.glUploadSpeed globalStat\n  downloadSpeed &lt;- liftIO $ A2.glDownloadSpeed globalStat\n  ...\n  withUrlRenderer $(hamletFile \"templates/default-layout-wrapper.hamlet\")\n</code></pre>\n\n<p>And in <code>templates/default-layout-wrapper.hamlet</code>:</p>\n\n<pre><code>...\n^{nav uploadSpeed downloadSpeed}\n...\n</code></pre>\n\n<p>And <code>nav</code> becomes something like:</p>\n\n<pre><code>nav uploadSpeed downloadSpeed =   $(whamletFile \"templates/navbar.hamlet)\n</code></pre>\n\n<p>So the basic ideas are:</p>\n\n<ul>\n<li>Do all of your IO in <code>defaultLayout</code> using <code>liftIO</code></li>\n<li>Pass data needed by sub-templates as function arguments</li>\n</ul>\n\n<p><strong>Update</strong></p>\n\n<p>To emulate <a href=\"http://www.yesodweb.com/book/yesods-monads#yesods-monads_example_database_driven_navbar\" rel=\"nofollow noreferrer\">this example in the Yesod book</a> you need to write <code>navbar</code> like this:</p>\n\n<pre><code>navbar :: Widget\nnavbar = do\n    globalStat &lt;- liftIO A2.getGlobalStat NWT.ariaRPCUrl\n    downloadSpeed &lt;- liftIO A2.glDownloadSpeed globalStat\n    uploadSpeed &lt;- liftIO A.glUploadSpeed\n    $(whamletFile \"templates/navbar.hamlet)\n</code></pre>\n\n<p>And in <code>navbar.whamlet</code> refer to <code>#{uploadSpeed}</code> and <code>#{downloadSpeed}</code>.</p>\n\n<p>You can't do IO in a whamlet file. Moreover, your A2 functions are IO-actions, but handlerToWidget requires a HandlerT action so you need to use <code>liftIO</code> to convert those calls.</p>\n\n<p><strong>Update 2</strong></p>\n\n<p>See <a href=\"http://lpaste.net/169497\" rel=\"nofollow noreferrer\">http://lpaste.net/169497</a> for a working example which does IO in a Widget.</p>\n"}, {"tags": [], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "is_accepted": false, "score": 0, "last_activity_date": 1468240031, "creation_date": 1468240031, "answer_id": 38306902, "question_id": 38289927, "link": "https://stackoverflow.com/questions/38289927/how-to-do-io-in-a-widget-hamlet-referenced-by-defaultlayout/38306902#38306902", "title": "How to do IO in a Widget/Hamlet referenced by defaultLayout?", "body": "<p>Here's how I got this to work. There were actually two different problems I was facing:</p>\n\n<ul>\n<li>Doing IO inside a Widget</li>\n<li>Referencing a Widget in the <code>default-layout-wrapper</code> hamletFile.</li>\n</ul>\n\n<p>Here's the solution for doing IO inside the widget:</p>\n\n<pre><code>nav :: Widget\nnav = do\n  globalStat &lt;- liftIO $ A2.getGlobalStat NWT.ariaRPCUrl\n  $(whamletFile \"templates/navbar.hamlet\")\n</code></pre>\n\n<p><strong>Note:</strong> The type signature <code>nav :: Widget</code> seems to be necessary, else the type inference engine might get confused, and infer a very different type for the <code>liftIO</code> operation (which was originally happening with me).</p>\n\n<p>For the second problem, I couldn't really find a solution for referencing a Widget within the <code>default-layout-wrapper</code> hamletFile. By the time this particular hamletFile is being rendered, the Widget monad has been converted to a <code>PageContent</code> type and now it needs an <code>Html url</code> type to be able to render it in conjunction with the <code>withUrlRenderer</code> function. Basically, I wasn't able to get <code>Widget</code> and <code>PageContent</code> to compose. However, the following approach gave me my desired result, in a different way:</p>\n\n<p><strong>default-layout.hamlet:</strong> Added the invocation to <code>nav</code> widget in this file. Moved some elements from <code>default-layout-wrapper</code> to this file:</p>\n\n<pre><code>&lt;div .container&gt;\n  &lt;header&gt;\n    ^{nav}\n  &lt;div #main role=\"main\"&gt;\n    $maybe msg &lt;- mmsg\n      &lt;div #message&gt;#{msg}\n    ^{widget}\n</code></pre>\n\n<p><strong>default-layout-wrapper.hamlet:</strong> Moved a few HTML element from this file to <code>default-layout</code>:</p>\n\n<pre><code>&lt;!-- SNIP --&gt;\n  &lt;body&gt;\n    &lt;div class=\"container\"&gt;\n      ^{pageBody pc}\n&lt;!-- SNIP --&gt;\n</code></pre>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1468240031, "creation_date": 1468138139, "last_edit_date": 1468211111, "question_id": 38289927, "link": "https://stackoverflow.com/questions/38289927/how-to-do-io-in-a-widget-hamlet-referenced-by-defaultlayout", "title": "How to do IO in a Widget/Hamlet referenced by defaultLayout?", "body": "<p>I'm new to Yesod and seem to be completely lost with Widgets, Handlers, Hamlets, WHamlets, and what have you! Here's what I'm trying to do:</p>\n\n<ul>\n<li>Every page on my site needs to have a navbar, which leads me to believe that the correct place for implementing this should be <code>defaultLayout</code></li>\n<li>Now, this navbar needs to display some information that is obtained from an IO action (it's an RPC call which gives this data, to be more specific).</li>\n</ul>\n\n<p>Therefore, I tried writing the following function in <code>Foundation.hs</code> (the code layout is the basic <code>yesod-sqlite</code> scaffolding template):</p>\n\n<pre><code>nav = do\n  globalStat &lt;- handlerToWidget $ A2.getGlobalStat NWT.ariaRPCUrl\n  $(whamletFile \"templates/navbar.hamlet)\n\nA2.getGlobalStat :: IO GlobalStatResponse\n</code></pre>\n\n<p>Here's what <code>template/navbar.hamlet</code> looks like:</p>\n\n<pre><code>&lt;nav .navbar .navbar-default&gt;\n  &lt;div .container-fluid&gt;\n    &lt;p .navbar-right .navbar-text&gt;\n      &lt;span&gt;\n        #{A2.glDownloadSpeed globalStat}\n        &lt;i .glyphicon .glyphicon-arrow-down&gt;\n      &lt;span&gt;\n        #{A2.glUploadSpeed globalStat}\n        &lt;i .glyphicon .glyphicon-arrow-up&gt;\n      &lt;span .label .label-success&gt;\n        On-the-watch\n</code></pre>\n\n<p>Here's what <code>default-layout-wrapper.hamlet</code> looks like:</p>\n\n<pre><code>&lt;!-- SNIP --&gt;\n  &lt;body&gt;\n    &lt;div class=\"container\"&gt;\n      &lt;header&gt;\n        ^{nav}\n      &lt;div id=\"main\" role=\"main\"&gt;\n        ^{pageBody pc}\n&lt;!-- SNIP --&gt;\n</code></pre>\n\n<p>Here's what <code>defaultLayout</code> looks like:</p>\n\n<pre><code>defaultLayout widget = do\n    master &lt;- getYesod\n    mmsg &lt;- getMessage\n    pc &lt;- widgetToPageContent $ do\n        addStylesheet $ StaticR css_bootstrap_css\n        $(widgetFile \"default-layout\")\n    withUrlRenderer $(hamletFile \"templates/default-layout-wrapper.hamlet\")\n</code></pre>\n\n<p>However, the code refuses to compile with one type-error after another. I've tried a lot of combinations of <code>hametFile</code>, <code>whamletFile</code>, <code>handerToWidget</code>, <code>liftIO</code>, even placing the nav function <em>inside</em> <code>defaultLayout</code>, but nothing seems to work. According to me my current code <em>should</em> compile, but I've obviously not understood how the Yesod-Core types are working.</p>\n\n<p>How do I get this to work? And more importantly, what concept have I misunderstood?</p>\n\n<p><strong>Edit 1:</strong> </p>\n\n<p>Have tried modifying the <code>nav</code> function to the following:</p>\n\n<pre><code>nav :: Handler Html\nnav = do\n  globalStat  &lt;- liftIO $ A2.getGlobalStat NWT.ariaRPCUrl\n  $(hamletFile \"templates/navbar.hamlet\")\n</code></pre>\n\n<p>But, it results in the following type mismatch in <code>defaultLayout</code> on the line with <code>withUrlRenderer</code>:</p>\n\n<pre><code> Couldn't match type \u2018HandlerT App IO Html\u2019\n                with \u2018Text.Hamlet.Render (Route App) -&gt; Html\u2019\n Expected type: HtmlUrl (Route App)\n   Actual type: Handler Html\n In the first argument of \u2018Text.Hamlet.asHtmlUrl\u2019, namely \u2018nav\u2019\n In a stmt of a 'do' block: Text.Hamlet.asHtmlUrl nav _render_a2ZY0 (intero)\n</code></pre>\n\n<p><strong>Edit 2:</strong></p>\n\n<p>Tried changing the type signature of <code>nav</code> to:</p>\n\n<pre><code>nav :: Widget\nnav = do\n  globalStat  &lt;- liftIO $ A2.getGlobalStat NWT.ariaRPCUrl\n  $(hamletFile \"templates/navbar.hamlet\") \n</code></pre>\n\n<p>But it results in a new type-mismatch, in the same line:</p>\n\n<pre><code> Couldn't match type \u2018WidgetT App IO ()\u2019\n                with \u2018Text.Hamlet.Render (Route App) -&gt; Html\u2019\n Expected type: HtmlUrl (Route App)\n   Actual type: Widget\n In the first argument of \u2018Text.Hamlet.asHtmlUrl\u2019, namely \u2018nav\u2019\n In a stmt of a 'do' block: Text.Hamlet.asHtmlUrl nav _render_a350l (intero)\n</code></pre>\n\n<p><strong>Edit 3:</strong></p>\n\n<p>Here's a relevant snippet from <code>-ddump-splices</code>:</p>\n\n<pre><code>\\ _render_a28TE\n  -&gt; do { asHtmlUrl (pageHead pc) _render_a28TE;\n          id ((Text.Blaze.Internal.preEscapedText . Data.Text.pack) \"\\n\");\n          asHtmlUrl (pageBody pc) _render_a28TE;\n          id ((Text.Blaze.Internal.preEscapedText . Data.Text.pack) \"\\n\");\n          asHtmlUrl testWidget2 _render_a28TE }\n</code></pre>\n\n<p>The type of <code>(pageHead pc)</code> and <code>(pageBody pc)</code> is <code>HtmlUrl (Route App)</code></p>\n"}, {"tags": ["http", "haskell", "https", "client"], "comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 2, "creation_date": 1468152683, "post_id": 38289523, "comment_id": 64000735, "body": "You won&#39;t be able to do this without additional libraries unless you re-implement <a href=\"http://hackage.haskell.org/package/http-client-0.5.1/docs/Network-HTTP-Client.html\" rel=\"nofollow noreferrer\"><code>http-client</code></a> which is the standard method. The <code>httpLbs</code> in <code>http-conduit</code> uses this."}], "answers": [{"comments": [{"owner": {"reputation": 181, "user_id": 6344725, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/31a90a0e7d6b623ff44c79f701f8e38d?s=128&d=identicon&r=PG&f=1", "display_name": "ein mensch", "link": "https://stackoverflow.com/users/6344725/ein-mensch"}, "edited": false, "score": 0, "creation_date": 1468140462, "post_id": 38290145, "comment_id": 63998093, "body": "yes, but I don&#39;t want to install additional packages."}, {"owner": {"reputation": 181, "user_id": 6344725, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/31a90a0e7d6b623ff44c79f701f8e38d?s=128&d=identicon&r=PG&f=1", "display_name": "ein mensch", "link": "https://stackoverflow.com/users/6344725/ein-mensch"}, "edited": false, "score": 0, "creation_date": 1468140474, "post_id": 38290145, "comment_id": 63998096, "body": "Is there a way to do that just using haskell-platform?"}, {"owner": {"reputation": 51262, "user_id": 208257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8d59503078761ba50620cbee4348882e?s=128&d=identicon&r=PG", "display_name": "Dan Burton", "link": "https://stackoverflow.com/users/208257/dan-burton"}, "reply_to_user": {"reputation": 181, "user_id": 6344725, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/31a90a0e7d6b623ff44c79f701f8e38d?s=128&d=identicon&r=PG&f=1", "display_name": "ein mensch", "link": "https://stackoverflow.com/users/6344725/ein-mensch"}, "edited": false, "score": 2, "creation_date": 1468141302, "post_id": 38290145, "comment_id": 63998227, "body": "There may be, but I&#39;ve never bothered doing it that way. The documentation for <code>Network.HTTP</code> says that &quot;This package only supports HTTP; it does not support HTTPS. Attempts to use HTTPS result in an error.&quot; However, I think this may be outdated and it may be possible to use the stuff provided in <code>Network.TCP</code> (from the same package)."}], "tags": [], "owner": {"reputation": 51262, "user_id": 208257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8d59503078761ba50620cbee4348882e?s=128&d=identicon&r=PG", "display_name": "Dan Burton", "link": "https://stackoverflow.com/users/208257/dan-burton"}, "is_accepted": false, "score": 1, "last_activity_date": 1468140166, "creation_date": 1468140166, "answer_id": 38290145, "question_id": 38289523, "link": "https://stackoverflow.com/questions/38289523/how-to-get-data-from-https-response-using-haskell/38290145#38290145", "title": "How to get data from HTTPS response using Haskell?", "body": "<p>It's really easy with the http-conduit package. For example:</p>\n\n<pre><code>bash&gt; stack --resolver lts-6.7 repl http-conduit\nghci&gt; :set -XOverloadedStrings \nghci&gt; import qualified Network.HTTP.Simple as H\nghci&gt; H.getResponseBody &lt;$&gt; H.httpLBS \"https://google.com\"\n</code></pre>\n\n<p><a href=\"https://www.stackage.org/haddock/lts-6.7/http-conduit-2.1.11/Network-HTTP-Simple.html#v:httpLBS\" rel=\"nofollow\">https://www.stackage.org/haddock/lts-6.7/http-conduit-2.1.11/Network-HTTP-Simple.html#v:httpLBS</a></p>\n"}], "owner": {"reputation": 181, "user_id": 6344725, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/31a90a0e7d6b623ff44c79f701f8e38d?s=128&d=identicon&r=PG&f=1", "display_name": "ein mensch", "link": "https://stackoverflow.com/users/6344725/ein-mensch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 285, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1468140166, "creation_date": 1468134442, "last_edit_date": 1468139514, "question_id": 38289523, "link": "https://stackoverflow.com/questions/38289523/how-to-get-data-from-https-response-using-haskell", "title": "How to get data from HTTPS response using Haskell?", "body": "<p>I use this line of Haskell code to read the content of an HTTP response:</p>\n\n<p><code>simpleHTTP (getRequest addr) &gt;&gt;= getResponseBody</code></p>\n\n<p>This line works very well for domains like <a href=\"http://www.example.com\" rel=\"nofollow\">http://www.example.com</a>, but if I try something like <a href=\"https://www.example.com\" rel=\"nofollow\">https://www.example.com</a>, I get an error saying that HTTPS is not supported.</p>\n\n<p>How can I make the code snippet work for HTTPS?</p>\n\n<p>Thank you in advance :)</p>\n\n<p>PS: I don't want to install additional libraries</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1468134000, "post_id": 38289439, "comment_id": 63996832, "body": "In this case, forall is not existential (to the caller) but a universal quantification."}, {"owner": {"reputation": 967, "user_id": 1465472, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/64ca2c1540eb6254acb10aec1958655c?s=128&d=identicon&r=PG", "display_name": "Mike Flynn", "link": "https://stackoverflow.com/users/1465472/mike-flynn"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1468134808, "post_id": 38289439, "comment_id": 63996987, "body": "I guess I don&#39;t understand why a universally defined type cannot fill the space for a non-universally defined type."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 1, "creation_date": 1468149745, "post_id": 38289439, "comment_id": 64000019, "body": "You defined the first argument to be a <code>forall pixel . (Pixel pixel) =&gt; Image pixel -&gt; a</code>. I.E. a thing that takes an image with <i>any</i> type of pixel, and returns the desired object type. <code>id</code> doesn&#39;t do that because it returns a different type depending on the type of pixel."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1468136089, "last_edit_date": 1468136089, "creation_date": 1468135376, "answer_id": 38289630, "question_id": 38289439, "link": "https://stackoverflow.com/questions/38289439/haskell-why-cant-i-use-id-in-another-function-where-ids-domain-is-clearly-a-s/38289630#38289630", "title": "Haskell: Why can&#39;t I use id in another function where id&#39;s domain is clearly a superset of the required type in the function?", "body": "<p>Suppose we have <code>img :: Image Pixel8</code> and run</p>\n\n<pre><code>getImage (ImageY8 img) :: Image Pixel16\n</code></pre>\n\n<p>How could this get magically converted by code which does not manipulate the bitmaps at all? Surely something is wrong here. Indeed, if the type system allowed this, it would allow a dangerous cast from two different types, likely leading to a crash. In practice, the type system is sound and correctly reject this.</p>\n\n<p>The crucial point is this:</p>\n\n<pre><code>dynamicMap :: (forall pixel . (Pixel pixel) =&gt; Image pixel -&gt; a)\n           -&gt; DynamicImage -&gt; a\n</code></pre>\n\n<p>This type is a contract between the caller and the callee. The caller gets to chose <code>a</code>. Then the caller has to pass a function argument of type <code>forall pixel . (Pixel pixel) =&gt; Image pixel -&gt; a</code>. This has to work on all <code>pixel</code> types.\nIn other words, the callee (<code>dynamicMap</code>) gets to choose <code>pixel</code>. There is no guarantee that the callee will chose <code>pixel</code> so to satisfy <code>Image pixel ~ a</code>. Indeed, it won't in the posted code. So, the compiler assumes that <code>Image pixel</code> and <code>a</code> might be different. But <code>id</code> forces them to be the same: the caller is imposing a constraint which limits the choice of the callee.</p>\n\n<p>Hence the type error.</p>\n\n<p>A simpler case:</p>\n\n<pre><code>foo :: (forall a. a -&gt; Int) -&gt; Int\nfoo f = f \"hello\" + f (42 :: Int) + f True\n\nbar :: Int\nbar = foo id\n</code></pre>\n\n<p>Here <code>bar</code> passes a function <code>id :: Int -&gt; Int</code>, which is not as general as <code>forall a. a-&gt;Int</code> -- the latter promises to convert anything to an <code>Int</code>, callee's choice. So, a type error is reported.</p>\n\n<p>More technically, <code>id</code> has type <code>forall b. b-&gt;b</code>, and we aim for <code>forall a. a-&gt;Int</code>. There is no way to substitute type <code>b</code> (with a type possibly involving the type variable <code>a</code>) so that <code>b-&gt;b</code> becomes <code>a-&gt;Int</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 967, "user_id": 1465472, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/64ca2c1540eb6254acb10aec1958655c?s=128&d=identicon&r=PG", "display_name": "Mike Flynn", "link": "https://stackoverflow.com/users/1465472/mike-flynn"}, "edited": false, "score": 0, "creation_date": 1468177224, "post_id": 38289786, "comment_id": 64007819, "body": "I really miss dynamic dispatch stuff from OO, for example, I&#39;d like to be able to use <code>show</code> on the pixel at (0,0) without having to explicitly know what type of pixel it is. From what I&#39;ve read in the past hour, I can do this using &quot;existential types&quot; correct?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 967, "user_id": 1465472, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/64ca2c1540eb6254acb10aec1958655c?s=128&d=identicon&r=PG", "display_name": "Mike Flynn", "link": "https://stackoverflow.com/users/1465472/mike-flynn"}, "edited": false, "score": 0, "creation_date": 1468177472, "post_id": 38289786, "comment_id": 64007894, "body": "In principle yes, but that&#39;s not a good way to do it. Existentials are awkward. The right way to show a pixel without knowing what type is to do it in a function that accepts concrete, not dynamic, images, but is polymorphic on the pixel type."}, {"owner": {"reputation": 967, "user_id": 1465472, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/64ca2c1540eb6254acb10aec1958655c?s=128&d=identicon&r=PG", "display_name": "Mike Flynn", "link": "https://stackoverflow.com/users/1465472/mike-flynn"}, "edited": false, "score": 0, "creation_date": 1468183326, "post_id": 38289786, "comment_id": 64009414, "body": "If I wanted to return a &quot;generic pixel&quot; though, I would use existential types, correct?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 967, "user_id": 1465472, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/64ca2c1540eb6254acb10aec1958655c?s=128&d=identicon&r=PG", "display_name": "Mike Flynn", "link": "https://stackoverflow.com/users/1465472/mike-flynn"}, "edited": false, "score": 0, "creation_date": 1468183678, "post_id": 38289786, "comment_id": 64009510, "body": "Yeah, only, you wouldn&#39;t want that. There&#39;s nothing useful you could do with a single generic pixel."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1468167756, "last_edit_date": 1468167756, "creation_date": 1468136774, "answer_id": 38289786, "question_id": 38289439, "link": "https://stackoverflow.com/questions/38289439/haskell-why-cant-i-use-id-in-another-function-where-ids-domain-is-clearly-a-s/38289786#38289786", "title": "Haskell: Why can&#39;t I use id in another function where id&#39;s domain is clearly a superset of the required type in the function?", "body": "<p>You seem to assume that Haskell polymorphic types work like OO polymorphic methods. They don't.</p>\n\n<p>The signature <code>getImage :: Pixel a =&gt; DynamicImage -&gt; Image a</code> is actually shorthand for</p>\n\n<pre><code>getImage :: \u2200 a . Pixel a =&gt; DynamicImage -&gt; Image a\n</code></pre>\n\n<p>An analogous-looking signature in e.g. C# would rather mean something like</p>\n\n<pre><code>getImage :: c ~ Pixel =&gt; DynamicImage -&gt; (\u2203 a . c a =&gt; Image a)\n</code></pre>\n\n<p>(You can read <code>\u2200</code> and <code>\u2203</code> as <code>forall</code> and <code>exists</code>, respectively.)\n<br>The difference? In Haskell, the <code>\u2200 a</code> shows that this function should work for any type <code>a</code> that <em>the caller can choose</em> (under the restriction that it's a pixel type). If you choose <code>a ~ Pixel8</code>, then <code>getImage</code> must be able to offer the image with <code>Pixel8</code>, ragardless of what pixel format the input image has.</p>\n\n<p>OTOH, <code>(\u2203 a . c a =&gt; Image a)</code> (which is not actually legal Haskell) means that the function return <em>some</em> image of <em>some</em> type, but the caller has no say in what pixel format it would be. This function would hence in fact be much less useful, unless you specifically want a heterogeneous collection of images. But you can already do that: simply store the <code>DynamicImage</code>s as they are!</p>\n\n<p>To properly do existential quantification, a custom ADT is often the best way; if you want to keep it open to <em>all</em> <code>Pixel</code> instances (even ones that may only be defined in the future) then you can also use proper existentials, but you still need to wrap them in a dedicated <code>data</code> type:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\ndata DynamicImage' where\n  DynamicImage' :: Pixel a =&gt; Image a -&gt; DynamicImage'\n</code></pre>\n\n<p>But this is usually much more cumbersome to work with, because you can't just pattern-match on <em>which specific Pixel type it is</em>. That is what you should do:</p>\n\n<pre><code>Prelude&gt; :m +Codec.Picture.Png\nPrelude Codec.Picture.Png&gt; import qualified Data.ByteString as BS\nPrelude Codec.Picture.Png BS&gt; Right i &lt;- decodePng &lt;$&gt; BS.readFile \"/usr/share/icons/hicolor/22x22/devices/totem-tv.png\" \nPrelude Codec.Picture.Png BS&gt; i`seq`0   -- actually evaluate `i` to the first level,\n                                        -- so we can see the pixel type\n0\nPrelude Codec.Picture.Png BS&gt; :sprint i\ni = Codec.Picture.Types.ImageRGBA8 _\nPrelude Codec.Picture.Png BS&gt; let Codec.Picture.Types.ImageRGBA8 i8 = i\n</code></pre>\n\n<p>If you've gotten to that point without error, you can then be utterly sure that <code>i8</code> will have type <code>RGBA8</code>, and you can do anything that's possible with those specific pixels.</p>\n"}], "owner": {"reputation": 967, "user_id": 1465472, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/64ca2c1540eb6254acb10aec1958655c?s=128&d=identicon&r=PG", "display_name": "Mike Flynn", "link": "https://stackoverflow.com/users/1465472/mike-flynn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 38289630, "answer_count": 2, "score": 3, "last_activity_date": 1468167756, "creation_date": 1468133814, "last_edit_date": 1468134745, "question_id": 38289439, "link": "https://stackoverflow.com/questions/38289439/haskell-why-cant-i-use-id-in-another-function-where-ids-domain-is-clearly-a-s", "title": "Haskell: Why can&#39;t I use id in another function where id&#39;s domain is clearly a superset of the required type in the function?", "body": "<p>A simple problem here. I'm new to Haskell, playing around with some images using the JuicyPixels package. I've loaded up an image into a <code>DynamicImage</code> object in GHCI using <code>decodePng</code>. The DynamicImage type is just a wrapper around images with several different pixel types:</p>\n\n<pre><code>data DynamicImage =\n       -- | A greyscale image.\n       ImageY8    (Image Pixel8)\n       -- | A greyscale image with 16bit components\n     | ImageY16   (Image Pixel16)\n       -- | A greyscale HDR image\n     | ImageYF    (Image PixelF)\n       -- | An image in greyscale with an alpha channel.\n     | ImageYA8   (Image PixelYA8)\n      -- | An image in greyscale with alpha channel on 16 bits.\n     | ImageYA16  (Image PixelYA16)\n     ...\n</code></pre>\n\n<p>All I want to do is access the underlying data using <code>dynamicMap</code> and see what kind of pixels I am loading. The type signature of dynamicMap uses Rank2Types:</p>\n\n<pre><code>dynamicMap :: (forall pixel . (Pixel pixel) =&gt; Image pixel -&gt; a)\n           -&gt; DynamicImage -&gt; a\ndynamicMap f (ImageY8    i) = f i\ndynamicMap f (ImageY16   i) = f i\ndynamicMap f (ImageYF    i) = f i\ndynamicMap f (ImageYA8   i) = f i\n...\n</code></pre>\n\n<p>It takes a function from images to anything, a dynamicImage, and that function applied to the underlying data. </p>\n\n<p>Why doesn't</p>\n\n<pre><code>getImage :: Pixel a =&gt; DynamicImage -&gt; Image a\ngetImage img = dynamicMap id img\n</code></pre>\n\n<p>typecheck? The error seems to be because the <code>id</code> function is too inclusive in its inputs. </p>\n\n<pre><code>Couldn't match type `pixel' with `a'\n      `pixel' is a rigid type variable bound by\n              a type expected by the context:\n                Pixel pixel =&gt; Image pixel -&gt; Image a\n              at &lt;path&gt;:24:16\n      `a' is a rigid type variable bound by\n          the type signature for\n            getImage :: Pixel a =&gt; DynamicImage -&gt; Image a\n          at &lt;path&gt;:23:13\n    Expected type: Image pixel -&gt; Image a\n      Actual type: Image a -&gt; Image a\n    Relevant bindings include\n      getImage :: DynamicImage -&gt; Image a\n        (bound at &lt;path&gt;:24:1)\n    In the first argument of `dynamicMap', namely `id'\n    In the expression: dynamicMap id img\n</code></pre>\n"}, {"tags": ["haskell", "operator-keyword", "options"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 2, "creation_date": 1468121964, "post_id": 38288333, "comment_id": 63995038, "body": "Unclarified uses of <code>&lt;&gt;</code> are almost certainly <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Monoid.html#v:-60--62-\" rel=\"nofollow noreferrer\"><code>&lt;&gt;</code> from Data.Monoid</a>, which is an infix alias for <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Monoid.html#v:mappend\" rel=\"nofollow noreferrer\"><code>mappend</code></a>."}, {"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 1, "creation_date": 1468124459, "post_id": 38288333, "comment_id": 63995424, "body": "I like <a href=\"http://hayoo.fh-wedel.de/?query=%3C%3E\" rel=\"nofollow noreferrer\">Hayoo</a> for searching Haskell APIs."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1468231875, "post_id": 38288333, "comment_id": 64025077, "body": "Hayoo and/or Hoogle is your friend."}], "answers": [{"tags": [], "owner": {"reputation": 1227, "user_id": 5053374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe57f0998df065470ff42c938f781cf?s=128&d=identicon&r=PG", "display_name": "Libby", "link": "https://stackoverflow.com/users/5053374/libby"}, "is_accepted": false, "score": 7, "last_activity_date": 1468124229, "creation_date": 1468124229, "answer_id": 38288530, "question_id": 38288333, "link": "https://stackoverflow.com/questions/38288333/what-does-mean-in-haskell-sample-code/38288530#38288530", "title": "What does &quot;&lt;&gt;&quot; mean in haskell sample code?", "body": "<p>Like Alexis said in the comment above, <code>(&lt;&gt;)</code> is from Data.Monoid. You can think of monoids as appendable things, so lists and text and stuff like that, and <code>&lt;&gt;</code> or <code>mappend</code> is how you append them. <code>[1,2,3] &lt;&gt; [4,5,6]</code> is the same as <code>[1,2,3] ++ [4,5,6]</code> -- both resulting in <code>[1,2,3,4,5,6]</code>. </p>\n\n<p>In the library you linked to, <code>ParserHelp</code> is defined as a monoid <a href=\"https://github.com/pcapriotti/optparse-applicative/blob/cc7faf83cac327f7c33bf368ee22cb64a42d44aa/Options/Applicative/Help/Types.hs#L24\">here</a> so you can use <code>&lt;&gt;</code> to \"add\" <code>ParserHelp</code>s.</p>\n\n<p>Googling operators is tough. <a href=\"https://www.haskell.org/hoogle/\">Hoogle</a> is really helpful for this!</p>\n"}], "owner": {"reputation": 431, "user_id": 2494308, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/bb275bbce79ac1fe4761d87d2c355921?s=128&d=identicon&r=PG", "display_name": "Max Li", "link": "https://stackoverflow.com/users/2494308/max-li"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1468124229, "creation_date": 1468121700, "question_id": 38288333, "link": "https://stackoverflow.com/questions/38288333/what-does-mean-in-haskell-sample-code", "title": "What does &quot;&lt;&gt;&quot; mean in haskell sample code?", "body": "<p>I have done lots of googling and failed in figuring this question out. Partially because google does not treat \"&lt;>\" as a keyword. I see this \"operator\" from the code sample at <a href=\"https://github.com/pcapriotti/optparse-applicative\" rel=\"nofollow\">optparse-applicative sample</a></p>\n\n<p>Anybody knows the meaning of \"&lt;>\" in haskell please help. Thanks!</p>\n"}, {"tags": ["haskell", "conduit"], "comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1468153374, "post_id": 38288312, "comment_id": 64000895, "body": "Notice that you are assuming that the first chunk you get from <code>await</code> will contain the whole header. I think this is not guaranteed by most bytestring sources."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1468153777, "post_id": 38288312, "comment_id": 64000971, "body": "Can&#39;t you just use <code>clientSource $$+ Data.Conduit.Binary.take headerLen</code>? Then what you do with the &#39;resumable conduit&#39; can depend on what you learn from <code>parseHeader</code> and any bytes beyond the header will be contained in the resumable conduit."}, {"owner": {"reputation": 1332, "user_id": 3262785, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/XqvLk.jpg?s=128&g=1", "display_name": "sqd", "link": "https://stackoverflow.com/users/3262785/sqd"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1468154206, "post_id": 38288312, "comment_id": 64001077, "body": "@Michael I didn&#39;t know there was such a function in conduit! thanks a lot."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1468163496, "post_id": 38288312, "comment_id": 64003711, "body": "+Michael&#39;s answer is probably the best one for this case, but in general: I think you&#39;re looking for the <a href=\"https://www.stackage.org/haddock/lts-6.7/conduit-1.2.6.6/Data-Conduit.html#v:leftover\" rel=\"nofollow noreferrer\"><code>leftover</code></a> function."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 2, "creation_date": 1468165587, "post_id": 38288312, "comment_id": 64004297, "body": "I was going to mention <code>leftover</code>, since at first sight that&#39;s what&#39;s being asked for, but the other problem, about <code>await</code>, meant that the program would need a loop to replicate what must be going on in <code>Data.Conduit.Binary.take</code> anyway to make sure it got <code>headerLen</code> many bytes. (<code>take</code> of course uses <code>leftover</code>)"}], "answers": [{"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 1, "last_activity_date": 1468241860, "creation_date": 1468241860, "answer_id": 38307576, "question_id": 38288312, "link": "https://stackoverflow.com/questions/38288312/haskell-conduit-how-to-send-data-downstream-while-producing-a-monadic-value/38307576#38307576", "title": "Haskell conduit: How to send data downstream while producing a monadic value", "body": "<p>You could also consider to use a parser wrapped into a conduit, for example <a href=\"https://hackage.haskell.org/package/conduit-extra-1.1.13.2/docs/Data-Conduit-Attoparsec.html\" rel=\"nofollow\"><code>Data.Conduit.Attoparsec</code></a> in <em>conduit-extra</em>. The wrapper takes care of requesting as many input pieces as needed (in your case it can happen that the first piece is shorter than <code>headerLen</code>), and also of taking care of leftovers:</p>\n\n<pre><code>import Control.Monad.Catch\nimport qualified Data.Attoparsec.ByteString as P\nimport Data.Attoparsec.Types\nimport qualified Data.ByteString as BS\nimport Data.Conduit\nimport Data.Conduit.Attoparsec\n\n\nparseHeader :: Parser BS.ByteString BS.ByteString\nparseHeader = P.take headerLen -- do whatever parsing you need to get the header\n  where \n    headerLen = 42\n\nconsumerHeader :: (MonadThrow m) =&gt; Consumer BS.ByteString m BS.ByteString\nconsumerHeader = sinkParser parseHeader\n</code></pre>\n\n<p><code>Consumer</code> is defined as</p>\n\n<pre><code>type Consumer i m r = forall o. ConduitM i o m r\n</code></pre>\n\n<p>so <code>consumerHeader</code> takes <code>ByteString</code> as input, is polymorphic in the output as well as the monad, and returns the parsed <code>ByteString</code>.</p>\n"}], "owner": {"reputation": 1332, "user_id": 3262785, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/XqvLk.jpg?s=128&g=1", "display_name": "sqd", "link": "https://stackoverflow.com/users/3262785/sqd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1468241860, "creation_date": 1468121378, "question_id": 38288312, "link": "https://stackoverflow.com/questions/38288312/haskell-conduit-how-to-send-data-downstream-while-producing-a-monadic-value", "title": "Haskell conduit: How to send data downstream while producing a monadic value", "body": "<p>I want to write a proxy, which would receive a header that indicates the destination IP, port, etc.</p>\n\n<p>So I have something like this:</p>\n\n<pre><code>getHeader = do\n    Just x &lt;- await\n    let (a, rest) = splitAt headerLen x\n    return $ parseHeader a\n    -- how to send the rest data downstream ??\n\n(resume, header) &lt;- clientSource $$+ getHeader\n-- do something according to the header\n</code></pre>\n\n<p>The problem is that, sometimes the header and the subsequent data are sent together, and therefore <code>getHeader</code> consumes the subsequent data, which is supposed to be consumed by later conduits. So how can I send <code>rest</code> downstream?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 10, "last_activity_date": 1468096202, "creation_date": 1468096202, "answer_id": 38286093, "question_id": 38285748, "link": "https://stackoverflow.com/questions/38285748/get-the-type-of-flip-foldr-id-in-haskell-from-the-console/38286093#38286093", "title": "Get the type of `flip foldr id` in Haskell from the console", "body": "<p>Actually in haskell there is no guesswork involved, it is best to sit down and work this with the help of the GHCi.</p>\n\n<p>So let us best get started and fire up ghci</p>\n\n<pre><code>$ &gt; ghci\nGHCi, version 7.10.3: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; :t flip\nflip :: (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c\nPrelude&gt; :t foldr\nfoldr :: Foldable t =&gt; (a1 -&gt; b1 -&gt; b1) -&gt; b1 -&gt; t a1 -&gt; b1\nPrelude&gt; :t id\nid :: a2 -&gt; a2\n</code></pre>\n\n<p>these are the basic types involved.</p>\n\n<p>Now if we use explicit parenthization we see <code>foldr :: Foldable t =&gt; (a -&gt; b -&gt; b) -&gt; b -&gt; (t a -&gt; b)</code> is a function that takes a folding function and a starting value that returns a function.</p>\n\n<p>Since all lower case letters on type level are (type)variables we can start to substitute</p>\n\n<pre><code>foldr :: Foldable t =&gt; (a1 -&gt; b1 -&gt; b1) -&gt; b1 -&gt; t a1 -&gt; b1\n                        **************     **    **********\nflip ::                (     a          -&gt; b  -&gt;    c   ) -&gt; ( b  -&gt;       a          -&gt;     c      )\n                                                              ***     **************      **********\nflip foldr :: Foldable t =&gt;                                    b1 -&gt; (a1 -&gt; b1 -&gt; b1) -&gt; (t a1 -&gt; b1)\n</code></pre>\n\n<p>mind that you have inserted the first parameter of the <code>flip</code> function - therefore it does not show up in the type signature anymore.</p>\n\n<p>Furthermore you can see <code>id</code> is then the starting value so <code>b1 ~ (a2-&gt; a2)</code> so substituting that gives us:</p>\n\n<pre><code>flip foldr id :: Foldable t =&gt; (a1 -&gt; (a2 -&gt; a2) -&gt; (a2 -&gt; a2)) -&gt; (t a1 -&gt; (a2 -&gt; a2))\n</code></pre>\n\n<p>and omitting the explicit parens again</p>\n\n<pre><code>flip foldr id :: Foldable t =&gt; (a1 -&gt; (a2 -&gt; a2) -&gt; a2 -&gt; a2) -&gt; t a1 -&gt; a2 -&gt; a2\n</code></pre>\n\n<p>And what the great thing about this procedure - you can check every step in GHCi to see if your (equational) reasoning has been correct.</p>\n\n<p>Some precautions:</p>\n\n<ul>\n<li><p>GHCi always tries to deduce the most general signature - so if you expect</p>\n\n<pre><code>foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\n</code></pre></li>\n</ul>\n\n<p>then in GHC-versions later than 7.8 you will see the signature I wrote above.</p>\n\n<ul>\n<li><code>type</code>-aliases might be confusing so if you have a <code>type MyAB a b = (a -&gt; b -&gt; b)</code> then <code>foldr :: MyAB a b -&gt; b -&gt; [a] -&gt; b</code> is a correct specialization, but you probably won't see this in GHCi.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 70793, "user_id": 28128, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4e974a514f0764fdfe99a8915f192002?s=128&d=identicon&r=PG", "display_name": "David Grayson", "link": "https://stackoverflow.com/users/28128/david-grayson"}, "is_accepted": true, "score": 3, "last_activity_date": 1468103186, "creation_date": 1468103186, "answer_id": 38286867, "question_id": 38285748, "link": "https://stackoverflow.com/questions/38285748/get-the-type-of-flip-foldr-id-in-haskell-from-the-console/38286867#38286867", "title": "Get the type of `flip foldr id` in Haskell from the console", "body": "<p>You can use the <code>:t</code> command in <code>ghci</code> to find out the type of any expression.</p>\n\n<pre><code>GHCi, version 7.10.3: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; :t flip foldr id\nflip foldr id\n  :: Foldable t =&gt; (a -&gt; (a1 -&gt; a1) -&gt; a1 -&gt; a1) -&gt; t a -&gt; a1 -&gt; a1\n</code></pre>\n"}], "owner": {"reputation": 754, "user_id": 4742773, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e2f7e04a66b903ef279d0a2bf37da992?s=128&d=identicon&r=PG&f=1", "display_name": "ignacio chiazzo", "link": "https://stackoverflow.com/users/4742773/ignacio-chiazzo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 285, "favorite_count": 0, "accepted_answer_id": 38286867, "answer_count": 2, "score": -7, "last_activity_date": 1501246086, "creation_date": 1468093701, "last_edit_date": 1501246086, "question_id": 38285748, "link": "https://stackoverflow.com/questions/38285748/get-the-type-of-flip-foldr-id-in-haskell-from-the-console", "title": "Get the type of `flip foldr id` in Haskell from the console", "body": "<p>How can I get the type of a function (<code>flip foldr id</code>) from theconsole?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 159491, "user_id": 58808, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/7cefc64f7b1b53513625bf3487ecd16d?s=128&d=identicon&r=PG", "display_name": "Ionu\u021b G. Stan", "link": "https://stackoverflow.com/users/58808/ionu%c8%9b-g-stan"}, "edited": false, "score": 2, "creation_date": 1468089188, "post_id": 38284994, "comment_id": 63988624, "body": "You forgot to rewrite all occurrences of the <code>Strategy</code> type alias in <code>evalPair&#39;</code>. That should give you an answer."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1468089408, "creation_date": 1468089408, "answer_id": 38285059, "question_id": 38284994, "link": "https://stackoverflow.com/questions/38284994/reviewing-evalpair-from-parallel-and-concurrent-programming-in-haskell/38285059#38285059", "title": "Reviewing `evalPair` from Parallel and Concurrent Programming in Haskell", "body": "<p>Note that <code>Strategy (a,b)</code> is a function of type <code>(a,b) -&gt; Eval (a,b)</code>.</p>\n\n<p>So another way of writing the signature for <code>evalPair'</code> is:</p>\n\n<pre><code>evalPair' :: (a -&gt; Eval a) -&gt; (b -&gt; Eval b) -&gt; ( (a,b) -&gt; Eval (a,b) )\n</code></pre>\n\n<p>Since function application associates to the right, we can remove that last pair of parens. And if we match up parameters we have:</p>\n\n<pre><code>evalPair' :: (a -&gt; Eval a) -&gt; (b -&gt; Eval b) -&gt; (a,b) -&gt; Eval (a,b)\nevalPair'      sa                sb            (a,b) = do\n  ...\n  return (a', b')\n</code></pre>\n\n<p>So that's where the pair <code>(a,b)</code> comes from.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 35, "favorite_count": 0, "accepted_answer_id": 38285059, "answer_count": 1, "score": 0, "last_activity_date": 1468089408, "creation_date": 1468088918, "question_id": 38284994, "link": "https://stackoverflow.com/questions/38284994/reviewing-evalpair-from-parallel-and-concurrent-programming-in-haskell", "title": "Reviewing `evalPair` from Parallel and Concurrent Programming in Haskell", "body": "<p>Given:</p>\n\n<pre><code>import Control.Parallel\nimport Control.Parallel.Strategies\n\nevalPair :: Strategy a -&gt; Strategy b -&gt; Strategy (a, b)\nevalPair sa sb (a, b) = do\n   a' &lt;- sa a\n   b' &lt;- sb b\n   return (a', b')\n</code></pre>\n\n<p>from <a href=\"http://chimera.labs.oreilly.com/books/1230000000929/ch03.html\" rel=\"nofollow\">Parallel and Concurrent Programming in Haskell</a>.</p>\n\n<p>I don't understand from where <code>(a, b)</code> comes, i.e. the third argument of <code>evalPair</code>.</p>\n\n<p>Re-writing the function without the <code>Strategy</code> type alias:</p>\n\n<pre><code>*Main&gt; :i Strategy\ntype Strategy a = a -&gt; Eval a\n        -- Defined in `Control.Parallel.Strategies'\n</code></pre>\n\n<p>it is:</p>\n\n<pre><code>evalPair' :: (a -&gt; Eval a) -&gt; (b -&gt; Eval b) -&gt; Strategy (a, b)\nevalPair' sa sb (a, b) = do\n   a' &lt;- sa a\n   b' &lt;- sb b\n   return (a', b')\n</code></pre>\n\n<p>But, I still don't understand the <code>(a, b)</code> argument. Why doesn't <code>evalPair</code>s type signature show: <code>Strategy a -&gt; Strategy b -&gt; (a, b) -&gt; Strategy b</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1468087381, "post_id": 38284696, "comment_id": 63988087, "body": "Probably because you didn&#39;t specify where <code>runEval</code> or <code>Eval</code> are coming from."}, {"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1468087441, "post_id": 38284696, "comment_id": 63988108, "body": "thanks, David. I usually include <code>import</code>&#39;s - my mistake."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 5, "creation_date": 1468087749, "post_id": 38284696, "comment_id": 63988196, "body": "<code>:sprint xs</code> prints <code>_</code> because you haven&#39;t forced any evaluation of <code>xs</code> - it has nothing to do with <code>runEval</code>."}], "answers": [{"tags": [], "owner": {"reputation": 2995, "user_id": 1095506, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/07067c06a12496ca32eb400313ef4ab6?s=128&d=identicon&r=PG", "display_name": "mariop", "link": "https://stackoverflow.com/users/1095506/mariop"}, "is_accepted": true, "score": 2, "last_activity_date": 1468093942, "creation_date": 1468093942, "answer_id": 38285790, "question_id": 38284696, "link": "https://stackoverflow.com/questions/38284696/understanding-runeval-not-whnf/38285790#38285790", "title": "Understanding `runEval` - Not WHNF?", "body": "<p>The reason is that <code>let</code> just binds a name with an expression but it doesn't trigger any evaluation of the expression.</p>\n\n<p>To understand better, let me use a more simple example</p>\n\n<pre><code>Main&gt; let x = error \"foobar!\" in 1\n1\n</code></pre>\n\n<p>As you can see, the <code>error \"foobar!\"</code>, that should throw exception, is just ignored. The reason is that <code>x</code> is not used and thus Haskell doesn't evaluate it. You need something to trigger the evaluation of <code>x</code></p>\n\n<pre><code>Main&gt; let x = error \"foobar!\" in x `seq` 1\n*** Exception: foobar!\n</code></pre>\n\n<p>Going back to your example, note that <code>Eval x</code> specifies how to evaluate a x, not when it will be evaluated in your program.</p>\n\n<p>Have a look at this wiki article on <a href=\"https://en.wikibooks.org/wiki/Haskell/Laziness\" rel=\"nofollow\">Lazyness</a> for more.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 228, "favorite_count": 0, "accepted_answer_id": 38285790, "answer_count": 1, "score": 0, "last_activity_date": 1468093942, "creation_date": 1468087006, "last_edit_date": 1468087432, "question_id": 38284696, "link": "https://stackoverflow.com/questions/38284696/understanding-runeval-not-whnf", "title": "Understanding `runEval` - Not WHNF?", "body": "<p>Given:</p>\n\n<pre><code>Prelude&gt; import Control.Parallel.Strategies \nPrelude&gt; import Control.Parallel\nPrelude&gt; let fact n = if (n &lt;= 0) then 1 else n * fact (n-1) :: Integer\nPrelude&gt; let xs = map (runEval . (\\x -&gt; return x :: Eval Integer) . fact) [1..100]\nPrelude&gt; let ys = map fact [1..100]\nPrelude&gt; :sprint xs\nxs = _\nPrelude&gt; :sprint ys\nys = _\n</code></pre>\n\n<p>As I understand, <code>xs</code> is in Weak Head Normal Form. Why is that? Didn't the <code>runEval</code> have any affect on bringing the value/computation to Normal Form?</p>\n"}, {"tags": ["haskell", "applicative", "do-notation"], "answers": [{"comments": [{"owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "edited": false, "score": 0, "creation_date": 1468089099, "post_id": 38284752, "comment_id": 63988594, "body": "It&#39;s impressive GHC would desugar to <code>Applicative</code>, but why? there is no guarantee it will perform better, is there?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "edited": false, "score": 1, "creation_date": 1468089348, "post_id": 38284752, "comment_id": 63988684, "body": "Monads enforce an order of operations not required by <code>Applicative</code> code, which has implications for parallelization. Letting the compiler decide if an available Applicative instance is suitable for a <code>do</code> expression frees the programmer from unnecessarily commuting to a monad."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 6, "last_activity_date": 1468171548, "last_edit_date": 1468171548, "creation_date": 1468087369, "answer_id": 38284752, "question_id": 38284684, "link": "https://stackoverflow.com/questions/38284684/de-sugaring-do-notation/38284752#38284752", "title": "de sugaring do notation", "body": "<p>The <code>do</code> notation desugars to <em>nested</em> lambdas, because (for example) <code>time</code> is in scope for the rest of the <code>do</code> block, not just the first call to <code>qcomma</code>:</p>\n\n<pre><code>qtime &gt;&gt;= (\n  \\time -&gt; qcomma\n      &gt;&gt; double \n      &gt;&gt;= (\\ ask -&gt; qcomma\n               &gt;&gt; double  \n               &gt;&gt;= (\\bid -&gt; qcomma \n                       &gt;&gt; double\n                       &gt;&gt;= (\\askVolume  -&gt; qcomma \n                                    &gt;&gt; double\n                                    &gt;&gt;= (\\bidVolume  -&gt; endOfLine\n                                          return (Quote time ask bid askVolume bidVolume ))))))\n</code></pre>\n\n<p>The applicative version might have the same effect, but is not desugared to anything.</p>\n\n<p>Starting with GHC 8, the <code>do</code> notation <em>might</em> desugar to applicative code if (<code>ApplicativeDo</code> is turned on and) the compiler can determine that <code>&gt;&gt;=</code> isn't necessary and the more general <code>Applicative</code> instance has the same meaning.</p>\n"}], "owner": {"reputation": 31, "user_id": 5659263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ee8854ca17ddf86fe99698c065ad905?s=128&d=identicon&r=PG&f=1", "display_name": "Devitect", "link": "https://stackoverflow.com/users/5659263/devitect"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 38284752, "answer_count": 1, "score": 1, "last_activity_date": 1468171548, "creation_date": 1468086939, "last_edit_date": 1468087573, "question_id": 38284684, "link": "https://stackoverflow.com/questions/38284684/de-sugaring-do-notation", "title": "de sugaring do notation", "body": "<p>I want to de sugar the following do notation. But im unsure whether I have got it right: </p>\n\n<p>Is:</p>\n\n<pre><code>quote   = do\n    time        &lt;- qtime\n    qcomma\n    ask         &lt;- double\n    qcomma\n    bid         &lt;- double\n    qcomma\n    askVolume   &lt;- double\n    qcomma\n    bidVolume   &lt;- double\n    endOfLine\n    return $ Quote time ask bid askVolume bidVolume\n</code></pre>\n\n<p>And</p>\n\n<pre><code>quote   = Quote &lt;$&gt; (qtime &lt;* qcomma)\n                &lt;*&gt; (double &lt;* qcomma)\n                &lt;*&gt; (double &lt;* qcomma)\n                &lt;*&gt; (double &lt;* qcomma)\n                &lt;*&gt; (double &lt;* endOfLine)\n</code></pre>\n\n<p>Equivalent to:</p>\n\n<pre><code>qtime &gt;&gt;= (\\time -&gt; qcomma) \n    &gt;&gt; double \n        &gt;&gt;= (\\ ask -&gt; qcomma)  \n            &gt;&gt; double  \n                &gt;&gt;= (\\bid -&gt; qcomma) \n                    &gt;&gt; double\n                        &gt;&gt;= (\\askVolume  -&gt; qcomma) \n                            &gt;&gt; double\n                                &gt;&gt;= (\\bidVolume  -&gt; endOfLine)\n                                    return (Quote time ask bid askVolume bidVolume ) \n</code></pre>\n\n<p>Any help is appreciated!</p>\n"}, {"tags": ["haskell", "io", "monads", "io-redirection"], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 4520455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4fd099aa6a4b437346ec9ff18ddd86f?s=128&d=identicon&r=PG&f=1", "display_name": "yvs314", "link": "https://stackoverflow.com/users/4520455/yvs314"}, "edited": false, "score": 0, "creation_date": 1468177564, "post_id": 38284550, "comment_id": 64007912, "body": "the  <code>print &quot;working through stdin&#47;redirect</code> piece is just a kind of <b>nop</b> operation to me, the question was on how would I avoid it altogether."}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": false, "score": 1, "last_activity_date": 1468086083, "creation_date": 1468086083, "answer_id": 38284550, "question_id": 38284115, "link": "https://stackoverflow.com/questions/38284115/conditional-standard-handle-redirection-in-haskell/38284550#38284550", "title": "conditional standard handle redirection in Haskell", "body": "<p>This seems fairly idiomatic to me already. The one note I have is to avoid <code>head</code>, as it is an unsafe function (it can throw a runtime error). In this case it is fairly easy to do so by using <code>case</code> to pattern match.</p>\n\n<pre><code>main :: IO ()\nmain = do\n  args &lt;- getArgs\n  case args of\n    fname:_ -&gt; do\n      print $ \"working with \" ++ fname\n      finHandle &lt;- openFile fname ReadMode\n      hDuplicateTo finHandle stdin\n      foutHandle &lt;- openFile (fname ++ \".out\") WriteMode\n      hDuplicateTo foutHandle stdout\n    [] -&gt; do\n      print \"working through stdin/redirect\"\n  interact ((++) \"Here you go---\\n\" . map toUpper)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 25, "user_id": 4520455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4fd099aa6a4b437346ec9ff18ddd86f?s=128&d=identicon&r=PG&f=1", "display_name": "yvs314", "link": "https://stackoverflow.com/users/4520455/yvs314"}, "edited": false, "score": 0, "creation_date": 1468177726, "post_id": 38284607, "comment_id": 64007952, "body": "Thank you very much for desugaring <code>interact</code>, should&#39;ve guessed to do it outright, this code certainly solves the problem at hand, and it is also more portable (<code>hDuplicateTo</code> is GHC-specific, it is absent from 2010&#39;s Haskell Report)."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1468086414, "creation_date": 1468086414, "answer_id": 38284607, "question_id": 38284115, "link": "https://stackoverflow.com/questions/38284115/conditional-standard-handle-redirection-in-haskell/38284607#38284607", "title": "conditional standard handle redirection in Haskell", "body": "<p>There's nothing very special about <code>interact</code> - here is its definition:</p>\n\n<pre><code>interact        ::  (String -&gt; String) -&gt; IO ()\ninteract f      =   do s &lt;- getContents\n                       putStr (f s)\n</code></pre>\n\n<p>How about something like this:</p>\n\n<pre><code> import System.Environment\n import Data.Char\n\n main = do\n   args &lt;- getArgs\n   let (reader, writer) =\n        case args of\n          []         -&gt; (getContents, putStr)\n          (path : _) -&gt; let outpath = path ++ \".output\"\n                        in (readFile path, writeFile outpath)\n   contents &lt;- reader\n   writer (process contents)\n\n process :: String -&gt; String\n process = (++) \"Here you go---\\n\" . map toUpper\n</code></pre>\n\n<p>Based on the command line arguments we set <code>reader</code> and <code>writer</code> to the IO-actions which will read the input and write the output.</p>\n"}], "owner": {"reputation": 25, "user_id": 4520455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4fd099aa6a4b437346ec9ff18ddd86f?s=128&d=identicon&r=PG&f=1", "display_name": "yvs314", "link": "https://stackoverflow.com/users/4520455/yvs314"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 305, "favorite_count": 0, "accepted_answer_id": 38284607, "answer_count": 2, "score": 1, "last_activity_date": 1468086547, "creation_date": 1468083180, "question_id": 38284115, "link": "https://stackoverflow.com/questions/38284115/conditional-standard-handle-redirection-in-haskell", "title": "conditional standard handle redirection in Haskell", "body": "<p>I want to read a file, process it, and write the results to another file; the input file name is to be supplied through a console argument, and the output file name is generated from the input file name. </p>\n\n<p>The catch is I want it to transparently \u201cfail over\u201d to stdin/stdout if no arguments are supplied; essentially, in case a file name is supplied, I redirect stdin/stdout to the respective file names so I can transparently use <b>interact</b> whether the file name  was supplied or not.</p>\n\n<p>Here's the code hacked together with dummy output in a superfluous <b>else</b>. What will be the proper, idiomatic form of doing it? </p>\n\n<p>It probably could have something to do with Control.Monad's  <b>when</b> or <b>guard</b>, as was pointed out in a similar question, but maybe somebody wrote this already.</p>\n\n<pre><code>import System.IO\nimport Data.Char(toUpper)\nimport System.Environment\nimport GHC.IO.Handle\n\nmain :: IO ()\nmain = do\n       args &lt;- getArgs\n       if(not $ null args) then\n        do\n           print $ \"working with \"++ (head args)\n           finHandle &lt;- openFile (head args) ReadMode --open the supplied input file\n           hDuplicateTo finHandle stdin --bind stdin to finName's handle\n           foutHandle &lt;- openFile ((head args) ++ \".out\") WriteMode --open the output file for writing\n           hDuplicateTo foutHandle stdout --bind stdout to the outgoing file\n        else print \"working through stdin/redirect\" --get to know \n        interact ((++) \"Here you go---\\n\" . map toUpper)\n</code></pre>\n"}, {"tags": ["haskell", "category-theory"], "answers": [{"tags": [], "owner": {"reputation": 131, "user_id": 4108839, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-u3r9Hd2y9y8/AAAAAAAAAAI/AAAAAAAAAAA/AMZuuckhyIsYzernILdGTfK66_1DRHcLog/s96-c/photo.jpg?sz=128", "display_name": "Benjamin Berger", "link": "https://stackoverflow.com/users/4108839/benjamin-berger"}, "is_accepted": true, "score": 0, "last_activity_date": 1540686615, "creation_date": 1540686615, "answer_id": 53027410, "question_id": 38283401, "link": "https://stackoverflow.com/questions/38283401/haskell-composition-of-morphisms-in-monoidal-categories/53027410#53027410", "title": "Haskell: Composition of morphisms in monoidal categories", "body": "<p>I figured it out, sort of. The basic idea is to use a multi-parameter type class  with a normalizing function and its inverse as methods. The normalizer associates everything to the right, recursively. The type class needs an instance for each case of the recursion. Then, to convert from one way to associate stuff to another, just compose the normalizer for the type of the first morphism and the inverse normalizer for the type of the second morphism.</p>\n\n<p>I will link code here as soon as I will have published it.</p>\n"}], "owner": {"reputation": 131, "user_id": 4108839, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-u3r9Hd2y9y8/AAAAAAAAAAI/AAAAAAAAAAA/AMZuuckhyIsYzernILdGTfK66_1DRHcLog/s96-c/photo.jpg?sz=128", "display_name": "Benjamin Berger", "link": "https://stackoverflow.com/users/4108839/benjamin-berger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "accepted_answer_id": 53027410, "answer_count": 1, "score": 4, "last_activity_date": 1540686615, "creation_date": 1468078321, "last_edit_date": 1468079361, "question_id": 38283401, "link": "https://stackoverflow.com/questions/38283401/haskell-composition-of-morphisms-in-monoidal-categories", "title": "Haskell: Composition of morphisms in monoidal categories", "body": "<p>I have the following definitions for a monoidal category class (Similar to the standard library, but providing inverses of the necessary natural isomorphisms):</p>\n\n<pre><code>class (Category r, Category s, Category t) =&gt; Bifunctor p r s t | p r -&gt; s t, p s -&gt; r t, p t -&gt; r s where\n  bimap :: r a b -&gt; s c d -&gt; t (p a c) (p b d)\n--\nclass (Bifunctor b k k k) =&gt; Associative k b where\n  associate :: k (b (b x y) z) (b x (b y z))  \n  associateInv :: k (b x (b y z)) (b (b x y) z)\n--\nclass (Bifunctor b k k k) =&gt; HasIdentity k b i | k b -&gt; i\nclass (Associative k b, HasIdentity k b i) =&gt; Monoidal k b i | k b -&gt; i where\n  idl :: k (b i a) a\n  idr :: k (b a i) a\n  idlInv :: k a (b i a)\n  idrInv :: k a (b a i)\n--\n</code></pre>\n\n<p>The problem with composing morphisms in a monoidal category using <code>(.)</code> is that the objects may be associated differently. For <code>instance</code> <code>Monoidal Hask (,) ()</code>, we might want to compose a morphism of type <code>x -&gt; ((a, b), c)</code> with a morphism of type <code>((a, ()), (b, c)) -&gt; y</code>. To make the types fit, the natural isomorphism given by <code>bimap idrInv id . associate</code> has to be applied.</p>\n\n<p>Does the Haskell type system enable an automatic way of determining an appropriate isomorphism, based on the desired domain and and codomain type? I can't figure out how to do it.</p>\n"}, {"tags": ["haskell", "arrows"], "answers": [{"comments": [{"owner": {"reputation": 555, "user_id": 4637817, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/849a2d4951995c9fcb2b9aec36faaf2c?s=128&d=identicon&r=PG&f=1", "display_name": "Remagpie", "link": "https://stackoverflow.com/users/4637817/remagpie"}, "edited": false, "score": 0, "creation_date": 1468076646, "post_id": 38282794, "comment_id": 63984877, "body": "I can&#39;t understand this answer. <code>(-&gt;)</code> instance does same thing and has exactly same property as standard functions. Like this, Kleisli arrow has exactly same property as monads. So i thought every arrows has exactly same property as its content. Then why do we use arrows?"}, {"owner": {"reputation": 555, "user_id": 4637817, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/849a2d4951995c9fcb2b9aec36faaf2c?s=128&d=identicon&r=PG&f=1", "display_name": "Remagpie", "link": "https://stackoverflow.com/users/4637817/remagpie"}, "edited": false, "score": 1, "creation_date": 1468077187, "post_id": 38282794, "comment_id": 63985039, "body": "Also, I&#39;m bit confused because Kleisli is still representing some <b>function</b>. I thought Arrows are generalization of function, but every arrows I see are still representing existing functions. Then, why should we use arrows instead of existing functions?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 555, "user_id": 4637817, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/849a2d4951995c9fcb2b9aec36faaf2c?s=128&d=identicon&r=PG&f=1", "display_name": "Remagpie", "link": "https://stackoverflow.com/users/4637817/remagpie"}, "edited": false, "score": 1, "creation_date": 1468079030, "post_id": 38282794, "comment_id": 63985608, "body": "It&#39;s a wrapper around a function with some extra structure. Most of the time, you aren&#39;t using anything except functions, but that doesn&#39;t mean the <code>Arrow</code> type class is <i>limited</i> to plain functions."}, {"owner": {"reputation": 375, "user_id": 3854340, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ec386363a0eadb401f5d281af2ed3fc?s=128&d=identicon&r=PG&f=1", "display_name": "aoeu256", "link": "https://stackoverflow.com/users/3854340/aoeu256"}, "edited": false, "score": 0, "creation_date": 1570631909, "post_id": 38282794, "comment_id": 102975090, "body": "A function goes from input -&gt; output using ($):: (input -&gt; output) -&gt; input -&gt; output.  The arrow allows you to bundle the arrow a which tells you how to change the input to the output and maybe extra input and output, along with the input and the output."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 5, "last_activity_date": 1468074209, "creation_date": 1468074209, "answer_id": 38282794, "question_id": 38282740, "link": "https://stackoverflow.com/questions/38282740/how-are-arrows-and-functions-different-in-haskell/38282794#38282794", "title": "How are Arrows and Functions different in haskell?", "body": "<p>That's because you are only looking at the <code>(-&gt;)</code> instance of <code>Arrow</code>. Other types can also declare instances of <code>Arrow</code>, in which the operations are more complicated. For example:</p>\n\n<pre><code>instance Monad m =&gt; Arrow (Kleisli m) where\n    arr f = Kleisli (return . f)\n    first (Kleisli f) = Kleisli (\\ ~(b,d) -&gt; f b &gt;&gt;= \\c -&gt; return (c,d))\n    second (Kleisli f) = Kleisli (\\ ~(d,b) -&gt; f b &gt;&gt;= \\c -&gt; return (d,c))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 555, "user_id": 4637817, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/849a2d4951995c9fcb2b9aec36faaf2c?s=128&d=identicon&r=PG&f=1", "display_name": "Remagpie", "link": "https://stackoverflow.com/users/4637817/remagpie"}, "edited": false, "score": 0, "creation_date": 1468080228, "post_id": 38283574, "comment_id": 63985961, "body": "Oh, now I understand it more clearly. Then can I think <code>Arrow</code> typeclass as class of &#39;composable&#39; objects?"}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 555, "user_id": 4637817, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/849a2d4951995c9fcb2b9aec36faaf2c?s=128&d=identicon&r=PG&f=1", "display_name": "Remagpie", "link": "https://stackoverflow.com/users/4637817/remagpie"}, "edited": false, "score": 0, "creation_date": 1468090421, "post_id": 38283574, "comment_id": 63988946, "body": "@Yang Yes, sort of, but that&#39;s only one part of <code>Arrow</code>, in particular <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Category.html#t:Category\" rel=\"nofollow noreferrer\"><code>Category</code></a>, which defines identity and composition. Arrows also have <a href=\"http://stackoverflow.com/q/38169453/1333025\">other properties</a>, in particular <i>profunctor</i> (although that&#39;s currently not captured by the type class hierarchy), which allows creating arrows from functions (<code>arr</code>) and threading an arrow through a tuple (<code>first</code>)."}, {"owner": {"reputation": 555, "user_id": 4637817, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/849a2d4951995c9fcb2b9aec36faaf2c?s=128&d=identicon&r=PG&f=1", "display_name": "Remagpie", "link": "https://stackoverflow.com/users/4637817/remagpie"}, "edited": false, "score": 0, "creation_date": 1468099925, "post_id": 38283574, "comment_id": 63991461, "body": "Do you mean that class of composable object is different from <code>Arrow</code>? John Hughes&#39; paper says that it&#39;s sufficient to provide <code>arr</code> and <code>&gt;&gt;&gt;</code> to define <code>Arrow</code>. Composability comes from <code>&gt;&gt;&gt;</code>, but where does other properties come from? I don&#39;t think <code>arr</code> does something special."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 555, "user_id": 4637817, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/849a2d4951995c9fcb2b9aec36faaf2c?s=128&d=identicon&r=PG&f=1", "display_name": "Remagpie", "link": "https://stackoverflow.com/users/4637817/remagpie"}, "edited": false, "score": 0, "creation_date": 1468181882, "post_id": 38283574, "comment_id": 64009036, "body": "@Yang I extended the answer. Composition is only one part of what makes arrows interesting, the other two are allowing to manipulate them with pure functions (<code>arr</code>) and allowing to act on only a part of an input (<code>first</code>)."}], "tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": true, "score": 6, "last_activity_date": 1468181802, "last_edit_date": 1495540733, "creation_date": 1468079401, "answer_id": 38283574, "question_id": 38282740, "link": "https://stackoverflow.com/questions/38282740/how-are-arrows-and-functions-different-in-haskell/38283574#38283574", "title": "How are Arrows and Functions different in haskell?", "body": "<p>Having an <strong>abstraction</strong> that obey certain laws allows you to do generic programming. You could program without any type-classes (no monads, applicatives, no equality/ordering etc.), but this would be quite inconvenient as you won't be able to write generic code that takes advantage of these properties.</p>\n\n<p>Just as if you say you don't want the <code>Ord</code> instance, and then you'd have to rewrite the implementation of <code>Set</code> separately for every data type that you can order.</p>\n\n<p>The point of <code>Arrow</code> is to describe computations that</p>\n\n<ul>\n<li>take input,</li>\n<li>produce output, and</li>\n<li>have certain in the middle (<em>effect</em> is a colloquial expression).</li>\n</ul>\n\n<p>So an arrow <code>A b c</code> is not a function <code>a -&gt; b</code>. Most likely an arrow is implemented internally as a function, but a more complex one, and the point of implementing the <code>Arrow</code> interface is to describe (among other things) how they compose.</p>\n\n<p>Specifically for arrows, you have the <a href=\"https://www.haskell.org/arrows/syntax.html\" rel=\"nofollow noreferrer\">arrow notation</a> that allows you to use the same notation for any valid <code>Arrow</code>. To give an example, in the <a href=\"https://hackage.haskell.org/package/netwire\" rel=\"nofollow noreferrer\">netwire</a> package the <a href=\"https://hackage.haskell.org/package/netwire-5.0.1/docs/Control-Wire-Core.html#t:Wire\" rel=\"nofollow noreferrer\"><code>Wire</code></a> data type implements <code>Arrow</code>, so you can use the arrow notation, as well as all utility functions that work on arrows. Without the instance, you'd have to either have some netwire-specific syntax, or just use the function that netwire provides.</p>\n\n<p>To give an example: The arrow corresponding to the <code>State</code> monad is <code>a -&gt; s -&gt; (b, s)</code>. But two such functions don't compose using <code>(.)</code>. You need to describe their composition, and that's exactly what <code>Arrow</code> does.</p>\n\n<hr>\n\n<p><strong>Update:</strong> There can be various notions of composability, but I guess you mean function-like composition. Yes, this composability comes from <code>Arrow</code>'s <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Category.html#t:Category\" rel=\"nofollow noreferrer\"><code>Category</code></a> superclass, which defines identity and composition.</p>\n\n<p>The other part of <code>Arrow</code> comes from <a href=\"https://hackage.haskell.org/package/profunctors-5.2/docs/Data-Profunctor.html#t:Strong\" rel=\"nofollow noreferrer\"><code>Strong</code></a> profunctor as I've recently learned from <a href=\"https://stackoverflow.com/q/38169453/1333025\">What's the relationship between profunctors and arrows?</a> (although this is not captured in the type-class hierarchy, as the <code>Profunctor</code> typeclass is younger than <code>Arrow</code>). Profunctors allow to be modified by pure computations from \"both sides\", see <code>lmap</code>/<code>rmap</code>/<code>dimap</code> in <code>Profunctor</code>. For arrows we have <code>(&lt;&lt;^)</code> and <code>(^&gt;&gt;)</code>, which are expressed using <code>arr</code> and <code>&gt;&gt;&gt;</code> by composing bv an arrow from either side with a pure arrow constructed using <code>arr</code>.</p>\n\n<p>Finally arrows have <em>strength</em> wrt <code>(,)</code>, which is captured by <code>first :: Arrow a =&gt; a b c -&gt; a (b, d) (c, d)</code>. This means that we can use an arrow only on a part of the input, passing another unchanged. This allows to construct \"circuits\" with \"parallel wires\" - without <code>first</code> it wouldn't be possible to save an output of one part of the computation and to use it somewhere further later on.</p>\n\n<p>A good exercise is to draw a circuit that represent a computation and then trying to express it using <code>Arrow</code> primitives/utilities, or alternatively with the arrow syntax notation. You'll see that <code>first</code> (or <code>***</code>) is essential for this.</p>\n\n<p>See <a href=\"https://en.wikibooks.org/wiki/Haskell/Understanding_arrows#An_Arrow_can_multitask\" rel=\"nofollow noreferrer\">Arrows can multitask</a> for nice drawings of the operations.</p>\n\n<p>For more theoretical background <a href=\"http://www-kb.is.s.u-tokyo.ac.jp/~asada/papers/arrStrMnd.pdf\" rel=\"nofollow noreferrer\">Arrows are Strong Monads</a> might be interesting (I haven't read it yet).</p>\n"}], "owner": {"reputation": 555, "user_id": 4637817, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/849a2d4951995c9fcb2b9aec36faaf2c?s=128&d=identicon&r=PG&f=1", "display_name": "Remagpie", "link": "https://stackoverflow.com/users/4637817/remagpie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 882, "favorite_count": 1, "accepted_answer_id": 38283574, "answer_count": 2, "score": 8, "last_activity_date": 1468181802, "creation_date": 1468073836, "question_id": 38282740, "link": "https://stackoverflow.com/questions/38282740/how-are-arrows-and-functions-different-in-haskell", "title": "How are Arrows and Functions different in haskell?", "body": "<p>I learned and searched about Arrows for a while, and I'm a bit confused about necessity of Arrow class.\nAs I know, Arrow class is abstraction of function, and Arrow <code>A a b c</code> represents something takes input of type b and output of type c. Also, it provides several fundamental operations like <code>&gt;&gt;&gt;</code>, <code>arr</code>, and <code>first</code>.</p>\n\n<p>However, I can't find any difference between standard function of type <code>b -&gt; c</code> and Arrow of type <code>A a b c</code>. In my view, <code>first</code> and <code>&gt;&gt;&gt;</code> can be replaced by <code>\\(b, c) -&gt; (f b, c)</code>, and <code>(.)</code>. Also, since every computation inside arrow are represented by function, if we replace arrows by those function, I think there will be no difference.</p>\n\n<p>In short, I think every node of computation graph of Arrows(something like in  <a href=\"https://www.haskell.org/arrows/syntax.html\" rel=\"noreferrer\">https://www.haskell.org/arrows/syntax.html</a>) can be replaced by standard function of Haskell. If it is true, why do we use Arrow instead of functions?</p>\n"}, {"tags": ["windows", "haskell", "ffi", "ghci", "console-input"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1468114472, "post_id": 38282624, "comment_id": 63993936, "body": "I can only tell you two unhelpful things: 1. This works in Linux just fine using <code>stdio.h getchar</code>, without needing to specify a library, and 2. your approach looks approximately correct."}, {"owner": {"reputation": 313, "user_id": 5953321, "user_type": "registered", "profile_image": "https://graph.facebook.com/886468944803810/picture?type=large", "display_name": "Junyoung Clare Jang", "link": "https://stackoverflow.com/users/5953321/junyoung-clare-jang"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1468155744, "post_id": 38282624, "comment_id": 64001467, "body": "@Eric In Linux, there is no need for FFI in this case, since hSetBuffering function works fine, and by using that function, I can make <i>Bufferless Input</i>. However, this approach wasn&#39;t work for Windows."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1468175312, "post_id": 38282624, "comment_id": 64007247, "body": "I was referring only to your main question of trying to link with <code>getChar</code>. I can&#39;t help you on the buffering problem."}, {"owner": {"reputation": 2667, "user_id": 325725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3db095f94749aaedfea12b927b13cf74?s=128&d=identicon&r=PG", "display_name": "Phyx", "link": "https://stackoverflow.com/users/325725/phyx"}, "edited": false, "score": 1, "creation_date": 1470471084, "post_id": 38282624, "comment_id": 64973331, "body": "w.r.t ticket #2189, there is ongoing work to slowly replace things like the IO manager in GHC with native Windows ones. But it&#39;s slow since there are not a lot of Windows maintainers. I currently have to prioritize to tickets which affect the most people."}], "answers": [{"comments": [{"owner": {"reputation": 313, "user_id": 5953321, "user_type": "registered", "profile_image": "https://graph.facebook.com/886468944803810/picture?type=large", "display_name": "Junyoung Clare Jang", "link": "https://stackoverflow.com/users/5953321/junyoung-clare-jang"}, "edited": false, "score": 0, "creation_date": 1470492076, "post_id": 38802027, "comment_id": 64978888, "body": "Then what is the &#39;-l&#39; option in <code>ghci --show-options</code>? And GHCi user guide said &quot;Extra libraries may be specified on the command line using the normal -llib option.&quot; [<a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ghci.html#extra-libraries]\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/latest/docs/html/users_guide/&hellip;</a>"}, {"owner": {"reputation": 2667, "user_id": 325725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3db095f94749aaedfea12b927b13cf74?s=128&d=identicon&r=PG", "display_name": "Phyx", "link": "https://stackoverflow.com/users/325725/phyx"}, "reply_to_user": {"reputation": 313, "user_id": 5953321, "user_type": "registered", "profile_image": "https://graph.facebook.com/886468944803810/picture?type=large", "display_name": "Junyoung Clare Jang", "link": "https://stackoverflow.com/users/5953321/junyoung-clare-jang"}, "edited": false, "score": 0, "creation_date": 1470493701, "post_id": 38802027, "comment_id": 64979379, "body": "@JunyoungClareJang <code>-l</code> is used to indicate to the linker that you have a dependency on a library. Libraries come in different forms, You have static ones commonly with <code>.a</code> extensions, dynamic <code>.dll</code> or import libraries <code>.dll.a</code>, <code>.a</code> and .<code>.lib</code>. when you specify <code>-lfoo</code> you&#39;re telling the linker you need library <code>foo</code>. If you have the library in multiple versions e.g. libfoo.dll, libfoo.a, libfoo.lib, which one the linker uses depends on the various flags and search priorities. As I said before, GHCi currently will always prefer the dynamic version over any and all static ones."}, {"owner": {"reputation": 2667, "user_id": 325725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3db095f94749aaedfea12b927b13cf74?s=128&d=identicon&r=PG", "display_name": "Phyx", "link": "https://stackoverflow.com/users/325725/phyx"}, "reply_to_user": {"reputation": 313, "user_id": 5953321, "user_type": "registered", "profile_image": "https://graph.facebook.com/886468944803810/picture?type=large", "display_name": "Junyoung Clare Jang", "link": "https://stackoverflow.com/users/5953321/junyoung-clare-jang"}, "edited": false, "score": 1, "creation_date": 1470494011, "post_id": 38802027, "comment_id": 64979452, "body": "These don&#39;t magically work, we have to actively write code to support them in GHCi. So some features are not supported yet as the Haskell runtime loader (RTS) doesn&#39;t support them yet. As I said, support for more is actively being added, such as import library support in 8.0.2 <a href=\"https://phabricator.haskell.org/D1696\" rel=\"nofollow noreferrer\">phabricator.haskell.org/D1696</a>"}, {"owner": {"reputation": 2667, "user_id": 325725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3db095f94749aaedfea12b927b13cf74?s=128&d=identicon&r=PG", "display_name": "Phyx", "link": "https://stackoverflow.com/users/325725/phyx"}, "reply_to_user": {"reputation": 313, "user_id": 5953321, "user_type": "registered", "profile_image": "https://graph.facebook.com/886468944803810/picture?type=large", "display_name": "Junyoung Clare Jang", "link": "https://stackoverflow.com/users/5953321/junyoung-clare-jang"}, "edited": false, "score": 0, "creation_date": 1470494713, "post_id": 38802027, "comment_id": 64979644, "body": "Also I should mention, symbol resolution is lazy, e.g we pick the first one we encounter (well, it&#39;s slightly more complicated than that but not important). GHCi has a dependency on the C runtime. On Windows this is msvcrt.dll, so it&#39;s already there by default, specifying it again will do nothing :)"}], "tags": [], "owner": {"reputation": 2667, "user_id": 325725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3db095f94749aaedfea12b927b13cf74?s=128&d=identicon&r=PG", "display_name": "Phyx", "link": "https://stackoverflow.com/users/325725/phyx"}, "is_accepted": true, "score": 1, "last_activity_date": 1470470944, "creation_date": 1470470944, "answer_id": 38802027, "question_id": 38282624, "link": "https://stackoverflow.com/questions/38282624/haskell-foreign-function-interface-with-ghci-in-windows/38802027#38802027", "title": "Haskell Foreign Function Interface with GHCI in Windows", "body": "<p>This is because there is no <code>getch</code> on Windows. <code>getch</code> is POSIX and POSIX has been deprecated on Windows. It's still around but the functions have been moved to a different namespace (to free up the root namespace to user programs). As you can see MSDN says <code>getch</code> is deprecated <a href=\"https://msdn.microsoft.com/en-us/library/ms235446.aspx\" rel=\"nofollow\">https://msdn.microsoft.com/en-us/library/ms235446.aspx</a> and to use <code>_getch</code> instead.</p>\n\n<pre><code>import Control.Monad\nimport Data.Char\nimport Foreign.C\n\ngetCh :: IO Char\ngetCh = liftM (chr . fromEnum) c_getch\nforeign import ccall unsafe \"conio.h _getch\" c_getch :: IO CInt\n\nmain :: IO ()\nmain = getCh &gt;&gt;= \\x -&gt; print x\n</code></pre>\n\n<p>Will work both compiled and interpreted. </p>\n\n<p>As to the why it works compiled and not interpreted when using <code>getch</code>:</p>\n\n<p>The <code>MingW-w64</code> project has never removed deprecated functions as Microsoft has</p>\n\n<p>As such</p>\n\n<pre><code>$ objdump -t /home/Tamar/ghc2/inplace/mingw/x86_64-w64-mingw32/lib/libmsvcr120.a | grep getch\n[  7](sec  1)(fl 0x00)(ty   0)(scl   2) (nx 0) 0x0000000000000000 getch\n[  8](sec  5)(fl 0x00)(ty   0)(scl   2) (nx 0) 0x0000000000000000 __imp_getch\n[  7](sec  1)(fl 0x00)(ty   0)(scl   2) (nx 0) 0x0000000000000000 _getch\n[  8](sec  5)(fl 0x00)(ty   0)(scl   2) (nx 0) 0x0000000000000000 __imp__getch\n</code></pre>\n\n<p><code>getch</code> is being redirected to <code>_getch</code> and so they have both versions. This is a source of incompatibility between MSVC++ and GCC.</p>\n\n<p>Microsoft however has removed them</p>\n\n<pre><code>&gt;dumpbin /exports C:\\Windows\\System32\\msvcr120.dll | findstr getch\n        699  2BA 0006B8B4 _getch = _getch\n</code></pre>\n\n<p>So what happens, when you link against <code>msvcrt</code>:</p>\n\n<ol>\n<li><p>In compiled mode both GCC and GHC will pick the static library first which happens to be an import lib <code>libmsvcrt.dll.a</code>. This is due to the link order of the linker (ld).</p></li>\n<li><p>In interpreted mode, GHCi will <em>always</em> prefer the dynamic version of the library over the static one. The reason is during re-linking (which has to happen when you introduce a new scope or reload) dynamic libraries are much faster as we don't have to internally do relocations and symbol resolving. There are also things we still don't support properly like weak symbols or common symbols, so for these reasons we just prefer the dynamic one.</p></li>\n<li><p>GHCi 8.0.1 does not support import libraries. So while you can force GHCi to use the static library (just give the full name to <code>-l</code>, e.g. <code>-llibmsvcr.a</code>) It won't work because the runtime loader doesn't know what to do with it. This is however supported in the current GIT master and will likely be in <code>8.0.2</code></p></li>\n</ol>\n"}], "owner": {"reputation": 313, "user_id": 5953321, "user_type": "registered", "profile_image": "https://graph.facebook.com/886468944803810/picture?type=large", "display_name": "Junyoung Clare Jang", "link": "https://stackoverflow.com/users/5953321/junyoung-clare-jang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 277, "favorite_count": 0, "accepted_answer_id": 38802027, "answer_count": 1, "score": 3, "last_activity_date": 1470470944, "creation_date": 1468072914, "last_edit_date": 1468155896, "question_id": 38282624, "link": "https://stackoverflow.com/questions/38282624/haskell-foreign-function-interface-with-ghci-in-windows", "title": "Haskell Foreign Function Interface with GHCI in Windows", "body": "<p>First of all, I specify that I use Windows 10 64bit and Haskell Platform 8.0.1.</p>\n\n<p>I try to use FFI of Haskell in Windows using following code.</p>\n\n<pre><code>import Control.Monad\nimport Data.Char\nimport Foreign.C\n\ngetCh :: IO Char\ngetCh = liftM (chr . fromEnum) c_getch\nforeign import ccall unsafe \"conio.h getch\" c_getch :: IO CInt\n\nmain :: IO ()\nmain = getCh &gt;&gt;= \\x -&gt; print x\n</code></pre>\n\n<p>After this, I can compile this well with ghc</p>\n\n<pre><code>&gt; ghc Examples.hs\n[1 of 1] Compiling Main             ( Examples.hs, Examples.o )\nLinking Examples.exe ...\n</code></pre>\n\n<p>and it runs completely.</p>\n\n<pre><code>&gt; Examples.exe\n'1'\n</code></pre>\n\n<p>(When I type 1 after running it)</p>\n\n<p>However, the problem occurs with GHCI. When I load it to ghci, I got these messages.</p>\n\n<pre><code>&gt; ghci Examples.hs\nGHCi, version 8.0.1: http://www.haskell.org/ghc/  :? for help\n[1 of 1] Compiling Main             ( Examples.hs, interpreted )\nOk, modules loaded: Main.\n*Main&gt; main\n\nByteCodeLink: can't find label\nDuring interactive linking, GHCi couldn't find the following symbol:\n  getch\nThis may be due to you not asking GHCi to load extra object files,\narchives or DLLs needed by your current session.  Restart GHCi, specifying\nthe missing library using the -L/path/to/object/dir and -lmissinglibname\nflags, or simply by naming the relevant files on the GHCi command line.\nAlternatively, this link failure might indicate a bug in GHCi.\nIf you suspect the latter, please send a bug report to:\n  glasgow-haskell-bugs@haskell.org\n\n*Main&gt;\n</code></pre>\n\n<p>I try to load \"missing library\", such as \"<code>-lmsvcrt</code>\" which needs to use <code>conio.h</code>, but result is pessimistically same.</p>\n\n<pre><code>&gt; ghci -lmsvcrt Examples.hs\nGHCi, version 8.0.1: http://www.haskell.org/ghc/  :? for help\n[1 of 1] Compiling Main             ( Examples.hs, interpreted )\nOk, modules loaded: Main.\n*Main&gt; main\n\nByteCodeLink: can't find label\nDuring interactive linking, GHCi couldn't find the following symbol:\n  getch\nThis may be due to you not asking GHCi to load extra object files,\narchives or DLLs needed by your current session.  Restart GHCi, specifying\nthe missing library using the -L/path/to/object/dir and -lmissinglibname\nflags, or simply by naming the relevant files on the GHCi command line.\nAlternatively, this link failure might indicate a bug in GHCi.\nIf you suspect the latter, please send a bug report to:\n  glasgow-haskell-bugs@haskell.org\n\n*Main&gt;\n</code></pre>\n\n<p>GHCI probably loads the library, since when I try to load a wrong library, ghci prints errors about that.</p>\n\n<p>I try several other things, like using <code>ghci Examples.hs -fobject-code</code>, <code>ghci -lmsvcrt Examples.hs -fobject-code</code>, and even</p>\n\n<pre><code>ghci Examples.hs \"-luser32\" \"-lgdi32\" \"-lwinmm\" \"-ladvapi32\" \"-lshell32\"\n\"-lshfolder\" \"-lwsock32\" \"-luser32\" \"-lshell32\" \"-lmsvcrt\" \"-lmingw32\" \n\"-lmingwex\" \"-luser32\" \"-lmingw32\" \"-lmingwex\" \"-lm\" \"-lwsock32\" \"-lgdi32\" \"-lwinmm\"\n</code></pre>\n\n<p>Which was found in <code>ghc Examples.hs -v5</code>.</p>\n\n<p>Sadly, Nothing works for my <code>main</code>, and I can't find any otherway for this.</p>\n\n<p>P.S. Is there anyone knowing how to use hSetBuffering in Windows (It was posted at 8 years ago in <a href=\"https://ghc.haskell.org/trac/ghc/ticket/2189\" rel=\"nofollow\">ghc ticket #2189</a>. Isn't it fixed?)</p>\n"}, {"tags": ["haskell", "compile-time-constant"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1468070487, "post_id": 38281729, "comment_id": 63983154, "body": "You can check the generated Core to see if that optimization was performed. But, AFAIK, there is no way to force that."}], "answers": [{"tags": [], "owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "is_accepted": true, "score": 8, "last_activity_date": 1468079981, "last_edit_date": 1468079981, "creation_date": 1468078983, "answer_id": 38283495, "question_id": 38281729, "link": "https://stackoverflow.com/questions/38281729/top-level-expression-evaluation-at-compile-time/38283495#38283495", "title": "Top-level expression evaluation at compile time", "body": "<p>If what you're evaluating is an instance of <a href=\"http://hackage.haskell.org/package/template-haskell-2.11.0.0/docs/Language-Haskell-TH-Syntax.html#t:Lift\"><code>Lift</code></a>, you can evaluate it at compile time using <a href=\"https://wiki.haskell.org/Template_Haskell\"><code>TemplateHaskell</code></a>:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n\nmodule Sort where\n\nimport Data.List\nimport Language.Haskell.TH.Syntax\n\nmyList :: [Int]\nmyList = $(lift (sort [3,2,0,1] :: [Int]))\n</code></pre>\n\n<p>If you want, you can check what it has compiled to with <code>-ddump-splices</code>:</p>\n\n<pre><code>$ ghc -ddump-splices sort\n[1 of 1] Compiling Sort             ( sort.hs, sort.o )\nsort.hs:9:12-41: Splicing expression\n    lift (sort [3, 2, 0, 1] :: [Int]) ======&gt; [0, 1, 2, 3]\n</code></pre>\n"}], "owner": {"reputation": 437, "user_id": 6534153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/65594d05af54fa0c3797bee8aa4a811a?s=128&d=identicon&r=PG&f=1", "display_name": "lanskey", "link": "https://stackoverflow.com/users/6534153/lanskey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 240, "favorite_count": 1, "accepted_answer_id": 38283495, "answer_count": 1, "score": 9, "last_activity_date": 1468079981, "creation_date": 1468066684, "question_id": 38281729, "link": "https://stackoverflow.com/questions/38281729/top-level-expression-evaluation-at-compile-time", "title": "Top-level expression evaluation at compile time", "body": "<p>Is there any way to ensure, that an expression like the following would be evaluated at compile time?</p>\n\n<pre><code>myList :: [Int]\nmyList = sort [3,2,0,1]\n</code></pre>\n"}, {"tags": ["haskell", "ghci"], "owner": {"reputation": 668, "user_id": 3244654, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/56c2ebb679d4e1c1887f9d9252af2c26?s=128&d=identicon&r=PG&f=1", "display_name": "Ignacio", "link": "https://stackoverflow.com/users/3244654/ignacio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1468066325, "creation_date": 1468066325, "question_id": 38281693, "link": "https://stackoverflow.com/questions/38281693/skip-module-in-step-while-debugging-haskell-with-ghci", "title": "Skip module in step while debugging Haskell with GHCi", "body": "<p>I am debugging a Haskell program with <em>GHCi</em>. I am using <code>:step</code> along with <code>:list</code>. There is a point where the program starts to pass repeatedly through the same functions within a <code>Parser.hs</code> module.</p>\n\n<p>I was wondering if there is any way to resume the program with <code>:continue</code> till it exits this <code>Parser.hs</code> module, i.e.</p>\n\n<ul>\n<li>goes back to the next step where it entered it before</li>\n</ul>\n\n<p>or</p>\n\n<ul>\n<li>calls function within another package.</li>\n</ul>\n\n<p>Something like hidding this module from the debugger (I wouldn't mind to hide it for the complete execution). I couldn't find anything in the suggested commands with <code>:help</code> but I don't have a lot of experience with <em>GHCi</em> so I thought to try it here.</p>\n\n<p>Cheers</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "edited": false, "score": 0, "creation_date": 1468068409, "post_id": 38281551, "comment_id": 63982620, "body": "I just tried it in <code>ghci</code> and they have the same signature <code>Num a =&gt; a -&gt; a -&gt; a -&gt; a</code>."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "edited": false, "score": 0, "creation_date": 1468070200, "post_id": 38281551, "comment_id": 63983087, "body": "@zoran119 GHCi behaves differently from compiling with ghc, by default. See the question linked above by chepner."}], "owner": {"reputation": 910, "user_id": 5465739, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/5medg.jpg?s=128&g=1", "display_name": "formatkaka", "link": "https://stackoverflow.com/users/5465739/formatkaka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 40, "favorite_count": 0, "closed_date": 1468070566, "answer_count": 0, "score": 0, "last_activity_date": 1468065279, "creation_date": 1468065279, "question_id": 38281551, "link": "https://stackoverflow.com/questions/38281551/anonymous-function-type-signature", "closed_reason": "Duplicate", "title": "Anonymous function type signature", "body": "<p>I was learning anonymous functions in haskell. </p>\n\n<pre><code>mTH3 x = (\\y -&gt; \\z -&gt; x*y*z)\n</code></pre>\n\n<p>The type signature for this comes out to be</p>\n\n<pre><code>*Main&gt; :t mTH3\nmTH3 :: Num a =&gt; a -&gt; a -&gt; a -&gt; a    \n</code></pre>\n\n<p>Whereas for this function</p>\n\n<pre><code>mTH4 = (\\x -&gt; \\y -&gt; \\z -&gt; x*y*z)  \n</code></pre>\n\n<p>It comes out to be </p>\n\n<pre><code>*Main&gt; :t mTH4\nmTH4 :: Integer -&gt; Integer -&gt; Integer -&gt; Integer\n</code></pre>\n\n<p>What is the reason of difference between them. Why isn't the type signature for second function same as first. If I try to define type signature of the second function like this :</p>\n\n<pre><code>mTH4 :: Num a =&gt; a -&gt; a -&gt; a -&gt; a\nmTH4 = (\\x -&gt; \\y -&gt; \\z -&gt; x*y*z)  \n</code></pre>\n\n<p>Then the output is same as the <code>mTH3</code> function.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1468070360, "post_id": 38281550, "comment_id": 63983125, "body": "This looks as an XY problem: where are you going to use this thing?"}, {"owner": {"reputation": 451, "user_id": 4624605, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/CLvcA.jpg?s=128&g=1", "display_name": "Paul Oskar Mayer", "link": "https://stackoverflow.com/users/4624605/paul-oskar-mayer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1468240958, "post_id": 38281550, "comment_id": 64030963, "body": "Im just learing haskell, im fiddling around to test my understanding."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1468242755, "post_id": 38281550, "comment_id": 64032272, "body": "In that case, I would recommend you pretend there&#39;s no solution to the task above. A key feature of Haskell (and many other languages) is that types are erased at runtime. If a function has type <code>f :: t -&gt; ...</code> it can <i>not</i> inspect type <code>t</code>, since at runtime there is no information about that. This improves performance (no need to keep type info around), and ensures a strong theoretical property called parametricity (ignore this for now)."}, {"owner": {"reputation": 451, "user_id": 4624605, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/CLvcA.jpg?s=128&g=1", "display_name": "Paul Oskar Mayer", "link": "https://stackoverflow.com/users/4624605/paul-oskar-mayer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1468413787, "post_id": 38281550, "comment_id": 64116393, "body": "Cool thanks ! thats the information i need ! and when empty argument is possible i use maybe?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1468417505, "post_id": 38281550, "comment_id": 64119259, "body": "What is an &quot;empty argument&quot;?"}], "answers": [{"tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 2, "last_activity_date": 1468067560, "last_edit_date": 1468067560, "creation_date": 1468065955, "answer_id": 38281645, "question_id": 38281550, "link": "https://stackoverflow.com/questions/38281550/haskell-function-that-matches-any-datatype-to-tuple/38281645#38281645", "title": "Haskell: function that matches any datatype to tuple", "body": "<p>Most likely you are doing this wrong and if done correctly you would not <em>need</em> such a function. Note that you are replacing a <em>type-check error</em> with run-time error.</p>\n\n<p>That said, you may implement that using type classes, and if there is enough context for type inference (or if you add the type annotations):</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances, MultiParamTypeClasses #-}\n\nclass Tuple a b c where\n    tuple :: a -&gt; Maybe (b, c)\n\ninstance Tuple a b c where\n    tuple _ = Nothing\n\ninstance {-# OVERLAPPING #-} Tuple (a, b) a b where\n    tuple = Just\n</code></pre>\n\n<p>then:</p>\n\n<pre><code>\\&gt; let a@(b, _) = (42 :: Int, 3.14 :: Double)\n\\&gt; tuple a :: Maybe (Int, Int)\nNothing\n\\&gt; tuple b :: Maybe (Int, Double)\nNothing\n\\&gt; tuple a :: Maybe (Int, Double)\nJust (42,3.14)\n</code></pre>\n"}], "owner": {"reputation": 451, "user_id": 4624605, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/CLvcA.jpg?s=128&g=1", "display_name": "Paul Oskar Mayer", "link": "https://stackoverflow.com/users/4624605/paul-oskar-mayer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 38281645, "answer_count": 1, "score": 1, "last_activity_date": 1468067560, "creation_date": 1468065274, "question_id": 38281550, "link": "https://stackoverflow.com/questions/38281550/haskell-function-that-matches-any-datatype-to-tuple", "title": "Haskell: function that matches any datatype to tuple", "body": "<p>im looking for a function that takes any datatype, matched only tuples and throws an error if input is no tuple. My idea is something like this:</p>\n\n<pre><code>transformTuple :: t -&gt; (a,b)\ntransformTuple (a,b) = (a,b)\ntransformTuple _ = error \"no tuple\"\n</code></pre>\n\n<p>this doesnt work because in line 2 (a,b) is matched with t, with clearly doesnt work.</p>\n"}, {"tags": ["haskell", "category-theory"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1468098271, "post_id": 38281441, "comment_id": 63991091, "body": "<code>category-extras</code> has been deprecated for a while. Have you looked at <a href=\"https://hackage.haskell.org/package/categories-1.0.7/docs/Control-Category-Associative.html\" rel=\"nofollow noreferrer\"><code>Associative</code></a> from the <code>categories</code> replacement package? This package also has <a href=\"https://hackage.haskell.org/package/categories-1.0.7/docs/Control-Category-Monoidal.html\" rel=\"nofollow noreferrer\"><code>Monoidal</code></a> with inverses."}, {"owner": {"reputation": 131, "user_id": 4108839, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-u3r9Hd2y9y8/AAAAAAAAAAI/AAAAAAAAAAA/AMZuuckhyIsYzernILdGTfK66_1DRHcLog/s96-c/photo.jpg?sz=128", "display_name": "Benjamin Berger", "link": "https://stackoverflow.com/users/4108839/benjamin-berger"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1468238684, "post_id": 38281441, "comment_id": 64029333, "body": "Ah thank you, I did not know it was deprecated."}], "answers": [{"comments": [{"owner": {"reputation": 131, "user_id": 4108839, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-u3r9Hd2y9y8/AAAAAAAAAAI/AAAAAAAAAAA/AMZuuckhyIsYzernILdGTfK66_1DRHcLog/s96-c/photo.jpg?sz=128", "display_name": "Benjamin Berger", "link": "https://stackoverflow.com/users/4108839/benjamin-berger"}, "edited": false, "score": 0, "creation_date": 1468068070, "post_id": 38281510, "comment_id": 63982510, "body": "The type is right, but isn&#39;t usually &quot;Co&quot; something different from &quot;inverse&quot;?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 131, "user_id": 4108839, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-u3r9Hd2y9y8/AAAAAAAAAAI/AAAAAAAAAAA/AMZuuckhyIsYzernILdGTfK66_1DRHcLog/s96-c/photo.jpg?sz=128", "display_name": "Benjamin Berger", "link": "https://stackoverflow.com/users/4108839/benjamin-berger"}, "edited": false, "score": 0, "creation_date": 1468094496, "post_id": 38281510, "comment_id": 63990125, "body": "Ah good point.  We probably need some sort of law that relates the two..."}, {"owner": {"reputation": 131, "user_id": 4108839, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-u3r9Hd2y9y8/AAAAAAAAAAI/AAAAAAAAAAA/AMZuuckhyIsYzernILdGTfK66_1DRHcLog/s96-c/photo.jpg?sz=128", "display_name": "Benjamin Berger", "link": "https://stackoverflow.com/users/4108839/benjamin-berger"}, "edited": false, "score": 0, "creation_date": 1468097237, "post_id": 38281510, "comment_id": 63990827, "body": "If that is true, than the inverses for <code>idl</code> and <code>idr</code> are in <code>Comonoidal</code>. The Documentation says:  This type class is also (ab)used for the inverse operations needed for a strict (co)monoidal category. A strict (co)monoidal category is one that is both Monoidal and Comonoidal and satisfies the following laws:"}, {"owner": {"reputation": 131, "user_id": 4108839, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-u3r9Hd2y9y8/AAAAAAAAAAI/AAAAAAAAAAA/AMZuuckhyIsYzernILdGTfK66_1DRHcLog/s96-c/photo.jpg?sz=128", "display_name": "Benjamin Berger", "link": "https://stackoverflow.com/users/4108839/benjamin-berger"}, "edited": false, "score": 0, "creation_date": 1468097647, "post_id": 38281510, "comment_id": 63990927, "body": "\u2026 But according to my humble understanding of category theory, this is nonsense. The associator and the unitors should <i>always</i> have an inverse. And Wikipedia says: A <b>strict monoidal category</b> is one for which the natural isomorphisms \u03b1, \u03bb and \u03c1 are identities."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 131, "user_id": 4108839, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-u3r9Hd2y9y8/AAAAAAAAAAI/AAAAAAAAAAA/AMZuuckhyIsYzernILdGTfK66_1DRHcLog/s96-c/photo.jpg?sz=128", "display_name": "Benjamin Berger", "link": "https://stackoverflow.com/users/4108839/benjamin-berger"}, "edited": false, "score": 0, "creation_date": 1468102596, "post_id": 38281510, "comment_id": 63991935, "body": "You&#39;re probably right. I think you should probably talk to Ed directly <a href=\"https://github.com/ekmett/category-extras\" rel=\"nofollow noreferrer\">github.com/ekmett/category-extras</a>"}, {"owner": {"reputation": 131, "user_id": 4108839, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-u3r9Hd2y9y8/AAAAAAAAAAI/AAAAAAAAAAA/AMZuuckhyIsYzernILdGTfK66_1DRHcLog/s96-c/photo.jpg?sz=128", "display_name": "Benjamin Berger", "link": "https://stackoverflow.com/users/4108839/benjamin-berger"}, "edited": false, "score": 0, "creation_date": 1468239127, "post_id": 38281510, "comment_id": 64029657, "body": "Your answer helped me to find where the inverses are, but I also learned that I was asking about a deprecated Package, which was even more helpful. So, should I accept your answer or what? I don&#39;t know."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 131, "user_id": 4108839, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-u3r9Hd2y9y8/AAAAAAAAAAI/AAAAAAAAAAA/AMZuuckhyIsYzernILdGTfK66_1DRHcLog/s96-c/photo.jpg?sz=128", "display_name": "Benjamin Berger", "link": "https://stackoverflow.com/users/4108839/benjamin-berger"}, "edited": false, "score": 0, "creation_date": 1468783289, "post_id": 38281510, "comment_id": 64256651, "body": "Benjamin, who cares?  ;-)  I guess it&#39;s a (very weak) signal to future searchers about whether they will find something useful here..."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 2, "last_activity_date": 1468065038, "creation_date": 1468065038, "answer_id": 38281510, "question_id": 38281441, "link": "https://stackoverflow.com/questions/38281441/haskell-control-category-monoidal-inverse-of-associate-idl-and-idr/38281510#38281510", "title": "Haskell: Control.Category.Monoidal: inverse of associate, idl and idr", "body": "<p>Looks like the inverse is defined by the class <a href=\"https://hackage.haskell.org/package/category-extras-0.51.3/docs/Control-Category-Associative.html\" rel=\"nofollow\"><code>Coassociative</code></a>, and it is probably that way just for more granularity and generality.</p>\n"}], "owner": {"reputation": 131, "user_id": 4108839, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-u3r9Hd2y9y8/AAAAAAAAAAI/AAAAAAAAAAA/AMZuuckhyIsYzernILdGTfK66_1DRHcLog/s96-c/photo.jpg?sz=128", "display_name": "Benjamin Berger", "link": "https://stackoverflow.com/users/4108839/benjamin-berger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1468065038, "creation_date": 1468064411, "question_id": 38281441, "link": "https://stackoverflow.com/questions/38281441/haskell-control-category-monoidal-inverse-of-associate-idl-and-idr", "title": "Haskell: Control.Category.Monoidal: inverse of associate, idl and idr", "body": "<p><code>Control.Category.Associative</code> declares the morphism <code>associate</code>:</p>\n\n<pre><code>class Bifunctor p k k k =&gt; Associative k p where\n    associate :: k (p (p a b) c) (p a (p b c))\n</code></pre>\n\n<p>But, as I understand monoidal categories, the associator should be an isomorphism. Where is its inverse? \n<code>Control.Categor.Monoidal</code> doesn't declare it either, just the left and right unitor components (<code>idl</code> and <code>idr</code>), and also omits their inverses.</p>\n\n<p>Is there a possibility to get the inverses from these morphisms in a canonical way that I'm overlooking, or why are the inverses omitted?</p>\n"}, {"tags": ["haskell", "esqueleto"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1468062268, "post_id": 38281072, "comment_id": 63980805, "body": "Try <code>select (return 1)</code> -- can&#39;t check it now, but it might work."}, {"owner": {"reputation": 1804, "user_id": 1260229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a918b56d3f83f46ced68b33737396b87?s=128&d=identicon&r=PG", "display_name": "sn&#248;reven", "link": "https://stackoverflow.com/users/1260229/sn%c3%b8reven"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1468062575, "post_id": 38281072, "comment_id": 63980880, "body": "@chi: unfortunately not: <code>No instance for (Database.Esqueleto.Internal.Sql.SqlSelect Int r0)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 1, "last_activity_date": 1468952807, "creation_date": 1468952807, "answer_id": 38465917, "question_id": 38281072, "link": "https://stackoverflow.com/questions/38281072/esqueleto-query-that-returns-constant-value/38465917#38465917", "title": "Esqueleto query that returns constant value", "body": "<p>Try this:</p>\n\n<pre><code>import Database.Esqueleto\n\n-- | We have to specialize `val` or else the type inferencer\n-- will complain about the `Esqueleto` instance.\nval_ :: Int -&gt; SqlExpr (Value Int)\nval_ = val\n\nquery :: SqlPersistT IO [Value Int]\nquery = select $ return (val_ 1)\n</code></pre>\n\n<p>@chi's comment was close, but the <code>1</code> needed to be lifted into a <code>SqlExpr</code>. <code>val</code> is written generically and depends on an <code>Esqueleto</code> class instance. Normally the type inferencer would grab this as soon as you used <code>from</code> and pulled in a SQL table, but since none of that is available here we have to specialize manually.</p>\n\n<p>Overall a good example of how typeclasses can obfuscate meaning and force people to turn to documentation or forums.</p>\n"}], "owner": {"reputation": 1804, "user_id": 1260229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a918b56d3f83f46ced68b33737396b87?s=128&d=identicon&r=PG", "display_name": "sn&#248;reven", "link": "https://stackoverflow.com/users/1260229/sn%c3%b8reven"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 38465917, "answer_count": 1, "score": 1, "last_activity_date": 1468952807, "creation_date": 1468061750, "question_id": 38281072, "link": "https://stackoverflow.com/questions/38281072/esqueleto-query-that-returns-constant-value", "title": "Esqueleto query that returns constant value", "body": "<p>Is it possible to use <a href=\"https://hackage.haskell.org/package/esqueleto-2.4.3\" rel=\"nofollow\">esqueleto</a> to create a query that returns a constant value? Like <code>SELECT 1</code> for example.</p>\n"}, {"tags": ["javascript", "haskell", "functional-programming", "ramda.js"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1468063578, "post_id": 38278449, "comment_id": 63981162, "body": "Definitely <code>zipWith</code>. As a method: <code>let xs = [1, 2, 3, 4], ys = [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;]; xs.map((x, i) =&gt; [x, ys[i]])</code> or as a curried function: <code>const zipWith = ys =&gt; xs =&gt; xs.map((x, i) =&gt; [x, ys[i]]); zipWith(ys)(xs);</code>. I haven&#39;t a ramda solution though."}], "answers": [{"tags": [], "owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "is_accepted": false, "score": 4, "last_activity_date": 1468040056, "creation_date": 1468040056, "answer_id": 38278486, "question_id": 38278449, "link": "https://stackoverflow.com/questions/38278449/is-there-a-name-for-mapping-multiple-lists/38278486#38278486", "title": "Is there a name for &#39;map&#39;ping multiple lists?", "body": "<p><code>mapMultiple :: (([a,b]) -&gt; c) -&gt; [[a],[b]] -&gt; [c]</code></p>\n\n<p>In Haskell, <code>[] :: * -&gt; *</code> i.e. it takes a type and returns a type. Therefore, <code>[] [a] [b]</code> i.e. <code>[[a],[b]]</code> does not make sense.</p>\n\n<p>You possibly meant to use a 2-tuple.</p>\n\n<p><code>mapMultiple :: ((a, b) -&gt; c) -&gt; ([a], [b]) -&gt; [c]</code></p>\n\n<p>In that case, look at <code>zip :: [a] -&gt; [b] -&gt; [(a, b)]</code>. What you may be looking for is <code>map f . uncurry zip</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1468043826, "last_edit_date": 1468043826, "creation_date": 1468043203, "answer_id": 38278793, "question_id": 38278449, "link": "https://stackoverflow.com/questions/38278449/is-there-a-name-for-mapping-multiple-lists/38278793#38278793", "title": "Is there a name for &#39;map&#39;ping multiple lists?", "body": "<p>Perhaps you are looking for <code>zipWith</code>, which is zip+map in Haskell:</p>\n\n<pre><code>&gt; zipWith (*) [1,2,3] [4,5,6]\n[4,10,18]\n</code></pre>\n\n<p>It is <a href=\"http://ramdajs.com/docs/#zipWith\" rel=\"nofollow\">available in Rambda</a>, too.</p>\n\n<p>Or <code>zipList3</code> for 3 lists:</p>\n\n<pre><code>&gt; zipWith3 (\\a b c -&gt; a+2*b+3*c) [1,2,3] [4,5,6] [7,8,9]\n[30,36,42]\n</code></pre>\n\n<p>The <code>ZipList</code> applicative generalizes to an arbitrary (statically known) number of lists, at the price of more verbosity:</p>\n\n<pre><code>&gt; (\\a b c d -&gt; a+2*b+3*c+4*d) &lt;$&gt; ZipList [1,2,3] &lt;*&gt; ZipList [4,5,6] &lt;*&gt; ZipList [7,8,9] &lt;*&gt; ZipList [10,11,12]\nZipList {getZipList = [70,80,90]}\n</code></pre>\n"}], "owner": {"reputation": 2829, "user_id": 1314444, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/046fa9e14978671c197265898995c4dd?s=128&d=identicon&r=PG", "display_name": "Secret", "link": "https://stackoverflow.com/users/1314444/secret"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 38278793, "answer_count": 2, "score": 1, "last_activity_date": 1468043826, "creation_date": 1468039705, "question_id": 38278449, "link": "https://stackoverflow.com/questions/38278449/is-there-a-name-for-mapping-multiple-lists", "title": "Is there a name for &#39;map&#39;ping multiple lists?", "body": "<p>I want to map multiple lists in the same pass. Is there a name for this pattern? </p>\n\n<p>Essentially, I'm looking for the name of something essentially similar to this:</p>\n\n<p><code>mapMultiple :: (([a,b]) -&gt; c) -&gt; [[a],[b]] -&gt; [c]</code></p>\n\n<p>But hopefully can have more than two lists (my haskell is rusty and I'm not sure of how to write that type signature)</p>\n\n<p>For something more concrete, let's say I have lists <code>A</code> and <code>B</code> such that:</p>\n\n<p><code>A = [1, 2, 3, 4] and B = ['A', 'B', 'C', 'D']</code></p>\n\n<p>I want to be able to map a list of A and B like so:</p>\n\n<p><code>mapMultiple(([num, letter]) =&gt; ([ num, letter ]), [A, B]) == [[1,'A'], [2,'B'],[3,'C'],[4,'D']]</code></p>\n\n<p>In rough psuedo code, here is how you would implement it:</p>\n\n<pre><code>mapMultiple = (fn, lists) =&gt; map(fn, zip(lists))\n</code></pre>\n\n<p>I'm looking for the common name for this pattern/function.</p>\n\n<p>Bonus points if you know its implementation name (or if it's not implemented) in Ramda.js</p>\n"}, {"tags": ["haskell", "package", "ghci"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1468043095, "post_id": 38278162, "comment_id": 63976315, "body": "I only know <code>:! cabal info packageName</code>-- I&#39;m not sure whether there&#39;s an internal command for that."}, {"owner": {"reputation": 72435, "user_id": 119549, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/3KYsB.jpg?s=128&g=1", "display_name": "Jacob", "link": "https://stackoverflow.com/users/119549/jacob"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1468046347, "post_id": 38278162, "comment_id": 63976899, "body": "An external command might be ok. However, I tried your suggestion and get this message: cabal: Use of GHC&#39;s environment variable GHC_PACKAGE_PATH is incompatible with Cabal. Use the flag --package-db to specify a package database (it can be used multiple times)."}, {"owner": {"reputation": 72435, "user_id": 119549, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/3KYsB.jpg?s=128&g=1", "display_name": "Jacob", "link": "https://stackoverflow.com/users/119549/jacob"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1468046433, "post_id": 38278162, "comment_id": 63976922, "body": "I am able to run that <i>outside</i> of <code>ghci</code>, and it seems to get me what I want."}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 2, "creation_date": 1468126748, "post_id": 38278162, "comment_id": 63995741, "body": "<code>ghc-pkg describe &lt;package&gt;</code> is another external command that displays the exposed modules. Or even <code>ghc-pkg field &lt;package&gt; exposed-modules</code>. You can even define a GHCi macro: <code>:def pkg (\\ pkgname -&gt; System.Process.system (&quot;ghc-pkg field &quot; ++ pkgname ++ &quot; exposed-modules&quot;) &gt;&gt; return &quot;&quot;)</code>. And then say <code>:pkg &lt;pkgname</code> at the GHCi prompt."}, {"owner": {"reputation": 72435, "user_id": 119549, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/3KYsB.jpg?s=128&g=1", "display_name": "Jacob", "link": "https://stackoverflow.com/users/119549/jacob"}, "reply_to_user": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 1, "creation_date": 1468176003, "post_id": 38278162, "comment_id": 64007450, "body": "@kosmikus, I didn&#39;t know about the ability to create macros! That should be posted as an answer."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1537315453, "post_id": 38278162, "comment_id": 91737112, "body": "Can you make a package that does this?"}], "owner": {"reputation": 72435, "user_id": 119549, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/3KYsB.jpg?s=128&g=1", "display_name": "Jacob", "link": "https://stackoverflow.com/users/119549/jacob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 215, "favorite_count": 1, "answer_count": 0, "score": 4, "last_activity_date": 1468036712, "creation_date": 1468036712, "question_id": 38278162, "link": "https://stackoverflow.com/questions/38278162/browsing-a-package-in-ghci", "title": "Browsing a package in ghci", "body": "<p>I have a project set up via <code>stack</code> and am importing a package dependency. I see that the package downloaded/installed successfully, so I had hoped that the REPL spawned by <code>stack ghci</code> would let me explore this package. To my surprise, there doesn't seem to be any sort of command for browsing a package. You can use <code>:browse</code> to look through a <em>module</em>, but I don't seem to have any way to see which modules are exposed by this package.</p>\n\n<p>Is there any way to inspect a <em>package</em> in <code>ghci</code>? And if not, are there other ways to inspect a package? I know there are websites which provide documentation, but I want to ensure the information I'm seeing matches the actual version of the package which is installed.</p>\n"}, {"tags": ["haskell", "hakyll"], "answers": [{"comments": [{"owner": {"reputation": 9806, "user_id": 382982, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/9ZaxF.jpg?s=128&g=1", "display_name": "pdoherty926", "link": "https://stackoverflow.com/users/382982/pdoherty926"}, "edited": false, "score": 0, "creation_date": 1468088778, "post_id": 38284768, "comment_id": 63988497, "body": "Thanks for the reply. Unfortunately, introducing your code doesn&#39;t change anything - which leads me to believe I&#39;m doing something else incorrectly. Do you know if it&#39;s possible that I&#39;m running into <a href=\"http://blog.gmane.org/gmane.comp.lang.haskell.hakyll/month=20130601\" rel=\"nofollow noreferrer\">this</a> issue?"}, {"owner": {"reputation": 4630, "user_id": 160386, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b6044f355342bb055fbb03804d9673e3?s=128&d=identicon&r=PG", "display_name": "Jan Tojnar", "link": "https://stackoverflow.com/users/160386/jan-tojnar"}, "reply_to_user": {"reputation": 9806, "user_id": 382982, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/9ZaxF.jpg?s=128&g=1", "display_name": "pdoherty926", "link": "https://stackoverflow.com/users/382982/pdoherty926"}, "edited": false, "score": 1, "creation_date": 1468091718, "post_id": 38284768, "comment_id": 63989310, "body": "Can you share an output of rebuilding with <code>-v</code> argument (e.g. <code>stack exec -- site rebuild -v</code>)"}, {"owner": {"reputation": 9806, "user_id": 382982, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/9ZaxF.jpg?s=128&g=1", "display_name": "pdoherty926", "link": "https://stackoverflow.com/users/382982/pdoherty926"}, "edited": false, "score": 0, "creation_date": 1468093558, "post_id": 38284768, "comment_id": 63989847, "body": "<a href=\"https://gist.github.com/ethagnawl/e849ed70639c8b87630418efc8fbdc40\" rel=\"nofollow noreferrer\">Here&#39;s</a> the output of that command and <a href=\"https://github.com/ethagnawl/peterdohertys.website\" rel=\"nofollow noreferrer\">the latest code</a>. Thanks, again."}, {"owner": {"reputation": 4630, "user_id": 160386, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b6044f355342bb055fbb03804d9673e3?s=128&d=identicon&r=PG", "display_name": "Jan Tojnar", "link": "https://stackoverflow.com/users/160386/jan-tojnar"}, "reply_to_user": {"reputation": 9806, "user_id": 382982, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/9ZaxF.jpg?s=128&g=1", "display_name": "pdoherty926", "link": "https://stackoverflow.com/users/382982/pdoherty926"}, "edited": false, "score": 0, "creation_date": 1468094202, "post_id": 38284768, "comment_id": 63990032, "body": "That\u2019s weird, the site content rebuilds just fine for me. Did you rebuild the haskell code of the site itself (<code>stack build</code>)?"}, {"owner": {"reputation": 9806, "user_id": 382982, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/9ZaxF.jpg?s=128&g=1", "display_name": "pdoherty926", "link": "https://stackoverflow.com/users/382982/pdoherty926"}, "edited": false, "score": 0, "creation_date": 1468094576, "post_id": 38284768, "comment_id": 63990149, "body": "Arg - that was it. I was working under the assumption that that was handled by <code>stack exec site build</code>. However, now that I&#39;m re-reading the tutorial, I see that it&#39;s stated very clearly that it is not. Thanks for your help."}], "tags": [], "owner": {"reputation": 4630, "user_id": 160386, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b6044f355342bb055fbb03804d9673e3?s=128&d=identicon&r=PG", "display_name": "Jan Tojnar", "link": "https://stackoverflow.com/users/160386/jan-tojnar"}, "is_accepted": true, "score": 1, "last_activity_date": 1468094701, "last_edit_date": 1468094701, "creation_date": 1468087489, "answer_id": 38284768, "question_id": 38278142, "link": "https://stackoverflow.com/questions/38278142/why-am-i-unable-to-define-an-arbitrary-field-in-hakyll/38284768#38284768", "title": "Why am I unable to define an arbitrary field in Hakyll?", "body": "<p>When trying your code, I get no such error. Instead I get a type error from linkCtx. It can be corrected like this:</p>\n\n<pre><code>linkCtx =\n    field \"link\" (\\item -&gt; return (itemBody item)) `mappend`\n    defaultContext\n</code></pre>\n\n<p>Or more idiomatically, replacing the lambda with <a href=\"https://wiki.haskell.org/Pointfree\" rel=\"nofollow\">point-free form</a>.</p>\n\n<pre><code>linkCtx =\n    field \"link\" (return . itemBody) `mappend`\n    defaultContext\n</code></pre>\n\n<p>Also if you want to load some items, you should match them first so hakyll knows about their existence.</p>\n\n<pre><code>    match \"links/*\" $ compile pandocCompiler\n</code></pre>\n\n<p>After making the changes listed above, rebuild site.hs using: <code>stack build</code> and the list of links will be rendered in index.html</p>\n"}], "owner": {"reputation": 9806, "user_id": 382982, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/9ZaxF.jpg?s=128&g=1", "display_name": "pdoherty926", "link": "https://stackoverflow.com/users/382982/pdoherty926"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "accepted_answer_id": 38284768, "answer_count": 1, "score": 0, "last_activity_date": 1468094701, "creation_date": 1468036522, "question_id": 38278142, "link": "https://stackoverflow.com/questions/38278142/why-am-i-unable-to-define-an-arbitrary-field-in-hakyll", "title": "Why am I unable to define an arbitrary field in Hakyll?", "body": "<p>When trying to define a \"links\" field on my index page, I'm met with an error that says: <code>[ERROR] Missing field $links$ in context for item index.html</code>, even though I have created a <code>links</code> field. (At least I'm pretty sure I have ...)</p>\n\n<pre><code>-- site.hs\nmain = hakyll $ do\n\n    match \"index.html\" $ do\n        route idRoute\n        compile $ do\n            links &lt;- loadAll \"links/*\"\n            let indexCtx =\n                    listField \"links\" linkCtx (return links) `mappend`\n                    constField \"title\" \"Home\"                `mappend`\n                    defaultContext\n\n            getResourceBody\n                &gt;&gt;= applyAsTemplate indexCtx\n                &gt;&gt;= loadAndApplyTemplate \"templates/default.html\" indexCtx\n                &gt;&gt;= relativizeUrls\n\n    match \"templates/*\" $ compile templateBodyCompiler\n\n\nlinkCtx :: Context String\nlinkCtx =\n    field \"link\" $ \\item -&gt; return (itemBody item)\n    defaultContext\n\n-- index.html\n&lt;h2&gt;Links&lt;/h2&gt;\n$partial(\"templates/link-list.html\")$\n\n-- templates/link-list.html\n&lt;ul&gt;\n    $for(links)$\n        $link$\n    $endfor$\n&lt;/ul&gt;\n\n-- links/behance.markdown\n---\ntitle: Behance\n---\n\n[Behance](https://www.behance.net/laylow)\n</code></pre>\n"}, {"tags": ["haskell", "prompt", "ghci"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1468044374, "post_id": 38273781, "comment_id": 63976530, "body": "You can also use e.g. <code>\\o33</code> for octal escape codes, which is closer to Bash. Converting oct-&gt;dec is boring :P"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 3, "last_activity_date": 1468004852, "creation_date": 1468004852, "answer_id": 38273781, "question_id": 38273567, "link": "https://stackoverflow.com/questions/38273567/setting-the-ghci-prompt-with-colors/38273781#38273781", "title": "Setting the ghci prompt with colors", "body": "<p>Haskell character escape codes are in decimal:</p>\n\n<pre><code>Prelude&gt; :set prompt \"\\027[31mhaskell&gt;\\027[0m \"\n</code></pre>\n\n<p>Putting the same directive in your <code>.ghci</code> file should also work.</p>\n"}, {"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1468005103, "post_id": 38273804, "comment_id": 63966981, "body": "Oh, so GHCi stops counting with <code>\\ESC</code> (and maybe any unprintable character) until it sees <code>\\STX</code>?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1468005191, "post_id": 38273804, "comment_id": 63967022, "body": "Never mind, I should read the pages I link to more carefully :)"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 9, "last_activity_date": 1468005159, "last_edit_date": 1468005159, "creation_date": 1468004975, "answer_id": 38273804, "question_id": 38273567, "link": "https://stackoverflow.com/questions/38273567/setting-the-ghci-prompt-with-colors/38273804#38273804", "title": "Setting the ghci prompt with colors", "body": "<p>According to <a href=\"https://wiki.haskell.org/GHCi_in_colour\" rel=\"noreferrer\">https://wiki.haskell.org/GHCi_in_colour</a>, you can use</p>\n\n<pre><code>:set prompt \"\\ESC[33m\\STXhaskell &gt; \\ESC[m\\STX\"\n</code></pre>\n\n<p>A few notes of explanation:</p>\n\n<ol>\n<li>Only a double-quoted string is treated specially; single quotes are treated as part of the prompt.</li>\n<li>The double-quoted string follows Haskell practice.</li>\n<li><code>\\STX</code> corresponds to the <code>\\]</code> of your <code>bash</code> prompt; <strike>it's not clear why GHCi does not require the equivalent of <code>\\[</code> as well. (Perhaps it does; I haven't played with this much.)</strike>. See <a href=\"http://trac.haskell.org/haskeline/wiki/ControlSequencesInPrompt\" rel=\"noreferrer\">http://trac.haskell.org/haskeline/wiki/ControlSequencesInPrompt</a> for an explanation.</li>\n</ol>\n"}], "owner": {"reputation": 4639, "user_id": 3986708, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/g0JCF.jpg?s=128&g=1", "display_name": "hgiesel", "link": "https://stackoverflow.com/users/3986708/hgiesel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1665, "favorite_count": 1, "accepted_answer_id": 38273804, "answer_count": 2, "score": 5, "last_activity_date": 1468005159, "creation_date": 1468003983, "question_id": 38273567, "link": "https://stackoverflow.com/questions/38273567/setting-the-ghci-prompt-with-colors", "title": "Setting the ghci prompt with colors", "body": "<p>I try to use terminal colors within my ghci prompt.</p>\n\n<p>So when I open <code>ghci</code> and try to:</p>\n\n<pre><code>Prelude&gt; :set prompt '\\[\\033[1haskell &gt; \\033[0m\\]'\n'\\[\\033[1\\]haskell&gt; \\[\\033[0m\\] '\n</code></pre>\n\n<p>I know that these codes are interpreted by bash with <code>echo</code> and the <code>-e</code> flag. But how can I do this within ghci?</p>\n"}, {"tags": ["haskell", "monads", "applicative", "category-theory"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1468000305, "post_id": 38272545, "comment_id": 63964633, "body": "I think <a href=\"http://stackoverflow.com/a/32932140/1477667\">&#216;rjan Johansen&#39;s answer</a> to your previous question (specifically the addendum) should answer this one."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1468001137, "post_id": 38272545, "comment_id": 63965048, "body": "@dfeuer You&#39;re right, I forgot about that addendum, that&#39;s indeed the answer."}], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "closed_date": 1468001165, "answer_count": 0, "score": 0, "last_activity_date": 1467999667, "creation_date": 1467999667, "last_edit_date": 1495542760, "question_id": 38272545, "link": "https://stackoverflow.com/questions/38272545/are-monad-instances-uniquely-determined-by-their-applicative-instances", "closed_reason": "Duplicate", "title": "Are Monad instances uniquely determined by their Applicative instances?", "body": "<p>In <a href=\"https://stackoverflow.com/q/32931549/1333025\">To what extent are Applicative/Monad instances uniquely determined?</a> I asked if the for a given data type the instances are uniquely determined (which is not the case). However, a related but different question is:</p>\n\n<p><strong>If we have a data type with an <code>Applicative</code> instance, can it have more than one valid <code>Monad</code> instance?</strong> Or in other words, is the corresponding monad uniquely determined, if it exists?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1467997286, "post_id": 38272006, "comment_id": 63963207, "body": "It&#39;s a bang pattern. It means that the construct is string, so that <code>First undefined == undefined</code>."}], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 2, "last_activity_date": 1467997289, "creation_date": 1467997289, "answer_id": 38272027, "question_id": 38272006, "link": "https://stackoverflow.com/questions/38272006/exclamation-mark-in-data-declaration-in-haskell/38272027#38272027", "title": "Exclamation mark in data declaration in Haskell", "body": "<p>It makes this field <em>strict</em> - <a href=\"https://wiki.haskell.org/Performance/Data_types#Strict_fields\" rel=\"nofollow\">see here</a></p>\n\n<p>if you add this to the field you make sure that the value is evaluated when you use the constructor - it's usually helpful to avoid space-leaks (from a huge thunk-chain)</p>\n\n<p>if you use GHC8 you can have this by default if you use the <a href=\"https://ghc.haskell.org/trac/ghc/wiki/StrictPragma\" rel=\"nofollow\"><code>Strict</code> or <code>StrictData</code> pragma</a></p>\n"}], "owner": {"reputation": 1346, "user_id": 517748, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/74457757fdbd05d55a166a65c548be38?s=128&d=identicon&r=PG", "display_name": "ihatetoregister", "link": "https://stackoverflow.com/users/517748/ihatetoregister"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 501, "favorite_count": 0, "closed_date": 1467997718, "accepted_answer_id": 38272027, "answer_count": 1, "score": 0, "last_activity_date": 1467997289, "creation_date": 1467997195, "question_id": 38272006, "link": "https://stackoverflow.com/questions/38272006/exclamation-mark-in-data-declaration-in-haskell", "closed_reason": "Duplicate", "title": "Exclamation mark in data declaration in Haskell", "body": "<p>What does the exclamation mark mean in this Haskell data declaration:</p>\n\n<pre><code>data Sample = First !Integer | Second !String\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1467996786, "post_id": 38271849, "comment_id": 63962987, "body": "Your type signature suggests that <code>cons8</code> can work with lists of any type, but if you want to put an <code>8</code> in the list, it needs to be a list of numbers."}, {"owner": {"reputation": 788, "user_id": 559103, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/861480630ebcb6626912c9f4818d7d5b?s=128&d=identicon&r=PG", "display_name": "j.i.h.", "link": "https://stackoverflow.com/users/559103/j-i-h"}, "edited": false, "score": 0, "creation_date": 1467997180, "post_id": 38271849, "comment_id": 63963166, "body": "This is probably a duplicate, but it&#39;s an easy answer anyways:  you need to put two definitions below which it will pattern match, one for empty list and one for non, two lines:  <code>cons8 [] = (your empty case code here)</code>, <code>cons8 (x:xs) = (non-empty case, x pattern matches to the head and is of type a, xs to the rest of the list and is type [a])</code>.  <code>cons8</code> wouldn&#39;t need an empty case though, I hope you can see why--it&#39;s not manipulating the head, just doing something with the list itself."}, {"owner": {"reputation": 788, "user_id": 559103, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/861480630ebcb6626912c9f4818d7d5b?s=128&d=identicon&r=PG", "display_name": "j.i.h.", "link": "https://stackoverflow.com/users/559103/j-i-h"}, "edited": false, "score": 0, "creation_date": 1467997672, "post_id": 38271849, "comment_id": 63963392, "body": "Also, the easy one line answer is to convert the infix function to prefix to take advantage of currying (I think that&#39;s correct terminology).  <code>cons8 = (:) 8</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 788, "user_id": 559103, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/861480630ebcb6626912c9f4818d7d5b?s=128&d=identicon&r=PG", "display_name": "j.i.h.", "link": "https://stackoverflow.com/users/559103/j-i-h"}, "edited": false, "score": 0, "creation_date": 1468004798, "post_id": 38271849, "comment_id": 63966849, "body": "@j.i.h., since there is no need to pattern match here, I think you&#39;re just confusing things."}], "answers": [{"comments": [{"owner": {"reputation": 788, "user_id": 559103, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/861480630ebcb6626912c9f4818d7d5b?s=128&d=identicon&r=PG", "display_name": "j.i.h.", "link": "https://stackoverflow.com/users/559103/j-i-h"}, "edited": false, "score": 2, "creation_date": 1467997296, "post_id": 38271980, "comment_id": 63963211, "body": "Only a minor style point, I would use <code>cons8 xs = 8 : xs</code> to indicate that it&#39;s a list"}, {"owner": {"reputation": 353, "user_id": 3059248, "user_type": "registered", "accept_rate": 8, "profile_image": "https://www.gravatar.com/avatar/4de3c6781428dec365cc468a0badbd9a?s=128&d=identicon&r=PG&f=1", "display_name": "user3059248", "link": "https://stackoverflow.com/users/3059248/user3059248"}, "edited": false, "score": 0, "creation_date": 1467998560, "post_id": 38271980, "comment_id": 63963807, "body": "Great explanation. I am very greatful."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 6, "last_activity_date": 1468000254, "last_edit_date": 1468000254, "creation_date": 1467997057, "answer_id": 38271980, "question_id": 38271849, "link": "https://stackoverflow.com/questions/38271849/writing-a-function-that-accepts-a-list-as-argument/38271980#38271980", "title": "Writing a function that accepts a list as argument", "body": "<p>First, starting from the type is indeed a good way to start.</p>\n\n<p>Let's check the type:</p>\n\n<pre><code>cons8 :: [a] -&gt; [a]\n</code></pre>\n\n<p>Here, <code>a</code> can be any type. The type above promises that the caller can use <code>cons8</code> with any list: a list of integers, a list of chars, a list of booleans, etc. Since we want to prepend 8, and list contain values of the same type, we can see that the type above is too general. Let's use something less general, e.g.</p>\n\n<pre><code>cons8 :: [Int] -&gt; [Int]\n</code></pre>\n\n<p>Now, how to take a list argument. This is important: you take a list argument as any other argument.</p>\n\n<pre><code>cons8 x = ???? -- TODO\n</code></pre>\n\n<p>A common mistake here is to write <code>cons8 [n] = ...</code> since it's a list. Don't do that! <code>[n]</code> is a list, but a very special one: a list with only one element (<code>n</code>). We don't want to handle only one-element lists, we want <code>cons8</code> to work with <em>any</em> list. So, no braces: let <code>x</code> be the whole list argument.</p>\n\n<p>Then, we can just apply the cons operator:</p>\n\n<pre><code>cons8 x = 8 : x\n</code></pre>\n\n<p>Of course, we can rename <code>x</code> to any other name, e.g.</p>\n\n<pre><code>cons8 list = 8 : list\n</code></pre>\n\n<p>would also work.</p>\n\n<p>When you get ahead in Haskell, you'll probably learn about sections, and prefer the following code</p>\n\n<pre><code>cons8 = (8 :)\n</code></pre>\n\n<p>Indeed, <code>(8 :)</code> is so short that you usually avoid defining a <code>cons8</code> function, and directly use its definition.</p>\n"}], "owner": {"reputation": 353, "user_id": 3059248, "user_type": "registered", "accept_rate": 8, "profile_image": "https://www.gravatar.com/avatar/4de3c6781428dec365cc468a0badbd9a?s=128&d=identicon&r=PG&f=1", "display_name": "user3059248", "link": "https://stackoverflow.com/users/3059248/user3059248"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 293, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1468000254, "creation_date": 1467996530, "question_id": 38271849, "link": "https://stackoverflow.com/questions/38271849/writing-a-function-that-accepts-a-list-as-argument", "title": "Writing a function that accepts a list as argument", "body": "<p>I started to study Haskell to prepare myself for next semester (I, in fact, dropped it early last semester) and I have been successfully writing some basic functions. The subject I am actually reviewing is Lists and I need help to write a very simple function called cons8 that accepts an argument which is a list and adds (cons) an 8 to the beginning of such a list. My issue is that I am stuck on how to include a list as an argument of the function and how to refer to it in the function\u00b4s body. I guess that I can define the type as follows, and then write the function:</p>\n\n<pre><code>cons8 :: [a] -&gt; [a]\n</code></pre>\n\n<p>I will very much appreciate your help to solve my issue.</p>\n"}, {"tags": ["haskell", "constructor", "algebraic-data-types"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1467995251, "post_id": 38271220, "comment_id": 63962175, "body": "Short answer: no. Where is the list coming from? In general, whenever I see lists that have to be a certain size (100 elements in this case) I get a bit suspicious about the use of a list.. Maybe just build up <code>Constants</code> where you are currently making the list?"}, {"owner": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1467995431, "post_id": 38271220, "comment_id": 63962282, "body": "Constants is example of type with big number of fields. Really example: <a href=\"https://www.stackage.org/haddock/lts-6.6/ghc-7.10.3/DynFlags.html#t:PlatformConstants\" rel=\"nofollow noreferrer\">stackage.org/haddock/lts-6.6/ghc-7.10.3/&hellip;</a>"}, {"owner": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1467995496, "post_id": 38271220, "comment_id": 63962323, "body": "List is coming from IO action"}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1467995738, "post_id": 38271220, "comment_id": 63962452, "body": "A recursive use of function currying might make this doable. I can type up an answer but won&#39;t have time to check it if you want."}, {"owner": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "edited": false, "score": 0, "creation_date": 1467996616, "post_id": 38271220, "comment_id": 63962895, "body": "I check your solution. Please, answer."}], "answers": [{"comments": [{"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 0, "creation_date": 1467998269, "post_id": 38272190, "comment_id": 63963681, "body": "The bug I got could be identical to <a href=\"https://ghc.haskell.org/trac/ghc/ticket/12041\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/12041</a> which seems to be fixed."}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 0, "creation_date": 1467999378, "post_id": 38272190, "comment_id": 63964195, "body": "I added the opposite direction. (But the other solution is certainly simpler.)"}, {"owner": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "edited": false, "score": 0, "creation_date": 1468000600, "post_id": 38272190, "comment_id": 63964767, "body": "I can&#39;t compile your code. ghc-7.10.3 try to compile it already 10 minutes and memory usage 3 Gb!"}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "reply_to_user": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "edited": false, "score": 0, "creation_date": 1468001348, "post_id": 38272190, "comment_id": 63965140, "body": "@Bet Strange. I know there have been issues with compiler performance when deriving <code>Generic</code> for large datatypes, but I don&#39;t seem to hit this here. For me, it takes 2 seconds with <code>-O0</code>, and 6 seconds with <code>-O1</code> and <code>O2</code>."}, {"owner": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "edited": false, "score": 0, "creation_date": 1468001397, "post_id": 38272190, "comment_id": 63965167, "body": "After 15 minutes of waiting ghc compile it. Strangely. The code is very little, but memory and processor usage is very big."}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "reply_to_user": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "edited": false, "score": 0, "creation_date": 1468077892, "post_id": 38272190, "comment_id": 63985255, "body": "I have now verified that the internal bug I&#39;ve experienced with ghc-8.0.1 is fixed in HEAD (and will hopefully also be fixed in 8.0.2)."}], "tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": false, "score": 3, "last_activity_date": 1467999338, "last_edit_date": 1467999338, "creation_date": 1467998075, "answer_id": 38272190, "question_id": 38271220, "link": "https://stackoverflow.com/questions/38271220/constructing-haskell-data-types-with-many-fields/38272190#38272190", "title": "Constructing Haskell data types with many fields", "body": "<p>Here is a proof-of-concept way to do this via generic programming (in this case, via <a href=\"https://hackage.haskell.org/package/generics-sop\" rel=\"nofollow\">generics-sop</a>). Whether this is a suitable approach to solve your actual problem depends on a lot of factors that I currently cannot judge:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric, ScopedTypeVariables, DataKinds, TypeFamilies, FlexibleContexts, TypeOperators, PolyKinds #-}\n{-# OPTIONS_GHC -fcontext-stack=200 #-}\n\nmodule Constants where\n\nimport Data.Maybe\nimport Generics.SOP\nimport qualified GHC.Generics as G\n\ndata Constants =\n  Constants\n    { x00 :: Int, x01 :: Int, x02 :: Int, x03 :: Int, x04 :: Int, x05 :: Int, x06 :: Int, x07 :: Int, x08 :: Int, x09 :: Int\n    , x10 :: Int, x11 :: Int, x12 :: Int, x13 :: Int, x14 :: Int, x15 :: Int, x16 :: Int, x17 :: Int, x18 :: Int, x19 :: Int\n    , x20 :: Int, x21 :: Int, x22 :: Int, x23 :: Int, x24 :: Int, x25 :: Int, x26 :: Int, x27 :: Int, x28 :: Int, x29 :: Int\n    , x30 :: Int, x31 :: Int, x32 :: Int, x33 :: Int, x34 :: Int, x35 :: Int, x36 :: Int, x37 :: Int, x38 :: Int, x39 :: Int\n    , x40 :: Int, x41 :: Int, x42 :: Int, x43 :: Int, x44 :: Int, x45 :: Int, x46 :: Int, x47 :: Int, x48 :: Int, x49 :: Int\n    , x50 :: Int, x51 :: Int, x52 :: Int, x53 :: Int, x54 :: Int, x55 :: Int, x56 :: Int, x57 :: Int, x58 :: Int, x59 :: Int\n    , x60 :: Int, x61 :: Int, x62 :: Int, x63 :: Int, x64 :: Int, x65 :: Int, x66 :: Int, x67 :: Int, x68 :: Int, x69 :: Int\n    , x70 :: Int, x71 :: Int, x72 :: Int, x73 :: Int, x74 :: Int, x75 :: Int, x76 :: Int, x77 :: Int, x78 :: Int, x79 :: Int\n    , x80 :: Int, x81 :: Int, x82 :: Int, x83 :: Int, x84 :: Int, x85 :: Int, x86 :: Int, x87 :: Int, x88 :: Int, x89 :: Int\n    , x90 :: Int, x91 :: Int, x92 :: Int, x93 :: Int, x94 :: Int, x95 :: Int, x96 :: Int, x97 :: Int, x98 :: Int, x99 :: Int\n    }\n  deriving (Show, G.Generic)\n\ninstance Generic Constants\n\nfromConstantList ::\n  forall a c xs . (Generic a, Code a ~ '[ xs ], All ((~) c) xs) =&gt;\n  [c] -&gt; a\nfromConstantList =\n  to . SOP . Z . hcmap (Proxy :: Proxy ((~) c)) (I . unK) . fromJust . fromList\n\ntoConstantList ::\n  forall a c xs . (Generic a, Code a ~ '[ xs ], All ((~) c) xs) =&gt;\n  a -&gt; [c]\ntoConstantList =\n  hcollapse . hcmap (Proxy :: Proxy ((~) c)) (K . unI) . unZ . unSOP . from\n\nunZ :: NS f (x ': xs) -&gt; f x\nunZ (Z x) = x\n\ntest1 :: Constants\ntest1 = fromConstantList [1..100]\n\ntest2 :: [Int]\ntest2 = toConstantList test1\n</code></pre>\n\n<p>In GHCi (this is with version 7.10.3, see below):</p>\n\n<pre><code>*Constants&gt; test1\nConstants {x00 = 1, x01 = 2, x02 = 3, x03 = 4, x04 = 5, x05 = 6, x06 = 7, x07 = 8, x08 = 9, x09 = 10, x10 = 11, x11 = 12, x12 = 13, x13 = 14, x14 = 15, x15 = 16, x16 = 17, x17 = 18, x18 = 19, x19 = 20, x20 = 21, x21 = 22, x22 = 23, x23 = 24, x24 = 25, x25 = 26, x26 = 27, x27 = 28, x28 = 29, x29 = 30, x30 = 31, x31 = 32, x32 = 33, x33 = 34, x34 = 35, x35 = 36, x36 = 37, x37 = 38, x38 = 39, x39 = 40, x40 = 41, x41 = 42, x42 = 43, x43 = 44, x44 = 45, x45 = 46, x46 = 47, x47 = 48, x48 = 49, x49 = 50, x50 = 51, x51 = 52, x52 = 53, x53 = 54, x54 = 55, x55 = 56, x56 = 57, x57 = 58, x58 = 59, x59 = 60, x60 = 61, x61 = 62, x62 = 63, x63 = 64, x64 = 65, x65 = 66, x66 = 67, x67 = 68, x68 = 69, x69 = 70, x70 = 71, x71 = 72, x72 = 73, x73 = 74, x74 = 75, x75 = 76, x76 = 77, x77 = 78, x78 = 79, x79 = 80, x80 = 81, x81 = 82, x82 = 83, x83 = 84, x84 = 85, x85 = 86, x86 = 87, x87 = 88, x88 = 89, x89 = 90, x90 = 91, x91 = 92, x92 = 93, x93 = 94, x94 = 95, x95 = 96, x96 = 97, x97 = 98, x98 = 99, x99 = 100}\n*Constants&gt; test2\n[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100]\n</code></pre>\n\n<p>Interestingly, when I tried to compile this with ghc-8.0.1 (then you have to replace the <code>-fcontext-stack</code> option with <code>-freduction-depth</code>, too), I got an unexpected internal GHC error which I have to investigate further ...</p>\n"}, {"comments": [{"owner": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "edited": false, "score": 0, "creation_date": 1468008276, "post_id": 38272395, "comment_id": 63968456, "body": "It&#39;s really very simple solution. Can you post solution for reverse task - from Constants to [Int]?"}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "reply_to_user": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "edited": false, "score": 0, "creation_date": 1468009048, "post_id": 38272395, "comment_id": 63968825, "body": "@Bet the reverse would be an entirely different thing, and would <i>probably</i> require template Haskell (which i do not know). I would suggest to roll-back your added edit and ask the reverse case in a new question."}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 8, "last_activity_date": 1468233712, "last_edit_date": 1495541296, "creation_date": 1467998948, "answer_id": 38272395, "question_id": 38271220, "link": "https://stackoverflow.com/questions/38271220/constructing-haskell-data-types-with-many-fields/38272395#38272395", "title": "Constructing Haskell data types with many fields", "body": "<p>Edit: see <a href=\"https://stackoverflow.com/questions/38303683/reading-long-data-structure-in-haskell\">Reading long data structure in Haskell</a> for a modified version when the record fields are of different types (i.e. not all ints).</p>\n\n<hr>\n\n<p>One possibility would be to use type classes:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n\ndata Constants = Constants { a :: Int, b :: Int, c :: Int, d :: Int, e :: Int }\n    deriving Show\n\nclass Cons a where\n    cons :: a -&gt; [Int] -&gt; Maybe Constants\n\ninstance Cons Constants where\n    cons c [] = Just c\n    cons _ _  = Nothing\n\ninstance (Cons a) =&gt; Cons (Int -&gt; a) where\n    cons f (x:xs) = cons (f x) xs\n    cons _ _      = Nothing\n</code></pre>\n\n<p>then, if the list is of the right size:</p>\n\n<pre><code>\\&gt; cons Constants [1..5]\nJust (Constants {a = 1, b = 2, c = 3, d = 4, e = 5})\n</code></pre>\n\n<p>and otherwise you get nothing:</p>\n\n<pre><code>\\&gt; cons Constants [1..4]\nNothing\n\\&gt; cons Constants [1..6]\nNothing\n</code></pre>\n"}], "owner": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 187, "favorite_count": 0, "accepted_answer_id": 38272395, "answer_count": 2, "score": 3, "last_activity_date": 1468233712, "creation_date": 1467994366, "last_edit_date": 1467997996, "question_id": 38271220, "link": "https://stackoverflow.com/questions/38271220/constructing-haskell-data-types-with-many-fields", "title": "Constructing Haskell data types with many fields", "body": "<p>I have data type</p>\n\n<pre><code>data Constants = Constants { x1 :: Int, x2 :: Int, ... , x100 :: Int }\n</code></pre>\n\n<p>Names x1, x2, ..., x100 may have irregular naming.</p>\n\n<p>Is there an elegant way to create Constants object from list of 100 Int values?</p>\n\n<pre><code>mkConstants :: [Int] -&gt; Constants\nmkConstants [x1, x2, ..., x100] = Constants x1 x2 ... x100 -- The bad way\n</code></pre>\n\n<p>What about reverse task?</p>\n\n<pre><code>extractInts :: Constants -&gt; [Int]\nextractInts (Constants x1 x2 ... x100) = [x1, x2, ..., x100] -- The bad way\n</code></pre>\n"}, {"tags": ["haskell", "svg", "reflex"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1467989578, "post_id": 38268962, "comment_id": 63958677, "body": "&quot;This does not compile&quot; - What&#39;s the error message?  It&#39;s always important to post compiler errors in these cases."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1467989973, "post_id": 38268962, "comment_id": 63958963, "body": "Are you sure you don&#39;t just want <code>el</code>?"}, {"owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1467991369, "post_id": 38268962, "comment_id": 63959914, "body": "@alec how do I get the attributes?"}, {"owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1467991527, "post_id": 38268962, "comment_id": 63960012, "body": "@bheklilr the errors were very long... I can take out some relevant parts"}], "answers": [{"comments": [{"owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "edited": false, "score": 0, "creation_date": 1487447728, "post_id": 38270441, "comment_id": 71793169, "body": "I observe that <code>elDynAttrNS</code> (for elements with namespaces?) is not on the <a href=\"https://github.com/reflex-frp/reflex-dom/blob/develop/Quickref.md\" rel=\"nofollow noreferrer\">cheatsheet</a>."}], "tags": [], "owner": {"reputation": 1008, "user_id": 1470114, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/0c64f5404b8787a038e8f6fa9522224d?s=128&d=identicon&r=PG", "display_name": "katychuang", "link": "https://stackoverflow.com/users/1470114/katychuang"}, "is_accepted": true, "score": 6, "last_activity_date": 1471301533, "last_edit_date": 1471301533, "creation_date": 1467991871, "answer_id": 38270441, "question_id": 38268962, "link": "https://stackoverflow.com/questions/38268962/a-single-svg-element-with-reflex-frp/38270441#38270441", "title": "a single svg element with reflex frp", "body": "<p>There are two things to fix here. </p>\n\n<p>First, you want to return something, often the basic <code>return ()</code> will allow you to compile.</p>\n\n<p>Second, the elAttr takes 2 input types, so after the \"circle\" you want to put the second argument in parenthesis rather than the <code>$</code>. </p>\n\n<p>This is what it looks like:</p>\n\n<pre><code>import Reflex.Dom\nimport qualified Data.Map as Map\n\nmain = mainWidget $ myDiv\n\nmyDiv = el \"svg\" $ do\n  elAttr \"circle\"  (Map.fromList [ (\"cx\" , \"50\") , (\"cy\", \"50\"), (\"r\" , \"40\"), (\"stroke\" , \"green\"), (\"fill\",  \"yellow\" )]) $ return ()\n</code></pre>\n\n<p>After compiling, you should be able to see this in your browser's element inspector. </p>\n\n<pre><code>&lt;html&gt;\n  &lt;head&gt;\n    &lt;script language=\"javascript\" src=\"rts.js\"&gt;&lt;/script&gt;\n    &lt;script language=\"javascript\" src=\"lib.js\"&gt;&lt;/script&gt;\n    &lt;script language=\"javascript\" src=\"out.js\"&gt;&lt;/script&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;svg&gt;\n     &lt;circle cx=\"50\" cy=\"50\" fill=\"yellow\" r=\"40\" stroke=\"green\"&gt;&lt;/circle&gt;\n    &lt;/svg&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>If you want to see it show up in the browser, make sure to define this attribute <code>xmlns=\"http://www.w3.org/20000/svg\"</code> in your svg element like below with <code>elDynAttrNS'</code>:</p>\n\n<pre><code>main = mainWidget $ myDiv\n\nmyDiv = do\n  let attrs = constDyn $ fromList\n               [ (\"width\" , \"500\")\n               , (\"height\" , \"250\")\n               ]\n  let cAttrs = constDyn $ fromList\n               [ (\"cx\", \"50\")\n               , (\"cy\", \"50\")\n               , (\"r\", \"40\")\n               , (\"stroke\", \"green\")\n               , (\"stroke-width\", \"3\")\n               , (\"fill\",  \"yellow\" )\n               ]\n\n  s &lt;- elSvg \"svg\" attrs (elSvg \"circle\" cAttrs (return ()))\n  return ()\n\nelSvg tag a1 a2 = do\n  elDynAttrNS' ns tag a1 a2\n  return ()\n\nns :: Maybe String\nns = Just \"http://www.w3.org/2000/svg\"\n</code></pre>\n"}], "owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 329, "favorite_count": 0, "accepted_answer_id": 38270441, "answer_count": 1, "score": 4, "last_activity_date": 1471301533, "creation_date": 1467987542, "question_id": 38268962, "link": "https://stackoverflow.com/questions/38268962/a-single-svg-element-with-reflex-frp", "title": "a single svg element with reflex frp", "body": "<p>I am trying to write a single SVG element within reflex FRP</p>\n\n<pre><code>import Reflex.Dom\nimport qualified Data.Map as Map\n\nmain = mainWidget $ myDiv\n\nmyDiv = el \"svg\" $ do\n  elAttr \"circle\"  $ Map.fromList [ (\"cx\" , \"50\") , (\"cy\", \"50\"), (\"r\" , \"40\"), (\"stroke\" , \"green\"), (\"fill\",  \"yellow\" )]\n</code></pre>\n\n<p>This does not compile. Hoping <a href=\"http://hackage.haskell.org/package/containers-0.5.7.1/docs/Data-Map-Lazy.html\" rel=\"nofollow\"><code>Data.Map</code></a> is correct. I know from the <a href=\"https://github.com/reflex-frp/reflex-dom/blob/develop/Quickref.md\" rel=\"nofollow\">quickref</a> the type signature is:</p>\n\n<pre><code>elAttr     :: String -&gt;          Map String String  -&gt; m a -&gt; m a\n</code></pre>\n\n<p>Slightly curious what monad <code>m</code> is associated with <code>mainWidget</code> but mainly just getting to work.</p>\n\n<p>This is compiled using the sandbox that comes with <a href=\"https://github.com/reflex-frp/reflex-platform\" rel=\"nofollow\">reflex</a>.</p>\n"}, {"tags": ["arrays", "list", "haskell", "roguelike"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1467987672, "post_id": 38267195, "comment_id": 63957426, "body": "&quot;How should I design X?&quot;-questions like this one are usually <a href=\"http://stackoverflow.com/help/closed-questions\">too broad</a> to get good answers on this site. Also, you seem to have assumptions about how it&#39;ll work (&quot;The array must be mutable&quot;) which I don&#39;t think are correct"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1467989169, "post_id": 38267195, "comment_id": 63958383, "body": "Since you are asking this question, I recommend lists, even if they are inefficient."}, {"owner": {"reputation": 2369, "user_id": 1500583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71020354a2fefbdadf424bd48c912515?s=128&d=identicon&r=PG", "display_name": "David McHealy", "link": "https://stackoverflow.com/users/1500583/david-mchealy"}, "edited": false, "score": 0, "creation_date": 1467993922, "post_id": 38267195, "comment_id": 63961428, "body": "I&#39;ve personally done it with a map, using a pair (coordinates) as a key.  It is simple, everything not in the map is a wall or blank stone, and they are easy to update and fold over."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1467991381, "creation_date": 1467991381, "answer_id": 38270278, "question_id": 38267195, "link": "https://stackoverflow.com/questions/38267195/array-or-list-for-rl-in-haskell/38270278#38270278", "title": "Array or list for RL in haskell", "body": "<p>Haskell supports n-dimensional arrays:</p>\n\n<pre><code>import Data.Array\nimport Data.Ix\nimport Control.Monad\n\nmain = do\n  let myBounds = ((0,5,10),(7,8,12)) :: ((Int,Int,Int),(Int,Int,Int))\n      threeDexample = array myBounds\n                        [ (ijk, e) | ijk@(i,j,k) &lt;- range myBounds,\n                                     let e = i+j*10+k*100 ]\n\n  forM_ (range myBounds) $ \\ijk@(i,j,k) -&gt; do\n    putStrLn $ \"value at \" ++ show ijk ++ \" = \" ++ show (threeDexample ! ijk)\n</code></pre>\n\n<p>To mutate, either use <code>Data.Array.MArray</code> or use the <a href=\"https://hackage.haskell.org/package/array-0.5.1.1/docs/Data-Array.html#v:-47--47-\" rel=\"nofollow\"><code>(//)</code></a> operation.</p>\n"}], "owner": {"reputation": 105, "user_id": 6490150, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e7bd6f35dfaa3c0c4ee2f99dbd19332c?s=128&d=identicon&r=PG&f=1", "display_name": "caffeinated-fox", "link": "https://stackoverflow.com/users/6490150/caffeinated-fox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1467991381, "creation_date": 1467982333, "last_edit_date": 1467982724, "question_id": 38267195, "link": "https://stackoverflow.com/questions/38267195/array-or-list-for-rl-in-haskell", "title": "Array or list for RL in haskell", "body": "<p>I'm making a little RL in haskell (with hscurses) and now, I write the code to make/print the dungeon.  </p>\n\n<p>The first thing I do is making a list/array with 'walls'<br>\nIn python(v3) it would be like this:</p>\n\n<pre><code>def mk_list(x, y):        \n    dungeon = [['#' for j in range(y)] for i in range(x)]\n\n    return dungeon\n</code></pre>\n\n<p>And it would be printed like this:</p>\n\n<pre><code>import curses\ndef print_dungeon(window, x, y, dungeon):\n    for i in range(x):\n        for j in range(y):\n        window.addstr(j, i, dungeon[x][y])\n    window.refresh()\n</code></pre>\n\n<p>So my question is: How can I do this in haskell?\nI know there excist the module <a href=\"https://hackage.haskell.org/package/array-0.5.1.1/docs/Data-Array.html\" rel=\"nofollow\"><code>Data.Array</code></a> but as I understand, they support only 2D arrays.<br>\nAlso the array must be mutable because I must 'dig' the rooms and corridors in it later.  </p>\n\n<p>But my question is also that should I use arrays for it, or is a list better?</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["haskell", "ssh"], "answers": [{"comments": [{"owner": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "edited": false, "score": 0, "creation_date": 1468008389, "post_id": 38270949, "comment_id": 63968516, "body": "That&#39;s what happens when you code on 2 hour of sleep. Thanks!"}], "tags": [], "owner": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "is_accepted": true, "score": 2, "last_activity_date": 1467993480, "creation_date": 1467993480, "answer_id": 38270949, "question_id": 38267164, "link": "https://stackoverflow.com/questions/38267164/simplessh-library-hangs-when-executing-a-command/38270949#38270949", "title": "simplessh library hangs when executing a command", "body": "<p>Never used this library but looking at the documentation for <code>openSession</code>:</p>\n\n<blockquote>\n  <p>Open a SSH session. The next step is to authenticate.</p>\n</blockquote>\n\n<p>Also from <code>execCommand</code> description:</p>\n\n<blockquote>\n  <p>One should be authenticated before sending commands on a Session.</p>\n</blockquote>\n\n<p>I think your code breaks the convention by calling <code>execCommand</code> before successfully authenticating. Not sure this is the problem but looks like you need to fix that anyway.</p>\n"}], "owner": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 38270949, "answer_count": 1, "score": 0, "last_activity_date": 1467993480, "creation_date": 1467982229, "question_id": 38267164, "link": "https://stackoverflow.com/questions/38267164/simplessh-library-hangs-when-executing-a-command", "title": "simplessh library hangs when executing a command", "body": "<p>I'm trying to use <a href=\"https://hackage.haskell.org/package/simplessh-0.2.0.5\" rel=\"nofollow\">simplessh</a> library to run a sequence of commands over SSH (actually, to learn some Haskell). It seems to be going OK, but it hangs on the second <code>runSimpleSSH</code> in this code:</p>\n\n<pre><code>module Main where\n\nimport Network.SSH.Client.SimpleSSH\n\nmain :: IO ()\nmain = do\n    s &lt;- runSimpleSSH $ openSession' \"localhost\" 22 Nothing\n    case s of\n        Left e -&gt; print e\n        Right s -&gt; do\n            r &lt;- runSimpleSSH $ execCommand s \"ls\" -- hangs here\n            case r of\n                Left e -&gt; print e\n                Right (Result { resultOut=resultOut, resultErr=resultErr, resultExit=resultExit }) -&gt; print resultExit\n</code></pre>\n\n<p>Is there something wrong with my Haskell code, or am I using the library wrong? I'm sure someone can tell based on the types exposed by the library.</p>\n\n<p>PS: I'm actually using a <a href=\"http://hub.darcs.net/jp.rider/simplessh/patch/c0e1eb9d1925ff86db5d8de350af5d60123d1e55\" rel=\"nofollow\">patched version of the library</a> which allows for no <code>known_hosts</code>, but the rest seems unchanged.</p>\n"}, {"tags": ["json", "haskell", "io"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1467987181, "post_id": 38266133, "comment_id": 63957102, "body": "On the off-chance you just want to decode JSON, you know there is a popular Haskell library for that called <a href=\"https://hackage.haskell.org/package/aeson-0.11.2.0/docs/Data-Aeson.html\" rel=\"nofollow noreferrer\"><code>aeson</code></a>?"}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 2, "last_activity_date": 1467987863, "creation_date": 1467987863, "answer_id": 38269082, "question_id": 38266133, "link": "https://stackoverflow.com/questions/38266133/how-to-extract-data-using-text-json/38269082#38269082", "title": "How to extract data using Text.JSON?", "body": "<p>I think your compile error is because of the position of the <code>where</code>. Try</p>\n\n<pre><code>main = do\n    ...\n    let (Ok format) = valFromObj \"format\" rootObj :: Result (JSObject (JSValue))\n    let (Ok format_name) = valFromObj \"format_name\" format\n    putStrLn format_name\n</code></pre>\n\n<p>The scope of the <code>where</code> is outside the <code>do</code> so it isn't aware of <code>format</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "is_accepted": false, "score": 1, "last_activity_date": 1467994835, "creation_date": 1467994835, "answer_id": 38271371, "question_id": 38266133, "link": "https://stackoverflow.com/questions/38266133/how-to-extract-data-using-text-json/38271371#38271371", "title": "How to extract data using Text.JSON?", "body": "<p>You cannot do this:</p>\n\n<pre><code>main = do\n  let bar = \"only visible inside main? \"\n  return baz\n  where\n    baz = bar ++ \" yes, this will break!\"\n</code></pre>\n\n<p>This gives:</p>\n\n<pre><code>test.hs:7:11:\n    Not in scope: \u2018bar\u2019\n    Perhaps you meant \u2018baz\u2019 (line 7)\n</code></pre>\n\n<p>Let bindings unlike function arguments are not available in where bindings. Above <code>bar</code> is not in scope for <code>baz</code> to use it. Compare to your code.</p>\n"}], "owner": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 38269082, "answer_count": 2, "score": 1, "last_activity_date": 1556971695, "creation_date": 1467979269, "last_edit_date": 1556971695, "question_id": 38266133, "link": "https://stackoverflow.com/questions/38266133/how-to-extract-data-using-text-json", "title": "How to extract data using Text.JSON?", "body": "<p>I'm trying to write a wrapper around <code>ffprobe</code> that extracts <code>value</code> in JSON of the format <code>{\"format\": {\"format_name\": value}}</code>. The JSON is output by a created process. Here's what I've gotten to.</p>\n\n<pre><code>import System.Process\nimport System.Environment\nimport System.IO\nimport Text.JSON\n\nmain = do\n    args &lt;- getArgs\n    (_, Just out, _, p) &lt;- createProcess\n        (proc \"ffprobe\" [args!!0, \"-of\", \"json\", \"-show_format\"])\n        { std_out = CreatePipe }\n    s &lt;- hGetContents out\n    --putStrLn $ show (decode s :: Result JSValue)\n    --waitForProcess p\n    --putStrLn $ valFromObj \"format_name\" format\n    --    where format = valFromObj \"format\" rootObj\n    --          (Ok rootObj) = decode s :: Result (JSObject (JSValue))\n    let (Ok rootObj) = decode s :: Result (JSObject (JSValue))\n    let (Ok format) = valFromObj \"format\" rootObj :: Result (JSObject (JSValue))\n    putStrLn format_name\n        where (Ok format_name) = valFromObj \"format_name\" format\n</code></pre>\n\n<p>It fails to compile with:</p>\n\n<pre><code>[1 of 1] Compiling Main             ( ffprobe.hs, ffprobe.o )\n\nffprobe.hs:20:59: error:\n    Variable not in scope: format :: JSObject JSValue\n</code></pre>\n\n<p>I'm confused about several things, including why I can't get the last line to compile:</p>\n\n<ol>\n<li><p>Why can't I assert for <code>Ok</code> in the <code>Result</code> after the <code>::</code>. Like <code>:: Result Ok JSObject JSValue</code>?</p></li>\n<li><p>Why can't I extract the values in a where clause?</p></li>\n<li><p>Why is it <code>Result (JSObject (JSValue))</code> and not <code>Result JSObject JSValue</code>?</p></li>\n<li><p>Why is <code>format</code> out of scope?</p></li>\n</ol>\n\n<p>I have a feeling I'm mixing the IO and Result monads together in the same <code>do</code> block or something. Is <code>Result</code> even a monad? Can I extract the value I want in a separate <code>do</code> without crapping all over the <code>IO</code> <code>do</code>?</p>\n"}, {"tags": ["haskell", "yesod", "shakespeare-text"], "answers": [{"comments": [{"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1467996664, "post_id": 38271442, "comment_id": 63962923, "body": "You are correct. That&#39;s what I was trying to do. However, my question is different. Looking at the error message, how does one get to know the exact line in the julius/cassius/hamlet template which is causing the error?"}, {"owner": {"reputation": 2369, "user_id": 1500583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71020354a2fefbdadf424bd48c912515?s=128&d=identicon&r=PG", "display_name": "David McHealy", "link": "https://stackoverflow.com/users/1500583/david-mchealy"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1468007953, "post_id": 38271442, "comment_id": 63968290, "body": "There is an option to dump template haskell splices during compile, which is something.  But beyond that the source of the error is always going to be the line in your code where you called it.  This is the reason I don&#39;t use templates, personally."}, {"owner": {"reputation": 1020, "user_id": 500060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c122862374667042520953c02df7d7ed?s=128&d=identicon&r=PG", "display_name": "glguy", "link": "https://stackoverflow.com/users/500060/glguy"}, "edited": false, "score": 0, "creation_date": 1470902445, "post_id": 38271442, "comment_id": 65141067, "body": "It doesn&#39;t solve this question, but Template Haskell can emit line pragmas in order to produce more useful error messages. I just don&#39;t think this template system is bothering with that."}], "tags": [], "owner": {"reputation": 2369, "user_id": 1500583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71020354a2fefbdadf424bd48c912515?s=128&d=identicon&r=PG", "display_name": "David McHealy", "link": "https://stackoverflow.com/users/1500583/david-mchealy"}, "is_accepted": false, "score": 2, "last_activity_date": 1467995074, "creation_date": 1467995074, "answer_id": 38271442, "question_id": 38260036, "link": "https://stackoverflow.com/questions/38260036/how-to-read-yesod-error-messages-effectively/38271442#38271442", "title": "How to read Yesod error messages effectively?", "body": "<p>After perusing <a href=\"http://hackage.haskell.org/package/shakespeare-2.0.8/docs/Text-Julius.html\" rel=\"nofollow\">http://hackage.haskell.org/package/shakespeare-2.0.8/docs/Text-Julius.html</a>, it looks like you are trying to embed a plain string in something that wants javascript.</p>\n\n<p>That is usually prevented so that someone can't inject bad code into a page when you are trying to just display a string they've supplied.  So just call rawJS on it and it should embed?  Or perhaps you are using the wrong interpolation type for the variable you are supplying (@,^, or #).  Yesod is particular about that.</p>\n\n<p>This just just a guess as I don't use julius.</p>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 272, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1467995074, "creation_date": 1467958530, "question_id": 38260036, "link": "https://stackoverflow.com/questions/38260036/how-to-read-yesod-error-messages-effectively", "title": "How to read Yesod error messages effectively?", "body": "<p>(newbie alert)</p>\n\n<p>Given the following error message, what's the quickest way to get to the source of the error:</p>\n\n<pre><code>08/Jul/2016:11:39:01 +0530 [Error#yesod-core] expected EPlain but got Nothing for: DerefBranch (DerefIdent (Ident \"show\")) (DerefString \"abcdef\") @(yesod_3MCr4WfhviiELXmo3fAaXL:Yesod.Core.Class.Yesod ./Yesod/Core/Class/Yesod.hs:625:5)\nGET /\n  Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\n  Status: 500 Internal Server Error 0.054158s\n\nHandler/Home.hs:38:11:\n    No instance for (Text.Julius.ToJavascript String)\n      arising from a use of \u2018Text.Julius.toJavascript\u2019\n    In the second argument of \u2018(GHC.Base..)\u2019, namely\n      \u2018Text.Julius.toJavascript\u2019\n    In the second argument of \u2018(GHC.Base..)\u2019, namely\n      \u2018(Text.Julius.unJavascript GHC.Base.. Text.Julius.toJavascript)\u2019\n    In the expression:\n      Text.Shakespeare.EPlain\n      GHC.Base..\n        (Text.Julius.unJavascript GHC.Base.. Text.Julius.toJavascript)\nBuild failure, pausing...\n</code></pre>\n\n<p>I'm working with a simple scaffolded site (no DB) and have purposely messed up with <code>homepage.julius</code>. In this particular instance I know exactly what the error is, but how can one know just by looking at the error message?</p>\n"}, {"tags": ["haskell", "polymorphism", "existential-type", "heterogeneous"], "answers": [{"comments": [{"owner": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "edited": false, "score": 0, "creation_date": 1467967060, "post_id": 38261539, "comment_id": 63944396, "body": "Of course, you are right. <code>AnyStorable</code> must be an instance of <code>Storable</code>."}], "tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": true, "score": 1, "last_activity_date": 1467964322, "creation_date": 1467964322, "answer_id": 38261539, "question_id": 38259745, "link": "https://stackoverflow.com/questions/38259745/haskell-heterogeneous-list-of-storable-objects/38261539#38261539", "title": "Haskell heterogeneous list of Storable objects", "body": "<p>In short, no. What you'd need for that would be <code>exists</code> keyword to specify the signature of the function that'll be mapped on the collection. Using <code>forall</code> in the datatype effectively expresses the same from the other side.</p>\n\n<p>BTW, you might consider making <code>AnyStorable</code> an instance of <code>Storable</code>.</p>\n"}], "owner": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 38261539, "answer_count": 1, "score": 1, "last_activity_date": 1467964322, "creation_date": 1467957131, "last_edit_date": 1467957649, "question_id": 38259745, "link": "https://stackoverflow.com/questions/38259745/haskell-heterogeneous-list-of-storable-objects", "title": "Haskell heterogeneous list of Storable objects", "body": "<p>I want to write function that can poke heterogeneous list of Storable objects (different types)</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE RankNTypes, ExistentialQuantification, ImpredicativeTypes #-}\n\npokeMany :: Ptr b -&gt; Int -&gt; [forall a. Storable a =&gt; a] -&gt; IO ()\npokeMany _ _ [] = return ()\npokeMany ptr offset (x:xs) = do\n    pokeByteOff ptr offset x\n    pokeMany ptr (offset + sizeOf x) xs\n\nsomePoke :: Ptr a -&gt; Int -&gt; Int -&gt; IO ()\nsomePoke ptr x1 x2 = pokeMany ptr 0 [x1, x2]\n</code></pre>\n\n<p>But I get compile errors:</p>\n\n<pre><code>No instance for (Storable a1) arising from a use of `sizeOf'\nThe type variable `a1' is ambiguous\nNote: there are several potential instances:\n  instance Storable CChar -- Defined in `Foreign.C.Types'\n  instance Storable CClock -- Defined in `Foreign.C.Types'\n  instance Storable CDouble -- Defined in `Foreign.C.Types'\n\nCouldn't match expected type `a2' with actual type `Int'\n  `a2' is a rigid type variable bound by\n       a type expected by the context: Storable a2 =&gt; a2\n</code></pre>\n\n<p>and others ...</p>\n\n<p>Then I create some data type</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE RankNTypes, ExistentialQuantification, ImpredicativeTypes #-}\n\ndata AnyStorable = forall a. Storable a =&gt; AnyStorable a\n\npokeMany :: Ptr b -&gt; Int -&gt; [AnyStorable] -&gt; IO ()\npokeMany _ _ [] = return ()\npokeMany ptr offset (AnyStorable x:xs) = do\n    pokeByteOff ptr offset x\n    pokeMany ptr (offset + sizeOf x) xs\n\nsomePoke :: Ptr a -&gt; Int -&gt; Int -&gt; IO ()\nsomePoke ptr n c = pokeMany ptr 0 [AnyStorable n, AnyStorable c, AnyStorable 'a']\n</code></pre>\n\n<p>The code above hasn't any compile errors.</p>\n\n<p>Can I write <code>pokeMany</code> function without creating new data type like AnyStorable?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 3, "creation_date": 1467943079, "post_id": 38257712, "comment_id": 63936569, "body": "Can you give us the verbose output? <code>stack build -v</code>"}], "owner": {"reputation": 1518, "user_id": 802500, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/54cb6e5f1e23129af9e91ea9b31eaace?s=128&d=identicon&r=PG", "display_name": "Justin Blank", "link": "https://stackoverflow.com/users/802500/justin-blank"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 108, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1468023901, "creation_date": 1467941593, "last_edit_date": 1468023901, "question_id": 38257712, "link": "https://stackoverflow.com/questions/38257712/haskell-stack-fails-with-error-message-unsatisfied-constraints", "title": "Haskell stack fails with error message &quot;unsatisfied constraints&quot;", "body": "<p>When building my project, I'm receiving a cryptic error </p>\n\n<pre><code>C:\\Users\\T60\\Dropbox\\note-build&gt;stack build\nnote-build-0.1.0.0: build\nPreprocessing library note-build-0.1.0.0...\nsetup-Simple-Cabal-1.22.5.0-ghc-7.10.3.exe: unsatisfied constraints\n\n--  While building package note-build-0.1.0.0 using:\n      C:\\stack_root\\setup-exe-cache\\i386-windows\\setup-Simple-Cabal-1.22.5.0-ghc-7.10.3.exe --builddir=.stack-work\\dist\\95439361 build lib:note-build exe:note-build --ghc-options \" -ddump-hi -ddump-to-file\"\n    Process exited with code: ExitFailure 1\n</code></pre>\n\n<p>It seems to be caused by adding filepath to the executable depends section of my cabal file. My Main.hs file uses System.FilePath, and without the line in my cabal file it fails, but adding it gives me this error. Prior to trying to use the filepath module, the project would build. </p>\n\n<pre><code>executable note-build\n  hs-source-dirs:      app\n  main-is:             Main.hs\n  ghc-options:         -threaded -rtsopts -with-rtsopts=-N\n  build-depends:       base\n                     , filepath\n                     , directory\n                     , note-build\n  default-language:    Haskell2010\n</code></pre>\n\n<p>What does this error mean, and am I putting the dependency in the wrong place in my cabal file? </p>\n\n<p>Update: I ran the build using the -v flag, and it revealed that I'd absentmindedly substituted <code>+</code> for <code>++</code>. </p>\n\n<pre><code>C:\\Users\\T60\\Dropbox\\note-build\\app\\Main.hs:20:31: @(stack_9kewhubnl5WIl89fhd1ea2:Stack.Build.Execute src/Stack\\Build\\Execute.hs:911:67)\n2016-07-07 22:08:24.020516: [warn]     No instance for (Num FilePath) arising from a use of `+' @(stack_9kewhubnl5WIl89fhd1ea2:Stack.Build.Execute src/Stack\\Build\\Execute.hs:911:67)\n2016-07-07 22:08:24.051760: [warn]     In the first argument of `normalise', namely `(y + \"/\")' @(stack_9kewhubnl5WIl89fhd1ea2:Stack.Build.Execute src/Stack\\Build\\Execute.hs:911:67)\n2016-07-07 22:08:24.067386: [warn]     In the expression: normalise (y + \"/\") @(stack_9kewhubnl5WIl89fhd1ea2:Stack.Build.Execute src/Stack\\Build\\Execute.hs:911:67)\n2016-07-07 22:08:24.129886: [warn]     In an equation for `y_norm': y_norm = normalise (y + \"/\"). \n</code></pre>\n\n<p>So the fix was easy enough, but should I consider this a potential issue with stack that I had to use verbose output to see what seems like a simple type error? </p>\n"}, {"tags": ["arrays", "parsing", "haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1467923657, "post_id": 38254722, "comment_id": 63930632, "body": "I believe all the Parsec functions are monadic and should be used in a <code>do</code> block, not by passing them as arguments to each other like that.  It certainly isn&#39;t going to work with your <code>CSV</code> type since it expects <code>[[String]]</code> and not some Parsec type."}, {"owner": {"reputation": 23, "user_id": 6503430, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/90a242d60cfa9e1fa9bd2d84afc854f8?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/6503430/john-doe"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1467923973, "post_id": 38254722, "comment_id": 63930806, "body": "bhekillar you are right :("}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1467924808, "post_id": 38254722, "comment_id": 63931268, "body": "@bheklilr you mean <code>CSV &lt;$&gt; endBy (...)</code> right?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1467924850, "post_id": 38254722, "comment_id": 63931292, "body": "@Alec I definitely mean <code>&lt;$&gt;</code>, this is what happens when I don&#39;t write as much Haskell as I used to... I just deleted that comment since it was outside of the edit window."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 2, "last_activity_date": 1467924733, "creation_date": 1467924733, "answer_id": 38255052, "question_id": 38254722, "link": "https://stackoverflow.com/questions/38254722/haskell-parse-a-string-into-array-of-arrays/38255052#38255052", "title": "Haskell parse a string into array of arrays", "body": "<p>Here is a solution that parses <code>runParsec parseCSV \"4;5\\n6,7\\n\"</code> into <code>Just (CSV [[\"4\",\"5\"],[\"6\",\"7\"]])</code>.</p>\n\n<pre><code>parseCSV :: Parser CSV\nparseCSV = CSV &lt;$&gt; csv\n  where\n    csv = row `endBy` char '\\n'\n    row = many (noneOf \",;\\n\") `sepBy` oneOf \",;\"\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 6503430, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/90a242d60cfa9e1fa9bd2d84afc854f8?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/6503430/john-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 386, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1467924733, "creation_date": 1467923436, "last_edit_date": 1467923544, "question_id": 38254722, "link": "https://stackoverflow.com/questions/38254722/haskell-parse-a-string-into-array-of-arrays", "title": "Haskell parse a string into array of arrays", "body": "<p>I Need to parse a String into Array of Arrays. String is splited in Arrays by \"\\n\" char. And each of that Array is splited by \",\" or \";\" signs.</p>\n\n<p>Example: <code>4;5\\n6,7</code>   -----> <code>[[4,5][6,7]]</code> </p>\n\n<pre><code>import qualified Text.Parsec as P (char,runP,noneOf,many,(&lt;|&gt;),eof)\nimport Text.ParserCombinators.Parsec\nimport Text.Parsec.String \nimport Text.Parsec.Char\nimport Text.PrettyPrint.HughesPJ\nimport Data.Maybe\n\nnewtype CSV = CSV [Row] deriving (Show,Eq)\ntype Row = [String]\n\nparseCSV :: Parser CSV\nparseCSV = do\n  return $ CSV (endBy (sepBy (many (noneOf \",\\n\")) (Text.Parsec.Char.char ',')) (Text.Parsec.Char.char '\\n'))\n\nrunParsec :: Parser a -&gt; String -&gt; Maybe a\nrunParsec parser input = case P.runP parser () \"\" input of\n    Left  _ -&gt; Nothing\n    Right a -&gt; Just a\n</code></pre>\n\n<p>But when I try to run the Code I get error because of wrong data types </p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 6503430, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/90a242d60cfa9e1fa9bd2d84afc854f8?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/6503430/john-doe"}, "edited": false, "score": 0, "creation_date": 1467916715, "post_id": 38252935, "comment_id": 63926969, "body": "it worked! I will mark it as correct answer in a few minutes, thanks!"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 1, "last_activity_date": 1467916567, "creation_date": 1467916567, "answer_id": 38252935, "question_id": 38252767, "link": "https://stackoverflow.com/questions/38252767/haskell-data-type-error-by-parsing/38252935#38252935", "title": "Haskell: Data Type error by parsing", "body": "<p>Try this instead:</p>\n\n<pre><code>parseCSV :: Parser CSV\nparseCSV = return $ CSV [[\"\"]]\n</code></pre>\n\n<p>The error says it all: <code>parseCSV</code> should have type <code>Parser CSV</code> (from the type signature), but <code>Just (CSV [[\"\"]])</code> has type <code>Maybe CSV</code>.</p>\n"}], "owner": {"reputation": 23, "user_id": 6503430, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/90a242d60cfa9e1fa9bd2d84afc854f8?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/6503430/john-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 38252935, "answer_count": 1, "score": 0, "last_activity_date": 1467916567, "creation_date": 1467915927, "question_id": 38252767, "link": "https://stackoverflow.com/questions/38252767/haskell-data-type-error-by-parsing", "title": "Haskell: Data Type error by parsing", "body": "<p>I have a string that I Need to parse to Array of Array or otherwise.</p>\n\n<p>This is the Code I have</p>\n\n<pre><code>import Test.HUnit (runTestTT,Test(TestLabel,TestList),(~?=))\nimport qualified Text.Parsec as P (char,runP,noneOf,many,(&lt;|&gt;),eof)\nimport Text.ParserCombinators.Parsec\nimport Text.Parsec.String \nimport Text.Parsec.Char\nimport Text.PrettyPrint.HughesPJ\nimport Data.Maybe\nimport Data.List.Split\n\nnewtype CSV = CSV [Row] deriving (Show,Eq)\ntype Row = [String]\n\nparseCSV :: Parser CSV\nparseCSV = error \"not done yet\"  \n\nrunParsec :: Parser a -&gt; String -&gt; Maybe a\nrunParsec parser input = case P.runP parser () \"\" input of\n    Left  _ -&gt; Nothing\n    Right a -&gt; Just a\n</code></pre>\n\n<p>When I start implementing parseCSV function</p>\n\n<pre><code>parseCSV = Just (CSV [[\"\"]])\n</code></pre>\n\n<p>I get this error:</p>\n\n<pre><code>Expected type: Parser CSV\nActual type: Maybe CSV\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "owner": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1468142318, "creation_date": 1467907191, "last_edit_date": 1468142318, "question_id": 38250173, "link": "https://stackoverflow.com/questions/38250173/re-running-setup-hs-and-change-detection", "title": "re-running Setup.hs and change detection", "body": "<p>I took the habit of managing my post-install setup things in the <code>Setup.hs</code>. The advantages are clear: it's coded in haskell, and it has access to the app data directory, where the binary will get installed.</p>\n\n<p>I'm using it now for instance, to copy the QML data files and icons that a haskell QML application needs to the installation folder.</p>\n\n<p>This all worked well until recently, but now <code>stack</code> started optimizing the build a lot, and if it detects that no haskell files changed, it won't re-trigger the <code>Setup.hs</code>. That obviously doesn't work for me, because I'd like my QML files and icons to get copied every time I run <code>stack install</code> during development.</p>\n\n<p>I can't find a flag for <code>stack</code> that would trigger just the <code>Setup.hs</code> and nothing else (or little else -- certainly <code>clean</code> and <code>--reconfigure</code> force rebuilding too many things). How are people doing that? Should I write a shell script? But it'll have trouble finding the target directory for the installation, plus it's less portable that the haskell in my Setup.hs?</p>\n\n<p>I feel stack are probably right in their reasoning and if my current way was really correct they would have enabled this scenario by now. So either there's a stack flag that I don't see, either I'm doing it wrong I think.</p>\n\n<p><em>NOTE</em>: <code>stack</code> is so smart that not even <code>touch Setup.hs</code> or of another .hs file helps to re-trigger its execution. I must physically change the contents of one file.</p>\n\n<p><em>NOTE2</em>: Ah, I re-discovered <code>stack path</code> to find out target path information. I could use that from a shell script to install the files. Still feels like a shame to write that in shell when I have haskell...</p>\n\n<p><em>NOTE3</em>: posted the question <a href=\"https://groups.google.com/forum/#!topic/haskell-stack/Vj-9j8P4nek\" rel=\"nofollow\">on the stack mailing list</a> now...</p>\n\n<p><em>NOTE4</em>: actually <a href=\"https://github.com/commercialhaskell/stack/issues/2357\" rel=\"nofollow\">opened a stack bug now</a></p>\n"}, {"tags": ["haskell", "coding-style", "parentheses"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 4, "creation_date": 1467906534, "post_id": 38249650, "comment_id": 63920992, "body": "I&#39;d prefer a fold for readability. By the way, this can be done point free: <code>polyEval&#39; x = foldl&#39; (\\b a -&gt; a + x*b) 0</code>."}, {"owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1467906674, "post_id": 38249650, "comment_id": 63921079, "body": "@Alec I just updated my question: I constructed this particular example because of the particular case where you have a function evaluated in two arguments as an argument for another one, and want to discuss this particular example. (by the way: your function is not entirely point free as you are explicitly using arguments for your lambda)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1467908043, "post_id": 38249650, "comment_id": 63921883, "body": "Assuming one keeps the code structure as it is, I think <code>... where powers = iterate (*x) 1</code> would help. I&#39;d use <code>polyEval x = sum . zipWith (*) powers . reverse</code>"}], "answers": [{"tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": false, "score": 2, "last_activity_date": 1467911154, "creation_date": 1467911154, "answer_id": 38251393, "question_id": 38249650, "link": "https://stackoverflow.com/questions/38249650/getting-rid-of-unnecessary-parenthesis/38251393#38251393", "title": "getting rid of unnecessary parenthesis", "body": "<p></p>\n\n<p>So it might be a little puerile, but I actually really like to think of Haskell\u2019s rules in terms of food. I think of Haskell\u2019s left-associative function application <code>f x y = (f x) y</code> as a sort of <em>aggressive nom</em> or <em>greedy nom</em>, in that the function <code>f</code> refuses to wait for the <code>y</code> to come around and immediately eats the <code>f</code>, unless you take the time to put these things in parentheses to make a sort of \"argument sandwich\" <code>f (x y)</code> (at which point the <code>x</code>, being uneaten, becomes hungry and eats the <code>y</code>.) The only boundaries are the operators and the special forms.</p>\n\n<p>Then within the boundaries of the special forms, the operators consume whatever is around them; finally the special forms take their time to digest the expressions around them. This is the only reason that <code>.</code> and <code>$</code> are able to save some parentheses.</p>\n\n<p>Finally this we can see that <code>iterate (* x) 1</code> is probably going to <em>need to be in a sandwich</em> because we don't want something to just eat <code>iterate</code> and stop. So there is no great way to do that without changing that code, unless we can somehow do away with the third argument to <code>zipWith</code> -- but that argument contains a <code>p</code> so that requires writing something to be more point-free. </p>\n\n<p>So, one solution is to change your approach! It makes a little more sense to store a polynomial as a list of coefficients in the already-reversed direction, so that your <code>x^2 + 2 * x + 3</code> example is stored as <code>[3, 2, 1]</code>. Then we don't need to perform this complicated <code>reverse</code> operation. It also makes the mathematics a little simpler as the product of two polynomials can be rewritten recursively as <code>(a + x * P(x)) * (b + x * Q(x))</code> which gives the straightforward algorithm:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code> newtype Poly f = Poly [f] deriving (Eq, Show)\n\n instance Num f =&gt; Num (Poly f) where\n     fromInteger n = Poly [fromInteger n]\n     negate (Poly ps) = Poly (map negate ps)\n     Poly f + Poly g = Poly $ summing f g where\n         summing [] g = g\n         summing f [] = f\n         summing (x:xs) (y:ys) = (x + y) : summing xs ys\n     Poly (x : xs) * Poly (y : ys) = prefix (x*y) (y_p + x_q) + r where\n         y_p = Poly $ map (y *) xs\n         x_q = Poly $ map (x *) ys\n         prefix n (Poly m) = Poly (n : m)\n         r = prefix 0 . prefix 0 $ Poly xs * Poly ys\n</code></pre>\n\n<p>Then your function</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>evaluatePoly :: Num f =&gt; Poly f -&gt; f -&gt; f\nevaluatePoly (Poly p) x = eval p where\n    eval = (sum .) . zipWith (*) $ iterate (x *) 1\n</code></pre>\n\n<p>lacks parentheses around <code>iterate</code> because the <code>eval</code> is written in pointfree style, so <code>$</code> can be used to consume the rest of the expression. As you can see it unfortunately leaves some new parentheses around <code>(sum .)</code> to do this, though, so it might not be totally worth your while. I find the latter less readable than, say,</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>evaluatePoly (Poly coeffs) x = sum $ zipWith (*) powersOfX coeffs where\n    powersOfX = iterate (x *) 1\n</code></pre>\n\n<p>I might even prefer to write the latter, if performance on high powers is not super-critical, as <code>powersOfX = [x^n | n &lt;- [0..]]</code> or <code>powersOfX = map (x^) [0..]</code>, but I think <code>iterate</code> is not too hard to understand in general.</p>\n"}, {"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 3, "last_activity_date": 1467911560, "creation_date": 1467911560, "answer_id": 38251491, "question_id": 38249650, "link": "https://stackoverflow.com/questions/38249650/getting-rid-of-unnecessary-parenthesis/38251491#38251491", "title": "getting rid of unnecessary parenthesis", "body": "<p>As usual with this sort of question I prefer the OP's version to any of the alternatives that have been proposed so far. I would write</p>\n\n<pre><code>polyEval x p = sum $ zipWith (*) (iterate (* x) 1) (reverse p)\n</code></pre>\n\n<p>and leave it at that. The two arguments of <code>zipWith (*)</code> play symmetric roles in the same way that the two arguments of <code>*</code> do, so eta-reducing is just obfuscation.</p>\n\n<p>The value of <code>$</code> is that it makes the outermost structure of the computation clear: the evaluation of a polynomial at a point is the sum of something. Eliminating parentheses should not be a goal in itself.</p>\n"}, {"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 0, "last_activity_date": 1467915175, "creation_date": 1467915175, "answer_id": 38252522, "question_id": 38249650, "link": "https://stackoverflow.com/questions/38249650/getting-rid-of-unnecessary-parenthesis/38252522#38252522", "title": "getting rid of unnecessary parenthesis", "body": "<p>Perhaps breaking it down to more elementary functions will simplify further.  First define a dot product function to multiply two arrays (inner product).</p>\n\n<pre><code>dot x y = sum $ zipWith (*) x y\n</code></pre>\n\n<p>and change the order of terms in polyEval to minimize the parenthesis</p>\n\n<pre><code>polyEval x p = dot (reverse p) $ iterate (* x) 1\n</code></pre>\n\n<p>reduced to 3 pairs of parenthesis.</p>\n"}], "owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 526, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1467915175, "creation_date": 1467905719, "last_edit_date": 1467906565, "question_id": 38249650, "link": "https://stackoverflow.com/questions/38249650/getting-rid-of-unnecessary-parenthesis", "title": "getting rid of unnecessary parenthesis", "body": "<p>I wrote a function for evaluating a polynomial at a given number. The polynomial is represented as a list of coefficients (e.g. <code>[1,2,3]</code> corresponds to <code>x^2+2x+3</code>).</p>\n\n<pre><code>polyEval x p = sum (zipWith (*) (iterate (*x) 1) (reverse p))\n</code></pre>\n\n<p>As you can see, I first used a lot of parenthesis to group which expressions should be evaluated. For better readability I tried to eliminate as many parenthesis using <code>.</code> and <code>$</code>. (In my opinion more than two pairs of nested parenthesis are making the code more and more difficult to read.) I know that function application has highest priority and is left associative. The <code>.</code> and <code>$</code>are both right associative but <code>.</code> has priority 9, while <code>$</code> has priority 0. </p>\n\n<p>So it seemed to me that following expression cannot be written with even fewer parenthesis</p>\n\n<pre><code>polyEval x p = sum $ zipWith (*) (iterate (*x) 1) $ reverse p\n</code></pre>\n\n<p>I know that we need parenthesis for <code>(*)</code> and <code>(*x)</code> to convert them to prefix functions, but is it possible to somehow remove the parenthesis around <code>iterate (*x) 1</code>?</p>\n\n<p>Also what version would you prefer for readability?</p>\n\n<p>I know that there are many other ways to achieve the same, but I'd like to discuss my particular example, as it has a function evaluated in two arguments  <code>(iterate (*x) 1)</code> as middle argument of another function that takes three arguments.</p>\n"}, {"tags": ["function", "haskell", "types", "ghc", "lambda-calculus"], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 7, "last_activity_date": 1467914408, "last_edit_date": 1495540373, "creation_date": 1467906078, "answer_id": 38249762, "question_id": 38248771, "link": "https://stackoverflow.com/questions/38248771/what-does-core-haskell-applying-types-to-functions-mean/38249762#38249762", "title": "What does Core Haskell applying types to functions mean?", "body": "<p>Core is pretty much <a href=\"https://en.wikipedia.org/wiki/System_F\" rel=\"nofollow noreferrer\">SystemF</a> (technically <a href=\"http://research.microsoft.com/en-us/um/people/simonpj/papers/ext-f/fc-tldi.pdf\" rel=\"nofollow noreferrer\">SystemFC</a>). In SystemF, type variables also need to be arguments to the function. In your example, Haskell infers that</p>\n\n<pre><code>add2 :: Num a =&gt; a -&gt; a -&gt; a \nadd2 a b = a + b\n</code></pre>\n\n<p>That explains the <code>TyVar \"a\"</code> argument to <code>add2</code>.</p>\n\n<p>Also, Haskell has to find a way to dispatch to the 'right' set of <code>Num</code> functions depending on what the type of the arguments <code>a</code> and <code>b</code> is. It does that by having a dictionary argument for each type class constraint. That's the <code>Id $dNum</code> argument. In the case of <code>add</code>, Haskell already knows which dictionary the appropriate <code>(+)</code> function can be found since it knows it knows the operation is on <code>Int</code> (so it doesn't need to be passed in: it's just <code>$fNumInt</code>).</p>\n\n<p>Essentially what happens under the hood is that for each typeclass Haskell makes a record <code>data $d&lt;Class&gt; = ...</code> with fields that are the functions inside the typeclass. Then, for each instance, it makes another <code>$f&lt;Class&gt;&lt;Type&gt; :: $d&lt;Class&gt;</code>. <a href=\"http://www.cs.tufts.edu/comp/150PLD/Notes/TypeClasses.pdf\" rel=\"nofollow noreferrer\">This is explained in more detail here</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/6121146/reading-ghc-core\">Here is another excellent answer describing Core related things.</a></p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 5, "last_activity_date": 1467910392, "creation_date": 1467910392, "answer_id": 38251168, "question_id": 38248771, "link": "https://stackoverflow.com/questions/38248771/what-does-core-haskell-applying-types-to-functions-mean/38251168#38251168", "title": "What does Core Haskell applying types to functions mean?", "body": "<p>In GHC 8.x you can play with type arguments in Haskell as well, similarly to Core. Here's an example with some more annotations, based on the posted code.</p>\n\n<pre><code>add :: Int -&gt; Int -&gt; Int\nadd a b = (+) @ Int a b\n</code></pre>\n\n<p>The <code>(+) @ Int</code> specializes the polymorphic <code>(+)</code> operator so that it works on type <code>Int</code>.</p>\n\n<p>In Core, you also see the typeclass dictionary being passed around <code>$fNumInt</code>.</p>\n\n<pre><code>add2 :: forall n. Num n =&gt; n -&gt; n -&gt; n    \nadd2 a b = (+) @ n a b\n</code></pre>\n\n<p>This is basically the same, except that <code>n</code> is not known. </p>\n\n<p>In Core, <code>add2</code> takes a hidden \"type-valued\" argument <code>n</code> (confusingly called <code>a</code> in the posted example, i.e. <code>(Lam (TyVar \"a\") ...</code>), which is then forwarded to <code>(+)</code> as a type argument. Since the dictionary is now unknown, in Core there is another hidden argument: the dictionary has to be passed by the caller of <code>add2</code>, which then forwards it to <code>(+)</code>. This additional argument is called <code>$dNum</code> (See <code>(Lam (Id \"$dNum\") ...</code>).</p>\n"}], "owner": {"reputation": 755, "user_id": 2704964, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79d2160e8cd355915182506411e69489?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Xue", "link": "https://stackoverflow.com/users/2704964/anton-xue"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 294, "favorite_count": 1, "accepted_answer_id": 38249762, "answer_count": 2, "score": 3, "last_activity_date": 1467914408, "creation_date": 1467903418, "question_id": 38248771, "link": "https://stackoverflow.com/questions/38248771/what-does-core-haskell-applying-types-to-functions-mean", "title": "What does Core Haskell applying types to functions mean?", "body": "<p>I wrote a custom pretty printer for Core Haskell in order to better study Core's structure. The gist of this pretty printer is that it takes a <a href=\"https://downloads.haskell.org/~ghc/7.6.1/docs/html/libraries/ghc/GHC.html#t:CoreModule\" rel=\"nofollow\">CoreModule</a> and includes data constructors in the output, which the default <code>Outputable</code> implementation does not seem to do.</p>\n\n<p>Here is the code of the module that I am running the pretty printer on:</p>\n\n<pre><code>module Bar2 where\n\nadd :: Int -&gt; Int -&gt; Int\nadd a b = a + b\n\nadd2 a b = a + b\n</code></pre>\n\n<p>Here is the pretty printer output:</p>\n\n<pre><code>------------------------------- Module Metadata --------------------------------\nModule { \"main\" :: modulePackageId, \"Bar2\" :: moduleName }\n-------------------------------- Type Bindings ---------------------------------\n[r0 :-&gt; Identifier \u2018add\u2019, rjH :-&gt; Identifier \u2018add2\u2019]\n-------------------------------- Core Bindings ---------------------------------\nNonRec (Id \"add2\")\n       (Lam (TyVar \"a\")\n            (Lam (Id \"$dNum\")\n                 (Lam (Id \"a1\")\n                      (Lam (Id \"b\")\n                           (App (App (App (App (Var (Id \"+\"))\n                                               (Type (TyVar (TyVar \"a\"))))\n                                          (Var (Id \"$dNum\")))\n                                     (Var (Id \"a1\")))\n                                (Var (Id \"b\")))))))\n\nNonRec (Id \"add\")\n       (Lam (Id \"a\")\n            (Lam (Id \"b\")\n                 (App (App (App (App (Var (Id \"+\"))\n                                     (Type (TyConApp (Int) [])))\n                                (Var (Id \"$fNumInt\")))\n                           (Var (Id \"a\")))\n                      (Var (Id \"b\")))))\n--------------------------------- Safe Haskell ---------------------------------\nSafe\n------------------------------------- End --------------------------------------\n</code></pre>\n\n<p>What is confusing to me is that in both instances, Core appears to be applying a type variable, or a type constructor to the <code>+</code> function, as well as some <code>$dNum</code> or <code>$fNumInt</code> before taking in the arguments.</p>\n\n<p>For the <code>add</code> function, the type is also explicitly given, while the <code>add2</code> is left up to compiler inference. This also seems to affect the number of arguments that the chain of lambda functions requires for evaluation, with <code>add</code> needing 2 while <code>add2</code> requiring 4.</p>\n\n<p>What does this all mean?</p>\n"}, {"tags": ["haskell", "records"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1467905230, "post_id": 38248692, "comment_id": 63920118, "body": "Do the record fields need to be named (could <code>Foo</code> be something else then a record)?"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1467906752, "post_id": 38248692, "comment_id": 63921126, "body": "This smell of XY problem. Maybe the solution is to not have that kind of <code>Foo</code> at all, but to make that judgement we <i>must</i> be given information about the problem that <code>Foo</code> has to solve."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1467907287, "post_id": 38248692, "comment_id": 63921431, "body": "Seems like a use case for datatype-generic programming, perhaps using a generics library like &quot;generics-sop&quot;."}, {"owner": {"reputation": 6586, "user_id": 70288, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7985e0ed3b6ea6355a87fb2245416a1a?s=128&d=identicon&r=PG", "display_name": "Robert Campbell", "link": "https://stackoverflow.com/users/70288/robert-campbell"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1467912388, "post_id": 38248692, "comment_id": 63924485, "body": "@Bakuriu - Good point. I&#39;ve added a note about the problem I&#39;m trying to solve. Basically the record is in place to collect the different types resulting from <a href=\"https://github.com/rcampbell/vcard/blob/master/VCard.hs\" rel=\"nofollow noreferrer\">permutation parsing the vCard format</a>. In the code I&#39;ve linked to you can see how it&#39;s getting unwieldy. I don&#39;t know how certain I can be that the types will only be lists and Maybes - it&#39;s an early and rough impl - but perhaps the fact that there are only two types can be taken advantage of somehow..."}], "answers": [{"comments": [{"owner": {"reputation": 6586, "user_id": 70288, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7985e0ed3b6ea6355a87fb2245416a1a?s=128&d=identicon&r=PG", "display_name": "Robert Campbell", "link": "https://stackoverflow.com/users/70288/robert-campbell"}, "edited": false, "score": 1, "creation_date": 1467982033, "post_id": 38250923, "comment_id": 63953507, "body": "I&#39;ve <a href=\"https://github.com/rcampbell/vcard/blob/14fb1c91df249ec9aa21ac5cbfe967d7b7a9757d/VCard.hs#L109-L141\" rel=\"nofollow noreferrer\">implemented this approach</a> in a <code>foldl</code> branch to compare against the generics one."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1467909567, "creation_date": 1467909567, "answer_id": 38250923, "question_id": 38248692, "link": "https://stackoverflow.com/questions/38248692/whats-a-better-way-of-managing-large-haskell-records/38250923#38250923", "title": "What&#39;s a better way of managing large Haskell records?", "body": "<p>Some suggestions:</p>\n\n<p>(1) You can use the <strong>RecordWildCards</strong> extension to automatically\nunpack a record into variables. Doesn't help if you need to unpack\ntwo records of the same type, but it's a useful to keep in mind.\nOliver Charles has a nice blog post on it: <a href=\"https://ocharles.org.uk/blog/posts/2014-12-04-record-wildcards.html\" rel=\"nofollow\">(link)</a></p>\n\n<p>(2) It appears your example application is performing a fold over the records.\nHave a look at Gabriel Gonzalez's <a href=\"https://hackage.haskell.org/package/foldl-1.2.1/docs/Control-Foldl.html#t:Fold\" rel=\"nofollow\">foldl</a> package. There is also a blog post: <a href=\"http://www.haskellforall.com/2013/08/foldl-100-composable-streaming-and.html\" rel=\"nofollow\">(link)</a></p>\n\n<p>Here is a example of how you might use it with a record like:</p>\n\n<pre><code>data Foo = Foo { _a :: Int, _b :: String }\n</code></pre>\n\n<p>The following code computes the maximum of the <code>_a</code> fields and the\nconcatenation of the <code>_b_</code> fields.</p>\n\n<pre><code> import qualified Control.Foldl as L\n import Data.Profunctor\n\n data Foo = Foo { _a :: Int, _b :: String }\n  deriving (Show)\n\n fold_a :: L.Fold Foo Int\n fold_a = lmap _a (L.Fold max 0 id)\n\n fold_b :: L.Fold Foo String\n fold_b = lmap _b (L.Fold (++) \"\" id)\n\n fold_foos :: L.Fold Foo Foo\n fold_foos = Foo &lt;$&gt; fold_a &lt;*&gt; fold_b\n\n theFoos = [ Foo 1 \"a\", Foo 3 \"b\", Foo 2 \"c\" ]\n\n test = L.fold fold_foos theFoos\n</code></pre>\n\n<p>Note the use of the Profunctor function <code>lmap</code> to extract out\nthe fields we want to fold over. The expression:</p>\n\n<pre><code>L.Fold max 0 id\n</code></pre>\n\n<p>is a fold over a list of Ints (or any Num instance), and therefore:</p>\n\n<pre><code>lmap _a (L.Fold max 0 id)\n</code></pre>\n\n<p>is the same fold but over a list of <code>Foo</code> records where we use <code>_a</code>\nto produce the Ints.</p>\n"}, {"comments": [{"owner": {"reputation": 6586, "user_id": 70288, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7985e0ed3b6ea6355a87fb2245416a1a?s=128&d=identicon&r=PG", "display_name": "Robert Campbell", "link": "https://stackoverflow.com/users/70288/robert-campbell"}, "edited": false, "score": 0, "creation_date": 1467982289, "post_id": 38251692, "comment_id": 63953680, "body": "I&#39;ve <a href=\"https://github.com/rcampbell/vcard/blob/b377d690854ac088ae8fba078971ac732b08cfb8/VCard.hs#L115-L151\" rel=\"nofollow noreferrer\">implemented this approach</a> in a <code>generics</code> branch to compare against the foldl one."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 6586, "user_id": 70288, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7985e0ed3b6ea6355a87fb2245416a1a?s=128&d=identicon&r=PG", "display_name": "Robert Campbell", "link": "https://stackoverflow.com/users/70288/robert-campbell"}, "edited": false, "score": 0, "creation_date": 1467984698, "post_id": 38251692, "comment_id": 63955347, "body": "@rcampbell I&#39;ve updated the code to simplify a few things."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 5, "last_activity_date": 1467986299, "last_edit_date": 1467986299, "creation_date": 1467912341, "answer_id": 38251692, "question_id": 38248692, "link": "https://stackoverflow.com/questions/38248692/whats-a-better-way-of-managing-large-haskell-records/38251692#38251692", "title": "What&#39;s a better way of managing large Haskell records?", "body": "<p>Datatype-generic programming techniques can be used to transform all the fields of a record in some \"uniform\" sort of way.</p>\n\n<p>Perhaps all the fields in the record implement some typeclass that we want to use (the typical example is <code>Show</code>). Or perhaps we have another record of \"similar\" shape that contains functions, and we want to apply each function to the corresponding field of the original record.</p>\n\n<p>For these kinds of uses, the <a href=\"http://hackage.haskell.org/package/generics-sop\" rel=\"nofollow\">generics-sop</a> library is a good option. It expands the default Generics functionality of GHC with extra type-level machinery that provides analogues of functions like <a href=\"http://hackage.haskell.org/package/generics-sop-0.2.1.0/docs/Generics-SOP.html#t:HSequence\" rel=\"nofollow\"><code>sequence</code></a> or <a href=\"http://hackage.haskell.org/package/generics-sop-0.2.1.0/docs/Generics-SOP.html#t:HAp\" rel=\"nofollow\"><code>ap</code></a>, but which work over all the fields of a record.</p>\n\n<p>Using generics-sop, I tried to create a slightly less verbose version of your <code>merge</code> funtion. Some preliminary imports:</p>\n\n<pre><code>{-# language TypeOperators #-}\n{-# language DeriveGeneric #-}\n{-# language TypeFamilies #-}\n{-# language DataKinds #-}\n\nimport Control.Applicative (liftA2)\nimport qualified GHC.Generics as GHC\nimport Generics.SOP\n</code></pre>\n\n<p>A <a href=\"http://hackage.haskell.org/package/generics-sop-0.2.1.0/docs/Generics-SOP.html#v:Fn\" rel=\"nofollow\">helper</a> function that lifts a binary operation to a form useable by the functions of generics-sop:</p>\n\n<pre><code>fn_2' :: (a -&gt; a -&gt; a) -&gt; (I -.-&gt; (I -.-&gt; I)) a -- I is simply an Identity functor\nfn_2' = fn_2 . liftA2\n</code></pre>\n\n<p>A general merge function that takes a vector of operators and works on any single-constructor record that derives <code>Generic</code>:</p>\n\n<pre><code>merge :: (Generic a, Code a ~ '[ xs ]) =&gt; NP (I -.-&gt; (I -.-&gt; I)) xs -&gt; a -&gt; a -&gt; a \nmerge funcs reg1 reg2 =\n    case (from reg1, from reg2) of \n        (SOP (Z np1), SOP (Z np2)) -&gt; \n            let npResult  = funcs `hap` np1 `hap` np2\n            in  to (SOP (Z npResult))\n</code></pre>\n\n<p><a href=\"http://hackage.haskell.org/package/generics-sop-0.2.1.0/docs/Generics-SOP.html#t:Code\" rel=\"nofollow\"><code>Code</code></a> is a type family that returns a type-level list of lists describing the structure of a datatype. The outer list is for constructors, the inner lists contain the types of the fields for each constructor.</p>\n\n<p>The <code>Code a ~ '[ xs ]</code> part of the constraint says \"the datatype can only have one constructor\" by requiring the outer list to have exactly one element. </p>\n\n<p>The <code>(SOP (Z _)</code> pattern matches extract the (heterogeneus) vector of field values from the record's generic representation. <a href=\"http://hackage.haskell.org/package/generics-sop-0.2.1.0/docs/Generics-SOP.html#t:SOP\" rel=\"nofollow\"><code>SOP</code></a> stands for \"sum-of-products\".</p>\n\n<p>A concrete example:</p>\n\n<pre><code>data Person = Person\n    {\n        name :: String\n    ,   age :: Int\n    } deriving (Show,GHC.Generic)\n\ninstance Generic Person -- this Generic is from generics-sop\n\nmergePerson :: Person -&gt; Person -&gt; Person\nmergePerson = merge (fn_2' (++) :* fn_2' (+) :* Nil)\n</code></pre>\n\n<p>The <code>Nil</code> and <code>:*</code> constructors are used to build the vector of operators (the type is called <a href=\"http://hackage.haskell.org/package/generics-sop-0.2.1.0/docs/Generics-SOP.html#t:NP\" rel=\"nofollow\"><code>NP</code></a>, from n-ary product). If the vector doesn't match the number of fields in the record, the program won't compile.</p>\n\n<p><strong>Update.</strong> Given that the types in your record are highly uniform, an alternative way of creating the vector of operations is to define instances of an auxiliary typeclass for each field type, and then use the <a href=\"http://hackage.haskell.org/package/generics-sop-0.2.1.0/docs/Generics-SOP.html#v:hpure\" rel=\"nofollow\"><code>hcpure</code></a> function:</p>\n\n<pre><code>class Mergeable a where\n    mergeFunc :: a -&gt; a -&gt; a\n\ninstance Mergeable String where\n    mergeFunc = (++)\n\ninstance Mergeable Int where\n    mergeFunc = (+)\n\nmergePerson :: Person -&gt; Person -&gt; Person\nmergePerson = merge (hcpure (Proxy :: Proxy Mergeable) (fn_2' mergeFunc))\n</code></pre>\n\n<p>The <a href=\"http://hackage.haskell.org/package/generics-sop-0.2.1.0/docs/Generics-SOP.html#v:hcliftA2\" rel=\"nofollow\"><code>hcliftA2</code></a> function (that combines <code>hcpure</code>, <code>fn_2</code> and <code>hap</code>) could be used to simplify things further.</p>\n"}], "owner": {"reputation": 6586, "user_id": 70288, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7985e0ed3b6ea6355a87fb2245416a1a?s=128&d=identicon&r=PG", "display_name": "Robert Campbell", "link": "https://stackoverflow.com/users/70288/robert-campbell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 397, "favorite_count": 1, "answer_count": 2, "score": 4, "last_activity_date": 1467986299, "creation_date": 1467903196, "last_edit_date": 1467982512, "question_id": 38248692, "link": "https://stackoverflow.com/questions/38248692/whats-a-better-way-of-managing-large-haskell-records", "title": "What&#39;s a better way of managing large Haskell records?", "body": "<p>Replacing fields names with letters, I have cases like this:</p>\n\n<pre><code>data Foo = Foo { a :: Maybe ...\n               , b :: [...]\n               , c :: Maybe ...\n               , ... for a lot more fields ...\n               } deriving (Show, Eq, Ord)\n\ninstance Writer Foo where\n  write x = maybeWrite a ++\n            listWrite  b ++\n            maybeWrite c ++\n            ... for a lot more fields ...\n\nparser = permute (Foo\n                   &lt;$?&gt; (Nothing, Just `liftM` aParser)\n                   &lt;|?&gt; ([], bParser)\n                   &lt;|?&gt; (Nothing, Just `liftM` cParser)\n                   ... for a lot more fields ...\n\n-- this is particularly hideous\nfoldl1 merge [foo1, foo2, ...]\nmerge (Foo a b c ...seriously a lot more...)\n      (Foo a' b' c' ...) = \n        Foo (max a a') (b ++ b') (max c c') ...\n</code></pre>\n\n<p>What techniques would allow me to better manage this growth? </p>\n\n<p>In a perfect world <code>a</code>, <code>b</code>, and <code>c</code> would all be the same type so I could keep them in a list, but they can be many different types. I'm particularly interested in any way to fold the records without needing the massive patterns.</p>\n\n<p>I'm using this large record to hold the different types resulting from <a href=\"https://github.com/rcampbell/vcard/blob/master/VCard.hs\" rel=\"nofollow\">permutation parsing the vCard format</a>.</p>\n\n<p><strong>Update</strong></p>\n\n<p>I've implemented both the <a href=\"https://github.com/rcampbell/vcard/blob/b377d690854ac088ae8fba078971ac732b08cfb8/VCard.hs#L115-L151\" rel=\"nofollow\">generics</a> and the <a href=\"https://github.com/rcampbell/vcard/blob/14fb1c91df249ec9aa21ac5cbfe967d7b7a9757d/VCard.hs#L109-L141\" rel=\"nofollow\">foldl</a> approaches suggested below. They both work, and they both reduce <a href=\"https://github.com/rcampbell/vcard/blob/da4dc58770451f026f871b2ec27c4f5f75bcba54/VCard.hs#L112-L174\" rel=\"nofollow\">three large field lists</a> to one. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1467903140, "post_id": 38248626, "comment_id": 63918613, "body": "Note that if you add <code>UndecidableInstances</code> and <code>FlexibleInstances</code> language extensions then it works."}, {"owner": {"reputation": 23, "user_id": 6520446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2676969426d369bf3ece554439630866?s=128&d=identicon&r=PG&f=1", "display_name": "ijon", "link": "https://stackoverflow.com/users/6520446/ijon"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1467904047, "post_id": 38248626, "comment_id": 63919260, "body": "Thank you for your comments and answers but could you please describe in a bit more detail which of the Haskell language mechanics prevents me (and why) from making such instance declarations? (Indeed it works with said language extensions, but why it doesn&#39;t work without them? I am interested in this for rather theoretical reasons, not practical ones.)"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1467904763, "post_id": 38248626, "comment_id": 63919769, "body": "The problem is that instance declarations (by default) must be of the form <code>instance context =&gt; C (T a1 .. an)</code> where <code>a1</code> , .., <code>an</code> appear in <code>contentx</code> <b>and <code>T</code> is a type constructor</b>. In your case your declaration is of the form <code>instance context =&gt; C a</code> you are missing the <code>T</code>!"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1467909398, "post_id": 38248626, "comment_id": 63922700, "body": "Suppose I add <code>instance Num [Int]</code> since I might like to perform pointwise operations (even if it is a bad idea for lists). Now, what should <code>multiplication [2] [3]</code> be? <code>[2,3]</code> or <code>[5]</code>? And what if I want a magma with <code>*</code> instead?"}, {"owner": {"reputation": 23, "user_id": 6520446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2676969426d369bf3ece554439630866?s=128&d=identicon&r=PG&f=1", "display_name": "ijon", "link": "https://stackoverflow.com/users/6520446/ijon"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1467930869, "post_id": 38248626, "comment_id": 63933655, "body": "@Bakuriu Thanks, it seems that your comment is <i>the</i> correct answer! So simply put the second declaration doesn&#39;t work because it is not syntactically correct! That type constructor &quot;T&quot; is needed. I think this is quite peculiar, since not writing a type constructor might be interpreted as a trivial &quot;identity&quot; constructor. Why such a design choice, why forcing to use a constructor? Bakuriu I like your comment/answer most, if you can add anything feel free to write down a proper answer so I can accept it."}, {"owner": {"reputation": 23, "user_id": 6520446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2676969426d369bf3ece554439630866?s=128&d=identicon&r=PG&f=1", "display_name": "ijon", "link": "https://stackoverflow.com/users/6520446/ijon"}, "edited": false, "score": 0, "creation_date": 1467931301, "post_id": 38248626, "comment_id": 63933786, "body": "Thank you all for answers/comments as for now I think that Bakuriu&#39;s explanation is what I wanted to know. However thank you very much for giving me advice on <i>solving</i> that <i>obstacle</i> or suggesting means to deal with such cases in a proper way. As I am mainly interested in the <i>theoretical</i> (or rather <i>design philosophy</i>) reasons I find Bakuriu&#39;s explanation the most accurate for now. Nonetheless, I will wait and maybe someone can give reasons of why such a choice of the syntax of instance declaration have been chosen."}, {"owner": {"reputation": 2652, "user_id": 5445670, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xrwS2.png?s=128&g=1", "display_name": "Solomon Ucko", "link": "https://stackoverflow.com/users/5445670/solomon-ucko"}, "edited": false, "score": 0, "creation_date": 1554646478, "post_id": 38248626, "comment_id": 97819934, "body": "FWIW, you can replace <code>multiplication x y = x ++ y</code> with just <code>multiplication = (++)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1467909534, "post_id": 38248701, "comment_id": 63922787, "body": "+1 for the <code>newtype</code> and Kmett&#39;s advice. The first will require overlapping instances if other instances are needed later on (if they are not, just define <code>multiplication :: Num a =&gt; ...</code> and avoid the magma class). And overlapping instances are best to be avoided."}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1545237332, "post_id": 38248701, "comment_id": 94558839, "body": "I think <code>multiplication x y = Sum $ getSum x + getSum y</code> can also be written <code>multiplication = liftA2 (+)</code>"}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 2, "last_activity_date": 1467904580, "last_edit_date": 1495540354, "creation_date": 1467903219, "answer_id": 38248701, "question_id": 38248626, "link": "https://stackoverflow.com/questions/38248626/type-instances-in-haskell/38248701#38248701", "title": "Type instances in Haskell", "body": "<p>You will need <a href=\"https://prime.haskell.org/wiki/FlexibleInstances\" rel=\"nofollow noreferrer\"><code>FlexibleInstances</code></a> and <a href=\"https://prime.haskell.org/wiki/UndecidableInstances\" rel=\"nofollow noreferrer\"><code>UndecidableInstances</code></a> language extensions:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances, UndecidableInstances #-}\n\nclass Magma a where\n    multiplication :: a -&gt; a -&gt; a\n\ninstance (Num a) =&gt; Magma a where\n    multiplication x y = x + y\n</code></pre>\n\n<p>alternatively, use a new type:</p>\n\n<pre><code>newtype Sum a = Sum { getSum :: a }\n\ninstance (Num a) =&gt; Magma (Sum a) where\n    multiplication x y = Sum $ getSum x + getSum y\n</code></pre>\n\n<p>See <a href=\"https://stackoverflow.com/a/3216937/625914\">Edward Kmett answer why <em>the latter is a better approach.</em></a></p>\n\n<p>Also, note that your Magma type class has a lot in common with <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Monoid.html\" rel=\"nofollow noreferrer\"><code>Data.Monoid</code></a>, in particular your Num instance <em>under addition</em> overlaps with <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/Data.Monoid.html#Sum\" rel=\"nofollow noreferrer\">Monoid instance for <code>Sum</code> type</a>.</p>\n\n<p>You may also define an instance for numeric types under multiplication as in <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/Data.Monoid.html#Product\" rel=\"nofollow noreferrer\">Monoid instance for <code>Product</code> type</a>. </p>\n"}], "owner": {"reputation": 23, "user_id": 6520446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2676969426d369bf3ece554439630866?s=128&d=identicon&r=PG&f=1", "display_name": "ijon", "link": "https://stackoverflow.com/users/6520446/ijon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 625, "favorite_count": 0, "accepted_answer_id": 38248701, "answer_count": 1, "score": 2, "last_activity_date": 1467904580, "creation_date": 1467903025, "last_edit_date": 1467903192, "question_id": 38248626, "link": "https://stackoverflow.com/questions/38248626/type-instances-in-haskell", "title": "Type instances in Haskell", "body": "<p>Recall that in mathematics a magma is a set with a binary operation on it. I am defining a magma typeclass in Haskell:</p>\n\n<pre><code>class Magma a where\n    multiplication :: a -&gt; a -&gt; a\n</code></pre>\n\n<p>Of course lists of any type with concatenation operator form a magma, and indeed the following works in Haskell:</p>\n\n<pre><code>instance Magma [a] where\n    multiplication x y = x ++ y\n</code></pre>\n\n<p>Similarly, real numbers with addition form a magma, but the following instance declaration does not work in Haskell:</p>\n\n<pre><code>instance (Num a) =&gt; Magma a where\n    multiplication x y = x + y\n</code></pre>\n\n<p>Could you please explain me why the first instance declaration works perfectly well, while the second one with a type constraint does not work?\n(I am using ghc.)</p>\n"}, {"tags": ["haskell", "syntax", "ghci", "let"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1467899634, "post_id": 38247253, "comment_id": 63915831, "body": "Please format your code."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1467901858, "post_id": 38247253, "comment_id": 63917620, "body": "The problem is that the parser thinks that the structure of your code is <code>let {nameTag = ... ; putStrLn nameTag}</code> where it expects an assignment instead of <code>putStrLn nameTag</code>."}], "answers": [{"comments": [{"owner": {"reputation": 141, "user_id": 6185125, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/680282768780295/picture?type=large", "display_name": "John Doe", "link": "https://stackoverflow.com/users/6185125/john-doe"}, "edited": false, "score": 0, "creation_date": 1467900675, "post_id": 38247616, "comment_id": 63916678, "body": "Thanks! I tried to use parenthesis, but that didn&#39;t work out. What&#39;s the fundamental difference between curly brackets and parenthesis in Haskell?"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 141, "user_id": 6185125, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/680282768780295/picture?type=large", "display_name": "John Doe", "link": "https://stackoverflow.com/users/6185125/john-doe"}, "edited": false, "score": 1, "creation_date": 1467900948, "post_id": 38247616, "comment_id": 63916903, "body": "@Rafa\u0142P\u0142aszczyk Brackets are for delimiting subexpressions. Curly brackets are for disambiguating language syntax. (Oh, and record syntax...)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 141, "user_id": 6185125, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/680282768780295/picture?type=large", "display_name": "John Doe", "link": "https://stackoverflow.com/users/6185125/john-doe"}, "edited": false, "score": 1, "creation_date": 1467909181, "post_id": 38247616, "comment_id": 63922566, "body": "@Rafa\u0142P\u0142aszczyk You probably noticed that Haskell is indentation-sensitive. Basically, brackets allow one to write everything in one line, writing blocks (<code>do,let,where,case of</code>) at the same indentation level as <code>{entry1;entry2;...}</code>. Usually not needed, except in GHCi. In many cases, only <code>;</code> are enough, and brackets can be omitted."}], "tags": [], "owner": {"reputation": 41648, "user_id": 108359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8a34d29224f05cd8bd1f480c89cf112?s=128&d=identicon&r=PG", "display_name": "Brian McKenna", "link": "https://stackoverflow.com/users/108359/brian-mckenna"}, "is_accepted": true, "score": 5, "last_activity_date": 1467900433, "creation_date": 1467900433, "answer_id": 38247616, "question_id": 38247253, "link": "https://stackoverflow.com/questions/38247253/haskell-using-let-within-a-do-syntax-in-ghci/38247616#38247616", "title": "HASKELL --- Using &quot;let&quot; within a &quot;do&quot; syntax in GHCI", "body": "<p>Yes, you can use braces around the let binding(s) to disambiguate the parsing:</p>\n\n<pre><code>do name &lt;- getLine; let { nameTag = \"Hello, my name is \" ++ name }; putStrLn nameTag\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 5, "last_activity_date": 1467908856, "creation_date": 1467908856, "answer_id": 38250739, "question_id": 38247253, "link": "https://stackoverflow.com/questions/38247253/haskell-using-let-within-a-do-syntax-in-ghci/38250739#38250739", "title": "HASKELL --- Using &quot;let&quot; within a &quot;do&quot; syntax in GHCI", "body": "<p>To complement the answer by McKenna, the error can be explained as follows: compare these two lines</p>\n\n<pre><code>do name &lt;- getLine; let name1 = \"One\"; putStrLn name1\ndo name &lt;- getLine; let name1 = \"One\"; name2 = \"Two\"; putStrLn name1\n</code></pre>\n\n<p>A human reader can see that they actually mean</p>\n\n<pre><code>do { name &lt;- getLine; let { name1 = \"One\" } ; putStrLn name1 }\ndo { name &lt;- getLine; let { name1 = \"One\"; name2 = \"Two\" }; putStrLn name1 }\n</code></pre>\n\n<p>but the parser is not that smart.\nWhen the Haskell parser sees the common code portion</p>\n\n<pre><code>do name &lt;- getLine; let name1 = \"One\";\n                                  -- ^ --\n</code></pre>\n\n<p>it has to decide whether the last <code>;</code> belongs to the <code>do</code> level (as in the first case above), or to the <code>let</code> level (second case). It turns out that it chooses <code>let</code>, and fails later on.</p>\n"}], "owner": {"reputation": 141, "user_id": 6185125, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/680282768780295/picture?type=large", "display_name": "John Doe", "link": "https://stackoverflow.com/users/6185125/john-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 244, "favorite_count": 1, "accepted_answer_id": 38247616, "answer_count": 2, "score": 1, "last_activity_date": 1467908856, "creation_date": 1467899427, "last_edit_date": 1467899690, "question_id": 38247253, "link": "https://stackoverflow.com/questions/38247253/haskell-using-let-within-a-do-syntax-in-ghci", "title": "HASKELL --- Using &quot;let&quot; within a &quot;do&quot; syntax in GHCI", "body": "<p>I know this works:</p>\n\n<pre><code>do name &lt;- getLine; let nameTag = \"Hello, my name is \" ++ name in putStrLn nameTag \n</code></pre>\n\n<p>As well as this piece of code when loaded into GHCI:</p>\n\n<pre><code>hey = do \n    name &lt;- getLine\n    let nameTag = \"Hello, my name is \" ++ name\n    putStrLn nameTag\n</code></pre>\n\n<p>But this does not work:</p>\n\n<pre><code>do name &lt;- getLine; let nameTag = \"Hello, my name is \" ++ name; putStrLn nameTag \n</code></pre>\n\n<p>giving the following error message:</p>\n\n<pre><code>&lt;interactive&gt;:142:82:\n  parse error (possibly incorrect indentation or mismatched brackets)\n</code></pre>\n\n<p>Why doesn't it work? Can I make it work? If yes, then how?</p>\n"}, {"tags": ["scala", "haskell", "monads"], "comments": [{"owner": {"reputation": 185247, "user_id": 135589, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dbd98f264c64096af168747c3ae71a7d?s=128&d=identicon&r=PG", "display_name": "Jesper", "link": "https://stackoverflow.com/users/135589/jesper"}, "edited": false, "score": 2, "creation_date": 1467895372, "post_id": 38245696, "comment_id": 63912625, "body": "What exactly is your question? The idea of a monad and what <code>flatMap</code> does is simple: a monad is a box that holds a value, and you give a function <code>f</code> to <code>flatMap</code> that does something with the value in the box, and you get back another box that contains the result of applying <code>f</code> to the value of the original box."}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 1, "creation_date": 1467895864, "post_id": 38245696, "comment_id": 63912961, "body": "The category is the category of scala types, so <code>Option</code> is an endofunctor on that category."}, {"owner": {"reputation": 5749, "user_id": 3663882, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bdc173d17ed7af94626f5939b7ad5484?s=128&d=identicon&r=PG&f=1", "display_name": "user3663882", "link": "https://stackoverflow.com/users/3663882/user3663882"}, "reply_to_user": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1467896080, "post_id": 38245696, "comment_id": 63913116, "body": "@Lee So it maps each type <code>T</code> to <code>Option[T]</code>?"}, {"owner": {"reputation": 5749, "user_id": 3663882, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bdc173d17ed7af94626f5939b7ad5484?s=128&d=identicon&r=PG&f=1", "display_name": "user3663882", "link": "https://stackoverflow.com/users/3663882/user3663882"}, "reply_to_user": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1467896402, "post_id": 38245696, "comment_id": 63913320, "body": "@Lee Excellent point. A little clarification about map between types. If we say that we have a map between types <code>T1</code> and <code>T2</code> it means that we have a map between all values of <code>T1</code> into some (maybe proper) subset of values of type <code>T2</code>. Correct?"}], "answers": [{"comments": [{"owner": {"reputation": 5749, "user_id": 3663882, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bdc173d17ed7af94626f5939b7ad5484?s=128&d=identicon&r=PG&f=1", "display_name": "user3663882", "link": "https://stackoverflow.com/users/3663882/user3663882"}, "edited": false, "score": 0, "creation_date": 1467898964, "post_id": 38246938, "comment_id": 63915276, "body": "In scala <code>join</code> is <code>flatten</code> (as far as I know)."}, {"owner": {"reputation": 5749, "user_id": 3663882, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bdc173d17ed7af94626f5939b7ad5484?s=128&d=identicon&r=PG&f=1", "display_name": "user3663882", "link": "https://stackoverflow.com/users/3663882/user3663882"}, "edited": false, "score": 0, "creation_date": 1467960703, "post_id": 38246938, "comment_id": 63941188, "body": "Let me ask you one more question. As you said that we have two operations <code>join</code> and <code>unit</code>. In the <a href=\"https://en.wikipedia.org/wiki/Monad_(category_theory)#Formal_definition\" rel=\"nofollow noreferrer\">category monad definition</a> we also have two natural transformations. Is it the same or we can prove that our monad is a &quot;monad&quot; according to the category definition. I didn&#39;t do it myself and don&#39;t want the actual proof (if it&#39;s true). Just want to know if it is."}, {"owner": {"reputation": 16267, "user_id": 1346276, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Tu8Re.jpg?s=128&g=1", "display_name": "phipsgabler", "link": "https://stackoverflow.com/users/1346276/phipsgabler"}, "reply_to_user": {"reputation": 5749, "user_id": 3663882, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bdc173d17ed7af94626f5939b7ad5484?s=128&d=identicon&r=PG&f=1", "display_name": "user3663882", "link": "https://stackoverflow.com/users/3663882/user3663882"}, "edited": false, "score": 1, "creation_date": 1467980953, "post_id": 38246938, "comment_id": 63952752, "body": "@user3663882 Yes, <code>join</code> and <code>unit</code> correspond exactly to mu and eta. Furthermore, the <a href=\"http://eed3si9n.com/learning-scalaz/Monad+laws.html\" rel=\"nofollow noreferrer\">laws do hold for them</a>; associativity corresponds to the diagram with T^3, and left and right identity are, IIRC, equivalent to the other one."}], "tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 4, "last_activity_date": 1467899095, "last_edit_date": 1467899095, "creation_date": 1467898563, "answer_id": 38246938, "question_id": 38245696, "link": "https://stackoverflow.com/questions/38245696/understanding-monads-in-scala/38246938#38246938", "title": "Understanding monads in scala", "body": "<p>The category is the category of scala types, where the objects are types and the arrows are functions between values of those types. <code>Option</code> is an endofunctor on this category. For each object (i.e. type) in the Scala category, the <code>Option</code> type constructor maps each type <code>A</code> into a type <code>Option[A]</code>.</p>\n\n<p>In addition it maps each arrow <code>f: A =&gt; B</code> into an arrow <code>fo: Option[A] =&gt; Option[B]</code> which is what <code>Option.map</code> does.</p>\n\n<p>A Monad is a Functor <code>M</code> along with two operations, <code>unit: A =&gt; M[A]</code> and <code>join: M[M[A]] =&gt; M[A]</code>. For <code>Option</code>, <code>unit(x: A) = Some(x)</code> and <code>join</code> can be defined as:</p>\n\n<pre><code>def join[A](o: Option[Option[A]]): Option[A] = o match {\n  case None =&gt; None\n  case Some(i) =&gt; i\n}\n</code></pre>\n\n<p><code>flatMap</code> can then be defined as, <code>flatMap(f, m) = join(map(f, m))</code>. Alternatively the monad can be defined using <code>unit</code> and <code>flatMap</code> and <code>join</code> defined as <code>join(m) = flatMap(id, m)</code>.</p>\n"}], "owner": {"reputation": 5749, "user_id": 3663882, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bdc173d17ed7af94626f5939b7ad5484?s=128&d=identicon&r=PG&f=1", "display_name": "user3663882", "link": "https://stackoverflow.com/users/3663882/user3663882"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 687, "favorite_count": 2, "accepted_answer_id": 38246938, "answer_count": 1, "score": 1, "last_activity_date": 1467899095, "creation_date": 1467895146, "question_id": 38245696, "link": "https://stackoverflow.com/questions/38245696/understanding-monads-in-scala", "title": "Understanding monads in scala", "body": "<p>I'm trying to understand what monads are (not just in scala, but by example using scala). Let's consider the most (in my opinion) simple example of a monad:</p>\n\n<pre><code>scala.Some\n</code></pre>\n\n<p>As some articles state, every monad in <a href=\"https://en.wikipedia.org/wiki/Monad_(functional_programming)#Monad_laws\" rel=\"nofollow\">its classic sense</a> should preserve some rules for the <code>flatMap</code> and <code>unit</code> functions. </p>\n\n<p>Here is the definition from <code>scala.Some</code></p>\n\n<pre><code>@inline final def flatMap[B](f: A =&gt; Option[B]): Option[B]\n</code></pre>\n\n<p>So, understand it better I want to understand it <a href=\"https://en.wikipedia.org/wiki/Monad_(category_theory)#Introduction\" rel=\"nofollow\">from the category theory standpoint</a>. So, we're considering a monad and it's supposed to be a functor (<strong><em>but between what?</em></strong>).</p>\n\n<p>Here we have to category <code>Option[A]</code> and <code>Option[B]</code> and the <code>flatMap</code> along with the <code>f: A =&gt; Option[B]</code> passed into it is supposed to define a <strong><em>Functor</em></strong> between them. But in the tranditional category definition it's a functor from a category to itself.</p>\n"}, {"tags": ["haskell", "syntax", "gadt"], "answers": [{"tags": [], "owner": {"reputation": 16267, "user_id": 1346276, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Tu8Re.jpg?s=128&g=1", "display_name": "phipsgabler", "link": "https://stackoverflow.com/users/1346276/phipsgabler"}, "is_accepted": true, "score": 13, "last_activity_date": 1467883510, "last_edit_date": 1467883510, "creation_date": 1467883095, "answer_id": 38241721, "question_id": 38241611, "link": "https://stackoverflow.com/questions/38241611/is-it-possible-to-declare-a-constrained-data-type-using-record-syntax/38241721#38241721", "title": "Is it possible to declare a constrained data type using record syntax?", "body": "<p>Yes, but in <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#generalised-algebraic-data-types-gadts\">GADT syntax</a> you always have to explicitly specify the return type of the constructor:</p>\n\n<pre><code>data ConstrainedRecord a where\n  ConstrainedRecord :: Num a =&gt; { first :: a, second :: a } -&gt; ConstrainedRecord a\n</code></pre>\n\n<p>(Also, this may come handy: </p>\n\n<pre><code>deriving instance (Show a) =&gt; Show (ConstrainedRecord a)\n</code></pre>\n\n<p>using <code>StandaloneDeriving</code>, since a normal <code>deriving</code> does not work.)</p>\n"}], "owner": {"reputation": 1281, "user_id": 5600363, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/d820760191b1bb057846d5a06c2bf5b6?s=128&d=identicon&r=PG", "display_name": "hkBst", "link": "https://stackoverflow.com/users/5600363/hkbst"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 564, "favorite_count": 0, "accepted_answer_id": 38241721, "answer_count": 1, "score": 5, "last_activity_date": 1467979804, "creation_date": 1467882779, "last_edit_date": 1467979804, "question_id": 38241611, "link": "https://stackoverflow.com/questions/38241611/is-it-possible-to-declare-a-constrained-data-type-using-record-syntax", "title": "Is it possible to declare a constrained data type using record syntax?", "body": "<p>Is it possible to declare a <a href=\"https://wiki.haskell.org/Data_declaration_with_constraint\" rel=\"nofollow\">constrained data type</a> using <a href=\"https://en.wikibooks.org/wiki/Haskell/More_on_datatypes#Named_Fields_.28Record_Syntax.29\" rel=\"nofollow\">record syntax</a>? My attempt</p>\n\n<pre><code>data ConstrainedRecord a where\n  ConstrainedRecord :: Num a =&gt; { first :: a, second :: a }\n</code></pre>\n\n<p>causes GHC to complain \"Record syntax is illegal here\".</p>\n"}, {"tags": ["php", "sockets", "unix", "haskell", "unix-socket"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1467883098, "post_id": 38238950, "comment_id": 63904413, "body": "I suppose it could be some kind of memory leak that makes it take more and more garbage collector time on each request... Have you tried looking at the runtime statistics output? (<code>+RTS -s</code>)"}, {"owner": {"reputation": 153, "user_id": 5511813, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82fa8bad39b965aa42733fc71d8cbf49?s=128&d=identicon&r=PG&f=1", "display_name": "Snow Sailor", "link": "https://stackoverflow.com/users/5511813/snow-sailor"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1467903575, "post_id": 38238950, "comment_id": 63918925, "body": "@MathematicalOrchid I compiled with RTS on the production server and my own computer. The left is the production server after handling about 4300 requests and the right is my own computer after handling about 500 requests (test DB): <a href=\"http://puu.sh/pTvvQ.png\" rel=\"nofollow noreferrer\">puu.sh/pTvvQ.png</a> At the top of the production shell session, you can see the time the socket was called compared to the time the database was called. It was lagging at the time that I can canceled it, but for about 4 minutes it ran almost perfectly, which hasn&#39;t happened before. For those 4 minutes, if it lagged behind, it would catch up in a few seconds."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1467904207, "post_id": 38238950, "comment_id": 63919373, "body": "OK, so it looks like GC is minuscule in both cases. So that rules that out..."}, {"owner": {"reputation": 153, "user_id": 5511813, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82fa8bad39b965aa42733fc71d8cbf49?s=128&d=identicon&r=PG&f=1", "display_name": "Snow Sailor", "link": "https://stackoverflow.com/users/5511813/snow-sailor"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1467907273, "post_id": 38238950, "comment_id": 63921425, "body": "Yeah it&#39;s really confusing. I am going to try removing GHC entirely and reinstalling it from source. My friend was having issues with GHC on Ubuntu when it used 100% CPU for absolutely no reason one time."}, {"owner": {"reputation": 153, "user_id": 5511813, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82fa8bad39b965aa42733fc71d8cbf49?s=128&d=identicon&r=PG&f=1", "display_name": "Snow Sailor", "link": "https://stackoverflow.com/users/5511813/snow-sailor"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1467910009, "post_id": 38238950, "comment_id": 63923059, "body": "@MathematicalOrchid So I reinstalled GHC and I&#39;m still seeing the same issue. I am led to believe this is a PHP socket problem now. When I turn off the Haskell microservice program and revert it back to doing things purely in PHP, the Haskell program suddenly handles 100 (supposedly) queued requests in 1 second. So that leads me to believe that PHP is limiting the number of connections to a socket for some reason? Or at least doing something evil when a new socket connection is created. Not sure at all."}, {"owner": {"reputation": 1783, "user_id": 4042398, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cea300bb172f4c250bd5532be1cdc448?s=128&d=identicon&r=PG", "display_name": "Slava Bacherikov", "link": "https://stackoverflow.com/users/4042398/slava-bacherikov"}, "edited": false, "score": 0, "creation_date": 1467910150, "post_id": 38238950, "comment_id": 63923152, "body": "You have to close all accepted sockets too, not only main socket or you will reach OS limit for opened descriptors. This is pretty same as TCP sockets. Also note: UNIX sockets could be used in datagram mode (udp like mode) in that case you don&#39;t need to accept new socket from it. For more info refer to <a href=\"http://linux.die.net/man/7/unix\" rel=\"nofollow noreferrer\">man unix</a>"}, {"owner": {"reputation": 153, "user_id": 5511813, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82fa8bad39b965aa42733fc71d8cbf49?s=128&d=identicon&r=PG&f=1", "display_name": "Snow Sailor", "link": "https://stackoverflow.com/users/5511813/snow-sailor"}, "edited": false, "score": 0, "creation_date": 1467911637, "post_id": 38238950, "comment_id": 63924063, "body": "Yes, I close every socket that I accept once I am done with it. The functions that actually deal with the sockets and return data aren&#39;t show in my post because that would add some unnecessary complexity and would go deeper than the problem requires (since the hanging happens before those functions). And I can see about using datagram mode for it at some point. I don&#39;t think that will solve my problem though. It may be that php-fpm is not cleaning up sockets until it garbage collects or something along those lines."}], "owner": {"reputation": 153, "user_id": 5511813, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82fa8bad39b965aa42733fc71d8cbf49?s=128&d=identicon&r=PG&f=1", "display_name": "Snow Sailor", "link": "https://stackoverflow.com/users/5511813/snow-sailor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 180, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1467874957, "creation_date": 1467873599, "last_edit_date": 1467874957, "question_id": 38238950, "link": "https://stackoverflow.com/questions/38238950/haskell-unix-domain-socket-bottleneck-from-php", "title": "Haskell - Unix domain socket bottleneck from PHP?", "body": "<p>I am writing a microservice framework to work alongside a PHP site. I have written it and tested it on my local computer (OSX) and it works very well. It will take data, read it as a ByteString, parse it into Haskell data with Aeson and perform specific actions on that data. I have it communicating over Unix domain sockets.</p>\n\n<p>I tested it on my local system by doing a <code>curl</code> to a localhost php file that communicates with the Haskell program. It was able to send/receive/print information 10,000 times in about 2 minutes.</p>\n\n<p>When I moved this over to the production server and implemented the exact same thing with PHP on that side, some weird things started to happen. The Haskell program runs, however it gets caught somewhere and just seems to hang for an increasing amount of time. First it hangs for 0.1 seconds longer than it should, and it just keeps going up and up. After about a minute of receiving 10+ requests/second the hangtime is almost 8 seconds. I made sure this wasn't the database being slow for whatever reason by comparing the time Haskell was called via the socket to the current time (right before the database call). </p>\n\n<p>Here is my main function:</p>\n\n<pre><code>import Network.Socket\n\nmain :: IO ()\nmain = do\n    removeSocketFile socketName\n    resource &lt;- defaultResources\n    withSocketsDo $ do\n        sock &lt;- socket AF_UNIX Stream 0\n        bind sock $ SockAddrUnix socketName\n        chmodSocket socketName\n        putStrLn $ \"Created socket file at \" ++ socketName\n        listen sock maxListenQueue\n        catch\n            (handleSocket sock resource)\n            (\\e -&gt; do\n                putStrLn $ show (e :: AsyncException)\n                close sock\n                putStrLn \"Closed socket\"\n                removeSocketFile socketName\n            )\n</code></pre>\n\n<p>And this is the code that handles the sockets and everything:</p>\n\n<pre><code>import Network.Socket\nimport Network.Socket.ByteString as NB\nimport Data.ByteString as B\nimport Data.Char as C\n\nhandleSocket :: Socket -&gt; ServerResources -&gt; IO ()\nhandleSocket sock resource = do\n    (conn,_) &lt;- accept sock\n    forkIO $ processConn conn resource\n    handleSocket sock resource\n\nprocessConn :: Socket -&gt; ServerResources -&gt; IO ()\nprocessConn conn resource = do\n    msg &lt;- NB.recv conn 2048\n    unless (B.null msg) $ do\n        let (cmd, payload) = B.break (== (fromIntegral $ C.ord ':')) msg\n        delegate cmd (B.drop 1 payload) conn resource\n        return ()\n</code></pre>\n\n<p>Does anyone see anything wrong here that would cause the program to behave like I described above? The strange thing is that it doesn't break at all when I run it on OSX, but when I put it onto Ubuntu 15.10 things don't go the way they should.</p>\n\n<p>I think it can be isolated to these functions because they are the only ones dealing with any sort of IO aside from the database (which I already concluded was not the problem).</p>\n\n<p>Any help is appreciated. Thanks.</p>\n"}, {"tags": ["haskell", "memory", "runtime"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 3, "last_activity_date": 1467889491, "last_edit_date": 1467889491, "creation_date": 1467872659, "answer_id": 38238731, "question_id": 38238445, "link": "https://stackoverflow.com/questions/38238445/runtime-memory-haskell/38238731#38238731", "title": "Runtime memory Haskell", "body": "<p>You can use the <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/GHC-Stats.html#v:getGCStats\" rel=\"nofollow\">getGCStats</a> function in <code>GHC.Stats</code> to get the amount of memory used as of the last GC (<code>currentBytesUsed</code>).</p>\n\n<p>You might have to compile your program with <code>-rtsopts</code> and run it with <code>+RTS -T</code> to enable the stats.</p>\n"}, {"tags": [], "owner": {"reputation": 3411, "user_id": 69663, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/aiMZN.png?s=128&g=1", "display_name": "unhammer", "link": "https://stackoverflow.com/users/69663/unhammer"}, "is_accepted": false, "score": 1, "last_activity_date": 1573848299, "last_edit_date": 1573848299, "creation_date": 1573476973, "answer_id": 58801819, "question_id": 38238445, "link": "https://stackoverflow.com/questions/38238445/runtime-memory-haskell/58801819#58801819", "title": "Runtime memory Haskell", "body": "<p>Apparantly the API changed a bit in newer GHC's. The following checks first if you've used <code>+RTS -T</code> and then (based on <a href=\"https://ofb.net/~elaforge/karya/hscolour/Util/Memory.html\" rel=\"nofollow noreferrer\">https://ofb.net/~elaforge/karya/hscolour/Util/Memory.html</a> ) uses the correct API based on GHC_VERSION:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE CPP #-}\n\nimport           GHC.Int    (Int64)\nimport qualified GHC.Stats\n\nrtsMemUsage :: IO (Maybe Int64)\nrtsMemUsage = do\n  enabled &lt;- GHC.Stats.getGCStatsEnabled\n  if enabled\n  then\n#if GHC_VERSION &gt;= 80401\n    Just . GHC.Stats.gcdetails_mem_in_use_bytes . GHC.Stats.gc &lt;$&gt; GHC.Stats.getRTSStats\n#else\n    Just . GHC.Stats.currentBytesUsed &lt;$&gt; GHC.Stats.getGCStats\n#endif\n  else return Nothing\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 6559217, "user_type": "registered", "profile_image": "https://graph.facebook.com/1408769699138292/picture?type=large", "display_name": "Dhruv Kumar", "link": "https://stackoverflow.com/users/6559217/dhruv-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1573848299, "creation_date": 1467871186, "last_edit_date": 1467889536, "question_id": 38238445, "link": "https://stackoverflow.com/questions/38238445/runtime-memory-haskell", "title": "Runtime memory Haskell", "body": "<p>I was trying to write a program in Haskell and I wanted to write a function which when called gives me the free memory and the total memory at that instance. I know that in Java I can write something like <code>runtime.getruntime().totalmemory()</code> inside a method. I am fairly new to Haskell and can't figure out how to hard code something like this inside my program.</p>\n"}, {"tags": ["haskell", "memory", "linker", "ghc"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1467872390, "post_id": 38238016, "comment_id": 63898271, "body": "It&#39;s a linker error. Has nothing to do with the pragmas. There is an optimization on this platform where small objects are treated differently from large objects. A table that stores these small objects gets overflown. Google <i>mips GOT truncated</i>. I don&#39;t know how to remedy this. Try adding <code>-optl -G4</code> (or 2 or 1) to the compiler flags. It may or may not help. If it doesn&#39;t you probably should file a bug against ghc."}], "owner": {"reputation": 11, "user_id": 5112163, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SUl9wsGJ7OI/AAAAAAAAAAI/AAAAAAAABkE/E6Qej0zTlos/photo.jpg?sz=128", "display_name": "Jonathan Jackson", "link": "https://stackoverflow.com/users/5112163/jonathan-jackson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 95, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1467907890, "creation_date": 1467868921, "last_edit_date": 1467907890, "question_id": 38238016, "link": "https://stackoverflow.com/questions/38238016/why-does-the-haskell-compiler-returns-relocation-truncation-error-on-mips-mips64", "title": "Why does the Haskell compiler returns relocation truncation error on mips mips64el", "body": "<p>I am working on a package (haskell-src-exts) that could not be built for the mips64el architecture for Debian and the log returned by the autobuilder ends like this:</p>\n\n<pre><code>[24 of 24] Compiling Language.Haskell.Exts (src/Language/Haskell/Exts.hs, dist-ghc/build/Language/Haskell/Exts.p_o )\ndist-ghc/build/Language/Haskell/Exts/Annotated/Syntax.dyn_o: In function `c66jH_entry':\nghc_8.hc:(.text+0x10c): relocation truncated to fit: R_MIPS_GOT_DISP against `stg_ap_0_fast'\n\n[...]\n\nghc_8.hc:(.text+0x884): relocation truncated to fit: R_MIPS_GOT_DISP against `base_GHCziNum_zp_entry'\nghc_8.hc:(.text+0x8e4): additional relocation overflows omitted from the output\ncollect2: error: ld returned 1 exit status\n/usr/share/cdbs/1/class/hlibrary.mk:147: recipe for target 'build-ghc-stamp' failed\nmake: *** [build-ghc-stamp] Error 1\ndpkg-buildpackage: error: debian/rules build-arch gave error exit status 2\n</code></pre>\n\n<p>After searching the web about relocation, and R_MIPS_GOT_DISP it seems to me that the linker is having a problem with the linking. </p>\n\n<p>Strangely enough it seems like a kind of error you would get for incorrectly assigning an address to an object or something. The problem is  I am pretty sure you cannot have that type of control over memory in Haskell, and certainly not over the linker.</p>\n\n<p>As written on Haskell's website: </p>\n\n<blockquote>\n  <p>The LANGUAGE pragma allows language extensions to be enabled in a portable way. It is the intention that all Haskell compilers support the LANGUAGE pragma with the same syntax, although not all extensions are supported by all compilers, of course. The LANGUAGE pragma should be used instead of OPTIONS_GHC, if possible.</p>\n</blockquote>\n\n<p>So this may be a case where a LANGUAGE pragma is used and not supported by the mips GHC compiler. Here is the line from the Syntax.hs file containing one of the pragmas:</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable, DeriveGeneric #-}\n</code></pre>\n\n<p>Note that the package could be built on many other (non-mips) architectures.</p>\n\n<p>If this is all true, I am forced to conclude that there is a problem with the mips64el version of GHC and this is what causes this bug. </p>\n\n<p>Any clues?\nThanks alot</p>\n"}, {"tags": ["haskell", "parallel-processing"], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 0, "last_activity_date": 1467909857, "last_edit_date": 1467909857, "creation_date": 1467869547, "answer_id": 38238125, "question_id": 38236762, "link": "https://stackoverflow.com/questions/38236762/understanding-haskell-parallel-fibonacci-results/38238125#38238125", "title": "Understanding Haskell Parallel Fibonacci Results", "body": "<p>I'm not sure if what follows is the only thing that is affecting the timing, but it definitely plays a big role.</p>\n\n<p><em>With a list, it is inefficient to split the work like this</em></p>\n\n<p>Remember that starting an execution in parallel takes very little work, so the fastest way to start executing something for each element in the list is just to run through them one after another and spark them with <code>rpar</code>. That's what <code>parMap</code> does.</p>\n\n<p>In your case, <code>splitAt</code> is much more work: it needs to traverse half the list, then allocate space for another list. You might as well have sparked the <code>fib</code> execution during this traversal instead.</p>\n\n<p>To see what I mean, try replacing <code>[1..40]</code> with <code>(replicate 1000 35)</code>. This is much more parallelizable: lots of reasonably difficult problems, all the same difficulty. With a 1000 element long list, <code>splitIt</code> runs in over 100 seconds while <code>spark</code> runs in under 1 second. <strong>Your solution ends up spending the vast majority of its time splitting and appending the lists rather than computing anything.</strong></p>\n"}, {"comments": [{"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1467938595, "post_id": 38238128, "comment_id": 63935596, "body": "Thanks for the detailed answer, ErikR. For my own understanding, what would be a reasonable first argument to <code>parMap</code> in <code>parMap rpar  fib</code>?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1467940867, "post_id": 38238128, "comment_id": 63936082, "body": "In general I recommend always using <code>parMap rdeepseq ...</code>"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 3, "last_activity_date": 1467869562, "creation_date": 1467869562, "answer_id": 38238128, "question_id": 38236762, "link": "https://stackoverflow.com/questions/38236762/understanding-haskell-parallel-fibonacci-results/38238128#38238128", "title": "Understanding Haskell Parallel Fibonacci Results", "body": "<p>First note that the work needed to compute <code>fib n</code> is exponential. That means that computing <code>map fib [1..n]</code> takes about the same amount of time as computing <code>fib (n+1)</code>. To see this just print out the time it takes to compute <code>fib n</code> for various values of <code>n</code>:</p>\n\n<pre><code>import System.TimeIt\nimport Control.Monad\n...\nmain = forM_ [1..40] $ \\n -&gt; timeIt $ print (fib n)\n</code></pre>\n\n<p>To compute <code>map fib [1..40]</code> efficiently with two threads you want to equalize the amount of work done by each thread as much as possible. It turns out that one such division of labor which works pretty well is to have one thread compute <code>map fib [1..38]</code> and the other compute <code>[fib 39, fib 40]</code>.</p>\n\n<p>If you create a spark for each <code>fib i</code> computation, the division of labor between the two threads is completely non-deterministic. To equalize the work done by each thread you actually want to carefully craft what the sparks are.</p>\n\n<p>Now look at the number of sparks created in your two programs - 80 for one and 40 for the other. So clearly each <code>fib i</code> is getting sparked which means that in both cases the <code>fib i</code> computations are getting assigned randomly to the two threads.</p>\n\n<p>Here is a way of getting a speedup of about 1.5 with two threads:</p>\n\n<pre><code>import Control.Parallel.Strategies\n\nfib :: Int -&gt; Int\nfib x \n | x &lt;= 1    = 1\n | otherwise = fib (x-1) + fib (x-2)\n\nmain = do\n  let fs = (map fib [1..40]) `using` parListSplitAt 38 rdeepseq rdeepseq\n  print fs\n</code></pre>\n\n<p>If you look at the RTS summary you'll see that it only creates two sparks - one for <code>map fib [1..38]</code> and the other for <code>map fib [39,40]</code>.</p>\n\n<p>About the 80 sparks... if you use <code>parMap rseq</code> instead of <code>parMap rpar</code> the number of sparks created drops down to 40. So clearly <code>parMap rpar</code> is  creating a spark which just creates another spark which is completely redundant. In general I would stick to <code>rdeepseq</code> as an evaluation strategy - it's just simpler, easier to reason about and less error-prone.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1467909857, "creation_date": 1467858756, "last_edit_date": 1467859059, "question_id": 38236762, "link": "https://stackoverflow.com/questions/38236762/understanding-haskell-parallel-fibonacci-results", "title": "Understanding Haskell Parallel Fibonacci Results", "body": "<p>Given:</p>\n\n<pre><code>module Main where\n\nimport Control.Parallel.Strategies\nimport Control.Applicative\n\n--main :: IO ()\n--main = putStrLn . show $ spark [1..40]\n\nmain :: IO ()\nmain = putStrLn . show . runEval $ splitIt [1..40]\n\nfib :: Int -&gt; Int\nfib x \n | x &lt;= 1    = 1\n | otherwise = fib (x-1) + fib (x-2)\n\n\nspark :: [Int] -&gt; [Int]\nspark = parMap rpar  fib \n\nsplitIt :: [Int] -&gt; Eval [Int]\nsplitIt xs = let len = length xs\n                 (as, bs) = splitAt (len `div` 2) xs\n             in\n              do\n                xs &lt;- fibPar as\n                ys &lt;- fibPar bs\n                return $ xs ++ ys\n\nfibPar :: [Int] -&gt; Eval [Int]\nfibPar []     = return []\nfibPar (x:xs) = do\n    a  &lt;- rpar $ fib x\n    as &lt;- fibPar xs\n    return $ a : as\n</code></pre>\n\n<p>I wrote two ways to calculate fibonacci for each element of <code>[1..40]</code>. Taking from <a href=\"http://chimera.labs.oreilly.com/books/1230000000929/ch02.html#sec_par-eval-sudoku2\" rel=\"nofollow\">Parallel and Concurrent Programming in Haskell</a>, I ran fibonacci in parallel two ways:</p>\n\n<p>(1) use <code>parMap</code> on the entire list. (first<code>main</code>)\n (2) cut list in half, splitting up each work with <code>rpar</code> (second <code>main</code>)</p>\n\n<p>From reading the aforementioned text, I would've expected #1 to be faster:</p>\n\n<blockquote>\n  <p>This illustrates an important principle when parallelizing code: Try to avoid partitioning the work into a small, fixed number of chunks.</p>\n</blockquote>\n\n<p>I compiled and ran both (only including 1 <code>main</code>, commenting out the other) via:</p>\n\n<ul>\n<li>compile - <code>ghc -O2 Fib.hs -threaded -rtsopts -eventlog</code></li>\n<li>run - <code>.\\Fib.exe +RTS -N2 -s</code></li>\n</ul>\n\n<p>Here are the results for (1) and (2), respectively:</p>\n\n<p><strong>(1) - use <code>parMap</code></strong></p>\n\n<pre><code> Tot time (elapsed)  Avg pause  Max pause\n  Gen  0         0 colls,     0 par    0.000s   0.000s     0.0000s    0.0000s\n  Gen  1         2 colls,     1 par    0.000s   0.000s     0.0001s    0.0001s\n\n  Parallel GC work balance: 84.39% (serial 0%, perfect 100%)\n\n  TASKS: 4 (1 bound, 3 peak workers (3 total), using -N2)\n\n  SPARKS: 80 (74 converted, 0 overflowed, 0 dud, 0 GC'd, 6 fizzled)\n\n  INIT    time    0.000s  (  0.000s elapsed)\n  MUT     time    8.594s  (  4.331s elapsed)\n  GC      time    0.000s  (  0.000s elapsed)\n  EXIT    time    0.000s  (  0.000s elapsed)\n  Total   time    8.594s  (  4.332s elapsed)\n\n  Alloc rate    12,259 bytes per MUT second\n\n  Productivity 100.0% of total user, 198.4% of total elapsed\n</code></pre>\n\n<p><strong>(2) - split list + use <code>rpar</code> on each half</strong></p>\n\n<pre><code>                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0         0 colls,     0 par    0.000s   0.000s     0.0000s    0.0000s\n  Gen  1         2 colls,     1 par    0.000s   0.000s     0.0002s    0.0003s\n\n  Parallel GC work balance: 12.41% (serial 0%, perfect 100%)\n\n  TASKS: 4 (1 bound, 3 peak workers (3 total), using -N2)\n\n  SPARKS: 40 (10 converted, 0 overflowed, 0 dud, 0 GC'd, 30 fizzled)\n\n  INIT    time    0.000s  (  0.001s elapsed)\n  MUT     time    7.453s  (  3.751s elapsed)\n  GC      time    0.000s  (  0.000s elapsed)\n  EXIT    time    0.000s  (  0.000s elapsed)\n  Total   time    7.453s  (  3.752s elapsed)\n\n  Alloc rate    14,398 bytes per MUT second\n\n  Productivity 100.0% of total user, 198.6% of total elapsed\n</code></pre>\n\n<p>Why wasn't, as I understand the text to hint at, the <code>parMap</code> version faster than the split up + <code>rpar</code> version?</p>\n"}, {"tags": ["haskell", "authentication", "yesod"], "comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 3, "creation_date": 1467860729, "post_id": 38236289, "comment_id": 63895298, "body": "Are you looking for <code>AuthR</code> <a href=\"https://www.stackage.org/haddock/lts-6.6/yesod-auth-1.4.13.3/src/Yesod-Auth-GoogleEmail2.html#forwardUrl\" rel=\"nofollow noreferrer\"><code>forwardUrl</code></a>?"}, {"owner": {"reputation": 237, "user_id": 3776949, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/be6672e55870194da81b207a1595fbac?s=128&d=identicon&r=PG&f=1", "display_name": "user3776949", "link": "https://stackoverflow.com/users/3776949/user3776949"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 2, "creation_date": 1467862156, "post_id": 38236289, "comment_id": 63895547, "body": "Yes, that&#39;s it.  For reference, I found the exact answer at <a href=\"http://stackoverflow.com/questions/21094784/point-authroute-directly-to-google-auth/21098838#21098838\">this earlier question</a> you answered."}, {"owner": {"reputation": 8576, "user_id": 327074, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/785321440230453d4a2a721f753bd538?s=128&d=identicon&r=PG", "display_name": "icc97", "link": "https://stackoverflow.com/users/327074/icc97"}, "edited": false, "score": 0, "creation_date": 1528188698, "post_id": 38236289, "comment_id": 88401108, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/21094784/point-authroute-directly-to-google-auth\">Point authRoute directly to google auth</a>"}], "owner": {"reputation": 237, "user_id": 3776949, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/be6672e55870194da81b207a1595fbac?s=128&d=identicon&r=PG&f=1", "display_name": "user3776949", "link": "https://stackoverflow.com/users/3776949/user3776949"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 96, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1467854585, "creation_date": 1467854585, "question_id": 38236289, "link": "https://stackoverflow.com/questions/38236289/using-yesods-googleemail2-auth-without-redirect-page", "title": "Using Yesod&#39;s GoogleEmail2 auth without redirect page", "body": "<p>I have a project that uses Yesod with the module Yesod.Auth.GoogleEmail2.  In my hamlet file I have <code>{AuthR LoginR}</code> which generates the Login button.  When that button is clicked, it redirects me to /auth/login, which is a bare page that has a link that says \"Login with Google\".  That link takes me to /auth/page/googleemail2/forward, and then I can log in to Google and everything works great.</p>\n\n<p>I'd like to remove the intermediate page /auth/login, so the user clicks the Login button and is taken directly to the Google login.  Does anyone know how to do that?</p>\n"}]