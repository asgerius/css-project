[{"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 5, "creation_date": 1472680174, "post_id": 39259502, "comment_id": 65855083, "body": "<code>Int</code> is a bounded size type.  Ghci is defaulting to unbound <code>Interger</code>s."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1472680630, "post_id": 39259502, "comment_id": 65855245, "body": "Some style advice: <b>1.</b> <code>return ()</code> is usually unnecessary <b>2.</b> most Haskellers have a slight preference for <code>print $ fact m</code> over <code>print (fact m)</code> <b>3.</b> you should always write type signatures for your top-level definitions."}, {"owner": {"reputation": 5417, "user_id": 987187, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EASnN.jpg?s=128&g=1", "display_name": "joel76", "link": "https://stackoverflow.com/users/987187/joel76"}, "edited": false, "score": 0, "creation_date": 1472681476, "post_id": 39259502, "comment_id": 65855556, "body": "Ok, Thank you for these advices"}, {"owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "edited": false, "score": 1, "creation_date": 1472716559, "post_id": 39259502, "comment_id": 65866424, "body": "Another style advice in addition to leftaroundabout&#39;s comment: maybe <code>m &lt;- readLn :: IO Int</code> would be better in your situation, rather than <code>input_line &lt;- getLine; let m = read input_line :: Int</code>. I personaly would have written <code>main = print . fact =&lt;&lt; (readLn :: IO Integer)</code>."}, {"owner": {"reputation": 5417, "user_id": 987187, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EASnN.jpg?s=128&g=1", "display_name": "joel76", "link": "https://stackoverflow.com/users/987187/joel76"}, "reply_to_user": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "edited": false, "score": 0, "creation_date": 1472734801, "post_id": 39259502, "comment_id": 65878942, "body": "@baxbaxwalanuksiwe : you have a level in Haskell that I don&#39;t have, I was sure that there exists a better to way to write the first 2 lines of main but I didn&#39;t find it. Thanks."}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1472680539, "post_id": 39259587, "comment_id": 65855209, "body": "If you left out any type annotation in <code>main</code>, you&#39;d get <code>Integer</code> by the same defaulting rules."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1472681160, "post_id": 39259587, "comment_id": 65855423, "body": "@Alec Right, I&#39;ve added that."}, {"owner": {"reputation": 5417, "user_id": 987187, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EASnN.jpg?s=128&g=1", "display_name": "joel76", "link": "https://stackoverflow.com/users/987187/joel76"}, "edited": false, "score": 0, "creation_date": 1472681408, "post_id": 39259587, "comment_id": 65855517, "body": "Thank you very much. I begin to understand the integers in Haskell. I tried Int64 with the same result. I thought Int64 would be enough big..."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 5417, "user_id": 987187, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EASnN.jpg?s=128&g=1", "display_name": "joel76", "link": "https://stackoverflow.com/users/987187/joel76"}, "edited": false, "score": 0, "creation_date": 1472682318, "post_id": 39259587, "comment_id": 65855857, "body": "@joel76 The biggest positive int64 has 63 digits in base 2, which are all 1, plus the sign bit. 450! has 14488 digits in base 10 - more than that in base 2. So even a 128 bit number wouldn&#39;t come close to being able to represent 450!."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 5417, "user_id": 987187, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EASnN.jpg?s=128&g=1", "display_name": "joel76", "link": "https://stackoverflow.com/users/987187/joel76"}, "edited": false, "score": 0, "creation_date": 1472684379, "post_id": 39259587, "comment_id": 65856481, "body": "@joel76 the factorial grows just stupendously fast, which is one reason why it&#39;s almost never actually used in practice. In most application where one might be tempted to use factorials, you really want the binomial-coefficient function (which can be implemented with factorials, but much more efficiently without). In other applications, it makes sense to apply the Stirling approximation (in floating-point)."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 7, "last_activity_date": 1472681138, "last_edit_date": 1472681138, "creation_date": 1472680416, "answer_id": 39259587, "question_id": 39259502, "link": "https://stackoverflow.com/questions/39259502/printing-very-big-numbers/39259587#39259587", "title": "Printing very big numbers", "body": "<p>The type of <code>fact</code> is <code>Num a =&gt; a -&gt; a</code>. In your <code>main</code>, you're applying it to <code>m</code>, which you declared to be an <code>Int</code>. So the result of <code>fact</code> will be an <code>Int</code> and all calculations in between will be done using <code>Int</code>s. <code>Int</code>s are fixed-width integers and can't represent numbers that big, causing an overflow and thus wrong results.</p>\n\n<p>On your second try, you're applying <code>fact</code> to <code>4500</code> without specifying which type you want <code>4500</code> to be. In cases like that, Haskell uses the default number type, which is <code>Integer</code>. Unlike <code>Int</code>, <code>Integer</code> can represent integers of any size, so the code just works.</p>\n\n<p>If you did <code>fact 4500 :: Int</code>, you'd get the same wrong result as the first time. Similarly if you use <code>:: Integer</code> in your <code>main</code> instead of <code>Int</code> (or leave it off, so the default is used again\u00b9), you'll get the correct result.</p>\n\n<hr>\n\n<p>\u00b9 Do note that this would produce a warning though. Explicitly annotating the type instead of relying on defaulting rules is usually preferable outside of GHCi or small test programs.</p>\n"}], "owner": {"reputation": 5417, "user_id": 987187, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EASnN.jpg?s=128&g=1", "display_name": "joel76", "link": "https://stackoverflow.com/users/987187/joel76"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "accepted_answer_id": 39259587, "answer_count": 1, "score": 0, "last_activity_date": 1472681138, "creation_date": 1472679963, "question_id": 39259502, "link": "https://stackoverflow.com/questions/39259502/printing-very-big-numbers", "title": "Printing very big numbers", "body": "<p>I begin to learn Haskell and I don't understand what happens : I have a very simple code :</p>\n\n<pre><code>import System.IO\nimport Control.Monad\n\nfact n = product [1..n]\n\nmain :: IO ()\nmain = do\n    input_line &lt;- getLine\n    let m = read input_line :: Int\n    print (fact m)\n    return ()\n</code></pre>\n\n<p>In ghci, when I try</p>\n\n<pre><code>*Main&gt; :load \"fact.hs\"\n[1 of 1] Compiling Main             ( fact.hs, interpreted )\nOk, modules loaded: Main.\n*Main&gt; main\n4500\n0\n</code></pre>\n\n<p>but </p>\n\n<pre><code>*Main&gt; fact 4500\n2274299510944531831673.....\n</code></pre>\n\n<p>What am I missing ?\nThank you for any explanation.</p>\n"}, {"tags": ["haskell", "testing", "yesod"], "comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 2, "creation_date": 1472710680, "post_id": 39259340, "comment_id": 65863151, "body": "Is the error happening with your withStripeExpecting block or withApp initialisation ? I would suggest to modify the withApp function (which is scaffolded)"}], "answers": [{"tags": [], "owner": {"reputation": 681, "user_id": 1072240, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1ef5bf598c44bbfa8b87fd77ccf2a993?s=128&d=identicon&r=PG", "display_name": "Jason Whittle", "link": "https://stackoverflow.com/users/1072240/jason-whittle"}, "is_accepted": true, "score": 1, "last_activity_date": 1473192698, "last_edit_date": 1592644375, "creation_date": 1473192698, "answer_id": 39357087, "question_id": 39259340, "link": "https://stackoverflow.com/questions/39259340/how-do-i-modify-my-yesod-app-during-a-test/39357087#39357087", "title": "How do I modify my Yesod app during a test?", "body": "<p>I posted a reference to this question on the Google Group for Yesod, and received <a href=\"https://groups.google.com/d/msg/yesodweb/s8Azk8_8S8A/zAVvgl6-CAAJ\" rel=\"nofollow noreferrer\">this response</a> from Michael Snoyman, the originator of Yesod:</p>\n<blockquote>\n<p>IIUC, you just need to override the field at a different spot in the code. Using the scaffolded site as an example, I'd override here:</p>\n<p><a href=\"https://github.com/yesodweb/yesod-scaffold/blob/68ec6af22248de6c2a00e63624c34350846557cf/test/TestImport.hs#L35\" rel=\"nofollow noreferrer\">https://github.com/yesodweb/yesod-scaffold/blob/68ec6af22248de6c2a00e63624c34350846557cf/test/TestImport.hs#L35</a></p>\n</blockquote>\n<p>Following that advice necessitated some rework to the <code>Yesod.Test</code> module to thread control of the mocks through to the test case. Those changes have been captured in <a href=\"https://github.com/yesodweb/yesod/pull/1274\" rel=\"nofollow noreferrer\">Pull Request #1274</a> to the yesod repo on GitHub.</p>\n<p>With the modified version of yesod-test in place, I was able to replace the line noted by Michael Snoyman with the following three lines:</p>\n<pre><code>mocks &lt;- newEmptyMVar\nlet foundation' = foundation { appStripe = mockStripe mocks }\nreturn (foundation', logWare, mocks)\n</code></pre>\n<p>I also added the following supporting definitions to the <code>TestImport</code> module:</p>\n<pre><code>data StripeMock = forall a. Typeable (StripeReturn a)\n               =&gt; StripeMock\n                { stripeReq :: StripeRequest a\n                , stripeRet :: Either StripeError (StripeReturn a)\n                }\n\ntype Mocks = MVar StripeMock\n\ntype Yex = YesodExample App Mocks\n\nmockStripe :: (Typeable (StripeReturn b))\n           =&gt; Mocks\n           -&gt; StripeConfig\n           -&gt; StripeRequest b\n           -&gt; IO (Either StripeError (StripeReturn b))\nmockStripe mocks _ _actualReq = do\n  (StripeMock _expectedReq res) &lt;- takeMVar mocks\n  -- assert actualReq matches expectedReq (in IO???)\n  return $ case cast res of\n            Just a -&gt; a\n            Nothing -&gt; error &quot;Stripe return types don\u2019t match in mock.&quot;\n\nstripeExpects :: (FromJSON (StripeReturn a), Typeable (StripeReturn a))\n              =&gt; StripeRequest a\n              -&gt; Either StripeError (StripeReturn a)\n              -&gt; Yex ()\nstripeExpects expectedReq res = do\n  mocks &lt;- getMocks\n  putMVar mocks $ StripeMock expectedReq res\n</code></pre>\n<p>The <code>stripeExpects</code> helper function replaces <code>withStripeExpecting</code>, and doesn\u2019t wrap the request the way <code>withStripeExpecting</code> did.</p>\n<p>As indicated in the pull request, I\u2019m trying to get this capacity included in the yesod-test package. If I get traction on that, I\u2019ll update this answer.</p>\n"}], "owner": {"reputation": 681, "user_id": 1072240, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1ef5bf598c44bbfa8b87fd77ccf2a993?s=128&d=identicon&r=PG", "display_name": "Jason Whittle", "link": "https://stackoverflow.com/users/1072240/jason-whittle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 0, "accepted_answer_id": 39357087, "answer_count": 1, "score": 0, "last_activity_date": 1473192698, "creation_date": 1472679160, "last_edit_date": 1472684979, "question_id": 39259340, "link": "https://stackoverflow.com/questions/39259340/how-do-i-modify-my-yesod-app-during-a-test", "title": "How do I modify my Yesod app during a test?", "body": "<p>I have a Yesod app with the type: </p>\n\n<pre><code>data App = App\n    { appSettings    :: AppSettings\n    , appStatic      :: Static\n    , appConnPool    :: ConnectionPool\n    , appHttpManager :: Manager\n    , appLogger      :: Logger\n    , appStripe      :: forall a. ((FromJSON (StripeReturn a)), Typeable (StripeReturn a))\n                     =&gt; StripeConfig\n                     -&gt; StripeRequest a\n                     -&gt; IO (Either StripeError (StripeReturn a))\n    }\n</code></pre>\n\n<p>and a helper function</p>\n\n<pre><code>stripe :: (FromJSON (StripeReturn a), Typeable (StripeReturn a))\n       =&gt; StripeRequest a\n       -&gt; Handler (Either StripeError (StripeReturn a))\nstripe req = do\n  f &lt;- appStripe &lt;$&gt; getYesod\n  c &lt;- appStripeConfig . appSettings &lt;$&gt; getYesod\n  liftIO $ f c req\n</code></pre>\n\n<p>that is used in several handlers. (The <code>appStripe</code> field of the <code>App</code> is never referenced directly in any handlers.) In <code>makeFoundation</code>, everything is as scaffolded, except that the <code>appStripe</code> field is filled in with <code>Web.Stripe.stripe</code> from the <code>stripe-haskell</code> library. </p>\n\n<p>In my tests, I would like to be able to mock the calls to Stripe, so I have the following function: </p>\n\n<pre><code>withStripeExpecting :: (FromJSON (StripeReturn a), Typeable (StripeReturn a))\n                    =&gt; StripeRequest a\n                    -&gt; Either StripeError (StripeReturn a)\n                    -&gt; YesodExample App ()\n                    -&gt; YesodExample App ()\nwithStripeExpecting _expectedReq res = withStateT $ \\yed -&gt; yed {yedSite = f (yedSite yed)}\n  where f app = app {appStripe = mock}\n        mock :: Typeable (StripeReturn b)\n             =&gt; StripeConfig\n             -&gt; StripeRequest b\n             -&gt; IO (Either StripeError (StripeReturn b))\n        mock _ _actualReq = do\n          -- assert actualReq matches expectedReq (in IO???)\n          return $ case cast res of\n                    Just a -&gt; a\n                    Nothing -&gt; error \"Stripe return types don\u2019t match in mock.\"\n</code></pre>\n\n<p>which I use in test cases like: </p>\n\n<pre><code>spec :: Spec\nspec = withApp $ do\n  describe \"create\" $ do\n    it \"returns a 201\" $ do\n      -- a bunch of set-up elided\n      withStripeExpecting stripeReq (Right stripeRes) $ do\n        requestWithSubject \"auth0|fake\" $ do\n          setMethod \"POST\"\n          setUrl $ SubscriptionPlansR walletId\n          setRequestBody encoded\n          addRequestHeader (H.hContentType, \"application/json\")\n        statusIs 201\n</code></pre>\n\n<p>which compiles and runs, but throws an error <code>StripeError {errorType = InvalidRequest, errorMsg = \"Invalid API Key provided: \", errorCode = Nothing, errorParam = Nothing, errorHTTP = Just UnAuthorized}</code> suggesting that it is running the real stripe IO action instead of the mock. </p>\n\n<p>How do I change a field of the <code>App</code> during a test so that it will be used by the handler under test? </p>\n"}, {"tags": ["haskell", "gloss"], "answers": [{"tags": [], "owner": {"reputation": 151, "user_id": 5872882, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fc8fcfe6e5954b67ec74d3408e807c45?s=128&d=identicon&r=PG&f=1", "display_name": "Max K", "link": "https://stackoverflow.com/users/5872882/max-k"}, "is_accepted": false, "score": 1, "last_activity_date": 1472672091, "creation_date": 1472672091, "answer_id": 39257662, "question_id": 39257213, "link": "https://stackoverflow.com/questions/39257213/give-more-information-to-the-simulate-function-haskell-gloss-library/39257662#39257662", "title": "Give more &quot;information&quot; to the simulate function (Haskell / Gloss Library)", "body": "<p>The key is to pass start information is to pass them over the initalState function. </p>\n\n<pre><code>startGUI :: Float -&gt; IO ()\nstartGUI si  = simulate window background fps (initialState si) render  update\n</code></pre>\n\n<p>Then you just have to configure your dataSet for the game.</p>\n"}], "owner": {"reputation": 151, "user_id": 5872882, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fc8fcfe6e5954b67ec74d3408e807c45?s=128&d=identicon&r=PG&f=1", "display_name": "Max K", "link": "https://stackoverflow.com/users/5872882/max-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1472672091, "creation_date": 1472670318, "question_id": 39257213, "link": "https://stackoverflow.com/questions/39257213/give-more-information-to-the-simulate-function-haskell-gloss-library", "title": "Give more &quot;information&quot; to the simulate function (Haskell / Gloss Library)", "body": "<p>At the beginning of the program, the user can give the simulation some \"information\": </p>\n\n<pre><code>    main:: IO()\n        main = do\n        putStrLn(\"Hallo\")\n        val &lt;- getLine\n        startGUI(read val ::Float)\n</code></pre>\n\n<p>The function (startGUI) :</p>\n\n<pre><code>startGUI :: Float -&gt; IO ()\nstartGUI si  = simulate window background fps initialState render $ moveBall si\n</code></pre>\n\n<p>Starts a function, which is some kind of a loop for the simulation. It basically updates the game. </p>\n\n<p>The moveBall function is defined like:</p>\n\n<pre><code>moveBall :: Float -&gt; Float -&gt; PongGame -&gt; PongGame\nmoveBall seconds go game = game { ballLoc = (x', y') }\n...\n</code></pre>\n\n<p>The error message, which I get is: </p>\n\n<pre><code>Couldn't match type \u2018PongGame\u2019 with \u2018PongGame -&gt; PongGame\u2019\n    Expected type: ViewPort -&gt; Float -&gt; PongGame -&gt; PongGame\n      Actual type: Float -&gt; PongGame -&gt; PongGame\n    Possible cause: \u2018moveBall\u2019 is applied to too many arguments\n    In the second argument of \u2018($)\u2019, namely \u2018moveBall si\u2019\n    In the expression:\n      simulate window background fps initialState render $ moveBall si\n</code></pre>\n\n<p>it refers to the startGUI function. </p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1472667779, "post_id": 39256410, "comment_id": 65848827, "body": "<code>iterate f x = x : iterate f (f x)</code> by your own suggestion."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1472668186, "post_id": 39256410, "comment_id": 65849047, "body": "That&#39;s what the Haskell report says: <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch20.html#x28-22800020\" rel=\"nofollow noreferrer\">haskell.org/onlinereport/haskell2010/&hellip;</a>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 6, "creation_date": 1472668916, "post_id": 39256410, "comment_id": 65849447, "body": "Conventionally, <code>f^0 = id</code>."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1472671936, "post_id": 39256410, "comment_id": 65851203, "body": "Can you give examples of use cases where you want to drop the argument? Most examples I can think of, you&#39;d want to keep it."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 15, "last_activity_date": 1472669395, "creation_date": 1472669395, "answer_id": 39256956, "question_id": 39256410, "link": "https://stackoverflow.com/questions/39256410/is-there-a-reason-for-iterate-to-start-with-original-element/39256956#39256956", "title": "Is there a reason for `iterate` to start with original element?", "body": "<p>When talking about iterated function application, it is convenient to define <code>f^0 == id</code>, so that identities like <code>f^m(f^n(x)) == f^(m+n)(x)</code> hold\nfor all natural numbers <code>m</code> and <code>n</code>.</p>\n\n<p>With that definition in mind, <code>iterate</code> satisfies the following identity by including the argument first:</p>\n\n<pre><code>iterate f x !! n == f^n x\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1472674810, "post_id": 39257975, "comment_id": 65852666, "body": "The OP isn&#39;t asking if it is safe to drop the first element of the return value; he&#39;s asking why <code>iterate f x</code> includes <code>x</code> as the first value in the first place."}, {"owner": {"reputation": 1679, "user_id": 1722752, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef35ad86b627ba3176b6aea8a184f51c?s=128&d=identicon&r=PG", "display_name": "MigMit", "link": "https://stackoverflow.com/users/1722752/migmit"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1472705715, "post_id": 39257975, "comment_id": 65861318, "body": "And that&#39;s exactly what I am answering."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1492281000, "post_id": 39257975, "comment_id": 73917341, "body": "Of course, this argument could be made to include the input of every function in its output.  <code>map :: (a -&gt; b) -&gt; [a] -&gt; ([a], [b])</code>"}], "tags": [], "owner": {"reputation": 1679, "user_id": 1722752, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef35ad86b627ba3176b6aea8a184f51c?s=128&d=identicon&r=PG", "display_name": "MigMit", "link": "https://stackoverflow.com/users/1722752/migmit"}, "is_accepted": false, "score": 1, "last_activity_date": 1472673365, "creation_date": 1472673365, "answer_id": 39257975, "question_id": 39256410, "link": "https://stackoverflow.com/questions/39256410/is-there-a-reason-for-iterate-to-start-with-original-element/39257975#39257975", "title": "Is there a reason for `iterate` to start with original element?", "body": "<p>If you only have an output of <code>iterate f x</code>, you can easily get that thing you want. But if you only have <code>[f x, f (f x),...]</code>, then you can't get <code>iterate f x</code>, you need to know more \u2014 like, know original <code>x</code>. So, dropping <code>x</code> in front means losing information for no good reason.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1472673365, "creation_date": 1472667334, "question_id": 39256410, "link": "https://stackoverflow.com/questions/39256410/is-there-a-reason-for-iterate-to-start-with-original-element", "title": "Is there a reason for `iterate` to start with original element?", "body": "<p>I sometimes use <a href=\"https://www.stackage.org/haddock/lts-6.14/base-4.8.2.0/src/GHC-List.html#iterate\" rel=\"nofollow\">iterate</a> but I rarely need the \nargument in the resulting list. </p>\n\n<p>From the documentation:</p>\n\n<pre><code>iterate f x == [x, f x, f (f x), ...]\n</code></pre>\n\n<p>Although I can <code>drop 1</code> it, I wonder whether there exists a good reason (maybe a free theorem) independent from implementation for designing basic functions like this one.</p>\n"}, {"tags": ["haskell", "happstack"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1472666221, "post_id": 39255271, "comment_id": 65848024, "body": "Why does it matter? Just from the type of <code>map</code>, we know <code>dir</code> can&#39;t behave differently depending on what order it is fed arguments. This is not just a rhetorical question: I suspect if you say why you think it matters, you will reveal some confusion about Haskell that we can help clear up for you."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1472675814, "post_id": 39255271, "comment_id": 65853158, "body": "<code>routes</code> is not a function; it&#39;s a list."}, {"owner": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1472709831, "post_id": 39255271, "comment_id": 65862790, "body": "Thanks @dfeuer for mentioning that. I already corrected this in the question."}, {"owner": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1472716004, "post_id": 39255271, "comment_id": 65866080, "body": "And to answer @DanielWagner&#39;s question, I am confused because in haskell <code>$</code> has the lowest precedence. In this case, since first <code>redirectUrlGraphEmail</code> will be fed into <code>seeOther</code> as an argument, what will happen next is to return the value as <code>b</code> or is to apply <code>$</code> on <code>toResponse &quot;&quot;</code> ?"}], "answers": [{"comments": [{"owner": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "edited": false, "score": 0, "creation_date": 1472716102, "post_id": 39255340, "comment_id": 65866138, "body": "I understand what you said, but isn&#39;t <code>$</code> has the lowest precedence in haskell which makes <code>seeOther</code> to call <code>redirectUrlGraphEmail</code> first?"}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "edited": false, "score": 0, "creation_date": 1472725171, "post_id": 39255340, "comment_id": 65872170, "body": "<code>$</code> has the lowest precedence compared to other infix operators. That whole bit on the right of the comma only contains a single infix operator, so it will be &quot;bundled up&quot; and labeled as <code>b</code> in the mapping function."}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": false, "score": 2, "last_activity_date": 1472664361, "last_edit_date": 1472664361, "creation_date": 1472663437, "answer_id": 39255340, "question_id": 39255271, "link": "https://stackoverflow.com/questions/39255271/the-order-of-functions-execution-in-a-high-order-function/39255340#39255340", "title": "The order of functions&#39; execution in a high order function", "body": "<p>Tuples items are separated by <code>,</code> which means that in your example for <code>graph-fb</code>,</p>\n\n<pre><code>a == \"graph-fb\"\nb == seeOther redirectUrlGraphEmail $ toResponse \"\"\n</code></pre>\n\n<p>The first function call to resolve will be <code>toResponse \"\"</code>, and that will be fed into <code>seeOther</code> as the second parameter. The result of this will then have the label <code>b</code> inside the mapping function.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 0, "last_activity_date": 1472710247, "creation_date": 1472710247, "answer_id": 39263857, "question_id": 39255271, "link": "https://stackoverflow.com/questions/39255271/the-order-of-functions-execution-in-a-high-order-function/39263857#39263857", "title": "The order of functions&#39; execution in a high order function", "body": "<p>There's no way to tell from that code. Even ignoring the compiler's freedom to reorganize your program in various dramatic ways, the usual approach to Haskell evaluation is lazy, which you can think of as demand-driven, <code>case</code>-driven, and (ultimately) I/O-driven. Whoever actually inspects the results determines the evaluation order.</p>\n"}], "owner": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1472710247, "creation_date": 1472663132, "last_edit_date": 1472709754, "question_id": 39255271, "link": "https://stackoverflow.com/questions/39255271/the-order-of-functions-execution-in-a-high-order-function", "title": "The order of functions&#39; execution in a high order function", "body": "<p>I have a function here </p>\n\n<pre><code>(map (\\ (a, b) -&gt; dir a b) $ routes \n</code></pre>\n\n<p>where <code>routes</code> is a list of tuples and it contains</p>\n\n<pre><code>routes = [...\n           (\"graph-fb\", seeOther redirectUrlGraphEmail $ toResponse \"\"),\n           (\"post-fb\", seeOther redirectUrlGraphPost $ toResponse \"\"),\n          ...]\n</code></pre>\n\n<p>Here is the question: when I call this function to apply dir on each tuple, which function is going to be returned as <code>b</code> in <code>dir a b</code> first, the function <code>seeOther redirectUrlGraphEmail</code> or <code>seeOther redirectUrlGraphEmail $ toResponse \"\"</code>?</p>\n"}, {"tags": ["haskell", "types", "constants"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1472655749, "post_id": 39253003, "comment_id": 65841906, "body": "What&#39;s wrong with <code>value = unsafePerformIO $ entryGetText myTextEntry</code>? (Aside from the fact that <code>unsafePerformIO</code> isn&#39;t supposed to depend on its environment.)"}, {"owner": {"reputation": 12902, "user_id": 207716, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c5db2fd504687aeda73c3561a83b43ac?s=128&d=identicon&r=PG", "display_name": "jk.", "link": "https://stackoverflow.com/users/207716/jk"}, "edited": false, "score": 0, "creation_date": 1472655907, "post_id": 39253003, "comment_id": 65842023, "body": "why are we using unsafePerformIO?"}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 6, "creation_date": 1472656156, "post_id": 39253003, "comment_id": 65842200, "body": "You&#39;re attempting to code impurely in a theoretically pure language. This will be an uphill battle."}], "answers": [{"comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 4, "creation_date": 1472662945, "post_id": 39253187, "comment_id": 65846170, "body": "Just since it&#39;s been mentioned twice in answers, I wanted to mention that passing arguments to a function is a perfectly clean and idiomatic way to do this (IMHO <code>Reader</code> seldom pulls its weight as an abstraction)"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1472666157, "post_id": 39253187, "comment_id": 65847984, "body": "You don&#39;t need the <code>:: Double</code> annotation on <code>read</code> here. Since its result is being passed to the <code>Information</code> constructor, the compiler knows the result must be <code>Double</code>."}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 7, "last_activity_date": 1472656053, "creation_date": 1472656053, "answer_id": 39253187, "question_id": 39253003, "link": "https://stackoverflow.com/questions/39253003/constants-in-haskell-after-start-of-the-program/39253187#39253187", "title": "&quot;Constants &quot; in Haskell after start of the program", "body": "<p><a href=\"https://wiki.haskell.org/IO_inside#unsafePerformIO\"><code>unsafePerformIO</code> should be avoided at all costs</a>, as its execution is unpredictable.</p>\n\n<p>Haskell is a pure language and values are immutable, so you won't be able to \"save\" a value that will show as mutated elsewhere.</p>\n\n<p>Instead, you'll need to read the value in and pass it around as needed.</p>\n\n\n\n<pre class=\"lang-haskell prettyprint-override\"><code>main = do  \n    putStrLn \"Enter the default massSaved value\"  \n    val &lt;- getLine\n    doThingsWithDefaultSimuInfo (Information (read val :: Double))\n\ndoThingsWithDefaultSimuInfo :: SimuInfo -&gt; IO ()\ndoThingsWithDefaultSimuInfo si = do\n    ...\n</code></pre>\n\n<p>(There are cleaner and more idiomatic ways to do this with Readers but I'm trying to keep this answer aimed at beginner-level)</p>\n"}, {"tags": [], "owner": {"reputation": 8344, "user_id": 166732, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/900f7c152ac710109cc9a258aa6d4859?s=128&d=identicon&r=PG", "display_name": "asm", "link": "https://stackoverflow.com/users/166732/asm"}, "is_accepted": false, "score": 0, "last_activity_date": 1472656167, "creation_date": 1472656167, "answer_id": 39253228, "question_id": 39253003, "link": "https://stackoverflow.com/questions/39253003/constants-in-haskell-after-start-of-the-program/39253228#39253228", "title": "&quot;Constants &quot; in Haskell after start of the program", "body": "<p>Values that are input from the user are not really constants.  I think the usual way to handle this kind of configuration input is with a reader Monad.</p>\n\n<pre><code>import Control.Monad.Reader\n\n-- type of our context, one double value.\n-- This is not really necessary, you could just use Double everywhere\n-- I use C.\nnewtype C = C Double\n  deriving (Show, Eq)\n\nmain :: IO ()\nmain = do\n  -- Read a double from the user.\n  c &lt;- getLine &gt;&gt;= return . read :: IO Double\n  -- Run the computation, given a context/configuration with\n  -- the user input.\n  print  $ runReader foo (C c)\n\n-- Computation dependent on our context.\nfoo :: Reader C Double\nfoo = do\n  C x &lt;- ask -- Get the value of our context.\n  return $ x + 10 --  and use it\n</code></pre>\n"}], "owner": {"reputation": 151, "user_id": 5872882, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fc8fcfe6e5954b67ec74d3408e807c45?s=128&d=identicon&r=PG&f=1", "display_name": "Max K", "link": "https://stackoverflow.com/users/5872882/max-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "accepted_answer_id": 39253187, "answer_count": 2, "score": 1, "last_activity_date": 1472656167, "creation_date": 1472655460, "question_id": 39253003, "link": "https://stackoverflow.com/questions/39253003/constants-in-haskell-after-start-of-the-program", "title": "&quot;Constants &quot; in Haskell after start of the program", "body": "<p>I have a keyboard input like <code>unsafePerformIO $ entryGetText myTextEntry</code>. How can I save this value like a \"constant\" (in data Type like this:</p>\n\n<pre><code>data SimuInfo = Information {\n                massSaved:: Double \n                } deriving Show\n</code></pre>\n\n<p>) after the program starts. The only method I know to \"save variables\" is:</p>\n\n<pre><code>valuea::Int\nvaluea = 120\n</code></pre>\n\n<p>But this method just works, when the value is not define by the user.</p>\n\n<p>Thanks in advance</p>\n"}, {"tags": ["haskell", "functional-programming", "lambda-calculus"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1472653160, "post_id": 39251953, "comment_id": 65839928, "body": "What is <code>x</code>? What abstract machine? What should a step do? And probably both types would be fine, the <code>Maybe</code> one just mixes signalling termination in the return value."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1472653338, "post_id": 39251953, "comment_id": 65840059, "body": "Assuming <code>x</code> is the type of the state, you also need an argument of type <code>y</code>, the thing that causes you to move to a different state."}, {"owner": {"reputation": 59, "user_id": 6083238, "user_type": "registered", "profile_image": "https://graph.facebook.com/100004005116874/picture?type=large", "display_name": "user158083", "link": "https://stackoverflow.com/users/6083238/user158083"}, "edited": false, "score": 0, "creation_date": 1472653347, "post_id": 39251953, "comment_id": 65840063, "body": "It will reduce the function. When applied to a term gives the term obtained after one step execution of abstract machine.   Suppose x is a datatype to represent terms for a language of arithmetic and boolean expressions."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1472654277, "post_id": 39251953, "comment_id": 65840805, "body": "As a user, I&#39;d prefer <code>X -&gt; Maybe X</code> for a stepping function. A function <code>X -&gt; X</code> would not tell me if the term is in normal form or if it is looping on itself."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1472685452, "post_id": 39253352, "comment_id": 65856767, "body": "Even worse, <code>x == singleStepReduce x</code> is not equivalent to <code>isNF x</code> when <code>x</code> has a self-looping transition."}], "tags": [], "owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "is_accepted": false, "score": 2, "last_activity_date": 1472656571, "creation_date": 1472656571, "answer_id": 39253352, "question_id": 39251953, "link": "https://stackoverflow.com/questions/39251953/haskell-code-for-one-step-redex-of-abstract-machine/39253352#39253352", "title": "Haskell code for one step redex of abstract machine?", "body": "<p>Normally, you want the single-step reduction function to have type <code>T -&gt; Maybe T</code>.  Then, for redexes you return a <code>Just</code>, and for normal forms you return <code>Nothing</code>.  This follows a general principle that functions should return as much of the information they compute to the caller as possible, which helps reduce re-computation in your program.</p>\n\n<p>If your single-step reduction function is <code>singleStepReduce :: T -&gt; T</code>, it has two choices when given an argument which is already in normal form:</p>\n\n<ul>\n<li>Return the argument.  This requires the caller to do something like <code>x == singleStepReduce x</code> or <code>isNF x</code> to determine if the argument is in NF; this is information <code>singleStepReduce</code> is already determining, so it's wasted computation; furthermore, <code>x == singleStepReduce x</code> is very computationally expensive, while <code>isNF x</code> still duplicates that determination <em>and</em> allows the rules for reduction and the rules for determining normal forms to fall out of step, which violates basic software engineering principles.</li>\n<li>Return <code>undefined</code>.  This is worse; it means the caller has no way to recover from the normal-form case, forcing the caller to use <code>isNF x</code> before calling <code>singleStepReduce x</code>, and leaving the problem that the definitions of <code>isNF x</code> and <code>singleStepReduce x</code> implement overlapping logic unsolved.</li>\n</ul>\n\n<p>Implementing a multi-step reducer, provided you're ok with the reducer going into an infinite loop on terms that lack a normal form, is then pretty simple:</p>\n\n<pre><code>multiStepReduce :: (a -&gt; Maybe a) -&gt; a\nmultiStepReduce r x = case r x of\n    Nothing -&gt; x\n    Just y -&gt; multiStepReduce r y\n</code></pre>\n"}], "owner": {"reputation": 59, "user_id": 6083238, "user_type": "registered", "profile_image": "https://graph.facebook.com/100004005116874/picture?type=large", "display_name": "user158083", "link": "https://stackoverflow.com/users/6083238/user158083"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 347, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1472656571, "creation_date": 1472652574, "last_edit_date": 1472656188, "question_id": 39251953, "link": "https://stackoverflow.com/questions/39251953/haskell-code-for-one-step-redex-of-abstract-machine", "title": "Haskell code for one step redex of abstract machine?", "body": "<p>What should be the type of a single-step reduction function for an abstract machine? <code>x -&gt; Maybe x</code> or <code>x -&gt; x</code>?</p>\n\n<p>Given such a single-step reduction function, how would one write the multi-step reduction function that gives the normal form of an input term?</p>\n"}, {"tags": ["haskell", "ghci"], "answers": [{"comments": [{"owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "edited": false, "score": 3, "creation_date": 1472660842, "post_id": 39254554, "comment_id": 65845063, "body": "Technically unless there is a function declaration it isn&#39;t the monomorphism restriction but just the underlying defaulting rules. Monomorphism restriction is about how defaulting rules apply to function definitions."}, {"owner": {"reputation": 1002, "user_id": 2016455, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/17d5b8c3cce04fa2071d7919d8671b4d?s=128&d=identicon&r=PG", "display_name": "Albert Netymk", "link": "https://stackoverflow.com/users/2016455/albert-netymk"}, "edited": false, "score": 0, "creation_date": 1472675196, "post_id": 39254554, "comment_id": 65852870, "body": "I had a quick looked at the link; &quot;The restriction is turned on by default in compiled modules, and turned off by default at the GHCi prompt (since GHC 7.8.1).&quot; It seems that it&#39;s off in ghci. (I was using ghci 7.10.3.)"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 1002, "user_id": 2016455, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/17d5b8c3cce04fa2071d7919d8671b4d?s=128&d=identicon&r=PG", "display_name": "Albert Netymk", "link": "https://stackoverflow.com/users/2016455/albert-netymk"}, "edited": false, "score": 0, "creation_date": 1472675621, "post_id": 39254554, "comment_id": 65853065, "body": "@AlbertNetymk yes, as comment above says restriction and defaulting rules are different things. So restriction is turned off but defaulting rules are still applied. See this link: <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ghci.html#type-defaulting-in-ghci\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/latest/docs/html/users_guide/&hellip;</a>"}, {"owner": {"reputation": 1002, "user_id": 2016455, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/17d5b8c3cce04fa2071d7919d8671b4d?s=128&d=identicon&r=PG", "display_name": "Albert Netymk", "link": "https://stackoverflow.com/users/2016455/albert-netymk"}, "edited": false, "score": 0, "creation_date": 1472680779, "post_id": 39254554, "comment_id": 65855297, "body": "@Shersh Thanks for the link to ghci user guide; it&#39;s very insightful. However, even after relaxing rule 3, it still doesn&#39;t match, does it? <code>Random</code> is not numeric, and it doesn&#39;t belong to [Show, Eq, ...]."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 1002, "user_id": 2016455, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/17d5b8c3cce04fa2071d7919d8671b4d?s=128&d=identicon&r=PG", "display_name": "Albert Netymk", "link": "https://stackoverflow.com/users/2016455/albert-netymk"}, "edited": false, "score": 0, "creation_date": 1472685193, "post_id": 39254554, "comment_id": 65856697, "body": "@AlbertNetymk Yes, you&#39;re right. <code>Random</code> is not a numeric type. But user guide says that &#171;At the GHCi prompt ... Rule 2 above is relaxed thus&#187; in next way: <code>All of the classes Ci are single-parameter type classes</code>. So  because <code>Random</code> is exactly a single-parameter type class defaulting rules applies."}, {"owner": {"reputation": 1002, "user_id": 2016455, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/17d5b8c3cce04fa2071d7919d8671b4d?s=128&d=identicon&r=PG", "display_name": "Albert Netymk", "link": "https://stackoverflow.com/users/2016455/albert-netymk"}, "edited": false, "score": 0, "creation_date": 1472686310, "post_id": 39254554, "comment_id": 65856993, "body": "@Shersh I thought rule 1,2,3 need to be satisfied at the same time. Looking at 2010 report 4.3.4 <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-750004.3\" rel=\"nofollow noreferrer\">haskell.org/onlinereport/haskell2010/&hellip;</a>, it uses &quot;and&quot; explicitly."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 1002, "user_id": 2016455, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/17d5b8c3cce04fa2071d7919d8671b4d?s=128&d=identicon&r=PG", "display_name": "Albert Netymk", "link": "https://stackoverflow.com/users/2016455/albert-netymk"}, "edited": false, "score": 0, "creation_date": 1472688998, "post_id": 39254554, "comment_id": 65857647, "body": "@AlbertNetymk It has to do with <code>default declaration</code> which is <code>default (Integer, Double)</code>. I&#39;ve updated my answer again."}, {"owner": {"reputation": 1002, "user_id": 2016455, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/17d5b8c3cce04fa2071d7919d8671b4d?s=128&d=identicon&r=PG", "display_name": "Albert Netymk", "link": "https://stackoverflow.com/users/2016455/albert-netymk"}, "edited": false, "score": 0, "creation_date": 1472731739, "post_id": 39254554, "comment_id": 65876643, "body": "@Shersh Thanks for the detailed illustration. The reasoning is easy to follow once we decide that <code>a</code> is defaultable. However, in this case, it&#39;s <i>not</i>, because it doesn&#39;t match all three rules, right? Specifically, &quot;Rule 3 above is relaxed this: At least one of the classes Ci is numeric, or is Show, Eq, Ord, Foldable or Traversable.&quot;"}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": 0, "last_activity_date": 1472689127, "last_edit_date": 1472689127, "creation_date": 1472660460, "answer_id": 39254554, "question_id": 39251728, "link": "https://stackoverflow.com/questions/39251728/ghci-randomio-type-inference/39254554#39254554", "title": "ghci randomio type inference", "body": "<p>I suppose it is just simple <a href=\"https://wiki.haskell.org/Monomorphism_restriction\" rel=\"nofollow\">Monomorphism restriction</a>. Polymorphic types such as <code>Num a =&gt; a</code> are handled like <code>Integer</code> if actual type is not specified. Probably this rule also works in <code>ghci</code> and you see integer type instead of some unknown type variable.</p>\n\n<p><strong>UPD 1:</strong> actually the real answer contained under this part of user guide about <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ghci.html#type-defaulting-in-ghci\" rel=\"nofollow\">defaulting rules</a>.</p>\n\n<p><strong>UPD 2:</strong> Case with <code>Random</code> type class turned to be more difficult than I expected. So in this case defaulting rules are resolved due to <code>default (Integer, Double)</code> declaration which is said in report. Consider next ghci session</p>\n\n<pre><code>Prelude System.Random&gt; default ()\nPrelude System.Random&gt; randomIO\n\n&lt;interactive&gt;:6:1:\n    No instance for (Show (IO a0)) arising from a use of \u2018print\u2019\n    In a stmt of an interactive GHCi command: print it\nPrelude System.Random&gt; default (Integer)\nPrelude System.Random&gt; randomIO\n-7948113563809442883\nPrelude System.Random&gt; default (Double)\nPrelude System.Random&gt; randomIO\n0.41581766590151104\n</code></pre>\n"}], "owner": {"reputation": 1002, "user_id": 2016455, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/17d5b8c3cce04fa2071d7919d8671b4d?s=128&d=identicon&r=PG", "display_name": "Albert Netymk", "link": "https://stackoverflow.com/users/2016455/albert-netymk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 66, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1472689127, "creation_date": 1472651993, "question_id": 39251728, "link": "https://stackoverflow.com/questions/39251728/ghci-randomio-type-inference", "title": "ghci randomio type inference", "body": "<p>I am following <a href=\"https://en.wikibooks.org/wiki/Haskell/Understanding_monads/State\" rel=\"nofollow\">https://en.wikibooks.org/wiki/Haskell/Understanding_monads/State</a>, and <code>randomIO</code> prints an integer in <code>ghci</code> directly. Given its type is polymorphic, how does <code>ghci</code> know it's <code>Int</code> here? Are there some special rules for type inference in <code>ghci</code>?</p>\n\n<pre><code>GHCi&gt; :m System.Random\nGHCi&gt; :t randomIO\nrandomIO :: Random a =&gt; IO a\nGHCi&gt; randomIO\n-1557093684\nGHCi&gt; randomIO\n1342278538\n</code></pre>\n"}, {"tags": ["haskell", "types", "module"], "comments": [{"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "edited": false, "score": 0, "creation_date": 1472650855, "post_id": 39250733, "comment_id": 65838193, "body": "Please limit Stack Overflow questions to focus on a single question. Your question about keyboard input should probably be moved to its own question, or <a href=\"http://learnyouahaskell.com/input-and-output\" rel=\"nofollow noreferrer\">read up on input/output here</a>"}], "answers": [{"tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": false, "score": 1, "last_activity_date": 1472651151, "last_edit_date": 1472651151, "creation_date": 1472650615, "answer_id": 39251202, "question_id": 39250733, "link": "https://stackoverflow.com/questions/39250733/passing-information-through-different-modules-haskell/39251202#39251202", "title": "Passing Information through different modules Haskell", "body": "<p>The error message is informing you that <code>example2</code> is invalid because the second parameter you're passing to <code>example</code> is supposed to be a <code>Double</code> but you are instead passing a function.</p>\n\n\n\n<pre class=\"lang-haskell prettyprint-override\"><code>example2 a  = example a Information\n</code></pre>\n\n<p><code>Information</code> is a constructor, which means that it is also a function that takes a <code>Double</code> as a parameter and returns a <code>SimuInfo</code> value.</p>\n\n<p>You have an <code>initialization</code> function which does the same thing as the <code>Information</code> constructor: it is a function that takes a <code>Double</code> as a parameter and returns a <code>SimuInfo</code> value.</p>\n\n<p>Therefore, you need to update <code>example2</code> to add that missing <code>Double</code> as input to <code>Information</code>. Here is an example of achieving this by adding another parameter to <code>example2</code>:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>example2 :: Double -&gt; Double -&gt; Double\nexample2 a infoVal = example a (Information infoVal)\n</code></pre>\n\n<p>The above could also be written using your helper function, <code>initialization</code></p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>example2 :: Double -&gt; Double -&gt; Double\nexample2 a infoVal = example a (initialization infoVal)\n</code></pre>\n\n<p>If you want to have a \"default\" value for <code>SimuInfo</code> that you can access from anywhere (similar to a constant in other languages), you can declare it like so:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>zeroedInformation :: SimuInfo\nzeroedInformation = Information 0\n</code></pre>\n"}], "owner": {"reputation": 151, "user_id": 5872882, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fc8fcfe6e5954b67ec74d3408e807c45?s=128&d=identicon&r=PG&f=1", "display_name": "Max K", "link": "https://stackoverflow.com/users/5872882/max-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 1, "answer_count": 1, "score": -1, "last_activity_date": 1472653852, "creation_date": 1472649461, "last_edit_date": 1472653852, "question_id": 39250733, "link": "https://stackoverflow.com/questions/39250733/passing-information-through-different-modules-haskell", "title": "Passing Information through different modules Haskell", "body": "<p>How can I store some values in a own created data Type. After the storing, different modules should have access to this values. </p>\n\n<p>It would be nice, if you could show me some code example, because I'm quite new in Haskell</p>\n\n<p>The code I have so far: \n<strong>The second module(which does not have the main stuff)</strong></p>\n\n<pre><code>data SimuInfo = Information {\n                massSaved:: Double\n                } deriving Show\n\ninitialization::  Double-&gt; SimuInfo\ninitialization m  = Information{\n                      massSaved = m\n                    }\n\n--a example function, which uses the data\nexample:: Double -&gt; SimuInfo -&gt; Double\nexample a information = 2* a * b\n                    where\n                    b = massSaved information\n</code></pre>\n\n<p><strong>This is the code in the first module, which uses the data type:</strong> </p>\n\n<pre><code>import Simufunc -- the import of the 2nd module\n\n\n\nexample2 :: Double -&gt; Double\nexample2 a  = example a Information\n</code></pre>\n\n<p><strong>This is the following Error message I get:</strong></p>\n\n<pre><code>Couldn't match expected type \u2018SimuInfo\u2019\n                with actual type \u2018Double -&gt; SimuInfo\u2019\n    Probable cause: \u2018Information\u2019 is applied to too few arguments\n    In the second argument of \u2018example\u2019, namely \u2018Information\u2019\n    In the expression: example a Information\n</code></pre>\n\n<p>Thanks in advance </p>\n"}, {"tags": ["parsing", "haskell", "parser-combinators"], "answers": [{"comments": [{"owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "edited": false, "score": 0, "creation_date": 1472642397, "post_id": 39248015, "comment_id": 65832202, "body": "ah i see, thank you. Quick qs, i was wondering why in your definition for the Expr data type, you have the Var value constructor, what purpose does it serve? I was under the impression that if you had a statement like x = 5, the parser will convert it in to something like  (Assign x (Int 5)). Is your var case for variable declarations that do not have a binding initially, e.g x; ?"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "edited": false, "score": 1, "creation_date": 1472643432, "post_id": 39248015, "comment_id": 65832888, "body": "@Zubair What does &quot;5 + x&quot; parse into?"}, {"owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "edited": false, "score": 1, "creation_date": 1472643599, "post_id": 39248015, "comment_id": 65832998, "body": "ah i see, assuming we have the relevant data types defined, i would assume something of the sort : BinApp Add (Lit Int 5) ( Var x), thank you for the clarification."}, {"owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "edited": false, "score": 0, "creation_date": 1472643614, "post_id": 39248015, "comment_id": 65833007, "body": "random sidenote, why cant I @ you?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "edited": false, "score": 0, "creation_date": 1472673893, "post_id": 39248015, "comment_id": 65852194, "body": "@Zubair The author of the question or answer you are commenting on always gets notified and are assumed to be the target of a comment by default, so adding an @ for them is considered redundant."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 2, "last_activity_date": 1472641817, "creation_date": 1472641817, "answer_id": 39248015, "question_id": 39247869, "link": "https://stackoverflow.com/questions/39247869/haskell-parser-combinators-identifiers/39248015#39248015", "title": "Haskell Parser Combinators - identifiers", "body": "<p>It's not the parser's job to figure out what the value of an expression is &mdash; that's the job of the <em>interpreter</em>. The parser's job is merely to turn a wedge of text into something easier for an interpreter to work with.</p>\n\n<p>In this case, you'd probably do something like</p>\n\n<pre><code>data Expr = Assign String Value | Var String | ...\n</code></pre>\n\n<p>You may or may not want to distinguish between <em>expressions</em> (which just produce a result) and <em>statements</em> (that do flow control and so on). It depends how complicated the language you're trying to parse is.</p>\n\n<p>You may also want to change this to <code>Assign String Expr</code>, since you can (presumably?) assign the result of an arbitrary <em>expression</em> to a variable, not merely a constant like 5.</p>\n\n<p>Once you've built a parser that turns text into this structure, then writing an interpreter that \"executes\" the program as another, separate, task.</p>\n"}], "owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 346, "favorite_count": 2, "accepted_answer_id": 39248015, "answer_count": 1, "score": 0, "last_activity_date": 1472662338, "creation_date": 1472641400, "last_edit_date": 1472662338, "question_id": 39247869, "link": "https://stackoverflow.com/questions/39247869/haskell-parser-combinators-identifiers", "title": "Haskell Parser Combinators - identifiers", "body": "<p>I am trying to write my own parser combinator library in Haskell, and I am struggling with how to parse identifiers.\nI have a datatype defined as follows which will be part of my AST.</p>\n\n<pre><code>data Expr = Var String | .... deriving (Show)\n</code></pre>\n\n<p>The purpose of this expression is to hold the names of variables as I parse them. The parser is defined as follows:</p>\n\n<pre><code>identifiers :: Parser Expr\nidentifiers = do\n  first &lt;-  string \"_\" &lt;|&gt; alphanum\n  rest  &lt;-  many alphanum\n  guard $ notElem (first:rest) keywords\n  return $ Var (first:rest)\n</code></pre>\n\n<p>I was wondering where in the parsing do you take into account what value the identifier is bound to. For example, if you had <code>number_of_results = 5</code>, the parser will parse the name of the identifier, but how do you keep reference to what the value of the identifier is?</p>\n\n<p>I was initially considering redefining the data type as follows:</p>\n\n<pre><code>data Expr = Var String Value | .... deriving (Show)\n</code></pre>\n\n<p>and then, in the parsing stage, continue parsing until I get to a value.</p>\n\n<p>However, I am not too sure whether I should do it like this... Could someone suggest a solution to this problem?</p>\n"}, {"tags": ["haskell", "types"], "answers": [{"tags": [], "owner": {"reputation": 1725, "user_id": 409157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84beba1253243b5508fc53c20fbe12f4?s=128&d=identicon&r=PG", "display_name": "Pedro Rodrigues", "link": "https://stackoverflow.com/users/409157/pedro-rodrigues"}, "is_accepted": true, "score": 4, "last_activity_date": 1472639661, "creation_date": 1472639661, "answer_id": 39247245, "question_id": 39246996, "link": "https://stackoverflow.com/questions/39246996/usage-of-own-data-types-haskell-receiving-error-parse-error-possibly-incorrect/39247245#39247245", "title": "usage of own data types Haskell receiving error: parse error (possibly incorrect indentation or mismatched brackets)", "body": "<p>Your <code>where</code> clause doesn't look right - it should have a syntax like this:</p>\n\n<pre><code>where\n  name = value\n</code></pre>\n\n<p>Perhaps you meant to write something like the following?</p>\n\n<pre><code>where\n  b = bFieldSaved information\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 0, "last_activity_date": 1472650873, "last_edit_date": 1472650873, "creation_date": 1472645196, "answer_id": 39249217, "question_id": 39246996, "link": "https://stackoverflow.com/questions/39246996/usage-of-own-data-types-haskell-receiving-error-parse-error-possibly-incorrect/39249217#39249217", "title": "usage of own data types Haskell receiving error: parse error (possibly incorrect indentation or mismatched brackets)", "body": "<p>You can pattern-match with record syntax, but you need to use the data constructor.</p>\n\n<pre><code> example a (Information {bFieldSave = b}) = 2 * a * b\n</code></pre>\n\n<p>Also, your <code>initialization</code> function isn't really necessary, as\nit is really equivalent to the data constructor you already have\nunderneath all the record syntax.</p>\n\n<pre><code>initialization:: Double -&gt; Double -&gt; Double -&gt; SimuInfo\n-- initialization m chiInit b = Information m chiInit b\ninitialization = Information\n</code></pre>\n"}], "owner": {"reputation": 151, "user_id": 5872882, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fc8fcfe6e5954b67ec74d3408e807c45?s=128&d=identicon&r=PG&f=1", "display_name": "Max K", "link": "https://stackoverflow.com/users/5872882/max-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 39247245, "answer_count": 2, "score": 0, "last_activity_date": 1472650873, "creation_date": 1472638965, "question_id": 39246996, "link": "https://stackoverflow.com/questions/39246996/usage-of-own-data-types-haskell-receiving-error-parse-error-possibly-incorrect", "title": "usage of own data types Haskell receiving error: parse error (possibly incorrect indentation or mismatched brackets)", "body": "<p>To run a simulation I created my own data Type, so I can store the parameters. </p>\n\n<pre><code>        example:: Double -&gt; SimuInfo -&gt; Double\n        example a information = 2* a * b\n                              where\n                                information{b = bFieldSaved }\n\n        ...--Some other functions    \n\n        data SimuInfo = Information {\n                        massSaved:: Double\n                        , chiSaved:: Double\n                        , bFieldSaved :: Double\n                        } deriving Show\n\n        initialization:: Double -&gt; Double -&gt; Double -&gt; SimuInfo\n        initialization m chiInit b = Information{\n                                  massSaved = m,\n                                  chiSaved = chiInit,\n                                  bFieldSaved = b\n                                }\n</code></pre>\n\n<p>The problem is that, while trying to compile, I receive this error message. (the compiler says, that it is in the line where I have <code>...--Some other functions</code>)</p>\n\n<pre><code>parse error (possibly incorrect indentation or mismatched brackets)\n</code></pre>\n\n<p>Thanks in advance </p>\n"}, {"tags": ["haskell", "higher-order-functions"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1472635888, "post_id": 39245699, "comment_id": 65827546, "body": "Please always add the full error message. And be sure to actually post the code as you&#39;ve tested it (use <code>ctrl-k</code> to make it a code block, so you won&#39;t mess up the indentation)."}, {"owner": {"reputation": 1174, "user_id": 2936106, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/XS85r.jpg?s=128&g=1", "display_name": "barakcaf", "link": "https://stackoverflow.com/users/2936106/barakcaf"}, "edited": false, "score": 0, "creation_date": 1472636425, "post_id": 39245699, "comment_id": 65827955, "body": "I think you will not get past the second line of impl. in myfunc since it will match any input that is not the empty list, and the empty list is matched in the first line. it looks like you are trying to validate that the two functions have been passed (similar to are not null) but that is redundant"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1472645584, "post_id": 39245699, "comment_id": 65834351, "body": "Rather than writing out an explicit recursive function, try to compose existing functions. <code>myfunc ce ao xs = map ao (filter ce xs)</code>, or even just <code>myfunc ce ao = map ao . filter ce</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1472645678, "post_id": 39245699, "comment_id": 65834412, "body": "Also, <code>checkeven</code> is just a verbose wrapper around <code>even</code>: <code>checkeven = even</code>."}], "answers": [{"tags": [], "owner": {"reputation": 353, "user_id": 5462440, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06d7f64b3dbfe68eab0e33f6c30cf41a?s=128&d=identicon&r=PG&f=1", "display_name": "Sakamiai", "link": "https://stackoverflow.com/users/5462440/sakamiai"}, "is_accepted": true, "score": 3, "last_activity_date": 1472637503, "creation_date": 1472637503, "answer_id": 39246457, "question_id": 39245699, "link": "https://stackoverflow.com/questions/39245699/haskell-passing-multiple-functions-into-a-function/39246457#39246457", "title": "Haskell - Passing multiple functions into a function", "body": "<p>In <em>myfunc</em> these two lines are useless because when pattern matching they mean the same thing (also they are not the final stage of the recursion you are looking for) :</p>\n\n<pre><code>myfunc _ ao (x : xs) = []\nmyfunc ce _ (x : xs) = []\n</code></pre>\n\n<p>also in the first pattern match <em>ce</em> <em>ao</em> are useless, because they are not used anywhere so they should be a <em>_</em>. </p>\n\n<p>So <em>myfunc</em> should look like this:</p>\n\n<pre><code>myfunc :: (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; [Int] -&gt; [Int]\nmyfunc _ _ [] = []\nmyfunc ce ao (x : xs) = if ce x then ao x : tail else tail where\n   tail = myfunc ce ao xs\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "reply_to_user": {"reputation": 353, "user_id": 5462440, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06d7f64b3dbfe68eab0e33f6c30cf41a?s=128&d=identicon&r=PG&f=1", "display_name": "Sakamiai", "link": "https://stackoverflow.com/users/5462440/sakamiai"}, "edited": false, "score": 0, "creation_date": 1472648969, "post_id": 39246553, "comment_id": 65836838, "body": "Each comment referers to the code above it, not beneath."}, {"owner": {"reputation": 353, "user_id": 5462440, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06d7f64b3dbfe68eab0e33f6c30cf41a?s=128&d=identicon&r=PG&f=1", "display_name": "Sakamiai", "link": "https://stackoverflow.com/users/5462440/sakamiai"}, "edited": false, "score": 0, "creation_date": 1472708945, "post_id": 39246553, "comment_id": 65862460, "body": "It seems our brains are wired up differently, didn&#39;t notice next comment :)"}], "tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": false, "score": 1, "last_activity_date": 1472637735, "creation_date": 1472637735, "answer_id": 39246553, "question_id": 39245699, "link": "https://stackoverflow.com/questions/39245699/haskell-passing-multiple-functions-into-a-function/39246553#39246553", "title": "Haskell - Passing multiple functions into a function", "body": "<p>Here is the breakdown:</p>\n\n<pre><code>addone :: Int -&gt; Int\naddone i = i + 1\naddone _ = 0\n</code></pre>\n\n<p>The last line is extraneous here, because first line will match everything.</p>\n\n<pre><code>checkeven :: Int -&gt; Bool\ncheckeven n \n   | even n == True = True\n   | otherwise      = False\n</code></pre>\n\n<p>This can be written as <code>checkeven = even</code>.</p>\n\n<pre><code>myfunc :: (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; [Int] -&gt; [Int]\nmyfunc ce ao [] = []\nmyfunc _ ao (x : xs) = []\nmyfunc ce _ (x : xs) = []\nmyfunc ce ao (x : xs) = if ce x then ao x : tail else tail where\n   tail = myfunc ce ao xs\n</code></pre>\n\n<p>The condition to match line 1 is \"the list is empty\". Conditions to match line 2 and 3 are \"the list isn't empty\". Thus, lines 3 and 4 will never be matched.</p>\n\n<p>RE the error, I can't see where it can come from. Please post the full code that reproduces the problem and clear error message.</p>\n"}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 1, "accepted_answer_id": 39246457, "answer_count": 2, "score": -1, "last_activity_date": 1472637735, "creation_date": 1472635545, "question_id": 39245699, "link": "https://stackoverflow.com/questions/39245699/haskell-passing-multiple-functions-into-a-function", "title": "Haskell - Passing multiple functions into a function", "body": "<p>Im trying to test passing two functions into 'myfunc' to perform operations of the elements of an Int list.</p>\n\n<p>*This is purely to test -- i know I can use filter, even etc.. just testing code here</p>\n\n<pre><code> addone :: Int -&gt; Int\n addone i = i + 1\n addoone _ = 0\n\ncheckeven :: Int -&gt; Bool\ncheckeven n \n   | even n == True = True\n   | otherwise      = False\n\nmyfunc :: (Int -&gt; Bool) -&gt; (Int -&gt; Int) -&gt; [Int] -&gt; [Int]\nmyfunc ce ao [] = []\nmyfunc _ ao (x : xs) = []\nmyfunc ce _ (x : xs) = []\nmyfunc ce ao (x : xs) = if ce x then ao x : tail else tail where\n   tail = myfunc ce ao xs\n\nmylist = [1,2,3,3,3,1,1,4]\nmain = do\n  let x = myfunc checkeven addone mylist\n  putStrLn $ show x\n</code></pre>\n\n<p>Getting an error when trying to run this of 'Non-exhaustive patterns'... Any ideas? </p>\n"}, {"tags": ["haskell", "functional-programming", "ml"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1472631684, "post_id": 39243889, "comment_id": 65824755, "body": "I&#39;m pretty sure that the RHS needs <code>xs,ys</code> to be swapped. See the answer to the duplicate question above."}, {"owner": {"reputation": 14052, "user_id": 1004301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a6aacd03deb37cb13cbc8b65e454f2b?s=128&d=identicon&r=PG", "display_name": "Lee Duhem", "link": "https://stackoverflow.com/users/1004301/lee-duhem"}, "edited": false, "score": 1, "creation_date": 1472632665, "post_id": 39243889, "comment_id": 65825342, "body": "You can expand <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:foldr\" rel=\"nofollow noreferrer\"><code>foldr</code></a> expressions in both sides to prove it directly."}], "owner": {"reputation": 63, "user_id": 6012730, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/0a6fde0b572f308893a30aa4795fe08f?s=128&d=identicon&r=PG&f=1", "display_name": "mlhack", "link": "https://stackoverflow.com/users/6012730/mlhack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 0, "closed_date": 1472631571, "answer_count": 0, "score": 0, "last_activity_date": 1472630353, "creation_date": 1472630353, "question_id": 39243889, "link": "https://stackoverflow.com/questions/39243889/how-to-prove-this-equation-foldr-function", "closed_reason": "Duplicate", "title": "How to prove this equation? (FOLDR function)", "body": "<p>I have to prove this equation:</p>\n\n<pre><code>foldr f a (xs ++ ys) = foldr f (foldr f a xs) ys\n</code></pre>\n\n<p>I tried with induction but I couldn't manage to prove it.</p>\n"}, {"tags": ["haskell", "quickcheck"], "answers": [{"comments": [{"owner": {"reputation": 796, "user_id": 672098, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/df506e61c4f7bb05009fcb7f22ee81e2?s=128&d=identicon&r=PG", "display_name": "Arek&#39; Fu", "link": "https://stackoverflow.com/users/672098/arek-fu"}, "edited": false, "score": 3, "creation_date": 1472627718, "post_id": 39242902, "comment_id": 65822488, "body": "I don&#39;t want to <i>prove</i> that the function terminates (that is the halting problem), I just want to make sure that I did not make any mistake in the implementation which would lead to infinite recursion. I would like to write my test in a way that clearly expresses my intention."}, {"owner": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "reply_to_user": {"reputation": 796, "user_id": 672098, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/df506e61c4f7bb05009fcb7f22ee81e2?s=128&d=identicon&r=PG", "display_name": "Arek&#39; Fu", "link": "https://stackoverflow.com/users/672098/arek-fu"}, "edited": false, "score": 0, "creation_date": 1472627987, "post_id": 39242902, "comment_id": 65822649, "body": "See my edit, which explains why <code>seq</code> is not appropriate here."}, {"owner": {"reputation": 796, "user_id": 672098, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/df506e61c4f7bb05009fcb7f22ee81e2?s=128&d=identicon&r=PG", "display_name": "Arek&#39; Fu", "link": "https://stackoverflow.com/users/672098/arek-fu"}, "edited": false, "score": 1, "creation_date": 1472628130, "post_id": 39242902, "comment_id": 65822726, "body": "Well, <code>f</code> returns an <code>Int</code>, so WHNF and NF are the same, right? But in the general case you are definitely right."}, {"owner": {"reputation": 8075, "user_id": 2169853, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/68b89009f4066d3e1adbe72d4329c8d3?s=128&d=identicon&r=PG", "display_name": "Jens", "link": "https://stackoverflow.com/users/2169853/jens"}, "edited": false, "score": 0, "creation_date": 1472628228, "post_id": 39242902, "comment_id": 65822792, "body": "You are correct that is undecidable in general, but there are ways to prove termination for many functions. Many theorem provers and software verification systems have to do this. For a functional language, a common idea is to define a well-defined order on the input term and then show via induction that the arguments of the recursive calls decrease in that order. It then follows that the function must terminate. Of course these systems do not work for every function, but it works often enough."}, {"owner": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "edited": false, "score": 0, "creation_date": 1472628279, "post_id": 39242902, "comment_id": 65822822, "body": "Yes, if you are only ever returning an <code>Int</code> then you don&#39;t need to worry about <code>seq</code> vs <code>deepseq</code>."}], "tags": [], "owner": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "is_accepted": false, "score": 7, "last_activity_date": 1472627964, "last_edit_date": 1472627964, "creation_date": 1472627222, "answer_id": 39242902, "question_id": 39242618, "link": "https://stackoverflow.com/questions/39242618/how-do-i-use-quickcheck-to-test-if-a-function-terminates/39242902#39242902", "title": "How do I use QuickCheck to test if a function terminates?", "body": "<p>This is the <a href=\"https://en.wikipedia.org/wiki/Halting_problem\">halting problem</a>. There is no algorithm capable of telling you whether a function terminates or not.</p>\n\n<p>In particular, you <em>may</em> be able to get a positive result (i.e. if the function does terminate, this proposition will tell you) if you are willing to wait long enough. But just by waiting, you can never know the difference between <em>this function does not terminate</em> and <em>this function has not terminated yet</em>.</p>\n\n<p>You can implement a check like <em>does this function terminate in time T</em> which may be appropriate for your needs.</p>\n\n<hr>\n\n<p><strong>Edit</strong> As written, your function does not do what you require. Consider</p>\n\n<pre><code>&gt; let f = 1:f\n&gt; f `seq` True\nTrue\n</code></pre>\n\n<p>The reason is that <code>seq</code> only evaluates to <a href=\"https://wiki.haskell.org/Weak_head_normal_form\">weak head normal form</a>. Instead you could use <code>deepseq</code> which evaluates data structures deeply,</p>\n\n<pre><code>&gt; import Control.DeepSeq (deepseq)\n&gt; f `deepseq` True\n* never returns *\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 796, "user_id": 672098, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/df506e61c4f7bb05009fcb7f22ee81e2?s=128&d=identicon&r=PG", "display_name": "Arek&#39; Fu", "link": "https://stackoverflow.com/users/672098/arek-fu"}, "edited": false, "score": 2, "creation_date": 1472627907, "post_id": 39243102, "comment_id": 65822606, "body": "Yes, the problem is exactly that I cannot express any reasonable invariant about the output of <code>f</code>, which is actually the result of a Monte-Carlo calculation."}], "tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": true, "score": 4, "last_activity_date": 1472627828, "creation_date": 1472627828, "answer_id": 39243102, "question_id": 39242618, "link": "https://stackoverflow.com/questions/39242618/how-do-i-use-quickcheck-to-test-if-a-function-terminates/39243102#39243102", "title": "How do I use QuickCheck to test if a function terminates?", "body": "<p>I probably wouldn't bother, I'd just test other properties of its output.</p>\n\n<p>Any property that examines the output of <code>f x y</code> in any way is going to do <em>at least</em> as much termination checking as your <code>prop_fTerminates</code>, so why waste time doubling up on that check?</p>\n\n<p>If for some reason \"f x y terminates\" is the only property you can test about <code>f</code>, then what you've got seems reasonable.</p>\n"}], "owner": {"reputation": 796, "user_id": 672098, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/df506e61c4f7bb05009fcb7f22ee81e2?s=128&d=identicon&r=PG", "display_name": "Arek&#39; Fu", "link": "https://stackoverflow.com/users/672098/arek-fu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 614, "favorite_count": 1, "accepted_answer_id": 39243102, "answer_count": 2, "score": 2, "last_activity_date": 1472627964, "creation_date": 1472626251, "question_id": 39242618, "link": "https://stackoverflow.com/questions/39242618/how-do-i-use-quickcheck-to-test-if-a-function-terminates", "title": "How do I use QuickCheck to test if a function terminates?", "body": "<p>I would like to use QuickCheck to test a function to make sure it terminates (no infinite recursion, no exceptions thrown, etc.). This is what I do at the moment:</p>\n\n<pre><code>f :: Int -&gt; Int -&gt; Int\n\nprop_fTerminates :: Int -&gt; Int -&gt; Bool   -- say\nprop_fTerminates x y = f x y `seq` True\n</code></pre>\n\n<p>Is there a better (more expressive and idiomatic) way?</p>\n"}, {"tags": ["haskell", "free-monad", "profunctor"], "answers": [{"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 4, "creation_date": 1472632090, "post_id": 39241574, "comment_id": 65825013, "body": "Yes, because profunctors are just functors with an additional, contravariant parameter. Your <code>T</code> doesn&#39;t actually make use of <code>f</code>&#39;s profunctor-ness, just its functor-ness: you&#39;re using <code>id</code> as the first argument to <code>dimap</code>. <code>T</code> is basically just <code>Free</code> with an extra parameter"}], "tags": [], "owner": {"reputation": 547, "user_id": 832176, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8d7cd2cd4d6d4ef64df3b266136ab853?s=128&d=identicon&r=PG", "display_name": "M Farkas-Dyck", "link": "https://stackoverflow.com/users/832176/m-farkas-dyck"}, "is_accepted": false, "score": 2, "last_activity_date": 1472622199, "creation_date": 1472622199, "answer_id": 39241574, "question_id": 39241262, "link": "https://stackoverflow.com/questions/39241262/analog-of-free-monads-for-profunctors/39241574#39241574", "title": "Analog of free monads for Profunctors", "body": "<p>So i think i figured it out: <code>M ~ Monad</code> \u263a</p>\n\n<pre><code>instance Profunctor f =&gt; Functor (T f a) where\n    fmap f (In m) = In (dimap id (fmap f) m)\n    fmap f (Hole x) = Hole (f x)\n    fmap f (Var v) = Var v\n\ninstance Profunctor f =&gt; Applicative (T f a) where\n    pure = Hole\n    (&lt;*&gt;) = ap\n\ninstance Profunctor f =&gt; Monad (T f a) where\n    In m &gt;&gt;= f = In ((&gt;&gt;= f) &lt;$&gt; m)\n    Hole x &gt;&gt;= f = f x\n    Var v &gt;&gt;= _ = Var v\n</code></pre>\n\n<p>Seems obvious in hindthought.</p>\n"}, {"comments": [{"owner": {"reputation": 365, "user_id": 3117573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TEuTH.jpg?s=128&g=1", "display_name": "mnish", "link": "https://stackoverflow.com/users/3117573/mnish"}, "edited": false, "score": 0, "creation_date": 1483540248, "post_id": 41454784, "comment_id": 70138002, "body": "Interesting, but why restrict to profunctors of the form Hask^op*Hask -&gt; Hask?"}, {"owner": {"reputation": 7598, "user_id": 207442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de17c115bd9246372432f29dc8245808?s=128&d=identicon&r=PG&f=1", "display_name": "sigfpe", "link": "https://stackoverflow.com/users/207442/sigfpe"}, "reply_to_user": {"reputation": 365, "user_id": 3117573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TEuTH.jpg?s=128&g=1", "display_name": "mnish", "link": "https://stackoverflow.com/users/3117573/mnish"}, "edited": false, "score": 0, "creation_date": 1483544626, "post_id": 41454784, "comment_id": 70140991, "body": "@mnish&#39;cos that&#39;s what Haskell&#39;s Profunctor type class is. Generalising to other classes is left as an exercise."}], "tags": [], "owner": {"reputation": 7598, "user_id": 207442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de17c115bd9246372432f29dc8245808?s=128&d=identicon&r=PG&f=1", "display_name": "sigfpe", "link": "https://stackoverflow.com/users/207442/sigfpe"}, "is_accepted": true, "score": 3, "last_activity_date": 1483492512, "creation_date": 1483492512, "answer_id": 41454784, "question_id": 39241262, "link": "https://stackoverflow.com/questions/39241262/analog-of-free-monads-for-profunctors/41454784#41454784", "title": "Analog of free monads for Profunctors", "body": "<p>There's a more appropriate notion of making a free thing from a profunctor. Then we can work by analogy.</p>\n\n<p>A free monoid, Y, generated by a set X is can be thought of as the solution to the equation \"Y=1+XY\". In Haskell notation that is</p>\n\n<pre><code>data List a = Nil | Cons a (List a)\n</code></pre>\n\n<p>A free monad, M, generated by the functor F can be thought of as the solution to the equation \"M=1+FM\" where the product \"FM' is the composition of functors. 1 is just the identity functor. In Haskell notation that is</p>\n\n<pre><code>data Free f a = Pure a | Free (f (Free a))\n</code></pre>\n\n<p>Making something free from a profunctor P should look like a solution, A, to \"A=1+PA\". The product \"PA\" is the standard <a href=\"http://hackage.haskell.org/package/Chart-gtk-1.1/docs/Data-Profunctor-Composition.html\" rel=\"nofollow noreferrer\">composition of profunctors</a>. The 1 is the \"identity\" profunctor, <code>(-&gt;)</code>. So we get</p>\n\n<pre><code>data Free p a b = Pure (a -&gt; b) | forall x.Free (p a x) (Free p x b)\n</code></pre>\n\n<p>This is also a profunctor:</p>\n\n<pre><code>instance Profunctor b =&gt; Profunctor (Free b) where\n    lmap f (Pure g) = Pure (g . f)\n    lmap f (Free g h) = Free (lmap f g) h\n    rmap f (Pure g) = Pure (f . g)\n    rmap f (Free g h) = Free g (rmap f h)\n</code></pre>\n\n<p>If the profunctor is strong then so is the free version:</p>\n\n<pre><code>instance Strong p =&gt; Strong (Free p) where\n    first' (Pure f) = Pure (first' f)\n    first' (Free f g) = Free (first' f) (first' g)\n</code></pre>\n\n<p>But what actually is <code>Free p</code>? It's actually a thing called a <a href=\"http://www.fceia.unr.edu.ar/~mauro/pubs/Notions_of_Computation_as_Monoids.pdf\" rel=\"nofollow noreferrer\">pre-arrow</a>. Restricting, free strong profunctors are arrows:</p>\n\n<pre><code>instance Profunctor p =&gt; Category (Free p) where\n    id = Pure id\n    Pure f . Pure g = Pure (f . g)\n    Free g h . Pure f = Free (lmap f g) h\n    Pure f . Free g h = Free g (Pure f . h)\n    f . Free g h = Free g (f . h)\n\ninstance (Profunctor p, Strong p) =&gt; Arrow (Free p) where\n    arr = Pure\n    first = first'\n</code></pre>\n\n<p>Intuitively you can think of an element of a profunctor <code>P a b</code> as taking an <code>a</code>-ish thing to a <code>b</code>-ish thing, the canonical example being given by <code>(-&gt;)</code>. <code>Free P</code> is an unevaluated chain of these elements with compatible (but unobservable) intermediate types.</p>\n"}], "owner": {"reputation": 547, "user_id": 832176, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8d7cd2cd4d6d4ef64df3b266136ab853?s=128&d=identicon&r=PG", "display_name": "M Farkas-Dyck", "link": "https://stackoverflow.com/users/832176/m-farkas-dyck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 293, "favorite_count": 2, "accepted_answer_id": 41454784, "answer_count": 2, "score": 7, "last_activity_date": 1559519169, "creation_date": 1472620548, "last_edit_date": 1559519169, "question_id": 39241262, "link": "https://stackoverflow.com/questions/39241262/analog-of-free-monads-for-profunctors", "title": "Analog of free monads for Profunctors", "body": "<p>We can define <code>data Free f a = Pure a | Free (f (Free f a))</code> and so have <code>Functor f =&gt; Monad (Free f)</code>.</p>\n\n<p>If we define\n<code>data T f a b = R a | S b | T (f a (T f a b))</code> have we some analogous <code>M</code> so <code>Profunctor f =&gt; M (T f a)</code>, where <code>class Profunctor f where dimap :: (a -&gt; b) -&gt; (c -&gt; d) -&gt; f b c -&gt; f a d</code>?</p>\n\n<p>I've been wondering ever since i noted <a href=\"https://hackage.haskell.org/package/compdata-0.10.1/docs/Data-Comp-Term.html#t:Cxt\" rel=\"nofollow\"><code>Data.Comp.Term.Context</code></a> and <code>Free</code> are isomorphic about a potential analog for <a href=\"https://hackage.haskell.org/package/compdata-param-0.9/docs/Data-Comp-Param-Term.html#t:Context\" rel=\"nofollow\"><code>Data.Comp.Param.Term.Context</code></a>.</p>\n"}, {"tags": ["haskell", "currying", "partial-application"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 4, "creation_date": 1472608760, "post_id": 39239577, "comment_id": 65816224, "body": "Look up function currying and keep in mind that data constructors like <code>Sentence</code> are treated pretty much like regular functions."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1472656180, "post_id": 39240189, "comment_id": 65842216, "body": "You can also use <code>:t Sentence</code> to see that the constructor has type <code>Subject -&gt; Verb -&gt; Object -&gt; Sentence</code>; <code>:t Sentence &quot;dogs&quot;</code> has type <code>Object -&gt; Verb -&gt; Sentence</code>, etc."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 8, "last_activity_date": 1472622040, "last_edit_date": 1472622040, "creation_date": 1472613406, "answer_id": 39240189, "question_id": 39239577, "link": "https://stackoverflow.com/questions/39239577/partial-application-of-data-constructor/39240189#39240189", "title": "Partial application of data constructor", "body": "<blockquote>\n  <p>but why is it that the definition of <code>s1</code> even makes sense?</p>\n</blockquote>\n\n<p>As @Alec mentioned, it's called currying. One way to see what is going on is to have GHCI tell you what the type of <code>s1</code> is:</p>\n\n<pre><code>ghci&gt; :t s1\ns1 :: Object -&gt; Sentence\n</code></pre>\n\n<p>So <code>s1</code> is a function taking an <code>Object</code> to a <code>Sentence</code>. Another way to think about is to start with the definition:</p>\n\n<pre><code>s1 = Sentence \"dogs\" \"drool\"\n</code></pre>\n\n<p>and using equational reasoning apply both sides to a value <code>x</code>:</p>\n\n<pre><code>s1 x = Sentence \"dogs\" \"drool\" x\n</code></pre>\n\n<p>So when you call <code>s1 x</code> it's the same as calling <code>Sentence</code> with the first two function arguments hard-coded to <code>\"dogs\"</code> and <code>\"drool\"</code>, and <code>x</code> becomes the third argument to the <code>Sentence</code> function.</p>\n\n<blockquote>\n  <p>can someone explain what \"No instance for <code>(Show (Object -&gt; Sentence))</code>\" means?</p>\n</blockquote>\n\n<p>When you evaluate something in GHCI is it basically the same as asking Haskell to <code>print</code> it. That is,</p>\n\n<pre><code>ghci&gt; 3+4\n</code></pre>\n\n<p>is effectively the same as:</p>\n\n<pre><code>ghci&gt; print (3+4)\n</code></pre>\n\n<p>(This rule doesn't apply to IO-actions like <code>getLine</code> or even <code>print</code> itself. In those cases Haskell just runs the IO-action.)</p>\n\n<p>In order to <code>print</code> something there has to be a Show instance for the type.\nBut as we've seen above, <code>s1</code> is a function of type <code>Object -&gt; Sentence</code>, and there are no predefined Show instances for functions.</p>\n\n<p>Note that there is a Show instance for <code>Sentence</code> values because you asked GHC to derive one with <code>deriving (Eq, Show)</code>. So when you type at the GHCI prompt:</p>\n\n<pre><code>ghci&gt; Sentence \"Julie\" \"loves\" \"dogs\"\n</code></pre>\n\n<p>you get back:</p>\n\n<pre><code>Sentence \"Julie\" \"loves\" \"dogs\"\n</code></pre>\n\n<p>because you are really asking GHCI to run <code>print (Sentence \"Julie\" \"loves\" \"dogs\")</code>.</p>\n\n<p>Note that <code>print</code> itself is defined as <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/src/System.IO.html#print\">(link)</a>:</p>\n\n<pre><code>print x = putStrLn (show x)\n</code></pre>\n\n<p>and the call to <code>show</code> is the reason why a value needs to have a Show instance defined for it in order to print it.</p>\n"}, {"tags": [], "owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "is_accepted": false, "score": 0, "last_activity_date": 1472694115, "last_edit_date": 1495542393, "creation_date": 1472694115, "answer_id": 39261479, "question_id": 39239577, "link": "https://stackoverflow.com/questions/39239577/partial-application-of-data-constructor/39261479#39261479", "title": "Partial application of data constructor", "body": "<blockquote>\n<pre><code>No instance for (Show (Object -&gt; Sentence))\n  arising from a use of `print'\nPossible fix:\n  add an instance declaration for (Show (Object -&gt; Sentence))\nIn a stmt of an interactive GHCi command: print it\n</code></pre>\n</blockquote>\n\n<p>To supplement @ErikR's answer: you may be wondering why GHC doesn't have a built-in support for displaying functions, i.e. unlike integers and strings, functions don't have an instance for the <code>Show</code> typeclass (these terms will be explained in depth later in the book, so don't worry if you don't understand what's a typeclass and an instance), unless you explicitly define it yourself. As someone who is learning Haskell and comes from an Object-Oriented background, I found it easier to get an intuition for typeclasses by thinking of them as Java-like interfaces.</p>\n\n<p>So, why there's no <code>Show</code> insance for functions? The <a href=\"https://wiki.haskell.org/Show_instance_for_functions\" rel=\"nofollow noreferrer\">Haskell wiki</a> provides two answers:</p>\n\n<p>1.Practically, GHC doesn't keep track of variable names, i.e. the following are the same for the compiler:</p>\n\n<pre><code>addOne num = num + 1\nf x = x + 1\nf y = y + 1  \n</code></pre>\n\n<p>Additionally, functions can be optimized, e.g. the following may have equivalent representations</p>\n\n<pre><code>f x = x - x + x\nf x = x\n</code></pre>\n\n<p>2.Theoretically, a function is defined by its graph, i.e. the set of (input, output) pairs. e.g. for</p>\n\n<pre><code>f x = x + x\n</code></pre>\n\n<p>the pairs are (1,2), (2,4), etc.\nThus, functions with the same graph are identical GHC-wise, e.g</p>\n\n<pre><code>f x = x + x\ng y = 2 * y\n</code></pre>\n\n<p>but you would expect <code>show f</code> and <code>show g</code> to be different, especially if you use significant variable names instead of x and y.  </p>\n\n<p>That said, you can use a pragma (an extension for the GHC compiler, that contains some functionality beyond the Haskell language standard) that would show only the function's type, as explained in <a href=\"https://stackoverflow.com/a/15846061/165753\">this answer</a>:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\nimport Data.Typeable\n\ninstance (Typeable a, Typeable b) =&gt; Show (a-&gt;b) where\n  show _ = show $ typeOf (undefined :: a -&gt; b)\n</code></pre>\n\n<p>This will get you</p>\n\n<pre><code>&gt; s1\n[Char] -&gt; Sentence\n</code></pre>\n\n<p>since <code>Object</code> is an alias of <code>String</code> (using the <code>type</code> keyword, <code>String</code> is itself an alias for <code>[Char]</code>).\nIf you want to explicitly see the distinction between subjects and objects, you can convert <code>Object</code> to a type with a datatype constructor <code>MkObject</code>:</p>\n\n<pre><code>newtype Object = MkObject String deriving (Eq, Show)\n\ns1 = Sentence \"dogs\" \"drool\"\ns2 = Sentence \"Julie\" \"loves\" (MkObject \"dogs\")\n</code></pre>\n\n<p>and voil\u00e0</p>\n\n<pre><code>&gt; s1\nObject -&gt; Sentence\n</code></pre>\n"}], "owner": {"reputation": 771, "user_id": 2852677, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b2589bf5e2ead9b3e7a39f30ae8a10f9?s=128&d=identicon&r=PG", "display_name": "gogurt", "link": "https://stackoverflow.com/users/2852677/gogurt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 626, "favorite_count": 2, "accepted_answer_id": 39240189, "answer_count": 2, "score": 4, "last_activity_date": 1472923722, "creation_date": 1472608643, "last_edit_date": 1472923722, "question_id": 39239577, "link": "https://stackoverflow.com/questions/39239577/partial-application-of-data-constructor", "title": "Partial application of data constructor", "body": "<p>I don't understand why the following exercise \"works\" in <em>Haskell Programming from First Principles</em>:</p>\n\n<pre><code>type Subject = String\ntype Verb = String\ntype Object = String\n\ndata Sentence =\n    Sentence Subject Verb Object\n    deriving (Eq, Show)\n\ns1 = Sentence \"dogs\" \"drool\"\ns2 = Sentence \"Julie\" \"loves\" \"dogs\"\n</code></pre>\n\n<p>Loading this into ghci shows that it typechecks just fine, but why is it that the definition of <code>s1</code> even makes sense? I'm still very new to Haskell, so at first I thought this was because in <code>s1</code> Haskell was implicitly letting the <code>Object</code> string be empty. But then...</p>\n\n<pre><code>*Main&gt; s1\n\n&lt;interactive&gt;:13:1:\n    No instance for (Show (Object -&gt; Sentence))\n      arising from a use of `print'\n    Possible fix:\n      add an instance declaration for (Show (Object -&gt; Sentence))\n    In a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>I'm still learning how to properly interpret these error messages, so please bear with me. But can someone explain what <code>No instance for (Show (Object -&gt; Sentence))</code> means? More specifically, how does leaving out the <code>Object</code> string in <code>s1</code> result in this <code>(Object -&gt; Sentence)</code> thing?</p>\n\n<p>I'm sure this is stupid easy, but I don't think the book has equipped me to understand this by this point...</p>\n"}, {"tags": ["haskell", "monads", "category-theory"], "comments": [{"owner": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "edited": false, "score": 0, "creation_date": 1472705541, "post_id": 39239286, "comment_id": 65861273, "body": "why the downvotes?"}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 2, "last_activity_date": 1472610035, "creation_date": 1472610035, "answer_id": 39239750, "question_id": 39239286, "link": "https://stackoverflow.com/questions/39239286/what-is-an-generalized-way-to-compose-these-3-types-of-functions-for-conditional/39239750#39239750", "title": "What is an generalized way to compose these 3 types of functions for conditional branching?", "body": "<p>If <code>new?</code> and <code>fetch</code> are separate functions, you will have to make two queries in any case. (One to check if the name is in the database, then another after you examine the result.)</p>\n\n<p>However, it seems like <code>new?</code> is redundant; <code>fetch</code> could return a <code>Maybe</code> value to either retrieve the desire number or indicate that the name is new. Also assuming that your monad is an instance of <code>MonadIO</code>, your signature and function would be something like</p>\n\n<pre><code>program :: MonadIO m =&gt; Name                  -- name to query\n                     -&gt; (Name -&gt; m Maybe Int) -- fetch\n                     -&gt; (Name -&gt; m Int)       -- generate\n                     -&gt; m Int                 -- number for name\nprogram name fetch generate = fetch name &gt;&gt;= maybe (generate name) return\n</code></pre>\n"}], "owner": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 39239750, "answer_count": 1, "score": 0, "last_activity_date": 1472610035, "creation_date": 1472605929, "last_edit_date": 1472606642, "question_id": 39239286, "link": "https://stackoverflow.com/questions/39239286/what-is-an-generalized-way-to-compose-these-3-types-of-functions-for-conditional", "title": "What is an generalized way to compose these 3 types of functions for conditional branching?", "body": "<p>I have three monadic functions which I want to compose together and conditionally branch on a predicate. I'm looking for possibly multiple <em>general</em> solutions with tradeoffs. Arrows (ArrowChoice?) and Monads are looking promising.</p>\n\n<p>The contrived problem is this:</p>\n\n<p><em>I run a service that keeps track of many clients' \"personal number\". If they log in for the first time, their number is set at 0. If they've logged in before, and presumably changed their number, that is the number that will be fetched for them.</em></p>\n\n<p>So the generic type of this program could be <code>program :: Name -&gt; Int</code>.</p>\n\n<p>I have 3 functions, which all might have a monadic effect of querying a persistent store of data (eg DB, State):</p>\n\n<pre><code>new?     :: Name -&gt; Bool\nfetch    :: Name -&gt; Int\ngenerate :: Name -&gt; Int\n</code></pre>\n\n<p>I want to be able to swap these functions out for others. For example, swap out <code>fetch</code> for <code>fetchFromDB</code>, or <code>fetchFromStateMonad</code>.</p>\n\n<p>One solution for \"composing\" them could look like this:</p>\n\n<pre><code>ex1 :: (a -&gt; Bool) -&gt; (a -&gt; b) -&gt; (a -&gt; b) -&gt; (a -&gt; b)\n-- or --\nex1 :: (Name -&gt; Bool) -&gt; (Name -&gt; Int) -&gt; (Name -&gt; Int) -&gt; (Name -&gt; Int)\n--     predicate         fetch            generate         result\n</code></pre>\n\n<p>This looks a bit like <code>ifM</code> which gets me closer to a generic solution.</p>\n\n<p>But when I call <code>ex1 \"John\"</code>, it'll make one database call for determining the predicate, and an other to <code>fetch</code> John's number. (of course, this is easy to solve in this narrow case. I'm looking for a more general one).</p>\n\n<pre><code>ex2 :: Name -&gt; (Name -&gt; Bool) -&gt; (Name -&gt; Int) -&gt; (Name -&gt; Int) -&gt; Int\n--     name    predicate         fetch            generate      result         \n</code></pre>\n\n<p>It's still not clear to me how to thread one single database query result through the <code>predicate</code> and <code>fetch</code>, but at least this type signature could allow for it. Now there's the issue of a type signature though which is less like composition, and more ad hoc.</p>\n\n<p>Is there a way to generalize this problem? Where some <code>composition</code> function does everything necessary to allow arbitrary predicates, and functions, to wire themselves up in the way I intended. </p>\n"}, {"tags": ["haskell", "hashmap", "hashtable", "asymptotic-complexity", "hackage"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1472614613, "post_id": 39238989, "comment_id": 65817482, "body": "First off: I believe that you are correct.  There is no pure + O(1) lookup key-value structure.  OTOH, the first question that comes up is one of necessity.  Avoiding monads (including avoiding using IO) is sort of an aesthetic choice that often lacks technical justification - in this case that avoidance is at an obvious cost.  Similarly, the suspicious of premature optimization has already been raised.  If you are so inclined then please do consider a patch to the <code>hashtables</code> library that adds a freeze operation and pure lookup.  Or try a HashMap and see if the performance concretely."}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1472644665, "post_id": 39238989, "comment_id": 65833722, "body": "@ThomasM.DuBuisson I was using a matrix of <code>(i,j)</code> keys for <i>O(1)</i> queries, but the matrix&#39;s dimensions grow far to quickly and the matrix is a sparsely populated upper triangular matrix. The memory requirements were not scalable. I was quite shocked when I couldn&#39;t find a suitable hashtable structure to replace the lookup matrix. There is a <a href=\"https://github.com/gregorycollins/hashtables/issues/35\" rel=\"nofollow noreferrer\">feature request</a> for freezing <code>HashTable</code>, but it is unanswered and I&#39;m not able to construct a pull request at this time."}], "answers": [{"comments": [{"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1472651217, "post_id": 39239080, "comment_id": 65838474, "body": "I didn&#39;t read the header documentation for <code>unordered-containers</code>&#39;s <code>HashMap</code> type, only the documentation for the <code>lookup</code> function so I missed the information you referenced about a large log base. I&#39;ll try using the <code>HashMap</code> type and profile the performance."}], "tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": true, "score": 15, "last_activity_date": 1472604104, "creation_date": 1472604104, "answer_id": 39239080, "question_id": 39238989, "link": "https://stackoverflow.com/questions/39238989/does-a-useful-haskell-hashmap-hashtable-dictionary-library-exist/39239080#39239080", "title": "Does a useful Haskell HashMap/HashTable/Dictionary library exist?", "body": "<p>The library you want is\u2026 <code>unordered-containers</code>. Or just plain old <code>Data.Map</code> from <code>containers</code>, if you\u2019d prefer.</p>\n\n<p>The note in the <a href=\"https://hackage.haskell.org/package/unordered-containers-0.2.7.1/docs/Data-HashSet.html\"><code>unordered-containers</code> documentation</a> explains why you shouldn\u2019t worry about the <em>O</em>(log <em>n</em>) time complexity for lookups:</p>\n\n<blockquote>\n  <p>Many operations have a average-case complexity of <em>O</em>(log <em>n</em>). The implementation uses a large base (i.e. 16) so in practice these operations are constant time.</p>\n</blockquote>\n\n<p>This is a common practice with certain kinds of functional data structures because it allows good sharing properties while also having good time complexities. log<sub>16</sub> still produces <em>very small</em> numbers even for very large <em>n</em>, so you can almost always treat those complexities as \u201ceffectively constant time\u201d.</p>\n\n<p>If this is ever a bottleneck for your application, sure, go with something else, but I find that highly unlikely. After all, log<sub>16</sub>(1,000,000) is a little under 5, so your lookup time is not going to grow very quickly. Processing all that data is going to take up much more time than the overhead of the lookup.</p>\n\n<p>As always: profile first. If you somehow have a problem that absolutely needs the fastest possible hash map in the world, you might need an imperative hash map, but for every case I\u2019ve ever had, the functional ones work just fine.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1574221925, "post_id": 39239192, "comment_id": 104150646, "body": "Rather than <code>fromList</code> as a primitive, you could use <code>runHT :: (forall s. ST s (HashTable s k v)) -&gt; HT k v</code>."}], "tags": [], "owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "is_accepted": false, "score": 11, "last_activity_date": 1472605101, "creation_date": 1472605101, "answer_id": 39239192, "question_id": 39238989, "link": "https://stackoverflow.com/questions/39238989/does-a-useful-haskell-hashmap-hashtable-dictionary-library-exist/39239192#39239192", "title": "Does a useful Haskell HashMap/HashTable/Dictionary library exist?", "body": "<p>You should follow Alexis' suggestion and use <code>unordered-containers</code>. If you really want something that is guaranteed to have <code>\u0398(1)</code> <code>lookup</code>s, you can define your own frozen version of any of the hash table types from <code>hashtables</code> using <code>unsafePerformIO</code>, but this is not very elegant. For example:</p>\n\n<pre><code>module HT\n    ( HT\n    , fromList\n    , lookup\n    ) where\n\nimport qualified Data.HashTable.IO as H\nimport Data.Hashable (Hashable)\nimport Data.Foldable (toList)\nimport System.IO.Unsafe (unsafePerformIO)\nimport Prelude hiding (lookup)\n\nnewtype HT k v = HT (H.BasicHashTable k v)\n\nfromList :: (Foldable t, Eq k, Hashable k) =&gt; t (k, v) -&gt; HT k v\nfromList = HT . unsafePerformIO . H.fromList . toList\n\nlookup :: (Eq k, Hashable k) =&gt; HT k v -&gt; k -&gt; Maybe v\nlookup (HT h) k = unsafePerformIO $ H.lookup h k\n</code></pre>\n\n<p>Both uses of <code>unsafePerformIO</code> above should be safe. For that is crucial that the <code>HT</code> is exported as an abstract type.</p>\n"}, {"tags": [], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "is_accepted": false, "score": 2, "last_activity_date": 1574166071, "creation_date": 1574166071, "answer_id": 58934010, "question_id": 39238989, "link": "https://stackoverflow.com/questions/39238989/does-a-useful-haskell-hashmap-hashtable-dictionary-library-exist/58934010#58934010", "title": "Does a useful Haskell HashMap/HashTable/Dictionary library exist?", "body": "<blockquote>\n  <p>Does there exist some other library which defines types and functions which can construct an immutable constant access query O(1) associative array that is not embedded in a stateful monad?</p>\n</blockquote>\n\n<p>At this point in time, the answer is still no.</p>\n\n<p>As of late-2019 there is an efficient <code>IO</code>-based <a href=\"https://lowerbound.io/blog/2019-10-24_concurrent_hash_table_performance.html\" rel=\"nofollow noreferrer\"><code>hashtable</code></a> package with decent benchmarks.</p>\n\n<p>What you describe seems doable in the same way that pure, immutable <a href=\"http://hackage.haskell.org/package/array/docs/Data-Array.html\" rel=\"nofollow noreferrer\"><code>Data.Array</code></a> construction is possible. See <a href=\"https://gitlab.haskell.org/ghc/packages/array/blob/master/Data/Array/Base.hs\" rel=\"nofollow noreferrer\"><code>Data.Array.Base</code></a> for how this is achieved via <code>unsafe*</code> operators. A <code>Data.Array</code> is defined with a bound, and my initial thought is that a pure, immutable hashtable will potentially have GC problems if it's allowed to grow without bounds.</p>\n"}], "owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2025, "favorite_count": 1, "accepted_answer_id": 39239080, "answer_count": 3, "score": 14, "last_activity_date": 1574166071, "creation_date": 1472603370, "last_edit_date": 1472621780, "question_id": 39238989, "link": "https://stackoverflow.com/questions/39238989/does-a-useful-haskell-hashmap-hashtable-dictionary-library-exist", "title": "Does a useful Haskell HashMap/HashTable/Dictionary library exist?", "body": "<p>I'm looking for a monad-free, constant access query <em>O(1)</em> associative array.</p>\n\n<p>Consider the hypothetical type:</p>\n\n<pre><code>data HT k v = ???\n</code></pre>\n\n<p>I want to construct an immutable structure once:</p>\n\n<pre><code>fromList :: Foldable t, Hashable k =&gt; t (k,v) -&gt; HT k v\n</code></pre>\n\n<p>I want to subsequently query it repeatedly with constant time access::</p>\n\n<pre><code>lookup :: Hashable k =&gt; HT k v -&gt; k -&gt; Maybe v\n</code></pre>\n\n<p>There appears to be two candidate libraries which fall short:</p>\n\n<ul>\n<li><p><a href=\"https://hackage.haskell.org/package/unordered-containers\" rel=\"noreferrer\"><code>unordered-containers</code></a></p></li>\n<li><p><a href=\"https://hackage.haskell.org/package/hashtables\" rel=\"noreferrer\"><code>hashtables</code></a></p></li>\n</ul>\n\n<h3><code>unordered-containers</code></h3>\n\n<p><code>unordered-containers</code> contains both strict and lazy variants of the type <code>HashMap</code>. Both <code>HashMap</code>s have <em>O(log n)</em> queries as documented by the <a href=\"https://hackage.haskell.org/package/unordered-containers-0.2.7.1/docs/Data-HashMap-Lazy.html#v:lookup\" rel=\"noreferrer\"><code>lookup</code></a> function. This query access time appears to be due to the construction of the <code>HashMap</code> types, which have an internal tree structure allowing for <em>O(log n)</em> <a href=\"https://hackage.haskell.org/package/unordered-containers-0.2.7.1/docs/Data-HashMap-Lazy.html#v:insert\" rel=\"noreferrer\"><code>insert</code></a> functionality. An understandable design trade off for many use-cases, but since I don't need a mutable <code>HashMap</code> this tradeoff hampers my use-case.</p>\n\n<h3><code>hashtables</code></h3>\n\n<p><code>hashtables</code> contains a <code>HashTable</code> type-class and three instance types with varying table constructions strategies. This library's type-class defines a constant time <em>O(1)</em> <a href=\"https://hackage.haskell.org/package/hashtables-1.2.1.0/docs/Data-HashTable-Class.html#v:lookup\" rel=\"noreferrer\"><code>lookup</code></a> function definition, but it is eternally embedded in the <code>ST</code> monad. There is no way to \"freeze\" the stateful <code>HashTable</code> implementations and have a <code>lookup</code> function that is not embedded of a stateful monad. The library's type-class interface is well designed when the entire computation is wrapped in a state monad, but this design is unsuitable for my use-case.</p>\n\n<hr>\n\n<p>Does there exist some other library which defines types and functions which can construct an immutable constant access query <em>O(1)</em> associative array that is not embedded in a stateful monad?</p>\n\n<p>Does there exist some way to wrap or modify these existing hashing-based libraries to produce an immutable constant access query <em>O(1)</em> associative array that is not embedded in a stateful monad?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1472597906, "post_id": 39237723, "comment_id": 65813768, "body": "This seems very strange. It would seem slightly less strange if you wanted to produce, say, <code>Map Integer (Either Integer String)</code>, making it explicit whether the value is the final one or a reference. But even with that change, it&#39;s a bit odd. Why do you need this?"}, {"owner": {"reputation": 3852, "user_id": 155191, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/a7azq.jpg?s=128&g=1", "display_name": "Leandro T. C. Melo", "link": "https://stackoverflow.com/users/155191/leandro-t-c-melo"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1472605288, "post_id": 39237723, "comment_id": 65815535, "body": "Indeed... This is an adaptation of my actual case, a minimum example I could come up with to show the essence of my doubt: updating a secondary data-structure while mapping/folding over a map."}], "answers": [{"comments": [{"owner": {"reputation": 3852, "user_id": 155191, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/a7azq.jpg?s=128&g=1", "display_name": "Leandro T. C. Melo", "link": "https://stackoverflow.com/users/155191/leandro-t-c-melo"}, "edited": false, "score": 0, "creation_date": 1472605179, "post_id": 39237885, "comment_id": 65815502, "body": "Thanks, I was not aware of mapAccumWithKey."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 3, "last_activity_date": 1472595521, "last_edit_date": 1472595521, "creation_date": 1472595198, "answer_id": 39237885, "question_id": 39237723, "link": "https://stackoverflow.com/questions/39237723/haskell-folding-over-a-map-while-updating-a-secondary-map/39237885#39237885", "title": "Haskell: folding over a map, while updating a secondary map", "body": "<p>I think the best you can do is using <a href=\"http://hackage.haskell.org/package/containers-0.5.7.1/docs/Data-Map-Lazy.html#v:mapAccumWithKey\" rel=\"nofollow\"><code>mapAccumWithKey</code></a>. Then, something like this:</p>\n\n<pre><code>deduplicate :: Map Int String -&gt; Map Int String\ndeduplicate = snd . Map.mapAccumWithKey go Map.empty\n  where\n    go accum k v = case Map.lookup v accum of\n                    Nothing -&gt; (Map.insert v (show k) accum, v)\n                    Just v' -&gt; (accum, v')\n</code></pre>\n\n<p>This maps the keys one by one while threading through a <code>Map String String</code> which keeps track of values already seen and their corresponding keys. There is obviously some cooler stuff to be done if you want to try something parallel, but sequentially this is optimal - it should be <code>O(n log n)</code> and you need at least that to detect shared keys in the first place.</p>\n\n<hr>\n\n<p>With <code>names' = deduplicate names</code>, I get the output <code>fromList [(1,\"foo\"),(2,\"bar\"),(3,\"1\")]</code>.</p>\n"}], "owner": {"reputation": 3852, "user_id": 155191, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/a7azq.jpg?s=128&g=1", "display_name": "Leandro T. C. Melo", "link": "https://stackoverflow.com/users/155191/leandro-t-c-melo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 235, "favorite_count": 0, "accepted_answer_id": 39237885, "answer_count": 1, "score": 0, "last_activity_date": 1472605393, "creation_date": 1472594285, "last_edit_date": 1472605393, "question_id": 39237723, "link": "https://stackoverflow.com/questions/39237723/haskell-folding-over-a-map-while-updating-a-secondary-map", "title": "Haskell: folding over a map, while updating a secondary map", "body": "<p>Consider the following map: <code>Map.fromList [(1,\"foo\"), (2,\"bar\"), (3,\"foo\")]</code></p>\n\n<p>I'd like to produce: <code>Map.fromList [(1,\"foo\"), (2,\"bar\"), (3,\"1\")]</code>. The last key, 3, previously associated with \"foo\", is now associated with \"1\" - so by following this value (and converting the string into a number) I can still arrive at \"foo\". If the result was <code>Map.fromList [(1,\"3\"), (2,\"bar\"), (3,\"foo\")]</code>, it would also be OK.</p>\n\n<p>Ideally I'd implement that by folding over the original map. Along with it, I'd incrementally populate a secondary (reverse) map with the elements (\"foo\", 1), (\"bar\", 2), etc. If the current key is found in the secondary map, instead of inserting it into the final map, I'd insert its associated value.</p>\n\n<p>Is there a simple/elegant way to sequence that, without multiple passes or a Monad?</p>\n\n<pre><code>main = do\n     let names = Map.fromList [(1,\"foo\"), (2,\"bar\"), (3,\"foo\")]\n         link acc k v = -- insert into map1, depending map2's lookup\n         names' = Map.foldlWithKey link (Map.empty, Map.empty) names\n     putStrLn $ show names'\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "edited": false, "score": 2, "creation_date": 1472580868, "post_id": 39234327, "comment_id": 65805923, "body": "Are you just trying to print two lines? Your <code>foo</code> function is pure so it cannot have side effects: it can only receive a string value and return a string. It can&#39;t affect the outside world."}, {"owner": {"reputation": 4510, "user_id": 6224823, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-eVoU_E2fMho/AAAAAAAAAAI/AAAAAAAAAC4/7qlAOwlIJkM/photo.jpg?sz=128", "display_name": "Olian04", "link": "https://stackoverflow.com/users/6224823/olian04"}, "reply_to_user": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "edited": false, "score": 0, "creation_date": 1472580936, "post_id": 39234327, "comment_id": 65805956, "body": "@ChadGilbert I&#39;m trying to replace a set of characters in a String with another set of characters. I&#39;m not printing anything."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1472581169, "post_id": 39234327, "comment_id": 65806089, "body": "@Olian04 Can you add some examples in your question ?"}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 1, "creation_date": 1472581208, "post_id": 39234327, "comment_id": 65806118, "body": "Are you trying to do two consecutive replacements? It looks like you want <code>replace &quot;uou&quot; &quot;u&quot; (replace &quot;aoa&quot; &quot;a&quot; s)</code>. You probably don&#39;t want to use <code>do</code> notation for this."}, {"owner": {"reputation": 21248, "user_id": 223274, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2a6aad3c8269beb376b3e2b0bd29bec4?s=128&d=identicon&r=PG", "display_name": "Ian Henry", "link": "https://stackoverflow.com/users/223274/ian-henry"}, "edited": false, "score": 1, "creation_date": 1472582677, "post_id": 39234327, "comment_id": 65806884, "body": "Another common way to write this would be as a composition of two <code>replace</code> calls: <code>foo = replace &quot;uou&quot; &quot;u&quot; . replace &quot;aoa&quot; &quot;a&quot;</code>. This scales a little better to arbitrarily many <code>replace</code> calls, but there are other ways that are even nicer."}], "answers": [{"comments": [{"owner": {"reputation": 4510, "user_id": 6224823, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-eVoU_E2fMho/AAAAAAAAAAI/AAAAAAAAAC4/7qlAOwlIJkM/photo.jpg?sz=128", "display_name": "Olian04", "link": "https://stackoverflow.com/users/6224823/olian04"}, "edited": false, "score": 2, "creation_date": 1472581394, "post_id": 39234529, "comment_id": 65806215, "body": "ohh, so the first replace is using the answer from the second replace as its parameter?"}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 4510, "user_id": 6224823, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-eVoU_E2fMho/AAAAAAAAAAI/AAAAAAAAAC4/7qlAOwlIJkM/photo.jpg?sz=128", "display_name": "Olian04", "link": "https://stackoverflow.com/users/6224823/olian04"}, "edited": false, "score": 0, "creation_date": 1472581496, "post_id": 39234529, "comment_id": 65806282, "body": "Correct, based on your question, that&#39;s what I assumed you were after."}, {"owner": {"reputation": 4510, "user_id": 6224823, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-eVoU_E2fMho/AAAAAAAAAAI/AAAAAAAAAC4/7qlAOwlIJkM/photo.jpg?sz=128", "display_name": "Olian04", "link": "https://stackoverflow.com/users/6224823/olian04"}, "edited": false, "score": 0, "creation_date": 1472581581, "post_id": 39234529, "comment_id": 65806319, "body": "So if there are lets say, more than one occurrence, or no occurrence of &quot;aoa&quot;. Will this still work?"}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 4510, "user_id": 6224823, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-eVoU_E2fMho/AAAAAAAAAAI/AAAAAAAAAC4/7qlAOwlIJkM/photo.jpg?sz=128", "display_name": "Olian04", "link": "https://stackoverflow.com/users/6224823/olian04"}, "edited": false, "score": 0, "creation_date": 1472581721, "post_id": 39234529, "comment_id": 65806386, "body": "That depends on your definition of <code>replace</code>. Is that a custom function or are you importing it from another package?"}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 9, "last_activity_date": 1472581213, "creation_date": 1472581213, "answer_id": 39234529, "question_id": 39234327, "link": "https://stackoverflow.com/questions/39234327/do-multiple-things-in-a-function/39234529#39234529", "title": "&quot;do&quot; multiple things in a function", "body": "<p>You don't need to use <code>do</code> notation to achieve a simple string replacement. But since strings are Monads, the compiler is assuming that you meant to use the string as a Monad and giving you an error message with that assumption.</p>\n\n<p>If you want to simply chain together two calls to <code>replace</code>, you could write:</p>\n\n<pre><code>foo s = replace \"uou\" \"u\" (replace \"aoa\" \"a\" s)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 62902, "user_id": 90511, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/nmOPo.png?s=128&g=1", "display_name": "hugomg", "link": "https://stackoverflow.com/users/90511/hugomg"}, "is_accepted": false, "score": 2, "last_activity_date": 1472581427, "creation_date": 1472581427, "answer_id": 39234584, "question_id": 39234327, "link": "https://stackoverflow.com/questions/39234327/do-multiple-things-in-a-function/39234584#39234584", "title": "&quot;do&quot; multiple things in a function", "body": "<p>do-notation is for \"monad stuff\". In this case I would prefer to just chain function calls together.</p>\n\n<pre><code>foo :: String -&gt; String\nfoo s =\n    let s' = replace \"aoa\" \"a\" s in\n    replace \"uou\" \"u\" s'\n</code></pre>\n\n<p>Since Haskell variables are immutable, we cannot update <code>s</code> with a new value and must instead create a new variable every time. A common idiom is to add a <code>'</code> to the end of a variable name - its a valid variable name in Haskell.</p>\n\n<p>You could also do it like this:</p>\n\n<pre><code>foo :: String -&gt; String\nfoo s =\n    let s'  = replace \"aoa\" \"a\" s  in\n    let s'' = replace \"uou\" \"u\" s' in\n    s''\n</code></pre>\n"}], "owner": {"reputation": 4510, "user_id": 6224823, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-eVoU_E2fMho/AAAAAAAAAAI/AAAAAAAAAC4/7qlAOwlIJkM/photo.jpg?sz=128", "display_name": "Olian04", "link": "https://stackoverflow.com/users/6224823/olian04"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2273, "favorite_count": 0, "accepted_answer_id": 39234529, "answer_count": 2, "score": 1, "last_activity_date": 1472581427, "creation_date": 1472580483, "last_edit_date": 1472581324, "question_id": 39234327, "link": "https://stackoverflow.com/questions/39234327/do-multiple-things-in-a-function", "title": "&quot;do&quot; multiple things in a function", "body": "<p><strong>I'm new.</strong></p>\n\n<p>So i got this working: </p>\n\n<pre><code>foo :: String -&gt; String\nfoo s = do replace \"aoa\" \"a\" s\n</code></pre>\n\n<p><em>(Typing <code>foo \"aoa\"</code> returns <code>\"a\"</code>)</em><br>\nBut when i add another replace: </p>\n\n<pre><code>foo :: String -&gt; String\nfoo s = do replace \"aoa\" \"a\" s\n           replace \"uou\" \"u\" s\n</code></pre>\n\n<p><em>(Typing <code>foo \"aoa\"</code> returns <code>\"aoa\"</code>)</em></p>\n\n<p>Everything breaks and i get this warning: </p>\n\n<pre><code>A do-notation statement discarded a result of type \u2018Char\u2019\nSuppress this warning by saying \u2018_ &lt;- replace \"aoa\" \"a\" s\u2019\nor by using the flag -fno-warn-unused-do-bind\n</code></pre>\n\n<p>Since i don't want to suppress the warning, this error message says nothing to me.</p>\n\n<p>What am i missing? </p>\n\n<p><strong>Edit1</strong><br>\nExamples:   </p>\n\n<pre><code>\"aoaaoa\" -&gt; \"aa\"   //Affected\n\"uouaoa\" -&gt; \"ua\"   //Affected\n\"aua\" -&gt; \"aua\"     //Not affected\n</code></pre>\n"}, {"tags": ["haskell", "unicode", "character-encoding"], "comments": [{"owner": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 0, "creation_date": 1472590082, "post_id": 39233848, "comment_id": 65810784, "body": "Trying to understand what you&#39;re asking for here, you&#39;re looking for 1) a function <code>Text -&gt; Text</code> that 2) you are assuming will only be passed a value containing <code>Data.Char.isLatin1</code> matching <code>Char</code>s in order to 3) replace <code>not . Data.Char.isAscii</code> <code>Char</code>s with <code>Text</code> strings containing that <code>Char</code>&#39;s c-style four digit form backslash-u encoding representation? E.g., <code>f &quot;El Ni&#241;o&quot; = &quot;El Ni\\\\u00f1o&quot;</code>, nb the escaped backslash."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 1099, "user_id": 6513157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d45981b71a14222513f57e8566e4b8b?s=128&d=identicon&r=PG&f=1", "display_name": "R B", "link": "https://stackoverflow.com/users/6513157/r-b"}, "edited": false, "score": 0, "creation_date": 1472593050, "post_id": 39233848, "comment_id": 65812123, "body": "@RowanBlush That is an excellent summary, yes."}], "answers": [{"tags": [], "owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "is_accepted": true, "score": 3, "last_activity_date": 1472826246, "last_edit_date": 1472826246, "creation_date": 1472590383, "answer_id": 39236910, "question_id": 39233848, "link": "https://stackoverflow.com/questions/39233848/convert-text-to-unicode-escape-sequence/39236910#39236910", "title": "Convert Text to Unicode Escape Sequence", "body": "<p>How about this:</p>\n\n<pre><code>import Text.Printf (printf)\n\nencodeUnicode16 :: String -&gt; String\nencodeUnicode16 = concatMap escapeChar\n  where\n    escapeChar c\n        | ' ' &lt;= c &amp;&amp; c &lt;= 'z' = [c]\n        | otherwise =\n            printf \"\\\\u%04x\" (fromEnum c)\n</code></pre>\n\n<p>I ghci, you can use it as follows:</p>\n\n<pre><code>&gt; putStrLn $ encodeUnicode16 \"\u00d1\"\n\\u00d1\n</code></pre>\n\n<p>Note that if you don't use <code>putStrLn</code> it will get escaped twice:</p>\n\n<pre><code>&gt; encodeUnicode16 \"\u00d1\"\n\"\\\\u00d1\"\n</code></pre>\n\n<p>This is because ghci will implicitly add a <code>print</code> in front of the command.</p>\n\n<p><strong>Edit</strong>: I missed that part that you have a <code>Text</code> and not a <code>String</code>. Here's the same code for <code>Text</code>:</p>\n\n<pre><code>import Data.Text (Text)\nimport qualified Data.Text as T\nimport qualified Data.Text.IO as T\nimport Text.Printf (printf)\n\nencodeUnicode16 :: Text -&gt; Text\nencodeUnicode16 = T.concatMap escapeChar\n  where\n    escapeChar c\n        | ' ' &lt;= c &amp;&amp; c &lt;= 'z' = T.singleton c\n        | otherwise =\n            T.pack $ printf \"\\\\u%04x\" (fromEnum c)\n</code></pre>\n\n<p>Again, you want to use <code>T.putStrLn</code> to avoid double escaping everything.</p>\n"}], "owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 709, "favorite_count": 1, "accepted_answer_id": 39236910, "answer_count": 1, "score": 2, "last_activity_date": 1472939611, "creation_date": 1472578824, "last_edit_date": 1472939611, "question_id": 39233848, "link": "https://stackoverflow.com/questions/39233848/convert-text-to-unicode-escape-sequence", "title": "Convert Text to Unicode Escape Sequence", "body": "<p>I have a <code>Text</code> object that contains some number of Latin characters that needs to be converted to a unicode escape sequence of the format <code>\\u####</code> with <code>#</code> being hex digits</p>\n\n<p>As described <a href=\"https://stackoverflow.com/questions/24953125/how-to-convert-unicode-escape-sequence-to-unicode-string-in-haskell\">here</a>, haskell easily converts strings to escape sequences and vice versa. However, it will only go to the decimal representation. For example, </p>\n\n<pre><code>&gt; let s = \"\u00d1\"\n&gt; s\n\"\\209\"\n</code></pre>\n\n<p>Is there a way to specify the escape sequence encoding to force it to spit out in the correct format? i.e</p>\n\n<pre><code>&gt; let s = encodeUnicode16 \"\u00d1\"\n&gt; s\n\"\\u00d1\"\n</code></pre>\n"}, {"tags": ["c++", "haskell", "c++14", "existential-type"], "comments": [{"owner": {"reputation": 82712, "user_id": 598696, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/k1Yif.png?s=128&g=1", "display_name": "Vittorio Romeo", "link": "https://stackoverflow.com/users/598696/vittorio-romeo"}, "edited": false, "score": 0, "creation_date": 1472576650, "post_id": 39233175, "comment_id": 65803631, "body": "Just to make sure I understand: do you want <code>TreeHeight</code> to be &quot;erased&quot; from the type of the parent node <i>(to not be part of its type)</i>? If so, you need some sort of run-time dispatch"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 5, "creation_date": 1472576829, "post_id": 39233175, "comment_id": 65803736, "body": "I am not a C++ expert, but I think C++ needs to instantiate templates at compile time in all the forms that will possibly used at runtime. Since the tree height is (pragmatically) unbounded, we can not hope to instantiate all its possible values in the template argument."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1472577207, "post_id": 39233175, "comment_id": 65803962, "body": "@chi, it&#39;s pragmatically bounded by a few bits more than a pointer, right? Now that may end up trying to generate code for every possible tree shape and run the compiler right out of disk space... I don&#39;t know enough about what&#39;s going on to say."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1472579680, "post_id": 39233175, "comment_id": 65805311, "body": "@dfeuer Yep, I&#39;d regard that as theoretically bounded (it&#39;s a finite-size type) but practically the bound is so large that one can not hope to realistically enumerate all the cases."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1472580887, "post_id": 39233175, "comment_id": 65805932, "body": "IIRC, in the Okasaki book he doesn&#39;t need to use type-level numerals, at the cost of some efficiency (still log-complexity, though). To try something like this in C++, I&#39;d try to see if OOP subtyping can somehow help. Also, we don&#39;t have algebraic types (let alone GADTs) in C++, yet we can encode them using a Church-like representation (the &quot;visitor pattern&quot; in OOP-speak)."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1472913448, "post_id": 39233175, "comment_id": 65948620, "body": "chi: <a href=\"https://wiki.rice.edu/confluence/download/attachments/2761212/Okasaki-Red-Black.pdf\" rel=\"nofollow noreferrer\">okasaki didn&#39;t</a>, but <a href=\"https://gist.github.com/rampion/2659812\" rel=\"nofollow noreferrer\">I did</a>"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1472913651, "post_id": 39233175, "comment_id": 65948691, "body": "chi: I think your first comment is correct, so verifying the tree depth statically is probably not practical."}], "answers": [{"comments": [{"owner": {"reputation": 65373, "user_id": 819272, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/o7w9X.png?s=128&g=1", "display_name": "TemplateRex", "link": "https://stackoverflow.com/users/819272/templaterex"}, "edited": false, "score": 0, "creation_date": 1472579777, "post_id": 39234090, "comment_id": 65805360, "body": "TIL tomfoolery, +1 :)"}, {"owner": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "reply_to_user": {"reputation": 65373, "user_id": 819272, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/o7w9X.png?s=128&g=1", "display_name": "TemplateRex", "link": "https://stackoverflow.com/users/819272/templaterex"}, "edited": false, "score": 0, "creation_date": 1472580335, "post_id": 39234090, "comment_id": 65805651, "body": "@chi So, you think the OP wants a &quot;I store something that passes guarantee <code>Z&lt;Y&gt;</code> with interface <code>X</code>&quot;?  That can be written."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 5, "creation_date": 1472580608, "post_id": 39234090, "comment_id": 65805787, "body": "I&#39;m still evaluating whether this approach really can achieve a similar level of static guarantees. Maybe you can make it work for known-at-compile-time RB trees (think <code>constexpr</code>, rhougly) but not for RB tree which are built at runtime. E.g. we can not write an insert routine, I think."}], "tags": [], "owner": {"reputation": 233737, "user_id": 1774667, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b6516fec2c5997b867545d285304cf12?s=128&d=identicon&r=PG", "display_name": "Yakk - Adam Nevraumont", "link": "https://stackoverflow.com/users/1774667/yakk-adam-nevraumont"}, "is_accepted": false, "score": 4, "last_activity_date": 1472580614, "last_edit_date": 1472580614, "creation_date": 1472579662, "answer_id": 39234090, "question_id": 39233175, "link": "https://stackoverflow.com/questions/39233175/equivalent-of-existential-quantification-in-c/39234090#39234090", "title": "Equivalent of existential quantification in C++?", "body": "<pre><code>template&lt;class K, class T&gt;\nstruct NodeView {\n  virtual NodeView const* left() const = 0;\n  virtual NodeView const* right() const = 0;\n  virtual K const&amp; key() const = 0;\n  virtual T const&amp; value() const = 0;\nprivate:\n  ~NodeView() {} // no deleting it!\n};\n</code></pre>\n\n<p>this is an interface.</p>\n\n<p>Have your tree nodes implement this interface.  They are permitted and encouraged to return <code>nullptr</code> when they have no child on one side or the other.</p>\n\n<p>In the base structure, take a root node as a template parameter.  Check that it is black using template tomfoolery.</p>\n\n<p>Use <code>make_shared</code> to store it in a <code>std::shared_ptr</code></p>\n\n<pre><code>auto tree = std::make_shared&lt;std::decay_t&lt;decltype(tree)&gt;&gt;(decltype(tree)(tree));\nstd::shared_ptr&lt;NodeView const&gt; m_tree = std::move(tree);\n</code></pre>\n\n<p>Where the <code>m_tree</code> member is a member of your root management structure.</p>\n\n<p>You now have read-only access to a generic tree.  It is guaranteed to be a balanced red-black tree at compile time by the code that stores it.  At run time, it is just guaranteed to be <em>a tree</em>.</p>\n\n<p>You could leak more guarantee information into the interface I wrote above, but that would clutter the interface beyond what a reader usually needs to know.  (like, have a different <code>Red</code> and <code>Black</code> interface node type).</p>\n\n<p>Now if the body of one short function is too much to trust, and you'd rather trust a wall of template code, we can do this:</p>\n\n<pre><code>template&lt;template&lt;class...&gt;class Test, class T&gt;\nstruct restricted_shared_ptr {\n  template&lt;class U,\n    std::enable_if_t&lt; Test&lt;U&gt;{}, int&gt; = 0\n  &gt;\n  restricted_shared_ptr( std::shared_ptr&lt;U&gt; pin ):ptr(std::move(pin)) {}\n  restricted_shared_ptr(restricted_shared_ptr const&amp;)=default;\n  restricted_shared_ptr(restricted_shared_ptr &amp;&amp;)=default;\n  restricted_shared_ptr&amp; operator=(restricted_shared_ptr const&amp;)=default;\n  restricted_shared_ptr&amp; operator=(restricted_shared_ptr &amp;&amp;)=default;\n  restricted_shared_ptr() = default;\n  T* get() const { return ptr.get(); }\n  explicit operator bool() const { return (bool)ptr; }\n  T&amp; operator*() const { return *ptr.get(); }\n  T* operator-&gt;() const { return ptr.get(); }\nprivate:\n  std::shared_ptr&lt;T&gt; ptr;\n};\n</code></pre>\n\n<p>Now we just write an arbitrary template check that says \"this is good enough to satisfy me\".</p>\n\n<p>And store a <code>restricted_shared_ptr&lt; MyCheck, NodeView&lt;K,T&gt; const &gt;</code>.  There is no way to store the a type within this shared pointer that does not pass <code>MyCheck</code> without undefined behavior.</p>\n\n<p>Here, you need to trust <code>MyCheck</code>'s constructor to do what it says it does.</p>\n\n<pre><code>template&lt;class T&gt;\nstruct IsBlackNode:std::false_type{};\n\ntemplate&lt;class K, class V, std::size_t Height, class Left, class Right&gt;\nstruct IsBlackNode&lt; BlackNode&lt;K, V, Height, Left, Right&gt; &gt;:std::true_type{};\n</code></pre>\n\n<p>which is a requirement that only <code>BlackNode</code>s can pass.</p>\n\n<p>So a <code>restricted_shared_ptr&lt; IsBlackNode, NodeView&lt;K, T&gt; const &gt;</code> is a shared pointer to something that passes the <code>IsBlackNode</code> test <em>and</em> implements the <code>NodeView&lt;K,T&gt;</code> interface.</p>\n"}, {"comments": [{"owner": {"reputation": 65373, "user_id": 819272, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/o7w9X.png?s=128&g=1", "display_name": "TemplateRex", "link": "https://stackoverflow.com/users/819272/templaterex"}, "edited": false, "score": 3, "creation_date": 1472580450, "post_id": 39234231, "comment_id": 65805713, "body": "how is the height invariant guaranteed at compile-time?"}, {"owner": {"reputation": 55059, "user_id": 212858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1166c87b6f3fc2e6746da96b60fefb46?s=128&d=identicon&r=PG", "display_name": "Useless", "link": "https://stackoverflow.com/users/212858/useless"}, "reply_to_user": {"reputation": 65373, "user_id": 819272, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/o7w9X.png?s=128&g=1", "display_name": "TemplateRex", "link": "https://stackoverflow.com/users/819272/templaterex"}, "edited": false, "score": 0, "creation_date": 1472580605, "post_id": 39234231, "comment_id": 65805784, "body": "it isn&#39;t, except that it&#39;s guaranteed by the appropriate constructor, so that you can&#39;t have constructed a given member of the variant without having checked it."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1472910952, "post_id": 39234231, "comment_id": 65947955, "body": "&quot;IIUC, your Haskell Node type doesn&#39;t have four type parameters, but two&quot;. Actually it does have 4. <code>data Node (color :: Color) (height :: Nat) key value</code> is pretty much a direct translation of <code>template &lt;color Color, size_t Height, typename Key, typename Value&gt; struct Node</code>"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1472911672, "post_id": 39234231, "comment_id": 65948150, "body": "&quot;The tricky part is there&#39;s no direct support for your different constructors&quot; - unless I added a virtual function to <code>Node</code>, which would provide the runtime information needed to differentiate between the various subclasses."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1472911774, "post_id": 39234231, "comment_id": 65948186, "body": "I really like the use of an overloaded <code>operator()</code> to replicate pattern matching. That&#39;s sweet!"}, {"owner": {"reputation": 55059, "user_id": 212858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1166c87b6f3fc2e6746da96b60fefb46?s=128&d=identicon&r=PG", "display_name": "Useless", "link": "https://stackoverflow.com/users/212858/useless"}, "edited": false, "score": 0, "creation_date": 1473015825, "post_id": 39234231, "comment_id": 65972985, "body": "Neither color nor height are <i>type</i> parameters though, their types are fixed: they&#39;re non-type parameters"}], "tags": [], "owner": {"reputation": 55059, "user_id": 212858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1166c87b6f3fc2e6746da96b60fefb46?s=128&d=identicon&r=PG", "display_name": "Useless", "link": "https://stackoverflow.com/users/212858/useless"}, "is_accepted": false, "score": 4, "last_activity_date": 1472581989, "last_edit_date": 1472581989, "creation_date": 1472580184, "answer_id": 39234231, "question_id": 39233175, "link": "https://stackoverflow.com/questions/39233175/equivalent-of-existential-quantification-in-c/39234231#39234231", "title": "Equivalent of existential quantification in C++?", "body": "<h2>Note</h2>\n\n<p>Yakk's answer is more idiomatic C++ - this answer shows how to write (or at least begin writing) something more similar to the Haskell version.</p>\n\n<p>When you see how much C++ is required to emulate Haskell, you may choose to use the native idioms instead.</p>\n\n<h2>tl;dr</h2>\n\n<p>most of your Haskell invariants (and properties) aren't really expressed statically in the type at all, but in the (runtime) code of the various constructors. The type system helps by guaranteeing one of those constructors really ran, and tracking which one it was for pattern-matching dispatch.</p>\n\n<hr>\n\n<p>IIUC, your Haskell <code>Node</code> type doesn't have four type parameters, but two:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Node (color :: Color) (height :: Nat) key value where\n</code></pre>\n\n<p>fixes the types of the color and height - only the key and value types are undetermined. All four are records, but two of those records have fixed types.</p>\n\n<p>So, the closest simple translation would be</p>\n\n<pre><code>template &lt;typename Key, typename Value&gt;\nstruct Node {\n    Color color_;\n    size_t height_;\n    Key key_;\n    Value val_;\n};\n</code></pre>\n\n<p>The tricky part is there's no direct support for your different constructors - that's runtime information Haskell tracks for you.</p>\n\n<p>So, a <code>Leaf</code> <em>is a</em> <code>Node</code>, whose constructor initialized the color and height fields for you, but the constructor used is also tracked as a part of the object created.</p>\n\n<p>The closest equivalent to this, and the pattern-matching it gives you, would be a variant type like <a href=\"http://www.boost.org/libs/variant/\" rel=\"nofollow\">Boost.Variant</a>, giving you something like:</p>\n\n<pre><code>// underlying record storage\ntemplate &lt;typename Key, typename Value&gt;\nstruct NodeBase {\n    Color color_;\n    size_t height_;\n    Key key_;\n    Value val_;\n};\n\ntemplate &lt;typename Key, typename Value&gt;\nstruct Leaf: public NodeBase&lt;Key,Value&gt; {\n    Leaf(Key k, Value v) : NodeBase{Color::Black, 0, k, v} {}\n    // default other ctors here\n};\n// similarly for your BlackBranch and RedBranch constructors\n\ntemplate &lt;typename Key, typename Value&gt;\nusing Node = boost::variant&lt;Leaf&lt;Key,Value&gt;,\n                            RedBranch&lt;Key,Value&gt;,\n                            BlackBranch&lt;Key,Value&gt;&gt;;\n</code></pre>\n\n<p>note again that your Branch type has records for leftColor, rightColor, childHeight, and that only the key and value create type parameters.</p>\n\n<p>Finally, where you'd use pattern matching to write a function on your different Node constructors in Haskell, you'd use</p>\n\n<pre><code>template &lt;typename Key, typename Value&gt;\nstruct myNodeFunction {\n    void operator() (Leaf &amp;l) {\n        // use l.key_, l.value_, confirm l.height_==0, etc.\n    }\n    void operator() (RedBranch &amp;rb) {\n        // use rb.key_, rb.value_, confirm rb.color_==Color::Red, etc.\n    }\n    void operator() (BlackBranch &amp;bb) {\n        // you get the idea\n    }\n};\n</code></pre>\n\n<p>and apply it like:</p>\n\n<pre><code>boost::apply_visitor(myNodeFunction&lt;K,V&gt;(), myNode);\n</code></pre>\n\n<p>or, if you're using this pattern a lot, you can wrap it up as</p>\n\n<pre><code>template &lt;typename Key, typename Value,\n          template Visitor&lt;typename,typename&gt; &gt;\nvoid apply(Node&lt;Key,Value&gt; &amp;node)\n{\n    boost::apply_visitor(Visitor&lt;Key,Value&gt;{}, node);\n}\n</code></pre>\n"}], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 333, "favorite_count": 1, "answer_count": 2, "score": 14, "last_activity_date": 1472581989, "creation_date": 1472576341, "last_edit_date": 1472577252, "question_id": 39233175, "link": "https://stackoverflow.com/questions/39233175/equivalent-of-existential-quantification-in-c", "title": "Equivalent of existential quantification in C++?", "body": "<p>To help teach myself C++, I'm working on a red-black tree implementation.  Coming from\nHaskell, I, thought it'd be interesting to see if I could enforce the <a href=\"https://en.wikipedia.org/wiki/Red%E2%80%93black_tree#Properties\">properties of a\nred-black tree</a>\nstatically in C++'s type system:</p>\n\n<blockquote>\n  <ol>\n  <li>A node is either red or black.</li>\n  <li>The root is black [...]</li>\n  <li>All leaves (NIL) are black.</li>\n  <li>If a node is red, then both its children are black.</li>\n  <li>Every path from a given node to any of its descendant NIL nodes contains\n  the same number of black nodes. [...]</li>\n  </ol>\n</blockquote>\n\n<p>I figured out how to craft the types for the nodes of the tree to satisfy constraints 1,\n3, 4, and 5 using templates:</p>\n\n<pre><code>template &lt;typename Key, typename Value&gt;\nclass RedBlackTree {\nprivate:\n  enum class color { Black, Red };\n\n  // [1. A node is either red or black]\n  template &lt;color Color, size_t Height&gt;\n  struct Node {};\n\n  // [3. All leaves are black]\n  struct Leaf : public Node&lt;color::Black, 0&gt; {};\n\n  template &lt;color Left, color Right, size_t ChildHeight&gt;\n  struct Branch {\n  public:\n    template &lt;color ChildColor&gt;\n    using Child = unique_ptr&lt;Node&lt;ChildColor, ChildHeight&gt;&gt;;\n\n    Key key;\n    Value value;\n    Child&lt;Left&gt; left;\n    Child&lt;Right&gt; right;\n\n    Branch(Key&amp;&amp; key, Value&amp;&amp; value, Child&lt;Left&gt; left, Child&lt;Right&gt; right) :\n      key { key }, value { value }, left { left }, right { right } {}\n  };\n\n  // [4. If a node is red, then both its children are black.]\n  // [5. Every path from a given node to any of its descendant NIL nodes contains \n  //     the same number of black nodes.]\n  template &lt;size_t Height&gt;\n  struct RedBranch: public Node&lt;color::Red, Height&gt;\n                  , public Branch&lt;color::Black, color::Black, Height&gt; {\n  public:\n    using RedBlackTree::Branch;\n  };\n\n  // [5. Every path from a given node to any of its descendant NIL nodes contains \n  //     the same number of black nodes.]\n  template &lt;size_t Height, color Left, color Right&gt;\n  struct BlackBranch: public Node&lt;color::Black, Height&gt;\n                    , public Branch&lt;Left, Right, Height-1&gt; {\n  public:\n    using RedBlackTree::Branch;\n  };\n\n  // ...\n};\n</code></pre>\n\n<p>Where I'm stymied is giving the <code>root</code> pointer that will be stored in the <code>RedBlackTree</code>\ninstance a type that satisfied property 2 but is still useful.</p>\n\n<p>What I want is something like:</p>\n\n<pre><code>template &lt;typename Key, typename Value&gt;\nclass RedBlackTree {\n  //...\n  unique_ptr&lt;Node&lt;color::Black,?&gt;&gt; root = std::make_unique&lt;Leaf&gt;();\n  //...\n}\n</code></pre>\n\n<p>(to borrow syntax from Java), so I can wildcard over the height of the tree.  This of\ncourse, doesn't work.</p>\n\n<p>I could get my code to compile if I did</p>\n\n<pre><code>template &lt;typename Key, typename Value, size_t TreeHeight&gt;\nclass RedBlackTree {\n  //...\n  unique_ptr&lt;Node&lt;color::Black,TreeHeight&gt;&gt; root = std::make_unique&lt;Leaf&gt;();\n  //...\n}\n</code></pre>\n\n<p>But this isn't the type I want for the tree - I don't want the type of the tree itself\nto reflect its height, otherwise the type of my tree might change when I insert a\nkey-value pair. I want to be able to update my <code>root</code> to contain a pointer to a black\n<code>Node</code> of <em>any</em> height.</p>\n\n<p>Back in haskell-land, I would have solved this problem using <em>existential\nquantification</em>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Color = Black | Red\n\ndata Node (color :: Color) (height :: Nat) key value where\n  Leaf :: Node 'Black 0 key value\n  BlackBranch :: Branch left right height key value -&gt; Node 'Black (height+1) key value\n  RedBranch :: Branch 'Black 'Black height key value -&gt; Node 'Red height key value\n\ndata Branch (left :: Color) (right :: Color) (childHeight :: Nat) key value = Branch\n  { left  :: Node left childHeight key value\n  , right :: Node right childHeight key value\n  , key   :: key\n  , value :: value\n  }\n\ndata RedBlackTree key value where\n  RedBlackTree :: { root :: Node 'Black height key value } -&gt; RedBlackTree key value\n</code></pre>\n\n<p>Is there an equivalent concept in C++14 (or maybe C++17), or an alternative way I could write my <code>struct</code> defintions to be able to give <code>root</code> a useful and correct type?</p>\n"}, {"tags": ["haskell", "functional-programming", "monoids"], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 4, "last_activity_date": 1472574172, "last_edit_date": 1472574172, "creation_date": 1472573623, "answer_id": 39232424, "question_id": 39232294, "link": "https://stackoverflow.com/questions/39232294/how-to-write-a-semigroup-instance/39232424#39232424", "title": "How to write a Semigroup Instance?", "body": "<p>In your definition, there is no need for <code>a</code> or <code>b</code> to instances of any particular type class, because you never actually do anything with the wrapped values.</p>\n\n<pre><code>instance Semigroup (Or a b) where\n    (Snd a) &lt;&gt; _ = Snd a\n    _       &lt;&gt; (Snd a) = Snd a\n    (Fst a) &lt;&gt; (Fst b) = Fst b  \n</code></pre>\n\n<p>Since your <code>Or</code> type is isomorphic to <code>Either</code>, compare this to the <code>Either</code> instance in the <code>semigroups</code> package, which similarly places no constraints on the types involved.</p>\n\n<pre><code>instance Semigroup (Either a b) where\n  Left _ &lt;&gt; b = b\n  a      &lt;&gt; _ = a\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1472576226, "post_id": 39232432, "comment_id": 65803392, "body": "Is the compiler smart enough to recognize when <code>Snd a</code> is being reused unmodified to avoid constructing a new copy? I wasn&#39;t being clever; I just copied the definition verbatim as a published example of a similar instance. :)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1472576927, "post_id": 39232432, "comment_id": 65803799, "body": "@chepner, I&#39;m not sure. That doesn&#39;t necessarily happen in core-to-core, as I recall, and I&#39;m much less familiar with what goes on in STG and beyond."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 6, "last_activity_date": 1472574518, "last_edit_date": 1472574518, "creation_date": 1472573646, "answer_id": 39232432, "question_id": 39232294, "link": "https://stackoverflow.com/questions/39232294/how-to-write-a-semigroup-instance/39232432#39232432", "title": "How to write a Semigroup Instance?", "body": "<p>The real problem is the constraint you've put on your instance, which you don't need. Just write</p>\n\n<pre><code>instance Semigroup (Or a b) where\n  (Snd a) &lt;&gt; _ = Snd a\n  _ &lt;&gt; (Snd a) = Snd a\n  (Fst a) &lt;&gt; (Fst b) = Fst b\n</code></pre>\n\n<p>As chepner shows, you can actually cut down the number of lines and the number of patterns, and return one of the arguments as the result instead of constructing a new copy of it. That's potentially good for efficiency.</p>\n\n<p>Less importantly, the parentheses in your patterns are all redundant, because application has higher precedence than any operator.</p>\n"}], "owner": {"reputation": 2365, "user_id": 6682929, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/BuvWA.jpg?s=128&g=1", "display_name": "Jonathan Portorreal", "link": "https://stackoverflow.com/users/6682929/jonathan-portorreal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1598, "favorite_count": 1, "accepted_answer_id": 39232432, "answer_count": 2, "score": 4, "last_activity_date": 1472574518, "creation_date": 1472573055, "question_id": 39232294, "link": "https://stackoverflow.com/questions/39232294/how-to-write-a-semigroup-instance", "title": "How to write a Semigroup Instance?", "body": "<h1>Problem</h1>\n\n<p>Given a data type, implement the Semigroup instance. Heres the data type I was given to implement: \n<code>data Or a b = Fst a | Snd b deriving  (Eq, Show, Num)</code>. And it should function like so: \n<br></p>\n\n<pre><code>Prelude&gt; Fst 1 &lt;&gt; Snd 2\nSnd 2\nPrelude&gt; Fst 1 &lt;&gt; Fst 2\nFst 2\nPrelude&gt; Snd 1 &lt;&gt; Fst 2\nSnd 1\nPrelude&gt; Snd 1 &lt;&gt; Snd 2\nSnd 1\n</code></pre>\n\n<p>When I test values like <code>&gt; Fst \"help\" &lt;&gt; Fst \"me\"</code> it works correctly, but when I test other values  I get errors. When I try to fix these errors by deriving the classes from the errors, I get more errors. What am I doing wrong here?</p>\n\n<h1>My Code</h1>\n\n<pre><code>data Or a b =\n    Fst a\n  | Snd b\n  deriving (Eq, Show)\n\ninstance (Semigroup a, Semigroup b, Num a, Num b) =&gt; Semigroup (Or a b) where\n (Snd a) &lt;&gt; _ = Snd a\n  _ &lt;&gt; (Snd a) = Snd a\n  (Fst a) &lt;&gt; (Fst b) = Fst b  \n</code></pre>\n\n<h1>Error</h1>\n\n<p>When I try to test with integers <code>&gt; Fst 1 &lt;&gt; Fst 2</code> I get:</p>\n\n<pre><code>No instance for (Num a0) arising from a use of \u2018it\u2019\nThe type variable \u2018a0\u2019 is ambiguous\nNote: there are several potential instances:\n  instance RealFloat a =&gt; Num (Data.Complex.Complex a)\n    -- Defined in \u2018Data.Complex\u2019\n  instance Data.Fixed.HasResolution a =&gt; Num (Data.Fixed.Fixed a)\n    -- Defined in \u2018Data.Fixed\u2019\n  instance forall (k :: BOX) (f :: k -&gt; *) (a :: k).\n           Num (f a) =&gt;\n           Num (Data.Monoid.Alt f a)\n    -- Defined in \u2018Data.Monoid\u2019\n  ...plus 21 others\nIn the first argument of \u2018print\u2019, namely \u2018it\u2019\nIn a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>When I try to derive the Num class <code>data Or a b = Fst a | Snd b deriving  (Eq, Show, Num)</code> I get:</p>\n\n<pre><code>    Can't make a derived instance of \u2018Num (Or a b)\u2019:\n      \u2018Num\u2019 is not a derivable class\n\n    In the data declaration for \u2018Or\u2019\nFailed, modules loaded: none.\n</code></pre>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1472579114, "post_id": 39231970, "comment_id": 65804997, "body": "What is the context? I can write <code>let myR = (\\x -&gt; x + 10)</code> at the GHCi prompt, with <code>myR :: (Num a, MonadReader a m) =&gt; m a</code>, and <code>myR 5</code> evaluates to 15."}], "answers": [{"tags": [], "owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "is_accepted": false, "score": 1, "last_activity_date": 1472572434, "creation_date": 1472572434, "answer_id": 39232105, "question_id": 39231970, "link": "https://stackoverflow.com/questions/39231970/please-clarify-the-behavior-of-reader-monad-type/39232105#39232105", "title": "Please clarify the behavior of Reader Monad type", "body": "<p>While it would be able to default the <code>Int</code> Haskell doesn't default the <code>Monad</code> to <code>Reader</code>. </p>\n\n<pre><code>let myR = reader (\\x -&gt; x + 10) :: Num a, MonadReader a m =&gt; m a\n</code></pre>\n\n<p>Is roughly what the type checker finds, then it applies a defaulting rule for <code>Num</code> to <code>Int</code> and gets.</p>\n\n<pre><code>let myR = reader (\\x -&gt; x + 10) :: MonadReader Int m =&gt; m Int\n</code></pre>\n\n<p>However it has no default defined for <code>MonadReader</code> so has to return an ambiguous error at this point.</p>\n\n<p>All isn't lost though, you can annotate some other part of the program if you don't want to annotate <code>myR</code>, the type checker just eventually needs to be told which <code>MonadReader</code> you want.</p>\n"}], "owner": {"reputation": 1397, "user_id": 3975711, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/756de1bfefa4329d2d23dd5975c24306?s=128&d=identicon&r=PG&f=1", "display_name": "Sergii Vorobei", "link": "https://stackoverflow.com/users/3975711/sergii-vorobei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1472572434, "creation_date": 1472571976, "question_id": 39231970, "link": "https://stackoverflow.com/questions/39231970/please-clarify-the-behavior-of-reader-monad-type", "title": "Please clarify the behavior of Reader Monad type", "body": "<p>I am relatively new to Haskell. Now I am trying to understand the Reader Monad more fully. It seems to be clearer the purpose and usage of it. But in Haskell while viewing the type of <code>:t reader</code> function I see <code>reader :: MonadReader r m =&gt; (r -&gt; a) -&gt; m a</code>. What does this type constraint mean? \nWhen I am trying to construct Reader, e.g</p>\n\n<pre><code>let myR = reader (\\x -&gt; x + 10)\n</code></pre>\n\n<p>I see error</p>\n\n<pre><code>&lt;interactive&gt;:21:11:\nNo instance for (MonadReader a0 m0) arising from a use of `reader'\nThe type variables `m0', `a0' are ambiguous\nPossible fix: add a type signature that fixes these type variable(s)\nNote: there are several potential instances:\n  instance MonadReader r' m =&gt;\n           MonadReader r' (Control.Monad.Trans.Cont.ContT r m)\n    -- Defined in `Control.Monad.Reader.Class'\n  instance MonadReader r ((-&gt;) r)\n    -- Defined in `Control.Monad.Reader.Class'\n  instance (Control.Monad.Trans.Error.Error e, MonadReader r m) =&gt;\n           MonadReader r (Control.Monad.Trans.Error.ErrorT e m)\n    -- Defined in `Control.Monad.Reader.Class'\n  ...plus 10 others\nIn the expression: reader (\\ x -&gt; x + 10)\nIn an equation for `myR': myR = reader (\\ x -&gt; x + 10)\n\n&lt;interactive&gt;:21:27:\nNo instance for (Num a0) arising from a use of `+'\nThe type variable `a0' is ambiguous\nPossible fix: add a type signature that fixes these type variable(s)\nNote: there are several potential instances:\n  instance Num Double -- Defined in `GHC.Float'\n  instance Num Float -- Defined in `GHC.Float'\n  instance Integral a =&gt; Num (GHC.Real.Ratio a)\n    -- Defined in `GHC.Real'\n  ...plus three others\nIn the expression: x + 10\nIn the first argument of `reader', namely `(\\ x -&gt; x + 10)'\nIn the expression: reader (\\ x -&gt; x + 10)\n</code></pre>\n\n<p>It is clear that I should add type signature:</p>\n\n<pre><code>let myR = reader (\\x -&gt; x + 10) :: Reader Int Int\n</code></pre>\n\n<p>This works but how I could imply from this definition of reader <code>reader :: MonadReader r m =&gt; (r -&gt; a) -&gt; m a</code> that I should define it as <code>Reader Int Int</code>?</p>\n\n<p>(In case of Maybe, e.g. <code>let m5 = return 5 :: Maybe Int</code> it seems to be clear for me, probably because of Maybe has one type parameter, I am not sure)</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1472568916, "post_id": 39230522, "comment_id": 65798606, "body": "These classes won&#39;t really work - the functions in the class do not mention the variable <code>b</code> and there is no fundep or the like to determine <code>b</code> from <code>a</code>. <code>Good</code> only works because of remarkable coincidence - in both instance for <code>Good</code>, the second type is a completely unrestricted type variable. This is essentially the same as if you didn&#39;t have the type variable in the class at all. <code>bad</code> does not work because <code>b</code> is a completely free type variable which may be instantiated to <code>C a</code> at some later time, which would change which instance is selected (&quot;The choice depends on the instantiation&quot;)."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1472570012, "post_id": 39230522, "comment_id": 65799446, "body": "I think your pragmas should have <code>AllowAmbiguousTypes</code> instead of <code>UndecidableInstances</code>, else you get a different error pertaining to <code>b</code> being ambiguous in the function signature <code>bad :: Bad a b =&gt; a -&gt; String</code>..."}, {"owner": {"reputation": 23, "user_id": 6774775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4514d20e9cff89c3b4fd393f93ba6ac0?s=128&d=identicon&r=PG", "display_name": "Franco Costantini", "link": "https://stackoverflow.com/users/6774775/franco-costantini"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1472570957, "post_id": 39230522, "comment_id": 65800186, "body": "@user2407038 Yes, I can see that, although the error is still there if you add b to the functions. Testing some more, I saw that you basically have to use the function while explicitely saying what is your b, that way ghc knows which instance to use. I could get this little example to work, but I don&#39;t think this is doable in the bigger project. Thanks!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1472573171, "post_id": 39230522, "comment_id": 65801712, "body": "If you read <code>Bad (Id a)</code> aloud, it sounds a lot like &quot;bad idea&quot;. Overlapping instances are usually a bad idea."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 3, "last_activity_date": 1472571291, "creation_date": 1472571291, "answer_id": 39231730, "question_id": 39230522, "link": "https://stackoverflow.com/questions/39230522/trouble-with-overlapping-instances/39231730#39231730", "title": "Trouble with overlapping instances", "body": "<p>As per my comment above, I think your pragmas should have <code>AllowAmbiguousTypes</code> instead of <code>UndecidableInstances</code>,\nelse you get a different error (at least I do on GHC 8.0.1) pertaining to <code>b</code> being ambiguous in the function signature\n<code>bad :: Bad a b =&gt; a -&gt; String</code>.</p>\n\n<p><code>AmbiguousTypes</code> allows you to write signatures for functions that will be ambiguous when they are used.\nInstead, the ambiguity check is moved to the call-site. This works really well with something like <code>TypeApplications</code>\nto specify those ambiguous variables. In this case, <code>bad</code> is always ambiguous, so we need this pragma to move to the\nerror message at the call-site. Now, I have the same message as you.</p>\n\n<hr>\n\n<p>The reason that even with <code>OVERLAPPABLE</code> and <code>OVERLAPPING</code>  Haskell complains is that depending on how <code>b</code> is instantiated (which hasn't been \nspecified), it will choose one of the two instances of <code>Bad</code>. In other words, you <em>could</em> want <code>b</code> to unify with <code>C a</code>,\njust as well as you could not, so Haskell throws up its hands and says \"you haven't told me enough about <code>b</code> for me to be\nable to pick a most specific instance of <code>Bad</code>\".</p>\n\n<p>On the other hand, even without knowing <code>b</code>, Haskell knows which of the instances <code>Good a b</code> and <code>Good (Id a) b</code> are more\nspecific - it is always the second one (even without knowing what <code>b</code> is that is the case).</p>\n\n<p>I really recommend you read the documentation about <a href=\"http://ghc.readthedocs.io/en/8.0.1/glasgow_exts.html?highlight=incoherentinstances#overlapping-instances\" rel=\"nofollow\">overlapping instances</a>\nas it explains the whole algorithm.</p>\n\n<hr>\n\n<p>You can usually get around these problems using things like <code>TypeApplications</code> (to specify <code>b</code>), or translating your type class to a type family.</p>\n"}], "owner": {"reputation": 23, "user_id": 6774775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4514d20e9cff89c3b4fd393f93ba6ac0?s=128&d=identicon&r=PG", "display_name": "Franco Costantini", "link": "https://stackoverflow.com/users/6774775/franco-costantini"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 368, "favorite_count": 0, "accepted_answer_id": 39231730, "answer_count": 1, "score": 2, "last_activity_date": 1472571291, "creation_date": 1472567960, "question_id": 39230522, "link": "https://stackoverflow.com/questions/39230522/trouble-with-overlapping-instances", "title": "Trouble with overlapping instances", "body": "<p>I'm currently working in a project where I derive some instances for a class. Since the class has only one method with will have the same definition save for a few specific cases, I tried defining an overlappable general instance and then defining the ones I need to be overlapping.  </p>\n\n<p>This doesn't work because I get an overlapping instances error. Doing some testing, we came accross this reduced example that's pretty much equivalent to my original problem:  </p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances, UndecidableInstances, MultiParamTypeClasses #-}\n\nmodule Instance where\n\ndata Id a = Id a String\n\ndata C a = C a\n\nclass Bad a b where\n  bad :: a -&gt; String\n\ninstance {-# OVERLAPPABLE #-} Bad a b where\n  bad = \\_ -&gt; \"Default case\"\n\ninstance {-# OVERLAPPING #-} Bad (Id a) (C a) where\n  bad = \\_ -&gt; \"Id\"\n\nclass Good a b where\n  good :: a -&gt; String\n\ninstance {-# OVERLAPPABLE #-} Good a b where\n  good = \\_ -&gt; \"Default case\"\n\ninstance {-# OVERLAPPING #-} Good (Id a) b where\n  good = \\_ -&gt; \"Id\"\n\ntest = let a = Id () \"a\"\n       in putStrLn (good a) &gt;&gt; putStrLn (bad a)\n</code></pre>\n\n<p>(Note that this won't compile unless you comment the second Bad instance.)  </p>\n\n<p>Class Good works without any problem (test outputs \"Id\"). If I don't remove the second instance for Bad, I get:  </p>\n\n<pre><code>Overlapping instances for Bad (Id ()) b0\n    arising from a use of \u2018bad\u2019\n  Matching instances:\n    instance [overlappable] Bad a b -- Defined at Instance.hs:12:31\n    instance [overlapping] Bad (Id a) (C a)\n      -- Defined at Instance.hs:15:30\n  (The choice depends on the instantiation of \u2018b0\u2019\n   To pick the first instance above, use IncoherentInstances\n   when compiling the other instance declarations)\n  In the first argument of \u2018putStrLn\u2019, namely \u2018(bad a)\u2019\n  In the second argument of \u2018(&gt;&gt;)\u2019, namely \u2018putStrLn (bad a)\u2019\n  In the expression: putStrLn (good a) &gt;&gt; putStrLn (bad a)\n</code></pre>\n\n<p>What I don't understand is why does this happen, when the only difference between them is an aditional restriction in the second class parameter.  </p>\n\n<p>Also, isn't the point of overlappable instances to avoid overlapping errors?  </p>\n\n<p>Regards</p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 9, "last_activity_date": 1472560556, "creation_date": 1472560556, "answer_id": 39227703, "question_id": 39227397, "link": "https://stackoverflow.com/questions/39227397/how-to-remove-old-build-plans-installed-by-haskell-stack/39227703#39227703", "title": "How to remove old build plans installed by Haskell stack?", "body": "<p>I would poke around ~/.stack and delete whatever files you don't want anymore:</p>\n\n<ul>\n<li>compiled libraries for a resolver in ~/.stack/snapshots/...</li>\n<li>compiler toolchains in ~/.stack/programs/...</li>\n<li>build plan yaml files in ~/.stack/build-plan/...</li>\n</ul>\n"}], "owner": {"reputation": 701, "user_id": 2028189, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c4ca5514c17ff9231cb37f60e6cd922c?s=128&d=identicon&r=PG", "display_name": "Kwang Yul Seo", "link": "https://stackoverflow.com/users/2028189/kwang-yul-seo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 961, "favorite_count": 0, "accepted_answer_id": 39227703, "answer_count": 1, "score": 7, "last_activity_date": 1483471894, "creation_date": 1472559819, "last_edit_date": 1483471894, "question_id": 39227397, "link": "https://stackoverflow.com/questions/39227397/how-to-remove-old-build-plans-installed-by-haskell-stack", "title": "How to remove old build plans installed by Haskell stack?", "body": "<p>How can I remove old build plans (GHC compiler and packages) installed by the stack tool?</p>\n"}, {"tags": ["haskell", "parallel-processing"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1472560901, "post_id": 39225557, "comment_id": 65792696, "body": "btw - the book <a href=\"http://community.haskell.org/~simonmar/pcph/\" rel=\"nofollow noreferrer\">&quot;Parallel and Concurrent Programming in Haskell&quot;</a> is an excellent book on this subject."}, {"owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1472561062, "post_id": 39225557, "comment_id": 65792814, "body": "I&#39;ve read this chapter already : <a href=\"http://chimera.labs.oreilly.com/books/1230000000929/ch03.html\" rel=\"nofollow noreferrer\">chimera.labs.oreilly.com/books/1230000000929/ch03.html</a>. Nowhere do we specify the thread count to strategies, so I imagine they go to a thread pool. But I&#39;m not sure."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1472562946, "post_id": 39225557, "comment_id": 65794131, "body": "Have a look at <a href=\"https://wiki.haskell.org/GHC/Data_Parallel_Haskell\" rel=\"nofollow noreferrer\">Data Parallel Haskell</a>"}], "answers": [{"comments": [{"owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "edited": false, "score": 0, "creation_date": 1472573257, "post_id": 39228949, "comment_id": 65801762, "body": "I tried <code>parMap</code> and updated the question. It slows down !"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "edited": false, "score": 0, "creation_date": 1472579266, "post_id": 39228949, "comment_id": 65805071, "body": "For your example tree and aggregator sparking every call to aggregate is not the best granularity of parallelism. You might see a speed up for a different aggregator function. ie one that does more work. Or if you used <code>parListChunk</code>."}, {"owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "edited": false, "score": 0, "creation_date": 1472590113, "post_id": 39228949, "comment_id": 65810802, "body": "No luck with either parListChunk or a longer aggregator (updated in the question above)."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "edited": false, "score": 0, "creation_date": 1472592908, "post_id": 39228949, "comment_id": 65812061, "body": "I answered your original question before you changed it. If you want help with a specific computation, please post it as a new question and I can devote more time to examining that case."}, {"owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "edited": false, "score": 0, "creation_date": 1472630895, "post_id": 39228949, "comment_id": 65824272, "body": "And I thank you for you answer, I just accepted it. I inserted a 0 node in between to get some recursion, which yields : SPARKS: 16 (7 converted, 0 overflowed, 0 dud, 0 GC&#39;d, 9 fizzled). Still no time improvement with 8 cores though. If I post this as another question, won&#39;t it be flagged as duplicate ?"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 7, "last_activity_date": 1472563931, "last_edit_date": 1495540850, "creation_date": 1472563931, "answer_id": 39228949, "question_id": 39225557, "link": "https://stackoverflow.com/questions/39225557/parallel-recursive-tasks-in-a-threadpool/39228949#39228949", "title": "Parallel recursive tasks in a threadpool", "body": "<p>The parallel runtime already manages a thread pool for sparks.\nFrom <a href=\"https://stackoverflow.com/a/959001/866915\">this SO answer</a>:</p>\n\n<blockquote>\n  <p>Sparks are not threads. forkIO introduces Haskell threads (which map down onto fewer real OS threads). Sparks create entries in the work queues for each thread, from which they'll take tasks to execute if the thread becomes idle.</p>\n</blockquote>\n\n<p>So I would first just try using <code>parMap strat</code> and see if it works for you. </p>\n\n<p>In fact, if your tree is a Traversable, I'd look at using <code>parTraversable</code>:</p>\n\n<pre><code>parTraversable :: Traversable t =&gt; Strategy a -&gt; Strategy (t a)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1472624618, "creation_date": 1472624618, "answer_id": 39242142, "question_id": 39225557, "link": "https://stackoverflow.com/questions/39225557/parallel-recursive-tasks-in-a-threadpool/39242142#39242142", "title": "Parallel recursive tasks in a threadpool", "body": "<p>In your <code>slowAggregate</code> example the function <code>slowAggregate</code> only gets called once - for the top node.</p>\n\n<p>It does not get called for any of the child nodes because those nodes don't have any children themselves. Those nodes are handled by the first guard clause of <code>aggregate</code>:</p>\n\n<pre><code>aggregate _ (Node x []) = Node x []\n</code></pre>\n\n<p>Moreover, when I ran the program with <code>+RTS -s -N2</code> all 8 of the sparks that were created fizzled:</p>\n\n<pre><code>  SPARKS: 8 (0 converted, 0 overflowed, 0 dud, 0 GC'd, 8 fizzled)\n</code></pre>\n\n<p>These sparks correspond to the 8 elements in the list [71..78]. All of these fizzled because none of them called <code>slowAggregate</code>.</p>\n"}], "owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 202, "favorite_count": 0, "accepted_answer_id": 39228949, "answer_count": 2, "score": 0, "last_activity_date": 1472624618, "creation_date": 1472554384, "last_edit_date": 1472590040, "question_id": 39225557, "link": "https://stackoverflow.com/questions/39225557/parallel-recursive-tasks-in-a-threadpool", "title": "Parallel recursive tasks in a threadpool", "body": "<p>My exact example is parallelizing this tree aggregation, where the information flows from the leaves to the root :</p>\n\n<pre><code>aggregate :: ([a] -&gt; a) -&gt; Tree a -&gt; Tree a\naggregate _ (Node x []) = Node x []\naggregate aggregator (Node _ children) =\n  let agChildren = map (aggregate aggregator) children in\n  Node (aggregator $ map (\\(Node y _) -&gt; y) agChildren) agChildren\n</code></pre>\n\n<p>I'd like each application of the aggregator function to be processed on a different thread. So I imagine altering the code above so that it spawns a tree of dependent tasks and gives them to a thread pool.</p>\n\n<p>I don't want a thread affected at a node, waiting for children threads to complete. Instead, this waiting thread should go compute other available children in the tree. Also it would be too slow to run a thread for each node concurrently. My trees can have hundreds of nodes and my machine only has 8 cores : they would spend their time scheduling instead of calculating. I need a thread pool that consumes tasks only when other tasks finish.</p>\n\n<p>As mentionned by ErikR below, <code>parMap</code> seems to do exactly that. I tried it and executed it with strat 64 +RTS -N2, to get exactly the same computation time. Here is the code (that does an idiotic computation just to test the performance), do you understand why the time doesn't change ?</p>\n\n<pre><code>slowAggregate :: [Int] -&gt; Int\nslowAggregate l = let s = sum l in\n  sum [a + b + c | a &lt;- [0..s], b &lt;- [0..s], c &lt;- [0..s] ]\n\nbigTree :: Tree Int\nbigTree = Node 0 $ map (\\x -&gt; Node x []) [71..78]\n\naggregate :: NFData a =&gt; ([a] -&gt; a) -&gt; Tree a -&gt; Tree a\naggregate _ (Node x []) = Node x []\naggregate aggregator (Node _ children) =\n  let agChildren = parMap rdeepseq (aggregate aggregator) children in \n  Node (aggregator $ map (\\(Node y _) -&gt; y) agChildren) agChildren\n\nmain = timeIt $ let (Node y _) = aggregate slowAggregate bigTree in print y\n</code></pre>\n"}, {"tags": ["haskell", "concurrency", "yesod", "conduit"], "answers": [{"comments": [{"owner": {"reputation": 785, "user_id": 2047038, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0c861f36ff63edadc0d3dc8d26328e5c?s=128&d=identicon&r=PG", "display_name": "Mahdi Dibaiee", "link": "https://stackoverflow.com/users/2047038/mahdi-dibaiee"}, "edited": false, "score": 0, "creation_date": 1472631061, "post_id": 39223331, "comment_id": 65824373, "body": "<code>runConduit</code> doesn&#39;t work because it requires a <code>ConduitM</code> containing <code>Data.Void.Void</code>, but I have <code>ConduitFlush</code> instead."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1472548413, "creation_date": 1472548413, "answer_id": 39223331, "question_id": 39221108, "link": "https://stackoverflow.com/questions/39221108/using-sendflush-and-sendchunkbs-in-forkio/39223331#39223331", "title": "Using sendFlush and sendChunkBS in forkIO", "body": "<p>I would try adding a call to <a href=\"https://hackage.haskell.org/package/conduit-1.2.7/docs/Data-Conduit.html#v:runConduit\" rel=\"nofollow\"><code>runConduit</code></a> just before <code>forkIO</code>;</p>\n\n<pre><code>  (rid, rwait) &lt;- liftIO $ T.forkIO $ runConduit $\n</code></pre>\n\n<p>Your argument to forkIO is a ConduitM action, and <code>runConduit</code>\nwill convert that to an IO action.</p>\n"}, {"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 0, "last_activity_date": 1472629173, "creation_date": 1472629173, "answer_id": 39243511, "question_id": 39221108, "link": "https://stackoverflow.com/questions/39221108/using-sendflush-and-sendchunkbs-in-forkio/39243511#39243511", "title": "Using sendFlush and sendChunkBS in forkIO", "body": "<p>The standard approach to this would be to create some kind of shared variable to communicate between the child thread and the main thread, and have the main thread pop values off of the variable and <code>send</code> them with the appropriate functions. My recommendation would be to use <a href=\"https://www.stackage.org/package/stm\" rel=\"nofollow\">Software Transactional Memory (STM)</a>, and probably something like a <a href=\"https://www.stackage.org/haddock/lts-6.14/stm-2.4.4.1/Control-Concurrent-STM-TBQueue.html\" rel=\"nofollow\">TBQueue</a>.</p>\n"}], "owner": {"reputation": 785, "user_id": 2047038, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0c861f36ff63edadc0d3dc8d26328e5c?s=128&d=identicon&r=PG", "display_name": "Mahdi Dibaiee", "link": "https://stackoverflow.com/users/2047038/mahdi-dibaiee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1472629173, "creation_date": 1472541329, "question_id": 39221108, "link": "https://stackoverflow.com/questions/39221108/using-sendflush-and-sendchunkbs-in-forkio", "title": "Using sendFlush and sendChunkBS in forkIO", "body": "<p>I'm developing a Yesod application and I'm encountering an error while trying to use <a href=\"http://hackage.haskell.org/package/yesod-core-1.4.24/docs/Yesod-Core-Handler.html#v:sendFlush\" rel=\"nofollow\"><code>sendFlush</code></a> and <a href=\"http://hackage.haskell.org/package/yesod-core-1.4.24/docs/Yesod-Core-Handler.html#v:sendFlush\" rel=\"nofollow\"><code>sendChunkBS</code></a> inside a <a href=\"http://hackage.haskell.org/package/threads-0.5.1.4/docs/Control-Concurrent-Thread.html#v:forkIO\" rel=\"nofollow\"><code>forkIO</code></a>.</p>\n\n<p><code>sendFlush</code> and <code>sendChunkBS</code> are of type <code>Monad m =&gt; Producer m (Flush Builder)</code> but <code>forkIO</code> requires an <code>IO ()</code>.</p>\n\n<p>Here is the code:</p>\n\n<pre><code>respondSource \"\" $ do\n  sendFlush\n\n  (rid, rwait) &lt;- liftIO $ T.forkIO $\n    do\n      let loop = do\n            output &lt;- liftIO $ SB.recv targetSocket (2^11)\n            liftIO $ putStrLn $ \"SB.recv: \" ++ BSC.unpack output\n\n            when (not $ BS.null output) $\n              do\n                sendChunkBS output\n                sendFlush\n                loop\n      loop\n</code></pre>\n\n<p>and the error:</p>\n\n<pre><code>Couldn't match expected type \u2018IO a0\u2019\n            with actual type \u2018C.ConduitM\n                                i0 (C.Flush Data.ByteString.Builder.Internal.Builder) m0 ()\u2019\nRelevant bindings include\n  loop :: C.ConduitM\n            i0 (C.Flush Data.ByteString.Builder.Internal.Builder) m0 ()\n    (bound at app/Main.hs:96:13)\nIn a stmt of a 'do' block: loop\nIn the second argument of \u2018($)\u2019, namely\n  \u2018do { let loop = ...;\n        loop }\u2019\n</code></pre>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1472585804, "post_id": 39221048, "comment_id": 65808565, "body": "This is unrelated, but I would expect your <code>Multiply</code> type family to have <code>Multiply NoUnit y = y</code> and <code>Multiply x NoUnit = x</code> instead of <code>Multiply NoUnit NoUnit = NoUnit</code>. Also, Adam Gundry concluded that GHC&#39;s built-in facilities aren&#39;t quite sufficient for good units-of-measure work. You should check out <a href=\"https://hackage.haskell.org/package/uom-plugin\" rel=\"nofollow noreferrer\">uom-plugin</a>, a type checker plugin supporting this kind of thing."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1472633847, "post_id": 39221048, "comment_id": 65826163, "body": "@dfeuer Thanks for the help but my actual code is not like this, this was just a minimal failing example. My actual code is very different and uses <code>DataKinds</code>. It seems to work for all SI units correctly, by just keeping track of how many of each of the 7 base SI units are combined into each value."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 14, "last_activity_date": 1472541554, "creation_date": 1472541554, "answer_id": 39221175, "question_id": 39221048, "link": "https://stackoverflow.com/questions/39221048/how-to-limit-the-open-world-assumption-in-haskell/39221175#39221175", "title": "How to limit the open world assumption in Haskell", "body": "<p>You can't turn off the open-world assumption, but there are ways to limit it, including this time. The problem, in your case, is the way you wrote the <code>Num</code> instance:</p>\n\n<pre><code>instance Num a =&gt; Num (Unit NoUnit a)\n</code></pre>\n\n<p>What you really wanted was</p>\n\n<pre><code>instance (Num a, u ~ NoUnit) =&gt; Num (Unit u a)\n</code></pre>\n\n<p>This way, when GHC sees that it needs <code>Num (Unit u) a</code>, it concludes that it needs both <code>Num a</code> and <code>u ~ NoUnit</code>. The way you wrote it, you left open the possibility of some additional instance somewhere.</p>\n\n<p>The trick of turning type constructors to the right of the <code>=&gt;</code> to equality constraints on the left is often useful.</p>\n"}], "owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 234, "favorite_count": 2, "accepted_answer_id": 39221175, "answer_count": 1, "score": 6, "last_activity_date": 1472541554, "creation_date": 1472541144, "question_id": 39221048, "link": "https://stackoverflow.com/questions/39221048/how-to-limit-the-open-world-assumption-in-haskell", "title": "How to limit the open world assumption in Haskell", "body": "<p>In order to improve my knowledge of GHC extensions I decided to try and implement numbers with units, and one thing I wanted to work was using numeric literals for unitless values. But that turned out to not be very practical due to the open world assumption that Haskell makes. A minimal example of what I couldn't get to work is the following:</p>\n\n<pre><code>data Unit u a = Unit a\n\ndata NoUnit\n\ninstance Num a =&gt; Num (Unit NoUnit a) where\n    -- (+) (*) (-) abs signum not important\n    fromInteger = Unit . fromInteger\n\ntype family Multiply a b where\n    Multiply NoUnit NoUnit = NoUnit\n\nmultiply :: Num a =&gt; Unit u1 a -&gt; Unit u2 a -&gt; Unit (Multiply u1 u2) a\nmultiply (Unit a) (Unit b) = Unit $ a * b\n</code></pre>\n\n<p>Now if I try and do something like <code>multiply 1 1</code> I expect the resulting value to be unambiguous. Because the only way to get something of type <code>Num (Unit u a)</code> is by setting <code>u</code> to <code>NoUnit</code>. And the remaining <code>a</code> should be taken care of by defaulting rules.</p>\n\n<p>Unfortunately due to the open world assumption of Haskell it is possible that some evil person decided that even a number that has units should be a valid <code>Num</code> instance even though such a thing would violate <code>(*) :: a -&gt; a -&gt; a</code> as multiplication of numbers with units does not fit that type signatures.</p>\n\n<p>Now the open world assumption is not an unreasonable one, particularly since orphan instances are not forbidden by the Haskell report. But in this specific case I really do want to tell GHC that the only valid phantom unit type for a <code>Num</code> instance of <code>Unit</code> is <code>NoUnit</code>.</p>\n\n<p>Is there any way to explicitly state this, and on somewhat of a side note would disallowing orphan instances allow GHC to ease up on the open world assumption at all?</p>\n\n<p>This kind of thing has come up a few times when trying to make my programs more type safe with partial dependent typing. Whenever I want to specify a <code>Num</code> or <code>IsString</code> or <code>IsList</code> instance for the base case and then use custom values or functions to obtain all the other possible cases.</p>\n"}, {"tags": ["haskell", "type-inference", "higher-rank-types", "impredicativetypes"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1472544473, "post_id": 39220435, "comment_id": 65781878, "body": "I don&#39;t know the full underlying theory, but type inference with higher ranked polytypes is hard -- IIRC, undecidable. Hence, polymorphism has to be somehow limited to make inference possible. A typical restriction is to allow each type variable <code>forall a. ...</code> to be instantiated only with monotypes (including <code>data, newtype</code>s). Impredicative types do relax this restriction, but right now they do not work fine in GHC."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1472552563, "post_id": 39220435, "comment_id": 65787235, "body": "@chi, my vague understanding is that Haskell 98 + rank-2 types can be inferred with difficulty, but that adding higher ranks or various type system extensions makes inference impossible."}], "answers": [{"comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 2, "creation_date": 1472565748, "post_id": 39229509, "comment_id": 65796274, "body": "<code>ImpredicativeTypes</code> is un-supported as of GHC 8, and it does not work by any reasonable standard of working."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1472577697, "post_id": 39229509, "comment_id": 65804249, "body": "@Andr&#225;sKov&#225;cs, it&#39;s been less-officially unsupported since long before that. If I&#39;m not mistaken it came in with boxy types and then stuck around like a drunk party-goer after that was replaced by OutsideIn(X)."}], "tags": [], "owner": {"reputation": 1725, "user_id": 409157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84beba1253243b5508fc53c20fbe12f4?s=128&d=identicon&r=PG", "display_name": "Pedro Rodrigues", "link": "https://stackoverflow.com/users/409157/pedro-rodrigues"}, "is_accepted": false, "score": 0, "last_activity_date": 1472565373, "creation_date": 1472565373, "answer_id": 39229509, "question_id": 39220435, "link": "https://stackoverflow.com/questions/39220435/why-are-higher-rank-types-so-fragile-in-haskell/39229509#39229509", "title": "Why are higher rank types so fragile in Haskell", "body": "<p>To be able to write <code>const runST</code>, you need to active the Impredicative types extension (on GHCi: <code>:set -XImpredicativeTypes</code>).</p>\n"}, {"comments": [{"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "edited": false, "score": 0, "creation_date": 1472572953, "post_id": 39230655, "comment_id": 65801583, "body": "I think that more or less makes sense. But I still am not sure why having type inference able to substitute poly types and then float the foralls is all that crazy. Is inferring <code>const runST</code> correctly really that problematic with a limited subset of higher rank type inference? I realize that it won&#39;t be able to safely create higher rank types out of nothing, but once you already have a higher rank type it seems like it wouldn&#39;t be that big of a deal to allow it to be passed around a bit."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "edited": false, "score": 2, "creation_date": 1472583264, "post_id": 39230655, "comment_id": 65807174, "body": "The problem with identifying and implementing a &#39;limited subset&#39; of higher rank type inference is you need a formal semantics for it - without impredicative types, there isn&#39;t even a way to state at which type <code>const</code> is instantiated in <code>const runST</code>, because that type is impredicative, even though the result type is not. The typechecker therefore would need to support impredicative types, solving the problem we were trying to avoid having to solve in the first place. It seems such a limited subset would be even more limited than your particular example (which is already very simple)."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "edited": false, "score": 0, "creation_date": 1472634124, "post_id": 39230655, "comment_id": 65826316, "body": "Ok I think I see what you are saying, this seems like one of those: simple on paper for one example and a bit of common sense, but really horrible from a computational and general case perspective. Well hopefully eventually <code>ImpredicativeTypes</code> will be supported."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 11, "last_activity_date": 1472568336, "last_edit_date": 1592644375, "creation_date": 1472568336, "answer_id": 39230655, "question_id": 39220435, "link": "https://stackoverflow.com/questions/39220435/why-are-higher-rank-types-so-fragile-in-haskell/39230655#39230655", "title": "Why are higher rank types so fragile in Haskell", "body": "<p>You have answered your own question:</p>\n<blockquote>\n<p>... by substituting <code>a</code> in <code>const</code> for <code>forall s. ST s a</code> ...</p>\n</blockquote>\n<p>This is the definition of <em>impredictive polymorphism</em> - the ability to instantiate a type variable with a <a href=\"https://en.wikipedia.org/wiki/Hindley%E2%80%93Milner_type_system#Polytype\" rel=\"noreferrer\"><em>polytype</em></a>, which is (loosely) a type with a <code>forall</code> quantifier at the leftmost side of the type.</p>\n<p>From the <a href=\"https://ghc.haskell.org/trac/ghc/wiki/ImpredicativePolymorphism\" rel=\"noreferrer\">GHC trac</a> page on the subject:</p>\n<blockquote>\n<p>GHC does not (yet) support impredicative polymorphism</p>\n</blockquote>\n<p>and furthermore</p>\n<blockquote>\n<p>We've made various attempts to support impredicativity, so there is a flag <code>-XImpredicativeTypes</code>. But it doesn't work, and is absolutely unsupported. If you use it, you are on your own; I make no promises about what will happen.</p>\n</blockquote>\n<p>So do not use <code>ImpredictiveTypes</code> - it won't help.</p>\n<hr />\n<p>Now for the gory details - why do all the specific examples work as they do?</p>\n<p>You've noted that in the expression <code>Just mempty</code>, the impredictive type <code>Maybe (forall a. Monoid a =&gt; a)</code> is not inferred; instead, the <code>forall</code> is 'floated out'. You also noted that performing the same process for <code>uncurry constST</code> gives a type &quot;which is higher rank but not impredicative&quot;. The <a href=\"https://downloads.haskell.org/%7Eghc/latest/docs/html/users_guide/glasgow_exts.html#arbitrary-rank-polymorphism\" rel=\"noreferrer\">GHC user guide</a> has this to say about higher rank types:</p>\n<blockquote>\n<p>In general, type inference for arbitrary-rank types is undecidable. ...</p>\n<p>For a lambda-bound or case-bound variable, x, either the programmer provides an explicit polymorphic type for x, or GHC\u2019s type inference will assume that x\u2019s type has no foralls in it.</p>\n</blockquote>\n<p>So you really have to help it quite a bit, and that usually precludes using higher-order functions alltogether (note the above says <em>nothing</em> about arbitrary applications, only about bound variables - and <code>uncurry constST</code> has no bound variables!). The correct type for <code>Just mempty</code> is rank 1, so there is no issue inferring it, with or without additional type signatures.</p>\n<p>For example, you can write your <code>(forall s. (b, ST s a)) -&gt; a</code> function as such (on GHC 8.0.1 at least):</p>\n<pre><code>constST' :: forall a b . (forall s . (b, ST s a)) -&gt; a\nconstST' z = runST z' \n  where z' :: forall s . ST s a\n        z' = snd z\n</code></pre>\n<p>and also note that you cannot even pattern match on the pair, because this immediately instantiates the bound <code>b</code> type var:</p>\n<pre><code>constST' :: forall a b . (forall s . (b, ST s a)) -&gt; a\nconstST' (a,b) = _res \n</code></pre>\n<p>Using typed holes, you get:</p>\n<pre><code>* Found hole: _res :: a\n  Where: `a' is a rigid type variable bound by\n           the type signature for:\n             constST' :: forall a b. (forall s. (b, ST s a)) -&gt; a\n* In the expression: _res\n  In an equation for constST': constST' (a, b) = _res\n* Relevant bindings include\n    b :: ST s0 a \n    a :: b \n</code></pre>\n<p>Note the type of <code>b</code> is <code>ST s0 a</code> for some <em>fresh type variable</em> <code>s0</code>, not the required <code>forall s . ST s a</code> for <code>runST</code>. There is no way to get the old type back.</p>\n<hr />\n<p>The simplest solution to such things is probably to define a <code>newtype</code>, as the GHC trac page suggests:</p>\n<pre><code>newtype RunnableST a = RST (forall s . ST s a)\n\nrrunST :: RunnableST a -&gt; a \nrrunST (RST a) = runST a \n</code></pre>\n<p>And store your <code>ST</code> actions which are ready to run in this container:</p>\n<pre><code>doSomething :: RunnableST X\ndoSomething = RST $ do ...\n</code></pre>\n"}], "owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 580, "favorite_count": 3, "accepted_answer_id": 39230655, "answer_count": 2, "score": 9, "last_activity_date": 1472568336, "creation_date": 1472539220, "question_id": 39220435, "link": "https://stackoverflow.com/questions/39220435/why-are-higher-rank-types-so-fragile-in-haskell", "title": "Why are higher rank types so fragile in Haskell", "body": "<p>I was messing around with the <code>runST</code> function. Which has type <code>(forall s. ST s a) -&gt; a</code> and it seems like trying to use it in any way that isn't directly applying without any indirection breaks it in pretty nasty ways.</p>\n\n<pre><code>runST :: (forall s. ST s a) -&gt; a\nconst :: a -&gt; b -&gt; a\n</code></pre>\n\n<p>so by substituting <code>a</code> in <code>const</code> for <code>forall s. ST s a</code> you should get the type of <code>const runST</code></p>\n\n<pre><code>const runST :: b -&gt; (forall s. ST s a) -&gt; a\n</code></pre>\n\n<p>but instead GHC says that it can't match <code>a</code> with <code>(forall s. ST s a) -&gt; a</code> but since <code>a</code> literally means <code>forall a. a</code> which is satisfied by every type I don't see what is invalid about that.</p>\n\n<p>As it turns out using <code>\\_ -&gt; runST</code> instead actually works just fine and gives the correct type.</p>\n\n<p>Once I had <code>constST</code> with the correct type I wanted to see if I could <code>uncurry</code> it, but unsurprisingly that also breaks. But it seems like it really shouldn't, although admittedly this case seems less obvious than the previous one:</p>\n\n<pre><code>constST :: b -&gt; (forall s. ST s a) -&gt; a\nuncurry :: (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c\n</code></pre>\n\n<p>So then surely the <code>a</code> in <code>uncurry</code> could be replaced with the <code>b</code> in <code>constST</code> and the <code>b</code> in <code>uncurry</code> could be replaced with the <code>(forall s. ST s a)</code> in <code>constST</code> and the <code>a</code> in <code>uncurry</code> could be replaced with the <code>c</code> in <code>constST</code>. This gives us:</p>\n\n<pre><code>uncurry constST :: (b, forall s. ST s a) -&gt; a\n</code></pre>\n\n<p>Now admittedly this type is impredicative which I know is pretty problematic. But technically <code>Just mempty</code> is also impredicative when substituting directly without moving the implicit <code>forall</code> quantification.</p>\n\n<pre><code>Just :: a -&gt; Maybe a\nmempty :: forall a. Monoid a =&gt; a\nJust mempty :: Maybe (forall a. Monoid a =&gt; a)\n</code></pre>\n\n<p>But the <code>forall</code> is automatically floated up to give you:</p>\n\n<pre><code>Just mempty :: forall a. Monoid a =&gt; Maybe a\n</code></pre>\n\n<p>Now if we do the same thing for <code>uncurry constST</code> we should get the sensible and as far as I can tell correct type of:</p>\n\n<pre><code>uncurry constST :: (forall s. (b, ST s a)) -&gt; a\n</code></pre>\n\n<p>Which is higher rank but not impredicative.</p>\n\n<p>Can someone explain to me why basically none of the above actually works with GHC 8, is there something more fundamental that makes the above very complicated in the general case? Because if not it seems like it would be really nice to have the above work, if only to get rid of the annoying special casing of <code>$</code> purely for the sake of <code>runST</code>.</p>\n\n<p>On a side note is it possible that instead of all the <code>forall</code> floating we could instead have <code>ImpredicativeTypes</code> just work correctly. It correctly infers the type for <code>Just mempty</code> as <code>Maybe (forall a. Monoid a =&gt; a)</code> but it seems like actually using it is not that easy. I have heard that impredicative type inference is not really doable but would it work to somehow limit type inference to predicative types except when you provide type signatures to indicate otherwise. Similar to how <code>MonoLocalBinds</code> makes local bindings monomorphic by default for the sake of type inference.</p>\n"}, {"tags": ["haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "edited": false, "score": 1, "creation_date": 1472519058, "post_id": 39217306, "comment_id": 65773064, "body": "You&#39;ve messed up with the function names. The real outputs are different."}, {"owner": {"reputation": 31, "user_id": 4200371, "user_type": "registered", "profile_image": "https://graph.facebook.com/100002932947943/picture?type=large", "display_name": "Edwin", "link": "https://stackoverflow.com/users/4200371/edwin"}, "reply_to_user": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "edited": false, "score": 0, "creation_date": 1472523900, "post_id": 39217306, "comment_id": 65774088, "body": "Oh right they&#39;re backwards thanks"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1472544011, "post_id": 39217306, "comment_id": 65781605, "body": "Enabling <code>-Wall</code> warnings would have spotted the shadowing mistake."}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 4200371, "user_type": "registered", "profile_image": "https://graph.facebook.com/100002932947943/picture?type=large", "display_name": "Edwin", "link": "https://stackoverflow.com/users/4200371/edwin"}, "edited": false, "score": 0, "creation_date": 1472525172, "post_id": 39217418, "comment_id": 65774374, "body": "What exactly is meant by all possible combinations of all the extractions? For example, in the case you listed above, I get a result of number of elements in the list squared. So if my list originally held 3 elements, I get a result of 9 elements."}, {"owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "reply_to_user": {"reputation": 31, "user_id": 4200371, "user_type": "registered", "profile_image": "https://graph.facebook.com/100002932947943/picture?type=large", "display_name": "Edwin", "link": "https://stackoverflow.com/users/4200371/edwin"}, "edited": false, "score": 0, "creation_date": 1472542401, "post_id": 39217418, "comment_id": 65780583, "body": "@Edwin For each iteration of the <code>(i, j) &lt;- rs</code> step it traverses <code>rs</code> again with the <code>(j, i) &lt;- rs</code> step. So if <code>rs</code> had 4 elements, as the result you&#39;d get a list of 16."}], "tags": [], "owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "is_accepted": false, "score": 2, "last_activity_date": 1472551515, "last_edit_date": 1472551515, "creation_date": 1472519698, "answer_id": 39217418, "question_id": 39217306, "link": "https://stackoverflow.com/questions/39217306/haskell-list-comprehension-for-eq-relations/39217418#39217418", "title": "Haskell List Comprehension for Eq Relations", "body": "<p>The list-comprehension syntax can also equivalently be expressed using the \"do\" notation, which is less cryptic and easier to explain.</p>\n\n<p>E.g., the following comprehension:</p>\n\n<pre><code>[ (j, i) | (i,j) &lt;- rs, (j,i) &lt;- rs ]\n</code></pre>\n\n<p>is equivalent to the following expression:</p>\n\n<pre><code>do\n  (i, j) &lt;- rs\n  (j, i) &lt;- rs\n  return (j, i)\n</code></pre>\n\n<p>So what happens here is that you first extract a value from the <code>rs</code> monad (in this case, List) and desctructure and assign it to the <code>i</code> and <code>j</code> variables. Then you extract the value again and assign it to the same variables in the reverse order. Thus you shadow the first assignment. After that you just produce the value for the output monad (List).</p>\n\n<p>Since the first assignment is shadowed, we can simply bypass it, getting the following equivalent expression:</p>\n\n<pre><code>do\n  _ &lt;- rs\n  (j, i) &lt;- rs\n  return (j, i)\n</code></pre>\n\n<p>or even:</p>\n\n<pre><code>do\n  rs\n  (j, i) &lt;- rs\n  return (j, i)\n</code></pre>\n\n<p>The List monad is defined such that you walk through all the possible combinations of all the extractions you do there.</p>\n\n<p>In this case you do extraction twice. As the result you get double traversal of the <code>rs</code> input list.</p>\n\n<p>In an imperative language it would look something like this:</p>\n\n<pre><code>function exmpl2(rs) {\n  var results = [];\n  for (a in rs) {\n    for (b in rs) {\n      results.push(b);\n    }\n  }\n  return results;\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 3, "last_activity_date": 1472536365, "creation_date": 1472536365, "answer_id": 39219685, "question_id": 39217306, "link": "https://stackoverflow.com/questions/39217306/haskell-list-comprehension-for-eq-relations/39219685#39219685", "title": "Haskell List Comprehension for Eq Relations", "body": "<p>I feel this can be more easily understood by approaching it from a simpler example.</p>\n\n<pre><code>\u03bb let chars = ['a', 'b', 'c']\n\n\u03bb let bools = [True, False]\n\n\u03bb [(c, b) | c &lt;- chars, b &lt;- bools]\n[('a',True),('a',False),('b',True),('b',False),('c',True),('c',False)]\n</code></pre>\n\n<p>It should be clear that we've produced every possible combination of taking a single <code>c</code> from <code>chars</code>, and a single <code>b</code> from <code>bools</code>.</p>\n\n<p>The next step is to understand that I could have used any expression where I put <code>(c, b)</code>. That part has <strong>zero</strong> impact on the <em>number</em> of items in the resulting list; whatever I put there I'll still have one item for every combination of <code>c</code> and <code>b</code> from <code>chars</code> and <code>bools</code>. I don't even need to actually use <code>c</code> and <code>b</code> (though obviously you usually would in real code).</p>\n\n<p>As an example:</p>\n\n<pre><code>\u03bb [ 7 | c &lt;- chars, b &lt;- bools]\n[7,7,7,7,7,7]\n</code></pre>\n\n<p>For every combination of <code>c</code> in <code>chars</code> and <code>b</code> in <code>bools</code>, I produce <code>7</code>. So that's six <code>7</code> items in my list.</p>\n\n<p>I can also refer to just one of <code>c</code> and <code>b</code>, and it still doesn't change the number of items I put out:</p>\n\n<pre><code>\u03bb [ b | c &lt;- chars, b &lt;- bools ]\n[True,False,True,False,True,False]\n</code></pre>\n\n<p>The only <em>values</em> I'm using are the <code>True</code> and <code>False</code> from <code>bools</code>, but the shape of the list (having six items) is determined by the \"every combination of <code>chars</code> and <code>bools</code>\" logic.</p>\n\n<p>Now a slightly evil trick I can pull (that is being used in your <code>exmp2</code>) is that because I never use <code>c</code> it doesn't matter what variable name I use to extract from <code>chars</code>. And because I'm <em>later</em> binding <code>b</code> when I extract from <code>bools</code>, I could use <code>b</code> there. The second binding of <code>b</code> in <code>b &lt;- bools</code> <strong>shadows</strong> the first; it's in effect a totally separate variable, but because they have the same name I can now only refer to one of them. Since I'm only using one of them, this doesn't affect what I'm trying to do (but it does make the code more difficult to understand, since you have to know more to figure out which <code>b</code> binding is the one affecting the values that get put out into my list):</p>\n\n<pre><code>\u03bb [ b | b &lt;- chars, b &lt;- bools ]\n[True,False,True,False,True,False]\n</code></pre>\n\n<p>So now we can look at your example:</p>\n\n<pre><code>exmp2 :: Reln -&gt; [(Int, Int)]\nexmp2 rs = [ (j, i) | (i,j) &lt;- rs, (j,i) &lt;- rs ]\n</code></pre>\n\n<p>This is taking every combination of <code>(i, j)</code> from <code>rs</code> and <code>(j, i)</code> from <code>rs</code>. Ignore the <code>i</code> and <code>j</code> for a moment; we're taking every combination of things we get by choosing two things from the same list. So we'll end up with the square of the number of items in <code>rs</code> in the output list.</p>\n\n<p>The first <code>(i, j) &lt;- rs</code> case binds the variables <code>i</code> and <code>j</code>. But the second case just binds the same variables again, so it's totally irrelevant what they were. We can just read this as if it was:</p>\n\n<pre><code>exmp2 rs = [ (j, i) | _ &lt;- rs, (j,i) &lt;- rs ]\n</code></pre>\n\n<p>So, for every possible combination of one pair from <code>rs</code> we don't care about, and another pair <code>(j, i)</code> from <code>rs</code>, produce the pair <code>(j, i)</code>.</p>\n\n<p>That's why in <code>exmpl2 [(1, 2), (2, 7), (1,9)]</code> you get the output containing 3 copies of the sequence <code>(1, 2), (2, 7), (1,9)</code>; once for the first pair <code>(1, 2)</code>, once for the second pair <code>(2, 7)</code>, and once for the third pair <code>(1, 9)</code>.</p>\n"}], "owner": {"reputation": 31, "user_id": 4200371, "user_type": "registered", "profile_image": "https://graph.facebook.com/100002932947943/picture?type=large", "display_name": "Edwin", "link": "https://stackoverflow.com/users/4200371/edwin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1472944239, "creation_date": 1472518538, "last_edit_date": 1472944239, "question_id": 39217306, "link": "https://stackoverflow.com/questions/39217306/haskell-list-comprehension-for-eq-relations", "title": "Haskell List Comprehension for Eq Relations", "body": "<p>I'm working through a class in Haskell and we are using list comprehensions for equivalence relations, which have been somewhat confusing. For example I can't wrap my head around what exactly is happening in this case.</p>\n\n<pre><code>exmp2 :: Reln -&gt; [(Int, Int)]\nexmp2 rs = [ (j, i) | (i,j) &lt;- rs, (j,i) &lt;- rs ]\n</code></pre>\n\n<p>vs</p>\n\n<pre><code>exmpl1 :: Reln -&gt; [(Int, Int)]\nexmpl1 rs = [ (j, i) | (i,j) &lt;- rs ]\n</code></pre>\n\n<p>If I use the above...</p>\n\n<p><code>exmpl1 [(1, 2), (2, 7), (1,9)]</code> outputs \n<code>[(2, 1), (7,2), (9,1)]</code></p>\n\n<p><code>exmpl2 [(1, 2), (2, 7), (1,9)]</code> outputs\n <code>[(1,2), (2,7), (1,9), (1,2), (2,7), (1,9), (1,2), (2,7), (1,9)]</code> </p>\n\n<p>I've gone through list comprehensions tutorials etc but I can't for the life of me figure out why exactly <code>exmpl2</code> outputs what is does. Thanks</p>\n"}, {"tags": ["haskell", "io", "osx-elcapitan"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 4, "creation_date": 1472515685, "post_id": 39216372, "comment_id": 65772329, "body": "Are you trying to run it in ghci?  It works for me via  <code>runhaskell program.hs</code>.  Update: under OSX 10.10.5, that is."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1472524186, "creation_date": 1472524186, "answer_id": 39217914, "question_id": 39216372, "link": "https://stackoverflow.com/questions/39216372/signal-eof-of-stdin-when-in-mac-os-x-terminal-with-ctrld-doesnt-work/39217914#39217914", "title": "signal EOF of stdin when in mac OS X terminal with ctrl+D doesn&#39;t work", "body": "<p>(Note: Question about running the program in GHCI.)</p>\n\n<p>According to <a href=\"https://ghc.haskell.org/trac/ghc/ticket/1268\" rel=\"nofollow\">this TRAC issue</a> from 9 years ago it is not considered a bug.</p>\n\n<p>You can <code>hSetBuffer stdin LineBuffering</code> and Control-D will be recognized, but GHCI will also raise a \"handle is closed\" error when it comes back to the REPL prompt and the session will terminate:</p>\n\n<pre><code>$ ghci  ./control-d.hs\nGHCi, version 7.10.2: http://www.haskell.org/ghc/  :? for help\n[1 of 1] Compiling Input            ( control-d.hs, interpreted )\nOk, modules loaded: Input.\n*Input&gt; import System.IO\n*Input System.IO&gt;  hSetBuffering stdin LineBuffering\n*Input System.IO&gt; :main\njhskdfjhdf\njhskdfjhdf&lt;stdin&gt;: hGetBuffering: illegal operation (handle is closed)\n$\n</code></pre>\n"}], "owner": {"reputation": 343, "user_id": 6268947, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/b27a22f070dbbc34e426bcd91fe078d2?s=128&d=identicon&r=PG&f=1", "display_name": "J.doe", "link": "https://stackoverflow.com/users/6268947/j-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 367, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1472544638, "creation_date": 1472511289, "last_edit_date": 1472544638, "question_id": 39216372, "link": "https://stackoverflow.com/questions/39216372/signal-eof-of-stdin-when-in-mac-os-x-terminal-with-ctrld-doesnt-work", "title": "signal EOF of stdin when in mac OS X terminal with ctrl+D doesn&#39;t work", "body": "<p>I am on a mac OS X EL Captain and try to figure out how to  signal  EOF , however ctrl + D  doesn't work. I have confirmed with the terminal using <code>stty all</code>  that eof = ^D.  </p>\n\n<p>With the following code in Haskell </p>\n\n<pre><code>Module Input where\n\nimport Data.List\nimport Data.Char\nimport System.IO (isEOF)\n\n\nmain =\n   interact (concat . sort . lines)\n</code></pre>\n\n<p>The expression will never give me any stdout -  I have tried ctrl+d , but nothing happens. Why is this? </p>\n\n<p><em>I run this program in GHCI</em></p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "edited": false, "score": 0, "creation_date": 1472512497, "post_id": 39216433, "comment_id": 65771577, "body": "if (cond) {} else if {} else {} = <code>If e s (If e&#39; s&#39; (Else s&#39;&#39;))</code>"}, {"owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "edited": false, "score": 0, "creation_date": 1472512678, "post_id": 39216433, "comment_id": 65771622, "body": "if (cond) {} = <code>If e s EndIf</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "edited": false, "score": 0, "creation_date": 1472514542, "post_id": 39216433, "comment_id": 65772059, "body": "@kurzweil4 Sure you can. <code>if(cond) {s} else if(cond&#39;) {s&#39;} else {s&#39;&#39;}</code> becomes <code>If (IfElse cond s (If (IfElse cond&#39; s&#39; s&#39;&#39;)))</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1472514640, "post_id": 39216433, "comment_id": 65772088, "body": "Proposal: scrap the <code>If</code> type entirely and write <code>data Statement = If Expr Statement (Maybe Statement) | While ... | ...</code>."}, {"owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1472515381, "post_id": 39216433, "comment_id": 65772258, "body": "@DanielWagner After looking at your proposal, I think that is actually excellent."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1472514596, "last_edit_date": 1472514596, "creation_date": 1472511618, "answer_id": 39216433, "question_id": 39215958, "link": "https://stackoverflow.com/questions/39215958/data-constructor-limitations/39216433#39216433", "title": "Data Constructor Limitations", "body": "<p>The problem is that an <code>If</code> <em>isn't</em> just an <code>Else</code>. You should define something like</p>\n\n<pre><code>data If = IfNoElse Expr Statement | IfElse Expr Statement Statement\ndata Statement = If If | While | ...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "edited": false, "score": 1, "creation_date": 1472515791, "post_id": 39216923, "comment_id": 65772361, "body": "This echoes what @DanielWagner commented above. But you formalized the answer first, so I will mark your answer as correct. Thanks for the excellent suggestions guys!"}, {"owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "edited": false, "score": 0, "creation_date": 1472518285, "post_id": 39216923, "comment_id": 65772899, "body": "After spending some time looking at this, I think I find the IfStat / IfElseStat the most elegant."}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 4, "last_activity_date": 1472515165, "creation_date": 1472515165, "answer_id": 39216923, "question_id": 39215958, "link": "https://stackoverflow.com/questions/39215958/data-constructor-limitations/39216923#39216923", "title": "Data Constructor Limitations", "body": "<p>This would be the traditional way of doing it:</p>\n\n<pre><code>data Stat = IfStat Expr Stat (Maybe Stat) | BarStat | BazStat | \u2026\ndata Expr = FooExpr | \u2026\n\n-- if (foo) bar;\nIfStat FooExpr BarStat Nothing\n\n-- if (foo) bar; else baz;\nIfStat FooExpr BarStat (Just BazStat)\n</code></pre>\n\n<p>The idea is to encode the grammar of your language as a data type, or at least the important bits. <code>Else</code> and <code>EndIf</code> don\u2019t make sense outside of an <code>If</code>, so you don\u2019t actually need to represent them.</p>\n\n<p>You can inline the <code>Maybe</code> into the statement data type:</p>\n\n<pre><code>data Stat = IfStat Expr Stat | IfElseStat Expr Stat Stat | \u2026\n</code></pre>\n\n<p>Or, if it makes sense for your language, you can add a representation for empty statements:</p>\n\n<pre><code>data Stat = IfStat Expr Stat Stat | EmptyStat | \u2026\n\n-- if (foo) bar;\n-- if (foo) bar; else;\nIfStat FooExpr BarStat EmptyStat\n\n-- if (foo) bar; else baz;\nIfStat FooExpr BarStat BazStat\n</code></pre>\n\n<p>However, normalising things like this can be problematic if you want exact pretty-printing later on.</p>\n\n<p>Block statements can be handled similarly:</p>\n\n<pre><code>data Stat = \u2026 | BlockStat [Stat] | \u2026\n\n-- if (foo) { bar; baz; }\nIfStat FooExpr (BlockStat [BarStat, BazStat]) EmptyStat\n</code></pre>\n"}], "owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 1, "accepted_answer_id": 39216923, "answer_count": 2, "score": 1, "last_activity_date": 1472517642, "creation_date": 1472508656, "last_edit_date": 1472517642, "question_id": 39215958, "link": "https://stackoverflow.com/questions/39215958/data-constructor-limitations", "title": "Data Constructor Limitations", "body": "<p>I have data structures as such:</p>\n\n<p><code>data IfTree = If Expr Statement IfTree | Else Statement | EndIf</code></p>\n\n<p><code>data Statement = IfStatement IfTree</code></p>\n\n<p>What is want is to make it impossible to do any of these combinations:</p>\n\n<pre><code>IfStatement $ Else ...\nIfStatement $ EndIf\n</code></pre>\n\n<p>An <code>IfStatement</code> should only be able to take an <code>If</code>.</p>\n\n<p>I am aware that I can hide the data constructors and only expose functions that compose them behind the scenes, but I want to limit this at the data type.</p>\n\n<p><strong>Update:</strong></p>\n\n<p>What I was trying to do was clunky. Thanks to the excellent answers and comments, a MUCH better way of handling this was given:</p>\n\n<p><code>data Statement = If Expr Statement (Maybe Statement) | ...</code></p>\n\n<p>or even:</p>\n\n<p><code>data Stat = IfStat Expr Stat | IfElseStat Expr Stat Stat | \u2026</code></p>\n"}, {"tags": ["haskell", "typeclass", "overlapping-instances"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1472546124, "post_id": 39215103, "comment_id": 65782921, "body": "<a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Semigroup.html\" rel=\"nofollow noreferrer\">That class already exists</a> as of GHC8, by the way"}], "answers": [{"comments": [{"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1472506924, "post_id": 39215640, "comment_id": 65769922, "body": "I&#39;ll just sit here and facepalm myself using all hands available. How did I not see this?"}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1472507159, "post_id": 39215640, "comment_id": 65770003, "body": "@ThreeFx: I figured out how to use the per-instance pragma. Also, I&#39;ve run into this problem myself\u2014it&#39;s weird to need an extension when I <i>use</i> an instance rather than when I define it!"}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 6, "last_activity_date": 1472507128, "last_edit_date": 1472507128, "creation_date": 1472506875, "answer_id": 39215640, "question_id": 39215103, "link": "https://stackoverflow.com/questions/39215103/ghc-overlapping-instances-when-generalising-addition/39215640#39215640", "title": "GHC Overlapping instances when generalising addition", "body": "<p>You need to enable overlapping instances in order to actually <em>use</em> them. In older versions of the compiler, you could do this per-module with the <code>OverlappingInstances</code> extension:</p>\n\n<pre><code>{-# LANGUAGE OverlappingInstances #-}\n</code></pre>\n\n<p>This works properly for this code:</p>\n\n<pre><code>\u03bb&gt; :set -XOverlappingInstances\n\u03bb&gt; \"abc\" + \"def\"\n\"abcdef\"\n</code></pre>\n\n<p>However, this approach is deprecated in newer versions of GHC (at least in 8.0):</p>\n\n<pre><code>Misc.hs:1:73-92: warning: \u2026\n    -XOverlappingInstances is deprecated: \n      instead use per-instance pragmas OVERLAPPING/OVERLAPPABLE/OVERLAPS\n</code></pre>\n\n<p>So the more modern approach is to specify this on a per-instance basis:</p>\n\n<pre><code>instance {-# OVERLAPPABLE #-} Num a =&gt; Addable a where\n  (+) = (Prelude.+)\n</code></pre>\n\n<p>This style of pragma also exists for <code>OVERLAPPING</code>, <code>OVERLAPS</code> and <code>INCOHERENT</code>, letting you annotate specific instances with these properties.</p>\n"}], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 622, "favorite_count": 1, "accepted_answer_id": 39215640, "answer_count": 1, "score": 3, "last_activity_date": 1472507128, "creation_date": 1472504338, "question_id": 39215103, "link": "https://stackoverflow.com/questions/39215103/ghc-overlapping-instances-when-generalising-addition", "title": "GHC Overlapping instances when generalising addition", "body": "<p>Trying to generalise <code>(+)</code> to more than just <code>Num</code>s, I wrote a up an <code>Addable</code> class:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>{-# LANGUAGE FlexibleContexts, FlexibleInstances, UndecidableInstances #-}\n\nclass Addable a where\n  (+) :: Addable a =&gt; a -&gt; a -&gt; a\n\ninstance Addable [a] where\n  (+) = (++)\n\ninstance Num a =&gt; Addable a where\n  (+) = (Prelude.+)\n</code></pre>\n\n<p>When trying to add (concatenate) lists, GHC complains about overlapping instances:</p>\n\n<pre><code>*Test&gt; \"abc\" + \"defghi\"\n\n&lt;interactive&gt;:84:7:\n    Overlapping instances for Addable [Char] arising from a use of `+'\n    Matching instances:\n      instance Num a =&gt; Addable a -- Defined at Utils.hs:23:10\n      instance Addable [a] -- Defined at Utils.hs:20:10\n    In the expression: \"abc\" + \"defghi\"\n    In an equation for `it': it = \"abc\" + \"defghi\"\n</code></pre>\n\n<p>I know that GHC disregards context when choosing instances of typeclasses, so trying to choose between <code>Addable [a]</code>  and <code>Addable a</code> is indeed a problem. However, I expect GHC to choose the first definition since it is more specific. <em>Why isn't that happening?</em></p>\n\n<p>Furthermore, is there an elegant workaround for this problem? Or am I going at this from the wrong angle?</p>\n"}, {"tags": ["haskell", "module"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1472503402, "post_id": 39214755, "comment_id": 65768484, "body": "The package you link only has <code>Data.Stream</code>. You must be  importing something else."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 1, "last_activity_date": 1472503380, "creation_date": 1472503380, "answer_id": 39214866, "question_id": 39214755, "link": "https://stackoverflow.com/questions/39214755/cannot-import-type-constructor-from-installed-package-in-haskell/39214866#39214866", "title": "Cannot import type constructor from installed package in Haskell", "body": "<p>You are importing the wrong module; looking at the top of your link, the module name is <code>Data.Stream</code>. (<code>Stream</code> is the name of the package -- it names a collection of modules to be installed.) So things should work better if you write</p>\n\n<pre><code>import Data.Stream\n\ntail' :: Stream a -&gt; Stream a\ntail' (Cons x s) = s\n</code></pre>\n\n<p>The fact that the incantation <code>import Stream</code> worked at all indicates to me that you have another package installed that provides this module, though I'm not sure which.</p>\n"}], "owner": {"reputation": 1161, "user_id": 3698413, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ed2687059a40a9ec609e0946bce0413a?s=128&d=identicon&r=PG&f=1", "display_name": "user287393", "link": "https://stackoverflow.com/users/3698413/user287393"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "accepted_answer_id": 39214866, "answer_count": 1, "score": 0, "last_activity_date": 1472503380, "creation_date": 1472502896, "question_id": 39214755, "link": "https://stackoverflow.com/questions/39214755/cannot-import-type-constructor-from-installed-package-in-haskell", "title": "Cannot import type constructor from installed package in Haskell", "body": "<p>I'm trying to use the <code>Stream</code> type defined in <a href=\"https://hackage.haskell.org/package/Stream-0.4.7.2/docs/Data-Stream.html\" rel=\"nofollow\">this package</a>. After installing with with cabal, I tried defining the tail function on streams as a quick test : </p>\n\n<pre><code>import Stream  \n\ntail' :: Stream a -&gt; Stream a\ntail' (Cons x s) = s\n</code></pre>\n\n<p>which gives me this error message :</p>\n\n<pre><code>test.hs:3:14: error:\n    Not in scope: type constructor or class `Stream'\n    Perhaps you meant `StreamT' (imported from Stream)\n\ntest.hs:3:26: error:\n    Not in scope: type constructor or class `Stream'\n    Perhaps you meant `StreamT' (imported from Stream)\n\ntest.hs:4:12: error: Not in scope: data constructor `Cons'\nFailed, modules loaded: none.\n</code></pre>\n\n<p>after some searches, I thought the problem might be that importing the module does not automatically import the type constructor <code>Stream</code> and constructor <code>Cons</code> with it. So I changed it to</p>\n\n<pre><code>import Stream (Stream, Cons)\n\ntail' :: Stream a -&gt; Stream a\ntail' (Cons x s) = s\n</code></pre>\n\n<p>after which I get</p>\n\n<pre><code>test.hs:1:20: error: Module `Stream' does not export `Stream'\n\ntest.hs:1:28: error: Module `Stream' does not export `Cons'\nFailed, modules loaded: none.\n</code></pre>\n\n<p>and this is puzzling. Do I have to alter the installed package and add <code>Stream</code> and <code>Cons</code> to its export list? Or am I not importing the module correctly?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1472494460, "post_id": 39212378, "comment_id": 65763943, "body": "Why would you be copying the list? That line suggests to me some substantial misunderstanding."}], "answers": [{"comments": [{"owner": {"reputation": 3024, "user_id": 3154996, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2031da3bb3fc999ec22e677995debd7b?s=128&d=identicon&r=PG&f=1", "display_name": "Elliot Gorokhovsky", "link": "https://stackoverflow.com/users/3154996/elliot-gorokhovsky"}, "edited": false, "score": 0, "creation_date": 1472581842, "post_id": 39212545, "comment_id": 65806454, "body": "If I understand correctly, this answer just addresses DFS. I&#39;m talking about topological sort, where vertices have to be appended to a list as they are discovered. I couldn&#39;t understand how this can be done in a functional style."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 3024, "user_id": 3154996, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2031da3bb3fc999ec22e677995debd7b?s=128&d=identicon&r=PG&f=1", "display_name": "Elliot Gorokhovsky", "link": "https://stackoverflow.com/users/3154996/elliot-gorokhovsky"}, "edited": false, "score": 1, "creation_date": 1472587721, "post_id": 39212545, "comment_id": 65809628, "body": "@Ren&#233;G The paper I linked goes on to discuss how to implement toposort on top of depth-first search. It&#39;s a bit longer than would reasonably fit in a StackOverflow answer, though, so I really do encourage you to give it a read. It&#39;s got a wealth of information, and is quite approachable."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 9, "last_activity_date": 1472494981, "last_edit_date": 1472494981, "creation_date": 1472494297, "answer_id": 39212545, "question_id": 39212378, "link": "https://stackoverflow.com/questions/39212378/functional-topological-sort/39212545#39212545", "title": "Functional topological sort", "body": "<p>The <a href=\"http://web.engr.oregonstate.edu/~erwig/papers/abstracts.html#JFP01\" rel=\"noreferrer\">fgl paper</a> discusses this exact question as its first example of how to do graph algorithms in a functional style:</p>\n\n<blockquote>\n<pre><code>dfs :: [Node] -&gt; Graph a b -&gt; [Node]\ndfs []     g        = []\ndfs (v:vs) (c &amp;v g) = v:dfs (suc c++vs) g\ndfs (v:vs) g        = dfs vs g\n</code></pre>\n  \n  <p>[Editor's note: the notation <code>c &amp;v g</code> is introduced earlier in the paper as a kind of \"pattern match on graphs\": <code>c &amp;v g</code> matches graphs containing the vertex <code>v</code>, binding <code>c</code> to a context giving edges in and out of the vertex and <code>g</code> to the graph with that node and all its edges deleted. In the Haskell library, this is realized by the function <a href=\"http://hackage.haskell.org/package/fgl-5.5.2.3/docs/Data-Graph-Inductive-Graph.html#v:match\" rel=\"noreferrer\"><code>match</code></a>.]</p>\n  \n  <p>The algorithm works as follows. If there are no nodes left to be visited (first case), <code>dfs</code> stops without returning any nodes. In contrast, if there are still nodes that must be visited, <code>dfs</code> tries to locate the context of the first of these nodes (<code>v</code>) in the argument graph. If this is possible (second equation), which is the case whenever <code>v</code> is contained in the argument graph, <code>v</code> is the next node on the resulting node list, and the search continues on the remaining graph <code>g</code> with the successors of <code>v</code> to be visited before the remaining list of nodes <code>vs</code>. The fact that the successors are put in front of all other nodes causes <code>dfs</code> to favor searching in the depth and not in the breadth. Finally, if <code>v</code> cannot be matched (last line), <code>dfs</code> continues the search with the remaining list of nodes <code>vs</code>. Note that the last case can only occur if <code>v</code> is not contained in the graph because otherwise the pattern in the second equation would have matched.</p>\n</blockquote>\n\n<p>As copy-and-paste wasn't working properly, I had to transcribe this text; any spelling mistakes are almost certainly mine rather than Martin Erwig's.</p>\n\n<p>As you suggest, the list of nodes left to visit is passed in as a parameter. However, your claim that this is inefficient seems off-target to me; the cost of constructing the new list <code>suc c++vs</code> is O(<code>length (suc c)</code>) -- but then you will have to visit all those nodes at least once to complete your depth-first search anyway, so that asymptotic cost is unavoidable.</p>\n\n<p>The full paper linked above spends quite some time discussing asymptotics and efficiency, and is also (in my opinion) quite enlightening, so I encourage you to give it a read.</p>\n"}], "owner": {"reputation": 3024, "user_id": 3154996, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2031da3bb3fc999ec22e677995debd7b?s=128&d=identicon&r=PG&f=1", "display_name": "Elliot Gorokhovsky", "link": "https://stackoverflow.com/users/3154996/elliot-gorokhovsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 717, "favorite_count": 0, "accepted_answer_id": 39212545, "answer_count": 1, "score": 4, "last_activity_date": 1472494981, "creation_date": 1472493643, "question_id": 39212378, "link": "https://stackoverflow.com/questions/39212378/functional-topological-sort", "title": "Functional topological sort", "body": "<p>In the topological sort algorithm, we perform DFS and push nodes onto a linked list as we encounter them. The only way I can think of to do this functionally would be do pass the list as a parameter into the calls, which is ugly and very inefficient (i.e., it shows up in the big O since copying the list is O(n). How would one do this idiomatically in Haskell? </p>\n"}, {"tags": ["haskell", "automated-tests", "quickcheck"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1472488706, "post_id": 39211023, "comment_id": 65760964, "body": "A list of two <i>units</i>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1472490374, "post_id": 39211023, "comment_id": 65761846, "body": "Meaning depends on the observer."}], "answers": [{"tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": false, "score": 6, "last_activity_date": 1472488670, "creation_date": 1472488670, "answer_id": 39211078, "question_id": 39211023, "link": "https://stackoverflow.com/questions/39211023/array-in-haskell/39211078#39211078", "title": "&quot;[(),()]&quot; array in Haskell", "body": "<p>That's a list of two <code>()</code> (or \"unit\") values.</p>\n\n<pre><code>Prelude&gt; :t [(),()]\n[(),()] :: [()]\nPrelude&gt; :info ()\ndata () = ()    -- Defined in \u2018GHC.Tuple\u2019\n</code></pre>\n\n<p>A list is not an array; an array is flat, with constant-time indexing. A list is a nested recursive type.</p>\n"}], "owner": {"reputation": 105, "user_id": 4809575, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/c72329f445630e8fae179221608685fe?s=128&d=identicon&r=PG", "display_name": "fant0me", "link": "https://stackoverflow.com/users/4809575/fant0me"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1472488670, "creation_date": 1472488496, "question_id": 39211023, "link": "https://stackoverflow.com/questions/39211023/array-in-haskell", "title": "&quot;[(),()]&quot; array in Haskell", "body": "<p>Recently, I've been doing automatic testing with Haskell and QuickCheck. Some time I have got some fails, but the program retrieved <code>[(),()]</code> as checked argument.</p>\n\n<p><strong>What does <code>\"[(),()]\"</code> mean?</strong></p>\n"}, {"tags": ["linux", "haskell", "cabal"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1472488579, "post_id": 39210942, "comment_id": 65760886, "body": "Is this the only error? Can you run a  verbose build?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1472490112, "post_id": 39210942, "comment_id": 65761723, "body": "Could you provide the entire output including your command?  Also, consider trying to install just <code>zlib</code> (ex: <code>cabal install zlib</code>) instead of building whatever larger project you&#39;re working in order to shrink the output a bit."}, {"owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "edited": false, "score": 0, "creation_date": 1472528663, "post_id": 39210942, "comment_id": 65775032, "body": "I have Ubuntu 16.04.1 LTS. I was able to install  <code>zlib</code>. I have the <code>zlib1g-dev</code> system package installed."}, {"owner": {"reputation": 9281, "user_id": 393758, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3ee15f717c343aabe3e14db32c22130b?s=128&d=identicon&r=PG", "display_name": "danza", "link": "https://stackoverflow.com/users/393758/danza"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1472546470, "post_id": 39210942, "comment_id": 65783138, "body": "thanks @n.m. for the hint. I ran the command again with verbosity <code>-v3</code> and i have got <code>&#47;usr&#47;include&#47;zlib.h:34:19: fatal error: zconf.h: No such file or directory</code> which is way more helpful for troubleshooting. You could write an answer suggesting to increase verbosity, that is what i was looking for, albeit simple. That was actually also suggested by cabal itself after the error! Anyway hopefully an answer can help somebody else"}, {"owner": {"reputation": 9281, "user_id": 393758, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3ee15f717c343aabe3e14db32c22130b?s=128&d=identicon&r=PG", "display_name": "danza", "link": "https://stackoverflow.com/users/393758/danza"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1472546509, "post_id": 39210942, "comment_id": 65783164, "body": "Also the suggestion from @ThomasM.DuBuisson is helpful, i was already following that"}, {"owner": {"reputation": 9281, "user_id": 393758, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3ee15f717c343aabe3e14db32c22130b?s=128&d=identicon&r=PG", "display_name": "danza", "link": "https://stackoverflow.com/users/393758/danza"}, "edited": false, "score": 0, "creation_date": 1472546597, "post_id": 39210942, "comment_id": 65783206, "body": "I had tried <code>-vvv</code> before, which is common for many other commands, but got a parsing error, so i thought that <code>-v</code> was the maximum i could ask for"}], "answers": [{"tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": true, "score": 2, "last_activity_date": 1472547461, "creation_date": 1472547461, "answer_id": 39222978, "question_id": 39210942, "link": "https://stackoverflow.com/questions/39210942/missing-native-library-to-build-an-haskell-package-with-cabal-on-linux/39222978#39222978", "title": "Missing native library to build an Haskell package with Cabal, on Linux", "body": "<p>If you increase build verbosity with say <code>-v3</code>, you will get actual compiler error messages.  In this case</p>\n\n<pre><code>/usr/include/zlib.h:34:19: fatal error: zconf.h: No such file or directory\n</code></pre>\n\n<p>A quick googling of the name <code>zlib.h</code> reveals that this is a confirmed open <a href=\"https://bugs.launchpad.net/ubuntu/+source/zlib/+bug/1155307\" rel=\"nofollow\">Ubuntu bug</a>.</p>\n"}], "owner": {"reputation": 9281, "user_id": 393758, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3ee15f717c343aabe3e14db32c22130b?s=128&d=identicon&r=PG", "display_name": "danza", "link": "https://stackoverflow.com/users/393758/danza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 216, "favorite_count": 0, "accepted_answer_id": 39222978, "answer_count": 1, "score": 0, "last_activity_date": 1472547461, "creation_date": 1472488187, "question_id": 39210942, "link": "https://stackoverflow.com/questions/39210942/missing-native-library-to-build-an-haskell-package-with-cabal-on-linux", "title": "Missing native library to build an Haskell package with Cabal, on Linux", "body": "<p>i get an error when trying to build an Haskell package which depends on a native C library, even though the header file seems to be at its place. The error says:</p>\n\n<pre><code>Missing (or bad) header file\n</code></pre>\n\n<p>What is the meaning of this error? How can i find out more? The file is not missing since i can find it in my system, under <code>/usr/include/</code>. I tried to use the <code>--extra-include-dirs</code> option in order to point Cabal to the header file which is present in my system, but i still get the error. So the file is not <em>missing</em>, how can it be <em>bad</em>?</p>\n\n<p>This is really a generic question about how to troubleshoot this kind of issues, but here are the details about my system:</p>\n\n<ul>\n<li>Package to install: <code>zlib</code></li>\n<li>Missing header: <code>zlib.h</code></li>\n<li>Header position in my system: <code>/usr/include/zlib.h</code></li>\n<li>Operative system: Ubuntu 16.04 </li>\n</ul>\n\n<p>I installed any possible Ubuntu <code>zlib-dev</code> package i could find, including 32 bit versions</p>\n"}, {"tags": ["haskell", "functional-programming", "ml"], "comments": [{"owner": {"reputation": 188, "user_id": 3429457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53b7cd29cd372b3b1fa2c25158d7f8e0?s=128&d=identicon&r=PG&f=1", "display_name": "RicardoVallejo", "link": "https://stackoverflow.com/users/3429457/ricardovallejo"}, "edited": false, "score": 0, "creation_date": 1472487330, "post_id": 39210584, "comment_id": 65760200, "body": "You&#39;re using a high order function, or a GoF in mathematics. Type :t to see the type. Refer to the book - learn you a Haskell"}, {"owner": {"reputation": 63, "user_id": 6012730, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/0a6fde0b572f308893a30aa4795fe08f?s=128&d=identicon&r=PG&f=1", "display_name": "mlhack", "link": "https://stackoverflow.com/users/6012730/mlhack"}, "reply_to_user": {"reputation": 188, "user_id": 3429457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53b7cd29cd372b3b1fa2c25158d7f8e0?s=128&d=identicon&r=PG&f=1", "display_name": "RicardoVallejo", "link": "https://stackoverflow.com/users/3429457/ricardovallejo"}, "edited": false, "score": 0, "creation_date": 1472487420, "post_id": 39210584, "comment_id": 65760242, "body": "I have to define it by myself, without typing anything."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1472487614, "post_id": 39210584, "comment_id": 65760342, "body": "I&#39;ve seen some recent SO questions using semi-colons at the end of Haskell &quot;statements&quot;. What book / learning resource did you pick that up from, because it is not needed and not typical Haskell."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1472492314, "post_id": 39210584, "comment_id": 65762846, "body": "@ErikR I think this is ML, not Haskell. Note also the single-quote prefixes on the type variables."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1472494039, "post_id": 39210584, "comment_id": 65763701, "body": "@DanielWagner, aren&#39;t semicolons separators in ML, rather than terminators?"}], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 6012730, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/0a6fde0b572f308893a30aa4795fe08f?s=128&d=identicon&r=PG&f=1", "display_name": "mlhack", "link": "https://stackoverflow.com/users/6012730/mlhack"}, "edited": false, "score": 0, "creation_date": 1472489281, "post_id": 39210750, "comment_id": 65761296, "body": "Thanks for the clear explantion, I understood it! :)"}], "tags": [], "owner": {"reputation": 1825, "user_id": 2671214, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/v464b.jpg?s=128&g=1", "display_name": "Tomasz Lewowski", "link": "https://stackoverflow.com/users/2671214/tomasz-lewowski"}, "is_accepted": true, "score": 3, "last_activity_date": 1472491572, "last_edit_date": 1472491572, "creation_date": 1472487414, "answer_id": 39210750, "question_id": 39210584, "link": "https://stackoverflow.com/questions/39210584/how-to-define-the-type-profile-for-this-function/39210750#39210750", "title": "How to define the type profile for this function?", "body": "<p><code>(a -&gt; a) -&gt; a -&gt; a</code> is the right answer. Let's split it to pieces to find out why.</p>\n\n<ol>\n<li>your function takes two arguments, <code>f</code> and <code>x</code>, so the signature will have three parts - say, <code>a -&gt; c -&gt; d</code></li>\n<li>first of these arguments is an unary function - that makes <code>a = (a -&gt; b)</code> (remember that <code>a</code> can be any type, as long as it appears only once in the signature) and the signature look like <code>(a -&gt; b) -&gt; c -&gt; d</code> </li>\n<li>result of <code>twice</code> is same as the result of its first argument - that makes <code>d = b</code> and the signature <code>(a -&gt; b) -&gt; c -&gt; b</code></li>\n<li><code>f</code> takes second argument of <code>twice</code> as its argument - this makes <code>c = a</code> and the signature look like this: <code>(a -&gt; b) -&gt; a -&gt; b</code></li>\n<li><code>twice</code> is applied to its own output, which means that <code>a = b</code> - this makes the final signature <code>(a -&gt; a) -&gt; a -&gt; a</code></li>\n</ol>\n"}], "owner": {"reputation": 63, "user_id": 6012730, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/0a6fde0b572f308893a30aa4795fe08f?s=128&d=identicon&r=PG&f=1", "display_name": "mlhack", "link": "https://stackoverflow.com/users/6012730/mlhack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 39210750, "answer_count": 1, "score": 2, "last_activity_date": 1472491572, "creation_date": 1472486810, "last_edit_date": 1472487066, "question_id": 39210584, "link": "https://stackoverflow.com/questions/39210584/how-to-define-the-type-profile-for-this-function", "title": "How to define the type profile for this function?", "body": "<p>I have to define the type profile of this function:</p>\n\n<pre><code>twice f x = f (f x);\n</code></pre>\n\n<p>The result should be the following, but I don't really get why.</p>\n\n<pre><code>('a -&gt; 'a) -&gt; 'a -&gt; 'a\n</code></pre>\n"}, {"tags": ["haskell", "testing"], "answers": [{"comments": [{"owner": {"reputation": 2229, "user_id": 720877, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/0b220fa4c0b59e883f360979ee745d63?s=128&d=identicon&r=PG", "display_name": "Croad Langshan", "link": "https://stackoverflow.com/users/720877/croad-langshan"}, "edited": false, "score": 0, "creation_date": 1472579366, "post_id": 39214530, "comment_id": 65805125, "body": "Also, the path / line number output is more conventional when using only <code>Test.Hspec</code>, rather than <code>Test.Hspec.Expectations</code> together than <code>Test.HUnitPlus</code>.  The regexp I was already using in emacs parses that output :-)"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 1, "last_activity_date": 1472501927, "creation_date": 1472501927, "answer_id": 39214530, "question_id": 39210574, "link": "https://stackoverflow.com/questions/39210574/line-numbers-from-hunit-plus-distribution-testsuite-stack-test-failures/39214530#39214530", "title": "Line numbers from HUnit-Plus / Distribution.TestSuite / stack test failures?", "body": "<p>Compilation errors are generated by GHC itself which gives you line numbers, <strike>to my knowledge no test suite has this feature, which would be a really nice thing to have though</strike>. What I found quite helpful is <a href=\"https://github.com/myfreeweb/hspec-expectations-pretty-diff\" rel=\"nofollow noreferrer\">hspec-expectations-pretty-diff</a> which is a nice diffing output <strike>but with no line numbers</strike>, I checked it also provides file path and line number!</p>\n\n<p><a href=\"https://i.stack.imgur.com/RsHbc.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/RsHbc.png\" alt=\"example output of hspec-expectations-pretty-diff\"></a></p>\n\n<p>Also I see some space for improvement for your test cases - usually a test case in my project has a string describing the test - therefore it is rarely ambiguous what test case failed. Also you can use the whole power of haskell to generate this <code>String</code>! </p>\n"}], "owner": {"reputation": 2229, "user_id": 720877, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/0b220fa4c0b59e883f360979ee745d63?s=128&d=identicon&r=PG", "display_name": "Croad Langshan", "link": "https://stackoverflow.com/users/720877/croad-langshan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 39214530, "answer_count": 1, "score": 0, "last_activity_date": 1472501927, "creation_date": 1472486758, "last_edit_date": 1472488399, "question_id": 39210574, "link": "https://stackoverflow.com/questions/39210574/line-numbers-from-hunit-plus-distribution-testsuite-stack-test-failures", "title": "Line numbers from HUnit-Plus / Distribution.TestSuite / stack test failures?", "body": "<p>I'm using <code>HUnit-Plus</code> via <code>stack test</code>, which I believe makes use of <code>Distribution.TestSuite</code>.</p>\n\n<p>When I get compilation errors, I get file paths and line numbers in the error.  This is great because I can just click on the error in my editor and jump straight to the relevant code.</p>\n\n<p>Other times there is no compilation error and instead I get output like this:</p>\n\n<pre><code>### Failure in testFoo: expected: 8\n</code></pre>\n\n<p>This isn't so great, because every time I have to navigate to the relevant test by hand.  Also, it is sometimes ambiguous which assertion has failed, and I have to add a string to label the assertion, which becomes repetitious because the string merely repeats in some form the content of the assertion (or else is meaningless).  With a line number that wouldn't be a problem.</p>\n\n<p>Is there a way to get this setup to print line numbers and file paths for test failures?</p>\n"}, {"tags": ["haskell", "ghc", "cabal", "haskell-stack"], "comments": [{"owner": {"reputation": 9139, "user_id": 773228, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/baaecdda322cf4462a0dd018d7959b1e?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Wood", "link": "https://stackoverflow.com/users/773228/justin-wood"}, "edited": false, "score": 0, "creation_date": 1472485401, "post_id": 39209910, "comment_id": 65759069, "body": "Are you aware the library profiling is already disabled by default? <code>--disable-library-profiling</code> is a <code>cabal</code> flag, not a <code>ghc</code> flag."}, {"owner": {"reputation": 2229, "user_id": 720877, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/0b220fa4c0b59e883f360979ee745d63?s=128&d=identicon&r=PG", "display_name": "Croad Langshan", "link": "https://stackoverflow.com/users/720877/croad-langshan"}, "reply_to_user": {"reputation": 9139, "user_id": 773228, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/baaecdda322cf4462a0dd018d7959b1e?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Wood", "link": "https://stackoverflow.com/users/773228/justin-wood"}, "edited": false, "score": 0, "creation_date": 1472485970, "post_id": 39209910, "comment_id": 65759409, "body": "I was unsure about that, thanks (but I&#39;d still like to know how to set cabal options).  Re that flag being for cabal: that&#39;s why I guessed that <code>cabal configure</code> would not put the flag where in fact it does, in <code>ghc-options</code>."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1472486756, "post_id": 39209910, "comment_id": 65759889, "body": "Are you sure you are using <code>ghc 6.7</code> ? IIRC, there was no 6.7 release."}, {"owner": {"reputation": 2229, "user_id": 720877, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/0b220fa4c0b59e883f360979ee745d63?s=128&d=identicon&r=PG", "display_name": "Croad Langshan", "link": "https://stackoverflow.com/users/720877/croad-langshan"}, "edited": false, "score": 0, "creation_date": 1472486879, "post_id": 39209910, "comment_id": 65759968, "body": "Hmm, I&#39;m not sure of that, no: I just know I&#39;m using <code>resolver: lts-6.7</code> in my <code>stack.yaml</code>, which I believe refers to: <a href=\"https://github.com/fpco/lts-haskell\" rel=\"nofollow noreferrer\">github.com/fpco/lts-haskell</a>"}], "answers": [{"tags": [], "owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "is_accepted": false, "score": 1, "last_activity_date": 1472522883, "creation_date": 1472522883, "answer_id": 39217758, "question_id": 39209910, "link": "https://stackoverflow.com/questions/39209910/setting-cabal-configuration-options-in-a-stack-project/39217758#39217758", "title": "Setting cabal configuration options in a stack project", "body": "<p>The stack equivalent of <code>--disable-library-profiling</code> is:</p>\n\n<pre><code>$ stack build --no-library-profiling\n</code></pre>\n"}], "owner": {"reputation": 2229, "user_id": 720877, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/0b220fa4c0b59e883f360979ee745d63?s=128&d=identicon&r=PG", "display_name": "Croad Langshan", "link": "https://stackoverflow.com/users/720877/croad-langshan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 328, "favorite_count": 2, "answer_count": 1, "score": 1, "last_activity_date": 1472522883, "creation_date": 1472484515, "last_edit_date": 1472484866, "question_id": 39209910, "link": "https://stackoverflow.com/questions/39209910/setting-cabal-configuration-options-in-a-stack-project", "title": "Setting cabal configuration options in a stack project", "body": "<p>In my stack project I have a <code>myproject.cabal</code> file.  I would like to try the cabal option <code>--disable-library-profiling</code> documented here:</p>\n\n<p><a href=\"https://www.haskell.org/cabal/users-guide/installing-packages.html\" rel=\"nofollow\">https://www.haskell.org/cabal/users-guide/installing-packages.html</a></p>\n\n<p>However, I've been unable to figure out where that option must be used: wherever I put it, subsequent stack runs exit with failure (complaining in one way or another about the option).</p>\n\n<p>My higher-level goal is to see if this speeds up ghc compilation for my project, but that's really secondary as far as this question goes: I'd really just like to know how these configuration options work (in the context of stack projects).</p>\n\n<p>I'm using ghc 6.7.  In particular, if I use <code>cabal configure</code>, the option ends up configured in <code>ghc-options</code> in my <code>myproject.cabal</code> file, but GHC then complains:</p>\n\n<pre><code>ghc: unrecognised flag: --disable-library-profiling\n</code></pre>\n\n<p>I'm already using other <code>ghc-options</code> without running into similar trouble -- stack completes successfully in this case:</p>\n\n<pre><code>  ghc-options:         -threaded -rtsopts -with-rtsopts=-N -O0 -j +RTS -A128m -n2m -RTS\n</code></pre>\n\n<p>but not in this case:</p>\n\n<pre><code>  ghc-options:         -threaded -rtsopts -with-rtsopts=-N -O0 -j +RTS -A128m -n2m -RTS --disable-library-profiling\n</code></pre>\n"}, {"tags": ["haskell", "ghc"], "answers": [{"comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1472483459, "post_id": 39209541, "comment_id": 65757890, "body": "I see that that happened, but why does that have any performance implications? Shouldn&#39;t the &quot;inlined&quot; version (from the slow core) be no slower?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1472483701, "post_id": 39209541, "comment_id": 65758040, "body": "GHC moved the computation of <code>w</code> to be outside of the call to <code>go</code>.  Even though you&#39;ve inlined <code>mybench</code>, it is still recomputing <code>w</code> every time <code>go</code> is called. This isn&#39;t happening in the fast version."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1472483814, "post_id": 39209541, "comment_id": 65758105, "body": "So when GHC factors out the computation, I get <i>sharing</i>. That makes sense!"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1472484372, "post_id": 39209541, "comment_id": 65758451, "body": "@Eric if you add <code>{-# options_ghc -fno-full-laziness #-}</code>, you disable lifting-out and the two code performs the same. My general advice is to enable <code>no-full-laziness</code> for numeric and really high-performance code and control lifting manually."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1472484736, "post_id": 39209541, "comment_id": 65758678, "body": "@Andr&#225;sKov&#225;cs They do perform the same...but they both take 6.1ms, 5x slower than the original slow version! Doesn&#39;t seem like good advice to me, what am I missing?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1472485180, "post_id": 39209541, "comment_id": 65758948, "body": "@Eric of course you have to lift manually in that case! The benefit comes from knowing precisely where computation takes place, and also from being able to prevent mishaps like fusion failing because of lifting. You can&#39;t develop a good intuition for numeric performance if GHC keeps surprising you with opaque lifting."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 4, "last_activity_date": 1472484741, "last_edit_date": 1472484741, "creation_date": 1472483371, "answer_id": 39209541, "question_id": 39209172, "link": "https://stackoverflow.com/questions/39209172/performance-analysis-via-core/39209541#39209541", "title": "Performance Analysis via Core", "body": "<p>It looks like in the fast version GHC lifted the computation:</p>\n\n<pre><code> y = fromInteger ((-9223372036854775808) + w `mod` 18446744073709551616)\n</code></pre>\n\n<p>out of the definition of <code>go</code>. Just look at where <code>modInteger</code> and <code>plusInteger</code> occur in both dumps.</p>\n\n<p>It looks like in the assignment <code>w = f 1 0 g</code> it inlined the definition of <code>f</code> so that it doesn't have to compute <code>w</code> on each call to <code>go</code>.\nMore specifically, <code>f 1 0 g</code> doesn't depend on any the parameters to <code>go</code> - ie. <code>s</code>, <code>i</code> or <code>g</code>, and so it's computation can be lifted out.</p>\n\n<p>Even though <code>g</code> is passed to <code>f</code> in the expression <code>f 1 0 g</code>, it doesn't actually get used.</p>\n"}], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 1, "accepted_answer_id": 39209541, "answer_count": 1, "score": 3, "last_activity_date": 1472484741, "creation_date": 1472482313, "question_id": 39209172, "link": "https://stackoverflow.com/questions/39209172/performance-analysis-via-core", "title": "Performance Analysis via Core", "body": "<p>The following code runs in about 1.5ms on my computer (compiled with GHC 8.0.1 and -02):</p>\n\n<pre><code>import Criterion\nimport Data.Bits\nimport Data.Int\nimport Criterion.Main\n\nmain :: IO ()\nmain = defaultMain [bench \"mybench\" $ nf (mybench 3840) (0 :: Int)]\n\nmybench :: Int -&gt; Int -&gt; Double\n{-# INLINE mybench #-}\nmybench n = go 0 n\n  where go s i g | i == 0 = s\n                 | otherwise =\n                      let (w,_) = f 1 0 g\n                          --w = f 1 0 g\n                          f mag v gen | mag &gt;= 18446744073709551616000 = (v,gen)\n                          --f mag v gen | mag &gt;= 18446744073709551616000 = v\n                                      | otherwise = v' `seq` f (mag*18446744073709551616 :: Integer) v' gen where\n                                            x = -8499970308474009078 :: Int\n                                            v' = (v * 18446744073709551616 + (fromIntegral x + 9223372036854775808))\n\n                          y = fromInteger ((-9223372036854775808) + w `mod` 18446744073709551616)\n                          coef = (fromIntegral (9007199254740991 .&amp;. (y::Int64)) :: Double) /  9007199254740992\n                          z = 2.0 * (-0.5 + coef)\n                      in go (z+s) (i-1) g\n</code></pre>\n\n<p>However, if I use the commented alternates of <code>w</code> and <code>f</code>, the code runs in ~31\u03bcs! This was surprising to me since I changed very little, and because <code>f</code> runs twice for each of 3,840 iterations (i.e., the code is barely used).</p>\n\n<p>I went to the core to investigate. Here's the relevant portions of <code>-ddump-simpl</code> from the <a href=\"http://lpaste.net/181325\" rel=\"nofollow\">slow version</a> and <a href=\"http://lpaste.net/181324\" rel=\"nofollow\">fast version</a>.</p>\n\n<p>Unfortunately, I can't see from the core what is making such a huge difference. The primary difference that I see is that in the fast version, GHC has realized that <code>f</code> doesn't need the <code>gen</code> argument. But surely that can't make a 45x/2 orders of magnitude performance difference. </p>\n\n<p>The source code is a bit contrived (several args aren't needed or used), so my main question is about the core: I don't see any differences that would indicate such a drastic performance difference. What am I missing when analyzing the core? As a followup, what could I do at the source level of the first/slow version to get it to perform like the second/fast version?</p>\n"}, {"tags": ["haskell", "ghc", "compiler-optimization"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1472481854, "post_id": 39208877, "comment_id": 65756886, "body": "I think &quot;by reading core&quot; is the answer. Why don&#39;t you want to do that? You may be able to guess by inserting functions from <code>Debug.Trace</code>, but I wouldn&#39;t rely on that."}, {"owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1472482145, "post_id": 39208877, "comment_id": 65757064, "body": "@jberryman Are there rules of thumb that indicate what code is likely or not likely to be optimized?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1472483859, "post_id": 39208877, "comment_id": 65758135, "body": "Unrelated, but nondeterminism is modeled with lists, not tuples. <code>quadratic a b c = [ans1, ans2] where ...</code>"}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 4, "last_activity_date": 1472482405, "last_edit_date": 1495541415, "creation_date": 1472482079, "answer_id": 39209097, "question_id": 39208877, "link": "https://stackoverflow.com/questions/39208877/how-to-tell-that-common-subexpression-elimination-is-happening-or-not-in-ghc/39209097#39209097", "title": "How to tell that common subexpression elimination is happening or not in GHC?", "body": "<p>Using <code>trace</code> might tell you as demonstrated in <a href=\"https://stackoverflow.com/questions/5920200/how-to-prevent-common-sub-expression-elimination-cse-with-ghc\">this SO question</a>.</p>\n\n<pre><code>import Debug.Trace\n\nquadratic a b c = (ans1, ans2)\n  where\n    ans1 = ((-b) + tr1 (sqrt (b * b - 4 * a * c))) / (2 * a)\n    ans2 = ((-b) - tr2 (sqrt (b * b - 4 * a * c))) / (2 * a)\n    tr1 = trace \"ans1\"\n    tr2 = trace \"ans2\"\n\nmain = print $ quadratic 1 10 3\n</code></pre>\n\n<p>Compiling this with <code>-O2</code> or <code>-O3</code> shows both <code>ans1</code> and <code>ans2</code> in the trace output indicating that GHC did not perform the CSE. You get similar\nresults if you use <code>tr1</code> in both places.</p>\n\n<p>The Haskell Wiki mentions that GHC only performs CSE in limited\ncircumstances -  <a href=\"https://wiki.haskell.org/GHC_optimisations#Common_subexpression_elimination\" rel=\"nofollow noreferrer\">(link)</a> - and that you are advised to perform\nit yourself if you want to make sure it happens.</p>\n"}], "owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 209, "favorite_count": 0, "accepted_answer_id": 39209097, "answer_count": 1, "score": 0, "last_activity_date": 1490323180, "creation_date": 1472481451, "last_edit_date": 1490323180, "question_id": 39208877, "link": "https://stackoverflow.com/questions/39208877/how-to-tell-that-common-subexpression-elimination-is-happening-or-not-in-ghc", "title": "How to tell that common subexpression elimination is happening or not in GHC?", "body": "<p>Let's say I have a naively implemented function like this:</p>\n\n<pre><code>quadratic a b c = (ans1, ans2)\n  where\n    ans1 = ((-b) + sqrt (b * b - 4 * a * c)) / (2 * a)\n    ans2 = ((-b) - sqrt (b * b - 4 * a * c)) / (2 * a)\n</code></pre>\n\n<p>There are multiple identical subexpressions. How can I tell without reading core that common subexpression elimination is happening or not and to which parts of this?</p>\n"}, {"tags": ["parsing", "haskell", "parsec"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 6125576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a87a1a5d1200de42da2bf2c5f397f380?s=128&d=identicon&r=PG&f=1", "display_name": "trenta3", "link": "https://stackoverflow.com/users/6125576/trenta3"}, "edited": false, "score": 0, "creation_date": 1472507899, "post_id": 39207991, "comment_id": 65770258, "body": "Accepted because it fits better with what I&#39;ve already done. When I have more time I will also check megaparsec, as adviced by the other answer"}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 2, "last_activity_date": 1472478688, "creation_date": 1472478688, "answer_id": 39207991, "question_id": 39207387, "link": "https://stackoverflow.com/questions/39207387/haskell-parser-with-spell-checking/39207991#39207991", "title": "haskell parser with spell-checking", "body": "<p>You can use Parsec's <a href=\"https://hackage.haskell.org/package/parsec-3.1.11/docs/Text-Parsec.html#v:getPosition\" rel=\"nofollow\"><code>getPosition</code></a> action to get the current position in the input stream. You can then store it in your AST type (i.e. changing it to something like</p>\n\n<pre><code>data TexFile = Items [(SourcePos, TexTerm)]\n</code></pre>\n\n<p>)</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1472481516, "creation_date": 1472481516, "answer_id": 39208898, "question_id": 39207387, "link": "https://stackoverflow.com/questions/39207387/haskell-parser-with-spell-checking/39208898#39208898", "title": "haskell parser with spell-checking", "body": "<p>Your basic problem is that you are throwing away information about\nwhite space in the file. If you recorded white space as another TexTerm\nyou could a) reconstruct the file contents from a TexFile, and b) know\nwhat line each TexTerm appears on.</p>\n\n<p>So one approach is to add a <code>WhiteSpace</code> constructor for <code>TexTerm</code>:</p>\n\n<pre><code>data TexTerm = Comment String\n             | ...\n             | WhiteSpace String\n</code></pre>\n\n<p>Now as you traverse your AST you can determine what line each construct is on by counting the number of newline characters in each <code>WhiteSpace</code> constructor.</p>\n\n<p>However, this will complicate your parser since you are skipping white space using <code>lexeme</code>. If all you need to do is spellcheck the TeX document,\nI would suggest a \"tag-soup\" approach using simpler data structures:</p>\n\n<pre><code>type TexFile = [TexTerm]\n\ndata TeXTerm = Comment String\n             | Formula String\n             | Command String      -- e.g. \\someCommand\n             | Text String\n             | Sym String          -- e.g. Sym \"{\" or Sym \"}\"\n             | WhiteSpace String   -- e.g. WhiteSpace \"\\n\"\n</code></pre>\n\n<p>Note that <code>TeXFile</code> and <code>TexTerm</code> are flat - non-recursive - data structures. We are simply tokenizing the TeX input.</p>\n"}], "owner": {"reputation": 11, "user_id": 6125576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a87a1a5d1200de42da2bf2c5f397f380?s=128&d=identicon&r=PG&f=1", "display_name": "trenta3", "link": "https://stackoverflow.com/users/6125576/trenta3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 0, "accepted_answer_id": 39207991, "answer_count": 2, "score": 1, "last_activity_date": 1472485926, "creation_date": 1472476910, "last_edit_date": 1472478703, "question_id": 39207387, "link": "https://stackoverflow.com/questions/39207387/haskell-parser-with-spell-checking", "title": "haskell parser with spell-checking", "body": "<p>in order to learn a bit more of Haskell (especially Monads) I'm trying to build a spell-checker. My goal is to be able to go through a LaTeX document and do something on words that aren't in a dictionary list.</p>\n\n<p>I've already written the parser (string to AST), which code i paste below. It basically returns the LaTeX source chunked in relevant pieces (text, formulas, commands, etc.). I would like to know how to build a program such that on every word not found in a list, we ask the user what word to substitute.</p>\n\n<p>(What we really care about LaTeX is that we have some part of the source that are text and have to be spell-checked, and other parts that are formulas and not plain english)</p>\n\n<hr>\n\n<p>Let me explain it more clearly with some examples of desired behaviour (for simplicity formulas are between <code>$ HERE IS THE FORMULA $</code>)</p>\n\n<p>Source:</p>\n\n<pre><code>This is my frst file and here\nwe have a formula: $\\forall x \\quad x$\n</code></pre>\n\n<p>Desired behaviour:</p>\n\n<pre><code>In file 'first.tex' at line 1: 'frst' unknown\n1 This is my **frst** file and here\n2 we have a formula: $\\forall x \\quad x$\nAction [Add word to dictionary / Change word]? \n</code></pre>\n\n<hr>\n\n<p>The main problem is, after I've parsed the file, I'm left with an AST and have no more references to lines, so i could not display them like the above example.</p>\n\n<hr>\n\n<p>Code for the parser:</p>\n\n<pre><code>import System.Environment\nimport Text.Parsec (ParseError)\nimport Text.Parsec.String (Parser, parseFromFile)\nimport Text.Parsec.String.Parsec (try)\nimport Text.Parsec.String.Char (oneOf, char, digit, string, letter, satisfy, noneOf, anyChar)\nimport Text.Parsec.String.Combinator (many1, choice, chainl1, between, count, option, optionMaybe, optional, manyTill, eof, lookAhead)\nimport Control.Applicative ((&lt;$&gt;), (&lt;*&gt;), (&lt;*), (*&gt;), (&lt;|&gt;), many, (&lt;$))\nimport Control.Monad (void, ap, mzero)\nimport Data.Char (isLetter, isDigit)\nimport FunctionsAndTypesForParsing\n\ndata TexFile = Items [TexTerm]\n              deriving (Eq, Show)\n\ndata TexTerm = Comment String\n             | Formula String\n             | Command String [TexFile]\n             | Text String\n             | Block TexFile\n               deriving (Eq, Show)\n\n-- We get the AST as output                                                                                                                                           \ntexFile :: Parser TexFile\ntexFile = Items &lt;$&gt; (many texTerm) &lt;* (optional (try $ eof))\n\ntexTerm :: Parser TexTerm\ntexTerm = lexeme $ (try comment &lt;|&gt; text &lt;|&gt; formula &lt;|&gt; command &lt;|&gt; block)\n\nwhitespace :: Parser ()\nwhitespace = void $ try $ oneOf \" \\n\\t\"\n\nlexeme :: Parser a -&gt; Parser a\nlexeme p = p &lt;* (many $ whitespace)\n\ncomment :: Parser TexTerm\ncomment = Comment &lt;$&gt; between (string \"%\") (string \"\\n\") (many $ noneOf \"\\n\")\n\nformula :: Parser TexTerm\nformula = Formula &lt;$&gt; (try singledollar &lt;|&gt; doubledollar &lt;|&gt; equation &lt;|&gt; align)\n  where\n    singledollar = between (string \"$\") (string \"$\") (many1 $ noneOf \"$\")\n    doubledollar = between (string \"$$\") (string \"$$\") (many1 $ noneOf \"$$\")\n    equation = try $ between (try $ string \"\\\\begin{equation}\") (string \"\\\\end{equation}\") (manyTill anyChar (lookAhead $ try $ string \"\\\\end{equation}\"))\n    align = try $ between (try $ string \"\\\\begin{align*}\") (string \"\\\\end{align*}\") (manyTill anyChar (lookAhead $ try $ string \"\\\\end{align*}\"))\n\ncommand :: Parser TexTerm\ncommand = Command &lt;$&gt; com &lt;*&gt; (many arg)\n  where\n    com = char '\\\\' *&gt; (manyTill (try letter &lt;|&gt; oneOf \"*\") (lookAhead $ try $ oneOf \"[{ \\\\\\n\\t\"))\n    arg = (try (between (string \"{\") (string \"}\") texFile)\n           &lt;|&gt; (between (string \"[\") (string \"]\") texFile)\n          )\n\ntext :: Parser TexTerm\ntext = Text &lt;$&gt; many1 textualchars\n  where\n    textualchars = try letter &lt;|&gt; digit &lt;|&gt; oneOf \" \\n\\t\\r,.*:;-&lt;&gt;#@()`_!'?\"\n\nblock :: Parser TexTerm\nblock = Block &lt;$&gt; between (string \"{\") (string \"}\") texFile\n</code></pre>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1472477574, "post_id": 39207345, "comment_id": 65754140, "body": "I think there&#39;s a duplicate. Related <a href=\"https://stackoverflow.com/questions/16202289/haskell-function-composition-type-of-and-how-its-presented\" title=\"haskell function composition type of and how its presented\">stackoverflow.com/questions/16202289/&hellip;</a>? But that one doesn&#39;t actually explain the type."}, {"owner": {"reputation": 932, "user_id": 4060922, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dpl7T.jpg?s=128&g=1", "display_name": "Damiano", "link": "https://stackoverflow.com/users/4060922/damiano"}, "edited": false, "score": 3, "creation_date": 1472484735, "post_id": 39207345, "comment_id": 65758677, "body": "Should be closed. Reason: Porn."}], "answers": [{"tags": [], "owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "is_accepted": false, "score": 2, "last_activity_date": 1472477861, "creation_date": 1472477861, "answer_id": 39207691, "question_id": 39207345, "link": "https://stackoverflow.com/questions/39207345/how-to-understand-the-function-in-haskell/39207691#39207691", "title": "How to understand the function &quot;(.)(.)&quot; in Haskell", "body": "<p>The function <code>(.)</code> has the type <code>(b -&gt; c) -&gt; (a -&gt; b) -&gt; (a -&gt; c)</code>, i.e. given two functions, one from <code>a</code> to <code>b</code> and one from <code>b</code> to <code>c</code>, it sticks them together to form a single <code>a</code> to <code>c</code> function.</p>\n\n<p>Let's write the type of <code>(.)</code> again, but using different letters to distinguish them: <code>(y -&gt; z) -&gt; (x -&gt; y) -&gt; (x -&gt; z)</code>. Let's say the <code>a b c</code> version is the first <code>(.)</code> in <code>(.)(.)</code>, and the <code>x y z</code> version is the second. We pass the second as the first argument to the first. Remember that the first argument to the first has the type <code>(b -&gt; c)</code>, so we need to match that against the type of the second function.</p>\n\n<p>You may notice that there's a mismatch here: <code>(b -&gt; c)</code> is a function that takes one argument, but <code>(.)</code> takes two. But in Haskell, all functions are curried, which means that a function taking two arguments is really the same thing as a function that takes one argument and returns another function that takes one argument (the second of the original two), and only that function then returns the real result.</p>\n\n<p>Or in other words, the arrow type constructor binds right to left, and we can put in parentheses to make it clearer: for our purposes, the type of the second <code>(.)</code> is better written as <code>(y -&gt; z) -&gt; ((x -&gt; y) -&gt; (x -&gt; z))</code>. Match this against <code>(b -&gt; c)</code> and it is clear that this means that <code>b = (y -&gt; z)</code> and <code>c = ((x -&gt; y) -&gt; (x -&gt; z))</code>.</p>\n\n<p>The first argument being given, the result is the remainder of the type of the first <code>(.)</code> with the type variables replaced by our substitutions - the type of <code>(.)(.)</code> is therefore <code>(a -&gt; (y -&gt; z)) -&gt; (a -&gt; ((x -&gt; y) -&gt; (x -&gt; z)))</code>.</p>\n\n<p>Now we can drop all parentheses that are on the right of an arrow to simplify this expression and get <code>(a -&gt; y -&gt; z) -&gt; a -&gt; (x -&gt; y) -&gt; x -&gt; z</code>. It is easy to see that this is exactly (modulo renaming) what GHCi gave you.</p>\n\n<p>And this type and function means, \"given a binary function <code>b</code> that takes an <code>a</code> and a <code>y</code> and returns a <code>z</code>, and given also a value <code>va</code> of type <code>a</code>, and given an unary function <code>u</code> that takes an <code>x</code> and returns a <code>y</code>, and given finally a value <code>vx</code> of type <code>x</code>, give me the <code>z</code> that results from the computation <code>b va (u vx)</code>.</p>\n\n<p>You probably won't need it. The only reason the function is interesting is that it looks like boobs.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 3, "last_activity_date": 1472483128, "last_edit_date": 1472483128, "creation_date": 1472478634, "answer_id": 39207973, "question_id": 39207345, "link": "https://stackoverflow.com/questions/39207345/how-to-understand-the-function-in-haskell/39207973#39207973", "title": "How to understand the function &quot;(.)(.)&quot; in Haskell", "body": "<p>This is a partial application of the composition operator <em>to</em> the composition operator itself. In general, we know that if we apply <code>(.)</code> to some function <code>f :: x -&gt; y</code>, then</p>\n\n<pre><code>&gt;&gt;&gt; :t (.) f\n(.) f :: (a -&gt; x) -&gt; a -&gt; y\n</code></pre>\n\n<p>because of how the types line up:</p>\n\n<pre><code>(b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n x -&gt; y\n--------------------------------\n            (a -&gt; x) -&gt; a -&gt; y\n</code></pre>\n\n<p>We drop the first argument, and replace remaining occurrences of <code>b</code> and <code>c</code> with the corresponding types of the given argument.</p>\n\n<p>Here, <code>f</code> is just <code>(.)</code> again, meaning we identify <code>x ~ (b -&gt; c)</code> and <code>y ~ (a -&gt; b) -&gt; a -&gt; c</code>. Lining up the types again</p>\n\n<pre><code>(a -&gt;   x   )  -&gt; a -&gt;              y\n      b -&gt; c               (a -&gt; b) -&gt; a -&gt; c\n</code></pre>\n\n<p>Since <code>a</code> occurs on the top and the bottom, we need to pick a new variable name for <code>a</code> on the bottom; GHC chose <code>a1</code>:</p>\n\n<pre><code>(a -&gt;   x   )  -&gt; a -&gt;               y\n      b -&gt; c               (a1 -&gt; b) -&gt; a1 -&gt; c\n</code></pre>\n\n<p>Putting the two together yields the type you see in GHCi.</p>\n\n<pre><code>(a -&gt; b -&gt; c) -&gt; a -&gt; (a1 -&gt; b) -&gt; a1 -&gt; c\n</code></pre>\n\n<hr>\n\n<p>Anatomy jokes aside, what <em>is</em> <code>(.)(.)</code>?</p>\n\n<p>Let's say you have a function <code>f :: a -&gt; b</code>, but you want a function <code>g :: a -&gt; c</code>, that is, you want <code>f</code> but with a different return type. The only thing you can do is find a helper function <code>h :: b -&gt; c</code> that will convert the return value for you. Your function <code>g</code> is then simply the composition of <code>h</code> and <code>f</code>:</p>\n\n<pre><code>g = h . f\n</code></pre>\n\n<p>You might, however, have a more general function <code>h' :: t -&gt; b -&gt; c</code>, which can\nturn values of  type <code>b</code> into values of type <code>c</code> in multiple ways, depending on the value of some argument <code>x :: t</code>. Then you could get lots of different <code>g</code>s depending on that argument.</p>\n\n<pre><code>g = (h' x) . f\n</code></pre>\n\n<p>Now, given <code>h'</code>, <code>x</code>, and <code>f</code>, we can return our <code>g</code>, so let's write a function that does that: a function that \"promotes\" the return value of <code>f</code> from a value of type <code>b</code> to a value of type <code>c</code>, given a function <code>h'</code> and some value <code>x</code>:</p>\n\n<pre><code>promote h' x f = (h' x) . f\n</code></pre>\n\n<p>You can mechanically convert any function to point-free form; I'm not familiar with the details, but using <a href=\"http://pointfree.io\" rel=\"nofollow\">PointFree.io</a> produces</p>\n\n<pre><code>promote = ((.) .)\n</code></pre>\n\n<p>which is just the partial application <code>(.) (.)</code> written as a section, that is: </p>\n\n<pre><code>((.) (.)) h' x f == (h' x) . f\n</code></pre>\n\n<p>So, our \"boobs\" operator is just a generalized pre-composition operator.</p>\n"}, {"tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": false, "score": 0, "last_activity_date": 1472482522, "last_edit_date": 1472482522, "creation_date": 1472479865, "answer_id": 39208365, "question_id": 39207345, "link": "https://stackoverflow.com/questions/39207345/how-to-understand-the-function-in-haskell/39208365#39208365", "title": "How to understand the function &quot;(.)(.)&quot; in Haskell", "body": "<pre><code>           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \n           \u2502                                                                          \u2502\n      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                             \u2502\n      \u2502    \u2502                                            \u2502                             \u2502\n \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n \u2502    \u2502    \u2502               \u2502                      \u2502     \u2502                \u2502            \u2502\n \u2193    \u2193    \u2193               \u2502                      \u2193     \u2502                \u2502            \u2502 \n(a -&gt; b -&gt; c)      -&gt;      a          -&gt;         (a1 -&gt; b)        -&gt;     a1     -&gt;    c\n \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500              \u2500\u2500\u2500                     \u2500\u2500\u2500\u2500\u2500\u2500\u2500                \u2500\u2500        \n      \u2193                    \u2193                         \u2193                   \u2193\n     (f)                  (x)                       (g)                 (y)\n      \u2193                    \u2193                         \u2193                   \u2193\na function        a thing that works      a function of one        a thing that\nof two arguments  as the first argument   argument that            works as the\nthat returns      of f                    returns a thing          argument of g\nthe same type                             suitable as the second\n(.)(.) returns                            argument of f\n</code></pre>\n\n<p>Now how can we combine these four things?</p>\n\n<p>First we can take <code>f</code> and apply it to <code>x</code>. What does this give us? A function of one argument. Its type should be <code>b-&gt;c</code>, because we have just applied a function of type <code>a-&gt;b-&gt;c</code> to an argument of type <code>a</code>.</p>\n\n<p>Then we can take the second <code>g</code> and apply it to <code>y</code>. This gives us something of type <code>b</code>.</p>\n\n<p>Then we can take a function of type <code>b-&gt;c</code> computed at the first step, and apply it to that thing of type <code>b</code> computed at the second step. This gives us something of type <code>c</code>, the result type of the entire <code>(.)(.)</code> construction, which is just what we need.</p>\n\n<p>Note how all of this can be discovered by looking at just the type. No need to know how the function was originally implemented at all.</p>\n"}], "owner": {"reputation": 63, "user_id": 6606087, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0055c03f1a6d84c695eac44919fcbe5?s=128&d=identicon&r=PG&f=1", "display_name": "zhangyunqi", "link": "https://stackoverflow.com/users/6606087/zhangyunqi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1275, "favorite_count": 4, "accepted_answer_id": 39207973, "answer_count": 3, "score": 6, "last_activity_date": 1472483128, "creation_date": 1472476740, "last_edit_date": 1472477351, "question_id": 39207345, "link": "https://stackoverflow.com/questions/39207345/how-to-understand-the-function-in-haskell", "title": "How to understand the function &quot;(.)(.)&quot; in Haskell", "body": "<p>I am a beginner in Haskell and I come across the function <code>(.)(.)</code>, I use <code>:t</code> to get its type in GHCi:</p>\n\n<pre><code>:t (.)(.)\n(.)(.) :: (a -&gt; b -&gt; c) -&gt; a -&gt; (a1 -&gt; b) -&gt; a1 -&gt; c\n</code></pre>\n\n<p>How to understand the type <code>(.)(.) :: (a -&gt; b -&gt; c) -&gt; a -&gt; (a1 -&gt; b) -&gt; a1 -&gt; c</code> here? I am very confused.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1472476424, "post_id": 39206888, "comment_id": 65753314, "body": "May I ask what book are you learning from?"}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1472476566, "post_id": 39207061, "comment_id": 65753410, "body": "The definition of <code>isVocal</code> also needs to be updated to return a string instead of a list of strings."}], "tags": [], "owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "is_accepted": false, "score": 1, "last_activity_date": 1472476656, "last_edit_date": 1472476656, "creation_date": 1472475859, "answer_id": 39207061, "question_id": 39206888, "link": "https://stackoverflow.com/questions/39206888/if-statement-with-elem-results-in-wrong-output/39207061#39207061", "title": "if-statement with elem results in wrong output", "body": "<p>You have 2 errors in your code. First, a String is already a list of characters so <code>vocals = \"aeiouy\"</code> is enough.</p>\n\n<p>Then you can test <code>elem x vocals</code>.</p>\n\n<p>Besides, your looping function <code>rovarsprak</code> is not tail recursive. <code>foldl</code> will make it so, by handling an accumulator in the signature (and it's also clearer that it's a loop) : </p>\n\n<pre><code>rovarsprakBis :: String -&gt; String\nrovarsprakBis = foldl (\\acc x -&gt; acc ++ isVocal x) \"\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 1, "last_activity_date": 1472477089, "creation_date": 1472477089, "answer_id": 39207449, "question_id": 39206888, "link": "https://stackoverflow.com/questions/39206888/if-statement-with-elem-results-in-wrong-output/39207449#39207449", "title": "if-statement with elem results in wrong output", "body": "<p><code>vocals</code> is intended to be a <code>String</code>, not a <code>[String]</code>:</p>\n\n<pre><code>vocals = \"aeiouy\" --List ['a','e','i','o','u','y'] with relevant vocals--\n</code></pre>\n\n<p><code>isVocal</code> would be a good name if it returned a <code>Bool</code>; you are actually returning a possibly different string, so something like <code>consonantToSyllable</code> would be better.</p>\n\n<p>Notice that it's simpler to just return the correct list of letters rather than building a bunch of short lists and concatenating them.</p>\n\n<pre><code>consonantToSyllable x = if elem x vocals then [x] else [x,'o',x]\n</code></pre>\n\n<p>or</p>\n\n<pre><code>consonantToSyllable x | elem x vocals = [x]\n                      | otherwise = [x,'o',x]\n\nrovarsprak [] = []\nrovarsprak (x:xs) = consonantToSyllable x ++ rovarsprak xs\n</code></pre>\n\n<p>The above recursion is the pattern captured by <code>concatMap</code>: map a function over a list, then concatenate the resulting lists into one list.</p>\n\n<pre><code>rovarsprak word = concatMap consonantToSyllable word\n</code></pre>\n\n<p>or just</p>\n\n<pre><code>rovarsprak = concatMap consonantToSyllable\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 5306262, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0801e8bccd35fed2ab84aa62012c6735?s=128&d=identicon&r=PG&f=1", "display_name": "Rawand", "link": "https://stackoverflow.com/users/5306262/rawand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 39207449, "answer_count": 2, "score": 0, "last_activity_date": 1472477089, "creation_date": 1472475333, "question_id": 39206888, "link": "https://stackoverflow.com/questions/39206888/if-statement-with-elem-results-in-wrong-output", "title": "if-statement with elem results in wrong output", "body": "<p>I have written a program whose purpose is to replace/extend every consonant characters in a given word with the constonant itself, an 'o' and the constonant following. If the character is a vocal, the program should ignore it and move on. </p>\n\n<p>For example, the string \"progp\" should result in \"poprorogogpop\".The only vocal in the string \"progp\" is the 'o' and it should therefore not be repeated. \nThis basically means that I want to construct a program which replaces a char with a String. </p>\n\n<p>This is what I have so far: </p>\n\n<pre><code>rovarsprak :: String -&gt; String    --Definition of our function which recieves an String as input and returns a String--\nisVocal :: Char -&gt; String       --Function which determines if a letter is a vocal or not--\n\nvocals = [\"aeiouy\"]; --List with relevant vocals--\n\nrovarsprak [] = [];  --Case for empty input--\nrovarsprak (x:xs) = isVocal(x) ++ rovarsprak(xs)\n\nisVocal x = if elem [x] vocals\n  then [x]\n  else [x] ++ \"o\" ++ [x]\n</code></pre>\n\n<p>If I compile and run this with the input parameter \"progp\" I recieve: </p>\n\n<p>\"poprorooogogpop\"</p>\n\n<p>Everything in the output is correct up until the 'o' character in the middle of the sentence in \"progp\" since the vocal 'o' should not be repeated in that way.</p>\n\n<p>My suspicion is that error lies within the elem-part of the if-statement or that it may be related with the recursion. </p>\n\n<p>A word of notice, I am extremly new to haskell programming and have searched for issues related with the elem-statement but to no success. </p>\n"}, {"tags": ["performance", "haskell", "ioref"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1472463927, "post_id": 39202738, "comment_id": 65745471, "body": "I doubt GHC can perform any relevant optimization on the IO refs. GCC does that on the equivalent <code>malloc</code> snippet, but that is far more idiomatic code in C than in Haskell. The <code>stg_</code> stuff is the GHC runtime, it should be implemented in C somewhere in the GHC sources. Not for the faint of heart."}], "answers": [{"comments": [{"owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "edited": false, "score": 0, "creation_date": 1472471718, "post_id": 39203908, "comment_id": 65750173, "body": "Thanks, this is clear. I am mostly interested in vector algorithms, so it is good to know that GHC only uses one IORef for the whole vector. For an unboxed vector of Ints, is reading or writing a cell more expensive than the same operation on an int[] in C ?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "edited": false, "score": 0, "creation_date": 1472472013, "post_id": 39203908, "comment_id": 65750389, "body": "@V.Semeria unboxed arrays (mutable or immutable) don&#39;t have any GC cost, since GC only needs to follow pointers to heap objects. Unboxed array operations have the same cost as in C."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "edited": false, "score": 0, "creation_date": 1472472545, "post_id": 39203908, "comment_id": 65750699, "body": "But note that unsafe operations on boxed arrays have too the same cost as in C, only with mutable boxed arrays do we pay extra GC cost (immutable arrays don&#39;t have the mentioned GC overhead)."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 11, "last_activity_date": 1472468629, "last_edit_date": 1495542769, "creation_date": 1472466201, "answer_id": 39203908, "question_id": 39202738, "link": "https://stackoverflow.com/questions/39202738/compilation-of-ioref-and-stref/39203908#39203908", "title": "Compilation of IORef and STRef", "body": "<p>Starting with a couple of links: </p>\n\n<ul>\n<li><a href=\"https://github.com/ghc/ghc/blob/cf989ffe490c146be4ed0fd7e0c00d3ff8fe1453/includes/rts/storage/Closures.h#L158\" rel=\"nofollow noreferrer\">The <code>MutVar</code> object definition.</a></li>\n<li><a href=\"https://github.com/ghc/ghc/blob/master/rts/PrimOps.cmm#L510\" rel=\"nofollow noreferrer\">The <code>cmm</code> code for <code>newMutVar</code>.</a></li>\n<li><a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Rts/Storage/HeapObjects\" rel=\"nofollow noreferrer\">A non-comprehensive but helpful summary of GHC object layout.</a> </li>\n</ul>\n\n<p>The <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Rts/Cmm\" rel=\"nofollow noreferrer\"><code>cmm</code></a> and <code>C</code> sources aren't particularly readable if you're not already familiar with the <a href=\"https://github.com/ghc/ghc/blob/master/includes/Cmm.h\" rel=\"nofollow noreferrer\">macros</a> and <a href=\"https://github.com/ghc/ghc/blob/master/rts/PrimOps.cmm\" rel=\"nofollow noreferrer\">primops</a>. Unfortunately, I don't know of a good way to view the assembly generated for <code>cmm</code> primops, short of looking into an executable with <a href=\"https://sourceware.org/binutils/docs/binutils/objdump.html\" rel=\"nofollow noreferrer\">objdump</a> or some other disassembler. </p>\n\n<p>Still, I can summarize the runtime semantics of <code>IORef</code>. </p>\n\n<p><a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.IORef.html#IORef\" rel=\"nofollow noreferrer\"><code>IORef</code></a> is a wrapper around <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/libraries/ghc-prim-0.5.0.0/GHC-Prim.html#g:13\" rel=\"nofollow noreferrer\"><code>MutVar#</code></a> from <code>GHC.Prim</code>. As the doc says, <code>MutVar#</code> is like a single-element mutable array. It takes up two machine words, the first is the header, the second is the stored value (which is a pointer to a GHC object). A value of <code>MutVar#</code> is itself a pointer to this two-word object. </p>\n\n<p><code>MutVar</code>-s differ from normal immutable objects most notably by participating in a write barrier mechanism. GHC has generational garbage collection, so any <code>MutVar</code> that lives in an older generation must be also a GC root when collecting the younger generations, since mutating a <code>MutVar</code> may cause younger objects to become reachable. Therefore, whenever a <code>MutVar</code> is promoted from generation 0 (the youngest), it is added to a so-called \"mutable list\" that contains references to all such mutable objects. The mutable list gets rebuilt during GC of old generations. In short, <code>MutVar</code>-s in old generations are always present on the mutable list.</p>\n\n<p>This is a rather simplistic way of dealing with mutable variables, and if we have large numbers of them in old generations, minor garbage collection slows down because of the bloated mutable list, and as a result the <a href=\"https://stackoverflow.com/questions/23462004/code-becomes-slower-as-more-boxed-arrays-are-allocated\">entire program slows down</a>.</p>\n\n<p>Since mutable variables aren't used prominently in production code, there hasn't been much demand or pressure for optimizing the RTS for their heavy usage.</p>\n\n<p>If you need a large number of mutable variables, you should instead use a single mutable boxed array, because that's only a single reference on the mutable list and also has a <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Rts/Storage/HeapObjects#Arrays\" rel=\"nofollow noreferrer\">bitmap-based optimization</a> for GC traversal of elements that might have been mutated.</p>\n\n<p>Also, as you see <code>newMutVar#</code> is only statically linked but not inlined, although it's a rather small chunk of code. As a result, it's also not optimized away. This is again broadly because of the lack of effort and attention for optimizing mutating code. By contrast, allocating and copying small known-sized primitive arrays is currently <a href=\"https://github.com/ghc/ghc/blob/master/includes/Cmm.h#L821\" rel=\"nofollow noreferrer\">inlined</a> and greatly optimized, because <a href=\"https://github.com/tibbe\" rel=\"nofollow noreferrer\">Johan Tibell</a> who did large amount of work implementing the <a href=\"https://github.com/tibbe/unordered-containers\" rel=\"nofollow noreferrer\"><code>unordered-containers</code></a> library made it so (in order to make <code>unordered-containers</code> faster). </p>\n"}], "owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 420, "favorite_count": 3, "accepted_answer_id": 39203908, "answer_count": 1, "score": 5, "last_activity_date": 1526819964, "creation_date": 1472462746, "last_edit_date": 1526819964, "question_id": 39202738, "link": "https://stackoverflow.com/questions/39202738/compilation-of-ioref-and-stref", "title": "Compilation of IORef and STRef", "body": "<p>To measure the performance of those Refs, I dumped the assembly produced by GHC on the following code :</p>\n\n<pre><code>import Data.IORef\n\nmain = do\n  r &lt;- newIORef 18\n  v &lt;- readIORef r\n  print v\n</code></pre>\n\n<p>I expected the IORef to be completely optimized away, leaving only a syscall to write stdout with string \"18\". Instead I get 250 lines of assembly. Do you know how many will actually be executed ? Here is what I think is the heart of the program :</p>\n\n<pre><code>.globl Main.main1_info\nMain.main1_info:\n_c1Zi:\n    leaq -8(%rbp),%rax\n    cmpq %r15,%rax\n    jb _c1Zj\n_c1Zk:\n    movq $block_c1Z9_info,-8(%rbp)\n    movl $Main.main2_closure+1,%ebx\n    addq $-8,%rbp\n    jmp stg_newMutVar#\n_c1Zn:\n    movq $24,904(%r13)\n    jmp stg_gc_unpt_r1\n.align 8\n    .long   S1Zo_srt-(block_c1Z9_info)+0\n    .long   0\n    .quad   0\n    .quad   30064771104\nblock_c1Z9_info:\n_c1Z9:\n    addq $24,%r12\n    cmpq 856(%r13),%r12\n    ja _c1Zn\n_c1Zm:\n    movq 8(%rbx),%rax\n    movq $sat_s1Z2_info,-16(%r12)\n    movq %rax,(%r12)\n    movl $GHC.Types.True_closure+2,%edi\n    leaq -16(%r12),%rsi\n    movl $GHC.IO.Handle.FD.stdout_closure,%r14d\n    addq $8,%rbp\n    jmp GHC.IO.Handle.Text.hPutStr2_info\n_c1Zj:\n    movl $Main.main1_closure,%ebx\n    jmp *-8(%r13)\n</code></pre>\n\n<p>I am concerned about this <code>jmp stg_newMutVar#</code>. It is nowhere else in the assembly, so maybe GHC resolves it at a later linking stage. But why is it even here and what does it do ? Can I dump the final assembly without any unresolved haskell symbols ?</p>\n"}, {"tags": ["haskell", "maybe", "alternative-functor"], "comments": [{"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1472461500, "post_id": 39202164, "comment_id": 65744006, "body": "FWIW: <code>&lt;?&gt;</code> in <code>parsec</code> gives a parser human readable name. It doesn&#39;t affect actual parsing in anyway."}, {"owner": {"reputation": 574, "user_id": 1504029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/96a8e68ffdcc9aca971108c6a989b74c?s=128&d=identicon&r=PG", "display_name": "Paul Visschers", "link": "https://stackoverflow.com/users/1504029/paul-visschers"}, "edited": false, "score": 0, "creation_date": 1472461576, "post_id": 39202164, "comment_id": 65744048, "body": "So really <code>(&lt;?&gt;) = flip fromMaybe</code>? Seems like the standard library provides what you want, just not quite in the form you&#39;d like it to be. Also of course this isn&#39;t part of <code>Applicative</code> or <code>Alternative</code>, because how would that work for other instances, like lists?"}, {"owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "reply_to_user": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1472462805, "post_id": 39202164, "comment_id": 65744753, "body": "@phadej You&#39;re right. In parsec <code>&lt;?&gt;</code> does not imply defaulting. So my analogy is weak."}, {"owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "edited": false, "score": 0, "creation_date": 1472629218, "post_id": 39202164, "comment_id": 65823358, "body": "<code>(?:) = flip fromMaybe</code> now found its way in my code everywhere. Clean and simple."}], "answers": [{"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 3, "last_activity_date": 1472461893, "creation_date": 1472461893, "answer_id": 39202464, "question_id": 39202164, "link": "https://stackoverflow.com/questions/39202164/in-haskell-is-there-an-abstraction-for-the-operator/39202464#39202464", "title": "In Haskell, is there an abstraction for the &lt;?&gt;-operator?", "body": "<p>The only two abstraction of \"emptyness\" I can think on top of my head are:</p>\n\n<p>First, <code>MonadError</code>: <code>Maybe</code> could have <code>instance MonadError () Maybe</code>. See however <a href=\"https://github.com/ekmett/mtl/issues/27\" rel=\"nofollow\">https://github.com/ekmett/mtl/issues/27</a></p>\n\n<p>Second, <code>lens</code> <a href=\"http://hackage.haskell.org/package/lens-4.14/docs/Control-Lens-Empty.html#v:_Empty\" rel=\"nofollow\"><code>_Empty</code></a>,\nwhich is by default comparison (<code>Eq</code>) with <code>mempty</code> (of <code>Monoid</code>). However <code>Monoid</code> and <code>Alternative</code> disagree for <code>Maybe</code>.</p>\n\n<p>Yet I don't recall any operator directly working on either one above.</p>\n"}, {"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 9, "last_activity_date": 1472462356, "creation_date": 1472462356, "answer_id": 39202605, "question_id": 39202164, "link": "https://stackoverflow.com/questions/39202164/in-haskell-is-there-an-abstraction-for-the-operator/39202605#39202605", "title": "In Haskell, is there an abstraction for the &lt;?&gt;-operator?", "body": "<p>I think it's a good idea to leave things at <code>(&lt;?&gt;) = flip fromMaybe</code>. </p>\n\n<p>If you'd like to generalize though, <code>Foldable</code> seems to be the simplest class with a notion of emptiness:</p>\n\n<pre><code>(&lt;?&gt;) :: Foldable t =&gt; t a -&gt; a -&gt; a\nta &lt;?&gt; a = foldr const a ta \n</code></pre>\n\n<p>This returns <code>a</code> if <code>ta</code> is empty or else the first element of <code>ta</code>. Examples:</p>\n\n<pre><code>Just 0 &lt;?&gt; 10 == 0\nNothing &lt;?&gt; 0 == 0\n[] &lt;?&gt; 10 == 10\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "edited": false, "score": 0, "creation_date": 1472473933, "post_id": 39205538, "comment_id": 65751617, "body": "Oh sure, <code>?:</code> would be a more sensible choice."}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": 4, "last_activity_date": 1472471101, "creation_date": 1472471101, "answer_id": 39205538, "question_id": 39202164, "link": "https://stackoverflow.com/questions/39202164/in-haskell-is-there-an-abstraction-for-the-operator/39205538#39205538", "title": "In Haskell, is there an abstraction for the &lt;?&gt;-operator?", "body": "<p>Actually, I don't like <code>&lt;?&gt;</code> operator name for what you are looking for.\nIf you search for <code>Maybe a -&gt; a -&gt; a</code> type on <a href=\"https://www.stackage.org/\" rel=\"nofollow\">Stackage</a> or <a href=\"http://hayoo.fh-wedel.de/\" rel=\"nofollow\">Hayoo</a> you can find <code>?:</code> operator from <code>errors</code> package.</p>\n\n<p>And this operator is so called <em>elvis</em>-operator. It is used in Groovy in that form. And <a href=\"https://kotlinlang.org/\" rel=\"nofollow\">Kotlin</a> also had it. This operator helps to deal with nulls in imperative language. But if you imagine that <code>Maybe a</code> is some kind of nullable type then <code>?:</code> operator makes sense for you as well. You can observe fact that there is some history behind <code>?:</code> operator.</p>\n\n<p>Also, <code>&lt;?&gt;</code> is already used in some packages like <a href=\"https://hackage.haskell.org/package/megaparsec\" rel=\"nofollow\">megaparsec</a>, <a href=\"https://hackage.haskell.org/package/attoparsec\" rel=\"nofollow\">attoparsec</a>, <a href=\"https://hackage.haskell.org/package/optparse-generic\" rel=\"nofollow\">optparse-generic</a> and others. And your project may use one of those with high probability. So you may experience some conflicts using your version of <em>elvis</em>-operator.</p>\n"}], "owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 1, "accepted_answer_id": 39202605, "answer_count": 3, "score": 6, "last_activity_date": 1614317955, "creation_date": 1472460893, "last_edit_date": 1614317955, "question_id": 39202164, "link": "https://stackoverflow.com/questions/39202164/in-haskell-is-there-an-abstraction-for-the-operator", "title": "In Haskell, is there an abstraction for the &lt;?&gt;-operator?", "body": "<p>I just found myself writing this code:</p>\n\n<pre><code>import Control.Applicative ((&lt;|&gt;))\n\nx = mA &lt;|&gt; mB &lt;?&gt; c\n\n(&lt;?&gt;) :: Maybe a -&gt; a -&gt; a\nJust x  &lt;?&gt; _ = x\nNothing &lt;?&gt; y = y\n</code></pre>\n\n<p>Where <code>mA :: Maybe a</code>, <code>mB :: Maybe a</code>, <code>c :: a</code>, and <code>x :: a</code>. Basically, the code says: pick the first alternative that is not <code>empty</code> and default to <code>c</code>. You can call it \"reverse Maybe monad\" where the analogy to <code>&lt;?&gt;</code> would be <code>pure</code>.</p>\n\n<p>Equivalently, I could have written</p>\n\n<pre><code>Just x = mA &lt;|&gt; mB &lt;|&gt; pure c,\n</code></pre>\n\n<p>but I feel uncomfortable with the irrefutable pattern. Or, of course,</p>\n\n<pre><code>x = fromMaybe c (mA &lt;|&gt; mB)\n</code></pre>\n\n<p>because <code>fromMaybe === flip &lt;?&gt;</code>.</p>\n\n<p>The <code>&lt;?&gt;</code> operator is inspired from parsec. I always get suspicious when I find myself defining utility functions like that, but I couldn't find this defaulting behavior anywhere.</p>\n\n<p>Apparently <code>Alternative</code> and <code>Applicative</code> are not powerful enough.</p>\n\n<p>Did I miss a type-class?</p>\n"}, {"tags": ["haskell", "type-families", "data-kinds"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1472463000, "post_id": 39202144, "comment_id": 65744920, "body": "I don&#39;t think this can be done in current Haskell. In a type family definition, we are not allowed to use value expressions (which have a type), only type expressions (which have a kind). Hence, I believe we currently have no way to refer to the value-level definition of <code>(+)</code>."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1472463012, "post_id": 39202144, "comment_id": 65744933, "body": "Are you familiar with <a href=\"https://github.com/bjornbm/dimensional\" rel=\"nofollow noreferrer\">Dimensional</a>?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 4, "creation_date": 1472467543, "post_id": 39202144, "comment_id": 65747704, "body": "&quot;there is no good reason why I can&#39;t just directly use all the existing functions&quot; - the reason is that Haskell is not a dependently-typed language. There&#39;s a separation between values and types, which means that you have to duplicate code between the two levels and use tedious hacks like singleton values. <a href=\"http://cs.brynmawr.edu/~rae/papers/2016/thesis/eisenberg-thesis-draft.pdf\" rel=\"nofollow noreferrer\">The Haskell designers are hard at work on lifting that restriction</a>; in the mean time, you could consider using a real dependently-typed language like Agda or Idris."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1472488061, "post_id": 39202144, "comment_id": 65760597, "body": "It seems like you are really just looking for dependant types (which as @BenjaminHodgson stated, Haskell does not yet have). &quot;Also is there an easy way to obtain a runtime value back from a type?&quot; In a dependantly typed language, both &#39;type&#39; and &#39;values&#39; are simply terms, i.e. there is no distinction. But the tradeoff for more expressiveness is more proof obligation - you will have to convince the compiler of many things you simply consider axiomatic."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1472489833, "post_id": 39202144, "comment_id": 65761586, "body": "@chi But the following works: <code>type family Foo a where { Foo False = Nothing; Foo True = Just () }</code>. So we can clearly use a subset of value expressions, I am just wondering why we can only use certain value expressions."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1472489926, "post_id": 39202144, "comment_id": 65761629, "body": "@BenjaminHodgson But I really want to keep all the things I love about Haskell, plus this was mostly a learning exercise to improve my knowledge of GHC extensions."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1472490682, "post_id": 39202144, "comment_id": 65761998, "body": "@user2407038 I don&#39;t see why you would need more proof obligation, maybe for certain aspects of dependent types but I really cannot tell why you would need to prove anything more for doing what my original question asked, all I am asking to do here is remove boilerplate."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1472491283, "post_id": 39202144, "comment_id": 65762301, "body": "@semicolon That is because we can lift value constructors to the type level via <code>DataKinds</code>. We do not have (yet) a way to lift other value expressions, though. I.e. if we let <code>n = Nothing</code> we can&#39;t use <code>Foo False = n</code> later on. We need <code>type N = Nothing</code> instead. Many things can be lifted manually at the type level, but the automagic lifting is far from being universal (albeit it is still very useful, and quite amazing!)."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1472492100, "post_id": 39202144, "comment_id": 65762711, "body": "@BenjaminHodgson Full fledged dependent types don&#39;t seem to be needed here.  This functionality is implementable in C++ which is hardly a dependently typed language."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1472518572, "post_id": 39202144, "comment_id": 65772972, "body": "@n.m. What do you mean by that specifically? Because the program itself I got working just fine, I just wanted things to be more concise. In C++ can you really do unrestricted compile time data manipulation within phantom types? I would be pretty surprised if that were true."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1472529622, "post_id": 39202144, "comment_id": 65775222, "body": "@semicolon not unrestricted, but compile time integer arithmetic is built in"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1472694815, "post_id": 39260301, "comment_id": 65858918, "body": "It&#39;s likely to happen soonish, I&#39;d say. Maybe 8.4 or 8.6, unless they decide it justifies a major-major version bump and call whatever release it is 9.0."}], "tags": [], "owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "is_accepted": true, "score": 0, "last_activity_date": 1472684411, "creation_date": 1472684411, "answer_id": 39260301, "question_id": 39202144, "link": "https://stackoverflow.com/questions/39202144/how-to-use-integer-literals-and-arithmetic-within-haskell-data-kinds/39260301#39260301", "title": "How to use integer literals and arithmetic within Haskell data kinds", "body": "<p>It looks like the answer to this question is simply that you cannot currently do either of those things automatically. Hopefully it won't take too long before this kind of thing becomes possible.</p>\n"}], "owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 177, "favorite_count": 1, "accepted_answer_id": 39260301, "answer_count": 1, "score": 2, "last_activity_date": 1472684411, "creation_date": 1472460833, "question_id": 39202144, "link": "https://stackoverflow.com/questions/39202144/how-to-use-integer-literals-and-arithmetic-within-haskell-data-kinds", "title": "How to use integer literals and arithmetic within Haskell data kinds", "body": "<p>I have recently started messing around with <code>DataKinds</code> in order to have compile-time scientific units for arithmetic. I have more or less figured out a way to do what I want but I feel like it could be a lot cleaner.</p>\n\n<p>I needed integers that could potentially be negative (m^-1) so I decided to use integers rather than naturals. But as it turns out when you do <code>:k 5</code> it gives you <code>GHC.Types.Nat</code> which does not fit my needs. I ended up instead making my own custom algebraic integer type. As well as defining addition and subtraction type families to use with it.</p>\n\n<p>But this all seems very indirect, it seems like there is no good reason why I can't just directly use all the existing functions for manipulating data at compile time within type families.</p>\n\n<p>Basically I want the following to essentially be generated automatically:</p>\n\n<pre><code>type family (a :: Int) + (b :: Int) :: Int where\n    -- Should be automatically derivable from (+) applied to Int\n</code></pre>\n\n<p>Is that possible, if not then why not?</p>\n\n<p>Also is there an easy way to obtain a runtime value back from a type? Specifically when writing a <code>Show</code> instance for all these types I basically just want to pull in the phantom type representing the unit combination and convert it to a string. All the ways I can think of doing that right now seem really verbose.</p>\n"}, {"tags": ["haskell", "io", "gtk2hs"], "answers": [{"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 3, "last_activity_date": 1506553748, "last_edit_date": 1506553748, "creation_date": 1472457452, "answer_id": 39201207, "question_id": 39200545, "link": "https://stackoverflow.com/questions/39200545/convert-a-entrygettext-into-int-gtk2hs/39201207#39201207", "title": "Convert a entryGetText into Int gtk2hs", "body": "<p>This is because you wrote</p>\n\n<pre><code>putStrLn unsafePerformIO (entryGetText txtMagn)\n</code></pre>\n\n<p>Here you pass <code>unsafePerformIO</code> to <code>putStrLn</code> as a parameter. You actually meant:</p>\n\n<pre><code>putStrLn (unsafePerformIO (entryGetText txtMagn))\n</code></pre>\n\n<p>Now to the <code>unsafePerformIO</code>. As its name suggests, it is <strong>unsafe</strong>, so you'd better have a clear idea what are you trying to accomplish. To safely pull out your value out of the <code>IO</code> and use it later:</p>\n\n<pre><code>text &lt;- entryGetText txtMagn\nputStrLn text\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 151, "user_id": 5872882, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fc8fcfe6e5954b67ec74d3408e807c45?s=128&d=identicon&r=PG&f=1", "display_name": "Max K", "link": "https://stackoverflow.com/users/5872882/max-k"}, "is_accepted": false, "score": 0, "last_activity_date": 1472671019, "creation_date": 1472671019, "answer_id": 39257399, "question_id": 39200545, "link": "https://stackoverflow.com/questions/39200545/convert-a-entrygettext-into-int-gtk2hs/39257399#39257399", "title": "Convert a entryGetText into Int gtk2hs", "body": "<p>To get the value, you have to use the read function:</p>\n\n<pre><code>val &lt;- getLine\nsomeFunctionWhichNeedsTheValue (read val ::Float) \n</code></pre>\n"}], "owner": {"reputation": 151, "user_id": 5872882, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fc8fcfe6e5954b67ec74d3408e807c45?s=128&d=identicon&r=PG&f=1", "display_name": "Max K", "link": "https://stackoverflow.com/users/5872882/max-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 39201207, "answer_count": 2, "score": 1, "last_activity_date": 1506553748, "creation_date": 1472455184, "question_id": 39200545, "link": "https://stackoverflow.com/questions/39200545/convert-a-entrygettext-into-int-gtk2hs", "title": "Convert a entryGetText into Int gtk2hs", "body": "<p>I'm trying to convert a entryText into a string, so I can use it for other functions. </p>\n\n<pre><code>`unsafePerformIO (entryGetText txtMagn)`\n</code></pre>\n\n<p>While trying to compile this code, I get the error message: </p>\n\n<pre><code>`Couldn't match type \u2018IO a0 -&gt; a0\u2019 with \u2018[Char]\u2019\n    Expected type: String\n      Actual type: IO a0 -&gt; a0\n    Probable cause: \u2018unsafePerformIO\u2019 is applied to too few arguments\n    In the first argument of \u2018putStrLn\u2019, namely \u2018unsafePerformIO\u2019`\n</code></pre>\n\n<p>Thanks in advance </p>\n"}, {"tags": ["haskell", "strictness", "equational-reasoning"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1472443021, "post_id": 39197358, "comment_id": 65736794, "body": "Where did you get this question?"}, {"owner": {"reputation": 29, "user_id": 6768254, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de631c46e2f2f1e2819ae3d9c4abb900?s=128&d=identicon&r=PG&f=1", "display_name": "beja", "link": "https://stackoverflow.com/users/6768254/beja"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1472470437, "post_id": 39197358, "comment_id": 65749386, "body": "I&#39;m preparing for an exam and this is question that was on the previous one"}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 4, "last_activity_date": 1472435133, "creation_date": 1472435133, "answer_id": 39197465, "question_id": 39197358, "link": "https://stackoverflow.com/questions/39197358/mapping-a-strict-vs-a-lazy-function/39197465#39197465", "title": "Mapping a strict vs. a lazy function", "body": "<p>Let's take the non-strict function <code>f = const ()</code>, and <code>xs = undefined</code>. In this case, we have</p>\n\n<pre><code>map f undefined = undefined\n</code></pre>\n\n<p>but</p>\n\n<pre><code>f undefined = ()\n</code></pre>\n\n<p>and so</p>\n\n<pre><code>(head . map f) undefined = head (map f undefined) = head undefined = undefined\n</code></pre>\n\n<p>but</p>\n\n<pre><code>(f . head) undefined = f (head undefined) = f undefined = ()\n</code></pre>\n\n<p>Q.E.D.</p>\n"}], "owner": {"reputation": 29, "user_id": 6768254, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de631c46e2f2f1e2819ae3d9c4abb900?s=128&d=identicon&r=PG&f=1", "display_name": "beja", "link": "https://stackoverflow.com/users/6768254/beja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 249, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1472435168, "creation_date": 1472433969, "last_edit_date": 1472435168, "question_id": 39197358, "link": "https://stackoverflow.com/questions/39197358/mapping-a-strict-vs-a-lazy-function", "title": "Mapping a strict vs. a lazy function", "body": "<pre><code>(head . map f) xs = (f . head) xs\n</code></pre>\n\n<p>It works for every xs list when f is strict. \nCan anyone give me example, why with non-strict f it doesnt work?</p>\n"}, {"tags": ["haskell", "ghc", "ghci"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 2, "creation_date": 1472428361, "post_id": 39196814, "comment_id": 65734047, "body": "There shouldn&#39;t be any difference between Interpreted code and compiled code. What examples are you running into that don&#39;t work in ghci?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 5, "creation_date": 1472429836, "post_id": 39196814, "comment_id": 65734300, "body": "The ghci repl works differently in a number of subtle (e.g. defaulting rules) and not-so-subtle ways, and for various reasons is not very nice to interactively build a program in in my experience (multi-line definitions are clumsy to write, difficult to edit when you realize you forgot to add a <code>let</code>, etc.). IMHO you will have a better experience working on a <code>.hs</code> file and loading/reloading/playing with it in ghci"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1472430780, "post_id": 39196814, "comment_id": 65734478, "body": "The interpreter only requires a different syntax for code actually typed into the REPL - if you write a Haskell source file and load it into GHCi, the syntax is identical. The code you enter into GHCi is essentially scoped as if it were in one big <code>do</code> block, except top level declarations are allowed (excluding top level function declarations)."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 3, "creation_date": 1472474975, "post_id": 39196814, "comment_id": 65752311, "body": "In case you&#39;re not aware of it: typing <code>:e</code> in ghci will open your editor of choice and the module will be reloaded once you leave the editor. It makes it a lot easier to write multi-line definitions for instance."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1473030277, "post_id": 39196814, "comment_id": 65976398, "body": "The best way to build Haskell programs interactively is using an editor like emacs that offers good Haskell support. This will give you the source in one pane and GHCi in another, along with all sorts of other assistance."}], "answers": [{"tags": [], "owner": {"reputation": 1200, "user_id": 2501758, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85bc622278325facbdf1e8b7cb1e7250?s=128&d=identicon&r=PG", "display_name": "Tuomas Laakkonen", "link": "https://stackoverflow.com/users/2501758/tuomas-laakkonen"}, "is_accepted": false, "score": 0, "last_activity_date": 1473026529, "last_edit_date": 1592644375, "creation_date": 1473026529, "answer_id": 39321873, "question_id": 39196814, "link": "https://stackoverflow.com/questions/39196814/use-haskell-through-ghci-alone/39321873#39321873", "title": "Use Haskell through GHCI alone?", "body": "<h2>TL; DR</h2>\n<p>In order to use GHCi, all definitions (<code>... = ...</code>) must be prefixed by <code>let</code> - e.g <code>let ... = ...</code>.</p>\n<hr />\n<p>GHCi does have a subtly different syntax to regular Haskell. This is to accommodate the use of IO in the REPL.</p>\n<p>For the most part, the syntax of GHCi is the same as the syntax for a <code>do</code> block in the IO monad:\nDefinitions can be made via <code>let</code> syntax:</p>\n<pre><code>let f x = 10\n</code></pre>\n<p>and IO actions can be sequenced:</p>\n<pre><code>print 1\n</code></pre>\n<p>When this is submitted to GHCi, it will be immediately performed - i.e <code>let</code> definitions are bound and IO actions are performed.</p>\n<p>However, the subtle differences come from GHCi's other function: evaluation expressions. If you type in an expression that is not an IO action, for instance:</p>\n<pre><code>1 + 3\n</code></pre>\n<p>GHCi will attempt to print the result of the expression. i.e, it will execute:</p>\n<pre><code>print $ 1 + 3\n</code></pre>\n"}], "owner": {"reputation": 1162, "user_id": 2530155, "user_type": "registered", "accept_rate": 21, "profile_image": "https://i.stack.imgur.com/hiao7.png?s=128&g=1", "display_name": "Lindon", "link": "https://stackoverflow.com/users/2530155/lindon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 100, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1475881360, "creation_date": 1472427918, "last_edit_date": 1475881360, "question_id": 39196814, "link": "https://stackoverflow.com/questions/39196814/use-haskell-through-ghci-alone", "title": "Use Haskell through GHCI alone?", "body": "<p>I'm totally new to Haskell, so this is a soft question, but it seems that most tutorials for Haskell define a main function, compile it, and then execute the program as a whole from the command line.</p>\n\n<p>I'm coming from more of an R/Julia/Python background where I feel most comfortable working within a REPL or sending lines to the REPL from an editor. </p>\n\n<p>I'm wondering if it is possible to be a Haskell programmer using GHCI alone? I am having difficult following most of the tutorials on Haskell within the interpreter for some reason. Is code written to be executed within the interpreter different from code that is compiled i.e. does the interpreter require special syntax?</p>\n"}, {"tags": ["haskell", "metaprogramming", "typeclass"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1472425792, "post_id": 39196292, "comment_id": 65733681, "body": "All you&#39;ve done is lift this to the type level. The problem is that unless you also encode some information in your data types at the type level, this is useless (since you can&#39;t reliably lift values to the type level yet)."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1472426068, "post_id": 39196292, "comment_id": 65733728, "body": "To be clearer, the way to use your <code>HasString</code> requires you to have a lifted version of <code>A</code>, <code>B</code>, <code>C</code> and <code>D</code>, but there is currently now way to go from value -&gt; type in general."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1472427502, "post_id": 39196292, "comment_id": 65733928, "body": "<a href=\"http://stackoverflow.com/questions/39002342/adding-an-ord-instance-to-singleton-package-generated-naturals/39003151#39003151\">Don&#39;t</a> <a href=\"http://stackoverflow.com/questions/33270639/so-whats-the-point\">use</a> <a href=\"http://stackoverflow.com/questions/37923470/is-there-any-connection-between-a-b-and-a-b-true/37925725#37925725\">type</a>-<a href=\"http://stackoverflow.com/questions/38290067/idiomatic-boolean-equality-usage-singletons/38293546#38293546\">level</a> <a href=\"http://stackoverflow.com/questions/38209817/checking-if-one-type-level-list-contains-another/38221146#38221146\">Boolean</a> predicates! How many times!"}], "owner": {"reputation": 1525, "user_id": 546591, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/33RTK.jpg?s=128&g=1", "display_name": "James Koppel", "link": "https://stackoverflow.com/users/546591/james-koppel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 87, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1472442698, "creation_date": 1472422568, "last_edit_date": 1472442698, "question_id": 39196292, "link": "https://stackoverflow.com/questions/39196292/constraining-on-the-transitive-children-of-an-adt", "title": "Constraining on the transitive children of an ADT", "body": "<p>I'd like to be able to define trees using mutually inductive datatypes, and then write a generic function which can only run on certain parts of the tree, depending on what a node's descendants can be. So, for instance, if I had datatypes</p>\n\n<pre><code>data A = A1 B | A2 C D\nnewtype B = B String\nnewtype C = C String\nnewtype D = D Int\n</code></pre>\n\n<p>I want to be able to define a <code>HasString</code> predicate and a function <code>getString</code> like this:</p>\n\n<pre><code>getString :: (HasString x) =&gt; x -&gt; String\n</code></pre>\n\n<p>such that <code>HasString</code> is satisfied for <code>A1</code>, <code>B</code>, and <code>C</code>, but not for <code>D</code>.</p>\n\n<p>The standard way to do this sort of thing is just with a manual traversal:</p>\n\n<pre><code>class GetString t where\n  getString :: t -&gt; String\n\ninstance GetString B where\n    getString (B s) = s\n\n-- .... instances for A, C\n</code></pre>\n\n<p>In writing this out, we've basically created a proof that every <code>A</code> transitively contains a <code>String</code>.</p>\n\n<p>Now, I want to do this using generic machinery, so I can get it to run on datatypes other than <code>A</code>. And I care about things other than <code>getString</code> too.</p>\n\n<p>Currently, I can construct a type-level predicate that indicates whether a datatype transitively contains a <code>String</code>. I can even build it using generic proof machinery:</p>\n\n<pre><code>type family Or a b where\n  Or True a = True\n  Or a True = True\n  Or a b    = False\n\ntype family And a b where\n  And True True = True\n  And a    b    = False\n\ntype family BaseHasString f where\n  BaseHasString B = True\n  BaseHasString C = True\n  BaseHasString x = False\n\ntype family Has f t where\n  Has f A  = Or (f A) (And (Has f B) (Or (Has f C) (Has f D)))\n  Has f x  = f x\n\ntype HasString t :: Constraint = (Has BaseHasString t ~ True)\n</code></pre>\n\n<p>(I should also be able to generalize this further using GHC Generics.)</p>\n\n<p>However, now that I have my <code>HasString</code> predicate, I can't figure out how to actually use it.</p>\n\n<p>So, how can I write my <code>getString</code> function?</p>\n"}, {"tags": ["haskell", "types", "functional-programming", "monads", "template-haskell"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1472422693, "post_id": 39196286, "comment_id": 65733069, "body": "What is the compiler error you are getting?"}, {"owner": {"reputation": 13, "user_id": 6767495, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb32e1900c87dc5225894d22b78562da?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/6767495/john"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1472422828, "post_id": 39196286, "comment_id": 65733096, "body": "I&#39;ll add the full error messages above right now."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1472424084, "post_id": 39196286, "comment_id": 65733351, "body": "&quot;<i>I would like the type variable m to be inferred</i>&quot; - that&#39;s not how it works. Types are inferred a) if they are not given b) to check the given ones for correctness. The compiler error tells you that the type is (non-variable) <code>State s0</code>, but you have given it the variable <code>m</code>."}, {"owner": {"reputation": 13, "user_id": 6767495, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb32e1900c87dc5225894d22b78562da?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/6767495/john"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1472424244, "post_id": 39196286, "comment_id": 65733388, "body": "Yes, but <code>m</code> is a type variable, not a type. That&#39;s why I included the info and examples at the beginning. I appreciate you taking the time to comment/answer, but to be honest, I don&#39;t fully understand what you mean."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1472424636, "post_id": 39196286, "comment_id": 65733473, "body": "A variable representing a type, yeah. And that&#39;s the problem: the type is not variable. It&#39;s inferred to be <code>State s0</code>, not an arbitrary monad. Change the signature to the actual type <code>result_sm :: a -&gt; StateM (State s0) s1 a</code> (possibly the same <code>s</code>) and it will work."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1472424767, "post_id": 39196286, "comment_id": 65733500, "body": "\u2026or fix the implementation to match the generic type, like in Alec&#39;s answer below"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1472425313, "post_id": 39196286, "comment_id": 65733598, "body": "Wasn&#39;t this (or some very closely related question) posted a few days ago? I believe I answered it, but I can&#39;t find it now. I guess it was deleted and reposted. If so, just know that is quite frowned upon."}, {"owner": {"reputation": 13, "user_id": 6767495, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb32e1900c87dc5225894d22b78562da?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/6767495/john"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1472425777, "post_id": 39196286, "comment_id": 65733676, "body": "@chi. Indeed it was, I have reposted the question with additional detail and finally got a good answer, thanks to Bergi and Alec. The other post was nuked nuked into oblivion."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 4, "last_activity_date": 1472424658, "creation_date": 1472424658, "answer_id": 39196498, "question_id": 39196286, "link": "https://stackoverflow.com/questions/39196286/having-difficulty-understanding-type-inference-in-haskell/39196498#39196498", "title": "Having difficulty understanding type inference in Haskell", "body": "<p>The compiler did its job. Your code doesn't make sense.</p>\n\n<ol>\n<li><p>In <code>result_sm</code>, you are trying to construct a <code>StateM m s a</code> with a <code>State s a</code>, which is a type mismatch. What you probably meant to do was </p>\n\n<pre><code>result_sm :: (Monad m) =&gt; a -&gt; StateM m s a\nresult_sm v = StateM (\\s -&gt; return (v, s)) \n</code></pre></li>\n<li><p>Since <code>bind_sm</code> has the constraint <code>Monad m</code> on it, you need to carry that constraint wherever you use <code>bind_sm</code>, including in the <code>Functor</code>, <code>Applicative</code>, and <code>Monad</code> instances of <code>bind_sm</code>. Therefore, these should read</p>\n\n<pre><code>instance Monad m =&gt; Functor (StateM m s) where ..\ninstance Monad m =&gt; Applicative (StateM m s) where ..\ninstance Monad m =&gt; Monad (StateM m s) where ..\n</code></pre></li>\n</ol>\n"}], "owner": {"reputation": 13, "user_id": 6767495, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb32e1900c87dc5225894d22b78562da?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/6767495/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "accepted_answer_id": 39196498, "answer_count": 1, "score": 0, "last_activity_date": 1472424658, "creation_date": 1472422504, "last_edit_date": 1472423375, "question_id": 39196286, "link": "https://stackoverflow.com/questions/39196286/having-difficulty-understanding-type-inference-in-haskell", "title": "Having difficulty understanding type inference in Haskell", "body": "<p>In Haskell, we know that if we have some function <code>f</code> with the type signature <code>f :: a -&gt; a</code>, then Haskell can infer the following types:</p>\n\n<p><code>f \"alpha\"</code> will have type <code>[Char]</code>;</p>\n\n<p><code>f 1234</code> will have type <code>Num a =&gt; a</code></p>\n\n<p><code>f Just</code> will have type <code>a -&gt; Maybe a</code></p>\n\n<p>and so on.</p>\n\n<p>With reference to the following code, </p>\n\n<p>in the function <code>result_sm :: (Monad m) =&gt; a -&gt; State m s a</code>, I would like the type variable <code>m</code> to be inferred to <code>State s</code>. <code>State s</code> is an instance of the <code>Monad</code> typeclass, so why isn't it working?</p>\n\n<p>Also, regarding the instance declaration for <code>Functor (StateM m s)</code>, I know that the compiler cannot deduce <code>Monad m</code> from the context <code>Functor m</code> bound by the ghc-inbuilt (natural/un-overridden) type signature for <code>fmap</code>.</p>\n\n<p>Similarly, regarding the instance declaration for <code>Applicative (StateM m s)</code>, I know that the compiler also cannot deduce <code>Monad m</code> from the context <code>(Functor (StateM m s), Applicative m)</code> bound by the ghc-inbuilt (natural/un-overridden) type signatures for <code>pure</code> and <code>&lt;*&gt;</code>.</p>\n\n<p>So my second question is as follows: how can I get the compiler to accept <code>m</code> as an instance of <code>Monad</code> typeclass in the above two instance declarations, and any similar instance declarations?</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE InstanceSigs #-}\n\nmodule StateParser where\n\nimport Control.Monad\nimport Control.Applicative\n\nnewtype State s a = State {compute :: s -&gt; (a, s)}\n\nnewtype StateM m s a = StateM {compute_M :: s -&gt; m (a, s)}\n\nresult_s :: a -&gt; State s a\nresult_s v = State (\\s -&gt; (v ,s))\n\nbind_s :: State s a -&gt; (a -&gt; State s b) -&gt; State s b\nbind_s st f = State $ \\s -&gt; (\\(v, s') -&gt; compute (f v) s') (compute st s)\n\nresult_sm :: (Monad m) =&gt; a -&gt; StateM m s a\nresult_sm v = StateM (\\s -&gt; result_s (v, s))\n\nbind_sm :: (Monad m) =&gt; StateM m s a -&gt; (a -&gt; StateM m s b) -&gt; StateM m s b\nbind_sm stm f = StateM $ \\s -&gt; (tmp s &gt;&gt;= id)\n  where\n    tmp s = fmap (\\(v, s') -&gt; compute_M (f v) s') (compute_M stm s)\n\ninstance Functor (State s) where\n  fmap f st = st &gt;&gt;= (pure . f)\n\ninstance Applicative (State s) where\n  pure = result_s\n  p &lt;*&gt; q = p &gt;&gt;= \\f -&gt;\n            q &gt;&gt;= (pure . f)\n\ninstance Monad (State s) where\n  --Explicit return definition only required for code required to be compatible\n  --with GHC versions prior to 7.10. The default implementation for all GHC\n  --versions from 7.10 is\n  return = pure\n  (&gt;&gt;=)  = bind_s\n\ninstance Functor m =&gt; Functor (StateM m s) where\n  fmap :: (Monad m) =&gt; (a -&gt; b) -&gt; StateM m s a -&gt; StateM m s b\n  fmap f stm = stm `bind_sm` (result_sm . f)\n\ninstance Applicative m =&gt; Applicative (StateM m s) where\n  pure :: (Monad m) =&gt; a -&gt; StateM m s a\n  pure = result_sm\n\n  (&lt;*&gt;) :: (Monad m) =&gt; StateM m s (a -&gt; b) -&gt; StateM m s a -&gt; StateM m s b\n  p &lt;*&gt; q = p `bind_sm` \\f -&gt;\n            q `bind_sm` (pure . f)\n\ninstance Monad m =&gt; Monad (StateM m s) where\n  return = pure\n  (&gt;&gt;=)  = bind_sm\n</code></pre>\n\n<p>And here are the full compiler error messages. Someone (username: Bergi) wanted to see them.</p>\n\n<pre><code>StateParser.hs:29:29:\n    Couldn't match type `m' with `State s0'\n      `m' is a rigid type variable bound by\n          the type signature for result_sm :: Monad m =&gt; a -&gt; StateM m s a\n          at StateParser.hs:28:14\n    Expected type: m (a, s)\n      Actual type: State s0 (a, s)\n    Relevant bindings include\n      result_sm :: a -&gt; StateM m s a (bound at StateParser.hs:29:1)\n    In the expression: result_s (v, s)\n    In the first argument of `StateM', namely\n      `(\\ s -&gt; result_s (v, s))'\n\nStateParser.hs:52:11:\n    Could not deduce (Monad m)\n    from the context (Functor m)\n      bound by the type signature for\n                 fmap :: Functor m =&gt; (a -&gt; b) -&gt; StateM m s a -&gt; StateM m s b\n      at StateParser.hs:52:11-63\n    Possible fix:\n      add (Monad m) to the context of\n        the type signature for\n          fmap :: Functor m =&gt; (a -&gt; b) -&gt; StateM m s a -&gt; StateM m s b\n    When checking that:\n        forall (m :: * -&gt; *) s.\n        Functor m =&gt;\n        forall a b. Monad m =&gt; (a -&gt; b) -&gt; StateM m s a -&gt; StateM m s b\n      is more polymorphic than:\n        forall (m :: * -&gt; *) s.\n        Functor m =&gt;\n        forall a b. (a -&gt; b) -&gt; StateM m s a -&gt; StateM m s b\n    When checking that instance signature for `fmap'\n      is more general than its signature in the class\n      Instance sig: forall (m :: * -&gt; *) s.\n                    Functor m =&gt;\n                    forall a b. Monad m =&gt; (a -&gt; b) -&gt; StateM m s a -&gt; StateM m s b\n         Class sig: forall (m :: * -&gt; *) s.\n                    Functor m =&gt;\n                    forall a b. (a -&gt; b) -&gt; StateM m s a -&gt; StateM m s b\n    In the instance declaration for `Functor (StateM m s)'\n\nStateParser.hs:56:11:\n    Could not deduce (Monad m)\n    from the context (Functor (StateM m s), Applicative m)\n      bound by the type signature for\n                 pure :: (Functor (StateM m s), Applicative m) =&gt; a -&gt; StateM m s a\n      at StateParser.hs:56:11-40\n    Possible fix:\n      add (Monad m) to the context of\n        the type signature for\n          pure :: (Functor (StateM m s), Applicative m) =&gt; a -&gt; StateM m s a\n    When checking that:\n        forall (m :: * -&gt; *) s.\n        (Functor (StateM m s), Applicative m) =&gt;\n        forall a. Monad m =&gt; a -&gt; StateM m s a\n      is more polymorphic than:\n        forall (m :: * -&gt; *) s.\n        (Functor (StateM m s), Applicative m) =&gt;\n        forall a. a -&gt; StateM m s a\n    When checking that instance signature for `pure'\n      is more general than its signature in the class\n      Instance sig: forall (m :: * -&gt; *) s.\n                    (Functor (StateM m s), Applicative m) =&gt;\n                    forall a. Monad m =&gt; a -&gt; StateM m s a\n         Class sig: forall (m :: * -&gt; *) s.\n                    (Functor (StateM m s), Applicative m) =&gt;\n                    forall a. a -&gt; StateM m s a\n    In the instance declaration for `Applicative (StateM m s)'\n\nStateParser.hs:59:12:\n    Could not deduce (Monad m)\n    from the context (Functor (StateM m s), Applicative m)\n      bound by the type signature for\n                 (&lt;*&gt;) :: (Functor (StateM m s), Applicative m) =&gt;\n                          StateM m s (a -&gt; b) -&gt; StateM m s a -&gt; StateM m s b\n      at StateParser.hs:59:12-75\n    Possible fix:\n      add (Monad m) to the context of\n        the type signature for\n          (&lt;*&gt;) :: (Functor (StateM m s), Applicative m) =&gt;\n                   StateM m s (a -&gt; b) -&gt; StateM m s a -&gt; StateM m s b\n    When checking that:\n        forall (m :: * -&gt; *) s.\n        (Functor (StateM m s), Applicative m) =&gt;\n        forall a b.\n        Monad m =&gt;\n        StateM m s (a -&gt; b) -&gt; StateM m s a -&gt; StateM m s b\n      is more polymorphic than:\n        forall (m :: * -&gt; *) s.\n        (Functor (StateM m s), Applicative m) =&gt;\n        forall a b. StateM m s (a -&gt; b) -&gt; StateM m s a -&gt; StateM m s b\n    When checking that instance signature for `&lt;*&gt;'\n      is more general than its signature in the class\n      Instance sig: forall (m :: * -&gt; *) s.\n                    (Functor (StateM m s), Applicative m) =&gt;\n                    forall a b.\n                    Monad m =&gt;\n                    StateM m s (a -&gt; b) -&gt; StateM m s a -&gt; StateM m s b\n         Class sig: forall (m :: * -&gt; *) s.\n                    (Functor (StateM m s), Applicative m) =&gt;\n                    forall a b. StateM m s (a -&gt; b) -&gt; StateM m s a -&gt; StateM m s b\n    In the instance declaration for `Applicative (StateM m s)'\n</code></pre>\n"}, {"tags": ["haskell", "state", "monads", "writer", "reader"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1472419718, "post_id": 39195846, "comment_id": 65732358, "body": "Are you using RWS from the transformers package or from mtl?"}, {"owner": {"reputation": 796, "user_id": 672098, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/df506e61c4f7bb05009fcb7f22ee81e2?s=128&d=identicon&r=PG", "display_name": "Arek&#39; Fu", "link": "https://stackoverflow.com/users/672098/arek-fu"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1472445616, "post_id": 39195846, "comment_id": 65737319, "body": "I am using <code>mtl</code>. I was actually not aware of <code>transformers</code>."}], "answers": [{"comments": [{"owner": {"reputation": 796, "user_id": 672098, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/df506e61c4f7bb05009fcb7f22ee81e2?s=128&d=identicon&r=PG", "display_name": "Arek&#39; Fu", "link": "https://stackoverflow.com/users/672098/arek-fu"}, "edited": false, "score": 0, "creation_date": 1472445690, "post_id": 39195973, "comment_id": 65737328, "body": "Excellent answer, thank you. The link at the end is very relevant."}, {"owner": {"reputation": 2571, "user_id": 1264675, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/7cdce6fa69152f105c232420c8e62925?s=128&d=identicon&r=PG", "display_name": "Undreren", "link": "https://stackoverflow.com/users/1264675/undreren"}, "edited": false, "score": 0, "creation_date": 1472450172, "post_id": 39195973, "comment_id": 65738676, "body": "That last link was super interesting. I was under the (perhaps naive) impression that Monad stacks only made code <i>easier</i> to reuse across different applications."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 2571, "user_id": 1264675, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/7cdce6fa69152f105c232420c8e62925?s=128&d=identicon&r=PG", "display_name": "Undreren", "link": "https://stackoverflow.com/users/1264675/undreren"}, "edited": false, "score": 1, "creation_date": 1472451038, "post_id": 39195973, "comment_id": 65738969, "body": "@Undreren You might also be interested in the sequels to that article: <a href=\"https://ro-che.info/articles/2014-06-14-extensible-effects-failed\" rel=\"nofollow noreferrer\">1</a>, <a href=\"https://ro-che.info/articles/2014-07-15-type-based-lift\" rel=\"nofollow noreferrer\">2</a>, <a href=\"https://ro-che.info/articles/2014-06-14-extensible-effects-failed\" rel=\"nofollow noreferrer\">3</a>. That said, I haven&#39;t ever myself run into the limitations of <code>mtl</code> in a real-life situation."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 7, "last_activity_date": 1472424212, "last_edit_date": 1472424212, "creation_date": 1472420007, "answer_id": 39195973, "question_id": 39195846, "link": "https://stackoverflow.com/questions/39195846/lifting-a-computation-from-the-state-monad-into-the-rws-monad/39195973#39195973", "title": "Lifting a computation from the State monad into the RWS monad", "body": "<p>I assume you are using <a href=\"https://hackage.haskell.org/package/mtl\" rel=\"nofollow\"><code>mtl</code></a> (if you aren't, consider doing so - the libraries are mostly compatible, except for what follows). You can derive instances of <code>MonadReader MyEnv</code>, <code>MonadWriter MyLog</code>, and <code>MonadState MyState</code>. Then, you can use these to generalize your functions over <em>any</em> monad stack that has these sort of constraints.</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving, MultiParamTypeClasses, FlexibleContexts #-}\n\nimport Control.Monad.RWS\nimport Control.Monad.Reader\nimport Control.Monad.Writer\nimport Control.Monad.State\n\nnewtype Problem a = Problem { unProblem :: RWS MyEnv MyLog MyState a }\n                    deriving (Functor, Applicative, Monad,\n                              MonadReader MyEnv, MonadWriter MyLog, MonadState MyState)\n</code></pre>\n\n<p>From your example, maybe <code>bar</code> only needs to know that there is some state <code>MyState</code>, so you can give it signature</p>\n\n<pre><code>bar :: MonadState MyState m =&gt; c -&gt; m d\nbar = ...\n</code></pre>\n\n<p>Then, even for <code>foo</code>, which might need the full <code>RWS</code> capabilities, you could write</p>\n\n<pre><code>foo :: (MonadState MyState m, MonadReader MyEnv m, MonadWriter MyLog m) =&gt; a -&gt; m b\nfoo = ...\n</code></pre>\n\n<p>Then, you can mix and match these to your liking:</p>\n\n<pre><code>baz :: Problem ()\nbaz = foo 2 &gt;&gt; bar \"hi\" &gt;&gt; return ()\n</code></pre>\n\n<hr>\n\n<p>Now, why is this useful in general? It boils down to the flexibility of your monad \"stack\". If tomorrow you decide that you don't actually need <code>RWS</code> but only <code>State</code>, you can refactor <code>Problem</code> accordingly and <code>bar</code> (which only ever needed state in the first place) will continue to work without any changes.</p>\n\n<p>In general, I try to avoid using <code>WriterT</code>, <code>StateT</code>, <code>RWST</code> etc inside auxiliary functions like <code>foo</code> or <code>bar</code>. Opt to keep your code there as generic and implementation-independent as possible using the typeclasses <code>MonadWriter</code>, <code>MonadState</code>, <code>MonadReader</code>, etc. Then, you only have to use <code>WriterT</code>, <code>StateT</code>, <code>RWST</code> once inside your code: when you actually \"run\" your monad.</p>\n\n<h3>Side note about <code>transformers</code></h3>\n\n<p>If you are using <a href=\"http://hackage.haskell.org/package/transformers\" rel=\"nofollow\"><code>transformers</code></a>, none of this works. That isn't necessarily a bad thing: <code>mtl</code>, by virtue of always being able to \"find\" components (like state or writer) <a href=\"https://ro-che.info/articles/2014-06-11-problem-with-mtl\" rel=\"nofollow\">has some problems</a>.</p>\n"}], "owner": {"reputation": 796, "user_id": 672098, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/df506e61c4f7bb05009fcb7f22ee81e2?s=128&d=identicon&r=PG", "display_name": "Arek&#39; Fu", "link": "https://stackoverflow.com/users/672098/arek-fu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 262, "favorite_count": 1, "accepted_answer_id": 39195973, "answer_count": 1, "score": 2, "last_activity_date": 1472424212, "creation_date": 1472418901, "question_id": 39195846, "link": "https://stackoverflow.com/questions/39195846/lifting-a-computation-from-the-state-monad-into-the-rws-monad", "title": "Lifting a computation from the State monad into the RWS monad", "body": "<p>I structure a computation around the use of the <code>RWS</code> (<code>Reader</code>+<code>Writer</code>+<code>State</code>) monad:</p>\n\n<pre><code>newtype Problem a = Problem { unProblem :: RWS MyEnv MyLog MyState a }\n                    deriving ({- lots of typeclasses -})\n</code></pre>\n\n<p>The computation is built step by step by assembling elementary computations of the form</p>\n\n<pre><code>foo :: a -&gt; Problem b\n</code></pre>\n\n<p>Sometimes, however, the subcomputations do not need the full power of the <code>RWS</code> monad. For instance, consider</p>\n\n<pre><code>bar :: c -&gt; State MyState d\n</code></pre>\n\n<p>I would like to use <code>bar</code> as a part of a larger computation in the context of the <code>Problem</code> monad. I can see three ways of doing this, none of which seems very elegant to me.</p>\n\n<ol>\n<li><p>Manually unwrap the  the <code>State</code> computation and rewrap it in the RWS monad:</p>\n\n<pre><code>baz :: a -&gt; RWS MyEnv MyLog MyState c\nbaz x = do temp &lt;- foo x\n           initialState &lt;- get\n           let (finalResult, finalState) = runState (bar temp) initialState\n           put finalState\n           return finalResult\n</code></pre></li>\n<li><p>Modify the type signature of <code>bar</code> by lifting it into the <code>Problem</code> monad. This has the downside that the new type signature does not explicitly promise that <code>bar</code> is independent of <code>MyEnv</code> and logs nothing to <code>MyLog</code>.</p></li>\n<li><p>Replace the <code>RWS</code> monad by an explicit <code>ReaderT MyEnv WriterT MyLog State MyState</code> monad stack. This allows me to concisely <code>lift.lift</code> the <code>bar</code> subcomputation into the full monad; however, this trick will not work e.g. for a subcomputation of the form <code>c -&gt; Reader MyEnv d</code>.</p></li>\n</ol>\n\n<p>Is there a cleaner way to compose <code>foo</code> and <code>bar</code>? I have a hunch that a few clever definitions of type-class instances might do the trick, but I can't see exactly how to proceed.</p>\n"}, {"tags": ["algorithm", "haskell", "functional-programming", "hilbert-curve"], "comments": [{"owner": {"reputation": 325120, "user_id": 501557, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/e4bac7ebd5f5a06c716f508af656e24b?s=128&d=identicon&r=PG", "display_name": "templatetypedef", "link": "https://stackoverflow.com/users/501557/templatetypedef"}, "edited": false, "score": 0, "creation_date": 1472418962, "post_id": 39195743, "comment_id": 65732183, "body": "When you say &quot;generating points on the fly,&quot; do you mean &quot;generating random points on the Hilbert curve,&quot; or something else?"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 325120, "user_id": 501557, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/e4bac7ebd5f5a06c716f508af656e24b?s=128&d=identicon&r=PG", "display_name": "templatetypedef", "link": "https://stackoverflow.com/users/501557/templatetypedef"}, "edited": false, "score": 0, "creation_date": 1472420095, "post_id": 39195743, "comment_id": 65732463, "body": "@templatetypedef maybe I was ambiguous, so I&#39;ve added layers of redundancy on the question to make it as specific as possible."}, {"owner": {"reputation": 325120, "user_id": 501557, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/e4bac7ebd5f5a06c716f508af656e24b?s=128&d=identicon&r=PG", "display_name": "templatetypedef", "link": "https://stackoverflow.com/users/501557/templatetypedef"}, "edited": false, "score": 0, "creation_date": 1472420251, "post_id": 39195743, "comment_id": 65732512, "body": "Can you elaborate on what you mean by &quot;the next point on the curve?&quot; The curve is continuous."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 325120, "user_id": 501557, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/e4bac7ebd5f5a06c716f508af656e24b?s=128&d=identicon&r=PG", "display_name": "templatetypedef", "link": "https://stackoverflow.com/users/501557/templatetypedef"}, "edited": false, "score": 0, "creation_date": 1472421540, "post_id": 39195743, "comment_id": 65732825, "body": "@templatetypedef the Wikipedia article has a function, <code>d2xy : Int -&gt; Int -&gt; (Int, Int)</code> to convert integers to 2D points on the hilbert curve in a square divided into <code>n by n</code> cells. <code>map (d2xy n) [0..]</code> is the list of points I want to generate incrementally."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 325120, "user_id": 501557, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/e4bac7ebd5f5a06c716f508af656e24b?s=128&d=identicon&r=PG", "display_name": "templatetypedef", "link": "https://stackoverflow.com/users/501557/templatetypedef"}, "edited": false, "score": 0, "creation_date": 1472421701, "post_id": 39195743, "comment_id": 65732852, "body": "@Gene why did you delete your answer? I found it very useful."}, {"owner": {"reputation": 42504, "user_id": 1161878, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0157ddd785dc01e95342e3661d34b42a?s=128&d=identicon&r=PG", "display_name": "Gene", "link": "https://stackoverflow.com/users/1161878/gene"}, "edited": false, "score": 0, "creation_date": 1472428633, "post_id": 39195743, "comment_id": 65734094, "body": "Well, it has nothing to do with Haskell. I know little of that language.  But I&#39;ll undelete since you asked..."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1472449934, "post_id": 39195743, "comment_id": 65738602, "body": "If you are interested in being able to generate the n-th point along the curve directly, have a look at <a href=\"https://github.com/galtay/hilbert_curve\" rel=\"nofollow noreferrer\">this github repo</a>"}], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1472428867, "post_id": 39196074, "comment_id": 65734123, "body": "Thanks for undeleting the answer. I only added the Haskell flag because it is the language on which I was comfortable to express the problem precisely. I ported your answer <a href=\"http://lpaste.net/181204\" rel=\"nofollow noreferrer\">to JavaScript</a> and turns out, as I suspected, it is about 4 times faster than <a href=\"http://lpaste.net/181205\" rel=\"nofollow noreferrer\">the Wikipedia version</a> when you absolutely must generate all points (which is my case). Thank you."}], "tags": [], "owner": {"reputation": 42504, "user_id": 1161878, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0157ddd785dc01e95342e3661d34b42a?s=128&d=identicon&r=PG", "display_name": "Gene", "link": "https://stackoverflow.com/users/1161878/gene"}, "is_accepted": true, "score": 0, "last_activity_date": 1472428950, "last_edit_date": 1472428950, "creation_date": 1472420751, "answer_id": 39196074, "question_id": 39195743, "link": "https://stackoverflow.com/questions/39195743/is-there-a-constant-time-algorithm-for-generating-hilbert-points-curve-increment/39196074#39196074", "title": "Is there a constant time algorithm for generating hilbert points curve incrementally?", "body": "<p>If you mean \"Is there an algorithm for generating the vertices of a Hilbert curve in sequence with O(1) cost per vertex?\" the answer is yes. This is a standard exercise in recursion. If you have the usual turtle graphics primitives for emitting the vertices, it looks like this:</p>\n\n<pre><code>-- Angle must be + or - 90.0 degrees.\nprocedure Hilbert(Order : in Natural;\n                  Angle : in Float) is\n   Step : constant Float := 1.0; -- length of base case edge\nbegin\n   if Order &gt; 0 then\n      Turn(Angle);\n      Hilbert(Order - 1, -Angle);\n      Walk(Step);\n      Turn(-Angle);\n      Hilbert(Order - 1,  Angle);\n      Walk(Step);\n      Hilbert(Order - 1,  Angle);\n      Turn(-Angle);\n      Walk(Step);\n      Hilbert(Order - 1, -Angle);\n      Turn(Angle);\n   end if;\nend Hilbert;\n</code></pre>\n\n<p>Initiate the recursion with </p>\n\n<pre><code>Hilbert(7, 90.0);\n</code></pre>\n\n<p>to get a 7th order curve.</p>\n\n<p><strong>Addition</strong></p>\n\n<p>Since you seem to be interested in an iterator pattern, you can either use the logic above and a language (like Python or Ruby) with generators, or you can implement the generator yourself with the usual techniques for recursive to iterative code conversion.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 375, "favorite_count": 3, "accepted_answer_id": 39196074, "answer_count": 1, "score": 2, "last_activity_date": 1472428950, "creation_date": 1472418049, "last_edit_date": 1472420070, "question_id": 39195743, "link": "https://stackoverflow.com/questions/39195743/is-there-a-constant-time-algorithm-for-generating-hilbert-points-curve-increment", "title": "Is there a constant time algorithm for generating hilbert points curve incrementally?", "body": "<p>The <a href=\"https://en.wikipedia.org/wiki/Hilbert_curve\" rel=\"nofollow\">Wikipedia Article</a> on the Hilbert Cube includes functions that encode/decode arbitrary indices to/from arbitrary points on the Hilbert Curve. Those algorithms aren't constant-time. Is there a constant-time algorithm that, given an actual point on the curve (and, perhaps, some required state), generates the next point (and the next state)?</p>\n\n<p>Formally, I want a type <code>State</code>, and a tuple <code>(initialState, nextState) :: (State, State -&gt; ((Nat, Nat), State)</code>, such that each application of <code>nextState</code> gives us the next point of the Hilbert curve, and such that that <code>nextState</code> is optimal, which is probably not the case for the algorithm presented on Wikipedia, since it possibly misses the opportunity for incremental computation that we have here. Illustration:</p>\n\n<pre><code>data State = _\n\ninitialState :: State\ninitialState = _\n\n-- This must be optimal\nnextState :: State -&gt; ((Nat, Nat), State)\nnextState = _\n\n-- Returns the `nth point` of the hilbert curve\nhilbertPoint :: Nat -&gt; (Nat, Nat)\nhilbertPoint n = iterate (snd.nextState) initialState !! n\n</code></pre>\n"}, {"tags": ["haskell", "haskell-snap-framework", "heist"], "answers": [{"comments": [{"owner": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "edited": false, "score": 0, "creation_date": 1472574421, "post_id": 39211943, "comment_id": 65802461, "body": "Wow. I don&#39;t fully get this yet but this helps a lot. There appears to be some real, deep philosophy behind how Heist (and Snap) works. If only someone would write a book about it!"}], "tags": [], "owner": {"reputation": 7154, "user_id": 527460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cece5abd2f9ad9056f5ac3830ac0bfe?s=128&d=identicon&r=PG", "display_name": "mightybyte", "link": "https://stackoverflow.com/users/527460/mightybyte"}, "is_accepted": true, "score": 1, "last_activity_date": 1472491972, "creation_date": 1472491972, "answer_id": 39211943, "question_id": 39195348, "link": "https://stackoverflow.com/questions/39195348/passing-data-directly-into-templates-in-compiled-heist-haskell/39211943#39211943", "title": "Passing data directly into templates in compiled Heist (Haskell)?", "body": "<p>The example that you're focusing on with the runtime data of <code>[(\"titleSplice\", \"myTitle\"), (\"bodySplice\", \"myBody\")]</code> is MUCH less powerful than the model that Heist exposes.  Your model is simple tag name substitution.  Heist's splice model is <code>Node -&gt; m [Node]</code>.  This allows it to do very powerful things like the <a href=\"http://hackage.haskell.org/package/heist-1.0.0.0/docs/Heist-Splices-Cache.html\" rel=\"nofollow\">cache tag</a>, the <a href=\"http://hackage.haskell.org/package/heist-1.0.0.0/docs/Heist-Splices-Markdown.html\" rel=\"nofollow\">markdown tag</a>, and even <a href=\"http://hackage.haskell.org/package/heist-1.0.0.0/docs/Heist-Splices-Html.html\" rel=\"nofollow\">head merging with the html tag</a>.</p>\n\n<p>The monad transformer approach Heist uses was a simple and obvious implementation that makes all runtime data accessible to splices.  It also thinks of splices as a universal API provided by the backend that can be used anywhere by front end designers.  Are other formulations possible?  I'm sure there are.  But this one is simple and powerful.</p>\n\n<p>Your formulation is also very template specific.  If a designer wanted to add some new kind of data to a page, you would have to change the Haskell code to accommodate that.  With Heist's approach no Haskell code change would be necessary.  This gives designers a lot of power to change things in a very decoupled manner.</p>\n"}], "owner": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 39211943, "answer_count": 1, "score": 1, "last_activity_date": 1472491972, "creation_date": 1472415060, "question_id": 39195348, "link": "https://stackoverflow.com/questions/39195348/passing-data-directly-into-templates-in-compiled-heist-haskell", "title": "Passing data directly into templates in compiled Heist (Haskell)?", "body": "<p>I use compiled Heist.  My splices only do run-time work (no load-time work). I have a <code>template.tpl</code> like this:</p>\n\n<pre><code>&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;&lt;titleSplice/&gt;&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;bodySplice/&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>This is how I do things:</p>\n\n<ul>\n<li>Within the Snap action for a <code>/:param</code> route, I use <code>renderTemplate heistState \"template\"</code> to obtain a <code>MyHeistRuntimeMonad Builder</code>.</li>\n<li>I can pass the <code>:param</code> value to my splice by putting it into my runtime monad via ReaderT: <code>type MyHeistRuntimeMonad = ReaderT String IO</code>. (Where the <code>String</code> is for the passed in <code>:param</code> value.)</li>\n</ul>\n\n<p><strong>And that is my problem</strong>. The only way to pass data from my routes to my splices is through the heist runtime monad. This makes things a bit complicated. My questions:</p>\n\n<ol>\n<li>Is there no alternative to <code>renderTemplate</code> that allows me to pass data directly to the template? For example, something like this: <code>renderTemplate' \"template\" [(\"titleSplice\", \"myTitle\"), (\"bodySplice\", \"myBody\")]</code>.</li>\n<li>If this is not possible, why not? I'm just wondering why things were designed the way they were. I don't quite get it.</li>\n</ol>\n"}, {"tags": ["haskell", "recursion", "iteration", "fold"], "comments": [{"owner": {"reputation": 466742, "user_id": 224671, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c90de868a7e95d75bdfd6a906dfedac7?s=128&d=identicon&r=PG", "display_name": "kennytm", "link": "https://stackoverflow.com/users/224671/kennytm"}, "edited": false, "score": 2, "creation_date": 1472414988, "post_id": 39195297, "comment_id": 65731211, "body": "Do you mean to use the <a href=\"http://learnyouahaskell.com/syntax-in-functions#let-it-be\" rel=\"nofollow noreferrer\"><code>let</code> keyword</a>?"}], "answers": [{"comments": [{"owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "edited": false, "score": 0, "creation_date": 1472417983, "post_id": 39195357, "comment_id": 65731910, "body": "Thanks - what if I wanted to map over the list and drop elements? how would you structure that?"}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "edited": false, "score": 2, "creation_date": 1472419809, "post_id": 39195357, "comment_id": 65732371, "body": "@ronaldmurphy That is exactly what <code>filter</code> is for."}], "tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": false, "score": 3, "last_activity_date": 1472417085, "last_edit_date": 1472417085, "creation_date": 1472415115, "answer_id": 39195357, "question_id": 39195297, "link": "https://stackoverflow.com/questions/39195297/haskell-even-number-iteration/39195357#39195357", "title": "Haskell even number iteration", "body": "<p>Haskell isn't an imperative language in which you order statements, but you can achieve your method by binding values to identifiers using <code>let</code>:</p>\n\n<pre><code>f :: Int -&gt; Int\nf x = let y = x + 5 in y * 3\n</code></pre>\n\n<p>But even using this your function has a few problems:</p>\n\n<ul>\n<li>your recursive call is wrong (use <code>evenfunc</code>)</li>\n<li>your usage of <code>drop</code> is probably wrong</li>\n<li>you never define <code>xs</code> anywhere</li>\n</ul>\n\n<p>All in all, it is probably best to remodel your approach using library functions. <code>filter</code> does exactly what you want:</p>\n\n<pre><code>evenfunc list = filter even list\n</code></pre>\n\n<p>Or, even:</p>\n\n<pre><code>evenfunc = filter even\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 52258, "user_id": 375232, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/h3OwD.png?s=128&g=1", "display_name": "Landei", "link": "https://stackoverflow.com/users/375232/landei"}, "is_accepted": true, "score": 3, "last_activity_date": 1472471128, "last_edit_date": 1472471128, "creation_date": 1472470683, "answer_id": 39205394, "question_id": 39195297, "link": "https://stackoverflow.com/questions/39195297/haskell-even-number-iteration/39205394#39205394", "title": "Haskell even number iteration", "body": "<p>Of course the given solution using <code>filter</code> should be preferred, but the recursive version could be instructive, too:</p>\n\n<pre><code>evenfunc :: [Int] -&gt; [Int]\nevenfunc [] = []\nevenfunc (x:xs) = if even x then x : tail else tail where\n    tail = evenfunc xs  \n</code></pre>\n\n<p>The first line <code>evenfunc [] = []</code> takes care of the base case - the empty list. You were missing this in your solution, and if you call <code>head</code> on an empty list, you get an exception.</p>\n\n<p>The second line deconstructs the list using a pattern: <code>x</code> is the head and <code>xs</code> is the tail. Then we use <code>if</code> pretty much as in imperative languages, with the difference that it returns a value (so it is in fact closer to the ternary operator <code>x ? y : z</code> in Java etc). In order to avoid repetition, we define a sub-expression <code>tail</code> in the <code>where</code> clause. If it is weird to you to use things before you define them, you can use <code>let</code> instead, which works similar. Of course, calculating <code>tail</code> means to execute the recursive call.</p>\n"}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 715, "favorite_count": 0, "accepted_answer_id": 39205394, "answer_count": 2, "score": 0, "last_activity_date": 1472471128, "creation_date": 1472414696, "question_id": 39195297, "link": "https://stackoverflow.com/questions/39195297/haskell-even-number-iteration", "title": "Haskell even number iteration", "body": "<p>I'm trying to drop all odd number from a list of integers.. however having some problems (I'm a total newbie), here's my code:</p>\n\n<pre><code> evenfunc :: [Int] -&gt; [Int]\n evenfunc li =\n        x = head li\n        y = tail li\n        if even x\n          then x : myevenfunc xs --take head an pass tail recursively\n        else\n          drop x li : myevenfunc xs --drop head from list and pass tail recursively\n</code></pre>\n\n<p>Its giving me a 'parse error on input '='' message when trying to run this.</p>\n\n<p>What am I doing wrong here?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1472413408, "post_id": 39195069, "comment_id": 65730773, "body": "It does return 5. Maybe you typed in something different?"}], "answers": [{"tags": [], "owner": {"reputation": 11096, "user_id": 2749717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46af1ef54856d737d52b7667afd240ee?s=128&d=identicon&r=PG&f=1", "display_name": "bipll", "link": "https://stackoverflow.com/users/2749717/bipll"}, "is_accepted": false, "score": 0, "last_activity_date": 1472413379, "creation_date": 1472413379, "answer_id": 39195111, "question_id": 39195069, "link": "https://stackoverflow.com/questions/39195069/dot-in-haskell-tricky-example/39195111#39195111", "title": "Dot in haskell, tricky example", "body": "<pre><code>main = print $(f . g) 4 5\n\nf x = x\ng x = \\y -&gt; y\n</code></pre>\n\n<p>Compiles nicely and when run prints 5. I'm using GHC 8.0.1.\nMaybe you'd rather provide a complete minimal etc. example?</p>\n"}, {"comments": [{"owner": {"reputation": 325, "user_id": 3713267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/cbbd05af741b8ca9f9bb981a4d820e92?s=128&d=identicon&r=PG&f=1", "display_name": "JohnnyGat", "link": "https://stackoverflow.com/users/3713267/johnnygat"}, "edited": false, "score": 0, "creation_date": 1472417387, "post_id": 39195124, "comment_id": 65731767, "body": "I forgot to mention type of f in my question. It was Integer -&gt; Integer. This is why I was getting error"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1472413847, "last_edit_date": 1472413847, "creation_date": 1472413436, "answer_id": 39195124, "question_id": 39195069, "link": "https://stackoverflow.com/questions/39195069/dot-in-haskell-tricky-example/39195124#39195124", "title": "Dot in haskell, tricky example", "body": "<p>As mentioned in the question, we have:</p>\n\n<pre><code>(f . g) x = f (g x)\n</code></pre>\n\n<p>Hence, in particular</p>\n\n<pre><code>(f . g) 4 = f (g 4)               (*)\n</code></pre>\n\n<p>from which we have</p>\n\n<pre><code>(f . g) 4 5\n=   -- application associates to the left\n((f . g) 4) 5\n=   -- equation (*) above\n(f (g 4)) 5 =\n=   -- application associates to the left\nf (g 4) 5\n</code></pre>\n\n<p>We can now see that the last argument <code>5</code> is being left as the second argument of <code>f</code>, and <em>not</em> passed to <code>g</code>.</p>\n\n<p>It is useful to remember that Haskell functions are curried: technically, there's no such a thing as a function which takes two arguments. A function having type <code>a -&gt; b -&gt; c</code> is actually a unary function returning a unary function, even if we like to think of that as a binary function.</p>\n\n<p>The composition operator works on unary functions as well: <code>f . g</code> composes the unary functions <code>f</code> and <code>g</code>. If <code>f</code> is \"binary\", it is treated as a unary function returning a function. This makes it take an additional argument, as shown above. If <code>g</code> is \"binary\", its returned function is passed to <code>f</code>.</p>\n\n<p>So, using the above definitions:</p>\n\n<pre><code>f x = x\ng x = \\y -&gt; y\n</code></pre>\n\n<p>we get:</p>\n\n<pre><code>(f . g) 4 5\n= -- done above\nf (g 4) 5\n= -- associativity\n(f (g 4)) 5\n= -- definition of f\n(g 4) 5\n= -- definition of g\n(\\y -&gt; y) 5\n= -- beta reduction\n5\n</code></pre>\n"}], "owner": {"reputation": 325, "user_id": 3713267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/cbbd05af741b8ca9f9bb981a4d820e92?s=128&d=identicon&r=PG&f=1", "display_name": "JohnnyGat", "link": "https://stackoverflow.com/users/3713267/johnnygat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 39195124, "answer_count": 2, "score": -2, "last_activity_date": 1472417264, "creation_date": 1472413030, "last_edit_date": 1472417264, "question_id": 39195069, "link": "https://stackoverflow.com/questions/39195069/dot-in-haskell-tricky-example", "title": "Dot in haskell, tricky example", "body": "<p>I know that \"haskells dot\" question was answered couple times before on stackoverflow but I came across a example that shows me I still don't fully get it. Let's say I have functions</p>\n\n<pre><code>f :: Integer -&gt; Integer\nf x = x\ng x = \\y -&gt; y\n</code></pre>\n\n<p>Now, as far as I know dot works like function composition -> <code>f (g x) = (f . g) x</code>\n. So </p>\n\n<p><code>(f . g) 4 5</code></p>\n\n<p>shuld returns 5. Because <code>g</code> takes two arguments and returns second one, and f is simply identity. However it doesn't, Im getting <code>Couldn't match type</code> error. I have a feeling that haskell parses this expresion to something like <code>((f . g) 4) 5</code>. But I need deeper explanation</p>\n"}, {"tags": ["haskell", "development-environment"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1472406563, "post_id": 39193671, "comment_id": 65728831, "body": "<code>import MyModule</code> will work if <code>MyModule</code> is in <code>exposed-modules</code> or <code>other-modules</code> in your cabal file."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 7, "last_activity_date": 1487585218, "last_edit_date": 1487585218, "creation_date": 1472407641, "answer_id": 39194308, "question_id": 39193671, "link": "https://stackoverflow.com/questions/39193671/view-non-exposed-library-functions-while-developing-in-haskell/39194308#39194308", "title": "View non-exposed library functions while developing in Haskell", "body": "<p>Quoting the <a href=\"https://downloads.haskell.org/~ghc/7.4.1/docs/html/users_guide/interactive-evaluation.html#ghci-scope\" rel=\"nofollow noreferrer\">GHCi docs</a>:</p>\n\n<blockquote>\n  <p>The <code>:module</code> command provides a way to do two things that cannot be done with ordinary import declarations: </p>\n  \n  <ul>\n  <li><code>:module</code> supports the <code>*</code> modifier on modules, which opens the full top-level scope of a module, rather than just its exports.</li>\n  </ul>\n</blockquote>\n\n<p>The additional <code>*</code> makes GHCi load the bytecode version of the module. This will not be as performant, but you'll get access to unexported bindings.</p>\n\n<p>Example:</p>\n\n<pre><code>\u03bb&gt; :m *MyLib\n\u03bb&gt; :t myfunctionofinterest\n</code></pre>\n\n<p>If you get</p>\n\n<pre><code>module 'MyLib' is not interpreted; try ':add *MyLib' first\n</code></pre>\n\n<p>you may have to do <code>:load</code> first (the advice about <code>:add</code> doesn't always do the trick):</p>\n\n<pre><code>\u03bb&gt; :l *MyLib\n\u03bb&gt; :m *MyLib\n\u03bb&gt; :t myfunctionofinterest\n</code></pre>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 1, "accepted_answer_id": 39194308, "answer_count": 1, "score": 7, "last_activity_date": 1487585218, "creation_date": 1472403355, "last_edit_date": 1495541363, "question_id": 39193671, "link": "https://stackoverflow.com/questions/39193671/view-non-exposed-library-functions-while-developing-in-haskell", "title": "View non-exposed library functions while developing in Haskell", "body": "<p>I made a mistake <a href=\"https://stackoverflow.com/questions/39193147/combining-and-splitting-assignment-in-haskell-io-do-block\">in another question</a> that could have been solved by viewing </p>\n\n<pre><code>:t myfunctionofinterest\n</code></pre>\n\n<p>for a function I was using in a library.</p>\n\n<p>However, when I am in my project root, and run</p>\n\n<pre><code>$ stack ghci\n</code></pre>\n\n<p>And my Main.hs has:</p>\n\n<pre><code>import MyLib\n</code></pre>\n\n<p>And my module does:</p>\n\n<pre><code>module MyLib {\n  bunchOfFunctions -- but not myfunctionofinterest\n} where\n\nimport SomeDB.ModuleThatExposes -- myfunctionofinterest\n\nmyfunc :: IO ()\nmyfunc = do\n  myfunctionofinterest a b c -- place where I misuse myfunctionofinterest and could have used :t on it to see it had 3 args\n</code></pre>\n\n<p>I can't <code>:t</code> myfunctionofinterest in the main since it's not exposed, nor does <code>Import MyLib.myfunctionofinterest</code> explicitly \nhelp, since it was something defined in an import. While I know I could expose it then check it, <code>:a</code> to compile, and then edit the lib to hide it again, is there  anything that allows that more quickly and directly?</p>\n\n<p>This seems like it must be a common pattern.  What do you do when you need to check the type of something used in a library as you develop?</p>\n"}, {"tags": ["haskell", "io-monad"], "answers": [{"comments": [{"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 1, "creation_date": 1472402015, "post_id": 39193293, "comment_id": 65727392, "body": "Got it, so these are unrelated problems.  The first was just not checking that the execute function took 4 arguments, and python-habit that I needed to query = &quot;myquery {}&quot;.format(args); execute(query).  The second needed a sequential operator.  If I needed parens to show order of operations explicitly, rather than use $, I would have had to have done:  mynum :: Int &lt;- (putStrLn &quot;Please input a number.&quot; &gt;&gt; readLn)"}], "tags": [], "owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "is_accepted": true, "score": 4, "last_activity_date": 1472401755, "last_edit_date": 1472401755, "creation_date": 1472400962, "answer_id": 39193293, "question_id": 39193147, "link": "https://stackoverflow.com/questions/39193147/combining-and-splitting-assignment-in-haskell-io-do-block/39193293#39193293", "title": "Combining and splitting assignment in Haskell IO do block", "body": "<p>In</p>\n\n<pre><code>execute conn \"INSERT INTO test (num, data) VALUES (?, ?)\" $ MyRecord (Just 200) (Just \"Test\")\n</code></pre>\n\n<p>, the left-hand side of the <code>$</code> operator is <code>execute conn \"INSERT\u2026\"</code>, and the right-hand side is <code>MyRecord \u2026</code>. That is, you're calling <code>execute</code> with three arguments: the connection, the query, and the parameters. That\u2019s the first problem:</p>\n\n<pre><code>q &lt;- \"INSERT INTO test (num, data) VALUES (?, ?)\" $ MyRecord (Just 200) (Just \"Test\")\nres &lt;- execute conn q\n</code></pre>\n\n<p>Here, the left-hand side of the <code>$</code> operator is the string <code>\"INSERT\u2026\"</code>, and the right-hand side is the parameters. You're trying to call a string, then pass the result as the second argument to <code>execute</code>.</p>\n\n<p>If <code>q</code> could be some strange type that represented two arguments, though, it probably wouldn\u2019t be an <code>IO a</code>. You\u2019re looking to just name a value with <code>let</code>, not run an action.</p>\n\n<p>This should work:</p>\n\n<pre><code>ipg :: IO ()\nipg = do\n  conn &lt;- connect defaultConnectInfo { connectHost = \"0.0.0.0\" }\n  let query = \"INSERT INTO test (num, data) VALUES (?, ?)\"\n  let parameters = MyRecord (Just 200) (Just \"Test\")\n  res &lt;- execute conn query parameters\n  print res\n</code></pre>\n\n<hr>\n\n<pre><code>myinput :: IO ()\nmyinput = do\n  mynum :: Int &lt;- readLn $ putStrLn \"Please input a number.\"\n  print mynum\n</code></pre>\n\n<p>This one just doesn\u2019t make a lot of sense. Maybe it\u2019s a misunderstanding of the <code>$</code> operator? <code>$</code> is mostly just a way to write expressions without using parentheses; <code>f $ x</code> is equivalent to <code>f x</code>, but the <code>$</code> has low precedence, so you can write <code>f $ 1 + 2</code> instead of <code>f (1 + 2)</code>.</p>\n\n<p>Anyway, I\u2019ll loosely translate it into Python for you, if that helps:</p>\n\n<pre class=\"lang-python prettyprint-override\"><code>def myinput():\n    mynum = int(input(print(\"Please input a number.\")))\n    print(mynum)\n</code></pre>\n\n<p>If you want to sequence the <code>readLn</code> and <code>putStrLn</code> actions, you can use the <code>&gt;&gt;</code> operator (which is what <code>do</code> is doing behind the scenes):</p>\n\n<pre><code>myinput :: IO ()\nmyinput = do\n  mynum :: Int &lt;- putStrLn \"Please input a number.\" &gt;&gt; readLn\n  print mynum\n</code></pre>\n\n<p>That\u2019s not very good for readability most of the time, though. (<code>a &gt;&gt; b</code> will also discard the result of <code>a</code> without complaint, whereas <code>do { a; b }</code> will give a compiler warning if discarding something that isn\u2019t <code>()</code>.)</p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 39193293, "answer_count": 1, "score": 0, "last_activity_date": 1472401755, "creation_date": 1472400025, "last_edit_date": 1472401712, "question_id": 39193147, "link": "https://stackoverflow.com/questions/39193147/combining-and-splitting-assignment-in-haskell-io-do-block", "title": "Combining and splitting assignment in Haskell IO do block", "body": "<p>I /think/ I have a similar misunderstanding of the language in two places involving how variable assignment works in do blocks, involving the IO monad. Could you help me understand (1) is it the same misunderstanding, (2) how to clear it up (in an answer, and maybe specifically if you have a favorite reference on the subject)?</p>\n\n<p>I find that I can perform an operation successfully when it is all one line, but not when I try to split into 2 for readability.</p>\n\n<p><strong>Part I: Turning 1 line into 2</strong></p>\n\n<p>Why does this work?</p>\n\n<pre><code>ipg :: IO ()\nipg = do\n  conn &lt;- connect defaultConnectInfo { connectHost = \"0.0.0.0\"}\n  res &lt;- execute conn \"INSERT INTO test (num, data) VALUES (?, ?)\" $ MyRecord (Just 200) (Just\"Test\")\n  print res\n</code></pre>\n\n<p>But this not work</p>\n\n<pre><code>ipg :: IO ()\nipg = do\n  conn &lt;- connect defaultConnectInfo { connectHost = \"0.0.0.0\" }\n  q &lt;- \"INSERT INTO test (num, data) VALUES (?, ?)\" $ MyRecord (Just 200) (Just\"Test\")\n  res &lt;- execute conn q\n  print res\n</code></pre>\n\n<p>Gives me:</p>\n\n<pre><code>Couldn't match expected type \u2018IO a0\u2019\n            with actual type \u2018q0 -&gt; IO GHC.Int.Int64\u2019\nProbable cause: \u2018execute\u2019 is applied to too few arguments\nIn a stmt of a 'do' block: res &lt;- execute conn q\n</code></pre>\n\n<p>The difference between the first and second being trying to store the query portion in q.</p>\n\n<p><strong>Part II: Turning 2 lines into 1</strong></p>\n\n<p>Why does this work:</p>\n\n<pre><code>myinput :: IO ()\nmyinput = do\n  putStrLn \"Please input a number.\"\n  mynum :: Int  &lt;- readLn  \n  print mynum\n</code></pre>\n\n<p>But this not work?</p>\n\n<pre><code>myinput :: IO ()\nmyinput = do\n  mynum :: Int &lt;- readLn $ putStrLn \"Please input a number.\"\n  print mynum\n</code></pre>\n\n<p>Gives me</p>\n\n<pre><code>Couldn't match expected type \u2018IO () -&gt; IO Int\u2019\n            with actual type \u2018IO a0\u2019\nThe first argument of ($) takes one argument,\n</code></pre>\n"}, {"tags": ["haskell", "pattern-matching", "tuples"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1472402139, "post_id": 39192987, "comment_id": 65727423, "body": "Only if you define pairs as <code>type Tuple a b = forall r . (a -&gt; b -&gt; r) -&gt; r</code>."}], "answers": [{"comments": [{"owner": {"reputation": 166, "user_id": 2456981, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/010dc360ab9fa756636577b68d2a999e?s=128&d=identicon&r=PG", "display_name": "Ghijs Kilani", "link": "https://stackoverflow.com/users/2456981/ghijs-kilani"}, "edited": false, "score": 0, "creation_date": 1472399663, "post_id": 39193045, "comment_id": 65726641, "body": "Oh yeah, I totally forgot to generalise the problem to all data constructors, in which case it&#39;s pretty obvious! Thanks a lot."}], "tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 5, "last_activity_date": 1472399379, "creation_date": 1472399379, "answer_id": 39193045, "question_id": 39192987, "link": "https://stackoverflow.com/questions/39192987/is-it-possible-to-redefine-fst-without-using-pattern-matching/39193045#39193045", "title": "Is it possible to redefine fst without using pattern matching?", "body": "<p>The only way to extract the arguments of a data constructor is to pattern match on it.  You can do the pattern matching manually, or call a function (like <code>fst</code>) which does it for you - but either way, the pattern matching is being done somewhere.</p>\n"}], "owner": {"reputation": 166, "user_id": 2456981, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/010dc360ab9fa756636577b68d2a999e?s=128&d=identicon&r=PG", "display_name": "Ghijs Kilani", "link": "https://stackoverflow.com/users/2456981/ghijs-kilani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 39193045, "answer_count": 1, "score": 1, "last_activity_date": 1472399379, "creation_date": 1472399040, "question_id": 39192987, "link": "https://stackoverflow.com/questions/39192987/is-it-possible-to-redefine-fst-without-using-pattern-matching", "title": "Is it possible to redefine fst without using pattern matching?", "body": "<p>I've been using Haskell for about a year now because I'm writing a paper on it. In one of the first chapters I talk about pattern matching, and refer to the function</p>\n\n<pre><code>fst :: (a,b) -&gt; a\n</code></pre>\n\n<p>to demonstrate the usefulness of it. In the text I say that it \"would be more convoluted\" to implement <code>fst</code> without using pattern matching. Out of interest I started thinking about how I'd do this, but can't seem to think of any way that doesn't use pattern matching in one way or another, the best thing I can think of is</p>\n\n<pre><code>fst' tuple = let (first, second) = tuple\n             in first\n</code></pre>\n\n<p>but that essentially still uses pattern matching! Is there a way to access the inner values of a tuple without pattern matching?</p>\n"}, {"tags": ["haskell", "haskell-snap-framework", "heist"], "answers": [{"comments": [{"owner": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "edited": false, "score": 0, "creation_date": 1472406957, "post_id": 39194129, "comment_id": 65728944, "body": "But if the computation (fetching from database, etc.) and its transformation into chunks  has to be done at run-time anyway, why do I have to create the splice at load-time? Why would that add efficiency?"}, {"owner": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "edited": false, "score": 0, "creation_date": 1472406997, "post_id": 39194129, "comment_id": 65728956, "body": "I can understand why creating the splice at load-time would add efficiency if it does something significant at load time. But what about splices that do all their work at run-time? This is the point of my question."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "edited": false, "score": 0, "creation_date": 1472411685, "post_id": 39194129, "comment_id": 65730317, "body": "@haskellHQ Reread your comments you have already said it yourself. In this way <i>some</i> splices can be optimized, while splices that <i>must</i> be run at runtime <b>cannot</b> be optimized in any case. Between optimizing what is possible to optimize and not optimizing anything what should the library designer choose?"}, {"owner": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1472413455, "post_id": 39194129, "comment_id": 65730788, "body": "@Bakuriu That&#39;s a good point. mightybyte: Can you confirm that Bakuriu&#39;s comments mirror the library designer&#39;s (your?) thought process? That would clear up everything."}, {"owner": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "edited": false, "score": 0, "creation_date": 1472415089, "post_id": 39194129, "comment_id": 65731236, "body": "I&#39;ve added another related question: <a href=\"http://stackoverflow.com/questions/39195348/passing-data-directly-into-templates-in-compiled-heist-haskell\" title=\"passing data directly into templates in compiled heist haskell\">stackoverflow.com/questions/39195348/&hellip;</a>"}, {"owner": {"reputation": 7154, "user_id": 527460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cece5abd2f9ad9056f5ac3830ac0bfe?s=128&d=identicon&r=PG", "display_name": "mightybyte", "link": "https://stackoverflow.com/users/527460/mightybyte"}, "reply_to_user": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "edited": false, "score": 0, "creation_date": 1472490309, "post_id": 39194129, "comment_id": 65761824, "body": "@haskellHQ I think @Bakuriu is pretty much right.  The splice type is <code>Node -&gt; m [Node]</code>, which is inherently slow.  It doesn&#39;t matter if your splice has an effective type of <code>m ByteString</code>.  Heist doesn&#39;t ever see that.  If you want simple string interpolation templates, you might bet better off with something like <a href=\"http://hackage.haskell.org/package/mustache\" rel=\"nofollow noreferrer\">mustache</a>."}], "tags": [], "owner": {"reputation": 7154, "user_id": 527460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cece5abd2f9ad9056f5ac3830ac0bfe?s=128&d=identicon&r=PG", "display_name": "mightybyte", "link": "https://stackoverflow.com/users/527460/mightybyte"}, "is_accepted": true, "score": 1, "last_activity_date": 1472406354, "creation_date": 1472406354, "answer_id": 39194129, "question_id": 39192461, "link": "https://stackoverflow.com/questions/39192461/in-compiled-heist-haskell-why-must-splices-be-created-beforehand/39194129#39194129", "title": "In Compiled Heist (Haskell), why must splices be created beforehand?", "body": "<p>Splice functions (compiled and interpreted) operate on nodes.  Think of splices as having a type signature of <code>Node -&gt; m [Node]</code>.  This is a relatively expensive operation because it's operating at the DOM level.  The splice's result nodes get inserted back into the DOM tree, then the entire tree has to be rendered to a ByteString.  The idea behind compiled heist was to do as much of this rendering work as possible up front at application initialization time.  The output of the initialization would be <code>[Chunk]</code> where Chunk can either be a static ByteString or a dynamic <code>m ByteString</code> (actual types are slightly different).  Compiled splices have to be processed before the initialization converts the whole template from <code>[Node]</code> to <code>[Chunk]</code>.  And to maximize runtime efficiency that conversion happens at app initialization time.</p>\n\n<p>For more information check out these links:</p>\n\n<p><a href=\"http://snapframework.com/docs/tutorials/compiled-splices\" rel=\"nofollow\">http://snapframework.com/docs/tutorials/compiled-splices</a></p>\n\n<p><a href=\"https://github.com/snapframework/heist/wiki/Compiled-Splice-Formulations\" rel=\"nofollow\">https://github.com/snapframework/heist/wiki/Compiled-Splice-Formulations</a></p>\n"}], "owner": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 39194129, "answer_count": 1, "score": 0, "last_activity_date": 1472406354, "creation_date": 1472395615, "question_id": 39192461, "link": "https://stackoverflow.com/questions/39192461/in-compiled-heist-haskell-why-must-splices-be-created-beforehand", "title": "In Compiled Heist (Haskell), why must splices be created beforehand?", "body": "<p>I can understand why HTML templates (.tpl files) must be processed beforehand (with <code>loadTemplates</code>) and put into the <code>HeistConfig</code>. This allow Heist to process the HTML into a more efficient format beforehand.</p>\n\n<p>However, I don't understand why <em>splices</em> must also be created beforehand and put inside the <code>HeistConfig</code>. What is the benefit of this? I don't see the benefit because splices are computed at runtime anyway. What is the thought process behind this?</p>\n\n<p>I think this may be because a splice can also execute code at <em>load-time</em> (in addition to runtime). Is this the primary explanation?</p>\n"}, {"tags": ["haskell", "tuples"], "comments": [{"owner": {"reputation": 3, "user_id": 6176690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34d73d31f4a8b36ba41539755facc35a?s=128&d=identicon&r=PG&f=1", "display_name": "Ak. Jain", "link": "https://stackoverflow.com/users/6176690/ak-jain"}, "edited": false, "score": 0, "creation_date": 1472379214, "post_id": 39190211, "comment_id": 65720920, "body": "getting this errorType error in explicitly typed binding *** Term           : createAccount *** Type           : IO ([Char],[Char],[Char],[Char],[Char]) *** Does not match : IO () -&gt; Record"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1472421721, "post_id": 39190211, "comment_id": 65732858, "body": "There doesn&#39;t appear to be any reason to get the house number; <code>createAccount</code> doesn&#39;t use it."}], "answers": [{"comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 3, "creation_date": 1472382148, "post_id": 39190497, "comment_id": 65721680, "body": "<i>Remove the type signature - you don&#39;t need it as Haskell can figure it out.</i> Adding type signatures to all top-level bindings is good practice, though."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 5, "last_activity_date": 1472381456, "creation_date": 1472381456, "answer_id": 39190497, "question_id": 39190211, "link": "https://stackoverflow.com/questions/39190211/how-to-return-a-tuple-in-haskell/39190497#39190497", "title": "How to return a tuple in Haskell", "body": "<p>The error message is saying that the type signature for <code>createAccount</code> is actually:</p>\n\n<pre><code>createAccount :: IO ([Char],[Char],[Char],[Char],[Char])\n</code></pre>\n\n<p>not <code>IO() -&gt; Record</code> as you declared it to be.</p>\n\n<p>Options to fix it:</p>\n\n<ul>\n<li>Change the type signature to <code>IO ([Char],[Char],[Char],[Char],[Char])</code> (or equivalenly: <code>IO Record</code>)</li>\n<li>Remove the type signature - you don't need it as Haskell can figure it out.</li>\n</ul>\n"}], "owner": {"reputation": 3, "user_id": 6176690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34d73d31f4a8b36ba41539755facc35a?s=128&d=identicon&r=PG&f=1", "display_name": "Ak. Jain", "link": "https://stackoverflow.com/users/6176690/ak-jain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 337, "favorite_count": 0, "accepted_answer_id": 39190497, "answer_count": 1, "score": -3, "last_activity_date": 1472382083, "creation_date": 1472379164, "last_edit_date": 1472382083, "question_id": 39190211, "link": "https://stackoverflow.com/questions/39190211/how-to-return-a-tuple-in-haskell", "title": "How to return a tuple in Haskell", "body": "<pre><code>type Record=([Char],[Char],[Char],[Char],[Char])\n\ncreateAccount::IO()-&gt;Record\ncreateAccount=do\n    putStrLn \"Enter First Name\"\n    fname&lt;-getLine\n    putStrLn \"Enter Last Name\"\n    lname&lt;-getLine\n    putStrLn \"Enter State\"\n    state&lt;-getLine\n    putStrLn \"Enter City\"\n    city&lt;-getLine\n    putStrLn \"Enter House No.\"\n    hnum&lt;-getLine\n    let hnumInt = read hnum :: Integer\n    putStrLn \"Enter Contact\"\n    contact&lt;-getLine\n    return (fname,lname,state,city,contact)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 2, "creation_date": 1472356801, "post_id": 39187844, "comment_id": 65716850, "body": "What&#39;s the result of <code>s []</code>?"}, {"owner": {"reputation": 555, "user_id": 5973371, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/57038c49f6bb5b7ab57269bc1f00ab93?s=128&d=identicon&r=PG", "display_name": "Zubin Kadva", "link": "https://stackoverflow.com/users/5973371/zubin-kadva"}, "reply_to_user": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 0, "creation_date": 1472356910, "post_id": 39187844, "comment_id": 65716864, "body": "<code>s [] = 0</code> I guess. But it gives me an error if I do this"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1472371786, "post_id": 39187844, "comment_id": 65719146, "body": "Using <code>-Wall</code> will detect this error at compile time instead of runtime."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1472371865, "post_id": 39187844, "comment_id": 65719170, "body": "@ZubinKadva How can Haskell make <code>s [] = 0</code> when the code does not specify what to do in that case?"}], "answers": [{"comments": [{"owner": {"reputation": 555, "user_id": 5973371, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/57038c49f6bb5b7ab57269bc1f00ab93?s=128&d=identicon&r=PG", "display_name": "Zubin Kadva", "link": "https://stackoverflow.com/users/5973371/zubin-kadva"}, "edited": false, "score": 0, "creation_date": 1472357223, "post_id": 39187898, "comment_id": 65716896, "body": "Well, it fixes the non-exhaustive error. Can you tell me what is the type for <code>s</code>? Sorry, but I am new to Haskell"}, {"owner": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "reply_to_user": {"reputation": 555, "user_id": 5973371, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/57038c49f6bb5b7ab57269bc1f00ab93?s=128&d=identicon&r=PG", "display_name": "Zubin Kadva", "link": "https://stackoverflow.com/users/5973371/zubin-kadva"}, "edited": false, "score": 1, "creation_date": 1472357278, "post_id": 39187898, "comment_id": 65716905, "body": "@ZubinKadva if you use GHCi, you can type <code>:type s</code> to find out the type. Here, the type is <code>IO ()</code>."}, {"owner": {"reputation": 555, "user_id": 5973371, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/57038c49f6bb5b7ab57269bc1f00ab93?s=128&d=identicon&r=PG", "display_name": "Zubin Kadva", "link": "https://stackoverflow.com/users/5973371/zubin-kadva"}, "edited": false, "score": 0, "creation_date": 1472357539, "post_id": 39187898, "comment_id": 65716932, "body": "Thanks, but entering the following code <code>s :: Show a =&gt; [a] -&gt; IO b</code> gives me an error"}, {"owner": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "reply_to_user": {"reputation": 555, "user_id": 5973371, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/57038c49f6bb5b7ab57269bc1f00ab93?s=128&d=identicon&r=PG", "display_name": "Zubin Kadva", "link": "https://stackoverflow.com/users/5973371/zubin-kadva"}, "edited": false, "score": 1, "creation_date": 1472357649, "post_id": 39187898, "comment_id": 65716953, "body": "Oh right, lack of attention on my part, that is the correct type."}], "tags": [], "owner": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "is_accepted": true, "score": 3, "last_activity_date": 1472357071, "creation_date": 1472357071, "answer_id": 39187898, "question_id": 39187844, "link": "https://stackoverflow.com/questions/39187844/non-exhaustive-patterns-in-function-s/39187898#39187898", "title": "Non-exhaustive patterns in function s", "body": "<p>Just applying <code>s</code> definition over the given data:</p>\n\n<pre><code>s [5, 4, 1, 1]\nprint 5 &gt;&gt; print 4 &gt;&gt; s [1, 1]\nprint 5 &gt;&gt; print 4 &gt;&gt; print 1 &gt;&gt; print 1 &gt;&gt; s []\n-- error: s [] is not defined\n</code></pre>\n\n<p>You just need to add the case in the patterns:</p>\n\n<pre><code>s [] = return ()\ns (x1:x2:xs) = ...\n</code></pre>\n\n<p>Note this still fails for <code>s [5]</code>.</p>\n"}], "owner": {"reputation": 555, "user_id": 5973371, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/57038c49f6bb5b7ab57269bc1f00ab93?s=128&d=identicon&r=PG", "display_name": "Zubin Kadva", "link": "https://stackoverflow.com/users/5973371/zubin-kadva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 0, "accepted_answer_id": 39187898, "answer_count": 1, "score": -1, "last_activity_date": 1472357071, "creation_date": 1472356241, "question_id": 39187844, "link": "https://stackoverflow.com/questions/39187844/non-exhaustive-patterns-in-function-s", "title": "Non-exhaustive patterns in function s", "body": "<p>I have a simple program as:</p>\n\n<pre><code>s (x1:x2:xs) = print(x1) &gt;&gt; print(x2) &gt;&gt; s xs\nmain = s [5,4,1,1]\n</code></pre>\n\n<p>But it produces the following error:</p>\n\n<pre><code>Non-exhaustive patterns in function s\n</code></pre>\n\n<p>I have tried a lot to fix this error. Need some help here.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1472337276, "post_id": 39186288, "comment_id": 65714034, "body": "The old signature was a lie for years. The new signature is actually more general, encompassing both lifted types (kind <code>*</code>) and unlifted ones (previously kind <code>#</code>; now broken down into more kinds)."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 8, "creation_date": 1472339767, "post_id": 39186288, "comment_id": 65714514, "body": "While not an exact duplicate (I think this question could benefit from a more up to date answer), <a href=\"http://stackoverflow.com/a/35320729/465378\">this answer</a> includes some information that can help to explain things."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1472356620, "post_id": 39186288, "comment_id": 65716823, "body": "@sevo what language extension turns this on? I knew about it from some other discussion, but can&#39;t trigger it. I just get <code>($) :: (a -&gt; b) -&gt; a -&gt; b</code>"}, {"owner": {"reputation": 1020, "user_id": 500060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c122862374667042520953c02df7d7ed?s=128&d=identicon&r=PG", "display_name": "glguy", "link": "https://stackoverflow.com/users/500060/glguy"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 2, "creation_date": 1472357669, "post_id": 39186288, "comment_id": 65716958, "body": "@Michael The difference is  between <code>:info</code> and <code>:type</code> with <code>:info</code> provide a lot more information"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 1020, "user_id": 500060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c122862374667042520953c02df7d7ed?s=128&d=identicon&r=PG", "display_name": "glguy", "link": "https://stackoverflow.com/users/500060/glguy"}, "edited": false, "score": 0, "creation_date": 1472361995, "post_id": 39186288, "comment_id": 65717474, "body": "@glguy ah, of course, thanks!"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1472468199, "post_id": 39186288, "comment_id": 65748094, "body": "@AlexisKing and here I&#39;ve wondered why I got several upvotes on my old answer. Will update at the end of the week."}], "answers": [{"tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 6, "last_activity_date": 1472401924, "last_edit_date": 1495540426, "creation_date": 1472400895, "answer_id": 39193282, "question_id": 39186288, "link": "https://stackoverflow.com/questions/39186288/why-dollar-operator-is-so-complex-in-ghc-8-0-1/39193282#39193282", "title": "Why dollar ($) operator is so complex in GHC 8.0.1?", "body": "<p>Before 8.0, there was a special case in the typechecker to make applications of <code>$</code> to <em>unlifted</em> kinds work. This also meant that you couldn't define your own functions which could work with both lifted and unlifted kinds. Now that this so-called <a href=\"https://stackoverflow.com/questions/35318562/what-is-levity-polymorphism/35320729#35320729\">Levity Polymorphsim</a> ('levity' refers to 'the degree to which something is lifted' - or 'lifted-ness', because of 'unlifted' and 'lifted' types) is built into the typechecker, this is possible:</p>\n\n<pre><code>import GHC.Exts (TYPE, RuntimeRep(..)) \nimport Data.Kind (type (*))\n\nap :: forall (a :: *) (b :: *) . (a -&gt; b) -&gt; (a -&gt; b) \nap f x = f x \n\nap_LP :: forall (a :: *) (b :: TYPE r) . (a -&gt; b) -&gt; (a -&gt; b) \nap_LP f x = f x\n</code></pre>\n\n<p>and indeed the <code>$</code> function is now defined identically to <code>ap_LP</code>, with no special case needed in the typechecker to make <code>$</code> work with functions returning unlifted types (there is a still a special case in the typechecker to make polymorphic application, i.e. <code>runST $ ...</code> work, but this is unrelated to levity polymorphism). This is essentially the reason for the added complexity - there are fewer 'hacks' in the type system now, and users of GHC can take advantage of levity polymorphism just by giving a function the appropriate type (note that levity-polymorphic types are never inferred, as far as I can tell). Before levity polymorphism, if you wanted to write a polymorphic function which could possible work on both lifted and unlifted kinds, you were obligated to write two identical copies of the function with different type signatures. </p>\n\n<p>The new type differs from the old one in that the new type is strictly more general than the old one:</p>\n\n<pre><code>-- ok \nap' :: forall (a :: *) (b :: *) . (a -&gt; b) -&gt; (a -&gt; b) \nap' = ap_LP \n\n-- type error: \n--    * Couldn't match a lifted type with an unlifted type\nap_LP' :: forall (a :: *) (b :: TYPE r) . (a -&gt; b) -&gt; (a -&gt; b) \nap_LP' = ap \n</code></pre>\n\n<p>In other words, every <code>b</code> which 'fit' the old signature must (by definition) fit the new type signature (and so this change is perfectly backwards-compatible!).</p>\n\n<hr>\n\n<p>Also note that the following is <em>not</em> possible:</p>\n\n<pre><code>ap'' :: forall (a :: TYPE r) (b :: *) . (a -&gt; b) -&gt; (a -&gt; b)\nap'' f x = f x \n</code></pre>\n\n<p>The error produced is </p>\n\n<pre><code>A representation-polymorphic type is not allowed here:\n  Type: a\n  Kind: TYPE r\nIn the type of binder `x'\n</code></pre>\n\n<p>and SPJ explains the reason for the restriction <a href=\"https://ghc.haskell.org/trac/ghc/ticket/8739#comment:6\" rel=\"nofollow noreferrer\">here</a>:</p>\n\n<blockquote>\n  <p>It's absolutely right that the second argument to ($) must not have an\n  unboxed kind. Because the code for ($) must move that argument around\n  (pass to the function), so it must know its width, pointerhood ect.</p>\n  \n  <p>But actually it would be ok for the result of the call (f $ x) to be\n  unboxed, because the code for ($) doesn't mess with the result; it\n  just tail-calls f.</p>\n</blockquote>\n\n<p>This is to say that not every levity-polymorphic type has a valid inhabitant - and this relates to the operational distinction between unboxed and boxed types, which can only be treated uniformly in certain cases, and the typechecker makes sure of it.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 476, "favorite_count": 7, "accepted_answer_id": 39193282, "answer_count": 1, "score": 22, "last_activity_date": 1472401924, "creation_date": 1472336349, "question_id": 39186288, "link": "https://stackoverflow.com/questions/39186288/why-dollar-operator-is-so-complex-in-ghc-8-0-1", "title": "Why dollar ($) operator is so complex in GHC 8.0.1?", "body": "<pre><code>Prelude&gt; :i ($)\n($) ::\n  forall (r :: GHC.Types.RuntimeRep) a (b :: TYPE r).\n  (a -&gt; b) -&gt; a -&gt; b\n        -- Defined in \u2018GHC.Base\u2019\ninfixr 0 $\n</code></pre>\n\n<p>How is it different from <code>(a -&gt; b) -&gt; a -&gt; b</code>? Is there any <code>b</code> that does not fit the new type signature?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 7, "last_activity_date": 1472332973, "last_edit_date": 1472332973, "creation_date": 1472332669, "answer_id": 39185836, "question_id": 39185576, "link": "https://stackoverflow.com/questions/39185576/type-applications-and-constraint-kinds/39185836#39185836", "title": "type applications and constraint kinds", "body": "<p>If you have <code>TypeApplications</code> enabled, you should enable <code>AllowAmbiguousTypes</code> too. If you do so, the error goes away. </p>\n\n<p>The <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#ambiguous-types-and-the-ambiguity-check\">ambiguity check</a> rejects definitions <code>t</code> such that no <code>t :: type</code> annotation could ever typecheck. For example:</p>\n\n<pre><code>test1 :: Show a =&gt; Int\ntest1 = 0\n</code></pre>\n\n<p>If we try to use <code>test1</code> elsewhere in our program, we find that there's no way to resolve the <code>Show a</code> constraint by way of <code>::</code> annotation. Therefore the ambiguity check rejects the definition itself. </p>\n\n<p>Of course, with type applications the ambiguity check becomes meaningless (arguably, it should be turned off by default in this case), since <code>test1 @type</code> is fine and completely determined whenever there is a <code>Show type</code> instance available. </p>\n\n<p>Note that this is not the same as the famous <code>show . read</code> ambiguity. That still produces an error, with <code>AllowAmbiguousTypes</code> too:</p>\n\n<pre><code>test2 = show . read \n-- \"ambiguous type variable prevents the constraint from being solved\"\n</code></pre>\n\n<p>Operationally, values with <code>c =&gt; t</code> types are just functions from <code>c</code>-typed instances to <code>t</code>. Just defining <code>test1</code> is fine, since we can always define a constant function. However, in <code>show . read</code> we need to supply instances as argument (or else there's no code to be run), and there's no way to resolve them. Using <code>test1</code> without a type application would be similarly ambiguous.  </p>\n"}], "owner": {"reputation": 148, "user_id": 6765537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de81569281aa0cff6985a18e9e291168?s=128&d=identicon&r=PG&f=1", "display_name": "xuh", "link": "https://stackoverflow.com/users/6765537/xuh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 369, "favorite_count": 0, "accepted_answer_id": 39185836, "answer_count": 1, "score": 7, "last_activity_date": 1472332973, "creation_date": 1472330577, "question_id": 39185576, "link": "https://stackoverflow.com/questions/39185576/type-applications-and-constraint-kinds", "title": "type applications and constraint kinds", "body": "<p>(I'm not entirely familiar with the inner workings of Haskell's constraint solver so this could likely be a rookie question.)</p>\n\n<p>When trying to use type application on GHC 8.0.1, as shown in the following sample code</p>\n\n<pre><code>{-# LANGUAGE KindSignatures, RankNTypes, ConstraintKinds, ScopedTypeVariables, TypeApplications #-}\nmodule Test where\n\nimport Data.Constraint\n\ntest0 :: forall (b :: *) . (forall a . a -&gt; Bool) -&gt; b -&gt; Bool\ntest0 g = g @b\n\ntest1 :: forall (c :: * -&gt; Constraint) (b :: *) . (c b) =&gt; (forall a . c a =&gt; a -&gt; Bool) -&gt; b -&gt; Bool\ntest1 g = g @b\n</code></pre>\n\n<p>it gives me the following errors</p>\n\n<pre><code>\u2022 Could not deduce: c0 b\n  from the context: c b\n    bound by the type signature for:\n               test1 :: c b =&gt; (forall a. c a =&gt; a -&gt; Bool) -&gt; b -&gt; Bool\n    at Test.hs:9:10-101\n\u2022 In the ambiguity check for \u2018test1\u2019\n  To defer the ambiguity check to use sites, enable AllowAmbiguousTypes\n  In the type signature:\n    test1 :: forall (c :: * -&gt; Constraint) (b :: *).\n             (c b) =&gt; (forall a. c a =&gt; a -&gt; Bool) -&gt; b -&gt; Bool\n</code></pre>\n\n<p>and</p>\n\n<pre><code>\u2022 Could not deduce: c a\n  from the context: c b\n    bound by the type signature for:\n               test1 :: c b =&gt; (forall a. c a =&gt; a -&gt; Bool) -&gt; b -&gt; Bool\n    at Test.hs:9:10-101\n  or from: c0 a\n    bound by the type signature for:\n               test1 :: c0 a =&gt; a -&gt; Bool\n    at Test.hs:9:10-101\n\u2022 In the ambiguity check for \u2018test1\u2019\n  To defer the ambiguity check to use sites, enable AllowAmbiguousTypes\n  In the type signature:\n    test1 :: forall (c :: * -&gt; Constraint) (b :: *).\n             (c b) =&gt; (forall a. c a =&gt; a -&gt; Bool) -&gt; b -&gt; Bool\n</code></pre>\n\n<p><code>test0</code> works where there is no constraint involved, but <code>test1</code> doesn't.</p>\n"}, {"tags": ["haskell", "haskell-lens"], "answers": [{"tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": true, "score": 4, "last_activity_date": 1472386361, "creation_date": 1472386361, "answer_id": 39191137, "question_id": 39184607, "link": "https://stackoverflow.com/questions/39184607/when-should-i-use-monadstate-lens-combinators/39191137#39191137", "title": "When should I use MonadState lens combinators?", "body": "<p>I recommend you to read this excellent blog post about using lens within <code>MonadState</code>. It gives you examples of how awesome Haskell could be.</p>\n\n<p><a href=\"http://www.haskellforall.com/2013/05/program-imperatively-using-haskell.html\" rel=\"nofollow\">http://www.haskellforall.com/2013/05/program-imperatively-using-haskell.html</a></p>\n\n<p>Regarding your question about difference between <code>assign</code> and <code>set</code>: <code>assign</code> is just a version of <code>set</code> that operates inside <code>MonadState</code>. That's it. You can observe this fact through implementation.</p>\n\n<p>Let me give some examples.</p>\n\n<p>You can use <code>set</code> to just set (sorry for repetition) some <em>field</em> of some <em>object</em>:</p>\n\n<pre><code>ghci&gt; set _2 42 ([0.1, 0.2], 3)\n([0.1,0.2],42)\n</code></pre>\n\n<p>If you want to use <code>assign</code> you need to call this function inside some <code>State</code> context. For example consider next simple function:</p>\n\n<pre><code>assignMe :: Int -&gt; StateT ([Double], Int) IO ()\nassignMe x = do\n    before &lt;- get\n    liftIO $ putStrLn $ \"before assignment: \" ++ show before\n    assign _2 x\n    after &lt;- get\n    liftIO $ putStrLn $ \"after assignment: \" ++ show after\n</code></pre>\n\n<p>If you now call this function in ghci you can observe result of its execution:</p>\n\n<pre><code>ghci&gt; execStateT (assignMe 42) ([0.1,0.2], 3)\nbefore assignment: ([0.1,0.2],3)\nafter assignment: ([0.1,0.2],42)\n([0.1,0.2],42)\n</code></pre>\n\n<p>That's it. <code>assign</code> just behaves like <code>set</code> except it applies lens to <em>state</em>.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 293, "favorite_count": 0, "accepted_answer_id": 39191137, "answer_count": 1, "score": 4, "last_activity_date": 1472386361, "creation_date": 1472323760, "question_id": 39184607, "link": "https://stackoverflow.com/questions/39184607/when-should-i-use-monadstate-lens-combinators", "title": "When should I use MonadState lens combinators?", "body": "<p>I understand that a <code>MonadState s m</code> gives me ability to get and update an <code>s</code>.</p>\n\n<p>I do not however understand how this state is related to the state used in lens combinators like <a href=\"https://hackage.haskell.org/package/lens-4.14/docs/src/Control.Lens.Setter.html#assign\" rel=\"nofollow\">assign</a>. Especially when lens can operate on multiple targets. Also, there are simpler functions like <a href=\"https://hackage.haskell.org/package/lens-4.14/docs/src/Control.Lens.Setter.html#set\" rel=\"nofollow\">set</a> that do not require state.</p>\n\n<p>What are use cases for each of those similar combinators?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1472326866, "last_edit_date": 1495541697, "creation_date": 1472326866, "answer_id": 39185059, "question_id": 39184052, "link": "https://stackoverflow.com/questions/39184052/why-isnt-this-incorrect-indentation-in-haskell/39185059#39185059", "title": "why isn&#39;t this incorrect indentation in haskell?", "body": "<p>It compiles because there's no block there to consider.</p>\n\n<p>Indentation only matters after <code>where</code>, <code>let</code>, <code>do</code>, <code>case of</code>. \nThese keywords start a block of things, and it is important to understand whether a line continues the previous entry, starts a new entry, or ends the block.</p>\n\n<pre><code>case f 5 of\n   A -&gt; foo\n      32         -- continues the previous entry\n   B -&gt; 12       -- starts a new entry\n+ bar 43         -- ends the case\n</code></pre>\n\n<p>After <code>=</code> we do not need to split a block into entries: there's only a single expression. Hence no <a href=\"https://stackoverflow.com/a/33010779/3234959\">indentation rules</a> apply.</p>\n"}, {"tags": [], "owner": {"reputation": 1020, "user_id": 500060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c122862374667042520953c02df7d7ed?s=128&d=identicon&r=PG", "display_name": "glguy", "link": "https://stackoverflow.com/users/500060/glguy"}, "is_accepted": false, "score": 1, "last_activity_date": 1472349687, "creation_date": 1472349687, "answer_id": 39187383, "question_id": 39184052, "link": "https://stackoverflow.com/questions/39184052/why-isnt-this-incorrect-indentation-in-haskell/39187383#39187383", "title": "why isn&#39;t this incorrect indentation in haskell?", "body": "<p>This compiles because the definition of <code>x</code> was all to the right of the beginning of <code>x</code>. It's not important where each line starts as long as those lines are indented to the right of <code>x</code>.</p>\n"}], "owner": {"reputation": 545, "user_id": 2140732, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/68de07a198b917b05b0274f8bed7f963?s=128&d=identicon&r=PG", "display_name": "madhukar93", "link": "https://stackoverflow.com/users/2140732/madhukar93"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 39185059, "answer_count": 2, "score": 0, "last_activity_date": 1472349687, "creation_date": 1472319996, "question_id": 39184052, "link": "https://stackoverflow.com/questions/39184052/why-isnt-this-incorrect-indentation-in-haskell", "title": "why isn&#39;t this incorrect indentation in haskell?", "body": "<p>Why doesn't line 5 contain an indentation error. I expected to get a parse error on compilation. I expected that the <code>+</code> on line 5 would have to be aligned under the <code>*</code> in line 4.</p>\n\n<pre><code>module Learn where\n\nx = 10\n  * 5\n + y  -- why isn't this incorrect indentation\n\nmyResult = x * 5\n\ny = 10\n</code></pre>\n"}, {"tags": ["haskell", "types", "functional-programming", "type-conversion"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1472317964, "post_id": 39183638, "comment_id": 65708824, "body": "There is no magic happening here - your function is simply wrong (not type correct), and the typechecker is perfectly right to reject it. Since the compiler already told you precisely why the program is incorrect, have you tried fixing the things it tells you are wrong? (Have you read the error?) At the very least, <code>StateM $ \\s -&gt; .. `bind_sm` ..</code> means that <code>StateM</code> should have type <code>s -&gt; StateM m0 x0 (StateM m1 x1 (a,s))</code> which it clearly does not."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1472320647, "post_id": 39183733, "comment_id": 65709562, "body": "Are the errors related to the code above, or to the users. The latter is understandable, since the type signature had to be changed."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 2, "creation_date": 1472338453, "post_id": 39183733, "comment_id": 65714279, "body": "@UnchartedWaters, you are not being very helpful to your own cause. The code @chi showed you does fix the problem with <code>result_sm</code> as demonstrated here: <a href=\"http://lpaste.net/180892\" rel=\"nofollow noreferrer\">lpaste.net/180892</a> You have other problems with <code>bind_sm</code> and other areas, but this is a fix for your first error."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1472317951, "creation_date": 1472317951, "answer_id": 39183733, "question_id": 39183638, "link": "https://stackoverflow.com/questions/39183638/why-am-i-getting-a-type-mismatch-error/39183733#39183733", "title": "Why am I getting a type mismatch error?", "body": "<pre><code>result_sm v = StateM (\\s -&gt; result_s (v, s))\n</code></pre>\n\n<p>Looks wrong to me. The function</p>\n\n<pre><code>\\s -&gt; result_s (v, s)\n</code></pre>\n\n<p>has type</p>\n\n<pre><code>s -&gt; State s (a,s)\n</code></pre>\n\n<p>while <code>StateM</code> expects</p>\n\n<pre><code>s -&gt; m (a,s)\n</code></pre>\n\n<p>for any arbitrary <code>m</code>, not just <code>m ~ State s</code>.</p>\n\n<p>Are you sure you don't want something like:</p>\n\n<pre><code>result_sm :: (Monad m) =&gt; a -&gt; StateM m s a\nresult_sm v = StateM (\\s -&gt; return (v, s))\n</code></pre>\n\n<p>(or an applicative variant)?</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6376715"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1472319090, "creation_date": 1472317323, "last_edit_date": 1472319090, "question_id": 39183638, "link": "https://stackoverflow.com/questions/39183638/why-am-i-getting-a-type-mismatch-error", "title": "Why am I getting a type mismatch error?", "body": "<p>Here is my code.</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE FlexibleInstances #-}\n\nmodule StateParser where\nimport Control.Monad\nimport Control.Applicative\n\nnewtype State s a = State {compute :: s -&gt; (a, s)}\n\nnewtype StateM m s a = StateM {compute_M :: s -&gt; m (a, s)}\n\nresult_s :: a -&gt; State s a\nresult_s v = State (\\s -&gt; (v ,s))\n\nbind_s :: State s a -&gt; (a -&gt; State s b) -&gt; State s b\nbind_s st f = State $ \\s -&gt; (\\(v, s') -&gt; compute (f v) s') (compute st s)\n\nresult_sm :: (Functor m) =&gt; a -&gt; StateM m s a\nresult_sm v = StateM (\\s -&gt; result_s (v, s))\n\nbind_sm :: (Functor m) =&gt; StateM m s a -&gt; (a -&gt; StateM m s b) -&gt; StateM m s b\nbind_sm stm f = StateM $ \\s -&gt; (tmp s `bind_sm` id)\n  where\n    tmp s = fmap (\\(v, s') -&gt; compute_M (f v) s') (compute_M stm s)\n\ninstance Functor (State s) where\n  fmap f st = st &gt;&gt;= (pure . f)\n\ninstance Applicative (State s) where\n  pure = result_s\n  p &lt;*&gt; q = p &gt;&gt;= \\f -&gt;\n            q &gt;&gt;= (pure . f)\n\ninstance Monad (State s) where\n  --Explicit return definition only required for code required to be compatible\n  --with GHC versions prior to 7.10. The default implementation for all GHC\n  --versions from 7.10 is\n  return = pure\n  (&gt;&gt;=)  = bind_s\n\ninstance Functor f =&gt; Functor (StateM f s) where\n  fmap f stm = stm `bind_sm` (result_sm . f)\n\ninstance Applicative f =&gt; Applicative (StateM f s) where\n  pure = result_sm\n  p &lt;*&gt; q = p `bind_sm` \\f -&gt;\n            q `bind_sm` (pure . f)\n\ninstance Monad m =&gt; Monad (StateM m s) where\n  return = pure\n  (&gt;&gt;=)  = bind_sm\n</code></pre>\n\n<p>When compiling, I get 2 type mismatch errors:</p>\n\n<pre><code>StateParser.hs:43:29\n    Couldn't match type `m' with `State s1'\n      `m' is a rigid type variable bound by\n          the type signature for result_sm :: Functor m =&gt; a -&gt; StateM m s a\n          at StateParser.hs:42:14\n    Expected type: m (a, s)\n      Actual type: State s1 (a, s)\n    ...\n    In the expression: result_s (v, s)\n    In the first argument of `StateM', namely\n      `(\\ s -&gt; result_s (v, s))'\n\nStateParser.hs:46:33:\n    Couldn't match type `m' with `StateM m0 s0'\n      `m' is a rigid type variable bound by\n          the type signature for\n            bind_sm :: Functor m =&gt;\n                       StateM m s a -&gt; (a -&gt; StateM m s b) -&gt; StateM m s b\n          at StateParser.hs:45:12\n    Expected type: StateM m0 s0 (m (b, s))\n      Actual type: m (m (b, s))\n    ...\n    In the first argument of `bind_sm', namely `tmp s'\n    In the expression: (tmp s `bind_sm` id)\n</code></pre>\n\n<p>However, I have very clearly defined instances of the <code>Functor</code> typeclass for the type constructors <code>State s</code> and <code>StateM f s</code>, which should allow them to match with the type variable <code>m</code>, bound by the <code>Functor</code> typeclass in <code>bind_sm</code> and <code>result_sm</code>.</p>\n\n<p>There is probably some aspect of Haskell's type inference procedures of which I am unaware. Will someone enlighten me?</p>\n"}, {"tags": ["haskell", "haskell-pipes", "hspec"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1472318616, "post_id": 39182947, "comment_id": 65709005, "body": "Convert your pipe to a producer or an effect and use <a href=\"https://hackage.haskell.org/package/pipes-4.2.0/docs/Pipes-Prelude.html#v:toListM-39-\" rel=\"nofollow noreferrer\">toListM</a> or simply <code>runEffect</code> to materialize the values. Obviously you must decide how to create and supply test data to the pipe."}, {"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1472325104, "post_id": 39182947, "comment_id": 65710885, "body": "<code>runEffect</code> will just give me an <code>m r</code> which in this case is <code>IO ()</code>. Not sure how that&#39;s supposed to help?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1472398418, "post_id": 39182947, "comment_id": 65726296, "body": "Not <code>runEffect classify</code> but <code>runEffect (giveDataToClassify classify)</code> - like I said, your pipe takes an input and you must decide <i>what</i> the input is, simply by combining your pipe in the appropriate appropriate manner with a pipe which creates output without requiring input (I think in <code>pipes</code> this is a <code>Producer</code>). For example, does <code>toListM $ mapM_ yield [ Person &quot;Bob&quot; 10, Person &quot;June&quot; 20 ] &gt;-&gt; classify</code> do what you want? Note the type of <code>\\xs -&gt; toListM $ mapM_ yield xs &gt;-&gt; classify</code> is <code>[Person] -&gt; IO [(Person, Classification)]</code> which seems to me a form compatible with HSpec."}, {"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1472482315, "post_id": 39182947, "comment_id": 65757181, "body": "I understand that I need to feed data to the pipe. My issue is that the <code>runEffect</code> call is in the <code>IO</code> monad, which can&#39;t evaluate to the <code>Expectation</code> required by hspec&#39;s <code>it</code>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1472486448, "post_id": 39182947, "comment_id": 65759705, "body": "Looking at the <a href=\"https://hackage.haskell.org/package/hspec-2.2.3/docs/Test-Hspec.html\" rel=\"nofollow noreferrer\">type of <code>it</code></a>, it takes an <code>Example a =&gt; a</code> argument, and you have an instance for <code>Example Expectation</code> (i.e. <code>Example (IO ())</code>), whose semantics are throwing a <code>HUnitFailure</code> exception denotes failure of the test and throwing a <code>Result</code> exception (seems to?) denote success of the test. Which (almost) fits the bill. I think it strange that there is no <code>Example a =&gt; Example (IO a)</code> instance, or even <code>Example (IO Result)</code> - it seems these could be useful to you. Perhaps you should try writing them yourself?"}, {"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1472491633, "post_id": 39182947, "comment_id": 65762471, "body": "I&#39;ll give it a go. Much appreciated."}], "answers": [{"comments": [{"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "edited": false, "score": 0, "creation_date": 1472327405, "post_id": 39183206, "comment_id": 65711502, "body": "My code isn&#39;t doing anything of the sort with IO like that (actually DB calls etc). The concept of IO in this question is merely for demonstration purposes and not the intent of the question at all. I want to know if &amp; how I can test my Pipe code with HSpec."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 1, "last_activity_date": 1472326354, "last_edit_date": 1472326354, "creation_date": 1472314598, "answer_id": 39183206, "question_id": 39182947, "link": "https://stackoverflow.com/questions/39182947/haskell-pipes-and-testing-with-hspec/39183206#39183206", "title": "Haskell Pipes and testing with HSpec", "body": "<p>You could use the functions of the <a href=\"http://hackage.haskell.org/package/temporary-1.2.0.4\" rel=\"nofollow\"><code>temporary</code></a> package to create temporary files with the expected data, and then test that the data is read correctly by the pipe.</p>\n\n<p>Incidentally, your <code>Pipe</code> is using <code>readFile</code> that performs lazy I/O. Lazy I/O and streaming libraries like pipes don't mix very well, in fact the latter exist mainly as an alternative to the former!</p>\n\n<p>Perhaps you should instead use functions which perform strict I/O, like <code>openFile</code> and <code>getLine</code>.</p>\n\n<p>One annoyance with strict I/O is that it forces you to consider resource allocation more carefully. How to ensure that each file handle is closed at the end, or in case of error? One possible way to achieve this is to work in the <a href=\"http://hackage.haskell.org/package/resourcet\" rel=\"nofollow\"><code>ResourceT IO</code></a> monad, instead of directly in <code>IO</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "is_accepted": true, "score": 1, "last_activity_date": 1473324457, "creation_date": 1473324457, "answer_id": 39386454, "question_id": 39182947, "link": "https://stackoverflow.com/questions/39182947/haskell-pipes-and-testing-with-hspec/39386454#39386454", "title": "Haskell Pipes and testing with HSpec", "body": "<p>The trick is to use <code>toListM</code> from Pipes <code>ListT</code> monad transformer.</p>\n\n<pre><code>import Pipes\nimport qualified Pipes.Prelude as P\nimport Test.Hspec\n\ndata Person = Person String Int | Unknown deriving (Show, Eq)\ndata Classification = Friend | Foe | Undecided deriving (Show, Eq)\n\nclassify :: Pipe Person (Person, Classification) IO ()\nclassify = do\n  p@(Person name _) &lt;- await\n  case name of \n    \"Alex\" -&gt; yield (p, Friend)\n    \"Bob\" -&gt; yield (p, Foe)\n    _ -&gt; yield (p, Undecided)\n</code></pre>\n\n<p>The test, using the ListT transformer to convert the pipe to a ListT and asserting using HSpec:</p>\n\n<pre><code>main = hspec $ do\n  describe \"classify\" $ do\n    it \"correctly finds friends\" $ do\n      [(p, cl)] &lt;- P.toListM $ each [Person \"Alex\" 31] &gt;-&gt; classify\n      p `shouldBe` (Person \"Alex\" 31)\n      cl `shouldBe` Friend\n</code></pre>\n\n<p>Note, you don't have to use <code>each</code>, this could be a simple producer with a call to <code>yield</code>.</p>\n"}], "owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 227, "favorite_count": 1, "accepted_answer_id": 39386454, "answer_count": 2, "score": 1, "last_activity_date": 1473324457, "creation_date": 1472312960, "last_edit_date": 1472374828, "question_id": 39182947, "link": "https://stackoverflow.com/questions/39182947/haskell-pipes-and-testing-with-hspec", "title": "Haskell Pipes and testing with HSpec", "body": "<p>I have written a program for a project that uses Pipes, which I love! I'm struggling to unit test my code however. </p>\n\n<p>I have a series of functions of type <code>Pipe In Out IO ()</code> (for example) that I wish to test with HSpec. How can I go about this? </p>\n\n<p>For example, suppose I have this domain:</p>\n\n<pre><code>data Person = Person String Int | Unknown deriving (Show, Eq)\ndata Classification = Friend | Foe | Undecided deriving Show\n</code></pre>\n\n<p>and this Pipe:</p>\n\n<pre><code>classify :: Pipe Person (Person, Classification) IO ()\nclassify = do\n    p@(Person name _) &lt;- await\n    case name of \n      \"Alex\" -&gt; yield (p, Friend)\n      \"Bob\" -&gt; yield (p, Foe)\n      _ -&gt; yield (p, Undecided)\n</code></pre>\n\n<p>I would like to write a spec:</p>\n\n<pre><code>main = hspec $ do\n  describe \"readFileP\" $ \n    it \"yields all the lines of a file\"\n      pendingWith \"How can I test this Pipe? :(\"\n</code></pre>\n"}, {"tags": ["mongodb", "haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 5, "creation_date": 1472309691, "post_id": 39182360, "comment_id": 65706350, "body": "The actual code simply throws exceptions in case of error - I&#39;m guessing that &quot;return Left&quot; is just a typo or a remnant from a time when the return type was different. &quot;return Left&quot; is indeed completely nonsense when working with <code>IO</code> or <code>MonadIO m</code> (I suppose it makes sense if you had e.g. <code>IO (Either a b)</code> ). Furthermore, <code>Either</code> cannot be an instance of <code>MonadIO</code> so you can&#39;t even instantiate <code>m</code> with <code>Either</code>. Although, <code>MonadIO m =&gt; EitherT e m</code> has an instance, but even if you use this instantiation, you will never get <code>Left something</code> from <code>access</code> - it&#39;s type even guarantees this."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 4, "creation_date": 1472310320, "post_id": 39182360, "comment_id": 65706516, "body": "<a href=\"https://hackage.haskell.org/package/mongoDB-1.1.0/docs/Database-MongoDB-Query.html\" rel=\"nofollow noreferrer\">here</a> is an old version in which the return type is <code>m (Either Failure a)</code> - it does really seem like just a case of outdated documentation. (If it&#39;s important to you, you should contact the maintainer)"}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 1, "creation_date": 1472310435, "post_id": 39182360, "comment_id": 65706561, "body": "<a href=\"https://github.com/mongodb-haskell/mongodb/issues\" rel=\"nofollow noreferrer\">Here</a>`s probably a good place to report that - or you could even make a pull request by clicking on the pencil icon <a href=\"https://github.com/mongodb-haskell/mongodb/blob/master/Database/MongoDB/Query.hs\" rel=\"nofollow noreferrer\">here</a> to do the work for him."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 5, "creation_date": 1472313165, "post_id": 39182360, "comment_id": 65707435, "body": "@user2407038 That&#39;s an answer, not a comment!"}, {"owner": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1472574085, "post_id": 39182360, "comment_id": 65802244, "body": "@user2407038 Write this into an answer please so I can accept it :)"}], "answers": [{"tags": [], "owner": {"reputation": 677, "user_id": 662716, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7e09655fd68e038c553fd501c69a6161?s=128&d=identicon&r=PG", "display_name": "Victor Denisov", "link": "https://stackoverflow.com/users/662716/victor-denisov"}, "is_accepted": true, "score": 1, "last_activity_date": 1474154142, "creation_date": 1474154142, "answer_id": 39552618, "question_id": 39182360, "link": "https://stackoverflow.com/questions/39182360/for-this-function-what-does-return-left-mean-in-the-case-of-io/39552618#39552618", "title": "For this function, what does &quot;return Left&quot; mean in the case of IO?", "body": "<p>Yes. It's a type. Return Left comes from an older version. If any errors happens then it just throws IO exceptions. We'll need to fix it.\nI filed a bug for it. <a href=\"https://github.com/mongodb-haskell/mongodb/issues/67\" rel=\"nofollow\">https://github.com/mongodb-haskell/mongodb/issues/67</a></p>\n"}], "owner": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 39552618, "answer_count": 1, "score": 2, "last_activity_date": 1474154142, "creation_date": 1472309021, "question_id": 39182360, "link": "https://stackoverflow.com/questions/39182360/for-this-function-what-does-return-left-mean-in-the-case-of-io", "title": "For this function, what does &quot;return Left&quot; mean in the case of IO?", "body": "<p>In <a href=\"https://hackage.haskell.org/package/mongoDB-2.1.1/docs/Database-MongoDB-Query.html\" rel=\"nofollow\">Database.MongoDB.Query</a>, there is this function:</p>\n\n<pre><code>access :: MonadIO m =&gt; Pipe -&gt; AccessMode -&gt; Database -&gt; Action m a -&gt; m a\n</code></pre>\n\n<p>The documentation says this about the function:</p>\n\n<blockquote>\n  <p>Run action against database on server at other end of pipe. Use access mode for any reads and writes. Return Left on connection failure or read/write failure.</p>\n</blockquote>\n\n<ul>\n<li>What does \"return Left\" mean here? I ask because <code>m</code> can be any monad (with a <code>MonadIO</code> instance). For instance, what does \"return Left\" mean if <code>m</code> is just the <code>IO</code> monad?</li>\n<li>Must <code>m</code> be the <code>Either</code> monad for me to be able to detect connection or read/write failure when using the <code>access</code> method?</li>\n</ul>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 461, "user_id": 6026302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b2a57659daba9701e24faec9fa37321?s=128&d=identicon&r=PG&f=1", "display_name": "villou24", "link": "https://stackoverflow.com/users/6026302/villou24"}, "is_accepted": true, "score": 1, "last_activity_date": 1472308392, "creation_date": 1472308392, "answer_id": 39182255, "question_id": 39182135, "link": "https://stackoverflow.com/questions/39182135/adding-an-additional-step-to/39182255#39182255", "title": "Adding an additional step to &quot;&gt;&gt;=&quot;", "body": "<p>You can compose <code>show</code> with the concatenation function like so:</p>\n\n<pre><code>forM_ [1..10] $ \\x -&gt; myFunc1 x 99 &gt;&gt;= putStrLn . (\"the result is: \" ++) . show &gt;&gt; return ()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 7, "last_activity_date": 1472308400, "creation_date": 1472308400, "answer_id": 39182256, "question_id": 39182135, "link": "https://stackoverflow.com/questions/39182135/adding-an-additional-step-to/39182256#39182256", "title": "Adding an additional step to &quot;&gt;&gt;=&quot;", "body": "<p>The first thing that sticks out is that the expression:</p>\n\n<pre><code>(++) \"the result is: \"\n</code></pre>\n\n<p>is not an IO-action - it's just a pure function String -> String, and\nthat's one reason why you code isn't type checking.</p>\n\n<p>To turn it into an IO-action you can compose it with <code>return</code>:</p>\n\n<pre><code>return . ( (++) \"the result is: \" )\n  :: String -&gt; IO String\n</code></pre>\n\n<p>Now you can use it with <code>&gt;&gt;=</code>.</p>\n\n<p>However, that's not where the real problem is...</p>\n\n<p>To prepend \"the result is: \" before the <code>show</code> you have to insert it in the <code>putStrLn</code> call:</p>\n\n<pre><code>... &gt;&gt;= putStrLn . (++ \"the result is: \") . show\n</code></pre>\n\n<p>(Note that there is no need to <code>&gt;&gt; return ()</code> since <code>putStrLn</code> already returns ()).</p>\n\n<p>Honestly, this is a lot simpler using do-notation:</p>\n\n<pre><code>forM_ [1..10] $ \\x -&gt; do\n  s &lt;- myFunc1 x 99\n  putStrLn $ \"the result is: \" ++ show s\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1472316083, "post_id": 39182259, "comment_id": 65708283, "body": "Your answer could be justifiably downvoted because of its lack of explanation and the irrelevance of <code>add</code>."}], "tags": [], "owner": {"reputation": 14006, "user_id": 3798102, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/100002464470905/picture?type=large", "display_name": "pamu", "link": "https://stackoverflow.com/users/3798102/pamu"}, "is_accepted": false, "score": 0, "last_activity_date": 1472308434, "creation_date": 1472308434, "answer_id": 39182259, "question_id": 39182135, "link": "https://stackoverflow.com/questions/39182135/adding-an-additional-step-to/39182259#39182259", "title": "Adding an additional step to &quot;&gt;&gt;=&quot;", "body": "<p>Replace <code>++</code> with <code>add</code></p>\n\n<pre><code>add x y = return (x ++ show (y))\n\n\nforM_ [1..10] $ \\x -&gt; myFunc1 x 99 &gt;&gt;= add \"the result is: \" &gt;&gt;= putStrLn . show &gt;&gt; return ()\n</code></pre>\n\n<p>reason: The return type of <code>++</code> is not <code>IO</code> type</p>\n"}], "owner": {"reputation": 311, "user_id": 6764793, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/718200fbfdd4e6335b8e17aaea7d0745?s=128&d=identicon&r=PG&f=1", "display_name": "darko", "link": "https://stackoverflow.com/users/6764793/darko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 39182255, "answer_count": 3, "score": 0, "last_activity_date": 1472308434, "creation_date": 1472307495, "question_id": 39182135, "link": "https://stackoverflow.com/questions/39182135/adding-an-additional-step-to", "title": "Adding an additional step to &quot;&gt;&gt;=&quot;", "body": "<p>I have this which works fine:</p>\n\n<pre><code>forM_ [1..10] $ \\x -&gt; myFunc1 x 99 &gt;&gt;= putStrLn . show &gt;&gt; return ()\n\nmyFunc1 :: Int -&gt; Int -&gt; IO Bool\nmyFunc1 .....\n</code></pre>\n\n<p>I want to do add an additional string to the output:</p>\n\n<pre><code>   forM_ [1..10] $ \\x -&gt; myFunc1 x 99 &gt;&gt;= (++) \"the result is: \" &gt;&gt;= putStrLn . show &gt;&gt; return ()\n</code></pre>\n\n<p>But that doesn't compile. I've tried different variations but still no success. Your suggestions?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1472307022, "post_id": 39181803, "comment_id": 65705520, "body": "Note: the law of associativity <code>(a+b)+c = a+(b+c)</code> is not true for <code>Double</code> or <code>Float</code>, see for example <code>(0.7 + 0.2)+0.1</code> and <code>0.7 + (0.2 +0.1)</code>."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1472307170, "post_id": 39181803, "comment_id": 65705571, "body": "so you get <code>sum $ map sum [[0.7],[0.2,0.1]]</code> being different from <code>sum $ concat [[0.7],[0.2,0.1]]</code>"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1472307307, "post_id": 39181803, "comment_id": 65705621, "body": "source for the counterexample <a href=\"https://stackoverflow.com/questions/10371857\">stackoverflow.com/questions/10371857</a>"}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 1, "last_activity_date": 1472305361, "creation_date": 1472305361, "answer_id": 39181803, "question_id": 39181607, "link": "https://stackoverflow.com/questions/39181607/why-is-this-expression-equal/39181803#39181803", "title": "Why is this expression equal?", "body": "<p>Imagine we have a list:</p>\n\n<pre><code>myList :: [[Int]]\nmyList = [[1,2],[3,4,5]]\n</code></pre>\n\n<p>Let's apply <code>sum . map sum</code>:</p>\n\n<pre><code>  (sum . map sum) [[1,2],[3,4,5]]\n= sum [sum [1,2], sum [3,4,5]]\n= sum [1+2,3+4+5]\n= 1+2+3+4+5\n</code></pre>\n\n<p>Now let's apply <code>sum . concat</code>:</p>\n\n<pre><code>   (sum . concat) [[1,2],[3,4,5]]\n = sum [1,2,3,4,5]\n = 1+2+3+4+5\n</code></pre>\n\n<p>Hopefully you can see now that, because (a+b)+c = a+(b+c), the order in which we add things does not matter, thus summing the inner lists, then summing the entire list produces the same result as simply summing each value of the inner lists.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 5, "last_activity_date": 1472316083, "last_edit_date": 1472316083, "creation_date": 1472308874, "answer_id": 39182335, "question_id": 39181607, "link": "https://stackoverflow.com/questions/39181607/why-is-this-expression-equal/39182335#39182335", "title": "Why is this expression equal?", "body": "<p>Informally, this is just saying that <strike>because</strike> if addition is associative, it doesn't matter how you group the numbers you are adding. <code>(a + b) + (c + d)</code> is the same as <code>(a + b + c + d)</code>.</p>\n\n<hr>\n\n<p>Formally, we can use equational reasoning and structure induction to prove this for lists of any size. (See the end for quick definitions of these two processes.)</p>\n\n<p>Assuming the following definitions of <code>map</code>, <code>concat</code>, <code>sum</code>, and <code>(.)</code>:</p>\n\n<ol>\n<li><code>map sum [] = []</code></li>\n<li><code>map sum (a:as) = sum a : map sum as</code></li>\n<li><code>concat [] = []</code></li>\n<li><code>concat (a:as) = a ++ concat as</code></li>\n<li><code>sum [] = 0</code></li>\n<li><code>sum (a:as) = a + sum as</code></li>\n<li><code>(f . g) x = f (g x)</code></li>\n</ol>\n\n<p>To make the proof below a little simpler, we'll claim without an explicit proof (but see below) that </p>\n\n<ol start=\"8\">\n<li><code>sum (a ++ b) == sum a + sum b</code></li>\n</ol>\n\n<p>First we establish that the identity is true for empty lists.</p>\n\n<pre><code>(sum . map sum) [] == sum (map sum [])  -- (7)\n                   == sum []            -- (1)\n                   == sum (concat [])   -- (3)\n                   == (sum . concat) [] -- (7)\n</code></pre>\n\n<p>(Note that we don't need definition 5, since an empty list is an empty list.)</p>\n\n<p>Now, add a new definition, for any list <code>as</code> of size <code>k</code>.</p>\n\n<ol start=\"9\">\n<li><code>(sum . map sum) as == (sum . concat) as</code></li>\n</ol>\n\n<p>If (9) is true, we can prove the identity for list of size <code>k+1</code>:</p>\n\n<pre><code>(sum . map sum) (a:as) == sum (map sum (a:as))        -- (7)\n                       == sum (sum a : map sum as)    -- (2)\n                       == sum a + sum (map sum as)    -- (6)\n                       == sum a + (sum . map sum) as  -- (7)\n                       == sum a + (sum . concat) as   -- (9)\n                       == sum a + sum (concat as)     -- (7)\n                       == sum (a ++ concat as)        -- (8)\n                       == sum (concat (a:as))         -- (4)\n                       == (sum . concat) (a:as)       -- (7)\n</code></pre>\n\n<p>By induction, we have proved the <code>sum . map sum == sum . concat</code> for lists of any size.</p>\n\n<hr>\n\n<ul>\n<li><p>Equational reasoning means that we can use an equality like <code>a = b</code> to replace <code>a</code> with <code>b</code> or <code>b</code> with <code>a</code> at any step of our proofs.</p></li>\n<li><p>Structural induction on lists is a bootstrapping process. You assume some property is true for lists of size <code>k</code>, then use that to prove it is true for lists of size <code>k+1</code>. Then, if you can prove it is true for <code>k=0</code>, this implies it is true for all <code>k</code>. For example, if it is true for <code>k=0</code>, then it is true for <code>k=1</code>, which means it is true for <code>k=2</code>, etc.</p></li>\n</ul>\n\n<hr>\n\n<p>Definition 4 assumes a definition of <code>++</code>:</p>\n\n<pre><code>[] ++ bs = bs\n(a:as) ++ bs = a : (as ++ bs)\n</code></pre>\n\n<p>With <code>++</code> defined, we can prove (8):</p>\n\n<p>A base case: a is empty</p>\n\n<pre><code>sum ([] ++ b) == sum b               -- definition of ++\n              == 0 + sum b           -- definition of +\n              == sum [] + sum b      -- definition of sum\n</code></pre>\n\n<p>Assuming <code>sum (a++b)</code> is true for <code>a</code> of length <code>k</code>,</p>\n\n<pre><code>sum ((a:as) ++ bs) == sum (a : (as ++ bs))   -- definition of ++\n                   == a + sum (as ++ bs)     -- definition of sum\n                   == a + sum as + sum bs    -- induction\n                   == sum (a:as) + sum bs    -- definition of sum\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 6012730, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/0a6fde0b572f308893a30aa4795fe08f?s=128&d=identicon&r=PG&f=1", "display_name": "mlhack", "link": "https://stackoverflow.com/users/6012730/mlhack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 39181803, "answer_count": 2, "score": 1, "last_activity_date": 1472316083, "creation_date": 1472304061, "question_id": 39181607, "link": "https://stackoverflow.com/questions/39181607/why-is-this-expression-equal", "title": "Why is this expression equal?", "body": "<p>I'm learning Haskell at the moment and I read a book called \"Thinking Functionally With Haskell\" and I can't really understand why this expression from the first chapter is true: </p>\n\n<blockquote>\n  <p>sum . map sum = sum . concat</p>\n</blockquote>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1472303924, "post_id": 39180630, "comment_id": 65704577, "body": "How are you calling <code>foldTree</code>?"}, {"owner": {"reputation": 9560, "user_id": 2023370, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4840a671d94ce5df0818cce059cab62b?s=128&d=identicon&r=PG&f=1", "display_name": "user2023370", "link": "https://stackoverflow.com/users/2023370/user2023370"}, "edited": false, "score": 0, "creation_date": 1563810965, "post_id": 39180630, "comment_id": 100814807, "body": "One comment I didn&#39;t see below: while a right fold on a list uses a combining function with <code>(a -&gt; b -&gt; b)</code> type; a <i>left</i> fold on a list uses one with <code>(a -&gt; b -&gt; a)</code> type."}], "answers": [{"comments": [{"owner": {"reputation": 409, "user_id": 1897830, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4bb6f01afcee8d6fd59ccb93499732d6?s=128&d=identicon&r=PG", "display_name": "user1897830", "link": "https://stackoverflow.com/users/1897830/user1897830"}, "edited": false, "score": 0, "creation_date": 1472299636, "post_id": 39180884, "comment_id": 65703268, "body": "Unfortunately that doesn&#39;t provide the correct answer either."}, {"owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "reply_to_user": {"reputation": 409, "user_id": 1897830, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4bb6f01afcee8d6fd59ccb93499732d6?s=128&d=identicon&r=PG", "display_name": "user1897830", "link": "https://stackoverflow.com/users/1897830/user1897830"}, "edited": false, "score": 0, "creation_date": 1472300291, "post_id": 39180884, "comment_id": 65703471, "body": "Please give an example where it fails"}], "tags": [], "owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "is_accepted": false, "score": 1, "last_activity_date": 1472299060, "creation_date": 1472299060, "answer_id": 39180884, "question_id": 39180630, "link": "https://stackoverflow.com/questions/39180630/fold-tree-function/39180884#39180884", "title": "Fold Tree Function", "body": "<p>I think you need to combine the middle point before going to the right subtree :</p>\n\n<pre><code>foldTree :: (a -&gt; b -&gt; b) -&gt; b -&gt; BinaryTree a -&gt; b\nfoldTree _ base Leaf = base\nfoldTree fn base (Node left a right) = foldTree fn middlePoint right\n  where leftFold = foldTree fn base left\n        middlePoint = fn a leftFold\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 409, "user_id": 1897830, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4bb6f01afcee8d6fd59ccb93499732d6?s=128&d=identicon&r=PG", "display_name": "user1897830", "link": "https://stackoverflow.com/users/1897830/user1897830"}, "edited": false, "score": 3, "creation_date": 1472300350, "post_id": 39180984, "comment_id": 65703490, "body": "That&#39;s great. However I would like to know how to code it myself. Just as a learning exercise."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 409, "user_id": 1897830, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4bb6f01afcee8d6fd59ccb93499732d6?s=128&d=identicon&r=PG", "display_name": "user1897830", "link": "https://stackoverflow.com/users/1897830/user1897830"}, "edited": false, "score": 0, "creation_date": 1472300688, "post_id": 39180984, "comment_id": 65703583, "body": "See <a href=\"http://stackoverflow.com/documentation/haskell/753/foldable/2556/an-instance-of-foldable-for-a-binary-tree#t=201608271208410494162\">the linked Documentation page</a> for an example. (Also, I added a section to the answer.)"}, {"owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "edited": false, "score": 0, "creation_date": 1472300800, "post_id": 39180984, "comment_id": 65703616, "body": "Isn&#39;t <code>foldl (\\l x -&gt; l ++ [x]) []</code> the identity on lists ? If so it preserves the list structure :)"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "edited": false, "score": 0, "creation_date": 1472300882, "post_id": 39180984, "comment_id": 65703633, "body": "@V.Semeria Yes, but trees are not lists. They contain extra information, which <code>foldl</code>/<code>foldr</code> discard. <code>Foldable</code>&#39;s view of the world reduces everything to a list."}, {"owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "edited": false, "score": 0, "creation_date": 1472301232, "post_id": 39180984, "comment_id": 65703730, "body": "Indeed. To me a foldable object is just something you can convert to a list. Then you use the usual foldr on lists."}, {"owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "edited": false, "score": 1, "creation_date": 1472301680, "post_id": 39180984, "comment_id": 65703874, "body": "Rather, <code>foldr f init t == foldr f init (toList t)</code>. So a fold cannot use more information about <code>t</code> than is contained in its list collapse."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 13, "last_activity_date": 1506553770, "last_edit_date": 1506553770, "creation_date": 1472299735, "answer_id": 39180984, "question_id": 39180630, "link": "https://stackoverflow.com/questions/39180630/fold-tree-function/39180984#39180984", "title": "Fold Tree Function", "body": "<p>GHC is good at folding things. The very structure of your type contains enough information for your desired in-order traversal strategy to be obvious to the machine. To invoke the magic spell, utter the words <em>\"<code>deriving Foldable</code>!\"</em> and GHC will write your function for you.</p>\n\n<pre><code>{-# LANGUAGE DeriveFoldable #-}\ndata BinaryTree a = Leaf\n                  | Node (BinaryTree a) a (BinaryTree a)\n                  deriving Foldable\n</code></pre>\n\n<p>Now we have</p>\n\n<pre><code>foldTree = foldr\n</code></pre>\n\n<p>An interesting corollary here is that you can vary the traversal order by varying the shape of the type.</p>\n\n<hr>\n\n<p>While we're here, a note on your requirements. You want to implement a function, using <code>foldr</code>, which takes a tree apart and puts it back together exactly the same, equivalent to <code>id</code>. <strong>This is not possible</strong>. <code>foldr</code> provides <em>sequential</em> access to the elements of the <code>Foldable</code> structure, erasing information like the precise position of the element within the tree. At best, you can build a list-shaped tree, with elements appearing along the right spine:</p>\n\n<pre><code>toListShapedTree = foldr (Node Leaf) Leaf\n</code></pre>\n\n<p>What you want is a <em>catamorphism</em>:</p>\n\n<pre><code>cata :: (b -&gt; a -&gt; b -&gt; b) -&gt; b -&gt; BinaryTree a -&gt; b\ncata node leaf Leaf = leaf\ncata node leaf (Node l x r) = node (cata node leaf l) x (cata node leaf r)\n</code></pre>\n\n<p>Note the extra parameter to the <code>node</code> argument! This specification gives the folding function access to the arguments of the <code>Node</code> constructor. Unlike <code>Foldable</code>, the type of a structure's catamorphism is specific to that structure. We don't lose information by viewing everything as a list. Now you can write:</p>\n\n<pre><code>cataId = cata Node Leaf\n</code></pre>\n\n<p>If you're dead set on using <code>foldr</code> for this, one strategy could be to take the positional information with you. First <a href=\"https://stackoverflow.com/questions/36474647/haskell-depth-for-each-node-in-binary-tree-using-reader-monad/36480067#36480067\">label each element with its position</a>, then in the fold use that data to reconstruct the tree. Seems like hard work to me.</p>\n"}, {"tags": [], "owner": {"reputation": 409, "user_id": 1897830, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4bb6f01afcee8d6fd59ccb93499732d6?s=128&d=identicon&r=PG", "display_name": "user1897830", "link": "https://stackoverflow.com/users/1897830/user1897830"}, "is_accepted": false, "score": 0, "last_activity_date": 1472455612, "last_edit_date": 1472455612, "creation_date": 1472301904, "answer_id": 39181302, "question_id": 39180630, "link": "https://stackoverflow.com/questions/39180630/fold-tree-function/39181302#39181302", "title": "Fold Tree Function", "body": "<p>Thanks for the answers. I think I will just leave it as is for these reasons:</p>\n\n<ol>\n<li>The type signature is given in the question so I presume that's what they want.</li>\n<li>The question mentions \"any traversal order is fine\".</li>\n<li>It works, just not in an order fashion eg. <code>foldTree (:) [] tree</code> will create a list of nodes but not in order. However <code>foldTree (+) 0 tree</code> creates a total where order is irrelevant.</li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 244, "user_id": 7012554, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/4e27f589084cc7b4fc26009c9fd99ff6?s=128&d=identicon&r=PG&f=1", "display_name": "Kaylo", "link": "https://stackoverflow.com/users/7012554/kaylo"}, "edited": false, "score": 0, "creation_date": 1538584228, "post_id": 39183925, "comment_id": 92196688, "body": "Assume I created a Trinary (Ternary?) tree which was defined as   <code>data TriTree a = EmptyNode | TriNode a (TriTree a) (TriTree a) (TriTree a)   deriving (Show)</code>  How would I create a pre-order fold for a tree like this?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 244, "user_id": 7012554, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/4e27f589084cc7b4fc26009c9fd99ff6?s=128&d=identicon&r=PG&f=1", "display_name": "Kaylo", "link": "https://stackoverflow.com/users/7012554/kaylo"}, "edited": false, "score": 0, "creation_date": 1538584959, "post_id": 39183925, "comment_id": 92197021, "body": "@Lombe That&#39;s not a comment, that&#39;s a question. You probably should post it as such, and clarify why you were not able to adapt the above code to your tree type."}, {"owner": {"reputation": 244, "user_id": 7012554, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/4e27f589084cc7b4fc26009c9fd99ff6?s=128&d=identicon&r=PG&f=1", "display_name": "Kaylo", "link": "https://stackoverflow.com/users/7012554/kaylo"}, "edited": false, "score": 0, "creation_date": 1538621091, "post_id": 39183925, "comment_id": 92209288, "body": "@chi I was able to figure it out. However,I have a different haskell related question. If you have the time, I was wondering if you&#39;d be able to help me figure it out. I just posted it here <a href=\"https://stackoverflow.com/questions/52638198/haskell-deriving-a-list-from-a-p-tree\" title=\"haskell deriving a list from a p tree\">stackoverflow.com/questions/52638198/&hellip;</a>"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1472462719, "last_edit_date": 1472462719, "creation_date": 1472319225, "answer_id": 39183925, "question_id": 39180630, "link": "https://stackoverflow.com/questions/39180630/fold-tree-function/39183925#39183925", "title": "Fold Tree Function", "body": "<p>I think you are looking for this kind of fold:</p>\n\n<pre><code>foldTree :: (a -&gt; b -&gt; b) -&gt; b -&gt; BinaryTree a -&gt; b\nfoldTree _ base Leaf = base\nfoldTree fn base (Node left a right) = foldTree fn base' left\n   where\n   base'  = fn a base''\n   base'' = foldTree fn base right\n</code></pre>\n\n<p>This is, roughly, what is being generated by the automatic <code>deriving Foldable</code>.</p>\n\n<p>The above is a sequential fold, which first folds over the left part, then over the middle element, then over the right.</p>\n\n<p>An equivalent but less efficient variant is to convert the tree to a list with an in-visit and then apply a <code>foldr fn base</code> over the result. One can \"spread\" the <code>foldr</code> over all the list generation, recovering the code above.</p>\n"}, {"comments": [{"owner": {"reputation": 9560, "user_id": 2023370, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4840a671d94ce5df0818cce059cab62b?s=128&d=identicon&r=PG&f=1", "display_name": "user2023370", "link": "https://stackoverflow.com/users/2023370/user2023370"}, "edited": false, "score": 0, "creation_date": 1563810783, "post_id": 53203426, "comment_id": 100814726, "body": "Switching <code>left</code> and <code>right</code> on the rhs of <code>foldTreel</code> corresponds to <code>foldTreer</code>. Switching <code>left</code> and <code>right</code> on the rhs of <code>foldTreer</code> corresponds to <code>foldTreel</code>. <code>foldTreec</code> stays the same."}], "tags": [], "owner": {"reputation": 1818, "user_id": 373489, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/a4ej6.png?s=128&g=1", "display_name": "Adam Mackler", "link": "https://stackoverflow.com/users/373489/adam-mackler"}, "is_accepted": false, "score": 2, "last_activity_date": 1541663704, "creation_date": 1541663704, "answer_id": 53203426, "question_id": 39180630, "link": "https://stackoverflow.com/questions/39180630/fold-tree-function/53203426#53203426", "title": "Fold Tree Function", "body": "<p>I came here after struggling with an exercise in Allen &amp; Moronuki's <em>Haskell Programming from first principles</em>. This question sounds like the same exercise, so, for what it's worth, from one beginner to another, here's what I came up with.</p>\n\n<p>I see three ways to \"fold\" (or catamorph) a binary tree. When folding a sequence, there are two ways to do it: fold left and fold right.  One way is to start by applying the given function to (1) the head of the list and (2) the return value of the recursive call applied to the tail of the list.  That's a fold right.</p>\n\n<p>The other way to do a sequential fold is to start by recursively calling fold on (1) the return value of the given function applied to the head of the list and (2) the tail of the list.  That's a fold left.</p>\n\n<p>But in a binary tree each value can have <em>two</em> \"subsequent\" values, rather than one as in a list.  So there must be two recursive calls to the fold.  The call to the passed function thus can either be outside the two recursive calls, inside the two, or else between them.  If I call those each left, right and center folds, I get these:</p>\n\n<pre><code>-- Fold Right for BinaryTree\n\nfoldTreer :: (a -&gt; b -&gt; b) -&gt; b -&gt; BinaryTree a -&gt; b\nfoldTreer f z Leaf = z\nfoldTreer f z (Node left a right) =\n    f a (foldTreer f (foldTreer f z left) right)\n\n-- Fold Left for Binary Tree\n\nfoldTreel :: (a -&gt; b -&gt; b) -&gt; b -&gt; BinaryTree a -&gt; b\nfoldTreel f z Leaf = z\nfoldTreel f z (Node left a right) =\n    foldTreel f (foldTreel f (f a z) left) right\n\n-- Fold Center for Binary Tree\n\nfoldTreec :: (a -&gt; b -&gt; b) -&gt; b -&gt; BinaryTree a -&gt; b\nfoldTreec f z Leaf = z\nfoldTreec f z (Node left a right) =\n    foldTreec f (f a (foldTreec f z left)) right\n</code></pre>\n\n<p>The first time I ever looked at Haskell was a couple weeks ago, so I could be totally wrong about everything, but that's the way it seems to me.</p>\n"}], "owner": {"reputation": 409, "user_id": 1897830, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4bb6f01afcee8d6fd59ccb93499732d6?s=128&d=identicon&r=PG", "display_name": "user1897830", "link": "https://stackoverflow.com/users/1897830/user1897830"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9877, "favorite_count": 2, "answer_count": 5, "score": 6, "last_activity_date": 1541663704, "creation_date": 1472297420, "question_id": 39180630, "link": "https://stackoverflow.com/questions/39180630/fold-tree-function", "title": "Fold Tree Function", "body": "<p>I'm trying to write a fold function for a tree:</p>\n\n<pre><code>data BinaryTree a = Leaf\n                  | Node (BinaryTree a) a (BinaryTree a)\n                  deriving (Eq, Ord, Show)\n\nfoldTree :: (a -&gt; b -&gt; b) -&gt; b -&gt; BinaryTree a -&gt; b\nfoldTree _ base Leaf = base\nfoldTree fn base (Node left a right) = fn a (foldTree fn acc right)\n         where acc = foldTree fn base left\n</code></pre>\n\n<p>This code nearly works. However not always. For example it won't reconstruct the tree exactly the same as the original.</p>\n"}, {"tags": ["haskell", "recursion", "induction", "equational-reasoning"], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1472296305, "post_id": 39180376, "comment_id": 65702331, "body": "The reason why it is much easier to write this proof by induction over <code>ys</code> as opposed to <code>xs</code> is because <code>++</code> is defined recursively over its first argument: <code>(++) (x:xs) ys = x : xs ++ ys</code>, so <code>y:ys ++ xs</code> is trivially equal to <code>y:(ys++xs)</code> whereas <code>ys ++ (x:xs)</code> cannot be trivially simplified."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 4, "last_activity_date": 1472315456, "last_edit_date": 1472315456, "creation_date": 1472295704, "answer_id": 39180376, "question_id": 39180054, "link": "https://stackoverflow.com/questions/39180054/induction-on-lists-proving-stronger-property-haskell/39180376#39180376", "title": "Induction on lists - Proving Stronger Property (Haskell)", "body": "<p>It is much easier to do the induction on <code>ys</code>, since then for empty <code>ys</code>, we have</p>\n\n<pre><code>sumTR xs (sumTR [] acc) =  -- by first case of (inner) sumTR\nsumTR xs acc =             -- by definition of (++)\nsumTR ([] ++ xs) acc       -- Q.E.D.\n</code></pre>\n\n<p>and for <code>y:ys</code>, we have</p>\n\n<pre><code>sumTR xs (sumTR (y:ys) acc) =    -- by second case of (inner) sumTR\nsumTR xs (sumTR ys (y + acc)) =  -- by induction\nsumTR (ys ++ xs) (y + acc) =     -- by second case of sumTR, \"in reverse\"\nsumTR (y:(ys ++ xs)) acc =       -- by definition of (++)\nsumTR ((y:ys) ++ xs) acc         -- Q.E.D.\n</code></pre>\n\n<p>Going with <code>ys</code> helped us because <code>(++)</code> is defined by recursion on its left-hand argument, which is <code>ys</code> in this case.</p>\n"}], "owner": {"reputation": 13, "user_id": 6764248, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28936d6f18636cf9ad1611fd3ae4a4db?s=128&d=identicon&r=PG&f=1", "display_name": "user6764248", "link": "https://stackoverflow.com/users/6764248/user6764248"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 235, "favorite_count": 0, "accepted_answer_id": 39180376, "answer_count": 1, "score": 1, "last_activity_date": 1472315456, "creation_date": 1472293493, "last_edit_date": 1472295729, "question_id": 39180054, "link": "https://stackoverflow.com/questions/39180054/induction-on-lists-proving-stronger-property-haskell", "title": "Induction on lists - Proving Stronger Property (Haskell)", "body": "<p>I'll say right off the bat this is for an assignment, and I'm not looking for an answer - just some direction, since I've been working on it for quite a while now.  Given the following tail-recursive sum function:</p>\n\n<pre><code>sumTR [ ] acc = acc  \nsumTR (x:xs) acc = sumTR xs (x + acc)  \n</code></pre>\n\n<p>we have to prove by induction that:  </p>\n\n<pre><code>sumTR xs (sumTR ys acc) = sumTR (ys ++ xs) acc  \n</code></pre>\n\n<p>After proving the base case (inducting on xs and treating ys as a constant) I arrived at:  </p>\n\n<pre><code>sumTR x:xs(sumTR ys acc) = ... = sumTR xs (x + sumTR ys acc)  \nsumTR (ys ++ x:xs) acc = ... = sumTR xs (sumTR ys (x + acc))\n</code></pre>\n\n<p>Our lecturer went through a simpler example (sum1 xs = sum2 xs, with sum1 being simple recursion), and when he reached the point where you can't make them any more similar, he proved a 'stronger property', by noting something like sum2 xs acc = acc + sum of xs.  Then he set an inductive hypothesis involving 'for all acc', and then set acc to 0 later on.  </p>\n\n<p>The main problem I'm having is that acc is already on LHS and RHS, so I feel like I've gotten close but that I'm not really proving a stronger property (the question doesn't ask for it specifically, but I think we're supposed to use it).  Also I'm not sure how extensively I'm allowed to use the associativity of addition when taking elements out (or inserting them into) the function.  </p>\n\n<p>Any help is appreciated! </p>\n"}, {"tags": ["haskell", "slice"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1472286496, "post_id": 39179034, "comment_id": 65699647, "body": "As far as prelude functions, there&#39;s <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:break\" rel=\"nofollow noreferrer\"><code>break</code></a>, which does it once.  It&#39;s not too hard to use break recursively to get <code>slice_when</code>&#39;s behavior, but there&#39;s no prelude function that does it.  Surely the <a href=\"http://hackage.haskell.org/package/split-0.2.3.1/docs/Data-List-Split.html\" rel=\"nofollow noreferrer\"><code>split</code></a> package has what you need."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1472286799, "post_id": 39179034, "comment_id": 65699729, "body": "Oops, I see, <code>slice_when</code> works on pairs.  This will be a bit more involved."}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 6764072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/793d8b6b48865ac929ffdec1d73a8287?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/6764072/jesse"}, "edited": false, "score": 0, "creation_date": 1472298119, "post_id": 39179360, "comment_id": 65702838, "body": "This works very well, thank you for your answer. ^.^"}], "tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": true, "score": 5, "last_activity_date": 1472288626, "creation_date": 1472288626, "answer_id": 39179360, "question_id": 39179034, "link": "https://stackoverflow.com/questions/39179034/haskell-equivalent-of-rubys-slice-when/39179360#39179360", "title": "Haskell equivalent of Ruby&#39;s slice_when", "body": "<p>Here\u2019s a <code>sliceWhen</code> implementation that I believe works like you want:</p>\n\n<pre><code>sliceWhen :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [[a]]\nsliceWhen _ []  = []\nsliceWhen _ [x] = [[x]]\nsliceWhen f (x:y:xs)\n  | f x y     = [x] : sliceWhen f (y:xs)\n  | otherwise = let z:zs = sliceWhen f (y:xs)\n                in (x:z) : zs\n</code></pre>\n\n<p>The above function runs the provided predicate on each boundary, and if it returns <code>True</code>, it creates a seam. Otherwise, it tacks the \u201ccurrent\u201d value onto the first element of the rest of the list.</p>\n"}, {"comments": [{"owner": {"reputation": 33, "user_id": 6764072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/793d8b6b48865ac929ffdec1d73a8287?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/6764072/jesse"}, "edited": false, "score": 0, "creation_date": 1472314572, "post_id": 39182436, "comment_id": 65707843, "body": "Hi, I run and got [1 :| [2],4 :| [],9 :| [10,11,12],15 :| [16],19 :| [20,21]], seems ok, but I can&#39;t understand this result, can you tell me, how can I transform it to [[1,2],[4],[9,10,11,12],[15,16],[19,20,21]], I am a novice, many thanks."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 33, "user_id": 6764072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/793d8b6b48865ac929ffdec1d73a8287?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/6764072/jesse"}, "edited": false, "score": 0, "creation_date": 1472315009, "post_id": 39182436, "comment_id": 65707969, "body": "It looks weird because the inner NonEmpty values are shown as pair of a first element and a list, like <code>9 :| [10,11,12]</code>. You can convert the inner values to regular lists using <code>map</code>, like this: <code>Prelude.map toList $ sliceWhen (\\x y -&gt; x+1 &#47;= y) [1,2,4,9,10,11,12,15,16,19,20,21]</code>."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 3, "last_activity_date": 1472331213, "last_edit_date": 1472331213, "creation_date": 1472309551, "answer_id": 39182436, "question_id": 39179034, "link": "https://stackoverflow.com/questions/39179034/haskell-equivalent-of-rubys-slice-when/39182436#39182436", "title": "Haskell equivalent of Ruby&#39;s slice_when", "body": "<p>Without explicit recursion, and using <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-List-NonEmpty.html\" rel=\"nofollow\"><code>NonEmpty</code></a>:</p>\n\n<pre><code>import Data.List.NonEmpty\n\nsliceWhen :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [NonEmpty a]\nsliceWhen p = foldr f []\n    where\n    f z [] = [z :| []]\n    f z gss@(gs@(x :| xs) : xss) = if p z x\n                                   then (z :| []) : gss\n                                   else cons z gs : xss\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 6764072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/793d8b6b48865ac929ffdec1d73a8287?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/6764072/jesse"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 1, "accepted_answer_id": 39179360, "answer_count": 2, "score": 3, "last_activity_date": 1472331213, "creation_date": 1472286178, "last_edit_date": 1472297772, "question_id": 39179034, "link": "https://stackoverflow.com/questions/39179034/haskell-equivalent-of-rubys-slice-when", "title": "Haskell equivalent of Ruby&#39;s slice_when", "body": "<p>I am new to Haskell, and I want a function works like Ruby's slice_when: </p>\n\n<p><a href=\"http://docs.ruby-lang.org/en/2.3.0/Enumerable.html#method-i-slice_when\" rel=\"nofollow\">slice_when</a>\n<strong>Ruby</strong></p>\n\n<pre><code>a = [1,2,4,9,10,11,12,15,16,19,20,21]\nb = a.slice_when {|i, j| i+1 != j }\np b.to_a #=&gt; [[1, 2], [4], [9, 10, 11, 12], [15, 16], [19, 20, 21]]\n</code></pre>\n\n<p><strong>Haskell</strong></p>\n\n<pre><code>ghci &gt; slice_when (\\x y -&gt; x+1 /= y) [1,2,4,9,10,11,12,15,16,19,20,21] \n\n=&gt; [[1, 2], [4], [9, 10, 11, 12], [15, 16], [19, 20, 21]]\n</code></pre>\n\n<p>Thank you very much.</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 4, "creation_date": 1472287735, "post_id": 39178172, "comment_id": 65699973, "body": "The problem is that <code>v</code> has type <code>V n a</code> for <b>all</b> possible types <code>n</code>. Given that Haskell relies on the open world assumption there is no way to know which instance of <code>Natural n</code> should be used there and thus the error where it says that <code>n0</code> is ambiguous: GHC doesn&#39;t want to choose a random type to be able to call <code>dim</code>. You must make your code not ambiguous."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1472311198, "post_id": 39178172, "comment_id": 65706811, "body": "The types here aren&#39;t actually ambiguous, these errors are due to the fact that the compiler tries to infer more general type signatures than required. Your code <a href=\"https://ideone.com/GsEHSO\" rel=\"nofollow noreferrer\">works</a> if you enable <code>-XMonoLocalBinds</code>."}, {"owner": {"reputation": 319, "user_id": 6531137, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8fa00f21d96d6c6030c3c74d7fb26944?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/6531137/kevin"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1472325908, "post_id": 39178172, "comment_id": 65711119, "body": "@user2407038 Thanks! Are there any downsides to using MonoLocalBinds?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1472397590, "post_id": 39178172, "comment_id": 65726049, "body": "@Kevin When you use <code>MonoLocalBinds</code>, the compiler no longer does <code>let</code> generaliztion (this is the definition of what the extension does). For a very detailed explanation of exactly how the typechecker handles <code>let</code> bindings with and w/o <code>MonoLocalBinds</code>, see <a href=\"https://ghc.haskell.org/trac/ghc/blog/LetGeneralisationInGhc7\" rel=\"nofollow noreferrer\">here</a>. In short, if you declare a function which you would like to be polymorphic in a <code>let</code> block, then to give it that polymorphic type, you will <i>always</i> have to give it a type signature, even if the polymorphic type is inferrable."}], "answers": [{"tags": [], "owner": {"reputation": 319, "user_id": 6531137, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8fa00f21d96d6c6030c3c74d7fb26944?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/6531137/kevin"}, "is_accepted": true, "score": 0, "last_activity_date": 1472325957, "creation_date": 1472325957, "answer_id": 39184913, "question_id": 39178172, "link": "https://stackoverflow.com/questions/39178172/why-cant-ghc-deduce-this-type/39184913#39184913", "title": "Why can&#39;t GHC deduce this type?", "body": "<p>As user2407038 suggested, enabling -XMonoLocalBinds makes the code work.</p>\n"}], "owner": {"reputation": 319, "user_id": 6531137, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8fa00f21d96d6c6030c3c74d7fb26944?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/6531137/kevin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 39184913, "answer_count": 1, "score": 0, "last_activity_date": 1472325957, "creation_date": 1472279260, "question_id": 39178172, "link": "https://stackoverflow.com/questions/39178172/why-cant-ghc-deduce-this-type", "title": "Why can&#39;t GHC deduce this type?", "body": "<p>Consider the following code snippet (from <a href=\"http://lpaste.net/180651\" rel=\"nofollow\">http://lpaste.net/180651</a>):</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\nclass Natural n\n\nnewtype V n a = V [a]\n\ndim :: Natural n =&gt; V n a -&gt; Int\ndim = undefined -- defined in my actual code\n\nbad_fromList :: Natural n =&gt; [a] -&gt; V n a\nbad_fromList l = if length l == dim v then v else undefined -- this is line 11\n  where v = V l\n\ngood_fromList :: forall n a. Natural n =&gt; [a] -&gt; V n a\ngood_fromList l = if length l == dim v then v else undefined\n  where v = V l :: V n a\n</code></pre>\n\n<p>GHCI gives the following error message:</p>\n\n<pre><code>test.hs:11:33: error:\n    \u2022 Could not deduce (Natural n0) arising from a use of \u2018dim\u2019\n      from the context: Natural n\n        bound by the type signature for:\n                   bad_fromList :: Natural n =&gt; [a] -&gt; V n a\n        at test.hs:10:1-41\n      The type variable \u2018n0\u2019 is ambiguous\n    \u2022 In the second argument of \u2018(==)\u2019, namely \u2018dim v\u2019\n      In the expression: length l == dim v\n      In the expression: if length l == dim v then v else undefined\n</code></pre>\n\n<p>Why can't GHCI deduce the type?</p>\n\n<p>Or, in the following code, pure' and good_f compile, while bad_f gives a similar error message. Why?</p>\n\n<pre><code>pure' :: Natural n =&gt; a -&gt; V n a\npure' x = v\n  where v = V $ replicate (dim v) x\n\nbad_f :: Natural n =&gt; [a] -&gt; (V n a, Int)\nbad_f xs = (v, dim v)\n  where v = V xs\n\ngood_f :: Natural n =&gt; a -&gt; (V n a, Int)\ngood_f x = (v, dim v)\n  where v = V $ replicate (dim v) x\n</code></pre>\n"}, {"tags": ["haskell", "error-handling", "monads"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 2, "creation_date": 1472242145, "post_id": 39173846, "comment_id": 65690168, "body": "Where did you see <code>instance MonadError (Either e) where ...</code>? Note that the MonadError  <a href=\"http://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Error-Class.html#t:MonadError\" rel=\"nofollow noreferrer\">defined in mtl</a> is different from the one <a href=\"http://hackage.haskell.org/package/monads-tf-0.1.0.3/docs/Control-Monad-Error.html#t:MonadError\" rel=\"nofollow noreferrer\">defined in monads-tf</a>"}, {"owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1472242386, "post_id": 39173846, "comment_id": 65690261, "body": "@ErikR hey, i saw it defined in this tutorial: <a href=\"https://wiki.haskell.org/All_About_Monads#The_Error_monad\" rel=\"nofollow noreferrer\">wiki.haskell.org/All_About_Monads#The_Error_monad</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1472244616, "post_id": 39173846, "comment_id": 65691190, "body": "I think the tutorial has a typo: it should read <code>instance MonadError e (Either e) where</code>"}], "owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 95, "favorite_count": 0, "closed_date": 1472244748, "answer_count": 0, "score": 0, "last_activity_date": 1472241384, "creation_date": 1472241384, "question_id": 39173846, "link": "https://stackoverflow.com/questions/39173846/haskell-monaderror", "closed_reason": "Duplicate", "title": "Haskell MonadError", "body": "<p>I was looking at a tutorial on monads in haskell\ni came across this type class:</p>\n\n<pre><code>class (Monad m) =&gt; MonadError e m | m -&gt; e where\n    throwError :: e -&gt; m a\n    catchError :: m a -&gt; (e -&gt; m a) -&gt; m a\n</code></pre>\n\n<p>I was wondering why the type parameters are e then m, i would have thought it would be m then e because when i looked at an instance for this class:</p>\n\n<pre><code>instance MonadError (Either e) where \nthrowError = Left \n(Left e) `catchError` handler = handler e \na        `catchError` _       = a\n</code></pre>\n\n<p>The monad constructor either came first, so my question is why in the class declaration are the type parameters switched?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 6, "creation_date": 1472238436, "post_id": 39172590, "comment_id": 65688554, "body": "Looks like a bug with error messages and generalized newtype deriving to me. You could open a ticket on <a href=\"https://ghc.haskell.org/trac/ghc\" rel=\"nofollow noreferrer\">Trac</a>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1472244491, "post_id": 39172590, "comment_id": 65691131, "body": "Weird. I&#39;d try standalone deriving to check whether it makes any difference."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 3, "creation_date": 1472245127, "post_id": 39172590, "comment_id": 65691411, "body": "I&#39;ve opened a ticket here: <a href=\"http://ghc.haskell.org/trac/ghc/ticket/12546\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/12546</a>"}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 2, "last_activity_date": 1482808478, "last_edit_date": 1495542746, "creation_date": 1482808478, "answer_id": 41338575, "question_id": 39172590, "link": "https://stackoverflow.com/questions/39172590/why-does-ghc-produce-the-following-kind-error-message/41338575#41338575", "title": "Why does GHC produce the following kind error message?", "body": "<p>As <a href=\"https://stackoverflow.com/questions/39172590/why-does-ghc-produce-the-following-kind-error-message#comment65688554_39172590\">Tikhon Jelvis said</a>, this was a bug. Alexis King opened <a href=\"http://ghc.haskell.org/trac/ghc/ticket/12546\" rel=\"nofollow noreferrer\">this ticket</a>, which was closed as fixed four months ago.</p>\n"}], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 358, "favorite_count": 0, "accepted_answer_id": 41338575, "answer_count": 1, "score": 8, "last_activity_date": 1482808478, "creation_date": 1472235911, "question_id": 39172590, "link": "https://stackoverflow.com/questions/39172590/why-does-ghc-produce-the-following-kind-error-message", "title": "Why does GHC produce the following kind error message?", "body": "<p>Given the following program:</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE FlexibleInstances #-}\n\nimport Control.Monad.Reader\n\nnewtype AppM a = AppM (ReaderT Int IO a)\n  deriving (Functor, Applicative, Monad, MonadReader)\n</code></pre>\n\n<p>The <code>MonadReader</code> deriving declaration should be <code>MonadReader Int</code>. GHC produces the following error message:</p>\n\n<pre><code>Expecting one more argument to \u2018MonadReader\u2019\nExpected kind \u2018* -&gt; ghc-prim-0.4.0.0:GHC.Prim.Constraint\u2019,\n  but \u2018MonadReader\u2019 has kind \u2018*\n                              -&gt; (* -&gt; *) -&gt; ghc-prim-0.4.0.0:GHC.Prim.Constraint\u2019\nIn the newtype declaration for \u2018AppM\u2019\n</code></pre>\n\n<p>This error message is confusing to me. The kind of <code>MonadReader</code> is <code>* -&gt; (* -&gt; *) -&gt; GHC.Prim.Constraint</code>, as the error message states, which makes sense. However, the error message states that it <em>expects</em> kind <code>* -&gt; GHC.Prim.Constraint</code>, despite the fact that <code>MonadReader Int</code> is actually of kind <code>(* -&gt; *) -&gt; GHC.Prim.Constraint</code>.</p>\n\n<p>Given that kinds <code>*</code> and <code>* -&gt; *</code> do not match, this error message feels not only misleading to me, but actually incorrect. Is this a bug, or am I overlooking something in this error message?</p>\n"}, {"tags": ["haskell", "happstack"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 1, "creation_date": 1472227986, "post_id": 39170431, "comment_id": 65683526, "body": "What is <code>LazyIO</code>?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 2, "creation_date": 1472227987, "post_id": 39170431, "comment_id": 65683530, "body": "You should tell us what imports are in scope - in particular, what module is <code>LazyIO</code> an alias for?"}, {"owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "edited": false, "score": 0, "creation_date": 1472228280, "post_id": 39170431, "comment_id": 65683690, "body": "<code>LazyIO</code> could plausibly be <code>Data.Text.Lazy.IO</code> or it could be <code>Data.ByteString.Lazy</code> or it could be something completely different.  Who knows?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1472228297, "post_id": 39170431, "comment_id": 65683702, "body": "<code>:t LazyIO.readfile $ markdownPath ++ &quot;PRIVACY.md&quot;</code> should indicate that the type is <code>m something</code> for some monad <code>m</code>, in which case <code>privacyContents</code> would have type <code>something</code>."}, {"owner": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "edited": false, "score": 0, "creation_date": 1472345128, "post_id": 39170431, "comment_id": 65715331, "body": "From my understanding, LazyIO is a package. <a href=\"http://hackage.haskell.org/package/lazyio\" rel=\"nofollow noreferrer\">link</a> And the import in scope should be <code>import qualified Data.Text.Lazy.IO as LazyIO</code>"}], "answers": [{"comments": [{"owner": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "edited": false, "score": 0, "creation_date": 1472349444, "post_id": 39170665, "comment_id": 65715879, "body": "I tried to use <code>Data.Text.Lazy.Text</code> as the type of the variable, but error <code>Not in scope: type constructor or class \u2018Data.Text.Lazy.Text\u2019</code> was returned when I compiled the program."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "edited": false, "score": 0, "creation_date": 1472349700, "post_id": 39170665, "comment_id": 65715916, "body": "Did you <code>import Data.Text.Lazy</code>?"}, {"owner": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "edited": false, "score": 0, "creation_date": 1472351970, "post_id": 39170665, "comment_id": 65716175, "body": "Yes, I think I did as <code>import qualified Data.Text.Lazy.IO as LazyIO</code>"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "edited": false, "score": 0, "creation_date": 1472356915, "post_id": 39170665, "comment_id": 65716866, "body": "But did you import Data.Text.Lazy? That is a different module from Data.Text.Lazy.IO. If you are still having trouble you should post a new question."}, {"owner": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "edited": false, "score": 0, "creation_date": 1472642096, "post_id": 39170665, "comment_id": 65832010, "body": "I see. I didn&#39;t import it at the first time. I just did right now. It seemed to work now. Thanks a lot!"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 3, "last_activity_date": 1472228305, "creation_date": 1472228305, "answer_id": 39170665, "question_id": 39170431, "link": "https://stackoverflow.com/questions/39170431/whats-the-type-of-lazyio-readfile/39170665#39170665", "title": "What&#39;s the type of LazyIO.readFile?", "body": "<p>You can have GHC tell you what the type is by using a type hole.</p>\n\n<p>Just add a let statement after the assignment:</p>\n\n<pre><code>...\nprivacyContents &lt;- LazyIO.readFile $ markdownPath ++ \"PRIVACY.md\"\nlet _ = privacyContents :: _\n...\n</code></pre>\n\n<p>When you compile the program or load it into ghci you will be told what the\ntype of <code>privacyContents</code> is.</p>\n\n<p>My guess is that LazyIO correpsonds to <code>Data.Text.IO.Lazy</code> which would make <code>privacyContents</code> a lazy Text value (i.e. type Data.Text.Lazy.Text).</p>\n"}], "owner": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1472228305, "creation_date": 1472227506, "last_edit_date": 1472227894, "question_id": 39170431, "link": "https://stackoverflow.com/questions/39170431/whats-the-type-of-lazyio-readfile", "title": "What&#39;s the type of LazyIO.readFile?", "body": "<p>I am trying to find the type of <code>privacyContents</code> in </p>\n\n<pre><code>privacyContents &lt;- LazyIO.readFile $ markdownPath ++ \"PRIVACY.md\"\n</code></pre>\n\n<p>Is the type of this variable defined by the return type of LazyIO.readFile? And if the answer is yes, what is the return type of LazyIO.readFile?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1472230838, "post_id": 39169092, "comment_id": 65685012, "body": "Uhm.. something looks wrong to me: the function <code>f = (\\a b -&gt; sum a &#47; 3)</code> does <i>not</i> satisfy the specification <code>f [ 3 , 4 , 5.6 ] ~= 4.2</code> since it takes an additional argument <code>b</code>. Are you sure you didn&#39;t miss something in either of them? If MagicHaskeller indeed reported that function for that spec, I would regard it as a bug."}], "answers": [{"comments": [{"owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "edited": false, "score": 0, "creation_date": 1472223859, "post_id": 39169190, "comment_id": 65681121, "body": "\\a is syntax for some list of type a in Haskell ?"}, {"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "reply_to_user": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "edited": false, "score": 1, "creation_date": 1472224222, "post_id": 39169190, "comment_id": 65681364, "body": "<code>\\ </code> introduces a lambda expression. It is followed by the arguments (<code>a b</code> here) and an arrow."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "edited": false, "score": 0, "creation_date": 1472227293, "post_id": 39169190, "comment_id": 65683150, "body": "@blue-sky Usually, the lambda expression is not used directly; <code>f a b = sum a &#47; 3</code> might be more familiar to you."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "edited": false, "score": 0, "creation_date": 1472227530, "post_id": 39169190, "comment_id": 65683270, "body": "@blue-sky <code>\\a -&gt; e</code> is syntax for a function which takes an argument, names it <code>a</code>, and returns <code>e</code>."}, {"owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1472229028, "post_id": 39169190, "comment_id": 65684115, "body": "@Daniel Wagner how is the compiler inferring that &#39;a&#39; contains the sum function? As &#39;a&#39; is a generic type."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "edited": false, "score": 2, "creation_date": 1472230341, "post_id": 39169190, "comment_id": 65684766, "body": "@blue-sky The compiler doesn&#39;t; MagicHaskeller is a separate program that takes a  specification and tries to deduce valid definitions that fit the specification. Such a function isn&#39;t unique; <code>g a = 4.2</code> is also a valid function that fits the specification. The &quot;magic&quot; is in trying to determine a function that matches a human&#39;s intuition as to which function is intended by a specification."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "edited": false, "score": 1, "creation_date": 1472232985, "post_id": 39169190, "comment_id": 65686018, "body": "@blue-sky <code>a</code> does not contain the sum function, and <code>a</code> is not a type. So ask more questions: you have misunderstood something farther up your inference chain then the question you are currently asking."}, {"owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1472243058, "post_id": 39169190, "comment_id": 65690551, "body": "@DanielWagner &#39;f = (\\a b -&gt; sum a / 3) &#39; is a lambda abstraction ? as described in section 3.1 of <a href=\"https://www.haskell.org/tutorial/functions.html\" rel=\"nofollow noreferrer\">haskell.org/tutorial/functions.html</a> . a is not typed at compile time but the sum function is applied to the a type. put another way &#39;sum a&#39; is the same as &#39;sum(a)&#39; , is this correct ? &#39;a&#39; has to be of some type otherwise its generic ?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "edited": false, "score": 1, "creation_date": 1472251885, "post_id": 39169190, "comment_id": 65693499, "body": "@blue-sky Yes, <code>f = \\a b -&gt; sum a&#47;3</code> is a lambda abstraction. No, <code>a</code> is typed at compile time (to a first approximation, types do not exist at runtime). No, the <code>sum</code> function is applied to the <i>term</i> <code>a</code> -- <code>a</code> is not a type (though it has a type). Yes, <code>sum a</code> and <code>sum(a)</code> are the same. I don&#39;t know what &quot;generic&quot; means, so I can&#39;t answer the last question. I still feel like we are talking past each other -- but I can&#39;t work out exactly where our difference in understanding is."}, {"owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1472253197, "post_id": 39169190, "comment_id": 65693848, "body": "@DanielWagner by generic I mean (coming from a Java background) that the &#39;a&#39; does not have a type so how can the compiler agree that &#39;a&#39; is allowed to be used with sum as &#39;a&#39; is not of type Num. I think this will clear it up for me : what is the difference between &#39;a&#39; not being a type and &#39;a&#39; having a type ? thanks for this detail."}, {"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "reply_to_user": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "edited": false, "score": 0, "creation_date": 1472298402, "post_id": 39169190, "comment_id": 65702913, "body": "@blue-sky <code>a</code> having a type and <code>a</code> being a type are completely different things."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "edited": false, "score": 0, "creation_date": 1472343128, "post_id": 39169190, "comment_id": 65715038, "body": "@blue-sky The compiler will verify that <code>a</code>&#39;s type is an instance of <code>Num</code> before agreeing to apply <code>sum</code>. For your second question: &quot;<code>a</code> having a type&quot; means that <code>a</code> is a term, and it&#39;s used in a consistent way in all the places it&#39;s used (e.g. isn&#39;t used as if it were a <code>Bool</code> in one place and as if it were a <code>Double</code> in another); on the other hand, <code>a</code> <i>being</i> a type means that it is a description of a consistent way to use terms. Compare: <code>3</code> has type <code>Int</code>; <code>3</code> is not a type, but <code>Int</code> is a type."}], "tags": [], "owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "is_accepted": true, "score": 1, "last_activity_date": 1472223323, "creation_date": 1472223323, "answer_id": 39169190, "question_id": 39169092, "link": "https://stackoverflow.com/questions/39169092/how-to-describe-this-function-definition/39169190#39169190", "title": "How to describe this function definition?", "body": "<p>Not quite, but close.</p>\n\n<p><code>f</code> <strong>is</strong> a function (it's a name bound to a lambda expression) that takes two arguments: a list of numbers <code>a</code> and some <code>b</code> that is completely ignored. The function returns the sum of the numbers in the list divided by three.</p>\n"}], "owner": {"reputation": 45345, "user_id": 470184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DzXRW.jpg?s=128&g=1", "display_name": "blue-sky", "link": "https://stackoverflow.com/users/470184/blue-sky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 39169190, "answer_count": 1, "score": 0, "last_activity_date": 1472223323, "creation_date": 1472222974, "question_id": 39169092, "link": "https://stackoverflow.com/questions/39169092/how-to-describe-this-function-definition", "title": "How to describe this function definition?", "body": "<p>Is this the correct way to describe a function specification and definition</p>\n\n<p>MagicHaskeller generates a function given a specification.</p>\n\n<p>For example the specification : <code>f [ 3 , 4 , 5.6 ] ~= 4.2</code> \ngenerates the function <code>f = (\\a b -&gt; sum a / 3)</code></p>\n\n<p>Put another way : the function : <code>f [ 3 , 4 , 5.6 ] ~= 4.2</code> accepts a list of three values and generates an approximate value by applying a transformation to these list values. The function generated <code>f = (\\a b -&gt; sum a / 3)</code> takes a function a which sums the list values and divides by 3. I think the statement <code>takes a function a which sums the list values and divides by 3</code> is incorrect. What is the correct interpretation of the function <code>f = (\\a b -&gt; sum a / 3)</code> ?</p>\n\n<p>Is my terminology correct ?</p>\n"}, {"tags": ["linux", "haskell", "audio", "openal"], "answers": [{"tags": [], "owner": {"reputation": 71, "user_id": 6614616, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/837e04716b819d95cb0e68bae8ea3d6e?s=128&d=identicon&r=PG&f=1", "display_name": "user6614616", "link": "https://stackoverflow.com/users/6614616/user6614616"}, "is_accepted": false, "score": 4, "last_activity_date": 1472222295, "creation_date": 1472222295, "answer_id": 39168858, "question_id": 39167975, "link": "https://stackoverflow.com/questions/39167975/no-sound-with-haskell-openal/39168858#39168858", "title": "No sound with Haskell OpenAl", "body": "<p>Well, it turns out I posted here a bit too quickly. There was no problem with my code, but rather with my OpenAl settings. By adding </p>\n\n<pre><code>drivers=pulse,alsa\n</code></pre>\n\n<p>to /etc/openal/alsoft.conf OpenAl works. This is described in <a href=\"https://wiki.archlinux.org/index.php/PulseAudio#OpenAL\" rel=\"nofollow\">https://wiki.archlinux.org/index.php/PulseAudio#OpenAL</a>.</p>\n"}], "owner": {"reputation": 71, "user_id": 6614616, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/837e04716b819d95cb0e68bae8ea3d6e?s=128&d=identicon&r=PG&f=1", "display_name": "user6614616", "link": "https://stackoverflow.com/users/6614616/user6614616"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1472222295, "creation_date": 1472219506, "question_id": 39167975, "link": "https://stackoverflow.com/questions/39167975/no-sound-with-haskell-openal", "title": "No sound with Haskell OpenAl", "body": "<p>I am currently attempting to play audio files in Haskell using OpenAl. In order to do so, I am trying to get the example code at the ALUT git repository (<a href=\"https://github.com/haskell-openal/ALUT/blob/master/examples/Basic/PlayFile.hs\" rel=\"nofollow\">https://github.com/haskell-openal/ALUT/blob/master/examples/Basic/PlayFile.hs</a>) to work. However, it refuses to produce any sound. What am I missing here?</p>\n\n<pre><code>{-\n   PlayFile.hs (adapted from playfile.c in freealut)\n   Copyright (c) Sven Panne 2005-2016\n   This file is part of the ALUT package &amp; distributed under a BSD-style license.\n   See the file LICENSE.\n-}\n\nimport Control.Monad ( when, unless )\nimport Data.List ( intersperse )\nimport Sound.ALUT\nimport System.Exit ( exitFailure )\nimport System.IO ( hPutStrLn, stderr )\n\n-- This program loads and plays a variety of files.\n\nplayFile :: FilePath -&gt; IO ()\nplayFile fileName = do\n   -- Create an AL buffer from the given sound file.\n   buf &lt;- createBuffer (File fileName)\n\n   -- Generate a single source, attach the buffer to it and start playing.\n   source &lt;- genObjectName\n   buffer source $= Just buf\n   play [source]\n\n   -- Normally nothing should go wrong above, but one never knows...\n   errs &lt;- get alErrors\n   unless (null errs) $ do\n      hPutStrLn stderr (concat (intersperse \",\" [ d | ALError _ d &lt;- errs ]))\n      exitFailure\n\n   -- Check every 0.1 seconds if the sound is still playing.\n   let waitWhilePlaying = do\n          sleep 0.1\n          state &lt;- get (sourceState source)\n          when (state == Playing) $\n             waitWhilePlaying\n   waitWhilePlaying\n\nmain :: IO ()\nmain = do\n   -- Initialise ALUT and eat any ALUT-specific commandline flags.\n   withProgNameAndArgs runALUT $ \\progName args -&gt; do\n\n      -- Check for correct usage.\n      unless (length args == 1) $ do\n         hPutStrLn stderr (\"usage: \" ++ progName ++ \" &lt;fileName&gt;\")\n         exitFailure\n\n      -- If everything is OK, play the sound file and exit when finished.\n      playFile (head args)\n</code></pre>\n\n<p>Unfortunately, while I don't get any errors, I also can\\t hear any sound. Pavucontrol also does not seem to detect anything (no extra streams appear under the Playback tab).</p>\n\n<p>Their HelloWorld example on the same git repository also gave neither errors nor sound.</p>\n\n<p>I also tried the OpenALInfo function on the same git repository (<a href=\"https://github.com/haskell-openal/ALUT/blob/master/examples/Basic/OpenALInfo.hs\" rel=\"nofollow\">https://github.com/haskell-openal/ALUT/blob/master/examples/Basic/OpenALInfo.hs</a>), which further proves that I'm actually connecting to OpenAL, and gives some information about the versions which may or may not be useful:</p>\n\n<pre><code>ALC version: 1.1\nALC extensions:\n    ALC_ENUMERATE_ALL_EXT, ALC_ENUMERATION_EXT, ALC_EXT_CAPTURE,\n    ALC_EXT_DEDICATED, ALC_EXT_disconnect, ALC_EXT_EFX,\n    ALC_EXT_thread_local_context, ALC_SOFTX_device_clock,\n    ALC_SOFT_HRTF, ALC_SOFT_loopback, ALC_SOFT_pause_device\nAL version: 1.1 ALSOFT 1.17.2\nAL renderer: OpenAL Soft\nAL vendor: OpenAL Community\nAL extensions:\n    AL_EXT_ALAW, AL_EXT_BFORMAT, AL_EXT_DOUBLE,\n    AL_EXT_EXPONENT_DISTANCE, AL_EXT_FLOAT32, AL_EXT_IMA4,\n    AL_EXT_LINEAR_DISTANCE, AL_EXT_MCFORMATS, AL_EXT_MULAW,\n    AL_EXT_MULAW_BFORMAT, AL_EXT_MULAW_MCFORMATS, AL_EXT_OFFSET,\n    AL_EXT_source_distance_model, AL_LOKI_quadriphonic,\n    AL_SOFT_block_alignment, AL_SOFT_buffer_samples,\n    AL_SOFT_buffer_sub_data, AL_SOFT_deferred_updates,\n    AL_SOFT_direct_channels, AL_SOFT_loop_points, AL_SOFT_MSADPCM,\n    AL_SOFT_source_latency, AL_SOFT_source_length\n</code></pre>\n"}, {"tags": ["haskell", "dependent-type"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1472220249, "post_id": 39167640, "comment_id": 65678706, "body": "<a href=\"https://personal.cis.strath.ac.uk/conor.mcbride/Pivotal.pdf\" rel=\"nofollow noreferrer\"><i>How to Keep Your Neighbours in Order</i></a> gives a definitive presentation of sorted containers in Agda"}, {"owner": {"reputation": 573, "user_id": 1485641, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/DZfVI.jpg?s=128&g=1", "display_name": "Bruno", "link": "https://stackoverflow.com/users/1485641/bruno"}, "edited": false, "score": 2, "creation_date": 1472220336, "post_id": 39167640, "comment_id": 65678753, "body": "Perhaps you could do something with Liquid Haskell, it would work on a function level. <a href=\"http://goto.ucsd.edu/~rjhala/liquid/haskell/blog/blog/2013/01/01/refinement-types-101.lhs/\" rel=\"nofollow noreferrer\">goto.ucsd.edu/~rjhala/liquid/haskell/blog/blog/2013/01/01/&hellip;</a>"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 2, "creation_date": 1472225004, "post_id": 39167640, "comment_id": 65681861, "body": "In Haskell it&#39;s going to be some combination of slow, hard to use and not really safe."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1472228793, "post_id": 39167640, "comment_id": 65683976, "body": "This <a href=\"http://goto.ucsd.edu/~rjhala/liquid/haskell/blog/blog/2013/07/29/putting-things-in-order.lhs/\" rel=\"nofollow noreferrer\">LiquidHaskell blog post</a> deals specifically with monotonic sequences - see the section titled &quot;Using Abstractly Refined Lists&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": true, "score": 1, "last_activity_date": 1472880805, "last_edit_date": 1472880805, "creation_date": 1472249611, "answer_id": 39175314, "question_id": 39167640, "link": "https://stackoverflow.com/questions/39167640/monotonic-sequence-type-in-haskell/39175314#39175314", "title": "Monotonic sequence type in haskell", "body": "<p>This isn't doing anything very fancy with types, but you could change how you interpret a sequence of naturals to get essentially the same guarantee.</p>\n\n<p>I think you are thinking along the right lines in your edit to the question. Consider</p>\n\n<pre><code>data IncreasingSeq = IncreasingSeq (Integer -&gt; Ratio Natural)\n</code></pre>\n\n<p>where each ratio represents how much it has increased from the previous number (starting with 0).</p>\n\n<p>Then you can provide a single function</p>\n\n<pre><code>applyToIncreasing :: ([Ratio Natural] -&gt; r) -&gt; IncreasingSeq -&gt; r\napplyToIncreasing f (IncreasingSeq s) = f . drop 1 $ scanl (+) 0 (map (s $) [0..])\n</code></pre>\n\n<p>This should let you deconstruct it in any way, without allowing the function to inspect the real structure.</p>\n\n<p>You just need a way to construct it: probably a <code>fromList</code> that just sorts it and an <code>insert</code> that performs a standard ordered insertion. </p>\n\n<p>It pains part of me to say this, but I don't think you'd gain anything over this using fancy type tricks: there are only three functions that could ever possibly go wrong, and they are fairly simple to correctly implement. The implementation is hidden so anything that uses those is correct as a result of those functions being correct. Just don't export the data constructor for <code>IncreasingSeq</code>.</p>\n\n<p>I would also suggest considering making <code>[Ratio Natural]</code> be the underlying representation. It simplifies things and guarantees that there are no \"gaps\" in the sequence (so it is guaranteed to be a sequence).</p>\n\n<p>If you want more safety and can take the performance hit, you can use <code>data Nat = Z | S Nat</code> instead of <code>Natural</code>.</p>\n\n<p>I will say that if this was Coq, or a similar language, instead of Haskell I would be more likely to suggest doing some fancier type-level stuff (depending on what you are trying to accomplish) for a couple reasons:</p>\n\n<ol>\n<li><p>In systems like Coq, you are usually proving theorems about the code. Because of this, it can be useful to have a type-level proof that a certain property holds. Since Haskell doesn't really have a builtin way to prove those sorts of theorems, the utility diminishes.</p></li>\n<li><p>On the other hand, we <em>can</em> (sometimes) construct data types that essentially <em>must</em> have the properties we want using a small number of trusted functions and a hidden implementation. In the context of a system with more theorem proving capability, like Coq, this might be harder to convince theorem prover of the property than if we used a dependent type (possibly, at least). In Haskell, however, we don't have that issue in the first place.</p></li>\n</ol>\n"}], "owner": {"reputation": 1972, "user_id": 1747134, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/696bad3bd2c5e16ded04f3cdf436623f?s=128&d=identicon&r=PG", "display_name": "user1747134", "link": "https://stackoverflow.com/users/1747134/user1747134"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 380, "favorite_count": 1, "accepted_answer_id": 39175314, "answer_count": 1, "score": 2, "last_activity_date": 1472880805, "creation_date": 1472218471, "last_edit_date": 1472223163, "question_id": 39167640, "link": "https://stackoverflow.com/questions/39167640/monotonic-sequence-type-in-haskell", "title": "Monotonic sequence type in haskell", "body": "<p>I would like to define a type for infinite number sequence in haskell. My idea is:</p>\n\n<pre><code>type MySeq = Natural -&gt; Ratio Integer\n</code></pre>\n\n<p>However, I would also like to be able to define some properties of the sequence on the type level. A simple example would be a non-decreasing sequence like this. Is this possible to do this with current dependent-type capabilities of GHC?</p>\n\n<p>EDIT: I came up with the following idea:</p>\n\n<pre><code>type PositiveSeq = Natural -&gt; Ratio Natural\ndata IncreasingSeq = IncreasingSeq {\n  start :: Ratio Natural,\n  diff :: PositiveSeq}\n\ntype IKnowItsIncreasing = [Ratio Natural]\n\ngetSeq :: IncreasingSeq -&gt; IKnowItsIncreasing\ngetSeq s = scanl (+) (start s) [diff s i | i &lt;- [1..]]\n</code></pre>\n\n<p>Of course, it's basically a hack and not actually type safe at all.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 3, "last_activity_date": 1472218310, "creation_date": 1472218310, "answer_id": 39167581, "question_id": 39167333, "link": "https://stackoverflow.com/questions/39167333/why-doesnt-ghc-type-checker-like-one-of-the-two-functions-that-look-almost-the/39167581#39167581", "title": "Why doesn&#39;t GHC type checker like one of the two functions that look almost the same?", "body": "<p>It looks to me like you just need</p>\n\n<pre><code>myFunction (DaPhone aList) aChar = ...\n</code></pre>\n\n<p>to unwrap <code>DaPhone</code> into an actual <em>list</em>.</p>\n"}], "owner": {"reputation": 7105, "user_id": 236007, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BiYes.jpg?s=128&g=1", "display_name": "Emre Sevin&#231;", "link": "https://stackoverflow.com/users/236007/emre-sevin%c3%a7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 39167581, "answer_count": 1, "score": 0, "last_activity_date": 1472218310, "creation_date": 1472217575, "question_id": 39167333, "link": "https://stackoverflow.com/questions/39167333/why-doesnt-ghc-type-checker-like-one-of-the-two-functions-that-look-almost-the", "title": "Why doesn&#39;t GHC type checker like one of the two functions that look almost the same?", "body": "<p>I'm trying to solve one of the chapter exercise in Chapter 11, \"Algebraic Datatypes\" in <a href=\"http://haskellbook.com/\" rel=\"nofollow\">Haskell Book</a>. But I'm stuck with a type error, can't understand why a very similar function works, whereas another doesn't.</p>\n\n<p>This is how I start:</p>\n\n<pre><code>type Digit = Char\n\ntype Presses = Int\n\ndata DaPhone =\n  DaPhone [(Char, Digit, Presses)]\n  deriving Show\n\nmyPhone :: DaPhone\nmyPhone =\n  DaPhone [('a', '2', 1), ('b', '2', 2), ('c', '2', 3)]\n\nreverseTaps :: DaPhone -&gt; Char -&gt; [(Digit, Presses)]\nreverseTaps aPhone aChar = foldr f [] aPhone\n  where f (c, d, p)\n          | c == aChar = ((d, p):)\n        f _         = id\n</code></pre>\n\n<p>and get the following error:</p>\n\n<pre><code>daPhone.hs:29:39: Couldn't match expected type \u2018t0 (Char, Digit, Presses)\u2019 \u2026\n                with actual type \u2018DaPhone\u2019\n    In the third argument of \u2018foldr\u2019, namely \u2018aPhone\u2019\n    In the expression: foldr f [] aPhone\nCompilation failed.\n</code></pre>\n\n<p>But if I try almost the same function with almost the same type, such as the following:</p>\n\n<pre><code>myList :: [(Char, Char, Int)]\nmyList = [('a', '2', 1), ('b', '2', 2), ('c', '2', 3)]\n\nmyFunction :: [(Char, Char, Int)] -&gt; Char -&gt; [(Char, Int)]\nmyFunction aList aChar = foldr f [] aList\n  where f (c, d, p)\n          | c == aChar = ((d,p):)\n        f _           = id\n</code></pre>\n\n<p>It compiles and works as expected:</p>\n\n<pre><code>\u03bb&gt; myFunction myList 'a'\n[('2',1)]\n\u03bb&gt; myFunction myList 'b'\n[('2',2)]\n\u03bb&gt; myFunction myList 'c'\n[('2',3)]\n</code></pre>\n\n<p>So, why do I get type error in <code>reverseTaps</code>, that is very similar to <code>myFunction</code>? (I guess it is about the definition of DaPhone, meaning maybe I need to do more pattern patching in <code>foldr</code>, etc., but I couldn't find out exactly how).</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": false, "score": 5, "last_activity_date": 1472216768, "creation_date": 1472216768, "answer_id": 39167064, "question_id": 39166987, "link": "https://stackoverflow.com/questions/39166987/how-to-use-maybe-base-correctly/39167064#39167064", "title": "How to use Maybe base correctly?", "body": "<p>While there are other compile errors in your code, the reason you're getting the error message about the parse error is because you are not including the pipe character used in guards.</p>\n\n\n\n<pre class=\"lang-haskell prettyprint-override\"><code>convert (c:cs) \n    | isDigit c            = Just(c: (convert cs):[])\n    | otherwise            = Nothing\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 43, "user_id": 6744061, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5271189c8671d9ff9ee098280d23cfa6?s=128&d=identicon&r=PG&f=1", "display_name": "kkkjjj", "link": "https://stackoverflow.com/users/6744061/kkkjjj"}, "edited": false, "score": 0, "creation_date": 1472224647, "post_id": 39167144, "comment_id": 65681648, "body": "Thanks for your answer."}], "tags": [], "owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "is_accepted": false, "score": 4, "last_activity_date": 1472217041, "creation_date": 1472217041, "answer_id": 39167144, "question_id": 39166987, "link": "https://stackoverflow.com/questions/39166987/how-to-use-maybe-base-correctly/39167144#39167144", "title": "How to use Maybe base correctly?", "body": "<p>There were several errors in your code. You need to try to convert each character, which gives a <code>Maybe Int</code>. Then you loop on the string using <code>mapM</code> inside the <code>Maybe</code> monad :</p>\n\n<pre><code>import Data.Char\n\nconvertChar :: Char -&gt; Maybe Int\nconvertChar c = if isDigit c then Just $ ord c else Nothing\n\nconvert :: String -&gt; Maybe [Int]\nconvert = mapM convertChar\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 43, "user_id": 6744061, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5271189c8671d9ff9ee098280d23cfa6?s=128&d=identicon&r=PG&f=1", "display_name": "kkkjjj", "link": "https://stackoverflow.com/users/6744061/kkkjjj"}, "edited": false, "score": 0, "creation_date": 1472224631, "post_id": 39167971, "comment_id": 65681639, "body": "Thanks for answer. Could you please tell me why the code shows such output? I don&#39;t understand the second line of the code."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 43, "user_id": 6744061, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5271189c8671d9ff9ee098280d23cfa6?s=128&d=identicon&r=PG&f=1", "display_name": "kkkjjj", "link": "https://stackoverflow.com/users/6744061/kkkjjj"}, "edited": false, "score": 0, "creation_date": 1472225755, "post_id": 39167971, "comment_id": 65682305, "body": "Which line, <code>sequence . map convertChar</code>?"}, {"owner": {"reputation": 43, "user_id": 6744061, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5271189c8671d9ff9ee098280d23cfa6?s=128&d=identicon&r=PG&f=1", "display_name": "kkkjjj", "link": "https://stackoverflow.com/users/6744061/kkkjjj"}, "edited": false, "score": 0, "creation_date": 1472225820, "post_id": 39167971, "comment_id": 65682336, "body": "convertChar c = if isDigit c then Just $ ord c else Nothing"}, {"owner": {"reputation": 43, "user_id": 6744061, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5271189c8671d9ff9ee098280d23cfa6?s=128&d=identicon&r=PG&f=1", "display_name": "kkkjjj", "link": "https://stackoverflow.com/users/6744061/kkkjjj"}, "edited": false, "score": 0, "creation_date": 1472225959, "post_id": 39167971, "comment_id": 65682409, "body": "I want to get [1,2,3] for input &quot;123&quot;, and &quot;Nothing&quot; for a input with letter. I don&#39;t know why this line can draw an output with 49..."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 43, "user_id": 6744061, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5271189c8671d9ff9ee098280d23cfa6?s=128&d=identicon&r=PG&f=1", "display_name": "kkkjjj", "link": "https://stackoverflow.com/users/6744061/kkkjjj"}, "edited": false, "score": 0, "creation_date": 1472226012, "post_id": 39167971, "comment_id": 65682441, "body": "Ah, <code>ord</code> converts a character to its ASCII value. If you just want to &quot;drop the quotes&quot;, so to speak, you need to subtract 48 from the result. You can&#39;t simply cast a character value to a number in Haskell."}, {"owner": {"reputation": 43, "user_id": 6744061, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5271189c8671d9ff9ee098280d23cfa6?s=128&d=identicon&r=PG&f=1", "display_name": "kkkjjj", "link": "https://stackoverflow.com/users/6744061/kkkjjj"}, "edited": false, "score": 0, "creation_date": 1472226354, "post_id": 39167971, "comment_id": 65682640, "body": "Thank you...One last question, what is the meaning of &#39;$&#39;? I searched that it means grouping expression, but I don&#39;t understand clearly..."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 43, "user_id": 6744061, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5271189c8671d9ff9ee098280d23cfa6?s=128&d=identicon&r=PG&f=1", "display_name": "kkkjjj", "link": "https://stackoverflow.com/users/6744061/kkkjjj"}, "edited": false, "score": 0, "creation_date": 1472226551, "post_id": 39167971, "comment_id": 65682756, "body": "It&#39;s a low-precedence operator for function application, used to save parentheses: <code>Just $ ord c - 48</code> is equivalent to <code>Just (ord c - 48)</code>. Whereas ordinary function application has higher precedence than any infix operator (hence, no need to write <code>(ord c) - 48</code> to avoid ambiguity with <code>ord (c - 48)</code>), the <code>$</code> operator has <i>lower</i> precedence than any other infix operator."}, {"owner": {"reputation": 43, "user_id": 6744061, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5271189c8671d9ff9ee098280d23cfa6?s=128&d=identicon&r=PG&f=1", "display_name": "kkkjjj", "link": "https://stackoverflow.com/users/6744061/kkkjjj"}, "edited": false, "score": 0, "creation_date": 1472226921, "post_id": 39167971, "comment_id": 65682930, "body": "I get it. Thank you very much!"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 2, "last_activity_date": 1472226413, "last_edit_date": 1495535352, "creation_date": 1472219494, "answer_id": 39167971, "question_id": 39166987, "link": "https://stackoverflow.com/questions/39166987/how-to-use-maybe-base-correctly/39167971#39167971", "title": "How to use Maybe base correctly?", "body": "<p>Another way of looking at <a href=\"https://stackoverflow.com/a/39167144/1126841\">V. Semeria's answer</a> is to use <code>sequence</code> (from the <code>Traversable</code> type class) with <code>map</code>:</p>\n\n<pre><code>import Data.Char -- for ord\n\nconvertChar :: Char -&gt; Maybe Int\nconvertChar c = if isDigit c then Just $ ord c - 48 else Nothing\n\nconvert :: String -&gt; Maybe [Int]\n-- Start with String -&gt; [Maybe Int], then convert\n-- the [Maybe Int] to Maybe [Int]\nconvert = sequence . map convertChar\n</code></pre>\n\n<p>This is a common pattern, so <code>Traversable</code> also provides <code>traverse</code>, which in this case is equivalent to <code>sequence . map</code>.</p>\n\n<pre><code>convert :: Traversable t =&gt; t Char -&gt; Maybe (t Int)\nconvert = traverse converChar\n</code></pre>\n\n<p>Some examples (most of the instances of <code>Traversable</code> available by default aren't very interesting, but various tree types can have instances).</p>\n\n<pre><code>&gt; convert \"123\"\nJust [1,2,3]\n&gt; convert (Just '1')\nJust (Just 1)\n&gt; convert (True, '2')\nJust (True, 2)\n&gt; convert (Right '1')\nJust (Right 1)\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 6744061, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5271189c8671d9ff9ee098280d23cfa6?s=128&d=identicon&r=PG&f=1", "display_name": "kkkjjj", "link": "https://stackoverflow.com/users/6744061/kkkjjj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 39167971, "answer_count": 3, "score": 0, "last_activity_date": 1472226413, "creation_date": 1472216514, "question_id": 39166987, "link": "https://stackoverflow.com/questions/39166987/how-to-use-maybe-base-correctly", "title": "How to use Maybe base correctly?", "body": "<p>I write a code to convert a string to be a list of Intger:</p>\n\n<pre><code>convert::String -&gt; Maybe [Int]\nconvert (c:cs) \n    isDigit c            = Just(c: (convert cs):[])\n    otherwise            = Nothing\n</code></pre>\n\n<p>and it shows an error...</p>\n\n<pre><code>test.hs:15:26: error:\nparse error on input \u2018=\u2019\nPerhaps you need a 'let' in a 'do' block?\ne.g. 'let x = 5' instead of 'x = 5'\n</code></pre>\n\n<p>Why is that so...</p>\n"}, {"tags": ["windows", "haskell", "installation", "package"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1472204410, "post_id": 39163135, "comment_id": 65669163, "body": "There is certainly no anything that <i>all</i> packages <i>must</i> support. All Stackage LTS packages, perhaps... but if you want it really foolproof you&#39;ll probably have to use something like Docker."}], "answers": [{"tags": [], "owner": {"reputation": 2667, "user_id": 325725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3db095f94749aaedfea12b927b13cf74?s=128&d=identicon&r=PG", "display_name": "Phyx", "link": "https://stackoverflow.com/users/325725/phyx"}, "is_accepted": false, "score": 0, "last_activity_date": 1472490190, "creation_date": 1472490190, "answer_id": 39211475, "question_id": 39163135, "link": "https://stackoverflow.com/questions/39163135/is-there-a-standardized-setup-for-haskell-on-windows-that-all-packages-must-supp/39211475#39211475", "title": "Is there a standardized setup for Haskell on windows that all packages must support?", "body": "<p>Officially, Cygwin is not supported by GHC (and personally I don't like it very much).</p>\n\n<p>MSYS2 is used to build GHC on Windows, and the packages that require configure support, such as network etc. </p>\n\n<p>So I'd say you'd get more mileage out of MSYS2 since that's what the Compiler is developed on Windows.</p>\n"}], "owner": {"reputation": 51, "user_id": 3737651, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/c249acf38009110ae5222ae3a1700242?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre van de Laar", "link": "https://stackoverflow.com/users/3737651/pierre-van-de-laar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 72, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1472490190, "creation_date": 1472204176, "last_edit_date": 1495541311, "question_id": 39163135, "link": "https://stackoverflow.com/questions/39163135/is-there-a-standardized-setup-for-haskell-on-windows-that-all-packages-must-supp", "title": "Is there a standardized setup for Haskell on windows that all packages must support?", "body": "<p>I have to develop Haskell on Windows.\nI need libraries that have a .configure file so I need *nix-like support.</p>\n\n<p>There are multiple options for *nix-like support, like Cygwin, UnxUtils, Windows Services for UNIX, UWin, MinGW, MSYS, MSYS2, ...\nUnfortunately, I discovered that not all packages support all options for *nix-like support.\nSince I only need *nix-like support to build packages, to me all *nix-like support is equal and I am wondering:</p>\n\n<p><strong>Is there a standardized setup for Haskell on windows that all packages must support?</strong></p>\n\n<p>If not, what setup for Haskell on Windows will work with most package?</p>\n\n<p>Of course, I have consulted the answer of <a href=\"https://stackoverflow.com/questions/304614/haskell-on-windows-setup\">Haskell on Windows setup</a>, yet the answers seem outdated. For example, Cygwin is mentioned, yet is no longer supported by some package, see e.g. <a href=\"https://stackoverflow.com/questions/38570323/failing-cabal-install-missingh-and-network-on-windows\">failing package install on windows</a>.</p>\n\n<p>Thanks in advance for your answers!</p>\n\n<p>Pierre</p>\n"}, {"tags": ["haskell", "monads", "category-theory"], "comments": [{"owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 0, "creation_date": 1472199341, "post_id": 39161440, "comment_id": 65666136, "body": "To define <code>NegCons x (PosCons x y) == y</code>, you need an <code>Eq</code> instance for the <code>a</code> in <code>FreeGroup a</code>. You cannot force that. I doubt <code>FreeGroup</code> is a monad in haskell."}, {"owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "reply_to_user": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 0, "creation_date": 1472199661, "post_id": 39161440, "comment_id": 65666325, "body": "It&#39;s the same for lists : <code>instance Eq a =&gt; Eq [a]</code>. The monad definition doesn&#39;t need the <code>==</code> operator, I just spoke of it the explain the link between <code>PosCons</code> and <code>NegCons</code>."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1472228901, "post_id": 39161440, "comment_id": 65684043, "body": "You cannot have an <code>Eq</code> constraint here like in the example you gave in the comment because for <code>Monad</code> you don&#39;t have &quot;access&quot; to the type argument. You cannot put an <code>Eq</code> constraint on <code>instance Monad FreeGroup where ...</code>. I guess this could work if you avoid equality by not having the Monad instance put it in any sort of normal form."}, {"owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "edited": false, "score": 0, "creation_date": 1472231156, "post_id": 39161440, "comment_id": 65685149, "body": "The monad instance is in the updated answer above"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1472243682, "post_id": 39161440, "comment_id": 65690789, "body": "The operation you&#39;re obviously missing is the one that shows that group operations factor through the free group. In Haskell terms, this is probably best expressed as <code>type instance Element (FreeGroup a) = a</code> and then <code>instance Eq a =&gt; MonoFoldable (FreeGroup a) where ...</code>. The <code>ofoldMap</code> implementation will have to collapse positive and negative elements appropriately. You&#39;ll probably also want <code>normalize :: Eq a =&gt; FreeGroup a -&gt; FreeGroup a</code>. The need to normalize manually, and track normalization without help from the type checker, is probably the biggest barrier to making this useful."}, {"owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "edited": false, "score": 0, "creation_date": 1472245517, "post_id": 39161440, "comment_id": 65691566, "body": "Thanks for the folding problem, I didn&#39;t think about it. <code>FreeGroup</code> is probably not foldable, because applying the &quot;negative&quot; of a function has no sense. Concerning normalization, is it really a logical obligation, or rather a performance concern ? It seems the monadic laws are verified here (aren&#39;t they ?)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1472246983, "post_id": 39161440, "comment_id": 65692075, "body": "You&#39;re right. <code>MonoFoldable</code> isn&#39;t right either. What you want is <code>class GroupFoldable a t | t -&gt; a where groupFold :: Group g =&gt; (a -&gt; g) -&gt; t -&gt; g</code>. You&#39;re right; folding doesn&#39;t require normalization. But the <code>Eq</code> instance will require normalization."}, {"owner": {"reputation": 365, "user_id": 3117573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TEuTH.jpg?s=128&g=1", "display_name": "mnish", "link": "https://stackoverflow.com/users/3117573/mnish"}, "edited": false, "score": 0, "creation_date": 1483111308, "post_id": 39161440, "comment_id": 69998896, "body": "@V.Semeria Using Functor and Monad instances means you are working in Hask, the whole category of Haskell types and functions, which has no intrinsic equational theory. In this sense your <code>PosCons f (NegCons f)</code> is <i>not</i> the same as <code>Nil</code>, so yours is not a group monad on Hask."}, {"owner": {"reputation": 365, "user_id": 3117573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TEuTH.jpg?s=128&g=1", "display_name": "mnish", "link": "https://stackoverflow.com/users/3117573/mnish"}, "edited": false, "score": 0, "creation_date": 1483111762, "post_id": 39161440, "comment_id": 69999087, "body": "I would recommend not to mess with Monads, Comonads etc. if you need a real non trivial algebraic theory, as it certainly would require an equational theory. Math is math, programming is programming, I think."}, {"owner": {"reputation": 365, "user_id": 3117573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TEuTH.jpg?s=128&g=1", "display_name": "mnish", "link": "https://stackoverflow.com/users/3117573/mnish"}, "edited": false, "score": 0, "creation_date": 1483112213, "post_id": 39161440, "comment_id": 69999265, "body": "What I mean is that the corresponding &#39;adjunction&#39; F-|G would not really make an isomorphism between FX-&gt;Y (in some category of groups) and X-&gt;GY (in Hask). The root cause of this is that Haskell&#39;s type system does not allow to construct suitable coequalizers."}], "answers": [{"tags": [], "owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "is_accepted": false, "score": 1, "last_activity_date": 1484858110, "creation_date": 1484858110, "answer_id": 41751196, "question_id": 39161440, "link": "https://stackoverflow.com/questions/39161440/free-group-monad/41751196#41751196", "title": "Free group monad", "body": "<p>\"Does the free group monad have any programming uses ?\" </p>\n\n<p>Due to the lack of answers over the last four months, I suppose the answer is 'no, not really'. But it is an interesting question, and since it is based on fundamental maths concepts it seems to me (also) that it should. </p>\n\n<p>First I note that the proposed free group functionality could also just as easily be implemented with a list of Either a a,</p>\n\n<pre><code>type FreeGroupT a = [Either a a]\n\nfgTofgT :: FreeGroup a -&gt; FreeGroupT a\nfgTofgT Nil = []\nfgTofgT (a :+: as) = Right a : fgToList as\nfgTofgT (a :-: as) = Left a : fgToList as\n\nfgTTofg :: FreeGroupT a -&gt; FreeGroup a\nfgTTofg [] = Nil\nfgTTofg (Right a : as) = a :+: fgTTofg as\nfgTTofg (Left a : as) = a :-: fgTTofg as\n\n--using (:-:) instead of NegCons\n--and   (:+:) instead of PosCons\n</code></pre>\n\n<p>This is a nice definition, since we ensure that our free group is just a monoid with a little extra structure. It calls out that the free group is just a composition of the free monoid with another functor (What's the name? Not the Either a b bifunctor but a functor F a = L a | R a).  We also ensure that the free group monad instance is consistent with the monad instance of the free monoid. That is, monads on the free group which operate on terms which happen to all be positive should behave like the monads over the free monoid, correct? </p>\n\n<p>Ultimately however, if we ever want to reduce inverses we need an <code>Eq a</code> instance. We will need to work at the term level, pure type level information is not enough. This makes the type level distinction between the free monoid and free group unhelpful--as far as i can see. At least with out dependent typing.</p>\n\n<p>For the sake of discussion on actual programming uses, I'll attempt (but fail) to provide a plausible use case.</p>\n\n<p>Imagine a text editor which uses the \"Ctrl\" key to signal command sequences. Any key sequence pressed while holding \"Ctrl\" are modeled as negatives (negative cons (:-:)) in the FreeGroup. So the free group term <code>'a':+:'b':+:'b':-:'a':-:[]</code> could be used to model emacs behavior which writes \"ab\", moves the cursor back a character, and then to the beginning of the line. Such a design is nice. We can easily embed commands and macros in a stream without some special reserved escape characters.   </p>\n\n<p>However, this example fails as a proper use case, since we would expect <code>'a':+:'b':+:'b':-:'a':-:[]</code> to be the same program as <code>[]</code>, which it isn't. Moreover, its easy enough to instead just wrap each list term in an Either as discussed above.</p>\n"}], "owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 481, "favorite_count": 5, "answer_count": 1, "score": 14, "last_activity_date": 1484858110, "creation_date": 1472199037, "last_edit_date": 1472295127, "question_id": 39161440, "link": "https://stackoverflow.com/questions/39161440/free-group-monad", "title": "Free group monad", "body": "<p>In category theory, a <a href=\"https://en.wikipedia.org/wiki/Monad_(category_theory)\">monad</a> is the composition of two adjoint functors. For example, the Maybe monad is the free pointed-set functor composed with the forgetful functor. Likewise, the List monad is the free monoid functor composed with the forgetful functor.</p>\n\n<p>Monoid is one of the simplest algebraic structures, so I wonder if programming can benefit from more complex ones. I didn't find the free group monad in standard Haskell packages, so I'll define it here</p>\n\n<pre><code>data FreeGroup a = Nil | PosCons a (FreeGroup a) | NegCons a (FreeGroup a)\n</code></pre>\n\n<p>The <code>==</code> operator is defined such that <code>NegCons x (PosCons x y) == y</code>. Accordingly, in <code>length :: FreeGroup a -&gt; Int</code>, each <code>PosCons</code> is counted +1 and each <code>NegCons</code> -1 (it is the only group morphism to Int that values +1 on each PosCons).</p>\n\n<p>As in lists (free monoids), <code>concat</code> is just multiplication and <code>map</code> is the functorial lift of functions. So the monad instance of <code>FreeGroup</code> is exactly the same as that of <code>List</code>.</p>\n\n<p>Does the free group monad have any programming uses ? Also, there is often an interpretation of a monad as a value in a context : for <code>List</code> the context would be choice or uncertainty. Is there such an interpretation for the free group monad ?</p>\n\n<p>How about free rings and vector spaces (which are always free) ?</p>\n\n<p>For any algebraic structure <code>S</code>, the existence of a <a href=\"https://en.wikipedia.org/wiki/Free_object\">categorical free functor</a> <code>FS :: Set -&gt; S</code> means the existence of a function Haskell calls fold :</p>\n\n<pre><code>foldS :: S s =&gt; (a -&gt; s) -&gt; FS a -&gt; s\n</code></pre>\n\n<p>It lifts a function on the basis <code>a</code> to an <code>S</code>-morphism on the free object <code>FS a</code>. The usual <code>foldr</code> function is a specialization of <code>foldMonoid</code> (called <code>foldMap</code> in Haskell, for some reason I don't quite get), the monoid being the set of functions <code>b -&gt; b</code> with composition as multiplication.</p>\n\n<p>For the sake of completeness, here is the monad instance of <code>FreeGroup</code> :</p>\n\n<pre><code>mult :: FreeGroup a -&gt; FreeGroup a -&gt; FreeGroup a\nmult Nil x = x\nmult x Nil = x\nmult (PosCons x y) z = PosCons x (mult y z)\nmult (NegCons x y) z = NegCons x (mult y z)\n\ninverse :: FreeGroup a -&gt; FreeGroup a\ninverse Nil = Nil\ninverse (PosCons x y) = mult (inverse y) (NegCons x Nil)\ninverse (NegCons x y) = mult (inverse y) (PosCons x Nil)\n\ngroupConcat :: FreeGroup (FreeGroup a) -&gt; FreeGroup a\ngroupConcat Nil = Nil\ngroupConcat (PosCons x l) = mult x (groupConcat l)\ngroupConcat (NegCons x l) = mult (inverse x) (groupConcat l)\n\ninstance Functor FreeGroup where\n  fmap f Nil = Nil\n  fmap f (PosCons x y) = PosCons (f x) (fmap f y)\n  fmap f (NegCons x y) = NegCons (f x) (fmap f y)\n\ninstance Applicative FreeGroup where\n  pure x = PosCons x Nil\n  fs &lt;*&gt; xs = do { f &lt;- fs; x &lt;- xs; return $ f x; }\n\ninstance Monad FreeGroup where\n  l &gt;&gt;= f = groupConcat $ fmap f l\n</code></pre>\n"}, {"tags": ["haskell", "recursion", "pattern-matching", "lazy-evaluation", "fold"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1472195126, "post_id": 39159825, "comment_id": 65663901, "body": "Probably related to a scoping issue with <code>xs</code>, since moving it to the definition of <code>g</code> fixes the problem."}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 6760001, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e393435eea28de1ba20e1e6b2619f3b?s=128&d=identicon&r=PG&f=1", "display_name": "Calvin S", "link": "https://stackoverflow.com/users/6760001/calvin-s"}, "edited": false, "score": 0, "creation_date": 1472196369, "post_id": 39160494, "comment_id": 65664548, "body": "Do you mean that the problem is there is some r which does not match (acc, xs) ?"}, {"owner": {"reputation": 33, "user_id": 6760001, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e393435eea28de1ba20e1e6b2619f3b?s=128&d=identicon&r=PG&f=1", "display_name": "Calvin S", "link": "https://stackoverflow.com/users/6760001/calvin-s"}, "edited": false, "score": 0, "creation_date": 1472196452, "post_id": 39160494, "comment_id": 65664592, "body": "doesn&#39;t the (v,[]) make sure that r is always in form of (acc,xs)?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 33, "user_id": 6760001, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e393435eea28de1ba20e1e6b2619f3b?s=128&d=identicon&r=PG&f=1", "display_name": "Calvin S", "link": "https://stackoverflow.com/users/6760001/calvin-s"}, "edited": false, "score": 0, "creation_date": 1472196685, "post_id": 39160494, "comment_id": 65664741, "body": "No, because subsequent recursive calls to the function are not passed <code>(v, [])</code>, but whatever is returned by <code>g</code>."}, {"owner": {"reputation": 33, "user_id": 6760001, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e393435eea28de1ba20e1e6b2619f3b?s=128&d=identicon&r=PG&f=1", "display_name": "Calvin S", "link": "https://stackoverflow.com/users/6760001/calvin-s"}, "edited": false, "score": 0, "creation_date": 1472197465, "post_id": 39160494, "comment_id": 65665165, "body": "Thank you for answering, just to confirm my understanding, the problem is (acc,xs) in second definition is strict, which make haskell evaluate acc and xs, which is defined by next iteration g, thus make haskell continue to infinity?"}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 3, "last_activity_date": 1506553797, "last_edit_date": 1506553797, "creation_date": 1472195808, "answer_id": 39160494, "question_id": 39159825, "link": "https://stackoverflow.com/questions/39159825/strictness-of-pattern-matching-vs-deconstructing/39160494#39160494", "title": "Strictness of pattern matching vs. deconstructing", "body": "<p>The crucial difference between the two functions is that in</p>\n\n<pre><code>g x r = let (acc, xs) = r\n        in (f x xs acc, x:xs)\n</code></pre>\n\n<p>The pattern match on the tuple constructor is irrefutable, whereas in </p>\n\n<pre><code>g x (acc, xs) = (f x xs acc, x:xs)\n</code></pre>\n\n<p>it is not. In other words, the first definition of <code>g</code> is equivalent to</p>\n\n<pre><code>g x ~(acc, xs) = (f x xs acc, x:xs)\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 6760001, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e393435eea28de1ba20e1e6b2619f3b?s=128&d=identicon&r=PG&f=1", "display_name": "Calvin S", "link": "https://stackoverflow.com/users/6760001/calvin-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 2, "accepted_answer_id": 39160494, "answer_count": 1, "score": 3, "last_activity_date": 1506553797, "creation_date": 1472193590, "last_edit_date": 1472195894, "question_id": 39159825, "link": "https://stackoverflow.com/questions/39159825/strictness-of-pattern-matching-vs-deconstructing", "title": "Strictness of pattern matching vs. deconstructing", "body": "<p>I'm trying to define primitive recursion in term of <code>foldr</code>, as explained in <a href=\"http://www.cs.nott.ac.uk/~pszgmh/fold.pdf\" rel=\"nofollow\">A tutorial on the universality and expressiveness on fold</a> chapter 4.1.  </p>\n\n<p>Here is first attempt at it</p>\n\n<pre><code>simpleRecursive f v xs = fst $ foldr g (v,[]) xs\n  where \n    g x (acc, xs) = (f x xs acc,x:xs)\n</code></pre>\n\n<p>However, above definition does not halt for <code>head $ simpleRecursive (\\x xs acc -&gt; x:xs) [] [1..]</code></p>\n\n<p>Below is definition that halt</p>\n\n<pre><code>simpleRecursive f v xs = fst $ foldr g (v,[]) xs\n  where \n    g x r = let (acc,xs) = r\n            in (f x xs acc,x:xs)\n</code></pre>\n\n<p>Given almost similar definition but different result, why does it differ? Does it have to do with how Haskell pattern match?</p>\n"}, {"tags": ["haskell", "exception-handling"], "answers": [{"comments": [{"owner": {"reputation": 5030, "user_id": 1021915, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/O3Ar0.jpg?s=128&g=1", "display_name": "Liam M", "link": "https://stackoverflow.com/users/1021915/liam-m"}, "edited": false, "score": 0, "creation_date": 1472182938, "post_id": 39157916, "comment_id": 65659415, "body": "Aaah, I see. I actually wasn&#39;t aware that I could add a type constraint like that, which is really useful to know when working with lambdas. Is there a name for that specific syntax construct?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 5030, "user_id": 1021915, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/O3Ar0.jpg?s=128&g=1", "display_name": "Liam M", "link": "https://stackoverflow.com/users/1021915/liam-m"}, "edited": false, "score": 0, "creation_date": 1472183589, "post_id": 39157916, "comment_id": 65659548, "body": "I just call it a type annotation, and you can annotate any subexpression. I&#39;ve updated the answer with some additional ways of providing the type information to GHC in the catch call."}, {"owner": {"reputation": 5030, "user_id": 1021915, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/O3Ar0.jpg?s=128&g=1", "display_name": "Liam M", "link": "https://stackoverflow.com/users/1021915/liam-m"}, "edited": false, "score": 0, "creation_date": 1472184352, "post_id": 39157916, "comment_id": 65659741, "body": "Thanks Erik, I really appreciate the added detail, you&#39;ve been a great help."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 9, "last_activity_date": 1472183417, "last_edit_date": 1472183417, "creation_date": 1472182522, "answer_id": 39157916, "question_id": 39157822, "link": "https://stackoverflow.com/questions/39157822/ambiguous-type-variable-a0-arising-from-a-use-of-ex-catch/39157916#39157916", "title": "Ambiguous type variable \u2018a0\u2019 arising from a use of \u2018Ex.catch\u2019", "body": "<p>GHC doesn't know why type of exception you want to catch.</p>\n\n<p>For instance, this version of outNum will catch any IOException:</p>\n\n<pre><code>outNum :: Int -&gt; IO()\noutNum i = Ex.catch (putStrLn(show (getNum i)))\n           (\\err -&gt; putStrLn (show (err :: Ex.IOException)))\n</code></pre>\n\n<p>You can catch all exceptions by using <code>Ex.SomeException</code>. However, see\nthe commentary about doing this in the <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Exception.html#g:4\" rel=\"noreferrer\">Control.Exception docs</a></p>\n\n<p>To catch several different kinds of exceptions, see the <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Exception.html#v:catches\" rel=\"noreferrer\"><code>catches</code> function</a></p>\n\n<p><strong>Update</strong></p>\n\n<p>Another way to indicate the type of exception you are interested in\nis to define the handler as a named function and provide a \"normal\"\ntype signature:</p>\n\n<pre><code>outNum i = Ex.catch (putStrLn (show (getNum i))\n            handler\n  where handler :: Ex.IOException -&gt; IO ()\n        handler err = putStrLn $ \"caught: \" ++ show err\n</code></pre>\n\n<p>and often you will see <code>catch</code> written as an infix operator:</p>\n\n<pre><code>outNum i = putStrLn (show (getNum i)) `catch` handler\n</code></pre>\n\n<p>Finally, with ScopedTypeVariables you can put the type annotation\non the lambda's argument:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\noutNum i = putStrLn ...\n             `catch` (\\(err :: Ex.SomeException) -&gt; putStrLn (\"caught: \" ++ show err))\n</code></pre>\n"}], "owner": {"reputation": 5030, "user_id": 1021915, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/O3Ar0.jpg?s=128&g=1", "display_name": "Liam M", "link": "https://stackoverflow.com/users/1021915/liam-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1527, "favorite_count": 1, "accepted_answer_id": 39157916, "answer_count": 1, "score": 2, "last_activity_date": 1472183417, "creation_date": 1472181690, "question_id": 39157822, "link": "https://stackoverflow.com/questions/39157822/ambiguous-type-variable-a0-arising-from-a-use-of-ex-catch", "title": "Ambiguous type variable \u2018a0\u2019 arising from a use of \u2018Ex.catch\u2019", "body": "<p>I've been fiddling about with Haskell, trying to understand error handling. While doing so I'm trying to come to grips with how to read and understand the ouput from GHC so I can better debug type errors.</p>\n\n<p>I've written the following test:</p>\n\n<pre><code>import System.Environment\nimport qualified Control.Exception as Ex\n\ngetNum :: Int -&gt; Int\ngetNum i = (!!) [1,2,3,4] i\n\noutNum :: Int -&gt; IO()\noutNum i = Ex.catch (putStrLn(show (getNum i))) (\\err -&gt; putStrLn (show err))\n\nmain = do\n   args &lt;- getArgs\n   outNum 3\n</code></pre>\n\n<p>This provokes the following error:</p>\n\n<blockquote>\n  <p>Ambiguous type variable \u2018a0\u2019 arising from a use of \u2018Ex.catch\u2019 prevents\n  the constraint \u2018(Ex.Exception a0)\u2019 from being solved.</p>\n</blockquote>\n\n<p>Looking at the definition of the functions involved:</p>\n\n<pre><code>catch :: IO a -&gt; (IOError -&gt; IO a) -&gt; IO a\nputStrLn :: String -&gt; IO ()\nshow :: Show a =&gt; a -&gt; String\nerror :: [Char] -&gt; a\n</code></pre>\n\n<p>I'm looking at this and thinking, the type of <code>a</code> must be <code>()</code> (unit type). What have I misunderstood, and how should Iamend my example so that it catches the exception and shows the error?</p>\n"}, {"tags": ["haskell", "haskell-stack", "nix"], "answers": [{"tags": [], "owner": {"reputation": 1484, "user_id": 2541778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/930c28082137d9918a90608c665c5af2?s=128&d=identicon&r=PG", "display_name": "Peter Simons", "link": "https://stackoverflow.com/users/2541778/peter-simons"}, "is_accepted": false, "score": 0, "last_activity_date": 1484835783, "creation_date": 1484835783, "answer_id": 41744123, "question_id": 39155853, "link": "https://stackoverflow.com/questions/39155853/stack-nix-build-complains-about-ghc-version-mismatch/41744123#41744123", "title": "stack --nix build complains about ghc version mismatch", "body": "<p>First of all, <code>threepenny-gui</code> seems to provide no <code>stack.yaml</code>, i.e. the project isn't configured to be built with <code>stack</code>. Thus, I wonder why you even bother using <code>stack</code> since that is not going to be any easier than building the project with <code>cabal-install</code> or even <code>Nix</code> directly. The easiest and fastest way is probably to configure the build by running:</p>\n\n<pre><code>$ nix-shell \"&lt;nixpkgs&gt;\" -A haskellPackages.threepenny-gui.env --run \"cabal configure\"\n</code></pre>\n\n<p>Afterwards, you can simply \"cabal build\" the project and work with it (inside or outside of a <code>nix-shell</code>) as you please; the compiler and all necessary build dependencies are provided by Nix.</p>\n\n<p>If you don't want that, then you can use the normal <code>cabal-install</code> approach:</p>\n\n<pre><code>$ cabal sandbox init\n$ cabal install --only-dependencies\n$ cabal configure\n$ cabal build\n</code></pre>\n\n<p>That build is probably going to require system libraries, like <code>libz</code>, so you must make sure that those are available. There's a million different ways to accomplish that, but the cleanest IMHO is the following:</p>\n\n<pre><code>$ zlibinc=$(nix-build --no-out-link \"&lt;nixpkgs&gt;\" -A zlib.dev)\n$ zliblib=$(nix-build --no-out-link \"&lt;nixpkgs&gt;\" -A zlib.out)\n$ cabal install --only-dependencies --extra-include-dirs=$zlibinc --extra-lib-dirs=$zliblib\n</code></pre>\n\n<p>Last but not least, it's not obvious to me why your <code>stack build --nix</code> command won't succeed, because that command will use Nix to install the proper version of GHC automatically. So if that doesn't work, then my best guess is that you're using an old version of <code>stack</code> where that feature doesn't work properly. I've tried that build using the <code>stack</code> binary that Nix provides, stack 1.3.2, and it can compile a current git checkout of <code>threepenny-gui</code> just fine:</p>\n\n<pre><code>$ git clone git://github.com/HeinrichApfelmus/threepenny-gui.git\nCloning into 'threepenny-gui'...\nremote: Counting objects: 4102, done.        \nremote: Total 4102 (delta 0), reused 0 (delta 0), pack-reused 4101        \nReceiving objects: 100% (4102/4102), 1.88 MiB | 581.00 KiB/s, done.\nResolving deltas: 100% (2290/2290), done.\n\n$ cd threepenny-gui\n$ stack init\nLooking for .cabal or package.yaml files to use to init the project.\nUsing cabal packages:\n- threepenny-gui.cabal\n\nSelecting the best among 9 snapshots...\n\n* Partially matches lts-7.16\n    websockets-snap not found\n        - threepenny-gui requires &gt;=0.8 &amp;&amp; &lt;0.11\n    Using package flags:\n        - threepenny-gui: buildexamples = False, network-uri = True, rebug = False\n\n* Matches nightly-2017-01-17\n\nSelected resolver: nightly-2017-01-17\nInitialising configuration using resolver: nightly-2017-01-17\nTotal number of user packages considered: 1\nWriting configuration to file: stack.yaml\nAll done.\n$ stack build --nix --nix-packages zlib\nthreepenny-gui-0.7.1.0: configure (lib)\nConfiguring threepenny-gui-0.7.1.0...\nthreepenny-gui-0.7.1.0: build (lib)\nPreprocessing library threepenny-gui-0.7.1.0...\n[...]\nRegistering threepenny-gui-0.7.1.0...\n</code></pre>\n\n<p>This works without any specially edited config files for <code>nix-shell</code>, nor does it require special customization of <code>stack</code>.</p>\n"}], "owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 229, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1484835783, "creation_date": 1472164966, "last_edit_date": 1472169677, "question_id": 39155853, "link": "https://stackoverflow.com/questions/39155853/stack-nix-build-complains-about-ghc-version-mismatch", "title": "stack --nix build complains about ghc version mismatch", "body": "<p>When building threepenny-gui on NixOS with <code>stack --nix build</code>, I got error saying I have the wrong version of ghc. Then I tried <code>stack --nix setup</code>, which doesn't run because bash is on an unexpected path on NixOS (that's expected, since the stack documentation only mentions <code>stack --nix build</code> not <code>setup</code>). What am I missing? </p>\n\n<p>FYI, to deal with the zlib issues I have also added a shell.nix and default.nix per <a href=\"https://github.com/commercialhaskell/stack/issues/2130\" rel=\"nofollow\">https://github.com/commercialhaskell/stack/issues/2130</a></p>\n\n<p>EDIT: was able to build with the method suggested by mkkeankylej from the above link, i.e. editing <code>~/.stack/config.yaml</code> and add zlib to <code>buildInputs</code> in shell.nix But I'd still like to know if there's a way to do it w/o falling back to nix-shell? It sounds like <code>stack --nix build</code> should work as long as the nix-shell method does. </p>\n"}, {"tags": ["haskell", "yesod", "cabal-install", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 716, "user_id": 4118267, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/xIgkR.jpg?s=128&g=1", "display_name": "oriaj", "link": "https://stackoverflow.com/users/4118267/oriaj"}, "edited": false, "score": 0, "creation_date": 1472219620, "post_id": 39155427, "comment_id": 65678261, "body": "thanks you are right my error was that run the command outside of the project; but it only work for the sqlite template; the postgres template send a error message when run <code>stack build</code> get:  <code>You need to install postgresql-server-dev-X.Y for building a server-side extension or libpq-dev for building a client-side application</code>"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 716, "user_id": 4118267, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/xIgkR.jpg?s=128&g=1", "display_name": "oriaj", "link": "https://stackoverflow.com/users/4118267/oriaj"}, "edited": false, "score": 0, "creation_date": 1472221590, "post_id": 39155427, "comment_id": 65679575, "body": "@oriaj For postgres, you have to most likely install the server library separately."}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 8, "last_activity_date": 1472162608, "creation_date": 1472162608, "answer_id": 39155427, "question_id": 39155246, "link": "https://stackoverflow.com/questions/39155246/cabal-dependencies-are-missing-in-yesod-and-stack/39155427#39155427", "title": "cabal dependencies are missing in Yesod and stack", "body": "<p>As described in the <a href=\"http://www.yesodweb.com/page/quickstart\">Yesod quick start page</a>, you have to do this inside the project:</p>\n\n<pre><code>stack build yesod-bin cabal-install --install-ghc\nstack build\n</code></pre>\n\n<p>And then,</p>\n\n<pre><code>stack exec -- yesod devel\n</code></pre>\n"}], "owner": {"reputation": 716, "user_id": 4118267, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/xIgkR.jpg?s=128&g=1", "display_name": "oriaj", "link": "https://stackoverflow.com/users/4118267/oriaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 194, "favorite_count": 0, "accepted_answer_id": 39155427, "answer_count": 1, "score": 2, "last_activity_date": 1472600405, "creation_date": 1472161723, "last_edit_date": 1472600405, "question_id": 39155246, "link": "https://stackoverflow.com/questions/39155246/cabal-dependencies-are-missing-in-yesod-and-stack", "title": "cabal dependencies are missing in Yesod and stack", "body": "<p>Hi i try to create a new proyect for yesod using stack, follow the <a href=\"http://www.yesodweb.com/page/quickstart\" rel=\"nofollow\">quickstart</a> tutorial; to create the scaffolding I use the command:</p>\n\n<pre><code>stack new my-project yesod-postgres &amp;&amp; cd my-project\n</code></pre>\n\n<p>But when run <code>stack exec -- yesod devel</code> get: </p>\n\n<pre><code>cabal: At least the following dependencies are missing:\nclassy-prelude &gt;=0.10.2,\nclassy-prelude-conduit &gt;=0.10.2,\nclassy-prelude-yesod &gt;=0.10.2,\ndata-default -any,\nhjsmin &gt;=0.1 &amp;&amp; &lt;0.3,\nmonad-logger ==0.3.*,\npersistent &gt;=2.0 &amp;&amp; &lt;2.6,\npersistent-postgresql &gt;=2.1.1 &amp;&amp; &lt;2.6,\npersistent-template &gt;=2.0 &amp;&amp; &lt;2.6,\nsafe -any,\nyesod &gt;=1.4.3 &amp;&amp; &lt;1.5,\nyesod-auth &gt;=1.4.0 &amp;&amp; &lt;1.5,\nyesod-core &gt;=1.4.17 &amp;&amp; &lt;1.5,\nyesod-form &gt;=1.4.0 &amp;&amp; &lt;1.5,\nyesod-static &gt;=1.4.0.3 &amp;&amp; &lt;1.6\n</code></pre>\n\n<p>I try with the command <code>stack exec -- cabal install</code> but get:</p>\n\n<pre><code>cabal: Use of GHC's environment variable GHC_PACKAGE_PATH is incompatible with\nCabal. Use the flag --package-db to specify a package database (it can be used multiple times).\n</code></pre>\n\n<p>Thanks for the help </p>\n\n<p><strong>EDIT</strong></p>\n\n<p>The command to install the postgres library in ubuntu:</p>\n\n<pre><code>sudo apt-get install -y libpq-dev\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 4, "creation_date": 1472146395, "post_id": 39151286, "comment_id": 65646374, "body": "Have a look at the <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:splitAt\" rel=\"nofollow noreferrer\"><code>splitAt</code></a> function or <a href=\"https://hackage.haskell.org/package/split-0.2.3.1/docs/Data-List-Split.html#v:chunksOf\" rel=\"nofollow noreferrer\"><code>chunksOf</code></a>"}, {"owner": {"reputation": 555, "user_id": 5973371, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/57038c49f6bb5b7ab57269bc1f00ab93?s=128&d=identicon&r=PG", "display_name": "Zubin Kadva", "link": "https://stackoverflow.com/users/5973371/zubin-kadva"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1472146659, "post_id": 39151286, "comment_id": 65646515, "body": "Thanks.. But then how should I loop through the tuples to perform calculations??"}], "answers": [{"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": false, "score": 4, "last_activity_date": 1472154479, "creation_date": 1472154479, "answer_id": 39153609, "question_id": 39151286, "link": "https://stackoverflow.com/questions/39151286/haskell-print-elements-of-a-list/39153609#39153609", "title": "Haskell: Print elements of a list", "body": "<p>You can write your own recursive function and pattern-match on elements you are interested in:</p>\n\n<pre><code>f (a:b:list) = doSomeThingWith a b : f list\n</code></pre>\n\n<p>Make sure to properly match on <code>[]</code> and <code>[a]</code> cases.</p>\n"}, {"comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1472167949, "post_id": 39153637, "comment_id": 65655986, "body": "Shouldn&#39;t tgere be a case for <code>mapTwo [x] = error &quot;singleton lists are not allowed&quot;</code>?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 2, "creation_date": 1472167968, "post_id": 39153637, "comment_id": 65655993, "body": "See my last sentence. I just didn&#39;t want to get into how to handle a list with an odd number of values."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1472168603, "post_id": 39153637, "comment_id": 65656173, "body": "Rather, I didn&#39;t want to bring up pros and cons of partial functions, using <code>Maybe</code> or <code>Either</code>, raising an error, or using an exception monad."}, {"owner": {"reputation": 555, "user_id": 5973371, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/57038c49f6bb5b7ab57269bc1f00ab93?s=128&d=identicon&r=PG", "display_name": "Zubin Kadva", "link": "https://stackoverflow.com/users/5973371/zubin-kadva"}, "edited": false, "score": 0, "creation_date": 1472337608, "post_id": 39153637, "comment_id": 65714103, "body": "I&#39;m not getting how to use <code>mapTwo</code>."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 5, "last_activity_date": 1472154598, "creation_date": 1472154598, "answer_id": 39153637, "question_id": 39151286, "link": "https://stackoverflow.com/questions/39151286/haskell-print-elements-of-a-list/39153637#39153637", "title": "Haskell: Print elements of a list", "body": "<p>Here's an example. You are (or should become) familiar with the <code>map</code> function:</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]\nmap f [] = []\nmap f (x:xs) = f x : map f xs\n</code></pre>\n\n<p>Here, you might have a function that takes <em>two</em> arguments, and want to apply it to two elements from a list at a time. Here's a function <code>mapTwo</code> that behaves like <code>map</code>, but with a two-argument function. For simplicity, we'll assume the list has an even number of elements.</p>\n\n<pre><code>mapTwo :: (a -&gt; a -&gt; b) -&gt; [a] -&gt; [b]\nmapTwo f [] = []\nmapTwo f (x1:x2:xs) = f x1 x2 : mapTwo f xs\n</code></pre>\n"}], "owner": {"reputation": 555, "user_id": 5973371, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/57038c49f6bb5b7ab57269bc1f00ab93?s=128&d=identicon&r=PG", "display_name": "Zubin Kadva", "link": "https://stackoverflow.com/users/5973371/zubin-kadva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 668, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1472154598, "creation_date": 1472145851, "last_edit_date": 1472146251, "question_id": 39151286, "link": "https://stackoverflow.com/questions/39151286/haskell-print-elements-of-a-list", "title": "Haskell: Print elements of a list", "body": "<p>I have a list\n<code>let a = [1,2,3,4]</code></p>\n\n<p>I want to extract 2 elements at a time to perform computation. Can anyone tell me how this can be achieved? I am new to Haskell.</p>\n\n<p>I am aware of <code>take 2 a</code>. But how can I put this in a loop so that 2 elements are extracted at a time. I am confused.</p>\n"}, {"tags": ["haskell", "combobox", "gtk2hs"], "answers": [{"comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1472175835, "post_id": 39149648, "comment_id": 65657872, "body": "It&#39;s probably more that the property type of <code>cellText</code> has at some point (in some Gtk2HS version) changed from <code>GlibString a =&gt; Maybe a</code> to <code>GlibString a =&gt; a</code>."}], "tags": [], "owner": {"reputation": 9139, "user_id": 773228, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/baaecdda322cf4462a0dd018d7959b1e?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Wood", "link": "https://stackoverflow.com/users/773228/justin-wood"}, "is_accepted": true, "score": 1, "last_activity_date": 1472140991, "last_edit_date": 1472140991, "creation_date": 1472140162, "answer_id": 39149648, "question_id": 39149097, "link": "https://stackoverflow.com/questions/39149097/combobox-in-gtk2hs-compiling-error/39149648#39149648", "title": "ComboBox in Gtk2hs compiling error", "body": "<p><a href=\"https://github.com/gtk2hs/gtk2hs/blob/master/glib/System/Glib/UTFString.hs#L119\" rel=\"nofollow\"><code>GlibString</code></a> Doesn't appear to have an instance for <code>Maybe String</code>. It may have at one point, but you should be able to just use <code>cellText := txt</code> instead. If for whatever reason you need to use a <code>Maybe String</code>, you could implement the instance yourself.</p>\n"}], "owner": {"reputation": 151, "user_id": 5872882, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fc8fcfe6e5954b67ec74d3408e807c45?s=128&d=identicon&r=PG&f=1", "display_name": "Max K", "link": "https://stackoverflow.com/users/5872882/max-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34, "favorite_count": 0, "accepted_answer_id": 39149648, "answer_count": 1, "score": 1, "last_activity_date": 1472140991, "creation_date": 1472138556, "last_edit_date": 1472138943, "question_id": 39149097, "link": "https://stackoverflow.com/questions/39149097/combobox-in-gtk2hs-compiling-error", "title": "ComboBox in Gtk2hs compiling error", "body": "<p>How can I handle a ComboBox with Gtk2hs? \nOn <a href=\"https://github.com/gtk2hs/gtk2hs/blob/master/docs/tutorial/tutorial.t2t#L271\" rel=\"nofollow\">this</a> page I found a solution: </p>\n\n<pre><code>store &lt;- listStoreNew [\"green\", \"yellow\", \"...\"]\ncomboElem &lt;- comboBoxNewWithModel store\nren &lt;- cellRendererTextNew\ncellLayoutPackEnd comboElem ren True\ncellLayoutSetAttributes comboElem ren store\n  (\\txt -&gt; [cellText := Just txt])\n</code></pre>\n\n<p>However while compiling I get this error (which occurs in the last line of my code example):</p>\n\n<pre><code>Main.hs:36:17:\nNo instance for (System.Glib.UTFString.GlibString (Maybe [Char]))\n  arising from a use of \u2018cellText\u2019\nIn the first argument of \u2018(:=)\u2019, namely \u2018cellText\u2019\nIn the expression: cellText := Just txt\nIn the expression: [cellText := Just txt]\n</code></pre>\n\n<p>How can I fix the problem? </p>\n\n<p>Thanks in advance</p>\n"}, {"tags": ["haskell", "gadt"], "answers": [{"comments": [{"owner": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "edited": false, "score": 0, "creation_date": 1472136494, "post_id": 39148323, "comment_id": 65640362, "body": "Can we make Question an instance of Monad or Category? I like it to be composable :: <code>Question o -&gt; (o -&gt; Question o&#39;) -&gt; Question o&#39;</code> This way at design time I can ensure that the questions are sequenced and will be asked in a &quot;rational&quot; order."}, {"owner": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "edited": false, "score": 0, "creation_date": 1472136563, "post_id": 39148323, "comment_id": 65640409, "body": "While retaining the ability to <code>getQuestion :: String -&gt; Question</code> as the first question perhaps."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "edited": false, "score": 0, "creation_date": 1472137190, "post_id": 39148323, "comment_id": 65640831, "body": "The original <code>Question</code> has kind <code>*</code> (no type parameters). If you want it to be parameterized by the type of its answer, it&#39;s a whole different kettle of fish. You can have <code>String-&gt;Question</code> but <code>String-&gt;Question a</code> has the same problem you are having with <code>Question -&gt; IO a</code>."}, {"owner": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "edited": false, "score": 0, "creation_date": 1472139073, "post_id": 39148323, "comment_id": 65642015, "body": "I think I&#39;ll lose one important feature by avoiding type parameters, I described it here: <a href=\"http://stackoverflow.com/questions/39147517/functions-of-gadts/39148323?noredirect=1#comment65641921_39148529\" title=\"functions of gadts\">stackoverflow.com/questions/39147517/functions-of-gadts/&hellip;</a>"}], "tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": true, "score": 5, "last_activity_date": 1472136198, "creation_date": 1472136198, "answer_id": 39148323, "question_id": 39147517, "link": "https://stackoverflow.com/questions/39147517/functions-of-gadts/39148323#39148323", "title": "Functions of GADTs", "body": "<p>This type</p>\n\n<pre><code>Question -&gt; IO a\n</code></pre>\n\n<p>means \"a function that accepts a <code>Question</code> and returns an <code>IO a</code> <em>for whatever <code>a</code> the caller wants</em>\". This is obviously wrong; some questions have an <code>Int</code> answer and some have a <code>String</code> answer, but no question has an answer that can on demand be <code>Int</code>, <code>String</code>, or whatever else we may want.</p>\n\n<p>If all you need from the answer is the ability to show itself, just return a shown answer as an <code>IO String</code>.</p>\n\n<pre><code>type Message = String\n\ndata Question = Simple Message (String -&gt; String)\n  -- more constructors\n\nyourName :: Question\nyourName = Simple \"Your name?\" show\n\nyourWeight :: Question\nyourWeight = Simple \"What is your weight?\" (show . (read :: String -&gt; Int))\n\ngetQuestion :: String -&gt; Question\ngetQuestion \"name\" =  yourName\ngetQuestion \"weight\" =  yourWeight\n\nrunQuestion :: Question -&gt; IO String\nrunQuestion (Simple message parser) = do\n  putStrLn message\n  ans &lt;- getLine\n  return $ parser ans\n\nmain = getLine &gt;&gt;= (runQuestion . getQuestion) &gt;&gt;= putStrLn\n</code></pre>\n\n<p>Otherwise you can move existentiality to the answer, which you need to encapsulate in a new GADT:</p>\n\n<pre><code>type Message = String\n\ndata Question where\n  Simple :: Message -&gt; (String -&gt; Answer) \u2192 Question\n  -- more constructors\n\ndata Answer where\n  Easy ::  (Typeable a, Show a) =&gt; a -&gt; Answer\n\ninstance Show Answer where\n  show (Easy a) = show a\n\nyourName :: Question\nyourName = Simple \"Your name?\" Easy\n\nyourWeight :: Question\nyourWeight = Simple \"What is your weight?\" (Easy . (read :: String -&gt; Int))\n\ngetQuestion :: String -&gt; Question\ngetQuestion \"name\" =  yourName\ngetQuestion \"weight\" =  yourWeight\n\nrunQuestion :: Question -&gt; IO Answer\nrunQuestion (Simple message parser) = do\n  putStrLn message\n  ans &lt;- getLine\n  return $ parser ans\n\nmain = getLine &gt;&gt;= (runQuestion . getQuestion) &gt;&gt;= print\n</code></pre>\n\n<p>but this is IMHO overkill.</p>\n"}, {"comments": [{"owner": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "edited": false, "score": 0, "creation_date": 1472138936, "post_id": 39148529, "comment_id": 65641921, "body": "I thought that I will run into dependent types. I want to create a rational question/answer; meaning that the sequence of Questions should be type checked at compile time like: <code>Question a b { run :: a -&gt; Input -&gt; Either (b, Question b)}</code>. The last question in any chain ends with <code>Left finalResult</code>. The top Questions in a chain take no input perhaps <code>a = ()</code>. Questions probably form a Category. <code>b</code> the result depends on the result of the previous Question <code>a</code>. <code>a</code> and <code>b</code> are Typeable, Show and Read because I want to continue a chain by getting and feeding it <code>a</code> from somewhere (eg. Redis)."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "edited": false, "score": 1, "creation_date": 1472139318, "post_id": 39148529, "comment_id": 65642165, "body": "@homam can you show a specific example of a chain of questions? I&#39;m having a hard time imagining how they might compose. To be specific, what question can you chain to either side of &quot;What is your weight&quot;?"}, {"owner": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1472140258, "post_id": 39148529, "comment_id": 65642757, "body": "@n.m.  If <code>Simple :: lastResult -&gt; Input -&gt; Either result (result, Question result _)</code> then  <code>yourName = Simple $ \\ _ i -&gt; Right (i, yourWeight)</code>  <code>yourWieght = Simple $ \\ name i -&gt; let res = (name, read i :: Int) in Left res</code>.  I can imagine that <code>yourName &gt;&gt;&gt; yourWeight</code> is valid."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "edited": false, "score": 0, "creation_date": 1472140853, "post_id": 39148529, "comment_id": 65643172, "body": "@homam so does <code>yourName &gt;&gt;&gt; yourWeight</code> result include both name and weight? I don&#39;t think Haskell tyoe system can handle that. You need dependent types, open rows, or probably just plain old magic."}, {"owner": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1472141130, "post_id": 39148529, "comment_id": 65643359, "body": "@n.m. yes, I want the result <code>yourName &gt;&gt;&gt; yourWeight</code> to contain the result of both Questions. This way I ensure that <code>yourWeight</code> can only be asked after <code>yourName</code>. The whole thing is probably similar to creating a type safe state machine where transitions are type checked."}], "tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": false, "score": 4, "last_activity_date": 1472136825, "creation_date": 1472136825, "answer_id": 39148529, "question_id": 39147517, "link": "https://stackoverflow.com/questions/39147517/functions-of-gadts/39148529#39148529", "title": "Functions of GADTs", "body": "<p>The error you report is not the only error.</p>\n\n<p>Let's put on the special spectacles which show the things usually kept invisible by \"type inference\".</p>\n\n<p>Firstly, the data constructor:</p>\n\n<pre><code>Simple :: forall a. (Typeable a, Show a) =&gt;\n          Message -&gt; (String -&gt; a) -&gt; Question\n</code></pre>\n\n<p>Effectively, a value of type <code>Question</code> looks like</p>\n\n<pre><code>Simple {a}{typeableDict4a}{showDict4a} message parser\n</code></pre>\n\n<p>where I've written the invisible things in braces. The constructor packs up a type and the two typeclass dictionaries that give the implementations for the members of <code>Typeable</code> and <code>Show</code>.</p>\n\n<p>Now let's have the main program. I've renamed the type variable to make a point.</p>\n\n<pre><code>runQuestion :: forall b. (Typeable b, Show b) =&gt; Question -&gt; IO b\n</code></pre>\n\n<p>The type to be given back is chosen by the caller of <code>runQuestion</code>, separately from whatever type is packed inside the argument of type <code>Question</code>. Now let's fill in the invisible components in the program itself.</p>\n\n<pre><code>runQuestion {b}{typeableDict4b}{showDict4b}\n  (Simple {a}{typeableDict4a}{showDict4a} message parser) = do\n                        -- so parser :: String -&gt; a\n      putStrLn message  -- ok, as message :: String\n      ans &lt;- getLine    -- ensures ans :: String\n  return $ parser ans   -- has type IO a, not IO b\n</code></pre>\n\n<p>The <code>parser</code> computes a value of the type <code>a</code> packed up in the <code>Question</code>, which is totally separate from the type <code>b</code> passed directly to <code>runQuestion</code>. The program does not typecheck because there's a conflict between two types which can be made different by the program's caller.</p>\n\n<p>Meanwhile, let's look at <code>print</code></p>\n\n<pre><code>print :: forall c. Show c =&gt; c -&gt; IO ()\n</code></pre>\n\n<p>When you write</p>\n\n<pre><code>main = getLine &gt;&gt;= (runQuestion . getQuestion) &gt;&gt;= print\n</code></pre>\n\n<p>you get</p>\n\n<pre><code>main = getLine &gt;&gt;=\n  (runQuestion {b}{typeableDict4b}{showDict4b} . getQuestion) &gt;&gt;=\n  print {b}{showDict4b}\n</code></pre>\n\n<p>and as the return type of <code>runQuestion {b}</code> is <code>IO b</code>, it must be the case that <code>print</code>'s <code>c</code> type is the same as <code>runQuestion</code>'s <code>b</code> type, but other than that, there is <em>nothing</em> to determine which type <code>b</code> is, or why it is an instance either of <code>Typeable</code> or <code>Show</code>. With the type annotation, the need for <code>Typeable</code> shows up first (in the <code>runQuestion</code> call); without, the need for <code>Show</code> in <code>print</code> causes the complaint.</p>\n\n<p>The real problem, is that somehow, you seem to want <code>runQuestion</code> to deliver a thing in whatever type is hidden inside the question, as if you could somehow write a (dependently typed) program like</p>\n\n<pre><code>typeFrom :: Question -&gt; *\ntypeFrom (Simple {a}{typeableDict4a}{showDict4a} message parser) = a\n\nrunQuestion :: (q :: Question) -&gt; IO (typeFrom q)\n</code></pre>\n\n<p>That's a perfectly sensible thing to want, but it isn't Haskell: there's no way to name \"the type packed up inside that argument\". Everything which involves that type has to live in the scope of the case analysis or pattern match which exposes it. It's your attempt to do the <code>print</code> outside that scope that won't be allowed.</p>\n"}], "owner": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 0, "accepted_answer_id": 39148323, "answer_count": 2, "score": 1, "last_activity_date": 1472175886, "creation_date": 1472133992, "last_edit_date": 1495540297, "question_id": 39147517, "link": "https://stackoverflow.com/questions/39147517/functions-of-gadts", "title": "Functions of GADTs", "body": "<p>It's a followup question of <a href=\"https://stackoverflow.com/questions/39143379/functions-to-polymorphic-data-types\">Functions to Polymorphic data types</a> </p>\n\n<p>Data type <code>Question</code> models a question/answer with a <code>Message</code> (the text of the question) and a function (<code>String -&gt; a</code>) that maps user's input to the result of the question:</p>\n\n<pre><code>data Question where\n  Simple :: (Typeable a, Show a) =&gt; Message -&gt; (String -&gt; a) -&gt; Question\n</code></pre>\n\n<p>This CLI program should first gets the name of the <code>Question</code>, find an instance using <code>getQuestion</code> function and then run the <code>Question</code> and print out the result.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE GADTs #-}\n\nimport Data.Typeable\n\ntype Message = String\n\ndata Question where\n  Simple :: (Typeable a, Show a) =&gt; Message -&gt; (String -&gt; a) -&gt; Question\n  -- more constructors\n\nyourName :: Question\nyourName = Simple \"Your name?\" id\n\nyourWeight :: Question\nyourWeight = Simple \"What is your weight?\" (read :: String -&gt; Int)\n\ngetQuestion :: String -&gt; Question\ngetQuestion \"name\" =  yourName\ngetQuestion \"weight\" =  yourWeight    \n\nrunQuestion :: (Typeable a, Show a) =&gt; Question -&gt; IO a\nrunQuestion (Simple message parser) = do\n  putStrLn message\n  ans &lt;- getLine\n  return $ parser ans\n\nmain = getLine &gt;&gt;= (runQuestion . getQuestion) &gt;&gt;= print\n</code></pre>\n\n<p>Type checking fails at here: <code>runQuestion :: (Typeable a, Show a) =&gt; Question -&gt; IO a</code> with <code>No instance for (Typeable a0) arising from a use of \u2018runQuestion\u2019</code>.</p>\n\n<p>If I remove the class constraints (<code>runQuestion :: Question -&gt; IO a</code>) then I get <code>No instance for (Show a0) arising from a use of \u2018print</code>.</p>\n"}, {"tags": ["haskell", "polymorphism", "gadt", "existential-type"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 5, "creation_date": 1472125998, "post_id": 39144302, "comment_id": 65633093, "body": "I like this, but I wonder if the OP really needs it -- it&#39;s easy to fall in the <a href=\"https://lukepalmer.wordpress.com/2010/01/24/haskell-antipattern-existential-typeclass/\" rel=\"nofollow noreferrer\">existential antipattern</a>. Only the OP knows, though."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1472127733, "post_id": 39144302, "comment_id": 65634281, "body": "@chi yes this is existential thingy but I don&#39;t think it&#39;s so much an antipattern. I know I&#39;m an a minority here."}, {"owner": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "edited": false, "score": 0, "creation_date": 1472128138, "post_id": 39144302, "comment_id": 65634551, "body": "Did we made <code>Foo</code> a union type here? Is this equivalent to <code>data Foo = IFoo Int | BFoo Bool</code>?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1472130713, "post_id": 39144302, "comment_id": 65636348, "body": "@n.m. Well, I also think Luke Palmer is a bit too extreme in its blog post. Still, I think using e.g. a list of Show-ables instead of a list of strings is a pointless overcomplication. In my view the type <code>Foo</code> above is valuable, but only because of the <code>Typeable</code> constraint, which allows one to <code>cast</code> later on and recover the type. Otherwise, <code>Foo</code> is isomorphic to a string (or, at most, to a string-builder function as in <code>shows</code>) so using existentials looks a bit overkill."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "edited": false, "score": 0, "creation_date": 1472130809, "post_id": 39144302, "comment_id": 65636427, "body": "@homam No it&#39;s not equivalent. <code>Foo</code> can also contain strings, pairs of ints, lists of lists of ints, etc. It can wrap anything which is showable (and typeable)."}], "tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": true, "score": 4, "last_activity_date": 1472125201, "creation_date": 1472125201, "answer_id": 39144302, "question_id": 39143379, "link": "https://stackoverflow.com/questions/39143379/functions-to-polymorphic-data-types/39144302#39144302", "title": "Functions to Polymorphic data types", "body": "<p>Perhaps you want to omit the type parameter from Foo.</p>\n\n<pre><code>data Foo where\n  Foo :: (Typeable a, Show a) =&gt; a -&gt; Foo\n\ninstance Show Foo where\n  show (Foo a) = show a\n\nfiveFoo :: Foo\nfiveFoo = Foo (5 :: Int) -- (Foo 5) doesn't work because of ambiguity\n\nfalseFoo :: Foo\nfalseFoo = Foo False\n\ngetFoo :: String -&gt; Foo\ngetFoo \"five\" = fiveFoo\ngetFoo \"false\" = falseFoo\n\nprint $ getFoo \"five\" -- prints '5'\nprint $ getFoo \"false\" -- prints 'False'\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "edited": false, "score": 1, "creation_date": 1472127591, "post_id": 39144779, "comment_id": 65634162, "body": "Well you&#39;re right. I tried to boil down my problem to its simplest. I want to create a series of <code>Nodes a b</code> (like a Category) so that each Node processes an input from user and continue with either another <code>Node b a&#39;</code> or with the final result <code>b</code>."}, {"owner": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "edited": false, "score": 1, "creation_date": 1472134249, "post_id": 39144779, "comment_id": 65638812, "body": "This is closer to my real problem: <a href=\"http://stackoverflow.com/questions/39147517/functions-of-gadts\">stackoverflow.com/questions/39147517/functions-of-gadts</a>"}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 2, "last_activity_date": 1472126512, "creation_date": 1472126512, "answer_id": 39144779, "question_id": 39143379, "link": "https://stackoverflow.com/questions/39143379/functions-to-polymorphic-data-types/39144779#39144779", "title": "Functions to Polymorphic data types", "body": "<pre><code>getFoo :: (Show a, Typeable a) =&gt; String -&gt; Foo a\ngetFoo \"five\" = fiveFoo\ngetFoo \"false\" = falseFoo\n</code></pre>\n\n<p>If <code>fiveFoo :: Foo Int</code> and <code>falseFoo :: Foo Bool</code>, you're essentially asking for <code>getFoo</code> to return a different type depending on what value you feed it at run-time. You can't do that. In Haskell, all types must be known at <em>compile-time</em>.</p>\n\n<p>If all you want to be able to do is convert the thing to a string, why not just store it as a string in the first place? I'm guessing the answer is that this is actually a simplification of the real problem you're trying to solve...(?)</p>\n"}, {"comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 3, "creation_date": 1472127905, "post_id": 39144975, "comment_id": 65634393, "body": "<code>data Foo a</code> --- <code>a</code> is redundant here, the &quot;inner&quot; <code>a</code> inside <code>forall</code> is a different variable!"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1472131501, "post_id": 39144975, "comment_id": 65636894, "body": "also, the GADT solution is almost exactly the same as the existential solution (and I have used a GADT only because OP used one) Don&#39;t GADTs subsume existential types?"}], "tags": [], "owner": {"reputation": 9436, "user_id": 444705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e754cabb8c4f443410c1fd107ecdfd8?s=128&d=identicon&r=PG", "display_name": "Pi Delport", "link": "https://stackoverflow.com/users/444705/pi-delport"}, "is_accepted": false, "score": 5, "last_activity_date": 1472130095, "last_edit_date": 1472130095, "creation_date": 1472127066, "answer_id": 39144975, "question_id": 39143379, "link": "https://stackoverflow.com/questions/39143379/functions-to-polymorphic-data-types/39144975#39144975", "title": "Functions to Polymorphic data types", "body": "<p>You can use <a href=\"https://wiki.haskell.org/Existential_type\" rel=\"nofollow\">existential types</a> to make a data type hide and \"carry\" a type class like <code>Show</code> around.</p>\n\n<p>Note that using existential types like this is considered to be an <a href=\"https://lukepalmer.wordpress.com/2010/01/24/haskell-antipattern-existential-typeclass/\" rel=\"nofollow\">anti-pattern</a> in Haskell, and you probably want to consider carefully whether you really want to do this: being more explicit about your types is usually simpler, better, and less prone to bugs.</p>\n\n<p>However, that being said, if you really want to do this, here is how you would use existential types with your example:</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\n\n-- This Foo can only be constructed with instances of Show as its argument.\ndata Foo = forall a. Show a =&gt; Foo a\n\n-- Note that there is no \"Show a =&gt; ...\" context here:\n-- Foo itself already carries that constraint around with it.\ninstance Show Foo where\n  show (Foo a) = show a\n\n\ngetFoo :: String -&gt; Foo\ngetFoo \"five\" = Foo 5\ngetFoo \"false\" = Foo False\n\nmain = print . getFoo =&lt;&lt; getLine\n</code></pre>\n\n<p>Demonstration:</p>\n\n<pre><code>ghci&gt; main\nfive\n5\nghci&gt; main\nfalse\nFalse\n</code></pre>\n"}], "owner": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 656, "favorite_count": 1, "accepted_answer_id": 39144302, "answer_count": 3, "score": 4, "last_activity_date": 1472130095, "creation_date": 1472122490, "last_edit_date": 1472127109, "question_id": 39143379, "link": "https://stackoverflow.com/questions/39143379/functions-to-polymorphic-data-types", "title": "Functions to Polymorphic data types", "body": "<p>data <code>Foo a</code> is defined like:</p>\n\n<pre><code>data Foo a where\n  Foo :: (Typeable a, Show a) =&gt; a -&gt; Foo a\n  -- perhaps more constructors\n\ninstance Show a =&gt; Show (Foo a) where\n  show (Foo a) = show a\n</code></pre>\n\n<p>with some instances:</p>\n\n<pre><code>fiveFoo :: Foo Int\nfiveFoo = Foo 5\n\nfalseFoo :: Foo Bool\nfalseFoo = Foo False\n</code></pre>\n\n<p>How can I define any function from <code>b -&gt; Foo a</code>, for example:</p>\n\n<pre><code>getFoo :: (Show a, Typeable a) =&gt; String -&gt; Foo a\ngetFoo \"five\" = fiveFoo\ngetFoo \"false\" = falseFoo\n</code></pre>\n\n<p>Here <code>getFoo</code> does not type check with <code>Couldn't match type \u2018a\u2019 with \u2018Bool\u2019</code>.</p>\n\n<p>The only thing that I am interested in here is for <code>a</code> to be of class <code>Show</code>so I can use <code>getFoo</code> like:</p>\n\n<pre><code>main = getLine &gt;&gt;= (print . getFoo)\n</code></pre>\n"}, {"tags": ["haskell", "syntax"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1472125234, "post_id": 39142322, "comment_id": 65632540, "body": "Partial duplicate of <a href=\"http://stackoverflow.com/questions/28624408/equal-vs-left-arrow-symbols-in-haskell\" title=\"equal vs left arrow symbols in haskell\">stackoverflow.com/questions/28624408/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "edited": false, "score": 0, "creation_date": 1472120488, "post_id": 39142494, "comment_id": 65629473, "body": "It&#39;s very clear! Thanks a lot! May I ask what is a &#39;top-level binding&#39;? What&#39;s the difference between a top-level binding and other bindings?"}, {"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "reply_to_user": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "edited": false, "score": 0, "creation_date": 1472122979, "post_id": 39142494, "comment_id": 65631071, "body": "Top-level bindings are those directly at file level (or in a module&#39;s where block). The only real difference to other bindings is their visibility."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1472633892, "post_id": 39142494, "comment_id": 65826197, "body": "I think <i>&quot;monadic extraction&quot;</i> should really be <i>&quot;monadic binding&quot;</i>."}], "tags": [], "owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "is_accepted": false, "score": 5, "last_activity_date": 1472121450, "last_edit_date": 1472121450, "creation_date": 1472120034, "answer_id": 39142494, "question_id": 39142322, "link": "https://stackoverflow.com/questions/39142322/whats-the-difference-between-in-haskell/39142494#39142494", "title": "What&#39;s the difference between =, &lt;- ,&lt;= In haskell?", "body": "<p><code>=</code> is a binding. It binds a name to a value/expression. You use it for top-level bindings, in let blocks and in where blocks.</p>\n\n<pre><code>myfun x = let y = x + 1\n          in z y\n  where z n = n * n\n</code></pre>\n\n<p><code>&lt;-</code> is a monadic extraction. It's part of the <code>do</code> notation and introduces a name bound to the contents of a monad.</p>\n\n<pre><code>main = do\n  name &lt;- getLine\n  putStrLn (\"Hello, \" ++ name)\n</code></pre>\n\n<p><code>&lt;=</code> is the less-or-equal operator defined in the <code>Cmp</code> typeclass.</p>\n\n<pre><code>message x = if x &lt; 18 then \"No, you can't vote.\" else \"Go ahead.\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 10, "last_activity_date": 1506553844, "last_edit_date": 1506553844, "creation_date": 1472121364, "answer_id": 39142992, "question_id": 39142322, "link": "https://stackoverflow.com/questions/39142322/whats-the-difference-between-in-haskell/39142992#39142992", "title": "What&#39;s the difference between =, &lt;- ,&lt;= In haskell?", "body": "<ul>\n<li><p><code>=</code> means <strong>defined to be equal</strong>. I.e., if I write</p>\n\n<pre><code>x = 5\n</code></pre>\n\n<p>somewhere in a file, I can then at any other point (within the same scope) replace <code>5</code> with <code>x</code> and vice versa \u2013 they're the same thing. (And will always remain the same.) The definition can however also refer back to the name you're binding it to, to give recursive computations like</p>\n\n<pre><code>fibonacci :: [Integer]\nfibonacci = 0 : 1 : zipWith (+) fibs (tail fibonacci)\n</code></pre>\n\n<p>In this case, you could still at any point replace <code>fibonacci</code> with <code>0 : 1 : zipWith (+) fibs (tail fibonacci)</code>, though of course you would need to repeat the process infinitely.<br>\nA <code>=</code> definition can stand either at the top-level, i.e. in a line of its own in the module, or within a <code>let</code> or <code>where</code> block:</p>\n\n<pre><code>silly :: Integer -&gt; Integer\nsilly x = y\n where y = let z = x + 1\n           in z - 1\n</code></pre>\n\n<p>Here, <code>silly</code> is a top-level binding (with a function argument), <code>y</code> is a <code>where</code> binding, and <code>z</code> is a <code>let</code> binding.</p></li>\n<li><p><code>&lt;-</code> means essentially <strong>defined as the <em>result</em> of</strong>, meaning the result of a monadic computation. It usually stands in a <code>do</code> block, for instance:</p>\n\n<pre><code>main :: IO ()\nmain = do\n   putStrLn \"Enter your name, please\"\n   userName &lt;- getLine\n   putStrLn $ \"Hello, \" ++ userName\n</code></pre>\n\n<p>Note that this is very different from</p>\n\n<pre><code>main = do\n   putStrLn \"Enter your name, please\"\n   let userName' = getLine\n   putStrLn $ \"Hello, \" ++ userName'  -- error here\n</code></pre>\n\n<p>What this would do is not define <code>userName</code> as the string entered by the user, but as <em>the action that requests a string to be entered</em>. <code>userName</code> is a <code>String</code>, but <code>userName' :: IO String</code>.</p>\n\n<p><code>&lt;-</code> is also used in list comprehensions:</p>\n\n<pre><code>squareNums :: [Integer]\nsquareNums = [x^2 | x &lt;- [0..]]\n</code></pre>\n\n<p>It may seem that this does something different from <code>userName &lt;- getLine</code>, but actually it does the same thing, just in a different monad (list instead of IO). In fact I could also write that as</p>\n\n<pre><code>squareNums = do\n    x &lt;- [0..]\n    return $ x^2\n</code></pre>\n\n<p>There's also a third use of <code>&lt;-</code> which is really different: <a href=\"https://wiki.haskell.org/Pattern_guard\" rel=\"nofollow noreferrer\">pattern guards</a>, but these are not so common.</p></li>\n<li><p><code>&lt;=</code> is just a library function (in infix-operator form). This is also the case for most other symbolic \u201csyntax\u201d you'll encounter in Haskell. You can <a href=\"https://hayoo.fh-wedel.de/?query=%3C%3D\" rel=\"nofollow noreferrer\">ask Hayoo</a> about such operators, it will tell you that <code>&lt;=</code> is <a href=\"http://hackage.haskell.org/package/base/docs/Data-Ord.html#v:-60--61-\" rel=\"nofollow noreferrer\">defined in the <code>Data.Ord</code> module</a> and is simply the less-that-or-equal comparison operator.\n<br> You can also define such operators yourself \u2013 if it weren't already in the standard library, I could easily define</p>\n\n<pre><code>(&lt;=) :: Ord a =&gt; a -&gt; a -&gt; Bool\nx &lt;= y = not $ x &gt; y\n</code></pre>\n\n<p>Incidentally, that <code>=&gt;</code> in the signature is something completely different \u2013 this is again built-in syntax. There was also a <a href=\"https://stackoverflow.com/questions/39084551/what-does-the-sign-mean-in-haskell\">question about that</a> this week.</p></li>\n</ul>\n"}], "owner": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 486, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1506553844, "creation_date": 1472119598, "last_edit_date": 1472119793, "question_id": 39142322, "link": "https://stackoverflow.com/questions/39142322/whats-the-difference-between-in-haskell", "title": "What&#39;s the difference between =, &lt;- ,&lt;= In haskell?", "body": "<p>We usually see <code>=</code>, <code>&lt;-</code>, <code>&lt;=</code> in haskell. What's the difference between these?</p>\n"}, {"tags": ["http", "haskell", "port", "ghc"], "comments": [{"owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "edited": false, "score": 0, "creation_date": 1472117388, "post_id": 39139787, "comment_id": 65627355, "body": "If the host is protected by portknocking, even nmap will think all its ports are closed. How exactly do you want to query the ports ?"}, {"owner": {"reputation": 61, "user_id": 6756007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28714ec499c9bc575f81b568a5c5379a?s=128&d=identicon&r=PG&f=1", "display_name": "Dorkajo", "link": "https://stackoverflow.com/users/6756007/dorkajo"}, "reply_to_user": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "edited": false, "score": 0, "creation_date": 1472120695, "post_id": 39139787, "comment_id": 65629596, "body": "@V.Semeria, we can assume it&#39;s not protected."}], "answers": [{"comments": [{"owner": {"reputation": 61, "user_id": 6756007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28714ec499c9bc575f81b568a5c5379a?s=128&d=identicon&r=PG&f=1", "display_name": "Dorkajo", "link": "https://stackoverflow.com/users/6756007/dorkajo"}, "edited": false, "score": 0, "creation_date": 1472207664, "post_id": 39143773, "comment_id": 65670990, "body": "it always returns False, in particular for localhost. have you tried it?"}, {"owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "reply_to_user": {"reputation": 61, "user_id": 6756007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28714ec499c9bc575f81b568a5c5379a?s=128&d=identicon&r=PG&f=1", "display_name": "Dorkajo", "link": "https://stackoverflow.com/users/6756007/dorkajo"}, "edited": false, "score": 0, "creation_date": 1472207776, "post_id": 39143773, "comment_id": 65671043, "body": "Yes I tried it on localhost, with a small web server I have on my machine. You can check what exception it throws in your case."}, {"owner": {"reputation": 61, "user_id": 6756007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28714ec499c9bc575f81b568a5c5379a?s=128&d=identicon&r=PG&f=1", "display_name": "Dorkajo", "link": "https://stackoverflow.com/users/6756007/dorkajo"}, "edited": false, "score": 0, "creation_date": 1472208851, "post_id": 39143773, "comment_id": 65671604, "body": "or maybe not always, but it seems in some cases it returns false instead of true."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1472231980, "post_id": 39143773, "comment_id": 65685565, "body": "If you&#39;d like it to always return true then just <code>isPortOpen _ _ = true</code> ;-).  Seriously though you need to be more specific, in my tests this routine returns true for open TCP ports and false for closed ports."}, {"owner": {"reputation": 21995, "user_id": 263061, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/7c724c96f7ec19f73245499b6169e329?s=128&d=identicon&r=PG", "display_name": "nh2", "link": "https://stackoverflow.com/users/263061/nh2"}, "edited": false, "score": 1, "creation_date": 1520383553, "post_id": 39143773, "comment_id": 85290306, "body": "This solution leaks the created Handle <code>h</code>. GC will clean it up eventually, but if you call <code>isPortOpen</code> many times in a loop, you may run out of handles before GC kicks in. You should probably <code>hClose</code> the handle in the <code>Right</code> branch. Also, the <code>SomeException</code> catch-all is quite generic, you should better catch specifically <code>IOError</code>. <a href=\"https://gist.github.com/nh2/3fb70820d89f5e9f6d1ee80415c53a72\" rel=\"nofollow noreferrer\">Here&#39;s a gist</a> of a more complete solution."}, {"owner": {"reputation": 21995, "user_id": 263061, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/7c724c96f7ec19f73245499b6169e329?s=128&d=identicon&r=PG", "display_name": "nh2", "link": "https://stackoverflow.com/users/263061/nh2"}, "edited": false, "score": 0, "creation_date": 1563049413, "post_id": 39143773, "comment_id": 100575359, "body": "My <a href=\"https://gist.github.com/nh2/3fb70820d89f5e9f6d1ee80415c53a72\" rel=\"nofollow noreferrer\">previous gist</a> is now outdated (I updated it to say why). I&#39;ve posted a <a href=\"https://stackoverflow.com/questions/39139787/i-want-to-check-whether-or-not-a-certain-port-is-open-haskell/57022572#57022572\">full answer</a> with <a href=\"https://gist.github.com/nh2/0a1442eb71ec0405a1e3ce83a467dfde\" rel=\"nofollow noreferrer\">better gist</a>."}], "tags": [], "owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "is_accepted": false, "score": 1, "last_activity_date": 1472136055, "last_edit_date": 1472136055, "creation_date": 1472123676, "answer_id": 39143773, "question_id": 39139787, "link": "https://stackoverflow.com/questions/39139787/i-want-to-check-whether-or-not-a-certain-port-is-open-haskell/39143773#39143773", "title": "I want to check whether or not a certain port is open (Haskell)?", "body": "<p>If <code>connectTo</code> returns, then the port is open. Otherwise it will throw exceptions like </p>\n\n<pre><code>*** Exception: connect: failed (Connection timed out (WSAETIMEDOUT))\n</code></pre>\n\n<p>or</p>\n\n<pre><code>*** Exception: connect: failed (Connection refused (WSAECONNREFUSED))\n</code></pre>\n\n<p>So you could do</p>\n\n<pre><code>import Network(connectTo, PortID(..), PortNumber(..))\nimport Control.Exception(try, SomeException)\nimport System.IO(Handle)\n\nisPortOpen :: String -&gt; PortNumber -&gt; IO Bool\nisPortOpen host port = do\n  h &lt;- try $ connectTo host (PortNumber port) :: IO (Either SomeException Handle)\n  return $ case h of\n    Left _ -&gt; False\n    Right _ -&gt; True\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21995, "user_id": 263061, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/7c724c96f7ec19f73245499b6169e329?s=128&d=identicon&r=PG", "display_name": "nh2", "link": "https://stackoverflow.com/users/263061/nh2"}, "is_accepted": false, "score": 2, "last_activity_date": 1563049347, "creation_date": 1563049347, "answer_id": 57022572, "question_id": 39139787, "link": "https://stackoverflow.com/questions/39139787/i-want-to-check-whether-or-not-a-certain-port-is-open-haskell/57022572#57022572", "title": "I want to check whether or not a certain port is open (Haskell)?", "body": "<p>The main task here is to connect to call <code>connect</code> and <strong>capture exactly the case that the host refused the connection</strong> (as opposed to the host not existing or being unroutable).</p>\n\n<p>A solution using the new <code>Network.Socket</code> API, not the deprecated <code>Socket</code> module, using the <a href=\"https://hackage.haskell.org/package/unliftio\" rel=\"nofollow noreferrer\"><code>unliftio</code></a> package's for async exception handling safety (you can use <code>Control.Exception</code> instead, but it will be <a href=\"https://haskell.fpcomplete.com/tutorial/exceptions\" rel=\"nofollow noreferrer\">less safe</a>):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import           Data.Word (Word8)\nimport           Foreign.C.Error (Errno(..), eCONNREFUSED)\nimport           GHC.IO.Exception (IOException(..))\nimport           Network.Socket (PortNumber, socket, connect, close', Family(AF_INET), SocketType(Stream), SockAddr(SockAddrInet), tupleToHostAddress)\nimport           UnliftIO.Exception (try, bracket, throwIO)\n\n\n-- | Checks whether @connect()@ to a given TCPv4 `SockAddr` succeeds or\n-- returns `eCONNREFUSED`.\n--\n-- Rethrows connection exceptions in all other cases (e.g. when the host\n-- is unroutable).\nisPortOpen :: SockAddr -&gt; IO Bool\nisPortOpen sockAddr = do\n  bracket (socket AF_INET Stream 6 {- TCP -}) close' $ \\sock -&gt; do\n    res &lt;- try $ connect sock sockAddr\n    case res of\n      Right () -&gt; return True\n      Left e -&gt;\n        if (Errno &lt;$&gt; ioe_errno e) == Just eCONNREFUSED\n          then return False\n          else throwIO e\n\n\n-- | Creates a `SockAttr` from host IP and port number.\n--\n-- Example:\n-- &gt; simpleSockAddr (127,0,0,1) 8000\nsimpleSockAddr :: (Word8, Word8, Word8, Word8) -&gt; PortNumber -&gt; SockAddr\nsimpleSockAddr addr port = SockAddrInet port (tupleToHostAddress addr)\n</code></pre>\n\n<p>Then you can do:</p>\n\n<pre><code>&gt; isPortOpen (simpleSockAddr (127,0,0,1) 8000)\nTrue\n</code></pre>\n\n<p>Full module in <a href=\"https://gist.github.com/nh2/0a1442eb71ec0405a1e3ce83a467dfde\" rel=\"nofollow noreferrer\">this gist</a>.</p>\n"}], "owner": {"reputation": 61, "user_id": 6756007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28714ec499c9bc575f81b568a5c5379a?s=128&d=identicon&r=PG&f=1", "display_name": "Dorkajo", "link": "https://stackoverflow.com/users/6756007/dorkajo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 370, "favorite_count": 1, "answer_count": 2, "score": 6, "last_activity_date": 1563049347, "creation_date": 1472112155, "last_edit_date": 1472121270, "question_id": 39139787, "link": "https://stackoverflow.com/questions/39139787/i-want-to-check-whether-or-not-a-certain-port-is-open-haskell", "title": "I want to check whether or not a certain port is open (Haskell)?", "body": "<p>I want to check whether or not a certain port is open on a certain host. How can I do that? After I've called <code>connectTo</code> and what's next, how can I actually know if a port is open?</p>\n\n<pre><code>main = do\n  withSocketsDo $ do\n    h &lt;- connectTo \"some_host.com\" $ PortNumber 1234\n    --- and....?\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 4, "creation_date": 1472126390, "post_id": 39136975, "comment_id": 65633357, "body": "The claim &quot;this question is already answered by &#39;What is the monomorphism restriction&#39;?&quot; is simply false and degrading to the user."}], "answers": [{"comments": [{"owner": {"reputation": 3967, "user_id": 3853711, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/SwXly.png?s=128&g=1", "display_name": "Rahn", "link": "https://stackoverflow.com/users/3853711/rahn"}, "edited": false, "score": 0, "creation_date": 1472101608, "post_id": 39137040, "comment_id": 65618721, "body": "But I didn&#39;t specify type at the first definition. Why does is work if a type signature is required?"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1472103797, "post_id": 39137040, "comment_id": 65619443, "body": "It might be worth mentioning that you can, y\u2019know, just <i>turn the monomorphism restriction off</i> if you so desire with the <code>NoMonomorphismRestriction</code> language pragma."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1472104033, "post_id": 39137040, "comment_id": 65619526, "body": "The monomorphism restriction only functions at the top level; it does not affect <code>let</code> bindings. The monomorphism restriction is rarely actually useful, and is especially unlikely to be useful if you compile your code with optimizations enabled; if it confuses you, turn it off."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 3, "last_activity_date": 1472104263, "last_edit_date": 1472104263, "creation_date": 1472101494, "answer_id": 39137040, "question_id": 39136975, "link": "https://stackoverflow.com/questions/39136975/haskell-define-product-with-foldr/39137040#39137040", "title": "Haskell: Define product with foldr", "body": "<p>This is the <a href=\"https://wiki.haskell.org/Monomorphism_restriction\" rel=\"nofollow\">Monomorphism restriction</a> at work. The solution is to add a type signature:</p>\n\n<pre><code>new_product :: (Foldable t, Num b) =&gt; t b -&gt; b\nnew_product = foldr (*) 1\n</code></pre>\n\n<hr>\n\n<p>Essentially, the problem here is that unless you are in GHCi (where this is disabled) Haskell refuses to infer a polymorphic type signature unless you explicitly have variables for the function. As a concrete example:</p>\n\n<pre><code>f x = ...      -- `f` can infer polymorphic type (in `x`) \nf = \\x -&gt; ...  -- `f` infers a monomorphic type\n</code></pre>\n\n<p>In your case, <code>f</code> is <code>new_product</code> and <code>x</code> is <code>xs</code>. When you have the point-free style, Haskell attempts to infer a monomorphic signature for <code>new_product</code> and fails because it can't figure out which <code>Foldable</code> instance to choose (based on <code>foldr</code>). On the other hand, when you include the <code>xs</code>, Haskell is no longer bound to infer a monomorphic signature, hence everything works.</p>\n\n<p>There is reason to this madness: the point is that when you write something like <code>f = ...</code> it is natural to assume that <code>f</code> only gets evaluated once. Yet, unless we force <code>f</code> to be monomorphic, that isn't necessarily the case.</p>\n\n<p>To use an example related to your function: suppose that I infer that <code>p = num_product [1..1000]</code> has type <code>Num a =&gt; a</code> (the most general type in this case), then using <code>p :: Int</code> and <code>p :: Integer</code> will cause us to evaluate <code>p</code> at least twice.</p>\n\n<p>Haskell has therefore decided not to <em>generalize</em> top-level bindings: you only infer polymorphic signatures for functions that have their variables explicit (ie. on the left hand side of the equal). That said, if you wish to explicitly write a polymorphic type signature, you are free to do so.</p>\n"}], "owner": {"reputation": 3967, "user_id": 3853711, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/SwXly.png?s=128&g=1", "display_name": "Rahn", "link": "https://stackoverflow.com/users/3853711/rahn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 669, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1472221837, "creation_date": 1472101210, "question_id": 39136975, "link": "https://stackoverflow.com/questions/39136975/haskell-define-product-with-foldr", "title": "Haskell: Define product with foldr", "body": "<p>I'm trying to define <code>product</code> with <code>foldr</code>:</p>\n\n<p>I could do it with:</p>\n\n<p><code>new_product xs = foldr (*) 1 xs</code></p>\n\n<p>but not:</p>\n\n<p><code>new_product = foldr (*) 1</code></p>\n\n<p>or:</p>\n\n<p><code>new_product = \\xs -&gt; foldr (*) 1 xs</code></p>\n\n<p>Both definition produce the same error:</p>\n\n<blockquote>\n  <p>No instance for (Foldable t0) arising from a use of \u2018folder\u2019</p>\n  \n  <p>The type variable \u2018t0\u2019 is ambiguous</p>\n  \n  <p>Relevant bindings include</p>\n  \n  <p>new_product :: t0 Integer -> Integer</p>\n</blockquote>\n\n<p>Is it some kind of type error?</p>\n\n<p>How could I fix it?</p>\n"}, {"tags": ["haskell", "ghci"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1472097987, "creation_date": 1472097987, "answer_id": 39136550, "question_id": 39136407, "link": "https://stackoverflow.com/questions/39136407/haskell-ghci-load-as-much-as-possible-rather-than-fail-or-error/39136550#39136550", "title": "Haskell: GHCi Load as much as possible, rather than fail or error", "body": "<p>Just give them a binding that doesn't work:</p>\n\n<pre><code>methodB = undefined\nmethodC = undefined\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 5, "last_activity_date": 1472100830, "creation_date": 1472100830, "answer_id": 39136906, "question_id": 39136407, "link": "https://stackoverflow.com/questions/39136407/haskell-ghci-load-as-much-as-possible-rather-than-fail-or-error/39136906#39136906", "title": "Haskell: GHCi Load as much as possible, rather than fail or error", "body": "<p>You can use <code>-fdefer-type-errors</code>. This will give you warnings about type errors but won't prevent you from running the other well-typed parts of your program.</p>\n\n<p>Example:</p>\n\n<p>If <code>Program.hs</code> contains:</p>\n\n<pre><code>foo :: Int\nfoo = 'a'\n\nmain = putStrLn \"Hello, world\"\n</code></pre>\n\n<p>Then with -fdefer-type-errors you can still load and run <code>main</code>:</p>\n\n<pre><code>$ ghci -fdefer-type-errors Program.hs\nGHCi, version 7.10.2: http://www.haskell.org/ghc/  :? for help\n[1 of 1] Compiling Main             ( Program.hs, interpreted )\n\nProgram.hs:5:7: Warning:\n    Couldn't match expected type \u2018Int\u2019 with actual type \u2018Char\u2019\n    In the expression: 'a'\n    In an equation for \u2018foo\u2019: foo = 'a'\nOk, modules loaded: Main.\n*Main&gt; main\nHello, world\n*Main&gt; \n</code></pre>\n"}], "owner": {"reputation": 386, "user_id": 1432051, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/e0a7761ff6709f6a086a4fe7160be930?s=128&d=identicon&r=PG", "display_name": "jamesmstone", "link": "https://stackoverflow.com/users/1432051/jamesmstone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 1, "accepted_answer_id": 39136906, "answer_count": 2, "score": 2, "last_activity_date": 1472100830, "creation_date": 1472097005, "question_id": 39136407, "link": "https://stackoverflow.com/questions/39136407/haskell-ghci-load-as-much-as-possible-rather-than-fail-or-error", "title": "Haskell: GHCi Load as much as possible, rather than fail or error", "body": "<p>In Haskell using GHCi is there a way to load a file such as the one below, that lets you test the methods that have bindings. </p>\n\n<p><strong>Use case:</strong> trying to test part of my module, while having skeleton code for the rest of it. (as to not have an XY problem)</p>\n\n<pre><code>module X (methodA, methodB, methodC) where\n\nmethodA :: String-&gt;String\nmethodA name = \"Hello \" ++ name\n\nmethodB :: Int -&gt; String\n\nmethodC :: String -&gt; String\n</code></pre>\n\n<p>This obviously outputs the correct error : <code>The type signature for \u2018methodB\u2019 lacks an accompanying binding</code>.\nFor example I would like something similar to below to work.</p>\n\n<pre><code>GHCi, version 8.0.1: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; :l example.hs \n[1 of 1] Compiling X                ( example.hs, interpreted )\n\nexample.hs:6:1: error:\n    The type signature for \u2018methodB\u2019 lacks an accompanying binding\n\nexample.hs:8:1: error:\n    The type signature for \u2018methodC\u2019 lacks an accompanying binding\nFailed, modules loaded: none.\nPrelude&gt; methodA \"jamesmstone\"\n\n&lt;interactive&gt;:2:1: error:\n    Variable not in scope: methodA :: [Char] -&gt; t\n</code></pre>\n"}]